<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.46" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/database/mysql/transaction.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="MySQL Transaction"><meta property="og:description" content="MySQL Transaction Không phải tất cả các engine lưu trữ của MySQL đều hỗ trợ giao dịch. Các engine lưu trữ hỗ trợ giao dịch bao gồm: InnoDB và NDB Cluster. Các engine lưu trữ khô..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/vanhung4499/images/master/snap/185b9c49-4c13-4241-a848-fbff85c03a64.png"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-06-28T15:54:38.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:modified_time" content="2024-06-28T15:54:38.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"MySQL Transaction","image":["https://raw.githubusercontent.com/vanhung4499/images/master/snap/185b9c49-4c13-4241-a848-fbff85c03a64.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002023.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/acid.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/202307210021321.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002326.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002333.png"],"dateModified":"2024-06-28T15:54:38.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>MySQL Transaction | VanHung4499</title><meta name="description" content="MySQL Transaction Không phải tất cả các engine lưu trữ của MySQL đều hỗ trợ giao dịch. Các engine lưu trữ hỗ trợ giao dịch bao gồm: InnoDB và NDB Cluster. Các engine lưu trữ khô...">
    <link rel="preload" href="/assets/style-BqjKxtxe.css" as="style"><link rel="stylesheet" href="/assets/style-BqjKxtxe.css">
    <link rel="modulepreload" href="/assets/app-BVzepGwQ.js"><link rel="modulepreload" href="/assets/transaction.html-ogMJAEij.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/project/" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon><!--]-->Project<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interview/" aria-label="Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:account-tie" width="1em" height="1em"></iconify-icon><!--]-->Interview<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">SQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/overview.html" aria-label="MySQL Overview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Overview<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/guide.html" aria-label="MySQL Guide"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Guide<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/architecture.html" aria-label="MySQL Architecture"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Architecture<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/engine.html" aria-label="MySQL Storage Engine"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Storage Engine<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/mysql-index.html" aria-label="MySQL Index"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Index<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/database/mysql/transaction.html" aria-label="MySQL Transaction"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Transaction<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/lock.html" aria-label="Lock"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->Lock<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/replication.html" aria-label="MySQL Replication"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Replication<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/optimization.html" aria-label="MySQL Optimization"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Optimization<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/opearation.html" aria-label="MySQL Opearation"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Opearation<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/configuration.html" aria-label="MySQL Configuration"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Configuration<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">MongoDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Elasticsearch</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Elastic Stack</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon>MySQL Transaction</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-28T15:54:38.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 22 min</span><meta property="timeRequired" content="PT22M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color1 clickable" role="navigation">mysql</span><!--]--><meta property="articleSection" content="mysql"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#gioi-thieu-ve-giao-dich">Giới thiệu về giao dịch</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cach-su-dung-giao-dich">Cách sử dụng giao dịch</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cac-lenh-xu-ly-giao-dich">Các lệnh xử lý giao dịch</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#autocommit">AUTOCOMMIT</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cac-cap-đo-co-lap-giao-dich">Các cấp độ cô lập giao dịch</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#gioi-thieu-ve-cap-đo-co-lap-giao-dich">Giới thiệu về cấp độ cô lập giao dịch</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#đoc-chua-cam-ket">Đọc chưa cam kết</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#đoc-đa-cam-ket">Đọc đã cam kết</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#đoc-lap-lai">Đọc lặp lại</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tuan-tu-hoa">Tuần tự hoá</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tom-tat-ve-cac-cap-đo-co-lap">Tóm tắt về các cấp độ cô lập</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#deadlock-be-tac">Deadlock (Bế tắc)</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nguyen-nhan-cua-deadlock">Nguyên nhân của deadlock</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tranh-tinh-trang-be-tac">Tránh tình trạng bế tắc</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#giai-quyet-tinh-trang-be-tac">Giải quyết tình trạng bế tắc</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#giao-dich-phan-tan">Giao dịch phân tán</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#thuc-hanh-tot-nhat-cho-giao-dich">Thực hành tốt nhất cho giao dịch</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#su-dung-cap-đo-co-lap-giao-dich-thap-nhat-co-the">Sử dụng cấp độ cô lập giao dịch thấp nhất có thể</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tranh-viec-nang-cap-khoa-hang-thanh-khoa-bang">Tránh việc nâng cấp khóa hàng thành khóa bảng</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#thu-nho-pham-vi-giao-dich">Thu nhỏ phạm vi giao dịch</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="mysql-transaction" tabindex="-1"><a class="header-anchor" href="#mysql-transaction"><span>MySQL Transaction</span></a></h1><blockquote><p>Không phải tất cả các engine lưu trữ của MySQL đều hỗ trợ giao dịch. Các engine lưu trữ hỗ trợ giao dịch bao gồm: <code>InnoDB</code> và <code>NDB Cluster</code>. Các engine lưu trữ không hỗ trợ giao dịch bao gồm: <code>MyISAM</code>.</p><p>Người dùng có thể chọn engine lưu trữ phù hợp dựa trên việc có cần xử lý giao dịch hay không (xử lý giao dịch có thể đảm bảo an toàn dữ liệu nhưng sẽ tăng chi phí hệ thống).</p></blockquote><h2 id="gioi-thieu-ve-giao-dich" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-ve-giao-dich"><span>Giới thiệu về giao dịch</span></a></h2><blockquote><p>Giao dịch đơn giản là: <strong>Tất cả các hoạt động trong một phiên làm việc phải thành công hoặc thất bại cùng nhau</strong>. Cụ thể hơn, giao dịch là một nhóm các hoạt động tuân thủ các đặc điểm ACID, có thể được gửi đi bằng cách sử dụng <code>Commit</code> để xác nhận giao dịch hoặc sử dụng <code>Rollback</code> để hoàn tác giao dịch.</p></blockquote><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/185b9c49-4c13-4241-a848-fbff85c03a64.png" alt="185b9c49-4c13-4241-a848-fbff85c03a64.png" tabindex="0" loading="lazy"><figcaption>185b9c49-4c13-4241-a848-fbff85c03a64.png</figcaption></figure><p><strong>Giao dịch là một nhóm các câu lệnh SQL nguyên tử</strong>. Cụ thể hơn, giao dịch là một nhóm các hoạt động tuân thủ các đặc điểm ACID.</p><p><strong>Các câu lệnh SQL trong giao dịch phải được thực thi hoàn toàn thành công hoặc thất bại hoàn toàn</strong>.</p><p><strong>Các cơ chế cách ly giao dịch khác nhau có thể được thực hiện bằng cách sử dụng khóa</strong>.</p><p>Hãy tưởng tượng nếu không có giao dịch, trong môi trường đồng thời, có thể xảy ra việc mất mát thay đổi.</p><p>Hai luồng T1 và T2 đều thay đổi dữ liệu, T1 thay đổi trước, T2 thay đổi sau, thay đổi của T2 ghi đè lên thay đổi của T1.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002023.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h2 id="cach-su-dung-giao-dich" tabindex="-1"><a class="header-anchor" href="#cach-su-dung-giao-dich"><span>Cách sử dụng giao dịch</span></a></h2><h3 id="cac-lenh-xu-ly-giao-dich" tabindex="-1"><a class="header-anchor" href="#cac-lenh-xu-ly-giao-dich"><span>Các lệnh xử lý giao dịch</span></a></h3><p>Trong MySQL, sử dụng câu lệnh <code>START TRANSACTION</code> để bắt đầu một giao dịch; sử dụng câu lệnh <code>COMMIT</code> để xác nhận tất cả các thay đổi; sử dụng câu lệnh <code>ROLLBACK</code> để hoàn tác tất cả các thay đổi. Không thể hoàn tác câu lệnh <code>SELECT</code>, việc hoàn tác câu lệnh <code>SELECT</code> cũng không có ý nghĩa; cũng không thể hoàn tác câu lệnh <code>CREATE</code> và <code>DROP</code>.</p><ul><li><code>START TRANSACTION</code> - Câu lệnh dùng để đánh dấu điểm bắt đầu của giao dịch.</li><li><code>SAVEPOINT</code> - Câu lệnh dùng để tạo điểm lưu trữ.</li><li><code>ROLLBACK TO</code> - Câu lệnh dùng để hoàn tác đến điểm lưu trữ đã chỉ định; nếu không có điểm lưu trữ được đặt, nó sẽ hoàn tác đến câu lệnh <code>START TRANSACTION</code>.</li><li><code>COMMIT</code> - Xác nhận giao dịch.</li></ul><p>Ví dụ xử lý giao dịch:</p><p>(1) Tạo một bảng ví dụ</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Xóa bảng user nếu tồn tại</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IF</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> user;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Tạo bảng user</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  id </span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) unsigned </span><span style="color:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;Id&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  username </span><span style="color:#C678DD;--shiki-dark:#C678DD;">varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">64</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;default&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;Tên đăng nhập&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">  password</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">64</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;default&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;Mật khẩu&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  email </span><span style="color:#C678DD;--shiki-dark:#C678DD;">varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">64</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;default&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;Email&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) COMMENT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;Bảng người dùng&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>(2) Thực hiện các hoạt động giao dịch</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Bắt đầu giao dịch</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">START TRANSACTION</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Thực hiện hoạt động A</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="color:#98C379;--shiki-dark:#98C379;"> `user`</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;root1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;root1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;xxxx@163.com&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Tạo điểm lưu trữ updateA</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">SAVEPOINT updateA;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Thực hiện hoạt động B</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="color:#98C379;--shiki-dark:#98C379;"> `user`</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;root2&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;root2&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;xxxx@163.com&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Hoàn tác đến điểm lưu trữ updateA</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">ROLLBACK</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> updateA;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Xác nhận giao dịch, chỉ hoạt động A được áp dụng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">COMMIT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) Kết quả thực thi</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> user;</span></span></code></pre></div><p>Kết quả:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>1	root1	root1	xxxx@163.com</span></span></code></pre></div><h3 id="autocommit" tabindex="-1"><a class="header-anchor" href="#autocommit"><span>AUTOCOMMIT</span></a></h3><p><strong>Mặc định, MySQL sử dụng chế độ xác nhận ngầm (<code>autocommit</code>)</strong>. Mỗi câu lệnh được thực thi được coi là một giao dịch và được xác nhận. Khi gặp câu lệnh <code>START TRANSACTION</code>, chế độ xác nhận ngầm sẽ bị tắt; sau khi thực hiện câu lệnh <code>COMMIT</code> hoặc <code>ROLLBACK</code>, giao dịch sẽ tự động đóng và chế độ xác nhận ngầm sẽ được khôi phục.</p><p>Bằng cách sử dụng <code>set autocommit=0</code>, bạn có thể hủy bỏ xác nhận tự động cho đến khi <code>set autocommit=1</code> được thực hiện; cờ <code>autocommit</code> được áp dụng cho mỗi kết nối chứ không phải cho máy chủ.</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Xem cờ AUTOCOMMIT</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">SHOW VARIABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD;">LIKE</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;AUTOCOMMIT&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Tắt AUTOCOMMIT</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> autocommit </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Bật AUTOCOMMIT</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> autocommit </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h1 id="acid" tabindex="-1"><a class="header-anchor" href="#acid"><span>ACID</span></a></h1><p>ACID là bốn yếu tố cơ bản để đảm bảo thực hiện giao dịch đúng đắn trong cơ sở dữ liệu.</p><ul><li><strong>Tính nguyên tử (Atomicity)</strong><ul><li>Giao dịch được coi là đơn vị nhỏ nhất không thể chia tách, tất cả các hoạt động trong giao dịch phải được thực hiện hoàn toàn thành công hoặc hoàn toàn thất bại.</li><li>Rollback có thể được thực hiện bằng cách sử dụng nhật ký, nhật ký ghi lại các thay đổi được thực hiện trong giao dịch và thực hiện ngược lại các thay đổi này khi rollback.</li></ul></li><li><strong>Tính nhất quán (Consistency)</strong><ul><li>Cơ sở dữ liệu duy trì trạng thái nhất quán trước và sau khi thực hiện giao dịch.</li><li>Trong trạng thái nhất quán, kết quả đọc của tất cả các giao dịch đối với một dữ liệu là giống nhau.</li></ul></li><li><strong>Tính cô lập (Isolation)</strong><ul><li>Sự thay đổi mà một giao dịch thực hiện không được nhìn thấy bởi các giao dịch khác cho đến khi nó được cam kết.</li></ul></li><li><strong>Tính bền vững (Durability)</strong><ul><li>Khi một giao dịch được cam kết, các thay đổi mà nó thực hiện sẽ được lưu trữ vĩnh viễn trong cơ sở dữ liệu. Ngay cả khi hệ thống gặp sự cố, kết quả của giao dịch vẫn không bị mất.</li><li>Điều này có thể được đạt được bằng sao lưu và khôi phục cơ sở dữ liệu, trong trường hợp hệ thống gặp sự cố.</li></ul></li></ul><p><strong>Hệ thống cơ sở dữ liệu hỗ trợ giao dịch phải có bốn tính chất này, nếu không, không thể đảm bảo tính chính xác của dữ liệu trong quá trình giao dịch.</strong></p><ul><li>Chỉ khi tuân thủ tính nhất quán, kết quả thực hiện của giao dịch mới là chính xác.</li><li>Trong trường hợp không có sự cạnh tranh, khi giao dịch được thực hiện tuần tự, tính cô lập sẽ được đảm bảo. Khi đó, chỉ cần đảm bảo tính nguyên tử, tính nhất quán cũng sẽ được đảm bảo.</li><li>Trong trường hợp có sự cạnh tranh, khi nhiều giao dịch được thực hiện song song, giao dịch không chỉ cần đảm bảo tính nguyên tử mà còn cần đảm bảo tính cô lập để đảm bảo tính nhất quán.</li><li>Tính bền vững của giao dịch là để xử lý trường hợp hệ thống gặp sự cố.</li></ul><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/acid.png" alt="acid.png" tabindex="0" loading="lazy"><figcaption>acid.png</figcaption></figure><blockquote><p>Mysql mặc định sử dụng chế độ tự động cam kết (<code>AUTO COMMIT</code>). Điều này có nghĩa là nếu không sử dụng rõ ràng câu lệnh <code>START TRANSACTION</code> để bắt đầu một giao dịch, mỗi câu lệnh truy vấn sẽ được coi là một giao dịch và tự động cam kết.</p></blockquote><h2 id="cac-cap-đo-co-lap-giao-dich" tabindex="-1"><a class="header-anchor" href="#cac-cap-đo-co-lap-giao-dich"><span>Các cấp độ cô lập giao dịch</span></a></h2><h3 id="gioi-thieu-ve-cap-đo-co-lap-giao-dich" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-ve-cap-đo-co-lap-giao-dich"><span>Giới thiệu về cấp độ cô lập giao dịch</span></a></h3><p>Trong môi trường đồng thời, rất khó đảm bảo tính cô lập của giao dịch, do đó sẽ xuất hiện nhiều vấn đề về tính nhất quán:</p><ul><li><strong>Mất mát thay đổi</strong></li><li><strong>Đọc bẩn (Dirty Read)</strong></li><li><strong>Đọc không nhất quán (Non-Repeatable Read)</strong></li><li><strong>Đọc ảo (Phantom Read)</strong></li></ul><p>Trong tiêu chuẩn SQL, xác định bốn cấp độ cô lập giao dịch (từ thấp đến cao):</p><ul><li><strong>Đọc chưa cam kết (Read Uncommitted)</strong></li><li><strong>Đọc đã cam kết (Read Committed)</strong></li><li><strong>Đọc lặp lại (Repeatable Read)</strong></li><li><strong>Serializable (Serializable)</strong></li></ul><p>Xem và thiết lập cấp độ cô lập giao dịch trong MySQL:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Xem cấp độ cô lập giao dịch</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">SHOW VARIABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD;">LIKE</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;transaction_isolation&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Thiết lập cấp độ cô lập giao dịch là READ UNCOMMITTED</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> SESSION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> READ</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> UNCOMMITTED</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Thiết lập cấp độ cô lập giao dịch là READ COMMITTED</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> SESSION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> READ</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> COMMITTED</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Thiết lập cấp độ cô lập giao dịch là REPEATABLE READ</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> SESSION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> REPEATABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> READ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Thiết lập cấp độ cô lập giao dịch là SERIALIZABLE</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> SESSION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> SERIALIZABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h3 id="đoc-chua-cam-ket" tabindex="-1"><a class="header-anchor" href="#đoc-chua-cam-ket"><span>Đọc chưa cam kết</span></a></h3><p><strong><code>Đọc chưa cam kết (Read Uncommitted)</code></strong> có nghĩa là: Các thay đổi trong giao dịch, ngay cả khi chưa được cam kết, cũng có thể nhìn thấy bởi các giao dịch khác.</p><p>Vấn đề của đọc chưa cam kết: Giao dịch có thể đọc dữ liệu chưa được cam kết, còn được gọi là <strong>đọc bẩn (Dirty Read)</strong>.</p><p>T1 thay đổi một dữ liệu, T2 sau đó đọc dữ liệu này. Nếu T1 hủy bỏ thay đổi này, thì dữ liệu đọc bởi T2 là dữ liệu bẩn.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202307210021321.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="đoc-đa-cam-ket" tabindex="-1"><a class="header-anchor" href="#đoc-đa-cam-ket"><span>Đọc đã cam kết</span></a></h3><p><strong><code>Đọc đã cam kết (Read Committed)</code></strong> có nghĩa là: Các thay đổi trong giao dịch chỉ có thể nhìn thấy bởi các giao dịch khác sau khi đã được cam kết. Nó giải quyết vấn đề đọc dơ bẩn.</p><p>Đọc đã cam kết là cấp độ cô lập mặc định của hầu hết các cơ sở dữ liệu.</p><p>Vấn đề của đọc đã cam kết: Khi thực hiện hai lần truy vấn giống nhau, kết quả có thể không nhất quán.</p><p>T2 đọc một dữ liệu, T1 thay đổi dữ liệu này. Nếu T2 đọc dữ liệu này lần nữa, kết quả đọc sẽ khác với kết quả đọc lần đầu.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002326.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="đoc-lap-lai" tabindex="-1"><a class="header-anchor" href="#đoc-lap-lai"><span>Đọc lặp lại</span></a></h3><p><strong><code>Đọc lặp lại (Repeatable Read)</code></strong> có nghĩa là: Đảm bảo kết quả của việc đọc nhiều lần cùng một dữ liệu trong cùng một giao dịch là giống nhau. Đọc lặp lại giải quyết vấn đề đọc không nhất quán.</p><p>Đọc lặp lại là cấp độ cô lập mặc định của MySQL.</p><p>Vấn đề của đọc lặp lại: Khi một giao dịch T1 đọc một phạm vi dữ liệu, giao dịch T2 chèn một bản ghi mới vào phạm vi đó, sau đó giao dịch T1 đọc lại phạm vi dữ liệu này, kết quả đọc sẽ khác với kết quả đọc lần đầu, được gọi là <strong>đọc ảo (Phantom Read)</strong>.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002333.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="tuan-tu-hoa" tabindex="-1"><a class="header-anchor" href="#tuan-tu-hoa"><span>Tuần tự hoá</span></a></h3><p><strong><code>Tuần tự hoá (Serializable)</code></strong> có nghĩa là: Buộc giao dịch thực hiện tuần tự, khóa đọc và ghi cho cùng một hàng dữ liệu. Nếu xảy ra xung đột khóa, giao dịch phía trước phải chờ giao dịch phía sau giải phóng khóa.</p><p>Thực hiện giao dịch tuần tự sẽ tránh tất cả các vấn đề đồng thời. Chiến lược tuần tự hóa sẽ khóa từng hàng dữ liệu được đọc, điều này có thể dẫn đến nhiều thời gian chờ và cạnh tranh khóa. Điều này gần như không thể chấp nhận được đối với các ứng dụng có độ tải cao, vì vậy thường không sử dụng cấp độ này.</p><h3 id="tom-tat-ve-cac-cap-đo-co-lap" tabindex="-1"><a class="header-anchor" href="#tom-tat-ve-cac-cap-đo-co-lap"><span>Tóm tắt về các cấp độ cô lập</span></a></h3><ul><li><strong><code>Đọc chưa cam kết (Read Uncommitted)</code></strong> - Các thay đổi trong giao dịch, ngay cả khi chưa được cam kết, cũng có thể nhìn thấy bởi các giao dịch khác.</li><li><strong><code>Đọc đã cam kết (Read Committed)</code></strong> - Các thay đổi trong giao dịch chỉ có thể nhìn thấy bởi các giao dịch khác sau khi đã được cam kết.</li><li><strong><code>Đọc lặp lại (Repeatable Read)</code></strong> - Đảm bảo kết quả của việc đọc nhiều lần cùng một dữ liệu trong cùng một giao dịch là giống nhau.</li><li><strong><code>Tuần tự hoá (Serializable)</code></strong> - Buộc giao dịch thực hiện tuần tự, khóa đọc và ghi cho cùng một hàng dữ liệu.</li></ul><p>Các vấn đề được giải quyết bởi các cấp độ cô lập giao dịch:</p><table><thead><tr><th style="text-align:center;">Cấp độ cô lập</th><th style="text-align:center;">Mất mát thay đổi</th><th style="text-align:center;">Đọc bẩn</th><th style="text-align:center;">Đọc không nhất quán</th><th style="text-align:center;">Đọc ảo</th></tr></thead><tbody><tr><td style="text-align:center;">Đọc chưa cam kết</td><td style="text-align:center;">✔️</td><td style="text-align:center;">❌</td><td style="text-align:center;">❌</td><td style="text-align:center;">❌</td></tr><tr><td style="text-align:center;">Đọc đã cam kết</td><td style="text-align:center;">✔️</td><td style="text-align:center;">✔️</td><td style="text-align:center;">❌</td><td style="text-align:center;">❌</td></tr><tr><td style="text-align:center;">Đọc lặp lại</td><td style="text-align:center;">✔️</td><td style="text-align:center;">✔️</td><td style="text-align:center;">✔️</td><td style="text-align:center;">❌</td></tr><tr><td style="text-align:center;">Tuần tự hoá</td><td style="text-align:center;">✔️</td><td style="text-align:center;">✔️</td><td style="text-align:center;">✔️</td><td style="text-align:center;">✔️</td></tr></tbody></table><h2 id="deadlock-be-tac" tabindex="-1"><a class="header-anchor" href="#deadlock-be-tac"><span>Deadlock (Bế tắc)</span></a></h2><p><strong>Deadlock là tình huống mà hai hoặc nhiều giao dịch cạnh tranh với nhau để khóa tài nguyên của nhau, dẫn đến một vòng lặp vô hạn</strong>.</p><p>Các tình huống gây ra deadlock:</p><ul><li>Khi nhiều giao dịch cố gắng khóa tài nguyên theo một thứ tự khác nhau, có thể gây ra deadlock.</li><li>Khi nhiều giao dịch cùng khóa cùng một tài nguyên, cũng có thể gây ra deadlock.</li></ul><h3 id="nguyen-nhan-cua-deadlock" tabindex="-1"><a class="header-anchor" href="#nguyen-nhan-cua-deadlock"><span>Nguyên nhân của deadlock</span></a></h3><p>Có ba loại khóa hàng (lock) được sử dụng trong InnoDB: record lock, gap lock và next-key lock. Record lock được sử dụng để khóa các mục chỉ mục, gap lock được sử dụng để gap lock giữa các mục chỉ mục và next-key lock là sự kết hợp của hai loại khóa trên.</p><p>Chỉ có trong các hoạt động đọc lặp lại hoặc cấp độ cô lập cao hơn, các hoạt động đọc và ghi sử dụng gap lock hoặc next-key lock. Trong các truy vấn <code>Select</code>, <code>Update</code> và <code>Delete</code>, ngoại trừ truy vấn dựa trên chỉ mục duy nhất, các truy vấn sử dụng các chỉ mục khác sẽ lấy gap lock hoặc next-key lock, tức là khóa các phạm vi quét. Chỉ mục khóa chính (primary index) cũng là một chỉ mục duy nhất (unique index), vì vậy nó không sử dụng gap lock hoặc next-key lock.</p><p>Trong MySQL, gap lock mặc định là bật, tức là giá trị của innodb_locks_unsafe_for_binlog là disable và cấp độ cô lập mặc định trong MySQL là RR.</p><p>Khi chúng ta thực hiện truy vấn SQL sau, vì cột order_no không phải là chỉ mục duy nhất, và cấp độ cô lập là RR, vì vậy loại khóa của SELECT là gap lock, phạm vi gap là (4,+∞).</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#98C379;--shiki-dark:#98C379;"> `demo`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#98C379;--shiki-dark:#98C379;">`order_record`</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> where</span><span style="color:#98C379;--shiki-dark:#98C379;"> `order_no`</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 4</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> for</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Khi chúng ta thực hiện truy vấn SQL INSERT sau, nó sẽ lấy khóa ý định chèn vào khoảng trống. Khóa ý định chèn cũng là một loại gap lock, và nó xung đột với gap lock, vì vậy khi một giao dịch giữ gap lock của khoảng trống, nó phải chờ đợi giao dịch khác giải phóng gap lock trước khi có thể lấy khóa ý định chèn (insert intention lock).</p><p>Cả hai giao dịch A và B đều giữ gap lock của khoảng (4,+∞), và tiếp theo là lấy khóa ý định chèn. Vì vậy, cả hai giao dịch đang chờ đợi giao dịch khác giải phóng gap lock. Do đó tạo ra một vòng lặp chờ đợi, gây ra deadlock.</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="color:#98C379;--shiki-dark:#98C379;"> `demo`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#98C379;--shiki-dark:#98C379;">`order_record`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">`order_no`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">`status`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">`create_date`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, ‘</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2019</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">07</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">13</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">57</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">03</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">’);</span></span></code></pre></div><table><thead><tr><th style="text-align:center;">Lock</th><th style="text-align:center;">Gap</th><th style="text-align:center;">Insert Intention</th><th style="text-align:center;">Record</th><th style="text-align:center;">Next Key</th></tr></thead><tbody><tr><td style="text-align:center;">Gap</td><td style="text-align:center;">Tương thích</td><td style="text-align:center;">Xung đột</td><td style="text-align:center;">Tương thích</td><td style="text-align:center;">Tương thích</td></tr><tr><td style="text-align:center;">Insert Intention</td><td style="text-align:center;">Xung đột</td><td style="text-align:center;">Tương thích</td><td style="text-align:center;">Tương thích</td><td style="text-align:center;">Xung đột</td></tr><tr><td style="text-align:center;">Record</td><td style="text-align:center;">Tương thích</td><td style="text-align:center;">Tương thích</td><td style="text-align:center;">Xung đột</td><td style="text-align:center;">Xung đột</td></tr><tr><td style="text-align:center;">Next Key</td><td style="text-align:center;">Tương thích</td><td style="text-align:center;">Tương thích</td><td style="text-align:center;">Xung đột</td><td style="text-align:center;">Xung đột</td></tr></tbody></table><blockquote><p>Nhận xét: chiều ngang là khóa đã nắm giữ, chiều dọc là khóa đang yêu cầu.</p></blockquote><p><strong>Một tình huống deadlock khác</strong></p><p>Chỉ mục khoá chính (primary index) của InnoDB là chỉ mục cụm (clustered index), các chỉ mục khác là chỉ mục phụ (non-clustered index). Nếu sử dụng chỉ mục phụ để cập nhật cơ sở dữ liệu, cần sử dụng chỉ mục cụm để cập nhật các trường dữ liệu. Nếu hai giao dịch cập nhật sử dụng các chỉ mục phụ khác nhau hoặc một giao dịch sử dụng chỉ mục phụ và một giao dịch sử dụng chỉ mục cụm, đều có thể dẫn đến sự chờ đợi vòng lặp tài nguyên khoá và gây ra deadlock. Vì các giao dịch này là xung đột với nhau nên bốn điều kiện cần thiết để xảy ra deadlock trên được hình thành.</p><table><thead><tr><th>Transaction A</th><th>Transaction B</th></tr></thead><tbody><tr><td>BEGIN;</td><td>BEGIN;</td></tr><tr><td>UPDATE <code>order_record</code> SET status = 1 WHERE <code>order_no</code> = 4</td><td>UPDATE <code>order_record</code> SET status = 1 WHERE <code>order_no</code> = 4</td></tr></tbody></table><p>Xuất hiện tình trạng deadlock theo các bước sau:</p><table><thead><tr><th>Transaction A</th><th>Transaction B</th></tr></thead><tbody><tr><td>Đầu tiên lấy idx_order_status (non-clustered index)</td><td></td></tr><tr><td></td><td>Nhận khóa hàng trên chỉ mục khóa chính</td></tr><tr><td>Theo khóa chính (primary key) thu được bởi chỉ mục phụ (non-clustered index), lấy chỉ mục khóa chính (primary index), khoá hàng (row lock)</td><td></td></tr><tr><td></td><td>Khi cập nhật cột status cần lấy idx_order_status (non-clusered index)</td></tr></tbody></table><p>Từ những điều đã trình bày ở trên, chúng ta có thể hiểu rằng trong quá trình cập nhật dữ liệu, chúng ta nên sử dụng khóa chính để cập nhật các trường trong bảng một cách tối đa. Điều này giúp ngăn chặn hiện tượng xảy ra deadlock không cần thiết.</p><h3 id="tranh-tinh-trang-be-tac" tabindex="-1"><a class="header-anchor" href="#tranh-tinh-trang-be-tac"><span>Tránh tình trạng bế tắc</span></a></h3><p>Những điều cần lưu ý để ngăn chặn tình trạng bế tắc:</p><ul><li>Trong quá trình lập trình, hãy cố gắng xử lý các bản ghi cơ sở dữ liệu theo một thứ tự cố định. Giả sử có hai hoạt động cập nhật, mỗi hoạt động cập nhật một bản ghi giống nhau nhưng thứ tự cập nhật khác nhau, có thể dẫn đến tình trạng bế tắc.</li><li>Trong trường hợp cho phép đọc không nhất quán và đọc không lặp lại, hãy sử dụng cấp độ cô lập giao dịch RC để tránh tình trạng bế tắc do gap lock.</li><li>Khi cập nhật bảng, hãy cố gắng sử dụng khóa chính để cập nhật.</li><li>Tránh giao dịch kéo dài, hãy cố gắng chia nhỏ giao dịch để giảm khả năng xung đột với các giao dịch khác.</li><li>Đặt tham số timeout chờ khóa hợp lý, chúng ta có thể sử dụng <code>innodb_lock_wait_timeout</code> để đặt ngưỡng timeout hợp lý, đặc biệt là trong các hoạt động kinh doanh có tải cao, chúng ta có thể đặt giá trị này nhỏ hơn để tránh việc chờ đợi nhiều giao dịch, chiếm tài nguyên hệ thống và gây ra tác động nghiêm trọng đến hiệu suất.</li></ul><p>Ngoài ra, chúng ta cũng có thể đặt cột <code>order_no</code> là cột chỉ mục duy nhất. Mặc dù không thể ngăn chặn việc đọc không nhất quán, nhưng chúng ta có thể sử dụng tính duy nhất của nó để đảm bảo không tạo bản ghi đơn hàng trùng lặp. Nhược điểm duy nhất của phương pháp này là khi gặp tình trạng tạo đơn hàng trùng lặp, nó sẽ gây ra ngoại lệ.</p><p>Chúng ta cũng có thể sử dụng các phương pháp khác để thay thế cơ sở dữ liệu để kiểm tra tính đơn nhất. Ví dụ, sử dụng Redis và ZooKeeper để thực hiện, hiệu suất chạy tốt hơn so với cơ sở dữ liệu.</p><h3 id="giai-quyet-tinh-trang-be-tac" tabindex="-1"><a class="header-anchor" href="#giai-quyet-tinh-trang-be-tac"><span>Giải quyết tình trạng bế tắc</span></a></h3><p>Khi gặp tình trạng bế tắc, có hai chiến lược:</p><ul><li>Một chiến lược là tiếp tục chờ đợi cho đến khi hết thời gian chờ. Thời gian chờ này có thể được đặt thông qua tham số <code>innodb_lock_wait_timeout</code>.</li><li>Chiến lược khác là thực hiện kiểm tra bế tắc, khi phát hiện bế tắc, hủy bỏ một giao dịch trong chuỗi bế tắc, cho phép các giao dịch khác tiếp tục thực hiện. Đặt tham số <code>innodb_deadlock_detect</code> thành on để bật cơ chế này.</li></ul><p>Trong InnoDB, giá trị mặc định của <code>innodb_lock_wait_timeout</code> là 50 giây, có nghĩa là nếu sử dụng chiến lược thứ nhất, khi gặp tình trạng bế tắc, giao dịch đầu tiên bị khóa sẽ chờ đợi trong 50 giây trước khi hết thời gian chờ và sau đó các giao dịch khác mới có thể tiếp tục thực hiện. Đối với dịch vụ trực tuyến, thời gian chờ này thường không thể chấp nhận được.</p><p>Tuy nhiên, chúng ta không thể đặt thời gian chờ quá nhỏ, ví dụ 1 giây. Nếu làm như vậy, khi gặp tình trạng bế tắc, thực sự sẽ giải quyết nhanh chóng, nhưng nếu không phải là bế tắc mà chỉ là chờ khóa đơn giản thì sao? Vì vậy, nếu đặt thời gian chờ quá ngắn, sẽ có nhiều trường hợp giả mạo.</p><p>Vì vậy, thông thường chúng ta vẫn nên sử dụng chiến lược thứ hai, tức là kiểm tra bế tắc một cách chủ động, và giá trị mặc định của <code>innodb_deadlock_detect</code> là <code>on</code>. Để giải quyết tình trạng bế tắc, các cơ sở dữ liệu khác nhau đã triển khai các cơ chế kiểm tra bế tắc và thời gian chờ riêng. Chính sách xử lý bế tắc của InnoDB là: <strong>rollback giao dịch nắm giữ ít khóa độc quyền cấp hàng nhất</strong>.</p><p>Kiểm tra bế tắc chủ động có thể nhanh chóng phát hiện và xử lý khi gặp tình trạng bế tắc, nhưng nó cũng có gánh nặng bổ sung. Bạn có thể tưởng tượng quá trình này: Mỗi khi một giao dịch bị khóa, hãy xem xem các luồng mà nó phụ thuộc vào có bị khóa bởi người khác không, và lặp lại quá trình này, cuối cùng xác định xem có xảy ra chờ đợi vòng lặp, tức là bế tắc hay không.</p><h3 id="giao-dich-phan-tan" tabindex="-1"><a class="header-anchor" href="#giao-dich-phan-tan"><span>Giao dịch phân tán</span></a></h3><p>Trong một nút dữ liệu đơn lẻ, giao dịch chỉ giới hạn trong việc kiểm soát truy cập vào tài nguyên cơ sở dữ liệu duy nhất, được gọi là <strong>giao dịch cục bộ</strong>. Hầu hết các hệ quản trị cơ sở dữ liệu quan hệ đã cung cấp hỗ trợ gốc cho giao dịch cục bộ.</p><p><strong>Giao dịch phân tán là giao dịch trải dài qua nhiều nút và yêu cầu tuân thủ các tính chất ACID của giao dịch.</strong></p><p>Các phương án phổ biến cho giao dịch phân tán bao gồm:</p><ul><li><strong>Hai giai đoạn cam kết (2PC)</strong> - Chia quá trình xác nhận giao dịch thành hai giai đoạn: giai đoạn chuẩn bị và giai đoạn cam kết. Người tham gia thông báo cho người điều phối về kết quả thành công hoặc thất bại của hoạt động, sau đó người điều phối quyết định xem tất cả người tham gia có nên thực hiện hoạt động hoặc hủy bỏ hoạt động hay không.</li><li><strong>Ba giai đoạn cam kết (3PC)</strong> - Khác với hai giai đoạn cam kết, giai đoạn cam kết ba giai đoạn giới thiệu cơ chế vượt quá thời gian. Đồng thời, cả người điều phối và người tham gia đều có cơ chế vượt quá thời gian. Giai đoạn chuẩn bị của hai giai đoạn cam kết được chia thành hai giai đoạn, chèn một giai đoạn preCommit, giải quyết vấn đề thời gian chờ lâu có thể xảy ra trong quá trình xác nhận hai giai đoạn khi người điều phối gặp sự cố hoặc lỗi.</li><li><strong>Giao dịch bù trừ (TCC)</strong><ul><li><strong>Thử</strong> - Hoạt động như giai đoạn một, chịu trách nhiệm kiểm tra và dự trữ tài nguyên.</li><li><strong>Cam kết</strong> - Hoạt động như hoạt động xác nhận hai giai đoạn, thực hiện thực sự của doanh nghiệp.</li><li><strong>Hủy bỏ</strong> - Hủy bỏ việc dự trữ tài nguyên.</li></ul></li><li><strong>Bảng tin tin nhắn cục bộ</strong> - Giao dịch khởi tạo bảng tin nhắn giao dịch mới trong bên gửi giao dịch, bên gửi giao dịch xử lý kinh doanh và ghi lại tin nhắn giao dịch trong giao dịch cục bộ, gửi tin nhắn giao dịch dựa trên dữ liệu trong bảng tin nhắn giao dịch, bên nhận giao dịch tiêu thụ tin nhắn giao dịch trong bảng tin nhắn giao dịch.</li><li><strong>Giao dịch MQ</strong> - Phương án giao dịch phân tán dựa trên bảng tin nhắn giao dịch cục bộ thực chất là một bảng tin nhắn giao dịch.</li><li><strong>Saga</strong> - Ý tưởng cốt lõi của giao dịch Saga là chia nhỏ giao dịch dài thành nhiều giao dịch cục bộ ngắn, được điều phối bởi bộ điều phối giao dịch Saga. Nếu kết thúc bình thường, thì hoàn thành bình thường, nếu một bước thất bại, sau đó gọi lại các hoạt động bù trừ theo thứ tự ngược lại.</li></ul><p>Phân tích các phương án giao dịch phân tán:</p><ul><li>2PC/3PC phụ thuộc vào cơ sở dữ liệu, có thể cung cấp tính nhất quán và tính chất giao dịch mạnh mẽ, nhưng độ trễ tương đối cao, phù hợp với ứng dụng truyền thống đơn lẻ, trong trường hợp có hoạt động chạy qua nhiều cơ sở dữ liệu trong cùng một phương thức, không phù hợp với các tình huống đòi hỏi đồng thời và hiệu suất cao.</li><li>TCC phù hợp với thời gian thực và ngắn, yêu cầu tính thời gian thực cao, yêu cầu tính nhất quán dữ liệu cao, ví dụ như ba dịch vụ trung tâm của các doanh nghiệp tài chính trực tuyến: giao dịch, thanh toán, tài khoản.</li><li>Bảng tin tin nhắn cục bộ/MQ giao dịch đều phù hợp với các bên tham gia hỗ trợ hoạt động độc lập, yêu cầu tính nhất quán không cao, doanh nghiệp có thể chấp nhận không nhất quán dữ liệu cho đến một chu kỳ kiểm tra thủ công.</li><li>Saga do Saga không đảm bảo tính cô lập, cần kiểm soát đồng thời ở mức doanh nghiệp, phù hợp với các tình huống giao dịch đồng thời trên cùng một tài nguyên ít hơn. Saga so với thiếu hành động xác nhận, dẫn đến việc triển khai hoạt động bù trừ khá phức tạp, ví dụ như kinh doanh là gửi tin nhắn, hoạt động bù trừ phải gửi một tin nhắn khác, trải nghiệm người dùng khá tệ. Saga phù hợp với các tình huống mà hoạt động bù trừ dễ xử lý.</li></ul><h2 id="thuc-hanh-tot-nhat-cho-giao-dich" tabindex="-1"><a class="header-anchor" href="#thuc-hanh-tot-nhat-cho-giao-dich"><span>Thực hành tốt nhất cho giao dịch</span></a></h2><blockquote><p>Làm thế nào để tối ưu giao dịch trong các tình huống có tải cao?</p></blockquote><h3 id="su-dung-cap-đo-co-lap-giao-dich-thap-nhat-co-the" tabindex="-1"><a class="header-anchor" href="#su-dung-cap-đo-co-lap-giao-dich-thap-nhat-co-the"><span>Sử dụng cấp độ cô lập giao dịch thấp nhất có thể</span></a></h3><p>Kết hợp với kịch bản kinh doanh, hãy cố gắng sử dụng cấp độ cô lập giao dịch thấp nhất có thể.</p><h3 id="tranh-viec-nang-cap-khoa-hang-thanh-khoa-bang" tabindex="-1"><a class="header-anchor" href="#tranh-viec-nang-cap-khoa-hang-thanh-khoa-bang"><span>Tránh việc nâng cấp khóa hàng thành khóa bảng</span></a></h3><p>Trong InnoDB, khóa hàng được thực hiện thông qua chỉ mục. Nếu không sử dụng điều kiện tìm kiếm dữ liệu thông qua chỉ mục, khóa hàng sẽ được nâng cấp thành khóa bảng. Chúng ta biết rằng khóa bảng sẽ ảnh hưởng nghiêm trọng đến hiệu suất hoạt động của toàn bộ bảng, vì vậy cần cố gắng tránh việc này.</p><h3 id="thu-nho-pham-vi-giao-dich" tabindex="-1"><a class="header-anchor" href="#thu-nho-pham-vi-giao-dich"><span>Thu nhỏ phạm vi giao dịch</span></a></h3><p>Đôi khi, khi lượng truy cập cơ sở dữ liệu đồng thời quá lớn, sẽ xảy ra các ngoại lệ sau:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>MySQLQueryInterruptedException: Query execution was interrupted</span></span></code></pre></div><p>Trong tình huống đồng thời cao, khi cập nhật một bản ghi, do giao dịch còn có thể chứa các hoạt động khác, một giao dịch có thể trở nên dài hơn. Khi có nhiều yêu cầu đồng thời, có thể xảy ra tình huống một số yêu cầu cùng tham gia vào giao dịch.</p><p>Vì cạnh tranh khóa không công bằng, khi nhiều giao dịch cùng cập nhật một bản ghi, trong trường hợp cực đoan, một hoạt động cập nhật có thể bị chờ đợi trong hệ thống hàng đợi mà không bao giờ nhận được khóa. Cuối cùng, nó sẽ bị hệ thống huỷ bỏ và đẩy ra.</p><table><thead><tr><th>Thứ tực thực hiện 1</th><th>Thứ tực thực hiện 2</th></tr></thead><tbody><tr><td>1. Mở giao dịch</td><td>1. Mở giao dịch</td></tr><tr><td>2. Truy vấn hàng tồn kho và đánh giá xem hàng tồn kho có đáp ứng không</td><td>2. Truy vấn hàng tồn kho và đánh giá xem hàng tồn kho có đáp ứng không</td></tr><tr><td>3. Tạo đơn hàng mới</td><td>3. Khấu trừ hàng tồn kho</td></tr><tr><td>4. Khấu trừ hàng tồn kho</td><td>4. Tạo đơn hàng mới</td></tr><tr><td>5. Cam kết hoặc Khôi phục</td><td>5. Cam kết hoặc Phục hồi</td></tr></tbody></table><p>Như mô tả trên, mặc dù tất cả đều trong một giao dịch, nhưng yêu cầu khóa xảy ra vào thời gian khác nhau. Chỉ khi tất cả các hoạt động khác đã hoàn thành, tất cả khóa mới được giải phóng. Vì việc khấu trừ kho là một hoạt động cập nhật và là khóa hàng, nó sẽ ảnh hưởng đến các giao dịch khác liên quan đến dữ liệu này. Vì vậy, chúng ta nên cố gắng tránh giữ khóa trong thời gian dài nhất có thể và giải phóng khóa sớm nhất có thể. Vì việc tạo đơn hàng trước và việc trừ kho trước đều không ảnh hưởng đến kinh doanh, chúng ta có thể đặt hoạt động trừ kho cuối cùng, tức là sử dụng thứ tự thực hiện 1, để giảm thiểu thời gian giữ khóa.</p><p><strong>Trong giao dịch InnoDB, khóa hàng được thêm vào khi cần thiết, nhưng không được giải phóng ngay khi không cần thiết nữa, mà chỉ được giải phóng khi giao dịch kết thúc. Đây chính là giao thức khóa hai giai đoạn.</strong></p><p>Biết được điều này, điều này sẽ giúp chúng ta sử dụng giao dịch một cách hiệu quả hơn. Nếu giao dịch của bạn cần khóa nhiều hàng, hãy đặt các khóa có thể gây xung đột nhất và có thể ảnh hưởng đến độ tương thích càng sau càng tốt, tức là ở cuối danh sách các hoạt động.</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/database/mysql/transaction.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/database/mysql/mysql-index.html" aria-label="MySQL Index"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon>MySQL Index</div></a><a class="route-link auto-link next" href="/database/mysql/lock.html" aria-label="Lock"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Lock<iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with ❤️ by Hung Nguyen</div><div class="copyright">Copyright © 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BVzepGwQ.js" defer></script>
  </body>
</html>
