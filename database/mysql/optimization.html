<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.46" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/database/mysql/optimization.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="MySQL Optimization"><meta property="og:description" content="MySQL Optimization Slow Query (Truy vấn chậm) Nhật ký truy vấn chậm có thể giúp chúng ta tìm ra các câu lệnh SQL thực thi chậm. Bạn có thể kiểm tra xem nhật ký truy vấn chậm có ..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-06-28T15:54:38.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:modified_time" content="2024-06-28T15:54:38.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"MySQL Optimization","image":[""],"dateModified":"2024-06-28T15:54:38.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>MySQL Optimization | VanHung4499</title><meta name="description" content="MySQL Optimization Slow Query (Truy vấn chậm) Nhật ký truy vấn chậm có thể giúp chúng ta tìm ra các câu lệnh SQL thực thi chậm. Bạn có thể kiểm tra xem nhật ký truy vấn chậm có ...">
    <link rel="preload" href="/assets/style-BqjKxtxe.css" as="style"><link rel="stylesheet" href="/assets/style-BqjKxtxe.css">
    <link rel="modulepreload" href="/assets/app-BG8AAbz2.js"><link rel="modulepreload" href="/assets/optimization.html-hB_8c0Ci.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/project/" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon><!--]-->Project<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interview/" aria-label="Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:account-tie" width="1em" height="1em"></iconify-icon><!--]-->Interview<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">SQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/overview.html" aria-label="MySQL Overview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Overview<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/guide.html" aria-label="MySQL Guide"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Guide<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/architecture.html" aria-label="MySQL Architecture"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Architecture<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/engine.html" aria-label="MySQL Storage Engine"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Storage Engine<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/mysql-index.html" aria-label="MySQL Index"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Index<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/transaction.html" aria-label="MySQL Transaction"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Transaction<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/lock.html" aria-label="Lock"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->Lock<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/replication.html" aria-label="MySQL Replication"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Replication<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/database/mysql/optimization.html" aria-label="MySQL Optimization"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Optimization<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/opearation.html" aria-label="MySQL Opearation"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Opearation<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/mysql/configuration.html" aria-label="MySQL Configuration"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL Configuration<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">MongoDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Elasticsearch</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Elastic Stack</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon>MySQL Optimization</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-28T15:54:38.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 20 min</span><meta property="timeRequired" content="PT20M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color1 clickable" role="navigation">mysql</span><!--]--><meta property="articleSection" content="mysql"></span><!----></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#slow-query-truy-van-cham">Slow Query (Truy vấn chậm)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#chien-luoc-thuc-thi-explain">Chiến lược thực thi (EXPLAIN)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#optimizer-trace">Optimizer trace</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#toi-uu-hoa-sql">Tối ưu hóa SQL</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#co-ban-ve-toi-uu-sql">Cơ bản về Tối ưu SQL</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-hoa-phan-trang">Tối ưu hóa Phân trang</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-truy-van-count">Tối ưu truy vấn COUNT()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-truy-van-join">Tối ưu truy vấn JOIN</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-group-by-va-distinct">Tối ưu GROUP BY và DISTINCT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-union">Tối ưu UNION</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-cach-thuc-hien-truy-van">Tối ưu cách thực hiện truy vấn</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-hoa-index">Tối ưu hoá index</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#toi-uu-cau-truc-du-lieu">Tối ưu cấu trúc dữ liệu</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-kieu-du-lieu">Tối ưu kiểu dữ liệu</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#thiet-ke-bang">Thiết kế bảng</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chuan-hoa-va-phi-chuan-hoa">Chuẩn hoá và phi chuẩn hoá</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-chi-muc">Tối ưu chỉ mục</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#mo-hinh-du-lieu-va-nghiep-vu">Mô hình dữ liệu và nghiệp vụ</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="mysql-optimization" tabindex="-1"><a class="header-anchor" href="#mysql-optimization"><span>MySQL Optimization</span></a></h1><h2 id="slow-query-truy-van-cham" tabindex="-1"><a class="header-anchor" href="#slow-query-truy-van-cham"><span>Slow Query (Truy vấn chậm)</span></a></h2><p>Nhật ký truy vấn chậm có thể giúp chúng ta tìm ra các câu lệnh SQL thực thi chậm.</p><p>Bạn có thể kiểm tra xem nhật ký truy vấn chậm có được bật hay không bằng cách sử dụng lệnh sau:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> show variables </span><span style="color:#C678DD;--shiki-dark:#C678DD;">like</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;%slow_query_log%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">----------------+-------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| Variable_name  | </span><span style="color:#C678DD;--shiki-dark:#C678DD;">Value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">----------------+-------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| slow_query_log | </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">----------------+-------+</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> row</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> in</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">02</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> sec)</span></span></code></pre></div><p>Bật hoặc tắt nhật ký truy vấn chậm:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"># Bật nhật ký truy vấn chậm</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> global</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> slow_query_log</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ON&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"># Tắt nhật ký truy vấn chậm</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> global</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> slow_query_log</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;OFF&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Kiểm tra ngưỡng thời gian của truy vấn chậm:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> show variables </span><span style="color:#C678DD;--shiki-dark:#C678DD;">like</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;%long_query_time%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-----------------+-----------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| Variable_name   | </span><span style="color:#C678DD;--shiki-dark:#C678DD;">Value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-----------------+-----------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| long_query_time | </span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">000000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-----------------+-----------+</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> row</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> in</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">02</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> sec)</span></span></code></pre></div><p>Thiết lập ngưỡng thời gian của truy vấn chậm:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> global</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> long_query_time </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>MySQL cung cấp một công cụ mysqldumpslow để thống kê nhật ký truy vấn chậm (công cụ này là một script Perl, cần cài đặt Perl trước).</p><p>Các tham số cụ thể của lệnh mysqldumpslow như sau:</p><ul><li><code>-s</code> - Sắp xếp theo cách order, các cách sắp xếp có thể là c (số lần truy cập), t (thời gian truy vấn), l (thời gian khóa), r (số bản ghi trả về), ac (số lần truy vấn trung bình), al (thời gian khóa trung bình), ar (số bản ghi trả về trung bình) và at (thời gian truy vấn trung bình). Mặc định là sắp xếp theo at.</li><li><code>-t</code> - Trả về N hàng đầu tiên.</li><li><code>-g</code> - Theo sau có thể là biểu thức chính quy, không phân biệt chữ hoa chữ thường.</li></ul><p>Ví dụ nếu bạn muốn sắp xếp theo thời gian truy vấn và xem hai câu lệnh SQL đầu tiên, bạn có thể thực hiện lệnh sau:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">perl</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysqldumpslow.pl</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -s</span><span style="color:#98C379;--shiki-dark:#98C379;"> t</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -t</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;C:\ProgramData\MySQL\MySQL Server 8.0\Data\slow.log&quot;</span></span></code></pre></div><h2 id="chien-luoc-thuc-thi-explain" tabindex="-1"><a class="header-anchor" href="#chien-luoc-thuc-thi-explain"><span>Chiến lược thực thi (EXPLAIN)</span></a></h2><p>Làm thế nào để xác định xem câu lệnh SQL hiện tại có sử dụng chỉ mục hay không? Làm thế nào để kiểm tra xem SQL đã được tối ưu sau khi chỉnh sửa hay chưa?</p><p>Trong SQL, bạn có thể sử dụng kế hoạch thực thi (<code>EXPLAIN</code>) để phân tích hiệu suất của truy vấn SELECT.</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> explain </span><span style="color:#C678DD;--shiki-dark:#C678DD;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> user_info </span><span style="color:#C678DD;--shiki-dark:#C678DD;">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">\G</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">*************************** </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">. </span><span style="color:#C678DD;--shiki-dark:#C678DD;">row</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ***************************</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           id: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  select_type: </span><span style="color:#C678DD;--shiki-dark:#C678DD;">SIMPLE</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: user_info</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   partitions: </span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">         type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: const</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">possible_keys: </span><span style="color:#C678DD;--shiki-dark:#C678DD;">PRIMARY</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">          key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#C678DD;--shiki-dark:#C678DD;">PRIMARY</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      key_len: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">8</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">          ref: const</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">         rows</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">     filtered: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">00</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        Extra: </span><span style="color:#C678DD;--shiki-dark:#C678DD;">NULL</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> row</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> in</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> warning (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">00</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> sec)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Giải thích các tham số của <code>EXPLAIN</code>:</p><ul><li><code>id</code>: Định danh của truy vấn SELECT. Mỗi truy vấn SELECT sẽ được gán một định danh duy nhất.</li><li><code>select_type</code> ⭐ : Loại truy vấn SELECT. <ul><li><code>SIMPLE</code>: Đại diện cho truy vấn không chứa UNION hoặc subquery.</li><li><code>PRIMARY</code>: Đại diện cho truy vấn ngoại vi nhất.</li><li><code>UNION</code>: Đại diện cho truy vấn UNION thứ hai trở đi.</li><li><code>DEPENDENT UNION</code>: Đại diện cho truy vấn UNION phụ thuộc vào truy vấn bên ngoài.</li><li><code>UNION RESULT</code>: Kết quả của truy vấn UNION.</li><li><code>SUBQUERY</code>: Truy vấn con đầu tiên trong subquery.</li><li><code>DEPENDENT SUBQUERY</code>: Truy vấn con đầu tiên trong subquery, phụ thuộc vào truy vấn bên ngoài. Nghĩa là subquery phụ thuộc vào kết quả của truy vấn bên ngoài.</li></ul></li><li><code>table</code>: Bảng mà truy vấn đang truy vấn, nếu có đặt tên bảng thì hiển thị tên đó.</li><li><code>partitions</code>: Phân vùng khớp.</li><li><code>type</code> ⭐ : Cách thực hiện truy vấn từ bảng để tìm hàng, loại truy vấn là một chỉ số quan trọng trong tối ưu SQL, giá trị kết quả từ tốt đến xấu lần lượt là: system &gt; const &gt; eq_ref &gt; ref &gt; range &gt; index &gt; ALL. <ul><li><code>system</code>/<code>const</code>: Chỉ có một hàng trong bảng khớp, trong trường hợp này, truy vấn chỉ cần truy vấn một lần để tìm dữ liệu tương ứng. Nếu sử dụng chỉ mục B + cây, chúng ta biết rằng chỉ mục được xây dựng thành nhiều cấp cây, khi chỉ mục được truy vấn ở tầng dưới cùng, hiệu suất truy vấn sẽ càng kém.</li><li><code>eq_ref</code>: Sử dụng quét chỉ mục duy nhất, phổ biến trong trường hợp kết nối nhiều bảng sử dụng khóa chính và chỉ mục duy nhất làm điều kiện kết nối.</li><li><code>ref</code>: Quét chỉ mục không duy nhất, cũng có thể thấy trong trường hợp sử dụng quét chỉ mục duy nhất bên trái.</li><li><code>range</code>: Quét phạm vi chỉ mục, ví dụ: &lt;, &gt;, between, v.v.</li><li><code>index</code>: Quét toàn bộ chỉ mục, trong trường hợp này, duyệt qua toàn bộ cây chỉ mục.</li><li><code>ALL</code>: Đại diện cho việc quét toàn bộ bảng, cần duyệt qua toàn bộ bảng để tìm hàng tương ứng.</li></ul></li><li><code>possible_keys</code>: Chỉ mục có thể sử dụng trong truy vấn này.</li><li><code>key</code> ⭐ : Chỉ mục thực sự được sử dụng trong truy vấn này.</li><li><code>ref</code>: Cột hoặc hằng số nào được sử dụng cùng với khóa.</li><li><code>rows</code> ⭐ : Số hàng đã quét trong truy vấn này, đây là một ước tính.</li><li><code>filtered</code>: Phần trăm dữ liệu được lọc bởi điều kiện truy vấn.</li><li><code>extra</code>: Thông tin bổ sung.</li></ul><h2 id="optimizer-trace" tabindex="-1"><a class="header-anchor" href="#optimizer-trace"><span>Optimizer trace</span></a></h2><p>Trong phiên bản MySQL 5.6 trở lên, chúng ta có thể sử dụng tính năng truy vấn trình tối ưu hóa để xem quá trình tạo kế hoạch thực thi của trình tối ưu hóa. Với tính năng này, chúng ta không chỉ có thể hiểu quá trình lựa chọn của trình tối ưu hóa, mà còn có thể hiểu chi phí của mỗi phần thực thi và từ đó tối ưu hóa truy vấn.</p><p>Như đoạn mã dưới đây, sau khi bật tính năng truy vấn trình tối ưu hóa, chúng ta có thể thực thi truy vấn SQL và sau đó truy vấn bảng information_schema.OPTIMIZER_TRACE để xem kế hoạch thực thi. Cuối cùng, chúng ta có thể tắt tính năng truy vấn trình tối ưu hóa:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> optimizer_trace</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;enabled=on&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> person </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> NAME</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> &gt;</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;name84059&#39;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> AND</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> create_time</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;2020-01-24 05:00&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> information_schema</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">OPTIMIZER_TRACE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> optimizer_trace</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;enabled=off&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h2 id="toi-uu-hoa-sql" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-sql"><span>Tối ưu hóa SQL</span></a></h2><h3 id="co-ban-ve-toi-uu-sql" tabindex="-1"><a class="header-anchor" href="#co-ban-ve-toi-uu-sql"><span>Cơ bản về Tối ưu SQL</span></a></h3><p>Sử dụng lệnh <code>EXPLAIN</code> để kiểm tra xem SQL hiện tại có sử dụng chỉ mục không và sau khi tối ưu hóa, sử dụng kế hoạch thực thi (<code>EXPLAIN</code>) để kiểm tra hiệu quả của việc tối ưu.</p><p>Cách tối ưu hóa SQL cơ bản:</p><ul><li><p><strong>Chỉ trả về các cột cần thiết</strong> - Tốt nhất không nên sử dụng câu lệnh <code>SELECT *</code>.</p></li><li><p><strong>Chỉ trả về các hàng cần thiết</strong> - Sử dụng câu lệnh con <code>WHERE</code> để lọc dữ liệu, đôi khi cũng cần sử dụng câu lệnh <code>LIMIT</code> để giới hạn dữ liệu trả về.</p></li><li><p><strong>Bộ nhớ đệm cho dữ liệu truy vấn lặp lại</strong> - Nên cân nhắc sử dụng bộ nhớ đệm (cache) trên phía khách hàng, tránh sử dụng bộ nhớ đệm của MySQL Server (có nhiều vấn đề và hạn chế).</p></li><li><p><strong>Sử dụng chỉ mục phủ</strong></p></li></ul><h3 id="toi-uu-hoa-phan-trang" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-phan-trang"><span>Tối ưu hóa Phân trang</span></a></h3><p>Khi cần phân trang, thường sử dụng <code>LIMIT</code> kết hợp với độ lệch (offset) để thực hiện, cùng với câu lệnh <code>ORDER BY</code> phù hợp. <strong>Nếu có chỉ mục tương ứng, hiệu suất thường sẽ tốt, nếu không, MySQL cần thực hiện nhiều thao tác sắp xếp tệp</strong>.</p><p>Một vấn đề phổ biến là khi độ lệch rất lớn, ví dụ: truy vấn như <code>LIMIT 1000000 20</code>, MySQL cần truy vấn 1000020 bản ghi và chỉ trả về 20 bản ghi, 1000000 bản ghi đầu tiên sẽ bị bỏ qua, điều này rất tốn kém.</p><p>Có hai giải pháp để tối ưu hóa phân trang:</p><ol><li><strong>Giải pháp - Liên kết trì hoãn</strong></li></ol><p>Một cách đơn giản nhất để tối ưu hóa truy vấn là sử dụng quét chỉ mục phủ càng nhiều càng tốt thay vì truy vấn tất cả các cột. Sau đó, thực hiện liên kết truy vấn để trả về tất cả các cột cần thiết. Khi độ lệch lớn, hiệu suất sẽ tăng lên rất nhiều. Xem truy vấn dưới đây:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> film_id, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">description</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> film </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ORDER BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> title </span><span style="color:#C678DD;--shiki-dark:#C678DD;">LIMIT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1000000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Nếu bảng này rất lớn, thì truy vấn này nên được thay đổi thành:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> film</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">film_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">film</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">description</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> film</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">INNER JOIN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> film_id </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> film </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ORDER BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> title </span><span style="color:#C678DD;--shiki-dark:#C678DD;">LIMIT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1000000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">5</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> tmp </span><span style="color:#C678DD;--shiki-dark:#C678DD;">USING</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(film_id);</span></span></code></pre></div><p>Liên kết trì hoãn ở đây sẽ cải thiện hiệu suất truy vấn rất nhiều, giúp MySQL quét ít trang nhất có thể, sau khi lấy được các bản ghi cần truy cập, sẽ quay lại bảng gốc để truy vấn các cột cần thiết theo cột liên kết.</p><ol start="2"><li><strong>Giải pháp - Cách sử dụng bookmark</strong></li></ol><p>Đôi khi, nếu có thể sử dụng bookmark để ghi lại vị trí lấy dữ liệu lần trước, thì lần sau có thể bắt đầu quét từ vị trí bookmark này, tránh sử dụng <code>OFFSET</code>. Ví dụ như truy vấn dưới đây:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Câu lệnh gốc</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> t </span><span style="color:#C678DD;--shiki-dark:#C678DD;">LIMIT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1000000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Câu lệnh tối ưu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> t </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1000000</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> LIMIT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Các phương pháp tối ưu khác bao gồm sử dụng bảng tổng hợp được tính trước, hoặc liên kết với một bảng dư thừa, bảng dư thừa chỉ chứa các cột khóa chính và các cột cần được sắp xếp.</p><h3 id="toi-uu-truy-van-count" tabindex="-1"><a class="header-anchor" href="#toi-uu-truy-van-count"><span>Tối ưu truy vấn <code>COUNT()</code></span></a></h3><p><code>COUNT()</code> có hai tác dụng:</p><ul><li>Đếm số lượng giá trị trong một cột. Khi đếm giá trị cột, yêu cầu giá trị cột không phải là <code>NULL</code> và nó sẽ không đếm <code>NULL</code>.</li><li>Đếm số lượng hàng.</li></ul><p><strong>Khi đếm các giá trị cột, yêu cầu giá trị cột không phải là <code>NULL</code> và nó sẽ không đếm <code>NULL</code></strong>. Nếu xác nhận biểu thức trong dấu ngoặc không thể là rỗng, thực tế là đang thống kê số hàng. Đơn giản nhất là khi sử dụng <code>COUNT(*)</code>, nó không mở rộng thành tất cả các cột như chúng ta tưởng tượng, mà ngược lại, nó bỏ qua tất cả các cột và chỉ thống kê số hàng.</p><p>Hiểu lầm phổ biến nhất của chúng ta xuất hiện ở đây, khi chỉ định một cột trong dấu ngoặc và hy vọng kết quả là số hàng, và thông thường người ta sai lầm cho rằng hiệu suất của phương pháp này sẽ tốt hơn. Nhưng điều này không phải là sự thật, nếu muốn đếm số hàng, hãy sử dụng <code>COUNT(*)</code> trực tiếp để ý nghĩa rõ ràng và hiệu suất cao hơn.</p><p>(1) Tối ưu đơn giản:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(*) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> world</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">city</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(*) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> world</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">city</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) - </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(*)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> world</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">city</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> id </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>(2) Sử dụng giá trị xấp xỉ</p><p>Đôi khi, trong một số tình huống nghiệp vụ, không cần giá trị thống kê chính xác, có thể sử dụng giá trị xấp xỉ để thay thế. Số hàng trả về từ <code>EXPLAIN</code> là một giá trị xấp xỉ tốt, và việc thực hiện <code>EXPLAIN</code> không yêu cầu thực hiện truy vấn thực tế, do đó chi phí rất thấp. Thông thường, việc thực hiện <code>COUNT()</code> đòi hỏi quét qua nhiều hàng để lấy giá trị chính xác, vì vậy rất khó tối ưu, ngoại trừ việc sử dụng chỉ mục che phủ. Nếu không thể giải quyết vấn đề, chỉ có thể giải quyết từ mức kiến ​​trúc, ví dụ như thêm bảng tổng hợp hoặc sử dụng hệ thống cache bên ngoài như Redis.</p><h3 id="toi-uu-truy-van-join" tabindex="-1"><a class="header-anchor" href="#toi-uu-truy-van-join"><span>Tối ưu truy vấn JOIN</span></a></h3><h4 id="toi-uu-cac-cau-truy-van-con" tabindex="-1"><a class="header-anchor" href="#toi-uu-cac-cau-truy-van-con"><span>Tối ưu các câu truy vấn con</span></a></h4><p>Hãy cố gắng sử dụng câu lệnh <code>JOIN</code> thay vì các câu truy vấn con. Vì câu truy vấn con là các truy vấn lồng nhau, dẫn đến tạo bảng tạm thời và tiêu tốn tài nguyên hệ thống cũng như thời gian. Đặc biệt là với các câu truy vấn con trả về kết quả lớn, ảnh hưởng lớn đến hiệu suất truy vấn.</p><h4 id="bang-nho-đieu-khien-bang-lon" tabindex="-1"><a class="header-anchor" href="#bang-nho-đieu-khien-bang-lon"><span>Bảng nhỏ điều khiển bảng lớn</span></a></h4><p>Trong các truy vấn JOIN, nên để bảng nhỏ làm điều khiển bảng lớn. Khi thực thi JOIN, MySQL sẽ duyệt bảng điều khiển trước, sau đó duyệt bảng bị điều khiển. Ví dụ, trong LEFT JOIN, bảng bên trái là bảng điều khiển. Nếu bảng bên trái nhỏ hơn bảng bên phải, số lần thiết lập kết nối sẽ ít hơn, từ đó cải thiện tốc độ truy vấn.</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> name</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> A </span><span style="color:#C678DD;--shiki-dark:#C678DD;">LEFT JOIN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> B ;</span></span></code></pre></div><h4 id="su-dung-cac-truong-du-thua-mot-cach-thich-hop" tabindex="-1"><a class="header-anchor" href="#su-dung-cac-truong-du-thua-mot-cach-thich-hop"><span>Sử dụng các trường dư thừa một cách thích hợp</span></a></h4><p>Thêm các trường dư thừa có thể giảm số lượng các truy vấn liên kết, vì truy vấn liên kết nhiều bảng có hiệu suất thấp. Vì vậy, nếu cần thiết, bạn có thể thêm các trường dư thừa để giảm số lượng các truy vấn liên kết bảng, đây là chiến lược tối ưu hóa bằng cách đổi thời gian lấy không gian.</p><h4 id="tranh-join-qua-nhieu-bang" tabindex="-1"><a class="header-anchor" href="#tranh-join-qua-nhieu-bang"><span>Tránh JOIN quá nhiều bảng</span></a></h4><p>&quot;Alibaba Java Development Handbook&quot; quy định không nên tham gia quá ba bảng, trước hết giảm tốc độ truy vấn, thứ hai là nói buffer sẽ chiếm nhiều bộ nhớ hơn.</p><p>Nếu không tránh được việc tham gia nhiều bảng, bạn có thể xem xét cách dữ liệu không đồng bộ được tách riêng trong ES để tìm kiếm.</p><h4 id="khac" tabindex="-1"><a class="header-anchor" href="#khac"><span>Khác</span></a></h4><p>Trong các kịch bản dữ liệu lớn, liên kết bảng thông qua một trường trùng lặp sẽ có hiệu suất tốt hơn so với việc sử dụng <code>JOIN</code> trực tiếp.</p><p>Nếu thực sự cần sử dụng truy vấn liên kết, cần lưu ý:</p><ul><li><strong>Đảm bảo các cột trong mệnh đề <code>ON</code> và <code>USING</code> có chỉ mục</strong>. Khi tạo chỉ mục, cần xem xét thứ tự liên kết. Khi bảng A và bảng B được liên kết bằng cột column, nếu trình tối ưu hóa liên kết theo thứ tự A, B, thì không cần tạo chỉ mục trên cột tương ứng của bảng A. Việc tạo chỉ mục không được sử dụng sẽ tạo ra gánh nặng bổ sung, thông thường, chỉ cần tạo chỉ mục trên cột tương ứng của bảng thứ hai trong thứ tự liên kết (lý do cụ thể được phân tích bên dưới).</li><li><strong>Đảm bảo bất kỳ biểu thức nào trong <code>GROUP BY</code> và <code>ORDER BY</code> chỉ tham chiếu đến một cột trong một bảng</strong>. Điều này cho phép MySQL sử dụng chỉ mục để tối ưu.</li></ul><p>Để hiểu kỹ thuật tối ưu liên kết truy vấn, cần hiểu cách MySQL thực hiện truy vấn liên kết. <strong>Chiến lược thực hiện liên kết hiện tại của MySQL rất đơn giản. Nó thực hiện liên kết lồng nhau</strong> cho bất kỳ liên kết nào, tức là trước tiên lặp lại từng bản ghi trong một bảng, sau đó lặp lại từng bản ghi trong bảng tiếp theo để tìm các hàng khớp, và tiếp tục như vậy cho đến khi tìm thấy tất cả các hàng khớp trong tất cả các bảng. Sau đó, dựa trên các hàng khớp của các bảng, trả về các cột yêu cầu trong truy vấn.</p><p>Quá trừu tượng? Lấy ví dụ trên để minh họa, chẳng hạn, có một câu truy vấn như vậy:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> A</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">xx</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">B</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">yy</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> A </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INNER JOIN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> B </span><span style="color:#C678DD;--shiki-dark:#C678DD;">USING</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(c)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> A</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">xx</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><p>Giả sử MySQL thực hiện phép liên kết theo thứ tự A, B trong câu truy vấn, sau đây là một đoạn mã giả để biểu diễn cách MySQL thực thi truy vấn này:</p><div class="language-ruby" data-ext="ruby" data-title="ruby"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">outer_iterator </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> SELECT</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> A</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.xx,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">A</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.c </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">FROM</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> A</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> WHERE</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> A</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.xx </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">IN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">outer_row </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> outer_iterator.next;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(outer_row) {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    inner_iterator </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> SELECT</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> B</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.yy </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">FROM</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> B</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> WHERE</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> B</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.c </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> outer_row.c;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    inner_row </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> inner_iterator.next;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(inner_row) {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        output[inner_row.yy,outer_row.xx];</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        inner_row </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> inner_iterator.next;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    outer_row </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> outer_iterator.next;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Có thể thấy, truy vấn bên ngoài cùng được thực hiện dựa trên cột <code>A.xx</code>, nếu cột <code>A.c</code> có chỉ mục, truy vấn liên kết sẽ không sử dụng chỉ mục. Tiếp theo, xem xét truy vấn bên trong, rõ ràng cột <code>B.c</code> có chỉ mục, có thể tăng tốc truy vấn. Do đó, chỉ cần tạo chỉ mục trên cột tương ứng của bảng thứ hai trong thứ tự liên kết.</p><h3 id="toi-uu-group-by-va-distinct" tabindex="-1"><a class="header-anchor" href="#toi-uu-group-by-va-distinct"><span>Tối ưu <code>GROUP BY</code> và <code>DISTINCT</code></span></a></h3><p>Trình tối ưu hóa MySQL sẽ chuyển đổi hai loại truy vấn này khi xử lý nội bộ. Cả hai đều <strong>có thể được tối ưu hóa bằng cách sử dụng chỉ mục, đây cũng là phương pháp tối ưu hiệu quả nhất</strong>.</p><h3 id="toi-uu-union" tabindex="-1"><a class="header-anchor" href="#toi-uu-union"><span>Tối ưu UNION</span></a></h3><p>Chiến lược của MySQL là thực hiện <code>UNION</code>: tạo bảng tạm thời, sau đó điền kết quả từng truy vấn vào bảng tạm thời, sau đó thực hiện truy vấn. Rất nhiều chiến lược tối ưu trong các truy vấn <code>UNION</code> sẽ không có hiệu quả, vì nó không thể tận dụng chỉ mục.</p><p>Tốt nhất là đẩy các điều kiện <code>WHERE</code>, <code>LIMIT</code> và các mệnh đề con vào từng truy vấn con của <code>UNION</code>, để trình tối ưu hóa có thể tận dụng đầy đủ các điều kiện này để tối ưu hóa.</p><p>Ngoài ra, hãy cố gắng sử dụng <code>UNION ALL</code> và tránh sử dụng <code>UNION</code>.</p><ul><li><code>UNION</code> cần quét và loại bỏ các bản sao, do đó tốn ít tài nguyên hơn; <code>UNION ALL</code> không thực hiện việc loại bỏ.</li><li><code>UNION</code> sắp xếp theo thứ tự các trường; <code>UNION ALL</code> chỉ đơn giản là kết hợp hai kết quả.</li></ul><h3 id="toi-uu-cach-thuc-hien-truy-van" tabindex="-1"><a class="header-anchor" href="#toi-uu-cach-thuc-hien-truy-van"><span>Tối ưu cách thực hiện truy vấn</span></a></h3><h4 id="chia-nho-truy-van-lon" tabindex="-1"><a class="header-anchor" href="#chia-nho-truy-van-lon"><span>Chia nhỏ truy vấn lớn</span></a></h4><p>Nếu một truy vấn lớn được thực hiện một lần, có thể khóa nhiều dữ liệu, làm đầy toàn bộ nhật ký giao dịch, sử dụng hết tài nguyên hệ thống và chặn nhiều truy vấn nhỏ nhưng quan trọng.</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DELETE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> messages </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> create</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> &lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> DATE_SUB(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">NOW</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(), INTERVAL </span><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> MONTH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">rows_affected </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">do {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    rows_affected </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> do_query(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    &quot;DELETE FROM messages WHERE create  &lt; DATE_SUB(NOW(), INTERVAL 3 MONTH) LIMIT 10000&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">} </span><span style="color:#C678DD;--shiki-dark:#C678DD;">while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> rows_affected </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span></span></code></pre></div><h4 id="phan-tach-truy-van-lien-ket-lon" tabindex="-1"><a class="header-anchor" href="#phan-tach-truy-van-lien-ket-lon"><span>Phân tách truy vấn liên kết lớn</span></a></h4><p>Phân tách một truy vấn liên kết lớn (JOIN) thành nhiều truy vấn đơn bảng, sau đó kết hợp kết quả trong ứng dụng, có những lợi ích sau:</p><ul><li>Tăng hiệu suất của bộ nhớ cache. Trong trường hợp truy vấn liên kết, nếu một trong các bảng thay đổi, bộ nhớ cache của truy vấn toàn bộ không thể sử dụng. Tuy nhiên, khi phân tách thành nhiều truy vấn đơn bảng, ngay cả khi một trong các bảng thay đổi, bộ nhớ cache của các truy vấn khác vẫn có thể được sử dụng.</li><li>Phân tách thành nhiều truy vấn đơn bảng, các kết quả của các truy vấn này có thể được sử dụng lại bởi các truy vấn khác, giảm số lượng truy vấn lặp lại.</li><li>Giảm sự cạnh tranh khóa.</li><li>Dễ dàng phân tách cơ sở dữ liệu, dễ dàng đạt được hiệu suất cao và khả năng mở rộng.</li><li>Có thể cải thiện hiệu suất của truy vấn. Ví dụ, thay vì sử dụng truy vấn liên kết ngẫu nhiên, sử dụng IN() có thể cho phép MySQL thực hiện truy vấn theo thứ tự ID, điều này có thể hiệu quả hơn việc thực hiện truy vấn liên kết ngẫu nhiên.</li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> tag</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">JOIN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> tag_post </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> tag_post</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tag_id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tag</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">JOIN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> post </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> tag_post</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">post_id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">post</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> tag</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tag</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;mysql&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> tag </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> tag</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;mysql&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> tag_post </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> tag_id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1234</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> post </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> post</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">id</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IN</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">123</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">456</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">567</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">9098</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">8904</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><h3 id="toi-uu-hoa-index" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-index"><span>Tối ưu hoá index</span></a></h3><p>Việc sắp xếp và nhóm có thể được tối ưu hóa thông qua các truy vấn bao phủ chỉ mục.</p><p>Xem <a href="mysql-index">MySQL Index</a> để hiểu chi tiết!</p><h2 id="toi-uu-cau-truc-du-lieu" tabindex="-1"><a class="header-anchor" href="#toi-uu-cau-truc-du-lieu"><span>Tối ưu cấu trúc dữ liệu</span></a></h2><p>Thiết kế logic và thiết kế vật lý tốt là nền tảng của hiệu suất cao.</p><h3 id="toi-uu-kieu-du-lieu" tabindex="-1"><a class="header-anchor" href="#toi-uu-kieu-du-lieu"><span>Tối ưu kiểu dữ liệu</span></a></h3><h4 id="nguyen-tac-co-ban-cua-toi-uu-kieu-du-lieu" tabindex="-1"><a class="header-anchor" href="#nguyen-tac-co-ban-cua-toi-uu-kieu-du-lieu"><span>Nguyên tắc cơ bản của tối ưu kiểu dữ liệu</span></a></h4><ul><li><strong>Càng nhỏ càng tốt</strong> - Kiểu dữ liệu nhỏ hơn thường nhanh hơn, chiếm ít không gian đĩa, bộ nhớ và yêu cầu ít chu kỳ CPU để xử lý. <ul><li>Ví dụ: Kiểu số nguyên thường nhanh hơn kiểu ký tự, do đó sử dụng kiểu số nguyên để lưu địa chỉ IP, sử dụng <code>DATETIME</code> để lưu thời gian thay vì chuỗi ký tự.</li></ul></li><li><strong>Đơn giản là tốt</strong> - Ví dụ: Kiểu số nguyên thường nhanh hơn kiểu ký tự. <ul><li>Ví dụ: Nhiều phần mềm sử dụng kiểu số nguyên để lưu địa chỉ IP.</li><li>Ví dụ: <strong><code>UNSIGNED</code> chỉ ra không cho phép giá trị âm, có thể tăng giới hạn trên giá trị dương gần gấp đôi</strong>.</li></ul></li><li><strong>Tránh NULL nếu có thể</strong> - Cột có thể là NULL sẽ làm phức tạp việc tạo chỉ mục, thống kê chỉ mục và so sánh giá trị.</li></ul><h4 id="lua-chon-kieu-du-lieu" tabindex="-1"><a class="header-anchor" href="#lua-chon-kieu-du-lieu"><span>Lựa chọn kiểu dữ liệu</span></a></h4><ul><li>Kiểu số nguyên thường là lựa chọn tốt nhất cho cột định danh vì chúng nhanh chóng và có thể sử dụng <code>AUTO_INCREMENT</code>.</li><li>Kiểu ENUM và SET thường là lựa chọn tồi, nên tránh sử dụng.</li><li>Nên tránh sử dụng kiểu ký tự làm cột định danh vì chúng tiêu tốn không gian và thường chậm hơn kiểu số. Đối với các chuỗi ngẫu nhiên như <code>MD5</code>, <code>SHA</code>, <code>UUID</code>, do phân bố ngẫu nhiên, chúng có thể phân tán trong không gian lớn, dẫn đến việc <code>INSERT</code> và một số truy vấn <code>SELECT</code> trở nên chậm chạp. <ul><li>Nếu lưu trữ UUID, nên xóa ký tự <code>-</code>; cách tốt hơn là chuyển đổi giá trị UUID thành số 16 byte bằng cách sử dụng hàm <code>UNHEX()</code> và lưu trữ trong cột <code>BINARY(16)</code>, khi truy vấn, có thể định dạng lại thành định dạng hex bằng cách sử dụng hàm <code>HEX()</code>.</li></ul></li></ul><h3 id="thiet-ke-bang" tabindex="-1"><a class="header-anchor" href="#thiet-ke-bang"><span>Thiết kế bảng</span></a></h3><p>Các vấn đề thiết kế nên tránh:</p><ul><li><strong>Quá nhiều cột</strong> - Thiết kế có quá nhiều cột không cần thiết, trong thực tế, nhiều cột trong bảng không được sử dụng. Mô hình bảng rộng như vậy sẽ tạo ra một khoản phí hiệu suất không nhỏ, đặc biệt là <code>ALTER TABLE</code> rất tốn thời gian.</li><li><strong>Quá nhiều liên kết</strong> - Mô hình thiết kế thực thể - thuộc tính - giá trị (EAV) là một mô hình thiết kế tồi phổ biến. MySQL giới hạn mỗi phép liên kết tối đa chỉ có thể có 61 bảng, nhưng mô hình EAV yêu cầu nhiều liên kết tự liên kết.</li><li><strong>Enum</strong> - Nên tránh sử dụng enum vì việc thêm và xóa chuỗi (tùy chọn enum) phải sử dụng <code>ALTER TABLE</code>.</li><li>Nên tránh sử dụng NULL nếu có thể.</li></ul><h3 id="chuan-hoa-va-phi-chuan-hoa" tabindex="-1"><a class="header-anchor" href="#chuan-hoa-va-phi-chuan-hoa"><span>Chuẩn hoá và phi chuẩn hoá</span></a></h3><p><strong>Mục tiêu của chuẩn hoá là giảm thiểu sự lặp lại, trong khi phi chuẩn hoá thì ngược lại</strong>.</p><p>Lợi ích của chuẩn hoá:</p><ul><li>Tiết kiệm không gian hơn so với phi chuẩn hoá.</li><li>Các hoạt động cập nhật nhanh hơn so với phi chuẩn hoá.</li><li>Cần ít <code>DISTINCT</code> hoặc <code>GROUP BY</code> hơn.</li></ul><p>Nhược điểm của chuẩn hoá:</p><ul><li>Thường cần truy vấn liên kết. Truy vấn liên kết có chi phí cao, đặc biệt là truy vấn liên kết giữa các bảng phân tán.</li></ul><p>Trong thực tế, hiếm khi sử dụng chuẩn hoá hoặc phi chuẩn hoá một cách cực đoan. Thực tế, nên cân nhắc lợi ích và hạn chế của chuẩn hoá và phi chuẩn hoá, sử dụng kết hợp.</p><h3 id="toi-uu-chi-muc" tabindex="-1"><a class="header-anchor" href="#toi-uu-chi-muc"><span>Tối ưu chỉ mục</span></a></h3><blockquote><p>Tối ưu chỉ mục nên là biện pháp hiệu suất tìm kiếm hiệu quả nhất.</p><p>Nếu bạn muốn tìm hiểu chi tiết về các tính năng chỉ mục, vui lòng tham khảo: [[MySQL Index]]</p></blockquote><h4 id="khi-nao-su-dung-chi-muc" tabindex="-1"><a class="header-anchor" href="#khi-nao-su-dung-chi-muc"><span>Khi nào sử dụng chỉ mục</span></a></h4><ul><li>Đối với các bảng rất nhỏ, hầu hết các trường hợp, quét toàn bộ bảng đơn giản hơn.</li><li>Đối với bảng trung bình và lớn, chỉ mục rất hiệu quả.</li><li>Đối với bảng cực lớn, việc xây dựng và sử dụng chỉ mục sẽ tăng chi phí. Có thể xem xét sử dụng kỹ thuật phân vùng.</li><li>Nếu có quá nhiều bảng, có thể xây dựng một bảng thông tin siêu dữ liệu để truy vấn các tính năng cần thiết.</li></ul><h4 id="chien-luoc-toi-uu-chi-muc" tabindex="-1"><a class="header-anchor" href="#chien-luoc-toi-uu-chi-muc"><span>Chiến lược tối ưu chỉ mục</span></a></h4><ul><li><strong>Nguyên tắc cơ bản của chỉ mục</strong><ul><li>Không phải càng nhiều chỉ mục càng tốt, không nên tạo chỉ mục cho tất cả các cột.</li><li>Tránh sự lặp lại và chỉ mục trùng lặp.</li><li>Xem xét xóa các chỉ mục không sử dụng.</li><li>Mở rộng chỉ mục hiện có thay vì tạo chỉ mục mới.</li><li>Các cột thường được sử dụng làm điều kiện lọc trong câu lệnh <code>WHERE</code> nên xem xét thêm chỉ mục cho chúng.</li></ul></li><li><strong>Cột độc lập</strong> - &quot;Cột độc lập&quot; có nghĩa là cột chỉ mục không phải là một phần của biểu thức hoặc đối số của hàm.</li><li><strong>Chỉ mục tiền tố</strong> - Đối với cột ký tự dài, có thể chỉ mục một phần đầu của chuỗi để tiết kiệm không gian chỉ mục.</li><li><strong>Nguyên tắc khớp trái nhất</strong> - Sắp xếp các cột có độ chọn lọc cao hoặc độ kardinal lớn ở đầu chỉ mục nhiều cột.</li><li>Sử dụng chỉ mục để sắp xếp dữ liệu.</li><li><code>=</code> và <code>IN</code> có thể không tuân thủ thứ tự - Không cần quan tâm đến thứ tự của <code>=</code>, <code>IN</code>, v.v.</li><li><strong>Chỉ mục bao phủ</strong></li><li><strong>Sử dụng trường tự tăng làm khóa chính</strong></li></ul><h2 id="mo-hinh-du-lieu-va-nghiep-vu" tabindex="-1"><a class="header-anchor" href="#mo-hinh-du-lieu-va-nghiep-vu"><span>Mô hình dữ liệu và nghiệp vụ</span></a></h2><ul><li>Trong trường hợp các trường bảng phức tạp, dễ thay đổi và khó thống nhất, chúng ta có thể xem xét sử dụng NoSQL thay thế lưu trữ bảng cơ sở dữ liệu quan hệ, ví dụ như ElasticSearch, MongoDB.</li><li>Trong trường hợp truy vấn trong môi trường đồng thời cao, chúng ta có thể sử dụng bộ nhớ cache (như Redis) thay thế các hoạt động cơ sở dữ liệu, tăng cường hiệu suất đồng thời.</li><li>Đối với các bảng có tốc độ tăng dữ liệu nhanh chóng, cần xem xét phân chia ngang hoặc phân chia cơ sở dữ liệu để tránh hạn chế hiệu suất của việc làm việc chỉ với một bảng duy nhất.</li><li>Ngoài ra, chúng ta nên tối ưu hóa bằng cách tránh các truy vấn JOIN phức tạp, ví dụ như sao chép một số trường để giảm số lượng truy vấn JOIN; tạo các bảng trung gian để giảm số lượng truy vấn JOIN.</li></ul></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/database/mysql/optimization.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/database/mysql/replication.html" aria-label="MySQL Replication"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon>MySQL Replication</div></a><a class="route-link auto-link next" href="/database/mysql/opearation.html" aria-label="MySQL Opearation"><div class="hint">Next<span class="arrow end"></span></div><div class="link">MySQL Opearation<iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with ❤️ by Hung Nguyen</div><div class="copyright">Copyright © 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BG8AAbz2.js" defer></script>
  </body>
</html>
