<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.46" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/database/redis/guide.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="Redis Guide"><meta property="og:description" content="Hướng dẫn Redis 1. Giới thiệu về Redis Redis là một cơ sở dữ liệu key-value nhanh chóng và không phụ thuộc vào quan hệ (NoSQL) được lưu trữ trong bộ nhớ, có thể ánh xạ giữa các ..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724111451.png"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-06-28T15:54:38.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:tag" content="redis"><meta property="article:modified_time" content="2024-06-28T15:54:38.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Redis Guide","image":["https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724111451.png"],"dateModified":"2024-06-28T15:54:38.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>Redis Guide | VanHung4499</title><meta name="description" content="Hướng dẫn Redis 1. Giới thiệu về Redis Redis là một cơ sở dữ liệu key-value nhanh chóng và không phụ thuộc vào quan hệ (NoSQL) được lưu trữ trong bộ nhớ, có thể ánh xạ giữa các ...">
    <link rel="preload" href="/assets/style-DgCUO63b.css" as="style"><link rel="stylesheet" href="/assets/style-DgCUO63b.css">
    <link rel="modulepreload" href="/assets/app-B-Bgbu6w.js"><link rel="modulepreload" href="/assets/guide.html-Cn-8IWAK.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/project/" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon><!--]-->Project<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">SQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Redis</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/overview.html" aria-label="Redis Overview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Overview<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/database/redis/guide.html" aria-label="Redis Guide"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Guide<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/basic-data-types.html" aria-label="Redis Basic Data Types"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Basic Data Types<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/advanced-data-types.html" aria-label="Redis Advanced Data Types"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Advanced Data Types<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/data-structures.html" aria-label="Redis Data Structures"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Data Structures<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/expire.html" aria-label="Redis Expire Delete"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Expire Delete<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/persistence.html" aria-label="Redis Persistence"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Persistence<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/event.html" aria-label="Redis Event"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Event<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/replication.html" aria-label="Redis Replication"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Replication<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/sentinel.html" aria-label="Redis Sentinel"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Sentinel<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/cluster.html" aria-label="Redis Cluster"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Cluster<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/pub-sub.html" aria-label="Redis Publish and Subcribe"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Publish and Subcribe<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/transaction.html" aria-label="Redis Transaction"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Transaction<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/pipeline.html" aria-label="Redis Pipeline"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Pipeline<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/operations.html" aria-label="Redis Operations"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Operations<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/action.html" aria-label="Redis In Action"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis In Action<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/database/redis/interview.html" aria-label="Redis Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis Interview<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">MongoDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Elasticsearch</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Elastic Stack</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon>Redis Guide</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-28T15:54:38.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 23 min</span><meta property="timeRequired" content="PT23M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color8 clickable" role="navigation">redis</span><!--]--><meta property="articleSection" content="redis"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">redis</span><!--]--><meta property="keywords" content="redis"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_1-gioi-thieu-ve-redis">1. Giới thiệu về Redis</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cac-truong-hop-su-dung-redis">Các trường hợp sử dụng Redis</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#uu-điem-cua-redis">Ưu điểm của Redis</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#redis-va-memcached">Redis và Memcached</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tai-sao-redis-nhanh">Tại sao Redis nhanh</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_2-cac-kieu-du-lieu-trong-redis">2. Các kiểu dữ liệu trong Redis</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-xoa-du-lieu-khong-su-dung-trong-redis">3. Xóa dữ liệu không sử dụng trong Redis</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#điem-chinh-ve-xoa-du-lieu-trong-bo-nho">Điểm chính về xóa dữ liệu trong bộ nhớ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#thoi-gian-het-han-cua-khoa-chinh">Thời gian hết hạn của khóa chính</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chien-luoc-xoa-du-lieu">Chiến lược xóa dữ liệu</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#lua-chon-chien-luoc-xoa-du-lieu">Lựa chọn chiến lược xóa dữ liệu</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trien-khai-noi-bo">Triển khai nội bộ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-luu-tru-du-lieu-trong-redis">4. Lưu trữ dữ liệu trong Redis</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_5-su-kien-trong-redis">5. Sự kiện trong Redis</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#su-kien-tap-tin">Sự kiện tập tin</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#su-kien-thoi-gian">Sự kiện thời gian</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#lap-lich-va-thuc-thi-su-kien">Lập lịch và thực thi sự kiện</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_6-giao-dich-trong-redis">6. Giao dịch trong Redis</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#multi">MULTI</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#exec">EXEC</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#discard">DISCARD</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#watch">WATCH</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rollback">Rollback</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_7-redis-pipeline">7. Redis Pipeline</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_8-redis-publish-subscribe">8. Redis Publish/Subscribe</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_9-redis-replication">9. Redis Replication</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#sao-chep-cu">Sao chép cũ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#sao-chep-moi">Sao chép mới</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#đong-bo-mot-phan">Đồng bộ một phần</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#lenh-psync">Lệnh PSYNC</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#kiem-tra-nhip-tim">Kiểm tra nhịp tim</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_10-redis-sentinel">10. Redis Sentinel</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_11-redis-cluster">11. Redis Cluster</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_12-redis-client">12. Redis Client</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="huong-dan-redis" tabindex="-1"><a class="header-anchor" href="#huong-dan-redis"><span>Hướng dẫn Redis</span></a></h1><h2 id="_1-gioi-thieu-ve-redis" tabindex="-1"><a class="header-anchor" href="#_1-gioi-thieu-ve-redis"><span>1. Giới thiệu về Redis</span></a></h2><blockquote><p>Redis là một cơ sở dữ liệu key-value nhanh chóng và không phụ thuộc vào quan hệ (NoSQL) được lưu trữ trong bộ nhớ, có thể ánh xạ giữa các khóa và năm loại giá trị khác nhau.</p><p>Loại khóa chỉ có thể là chuỗi, các loại giá trị được hỗ trợ bao gồm: chuỗi, danh sách, tập hợp, tập hợp có thứ tự và bảng băm.</p></blockquote><h3 id="cac-truong-hop-su-dung-redis" tabindex="-1"><a class="header-anchor" href="#cac-truong-hop-su-dung-redis"><span>Các trường hợp sử dụng Redis</span></a></h3><ul><li><strong>Bộ nhớ đệm</strong> - Đặt dữ liệu hot vào bộ nhớ, đặt giới hạn sử dụng bộ nhớ tối đa và chiến lược loại bỏ hết hạn để đảm bảo tỷ lệ trúng đích của bộ nhớ đệm.</li><li><strong>Bộ đếm</strong> - Cơ sở dữ liệu bộ nhớ này hỗ trợ các hoạt động đọc và ghi bộ đếm thường xuyên.</li><li><strong>Giới hạn ứng dụng</strong> - Hạn chế lưu lượng truy cập vào một trang web.</li><li><strong>Hàng đợi tin nhắn</strong> - Sử dụng kiểu dữ liệu danh sách, đó là danh sách liên kết hai chiều.</li><li><strong>Bảng tìm kiếm</strong> - Sử dụng kiểu dữ liệu HASH.</li><li><strong>Phép giao của tập hợp</strong> - Sử dụng kiểu dữ liệu SET, ví dụ như tìm những người bạn chung của hai người dùng.</li><li><strong>Bảng xếp hạng</strong> - Sử dụng kiểu dữ liệu ZSET.</li><li><strong>Phiên phân tán</strong> - Lưu trữ phiên của nhiều máy chủ ứng dụng vào Redis để đảm bảo tính nhất quán của phiên.</li><li><strong>Khóa phân tán</strong> - Ngoài việc sử dụng SETNX để triển khai khóa phân tán, bạn cũng có thể sử dụng khóa phân tán RedLock do chính thức cung cấp.</li></ul><h3 id="uu-điem-cua-redis" tabindex="-1"><a class="header-anchor" href="#uu-điem-cua-redis"><span>Ưu điểm của Redis</span></a></h3><ul><li>Hiệu suất cao - Redis có thể đọc với tốc độ 110.000 lần / giây và ghi với tốc độ 81.000 lần / giây.</li><li>Loại dữ liệu phong phú - Hỗ trợ chuỗi, danh sách, tập hợp, tập hợp có thứ tự và bảng băm.</li><li>Tính nguyên tử - Tất cả các hoạt động của Redis đều có tính nguyên tử. Một hoạt động đơn lẻ là nguyên tử. Nhiều hoạt động cũng hỗ trợ giao dịch, tức là nguyên tử, bằng cách bao gồm các chỉ thị MULTI và EXEC.</li><li>Dữ liệu bền vững - Redis hỗ trợ việc lưu trữ dữ liệu. Có thể lưu trữ dữ liệu trong bộ nhớ và khôi phục lại khi khởi động lại.</li><li>Sao lưu - Redis hỗ trợ sao lưu dữ liệu, tức là sao lưu dữ liệu theo chế độ master-slave.</li><li>Tính năng phong phú - Redis cũng hỗ trợ xuất bản / đăng ký, thông báo, hết hạn khóa, v.v.</li></ul><h3 id="redis-va-memcached" tabindex="-1"><a class="header-anchor" href="#redis-va-memcached"><span>Redis và Memcached</span></a></h3><p>Redis và Memcached thường được so sánh vì cả hai đều có thể được sử dụng làm bộ nhớ đệm, nhưng chúng có một số khác biệt chính như sau:</p><p><strong>Loại dữ liệu</strong></p><ul><li>Memcached chỉ hỗ trợ kiểu dữ liệu chuỗi;</li><li>Trong khi đó, Redis hỗ trợ năm loại dữ liệu khác nhau, giúp nó giải quyết vấn đề một cách linh hoạt hơn.</li></ul><p><strong>Dữ liệu bền vững</strong></p><ul><li>Memcached không hỗ trợ tính năng bền vững;</li><li>Redis hỗ trợ hai chính sách bền vững: RDB Snapshot và AOF Log.</li></ul><p><strong>Phân tán</strong></p><ul><li>Memcached không hỗ trợ phân tán, chỉ có thể triển khai lưu trữ phân tán bằng cách sử dụng thuật toán phân tán như băm nhất quán trên máy khách, điều này yêu cầu tính toán vị trí dữ liệu trên máy khách khi lưu trữ và truy vấn.</li><li>Redis Cluster hỗ trợ phân tán.</li></ul><p><strong>Quản lý bộ nhớ</strong></p><ul><li>Memcached chia bộ nhớ thành các khối có độ dài cố định để lưu trữ dữ liệu, giải quyết hoàn toàn vấn đề mảnh vụn bộ nhớ, nhưng phương pháp này làm giảm hiệu suất sử dụng bộ nhớ, ví dụ: nếu kích thước khối là 128 byte và chỉ lưu trữ 100 byte dữ liệu, thì 28 byte còn lại sẽ bị lãng phí.</li><li>Trong Redis, không phải tất cả dữ liệu đều được lưu trữ trong bộ nhớ, một số giá trị không được sử dụng trong thời gian dài có thể được trao đổi sang đĩa. Dữ liệu của Memcached sẽ luôn nằm trong bộ nhớ.</li></ul><h3 id="tai-sao-redis-nhanh" tabindex="-1"><a class="header-anchor" href="#tai-sao-redis-nhanh"><span>Tại sao Redis nhanh</span></a></h3><p>Redis có thể đạt được QPS đơn lẻ lên đến 100.000.</p><p>Redis sử dụng mô hình đơn luồng (Redis 6.0 đã hỗ trợ mô hình đa luồng), tại sao nó vẫn có thể đạt được đồng thời cao như vậy?</p><ul><li>Redis hoàn toàn dựa trên hoạt động bộ nhớ.</li><li>Cấu trúc dữ liệu của Redis đơn giản.</li><li>Sử dụng mô hình đơn luồng để tránh việc chuyển đổi ngữ cảnh và cạnh tranh giữa các luồng.</li><li>Sử dụng mô hình I/O multiplexing (I/O không chặn).</li></ul><blockquote><p>I/O multiplexing</p><p>Mô hình I/O multiplexing là khả năng theo dõi cùng một lúc nhiều luồng I/O sự kiện của select, poll, epoll. Khi không hoạt động, nó sẽ chặn luồng hiện tại và khi một hoặc nhiều luồng có sự kiện I/O, nó sẽ được đánh thức từ trạng thái chặn và sau đó chương trình sẽ kiểm tra tất cả các luồng I/O (epoll chỉ kiểm tra các luồng thực sự gửi sự kiện), và chỉ xử lý từng luồng sẵn sàng, điều này tránh các hoạt động không hữu ích lớn.</p></blockquote><h2 id="_2-cac-kieu-du-lieu-trong-redis" tabindex="-1"><a class="header-anchor" href="#_2-cac-kieu-du-lieu-trong-redis"><span>2. Các kiểu dữ liệu trong Redis</span></a></h2><p>Redis có các kiểu dữ liệu cơ bản: STRING, HASH, LIST, SET, ZSET</p><p>Redis cũng có các kiểu dữ liệu nâng cao: BitMap, HyperLogLog, GEO</p><p>💡 Để biết thêm thông tin chi tiết về các tính năng và nguyên lý, vui lòng tham khảo: [[Redis Data Types and Applications]]</p><h2 id="_3-xoa-du-lieu-khong-su-dung-trong-redis" tabindex="-1"><a class="header-anchor" href="#_3-xoa-du-lieu-khong-su-dung-trong-redis"><span>3. Xóa dữ liệu không sử dụng trong Redis</span></a></h2><h3 id="điem-chinh-ve-xoa-du-lieu-trong-bo-nho" tabindex="-1"><a class="header-anchor" href="#điem-chinh-ve-xoa-du-lieu-trong-bo-nho"><span>Điểm chính về xóa dữ liệu trong bộ nhớ</span></a></h3><ul><li><strong>Bộ nhớ tối đa</strong> - Redis cho phép đặt giá trị tối đa của bộ nhớ thông qua tham số <code>maxmemory</code>.</li><li><strong>Thời gian hết hạn</strong> - Là cơ chế quan trọng để xóa dữ liệu vô hiệu, trong các lệnh Redis cung cấp, <code>EXPIRE</code>, <code>EXPIREAT</code>, <code>PEXPIRE</code>, <code>PEXPIREAT</code>, <code>SETEX</code> và <code>PSETEX</code> được sử dụng để đặt thời gian hết hạn cho một cặp khóa-giá trị. Khi một cặp khóa-giá trị được liên kết với thời gian hết hạn, nó sẽ tự động bị xóa sau khi hết hạn (hoặc nói cách khác, trở thành không thể truy cập).</li><li><strong>Chiến lược xóa</strong> - Khi lưu trữ dữ liệu vào Redis, khi không gian bộ nhớ còn lại không đủ để lưu trữ dữ liệu mới, Redis sẽ thực hiện chiến lược xóa dữ liệu để giải phóng một phần nội dung và đảm bảo dữ liệu mới có thể được lưu trữ trong bộ nhớ. Cơ chế xóa dữ liệu trong bộ nhớ nhằm tối ưu hóa việc sử dụng bộ nhớ, bằng cách đổi lấy một số lần không trúng đích để sử dụng bộ nhớ, đảm bảo rằng dữ liệu được lưu trữ trong bộ nhớ Redis là dữ liệu nóng.</li><li><strong>LRU không chính xác</strong> - Trên thực tế, Redis không triển khai LRU đáng tin cậy, có nghĩa là việc xóa khóa không nhất thiết là khóa không được sử dụng lâu nhất.</li></ul><h3 id="thoi-gian-het-han-cua-khoa-chinh" tabindex="-1"><a class="header-anchor" href="#thoi-gian-het-han-cua-khoa-chinh"><span>Thời gian hết hạn của khóa chính</span></a></h3><p>Redis có thể đặt thời gian hết hạn cho mỗi khóa, khi khóa hết hạn, nó sẽ tự động bị xóa.</p><p>Đối với các cấu trúc dữ liệu như bảng băm, chỉ có thể đặt thời gian hết hạn cho toàn bộ khóa (toàn bộ bảng băm), không thể đặt thời gian hết hạn cho từng phần tử trong khóa.</p><p>Có thể sử dụng <code>EXPIRE</code> hoặc <code>EXPIREAT</code> để đặt thời gian hết hạn cho khóa.</p><blockquote><p>🔔 Lưu ý: Nếu thời gian <code>EXPIRE</code> được đặt là số âm, thời gian dấu thời gian <code>EXPIREAT</code> là thời gian hết hạn, khóa sẽ bị xóa trực tiếp.</p></blockquote><p>Ví dụ:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">SET</span><span style="color:#98C379;--shiki-dark:#98C379;"> mykey</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Hello&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;OK&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">EXPIRE</span><span style="color:#98C379;--shiki-dark:#98C379;"> mykey</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">TTL</span><span style="color:#98C379;--shiki-dark:#98C379;"> mykey</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">10</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">SET</span><span style="color:#98C379;--shiki-dark:#98C379;"> mykey</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Hello World&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;OK&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">TTL</span><span style="color:#98C379;--shiki-dark:#98C379;"> mykey</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">-1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><h3 id="chien-luoc-xoa-du-lieu" tabindex="-1"><a class="header-anchor" href="#chien-luoc-xoa-du-lieu"><span>Chiến lược xóa dữ liệu</span></a></h3><p>Xóa dữ liệu trong bộ nhớ chỉ là một tính năng mà Redis cung cấp, để triển khai tốt hơn tính năng này, cần cung cấp các chiến lược khác nhau cho các tình huống ứng dụng khác nhau, vấn đề cần giải quyết bao gồm cách chọn không gian khóa để xóa? Làm thế nào để chọn khóa để xóa trong không gian khóa?</p><p>Redis cung cấp các chiến lược xóa dữ liệu sau để người dùng lựa chọn:</p><ul><li><strong><code>noeviction</code></strong> - Khi sử dụng bộ nhớ đạt đến ngưỡng, tất cả các lệnh yêu cầu cấp phát bộ nhớ sẽ báo lỗi. Đây là chiến lược mặc định của Redis.</li><li><strong><code>allkeys-lru</code></strong> - Trong không gian khóa chính, ưu tiên xóa khóa không được sử dụng gần đây nhất.</li><li><strong><code>allkeys-random</code></strong> - Trong không gian khóa chính, xóa ngẫu nhiên một khóa.</li><li><strong><code>volatile-lru</code></strong> - Trong không gian khóa có thời gian hết hạn, ưu tiên xóa khóa không được sử dụng gần đây nhất.</li><li><strong><code>volatile-random</code></strong> - Trong không gian khóa có thời gian hết hạn, xóa ngẫu nhiên một khóa.</li><li><strong><code>volatile-ttl</code></strong> - Trong không gian khóa có thời gian hết hạn, ưu tiên xóa khóa có thời gian hết hạn sớm hơn.</li></ul><h3 id="lua-chon-chien-luoc-xoa-du-lieu" tabindex="-1"><a class="header-anchor" href="#lua-chon-chien-luoc-xoa-du-lieu"><span>Lựa chọn chiến lược xóa dữ liệu</span></a></h3><ul><li>Nếu <strong>dữ liệu phân bố theo phân phối mũ (có dữ liệu nóng, một số dữ liệu truy cập thường xuyên, một số dữ liệu truy cập ít), hãy sử dụng <code>allkeys-lru</code></strong>.</li><li>Nếu <strong>dữ liệu phân bố đồng đều (tần suất truy cập dữ liệu tương đương), hãy sử dụng <code>allkeys-random</code></strong>.</li><li>Nếu muốn <strong>sử dụng các giá trị TTL khác nhau để gợi ý cho Redis những khóa nào nên bị xóa, hãy sử dụng <code>volatile-ttl</code></strong>.</li><li><strong><code>volatile-lru</code> và <code>volatile-random</code> phù hợp cho các tình huống vừa sử dụng bộ nhớ cache vừa sử dụng lưu trữ bền vững</strong>, tuy nhiên, chúng ta cũng có thể đạt được cùng hiệu quả bằng cách sử dụng hai phiên bản Redis.</li><li><strong>Đặt thời gian hết hạn cho khóa thực tế sẽ tiêu tốn nhiều bộ nhớ hơn, do đó, khuyến nghị sử dụng chiến lược <code>allkeys-lru</code> để sử dụng bộ nhớ hiệu quả hơn</strong>.</li></ul><h3 id="trien-khai-noi-bo" tabindex="-1"><a class="header-anchor" href="#trien-khai-noi-bo"><span>Triển khai nội bộ</span></a></h3><p>Có hai cách chính để Redis xóa khóa không hợp lệ:</p><ul><li>Phương pháp tiêu cực (passive way), khi khóa được truy cập và phát hiện rằng nó không hợp lệ, nó sẽ bị xóa.</li><li>Phương pháp tích cực (active way), định kỳ lựa chọn một số khóa không hợp lệ từ không gian khóa có thời gian hết hạn và xóa chúng.</li><li>Xóa tích cực: Khi bộ nhớ đã sử dụng vượt quá giới hạn <code>maxmemory</code>, kích hoạt chiến lược xóa tích cực, chiến lược này được cấu hình bằng tham số khởi động để xác định thời gian hết hạn chính xác của khóa được duy trì trong từ điển <code>expires</code>.</li></ul><h2 id="_4-luu-tru-du-lieu-trong-redis" tabindex="-1"><a class="header-anchor" href="#_4-luu-tru-du-lieu-trong-redis"><span>4. Lưu trữ dữ liệu trong Redis</span></a></h2><p>Redis là một cơ sở dữ liệu lưu trữ trong bộ nhớ, để đảm bảo dữ liệu không bị mất sau khi máy chủ gặp sự cố, cần lưu trữ dữ liệu từ bộ nhớ xuống đĩa cứng.</p><p>Redis hỗ trợ hai phương pháp lưu trữ dữ liệu: RDB và AOF.</p><ul><li><strong>RDB (Redis Database) là phương pháp chụp nhanh, nó lưu trữ tất cả dữ liệu Redis tại một thời điểm cụ thể vào một tập tin nhị phân được nén (tập tin RDB)</strong>.</li><li>AOF (Append Only File) là một tập tin nhật ký văn bản, nó ghi lại tất cả các lệnh ghi vào cuối tập tin AOF để ghi lại sự thay đổi dữ liệu. Khi máy chủ khởi động lại, nó sẽ tải và thực thi các lệnh này để khôi phục dữ liệu gốc. AOF thích hợp để sử dụng làm <strong>bản sao lưu nóng</strong>.</li></ul><p>💡 Để biết thêm thông tin chi tiết về các tính năng và nguyên lý, vui lòng tham khảo: [[Redis Persistence]]</p><h2 id="_5-su-kien-trong-redis" tabindex="-1"><a class="header-anchor" href="#_5-su-kien-trong-redis"><span>5. Sự kiện trong Redis</span></a></h2><p>Redis là một máy chủ sự kiện, nó xử lý hai loại sự kiện:</p><ul><li><p><strong>Sự kiện tập tin (file event)</strong> - Redis giao tiếp với khách hàng hoặc các máy chủ khác thông qua socket, sự kiện tập tin là một trừu tượng hóa của hoạt động trên socket. Giao tiếp giữa máy chủ và khách hàng (hoặc các máy chủ khác) tạo ra các sự kiện tập tin, và máy chủ xử lý và xử lý các sự kiện này bằng cách lắng nghe và xử lý chúng.</p></li><li><p><strong>Sự kiện thời gian (time event)</strong> - Redis cần thực hiện một số hoạt động vào một thời điểm nhất định, sự kiện thời gian là một trừu tượng của các hoạt động định thời này.</p></li></ul><h3 id="su-kien-tap-tin" tabindex="-1"><a class="header-anchor" href="#su-kien-tap-tin"><span>Sự kiện tập tin</span></a></h3><p>Redis đã phát triển trình xử lý sự kiện mạng của riêng mình dựa trên mô hình Reactor.</p><ul><li>Trình xử lý sự kiện tập tin của Redis sử dụng trình điều khiển I/O đa kênh để lắng nghe đồng thời nhiều socket và liên kết các trình xử lý sự kiện khác nhau với các socket tương ứng dựa trên nhiệm vụ hiện tại của socket.</li><li>Khi socket được lắng nghe đã sẵn sàng để thực hiện kết nối, đọc, ghi hoặc đóng, sự kiện tập tin tương ứng sẽ xảy ra và trình xử lý sự kiện tập tin sẽ gọi trình xử lý sự kiện đã được liên kết trước đó với socket để xử lý các sự kiện này.</li></ul><p>Mặc dù trình xử lý sự kiện tập tin chạy dưới dạng một luồng đơn, nhưng bằng cách sử dụng trình điều khiển I/O đa kênh để lắng nghe nhiều socket, trình xử lý sự kiện tập tin đã triển khai mô hình giao tiếp mạng hiệu suất cao.</p><p>Trình xử lý sự kiện tập tin bao gồm bốn thành phần: socket, trình điều khiển I/O đa kênh (I/O Multiplexing), bộ phân phối sự kiện tập tin và trình xử lý sự kiện.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724111451.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="su-kien-thoi-gian" tabindex="-1"><a class="header-anchor" href="#su-kien-thoi-gian"><span>Sự kiện thời gian</span></a></h3><p>Sự kiện thời gian được chia thành hai loại:</p><ul><li><strong>Sự kiện định thời</strong>: là việc cho phép một đoạn chương trình được thực thi một lần trong khoảng thời gian đã chỉ định;</li><li><strong>Sự kiện định kỳ</strong>: là sự kiện cho phép một đoạn chương trình thực thi mỗi khoảng thời gian cụ thể.</li></ul><p>Redis lưu trữ tất cả các sự kiện thời gian trong một danh sách liên kết không tuần tự. Khi trình thực thi sự kiện thời gian chạy, nó sẽ duyệt qua toàn bộ danh sách liên kết để tìm các sự kiện thời gian đã đến và gọi trình xử lý sự kiện tương ứng.</p><h3 id="lap-lich-va-thuc-thi-su-kien" tabindex="-1"><a class="header-anchor" href="#lap-lich-va-thuc-thi-su-kien"><span>Lập lịch và thực thi sự kiện</span></a></h3><p>Để nhận được các sự kiện tập tin chờ xử lý, máy chủ cần lắng nghe liên tục các socket, nhưng không thể lắng nghe mãi mãi, nếu không sự kiện thời gian sẽ không thể được thực hiện trong thời gian quy định. Do đó, thời gian lắng nghe phải được xác định dựa trên sự kiện thời gian gần nhất.</p><p>Lập lịch và thực thi sự kiện được thực hiện bởi hàm aeProcessEvents, mã giả như sau:</p><div class="language-python line-numbers-mode" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> aeProcessEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    ## Tìm sự kiện thời gian gần nhất đã đến</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    time_event </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> aeSearchNearestTimer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    ## Tính toán thời gian còn lại đến sự kiện thời gian gần nhất</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> time_event.when </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> unix_ts_now</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    ## Nếu sự kiện đã đến, giá trị remaind_ms có thể là số âm, đặt nó thành 0</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    ## Tạo timeval dựa trên remaind_ms</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    timeval </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> create_timeval_with_ms</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(remaind_ms)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    ## Chờ và chặn để chờ sự kiện tập tin xảy ra, thời gian chặn tối đa được xác định bởi timeval được truyền vào</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    aeApiPoll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(timeval)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    ## Xử lý tất cả các sự kiện tập tin đã xảy ra</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    processFileEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    ## Xử lý tất cả các sự kiện thời gian đã đến</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    processTimeEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đặt hàm aeProcessEvents trong một vòng lặp, kèm theo các hàm khởi tạo và dọn dẹp, sẽ tạo thành hàm chính của máy chủ Redis, mã giả như sau:</p><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    ## Khởi tạo máy chủ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    init_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    ## Xử lý sự kiện liên tục cho đến khi máy chủ tắt</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    while</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> server_is_not_shutdown</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        aeProcessEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    ## Máy chủ tắt, thực hiện dọn dẹp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    clean_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span></code></pre></div><h2 id="_6-giao-dich-trong-redis" tabindex="-1"><a class="header-anchor" href="#_6-giao-dich-trong-redis"><span>6. Giao dịch trong Redis</span></a></h2><blockquote><p><strong>Redis không cung cấp giao dịch nghiêm ngặt, Redis chỉ đảm bảo thực hiện các lệnh theo thứ tự và đảm bảo thực hiện tất cả các lệnh, nhưng khi một lệnh thực hiện không thành công, nó sẽ tiếp tục thực hiện các lệnh tiếp theo mà không có quá trình rollback</strong>.</p></blockquote><p><code>MULTI</code>, <code>EXEC</code>, <code>DISCARD</code> và <code>WATCH</code> là các lệnh liên quan đến giao dịch trong Redis.</p><p>Giao dịch cho phép thực hiện nhiều lệnh cùng một lúc và có hai cam kết quan trọng sau:</p><ul><li>Giao dịch là một hoạt động cô lập độc lập: Tất cả các lệnh trong giao dịch sẽ được thực hiện theo thứ tự và tuần tự. Trong quá trình thực hiện giao dịch, nó sẽ không bị gián đoạn bởi các yêu cầu lệnh từ khách hàng khác.</li><li>Giao dịch là một hoạt động nguyên tử: Tất cả các lệnh trong giao dịch sẽ được thực hiện hoặc không được thực hiện.</li></ul><h3 id="multi" tabindex="-1"><a class="header-anchor" href="#multi"><span>MULTI</span></a></h3><p><strong>Lệnh <a href="https://redis.io/commands/multi" target="_blank" rel="noopener noreferrer"><code>MULTI</code></a> được sử dụng để bắt đầu một giao dịch, nó luôn trả về OK.</strong></p><p>Sau khi thực hiện <code>MULTI</code>, khách hàng có thể tiếp tục gửi bất kỳ số lượng lệnh nào đến máy chủ, các lệnh này sẽ không được thực hiện ngay lập tức mà sẽ được đặt vào một hàng đợi. Khi lệnh <code>EXEC</code> được gọi, tất cả các lệnh trong hàng đợi sẽ được thực hiện.</p><p>Dưới đây là một ví dụ về giao dịch, nó tăng giá trị của hai khóa <code>foo</code> và <code>bar</code> một cách nguyên tử:</p><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> MULTI</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">OK</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> INCR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> foo</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">QUEUED</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> INCR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> bar</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">QUEUED</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> EXEC</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) (integer) </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) (integer) </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span></span></code></pre></div><h3 id="exec" tabindex="-1"><a class="header-anchor" href="#exec"><span>EXEC</span></a></h3><p><strong>Lệnh <a href="https://redis.io/commands/exec" target="_blank" rel="noopener noreferrer"><code>EXEC</code></a> được sử dụng để kích hoạt và thực hiện tất cả các lệnh trong giao dịch.</strong></p><ul><li>Nếu khách hàng mở một giao dịch bằng cách sử dụng <code>MULTI</code> nhưng không thực hiện thành công <code>EXEC</code>, tất cả các lệnh trong giao dịch sẽ không được thực hiện.</li><li>Trên một khía cạnh khác, nếu khách hàng thực hiện thành công <code>EXEC</code> sau khi mở giao dịch, tất cả các lệnh trong giao dịch sẽ được thực hiện.</li></ul><h3 id="discard" tabindex="-1"><a class="header-anchor" href="#discard"><span>DISCARD</span></a></h3><p><strong>Khi thực hiện lệnh <a href="https://redis.io/commands/discard" target="_blank" rel="noopener noreferrer"><code>DISCARD</code></a>, giao dịch sẽ bị hủy bỏ, hàng đợi giao dịch sẽ được xóa và khách hàng sẽ thoát khỏi trạng thái giao dịch.</strong></p><p>Ví dụ:</p><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> foo </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">OK</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> MULTI</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">OK</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> INCR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> foo</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">QUEUED</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> DISCARD</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">OK</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> GET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> foo</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1&quot;</span></span></code></pre></div><h3 id="watch" tabindex="-1"><a class="header-anchor" href="#watch"><span>WATCH</span></a></h3><p><strong>Lệnh <a href="https://redis.io/commands/watch" target="_blank" rel="noopener noreferrer"><code>WATCH</code></a> trong Redis cung cấp hành vi check-and-set (CAS) cho giao dịch.</strong></p><p>Các khóa được theo dõi bởi WATCH sẽ được giám sát và phát hiện xem chúng có bị thay đổi không. Nếu ít nhất một khóa được theo dõi đã được thay đổi trước khi EXEC được thực thi, toàn bộ giao dịch sẽ bị hủy bỏ và EXEC sẽ trả về nil-reply để chỉ ra giao dịch đã thất bại.</p><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">WATCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> mykey</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">val </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> GET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> mykey</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">val </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> val </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">MULTI</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> mykey </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">$</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">val</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">EXEC</span></span></code></pre></div><p>Sử dụng mã trên, nếu giá trị của mykey được thay đổi bởi một khách hàng khác sau khi WATCH được thực thi và trước khi EXEC được thực thi, giao dịch của khách hàng hiện tại sẽ thất bại. Chương trình cần làm là lặp lại thao tác này cho đến khi không có xung đột xảy ra.</p><p>Hình thức khóa này được gọi là khóa lạc quan (optimistic lock), đây là một cơ chế khóa rất mạnh mẽ. Và vì hầu hết các khách hàng thường truy cập vào các khóa khác nhau, xung đột xảy ra rất ít, nên thường không cần phải thử lại.</p><p>WATCH yêu cầu EXEC chỉ được thực thi khi tất cả các khóa được giám sát không bị thay đổi. Nếu điều kiện này không được đáp ứng, giao dịch sẽ không được thực thi.</p><p>Lệnh WATCH có thể được gọi nhiều lần. Giám sát các khóa bắt đầu có hiệu lực sau khi WATCH được thực thi và kết thúc khi EXEC được gọi.</p><p>Người dùng cũng có thể giám sát nhiều khóa trong một lệnh WATCH, ví dụ:</p><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">redis</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> WATCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> key1 key2 key3</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">OK</span></span></code></pre></div><h4 id="cac-tinh-huong-huy-watch" tabindex="-1"><a class="header-anchor" href="#cac-tinh-huong-huy-watch"><span>Các tình huống hủy WATCH</span></a></h4><p>Khi EXEC được gọi, giám sát cho tất cả các khóa sẽ bị hủy bỏ, bất kể giao dịch có được thực thi thành công hay không.</p><p>Ngoài ra, khi khách hàng ngắt kết nối, giám sát của khách hàng đối với các khóa cũng sẽ bị hủy bỏ.</p><p>Sử dụng lệnh UNWATCH không có tham số có thể hủy bỏ giám sát cho tất cả các khóa. Đối với một số giao dịch yêu cầu thay đổi nhiều khóa, đôi khi chương trình cần khóa đồng thời nhiều khóa và kiểm tra xem giá trị hiện tại của các khóa đó có đáp ứng yêu cầu của chương trình hay không. Khi giá trị không đáp ứng yêu cầu, có thể sử dụng lệnh UNWATCH để hủy bỏ giám sát hiện tại, từ bỏ giao dịch này và chờ đợi lần thử giao dịch tiếp theo.</p><h4 id="su-dung-watch-đe-tao-thao-tac-nguyen-tu" tabindex="-1"><a class="header-anchor" href="#su-dung-watch-đe-tao-thao-tac-nguyen-tu"><span>Sử dụng WATCH để tạo thao tác nguyên tử</span></a></h4><p>WATCH có thể được sử dụng để tạo ra các thao tác nguyên tử không được tích hợp sẵn trong Redis.</p><p>Ví dụ, đoạn mã sau triển khai lệnh ZPOP tự tạo, nó có thể lấy ra phần tử có điểm số nhỏ nhất trong tập hợp có thứ tự:</p><div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">WATCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> zset</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">element </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> ZRANGE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> zset </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">MULTI</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">ZREM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> zset element</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">EXEC</span></span></code></pre></div><h3 id="rollback" tabindex="-1"><a class="header-anchor" href="#rollback"><span>Rollback</span></a></h3><p><strong>Redis không hỗ trợ rollback</strong>. Lý do Redis không hỗ trợ rollback:</p><ul><li>Lệnh Redis chỉ thất bại do cú pháp sai hoặc lệnh được sử dụng trên loại khóa sai.</li><li>Vì không cần hỗ trợ rollback, nên Redis có thể giữ cho nội bộ đơn giản và nhanh chóng.</li></ul><h2 id="_7-redis-pipeline" tabindex="-1"><a class="header-anchor" href="#_7-redis-pipeline"><span>7. Redis Pipeline</span></a></h2><p>Redis là một dịch vụ TCP dựa trên mô hình C/S và giao thức yêu cầu/phản hồi. Redis hỗ trợ công nghệ Pipeline. Công nghệ Pipeline cho phép gửi yêu cầu theo cách bất đồng bộ, tức là cho phép gửi yêu cầu mới trong khi đáp ứng của yêu cầu cũ vẫn chưa trả về. Phương pháp này có thể cải thiện đáng kể hiệu suất truyền tải.</p><p>Khi cần thực thi một loạt lệnh Redis, nếu thực thi từng lệnh một, rõ ràng là rất không hiệu quả. Để giảm số lần truyền thông và giảm độ trễ, có thể sử dụng chức năng Pipeline của Redis. Chức năng Pipeline của Redis không cung cấp hỗ trợ dòng lệnh, nhưng nó được triển khai trong các phiên bản khách hàng của nhiều ngôn ngữ.</p><p>Lấy ví dụ với Jedis:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Pipeline</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> pipe </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">pipelined</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">multi</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;login:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, token, user);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;recent:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, timestamp, token);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (item </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;viewed:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> token, timestamp, item);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zremrangeByRank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;viewed:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> token, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">26</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zincrby</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;viewed:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">exec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span></code></pre></div><blockquote><p>🔔 Lưu ý: Khi gửi các lệnh bằng Pipeline, Redis Server sẽ đặt một số yêu cầu vào hàng đợi bộ nhớ cache (chiếm bộ nhớ), và sau khi thực thi xong, gửi kết quả một lần duy nhất. Nếu cần gửi một số lượng lớn lệnh, sẽ chiếm nhiều bộ nhớ, do đó nên xử lý theo số lượng hợp lý và chia thành các lô để xử lý.</p></blockquote><h2 id="_8-redis-publish-subscribe" tabindex="-1"><a class="header-anchor" href="#_8-redis-publish-subscribe"><span>8. Redis Publish/Subscribe</span></a></h2><p>Redis cung cấp 5 lệnh Publish/Subscribe:</p><table><thead><tr><th>Lệnh</th><th>Mô tả</th></tr></thead><tbody><tr><td><code>SUBSCRIBE</code></td><td><code>SUBSCRIBE channel [channel …]</code> — Đăng ký các kênh đã chỉ định.</td></tr><tr><td><code>UNSUBSCRIBE</code></td><td><code>UNSUBSCRIBE [channel [channel …]]</code> — Hủy đăng ký các kênh đã chỉ định.</td></tr><tr><td><code>PUBLISH</code></td><td><code>PUBLISH channel message</code> — Gửi tin nhắn đến kênh đã chỉ định.</td></tr><tr><td><code>PSUBSCRIBE</code></td><td><code>PSUBSCRIBE pattern [pattern …]</code> — Đăng ký các kênh phù hợp với mẫu đã chỉ định.</td></tr><tr><td><code>PUNSUBSCRIBE</code></td><td><code>PUNSUBSCRIBE [pattern [pattern …]]</code> — Hủy đăng ký các kênh phù hợp với mẫu đã chỉ định.</td></tr></tbody></table><p>Sau khi người đăng ký đã đăng ký kênh, nhà xuất bản sẽ gửi tin nhắn chuỗi tới kênh và tất cả các người đăng ký sẽ nhận được nó.</p><p>Một khách hàng sử dụng SUBSCRIBE để đăng ký một kênh, các khách hàng khác có thể sử dụng PUBLISH để gửi tin nhắn vào kênh này.</p><p>Mô hình Publish/Subscribe khác với mô hình Observer:</p><ul><li>Trong mô hình Observer, người quan sát và chủ đề đều biết sự tồn tại của nhau; trong khi đó, trong mô hình Publish/Subscribe, người xuất bản và người đăng ký không biết sự tồn tại của nhau, và họ giao tiếp thông qua kênh.</li><li>Mô hình Observer là đồng bộ, khi sự kiện xảy ra, chủ đề sẽ gọi phương thức của người quan sát; trong khi đó, mô hình Publish/Subscribe là bất đồng bộ.</li></ul><hr><p><strong><em>Dưới đây là các tính năng và chức năng của Redis Cluster</em></strong></p><h2 id="_9-redis-replication" tabindex="-1"><a class="header-anchor" href="#_9-redis-replication"><span>9. Redis Replication</span></a></h2><blockquote><p>Các cơ sở dữ liệu quan hệ thường sử dụng một máy chủ chính để gửi cập nhật cho nhiều máy chủ phụ và sử dụng các máy chủ phụ để xử lý các yêu cầu đọc, Redis cũng triển khai tính năng sao chép theo cùng một cách.</p></blockquote><h3 id="sao-chep-cu" tabindex="-1"><a class="header-anchor" href="#sao-chep-cu"><span>Sao chép cũ</span></a></h3><p>Tính năng sao chép Redis trước phiên bản 2.8 dựa trên lệnh <code>SYNC</code>.</p><p>Tính năng sao chép Redis được chia thành hai hoạt động: đồng bộ hóa (sync) và truyền lệnh (command propagate):</p><ul><li><strong>Đồng bộ hóa (sync)</strong> - Được sử dụng để cập nhật trạng thái cơ sở dữ liệu của máy chủ phụ với trạng thái cơ sở dữ liệu hiện tại của máy chủ chính.</li><li><strong>Truyền lệnh (command propagate)</strong> - Khi trạng thái cơ sở dữ liệu của máy chủ chính bị thay đổi, dẫn đến sự không đồng nhất giữa trạng thái cơ sở dữ liệu của máy chủ chính và máy chủ phụ, cho phép máy chủ phụ trở lại trạng thái đồng nhất với máy chủ chính.</li></ul><p>Phương pháp này có nhược điểm: không xử lý hiệu quả trường hợp sao chép sau khi kết nối lại sau khi mất kết nối.</p><h3 id="sao-chep-moi" tabindex="-1"><a class="header-anchor" href="#sao-chep-moi"><span>Sao chép mới</span></a></h3><p>Tính năng sao chép Redis sau phiên bản 2.8 dựa trên lệnh <code>PSYNC</code>. Lệnh <code>PSYNC</code> có hai chế độ: đồng bộ hoàn toàn (full resynchronization) và đồng bộ một phần (partial resynchronization).</p><ul><li><strong>Đồng bộ hoàn toàn (full resynchronization)</strong> - Được sử dụng cho sao chép lần đầu tiên. Các bước thực hiện tương tự như lệnh <code>SYNC</code>.</li><li><strong>Đồng bộ một phần (partial resynchronization)</strong> - Được sử dụng cho sao chép sau khi kết nối lại. <strong>Nếu điều kiện cho phép, máy chủ chính có thể gửi các lệnh ghi đã thực hiện trong thời gian máy chủ phụ bị mất kết nối</strong> và máy chủ phụ chỉ cần nhận và thực hiện các lệnh ghi này để duy trì trạng thái cơ sở dữ liệu giữa máy chủ chính và máy chủ phụ.</li></ul><h3 id="đong-bo-mot-phan" tabindex="-1"><a class="header-anchor" href="#đong-bo-mot-phan"><span>Đồng bộ một phần</span></a></h3><p>Đồng bộ một phần bao gồm ba phần:</p><ul><li><strong>Offset sao chép (replication offset)</strong> của máy chủ chính và máy chủ phụ</li><li><strong>Bộ đệm chờ sao chép (replication backlog)</strong> của máy chủ chính</li><li><strong>ID chạy của máy chủ</strong>.</li></ul><h3 id="lenh-psync" tabindex="-1"><a class="header-anchor" href="#lenh-psync"><span>Lệnh PSYNC</span></a></h3><p>Máy chủ phụ gửi lệnh <code>PSYNC &lt;runid&gt; &lt;offset&gt;</code> đến máy chủ chính để sao chép.</p><ul><li>Nếu <strong>ID chạy của máy chủ chính và máy chủ phụ giống nhau</strong> và <strong>offset được chỉ định nằm trong bộ đệm trong bộ nhớ</strong>, sao chép sẽ tiếp tục từ điểm bị gián đoạn trước đó.</li><li>Nếu một trong hai điều kiện không được đáp ứng, sao chép sẽ được thực hiện lại hoàn toàn.</li></ul><h3 id="kiem-tra-nhip-tim" tabindex="-1"><a class="header-anchor" href="#kiem-tra-nhip-tim"><span>Kiểm tra nhịp tim</span></a></h3><p>Máy chủ chính cập nhật trạng thái máy chủ phụ bằng cách truyền lệnh cho máy chủ phụ. Đồng thời, máy chủ phụ gửi lệnh <code>REPLCONF ACK &lt;replication_offset&gt;</code> để kiểm tra nhịp và kiểm tra lệnh bị mất.</p><p>💡 Để biết thêm chi tiết về các tính năng và nguyên tắc, vui lòng tham khảo: [[Redis Replication]]</p><h2 id="_10-redis-sentinel" tabindex="-1"><a class="header-anchor" href="#_10-redis-sentinel"><span>10. Redis Sentinel</span></a></h2><p>Redis Sentinel (hay còn gọi là Sentinel) có thể theo dõi các máy chủ chính và tự động chọn ra máy chủ chính mới khi máy chủ chính bị offline.</p><p>💡 Để biết thêm chi tiết về các tính năng và nguyên tắc, vui lòng tham khảo: [[Redis Sentinel]]</p><h2 id="_11-redis-cluster" tabindex="-1"><a class="header-anchor" href="#_11-redis-cluster"><span>11. Redis Cluster</span></a></h2><p>Sharding là phương pháp chia dữ liệu thành nhiều phần và lưu trữ dữ liệu trên nhiều máy chủ, cũng như truy xuất dữ liệu từ nhiều máy chủ, phương pháp này có thể cung cấp hiệu suất tuyến tính trong việc giải quyết một số vấn đề.</p><p>Giả sử có 4 phiên bản Redis R0, R1, R2, R3 và nhiều khóa đại diện cho người dùng như user:1, user:2, … và có nhiều cách để chọn một khóa cụ thể để lưu trữ trên máy chủ cụ thể. Cách đơn giản nhất là phân chia theo phạm vi, ví dụ như lưu trữ người dùng có id từ 0 đến 1000 trên phiên bản R0, lưu trữ người dùng có id từ 1001 đến 2000 trên phiên bản R1, và cứ tiếp tục như vậy. Tuy nhiên, điều này đòi hỏi việc duy trì một bảng ánh xạ phạm vi, đòi hỏi công việc duy trì cao. Cách khác là phân chia bằng hàm băm, sử dụng hàm băm CRC32 để chuyển đổi khóa thành một số, sau đó lấy số này chia lấy số dư cho số lượng phiên bản để xác định máy chủ cần lưu trữ.</p><p>Có ba phương pháp chia dữ liệu chính:</p><ul><li>Chia dữ liệu trên máy khách: Máy khách sử dụng thuật toán băm nhất quán để xác định khóa được phân phối đến máy chủ nào.</li><li>Chia dữ liệu qua proxy: Gửi yêu cầu từ máy khách đến proxy, proxy sẽ chuyển tiếp yêu cầu đến máy chủ đúng.</li><li>Chia dữ liệu trên máy chủ: Redis Cluster (giải pháp Redis Cluster chính thức từ Redis).</li></ul><h2 id="_12-redis-client" tabindex="-1"><a class="header-anchor" href="#_12-redis-client"><span>12. Redis Client</span></a></h2><p>Có nhiều loại Redis Client được hỗ trợ trong cộng đồng Redis, bạn có thể tìm kiếm khách hàng phù hợp tại đây: <a href="https://redis.io/docs/clients/" target="_blank" rel="noopener noreferrer">Get started using Redis clients | Redis</a></p><p>Các Redis Client Java được khuyến nghị bởi Redis Official:</p><ul><li><a href="https://github.com/redis/jedis" target="_blank" rel="noopener noreferrer">Jedis</a> - Redis Client Java phổ biến nhất.</li><li><a href="https://github.com/redisson/redisson" target="_blank" rel="noopener noreferrer">Redisson</a> - Cung cấp nhiều tính năng dịch vụ phân tán bổ sung như khóa phân tán, các đối tượng Java phổ biến phân tán (BitSet, BlockingQueue, CountDownLatch, v.v.).</li><li><a href="https://github.com/lettuce-io/lettuce-core" target="_blank" rel="noopener noreferrer">Lettuce</a> - Redis Client mặc định của Spring Boot 2.0.</li></ul></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/database/redis/guide.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/database/redis/overview.html" aria-label="Redis Overview"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon>Redis Overview</div></a><a class="route-link auto-link next" href="/database/redis/basic-data-types.html" aria-label="Redis Basic Data Types"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Redis Basic Data Types<iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with ❤️ by Hung Nguyen</div><div class="copyright">Copyright © 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-B-Bgbu6w.js" defer></script>
  </body>
</html>
