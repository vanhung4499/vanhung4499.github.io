<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/database/elasticsearch/interview.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="Elasticsearch Interview"><meta property="og:description" content="TÃ³m táº¯t phá»ng váº¥n Elasticsearch Triá»ƒn khai cá»¥m Cáº¥u hÃ¬nh triá»ƒn khai ES: 5 nÃºt (cáº¥u hÃ¬nh: 8 nhÃ¢n 64 G 1T), tá»•ng cá»™ng 320 G, 5 T. Khoáº£ng 10+ chá»‰ má»¥c, 5 phÃ¢n Ä‘oáº¡n, lÆ°á»£ng dá»¯ liá»‡u má»›i..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223081955.png"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-06-28T15:54:38.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:tag" content="elasticssearch"><meta property="article:tag" content="interview"><meta property="article:modified_time" content="2024-06-28T15:54:38.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Elasticsearch Interview","image":["https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223081955.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223111949.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/v2-bf18227dc4554da0dcc7b970dbd582ae_720w.jpg","https://raw.githubusercontent.com/vanhung4499/images/master/snap/v2-bf1b23846420eb4fdace5c6415ad7cf2_720w.jpg","https://raw.githubusercontent.com/vanhung4499/images/master/snap/v2-576954e3b238870ec089d68abe0de1d4_720w.jpg","https://raw.githubusercontent.com/vanhung4499/images/master/snap/v2-5e0c4bfbd57a4fae4895c480aaaa0a37_720w.jpg","https://raw.githubusercontent.com/vanhung4499/images/master/snap/v2-4c25616e623de2aee23bd63ec22a5bfd_720w.jpg","https://raw.githubusercontent.com/vanhung4499/images/master/snap/v2-5bdbe7ada0ddee9d8b2f03c0a379e0d4_720w.jpg","https://pic4.zhimg.com/80/v2-26a48882a8f09a50dfeb79cc25045fcf_720w.jpg","https://pic4.zhimg.com/80/v2-66f01f0d578c83274e90a7ddf704b633_720w.jpg","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240224203118.png"],"dateModified":"2024-06-28T15:54:38.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>Elasticsearch Interview | VanHung4499</title><meta name="description" content="TÃ³m táº¯t phá»ng váº¥n Elasticsearch Triá»ƒn khai cá»¥m Cáº¥u hÃ¬nh triá»ƒn khai ES: 5 nÃºt (cáº¥u hÃ¬nh: 8 nhÃ¢n 64 G 1T), tá»•ng cá»™ng 320 G, 5 T. Khoáº£ng 10+ chá»‰ má»¥c, 5 phÃ¢n Ä‘oáº¡n, lÆ°á»£ng dá»¯ liá»‡u má»›i...">
    <link rel="preload" href="/assets/style-DFXXOFfS.css" as="style"><link rel="stylesheet" href="/assets/style-DFXXOFfS.css">
    <link rel="modulepreload" href="/assets/app-CIGQMwlz.js"><link rel="modulepreload" href="/assets/interview.html-zvuVXREa.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon>Project<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/rouyi-vue-pro/" aria-label="Rouyi Vue Pro"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Rouyi Vue Pro<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/yudao-cloud/" aria-label="Yudao Cloud"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Yudao Cloud<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interview/" aria-label="Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:account-tie" width="1em" height="1em"></iconify-icon><!--]-->Interview<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">SQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">MongoDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Elasticsearch</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/overview.html" aria-label="Elasticsearch Overview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Overview<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/quick-start.html" aria-label="Elasticsearch Quick Start"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Quick Start<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/intro.html" aria-label="Elasticsearch Intro"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Intro<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/es-index.html" aria-label="Elasticsearch Index"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Index<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/mapping.html" aria-label="Elasticsearch Mapping"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Mapping<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/highlight-search-display.html" aria-label="Elasticsearch Highlight Search and Display"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Highlight Search and Display<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/query.html" aria-label="Elasticsearch Query"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Query<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/sorting.html" aria-label="Elasticsearch Sorting"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Sorting<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/aggregation.html" aria-label="Elasticsearch Aggregation"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Aggregation<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/analyzer.html" aria-label="Elasticsearch Analyzer"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Analyzer<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/optimization.html" aria-label="Elasticsearch performance optimization"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch performance optimization<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/rest-api.html" aria-label="Elasticsearch REST API"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch REST API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/cluster-shard.html" aria-label="Elasticsearch Cluster and Shard"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Cluster and Shard<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/operation.html" aria-label="Elasticsearch Operation"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Operation<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/database/elasticsearch/interview.html" aria-label="Elasticsearch Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Interview<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Elastic Stack</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon>Elasticsearch Interview</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing DateğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-28T15:54:38.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 48 min</span><meta property="timeRequired" content="PT48M"></span><span class="page-category-info" aria-label="CategoryğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color4 clickable" role="navigation">elasticssearch</span><!--]--><meta property="articleSection" content="elasticssearch"></span><span class="page-tag-info" aria-label="TagğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color4 clickable" role="navigation">elasticssearch</span><span class="page-tag-item color4 clickable" role="navigation">interview</span><!--]--><meta property="keywords" content="elasticssearch,interview"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#trien-khai-cum">Triá»ƒn khai cá»¥m</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#toi-uu-hoa-hieu-suat">Tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#filesystem-cache">filesystem cache</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#du-lieu-khoi-Ä‘ong">Dá»¯ liá»‡u khá»Ÿi Ä‘á»™ng</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#phan-tach-nong-va-lanh">PhÃ¢n tÃ¡ch nÃ³ng vÃ  láº¡nh</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#thiet-ke-mo-hinh-document">Thiáº¿t káº¿ mÃ´ hÃ¬nh document</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-hoa-hieu-suat-phan-trang">Tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t phÃ¢n trang</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#nguyen-ly-hoat-Ä‘ong">NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#qua-trinh-ghi-du-lieu-es">QuÃ¡ trÃ¬nh ghi dá»¯ liá»‡u es</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#qua-trinh-Ä‘oc-du-lieu-es">QuÃ¡ trÃ¬nh Ä‘á»c dá»¯ liá»‡u es</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#qua-trinh-tim-kiem-du-lieu-trong-es">QuÃ¡ trÃ¬nh tÃ¬m kiáº¿m dá»¯ liá»‡u trong ES</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nguyen-ly-co-ban-khi-ghi-du-lieu">NguyÃªn lÃ½ cÆ¡ báº£n khi ghi dá»¯ liá»‡u</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nguyen-ly-co-ban-khi-xoa-cap-nhat-du-lieu">NguyÃªn lÃ½ cÆ¡ báº£n khi xÃ³a/cáº­p nháº­t dá»¯ liá»‡u</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#lop-co-ban-lucene">Lá»›p cÆ¡ báº£n Lucene</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chi-muc-Ä‘ao-nguoc">Chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#chi-muc-Ä‘ao-nguoc-trong-elasticsearch-la-gi">Chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c trong Elasticsearch lÃ  gÃ¬?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_3-elasticsearch-co-qua-nhieu-du-lieu-chi-muc-thi-phai-lam-sao-can-toi-uu-nhu-the-nao-trien-khai-nhu-the-nao">3. Elasticsearch cÃ³ quÃ¡ nhiá»u dá»¯ liá»‡u chá»‰ má»¥c thÃ¬ pháº£i lÃ m sao, cáº§n tá»‘i Æ°u nhÆ° tháº¿ nÃ o, triá»ƒn khai nhÆ° tháº¿ nÃ o?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_4-elasticsearch-thuc-hien-viec-bau-chon-master-nhu-the-nao">4. Elasticsearch thá»±c hiá»‡n viá»‡c báº§u chá»n master nhÆ° tháº¿ nÃ o</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#hay-mo-ta-chi-tiet-qua-trinh-elasticsearch-lap-chi-muc-cho-mot-tai-lieu">HÃ£y mÃ´ táº£ chi tiáº¿t quÃ¡ trÃ¬nh Elasticsearch láº­p chá»‰ má»¥c cho má»™t tÃ i liá»‡u</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#hay-mo-ta-chi-tiet-qua-trinh-tim-kiem-cua-elasticsearch">HÃ£y mÃ´ táº£ chi tiáº¿t quÃ¡ trÃ¬nh tÃ¬m kiáº¿m cá»§a Elasticsearch?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#khi-trien-khai-elasticsearch-co-nhung-phuong-phap-toi-uu-hoa-nao-Ä‘oi-voi-linux">Khi triá»ƒn khai Elasticsearch, cÃ³ nhá»¯ng phÆ°Æ¡ng phÃ¡p tá»‘i Æ°u hÃ³a nÃ o Ä‘á»‘i vá»›i Linux?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cau-truc-ben-trong-cua-lucene-la-gi">Cáº¥u trÃºc bÃªn trong cá»§a Lucene lÃ  gÃ¬?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#elasticsearch-lam-the-nao-Ä‘e-thuc-hien-viec-bau-chon-master">Elasticsearch lÃ m tháº¿ nÃ o Ä‘á»ƒ thá»±c hiá»‡n viá»‡c báº§u chá»n Master?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_10-trong-elasticsearch-co-cac-nut-vi-du-tong-cong-20-nut-trong-Ä‘o-10-nut-Ä‘a-chon-mot-master-10-nut-con-lai-Ä‘a-chon-mot-master-khac-thi-phai-lam-the-nao">10. Trong Elasticsearch cÃ³ cÃ¡c nÃºt (vÃ­ dá»¥ tá»•ng cá»™ng 20 nÃºt), trong Ä‘Ã³ 10 nÃºt Ä‘Ã£ chá»n má»™t Master, 10 nÃºt cÃ²n láº¡i Ä‘Ã£ chá»n má»™t Master khÃ¡c, thÃ¬ pháº£i lÃ m tháº¿ nÃ o?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#khi-ket-noi-voi-cum-khach-hang-chon-nut-cu-the-nao-Ä‘e-thuc-hien-yeu-cau">Khi káº¿t ná»‘i vá»›i cá»¥m, khÃ¡ch hÃ ng chá»n nÃºt cá»¥ thá»ƒ nÃ o Ä‘á»ƒ thá»±c hiá»‡n yÃªu cáº§u?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#mo-ta-chi-tiet-qua-trinh-elasticsearch-lap-chi-muc-cho-tai-lieu">MÃ´ táº£ chi tiáº¿t quÃ¡ trÃ¬nh Elasticsearch láº­p chá»‰ má»¥c cho tÃ i liá»‡u.</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#mo-ta-chi-tiet-qua-trinh-elasticsearch-cap-nhat-va-xoa-tai-lieu">MÃ´ táº£ chi tiáº¿t quÃ¡ trÃ¬nh Elasticsearch cáº­p nháº­t vÃ  xÃ³a tÃ i liá»‡u.</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#mo-ta-chi-tiet-qua-trinh-tim-kiem-cua-elasticsearch">MÃ´ táº£ chi tiáº¿t quÃ¡ trÃ¬nh tÃ¬m kiáº¿m cá»§a Elasticsearch.</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#trong-elasticsearch-lam-the-nao-Ä‘e-tim-thay-chi-muc-nghich-Ä‘ao-tuong-ung-voi-mot-tu">Trong Elasticsearch, lÃ m tháº¿ nÃ o Ä‘á»ƒ tÃ¬m tháº¥y chá»‰ má»¥c nghá»‹ch Ä‘áº£o tÆ°Æ¡ng á»©ng vá»›i má»™t tá»«?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#khi-trien-khai-elasticsearch-phuong-phap-toi-uu-hoa-nao-co-the-ap-dung-cho-linux">Khi triá»ƒn khai Elasticsearch, phÆ°Æ¡ng phÃ¡p tá»‘i Æ°u hÃ³a nÃ o cÃ³ thá»ƒ Ã¡p dá»¥ng cho Linux?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#Ä‘oi-voi-gc-Ä‘ieu-gi-can-chu-y-khi-su-dung-elasticsearch">Äá»‘i vá»›i GC, Ä‘iá»u gÃ¬ cáº§n chÃº Ã½ khi sá»­ dá»¥ng Elasticsearch?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_18-elasticsearch-lam-the-nao-Ä‘e-thuc-hien-tong-hop-so-luong-lon-du-lieu-hang-ty">18. Elasticsearch lÃ m tháº¿ nÃ o Ä‘á»ƒ thá»±c hiá»‡n tá»•ng há»£p sá»‘ lÆ°á»£ng lá»›n dá»¯ liá»‡u (hÃ ng tá»·)?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_19-trong-tinh-huong-Ä‘ong-thoi-elasticsearch-lam-the-nao-Ä‘e-Ä‘am-bao-tinh-nhat-quan-cua-Ä‘oc-va-ghi">19. Trong tÃ¬nh huá»‘ng Ä‘á»“ng thá»i, Elasticsearch lÃ m tháº¿ nÃ o Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n cá»§a Ä‘á»c vÃ  ghi?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_20-lam-the-nao-Ä‘e-giam-sat-trang-thai-cua-cum-elasticsearch">20. LÃ m tháº¿ nÃ o Ä‘á»ƒ giÃ¡m sÃ¡t tráº¡ng thÃ¡i cá»§a cá»¥m Elasticsearch?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#_21-hay-gioi-thieu-ve-kien-truc-cong-nghe-tong-the-cua-tim-kiem-thuong-mai-Ä‘ien-tu-cua-ban">21. HÃ£y giá»›i thiá»‡u vá» kiáº¿n trÃºc cÃ´ng nghá»‡ tá»•ng thá»ƒ cá»§a tÃ¬m kiáº¿m thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ cá»§a báº¡n.</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#hay-gioi-thieu-ve-giai-phap-tim-kiem-ca-nhan-hoa-cua-ban">HÃ£y giá»›i thiá»‡u vá» giáº£i phÃ¡p tÃ¬m kiáº¿m cÃ¡ nhÃ¢n hÃ³a cá»§a báº¡n?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ban-co-biet-ve-trie-cay-tu-Ä‘ien-khong">Báº¡n cÃ³ biáº¿t vá» Trie (cÃ¢y tá»« Ä‘iá»ƒn) khÃ´ng?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#lam-the-nao-Ä‘e-thuc-hien-sua-loi-chinh-ta">LÃ m tháº¿ nÃ o Ä‘á»ƒ thá»±c hiá»‡n sá»­a lá»—i chÃ­nh táº£?</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="tom-tat-phong-van-elasticsearch" tabindex="-1"><a class="header-anchor" href="#tom-tat-phong-van-elasticsearch"><span>TÃ³m táº¯t phá»ng váº¥n Elasticsearch</span></a></h1><h2 id="trien-khai-cum" tabindex="-1"><a class="header-anchor" href="#trien-khai-cum"><span>Triá»ƒn khai cá»¥m</span></a></h2><p>Cáº¥u hÃ¬nh triá»ƒn khai ES:</p><p>5 nÃºt (cáº¥u hÃ¬nh: 8 nhÃ¢n 64 G 1T), tá»•ng cá»™ng 320 G, 5 T.</p><p>Khoáº£ng 10+ chá»‰ má»¥c, 5 phÃ¢n Ä‘oáº¡n, lÆ°á»£ng dá»¯ liá»‡u má»›i hÃ ng ngÃ y lÃ  khoáº£ng 2G, 40 triá»‡u báº£n ghi. Báº£n ghi Ä‘Æ°á»£c lÆ°u trá»¯ trong 30 ngÃ y.</p><h2 id="toi-uu-hoa-hieu-suat" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-hieu-suat"><span>Tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t</span></a></h2><h3 id="filesystem-cache" tabindex="-1"><a class="header-anchor" href="#filesystem-cache"><span>filesystem cache</span></a></h3><p>Dá»¯ liá»‡u báº¡n ghi vÃ o es, thá»±c táº¿ Ä‘Ã£ Ä‘Æ°á»£c ghi vÃ o tá»‡p trÃªn Ä‘Ä©a,Â <strong>khi truy váº¥n</strong>, há»‡ Ä‘iá»u hÃ nh sáº½ tá»± Ä‘á»™ng lÆ°u trá»¯ dá»¯ liá»‡u tá»« tá»‡p trÃªn Ä‘Ä©a vÃ oÂ <code>filesystem cache</code>.</p><p><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223081955.png" alt="image.png" loading="lazy"><br> CÆ¡ cháº¿ tÃ¬m kiáº¿m cá»§a es phá»¥ thuá»™c náº·ng ná» vÃ oÂ <code>filesystem cache</code>Â cÆ¡ sá»Ÿ. Náº¿u báº¡n cung cáº¥p thÃªm bá»™ nhá»› choÂ <code>filesystem cache</code>, cá»‘ gáº¯ng Ä‘á»ƒ bá»™ nhá»› cÃ³ thá»ƒ chá»©a táº¥t cáº£ cÃ¡c tá»‡p dá»¯ liá»‡u chá»‰ má»¥cÂ <code>idx segment file</code>, thÃ¬ khi báº¡n tÃ¬m kiáº¿m, háº§u nhÆ° táº¥t cáº£ cÃ¡c hoáº¡t Ä‘á»™ng Ä‘á»u Ä‘i qua bá»™ nhá»›, hiá»‡u suáº¥t sáº½ ráº¥t cao.</p><p>Hiá»‡u suáº¥t cÃ³ thá»ƒ chÃªnh lá»‡ch Ä‘áº¿n má»©c Ä‘á»™ nÃ o? Trong nhiá»u thá»­ nghiá»‡m vÃ  kiá»ƒm tra Ã¡p lá»±c cá»§a chÃºng tÃ´i trÆ°á»›c Ä‘Ã¢y, náº¿u Ä‘i qua Ä‘Ä©a, thÃ¬ thá»i gian tÃ¬m kiáº¿m cháº¯c cháº¯n lÃ  á»Ÿ má»©c giÃ¢y, tá»« 1 giÃ¢y, 5 giÃ¢y Ä‘áº¿n 10 giÃ¢y. NhÆ°ng náº¿u Ä‘i quaÂ <code>filesystem cache</code>, nghÄ©a lÃ  Ä‘i qua bá»™ nhá»› thuáº§n tÃºy, thÃ¬ hiá»‡u suáº¥t thÆ°á»ng cao hÆ¡n má»™t báº­c so vá»›i viá»‡c Ä‘i qua Ä‘Ä©a, cÆ¡ báº£n lÃ  á»Ÿ má»©c mili giÃ¢y, tá»« vÃ i mili giÃ¢y Ä‘áº¿n vÃ i trÄƒm mili giÃ¢y.</p><p>á» Ä‘Ã¢y cÃ³ má»™t vÃ­ dá»¥ thá»±c táº¿. Má»™t cÃ´ng ty cÃ³ 3 mÃ¡y chá»§ es, má»—i mÃ¡y chá»§ cÃ³ váº» nhÆ° cÃ³ nhiá»u bá»™ nhá»›, 64G, tá»•ng bá»™ nhá»› lÃ Â <code>64 * 3 = 192G</code>. Má»—i mÃ¡y chá»§ cung cáº¥p cho es jvm heap lÃ Â <code>32G</code>, vÃ¬ váº­y pháº§n cÃ²n láº¡i choÂ <code>filesystem cache</code>Â chá»‰ lÃ Â <code>32G</code>Â má»—i mÃ¡y, tá»•ng cá»™ng trong cá»¥m, choÂ <code>filesystem cache</code>Â chá»‰ lÃ Â <code>32 * 3 = 96G</code>Â bá»™ nhá»›. Tuy nhiÃªn, vÃ o thá»i Ä‘iá»ƒm Ä‘Ã³, táº¥t cáº£ cÃ¡c tá»‡p dá»¯ liá»‡u chá»‰ má»¥c trÃªn Ä‘Ä©a, trÃªn 3 mÃ¡y, tá»•ng cá»™ng chiáº¿mÂ <code>1T</code>Â dung lÆ°á»£ng Ä‘Ä©a, lÆ°á»£ng dá»¯ liá»‡u es lÃ Â <code>1T</code>, vÃ¬ váº­y lÆ°á»£ng dá»¯ liá»‡u má»—i mÃ¡y lÃ Â <code>300G</code>. Hiá»‡u suáº¥t tá»‘t khÃ´ng? Bá»™ nhá»›Â <code>filesystem cache</code>Â chá»‰ cÃ³ 100G, chá»‰ má»™t pháº§n mÆ°á»i dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘áº·t trong bá»™ nhá»›, pháº§n cÃ²n láº¡i Ä‘á»u á»Ÿ trÃªn Ä‘Ä©a, sau Ä‘Ã³ báº¡n thá»±c hiá»‡n hoáº¡t Ä‘á»™ng tÃ¬m kiáº¿m, háº§u háº¿t cÃ¡c hoáº¡t Ä‘á»™ng Ä‘á»u Ä‘i qua Ä‘Ä©a, hiá»‡u suáº¥t cháº¯c cháº¯n sáº½ kÃ©m.</p><p>Vá» cÆ¡ báº£n, náº¿u báº¡n muá»‘n es hoáº¡t Ä‘á»™ng tá»‘t, trÆ°á»ng há»£p tá»‘t nháº¥t lÃ  bá»™ nhá»› mÃ¡y cá»§a báº¡n cÃ³ thá»ƒ chá»©a Ã­t nháº¥t má»™t ná»­a tá»•ng lÆ°á»£ng dá»¯ liá»‡u cá»§a báº¡n.</p><p>Dá»±a trÃªn kinh nghiá»‡m thá»±c táº¿ trong mÃ´i trÆ°á»ng product cá»§a chÃºng tÃ´i, trÆ°á»ng há»£p tá»‘t nháº¥t lÃ  chá»‰ lÆ°u trá»¯ má»™t lÆ°á»£ng dá»¯ liá»‡u nhá» trong es, chá»‰ lÃ  nhá»¯ng chá»‰ má»¥c mÃ  báº¡n cáº§nÂ <strong>tÃ¬m kiáº¿m</strong>, náº¿u bá»™ nhá»› dÃ nh choÂ <code>filesystem cache</code>Â lÃ  100G, thÃ¬ báº¡n nÃªn kiá»ƒm soÃ¡t lÆ°á»£ng dá»¯ liá»‡u chá»‰ má»¥c dÆ°á»›iÂ <code>100G</code>. Trong trÆ°á»ng há»£p nÃ y, háº§u háº¿t dá»¯ liá»‡u cá»§a báº¡n Ä‘á»u Ä‘i qua bá»™ nhá»› Ä‘á»ƒ tÃ¬m kiáº¿m, hiá»‡u suáº¥t ráº¥t cao, thÆ°á»ng cÃ³ thá»ƒ trong vÃ²ng 1 giÃ¢y.</p><p>VÃ­ dá»¥, báº¡n hiá»‡n cÃ³ má»™t hÃ ng dá»¯ liá»‡u.Â <code>id, name, age â€¦.</code>Â 30 trÆ°á»ng. NhÆ°ng bÃ¢y giá», báº¡n chá»‰ cáº§n tÃ¬m kiáº¿m dá»±a trÃªn ba trÆ°á»ngÂ <code>id, name, age</code>. Náº¿u báº¡n ngÃ¢y thÆ¡ ghi táº¥t cáº£ cÃ¡c trÆ°á»ng cá»§a má»™t hÃ ng dá»¯ liá»‡u vÃ o es, Ä‘iá»u nÃ y sáº½ dáº«n Ä‘áº¿n viá»‡cÂ <code>90%</code>Â dá»¯ liá»‡u khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ tÃ¬m kiáº¿m, nhÆ°ng váº«n chiáº¿m khÃ´ng gianÂ <code>filesystem cache</code>Â trÃªn mÃ¡y chá»§ es, dá»¯ liá»‡u má»—i hÃ ng cÃ ng lá»›n,Â <code>filesystem cache</code>Â cÃ³ thá»ƒ lÆ°u trá»¯ cÃ ng Ã­t dá»¯ liá»‡u. Thá»±c táº¿, chá»‰ cáº§n ghi vÃ o esÂ <strong>má»™t sá»‘ trÆ°á»ng Ã­t</strong>Â cáº§n tÃ¬m kiáº¿m, vÃ­ dá»¥, chá»‰ cáº§n ghi vÃ o esÂ <code>id, name, age</code>Â ba trÆ°á»ng, sau Ä‘Ã³ báº¡n cÃ³ thá»ƒ lÆ°u trá»¯ dá»¯ liá»‡u trÆ°á»ng khÃ¡c trong mysql/hbase, chÃºng tÃ´i thÆ°á»ng khuyáº¿n nghá»‹ sá»­ dá»¥ng cáº¥u trÃºcÂ <code>es + hbase</code>.</p><p>Äáº·c Ä‘iá»ƒm cá»§a hbase lÃ Â <strong>phÃ¹ há»£p cho viá»‡c lÆ°u trá»¯ dá»¯ liá»‡u trá»±c tuyáº¿n lá»›n</strong>, tá»©c lÃ  hbase cÃ³ thá»ƒ ghi vÃ o dá»¯ liá»‡u lá»›n, nhÆ°ng khÃ´ng nÃªn thá»±c hiá»‡n tÃ¬m kiáº¿m phá»©c táº¡p, chá»‰ cáº§n thá»±c hiá»‡n má»™t sá»‘ hoáº¡t Ä‘á»™ng Ä‘Æ¡n giáº£n dá»±a trÃªn id hoáº·c pháº¡m vi. TÃ¬m kiáº¿m tá»« es dá»±a trÃªn tÃªn vÃ  tuá»•i, káº¿t quáº£ cÃ³ thá»ƒ chá»‰ lÃ  20Â <code>doc id</code>, sau Ä‘Ã³ tÃ¬m kiáº¿mÂ <strong>dá»¯ liá»‡u Ä‘áº§y Ä‘á»§</strong>Â tÆ°Æ¡ng á»©ng vá»›i má»—iÂ <code>doc id</code>Â tá»« hbase, Ä‘Æ°a ra, sau Ä‘Ã³ tráº£ vá» cho phÃ­a trÆ°á»›c.</p><p>Dá»¯ liá»‡u ghi vÃ o es nÃªn nhá» hÆ¡n hoáº·c báº±ng, hoáº·c hÆ¡i lá»›n hÆ¡n dung lÆ°á»£ng bá»™ nhá»› cá»§a filesystem cache cá»§a es. Sau Ä‘Ã³, báº¡n cÃ³ thá»ƒ máº¥t 20ms Ä‘á»ƒ tÃ¬m kiáº¿m tá»« es, sau Ä‘Ã³ tÃ¬m kiáº¿m tá»« hbase dá»±a trÃªn id Ä‘Æ°á»£c tráº£ vá» tá»« es, tÃ¬m kiáº¿m 20 báº£n ghi, cÃ³ thá»ƒ máº¥t thÃªm 30ms, cÃ³ thá»ƒ báº¡n Ä‘Ã£ chÆ¡i nhÆ° váº­y trÆ°á»›c Ä‘Ã¢y, 1T dá»¯ liá»‡u Ä‘á»u Ä‘áº·t trong es, má»—i truy váº¥n Ä‘á»u máº¥t 5~10s, bÃ¢y giá» cÃ³ thá»ƒ hiá»‡u suáº¥t sáº½ cao hÆ¡n, má»—i truy váº¥n chá»‰ máº¥t 50ms.</p><h3 id="du-lieu-khoi-Ä‘ong" tabindex="-1"><a class="header-anchor" href="#du-lieu-khoi-Ä‘ong"><span>Dá»¯ liá»‡u khá»Ÿi Ä‘á»™ng</span></a></h3><p>Giáº£ sá»­, ngay cáº£ khi báº¡n lÃ m theo phÆ°Æ¡ng Ã¡n Ä‘Ã£ nÃªu á»Ÿ trÃªn, lÆ°á»£ng dá»¯ liá»‡u Ä‘Æ°á»£c ghi vÃ o má»—i mÃ¡y trong cá»¥m es váº«n vÆ°á»£t quÃ¡ gáº¥p Ä‘Ã´iÂ <code>filesystem cache</code>, vÃ­ dá»¥, báº¡n ghi 60G dá»¯ liá»‡u vÃ o má»™t mÃ¡y, nhÆ°ngÂ <code>filesystem cache</code>Â chá»‰ cÃ³ 30G, váº«n cÃ²n 30G dá»¯ liá»‡u á»Ÿ trÃªn Ä‘Ä©a.</p><p>Thá»±c táº¿, báº¡n cÃ³ thá»ƒ thá»±c hiá»‡nÂ <strong>khá»Ÿi Ä‘á»™ng dá»¯ liá»‡u</strong>.</p><p>VÃ­ dá»¥, náº¿u báº¡n nÃ³i vá» Weibo, báº¡n cÃ³ thá»ƒ láº¥y má»™t sá»‘ dá»¯ liá»‡u tá»« cÃ¡c ngÆ°á»i dÃ¹ng VIP, nhá»¯ng ngÆ°á»i thÆ°á»ng xuyÃªn Ä‘Æ°á»£c xem nhiá»u, báº¡n tá»± táº¡o má»™t há»‡ thá»‘ng phÃ­a sau, sau má»—i má»™t thá»i gian, há»‡ thá»‘ng phÃ­a sau cá»§a báº¡n sáº½ tÃ¬m kiáº¿m dá»¯ liá»‡u nÃ³ng, vÃ  Ä‘áº©y vÃ oÂ <code>filesystem cache</code>, sau Ä‘Ã³, khi ngÆ°á»i dÃ¹ng thá»±c sá»± Ä‘áº¿n xem dá»¯ liá»‡u nÃ³ng nÃ y, há» sáº½ trá»±c tiáº¿p tÃ¬m kiáº¿m tá»« bá»™ nhá»›, ráº¥t nhanh.</p><p>Hoáº·c lÃ  thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­, báº¡n cÃ³ thá»ƒ láº¥y má»™t sá»‘ sáº£n pháº©m Ä‘Æ°á»£c xem nhiá»u nháº¥t thÆ°á»ng xuyÃªn, cháº³ng háº¡n nhÆ° iPhone 15, dá»¯ liá»‡u nÃ³ng Ä‘Æ°á»£c táº¡o trÆ°á»›c báº±ng má»™t chÆ°Æ¡ng trÃ¬nh phÃ­a sau, sau má»—i phÃºt, báº¡n tá»± Ä‘á»™ng truy cáº­p má»™t láº§n, vÃ  Ä‘áº©y vÃ oÂ <code>filesystem cache</code>.</p><p>Äá»‘i vá»›i nhá»¯ng dá»¯ liá»‡u mÃ  báº¡n cho lÃ  nÃ³ng, vÃ  thÆ°á»ng xuyÃªn cÃ³ ngÆ°á»i truy cáº­p, nÃªnÂ <strong>táº¡o má»™t há»‡ thá»‘ng khá»Ÿi Ä‘á»™ng bá»™ Ä‘á»‡m chuyÃªn dá»¥ng</strong>, tá»©c lÃ , sau má»—i má»™t khoáº£ng thá»i gian, truy cáº­p trÆ°á»›c vÃ o dá»¯ liá»‡u nÃ³ng, Ä‘á»ƒ dá»¯ liá»‡u vÃ oÂ <code>filesystem cache</code>. NhÆ° váº­y, khi ngÆ°á»i khÃ¡c truy cáº­p láº§n sau, hiá»‡u suáº¥t cháº¯c cháº¯n sáº½ tá»‘t hÆ¡n nhiá»u.</p><h3 id="phan-tach-nong-va-lanh" tabindex="-1"><a class="header-anchor" href="#phan-tach-nong-va-lanh"><span>PhÃ¢n tÃ¡ch nÃ³ng vÃ  láº¡nh</span></a></h3><p>es cÃ³ thá»ƒ thá»±c hiá»‡n viá»‡c phÃ¢n tÃ¡ch ngang tÆ°Æ¡ng tá»± nhÆ° mysql, tá»©c lÃ , Ä‘áº·t má»™t lÆ°á»£ng lá»›n dá»¯ liá»‡u Ã­t Ä‘Æ°á»£c truy cáº­p, táº§n suáº¥t tháº¥p vÃ o má»™t chá»‰ má»¥c riÃªng biá»‡t, sau Ä‘Ã³ Ä‘áº·t dá»¯ liá»‡u nÃ³ng Ä‘Æ°á»£c truy cáº­p thÆ°á»ng xuyÃªn vÃ o má»™t chá»‰ má»¥c riÃªng biá»‡t. Tá»‘t nháº¥t lÃ  Ä‘áº·tÂ <strong>dá»¯ liá»‡u láº¡nh vÃ o má»™t chá»‰ má»¥c, sau Ä‘Ã³ Ä‘áº·t dá»¯ liá»‡u nÃ³ng vÃ o má»™t chá»‰ má»¥c khÃ¡c</strong>, Ä‘iá»u nÃ y cÃ³ thá»ƒ Ä‘áº£m báº£o ráº±ng sau khi dá»¯ liá»‡u nÃ³ng Ä‘Æ°á»£c khá»Ÿi Ä‘á»™ng, hÃ£y Ä‘á»ƒ chÃºng á»Ÿ trongÂ <code>filesystem os cache</code>Â cÃ ng nhiá»u cÃ ng tá»‘t,Â <strong>Ä‘á»«ng Ä‘á»ƒ dá»¯ liá»‡u láº¡nh xÃ³a bá» chÃºng</strong>.</p><p>Báº¡n xem, giáº£ sá»­ báº¡n cÃ³ 6 mÃ¡y, 2 chá»‰ má»¥c, má»™t cho dá»¯ liá»‡u láº¡nh, má»™t cho dá»¯ liá»‡u nÃ³ng, má»—i chá»‰ má»¥c cÃ³ 3 shard. 3 mÃ¡y Ä‘áº·t chá»‰ má»¥c dá»¯ liá»‡u nÃ³ng, 3 mÃ¡y khÃ¡c Ä‘áº·t chá»‰ má»¥c dá»¯ liá»‡u láº¡nh. Sau Ä‘Ã³, báº¡n sáº½ dÃ nh nhiá»u thá»i gian truy cáº­p vÃ o chá»‰ má»¥c dá»¯ liá»‡u nÃ³ng, dá»¯ liá»‡u nÃ³ng cÃ³ thá»ƒ chiáº¿m 10% tá»•ng lÆ°á»£ng dá»¯ liá»‡u, lÃºc nÃ y lÆ°á»£ng dá»¯ liá»‡u ráº¥t nhá», gáº§n nhÆ° táº¥t cáº£ Ä‘á»u Ä‘Æ°á»£c giá»¯ trongÂ <code>filesystem cache</code>, Ä‘iá»u nÃ y cÃ³ thá»ƒ Ä‘áº£m báº£o ráº±ng hiá»‡u suáº¥t truy cáº­p dá»¯ liá»‡u nÃ³ng ráº¥t cao. NhÆ°ng Ä‘á»‘i vá»›i dá»¯ liá»‡u láº¡nh, nÃ³ náº±m trong má»™t chá»‰ má»¥c khÃ¡c, khÃ´ng á»Ÿ cÃ¹ng mÃ¡y vá»›i chá»‰ má»¥c dá»¯ liá»‡u nÃ³ng, khÃ´ng cÃ³ liÃªn há»‡ gÃ¬ vá»›i nhau. Náº¿u cÃ³ ngÆ°á»i truy cáº­p dá»¯ liá»‡u láº¡nh, cÃ³ thá»ƒ nhiá»u dá»¯ liá»‡u Ä‘ang á»Ÿ trÃªn Ä‘Ä©a, lÃºc nÃ y hiá»‡u suáº¥t sáº½ kÃ©m má»™t chÃºt, chá»‰ cÃ³ 10% ngÆ°á»i truy cáº­p dá»¯ liá»‡u láº¡nh, 90% ngÆ°á»i Ä‘ang truy cáº­p dá»¯ liá»‡u nÃ³ng, khÃ´ng sao cáº£.</p><h3 id="thiet-ke-mo-hinh-document" tabindex="-1"><a class="header-anchor" href="#thiet-ke-mo-hinh-document"><span>Thiáº¿t káº¿ mÃ´ hÃ¬nh document</span></a></h3><p>Äá»‘i vá»›i MySQL, chÃºng ta thÆ°á»ng xuyÃªn cÃ³ má»™t sá»‘ truy váº¥n liÃªn káº¿t phá»©c táº¡p. Trong es, chÃºng ta nÃªn xá»­ lÃ½ nhÆ° tháº¿ nÃ o, truy váº¥n liÃªn káº¿t phá»©c táº¡p trong es nÃªn trÃ¡nh sá»­ dá»¥ng cÃ ng nhiá»u cÃ ng tá»‘t, má»™t khi sá»­ dá»¥ng, hiá»‡u suáº¥t thÆ°á»ng khÃ´ng tá»‘t.</p><p>Tá»‘t nháº¥t lÃ  hoÃ n thÃ nh liÃªn káº¿t trÆ°á»›c trong há»‡ thá»‘ng Java, vÃ  ghi dá»¯ liá»‡u Ä‘Ã£ liÃªn káº¿t trá»±c tiáº¿p vÃ o es. Khi tÃ¬m kiáº¿m, khÃ´ng cáº§n sá»­ dá»¥ng cÃº phÃ¡p tÃ¬m kiáº¿m cá»§a es Ä‘á»ƒ hoÃ n thÃ nh truy váº¥n liÃªn káº¿t nhÆ° join.</p><p>Thiáº¿t káº¿ mÃ´ hÃ¬nh document ráº¥t quan trá»ng, nhiá»u hoáº¡t Ä‘á»™ng, khÃ´ng nÃªn chá» Ä‘áº¿n khi tÃ¬m kiáº¿m má»›i thá»±c hiá»‡n cÃ¡c hoáº¡t Ä‘á»™ng phá»©c táº¡p khÃ¡c nhau. es há»— trá»£ ráº¥t nhiá»u hoáº¡t Ä‘á»™ng, khÃ´ng nÃªn cá»‘ gáº¯ng sá»­ dá»¥ng es Ä‘á»ƒ thá»±c hiá»‡n má»™t sá»‘ thao tÃ¡c mÃ  nÃ³ khÃ´ng lÃ m tá»‘t. Náº¿u thá»±c sá»± cÃ³ thao tÃ¡c nhÆ° váº­y, hÃ£y cá»‘ gáº¯ng hoÃ n thÃ nh nÃ³ khi thiáº¿t káº¿ mÃ´ hÃ¬nh document, khi ghi dá»¯ liá»‡u. NgoÃ i ra, Ä‘á»‘i vá»›i má»™t sá»‘ hoáº¡t Ä‘á»™ng quÃ¡ phá»©c táº¡p, nhÆ° join/nested/parent-child tÃ¬m kiáº¿m nÃªn trÃ¡nh cÃ ng nhiá»u cÃ ng tá»‘t, hiá»‡u suáº¥t Ä‘á»u ráº¥t kÃ©m.</p><h3 id="toi-uu-hoa-hieu-suat-phan-trang" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-hieu-suat-phan-trang"><span>Tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t phÃ¢n trang</span></a></h3><p>PhÃ¢n trang cá»§a es khÃ¡ khÃ³ khÄƒn, táº¡i sao? VÃ­ dá»¥, giáº£ sá»­ báº¡n cÃ³ 10 báº£n ghi trÃªn má»—i trang, vÃ  báº¡n muá»‘n truy váº¥n trang thá»© 100, thá»±c táº¿, nÃ³ sáº½ láº¥y 1000 báº£n ghi Ä‘áº§u tiÃªn Ä‘Æ°á»£c lÆ°u trá»¯ trÃªn má»—i shard vÃ  Ä‘Æ°a chÃºng vÃ o má»™t nÃºt Ä‘iá»u phá»‘i, náº¿u báº¡n cÃ³ 5 shard, thÃ¬ sáº½ cÃ³ 5000 báº£n ghi, sau Ä‘Ã³ nÃºt Ä‘iá»u phá»‘i sáº½ xá»­ lÃ½ vÃ  há»£p nháº¥t 5000 báº£n ghi nÃ y, sau Ä‘Ã³ láº¥y 10 báº£n ghi cuá»‘i cÃ¹ng trÃªn trang thá»© 100.</p><p>PhÃ¢n tÃ¡n, báº¡n muá»‘n xem 10 báº£n ghi trÃªn trang thá»© 100, khÃ´ng thá»ƒ nÃ³i ráº±ng tá»« 5 shard, má»—i shard chá»‰ xem 2 báº£n ghi, cuá»‘i cÃ¹ng há»£p nháº¥t thÃ nh 10 báº£n ghi táº¡i nÃºt Ä‘iá»u phá»‘i, pháº£i khÃ´ng? Báº¡nÂ <strong>pháº£i</strong>Â láº¥y 1000 báº£n ghi tá»« má»—i shard, sau Ä‘Ã³ sáº¯p xáº¿p, lá»c, v.v., dá»±a trÃªn yÃªu cáº§u cá»§a báº¡n, sau Ä‘Ã³ phÃ¢n trang má»™t láº§n ná»¯a, láº¥y dá»¯ liá»‡u trÃªn trang thá»© 100. Khi báº¡n láº­t trang, cÃ ng sÃ¢u, má»—i shard tráº£ vá» cÃ ng nhiá»u dá»¯ liá»‡u, vÃ  thá»i gian xá»­ lÃ½ cá»§a nÃºt Ä‘iá»u phá»‘i cÃ ng lÃ¢u, ráº¥t khÃ³ chá»‹u. VÃ¬ váº­y, khi sá»­ dá»¥ng es Ä‘á»ƒ phÃ¢n trang, báº¡n sáº½ tháº¥y ráº±ng cÃ ng láº­t Ä‘áº¿n sau, cÃ ng cháº­m.</p><p>ChÃºng tÃ´i cÅ©ng Ä‘Ã£ gáº·p váº¥n Ä‘á» nÃ y trÆ°á»›c Ä‘Ã¢y, sá»­ dá»¥ng es Ä‘á»ƒ phÃ¢n trang, má»™t sá»‘ trang Ä‘áº§u tiÃªn chá»‰ máº¥t vÃ i chá»¥c mili giÃ¢y, khi láº­t Ä‘áº¿n trang thá»© 10 hoáº·c vÃ i chá»¥c trang, cÆ¡ báº£n máº¥t 5~10 giÃ¢y má»›i cÃ³ thá»ƒ láº¥y má»™t trang dá»¯ liá»‡u.</p><p>CÃ³ giáº£i phÃ¡p nÃ o khÃ´ng?</p><h4 id="khong-cho-phep-phan-trang-sau-mac-Ä‘inh-hieu-suat-phan-trang-sau-rat-kem" tabindex="-1"><a class="header-anchor" href="#khong-cho-phep-phan-trang-sau-mac-Ä‘inh-hieu-suat-phan-trang-sau-rat-kem"><span>KhÃ´ng cho phÃ©p phÃ¢n trang sÃ¢u (máº·c Ä‘á»‹nh hiá»‡u suáº¥t phÃ¢n trang sÃ¢u ráº¥t kÃ©m)</span></a></h4><p>NÃ³i vá»›i quáº£n lÃ½ sáº£n pháº©m ráº±ng, há»‡ thá»‘ng cá»§a báº¡n khÃ´ng cho phÃ©p láº­t trang quÃ¡ sÃ¢u, máº·c Ä‘á»‹nh lÃ  cÃ ng láº­t sÃ¢u, hiá»‡u suáº¥t cÃ ng kÃ©m.</p><h4 id="tuong-tu-nhu-viec-keo-xuong-Ä‘e-hien-thi-them-san-pham-Ä‘uoc-Ä‘e-xuat-trong-ung-dung" tabindex="-1"><a class="header-anchor" href="#tuong-tu-nhu-viec-keo-xuong-Ä‘e-hien-thi-them-san-pham-Ä‘uoc-Ä‘e-xuat-trong-ung-dung"><span>TÆ°Æ¡ng tá»± nhÆ° viá»‡c kÃ©o xuá»‘ng Ä‘á»ƒ hiá»ƒn thá»‹ thÃªm sáº£n pháº©m Ä‘Æ°á»£c Ä‘á» xuáº¥t trong á»©ng dá»¥ng</span></a></h4><p>TÆ°Æ¡ng tá»± nhÆ° trong Weibo, kÃ©o xuá»‘ng Ä‘á»ƒ lÃ m má»›i Weibo, hiá»ƒn thá»‹ tá»«ng trang, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng <code>scroll api</code>. Äá»‘i vá»›i cÃ¡ch sá»­ dá»¥ng, hÃ£y tá»± tÃ¬m kiáº¿m trÃªn internet.</p><p>Scroll sáº½ táº¡o ra má»™t <strong>báº£n chá»¥p toÃ n bá»™ dá»¯ liá»‡u</strong> cho báº¡n má»™t láº§n, sau Ä‘Ã³ má»—i láº§n kÃ©o xuá»‘ng Ä‘á»ƒ láº­t trang tiáº¿p theo sáº½ thÃ´ng qua viá»‡c di chuyá»ƒn <strong>con trá»</strong> <code>scroll_id</code>, nháº­n trang tiáº¿p theo nhÆ° váº­y, hiá»‡u suáº¥t sáº½ cao hÆ¡n ráº¥t nhiá»u so vá»›i hiá»‡u suáº¥t phÃ¢n trang Ä‘Ã£ nÃ³i á»Ÿ trÃªn, cÆ¡ báº£n lÃ  á»Ÿ má»©c mili giÃ¢y.</p><p>Tuy nhiÃªn, Ä‘iá»ƒm duy nháº¥t lÃ , Ä‘iá»u nÃ y phÃ¹ há»£p vá»›i viá»‡c láº­t trang khi kÃ©o xuá»‘ng giá»‘ng nhÆ° Weibo, <strong>khÃ´ng thá»ƒ tÃ¹y Ã½ nháº£y Ä‘áº¿n báº¥t ká»³ trang nÃ o</strong>. NghÄ©a lÃ , báº¡n khÃ´ng thá»ƒ truy cáº­p trang thá»© 10 trÆ°á»›c, sau Ä‘Ã³ Ä‘i Ä‘áº¿n trang thá»© 120, sau Ä‘Ã³ láº¡i quay láº¡i trang thá»© 58, khÃ´ng thá»ƒ nháº£y trang tÃ¹y Ã½. VÃ¬ váº­y, nhiá»u sáº£n pháº©m hiá»‡n nay khÃ´ng cho phÃ©p báº¡n tÃ¹y Ã½ láº­t trang, á»©ng dá»¥ng, cÅ©ng nhÆ° má»™t sá»‘ trang web, chá»‰ cho phÃ©p báº¡n kÃ©o xuá»‘ng, láº­t tá»«ng trang má»™t.</p><p>Khi khá»Ÿi táº¡o, báº¡n pháº£i chá»‰ Ä‘á»‹nh tham sá»‘ <code>scroll</code>, thÃ´ng bÃ¡o cho es cáº§n lÆ°u trá»¯ ngá»¯ cáº£nh tÃ¬m kiáº¿m nÃ y trong bao lÃ¢u. Báº¡n cáº§n Ä‘áº£m báº£o ráº±ng ngÆ°á»i dÃ¹ng sáº½ khÃ´ng tiáº¿p tá»¥c láº­t trang trong vÃ i giá», náº¿u khÃ´ng cÃ³ thá»ƒ sáº½ tháº¥t báº¡i do quÃ¡ thá»i gian.</p><p>NgoÃ i viá»‡c sá»­ dá»¥ng <code>scroll api</code>, báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng <code>search_after</code>. Ã tÆ°á»Ÿng cá»§a <code>search_after</code> lÃ  sá»­ dá»¥ng káº¿t quáº£ cá»§a trang trÆ°á»›c Ä‘á»ƒ giÃºp tÃ¬m kiáº¿m dá»¯ liá»‡u trÃªn trang tiáº¿p theo, rÃµ rÃ ng, cÃ¡ch nÃ y cÅ©ng khÃ´ng cho phÃ©p báº¡n tÃ¹y Ã½ láº­t trang, báº¡n chá»‰ cÃ³ thá»ƒ láº­t tá»«ng trang má»™t. Khi khá»Ÿi táº¡o, báº¡n cáº§n sá»­ dá»¥ng má»™t trÆ°á»ng giÃ¡ trá»‹ duy nháº¥t lÃ m trÆ°á»ng sáº¯p xáº¿p.</p><p><strong>1.1. Tá»‘i Æ°u hÃ³a giai Ä‘oáº¡n thiáº¿t káº¿</strong></p><p>(1) Dá»±a trÃªn yÃªu cáº§u tÄƒng trÆ°á»Ÿng kinh doanh, táº¡o chá»‰ má»¥c dá»±a trÃªn máº«u ngÃ y, cuá»™n chá»‰ má»¥c qua API roll over;</p><p>(2) Sá»­ dá»¥ng bÃ­ danh Ä‘á»ƒ quáº£n lÃ½ chá»‰ má»¥c;</p><p>(3) Má»—i ngÃ y vÃ o lÃºc ná»­a Ä‘Ãªm, thá»±c hiá»‡n thao tÃ¡c force_merge trÃªn chá»‰ má»¥c Ä‘á»ƒ giáº£i phÃ³ng khÃ´ng gian;</p><p>(4) Sá»­ dá»¥ng cÆ¡ cháº¿ phÃ¢n tÃ¡ch nÃ³ng vÃ  láº¡nh, lÆ°u trá»¯ dá»¯ liá»‡u nÃ³ng vÃ o SSD Ä‘á»ƒ cáº£i thiá»‡n hiá»‡u suáº¥t tÃ¬m kiáº¿m; dá»¯ liá»‡u láº¡nh Ä‘Æ°á»£c thu nhá» Ä‘á»‹nh ká»³ Ä‘á»ƒ giáº£m bá»›t lÆ°u trá»¯;</p><p>(5) Sá»­ dá»¥ng curator Ä‘á»ƒ quáº£n lÃ½ vÃ²ng Ä‘á»i chá»‰ má»¥c;</p><p>(6) Chá»‰ Ä‘áº·t tokenizer má»™t cÃ¡ch há»£p lÃ½ cho cÃ¡c trÆ°á»ng cáº§n phÃ¢n máº£nh;</p><p>(7) Giai Ä‘oáº¡n Mapping káº¿t há»£p Ä‘áº§y Ä‘á»§ cÃ¡c thuá»™c tÃ­nh cá»§a tá»«ng trÆ°á»ng, liá»‡u cÃ³ cáº§n tÃ¬m kiáº¿m, liá»‡u cÃ³ cáº§n lÆ°u trá»¯, v.vâ€¦â€¦.</p><p><strong>1.2. Tá»‘i Æ°u hÃ³a viáº¿t</strong></p><p>(1) Thiáº¿t láº­p sá»‘ lÆ°á»£ng báº£n sao lÃ  0 trÆ°á»›c khi ghi;</p><p>(2) Táº¯t refresh_interval trÆ°á»›c khi ghi, Ä‘áº·t lÃ  -1, vÃ´ hiá»‡u hÃ³a cÆ¡ cháº¿ lÃ m má»›i;</p><p>(3) Trong quÃ¡ trÃ¬nh ghi: sá»­ dá»¥ng bulk Ä‘á»ƒ ghi hÃ ng loáº¡t;</p><p>(4) Phá»¥c há»“i sá»‘ lÆ°á»£ng báº£n sao vÃ  khoáº£ng thá»i gian lÃ m má»›i sau khi ghi;</p><p>(5) Cá»‘ gáº¯ng sá»­ dá»¥ng id tá»± Ä‘á»™ng sinh.</p><p>1.3. Tá»‘i Æ°u hÃ³a truy váº¥n</p><p>(1) VÃ´ hiá»‡u hÃ³a wildcard;</p><p>(2) VÃ´ hiá»‡u hÃ³a terms hÃ ng loáº¡t (trÆ°á»ng há»£p hÃ ng trÄƒm hÃ ng nghÃ¬n);</p><p>(3) Táº­n dá»¥ng tá»‘i Ä‘a cÆ¡ cháº¿ chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c, náº¿u cÃ³ thá»ƒ dÃ¹ng loáº¡i keyword thÃ¬ hÃ£y dÃ¹ng keyword;</p><p>(4) Khi lÆ°á»£ng dá»¯ liá»‡u lá»›n, báº¡n cÃ³ thá»ƒ Ä‘á»‹nh chá»‰ má»¥c dá»±a trÃªn thá»i gian trÆ°á»›c khi tÃ¬m kiáº¿m;</p><p>(5) Thiáº¿t láº­p cÆ¡ cháº¿ Ä‘á»‹nh tuyáº¿n há»£p lÃ½.</p><p>1.4. Tá»‘i Æ°u hÃ³a khÃ¡c</p><p>Tá»‘i Æ°u hÃ³a triá»ƒn khai, tá»‘i Æ°u hÃ³a kinh doanh, v.v.</p><p>Pháº§n nÃªu trÃªn chá»‰ Ä‘á» cáº­p Ä‘áº¿n má»™t pháº§n, ngÆ°á»i phá»ng váº¥n sáº½ cÆ¡ báº£n Ä‘Ã¡nh giÃ¡ kinh nghiá»‡m thá»±c hÃ nh hoáº·c váº­n hÃ nh trÆ°á»›c Ä‘Ã¢y cá»§a báº¡n.</p><h2 id="nguyen-ly-hoat-Ä‘ong" tabindex="-1"><a class="header-anchor" href="#nguyen-ly-hoat-Ä‘ong"><span>NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng</span></a></h2><h3 id="qua-trinh-ghi-du-lieu-es" tabindex="-1"><a class="header-anchor" href="#qua-trinh-ghi-du-lieu-es"><span>QuÃ¡ trÃ¬nh ghi dá»¯ liá»‡u es</span></a></h3><ul><li>MÃ¡y khÃ¡ch chá»n má»™t node Ä‘á»ƒ gá»­i yÃªu cáº§u Ä‘i, node nÃ y lÃ  <code>coordinating node</code> (nÃºt Ä‘iá»u phá»‘i).</li><li><code>Coordinating node</code> thá»±c hiá»‡n <strong>Ä‘á»‹nh tuyáº¿n</strong> cho document, chuyá»ƒn yÃªu cáº§u Ä‘áº¿n node tÆ°Æ¡ng á»©ng (cÃ³ primary shard).</li><li><code>Primary shard</code> trÃªn node thá»±c táº¿ xá»­ lÃ½ yÃªu cáº§u, sau Ä‘Ã³ Ä‘á»“ng bá»™ hÃ³a dá»¯ liá»‡u vá»›i <code>replica node</code>.</li><li><code>Coordinating node</code> náº¿u phÃ¡t hiá»‡n <code>primary node</code> vÃ  táº¥t cáº£ <code>replica node</code> Ä‘á»u Ä‘Ã£ hoÃ n thÃ nh, thÃ¬ tráº£ káº¿t quáº£ pháº£n há»“i cho mÃ¡y khÃ¡ch.</li></ul><h3 id="qua-trinh-Ä‘oc-du-lieu-es" tabindex="-1"><a class="header-anchor" href="#qua-trinh-Ä‘oc-du-lieu-es"><span>QuÃ¡ trÃ¬nh Ä‘á»c dá»¯ liá»‡u es</span></a></h3><p>CÃ³ thá»ƒ truy váº¥n thÃ´ng qua <code>doc id</code>, sáº½ dá»±a vÃ o <code>doc id</code> Ä‘á»ƒ thá»±c hiá»‡n hash, xÃ¡c Ä‘á»‹nh lÃºc Ä‘Ã³ Ä‘Ã£ phÃ¢n <code>doc id</code> vÃ o shard nÃ o, tá»« shard Ä‘Ã³ truy váº¥n.</p><ul><li>MÃ¡y khÃ¡ch gá»­i yÃªu cáº§u Ä‘áº¿n <strong>báº¥t ká»³</strong> má»™t node, trá»Ÿ thÃ nh <code>coordinate node</code>.</li><li><code>Coordinate node</code> thá»±c hiá»‡n Ä‘á»‹nh tuyáº¿n hash cho <code>doc id</code>, chuyá»ƒn yÃªu cáº§u Ä‘áº¿n node tÆ°Æ¡ng á»©ng, lÃºc nÃ y sáº½ sá»­ dá»¥ng thuáº­t toÃ¡n <strong>round-robin ngáº«u nhiÃªn</strong>, chá»n ngáº«u nhiÃªn má»™t trong sá»‘ <code>primary shard</code> vÃ  táº¥t cáº£ cÃ¡c báº£n sao cá»§a nÃ³, Ä‘á»ƒ cÃ¢n báº±ng táº£i yÃªu cáº§u Ä‘á»c.</li><li>Node nháº­n yÃªu cáº§u tráº£ document cho <code>coordinate node</code>.</li><li><code>Coordinate node</code> tráº£ document cho mÃ¡y khÃ¡ch.</li></ul><h3 id="qua-trinh-tim-kiem-du-lieu-trong-es" tabindex="-1"><a class="header-anchor" href="#qua-trinh-tim-kiem-du-lieu-trong-es"><span>QuÃ¡ trÃ¬nh tÃ¬m kiáº¿m dá»¯ liá»‡u trong ES</span></a></h3><p>Äiá»ƒm máº¡nh nháº¥t cá»§a ES lÃ  thá»±c hiá»‡n tÃ¬m kiáº¿m toÃ n vÄƒn, vÃ­ dá»¥, báº¡n cÃ³ ba dá»¯ liá»‡u:</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>Java is interesting</span></span>
<span class="line"><span>Java is so difficult to learn</span></span>
<span class="line"><span>J2EE is great</span></span></code></pre></div><p>Báº¡n tÃ¬m kiáº¿m theo tá»« khÃ³aÂ <code>java</code>, nÃ³ sáº½ tÃ¬m kiáº¿m cÃ¡cÂ <code>document</code>Â chá»©aÂ <code>java</code>. ES sáº½ tráº£ vá» cho báº¡n: Java is interesting, Java is so difficult to learn</p><ul><li>MÃ¡y khÃ¡ch gá»­i yÃªu cáº§u Ä‘áº¿n má»™tÂ <code>coordinating node</code>.</li><li>NÃºt Ä‘iá»u phá»‘i chuyá»ƒn yÃªu cáº§u tÃ¬m kiáº¿m Ä‘áº¿nÂ <strong>táº¥t cáº£</strong>Â <code>primary shard</code> hoáº·cÂ <code>replica shard</code>Â tÆ°Æ¡ng á»©ng.</li><li>Giai Ä‘oáº¡n truy váº¥n (query phase): má»—i shard sáº½ tráº£ láº¡i káº¿t quáº£ tÃ¬m kiáº¿m cá»§a mÃ¬nh (thá»±c táº¿ chá»‰ lÃ  má»™t sá»‘Â <code>doc id</code>) cho nÃºt Ä‘iá»u phá»‘i, nÃºt Ä‘iá»u phá»‘i thá»±c hiá»‡n cÃ¡c hoáº¡t Ä‘á»™ng nhÆ° há»£p nháº¥t dá»¯ liá»‡u, sáº¯p xáº¿p, phÃ¢n trang, etc., Ä‘á»ƒ táº¡o ra káº¿t quáº£ cuá»‘i cÃ¹ng.</li><li>Giai Ä‘oáº¡n láº¥y (fetch phase): sau Ä‘Ã³, nÃºt Ä‘iá»u phá»‘i sáº½Â <strong>láº¥y</strong>Â dá»¯ liá»‡uÂ <code>document</code>Â thá»±c táº¿ tá»« cÃ¡c node dá»±a trÃªnÂ <code>doc id</code>, vÃ  cuá»‘i cÃ¹ng tráº£ láº¡i cho mÃ¡y khÃ¡ch.</li></ul><blockquote><p>YÃªu cáº§u ghi Ä‘Æ°á»£c ghi vÃ o primary shard, sau Ä‘Ã³ Ä‘á»“ng bá»™ hÃ³a vá»›i táº¥t cáº£ cÃ¡c replica shard; yÃªu cáº§u Ä‘á»c cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘á»c tá»« primary shard hoáº·c replica shard, sá»­ dá»¥ng thuáº­t toÃ¡n round-robin.</p></blockquote><h3 id="nguyen-ly-co-ban-khi-ghi-du-lieu" tabindex="-1"><a class="header-anchor" href="#nguyen-ly-co-ban-khi-ghi-du-lieu"><span>NguyÃªn lÃ½ cÆ¡ báº£n khi ghi dá»¯ liá»‡u</span></a></h3><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223111949.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Äáº§u tiÃªn, dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c ghi vÃ o bá»™ Ä‘á»‡m trong bá»™ nhá»› (buffer), trong quÃ¡ trÃ¬nh nÃ y dá»¯ liá»‡u khÃ´ng thá»ƒ Ä‘Æ°á»£c tÃ¬m kiáº¿m; Ä‘á»“ng thá»i dá»¯ liá»‡u cÅ©ng Ä‘Æ°á»£c ghi vÃ o tá»‡p nháº­t kÃ½ translog.</p><p>Náº¿u bá»™ Ä‘á»‡m gáº§n nhÆ° Ä‘áº§y, hoáº·c sau má»™t khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh, dá»¯ liá»‡u trong bá»™ Ä‘á»‡m sáº½ Ä‘Æ°á»£cÂ <code>refresh</code>Â vÃ o má»™tÂ <code>segment file</code>Â má»›i, nhÆ°ng lÃºc nÃ y dá»¯ liá»‡u khÃ´ng Ä‘Æ°á»£c ghi trá»±c tiáº¿p vÃ o tá»‡pÂ <code>segment file</code> trÃªn Ä‘Ä©a, mÃ  pháº£i Ä‘i vÃ oÂ <code>os cache</code>Â trÆ°á»›c. QuÃ¡ trÃ¬nh nÃ y Ä‘Æ°á»£c gá»i lÃ Â <code>refresh</code>.</p><p>Má»—i giÃ¢y, ES sáº½ ghi dá»¯ liá»‡u trong bá»™ Ä‘á»‡m vÃ o má»™tÂ <code>segment file</code>Â <strong>má»›i</strong>, má»—i giÃ¢y sáº½ táº¡o ra má»™t tá»‡p Ä‘Ä©a <code>segment file</code>Â <strong>má»›i</strong>, tá»‡pÂ <code>segment file</code> nÃ y sáº½ lÆ°u trá»¯ dá»¯ liá»‡u Ä‘Æ°á»£c ghi vÃ o bá»™ Ä‘á»‡m trong 1 giÃ¢y gáº§n Ä‘Ã¢y.</p><p>Tuy nhiÃªn, náº¿u khÃ´ng cÃ³ dá»¯ liá»‡u trong bá»™ Ä‘á»‡m, thÃ¬ táº¥t nhiÃªn khÃ´ng cÃ³ quÃ¡ trÃ¬nh refresh nÃ o Ä‘Æ°á»£c thá»±c hiá»‡n, náº¿u cÃ³ dá»¯ liá»‡u trong bá»™ Ä‘á»‡m, máº·c Ä‘á»‹nh sáº½ thá»±c hiá»‡n má»™t láº§n refresh má»—i giÃ¢y, Ä‘áº©y dá»¯ liá»‡u vÃ o má»™tÂ <code>segment file</code>Â má»›i.</p><p>TrÃªn há»‡ Ä‘iá»u hÃ nh, tá»‡p Ä‘Ä©a thá»±c táº¿ Ä‘á»u cÃ³ má»™t thá»© gá»i lÃ Â <code>os cache</code>, tá»©c lÃ  trÆ°á»›c khi dá»¯ liá»‡u Ä‘Æ°á»£c ghi vÃ o tá»‡p Ä‘Ä©a, nÃ³ sáº½ Ä‘Æ°á»£c Ä‘Æ°a vÃ oÂ <code>os cache</code> trÆ°á»›c, Ä‘áº§u tiÃªn vÃ o bá»™ nhá»› cache cáº¥p há»‡ Ä‘iá»u hÃ nh. Chá»‰ cáº§n dá»¯ liá»‡u trong bá»™ Ä‘á»‡m Ä‘Æ°á»£c chuyá»ƒn vÃ oÂ <code>os cache</code>Â thÃ´ng qua hoáº¡t Ä‘á»™ng refresh, dá»¯ liá»‡u nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¬m kiáº¿m.</p><p>Táº¡i sao nÃ³i ráº±ng ES lÃ Â <strong>gáº§n nhÆ° thá»i gian thá»±c</strong>?Â <code>NRT</code>, tÃªn Ä‘áº§y Ä‘á»§ lÃ Â <code>near real-time</code>. Máº·c Ä‘á»‹nh lÃ  refresh má»—i giÃ¢y má»™t láº§n, vÃ¬ váº­y ES lÃ  gáº§n nhÆ° thá»i gian thá»±c, vÃ¬ dá»¯ liá»‡u Ä‘Æ°á»£c ghi vÃ o sau 1 giÃ¢y má»›i cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¬m tháº¥y. Báº¡n cÃ³ thá»ƒ sá»­ dá»¥ngÂ <code>restful api</code>Â cá»§a es hoáº·cÂ <code>java api</code>Â Ä‘á»ƒ thá»±c hiá»‡n má»™t hoáº¡t Ä‘á»™ng refreshÂ <strong>thá»§ cÃ´ng</strong>, tá»©c lÃ  thá»§ cÃ´ng Ä‘Æ°a dá»¯ liá»‡u trong bá»™ Ä‘á»‡m vÃ oÂ <code>os cache</code>, Ä‘á»ƒ dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¬m kiáº¿m ngay láº­p tá»©c. Miá»…n lÃ  dá»¯ liá»‡u Ä‘Æ°á»£c Ä‘Æ°a vÃ oÂ <code>os cache</code>, bá»™ Ä‘á»‡m sáº½ Ä‘Æ°á»£c lÃ m sáº¡ch, vÃ¬ khÃ´ng cáº§n giá»¯ bá»™ Ä‘á»‡m ná»¯a, dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c lÆ°u trá»¯ trong tá»‡p nháº­t kÃ½ translog má»™t láº§n.</p><p>Láº·p láº¡i cÃ¡c bÆ°á»›c trÃªn, dá»¯ liá»‡u má»›i liÃªn tá»¥c vÃ o bá»™ Ä‘á»‡m vÃ  translog, liÃªn tá»¥c ghi dá»¯ liá»‡uÂ <code>buffer</code>Â vÃ o má»™tÂ <code>segment file</code>Â má»›i sau má»—i láº§nÂ <code>refresh</code>, sau má»—i láº§nÂ <code>refresh</code>Â bá»™ Ä‘á»‡m sáº½ Ä‘Æ°á»£c lÃ m sáº¡ch, translog sáº½ Ä‘Æ°á»£c giá»¯ láº¡i. Khi quÃ¡ trÃ¬nh nÃ y tiáº¿p diá»…n, translog sáº½ ngÃ y cÃ ng lá»›n. Khi translog Ä‘áº¡t Ä‘áº¿n má»™t Ä‘á»™ dÃ i nháº¥t Ä‘á»‹nh, nÃ³ sáº½ kÃ­ch hoáº¡t hoáº¡t Ä‘á»™ngÂ <code>commit</code>.</p><p>BÆ°á»›c Ä‘áº§u tiÃªn cá»§a hoáº¡t Ä‘á»™ng commit lÃ  ghi dá»¯ liá»‡u hiá»‡n cÃ³ trong bá»™ Ä‘á»‡m vÃ oÂ <code>os cache</code>, sau Ä‘Ã³ lÃ m sáº¡ch bá»™ Ä‘á»‡m. Sau Ä‘Ã³, ghi má»™tÂ <code>commit point</code>Â vÃ o tá»‡p Ä‘Ä©a, trong Ä‘Ã³ Ä‘Ã¡nh dáº¥u táº¥t cáº£ cÃ¡cÂ <code>segment file</code>Â tÆ°Æ¡ng á»©ng vá»›iÂ <code>commit point</code>Â nÃ y, Ä‘á»“ng thá»i buá»™cÂ <code>os cache</code>Â chá»©a táº¥t cáº£ dá»¯ liá»‡u hiá»‡n táº¡i Ä‘á»ƒ Ä‘Æ°á»£cÂ <code>fsync</code>Â vÃ o tá»‡p Ä‘Ä©a. Cuá»‘i cÃ¹ng,Â <strong>xÃ³a</strong>Â tá»‡p nháº­t kÃ½ translog hiá»‡n táº¡i, khá»Ÿi Ä‘á»™ng láº¡i má»™t translog, lÃºc nÃ y hoáº¡t Ä‘á»™ng commit Ä‘Ã£ hoÃ n thÃ nh.</p><p>Hoáº¡t Ä‘á»™ng commit nÃ y Ä‘Æ°á»£c gá»i lÃ Â <code>flush</code>. Máº·c Ä‘á»‹nh lÃ  má»—i 30 phÃºt tá»± Ä‘á»™ng thá»±c hiá»‡n má»™t láº§nÂ <code>flush</code>, nhÆ°ng náº¿u translog quÃ¡ lá»›n, cÅ©ng sáº½ kÃ­ch hoáº¡tÂ <code>flush</code>. Hoáº¡t Ä‘á»™ng flush tÆ°Æ¡ng á»©ng vá»›i toÃ n bá»™ quÃ¡ trÃ¬nh commit, chÃºng ta cÃ³ thá»ƒ thÃ´ng qua api cá»§a es, thá»±c hiá»‡n thá»§ cÃ´ng hoáº¡t Ä‘á»™ng flush, thá»§ cÃ´ngÂ <code>fsync</code>Â dá»¯ liá»‡u trongÂ <code>os cache</code>Â vÃ o Ä‘Ä©a.</p><p>Tá»‡p nháº­t kÃ½ translog cÃ³ vai trÃ² gÃ¬? TrÆ°á»›c khi báº¡n thá»±c hiá»‡n hoáº¡t Ä‘á»™ng commit, dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘ang náº±m trong bá»™ Ä‘á»‡m hoáº·c náº±m trongÂ <code>os cache</code>. DÃ¹ lÃ  bá»™ Ä‘á»‡m hayÂ <code>os cache</code>Â Ä‘á»u lÃ  bá»™ nhá»›, náº¿u mÃ¡y nÃ y bá»‹ há»ng, dá»¯ liá»‡u trong bá»™ nhá»› sáº½ máº¥t háº¿t. VÃ¬ váº­y, cáº§n ghi cÃ¡c hoáº¡t Ä‘á»™ng tÆ°Æ¡ng á»©ng cá»§a dá»¯ liá»‡u vÃ o má»™t tá»‡p nháº­t kÃ½ Ä‘áº·c biá»‡t lÃ Â <code>translog</code>, náº¿u mÃ¡y bá»‹ há»ng lÃºc nÃ y, khi khá»Ÿi Ä‘á»™ng láº¡i, es sáº½ tá»± Ä‘á»™ng Ä‘á»c dá»¯ liá»‡u tá»« tá»‡p nháº­t kÃ½ translog vÃ  phá»¥c há»“i vÃ o bá»™ nhá»›Â <code>buffer</code>Â vÃ Â <code>os cache</code>.</p><p>Thá»±c táº¿, translog cÅ©ng Ä‘Æ°á»£c ghi vÃ oÂ <code>os cache</code>Â trÆ°á»›c, máº·c Ä‘á»‹nh lÃ  má»—i 5 giÃ¢y sáº½ Ä‘áº©y vÃ o Ä‘Ä©a má»™t láº§n, vÃ¬ váº­y máº·c Ä‘á»‹nh, cÃ³ thá»ƒ cÃ³ 5 giÃ¢y dá»¯ liá»‡u chá»‰ náº±m trong bá»™ Ä‘á»‡m hoáº·c <code>os cache</code> hoáº·c tá»‡p translog, khÃ´ng náº±m trÃªn Ä‘Ä©a, náº¿u mÃ¡y nÃ y bá»‹ há»ng lÃºc nÃ y, sáº½Â <strong>máº¥t</strong>Â 5 giÃ¢y dá»¯ liá»‡u. NhÆ°ng hiá»‡u suáº¥t nhÆ° váº­y tá»‘t hÆ¡n, máº¥t tá»‘i Ä‘a 5 giÃ¢y dá»¯ liá»‡u. Báº¡n cÅ©ng cÃ³ thá»ƒ Ä‘áº·t translog Ä‘á»ƒ má»—i láº§n ghi pháº£iÂ <code>fsync</code>Â trá»±c tiáº¿p vÃ o Ä‘Ä©a, nhÆ°ng hiá»‡u suáº¥t sáº½ kÃ©m hÆ¡n nhiá»u.</p><p>Thá»±c táº¿, náº¿u báº¡n á»Ÿ Ä‘Ã¢y, náº¿u ngÆ°á»i phá»ng váº¥n khÃ´ng há»i báº¡n vá» váº¥n Ä‘á» máº¥t dá»¯ liá»‡u cá»§a es, báº¡n cÃ³ thá»ƒ tá»± hÃ o vá»›i ngÆ°á»i phá»ng váº¥n á»Ÿ Ä‘Ã¢y, báº¡n nÃ³i, thá»±c táº¿ es trÆ°á»›c tiÃªn lÃ  gáº§n nhÆ° thá»i gian thá»±c, dá»¯ liá»‡u Ä‘Æ°á»£c ghi vÃ o sau 1 giÃ¢y má»›i cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¬m tháº¥y; cÃ³ thá»ƒ máº¥t dá»¯ liá»‡u. CÃ³ 5 giÃ¢y dá»¯ liá»‡u, náº±m trong bá»™ Ä‘á»‡m,Â <code>os cache</code>Â cá»§a translog,Â <code>os cache</code>Â cá»§aÂ <code>segment file</code>, khÃ´ng náº±m trÃªn Ä‘Ä©a, náº¿u mÃ¡y nÃ y bá»‹ há»ng lÃºc nÃ y, sáº½ dáº«n Ä‘áº¿nÂ <strong>máº¥t</strong>Â 5 giÃ¢y dá»¯ liá»‡u.</p><p><strong>TÃ³m láº¡i</strong>, dá»¯ liá»‡u Ä‘Æ°á»£c ghi vÃ o bá»™ Ä‘á»‡m trÆ°á»›c, sau Ä‘Ã³ má»—i giÃ¢y, dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c refresh vÃ oÂ <code>os cache</code>, khi dá»¯ liá»‡u Ä‘áº¿nÂ <code>os cache</code>, dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘Æ°á»£c tÃ¬m kiáº¿m (Ä‘Ã³ lÃ  lÃ½ do táº¡i sao chÃºng ta nÃ³i ráº±ng tá»« khi dá»¯ liá»‡u Ä‘Æ°á»£c ghi vÃ o cho Ä‘áº¿n khi cÃ³ thá»ƒ tÃ¬m kiáº¿m, cÃ³ Ä‘á»™ trá»… 1s). Má»—i 5 giÃ¢y, dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c ghi vÃ o tá»‡p translog (do Ä‘Ã³, náº¿u mÃ¡y bá»‹ há»ng, táº¥t cáº£ dá»¯ liá»‡u trong bá»™ nhá»› sáº½ máº¥t, tá»‘i Ä‘a sáº½ máº¥t 5s dá»¯ liá»‡u), khi translog lá»›n Ä‘áº¿n má»™t má»©c Ä‘á»™ nháº¥t Ä‘á»‹nh, hoáº·c máº·c Ä‘á»‹nh má»—i 30 phÃºt, má»™t hoáº¡t Ä‘á»™ng commit sáº½ Ä‘Æ°á»£c kÃ­ch hoáº¡t, Ä‘áº©y táº¥t cáº£ dá»¯ liá»‡u trong bá»™ Ä‘á»‡m vÃ o tá»‡pÂ <code>segment file</code>trÃªn Ä‘Ä©a.</p><blockquote><p>Sau khi dá»¯ liá»‡u Ä‘Æ°á»£c ghi vÃ oÂ <code>segment file</code>, chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c cÅ©ng sáº½ Ä‘Æ°á»£c táº¡o ngay láº­p tá»©c.</p></blockquote><h3 id="nguyen-ly-co-ban-khi-xoa-cap-nhat-du-lieu" tabindex="-1"><a class="header-anchor" href="#nguyen-ly-co-ban-khi-xoa-cap-nhat-du-lieu"><span>NguyÃªn lÃ½ cÆ¡ báº£n khi xÃ³a/cáº­p nháº­t dá»¯ liá»‡u</span></a></h3><p>Náº¿u lÃ  hoáº¡t Ä‘á»™ng xÃ³a, khi commit sáº½ táº¡o ra má»™t tá»‡pÂ <code>.del</code>, trong Ä‘Ã³ Ä‘Ã¡nh dáº¥u má»™t doc nháº¥t Ä‘á»‹nh lÃ  tráº¡ng thÃ¡iÂ <code>deleted</code>, vÃ¬ váº­y khi tÃ¬m kiáº¿m, dá»±a vÃ o tá»‡pÂ <code>.del</code>, báº¡n sáº½ biáº¿t liá»‡u doc cÃ³ bá»‹ xÃ³a hay khÃ´ng.</p><p>Náº¿u lÃ  hoáº¡t Ä‘á»™ng cáº­p nháº­t, nÃ³ sáº½ Ä‘Ã¡nh dáº¥u doc gá»‘c lÃ  tráº¡ng thÃ¡iÂ <code>deleted</code>Â vÃ  sau Ä‘Ã³ ghi má»™t dá»¯ liá»‡u má»›i.</p><p>Má»—i khi bá»™ Ä‘á»‡m Ä‘Æ°á»£c refresh, má»™tÂ <code>segment file</code>Â sáº½ Ä‘Æ°á»£c táº¡o ra, vÃ¬ váº­y máº·c Ä‘á»‹nh lÃ  má»™tÂ <code>segment file</code>Â má»—i giÃ¢y, vÃ¬ váº­yÂ <code>segment file</code>Â sáº½ ngÃ y cÃ ng nhiá»u, lÃºc nÃ y sáº½ thÆ°á»ng xuyÃªn thá»±c hiá»‡n merge. Má»—i láº§n merge, nhiá»uÂ <code>segment file</code>Â sáº½ Ä‘Æ°á»£c há»£p nháº¥t thÃ nh má»™t, Ä‘á»“ng thá»i á»Ÿ Ä‘Ã¢y, doc Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ Â <code>deleted</code>Â sáº½ Ä‘Æ°á»£cÂ <strong>xÃ³a váº­t lÃ½</strong>, sau Ä‘Ã³ ghiÂ <code>segment file</code>Â má»›i vÃ o Ä‘Ä©a, á»Ÿ Ä‘Ã¢y sáº½ ghi má»™tÂ <code>commit point</code>, Ä‘Ã¡nh dáº¥u táº¥t cáº£Â <code>segment file</code>Â má»›i, sau Ä‘Ã³ má»ŸÂ <code>segment file</code>Â Ä‘á»ƒ tÃ¬m kiáº¿m, vÃ  sau Ä‘Ã³ xÃ³aÂ <code>segment file</code>Â cÅ©.</p><h3 id="lop-co-ban-lucene" tabindex="-1"><a class="header-anchor" href="#lop-co-ban-lucene"><span>Lá»›p cÆ¡ báº£n Lucene</span></a></h3><p>ÄÆ¡n giáº£n, Lucene chá»‰ lÃ  má»™t thÆ° viá»‡n jar, bÃªn trong nÃ³ chá»©a cÃ¡c mÃ£ thuáº­t toÃ¡n Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã³ng gÃ³i Ä‘á»ƒ táº¡o chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c. Khi chÃºng ta phÃ¡t triá»ƒn báº±ng Java, chÃºng ta chá»‰ cáº§n import thÆ° viá»‡n jar Lucene, sau Ä‘Ã³ phÃ¡t triá»ƒn dá»±a trÃªn API cá»§a Lucene.</p><p>ThÃ´ng qua Lucene, chÃºng ta cÃ³ thá»ƒ táº¡o chá»‰ má»¥c cho dá»¯ liá»‡u hiá»‡n cÃ³, Lucene sáº½ tá»• chá»©c cáº¥u trÃºc dá»¯ liá»‡u chá»‰ má»¥c trÃªn á»• Ä‘Ä©a cá»¥c bá»™ cho chÃºng ta.</p><h3 id="chi-muc-Ä‘ao-nguoc" tabindex="-1"><a class="header-anchor" href="#chi-muc-Ä‘ao-nguoc"><span>Chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c</span></a></h3><p>Trong cÃ´ng cá»¥ tÃ¬m kiáº¿m, má»—i tÃ i liá»‡u Ä‘á»u cÃ³ má»™t ID tÃ i liá»‡u tÆ°Æ¡ng á»©ng, ná»™i dung tÃ i liá»‡u Ä‘Æ°á»£c biá»ƒu diá»…n dÆ°á»›i dáº¡ng má»™t táº­p há»£p cÃ¡c tá»« khÃ³a. VÃ­ dá»¥, sau khi phÃ¢n loáº¡i, tÃ i liá»‡u 1 Ä‘Ã£ trÃ­ch xuáº¥t 20 tá»« khÃ³a, má»—i tá»« khÃ³a Ä‘á»u ghi láº¡i sá»‘ láº§n xuáº¥t hiá»‡n vÃ  vá»‹ trÃ­ xuáº¥t hiá»‡n cá»§a nÃ³ trong tÃ i liá»‡u.</p><p>Váº­y, chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c lÃ  Ã¡nh xáº¡ tá»«Â <strong>tá»« khÃ³a Ä‘áº¿n ID tÃ i liá»‡u</strong>, má»—i tá»« khÃ³a Ä‘á»u tÆ°Æ¡ng á»©ng vá»›i má»™t loáº¡t tÃ i liá»‡u, trong Ä‘Ã³ táº¥t cáº£ cÃ¡c tÃ i liá»‡u Ä‘á»u xuáº¥t hiá»‡n tá»« khÃ³a.</p><p>VÃ­ dá»¥.</p><p>CÃ³ cÃ¡c tÃ i liá»‡u sau:</p><table><thead><tr><th>DocId</th><th>Doc</th></tr></thead><tbody><tr><td>1</td><td>Cha cá»§a Google Maps chuyá»ƒn sang Facebook</td></tr><tr><td>2</td><td>Cha cá»§a Google Maps gia nháº­p Facebook</td></tr><tr><td>3</td><td>NgÆ°á»i sÃ¡ng láº­p Google Maps, Lars rá»i Google Ä‘á»ƒ gia nháº­p Facebook</td></tr><tr><td>4</td><td>Cha cá»§a Google Maps chuyá»ƒn sang Facebook cÃ³ liÃªn quan Ä‘áº¿n viá»‡c há»§y dá»± Ã¡n Wave</td></tr><tr><td>5</td><td>Cha cá»§a Google Maps, Lars gia nháº­p trang web xÃ£ há»™i Facebook</td></tr></tbody></table><p>Sau khi phÃ¢n loáº¡i tÃ i liá»‡u, chÃºng ta nháº­n Ä‘Æ°á»£c chá»‰ má»¥cÂ <strong>Ä‘áº£o ngÆ°á»£c</strong>Â sau.</p><table><thead><tr><th>WordId</th><th>Word</th><th>DocIds</th></tr></thead><tbody><tr><td>1</td><td>Google</td><td>1,2,3,4,5</td></tr><tr><td>2</td><td>Maps</td><td>1,2,3,4,5</td></tr><tr><td>3</td><td>Cha</td><td>1,2,4,5</td></tr><tr><td>4</td><td>Chuyá»ƒn sang</td><td>1,4</td></tr><tr><td>5</td><td>Facebook</td><td>1,2,3,4,5</td></tr><tr><td>6</td><td>Gia nháº­p</td><td>2,3,5</td></tr><tr><td>7</td><td>NgÆ°á»i sÃ¡ng láº­p</td><td>3</td></tr><tr><td>8</td><td>Lars</td><td>3,5</td></tr><tr><td>9</td><td>Rá»i</td><td>3</td></tr><tr><td>10</td><td>VÃ </td><td>4</td></tr><tr><td>..</td><td>..</td><td>..</td></tr></tbody></table><p>NgoÃ i ra, chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c há»¯u Ã­ch cÃ²n cÃ³ thá»ƒ ghi láº¡i nhiá»u thÃ´ng tin hÆ¡n, cháº³ng háº¡n nhÆ° thÃ´ng tin táº§n suáº¥t tÃ i liá»‡u, cho biáº¿t cÃ³ bao nhiÃªu tÃ i liá»‡u chá»©a má»™t tá»« nháº¥t Ä‘á»‹nh trong táº­p há»£p tÃ i liá»‡u.</p><p>VÃ¬ váº­y, vá»›i chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c, cÃ´ng cá»¥ tÃ¬m kiáº¿m cÃ³ thá»ƒ dá»… dÃ ng pháº£n há»“i truy váº¥n cá»§a ngÆ°á»i dÃ¹ng. VÃ­ dá»¥, ngÆ°á»i dÃ¹ng nháº­p truy váº¥nÂ <code>Facebook</code>, há»‡ thá»‘ng tÃ¬m kiáº¿m tra cá»©u chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c, Ä‘á»c tá»« Ä‘Ã³ cÃ¡c tÃ i liá»‡u chá»©a tá»« nÃ y, cÃ¡c tÃ i liá»‡u nÃ y lÃ  káº¿t quáº£ tÃ¬m kiáº¿m Ä‘Æ°á»£c cung cáº¥p cho ngÆ°á»i dÃ¹ng.</p><p>Cáº§n chÃº Ã½ Ä‘áº¿n hai chi tiáº¿t quan trá»ng cá»§a chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c:</p><ul><li>Táº¥t cáº£ cÃ¡c má»¥c tá»« trong chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c tÆ°Æ¡ng á»©ng vá»›i má»™t hoáº·c nhiá»u tÃ i liá»‡u;</li><li>CÃ¡c má»¥c tá»« trong chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c Ä‘Æ°á»£c sáº¯p xáº¿p theo thá»© tá»± tá»« Ä‘iá»ƒn tÄƒng dáº§n.</li></ul><blockquote><p>TrÃªn chá»‰ lÃ  má»™t vÃ­ dá»¥ Ä‘Æ¡n giáº£n, khÃ´ng Ä‘Æ°á»£c sáº¯p xáº¿p theo thá»© tá»± tá»« Ä‘iá»ƒn tÄƒng dáº§n má»™t cÃ¡ch nghiÃªm ngáº·t.</p></blockquote><h2 id="chi-muc-Ä‘ao-nguoc-trong-elasticsearch-la-gi" tabindex="-1"><a class="header-anchor" href="#chi-muc-Ä‘ao-nguoc-trong-elasticsearch-la-gi"><span>Chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c trong Elasticsearch lÃ  gÃ¬?</span></a></h2><p>NgÆ°á»i phá»ng váº¥n: TÃ´i muá»‘n hiá»ƒu rÃµ hÆ¡n vá» kiáº¿n thá»©c cÆ¡ báº£n cá»§a báº¡n.</p><p>Tráº£ lá»i: HÃ£y giáº£i thÃ­ch má»™t cÃ¡ch dá»… hiá»ƒu.</p><p>ThÃ´ng thÆ°á»ng, chÃºng ta tÃ¬m kiáº¿m thÃ´ng qua cÃ¡c bÃ i viáº¿t, dÃ² tá»«ng cÃ¡i Ä‘á»ƒ tÃ¬m vá»‹ trÃ­ cá»§a tá»« khÃ³a tÆ°Æ¡ng á»©ng.</p><p>Tuy nhiÃªn, chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c, thÃ´ng qua chiáº¿n lÆ°á»£c phÃ¢n tá»«, táº¡o ra má»™t báº£ng Ã¡nh xáº¡ giá»¯a tá»« vÃ  bÃ i viáº¿t, báº£ng tá»« Ä‘iá»ƒn + Ã¡nh xáº¡ nÃ y chÃ­nh lÃ  chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c. Vá»›i chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c, chÃºng ta cÃ³ thá»ƒ thá»±c hiá»‡n viá»‡c tÃ¬m kiáº¿m bÃ i viáº¿t vá»›i Ä‘á»™ phá»©c táº¡p thá»i gian lÃ  o(1), tÄƒng Ä‘Ã¡ng ká»ƒ hiá»‡u suáº¥t tÃ¬m kiáº¿m.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/v2-bf18227dc4554da0dcc7b970dbd582ae_720w.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>CÃ¡ch tráº£ lá»i há»c thuáº­t:</p><p>Chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c, ngÆ°á»£c láº¡i vá»›i viá»‡c má»™t bÃ i viáº¿t chá»©a nhá»¯ng tá»« nÃ o, nÃ³ báº¯t Ä‘áº§u tá»« tá»«, ghi láº¡i tá»« nÃ y Ä‘Ã£ xuáº¥t hiá»‡n trong nhá»¯ng tÃ i liá»‡u nÃ o, gá»“m hai pháº§n - tá»« Ä‘iá»ƒn vÃ  báº£ng Ä‘áº£o ngÆ°á»£c.</p><p>Äiá»ƒm cá»™ng: CÆ¡ cháº¿ hoáº¡t Ä‘á»™ng cÆ¡ báº£n cá»§a chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c dá»±a trÃªn cáº¥u trÃºc dá»¯ liá»‡u FST (Finite State Transducer).</p><p>Lucene tá»« phiÃªn báº£n 4+ báº¯t Ä‘áº§u sá»­ dá»¥ng cáº¥u trÃºc dá»¯ liá»‡u FST má»™t cÃ¡ch rá»™ng rÃ£i. FST cÃ³ hai Æ°u Ä‘iá»ƒm:</p><p>(1) Chiáº¿m Ã­t khÃ´ng gian. Báº±ng cÃ¡ch tÃ¡i sá»­ dá»¥ng tiá»n tá»‘ vÃ  háº­u tá»‘ cá»§a cÃ¡c tá»« trong tá»« Ä‘iá»ƒn, nÃ³ Ä‘Ã£ nÃ©n khÃ´ng gian lÆ°u trá»¯;</p><p>(2) Tá»‘c Ä‘á»™ truy váº¥n nhanh. Äá»™ phá»©c táº¡p thá»i gian truy váº¥n lÃ  O(len(str)).</p><h2 id="_3-elasticsearch-co-qua-nhieu-du-lieu-chi-muc-thi-phai-lam-sao-can-toi-uu-nhu-the-nao-trien-khai-nhu-the-nao" tabindex="-1"><a class="header-anchor" href="#_3-elasticsearch-co-qua-nhieu-du-lieu-chi-muc-thi-phai-lam-sao-can-toi-uu-nhu-the-nao-trien-khai-nhu-the-nao"><span>3. Elasticsearch cÃ³ quÃ¡ nhiá»u dá»¯ liá»‡u chá»‰ má»¥c thÃ¬ pháº£i lÃ m sao, cáº§n tá»‘i Æ°u nhÆ° tháº¿ nÃ o, triá»ƒn khai nhÆ° tháº¿ nÃ o?</span></a></h2><p>NgÆ°á»i phá»ng váº¥n: TÃ´i muá»‘n hiá»ƒu kháº£ nÄƒng quáº£n lÃ½ dá»¯ liá»‡u lá»›n cá»§a báº¡n.</p><p>Tráº£ lá»i: Káº¿ hoáº¡ch cho dá»¯ liá»‡u chá»‰ má»¥c nÃªn Ä‘Æ°á»£c láº­p trÆ°á»›c, Ä‘Ãºng nhÆ° cÃ¢u &quot;Thiáº¿t káº¿ trÆ°á»›c, mÃ£ hÃ³a sau&quot;, nhÆ° váº­y má»›i cÃ³ thá»ƒ trÃ¡nh hiá»‡u quáº£ sá»± tÄƒng dá»¯ liá»‡u Ä‘á»™t ngá»™t dáº«n Ä‘áº¿n kháº£ nÄƒng xá»­ lÃ½ khÃ´ng Ä‘á»§ cá»§a cá»¥m, gÃ¢y áº£nh hÆ°á»Ÿng Ä‘áº¿n khÃ¡ch hÃ ng trá»±c tuyáº¿n tÃ¬m kiáº¿m hoáº·c cÃ¡c hoáº¡t Ä‘á»™ng kinh doanh khÃ¡c.</p><p>CÃ¡ch tá»‘i Æ°u, nhÆ° Ä‘Ã£ nÃ³i trong cÃ¢u há»i 1, tÃ´i sáº½ chi tiáº¿t hÆ¡n á»Ÿ Ä‘Ã¢y:</p><p><strong>3.1 Vá» máº·t chá»‰ má»¥c Ä‘á»™ng</strong></p><p>Dá»±a trÃªn máº«u + thá»i gian + rollover api Ä‘á»ƒ táº¡o chá»‰ má»¥c, vÃ­ dá»¥: trong giai Ä‘oáº¡n thiáº¿t káº¿, chÃºng ta xÃ¡c Ä‘á»‹nh: Ä‘á»‹nh dáº¡ng máº«u cá»§a chá»‰ má»¥c blog lÃ : <code>blog * index * timestamp</code>, dá»¯ liá»‡u tÄƒng má»—i ngÃ y. Lá»£i Ã­ch cá»§a viá»‡c lÃ m nhÆ° váº­y: khÃ´ng Ä‘á»ƒ cho sá»± tÄƒng dá»¯ liá»‡u Ä‘á»™t ngá»™t dáº«n Ä‘áº¿n má»™t chá»‰ má»¥c duy nháº¥t cÃ³ ráº¥t nhiá»u dá»¯ liá»‡u, gáº§n nhÆ° tiáº¿p cáº­n Ä‘Æ°á»ng biÃªn 2 láº§n lÅ©y thá»«a 32 -1, lÆ°u trá»¯ chá»‰ má»¥c Ä‘áº¡t Ä‘áº¿n TB+ hoáº·c tháº­m chÃ­ lá»›n hÆ¡n.</p><p>Má»™t khi má»™t chá»‰ má»¥c duy nháº¥t ráº¥t lá»›n, cÃ¡c rá»§i ro nhÆ° lÆ°u trá»¯ cÅ©ng theo sau, vÃ¬ váº­y cáº§n cÃ¢n nháº¯c trÆ°á»›c vÃ  trÃ¡nh ngay tá»« Ä‘áº§u.</p><p><strong>3.2 Vá» máº·t lÆ°u trá»¯</strong></p><p>PhÃ¢n tÃ¡ch lÆ°u trá»¯ dá»¯ liá»‡u nÃ³ng vÃ  láº¡nh, dá»¯ liá»‡u nÃ³ng (vÃ­ dá»¥: dá»¯ liá»‡u trong 3 ngÃ y hoáº·c má»™t tuáº§n gáº§n Ä‘Ã¢y), pháº§n cÃ²n láº¡i lÃ  dá»¯ liá»‡u láº¡nh.</p><p>Äá»‘i vá»›i dá»¯ liá»‡u láº¡nh khÃ´ng cÃ²n ghi thÃªm dá»¯ liá»‡u má»›i, cÃ³ thá»ƒ xem xÃ©t thá»±c hiá»‡n thao tÃ¡c force_merge vÃ  shrink Ä‘á»‹nh ká»³ Ä‘á»ƒ tiáº¿t kiá»‡m khÃ´ng gian lÆ°u trá»¯ vÃ  hiá»‡u suáº¥t tÃ¬m kiáº¿m.</p><p><strong>3.3 Vá» máº·t triá»ƒn khai</strong></p><p>Má»™t khi khÃ´ng cÃ³ káº¿ hoáº¡ch trÆ°á»›c, Ä‘Ã¢y lÃ  chiáº¿n lÆ°á»£c kháº©n cáº¥p.</p><p>Káº¿t há»£p vá»›i tÃ­nh nÄƒng má»Ÿ rá»™ng Ä‘á»™ng cá»§a ES, cÃ¡ch thÃªm mÃ¡y Ä‘á»™ng cÃ³ thá»ƒ giáº£m Ã¡p lá»±c cá»¥m, lÆ°u Ã½: náº¿u trÆ°á»›c Ä‘Ã³ káº¿ hoáº¡ch cho nÃºt chÃ­nh lÃ  há»£p lÃ½, khÃ´ng cáº§n khá»Ÿi Ä‘á»™ng láº¡i cá»¥m cÅ©ng cÃ³ thá»ƒ hoÃ n thÃ nh viá»‡c thÃªm Ä‘á»™ng.</p><h2 id="_4-elasticsearch-thuc-hien-viec-bau-chon-master-nhu-the-nao" tabindex="-1"><a class="header-anchor" href="#_4-elasticsearch-thuc-hien-viec-bau-chon-master-nhu-the-nao"><span>4. Elasticsearch thá»±c hiá»‡n viá»‡c báº§u chá»n master nhÆ° tháº¿ nÃ o</span></a></h2><p>NgÆ°á»i phá»ng váº¥n: TÃ´i muá»‘n hiá»ƒu vá» nguyÃªn lÃ½ cÆ¡ báº£n cá»§a cá»¥m ES, khÃ´ng chá»‰ táº­p trung vÃ o máº·t kinh doanh ná»¯a.</p><p>Tráº£ lá»i:</p><p>Äiá»u kiá»‡n tiÃªn quyáº¿t:</p><p>(1) Chá»‰ cÃ³ cÃ¡c nÃºt á»©ng cá»­ lÃ m master (master: true) má»›i cÃ³ thá»ƒ trá»Ÿ thÃ nh master.</p><p>(2) Sá»‘ lÆ°á»£ng master tá»‘i thiá»ƒu (min_master_nodes) cÃ³ má»¥c Ä‘Ã­ch ngÄƒn cháº·n tÃ¬nh tráº¡ng &quot;bá»™ nÃ£o bá»‹ chia cáº¯t&quot; (split-brain).</p><p>TÃ´i Ä‘Ã£ kiá»ƒm tra láº¡i mÃ£ nguá»“n, Ä‘iá»ƒm vÃ o chÃ­nh lÃ  findMaster, náº¿u viá»‡c chá»n master thÃ nh cÃ´ng thÃ¬ tráº£ vá» Master tÆ°Æ¡ng á»©ng, náº¿u khÃ´ng thÃ¬ tráº£ vá» null. Quy trÃ¬nh báº§u chá»n Ä‘Æ°á»£c mÃ´ táº£ nhÆ° sau:</p><p>BÆ°á»›c Ä‘áº§u tiÃªn: XÃ¡c nháº­n sá»‘ lÆ°á»£ng nÃºt á»©ng cá»­ lÃ m master Ä‘Ã£ Ä‘áº¡t chuáº©n, giÃ¡ trá»‹ Ä‘Æ°á»£c thiáº¿t láº­p trong elasticsearch.yml</p><p>discovery.zen.minimum_master_nodes;</p><p>BÆ°á»›c thá»© hai: So sÃ¡nh: Ä‘áº§u tiÃªn xÃ¡c Ä‘á»‹nh xem nÃºt cÃ³ Ä‘á»§ Ä‘iá»u kiá»‡n Ä‘á»ƒ lÃ m master hay khÃ´ng, náº¿u cÃ³ thÃ¬ Æ°u tiÃªn tráº£ vá»;</p><p>Náº¿u cáº£ hai nÃºt Ä‘á»u lÃ  nÃºt á»©ng cá»­ lÃ m master, thÃ¬ nÃºt cÃ³ id nhá» hÆ¡n sáº½ trá»Ÿ thÃ nh master. LÆ°u Ã½ á»Ÿ Ä‘Ã¢y id lÃ  kiá»ƒu string.</p><p>Ghi chÃº: PhÆ°Æ¡ng phÃ¡p Ä‘á»ƒ láº¥y id cá»§a nÃºt.</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>1GET /_cat/nodes?v&amp;h=ip,port,heapPercent,heapMax,id,name</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2ip port heapPercent heapMax id name</span></span></code></pre></div><h2 id="hay-mo-ta-chi-tiet-qua-trinh-elasticsearch-lap-chi-muc-cho-mot-tai-lieu" tabindex="-1"><a class="header-anchor" href="#hay-mo-ta-chi-tiet-qua-trinh-elasticsearch-lap-chi-muc-cho-mot-tai-lieu"><span>HÃ£y mÃ´ táº£ chi tiáº¿t quÃ¡ trÃ¬nh Elasticsearch láº­p chá»‰ má»¥c cho má»™t tÃ i liá»‡u</span></a></h2><p>NgÆ°á»i phá»ng váº¥n: TÃ´i muá»‘n hiá»ƒu vá» nguyÃªn lÃ½ cÆ¡ báº£n cá»§a ES, khÃ´ng chá»‰ táº­p trung vÃ o máº·t kinh doanh ná»¯a.</p><p>Tráº£ lá»i:</p><p>á» Ä‘Ã¢y, viá»‡c láº­p chá»‰ má»¥c tÃ i liá»‡u nÃªn Ä‘Æ°á»£c hiá»ƒu lÃ  quÃ¡ trÃ¬nh ghi tÃ i liá»‡u vÃ o ES, táº¡o chá»‰ má»¥c.</p><p>Viá»‡c ghi tÃ i liá»‡u bao gá»“m: ghi tÃ i liá»‡u Ä‘Æ¡n vÃ  ghi hÃ ng loáº¡t bulk, á»Ÿ Ä‘Ã¢y tÃ´i chá»‰ giáº£i thÃ­ch: quÃ¡ trÃ¬nh ghi tÃ i liá»‡u Ä‘Æ¡n.</p><p>HÃ£y nhá»› hÃ¬nh nÃ y trong tÃ i liá»‡u chÃ­nh thá»©c.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/v2-bf1b23846420eb4fdace5c6415ad7cf2_720w.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>BÆ°á»›c Ä‘áº§u tiÃªn: KhÃ¡ch hÃ ng gá»­i yÃªu cáº§u ghi dá»¯ liá»‡u vÃ o má»™t nÃºt nÃ o Ä‘Ã³ trong cá»¥m. (Náº¿u khÃ´ng chá»‰ Ä‘á»‹nh Ä‘á»‹nh tuyáº¿n/nÃºt Ä‘iá»u phá»‘i, nÃºt nháº­n yÃªu cáº§u sáº½ Ä‘Ã³ng vai trÃ² lÃ  nÃºt Ä‘á»‹nh tuyáº¿n.)</p><p>BÆ°á»›c thá»© hai: Khi nÃºt 1 nháº­n Ä‘Æ°á»£c yÃªu cáº§u, nÃ³ sá»­ dá»¥ng _id cá»§a tÃ i liá»‡u Ä‘á»ƒ xÃ¡c Ä‘á»‹nh tÃ i liá»‡u thuá»™c vá» shard 0. YÃªu cáº§u sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘áº¿n má»™t nÃºt khÃ¡c, giáº£ sá»­ lÃ  nÃºt 3. Do Ä‘Ã³, shard chÃ­nh cá»§a shard 0 Ä‘Æ°á»£c phÃ¢n bá»• trÃªn nÃºt 3.</p><p>BÆ°á»›c thá»© ba: NÃºt 3 thá»±c hiá»‡n thao tÃ¡c ghi trÃªn shard chÃ­nh, náº¿u thÃ nh cÃ´ng, nÃ³ sáº½ chuyá»ƒn yÃªu cáº§u song song Ä‘áº¿n shard phá»¥ trÃªn nÃºt 1 vÃ  nÃºt 2, chá» káº¿t quáº£ tráº£ vá». Táº¥t cáº£ shard phá»¥ Ä‘á»u bÃ¡o cÃ¡o thÃ nh cÃ´ng, nÃºt 3 sáº½ bÃ¡o cÃ¡o thÃ nh cÃ´ng cho nÃºt Ä‘iá»u phá»‘i (nÃºt 1), nÃºt 1 sáº½ bÃ¡o cÃ¡o thÃ nh cÃ´ng cho khÃ¡ch hÃ ng yÃªu cáº§u.</p><p>Náº¿u ngÆ°á»i phá»ng váº¥n há»i thÃªm: QuÃ¡ trÃ¬nh tÃ i liá»‡u láº¥y shard trong bÆ°á»›c thá»© hai lÃ  nhÆ° tháº¿ nÃ o?</p><p>Tráº£ lá»i: Sá»­ dá»¥ng thuáº­t toÃ¡n Ä‘á»‹nh tuyáº¿n Ä‘á»ƒ láº¥y, thuáº­t toÃ¡n Ä‘á»‹nh tuyáº¿n lÃ  quÃ¡ trÃ¬nh tÃ­nh toÃ¡n id shard má»¥c tiÃªu dá»±a trÃªn Ä‘á»‹nh tuyáº¿n vÃ  id tÃ i liá»‡u.</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>1shard = hash(_routing) % (num_of_primary_shards)</span></span></code></pre></div><h2 id="hay-mo-ta-chi-tiet-qua-trinh-tim-kiem-cua-elasticsearch" tabindex="-1"><a class="header-anchor" href="#hay-mo-ta-chi-tiet-qua-trinh-tim-kiem-cua-elasticsearch"><span>HÃ£y mÃ´ táº£ chi tiáº¿t quÃ¡ trÃ¬nh tÃ¬m kiáº¿m cá»§a Elasticsearch?</span></a></h2><p>NgÆ°á»i phá»ng váº¥n: TÃ´i muá»‘n hiá»ƒu vá» nguyÃªn lÃ½ cÆ¡ báº£n cá»§a ES, khÃ´ng chá»‰ táº­p trung vÃ o máº·t kinh doanh ná»¯a.</p><p>Tráº£ lá»i:</p><p>QuÃ¡ trÃ¬nh tÃ¬m kiáº¿m Ä‘Æ°á»£c chia thÃ nh hai giai Ä‘oáº¡n: &quot;query&quot; vÃ  &quot;fetch&quot;.</p><p>Má»¥c Ä‘Ã­ch cá»§a giai Ä‘oáº¡n query: xÃ¡c Ä‘á»‹nh vá»‹ trÃ­, nhÆ°ng khÃ´ng láº¥y dá»¯ liá»‡u.</p><p>CÃ¡c bÆ°á»›c Ä‘Æ°á»£c tÃ¡ch ra nhÆ° sau:</p><p>(1) Giáº£ sá»­ má»™t chá»‰ má»¥c dá»¯ liá»‡u cÃ³ 5 shard chÃ­nh + 1 shard phá»¥, tá»•ng cá»™ng 10 shard, má»—i yÃªu cáº§u sáº½ trÃºng má»™t trong cÃ¡c shard (chÃ­nh hoáº·c phá»¥).</p><p>(2) Má»—i shard thá»±c hiá»‡n truy váº¥n táº¡i cá»¥c bá»™, káº¿t quáº£ Ä‘Æ°á»£c tráº£ vá» vÃ o hÃ ng Ä‘á»£i Æ°u tiÃªn cÃ³ thá»© tá»± táº¡i cá»¥c bá»™.</p><p>(3) Káº¿t quáº£ tá»« bÆ°á»›c (2) Ä‘Æ°á»£c gá»­i Ä‘áº¿n nÃºt Ä‘iá»u phá»‘i, nÃºt Ä‘iá»u phá»‘i táº¡o ra má»™t danh sÃ¡ch sáº¯p xáº¿p toÃ n cáº§u.</p><p>Má»¥c Ä‘Ã­ch cá»§a giai Ä‘oáº¡n fetch: láº¥y dá»¯ liá»‡u.</p><p>NÃºt Ä‘á»‹nh tuyáº¿n láº¥y táº¥t cáº£ cÃ¡c tÃ i liá»‡u vÃ  tráº£ vá» cho khÃ¡ch hÃ ng.</p><h2 id="khi-trien-khai-elasticsearch-co-nhung-phuong-phap-toi-uu-hoa-nao-Ä‘oi-voi-linux" tabindex="-1"><a class="header-anchor" href="#khi-trien-khai-elasticsearch-co-nhung-phuong-phap-toi-uu-hoa-nao-Ä‘oi-voi-linux"><span>Khi triá»ƒn khai Elasticsearch, cÃ³ nhá»¯ng phÆ°Æ¡ng phÃ¡p tá»‘i Æ°u hÃ³a nÃ o Ä‘á»‘i vá»›i Linux?</span></a></h2><p>NgÆ°á»i phá»ng váº¥n: TÃ´i muá»‘n hiá»ƒu vá» kháº£ nÄƒng váº­n hÃ nh cá»¥m ES.</p><p>Tráº£ lá»i:</p><p>(1) Táº¯t bá»™ nhá»› Ä‘á»‡m swap;</p><p>(2) Äáº·t bá»™ nhá»› heap thÃ nh: Min (bá»™ nhá»›/nÃºt, 32GB);</p><p>(3) Äáº·t sá»‘ lÆ°á»£ng tá»‘i Ä‘a cá»§a file handle;</p><p>(4) KÃ­ch thÆ°á»›c cá»§a thread pool + hÃ ng Ä‘á»£i cáº§n Ä‘Æ°á»£c Ä‘iá»u chá»‰nh theo nhu cáº§u kinh doanh;</p><p>(5) PhÆ°Æ¡ng phÃ¡p lÆ°u trá»¯ á»• Ä‘Ä©a RAID - náº¿u cÃ³ Ä‘iá»u kiá»‡n, sá»­ dá»¥ng RAID10 Ä‘á»ƒ tÄƒng hiá»‡u suáº¥t cá»§a nÃºt Ä‘Æ¡n vÃ  trÃ¡nh sá»± cá»‘ lÆ°u trá»¯ á»Ÿ nÃºt Ä‘Æ¡n.</p><h2 id="cau-truc-ben-trong-cua-lucene-la-gi" tabindex="-1"><a class="header-anchor" href="#cau-truc-ben-trong-cua-lucene-la-gi"><span>Cáº¥u trÃºc bÃªn trong cá»§a Lucene lÃ  gÃ¬?</span></a></h2><p>NgÆ°á»i phá»ng váº¥n: TÃ´i muá»‘n hiá»ƒu rá»™ng vÃ  sÃ¢u vá» kiáº¿n thá»©c cá»§a báº¡n.</p><p>Tráº£ lá»i:</p><p>Lucene gá»“m hai quy trÃ¬nh chÃ­nh: táº¡o chá»‰ má»¥c vÃ  tÃ¬m kiáº¿m. CÃ³ ba khÃ­a cáº¡nh chÃ­nh: táº¡o chá»‰ má»¥c, chá»‰ má»¥c vÃ  tÃ¬m kiáº¿m. ChÃºng ta cÃ³ thá»ƒ má»Ÿ rá»™ng dá»±a trÃªn khung nÃ y.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/v2-576954e3b238870ec089d68abe0de1d4_720w.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ol><li><strong>Táº¡o chá»‰ má»¥c (Index Creation)</strong>: Äáº§u tiÃªn, Lucene sáº½ phÃ¢n tÃ­ch vÃ  xá»­ lÃ½ dá»¯ liá»‡u thÃ´, cháº³ng háº¡n nhÆ° vÄƒn báº£n, Ä‘á»ƒ táº¡o ra má»™t táº­p dá»¯ liá»‡u cÃ³ cáº¥u trÃºc cÃ³ thá»ƒ tÃ¬m kiáº¿m Ä‘Æ°á»£c.</li><li><strong>Chá»‰ má»¥c (Indexing)</strong>: Sau Ä‘Ã³, Lucene sáº½ táº¡o ra má»™t chá»‰ má»¥c tá»« dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c xá»­ lÃ½. Chá»‰ má»¥c nÃ y giá»‘ng nhÆ° má»™t &quot;má»¥c lá»¥c&quot; cho dá»¯ liá»‡u, giÃºp tÄƒng tá»‘c Ä‘á»™ tÃ¬m kiáº¿m.</li><li><strong>TÃ¬m kiáº¿m (Searching)</strong>: Khi cÃ³ yÃªu cáº§u tÃ¬m kiáº¿m, Lucene sáº½ sá»­ dá»¥ng chá»‰ má»¥c Ä‘á»ƒ nhanh chÃ³ng tÃ¬m ra káº¿t quáº£ phÃ¹ há»£p.</li></ol><p>ÄÃ¢y lÃ  cáº¥u trÃºc cÆ¡ báº£n cá»§a Lucene. Tuy nhiÃªn, Lucene cÅ©ng há»— trá»£ nhiá»u tÃ­nh nÄƒng phá»©c táº¡p hÆ¡n, cháº³ng háº¡n nhÆ° tÃ¬m kiáº¿m nÃ¢ng cao, xáº¿p háº¡ng káº¿t quáº£ vÃ  nhiá»u hÆ¡n ná»¯a.</p><h2 id="elasticsearch-lam-the-nao-Ä‘e-thuc-hien-viec-bau-chon-master" tabindex="-1"><a class="header-anchor" href="#elasticsearch-lam-the-nao-Ä‘e-thuc-hien-viec-bau-chon-master"><span>Elasticsearch lÃ m tháº¿ nÃ o Ä‘á»ƒ thá»±c hiá»‡n viá»‡c báº§u chá»n Master?</span></a></h2><p>(1) Viá»‡c báº§u chá»n Master trong Elasticsearch do mÃ´-Ä‘un ZenDiscovery chá»‹u trÃ¡ch nhiá»‡m, chá»§ yáº¿u bao gá»“m hai pháº§n: Ping (cÃ¡c nÃºt sá»­ dá»¥ng RPC nÃ y Ä‘á»ƒ phÃ¡t hiá»‡n láº«n nhau) vÃ  Unicast (mÃ´-Ä‘un Ä‘Æ¡n phÃ¡t bao gá»“m má»™t danh sÃ¡ch mÃ¡y chá»§ Ä‘á»ƒ kiá»ƒm soÃ¡t cÃ¡c nÃºt nÃ o cáº§n ping).</p><p>(2) Äá»‘i vá»›i táº¥t cáº£ cÃ¡c nÃºt cÃ³ thá»ƒ trá»Ÿ thÃ nh Master (node.master: true), sáº¯p xáº¿p theo nodeId theo thá»© tá»± tá»« Ä‘iá»ƒn. Trong má»—i láº§n báº§u cá»­, má»—i nÃºt sáº½ sáº¯p xáº¿p cÃ¡c nÃºt mÃ  nÃ³ biáº¿t theo thá»© tá»±, sau Ä‘Ã³ chá»n nÃºt Ä‘áº§u tiÃªn (vá»‹ trÃ­ thá»© 0) vÃ  táº¡m thá»i coi nÃ³ lÃ  nÃºt Master.</p><p>(3) Náº¿u sá»‘ phiáº¿u báº§u cho má»™t nÃºt Ä‘áº¡t Ä‘áº¿n má»™t giÃ¡ trá»‹ nháº¥t Ä‘á»‹nh (sá»‘ nÃºt cÃ³ thá»ƒ trá»Ÿ thÃ nh Master lÃ  n/2 + 1) vÃ  nÃºt Ä‘Ã³ cÅ©ng tá»± báº§u chá»n mÃ¬nh, thÃ¬ nÃºt Ä‘Ã³ sáº½ trá»Ÿ thÃ nh Master. NgÆ°á»£c láº¡i, quÃ¡ trÃ¬nh báº§u cá»­ sáº½ tiáº¿p tá»¥c cho Ä‘áº¿n khi Ä‘áº¡t Ä‘Æ°á»£c Ä‘iá»u kiá»‡n trÃªn.</p><p>(4) Bá»• sung: TrÃ¡ch nhiá»‡m chÃ­nh cá»§a nÃºt Master bao gá»“m viá»‡c quáº£n lÃ½ cá»¥m, nÃºt vÃ  chá»‰ má»¥c, khÃ´ng chá»‹u trÃ¡ch nhiá»‡m quáº£n lÃ½ á»Ÿ cáº¥p Ä‘á»™ tÃ i liá»‡u; nÃºt data cÃ³ thá»ƒ táº¯t chá»©c nÄƒng http*.</p><h2 id="_10-trong-elasticsearch-co-cac-nut-vi-du-tong-cong-20-nut-trong-Ä‘o-10-nut-Ä‘a-chon-mot-master-10-nut-con-lai-Ä‘a-chon-mot-master-khac-thi-phai-lam-the-nao" tabindex="-1"><a class="header-anchor" href="#_10-trong-elasticsearch-co-cac-nut-vi-du-tong-cong-20-nut-trong-Ä‘o-10-nut-Ä‘a-chon-mot-master-10-nut-con-lai-Ä‘a-chon-mot-master-khac-thi-phai-lam-the-nao"><span>10. Trong Elasticsearch cÃ³ cÃ¡c nÃºt (vÃ­ dá»¥ tá»•ng cá»™ng 20 nÃºt), trong Ä‘Ã³ 10 nÃºt Ä‘Ã£ chá»n má»™t Master, 10 nÃºt cÃ²n láº¡i Ä‘Ã£ chá»n má»™t Master khÃ¡c, thÃ¬ pháº£i lÃ m tháº¿ nÃ o?</span></a></h2><p>(1) Khi sá»‘ lÆ°á»£ng á»©ng cá»­ viÃªn Master cá»§a cá»¥m khÃ´ng Ã­t hÆ¡n 3, báº¡n cÃ³ thá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» phÃ¢n Ä‘Ã´i báº±ng cÃ¡ch Ä‘áº·t sá»‘ lÆ°á»£ng phiáº¿u tá»‘i thiá»ƒu Ä‘á»ƒ thÃ´ng qua (discovery.zen.minimum_master_nodes) nhiá»u hÆ¡n má»™t ná»­a sá»‘ lÆ°á»£ng á»©ng cá»­ viÃªn.</p><p>(3) Khi sá»‘ lÆ°á»£ng á»©ng cá»­ viÃªn lÃ  hai, báº¡n chá»‰ cÃ³ thá»ƒ chá»‰nh sá»­a Ä‘á»ƒ cÃ³ má»™t á»©ng cá»­ viÃªn Master duy nháº¥t, cÃ¡c nÃºt khÃ¡c hoáº¡t Ä‘á»™ng nhÆ° nÃºt dá»¯ liá»‡u, Ä‘á»ƒ trÃ¡nh váº¥n Ä‘á» phÃ¢n Ä‘Ã´i.</p><h2 id="khi-ket-noi-voi-cum-khach-hang-chon-nut-cu-the-nao-Ä‘e-thuc-hien-yeu-cau" tabindex="-1"><a class="header-anchor" href="#khi-ket-noi-voi-cum-khach-hang-chon-nut-cu-the-nao-Ä‘e-thuc-hien-yeu-cau"><span>Khi káº¿t ná»‘i vá»›i cá»¥m, khÃ¡ch hÃ ng chá»n nÃºt cá»¥ thá»ƒ nÃ o Ä‘á»ƒ thá»±c hiá»‡n yÃªu cáº§u?</span></a></h2><p>TransportClient sá»­ dá»¥ng mÃ´-Ä‘un transport Ä‘á»ƒ káº¿t ná»‘i tá»« xa vá»›i má»™t cá»¥m Elasticsearch. NÃ³ khÃ´ng tham gia vÃ o cá»¥m, chá»‰ Ä‘Æ¡n giáº£n lÃ  nháº­n Ä‘Æ°á»£c má»™t hoáº·c nhiá»u Ä‘á»‹a chá»‰ transport khá»Ÿi táº¡o vÃ  giao tiáº¿p vá»›i cÃ¡c Ä‘á»‹a chá»‰ nÃ y theo cÃ¡ch láº­p lá»‹ch.</p><h2 id="mo-ta-chi-tiet-qua-trinh-elasticsearch-lap-chi-muc-cho-tai-lieu" tabindex="-1"><a class="header-anchor" href="#mo-ta-chi-tiet-qua-trinh-elasticsearch-lap-chi-muc-cho-tai-lieu"><span>MÃ´ táº£ chi tiáº¿t quÃ¡ trÃ¬nh Elasticsearch láº­p chá»‰ má»¥c cho tÃ i liá»‡u.</span></a></h2><p>NÃºt Ä‘iá»u phá»‘i máº·c Ä‘á»‹nh sá»­ dá»¥ng ID tÃ i liá»‡u Ä‘á»ƒ tham gia vÃ o tÃ­nh toÃ¡n (cÅ©ng há»— trá»£ thÃ´ng qua routing), Ä‘á»ƒ cung cáº¥p má»™t phÃ¢n Ä‘oáº¡n phÃ¹ há»£p cho Ä‘á»‹nh tuyáº¿n.</p><div class="language-text" data-highlighter="shiki" data-ext="text" data-title="text" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>shard = hash(document_id) % (num_of_primary_shards)</span></span></code></pre></div><p>(1) Khi nÃºt chá»©a phÃ¢n Ä‘oáº¡n nháº­n Ä‘Æ°á»£c yÃªu cáº§u tá»« nÃºt Ä‘iá»u phá»‘i, nÃ³ sáº½ ghi yÃªu cáº§u vÃ o MemoryBuffer, sau Ä‘Ã³ Ä‘á»‹nh ká»³ (máº·c Ä‘á»‹nh lÃ  má»—i giÃ¢y) ghi vÃ o Filesystem Cache, quÃ¡ trÃ¬nh tá»« MomeryBuffer sang Filesystem Cache nÃ y Ä‘Æ°á»£c gá»i lÃ  refresh.</p><p>(2) Táº¥t nhiÃªn, trong má»™t sá»‘ trÆ°á»ng há»£p, dá»¯ liá»‡u tá»“n táº¡i trong Momery Buffer vÃ  Filesystem Cache cÃ³ thá»ƒ bá»‹ máº¥t, ES sá»­ dá»¥ng cÆ¡ cháº¿ translog Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh Ä‘Ã¡ng tin cáº­y cá»§a dá»¯ liá»‡u. CÆ¡ cháº¿ thá»±c hiá»‡n lÃ  sau khi nháº­n Ä‘Æ°á»£c yÃªu cáº§u, cÅ©ng sáº½ ghi vÃ o translog, khi dá»¯ liá»‡u trong Filesystem cache Ä‘Æ°á»£c ghi vÃ o Ä‘Ä©a, má»›i Ä‘Æ°á»£c xÃ³a, quÃ¡ trÃ¬nh nÃ y Ä‘Æ°á»£c gá»i lÃ  flush.</p><p>(3) Trong quÃ¡ trÃ¬nh flush, bá»™ Ä‘á»‡m trong bá»™ nhá»› sáº½ Ä‘Æ°á»£c xÃ³a, ná»™i dung Ä‘Æ°á»£c ghi vÃ o má»™t phÃ¢n Ä‘oáº¡n má»›i, fsync cá»§a phÃ¢n Ä‘oáº¡n sáº½ táº¡o má»™t Ä‘iá»ƒm commit má»›i vÃ  lÃ m má»›i ná»™i dung vÃ o Ä‘Ä©a, translog cÅ© sáº½ bá»‹ xÃ³a vÃ  báº¯t Ä‘áº§u má»™t translog má»›i.</p><p>(4) Thá»i Ä‘iá»ƒm kÃ­ch hoáº¡t flush lÃ  Ä‘á»‹nh ká»³ (máº·c Ä‘á»‹nh 30 phÃºt) hoáº·c khi translog trá»Ÿ nÃªn quÃ¡ lá»›n (máº·c Ä‘á»‹nh lÃ  512M).</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/v2-5e0c4bfbd57a4fae4895c480aaaa0a37_720w.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>Bá»• sung: Vá» Segement cá»§a Lucene:</p><p>(1) Chá»‰ má»¥c Lucene Ä‘Æ°á»£c táº¡o thÃ nh tá»« nhiá»u phÃ¢n Ä‘oáº¡n, má»—i phÃ¢n Ä‘oáº¡n lÃ  má»™t chá»‰ má»¥c nghá»‹ch Ä‘áº£o Ä‘áº§y Ä‘á»§ chá»©c nÄƒng.</p><p>(2) PhÃ¢n Ä‘oáº¡n lÃ  báº¥t biáº¿n, cho phÃ©p Lucene thÃªm tÃ i liá»‡u má»›i vÃ o chá»‰ má»¥c má»™t cÃ¡ch tÄƒng dáº§n mÃ  khÃ´ng cáº§n xÃ¢y dá»±ng láº¡i chá»‰ má»¥c tá»« Ä‘áº§u.</p><p>(3) Äá»‘i vá»›i má»—i yÃªu cáº§u tÃ¬m kiáº¿m, táº¥t cáº£ cÃ¡c phÃ¢n Ä‘oáº¡n trong chá»‰ má»¥c sáº½ Ä‘Æ°á»£c tÃ¬m kiáº¿m, vÃ  má»—i phÃ¢n Ä‘oáº¡n sáº½ tiÃªu thá»¥ chu ká»³ Ä‘á»“ng há»“ CPU, tay cáº§m tá»‡p vÃ  bá»™ nhá»›. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  cÃ ng nhiá»u phÃ¢n Ä‘oáº¡n, hiá»‡u suáº¥t tÃ¬m kiáº¿m sáº½ cÃ ng tháº¥p.</p><p>(4) Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y, Elasticsearch sáº½ há»£p nháº¥t cÃ¡c phÃ¢n Ä‘oáº¡n nhá» vÃ o má»™t phÃ¢n Ä‘oáº¡n lá»›n hÆ¡n, gá»­i phÃ¢n Ä‘oáº¡n há»£p nháº¥t má»›i Ä‘áº¿n Ä‘Ä©a, vÃ  xÃ³a cÃ¡c phÃ¢n Ä‘oáº¡n nhá» cÅ©.</p><h2 id="mo-ta-chi-tiet-qua-trinh-elasticsearch-cap-nhat-va-xoa-tai-lieu" tabindex="-1"><a class="header-anchor" href="#mo-ta-chi-tiet-qua-trinh-elasticsearch-cap-nhat-va-xoa-tai-lieu"><span>MÃ´ táº£ chi tiáº¿t quÃ¡ trÃ¬nh Elasticsearch cáº­p nháº­t vÃ  xÃ³a tÃ i liá»‡u.</span></a></h2><p>(1) XÃ³a vÃ  cáº­p nháº­t Ä‘á»u lÃ  cÃ¡c thao tÃ¡c ghi, nhÆ°ng tÃ i liá»‡u trong Elasticsearch lÃ  báº¥t biáº¿n, do Ä‘Ã³ khÃ´ng thá»ƒ bá»‹ xÃ³a hoáº·c thay Ä‘á»•i Ä‘á»ƒ thá»ƒ hiá»‡n sá»± thay Ä‘á»•i cá»§a nÃ³;</p><p>(2) Má»—i phÃ¢n Ä‘oáº¡n trÃªn Ä‘Ä©a Ä‘á»u cÃ³ má»™t tá»‡p .del tÆ°Æ¡ng á»©ng. Khi yÃªu cáº§u xÃ³a Ä‘Æ°á»£c gá»­i, tÃ i liá»‡u khÃ´ng bá»‹ xÃ³a tháº­t sá»±, mÃ  chá»‰ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  Ä‘Ã£ xÃ³a trong tá»‡p .del. TÃ i liá»‡u váº«n cÃ³ thá»ƒ khá»›p vá»›i truy váº¥n, nhÆ°ng sáº½ bá»‹ lá»c ra khá»i káº¿t quáº£. Khi cÃ¡c phÃ¢n Ä‘oáº¡n Ä‘Æ°á»£c há»£p nháº¥t, tÃ i liá»‡u Ä‘Ã£ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  Ä‘Ã£ xÃ³a trong tá»‡p .del sáº½ khÃ´ng Ä‘Æ°á»£c ghi vÃ o phÃ¢n Ä‘oáº¡n má»›i.</p><p>(3) Khi táº¡o tÃ i liá»‡u má»›i, Elasticsearch sáº½ gÃ¡n má»™t sá»‘ phiÃªn báº£n cho tÃ i liá»‡u Ä‘Ã³, khi thá»±c hiá»‡n cáº­p nháº­t, phiÃªn báº£n cÅ© cá»§a tÃ i liá»‡u Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  Ä‘Ã£ xÃ³a trong tá»‡p .del, phiÃªn báº£n má»›i cá»§a tÃ i liá»‡u Ä‘Æ°á»£c láº­p chá»‰ má»¥c vÃ o má»™t phÃ¢n Ä‘oáº¡n má»›i. PhiÃªn báº£n cÅ© cá»§a tÃ i liá»‡u váº«n cÃ³ thá»ƒ khá»›p vá»›i truy váº¥n, nhÆ°ng sáº½ bá»‹ lá»c ra khá»i káº¿t quáº£.</p><h2 id="mo-ta-chi-tiet-qua-trinh-tim-kiem-cua-elasticsearch" tabindex="-1"><a class="header-anchor" href="#mo-ta-chi-tiet-qua-trinh-tim-kiem-cua-elasticsearch"><span>MÃ´ táº£ chi tiáº¿t quÃ¡ trÃ¬nh tÃ¬m kiáº¿m cá»§a Elasticsearch.</span></a></h2><p>(1) TÃ¬m kiáº¿m Ä‘Æ°á»£c thá»±c hiá»‡n theo má»™t quy trÃ¬nh hai giai Ä‘oáº¡n, chÃºng tÃ´i gá»i nÃ³ lÃ  Query Then Fetch;</p><p>(2) Trong giai Ä‘oáº¡n truy váº¥n ban Ä‘áº§u, truy váº¥n sáº½ Ä‘Æ°á»£c phÃ¡t sÃ³ng Ä‘áº¿n má»—i báº£n sao phÃ¢n Ä‘oáº¡n trong chá»‰ má»¥c (phÃ¢n Ä‘oáº¡n chÃ­nh hoáº·c phÃ¢n Ä‘oáº¡n sao chÃ©p). Má»—i phÃ¢n Ä‘oáº¡n thá»±c hiá»‡n tÃ¬m kiáº¿m cá»¥c bá»™ vÃ  xÃ¢y dá»±ng má»™t hÃ ng Ä‘á»£i Æ°u tiÃªn cÃ³ kÃ­ch thÆ°á»›c lÃ  from + size cho tÃ i liá»‡u khá»›p.</p><p>LÆ°u Ã½: Khi tÃ¬m kiáº¿m, nÃ³ sáº½ truy váº¥n Filesystem Cache, nhÆ°ng má»™t sá»‘ dá»¯ liá»‡u váº«n cÃ²n trong MemoryBuffer, vÃ¬ váº­y tÃ¬m kiáº¿m lÃ  gáº§n thá»i gian thá»±c.</p><p>(3) Má»—i phÃ¢n Ä‘oáº¡n tráº£ vá» ID vÃ  giÃ¡ trá»‹ sáº¯p xáº¿p cá»§a táº¥t cáº£ cÃ¡c tÃ i liá»‡u trong hÃ ng Ä‘á»£i Æ°u tiÃªn cá»§a mÃ¬nh cho nÃºt Ä‘iá»u phá»‘i, nÃ³ há»£p nháº¥t cÃ¡c giÃ¡ trá»‹ nÃ y vÃ o hÃ ng Ä‘á»£i Æ°u tiÃªn cá»§a mÃ¬nh Ä‘á»ƒ táº¡o ra má»™t danh sÃ¡ch káº¿t quáº£ Ä‘Ã£ sáº¯p xáº¿p toÃ n cáº§u.</p><p>(4) Tiáº¿p theo lÃ  giai Ä‘oáº¡n láº¥y, nÃºt Ä‘iá»u phá»‘i xÃ¡c Ä‘á»‹nh nhá»¯ng tÃ i liá»‡u nÃ o cáº§n Ä‘Æ°á»£c láº¥y vÃ  gá»­i nhiá»u yÃªu cáº§u GET Ä‘áº¿n cÃ¡c phÃ¢n Ä‘oáº¡n liÃªn quan. Má»—i phÃ¢n Ä‘oáº¡n táº£i vÃ  lÃ m giÃ u tÃ i liá»‡u, náº¿u cáº§n, sau Ä‘Ã³ tráº£ láº¡i tÃ i liá»‡u cho nÃºt Ä‘iá»u phá»‘i. Má»™t khi táº¥t cáº£ cÃ¡c tÃ i liá»‡u Ä‘Ã£ Ä‘Æ°á»£c láº¥y, nÃºt Ä‘iá»u phá»‘i tráº£ káº¿t quáº£ cho khÃ¡ch hÃ ng.</p><p>(5) Bá»• sung: Loáº¡i tÃ¬m kiáº¿m Query Then Fetch tham chiáº¿u Ä‘áº¿n dá»¯ liá»‡u phÃ¢n Ä‘oáº¡n cá»¥c bá»™ khi Ä‘iá»ƒm sá»‘ liÃªn quan Ä‘áº¿n tÃ i liá»‡u, Ä‘iá»u nÃ y cÃ³ thá»ƒ khÃ´ng chÃ­nh xÃ¡c khi sá»‘ lÆ°á»£ng tÃ i liá»‡u nhá», DFS Query Then Fetch thÃªm má»™t xá»­ lÃ½ truy váº¥n trÆ°á»›c, há»i vá» Term vÃ  Document frequency, Ä‘iá»ƒm sá»‘ nÃ y chÃ­nh xÃ¡c hÆ¡n, nhÆ°ng hiá»‡u suáº¥t sáº½ giáº£m.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/v2-4c25616e623de2aee23bd63ec22a5bfd_720w.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="trong-elasticsearch-lam-the-nao-Ä‘e-tim-thay-chi-muc-nghich-Ä‘ao-tuong-ung-voi-mot-tu" tabindex="-1"><a class="header-anchor" href="#trong-elasticsearch-lam-the-nao-Ä‘e-tim-thay-chi-muc-nghich-Ä‘ao-tuong-ung-voi-mot-tu"><span>Trong Elasticsearch, lÃ m tháº¿ nÃ o Ä‘á»ƒ tÃ¬m tháº¥y chá»‰ má»¥c nghá»‹ch Ä‘áº£o tÆ°Æ¡ng á»©ng vá»›i má»™t tá»«?</span></a></h2><p>(1) QuÃ¡ trÃ¬nh láº­p chá»‰ má»¥c cá»§a Lucene, lÃ  quÃ¡ trÃ¬nh viáº¿t báº£ng nghá»‹ch Ä‘áº£o theo Ä‘á»‹nh dáº¡ng tá»‡p nÃ y theo quy trÃ¬nh cÆ¡ báº£n cá»§a tÃ¬m kiáº¿m toÃ n vÄƒn.</p><p>(2) QuÃ¡ trÃ¬nh tÃ¬m kiáº¿m cá»§a Lucene, lÃ  quÃ¡ trÃ¬nh Ä‘á»c thÃ´ng tin Ä‘Ã£ Ä‘Æ°á»£c láº­p chá»‰ má»¥c vÃ o tá»‡p nÃ y theo Ä‘á»‹nh dáº¡ng nÃ y, sau Ä‘Ã³ tÃ­nh Ä‘iá»ƒm (score) cho má»—i tÃ i liá»‡u.</p><h2 id="khi-trien-khai-elasticsearch-phuong-phap-toi-uu-hoa-nao-co-the-ap-dung-cho-linux" tabindex="-1"><a class="header-anchor" href="#khi-trien-khai-elasticsearch-phuong-phap-toi-uu-hoa-nao-co-the-ap-dung-cho-linux"><span>Khi triá»ƒn khai Elasticsearch, phÆ°Æ¡ng phÃ¡p tá»‘i Æ°u hÃ³a nÃ o cÃ³ thá»ƒ Ã¡p dá»¥ng cho Linux?</span></a></h2><p>(1) MÃ¡y cÃ³ bá»™ nhá»› 64 GB lÃ  lÃ½ tÆ°á»Ÿng nháº¥t, nhÆ°ng mÃ¡y cÃ³ bá»™ nhá»› 32 GB vÃ  16 GB cÅ©ng ráº¥t phá»• biáº¿n. MÃ¡y cÃ³ bá»™ nhá»› dÆ°á»›i 8 GB sáº½ khÃ´ng hiá»‡u quáº£.</p><p>(2) Náº¿u báº¡n pháº£i lá»±a chá»n giá»¯a CPU nhanh hÆ¡n vÃ  nhiá»u nhÃ¢n hÆ¡n, hÃ£y chá»n nhiá»u nhÃ¢n hÆ¡n. Sá»± song song hÃ³a do nhiá»u nhÃ¢n mang láº¡i sáº½ vÆ°á»£t trá»™i hÆ¡n nhiá»u so vá»›i tá»‘c Ä‘á»™ xung nhá»‹p nhanh hÆ¡n má»™t chÃºt.</p><p>(3) Náº¿u báº¡n cÃ³ thá»ƒ chi tráº£ cho SSD, nÃ³ sáº½ vÆ°á»£t trá»™i hÆ¡n báº¥t ká»³ phÆ°Æ¡ng tiá»‡n quay nÃ o. NÃºt dá»±a trÃªn SSD, cáº£ hiá»‡u suáº¥t truy váº¥n vÃ  chá»‰ má»¥c Ä‘á»u Ä‘Æ°á»£c cáº£i thiá»‡n. Náº¿u báº¡n cÃ³ thá»ƒ chi tráº£, SSD lÃ  má»™t lá»±a chá»n tá»‘t.</p><p>(4) Ká»ƒ cáº£ khi cÃ¡c trung tÃ¢m dá»¯ liá»‡u gáº§n nhau, cÅ©ng nÃªn trÃ¡nh triá»ƒn khai cá»¥m trÃªn nhiá»u trung tÃ¢m dá»¯ liá»‡u. HÃ£y hoÃ n toÃ n trÃ¡nh cá»¥m tráº£i qua khoáº£ng cÃ¡ch Ä‘á»‹a lÃ½ lá»›n.</p><p>(5) HÃ£y Ä‘áº£m báº£o ráº±ng JVM cháº¡y á»©ng dá»¥ng cá»§a báº¡n vÃ  JVM cá»§a mÃ¡y chá»§ hoÃ n toÃ n giá»‘ng nhau. Elasticsearch sá»­ dá»¥ng tuáº§n tá»± hÃ³a gá»‘c Java á»Ÿ má»™t sá»‘ nÆ¡i.</p><p>(6) Báº±ng cÃ¡ch thiáº¿t láº­p gateway.recover_after_nodes, gateway.expected_nodes, gateway.recover_after_time, báº¡n cÃ³ thá»ƒ trÃ¡nh trao Ä‘á»•i quÃ¡ nhiá»u phÃ¢n Ä‘oáº¡n khi khá»Ÿi Ä‘á»™ng láº¡i cá»¥m, Ä‘iá»u nÃ y cÃ³ thá»ƒ giáº£m thá»i gian khÃ´i phá»¥c dá»¯ liá»‡u tá»« má»™t vÃ i giá» xuá»‘ng chá»‰ vÃ i giÃ¢y.</p><p>(7) Elasticsearch máº·c Ä‘á»‹nh Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘á»ƒ sá»­ dá»¥ng khÃ¡m phÃ¡ unicast Ä‘á»ƒ trÃ¡nh viá»‡c cÃ¡c nÃºt khÃ´ng mong muá»‘n tham gia vÃ o cá»¥m. Chá»‰ cÃ³ cÃ¡c nÃºt cháº¡y trÃªn cÃ¹ng má»™t mÃ¡y má»›i tá»± Ä‘á»™ng táº¡o thÃ nh má»™t cá»¥m. NÃªn sá»­ dá»¥ng unicast thay vÃ¬ multicast.</p><p>(8) Äá»«ng thay Ä‘á»•i kÃ­ch thÆ°á»›c cá»§a thu gom rÃ¡c (CMS) vÃ  cÃ¡c há»“ bÆ¡i luá»“ng má»™t cÃ¡ch tÃ¹y tiá»‡n.</p><p>(9) ÄÆ°a má»™t ná»­a (hoáº·c Ã­t hÆ¡n) bá»™ nhá»› cá»§a báº¡n cho Lucene (nhÆ°ng khÃ´ng quÃ¡ 32 GB!), thÃ´ng qua biáº¿n mÃ´i trÆ°á»ng ES_HEAP_SIZE.</p><p>(10) Viá»‡c trao Ä‘á»•i bá»™ nhá»› sang Ä‘Ä©a lÃ  cháº¿t ngÆ°á»i Ä‘á»‘i vá»›i hiá»‡u suáº¥t mÃ¡y chá»§. Náº¿u bá»™ nhá»› Ä‘Æ°á»£c trao Ä‘á»•i sang Ä‘Ä©a, má»™t hoáº¡t Ä‘á»™ng 100 microsecond cÃ³ thá»ƒ trá»Ÿ thÃ nh 10 millisecond. HÃ£y nghÄ© vá» viá»‡c cá»™ng dá»“n Ä‘á»™ trá»… cá»§a nhiá»u hoáº¡t Ä‘á»™ng 10 microsecond. KhÃ´ng khÃ³ Ä‘á»ƒ tháº¥y swapping lÃ  má»™t ná»—i kinh hoÃ ng Ä‘á»‘i vá»›i hiá»‡u suáº¥t.</p><p>(11) Lucene sá»­ dá»¥ng ráº¥t nhiá»u tá»‡p. Äá»“ng thá»i, Elasticsearch cÅ©ng sá»­ dá»¥ng ráº¥t nhiá»u socket Ä‘á»ƒ giao tiáº¿p giá»¯a cÃ¡c nÃºt vÃ  HTTP Client. Táº¥t cáº£ nhá»¯ng Ä‘iá»u nÃ y Ä‘á»u yÃªu cáº§u Ä‘á»§ sá»‘ lÆ°á»£ng mÃ´ táº£ tá»‡p. Báº¡n nÃªn tÄƒng sá»‘ lÆ°á»£ng mÃ´ táº£ tá»‡p cá»§a mÃ¬nh, Ä‘áº·t má»™t giÃ¡ trá»‹ lá»›n, nhÆ° 64,000.</p><p>Bá»• sung: PhÆ°Æ¡ng phÃ¡p tÄƒng cÆ°á»ng hiá»‡u suáº¥t trong giai Ä‘oáº¡n chá»‰ má»¥c</p><p>(1) Sá»­ dá»¥ng yÃªu cáº§u hÃ ng loáº¡t vÃ  Ä‘iá»u chá»‰nh kÃ­ch thÆ°á»›c cá»§a nÃ³: Má»—i lÃ´ dá»¯ liá»‡u tá»« 5-15 MB lÃ  má»™t Ä‘iá»ƒm báº¯t Ä‘áº§u tá»‘t.</p><p>(2) LÆ°u trá»¯: Sá»­ dá»¥ng SSD</p><p>(3) PhÃ¢n Ä‘oáº¡n vÃ  há»£p nháº¥t: Elasticsearch máº·c Ä‘á»‹nh lÃ  20 MB/s, Ä‘á»‘i vá»›i Ä‘Ä©a cÆ¡ há»c, Ä‘Ã¢y cÃ³ thá»ƒ lÃ  má»™t cÃ i Ä‘áº·t tá»‘t. Náº¿u báº¡n sá»­ dá»¥ng SSD, báº¡n cÃ³ thá»ƒ cÃ¢n nháº¯c tÄƒng lÃªn 100-200 MB/s. Náº¿u báº¡n Ä‘ang thá»±c hiá»‡n nháº­p hÃ ng loáº¡t, hoÃ n toÃ n khÃ´ng quan tÃ¢m Ä‘áº¿n tÃ¬m kiáº¿m, báº¡n cÃ³ thá»ƒ táº¯t hoÃ n toÃ n giá»›i háº¡n há»£p nháº¥t. NgoÃ i ra, báº¡n cÅ©ng cÃ³ thá»ƒ tÄƒng thiáº¿t láº­p index.translog.flush_threshold_size tá»« máº·c Ä‘á»‹nh lÃ  512 MB lÃªn má»™t giÃ¡ trá»‹ lá»›n hÆ¡n, nhÆ° 1 GB, Ä‘iá»u nÃ y cÃ³ thá»ƒ táº¡o ra phÃ¢n Ä‘oáº¡n lá»›n hÆ¡n trong nháº­t kÃ½ giao dá»‹ch má»—i khi xáº£y ra xáº£y ra má»™t láº§n xáº£.</p><p>(4) Náº¿u káº¿t quáº£ tÃ¬m kiáº¿m cá»§a báº¡n khÃ´ng cáº§n Ä‘á»™ chÃ­nh xÃ¡c gáº§n thá»i gian thá»±c, hÃ£y xem xÃ©t thay Ä‘á»•i index.refresh_interval cá»§a má»—i chá»‰ má»¥c thÃ nh 30s.</p><p>(5) Náº¿u báº¡n Ä‘ang thá»±c hiá»‡n nháº­p hÃ ng loáº¡t, hÃ£y xem xÃ©t táº¯t báº£n sao báº±ng cÃ¡ch Ä‘áº·t index.number_of_replicas: 0.</p><h2 id="Ä‘oi-voi-gc-Ä‘ieu-gi-can-chu-y-khi-su-dung-elasticsearch" tabindex="-1"><a class="header-anchor" href="#Ä‘oi-voi-gc-Ä‘ieu-gi-can-chu-y-khi-su-dung-elasticsearch"><span>Äá»‘i vá»›i GC, Ä‘iá»u gÃ¬ cáº§n chÃº Ã½ khi sá»­ dá»¥ng Elasticsearch?</span></a></h2><p>(1) Chá»‰ má»¥c tá»« nghá»‹ch Ä‘áº£o cáº§n pháº£i cá»‘ Ä‘á»‹nh trong bá»™ nhá»›, khÃ´ng thá»ƒ GC, cáº§n giÃ¡m sÃ¡t xu hÆ°á»›ng tÄƒng segmentmemory trÃªn data node.</p><p>(2) CÃ¡c loáº¡i bá»™ nhá»› Ä‘á»‡m, field cache, filter cache, indexing cache, bulk queue, v.v., nÃªn Ä‘Æ°á»£c Ä‘áº·t kÃ­ch thÆ°á»›c há»£p lÃ½, vÃ  nÃªn dá»±a vÃ o trÆ°á»ng há»£p xáº¥u nháº¥t Ä‘á»ƒ xem liá»‡u heap cÃ³ Ä‘á»§ khÃ´ng, tá»©c lÃ  khi táº¥t cáº£ cÃ¡c loáº¡i bá»™ nhá»› Ä‘á»‡m Ä‘á»u Ä‘Æ°á»£c sá»­ dá»¥ng háº¿t, liá»‡u váº«n cÃ²n khÃ´ng gian heap Ä‘á»ƒ cáº¥p phÃ¡t cho nhiá»‡m vá»¥ khÃ¡c khÃ´ng? TrÃ¡nh viá»‡c sá»­ dá»¥ng phÆ°Æ¡ng phÃ¡p nhÆ° clear cache Ä‘á»ƒ giáº£i phÃ³ng bá»™ nhá»›.</p><p>(3) TrÃ¡nh tÃ¬m kiáº¿m vÃ  tá»•ng há»£p tráº£ vá» má»™t lÆ°á»£ng lá»›n káº¿t quáº£. Trong nhá»¯ng tÃ¬nh huá»‘ng thá»±c sá»± cáº§n rÃºt lá»›n dá»¯ liá»‡u, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng scan &amp; scroll api Ä‘á»ƒ thá»±c hiá»‡n.</p><p>(4) Cluster stats Ä‘Æ°á»£c giá»¯ trong bá»™ nhá»› vÃ  khÃ´ng thá»ƒ má»Ÿ rá»™ng theo chiá»u ngang, cá»¥m quy mÃ´ siÃªu lá»›n cÃ³ thá»ƒ xem xÃ©t chia thÃ nh nhiá»u cá»¥m thÃ´ng qua tribe node.</p><p>(5) Muá»‘n biáº¿t heap cÃ³ Ä‘á»§ khÃ´ng, báº¡n pháº£i káº¿t há»£p vá»›i tÃ¬nh huá»‘ng á»©ng dá»¥ng thá»±c táº¿, vÃ  tiáº¿p tá»¥c giÃ¡m sÃ¡t viá»‡c sá»­ dá»¥ng heap cá»§a cá»¥m.</p><p>(6) Dá»±a vÃ o dá»¯ liá»‡u giÃ¡m sÃ¡t Ä‘á»ƒ hiá»ƒu nhu cáº§u vá» bá»™ nhá»›, cáº¥u hÃ¬nh há»£p lÃ½ cho cÃ¡c loáº¡i circuit breaker, giáº£m thiá»ƒu rá»§i ro trÃ n bá»™ nhá»› xuá»‘ng má»©c tháº¥p nháº¥t.</p><h2 id="_18-elasticsearch-lam-the-nao-Ä‘e-thuc-hien-tong-hop-so-luong-lon-du-lieu-hang-ty" tabindex="-1"><a class="header-anchor" href="#_18-elasticsearch-lam-the-nao-Ä‘e-thuc-hien-tong-hop-so-luong-lon-du-lieu-hang-ty"><span>18. Elasticsearch lÃ m tháº¿ nÃ o Ä‘á»ƒ thá»±c hiá»‡n tá»•ng há»£p sá»‘ lÆ°á»£ng lá»›n dá»¯ liá»‡u (hÃ ng tá»·)?</span></a></h2><p>Elasticsearch cung cáº¥p má»™t loáº¡i tá»•ng há»£p gáº§n Ä‘Ãºng gá»i lÃ  cardinality. NÃ³ cung cáº¥p sá»‘ lÆ°á»£ng giÃ¡ trá»‹ duy nháº¥t (distinct hoáº·c unique) cá»§a má»™t trÆ°á»ng. Äiá»u nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n dá»±a trÃªn thuáº­t toÃ¡n HyperLogLog (HLL). HLL sáº½ Ä‘áº§u tiÃªn thá»±c hiá»‡n cÃ¡c phÃ©p tÃ­nh bÄƒm trÃªn Ä‘áº§u vÃ o, sau Ä‘Ã³ dá»±a vÃ o cÃ¡c bit trong káº¿t quáº£ bÄƒm Ä‘á»ƒ Æ°á»›c lÆ°á»£ng xÃ¡c suáº¥t vÃ  thu Ä‘Æ°á»£c sá»‘ lÆ°á»£ng giÃ¡ trá»‹ duy nháº¥t. Nhá»¯ng Ä‘áº·c Ä‘iá»ƒm cá»§a nÃ³ bao gá»“m:</p><ul><li>Äá»™ chÃ­nh xÃ¡c cÃ³ thá»ƒ cáº¥u hÃ¬nh, Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ kiá»ƒm soÃ¡t viá»‡c sá»­ dá»¥ng bá»™ nhá»› (Ä‘á»™ chÃ­nh xÃ¡c cao hÆ¡n = sá»­ dá»¥ng nhiá»u bá»™ nhá»› hÆ¡n).</li><li>Äá»‘i vá»›i táº­p dá»¯ liá»‡u nhá», Ä‘á»™ chÃ­nh xÃ¡c ráº¥t cao.</li><li>Báº¡n cÃ³ thá»ƒ Ä‘áº·t sá»‘ lÆ°á»£ng bá»™ nhá»› cá»‘ Ä‘á»‹nh cáº§n thiáº¿t cho viá»‡c loáº¡i bá» trÃ¹ng láº·p thÃ´ng qua cÃ¡c tham sá»‘ cáº¥u hÃ¬nh. Báº¥t ká»ƒ sá»‘ lÆ°á»£ng giÃ¡ trá»‹ duy nháº¥t lÃ  hÃ ng nghÃ¬n hay hÃ ng tá»·, lÆ°á»£ng bá»™ nhá»› sá»­ dá»¥ng chá»‰ liÃªn quan Ä‘áº¿n Ä‘á»™ chÃ­nh xÃ¡c báº¡n cáº¥u hÃ¬nh.</li></ul><h2 id="_19-trong-tinh-huong-Ä‘ong-thoi-elasticsearch-lam-the-nao-Ä‘e-Ä‘am-bao-tinh-nhat-quan-cua-Ä‘oc-va-ghi" tabindex="-1"><a class="header-anchor" href="#_19-trong-tinh-huong-Ä‘ong-thoi-elasticsearch-lam-the-nao-Ä‘e-Ä‘am-bao-tinh-nhat-quan-cua-Ä‘oc-va-ghi"><span>19. Trong tÃ¬nh huá»‘ng Ä‘á»“ng thá»i, Elasticsearch lÃ m tháº¿ nÃ o Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n cá»§a Ä‘á»c vÃ  ghi?</span></a></h2><p>ï¼ˆ1ï¼‰CÃ³ thá»ƒ sá»­ dá»¥ng kiá»ƒm soÃ¡t Ä‘á»“ng thá»i láº¡c quan thÃ´ng qua sá»‘ phiÃªn báº£n, Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng phiÃªn báº£n má»›i sáº½ khÃ´ng bá»‹ phiÃªn báº£n cÅ© ghi Ä‘Ã¨, vÃ  Ä‘á»ƒ lá»›p á»©ng dá»¥ng xá»­ lÃ½ cÃ¡c xung Ä‘á»™t cá»¥ thá»ƒ.</p><p>ï¼ˆ2ï¼‰NgoÃ i ra, Ä‘á»‘i vá»›i thao tÃ¡c ghi, má»©c Ä‘á»™ nháº¥t quÃ¡n há»— trá»£ quorum/one/all, máº·c Ä‘á»‹nh lÃ  quorum, tá»©c chá»‰ cho phÃ©p thao tÃ¡c ghi khi pháº§n lá»›n cÃ¡c phÃ¢n Ä‘oáº¡n cÃ³ sáºµn. Tuy nhiÃªn, ngay cáº£ khi pháº§n lá»›n Ä‘á»u cÃ³ sáºµn, cÅ©ng cÃ³ thá»ƒ xáº£y ra tÃ¬nh huá»‘ng do máº¡ng vÃ  nhá»¯ng nguyÃªn nhÃ¢n khÃ¡c dáº«n Ä‘áº¿n viá»‡c ghi vÃ o báº£n sao tháº¥t báº¡i, Ä‘iá»u nÃ y khiáº¿n báº£n sao Ä‘Ã³ bá»‹ coi lÃ  lá»—i, vÃ  phÃ¢n Ä‘oáº¡n sáº½ Ä‘Æ°á»£c xÃ¢y dá»±ng láº¡i trÃªn má»™t nÃºt khÃ¡c.</p><p>ï¼ˆ3ï¼‰Äá»‘i vá»›i thao tÃ¡c Ä‘á»c, báº¡n cÃ³ thá»ƒ Ä‘áº·t replication lÃ  sync (máº·c Ä‘á»‹nh), Ä‘iá»u nÃ y khiáº¿n thao tÃ¡c chá»‰ tráº£ vá» sau khi hoÃ n thÃ nh trÃªn cáº£ phÃ¢n Ä‘oáº¡n chÃ­nh vÃ  phÃ¢n Ä‘oáº¡n sao; náº¿u Ä‘áº·t replication lÃ  async, báº¡n cÅ©ng cÃ³ thá»ƒ Ä‘áº·t tham sá»‘ yÃªu cáº§u tÃ¬m kiáº¿m _preference lÃ  primary Ä‘á»ƒ truy váº¥n phÃ¢n Ä‘oáº¡n chÃ­nh, Ä‘áº£m báº£o ráº±ng tÃ i liá»‡u lÃ  phiÃªn báº£n má»›i nháº¥t.</p><h2 id="_20-lam-the-nao-Ä‘e-giam-sat-trang-thai-cua-cum-elasticsearch" tabindex="-1"><a class="header-anchor" href="#_20-lam-the-nao-Ä‘e-giam-sat-trang-thai-cua-cum-elasticsearch"><span>20. LÃ m tháº¿ nÃ o Ä‘á»ƒ giÃ¡m sÃ¡t tráº¡ng thÃ¡i cá»§a cá»¥m Elasticsearch?</span></a></h2><p>Marvel cho phÃ©p báº¡n dá»… dÃ ng giÃ¡m sÃ¡t Elasticsearch thÃ´ng qua Kibana. Báº¡n cÃ³ thá»ƒ xem tráº¡ng thÃ¡i sá»©c khá»e vÃ  hiá»‡u suáº¥t cá»§a cá»¥m trong thá»i gian thá»±c, cÅ©ng nhÆ° phÃ¢n tÃ­ch cÃ¡c chá»‰ sá»‘ cá»¥m, chá»‰ má»¥c vÃ  nÃºt trong quÃ¡ khá»©.</p><h2 id="_21-hay-gioi-thieu-ve-kien-truc-cong-nghe-tong-the-cua-tim-kiem-thuong-mai-Ä‘ien-tu-cua-ban" tabindex="-1"><a class="header-anchor" href="#_21-hay-gioi-thieu-ve-kien-truc-cong-nghe-tong-the-cua-tim-kiem-thuong-mai-Ä‘ien-tu-cua-ban"><span>21. HÃ£y giá»›i thiá»‡u vá» kiáº¿n trÃºc cÃ´ng nghá»‡ tá»•ng thá»ƒ cá»§a tÃ¬m kiáº¿m thÆ°Æ¡ng máº¡i Ä‘iá»‡n tá»­ cá»§a báº¡n.</span></a></h2><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/v2-5bdbe7ada0ddee9d8b2f03c0a379e0d4_720w.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="hay-gioi-thieu-ve-giai-phap-tim-kiem-ca-nhan-hoa-cua-ban" tabindex="-1"><a class="header-anchor" href="#hay-gioi-thieu-ve-giai-phap-tim-kiem-ca-nhan-hoa-cua-ban"><span>HÃ£y giá»›i thiá»‡u vá» giáº£i phÃ¡p tÃ¬m kiáº¿m cÃ¡ nhÃ¢n hÃ³a cá»§a báº¡n?</span></a></h2><p>Thá»±c hiá»‡n tÃ¬m kiáº¿m cÃ¡ nhÃ¢n hÃ³a dá»±a trÃªn word2vec vÃ  Elasticsearch</p><p>ï¼ˆ1ï¼‰Dá»±a trÃªn word2vec, Elasticsearch vÃ  plug-in script tÃ¹y chá»‰nh cá»§a chÃºng tÃ´i, chÃºng tÃ´i Ä‘Ã£ thá»±c hiá»‡n má»™t dá»‹ch vá»¥ tÃ¬m kiáº¿m cÃ¡ nhÃ¢n hÃ³a, so vá»›i phiÃªn báº£n gá»‘c, tá»· lá»‡ nháº¥p chuá»™t vÃ  tá»· lá»‡ chuyá»ƒn Ä‘á»•i má»›i Ä‘á»u tÄƒng Ä‘Ã¡ng ká»ƒ;</p><p>ï¼ˆ2ï¼‰Vector sáº£n pháº©m dá»±a trÃªn word2vec cÅ©ng cÃ³ má»™t á»©ng dá»¥ng khÃ¡c, Ä‘Ã³ lÃ  cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ thá»±c hiá»‡n Ä‘á» xuáº¥t sáº£n pháº©m tÆ°Æ¡ng tá»±;</p><p>ï¼ˆ3ï¼‰Sá»­ dá»¥ng word2vec Ä‘á»ƒ thá»±c hiá»‡n tÃ¬m kiáº¿m cÃ¡ nhÃ¢n hÃ³a hoáº·c Ä‘á» xuáº¥t cÃ¡ nhÃ¢n hÃ³a cÃ³ má»™t sá»‘ háº¡n cháº¿, bá»Ÿi vÃ¬ nÃ³ chá»‰ cÃ³ thá»ƒ xá»­ lÃ½ dá»¯ liá»‡u chuá»—i thá»i gian nhÆ° lá»‹ch sá»­ nháº¥p chuá»™t cá»§a ngÆ°á»i dÃ¹ng, vÃ  khÃ´ng thá»ƒ xem xÃ©t toÃ n diá»‡n sá»Ÿ thÃ­ch cá»§a ngÆ°á»i dÃ¹ng, Ä‘iá»u nÃ y váº«n cÃ²n ráº¥t nhiá»u khÃ´ng gian Ä‘á»ƒ cáº£i thiá»‡n vÃ  nÃ¢ng cao;</p><h2 id="ban-co-biet-ve-trie-cay-tu-Ä‘ien-khong" tabindex="-1"><a class="header-anchor" href="#ban-co-biet-ve-trie-cay-tu-Ä‘ien-khong"><span>Báº¡n cÃ³ biáº¿t vá» Trie (cÃ¢y tá»« Ä‘iá»ƒn) khÃ´ng?</span></a></h2><p>Ã tÆ°á»Ÿng chÃ­nh cá»§a Trie lÃ  sá»­ dá»¥ng khÃ´ng gian Ä‘á»ƒ tiáº¿t kiá»‡m thá»i gian, sá»­ dá»¥ng tiá»n tá»‘ chung cá»§a chuá»—i Ä‘á»ƒ giáº£m thiá»ƒu chi phÃ­ truy váº¥n vÃ  tÄƒng hiá»‡u suáº¥t. NÃ³ cÃ³ 3 tÃ­nh cháº¥t cÆ¡ báº£n:</p><p>1ï¼‰NÃºt gá»‘c khÃ´ng chá»©a kÃ½ tá»±, ngoáº¡i trá»« nÃºt gá»‘c, má»—i nÃºt chá»‰ chá»©a má»™t kÃ½ tá»±.</p><p>2ï¼‰Tá»« nÃºt gá»‘c Ä‘áº¿n má»™t nÃºt nÃ o Ä‘Ã³, cÃ¡c kÃ½ tá»± trÃªn Ä‘Æ°á»ng Ä‘i ná»‘i láº¡i vá»›i nhau, táº¡o thÃ nh chuá»—i tÆ°Æ¡ng á»©ng vá»›i nÃºt Ä‘Ã³.</p><p>3ï¼‰Táº¥t cáº£ cÃ¡c nÃºt con cá»§a má»—i nÃºt Ä‘á»u chá»©a cÃ¡c kÃ½ tá»± khÃ´ng giá»‘ng nhau.</p><figure><img src="https://pic4.zhimg.com/80/v2-26a48882a8f09a50dfeb79cc25045fcf_720w.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>ï¼ˆ1ï¼‰Báº¡n cÃ³ thá»ƒ tháº¥y ráº±ng, sá»‘ lÆ°á»£ng nÃºt á»Ÿ má»—i cáº¥p cá»§a cÃ¢y Trie lÃ  á»Ÿ cáº¥p Ä‘á»™ <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><msup><mn>6</mn><mi>i</mi></msup></mrow><annotation encoding="application/x-tex">26^i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8247em;"></span><span class="mord">2</span><span class="mord"><span class="mord">6</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height:0.8247em;"><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">i</span></span></span></span></span></span></span></span></span></span></span>. VÃ¬ váº­y, Ä‘á»ƒ tiáº¿t kiá»‡m khÃ´ng gian, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng danh sÃ¡ch liÃªn káº¿t Ä‘á»™ng, hoáº·c mÃ´ phá»ng Ä‘á»™ng báº±ng máº£ng. VÃ  viá»‡c sá»­ dá»¥ng khÃ´ng gian, sáº½ khÃ´ng vÆ°á»£t quÃ¡ sá»‘ lÆ°á»£ng tá»« Ã— Ä‘á»™ dÃ i tá»«.</p><p>ï¼ˆ2ï¼‰CÃ i Ä‘áº·t: Má»Ÿ má»™t máº£ng kÃ­ch thÆ°á»›c bá»™ chá»¯ cÃ¡i cho má»—i nÃºt, má»—i nÃºt treo má»™t danh sÃ¡ch liÃªn káº¿t, sá»­ dá»¥ng phÆ°Æ¡ng phÃ¡p biá»ƒu diá»…n con trÃ¡i ngÆ°á»i anh em pháº£i Ä‘á»ƒ ghi láº¡i cÃ¢y nÃ y;</p><h2 id="lam-the-nao-Ä‘e-thuc-hien-sua-loi-chinh-ta" tabindex="-1"><a class="header-anchor" href="#lam-the-nao-Ä‘e-thuc-hien-sua-loi-chinh-ta"><span>LÃ m tháº¿ nÃ o Ä‘á»ƒ thá»±c hiá»‡n sá»­a lá»—i chÃ­nh táº£?</span></a></h2><p>ï¼ˆ1ï¼‰Sá»­a lá»—i chÃ­nh táº£ Ä‘Æ°á»£c thá»±c hiá»‡n dá»±a trÃªn khoáº£ng cÃ¡ch chá»‰nh sá»­a; khoáº£ng cÃ¡ch chá»‰nh sá»­a lÃ  má»™t phÆ°Æ¡ng phÃ¡p tiÃªu chuáº©n, nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ biá»ƒu thá»‹ sá»‘ lÆ°á»£ng tá»‘i thiá»ƒu cÃ¡c hoáº¡t Ä‘á»™ng chÃ¨n, xÃ³a vÃ  thay tháº¿ tá»« má»™t chuá»—i chuyá»ƒn Ä‘á»•i sang má»™t chuá»—i khÃ¡c;</p><p>ï¼ˆ2ï¼‰QuÃ¡ trÃ¬nh tÃ­nh toÃ¡n khoáº£ng cÃ¡ch chá»‰nh sá»­a: vÃ­ dá»¥, Ä‘á»ƒ tÃ­nh khoáº£ng cÃ¡ch chá»‰nh sá»­a giá»¯a batyu vÃ  beauty, trÆ°á»›c tiÃªn táº¡o má»™t báº£ng 7Ã—8 (Ä‘á»™ dÃ i cá»§a batyu lÃ  5, Ä‘á»™ dÃ i cá»§a coffee lÃ  6, cá»™ng thÃªm 2), sau Ä‘Ã³, Ä‘iá»n sá»‘ Ä‘en vÃ o cÃ¡c vá»‹ trÃ­ sau. QuÃ¡ trÃ¬nh tÃ­nh toÃ¡n cá»§a Ã´ khÃ¡c lÃ  láº¥y giÃ¡ trá»‹ nhá» nháº¥t trong ba giÃ¡ trá»‹ sau:</p><p>Náº¿u kÃ½ tá»± á»Ÿ trÃªn cÃ¹ng báº±ng kÃ½ tá»± á»Ÿ bÃªn trÃ¡i, thÃ¬ nÃ³ lÃ  sá»‘ á»Ÿ gÃ³c trÃªn bÃªn trÃ¡i. Náº¿u khÃ´ng, nÃ³ lÃ  sá»‘ á»Ÿ gÃ³c trÃªn bÃªn trÃ¡i +1. (Äá»‘i vá»›i 3,3, nÃ³ lÃ  0)</p><p>Sá»‘ bÃªn trÃ¡i +1 (Ä‘á»‘i vá»›i Ã´ 3,3, nÃ³ lÃ  2)</p><p>Sá»‘ á»Ÿ trÃªn +1 (Ä‘á»‘i vá»›i Ã´ 3,3, nÃ³ lÃ  2)</p><p>Cuá»‘i cÃ¹ng, láº¥y giÃ¡ trá»‹ á»Ÿ gÃ³c dÆ°á»›i bÃªn pháº£i lÃ  giÃ¡ trá»‹ khoáº£ng cÃ¡ch chá»‰nh sá»­a 3.</p><figure><img src="https://pic4.zhimg.com/80/v2-66f01f0d578c83274e90a7ddf704b633_720w.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>Äá»‘i vá»›i viá»‡c sá»­a lá»—i chÃ­nh táº£, chÃºng tÃ´i xem xÃ©t viá»‡c xÃ¢y dá»±ng má»™t khÃ´ng gian Ä‘o lÆ°á»ng (Metric Space), trong Ä‘Ã³ má»i má»‘i quan há»‡ trong khÃ´ng gian nÃ y Ä‘á»u tuÃ¢n theo ba Ä‘iá»u kiá»‡n cÆ¡ báº£n sau:</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">d(x,y) = 0</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:0.6444em;"></span><span class="mord">0</span></span></span></span> -- Náº¿u khoáº£ng cÃ¡ch tá»« x Ä‘áº¿n y lÃ  0, thÃ¬ x=y</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>=</mo><mi>d</mi><mo stretchy="false">(</mo><mi>y</mi><mo separator="true">,</mo><mi>x</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(x,y) = d(y,x)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal">x</span><span class="mclose">)</span></span></span></span> -- Khoáº£ng cÃ¡ch tá»« x Ä‘áº¿n y tÆ°Æ¡ng Ä‘Æ°Æ¡ng vá»›i khoáº£ng cÃ¡ch tá»« y Ä‘áº¿n x</p><p><span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>y</mi><mo stretchy="false">)</mo><mo>+</mo><mi>d</mi><mo stretchy="false">(</mo><mi>y</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo><mo>&gt;</mo><mo>=</mo><mi>d</mi><mo stretchy="false">(</mo><mi>x</mi><mo separator="true">,</mo><mi>z</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">d(x,y) + d(y,z) &gt;= d(x,z)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.03588em;">y</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2778em;"></span><span class="mrel">&gt;=</span><span class="mspace" style="margin-right:0.2778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathnormal">d</span><span class="mopen">(</span><span class="mord mathnormal">x</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em;"></span><span class="mord mathnormal" style="margin-right:0.04398em;">z</span><span class="mclose">)</span></span></span></span> -- Báº¥t Ä‘áº³ng thá»©c tam giÃ¡c</p><p>ï¼ˆ1ï¼‰Dá»±a vÃ o báº¥t Ä‘áº³ng thá»©c tam giÃ¡c, thÃ¬ má»™t kÃ½ tá»± B náº±m trong pháº¡m vi n tá»« query, khoáº£ng cÃ¡ch tá»‘i Ä‘a tá»« A Ä‘áº¿n B lÃ  d+n, vÃ  khoáº£ng cÃ¡ch tá»‘i thiá»ƒu lÃ  d-n.</p><p>ï¼ˆ2ï¼‰QuÃ¡ trÃ¬nh xÃ¢y dá»±ng cÃ¢y BK nhÆ° sau: má»—i nÃºt cÃ³ báº¥t ká»³ sá»‘ lÆ°á»£ng nÃºt con, má»—i cáº¡nh cÃ³ má»™t giÃ¡ trá»‹ biá»ƒu thá»‹ khoáº£ng cÃ¡ch chá»‰nh sá»­a. Táº¥t cáº£ cÃ¡c nÃºt con Ä‘áº¿n nÃºt cha cÃ³ giÃ¡ trá»‹ n biá»ƒu thá»‹ khoáº£ng cÃ¡ch chá»‰nh sá»­a chÃ­nh xÃ¡c lÃ  n. VÃ­ dá»¥, chÃºng ta cÃ³ má»™t cÃ¢y vá»›i nÃºt cha lÃ  &quot;book&quot; vÃ  hai nÃºt con lÃ  &quot;cake&quot; vÃ  &quot;books&quot;, cáº¡nh tá»« &quot;book&quot; Ä‘áº¿n &quot;books&quot; cÃ³ giÃ¡ trá»‹ 1, cáº¡nh tá»« &quot;book&quot; Ä‘áº¿n &quot;cake&quot; cÃ³ giÃ¡ trá»‹ 4. Sau khi xÃ¢y dá»±ng xong cÃ¢y tá»« tá»« Ä‘iá»ƒn, báº¥t cá»© khi nÃ o báº¡n muá»‘n chÃ¨n má»™t tá»« má»›i, báº¡n tÃ­nh khoáº£ng cÃ¡ch chá»‰nh sá»­a giá»¯a tá»« má»›i vÃ  nÃºt gá»‘c vÃ  tÃ¬m cáº¡nh cÃ³ giÃ¡ trá»‹ d(neweord, root). So sÃ¡nh Ä‘á»‡ quy vá»›i má»—i nÃºt con cho Ä‘áº¿n khi khÃ´ng cÃ²n nÃºt con nÃ o, báº¡n cÃ³ thá»ƒ táº¡o má»™t nÃºt con má»›i vÃ  lÆ°u tá»« má»›i táº¡i Ä‘Ã³. VÃ­ dá»¥, chÃ¨n &quot;boo&quot; vÃ o cÃ¢y trong vÃ­ dá»¥ trÆ°á»›c, chÃºng ta kiá»ƒm tra nÃºt gá»‘c trÆ°á»›c, tÃ¬m cáº¡nh cÃ³ giÃ¡ trá»‹ d(&quot;book&quot;, &quot;boo&quot;) = 1, sau Ä‘Ã³ kiá»ƒm tra nÃºt con cÃ³ giÃ¡ trá»‹ 1 trÃªn cáº¡nh, nháº­n Ä‘Æ°á»£c tá»« &quot;books&quot;. ChÃºng tÃ´i láº¡i tÃ­nh khoáº£ng cÃ¡ch d(&quot;books&quot;, &quot;boo&quot;)=2, sau Ä‘Ã³ chÃ¨n tá»« má»›i sau &quot;books&quot;, vÃ  giÃ¡ trá»‹ cáº¡nh lÃ  2.</p><p>ï¼ˆ3ï¼‰Quy trÃ¬nh tÃ¬m kiáº¿m tá»« tÆ°Æ¡ng tá»± nhÆ° sau: TÃ­nh khoáº£ng cÃ¡ch chá»‰nh sá»­a giá»¯a tá»« vÃ  nÃºt gá»‘c d, sau Ä‘Ã³ tÃ¬m Ä‘á»‡ quy má»—i cáº¡nh con cÃ³ giÃ¡ trá»‹ tá»« d-n Ä‘áº¿n d+n (bao gá»“m). Náº¿u nÃºt Ä‘Æ°á»£c kiá»ƒm tra cÃ³ khoáº£ng cÃ¡ch d so vá»›i tá»« tÃ¬m kiáº¿m nhá» hÆ¡n n, thÃ¬ tráº£ vá» nÃºt Ä‘Ã³ vÃ  tiáº¿p tá»¥c tÃ¬m kiáº¿m. VÃ­ dá»¥, nháº­p cape vÃ  khoáº£ng cÃ¡ch chá»‹u Ä‘á»±ng tá»‘i Ä‘a lÃ  1, sau Ä‘Ã³ tÃ­nh khoáº£ng cÃ¡ch chá»‰nh sá»­a vá»›i nÃºt gá»‘c d(&quot;book&quot;, &quot;cape&quot;)=4, sau Ä‘Ã³ tÃ¬m kiáº¿m nÃºt con giá»¯a nÃºt gá»‘c vÃ  khoáº£ng cÃ¡ch chá»‰nh sá»­a tá»« 3 Ä‘áº¿n 5, tÃ¬m tháº¥y nÃºt cake, tÃ­nh toÃ¡n d(&quot;cake&quot;, &quot;cape&quot;)=1, Ä‘Ã¡p á»©ng yÃªu cáº§u nÃªn tráº£ vá» cake, sau Ä‘Ã³ tÃ¬m nÃºt con giá»¯a nÃºt cake vÃ  khoáº£ng cÃ¡ch chá»‰nh sá»­a tá»« 0 Ä‘áº¿n 2, tÃ¬m tháº¥y nÃºt cape vÃ  cart, nhÆ° váº­y, káº¿t quáº£ cape Ä‘Ã¡p á»©ng yÃªu cáº§u Ä‘Ã£ Ä‘Æ°á»£c tÃ¬m tháº¥y.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240224203118.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/database/elasticsearch/interview.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/database/elasticsearch/operation.html" aria-label="Elasticsearch Operation"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon>Elasticsearch Operation</div></a><!----></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with â¤ï¸ by Hung Nguyen</div><div class="copyright">Copyright Â© 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CIGQMwlz.js" defer></script>
  </body>
</html>
