<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/database/elasticsearch/optimization.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="Elasticsearch performance optimization"><meta property="og:description" content="Tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t Elasticsearch Elasticsearch lÃ  cÃ´ng cá»¥ tÃ¬m kiáº¿m cáº¥p doanh nghiá»‡p phá»• biáº¿n hiá»‡n nay, Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ hoáº¡t Ä‘á»™ng trong mÃ´i trÆ°á»ng Ä‘Ã¡m mÃ¢y, cÃ³ kháº£ nÄƒng tÃ¬m kiáº¿..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-06-28T15:54:38.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:tag" content="elasticssearch"><meta property="article:modified_time" content="2024-06-28T15:54:38.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Elasticsearch performance optimization","image":[""],"dateModified":"2024-06-28T15:54:38.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>Elasticsearch performance optimization | VanHung4499</title><meta name="description" content="Tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t Elasticsearch Elasticsearch lÃ  cÃ´ng cá»¥ tÃ¬m kiáº¿m cáº¥p doanh nghiá»‡p phá»• biáº¿n hiá»‡n nay, Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ hoáº¡t Ä‘á»™ng trong mÃ´i trÆ°á»ng Ä‘Ã¡m mÃ¢y, cÃ³ kháº£ nÄƒng tÃ¬m kiáº¿...">
    <link rel="preload" href="/assets/style-DFXXOFfS.css" as="style"><link rel="stylesheet" href="/assets/style-DFXXOFfS.css">
    <link rel="modulepreload" href="/assets/app-5QVbWi7Z.js"><link rel="modulepreload" href="/assets/optimization.html-COw2kjA7.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon>Project<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/rouyi-vue-pro/" aria-label="Rouyi Vue Pro"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Rouyi Vue Pro<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/yudao-cloud/" aria-label="Yudao Cloud"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Yudao Cloud<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interview/" aria-label="Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:account-tie" width="1em" height="1em"></iconify-icon><!--]-->Interview<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">SQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">MongoDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Elasticsearch</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/overview.html" aria-label="Elasticsearch Overview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Overview<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/quick-start.html" aria-label="Elasticsearch Quick Start"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Quick Start<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/intro.html" aria-label="Elasticsearch Intro"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Intro<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/es-index.html" aria-label="Elasticsearch Index"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Index<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/mapping.html" aria-label="Elasticsearch Mapping"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Mapping<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/highlight-search-display.html" aria-label="Elasticsearch Highlight Search and Display"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Highlight Search and Display<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/query.html" aria-label="Elasticsearch Query"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Query<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/sorting.html" aria-label="Elasticsearch Sorting"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Sorting<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/aggregation.html" aria-label="Elasticsearch Aggregation"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Aggregation<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/analyzer.html" aria-label="Elasticsearch Analyzer"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Analyzer<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/database/elasticsearch/optimization.html" aria-label="Elasticsearch performance optimization"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch performance optimization<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/rest-api.html" aria-label="Elasticsearch REST API"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch REST API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/cluster-shard.html" aria-label="Elasticsearch Cluster and Shard"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Cluster and Shard<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/operation.html" aria-label="Elasticsearch Operation"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Operation<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/interview.html" aria-label="Elasticsearch Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Interview<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Elastic Stack</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon>Elasticsearch performance optimization</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing DateğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-28T15:54:38.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 25 min</span><meta property="timeRequired" content="PT25M"></span><span class="page-category-info" aria-label="CategoryğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color4 clickable" role="navigation">elasticssearch</span><!--]--><meta property="articleSection" content="elasticssearch"></span><span class="page-tag-info" aria-label="TagğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color4 clickable" role="navigation">elasticssearch</span><!--]--><meta property="keywords" content="elasticssearch"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#toi-uu-hoa-cau-hinh-phan-cung">Tá»‘i Æ°u hÃ³a cáº¥u hÃ¬nh pháº§n cá»©ng</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cau-hinh-cpu">Cáº¥u hÃ¬nh CPU</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cau-hinh-bo-nho">Cáº¥u hÃ¬nh bá»™ nhá»›</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#Ä‘ia">ÄÄ©a</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cai-Ä‘at-toi-uu-hoa-chi-muc">CÃ i Ä‘áº·t tá»‘i Æ°u hÃ³a chá»‰ má»¥c</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#gui-hang-loat">Gá»­i hÃ ng loáº¡t</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tang-khoang-thoi-gian-refresh">TÄƒng khoáº£ng thá»i gian Refresh</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chinh-sua-cai-Ä‘at-index-buffer-size">Chá»‰nh sá»­a cÃ i Ä‘áº·t index_buffer_size</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chinh-sua-cai-Ä‘at-lien-quan-Ä‘en-translog">Chá»‰nh sá»­a cÃ i Ä‘áº·t liÃªn quan Ä‘áº¿n translog</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chu-y-su-dung-truong-id">ChÃº Ã½ sá»­ dá»¥ng trÆ°á»ng _id</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chu-y-su-dung-truong-all-va-truong-source">ChÃº Ã½ sá»­ dá»¥ng trÆ°á»ng _all vÃ  trÆ°á»ng _source</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#su-dung-thuoc-tinh-index-mot-cach-hop-ly">Sá»­ dá»¥ng thuá»™c tÃ­nh index má»™t cÃ¡ch há»£p lÃ½</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#giam-so-luong-ban-sao">Giáº£m sá»‘ lÆ°á»£ng báº£n sao</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#toi-uu-hoa-ve-truy-van">Tá»‘i Æ°u hÃ³a vá» truy váº¥n</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-hoa-Ä‘inh-tuyen">Tá»‘i Æ°u hÃ³a Ä‘á»‹nh tuyáº¿n</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#filter-vs-query">Filter VS Query</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#phan-trang-sau">PhÃ¢n trang sÃ¢u</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#su-dung-script-mot-cach-hop-ly">Sá»­ dá»¥ng script má»™t cÃ¡ch há»£p lÃ½</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#toi-uu-hoa-cau-truc-du-lieu">Tá»‘i Æ°u hÃ³a cáº¥u trÃºc dá»¯ liá»‡u</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#giam-thieu-cac-truong-khong-can-thiet">Giáº£m thiá»ƒu cÃ¡c trÆ°á»ng khÃ´ng cáº§n thiáº¿t</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nested-object-vs-parent-child">Nested Object vs Parent/Child</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chon-mapping-tinh-neu-khong-can-thiet-hay-vo-hieu-hoa-mapping-Ä‘ong">Chá»n mapping tÄ©nh, náº¿u khÃ´ng cáº§n thiáº¿t, hÃ£y vÃ´ hiá»‡u hÃ³a mapping Ä‘á»™ng</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#thiet-ke-kien-truc-cum">Thiáº¿t káº¿ kiáº¿n trÃºc cá»¥m</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#phan-tach-nut-chinh-nut-du-lieu-va-nut-Ä‘ieu-phoi">PhÃ¢n tÃ¡ch nÃºt chÃ­nh, nÃºt dá»¯ liá»‡u vÃ  nÃºt Ä‘iá»u phá»‘i</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tat-chuc-nang-http-tren-cac-nut-du-lieu">Táº¯t chá»©c nÄƒng http trÃªn cÃ¡c nÃºt dá»¯ liá»‡u</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#moi-may-chu-nen-chi-trien-khai-mot-nut">Má»—i mÃ¡y chá»§ nÃªn chá»‰ triá»ƒn khai má»™t nÃºt</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cai-Ä‘at-phan-manh-cum">CÃ i Ä‘áº·t phÃ¢n máº£nh cá»¥m</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tai-lieu-tham-khao">TÃ i liá»‡u tham kháº£o</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="toi-uu-hoa-hieu-suat-elasticsearch" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-hieu-suat-elasticsearch"><span>Tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t Elasticsearch</span></a></h1><p>Elasticsearch lÃ  cÃ´ng cá»¥ tÃ¬m kiáº¿m cáº¥p doanh nghiá»‡p phá»• biáº¿n hiá»‡n nay, Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ hoáº¡t Ä‘á»™ng trong mÃ´i trÆ°á»ng Ä‘Ã¡m mÃ¢y, cÃ³ kháº£ nÄƒng tÃ¬m kiáº¿m thá»i gian thá»±c, á»•n Ä‘á»‹nh, Ä‘Ã¡ng tin cáº­y, nhanh chÃ³ng vÃ  dá»… dÃ ng cÃ i Ä‘áº·t. DÃ¹ lÃ  má»™t sáº£n pháº©m sáºµn sÃ ng sá»­ dá»¥ng ngay sau khi má»Ÿ há»™p, sau khi Ä‘Æ°a vÃ o mÃ´i trÆ°á»ng sáº£n xuáº¥t, chÃºng ta khÃ´ng thá»ƒ Ä‘áº£m báº£o Ä‘Æ°á»£c hiá»‡u suáº¥t vÃ  á»•n Ä‘á»‹nh cá»§a nÃ³. Viá»‡c tÄƒng cÆ°á»ng hiá»‡u suáº¥t dá»‹ch vá»¥ dá»±a trÃªn tÃ¬nh hÃ¬nh thá»±c táº¿ cÃ³ ráº¥t nhiá»u ká»¹ thuáº­t. Trong chÆ°Æ¡ng nÃ y, chÃºng tÃ´i sáº½ chia sáº» nhá»¯ng kinh nghiá»‡m tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t Elasticsearch tá»« thá»±c tiá»…n, chá»§ yáº¿u tá»« cÃ¡c khÃ­a cáº¡nh nhÆ° tá»‘i Æ°u hÃ³a cáº¥u hÃ¬nh pháº§n cá»©ng, cÃ i Ä‘áº·t tá»‘i Æ°u hÃ³a chá»‰ má»¥c, tá»‘i Æ°u hÃ³a truy váº¥n, tá»‘i Æ°u hÃ³a cáº¥u trÃºc dá»¯ liá»‡u, tá»‘i Æ°u hÃ³a kiáº¿n trÃºc cá»¥m.</p><h2 id="toi-uu-hoa-cau-hinh-phan-cung" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-cau-hinh-phan-cung"><span>Tá»‘i Æ°u hÃ³a cáº¥u hÃ¬nh pháº§n cá»©ng</span></a></h2><p>NÃ¢ng cáº¥p cáº¥u hÃ¬nh pháº§n cá»©ng luÃ´n lÃ  phÆ°Æ¡ng phÃ¡p tÄƒng cÆ°á»ng kháº£ nÄƒng phá»¥c vá»¥ nhanh chÃ³ng vÃ  hiá»‡u quáº£ nháº¥t, ba yáº¿u tá»‘ cÃ³ thá»ƒ áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u suáº¥t á»©ng dá»¥ng á»Ÿ cáº¥p Ä‘á»™ há»‡ thá»‘ng bao gá»“m: CPU, bá»™ nhá»› vÃ  IO, cÃ³ thá»ƒ tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t ES tá»« ba khÃ­a cáº¡nh nÃ y.</p><h3 id="cau-hinh-cpu" tabindex="-1"><a class="header-anchor" href="#cau-hinh-cpu"><span>Cáº¥u hÃ¬nh CPU</span></a></h3><p>NÃ³i chung, cÃ³ má»™t sá»‘ lÃ½ do khiáº¿n CPU báº­n rá»™n:</p><ol><li>CÃ³ vÃ²ng láº·p vÃ´ háº¡n, khÃ´ng cháº·n, khá»›p máº«u thÃ´ng thÆ°á»ng hoáº·c chá»‰ tÃ­nh toÃ¡n trong luá»“ng;</li><li>Xáº£y ra GC thÆ°á»ng xuyÃªn;</li><li>Chuyá»ƒn Ä‘á»•i ngá»¯ cáº£nh cá»§a nhiá»u luá»“ng;</li></ol><p>Háº§u háº¿t cÃ¡c triá»ƒn khai Elasticsearch thÆ°á»ng khÃ´ng Ä‘áº·t yÃªu cáº§u cao Ä‘á»‘i vá»›i CPU. Do Ä‘Ã³, so vá»›i cÃ¡c tÃ i nguyÃªn khÃ¡c, viá»‡c cáº¥u hÃ¬nh bao nhiÃªu (CPU) khÃ´ng quan trá»ng láº¯m. Báº¡n nÃªn chá»n bá»™ xá»­ lÃ½ hiá»‡n Ä‘áº¡i cÃ³ nhiá»u nhÃ¢n, mÃ¡y chá»§ trong cá»¥m thÆ°á»ng sá»­ dá»¥ng tá»« 2 Ä‘áº¿n 8 nhÃ¢n. <strong>Náº¿u báº¡n pháº£i chá»n giá»¯a CPUs nhanh hÆ¡n vÃ  sá»‘ lÆ°á»£ng nhÃ¢n nhiá»u hÆ¡n, viá»‡c chá»n sá»‘ lÆ°á»£ng nhÃ¢n nhiá»u hÆ¡n sáº½ tá»‘t hÆ¡n</strong>. Sá»‘ lÆ°á»£ng nhÃ¢n bá»• sung cung cáº¥p Ä‘á»“ng thá»i nhiá»u hÆ¡n ráº¥t nhiá»u so vá»›i tá»‘c Ä‘á»™ xung nhá»‹p nhanh hÆ¡n má»™t chÃºt.</p><h3 id="cau-hinh-bo-nho" tabindex="-1"><a class="header-anchor" href="#cau-hinh-bo-nho"><span>Cáº¥u hÃ¬nh bá»™ nhá»›</span></a></h3><p>Náº¿u cÃ³ má»™t loáº¡i tÃ i nguyÃªn nÃ o Ä‘Ã³ sáº½ Ä‘Æ°á»£c tiÃªu thá»¥ trÆ°á»›c tiÃªn, Ä‘Ã³ cÃ³ thá»ƒ lÃ  bá»™ nhá»›. Sáº¯p xáº¿p vÃ  tá»•ng há»£p Ä‘á»u tiÃªu thá»¥ nhiá»u bá»™ nhá»›, vÃ¬ váº­y viá»‡c cÃ³ Ä‘á»§ khÃ´ng gian heap Ä‘á»ƒ xá»­ lÃ½ chÃºng lÃ  ráº¥t quan trá»ng. Ngay cáº£ khi khÃ´ng gian heap khÃ¡ nhá», nÃ³ cÅ©ng cÃ³ thá»ƒ cung cáº¥p thÃªm bá»™ nhá»› cho bá»™ Ä‘á»‡m tá»‡p há»‡ Ä‘iá»u hÃ nh. Bá»Ÿi vÃ¬ nhiá»u cáº¥u trÃºc dá»¯ liá»‡u mÃ  Lucene sá»­ dá»¥ng dá»±a trÃªn Ä‘á»‹nh dáº¡ng dá»±a trÃªn Ä‘Ä©a, Elasticsearch táº­n dá»¥ng bá»™ Ä‘á»‡m há»‡ Ä‘iá»u hÃ nh cÃ³ thá»ƒ táº¡o ra hiá»‡u quáº£ lá»›n.</p><p><strong>MÃ¡y cÃ³ bá»™ nhá»› 64 GB lÃ  ráº¥t lÃ½ tÆ°á»Ÿng</strong>, nhÆ°ng mÃ¡y 32 GB vÃ  16 GB cÅ©ng ráº¥t phá»• biáº¿n. DÆ°á»›i 8 GB sáº½ pháº£n tÃ¡c dá»¥ng (báº¡n cuá»‘i cÃ¹ng sáº½ cáº§n ráº¥t nhiá»u mÃ¡y nhá»), mÃ¡y cÃ³ bá»™ nhá»› lá»›n hÆ¡n 64 GB cÅ©ng sáº½ gáº·p váº¥n Ä‘á».</p><p>Do ES Ä‘Æ°á»£c xÃ¢y dá»±ng dá»±a trÃªn lucene, vÃ  sá»©c máº¡nh cá»§a thiáº¿t káº¿ lucene náº±m á»Ÿ chá»— lucene cÃ³ thá»ƒ táº­n dá»¥ng tá»‘t bá»™ nhá»› há»‡ Ä‘iá»u hÃ nh Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u chá»‰ má»¥c, Ä‘á»ƒ cung cáº¥p hiá»‡u suáº¥t truy váº¥n nhanh. CÃ¡c tá»‡p phÃ¢n Ä‘oáº¡n chá»‰ má»¥c cá»§a lucene Ä‘Æ°á»£c lÆ°u trá»¯ trong má»™t tá»‡p duy nháº¥t vÃ  khÃ´ng thay Ä‘á»•i, Ä‘á»‘i vá»›i há»‡ Ä‘iá»u hÃ nh, cÃ³ thá»ƒ giá»¯ tá»‡p chá»‰ má»¥c trong bá»™ Ä‘á»‡m má»™t cÃ¡ch thÃ¢n thiá»‡n, Ä‘á»ƒ truy cáº­p nhanh; do Ä‘Ã³, chÃºng ta cáº§n Ä‘á»ƒ má»™t ná»­a bá»™ nhá»› váº­t lÃ½ cho lucene; ná»­a cÃ²n láº¡i cá»§a bá»™ nhá»› váº­t lÃ½ Ä‘á»ƒ cho ES (JVM heap).</p><h4 id="phan-bo-bo-nho" tabindex="-1"><a class="header-anchor" href="#phan-bo-bo-nho"><span>PhÃ¢n bá»• bá»™ nhá»›</span></a></h4><p>Khi bá»™ nhá»› mÃ¡y nhá» hÆ¡n 64G, tuÃ¢n theo nguyÃªn táº¯c chung, 50% cho ES, 50% cho lucene.</p><p>Khi bá»™ nhá»› mÃ¡y lá»›n hÆ¡n 64G, tuÃ¢n theo nguyÃªn táº¯c sau:</p><ul><li>Náº¿u cáº£nh sá»­ dá»¥ng chÃ­nh lÃ  tÃ¬m kiáº¿m toÃ n vÄƒn báº£n, thÃ¬ nÃªn cáº¥p 4~32G bá»™ nhá»› cho ES Heap; bá»™ nhá»› khÃ¡c Ä‘á»ƒ cho há»‡ Ä‘iá»u hÃ nh, cho lucene sá»­ dá»¥ng (segments cache), Ä‘á»ƒ cung cáº¥p hiá»‡u suáº¥t truy váº¥n nhanh hÆ¡n.</li><li>Náº¿u cáº£nh sá»­ dá»¥ng chÃ­nh lÃ  tá»•ng há»£p hoáº·c sáº¯p xáº¿p, vÃ  háº§u háº¿t lÃ  numerics, dates, geo_points vÃ  cÃ¡c loáº¡i kÃ½ tá»± not_analyzed, nÃªn cáº¥p 4~32G bá»™ nhá»› cho ES Heap; bá»™ nhá»› khÃ¡c Ä‘á»ƒ cho há»‡ Ä‘iá»u hÃ nh, cho lucene sá»­ dá»¥ng, cung cáº¥p hiá»‡u suáº¥t tá»•ng há»£p, sáº¯p xáº¿p nhanh hÆ¡n dá»±a trÃªn tÃ i liá»‡u.</li><li>Náº¿u cáº£nh sá»­ dá»¥ng lÃ  tá»•ng há»£p hoáº·c sáº¯p xáº¿p, vÃ  táº¥t cáº£ Ä‘á»u dá»±a trÃªn dá»¯ liá»‡u kÃ½ tá»± analyzed, thÃ¬ cáº§n nhiá»u heap size hÆ¡n, nÃªn cháº¡y nhiá»u thá»±c thá»ƒ ES trÃªn mÃ¡y, má»—i thá»±c thá»ƒ giá»¯ khÃ´ng vÆ°á»£t quÃ¡ 50% cÃ i Ä‘áº·t heap ES (nhÆ°ng khÃ´ng vÆ°á»£t quÃ¡ 32 G, khi heap memory Ä‘Æ°á»£c cÃ i Ä‘áº·t dÆ°á»›i 32 G, JVM sá»­ dá»¥ng ká»¹ thuáº­t nÃ©n chá»‰ sá»‘ Ä‘á»‘i tÆ°á»£ng Ä‘á»ƒ tiáº¿t kiá»‡m khÃ´ng gian), hÆ¡n 50% Ä‘á»ƒ cho lucene.</li></ul><h4 id="vo-hieu-hoa-swap" tabindex="-1"><a class="header-anchor" href="#vo-hieu-hoa-swap"><span>VÃ´ hiá»‡u hÃ³a swap</span></a></h4><p>VÃ´ hiá»‡u hÃ³a swap, má»™t khi cho phÃ©p trao Ä‘á»•i bá»™ nhá»› vá»›i Ä‘Ä©a, sáº½ gÃ¢y ra váº¥n Ä‘á» vá» hiá»‡u suáº¥t nghiÃªm trá»ng. CÃ³ thá»ƒ thÃ´ng qua <code>bootstrap.memory_lock: true</code> trong elasticsearch.yml, Ä‘á»ƒ giá»¯ JVM khÃ³a bá»™ nhá»›, Ä‘áº£m báº£o hiá»‡u suáº¥t cá»§a ES.</p><h4 id="cai-Ä‘at-gc" tabindex="-1"><a class="header-anchor" href="#cai-Ä‘at-gc"><span>CÃ i Ä‘áº·t GC</span></a></h4><p>Giá»¯ cÃ i Ä‘áº·t GC hiá»‡n táº¡i, cÃ i Ä‘áº·t máº·c Ä‘á»‹nh lÃ : Concurrent-Mark and Sweep (CMS), khÃ´ng chuyá»ƒn sang G1 GC, vÃ¬ hiá»‡n táº¡i G1 váº«n cÃ³ ráº¥t nhiá»u BUG.</p><p>Giá»¯ cÃ i Ä‘áº·t hiá»‡n táº¡i cá»§a thread pool, hiá»‡n táº¡i cÃ i Ä‘áº·t thread pool cá»§a ES Ä‘Ã£ cÃ³ nhiá»u cÃ i Ä‘áº·t tá»‘i Æ°u hÃ³a so vá»›i 1.X, giá»¯ nguyÃªn lÃ  Ä‘Æ°á»£c; kÃ­ch thÆ°á»›c thread pool máº·c Ä‘á»‹nh báº±ng sá»‘ lÆ°á»£ng lÃµi CPU. Náº¿u cáº§n thay Ä‘á»•i, cÃ i Ä‘áº·t theo cÃ´ng thá»©c ((sá»‘ lÆ°á»£ng lÃµi CPU * 3) / 2) + 1; khÃ´ng Ä‘Æ°á»£c vÆ°á»£t quÃ¡ gáº¥p Ä‘Ã´i sá»‘ lÆ°á»£ng lÃµi CPU; nhÆ°ng khÃ´ng nÃªn thay Ä‘á»•i cáº¥u hÃ¬nh máº·c Ä‘á»‹nh, náº¿u khÃ´ng sáº½ gÃ¢y tá»•n thÆ°Æ¡ng cho CPU.</p><h3 id="Ä‘ia" tabindex="-1"><a class="header-anchor" href="#Ä‘ia"><span>ÄÄ©a</span></a></h3><p>ÄÄ©a quan trá»ng Ä‘á»‘i vá»›i táº¥t cáº£ cÃ¡c cá»¥m, Ä‘áº·c biá»‡t quan trá»ng Ä‘á»‘i vá»›i cÃ¡c cá»¥m cÃ³ lÆ°á»£ng ghi lá»›n (vÃ­ dá»¥ nhÆ° nhá»¯ng cá»¥m lÆ°u trá»¯ dá»¯ liá»‡u nháº­t kÃ½). ÄÄ©a lÃ  há»‡ thá»‘ng con cháº­m nháº¥t trÃªn mÃ¡y chá»§, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  nhá»¯ng cá»¥m cÃ³ lÆ°á»£ng ghi lá»›n dá»… dÃ ng lÃ m cho Ä‘Ä©a bÃ£o hÃ²a, khiáº¿n nÃ³ trá»Ÿ thÃ nh nÃºt tháº¯t cá»• chai cá»§a cá»¥m.</p><p><strong>Trong pháº¡m vi chá»‹u Ä‘á»±ng Ä‘Æ°á»£c Ã¡p lá»±c kinh táº¿, hÃ£y sá»­ dá»¥ng á»• Ä‘Ä©a thá»ƒ ráº¯n (SSD) cÃ ng nhiá»u cÃ ng tá»‘t</strong>. So vá»›i báº¥t ká»³ phÆ°Æ¡ng tiá»‡n quay nÃ o (á»• Ä‘Ä©a cá»©ng cÆ¡ há»c, bÄƒng tá»«, v.v.), á»• Ä‘Ä©a thá»ƒ ráº¯n sáº½ tÄƒng cÆ°á»ng IO Ä‘Ã¡ng ká»ƒ, dÃ¹ lÃ  ghi ngáº«u nhiÃªn hay ghi tuáº§n tá»±.</p><blockquote><p>Náº¿u báº¡n Ä‘ang sá»­ dá»¥ng SSD, hÃ£y Ä‘áº£m báº£o ráº±ng trÃ¬nh láº­p lá»‹ch I/O cá»§a há»‡ thá»‘ng báº¡n Ä‘Æ°á»£c cáº¥u hÃ¬nh Ä‘Ãºng. Khi báº¡n ghi dá»¯ liá»‡u vÃ o Ä‘Ä©a, trÃ¬nh láº­p lá»‹ch I/O quyáº¿t Ä‘á»‹nh khi nÃ o thá»±c sá»± gá»­i dá»¯ liá»‡u Ä‘áº¿n Ä‘Ä©a. Háº§u háº¿t cÃ¡c phiÃªn báº£n *nix máº·c Ä‘á»‹nh cÃ³ trÃ¬nh láº­p lá»‹ch lÃ  cfq (Completely Fair Queuing).</p><p>TrÃ¬nh láº­p lá»‹ch phÃ¢n bá»• thá»i gian cho má»—i quy trÃ¬nh. VÃ  tá»‘i Æ°u hÃ³a viá»‡c chuyá»ƒn cÃ¡c hÃ ng Ä‘á»£i lá»›n Ä‘áº¿n Ä‘Ä©a. NhÆ°ng nÃ³ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a cho phÆ°Æ¡ng tiá»‡n quay: Ä‘áº·c tÃ­nh cá»‘ há»¯u cá»§a á»• Ä‘Ä©a cÆ¡ há»c cÃ³ nghÄ©a lÃ  viá»‡c ghi dá»¯ liá»‡u vÃ o Ä‘Ä©a dá»±a trÃªn bá»‘ cá»¥c váº­t lÃ½ sáº½ hiá»‡u quáº£ hÆ¡n.</p><p>Äiá»u nÃ y khÃ´ng hiá»‡u quáº£ Ä‘á»‘i vá»›i SSD, máº·c dÃ¹ khÃ´ng liÃªn quan Ä‘áº¿n á»• Ä‘Ä©a cÆ¡ há»c. Tuy nhiÃªn, deadline hoáº·c noop nÃªn Ä‘Æ°á»£c sá»­ dá»¥ng. TrÃ¬nh láº­p lá»‹ch deadline tá»‘i Æ°u hÃ³a dá»±a trÃªn thá»i gian chá» ghi, trong khi noop chá»‰ lÃ  má»™t hÃ ng Ä‘á»£i FIFO Ä‘Æ¡n giáº£n.</p><p>Thay Ä‘á»•i Ä‘Æ¡n giáº£n nÃ y cÃ³ thá»ƒ táº¡o ra sá»± khÃ¡c biá»‡t Ä‘Ã¡ng ká»ƒ. Chá»‰ cáº§n sá»­ dá»¥ng trÃ¬nh láº­p lá»‹ch Ä‘Ãºng, chÃºng tÃ´i Ä‘Ã£ tháº¥y kháº£ nÄƒng ghi tÄƒng lÃªn 500 láº§n.</p></blockquote><p><strong>Náº¿u báº¡n sá»­ dá»¥ng phÆ°Æ¡ng tiá»‡n quay (nhÆ° á»• Ä‘Ä©a cÆ¡ há»c), hÃ£y cá»‘ gáº¯ng cÃ³ Ä‘Æ°á»£c á»• Ä‘Ä©a nhanh nháº¥t cÃ³ thá»ƒ (á»• Ä‘Ä©a mÃ¡y chá»§ hiá»‡u suáº¥t cao, á»• Ä‘Ä©a 15k RPM)</strong>.</p><p><strong>Sá»­ dá»¥ng RAID0 lÃ  cÃ¡ch hiá»‡u quáº£ Ä‘á»ƒ tÄƒng tá»‘c Ä‘á»™ Ä‘Ä©a, Ä‘á»‘i vá»›i cáº£ á»• Ä‘Ä©a cÆ¡ há»c vÃ  SSD</strong>. KhÃ´ng cáº§n pháº£i sá»­ dá»¥ng gÆ°Æ¡ng hoáº·c cÃ¡c biáº¿n thá»ƒ RAID khÃ¡c, bá»Ÿi vÃ¬ Elasticsearch Ä‘Ã£ cung cáº¥p chá»©c nÄƒng sao lÆ°u á»Ÿ cáº¥p Ä‘á»™ tá»± thÃ¢n thÃ´ng qua cÃ¡c báº£n sao, vÃ¬ váº­y khÃ´ng cáº§n sá»­ dá»¥ng chá»©c nÄƒng sao lÆ°u cá»§a Ä‘Ä©a, Ä‘á»“ng thá»i náº¿u sá»­ dá»¥ng chá»©c nÄƒng sao lÆ°u cá»§a Ä‘Ä©a, sáº½ áº£nh hÆ°á»Ÿng lá»›n Ä‘áº¿n tá»‘c Ä‘á»™ ghi.</p><p><strong>Cuá»‘i cÃ¹ng, hÃ£y trÃ¡nh sá»­ dá»¥ng lÆ°u trá»¯ káº¿t ná»‘i máº¡ng (NAS)</strong>. Má»i ngÆ°á»i thÆ°á»ng tuyÃªn bá»‘ ráº±ng giáº£i phÃ¡p NAS cá»§a há» nhanh hÆ¡n vÃ  Ä‘Ã¡ng tin cáº­y hÆ¡n so vá»›i á»• Ä‘Ä©a cá»¥c bá»™. Bá» qua nhá»¯ng tuyÃªn bá»‘ nÃ y, chÃºng tÃ´i chÆ°a bao giá» tháº¥y NAS Ä‘Ã¡ng giÃ¡ cho sá»± quáº£ng cÃ¡o lá»›n cá»§a nÃ³. NAS thÆ°á»ng ráº¥t cháº­m, hiá»ƒn thá»‹ Ä‘á»™ trá»… lá»›n hÆ¡n vÃ  phÆ°Æ¡ng sai Ä‘á»™ trá»… trung bÃ¬nh rá»™ng hÆ¡n, vÃ  nÃ³ lÃ  Ä‘iá»ƒm lá»—i Ä‘Æ¡n.</p><h2 id="cai-Ä‘at-toi-uu-hoa-chi-muc" tabindex="-1"><a class="header-anchor" href="#cai-Ä‘at-toi-uu-hoa-chi-muc"><span>CÃ i Ä‘áº·t tá»‘i Æ°u hÃ³a chá»‰ má»¥c</span></a></h2><p>Tá»‘i Æ°u hÃ³a chá»‰ má»¥c chá»§ yáº¿u táº­p trung vÃ o viá»‡c tá»‘i Æ°u hÃ³a á»Ÿ má»©c Ä‘á»™ chÃ¨n cá»§a Elasticsearch, tá»‘c Ä‘á»™ chá»‰ má»¥c cá»§a Elasticsearch thá»±c sá»± khÃ¡ nhanh, dá»¯ liá»‡u cá»¥ thá»ƒ, chÃºng ta cÃ³ thá»ƒ tham kháº£o dá»¯ liá»‡u benchmark chÃ­nh thá»©c. ChÃºng ta cÃ³ thá»ƒ tá»‘i Æ°u hÃ³a chá»‰ má»¥c dá»±a trÃªn cÃ¡c yÃªu cáº§u khÃ¡c nhau.</p><h3 id="gui-hang-loat" tabindex="-1"><a class="header-anchor" href="#gui-hang-loat"><span>Gá»­i hÃ ng loáº¡t</span></a></h3><p>Khi cÃ³ ráº¥t nhiá»u dá»¯ liá»‡u cáº§n gá»­i, nÃªn sá»­ dá»¥ng gá»­i hÃ ng loáº¡t (hoáº¡t Ä‘á»™ng Bulk); ngoÃ i ra, khi sá»­ dá»¥ng yÃªu cáº§u bulk, má»—i yÃªu cáº§u khÃ´ng nÃªn vÆ°á»£t quÃ¡ vÃ i chá»¥c MB, vÃ¬ náº¿u quÃ¡ lá»›n sáº½ dáº«n Ä‘áº¿n viá»‡c sá»­ dá»¥ng quÃ¡ nhiá»u bá»™ nhá»›.</p><p>VÃ­ dá»¥, trong quÃ¡ trÃ¬nh thá»±c thi ELK, Logstash indexer gá»­i dá»¯ liá»‡u vÃ o Elasticsearch, kÃ­ch thÆ°á»›c batch cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng nhÆ° má»™t Ä‘iá»ƒm tá»‘i Æ°u hÃ³a. Tuy nhiÃªn, kÃ­ch thÆ°á»›c tá»‘i Æ°u cáº§n pháº£i xÃ¡c Ä‘á»‹nh dá»±a trÃªn kÃ­ch thÆ°á»›c tÃ i liá»‡u vÃ  hiá»‡u suáº¥t mÃ¡y chá»§.</p><p>VÃ­ dá»¥, trong Logstash, náº¿u kÃ­ch thÆ°á»›c tÃ i liá»‡u gá»­i vÆ°á»£t quÃ¡ 20MB, Logstash sáº½ chia má»™t yÃªu cáº§u hÃ ng loáº¡t thÃ nh nhiá»u yÃªu cáº§u hÃ ng loáº¡t.</p><p>Náº¿u trong quÃ¡ trÃ¬nh gá»­i, báº¡n gáº·p pháº£i ngoáº¡i lá»‡ EsRejectedExecutionException, thÃ¬ Ä‘iá»u nÃ y cho tháº¥y hiá»‡u suáº¥t chá»‰ má»¥c cá»§a cá»¥m Ä‘Ã£ Ä‘áº¡t Ä‘áº¿n giá»›i háº¡n. Trong trÆ°á»ng há»£p nÃ y, báº¡n cáº§n tÄƒng nguá»“n lá»±c cá»§a cá»¥m mÃ¡y chá»§ hoáº·c giáº£m tá»‘c Ä‘á»™ thu tháº­p dá»¯ liá»‡u dá»±a trÃªn quy táº¯c kinh doanh, vÃ­ dá»¥ chá»‰ thu tháº­p nháº­t kÃ½ cáº¥p Warn, Error trá»Ÿ lÃªn.</p><h3 id="tang-khoang-thoi-gian-refresh" tabindex="-1"><a class="header-anchor" href="#tang-khoang-thoi-gian-refresh"><span>TÄƒng khoáº£ng thá»i gian Refresh</span></a></h3><p>Äá»ƒ tÄƒng hiá»‡u suáº¥t chá»‰ má»¥c, Elasticsearch sá»­ dá»¥ng chiáº¿n lÆ°á»£c ghi trá»… khi ghi dá»¯ liá»‡u, tá»©c lÃ  dá»¯ liá»‡u Ä‘Æ°á»£c ghi vÃ o bá»™ nhá»› trÆ°á»›c, khi vÆ°á»£t quÃ¡ 1 giÃ¢y máº·c Ä‘á»‹nh (index.refresh_interval) sáº½ thá»±c hiá»‡n má»™t hoáº¡t Ä‘á»™ng ghi, tá»©c lÃ  lÃ m má»›i dá»¯ liá»‡u segment trong bá»™ nhá»› vÃ o Ä‘Ä©a, lÃºc nÃ y chÃºng ta má»›i cÃ³ thá»ƒ tÃ¬m kiáº¿m dá»¯ liá»‡u. ÄÃ¢y lÃ  lÃ½ do táº¡i sao Elasticsearch cung cáº¥p chá»©c nÄƒng tÃ¬m kiáº¿m gáº§n thá»i gian thá»±c, chá»© khÃ´ng pháº£i lÃ  tÃ¬m kiáº¿m thá»i gian thá»±c.</p><p>Náº¿u há»‡ thá»‘ng cá»§a chÃºng ta khÃ´ng Ä‘áº·t yÃªu cáº§u cao vá» Ä‘á»™ trá»… dá»¯ liá»‡u, chÃºng ta <strong>cÃ³ thá»ƒ tÄƒng khoáº£ng thá»i gian lÃ m má»›i Ä‘á»ƒ giáº£m Ã¡p lá»±c há»£p nháº¥t segment vÃ  tÄƒng tá»‘c Ä‘á»™ chá»‰ má»¥c</strong>. VÃ­ dá»¥, trong quÃ¡ trÃ¬nh theo dÃµi toÃ n bá»™ chuá»—i, chÃºng tÃ´i Ä‘Ã£ Ä‘áº·t <code>index.refresh_interval</code> thÃ nh 30 giÃ¢y, giáº£m sá»‘ láº§n lÃ m má»›i. Má»™t vÃ­ dá»¥ khÃ¡c, khi tiáº¿n hÃ nh chá»‰ má»¥c toÃ n bá»™, báº¡n cÃ³ thá»ƒ táº¡m thá»i táº¯t sá»‘ láº§n lÃ m má»›i, tá»©c lÃ  Ä‘áº·t <code>index.refresh_interval</code> thÃ nh -1, sau khi dá»¯ liá»‡u Ä‘Æ°á»£c nháº­p thÃ nh cÃ´ng, hÃ£y má»Ÿ láº¡i cháº¿ Ä‘á»™ bÃ¬nh thÆ°á»ng, vÃ­ dá»¥ 30 giÃ¢y.</p><blockquote><p>Khi táº£i dá»¯ liá»‡u lá»›n, báº¡n cÃ³ thá»ƒ táº¡m thá»i khÃ´ng sá»­ dá»¥ng refresh vÃ  repliccas, Ä‘áº·t index.refresh_interval thÃ nh -1, Ä‘áº·t index.number_of_replicas thÃ nh 0.</p></blockquote><h3 id="chinh-sua-cai-Ä‘at-index-buffer-size" tabindex="-1"><a class="header-anchor" href="#chinh-sua-cai-Ä‘at-index-buffer-size"><span>Chá»‰nh sá»­a cÃ i Ä‘áº·t index_buffer_size</span></a></h3><p>CÃ i Ä‘áº·t bá»™ Ä‘á»‡m chá»‰ má»¥c cÃ³ thá»ƒ kiá»ƒm soÃ¡t bao nhiÃªu bá»™ nhá»› Ä‘Æ°á»£c phÃ¢n bá»• cho quÃ¡ trÃ¬nh chá»‰ má»¥c. ÄÃ¢y lÃ  má»™t cáº¥u hÃ¬nh toÃ n cáº§u, sáº½ Ä‘Æ°á»£c Ã¡p dá»¥ng cho táº¥t cáº£ cÃ¡c phÃ¢n Ä‘oáº¡n khÃ¡c nhau trÃªn má»™t nÃºt.</p><div class="language-yml" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">indices.memory.index_buffer_size</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">10%</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">indices.memory.min_index_buffer_size</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">48mb</span></span></code></pre></div><p><code>indices.memory.index_buffer_size</code> cháº¥p nháº­n má»™t pháº§n trÄƒm hoáº·c má»™t giÃ¡ trá»‹ biá»ƒu thá»‹ kÃ­ch thÆ°á»›c byte. Máº·c Ä‘á»‹nh lÃ  10%, cÃ³ nghÄ©a lÃ  10% tá»•ng bá»™ nhá»› Ä‘Æ°á»£c phÃ¢n bá»• cho nÃºt Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÃ m kÃ­ch thÆ°á»›c bá»™ Ä‘á»‡m chá»‰ má»¥c. GiÃ¡ trá»‹ nÃ y Ä‘Æ°á»£c chia cho cÃ¡c phÃ¢n Ä‘oáº¡n (shards) khÃ¡c nhau. Náº¿u báº¡n Ä‘áº·t pháº§n trÄƒm, báº¡n cÅ©ng cÃ³ thá»ƒ Ä‘áº·t <code>min_index_buffer_size</code> (máº·c Ä‘á»‹nh lÃ  48mb) vÃ  <code>max_index_buffer_size</code> (máº·c Ä‘á»‹nh khÃ´ng cÃ³ giá»›i háº¡n trÃªn).</p><h3 id="chinh-sua-cai-Ä‘at-lien-quan-Ä‘en-translog" tabindex="-1"><a class="header-anchor" href="#chinh-sua-cai-Ä‘at-lien-quan-Ä‘en-translog"><span>Chá»‰nh sá»­a cÃ i Ä‘áº·t liÃªn quan Ä‘áº¿n translog</span></a></h3><p>Má»™t lÃ  kiá»ƒm soÃ¡t táº§n suáº¥t hoáº¡t Ä‘á»™ng tá»« bá»™ nhá»› Ä‘áº¿n á»• cá»©ng, Ä‘á»ƒ giáº£m IO á»• cá»©ng. Báº¡n cÃ³ thá»ƒ Ä‘áº·t thá»i gian sync_interval lá»›n hÆ¡n. Máº·c Ä‘á»‹nh lÃ  5 giÃ¢y.</p><div class="language-yml" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">index.translog.sync_interval</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">5s</span></span></code></pre></div><p>Báº¡n cÅ©ng cÃ³ thá»ƒ kiá»ƒm soÃ¡t kÃ­ch thÆ°á»›c khá»‘i dá»¯ liá»‡u tranlog, khi Ä‘áº¡t Ä‘áº¿n kÃ­ch thÆ°á»›c threshold, dá»¯ liá»‡u má»›i sáº½ Ä‘Æ°á»£c flush vÃ o tá»‡p chá»‰ má»¥c lucene. Máº·c Ä‘á»‹nh lÃ  512mb.</p><div class="language-yml" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">index.translog.flush_threshold_size</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">512mb</span></span></code></pre></div><h3 id="chu-y-su-dung-truong-id" tabindex="-1"><a class="header-anchor" href="#chu-y-su-dung-truong-id"><span>ChÃº Ã½ sá»­ dá»¥ng trÆ°á»ng _id</span></a></h3><p>Trong viá»‡c sá»­ dá»¥ng trÆ°á»ng _id, báº¡n nÃªn trÃ¡nh tÃ¹y chá»‰nh _id Ä‘á»ƒ trÃ¡nh quáº£n lÃ½ phiÃªn báº£n dá»±a trÃªn ID; nÃªn sá»­ dá»¥ng chiáº¿n lÆ°á»£c táº¡o ID máº·c Ä‘á»‹nh cá»§a ES hoáº·c sá»­ dá»¥ng ID kiá»ƒu sá»‘ lÃ m khÃ³a chÃ­nh.</p><h3 id="chu-y-su-dung-truong-all-va-truong-source" tabindex="-1"><a class="header-anchor" href="#chu-y-su-dung-truong-all-va-truong-source"><span>ChÃº Ã½ sá»­ dá»¥ng trÆ°á»ng _all vÃ  trÆ°á»ng _source</span></a></h3><p>Báº¡n nÃªn chÃº Ã½ Ä‘áº¿n viá»‡c sá»­ dá»¥ng trÆ°á»ng _all vÃ  trÆ°á»ng _source, tÃ¹y thuá»™c vÃ o tÃ¬nh huá»‘ng vÃ  nhu cáº§u, trÆ°á»ng _all bao gá»“m táº¥t cáº£ cÃ¡c trÆ°á»ng chá»‰ má»¥c, thuáº­n tiá»‡n cho viá»‡c tÃ¬m kiáº¿m toÃ n vÄƒn, náº¿u khÃ´ng cÃ³ nhu cáº§u nÃ y, cÃ³ thá»ƒ táº¯t; _source lÆ°u trá»¯ ná»™i dung tÃ i liá»‡u gá»‘c, náº¿u khÃ´ng cÃ³ nhu cáº§u láº¥y dá»¯ liá»‡u tÃ i liá»‡u gá»‘c, cÃ³ thá»ƒ Ä‘á»‹nh nghÄ©a cÃ¡c trÆ°á»ng Ä‘Æ°á»£c Ä‘Æ°a vÃ o _source báº±ng cÃ¡ch Ä‘áº·t thuá»™c tÃ­nh includes, excludes.</p><h3 id="su-dung-thuoc-tinh-index-mot-cach-hop-ly" tabindex="-1"><a class="header-anchor" href="#su-dung-thuoc-tinh-index-mot-cach-hop-ly"><span>Sá»­ dá»¥ng thuá»™c tÃ­nh index má»™t cÃ¡ch há»£p lÃ½</span></a></h3><p>HÃ£y sá»­ dá»¥ng thuá»™c tÃ­nh index má»™t cÃ¡ch há»£p lÃ½, analyzed vÃ  not_analyzed, kiá»ƒm soÃ¡t trÆ°á»ng cÃ³ pháº£i lÃ  tá»« vá»±ng hay khÃ´ng dá»±a trÃªn yÃªu cáº§u kinh doanh. Chá»‰ cáº§n cÃ¡c trÆ°á»ng yÃªu cáº§u groupby, khi cáº¥u hÃ¬nh, Ä‘áº·t thÃ nh not_analyzed Ä‘á»ƒ tÄƒng hiá»‡u suáº¥t truy váº¥n hoáº·c phÃ¢n loáº¡i.</p><h3 id="giam-so-luong-ban-sao" tabindex="-1"><a class="header-anchor" href="#giam-so-luong-ban-sao"><span>Giáº£m sá»‘ lÆ°á»£ng báº£n sao</span></a></h3><p>Elasticsearch máº·c Ä‘á»‹nh sá»‘ lÆ°á»£ng báº£n sao lÃ  3, máº·c dÃ¹ Ä‘iá»u nÃ y sáº½ cáº£i thiá»‡n kháº£ nÄƒng sáºµn cÃ³ cá»§a cá»¥m, tÄƒng sá»‘ lÆ°á»£ng truy váº¥n Ä‘á»“ng thá»i, nhÆ°ng cÅ©ng sáº½ áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u suáº¥t ghi chá»‰ má»¥c.</p><p>Trong quÃ¡ trÃ¬nh chá»‰ má»¥c, cáº§n gá»­i tÃ i liá»‡u Ä‘Æ°á»£c cáº­p nháº­t Ä‘áº¿n cÃ¡c nÃºt báº£n sao, chá» nÃºt báº£n sao hoáº¡t Ä‘á»™ng sau Ä‘Ã³ tráº£ vá» káº¿t thÃºc. Khi sá»­ dá»¥ng Elasticsearch Ä‘á»ƒ tÃ¬m kiáº¿m kinh doanh, nÃªn Ä‘áº·t sá»‘ lÆ°á»£ng báº£n sao lÃ  3, nhÆ°ng trong há»‡ thá»‘ng nháº­t kÃ½ ELK ná»™i bá»™, há»‡ thá»‘ng theo dÃµi phÃ¢n tÃ¡n, hoÃ n toÃ n cÃ³ thá»ƒ Ä‘áº·t sá»‘ lÆ°á»£ng báº£n sao lÃ  1.</p><h2 id="toi-uu-hoa-ve-truy-van" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-ve-truy-van"><span>Tá»‘i Æ°u hÃ³a vá» truy váº¥n</span></a></h2><p>Khi Elasticsearch Ä‘Æ°á»£c sá»­ dá»¥ng nhÆ° má»™t truy váº¥n gáº§n thá»i gian thá»±c cho tÃ¬m kiáº¿m kinh doanh, viá»‡c tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t truy váº¥n trá»Ÿ nÃªn ráº¥t quan trá»ng.</p><h3 id="toi-uu-hoa-Ä‘inh-tuyen" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-Ä‘inh-tuyen"><span>Tá»‘i Æ°u hÃ³a Ä‘á»‹nh tuyáº¿n</span></a></h3><p>Khi chÃºng tÃ´i truy váº¥n má»™t tÃ i liá»‡u, Elasticsearch lÃ m tháº¿ nÃ o Ä‘á»ƒ biáº¿t má»™t tÃ i liá»‡u nÃªn Ä‘Æ°á»£c lÆ°u trá»¯ trong phÃ¢n Ä‘oáº¡n nÃ o? Thá»±c táº¿, nÃ³ Ä‘Æ°á»£c tÃ­nh toÃ¡n thÃ´ng qua cÃ´ng thá»©c sau Ä‘Ã¢y.</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>shard = hash(routing) % number_of_primary_shards</span></span></code></pre></div><p>GiÃ¡ trá»‹ máº·c Ä‘á»‹nh cá»§a routing lÃ  id cá»§a tÃ i liá»‡u, nhÆ°ng cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng giÃ¡ trá»‹ tÃ¹y chá»‰nh, cháº³ng háº¡n nhÆ° ID ngÆ°á»i dÃ¹ng.</p><h4 id="truy-van-khong-co-routing" tabindex="-1"><a class="header-anchor" href="#truy-van-khong-co-routing"><span>Truy váº¥n khÃ´ng cÃ³ routing</span></a></h4><p>Khi truy váº¥n, vÃ¬ khÃ´ng biáº¿t dá»¯ liá»‡u cáº§n truy váº¥n cá»¥ thá»ƒ náº±m trÃªn phÃ¢n Ä‘oáº¡n nÃ o, nÃªn toÃ n bá»™ quÃ¡ trÃ¬nh Ä‘Æ°á»£c chia thÃ nh 2 bÆ°á»›c:</p><ol><li>PhÃ¢n phá»‘i: Khi yÃªu cáº§u Ä‘áº¿n nÃºt Ä‘iá»u phá»‘i, nÃºt Ä‘iá»u phá»‘i sáº½ phÃ¢n phá»‘i yÃªu cáº§u truy váº¥n Ä‘áº¿n má»—i phÃ¢n Ä‘oáº¡n.</li><li>Tá»•ng há»£p: NÃºt Ä‘iá»u phá»‘i thu tháº­p káº¿t quáº£ truy váº¥n tá»« má»—i phÃ¢n Ä‘oáº¡n, sau Ä‘Ã³ sáº¯p xáº¿p káº¿t quáº£ truy váº¥n, sau Ä‘Ã³ tráº£ vá» káº¿t quáº£ cho ngÆ°á»i dÃ¹ng.</li></ol><h4 id="truy-van-co-routing" tabindex="-1"><a class="header-anchor" href="#truy-van-co-routing"><span>Truy váº¥n cÃ³ routing</span></a></h4><p>Khi truy váº¥n, cÃ³ thá»ƒ trá»±c tiáº¿p xÃ¡c Ä‘á»‹nh má»™t phÃ¢n Ä‘oáº¡n truy váº¥n dá»±a trÃªn thÃ´ng tin routing, khÃ´ng cáº§n truy váº¥n táº¥t cáº£ cÃ¡c phÃ¢n Ä‘oáº¡n, sau Ä‘Ã³ sáº¯p xáº¿p thÃ´ng qua nÃºt Ä‘iá»u phá»‘i.</p><p>NhÆ° truy váº¥n ngÆ°á»i dÃ¹ng tÃ¹y chá»‰nh á»Ÿ trÃªn, náº¿u routing Ä‘Æ°á»£c Ä‘áº·t lÃ  userid, thÃ¬ cÃ³ thá»ƒ trá»±c tiáº¿p truy váº¥n ra dá»¯ liá»‡u, hiá»‡u quáº£ tÄƒng ráº¥t nhiá»u.</p><h3 id="filter-vs-query" tabindex="-1"><a class="header-anchor" href="#filter-vs-query"><span>Filter VS Query</span></a></h3><p>Náº¿u cÃ³ thá»ƒ, hÃ£y sá»­ dá»¥ng ngá»¯ cáº£nh bá»™ lá»c (Filter) thay vÃ¬ ngá»¯ cáº£nh truy váº¥n (Query)</p><ul><li>Query: TÃ i liá»‡u nÃ y khá»›p vá»›i cÃ¢u truy váº¥n con nÃ y á»Ÿ má»©c Ä‘á»™ nÃ o?</li><li>Filter: TÃ i liá»‡u nÃ y cÃ³ khá»›p vá»›i cÃ¢u truy váº¥n con khÃ´ng?</li></ul><p>Elasticsearch chá»‰ cáº§n tráº£ lá»i &quot;cÃ³&quot; hoáº·c &quot;khÃ´ng&quot; cho cÃ¡c truy váº¥n Filter, khÃ´ng cáº§n tÃ­nh Ä‘iá»ƒm liÃªn quan nhÆ° truy váº¥n Query, Ä‘á»“ng thá»i káº¿t quáº£ Filter cÃ³ thá»ƒ Ä‘Æ°á»£c lÆ°u vÃ o bá»™ nhá»› cache.</p><h3 id="phan-trang-sau" tabindex="-1"><a class="header-anchor" href="#phan-trang-sau"><span>PhÃ¢n trang sÃ¢u</span></a></h3><p>Trong quÃ¡ trÃ¬nh sá»­ dá»¥ng Elasticsearch, nÃªn trÃ¡nh viá»‡c phÃ¢n trang lá»›n xáº£y ra.</p><p>Truy váº¥n phÃ¢n trang thÃ´ng thÆ°á»ng Ä‘á»u báº¯t Ä‘áº§u tá»« from vÃ  láº¥y size báº£n ghi, Ä‘iá»u nÃ y yÃªu cáº§u truy váº¥n vÃ  xáº¿p háº¡ng from+size báº£n ghi Ä‘áº§u tiÃªn trong má»—i phÃ¢n Ä‘oáº¡n. NÃºt Ä‘iá»u phá»‘i thu tháº­p from+size báº£n ghi Ä‘áº§u tiÃªn tá»« má»—i phÃ¢n Ä‘oáº¡n. NÃºt Ä‘iá»u phá»‘i sáº½ nháº­n Ä‘Æ°á»£c N*(from+size) báº£n ghi, sau Ä‘Ã³ sáº¯p xáº¿p chÃºng, sau Ä‘Ã³ tráº£ vá» from Ä‘áº¿n from+size báº£n ghi. Náº¿u from hoáº·c size ráº¥t lá»›n, sá»‘ lÆ°á»£ng báº£n ghi tham gia sáº¯p xáº¿p sáº½ tÄƒng lÃªn nhiá»u, cuá»‘i cÃ¹ng sáº½ lÃ m tÄƒng tiÃªu hao tÃ i nguyÃªn CPU.</p><p>CÃ³ thá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng scroll vÃ  scroll-scan hiá»‡u quáº£ cá»§a Elasticsearch.</p><p>CÅ©ng cÃ³ thá»ƒ káº¿t há»£p vá»›i Ä‘áº·c Ä‘iá»ƒm kinh doanh thá»±c táº¿, náº¿u kÃ­ch thÆ°á»›c id tÃ i liá»‡u vÃ  thá»i gian táº¡o tÃ i liá»‡u lÃ  Ä‘á»“ng nháº¥t vÃ  cÃ³ thá»© tá»±, cÃ³ thá»ƒ sá»­ dá»¥ng id tÃ i liá»‡u lÃ m offset phÃ¢n trang, vÃ  Ä‘áº·t nÃ³ lÃ m má»™t Ä‘iá»u kiá»‡n truy váº¥n phÃ¢n trang.</p><h3 id="su-dung-script-mot-cach-hop-ly" tabindex="-1"><a class="header-anchor" href="#su-dung-script-mot-cach-hop-ly"><span>Sá»­ dá»¥ng script má»™t cÃ¡ch há»£p lÃ½</span></a></h3><p>ChÃºng ta biáº¿t ráº±ng viá»‡c sá»­ dá»¥ng script chá»§ yáº¿u cÃ³ 3 hÃ¬nh thá»©c, cÃ¡ch biÃªn dá»‹ch Ä‘á»™ng ná»™i tuyáº¿n, lÆ°u trá»¯ trong thÆ° viá»‡n chá»‰ má»¥c _script vÃ  lÆ°u trá»¯ dÆ°á»›i dáº¡ng script tá»‡p; cáº£nh bÃ¡o thÃ´ng thÆ°á»ng lÃ  sáº¯p xáº¿p thÃ´, nÃªn sá»­ dá»¥ng cÃ¡ch thá»© hai Ä‘á»ƒ lÆ°u trá»¯ script trong thÆ° viá»‡n chá»‰ má»¥c _script trÆ°á»›c, Ä‘á»ƒ biÃªn dá»‹ch trÆ°á»›c, sau Ä‘Ã³ sá»­ dá»¥ng thÃ´ng qua id script vÃ  káº¿t há»£p vá»›i params, cÃ³ thá»ƒ Ä‘áº¡t Ä‘Æ°á»£c mÃ´ hÃ¬nh (logic) vÃ  dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c phÃ¢n tÃ¡ch, Ä‘á»“ng thá»i dá»… dÃ ng má»Ÿ rá»™ng vÃ  báº£o dÆ°á»¡ng mÃ´-Ä‘un script. Vui lÃ²ng tham kháº£o chi tiáº¿t vá» ná»™i dung script ES táº¡i <a href="https://www.knowledgedict.com/tutorial/elasticsearch-script.html" target="_blank" rel="noopener noreferrer">Giáº£i thÃ­ch chi tiáº¿t vá» mÃ´-Ä‘un script Elasticsearch</a>.</p><h2 id="toi-uu-hoa-cau-truc-du-lieu" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-cau-truc-du-lieu"><span>Tá»‘i Æ°u hÃ³a cáº¥u trÃºc dá»¯ liá»‡u</span></a></h2><p>Dá»±a trÃªn cÃ¡c tÃ¬nh huá»‘ng sá»­ dá»¥ng cá»§a Elasticsearch, cáº¥u trÃºc dá»¯ liá»‡u tÃ i liá»‡u nÃªn Ä‘Æ°á»£c káº¿t há»£p vá»›i tÃ¬nh huá»‘ng sá»­ dá»¥ng, loáº¡i bá» dá»¯ liá»‡u khÃ´ng cáº§n thiáº¿t vÃ  khÃ´ng há»£p lÃ½.</p><h3 id="giam-thieu-cac-truong-khong-can-thiet" tabindex="-1"><a class="header-anchor" href="#giam-thieu-cac-truong-khong-can-thiet"><span>Giáº£m thiá»ƒu cÃ¡c trÆ°á»ng khÃ´ng cáº§n thiáº¿t</span></a></h3><p>Náº¿u Elasticsearch Ä‘Æ°á»£c sá»­ dá»¥ng cho dá»‹ch vá»¥ tÃ¬m kiáº¿m kinh doanh, má»™t sá»‘ trÆ°á»ng khÃ´ng cáº§n thiáº¿t Ä‘á»ƒ tÃ¬m kiáº¿m nÃªn khÃ´ng Ä‘Æ°á»£c lÆ°u trong ES. Äiá»u nÃ y khÃ´ng chá»‰ tiáº¿t kiá»‡m khÃ´ng gian, mÃ  cÃ²n cáº£i thiá»‡n hiá»‡u suáº¥t tÃ¬m kiáº¿m vá»›i cÃ¹ng má»™t lÆ°á»£ng dá»¯ liá»‡u.</p><p>TrÃ¡nh sá»­ dá»¥ng giÃ¡ trá»‹ Ä‘á»™ng lÃ m trÆ°á»ng, viá»‡c tÄƒng mapping Ä‘á»™ng cÃ³ thá»ƒ dáº«n Ä‘áº¿n sá»± cá»‘ á»Ÿ cá»¥m; tÆ°Æ¡ng tá»±, cáº§n kiá»ƒm soÃ¡t sá»‘ lÆ°á»£ng trÆ°á»ng, khÃ´ng láº­p chá»‰ má»¥c cho cÃ¡c trÆ°á»ng khÃ´ng Ä‘Æ°á»£c sá»­ dá»¥ng trong kinh doanh. Kiá»ƒm soÃ¡t sá»‘ lÆ°á»£ng trÆ°á»ng chá»‰ má»¥c, Ä‘á»™ sÃ¢u cá»§a mapping, loáº¡i trÆ°á»ng chá»‰ má»¥c, lÃ  quan trá»ng nháº¥t trong viá»‡c tá»‘i Æ°u hÃ³a hiá»‡u suáº¥t ES.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ cÃ i Ä‘áº·t máº·c Ä‘á»‹nh cá»§a ES vá» sá»‘ lÆ°á»£ng trÆ°á»ng, Ä‘á»™ sÃ¢u mapping:</p><div class="language-yml" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">index.mapping.nested_objects.limit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">10000</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">index.mapping.total_fields.limit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1000</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">index.mapping.depth.limit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span></span></code></pre></div><h3 id="nested-object-vs-parent-child" tabindex="-1"><a class="header-anchor" href="#nested-object-vs-parent-child"><span>Nested Object vs Parent/Child</span></a></h3><p>Háº¡n cháº¿ sá»­ dá»¥ng cÃ¡c trÆ°á»ng nested hoáº·c parent/child, khÃ´ng sá»­ dá»¥ng náº¿u khÃ´ng cáº§n thiáº¿t; nested query cháº­m, parent/child query cÃ²n cháº­m hÆ¡n, cháº­m hÆ¡n nested query hÃ ng trÄƒm láº§n; vÃ¬ váº­y, náº¿u cÃ³ thá»ƒ giáº£i quyáº¿t á»Ÿ giai Ä‘oáº¡n thiáº¿t káº¿ mapping (thiáº¿t káº¿ báº£ng rá»™ng lá»›n hoáº·c sá»­ dá»¥ng cáº¥u trÃºc dá»¯ liá»‡u thÃ´ng minh), thÃ¬ khÃ´ng nÃªn sá»­ dá»¥ng mapping quan há»‡ cha-con.</p><p>Náº¿u báº¡n cáº§n sá»­ dá»¥ng nested fields, hÃ£y Ä‘áº£m báº£o khÃ´ng cÃ³ quÃ¡ nhiá»u trÆ°á»ng nested, hiá»‡n táº¡i giá»›i háº¡n máº·c Ä‘á»‹nh cá»§a ES lÃ  50. Bá»Ÿi vÃ¬ Ä‘á»‘i vá»›i 1 tÃ i liá»‡u, má»—i trÆ°á»ng nested sáº½ táº¡o ra má»™t tÃ i liá»‡u Ä‘á»™c láº­p, Ä‘iá»u nÃ y sáº½ lÃ m tÄƒng sá»‘ lÆ°á»£ng tÃ i liá»‡u má»™t cÃ¡ch Ä‘Ã¡ng ká»ƒ, áº£nh hÆ°á»Ÿng Ä‘áº¿n hiá»‡u suáº¥t truy váº¥n, Ä‘áº·c biá»‡t lÃ  hiá»‡u suáº¥t JOIN.</p><div class="language-yml" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">index.mapping.nested_fields.limit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">50</span></span></code></pre></div><table><thead><tr><th style="text-align:left;">So sÃ¡nh</th><th style="text-align:left;">Nested Object</th><th style="text-align:left;">Parent/Child</th></tr></thead><tbody><tr><td style="text-align:left;">Æ¯u Ä‘iá»ƒm</td><td style="text-align:left;">CÃ¡c tÃ i liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯ cÃ¹ng nhau, do Ä‘Ã³ hiá»‡u suáº¥t Ä‘á»c cao</td><td style="text-align:left;">CÃ¡c tÃ i liá»‡u cha vÃ  con cÃ³ thá»ƒ Ä‘Æ°á»£c cáº­p nháº­t Ä‘á»™c láº­p, khÃ´ng áº£nh hÆ°á»Ÿng láº«n nhau</td></tr><tr><td style="text-align:left;">NhÆ°á»£c Ä‘iá»ƒm</td><td style="text-align:left;">Khi cáº­p nháº­t tÃ i liá»‡u cha hoáº·c con, cáº§n cáº­p nháº­t toÃ n bá»™ tÃ i liá»‡u</td><td style="text-align:left;">Äá»ƒ duy trÃ¬ má»‘i quan há»‡ join, cáº§n sá»­ dá»¥ng má»™t pháº§n bá»™ nhá»›, hiá»‡u suáº¥t Ä‘á»c tháº¥p</td></tr><tr><td style="text-align:left;">TÃ¬nh huá»‘ng</td><td style="text-align:left;">TÃ i liá»‡u con cáº­p nháº­t Ã­t, truy váº¥n thÆ°á»ng xuyÃªn</td><td style="text-align:left;">TÃ i liá»‡u con cáº­p nháº­t thÆ°á»ng xuyÃªn</td></tr></tbody></table><h3 id="chon-mapping-tinh-neu-khong-can-thiet-hay-vo-hieu-hoa-mapping-Ä‘ong" tabindex="-1"><a class="header-anchor" href="#chon-mapping-tinh-neu-khong-can-thiet-hay-vo-hieu-hoa-mapping-Ä‘ong"><span>Chá»n mapping tÄ©nh, náº¿u khÃ´ng cáº§n thiáº¿t, hÃ£y vÃ´ hiá»‡u hÃ³a mapping Ä‘á»™ng</span></a></h3><p>Háº¡n cháº¿ sá»­ dá»¥ng mapping Ä‘á»™ng cÃ ng nhiá»u cÃ ng tá»‘t, Ä‘iá»u nÃ y cÃ³ thá»ƒ dáº«n Ä‘áº¿n sá»± cá»‘ á»Ÿ cá»¥m, ngoÃ i ra, mapping Ä‘á»™ng cÃ³ thá»ƒ mang láº¡i loáº¡i dá»¯ liá»‡u khÃ´ng thá»ƒ kiá»ƒm soÃ¡t, tá»« Ä‘Ã³ cÃ³ thá»ƒ dáº«n Ä‘áº¿n cÃ¡c ngoáº¡i lá»‡ liÃªn quan Ä‘áº¿n truy váº¥n, áº£nh hÆ°á»Ÿng Ä‘áº¿n kinh doanh.</p><p>NgoÃ i ra, khi Elasticsearch Ä‘Æ°á»£c sá»­ dá»¥ng nhÆ° má»™t cÃ´ng cá»¥ tÃ¬m kiáº¿m, chá»§ yáº¿u chá»‹u trÃ¡ch nhiá»‡m cho viá»‡c khá»›p vÃ  sáº¯p xáº¿p truy váº¥n, vÃ¬ váº­y loáº¡i dá»¯ liá»‡u lÆ°u trá»¯ dá»±a trÃªn hai chá»©c nÄƒng nÃ y Ä‘Æ°á»£c chia thÃ nh hai loáº¡i, má»™t lÃ  trÆ°á»ng cáº§n pháº£i khá»›p, Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ táº¡o chá»‰ má»¥c Ä‘áº£o ngÆ°á»£c cho viá»‡c khá»›p truy váº¥n, vÃ  loáº¡i khÃ¡c lÃ  trÆ°á»ng Ä‘áº·c trÆ°ng Ä‘Æ°á»£c sá»­ dá»¥ng cho viá»‡c sáº¯p xáº¿p thÃ´, nhÆ° ctr, sá»‘ lÆ°á»£t nháº¥p, sá»‘ lÆ°á»£ng bÃ¬nh luáº­n, v.v.</p><h2 id="thiet-ke-kien-truc-cum" tabindex="-1"><a class="header-anchor" href="#thiet-ke-kien-truc-cum"><span>Thiáº¿t káº¿ kiáº¿n trÃºc cá»¥m</span></a></h2><p>Viá»‡c triá»ƒn khai Elasticsearch má»™t cÃ¡ch há»£p lÃ½ sáº½ giÃºp cáº£i thiá»‡n kháº£ nÄƒng sáºµn sÃ ng tá»•ng thá»ƒ cá»§a dá»‹ch vá»¥.</p><h3 id="phan-tach-nut-chinh-nut-du-lieu-va-nut-Ä‘ieu-phoi" tabindex="-1"><a class="header-anchor" href="#phan-tach-nut-chinh-nut-du-lieu-va-nut-Ä‘ieu-phoi"><span>PhÃ¢n tÃ¡ch nÃºt chÃ­nh, nÃºt dá»¯ liá»‡u vÃ  nÃºt Ä‘iá»u phá»‘i</span></a></h3><p>Khi thiáº¿t káº¿ kiáº¿n trÃºc cá»¥m Elasticsearch, hÃ£y Ã¡p dá»¥ng kiáº¿n trÃºc phÃ¢n tÃ¡ch giá»¯a nÃºt chÃ­nh, nÃºt dá»¯ liá»‡u vÃ  nÃºt cÃ¢n báº±ng táº£i. Trong phiÃªn báº£n 5.x trá»Ÿ Ä‘i, nÃºt dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘Æ°á»£c phÃ¢n chia thÃ nh mÃ´ hÃ¬nh &quot;Hot-Warm&quot;.</p><p>CÃ³ 2 tham sá»‘ trong tá»‡p cáº¥u hÃ¬nh Elasticsearch lÃ  node.master vÃ  node.data. Sá»± káº¿t há»£p cá»§a hai tham sá»‘ nÃ y cÃ³ thá»ƒ giÃºp cáº£i thiá»‡n hiá»‡u suáº¥t mÃ¡y chá»§.</p><h4 id="nut-chinh-master" tabindex="-1"><a class="header-anchor" href="#nut-chinh-master"><span>NÃºt chÃ­nh (master)</span></a></h4><p>Cáº¥u hÃ¬nh <code>node.master:true</code> vÃ  <code>node.data:false</code>, nÃºt mÃ¡y chá»§ nÃ y chá»‰ hoáº¡t Ä‘á»™ng nhÆ° má»™t nÃºt chÃ­nh, nhÆ°ng khÃ´ng lÆ°u trá»¯ báº¥t ká»³ dá»¯ liá»‡u chá»‰ má»¥c nÃ o. ChÃºng tÃ´i khuyÃªn báº¡n nÃªn cháº¡y 3 nÃºt chÃ­nh chuyÃªn dá»¥ng trong má»—i cá»¥m Ä‘á»ƒ cung cáº¥p Ä‘á»™ linh hoáº¡t tá»‘t nháº¥t. Khi sá»­ dá»¥ng, báº¡n cÅ©ng cáº§n Ä‘áº·t tham sá»‘ <code>discovery.zen.minimum_master_nodes setting</code> thÃ nh 2 Ä‘á»ƒ trÃ¡nh tÃ¬nh tráº¡ng phÃ¢n rÃ£ (split-brain). Sá»­ dá»¥ng 3 nÃºt chÃ­nh chuyÃªn dá»¥ng, chá»‹u trÃ¡ch nhiá»‡m quáº£n lÃ½ cá»¥m vÃ  tÄƒng cÆ°á»ng sá»± á»•n Ä‘á»‹nh tá»•ng thá»ƒ cá»§a tráº¡ng thÃ¡i. Bá»Ÿi vÃ¬ 3 nÃºt chÃ­nh nÃ y khÃ´ng chá»©a dá»¯ liá»‡u vÃ  khÃ´ng tham gia vÃ o hoáº¡t Ä‘á»™ng tÃ¬m kiáº¿m vÃ  chá»‰ má»¥c thá»±c táº¿, há» khÃ´ng pháº£i lÃ m nhá»¯ng viá»‡c giá»‘ng nhau trÃªn JVM, cháº³ng háº¡n nhÆ° chá»‰ má»¥c náº·ng hoáº·c tÃ¬m kiáº¿m tá»‘n thá»i gian vÃ  tÃ i nguyÃªn. Do Ä‘Ã³, há» Ã­t cÃ³ kháº£ nÄƒng bá»‹ dá»«ng láº¡i do viá»‡c thu gom rÃ¡c. Do Ä‘Ã³, cáº¥u hÃ¬nh CPU, bá»™ nhá»› vÃ  Ä‘Ä©a cá»§a nÃºt chÃ­nh cÃ³ thá»ƒ Ã­t hÆ¡n nhiá»u so vá»›i nÃºt dá»¯ liá»‡u.</p><h4 id="nut-du-lieu-data" tabindex="-1"><a class="header-anchor" href="#nut-du-lieu-data"><span>NÃºt dá»¯ liá»‡u (data)</span></a></h4><p>Cáº¥u hÃ¬nh <code>node.master:false</code> vÃ  <code>node.data:true</code>, nÃºt mÃ¡y chá»§ nÃ y chá»‰ hoáº¡t Ä‘á»™ng nhÆ° má»™t nÃºt dá»¯ liá»‡u, chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u chá»‰ má»¥c, lÃ m cho nÃºt mÃ¡y chá»§ nÃ y hoáº¡t Ä‘á»™ng Ä‘Æ¡n giáº£n, chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u vÃ  truy váº¥n dá»¯ liá»‡u, giáº£m tá»· lá»‡ tiÃªu hao tÃ i nguyÃªn cá»§a nÃ³.</p><p>Trong phiÃªn báº£n Elasticsearch 5.x trá»Ÿ Ä‘i, nÃºt dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘Æ°á»£c chia thÃ nh mÃ´ hÃ¬nh &quot;Hot-Warm&quot;, tá»©c lÃ  chia thÃ nh nÃºt nÃ³ng (hot node) vÃ  nÃºt áº¥m (warm node).</p><p>nÃºt nÃ³ng:</p><p>NÃºt nÃ³ng chá»§ yáº¿u lÃ  nÃºt chá»‰ má»¥c (nÃºt ghi), Ä‘á»“ng thá»i lÆ°u trá»¯ má»™t sá»‘ chá»‰ má»¥c Ä‘Æ°á»£c truy váº¥n thÆ°á»ng xuyÃªn gáº§n Ä‘Ã¢y. Do viá»‡c thá»±c hiá»‡n chá»‰ má»¥c ráº¥t tiÃªu tá»‘n CPU vÃ  IO, Ä‘Ã³ lÃ  hoáº¡t Ä‘á»™ng IO vÃ  CPU náº·ng, nÃªn sá»­ dá»¥ng loáº¡i Ä‘Ä©a SSD, duy trÃ¬ hiá»‡u suáº¥t ghi tá»‘t; chÃºng tÃ´i khuyÃªn báº¡n nÃªn triá»ƒn khai Ã­t nháº¥t 3 nÃºt nÃ³ng Ä‘á»ƒ Ä‘áº£m báº£o kháº£ nÄƒng sáºµn sÃ ng cao. Dá»±a trÃªn lÆ°á»£ng dá»¯ liá»‡u cáº§n thu tháº­p vÃ  truy váº¥n gáº§n Ä‘Ã¢y, báº¡n cÃ³ thá»ƒ tÄƒng sá»‘ lÆ°á»£ng mÃ¡y chá»§ Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c hiá»‡u suáº¥t mong muá»‘n.</p><p>Äá»ƒ Ä‘áº·t nÃºt thÃ nh loáº¡i nÃ³ng, báº¡n cáº§n cáº¥u hÃ¬nh nhÆ° sau trong elasticsearch.yml:</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>node.attr.box_type: hot</span></span></code></pre></div><p>Náº¿u Ä‘ang hoáº¡t Ä‘á»™ng trÃªn chá»‰ má»¥c cá»¥ thá»ƒ, báº¡n cÃ³ thá»ƒ Ä‘áº·t <code>index.routing.allocation.require.box_type: hot</code> Ä‘á»ƒ ghi chá»‰ má»¥c vÃ o nÃºt nÃ³ng.</p><p>nÃºt áº¥m:</p><p>Loáº¡i nÃºt nÃ y Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ xá»­ lÃ½ má»™t lÆ°á»£ng lá»›n chá»‰ má»¥c chá»‰ Ä‘á»c mÃ  khÃ´ng thÆ°á»ng xuyÃªn truy cáº­p. Do cÃ¡c chá»‰ má»¥c nÃ y chá»‰ Ä‘á»c, nÃºt áº¥m cÃ³ xu hÆ°á»›ng gáº¯n káº¿t má»™t lÆ°á»£ng lá»›n Ä‘Ä©a (Ä‘Ä©a thÃ´ng thÆ°á»ng) thay vÃ¬ SSD. Cáº¥u hÃ¬nh bá»™ nhá»›, CPU giá»‘ng nhÆ° nÃºt nÃ³ng; sá»‘ lÆ°á»£ng nÃºt thÆ°á»ng cÅ©ng lá»›n hÆ¡n hoáº·c báº±ng 3.</p><p>Äá»ƒ Ä‘áº·t nÃºt thÃ nh loáº¡i áº¥m, báº¡n cáº§n cáº¥u hÃ¬nh nhÆ° sau trong elasticsearch.yml:</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>node.attr.box_type: warm</span></span></code></pre></div><p>Äá»“ng thá»i, báº¡n cÅ©ng cÃ³ thá»ƒ Ä‘áº·t <code>index.codec:best_compression</code> trong elasticsearch.yml Ä‘á»ƒ Ä‘áº£m báº£o cáº¥u hÃ¬nh nÃ©n cá»§a nÃºt áº¥m.</p><p>Khi chá»‰ má»¥c khÃ´ng cÃ²n Ä‘Æ°á»£c truy váº¥n thÆ°á»ng xuyÃªn, báº¡n cÃ³ thá»ƒ Ä‘Ã¡nh dáº¥u chá»‰ má»¥c lÃ  áº¥m thÃ´ng qua <code>index.routing.allocation.require.box_type:warm</code>, Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng chá»‰ má»¥c khÃ´ng Ä‘Æ°á»£c ghi vÃ o nÃºt nÃ³ng, Ä‘á»ƒ giá»¯ nguyÃªn tÃ i nguyÃªn Ä‘Ä©a SSD. Má»™t khi báº¡n Ä‘áº·t thuá»™c tÃ­nh nÃ y, ES sáº½ tá»± Ä‘á»™ng há»£p nháº¥t chá»‰ má»¥c vÃ o nÃºt áº¥m.</p><h4 id="nut-Ä‘ieu-phoi-coordinating" tabindex="-1"><a class="header-anchor" href="#nut-Ä‘ieu-phoi-coordinating"><span>NÃºt Ä‘iá»u phá»‘i (coordinating)</span></a></h4><p>NÃºt Ä‘iá»u phá»‘i Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ Ä‘iá»u phá»‘i trong phÃ¢n tÃ¡n, tráº£ vá» dá»¯ liá»‡u sau khi káº¿t há»£p tá»« cÃ¡c phÃ¢n Ä‘oáº¡n hoáº·c nÃºt khÃ¡c. NÃºt nÃ y sáº½ khÃ´ng Ä‘Æ°á»£c chá»n lÃ m nÃºt chÃ­nh, cÅ©ng khÃ´ng lÆ°u trá»¯ báº¥t ká»³ dá»¯ liá»‡u chá»‰ má»¥c nÃ o. MÃ¡y chá»§ nÃ y chá»§ yáº¿u Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ cÃ¢n báº±ng táº£i truy váº¥n. Khi truy váº¥n, thÆ°á»ng sáº½ liÃªn quan Ä‘áº¿n viá»‡c truy váº¥n dá»¯ liá»‡u tá»« nhiá»u mÃ¡y chá»§ nÃºt vÃ  phÃ¢n phá»‘i yÃªu cáº§u Ä‘áº¿n nhiá»u mÃ¡y chá»§ nÃºt chá»‰ Ä‘á»‹nh, vÃ  xá»­ lÃ½ tá»•ng há»£p káº¿t quáº£ tráº£ vá» tá»« cÃ¡c mÃ¡y chá»§ nÃºt, cuá»‘i cÃ¹ng tráº£ vá» cho mÃ¡y khÃ¡ch. Trong cá»¥m ES, táº¥t cáº£ cÃ¡c nÃºt Ä‘á»u cÃ³ thá»ƒ lÃ  nÃºt Ä‘iá»u phá»‘i, nhÆ°ng báº¡n cÃ³ thá»ƒ Ä‘áº·tÂ <code>node.master</code>,Â <code>node.data</code>,Â <code>node.ingest</code>Â táº¥t cáº£ Ä‘á»u lÃ Â <code>false</code>Â Ä‘á»ƒ Ä‘áº·t nÃºt Ä‘iá»u phá»‘i chuyÃªn dá»¥ng. Cáº§n CPU tá»‘t vÃ  bá»™ nhá»› cao.</p><ul><li>node.master:false vÃ  node.data:true, mÃ¡y chá»§ nÃºt nÃ y chá»‰ hoáº¡t Ä‘á»™ng nhÆ° má»™t nÃºt dá»¯ liá»‡u, chá»‰ dÃ¹ng Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u chá»‰ má»¥c, lÃ m cho mÃ¡y chá»§ nÃºt nÃ y chá»‰ cÃ³ má»™t chá»©c nÄƒng, chá»‰ dÃ¹ng Ä‘á»ƒ lÆ°u trá»¯ dá»¯ liá»‡u vÃ  truy váº¥n dá»¯ liá»‡u, giáº£m tá»· lá»‡ tiÃªu hao tÃ i nguyÃªn cá»§a nÃ³.</li><li>node.master:true vÃ  node.data:false, mÃ¡y chá»§ nÃºt nÃ y chá»‰ hoáº¡t Ä‘á»™ng nhÆ° má»™t nÃºt chÃ­nh, nhÆ°ng khÃ´ng lÆ°u trá»¯ báº¥t ká»³ dá»¯ liá»‡u chá»‰ má»¥c nÃ o, mÃ¡y chá»§ nÃºt nÃ y sáº½ sá»­ dá»¥ng tÃ i nguyÃªn ráº£nh rá»—i cá»§a chÃ­nh nÃ³, Ä‘á»ƒ Ä‘iá»u phá»‘i cÃ¡c yÃªu cáº§u táº¡o chá»‰ má»¥c hoáº·c truy váº¥n, vÃ  phÃ¢n phá»‘i cÃ¡c yÃªu cáº§u nÃ y má»™t cÃ¡ch há»£p lÃ½ Ä‘áº¿n cÃ¡c mÃ¡y chá»§ nÃºt liÃªn quan.</li><li>node.master:false vÃ  node.data:false, mÃ¡y chá»§ nÃºt nÃ y khÃ´ng sáº½ Ä‘Æ°á»£c chá»n lÃ m nÃºt chÃ­nh, cÅ©ng khÃ´ng lÆ°u trá»¯ báº¥t ká»³ dá»¯ liá»‡u chá»‰ má»¥c nÃ o. MÃ¡y chá»§ nÃ y chá»§ yáº¿u Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ cÃ¢n báº±ng táº£i truy váº¥n. Khi truy váº¥n, thÆ°á»ng sáº½ liÃªn quan Ä‘áº¿n viá»‡c truy váº¥n dá»¯ liá»‡u tá»« nhiá»u mÃ¡y chá»§ nÃºt vÃ  phÃ¢n phá»‘i yÃªu cáº§u Ä‘áº¿n nhiá»u mÃ¡y chá»§ nÃºt chá»‰ Ä‘á»‹nh, vÃ  xá»­ lÃ½ tá»•ng há»£p káº¿t quáº£ tráº£ vá» tá»« cÃ¡c mÃ¡y chá»§ nÃºt, cuá»‘i cÃ¹ng tráº£ vá» cho mÃ¡y khÃ¡ch.</li></ul><h2 id="tat-chuc-nang-http-tren-cac-nut-du-lieu" tabindex="-1"><a class="header-anchor" href="#tat-chuc-nang-http-tren-cac-nut-du-lieu"><span>Táº¯t chá»©c nÄƒng http trÃªn cÃ¡c nÃºt dá»¯ liá»‡u</span></a></h2><p>Äá»‘i vá»›i táº¥t cáº£ cÃ¡c nÃºt dá»¯ liá»‡u trong cá»¥m Elasticsearch, khÃ´ng cáº§n má»Ÿ dá»‹ch vá»¥ http. Äáº·t tham sá»‘ cáº¥u hÃ¬nh nhÆ° sau: <code>http.enabled:false</code>, Ä‘á»“ng thá»i khÃ´ng cÃ i Ä‘áº·t cÃ¡c plugin giÃ¡m sÃ¡t nhÆ° head, bigdesk, marvel, v.v. Äiá»u nÃ y Ä‘áº£m báº£o ráº±ng cÃ¡c nÃºt dá»¯ liá»‡u chá»‰ cáº§n xá»­ lÃ½ cÃ¡c hoáº¡t Ä‘á»™ng nhÆ° táº¡o/cáº­p nháº­t/xÃ³a/truy váº¥n dá»¯ liá»‡u chá»‰ má»¥c.</p><p>Chá»©c nÄƒng http cÃ³ thá»ƒ Ä‘Æ°á»£c má»Ÿ trÃªn cÃ¡c mÃ¡y chá»§ khÃ´ng pháº£i nÃºt dá»¯ liá»‡u, vÃ  cÃ¡c plugin giÃ¡m sÃ¡t liÃªn quan cÅ©ng Ä‘Æ°á»£c cÃ i Ä‘áº·t trÃªn nhá»¯ng mÃ¡y chá»§ nÃ y, Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ giÃ¡m sÃ¡t tráº¡ng thÃ¡i cá»¥m Elasticsearch vÃ  cÃ¡c thÃ´ng tin dá»¯ liá»‡u khÃ¡c. Viá»‡c lÃ m nÃ y vá»«a Ä‘áº£m báº£o an ninh dá»¯ liá»‡u, vá»«a cáº£i thiá»‡n hiá»‡u suáº¥t dá»‹ch vá»¥.</p><h2 id="moi-may-chu-nen-chi-trien-khai-mot-nut" tabindex="-1"><a class="header-anchor" href="#moi-may-chu-nen-chi-trien-khai-mot-nut"><span>Má»—i mÃ¡y chá»§ nÃªn chá»‰ triá»ƒn khai má»™t nÃºt</span></a></h2><p>Má»™t mÃ¡y chá»§ váº­t lÃ½ cÃ³ thá»ƒ khá»Ÿi Ä‘á»™ng nhiá»u nÃºt mÃ¡y chá»§ (báº±ng cÃ¡ch Ä‘áº·t cÃ¡c cá»•ng khá»Ÿi Ä‘á»™ng khÃ¡c nhau), nhÆ°ng tÃ i nguyÃªn CPU, bá»™ nhá»›, Ä‘Ä©a cá»©ng, v.v. cá»§a má»™t mÃ¡y chá»§ cuá»‘i cÃ¹ng lÃ  cÃ³ giá»›i háº¡n, vÃ¬ váº­y, tá»« gÃ³c Ä‘á»™ hiá»‡u suáº¥t mÃ¡y chá»§, khÃ´ng khuyáº¿n nghá»‹ khá»Ÿi Ä‘á»™ng nhiá»u nÃºt trÃªn má»™t mÃ¡y chá»§.</p><h2 id="cai-Ä‘at-phan-manh-cum" tabindex="-1"><a class="header-anchor" href="#cai-Ä‘at-phan-manh-cum"><span>CÃ i Ä‘áº·t phÃ¢n máº£nh cá»¥m</span></a></h2><p>Má»™t khi báº¡n Ä‘Ã£ táº¡o chá»‰ má»¥c trÃªn ES, báº¡n khÃ´ng thá»ƒ Ä‘iá»u chá»‰nh cÃ i Ä‘áº·t phÃ¢n máº£nh. Trong ES, má»™t phÃ¢n máº£nh thá»±c táº¿ tÆ°Æ¡ng á»©ng vá»›i má»™t chá»‰ má»¥c lucene, vÃ  viá»‡c Ä‘á»c vÃ  ghi chá»‰ má»¥c lucene sáº½ tiÃªu thá»¥ ráº¥t nhiá»u tÃ i nguyÃªn há»‡ thá»‘ng, do Ä‘Ã³, sá»‘ lÆ°á»£ng phÃ¢n máº£nh khÃ´ng nÃªn Ä‘Æ°á»£c Ä‘áº·t quÃ¡ lá»›n; vÃ¬ váº­y, khi táº¡o chá»‰ má»¥c, viá»‡c cáº¥u hÃ¬nh sá»‘ lÆ°á»£ng phÃ¢n máº£nh má»™t cÃ¡ch há»£p lÃ½ ráº¥t quan trá»ng. NÃ³i chung, chÃºng ta tuÃ¢n theo má»™t sá»‘ nguyÃªn táº¯c sau:</p><ol><li>Kiá»ƒm soÃ¡t dung lÆ°á»£ng Ä‘Ä©a mÃ  má»—i phÃ¢n máº£nh chiáº¿m khÃ´ng vÆ°á»£t quÃ¡ cÃ i Ä‘áº·t khÃ´ng gian heap JVM tá»‘i Ä‘a cá»§a ES (thÃ´ng thÆ°á»ng khÃ´ng Ä‘Æ°á»£c Ä‘áº·t quÃ¡ 32 G, tham kháº£o nguyÃªn táº¯c cÃ i Ä‘áº·t bá»™ nhá»› JVM á»Ÿ trÃªn), do Ä‘Ã³, náº¿u tá»•ng dung lÆ°á»£ng chá»‰ má»¥c khoáº£ng 500 G, thÃ¬ sá»‘ lÆ°á»£ng phÃ¢n máº£nh khoáº£ng 16 lÃ  Ä‘á»§; táº¥t nhiÃªn, tá»‘t nháº¥t lÃ  cÃ¢n nháº¯c nguyÃªn táº¯c 2 cÃ¹ng má»™t lÃºc.</li><li>Xem xÃ©t sá»‘ lÆ°á»£ng nÃºt, thÆ°á»ng má»™t nÃºt Ä‘Ã´i khi chá»‰ lÃ  má»™t mÃ¡y chá»§ váº­t lÃ½, náº¿u sá»‘ lÆ°á»£ng phÃ¢n máº£nh quÃ¡ nhiá»u, vÆ°á»£t quÃ¡ sá»‘ lÆ°á»£ng nÃºt, ráº¥t cÃ³ thá»ƒ má»™t nÃºt sáº½ chá»©a nhiá»u phÃ¢n máº£nh, náº¿u nÃºt nÃ y gáº·p sá»± cá»‘, ngay cáº£ khi giá»¯ Ä‘Æ°á»£c hÆ¡n 1 báº£n sao, cÅ©ng cÃ³ thá»ƒ dáº«n Ä‘áº¿n máº¥t dá»¯ liá»‡u, cá»¥m khÃ´ng thá»ƒ khÃ´i phá»¥c. VÃ¬ váº­y, <strong>thÃ´ng thÆ°á»ng, chÃºng tÃ´i Ä‘áº·t sá»‘ lÆ°á»£ng phÃ¢n máº£nh khÃ´ng vÆ°á»£t quÃ¡ 3 láº§n sá»‘ lÆ°á»£ng nÃºt</strong>.</li></ol><h2 id="tai-lieu-tham-khao" tabindex="-1"><a class="header-anchor" href="#tai-lieu-tham-khao"><span>TÃ i liá»‡u tham kháº£o</span></a></h2><ul><li><a href="https://www.knowledgedict.com/tutorial/elasticsearch-intro.html" target="_blank" rel="noopener noreferrer">HÆ°á»›ng dáº«n Elasticsearch</a></li></ul></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/database/elasticsearch/optimization.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/database/elasticsearch/analyzer.html" aria-label="Elasticsearch Analyzer"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon>Elasticsearch Analyzer</div></a><a class="route-link auto-link next" href="/database/elasticsearch/rest-api.html" aria-label="Elasticsearch REST API"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Elasticsearch REST API<iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with â¤ï¸ by Hung Nguyen</div><div class="copyright">Copyright Â© 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-5QVbWi7Z.js" defer></script>
  </body>
</html>
