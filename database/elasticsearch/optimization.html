<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/database/elasticsearch/optimization.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="Elasticsearch performance optimization"><meta property="og:description" content="Tối ưu hóa hiệu suất Elasticsearch Elasticsearch là công cụ tìm kiếm cấp doanh nghiệp phổ biến hiện nay, được thiết kế để hoạt động trong môi trường đám mây, có khả năng tìm kiế..."><meta property="og:type" content="article"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-06-28T15:54:38.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:tag" content="elasticssearch"><meta property="article:modified_time" content="2024-06-28T15:54:38.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Elasticsearch performance optimization","image":[""],"dateModified":"2024-06-28T15:54:38.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>Elasticsearch performance optimization | VanHung4499</title><meta name="description" content="Tối ưu hóa hiệu suất Elasticsearch Elasticsearch là công cụ tìm kiếm cấp doanh nghiệp phổ biến hiện nay, được thiết kế để hoạt động trong môi trường đám mây, có khả năng tìm kiế...">
    <link rel="preload" href="/assets/style-DFXXOFfS.css" as="style"><link rel="stylesheet" href="/assets/style-DFXXOFfS.css">
    <link rel="modulepreload" href="/assets/app-5QVbWi7Z.js"><link rel="modulepreload" href="/assets/optimization.html-COw2kjA7.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon>Project<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/rouyi-vue-pro/" aria-label="Rouyi Vue Pro"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Rouyi Vue Pro<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/yudao-cloud/" aria-label="Yudao Cloud"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Yudao Cloud<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interview/" aria-label="Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:account-tie" width="1em" height="1em"></iconify-icon><!--]-->Interview<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">SQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Redis</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">MongoDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Elasticsearch</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/overview.html" aria-label="Elasticsearch Overview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Overview<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/quick-start.html" aria-label="Elasticsearch Quick Start"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Quick Start<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/intro.html" aria-label="Elasticsearch Intro"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Intro<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/es-index.html" aria-label="Elasticsearch Index"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Index<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/mapping.html" aria-label="Elasticsearch Mapping"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Mapping<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/highlight-search-display.html" aria-label="Elasticsearch Highlight Search and Display"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Highlight Search and Display<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/query.html" aria-label="Elasticsearch Query"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Query<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/sorting.html" aria-label="Elasticsearch Sorting"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Sorting<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/aggregation.html" aria-label="Elasticsearch Aggregation"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Aggregation<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/analyzer.html" aria-label="Elasticsearch Analyzer"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Analyzer<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/database/elasticsearch/optimization.html" aria-label="Elasticsearch performance optimization"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch performance optimization<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/rest-api.html" aria-label="Elasticsearch REST API"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch REST API<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/cluster-shard.html" aria-label="Elasticsearch Cluster and Shard"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Cluster and Shard<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/operation.html" aria-label="Elasticsearch Operation"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Operation<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/database/elasticsearch/interview.html" aria-label="Elasticsearch Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch Interview<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Elastic Stack</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon>Elasticsearch performance optimization</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-28T15:54:38.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 25 min</span><meta property="timeRequired" content="PT25M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color4 clickable" role="navigation">elasticssearch</span><!--]--><meta property="articleSection" content="elasticssearch"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color4 clickable" role="navigation">elasticssearch</span><!--]--><meta property="keywords" content="elasticssearch"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#toi-uu-hoa-cau-hinh-phan-cung">Tối ưu hóa cấu hình phần cứng</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cau-hinh-cpu">Cấu hình CPU</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cau-hinh-bo-nho">Cấu hình bộ nhớ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#đia">Đĩa</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cai-đat-toi-uu-hoa-chi-muc">Cài đặt tối ưu hóa chỉ mục</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#gui-hang-loat">Gửi hàng loạt</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tang-khoang-thoi-gian-refresh">Tăng khoảng thời gian Refresh</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chinh-sua-cai-đat-index-buffer-size">Chỉnh sửa cài đặt index_buffer_size</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chinh-sua-cai-đat-lien-quan-đen-translog">Chỉnh sửa cài đặt liên quan đến translog</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chu-y-su-dung-truong-id">Chú ý sử dụng trường _id</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chu-y-su-dung-truong-all-va-truong-source">Chú ý sử dụng trường _all và trường _source</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#su-dung-thuoc-tinh-index-mot-cach-hop-ly">Sử dụng thuộc tính index một cách hợp lý</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#giam-so-luong-ban-sao">Giảm số lượng bản sao</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#toi-uu-hoa-ve-truy-van">Tối ưu hóa về truy vấn</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-hoa-đinh-tuyen">Tối ưu hóa định tuyến</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#filter-vs-query">Filter VS Query</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#phan-trang-sau">Phân trang sâu</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#su-dung-script-mot-cach-hop-ly">Sử dụng script một cách hợp lý</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#toi-uu-hoa-cau-truc-du-lieu">Tối ưu hóa cấu trúc dữ liệu</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#giam-thieu-cac-truong-khong-can-thiet">Giảm thiểu các trường không cần thiết</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nested-object-vs-parent-child">Nested Object vs Parent/Child</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#chon-mapping-tinh-neu-khong-can-thiet-hay-vo-hieu-hoa-mapping-đong">Chọn mapping tĩnh, nếu không cần thiết, hãy vô hiệu hóa mapping động</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#thiet-ke-kien-truc-cum">Thiết kế kiến trúc cụm</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#phan-tach-nut-chinh-nut-du-lieu-va-nut-đieu-phoi">Phân tách nút chính, nút dữ liệu và nút điều phối</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tat-chuc-nang-http-tren-cac-nut-du-lieu">Tắt chức năng http trên các nút dữ liệu</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#moi-may-chu-nen-chi-trien-khai-mot-nut">Mỗi máy chủ nên chỉ triển khai một nút</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cai-đat-phan-manh-cum">Cài đặt phân mảnh cụm</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tai-lieu-tham-khao">Tài liệu tham khảo</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="toi-uu-hoa-hieu-suat-elasticsearch" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-hieu-suat-elasticsearch"><span>Tối ưu hóa hiệu suất Elasticsearch</span></a></h1><p>Elasticsearch là công cụ tìm kiếm cấp doanh nghiệp phổ biến hiện nay, được thiết kế để hoạt động trong môi trường đám mây, có khả năng tìm kiếm thời gian thực, ổn định, đáng tin cậy, nhanh chóng và dễ dàng cài đặt. Dù là một sản phẩm sẵn sàng sử dụng ngay sau khi mở hộp, sau khi đưa vào môi trường sản xuất, chúng ta không thể đảm bảo được hiệu suất và ổn định của nó. Việc tăng cường hiệu suất dịch vụ dựa trên tình hình thực tế có rất nhiều kỹ thuật. Trong chương này, chúng tôi sẽ chia sẻ những kinh nghiệm tối ưu hóa hiệu suất Elasticsearch từ thực tiễn, chủ yếu từ các khía cạnh như tối ưu hóa cấu hình phần cứng, cài đặt tối ưu hóa chỉ mục, tối ưu hóa truy vấn, tối ưu hóa cấu trúc dữ liệu, tối ưu hóa kiến trúc cụm.</p><h2 id="toi-uu-hoa-cau-hinh-phan-cung" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-cau-hinh-phan-cung"><span>Tối ưu hóa cấu hình phần cứng</span></a></h2><p>Nâng cấp cấu hình phần cứng luôn là phương pháp tăng cường khả năng phục vụ nhanh chóng và hiệu quả nhất, ba yếu tố có thể ảnh hưởng đến hiệu suất ứng dụng ở cấp độ hệ thống bao gồm: CPU, bộ nhớ và IO, có thể tối ưu hóa hiệu suất ES từ ba khía cạnh này.</p><h3 id="cau-hinh-cpu" tabindex="-1"><a class="header-anchor" href="#cau-hinh-cpu"><span>Cấu hình CPU</span></a></h3><p>Nói chung, có một số lý do khiến CPU bận rộn:</p><ol><li>Có vòng lặp vô hạn, không chặn, khớp mẫu thông thường hoặc chỉ tính toán trong luồng;</li><li>Xảy ra GC thường xuyên;</li><li>Chuyển đổi ngữ cảnh của nhiều luồng;</li></ol><p>Hầu hết các triển khai Elasticsearch thường không đặt yêu cầu cao đối với CPU. Do đó, so với các tài nguyên khác, việc cấu hình bao nhiêu (CPU) không quan trọng lắm. Bạn nên chọn bộ xử lý hiện đại có nhiều nhân, máy chủ trong cụm thường sử dụng từ 2 đến 8 nhân. <strong>Nếu bạn phải chọn giữa CPUs nhanh hơn và số lượng nhân nhiều hơn, việc chọn số lượng nhân nhiều hơn sẽ tốt hơn</strong>. Số lượng nhân bổ sung cung cấp đồng thời nhiều hơn rất nhiều so với tốc độ xung nhịp nhanh hơn một chút.</p><h3 id="cau-hinh-bo-nho" tabindex="-1"><a class="header-anchor" href="#cau-hinh-bo-nho"><span>Cấu hình bộ nhớ</span></a></h3><p>Nếu có một loại tài nguyên nào đó sẽ được tiêu thụ trước tiên, đó có thể là bộ nhớ. Sắp xếp và tổng hợp đều tiêu thụ nhiều bộ nhớ, vì vậy việc có đủ không gian heap để xử lý chúng là rất quan trọng. Ngay cả khi không gian heap khá nhỏ, nó cũng có thể cung cấp thêm bộ nhớ cho bộ đệm tệp hệ điều hành. Bởi vì nhiều cấu trúc dữ liệu mà Lucene sử dụng dựa trên định dạng dựa trên đĩa, Elasticsearch tận dụng bộ đệm hệ điều hành có thể tạo ra hiệu quả lớn.</p><p><strong>Máy có bộ nhớ 64 GB là rất lý tưởng</strong>, nhưng máy 32 GB và 16 GB cũng rất phổ biến. Dưới 8 GB sẽ phản tác dụng (bạn cuối cùng sẽ cần rất nhiều máy nhỏ), máy có bộ nhớ lớn hơn 64 GB cũng sẽ gặp vấn đề.</p><p>Do ES được xây dựng dựa trên lucene, và sức mạnh của thiết kế lucene nằm ở chỗ lucene có thể tận dụng tốt bộ nhớ hệ điều hành để lưu trữ dữ liệu chỉ mục, để cung cấp hiệu suất truy vấn nhanh. Các tệp phân đoạn chỉ mục của lucene được lưu trữ trong một tệp duy nhất và không thay đổi, đối với hệ điều hành, có thể giữ tệp chỉ mục trong bộ đệm một cách thân thiện, để truy cập nhanh; do đó, chúng ta cần để một nửa bộ nhớ vật lý cho lucene; nửa còn lại của bộ nhớ vật lý để cho ES (JVM heap).</p><h4 id="phan-bo-bo-nho" tabindex="-1"><a class="header-anchor" href="#phan-bo-bo-nho"><span>Phân bổ bộ nhớ</span></a></h4><p>Khi bộ nhớ máy nhỏ hơn 64G, tuân theo nguyên tắc chung, 50% cho ES, 50% cho lucene.</p><p>Khi bộ nhớ máy lớn hơn 64G, tuân theo nguyên tắc sau:</p><ul><li>Nếu cảnh sử dụng chính là tìm kiếm toàn văn bản, thì nên cấp 4~32G bộ nhớ cho ES Heap; bộ nhớ khác để cho hệ điều hành, cho lucene sử dụng (segments cache), để cung cấp hiệu suất truy vấn nhanh hơn.</li><li>Nếu cảnh sử dụng chính là tổng hợp hoặc sắp xếp, và hầu hết là numerics, dates, geo_points và các loại ký tự not_analyzed, nên cấp 4~32G bộ nhớ cho ES Heap; bộ nhớ khác để cho hệ điều hành, cho lucene sử dụng, cung cấp hiệu suất tổng hợp, sắp xếp nhanh hơn dựa trên tài liệu.</li><li>Nếu cảnh sử dụng là tổng hợp hoặc sắp xếp, và tất cả đều dựa trên dữ liệu ký tự analyzed, thì cần nhiều heap size hơn, nên chạy nhiều thực thể ES trên máy, mỗi thực thể giữ không vượt quá 50% cài đặt heap ES (nhưng không vượt quá 32 G, khi heap memory được cài đặt dưới 32 G, JVM sử dụng kỹ thuật nén chỉ số đối tượng để tiết kiệm không gian), hơn 50% để cho lucene.</li></ul><h4 id="vo-hieu-hoa-swap" tabindex="-1"><a class="header-anchor" href="#vo-hieu-hoa-swap"><span>Vô hiệu hóa swap</span></a></h4><p>Vô hiệu hóa swap, một khi cho phép trao đổi bộ nhớ với đĩa, sẽ gây ra vấn đề về hiệu suất nghiêm trọng. Có thể thông qua <code>bootstrap.memory_lock: true</code> trong elasticsearch.yml, để giữ JVM khóa bộ nhớ, đảm bảo hiệu suất của ES.</p><h4 id="cai-đat-gc" tabindex="-1"><a class="header-anchor" href="#cai-đat-gc"><span>Cài đặt GC</span></a></h4><p>Giữ cài đặt GC hiện tại, cài đặt mặc định là: Concurrent-Mark and Sweep (CMS), không chuyển sang G1 GC, vì hiện tại G1 vẫn có rất nhiều BUG.</p><p>Giữ cài đặt hiện tại của thread pool, hiện tại cài đặt thread pool của ES đã có nhiều cài đặt tối ưu hóa so với 1.X, giữ nguyên là được; kích thước thread pool mặc định bằng số lượng lõi CPU. Nếu cần thay đổi, cài đặt theo công thức ((số lượng lõi CPU * 3) / 2) + 1; không được vượt quá gấp đôi số lượng lõi CPU; nhưng không nên thay đổi cấu hình mặc định, nếu không sẽ gây tổn thương cho CPU.</p><h3 id="đia" tabindex="-1"><a class="header-anchor" href="#đia"><span>Đĩa</span></a></h3><p>Đĩa quan trọng đối với tất cả các cụm, đặc biệt quan trọng đối với các cụm có lượng ghi lớn (ví dụ như những cụm lưu trữ dữ liệu nhật ký). Đĩa là hệ thống con chậm nhất trên máy chủ, điều này có nghĩa là những cụm có lượng ghi lớn dễ dàng làm cho đĩa bão hòa, khiến nó trở thành nút thắt cổ chai của cụm.</p><p><strong>Trong phạm vi chịu đựng được áp lực kinh tế, hãy sử dụng ổ đĩa thể rắn (SSD) càng nhiều càng tốt</strong>. So với bất kỳ phương tiện quay nào (ổ đĩa cứng cơ học, băng từ, v.v.), ổ đĩa thể rắn sẽ tăng cường IO đáng kể, dù là ghi ngẫu nhiên hay ghi tuần tự.</p><blockquote><p>Nếu bạn đang sử dụng SSD, hãy đảm bảo rằng trình lập lịch I/O của hệ thống bạn được cấu hình đúng. Khi bạn ghi dữ liệu vào đĩa, trình lập lịch I/O quyết định khi nào thực sự gửi dữ liệu đến đĩa. Hầu hết các phiên bản *nix mặc định có trình lập lịch là cfq (Completely Fair Queuing).</p><p>Trình lập lịch phân bổ thời gian cho mỗi quy trình. Và tối ưu hóa việc chuyển các hàng đợi lớn đến đĩa. Nhưng nó được tối ưu hóa cho phương tiện quay: đặc tính cố hữu của ổ đĩa cơ học có nghĩa là việc ghi dữ liệu vào đĩa dựa trên bố cục vật lý sẽ hiệu quả hơn.</p><p>Điều này không hiệu quả đối với SSD, mặc dù không liên quan đến ổ đĩa cơ học. Tuy nhiên, deadline hoặc noop nên được sử dụng. Trình lập lịch deadline tối ưu hóa dựa trên thời gian chờ ghi, trong khi noop chỉ là một hàng đợi FIFO đơn giản.</p><p>Thay đổi đơn giản này có thể tạo ra sự khác biệt đáng kể. Chỉ cần sử dụng trình lập lịch đúng, chúng tôi đã thấy khả năng ghi tăng lên 500 lần.</p></blockquote><p><strong>Nếu bạn sử dụng phương tiện quay (như ổ đĩa cơ học), hãy cố gắng có được ổ đĩa nhanh nhất có thể (ổ đĩa máy chủ hiệu suất cao, ổ đĩa 15k RPM)</strong>.</p><p><strong>Sử dụng RAID0 là cách hiệu quả để tăng tốc độ đĩa, đối với cả ổ đĩa cơ học và SSD</strong>. Không cần phải sử dụng gương hoặc các biến thể RAID khác, bởi vì Elasticsearch đã cung cấp chức năng sao lưu ở cấp độ tự thân thông qua các bản sao, vì vậy không cần sử dụng chức năng sao lưu của đĩa, đồng thời nếu sử dụng chức năng sao lưu của đĩa, sẽ ảnh hưởng lớn đến tốc độ ghi.</p><p><strong>Cuối cùng, hãy tránh sử dụng lưu trữ kết nối mạng (NAS)</strong>. Mọi người thường tuyên bố rằng giải pháp NAS của họ nhanh hơn và đáng tin cậy hơn so với ổ đĩa cục bộ. Bỏ qua những tuyên bố này, chúng tôi chưa bao giờ thấy NAS đáng giá cho sự quảng cáo lớn của nó. NAS thường rất chậm, hiển thị độ trễ lớn hơn và phương sai độ trễ trung bình rộng hơn, và nó là điểm lỗi đơn.</p><h2 id="cai-đat-toi-uu-hoa-chi-muc" tabindex="-1"><a class="header-anchor" href="#cai-đat-toi-uu-hoa-chi-muc"><span>Cài đặt tối ưu hóa chỉ mục</span></a></h2><p>Tối ưu hóa chỉ mục chủ yếu tập trung vào việc tối ưu hóa ở mức độ chèn của Elasticsearch, tốc độ chỉ mục của Elasticsearch thực sự khá nhanh, dữ liệu cụ thể, chúng ta có thể tham khảo dữ liệu benchmark chính thức. Chúng ta có thể tối ưu hóa chỉ mục dựa trên các yêu cầu khác nhau.</p><h3 id="gui-hang-loat" tabindex="-1"><a class="header-anchor" href="#gui-hang-loat"><span>Gửi hàng loạt</span></a></h3><p>Khi có rất nhiều dữ liệu cần gửi, nên sử dụng gửi hàng loạt (hoạt động Bulk); ngoài ra, khi sử dụng yêu cầu bulk, mỗi yêu cầu không nên vượt quá vài chục MB, vì nếu quá lớn sẽ dẫn đến việc sử dụng quá nhiều bộ nhớ.</p><p>Ví dụ, trong quá trình thực thi ELK, Logstash indexer gửi dữ liệu vào Elasticsearch, kích thước batch có thể hoạt động như một điểm tối ưu hóa. Tuy nhiên, kích thước tối ưu cần phải xác định dựa trên kích thước tài liệu và hiệu suất máy chủ.</p><p>Ví dụ, trong Logstash, nếu kích thước tài liệu gửi vượt quá 20MB, Logstash sẽ chia một yêu cầu hàng loạt thành nhiều yêu cầu hàng loạt.</p><p>Nếu trong quá trình gửi, bạn gặp phải ngoại lệ EsRejectedExecutionException, thì điều này cho thấy hiệu suất chỉ mục của cụm đã đạt đến giới hạn. Trong trường hợp này, bạn cần tăng nguồn lực của cụm máy chủ hoặc giảm tốc độ thu thập dữ liệu dựa trên quy tắc kinh doanh, ví dụ chỉ thu thập nhật ký cấp Warn, Error trở lên.</p><h3 id="tang-khoang-thoi-gian-refresh" tabindex="-1"><a class="header-anchor" href="#tang-khoang-thoi-gian-refresh"><span>Tăng khoảng thời gian Refresh</span></a></h3><p>Để tăng hiệu suất chỉ mục, Elasticsearch sử dụng chiến lược ghi trễ khi ghi dữ liệu, tức là dữ liệu được ghi vào bộ nhớ trước, khi vượt quá 1 giây mặc định (index.refresh_interval) sẽ thực hiện một hoạt động ghi, tức là làm mới dữ liệu segment trong bộ nhớ vào đĩa, lúc này chúng ta mới có thể tìm kiếm dữ liệu. Đây là lý do tại sao Elasticsearch cung cấp chức năng tìm kiếm gần thời gian thực, chứ không phải là tìm kiếm thời gian thực.</p><p>Nếu hệ thống của chúng ta không đặt yêu cầu cao về độ trễ dữ liệu, chúng ta <strong>có thể tăng khoảng thời gian làm mới để giảm áp lực hợp nhất segment và tăng tốc độ chỉ mục</strong>. Ví dụ, trong quá trình theo dõi toàn bộ chuỗi, chúng tôi đã đặt <code>index.refresh_interval</code> thành 30 giây, giảm số lần làm mới. Một ví dụ khác, khi tiến hành chỉ mục toàn bộ, bạn có thể tạm thời tắt số lần làm mới, tức là đặt <code>index.refresh_interval</code> thành -1, sau khi dữ liệu được nhập thành công, hãy mở lại chế độ bình thường, ví dụ 30 giây.</p><blockquote><p>Khi tải dữ liệu lớn, bạn có thể tạm thời không sử dụng refresh và repliccas, đặt index.refresh_interval thành -1, đặt index.number_of_replicas thành 0.</p></blockquote><h3 id="chinh-sua-cai-đat-index-buffer-size" tabindex="-1"><a class="header-anchor" href="#chinh-sua-cai-đat-index-buffer-size"><span>Chỉnh sửa cài đặt index_buffer_size</span></a></h3><p>Cài đặt bộ đệm chỉ mục có thể kiểm soát bao nhiêu bộ nhớ được phân bổ cho quá trình chỉ mục. Đây là một cấu hình toàn cầu, sẽ được áp dụng cho tất cả các phân đoạn khác nhau trên một nút.</p><div class="language-yml" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">indices.memory.index_buffer_size</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">10%</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">indices.memory.min_index_buffer_size</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">48mb</span></span></code></pre></div><p><code>indices.memory.index_buffer_size</code> chấp nhận một phần trăm hoặc một giá trị biểu thị kích thước byte. Mặc định là 10%, có nghĩa là 10% tổng bộ nhớ được phân bổ cho nút được sử dụng để làm kích thước bộ đệm chỉ mục. Giá trị này được chia cho các phân đoạn (shards) khác nhau. Nếu bạn đặt phần trăm, bạn cũng có thể đặt <code>min_index_buffer_size</code> (mặc định là 48mb) và <code>max_index_buffer_size</code> (mặc định không có giới hạn trên).</p><h3 id="chinh-sua-cai-đat-lien-quan-đen-translog" tabindex="-1"><a class="header-anchor" href="#chinh-sua-cai-đat-lien-quan-đen-translog"><span>Chỉnh sửa cài đặt liên quan đến translog</span></a></h3><p>Một là kiểm soát tần suất hoạt động từ bộ nhớ đến ổ cứng, để giảm IO ổ cứng. Bạn có thể đặt thời gian sync_interval lớn hơn. Mặc định là 5 giây.</p><div class="language-yml" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">index.translog.sync_interval</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">5s</span></span></code></pre></div><p>Bạn cũng có thể kiểm soát kích thước khối dữ liệu tranlog, khi đạt đến kích thước threshold, dữ liệu mới sẽ được flush vào tệp chỉ mục lucene. Mặc định là 512mb.</p><div class="language-yml" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">index.translog.flush_threshold_size</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">512mb</span></span></code></pre></div><h3 id="chu-y-su-dung-truong-id" tabindex="-1"><a class="header-anchor" href="#chu-y-su-dung-truong-id"><span>Chú ý sử dụng trường _id</span></a></h3><p>Trong việc sử dụng trường _id, bạn nên tránh tùy chỉnh _id để tránh quản lý phiên bản dựa trên ID; nên sử dụng chiến lược tạo ID mặc định của ES hoặc sử dụng ID kiểu số làm khóa chính.</p><h3 id="chu-y-su-dung-truong-all-va-truong-source" tabindex="-1"><a class="header-anchor" href="#chu-y-su-dung-truong-all-va-truong-source"><span>Chú ý sử dụng trường _all và trường _source</span></a></h3><p>Bạn nên chú ý đến việc sử dụng trường _all và trường _source, tùy thuộc vào tình huống và nhu cầu, trường _all bao gồm tất cả các trường chỉ mục, thuận tiện cho việc tìm kiếm toàn văn, nếu không có nhu cầu này, có thể tắt; _source lưu trữ nội dung tài liệu gốc, nếu không có nhu cầu lấy dữ liệu tài liệu gốc, có thể định nghĩa các trường được đưa vào _source bằng cách đặt thuộc tính includes, excludes.</p><h3 id="su-dung-thuoc-tinh-index-mot-cach-hop-ly" tabindex="-1"><a class="header-anchor" href="#su-dung-thuoc-tinh-index-mot-cach-hop-ly"><span>Sử dụng thuộc tính index một cách hợp lý</span></a></h3><p>Hãy sử dụng thuộc tính index một cách hợp lý, analyzed và not_analyzed, kiểm soát trường có phải là từ vựng hay không dựa trên yêu cầu kinh doanh. Chỉ cần các trường yêu cầu groupby, khi cấu hình, đặt thành not_analyzed để tăng hiệu suất truy vấn hoặc phân loại.</p><h3 id="giam-so-luong-ban-sao" tabindex="-1"><a class="header-anchor" href="#giam-so-luong-ban-sao"><span>Giảm số lượng bản sao</span></a></h3><p>Elasticsearch mặc định số lượng bản sao là 3, mặc dù điều này sẽ cải thiện khả năng sẵn có của cụm, tăng số lượng truy vấn đồng thời, nhưng cũng sẽ ảnh hưởng đến hiệu suất ghi chỉ mục.</p><p>Trong quá trình chỉ mục, cần gửi tài liệu được cập nhật đến các nút bản sao, chờ nút bản sao hoạt động sau đó trả về kết thúc. Khi sử dụng Elasticsearch để tìm kiếm kinh doanh, nên đặt số lượng bản sao là 3, nhưng trong hệ thống nhật ký ELK nội bộ, hệ thống theo dõi phân tán, hoàn toàn có thể đặt số lượng bản sao là 1.</p><h2 id="toi-uu-hoa-ve-truy-van" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-ve-truy-van"><span>Tối ưu hóa về truy vấn</span></a></h2><p>Khi Elasticsearch được sử dụng như một truy vấn gần thời gian thực cho tìm kiếm kinh doanh, việc tối ưu hóa hiệu suất truy vấn trở nên rất quan trọng.</p><h3 id="toi-uu-hoa-đinh-tuyen" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-đinh-tuyen"><span>Tối ưu hóa định tuyến</span></a></h3><p>Khi chúng tôi truy vấn một tài liệu, Elasticsearch làm thế nào để biết một tài liệu nên được lưu trữ trong phân đoạn nào? Thực tế, nó được tính toán thông qua công thức sau đây.</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>shard = hash(routing) % number_of_primary_shards</span></span></code></pre></div><p>Giá trị mặc định của routing là id của tài liệu, nhưng cũng có thể sử dụng giá trị tùy chỉnh, chẳng hạn như ID người dùng.</p><h4 id="truy-van-khong-co-routing" tabindex="-1"><a class="header-anchor" href="#truy-van-khong-co-routing"><span>Truy vấn không có routing</span></a></h4><p>Khi truy vấn, vì không biết dữ liệu cần truy vấn cụ thể nằm trên phân đoạn nào, nên toàn bộ quá trình được chia thành 2 bước:</p><ol><li>Phân phối: Khi yêu cầu đến nút điều phối, nút điều phối sẽ phân phối yêu cầu truy vấn đến mỗi phân đoạn.</li><li>Tổng hợp: Nút điều phối thu thập kết quả truy vấn từ mỗi phân đoạn, sau đó sắp xếp kết quả truy vấn, sau đó trả về kết quả cho người dùng.</li></ol><h4 id="truy-van-co-routing" tabindex="-1"><a class="header-anchor" href="#truy-van-co-routing"><span>Truy vấn có routing</span></a></h4><p>Khi truy vấn, có thể trực tiếp xác định một phân đoạn truy vấn dựa trên thông tin routing, không cần truy vấn tất cả các phân đoạn, sau đó sắp xếp thông qua nút điều phối.</p><p>Như truy vấn người dùng tùy chỉnh ở trên, nếu routing được đặt là userid, thì có thể trực tiếp truy vấn ra dữ liệu, hiệu quả tăng rất nhiều.</p><h3 id="filter-vs-query" tabindex="-1"><a class="header-anchor" href="#filter-vs-query"><span>Filter VS Query</span></a></h3><p>Nếu có thể, hãy sử dụng ngữ cảnh bộ lọc (Filter) thay vì ngữ cảnh truy vấn (Query)</p><ul><li>Query: Tài liệu này khớp với câu truy vấn con này ở mức độ nào?</li><li>Filter: Tài liệu này có khớp với câu truy vấn con không?</li></ul><p>Elasticsearch chỉ cần trả lời &quot;có&quot; hoặc &quot;không&quot; cho các truy vấn Filter, không cần tính điểm liên quan như truy vấn Query, đồng thời kết quả Filter có thể được lưu vào bộ nhớ cache.</p><h3 id="phan-trang-sau" tabindex="-1"><a class="header-anchor" href="#phan-trang-sau"><span>Phân trang sâu</span></a></h3><p>Trong quá trình sử dụng Elasticsearch, nên tránh việc phân trang lớn xảy ra.</p><p>Truy vấn phân trang thông thường đều bắt đầu từ from và lấy size bản ghi, điều này yêu cầu truy vấn và xếp hạng from+size bản ghi đầu tiên trong mỗi phân đoạn. Nút điều phối thu thập from+size bản ghi đầu tiên từ mỗi phân đoạn. Nút điều phối sẽ nhận được N*(from+size) bản ghi, sau đó sắp xếp chúng, sau đó trả về from đến from+size bản ghi. Nếu from hoặc size rất lớn, số lượng bản ghi tham gia sắp xếp sẽ tăng lên nhiều, cuối cùng sẽ làm tăng tiêu hao tài nguyên CPU.</p><p>Có thể giải quyết vấn đề này bằng cách sử dụng scroll và scroll-scan hiệu quả của Elasticsearch.</p><p>Cũng có thể kết hợp với đặc điểm kinh doanh thực tế, nếu kích thước id tài liệu và thời gian tạo tài liệu là đồng nhất và có thứ tự, có thể sử dụng id tài liệu làm offset phân trang, và đặt nó làm một điều kiện truy vấn phân trang.</p><h3 id="su-dung-script-mot-cach-hop-ly" tabindex="-1"><a class="header-anchor" href="#su-dung-script-mot-cach-hop-ly"><span>Sử dụng script một cách hợp lý</span></a></h3><p>Chúng ta biết rằng việc sử dụng script chủ yếu có 3 hình thức, cách biên dịch động nội tuyến, lưu trữ trong thư viện chỉ mục _script và lưu trữ dưới dạng script tệp; cảnh báo thông thường là sắp xếp thô, nên sử dụng cách thứ hai để lưu trữ script trong thư viện chỉ mục _script trước, để biên dịch trước, sau đó sử dụng thông qua id script và kết hợp với params, có thể đạt được mô hình (logic) và dữ liệu đã được phân tách, đồng thời dễ dàng mở rộng và bảo dưỡng mô-đun script. Vui lòng tham khảo chi tiết về nội dung script ES tại <a href="https://www.knowledgedict.com/tutorial/elasticsearch-script.html" target="_blank" rel="noopener noreferrer">Giải thích chi tiết về mô-đun script Elasticsearch</a>.</p><h2 id="toi-uu-hoa-cau-truc-du-lieu" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-cau-truc-du-lieu"><span>Tối ưu hóa cấu trúc dữ liệu</span></a></h2><p>Dựa trên các tình huống sử dụng của Elasticsearch, cấu trúc dữ liệu tài liệu nên được kết hợp với tình huống sử dụng, loại bỏ dữ liệu không cần thiết và không hợp lý.</p><h3 id="giam-thieu-cac-truong-khong-can-thiet" tabindex="-1"><a class="header-anchor" href="#giam-thieu-cac-truong-khong-can-thiet"><span>Giảm thiểu các trường không cần thiết</span></a></h3><p>Nếu Elasticsearch được sử dụng cho dịch vụ tìm kiếm kinh doanh, một số trường không cần thiết để tìm kiếm nên không được lưu trong ES. Điều này không chỉ tiết kiệm không gian, mà còn cải thiện hiệu suất tìm kiếm với cùng một lượng dữ liệu.</p><p>Tránh sử dụng giá trị động làm trường, việc tăng mapping động có thể dẫn đến sự cố ở cụm; tương tự, cần kiểm soát số lượng trường, không lập chỉ mục cho các trường không được sử dụng trong kinh doanh. Kiểm soát số lượng trường chỉ mục, độ sâu của mapping, loại trường chỉ mục, là quan trọng nhất trong việc tối ưu hóa hiệu suất ES.</p><p>Dưới đây là một số cài đặt mặc định của ES về số lượng trường, độ sâu mapping:</p><div class="language-yml" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">index.mapping.nested_objects.limit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">10000</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">index.mapping.total_fields.limit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1000</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">index.mapping.depth.limit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span></span></code></pre></div><h3 id="nested-object-vs-parent-child" tabindex="-1"><a class="header-anchor" href="#nested-object-vs-parent-child"><span>Nested Object vs Parent/Child</span></a></h3><p>Hạn chế sử dụng các trường nested hoặc parent/child, không sử dụng nếu không cần thiết; nested query chậm, parent/child query còn chậm hơn, chậm hơn nested query hàng trăm lần; vì vậy, nếu có thể giải quyết ở giai đoạn thiết kế mapping (thiết kế bảng rộng lớn hoặc sử dụng cấu trúc dữ liệu thông minh), thì không nên sử dụng mapping quan hệ cha-con.</p><p>Nếu bạn cần sử dụng nested fields, hãy đảm bảo không có quá nhiều trường nested, hiện tại giới hạn mặc định của ES là 50. Bởi vì đối với 1 tài liệu, mỗi trường nested sẽ tạo ra một tài liệu độc lập, điều này sẽ làm tăng số lượng tài liệu một cách đáng kể, ảnh hưởng đến hiệu suất truy vấn, đặc biệt là hiệu suất JOIN.</p><div class="language-yml" data-highlighter="shiki" data-ext="yml" data-title="yml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">index.mapping.nested_fields.limit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">50</span></span></code></pre></div><table><thead><tr><th style="text-align:left;">So sánh</th><th style="text-align:left;">Nested Object</th><th style="text-align:left;">Parent/Child</th></tr></thead><tbody><tr><td style="text-align:left;">Ưu điểm</td><td style="text-align:left;">Các tài liệu được lưu trữ cùng nhau, do đó hiệu suất đọc cao</td><td style="text-align:left;">Các tài liệu cha và con có thể được cập nhật độc lập, không ảnh hưởng lẫn nhau</td></tr><tr><td style="text-align:left;">Nhược điểm</td><td style="text-align:left;">Khi cập nhật tài liệu cha hoặc con, cần cập nhật toàn bộ tài liệu</td><td style="text-align:left;">Để duy trì mối quan hệ join, cần sử dụng một phần bộ nhớ, hiệu suất đọc thấp</td></tr><tr><td style="text-align:left;">Tình huống</td><td style="text-align:left;">Tài liệu con cập nhật ít, truy vấn thường xuyên</td><td style="text-align:left;">Tài liệu con cập nhật thường xuyên</td></tr></tbody></table><h3 id="chon-mapping-tinh-neu-khong-can-thiet-hay-vo-hieu-hoa-mapping-đong" tabindex="-1"><a class="header-anchor" href="#chon-mapping-tinh-neu-khong-can-thiet-hay-vo-hieu-hoa-mapping-đong"><span>Chọn mapping tĩnh, nếu không cần thiết, hãy vô hiệu hóa mapping động</span></a></h3><p>Hạn chế sử dụng mapping động càng nhiều càng tốt, điều này có thể dẫn đến sự cố ở cụm, ngoài ra, mapping động có thể mang lại loại dữ liệu không thể kiểm soát, từ đó có thể dẫn đến các ngoại lệ liên quan đến truy vấn, ảnh hưởng đến kinh doanh.</p><p>Ngoài ra, khi Elasticsearch được sử dụng như một công cụ tìm kiếm, chủ yếu chịu trách nhiệm cho việc khớp và sắp xếp truy vấn, vì vậy loại dữ liệu lưu trữ dựa trên hai chức năng này được chia thành hai loại, một là trường cần phải khớp, được sử dụng để tạo chỉ mục đảo ngược cho việc khớp truy vấn, và loại khác là trường đặc trưng được sử dụng cho việc sắp xếp thô, như ctr, số lượt nhấp, số lượng bình luận, v.v.</p><h2 id="thiet-ke-kien-truc-cum" tabindex="-1"><a class="header-anchor" href="#thiet-ke-kien-truc-cum"><span>Thiết kế kiến trúc cụm</span></a></h2><p>Việc triển khai Elasticsearch một cách hợp lý sẽ giúp cải thiện khả năng sẵn sàng tổng thể của dịch vụ.</p><h3 id="phan-tach-nut-chinh-nut-du-lieu-va-nut-đieu-phoi" tabindex="-1"><a class="header-anchor" href="#phan-tach-nut-chinh-nut-du-lieu-va-nut-đieu-phoi"><span>Phân tách nút chính, nút dữ liệu và nút điều phối</span></a></h3><p>Khi thiết kế kiến trúc cụm Elasticsearch, hãy áp dụng kiến trúc phân tách giữa nút chính, nút dữ liệu và nút cân bằng tải. Trong phiên bản 5.x trở đi, nút dữ liệu có thể được phân chia thành mô hình &quot;Hot-Warm&quot;.</p><p>Có 2 tham số trong tệp cấu hình Elasticsearch là node.master và node.data. Sự kết hợp của hai tham số này có thể giúp cải thiện hiệu suất máy chủ.</p><h4 id="nut-chinh-master" tabindex="-1"><a class="header-anchor" href="#nut-chinh-master"><span>Nút chính (master)</span></a></h4><p>Cấu hình <code>node.master:true</code> và <code>node.data:false</code>, nút máy chủ này chỉ hoạt động như một nút chính, nhưng không lưu trữ bất kỳ dữ liệu chỉ mục nào. Chúng tôi khuyên bạn nên chạy 3 nút chính chuyên dụng trong mỗi cụm để cung cấp độ linh hoạt tốt nhất. Khi sử dụng, bạn cũng cần đặt tham số <code>discovery.zen.minimum_master_nodes setting</code> thành 2 để tránh tình trạng phân rã (split-brain). Sử dụng 3 nút chính chuyên dụng, chịu trách nhiệm quản lý cụm và tăng cường sự ổn định tổng thể của trạng thái. Bởi vì 3 nút chính này không chứa dữ liệu và không tham gia vào hoạt động tìm kiếm và chỉ mục thực tế, họ không phải làm những việc giống nhau trên JVM, chẳng hạn như chỉ mục nặng hoặc tìm kiếm tốn thời gian và tài nguyên. Do đó, họ ít có khả năng bị dừng lại do việc thu gom rác. Do đó, cấu hình CPU, bộ nhớ và đĩa của nút chính có thể ít hơn nhiều so với nút dữ liệu.</p><h4 id="nut-du-lieu-data" tabindex="-1"><a class="header-anchor" href="#nut-du-lieu-data"><span>Nút dữ liệu (data)</span></a></h4><p>Cấu hình <code>node.master:false</code> và <code>node.data:true</code>, nút máy chủ này chỉ hoạt động như một nút dữ liệu, chỉ được sử dụng để lưu trữ dữ liệu chỉ mục, làm cho nút máy chủ này hoạt động đơn giản, chỉ được sử dụng để lưu trữ dữ liệu và truy vấn dữ liệu, giảm tỷ lệ tiêu hao tài nguyên của nó.</p><p>Trong phiên bản Elasticsearch 5.x trở đi, nút dữ liệu có thể được chia thành mô hình &quot;Hot-Warm&quot;, tức là chia thành nút nóng (hot node) và nút ấm (warm node).</p><p>nút nóng:</p><p>Nút nóng chủ yếu là nút chỉ mục (nút ghi), đồng thời lưu trữ một số chỉ mục được truy vấn thường xuyên gần đây. Do việc thực hiện chỉ mục rất tiêu tốn CPU và IO, đó là hoạt động IO và CPU nặng, nên sử dụng loại đĩa SSD, duy trì hiệu suất ghi tốt; chúng tôi khuyên bạn nên triển khai ít nhất 3 nút nóng để đảm bảo khả năng sẵn sàng cao. Dựa trên lượng dữ liệu cần thu thập và truy vấn gần đây, bạn có thể tăng số lượng máy chủ để đạt được hiệu suất mong muốn.</p><p>Để đặt nút thành loại nóng, bạn cần cấu hình như sau trong elasticsearch.yml:</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>node.attr.box_type: hot</span></span></code></pre></div><p>Nếu đang hoạt động trên chỉ mục cụ thể, bạn có thể đặt <code>index.routing.allocation.require.box_type: hot</code> để ghi chỉ mục vào nút nóng.</p><p>nút ấm:</p><p>Loại nút này được thiết kế để xử lý một lượng lớn chỉ mục chỉ đọc mà không thường xuyên truy cập. Do các chỉ mục này chỉ đọc, nút ấm có xu hướng gắn kết một lượng lớn đĩa (đĩa thông thường) thay vì SSD. Cấu hình bộ nhớ, CPU giống như nút nóng; số lượng nút thường cũng lớn hơn hoặc bằng 3.</p><p>Để đặt nút thành loại ấm, bạn cần cấu hình như sau trong elasticsearch.yml:</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>node.attr.box_type: warm</span></span></code></pre></div><p>Đồng thời, bạn cũng có thể đặt <code>index.codec:best_compression</code> trong elasticsearch.yml để đảm bảo cấu hình nén của nút ấm.</p><p>Khi chỉ mục không còn được truy vấn thường xuyên, bạn có thể đánh dấu chỉ mục là ấm thông qua <code>index.routing.allocation.require.box_type:warm</code>, để đảm bảo rằng chỉ mục không được ghi vào nút nóng, để giữ nguyên tài nguyên đĩa SSD. Một khi bạn đặt thuộc tính này, ES sẽ tự động hợp nhất chỉ mục vào nút ấm.</p><h4 id="nut-đieu-phoi-coordinating" tabindex="-1"><a class="header-anchor" href="#nut-đieu-phoi-coordinating"><span>Nút điều phối (coordinating)</span></a></h4><p>Nút điều phối được sử dụng để điều phối trong phân tán, trả về dữ liệu sau khi kết hợp từ các phân đoạn hoặc nút khác. Nút này sẽ không được chọn làm nút chính, cũng không lưu trữ bất kỳ dữ liệu chỉ mục nào. Máy chủ này chủ yếu được sử dụng để cân bằng tải truy vấn. Khi truy vấn, thường sẽ liên quan đến việc truy vấn dữ liệu từ nhiều máy chủ nút và phân phối yêu cầu đến nhiều máy chủ nút chỉ định, và xử lý tổng hợp kết quả trả về từ các máy chủ nút, cuối cùng trả về cho máy khách. Trong cụm ES, tất cả các nút đều có thể là nút điều phối, nhưng bạn có thể đặt <code>node.master</code>, <code>node.data</code>, <code>node.ingest</code> tất cả đều là <code>false</code> để đặt nút điều phối chuyên dụng. Cần CPU tốt và bộ nhớ cao.</p><ul><li>node.master:false và node.data:true, máy chủ nút này chỉ hoạt động như một nút dữ liệu, chỉ dùng để lưu trữ dữ liệu chỉ mục, làm cho máy chủ nút này chỉ có một chức năng, chỉ dùng để lưu trữ dữ liệu và truy vấn dữ liệu, giảm tỷ lệ tiêu hao tài nguyên của nó.</li><li>node.master:true và node.data:false, máy chủ nút này chỉ hoạt động như một nút chính, nhưng không lưu trữ bất kỳ dữ liệu chỉ mục nào, máy chủ nút này sẽ sử dụng tài nguyên rảnh rỗi của chính nó, để điều phối các yêu cầu tạo chỉ mục hoặc truy vấn, và phân phối các yêu cầu này một cách hợp lý đến các máy chủ nút liên quan.</li><li>node.master:false và node.data:false, máy chủ nút này không sẽ được chọn làm nút chính, cũng không lưu trữ bất kỳ dữ liệu chỉ mục nào. Máy chủ này chủ yếu được sử dụng để cân bằng tải truy vấn. Khi truy vấn, thường sẽ liên quan đến việc truy vấn dữ liệu từ nhiều máy chủ nút và phân phối yêu cầu đến nhiều máy chủ nút chỉ định, và xử lý tổng hợp kết quả trả về từ các máy chủ nút, cuối cùng trả về cho máy khách.</li></ul><h2 id="tat-chuc-nang-http-tren-cac-nut-du-lieu" tabindex="-1"><a class="header-anchor" href="#tat-chuc-nang-http-tren-cac-nut-du-lieu"><span>Tắt chức năng http trên các nút dữ liệu</span></a></h2><p>Đối với tất cả các nút dữ liệu trong cụm Elasticsearch, không cần mở dịch vụ http. Đặt tham số cấu hình như sau: <code>http.enabled:false</code>, đồng thời không cài đặt các plugin giám sát như head, bigdesk, marvel, v.v. Điều này đảm bảo rằng các nút dữ liệu chỉ cần xử lý các hoạt động như tạo/cập nhật/xóa/truy vấn dữ liệu chỉ mục.</p><p>Chức năng http có thể được mở trên các máy chủ không phải nút dữ liệu, và các plugin giám sát liên quan cũng được cài đặt trên những máy chủ này, được sử dụng để giám sát trạng thái cụm Elasticsearch và các thông tin dữ liệu khác. Việc làm này vừa đảm bảo an ninh dữ liệu, vừa cải thiện hiệu suất dịch vụ.</p><h2 id="moi-may-chu-nen-chi-trien-khai-mot-nut" tabindex="-1"><a class="header-anchor" href="#moi-may-chu-nen-chi-trien-khai-mot-nut"><span>Mỗi máy chủ nên chỉ triển khai một nút</span></a></h2><p>Một máy chủ vật lý có thể khởi động nhiều nút máy chủ (bằng cách đặt các cổng khởi động khác nhau), nhưng tài nguyên CPU, bộ nhớ, đĩa cứng, v.v. của một máy chủ cuối cùng là có giới hạn, vì vậy, từ góc độ hiệu suất máy chủ, không khuyến nghị khởi động nhiều nút trên một máy chủ.</p><h2 id="cai-đat-phan-manh-cum" tabindex="-1"><a class="header-anchor" href="#cai-đat-phan-manh-cum"><span>Cài đặt phân mảnh cụm</span></a></h2><p>Một khi bạn đã tạo chỉ mục trên ES, bạn không thể điều chỉnh cài đặt phân mảnh. Trong ES, một phân mảnh thực tế tương ứng với một chỉ mục lucene, và việc đọc và ghi chỉ mục lucene sẽ tiêu thụ rất nhiều tài nguyên hệ thống, do đó, số lượng phân mảnh không nên được đặt quá lớn; vì vậy, khi tạo chỉ mục, việc cấu hình số lượng phân mảnh một cách hợp lý rất quan trọng. Nói chung, chúng ta tuân theo một số nguyên tắc sau:</p><ol><li>Kiểm soát dung lượng đĩa mà mỗi phân mảnh chiếm không vượt quá cài đặt không gian heap JVM tối đa của ES (thông thường không được đặt quá 32 G, tham khảo nguyên tắc cài đặt bộ nhớ JVM ở trên), do đó, nếu tổng dung lượng chỉ mục khoảng 500 G, thì số lượng phân mảnh khoảng 16 là đủ; tất nhiên, tốt nhất là cân nhắc nguyên tắc 2 cùng một lúc.</li><li>Xem xét số lượng nút, thường một nút đôi khi chỉ là một máy chủ vật lý, nếu số lượng phân mảnh quá nhiều, vượt quá số lượng nút, rất có thể một nút sẽ chứa nhiều phân mảnh, nếu nút này gặp sự cố, ngay cả khi giữ được hơn 1 bản sao, cũng có thể dẫn đến mất dữ liệu, cụm không thể khôi phục. Vì vậy, <strong>thông thường, chúng tôi đặt số lượng phân mảnh không vượt quá 3 lần số lượng nút</strong>.</li></ol><h2 id="tai-lieu-tham-khao" tabindex="-1"><a class="header-anchor" href="#tai-lieu-tham-khao"><span>Tài liệu tham khảo</span></a></h2><ul><li><a href="https://www.knowledgedict.com/tutorial/elasticsearch-intro.html" target="_blank" rel="noopener noreferrer">Hướng dẫn Elasticsearch</a></li></ul></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/database/elasticsearch/optimization.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/database/elasticsearch/analyzer.html" aria-label="Elasticsearch Analyzer"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon>Elasticsearch Analyzer</div></a><a class="route-link auto-link next" href="/database/elasticsearch/rest-api.html" aria-label="Elasticsearch REST API"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Elasticsearch REST API<iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with ❤️ by Hung Nguyen</div><div class="copyright">Copyright © 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-5QVbWi7Z.js" defer></script>
  </body>
</html>
