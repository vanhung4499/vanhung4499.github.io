<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="https://vanhung4499.github.io/rss.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <atom:link href="https://vanhung4499.github.io/rss.xml" rel="self" type="application/rss+xml"/>
    <title>VanHung4499</title>
    <link>https://vanhung4499.github.io/</link>
    <description>My personal wiki and blog</description>
    <language>en-US</language>
    <pubDate>Sun, 30 Jun 2024 16:18:17 GMT</pubDate>
    <lastBuildDate>Sun, 30 Jun 2024 16:18:17 GMT</lastBuildDate>
    <generator>@vuepress/plugin-feed</generator>
    <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
    <category>java</category>
    <category>about</category>
    <category>blog</category>
    <category>database</category>
    <category>devops</category>
    <category>framework</category>
    <category>programming</category>
    <category>project</category>
    <category>any</category>
    <category>elastic</category>
    <category>elasticssearch</category>
    <category>mongodb</category>
    <category>nosql</category>
    <category>db</category>
    <category>mysql</category>
    <category>redis</category>
    <category>interview</category>
    <category>sql</category>
    <category>design</category>
    <category>design-pattern</category>
    <category>Docker</category>
    <category>git</category>
    <category>kubernetes</category>
    <category>linux</category>
    <category>dsa</category>
    <category>algorithm</category>
    <category>data-structure</category>
    <item>
      <title>Buffered Stream</title>
      <link>https://vanhung4499.github.io/programming/java/IO/buffer.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/buffer.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Buffered Stream</source>
      <description>Buffered Stream Các buffered stream của Java là một loại bao bọc cho các byte stream và character stream, bằng cách mở một bộ đệm trong bộ nhớ để tăng hiệu suất của các thao tác...</description>
      <category>java</category>
      <pubDate>Sun, 30 Jun 2024 16:14:55 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Các buffered stream của Java là một loại bao bọc cho các byte stream và character stream, bằng cách mở một bộ đệm trong bộ nhớ để tăng hiệu suất của các thao tác I/O. Java sử dụng <code>BufferedInputStream</code> và <code>BufferedOutputStream</code> để thực hiện đệm byte stream, và <code>BufferedReader</code> và <code>BufferedWriter</code> để thực hiện đệm character stream.</p>
<p>Nguyên lý hoạt động của buffered stream là ghi dữ liệu vào bộ đệm trước, khi bộ đệm đầy thì ghi dữ liệu vào tệp hoặc output stream một lần, hoặc khi bộ đệm trống thì đọc một lượng dữ liệu nhất định từ tệp hoặc input stream một lần. Điều này giúp giảm số lần thao tác I/O của hệ thống, tăng hiệu suất I/O của hệ thống, từ đó tăng hiệu suất chạy của chương trình.</p>
<h3>01. Buffered byte stream</h3>
<p><code>BufferedInputStream</code> và <code>BufferedOutputStream</code> thuộc loại buffered stream byte, củng cố các byte stream <code>InputStream</code> và <code>OutputStream</code>. Về các byte stream, chúng ta đã thảo luận chi tiết trước đó, bạn có thể <a href="https://javabetter.cn/io/stream.html" target="_blank" rel="noopener noreferrer">nhấp vào liên kết này</a> để ôn lại.</p>
<h4>1. Phương thức khởi tạo</h4>
<ul>
<li><code>BufferedInputStream(InputStream in)</code> : Tạo một buffered stream đầu vào mới, chú ý rằng tham số là loại <strong>InputStream</strong>.</li>
<li><code>BufferedOutputStream(OutputStream out)</code> : Tạo một buffered stream đầu ra mới, chú ý rằng tham số là loại <strong>OutputStream</strong>.</li>
</ul>
<p>Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo buffered stream đầu vào byte, đầu tiên khai báo byte stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(fis)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo buffered stream đầu vào byte (một bước)</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo buffered stream đầu ra byte (một bước)</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h4>2. Hiệu quả của buffered stream</h4>
<p>Chúng ta sẽ kiểm tra hiệu quả của buffered stream bằng cách sao chép một tệp lớn hơn 370MB. Để so sánh, trước tiên chúng ta sẽ thực hiện bằng cách sử dụng stream cơ bản, mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi lại thời gian bắt đầu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> start </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"py.mp4"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tệp exe đủ lớn</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"copyPy.mp4"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đọc và ghi dữ liệu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi lại thời gian kết thúc</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Thời gian sao chép bằng stream cơ bản: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> start) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> " mili giây"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Xin lỗi, máy của tôi khá yếu, sau 10 phút vẫn đang sao chép. Hãy chuyển sang thử buffered stream, mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi lại thời gian bắt đầu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> start </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"py.mp4"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"copyPy.mp4"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đọc và ghi dữ liệu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> bis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi lại thời gian kết thúc</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Thời gian sao chép bằng buffered stream: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> start) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> " mili giây"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Chỉ cần 8016 mili giây. Làm thế nào để nhanh hơn nữa?</p>
<p>Chúng ta có thể sử dụng cách đọc và ghi bằng mảng, như đã thảo luận trước đó, mã như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi lại thời gian bắt đầu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> start </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"py.mp4"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"copyPy.mp4"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đọc và ghi dữ liệu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] bytes </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">8</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> *</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> bis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(bytes)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(bytes, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi lại thời gian kết thúc</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Thời gian sao chép bằng buffered stream sử dụng mảng: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> start) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> " mili giây"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Bây giờ thì nhanh hơn nhiều, chỉ cần 521 mili giây.</p>
<h4>3. Tại sao buffered stream lại nhanh như vậy?</h4>
<p>Java IO truyền thống là chế độ chặn, hoạt động của nó là "đọc/ghi, chờ, đọc/ghi, chờ...". buffered stream giải quyết vấn đề này bằng cách <strong>đọc và ghi nhiều hơn trong một lần, giảm tần suất đọc và ghi, sử dụng không gian để đổi lấy thời gian</strong>.</p>
<ul>
<li><strong>Giảm số lần gọi hệ thống</strong>: Khi sử dụng buffered stream, dữ liệu không được ghi trực tiếp vào đĩa hoặc output stream, mà trước tiên được ghi vào bộ đệm. Khi bộ đệm đầy, dữ liệu mới được ghi một lần vào đĩa hoặc output stream. Điều này giúp giảm số lần gọi hệ thống, do đó nâng cao hiệu quả hoạt động I/O.</li>
<li><strong>Giảm số lần đọc và ghi đĩa</strong>: Khi cần đọc dữ liệu, buffered stream sẽ đọc từ bộ đệm trước. Nếu bộ đệm không đủ dữ liệu, buffered stream sẽ đọc một lượng lớn dữ liệu từ đĩa hoặc input stream một lần. Tương tự, khi cần ghi dữ liệu, buffered stream sẽ ghi vào bộ đệm trước. Nếu bộ đệm đầy, dữ liệu trong bộ đệm sẽ được ghi vào đĩa hoặc output stream một lần. Điều này giúp giảm số lần đọc và ghi đĩa, do đó nâng cao hiệu quả hoạt động I/O.</li>
<li><strong>Nâng cao hiệu quả truyền dữ liệu</strong>: Khi sử dụng buffered stream, dữ liệu được truyền theo khối, giảm số lần truyền dữ liệu, do đó nâng cao hiệu quả truyền dữ liệu.</li>
</ul>
<p>Hãy xem phương thức <code>read</code> của <code>BufferedInputStream</code>:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> synchronized</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> read</span><span style="color:#E06C75;--shiki-dark:#E06C75">() throws IOException {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (pos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> count) {     </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu vị trí hiện tại đã đến cuối bộ đệm</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        fill</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">             // Điền đầy bộ đệm</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (pos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> count)   </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu sau khi điền đầy vẫn đến cuối bộ đệm, nghĩa là đã đọc xong</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            return</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">      // Trả về -1 để biểu thị đã đọc xong</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getBufIfOpen</span><span style="color:#E06C75;--shiki-dark:#E06C75">()[pos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">++</span><span style="color:#E06C75;--shiki-dark:#E06C75">] </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&amp;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0xff</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Trả về byte tại vị trí hiện tại và tăng vị trí lên 1</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Đoạn mã này có hai phần chính:</p>
<ul>
<li><code>fill()</code>: Phương thức này sẽ điền đầy bộ đệm <code>buf</code>.</li>
<li><code>getBufIfOpen()[pos++] &amp; 0xff</code>: Trả về byte tại vị trí đọc hiện tại <code>pos</code> (phương thức <code>getBufIfOpen()</code> trả về mảng <code>buffer</code>, là kiểu <code>byte</code>), và thực hiện phép toán <code>AND</code> với <code>0xff</code>. Mục đích là để xử lý byte <code>b</code> như một byte không dấu, vì kiểu <code>byte</code> trong Java có dấu. Phép toán <code>AND</code> với <code>0xff</code> sẽ chuyển đổi byte này thành byte không dấu, với phạm vi từ 0 đến 255.</li>
</ul>
<blockquote>
<p>Xử lý <code>byte &amp; 0xFF</code> sẽ được giải thích chi tiết sau.</p>
</blockquote>
<p>Tiếp theo, hãy xem phương thức <code>read</code> của <code>FileInputStream</code>:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630225343.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Trong đoạn mã này, phương thức <code>read0()</code> là một native-method, được thực hiện bởi hệ điều hành và không phải bằng Java. Trên các hệ điều hành khác nhau, phương thức <code>read0()</code> có thể được thực hiện khác nhau, nhưng chức năng của chúng là giống nhau, dùng để <strong>đọc một byte</strong>.</p>
<p>Tiếp theo, hãy xem phương thức <code>write(byte b[], int off, int len)</code> của <code>BufferedOutputStream</code>:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> synchronized</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> write</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b[]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len) throws IOException {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> buf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {    </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu số byte ghi lớn hơn hoặc bằng độ dài bộ đệm</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        /* Nếu độ dài yêu cầu vượt quá kích thước của bộ đệm đầu ra,</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">           trước tiên sẽ làm trống bộ đệm, sau đó trực tiếp ghi dữ liệu.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">           Điều này có thể tránh vấn đề xâu chuỗi bộ đệm. */</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        flushBuffer</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">          // Trước tiên làm trống bộ đệm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b, off, len);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Trực tiếp ghi dữ liệu vào output stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> buf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#E06C75;--shiki-dark:#E06C75"> count) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu số byte ghi lớn hơn không gian trống</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        flushBuffer</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">              // Trước tiên làm trống bộ đệm</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">arraycopy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b, off, buf, count, len);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Sao chép dữ liệu vào bộ đệm</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    count </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">                             // Cập nhật bộ đếm</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trước tiên, phương thức này sẽ kiểm tra nếu số byte ghi lớn hơn hoặc bằng độ dài bộ đệm. Nếu đúng, trước tiên nó sẽ làm trống bộ đệm, sau đó trực tiếp ghi dữ liệu vào output stream. Điều này nhằm tránh vấn đề xâu chuỗi bộ đệm, nghĩa là khi kích thước bộ đệm không đủ để chứa dữ liệu cần ghi, có thể gây ra làm trống bộ đệm liên tiếp, dẫn đến giảm hiệu suất.</p>
<blockquote>
<p>Vấn đề xâu chuỗi (Cascade Problem) là hiện tượng khi một tập hợp các buffered stream có kích thước bộ đệm không đủ để chứa dữ liệu cần ghi, dẫn đến dữ liệu bị phân chia thành nhiều phần và ghi vào các bộ đệm khác nhau, cuối cùng cần phải làm trống từng bộ đệm một, từ đó gây giảm hiệu suất.</p>
</blockquote>
<p>Tiếp theo, nếu số byte ghi nhỏ hơn độ dài bộ đệm, nó sẽ kiểm tra không gian còn lại của bộ đệm có đủ để chứa dữ liệu cần ghi hay không. Nếu không đủ, nó sẽ làm trống bộ đệm. Sau đó, nó sẽ sử dụng phương thức <code>System.arraycopy()</code> để sao chép dữ liệu vào bộ đệm và cập nhật bộ đếm <code>count</code>.</p>
<p>Cuối cùng, nếu số byte ghi nhỏ hơn độ dài bộ đệm và bộ đệm vẫn còn không gian trống, nó sẽ trực tiếp sao chép dữ liệu vào bộ đệm và cập nhật bộ đếm <code>count</code>.</p>
<p>Điều này có nghĩa là chỉ khi <code>buf</code> đầy, nó mới làm trống bộ đệm (flush) và ghi dữ liệu vào đĩa, mặc định mỗi lần ghi 8192 byte.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">OutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> out) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    this</span><span style="color:#E06C75;--shiki-dark:#E06C75">(out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 8192</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Nếu <code>buf</code> chưa đầy, nó sẽ tiếp tục ghi vào <code>buf</code>.</p>
<p>So sánh với phương thức <code>write</code> của <code>FileOutputStream</code>, cũng là phương thức gốc và mỗi lần chỉ có thể ghi một byte.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630225438.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Khi sử dụng <code>BufferedOutputStream</code> và <code>BufferedInputStream</code> cùng nhau, số lần đọc và ghi sẽ giảm đáng kể, đặc biệt khi sử dụng <code>byte[] bytes = new byte[8*1024]</code>, tương đương với việc bộ đệm có dung lượng 8 x 1024 byte, thì hiệu quả đọc và ghi sẽ tăng lên rất nhiều.</p>
<h4>4. <code>byte &amp; 0xFF</code></h4>
<p>Kiểu byte thường được sử dụng để lưu trữ dữ liệu nhị phân, ví dụ như đọc và ghi vào tệp, truyền dữ liệu qua mạng, v.v. Trong những tình huống này, biến kiểu byte có thể được sử dụng để lưu trữ từng byte trong stream dữ liệu để thực hiện các thao tác đọc và ghi.</p>
<p>Kiểu byte là có dấu, có nghĩa là giá trị của nó nằm trong phạm vi từ -128 đến 127. Nếu chúng ta muốn có được một giá trị byte không dấu, chúng ta cần sử dụng <code>byte &amp; 0xFF</code> để chuyển đổi.</p>
<p>Điều này là bởi vì 0xFF là một số nguyên không dấu, biểu diễn nhị phân của nó là 11111111. Khi một giá trị kiểu byte được thực hiện phép AND với 0xFF, nó sẽ chuyển đổi giá trị kiểu byte đó thành một số nguyên không dấu, nằm trong phạm vi từ 0 đến 255.</p>
<p>0xFF là một số thập lục phân, tương đương với nhị phân 11111111. Toán tử &amp; có ý nghĩa là: nếu hai bit tương ứng là 1, thì bit kết quả là 1, ngược lại là 0; vì vậy khi thực hiện phép AND với 0xFF, byte sẽ được giữ nguyên và chuyển đổi thành một số nguyên trong khoảng từ 0 đến 255.</p>
<p>Ví dụ, nếu chúng ta có một biến kiểu byte là b, với giá trị là -1, thì kết quả của b &amp; 0xFF là 255. Điều này cho phép chuyển đổi một giá trị kiểu byte có dấu thành một số nguyên không dấu.</p>
<p>Phép toán AND là một phương pháp tính toán dữ liệu nhị phân, trong đó nếu cả hai bit tương ứng đều là 1 thì kết quả là 1, ngược lại là 0. Trong quá trình tính toán <code>getBufIfOpen()[pos++] &amp; 0xff</code>, byte có 8 bit, 0xFF là 255 trong hệ thập lục phân, biểu diễn là số nguyên, có 32 bit.</p>
<p>Nếu <code>getBufIfOpen()[pos++]</code> là -118, thì biểu diễn gốc của nó là</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>00000000 00000000 00000000 10001010</span></span></code></pre>
</div><p>Biểu diễn đảo của nó là</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>11111111 11111111 11111111 11110101</span></span></code></pre>
</div><p>Biểu diễn bù của nó là</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>11111111 11111111 11111111 11110110</span></span></code></pre>
</div><p>0XFF là 255 biểu diễn trong hệ thập lục phân là 255, biểu diễn gốc, đảo, bù là như nhau, dữ liệu hai, byte 255 chính byte cùng.</p>
<p>① Dạng gốc</p>
<p>Dạng gốc là việc thêm dấu chữ số vào giá trị tuyệt đối, tức là sử dụng dấu đầu tiên để biểu thị dấu, các bit còn lại biểu thị giá trị. Ví dụ nếu là số nhị phân 8 bit:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[+1] gốc = 0000 0001</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[-1] gốc = 1000 0001</span></span></code></pre>
</div><p>Dấu đầu tiên là dấu chữ số. Vì dấu đầu tiên là dấu chữ số, nên phạm vi giá trị của số nhị phân 8 bit là:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[1111 1111 , 0111 1111]</span></span></code></pre>
</div><p>tức là</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[-127 , 127]</span></span></code></pre>
</div><p>② Dạng đảo</p>
<p>Phương pháp biểu thị của dạng đảo là:</p>
<ul>
<li>Dạng đảo của số dương là chính nó</li>
<li>Dạng đảo của số âm là dựa trên dạng gốc của nó, giữ nguyên dấu chữ số, các bit còn lại đảo ngược.</li>
</ul>
<p>Ví dụ:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[+1] = [00000001] gốc = [00000001] đảo</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[-1] = [10000001] gốc = [11111110] đảo</span></span></code></pre>
</div><p>Có thể thấy nếu một dạng đảo biểu thị là số âm, thì não không thể trực quan nhận ra giá trị của nó. Thông thường cần chuyển đổi sang dạng gốc trước khi tính toán.</p>
<p>③ Dạng bù</p>
<p>Phương pháp biểu thị của dạng bù là:</p>
<ul>
<li>Dạng bù của số dương là chính nó</li>
<li>Dạng bù của số âm là dựa trên dạng gốc của nó, giữ nguyên dấu chữ số, các bit còn lại đảo ngược, sau đó +1. (tức là cộng thêm một)</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[+1] = [00000001] gốc = [00000001] đảo = [00000001] bù</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[-1] = [10000001] gốc = [11111110] đảo = [11111111] bù</span></span></code></pre>
</div><p>Đối với số âm, phương pháp biểu thị bù cũng là một cách mà não không thể trực quan nhận ra giá trị của nó. Thông thường cũng cần chuyển đổi sang dạng gốc trước khi tính toán.</p>
<p>Từ những điều trên có thể thấy:</p>
<ul>
<li>Đối với số dương: dạng gốc, đảo, bù đều giống nhau</li>
<li>Đối với số âm: dạng gốc, đảo, bù đều khác nhau</li>
</ul>
<h3>02. Buffered character stream</h3>
<p>Lớp BufferedReader kế thừa từ lớp Reader và cung cấp một số phương thức tiện ích, ví dụ như phương thức <code>readLine()</code> có thể đọc một dòng dữ liệu một lần, thay vì đọc từng ký tự một.</p>
<p>Lớp BufferedWriter kế thừa từ lớp Writer và cung cấp một số phương thức tiện ích, ví dụ như phương thức <code>newLine()</code> có thể ghi một dấu phân tách dòng cụ thể cho hệ thống.</p>
<h4>1. Phương thức khởi tạo</h4>
<ul>
<li><code>BufferedReader(Reader in)</code> ：Tạo một buffered input stream mới, lưu ý loại tham số là <strong>Reader</strong>.</li>
<li><code>BufferedWriter(Writer out)</code>： Tạo một buffered output stream mới, lưu ý loại tham số là <strong>Writer</strong>.</li>
</ul>
<p>Mã ví dụ như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo input stream ký tự đệm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> br </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo output stream ký tự đệm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h4>2. Phương thức đặc thù của buffered character stream</h4>
<p>Các phương thức cơ bản của buffered character stream và cách gọi tương tự như <a href="character">character stream</a>, ở đây không nhắc lại. Chúng ta sẽ xem xét các phương thức <strong>đặc thù</strong> của buffered character stream.</p>
<ul>
<li>BufferedReader：<code>String readLine()</code>: <strong>Đọc một dòng dữ liệu</strong>, đọc đến cuối cùng sẽ trả về null.</li>
<li>BufferedWriter：<code>newLine()</code>: <strong>Xuống dòng</strong>, hệ thống xác định ký tự xuống dòng.</li>
</ul>
<p>Ví dụ về phương thức <code>readLine()</code>:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> br </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Định nghĩa chuỗi để lưu trữ dòng văn bản đã đọc</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> line  </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc lặp, đọc đến cuối cùng sẽ trả về null</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((line </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(line);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630225343.png" type="image/png"/>
    </item>
    <item>
      <title>Character Stream</title>
      <link>https://vanhung4499.github.io/programming/java/IO/character.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/character.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Character Stream</source>
      <description>Character Stream 7.4 Character Stream Câu chuyện về Character Stream Reader và Writer bắt đầu từ biểu đồ quan hệ lớp của chúng, hãy cùng xem biểu đồ. image.pngimage.png Characte...</description>
      <category>java</category>
      <pubDate>Sun, 30 Jun 2024 16:14:55 GMT</pubDate>
      <content:encoded><![CDATA[
<h1>7.4 Character Stream</h1>
<p>Câu chuyện về Character Stream Reader và Writer bắt đầu từ biểu đồ quan hệ lớp của chúng, hãy cùng xem biểu đồ.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630220036.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Character Stream là một loại IO Stream dùng để đọc và ghi dữ liệu ký tự. Khác với Byte Stream, Character Stream đọc và ghi dữ liệu theo đơn vị ký tự chứ không phải theo đơn vị byte. Thường được sử dụng để xử lý thông tin văn bản.</p>
<p>Nếu sử dụng Byte Stream để đọc trực tiếp tiếng Việt, có thể gặp phải vấn đề hiển thị ký tự bị lỗi, xem ví dụ dưới đây:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// FileInputStream là character input stream hoạt động trên file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> inputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// // Nội dung là "Xin chào các bạn"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> inputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) len);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Xem kết quả chạy:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Xin chÃ&nbsp;o cÃ¡c báº¡n</span></span></code></pre>
</div><p>Lý do xuất hiện lỗi hiển thị là vì trong Byte Stream, một ký tự thường được tạo thành từ nhiều byte và các mã ký tự khác nhau sử dụng số byte khác nhau. Nếu chúng ta sử dụng mã ký tự không đúng hoặc không xử lý chính xác việc chuyển đổi mã ký tự khi đọc và ghi dữ liệu, sẽ dẫn đến ký tự tiếng Việt bị lỗi hiển thị.</p>
<p>Ví dụ, khi sử dụng mã ký tự mặc định (xem ví dụ trên) để đọc một file văn bản chứa ký tự tiếng Việt, sẽ xuất hiện lỗi hiển thị. Bởi vì mã ký tự mặc định thường là mã ASCII, chỉ có thể biểu diễn ký tự tiếng Anh và không thể giải mã đúng ký tự tiếng Việt.</p>
<p>Vậy làm thế nào để sử dụng Byte Stream để đọc đúng tiếng Việt? Xem ví dụ dưới đây.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> inputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] bytes </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> inputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(bytes)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(bytes, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Tại sao cách này lại hiệu quả?</p>
<p>Bởi vì chúng ta sử dụng lớp String để giải mã. Khi kiểm tra mã nguồn của <code>new String(byte bytes[], int offset, int length)</code>, chúng ta có thể thấy phương thức này có chức năng giải mã:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bytes[]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> offset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> length) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    checkBounds</span><span style="color:#E06C75;--shiki-dark:#E06C75">(bytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> offset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> length)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> StringCoding</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">decode</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(bytes, offset, length);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Khi tiếp tục theo dõi phương thức <code>StringCoding.decode()</code>, sẽ thấy nó gọi đến phương thức <code>defaultCharset()</code>, và sẽ thấy mã mặc định là <code>UTF-8</code>, như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Charset</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> defaultCharset</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (defaultCharset </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        synchronized</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Charset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (cs </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">                defaultCharset </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> cs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            else</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">                defaultCharset </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> forName</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"UTF-8"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#E06C75;--shiki-dark:#E06C75"> defaultCharset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">decode</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] ba</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> csn </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Charset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">defaultCharset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // use charset name decode() variant which provides caching.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> decode</span><span style="color:#E06C75;--shiki-dark:#E06C75">(csn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ba</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UnsupportedEncodingException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> x</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        warnUnsupportedCharset</span><span style="color:#E06C75;--shiki-dark:#E06C75">(csn)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong Java, các mã ký tự thông dụng bao gồm ASCII, ISO-8859-1, UTF-8, UTF-16, v.v. Trong đó, ASCII và ISO-8859-1 chỉ có thể biểu diễn một phần ký tự, trong khi UTF-8 và UTF-16 có thể biểu diễn tất cả các ký tự Unicode, bao gồm ký tự tiếng Việt.</p>
<p>Khi chúng ta sử dụng <code>new String(byte bytes[], int offset, int length)</code> để chuyển đổi Byte Stream thành chuỗi ký tự, Java sẽ dựa vào quy tắc UTF-8 để giải mã mỗi 3 byte thành một ký tự tiếng Việt, từ đó giải mã chính xác ký tự tiếng Việt.</p>
<p>Mặc dù Byte Stream cũng có thể giải quyết vấn đề lỗi hiển thị ký tự, nhưng không trực tiếp. Do đó, chúng ta có Character Stream, <code>chuyên dùng để xử lý file văn bản</code> (âm thanh, hình ảnh, video, v.v. là các file không phải văn bản).</p>
<p>Từ góc độ khác: <strong>Character Stream = Byte Stream + Bảng mã hóa</strong>.</p>
<h3>01. Character Input Stream (Reader)</h3>
<p><code>java.io.Reader</code> là <strong>lớp cha</strong> của <strong>character input stream</strong>, nó định nghĩa một số phương thức chung của character input stream:</p>
<ul>
<li><code>close()</code>：Đóng stream này và giải phóng các tài nguyên hệ thống liên quan.</li>
<li><code>read()</code>：Đọc một ký tự từ input stream.</li>
<li><code>read(char[] cbuf)</code>：Đọc một số ký tự từ input stream và lưu chúng vào mảng ký tự <code>cbuf</code>.</li>
</ul>
<p>FileReader là lớp con của Reader, được sử dụng để đọc dữ liệu ký tự từ tệp. Các đặc điểm chính của nó như sau:</p>
<ul>
<li>Có thể chỉ định đường dẫn tệp cần đọc thông qua hàm tạo.</li>
<li>Mỗi lần có thể đọc một hoặc nhiều ký tự.</li>
<li>Có thể đọc các ký tự trong tập ký tự Unicode và thực hiện chuyển đổi tập ký tự thông qua mã hóa ký tự được chỉ định.</li>
</ul>
<h4>1. Hàm tạo của FileReader</h4>
<ul>
<li><code>FileReader(File file)</code>：Tạo một FileReader mới, tham số là <strong>đối tượng File</strong>.</li>
<li><code>FileReader(String fileName)</code>：Tạo một FileReader mới, tham số là tên tệp.</li>
</ul>
<p>Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream bằng cách sử dụng đối tượng File</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream bằng cách sử dụng tên tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h4>2. Đọc dữ liệu ký tự với FileReader</h4>
<p>① <strong>Đọc ký tự</strong>：Phương thức <code>read</code>, mỗi lần có thể đọc một ký tự, trả về ký tự đã đọc (được chuyển thành kiểu int), khi đọc đến cuối tệp sẽ trả về <code>-1</code>. Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream bằng cách sử dụng tên tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abc.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Định nghĩa biến để lưu dữ liệu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc tuần tự</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) b);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>② <strong>Đọc ký tự với độ dài chỉ định</strong>：Phương thức <code>read(char[] cbuf, int off, int len)</code> đọc một số ký tự từ input stream và lưu chúng vào mảng ký tự. Trong đó, cbuf biểu thị mảng ký tự để lưu kết quả đọc, off biểu thị vị trí bắt đầu lưu kết quả, len biểu thị số ký tự cần đọc. Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> textFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"docs/约定.md"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Một ví dụ về FileReader</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// try-with-resources FileReader</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> reader </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(textFile)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // read(char[] cbuf)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> reader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">buffer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Trong ví dụ này, FileReader được sử dụng để đọc dữ liệu ký tự từ tệp và lưu chúng vào một mảng ký tự có kích thước 1024. Mỗi lần đọc len ký tự, sau đó sử dụng phương thức tạo của String để chuyển đổi chúng thành chuỗi và xuất ra.</p>
<p>FileReader đã triển khai interface AutoCloseable, do đó có thể sử dụng câu lệnh try-with-resources để tự động đóng tài nguyên, tránh các thao tác đóng tài nguyên thủ công phức tạp.</p>
<h3>02. Character Output Stream (Writer)</h3>
<p><code>java.io.Writer</code> là <strong>lớp cha</strong> của <strong>character output stream</strong>, nó cho phép ghi thông tin ký tự đã chỉ định vào đích, hãy xem một số phương thức chung mà nó định nghĩa:</p>
<ul>
<li><code>write(int c)</code>：Ghi một ký tự.</li>
<li><code>write(char[] cbuf)</code>：Ghi một mảng ký tự.</li>
<li><code>write(char[] cbuf, int off, int len)</code>：Ghi một phần của mảng ký tự, off là chỉ số bắt đầu, len là số lượng ký tự.</li>
<li><code>write(String str)</code>：Ghi một chuỗi.</li>
<li><code>write(String str, int off, int len)</code>：Ghi một phần của chuỗi, off chỉ vị trí bắt đầu của chuỗi con trong str, len chỉ độ dài của chuỗi con cần ghi.</li>
<li><code>flush()</code>：Làm mới bộ đệm của stream.</li>
<li><code>close()</code>：Đóng stream này, nhưng phải làm mới nó trước.</li>
</ul>
<p>Lớp <code>java.io.FileWriter</code> là lớp con của Writer, được sử dụng để ghi các ký tự vào tệp.</p>
<h4>1. Hàm tạo của FileWriter</h4>
<ul>
<li><code>FileWriter(File file)</code>：Tạo một FileWriter mới, tham số là đối tượng File cần ghi.</li>
<li><code>FileWriter(String fileName)</code>：Tạo một FileWriter mới, tham số là tên của tệp cần ghi.</li>
</ul>
<p>Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Cách thứ nhất: Tạo đối tượng stream bằng cách sử dụng đối tượng File</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Cách thứ hai: Tạo đối tượng stream bằng cách sử dụng tên tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h4>2. Ghi dữ liệu bằng FileWriter</h4>
<p>① <strong>Ghi ký tự</strong>: Phương thức <code>write(int b)</code> cho phép ghi ra một ký tự mỗi lần. Ví dụ mã như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">72</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi mã ASCII của ký tự 'H'</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">101</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi mã ASCII của ký tự 'e'</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">108</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi mã ASCII của ký tự 'l'</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">108</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi mã ASCII của ký tự 'l'</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">111</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi mã ASCII của ký tự 'o'</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ví dụ mã này, trước tiên tạo một đối tượng FileWriter <code>fw</code> và chỉ định đường dẫn tệp "output.txt" để ghi vào. Sau đó, sử dụng phương thức <code>fw.write()</code> để ghi các byte vào tệp, ở đây lần lượt ghi mã ASCII của các ký tự 'H', 'e', 'l', 'l', 'o'. Cuối cùng, trong khối <code>finally</code>, đóng đối tượng FileWriter để giải phóng tài nguyên.</p>
<p>Lưu ý rằng khi sử dụng phương thức <code>write(int b)</code>, chúng ta đang ghi một byte, không phải một ký tự. Nếu cần ghi ký tự, có thể sử dụng các phương thức <code>write(char cbuf[])</code> hoặc <code>write(String str)</code>.</p>
<p>② <strong>Ghi mảng ký tự</strong>: Phương thức <code>write(char[] cbuf)</code> cho phép ghi mảng ký tự chỉ định vào output stream. Ví dụ mã như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] chars </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span><span style="color:#98C379;--shiki-dark:#98C379">'H'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'e'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'l'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'l'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'o'</span><span style="color:#E06C75;--shiki-dark:#E06C75">}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(chars);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi mảng ký tự vào tệp</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>③ <strong>Ghi một phần mảng ký tự</strong>: Phương thức <code>write(char[] cbuf, int off, int len)</code> cho phép ghi một phần mảng ký tự chỉ định vào output stream. Ví dụ mã như sau (phần lặp lại không viết lại, tham khảo phần trên):</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] chars </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span><span style="color:#98C379;--shiki-dark:#98C379">'H'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'e'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'l'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'l'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'o'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> ','</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> ' '</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'W'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'o'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'r'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'l'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'd'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> '!'</span><span style="color:#E06C75;--shiki-dark:#E06C75">}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(chars, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi 5 ký tự đầu tiên của mảng ký tự vào tệp</span></span></code></pre>
</div><p>Sử dụng phương thức <code>fw.write()</code> để ghi 5 ký tự đầu tiên của mảng ký tự vào tệp.</p>
<p>④ <strong>Ghi chuỗi</strong>: Phương thức <code>write(String str)</code> cho phép ghi chuỗi chỉ định vào output stream. Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Hello, World!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi chuỗi vào tệp</span></span></code></pre>
</div><p>⑤ <strong>Ghi một phần chuỗi</strong>: Phương thức <code>write(String str, int off, int len)</code> cho phép ghi một phần chuỗi chỉ định vào output stream. Ví dụ mã như sau (dạng try-with-resources):</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Hello, World!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi 5 ký tự đầu tiên của chuỗi vào tệp</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><blockquote>
<p>【Lưu ý】Nếu không đóng tài nguyên, dữ liệu chỉ được lưu vào bộ đệm và chưa được lưu vào tệp.</p>
</blockquote>
<h4>3. Đóng và làm mới (close và flush)</h4>
<p>Vì FileWriter có bộ đệm bên trong (ByteBuffer), nếu không đóng output stream, sẽ không thể ghi ký tự vào tệp.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630221049.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Tuy nhiên, nếu đóng stream, sẽ không thể tiếp tục ghi dữ liệu. Nếu muốn ghi dữ liệu mà vẫn có thể tiếp tục sử dụng stream, ta cần phương thức <code>flush</code>.</p>
<ul>
<li><code>flush</code>: Làm mới bộ đệm, cho phép tiếp tục sử dụng stream.</li>
<li><code>close</code>: Làm mới bộ đệm trước, sau đó thông báo hệ thống giải phóng tài nguyên. Sau khi gọi, không thể sử dụng lại stream.</li>
</ul>
<p>Phương thức <code>flush</code> khá thú vị, hãy xem đoạn mã sau để hiểu thêm:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nguồn, là stream nhập (stream đọc) đọc từ tệp a.txt</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abc.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Tệp a.txt phải tồn tại, nếu không sẽ ném ra ngoại lệ FileNotFoundException</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đích, là output stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Hệ thống sẽ tự động tạo tệp b.txt vì đây là output stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(len);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chú ý ở đây không đóng stream bằng phương thức close, trong phát triển không nên làm như vậy, nhưng để hiểu rõ hơn về tác dụng của flush</span></span></code></pre>
</div><p>Kết quả chạy chương trình sẽ như thế nào? Đáp án là tệp b.txt vẫn trống, không có gì.</p>
<p>Nguyên nhân đã được đề cập trước đó. <strong>Lập trình là như vậy, không thực hành thì sẽ không bao giờ học được</strong>! Vì vậy, hãy thực hành nhiều hơn.</p>
<p>Thêm ba dòng mã sau vào đoạn mã trên, tệp <code>b.txt</code> sẽ được sao chép dữ liệu từ tệp nguồn:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Phương thức <code>flush()</code> có nghĩa là làm sạch bộ đệm, được sử dụng để làm sạch stream dữ liệu trong bộ đệm. Khi thực hiện các thao tác stream, dữ liệu được đọc vào bộ nhớ trước, sau đó mới ghi vào tệp.</p>
<p>Bạn có thể thử với ví dụ mã sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng tên tệp để tạo đối tượng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fw.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu, sau đó flush</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'a'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi ký tự đầu tiên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'b'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tiếp tục ghi ký tự thứ hai, ghi thành công</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu, sau đó close</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'c'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi ký tự đầu tiên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'d'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tiếp tục ghi ký tự thứ hai, lỗi java.io.IOException: Stream closed</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Lưu ý, dù phương thức <code>flush</code> đã ghi dữ liệu ra, cuối cùng vẫn cần gọi phương thức <code>close</code> để giải phóng tài nguyên hệ thống. Tất nhiên, bạn cũng có thể sử dụng cách try-with-resources.</p>
<h4>4. FileWriter viết tiếp và xuống dòng</h4>
<p><strong>Viết tiếp và xuống dòng</strong>: Thao tác tương tự như <a href="stream">FileOutputStream</a>, hãy xem đoạn mã dưới đây:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng tên tệp để tạo đối tượng stream, có thể viết tiếp dữ liệu</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fw.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">     </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi chuỗi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"xin chào"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi xuống dòng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\r\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi chuỗi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"các bạn"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Kết quả đầu ra như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>xin chào</span></span>
<span class="line"><span>các bạn</span></span></code></pre>
</div><h4>5. Sao chép tệp văn bản</h4>
<p>Đoạn mã dưới đây thực hiện việc sao chép tệp văn bản:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.io.FileReader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.io.FileWriter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.io.IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CopyFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Tạo đối tượng stream đầu vào</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fr</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"aa.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu tệp không tồn tại sẽ ném ra ngoại lệ java.io.FileNotFoundException</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Tạo đối tượng stream đầu ra</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"copyaa.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        /* Các công việc của stream đầu ra:</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">         * 1. Gọi tài nguyên hệ thống để tạo một tệp</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">         * 2. Tạo đối tượng stream đầu ra</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">         * 3. Chỉ định đối tượng stream đầu ra đến tệp        </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">         */</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Sao chép tệp văn bản, mỗi lần đọc một ký tự</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        copyMethod1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(fr, fw);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Sao chép tệp văn bản, mỗi lần đọc một mảng ký tự</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        copyMethod2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(fr, fw);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> copyMethod1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ((ch </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc dữ liệu</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(ch); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> copyMethod2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75">chs</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">];</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(chs)) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc dữ liệu</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(chs, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630220036.png" type="image/png"/>
    </item>
    <item>
      <title>Java IO Classification</title>
      <link>https://vanhung4499.github.io/programming/java/IO/classification.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/classification.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Java IO Classification</source>
      <description>Phân loại IO Nhìn này, tôi chỉ phân loại IO theo cách truyền dẫn đơn giản mà đã ra đủ thứ đây! image.pngimage.png Học IO trong Java lúc đầu cũng thấy đầu đau, đầy là các lớp, có...</description>
      <category>java</category>
      <pubDate>Sun, 30 Jun 2024 16:14:55 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Nhìn này, tôi chỉ phân loại IO theo cách truyền dẫn đơn giản mà đã ra đủ thứ đây!</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630135523.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Học IO trong Java lúc đầu cũng thấy đầu đau, đầy là các lớp, có lẽ là nhiều lớp nhất trong tất cả các gói Java, một lúc là Input, một lúc là Output, một lúc là Reader, một lúc là Writer, thực sự không biết các nhà thiết kế Java nghĩ gì.</p>
<p>Chủ yếu là do các nhà thiết kế Java đã xem xét rất nhiều, vì vậy IO mang đến cho người ta cảm giác lộn xộn, tôi sẽ sắp xếp lại cho bạn.</p>
<h3>00. Giới thiệu sơ lược về Java IO</h3>
<p>IO, tức là Input (nhập) và Output (xuất), đề cập đến việc truyền dữ liệu giữa ứng dụng và các thiết bị ngoại vi, các thiết bị ngoại vi phổ biến bao gồm tệp, đường ống và kết nối mạng.</p>
<p>Trong Java, IO được xử lý thông qua stream. Vậy stream là gì?</p>
<p>Stream là một khái niệm trừu tượng, là một chuỗi dữ liệu (kí tự hoặc byte) được truyền thông tin theo cách vào trước ra trước (FIFO - First In First Out).</p>
<p>Khi chương trình cần đọc dữ liệu, nó sẽ mở một stream đến nguồn dữ liệu. Nguồn dữ liệu này có thể là tệp, bộ nhớ hoặc kết nối mạng. Tương tự, khi chương trình cần ghi dữ liệu, nó sẽ mở một stream đến đích. Bạn có thể tưởng tượng dữ liệu giống như "dòng chảy" trong stream đó.</p>
<p>Thông thường, các đặc điểm của stream bao gồm:</p>
<ul>
<li><strong>Vào trước ra trước (FIFO)</strong>: Dữ liệu được ghi vào stream đầu tiên sẽ được đọc ra từ stream đầu tiên.</li>
<li><strong>Truy cập tuần tự</strong>: Có thể ghi một chuỗi byte vào stream, khi đọc ra cũng sẽ đọc theo thứ tự đã ghi, không thể truy cập ngẫu nhiên vào dữ liệu ở giữa. (Ngoại trừ RandomAccessFile)</li>
<li><strong>Chỉ đọc hoặc chỉ ghi</strong>: Mỗi stream chỉ có thể là stream đầu vào hoặc đầu ra, không thể có cả hai chức năng cùng một lúc. stream đầu vào chỉ có thể thực hiện thao tác đọc, còn stream đầu ra chỉ có thể thực hiện thao tác ghi. Trong một kênh truyền dữ liệu, nếu cần cả ghi và đọc dữ liệu, thì cần phải cung cấp hai stream riêng biệt.</li>
</ul>
<h3>01. Phân loại theo phương thức truyền tải</h3>
<p>Hãy bắt đầu từ sơ đồ ở đầu bài.</p>
<p>Có hai phương thức truyền tải: byte và ký tự. Đầu tiên, cần hiểu rõ sự khác biệt giữa byte và ký tự, đúng không?</p>
<p>Byte là đơn vị đo lường dung lượng lưu trữ trong máy tính, thường thì một byte có 8 bit.</p>
<p>Ký tự có thể là chữ cái, số hoặc ký hiệu mà máy tính sử dụng, ví dụ như A, 1, $.</p>
<p>Thông thường, một chữ cái hoặc một ký tự chiếm một byte, một ký tự Việt chiếm hai byte.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630165013.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Cụ thể, còn phụ thuộc vào mã hóa ký tự, ví dụ như trong mã hóa UTF-8, một chữ cái tiếng Anh (không phân biệt chữ hoa và chữ thường) chiếm một byte, một ký tự Việt chiếm hai byte. Trong mã hóa Unicode, một chữ cái tiếng Anh chiếm một byte, một ký tự Trung Quốc chiếm hai byte.</p>
<p>Hiểu sự khác biệt giữa byte và ký tự, sau đó xem xét Byte Stream và character stream sẽ dễ dàng hơn nhiều.</p>
<p>Byte Stream dùng để xử lý các tệp nhị phân, chẳng hạn như hình ảnh, MP3, video.</p>
<p>character stream dùng để xử lý các tệp văn bản. Tệp văn bản có thể được coi là một loại tệp nhị phân đặc biệt, nhưng đã được mã hóa để dễ đọc hơn.</p>
<p>Nói cách khác, Byte Stream có thể xử lý mọi tệp, trong khi character stream chỉ có thể xử lý văn bản.</p>
<p>Mặc dù có rất nhiều lớp IO, nhưng cốt lõi là 4 lớp trừu tượng: <code>InputStream</code>, <code>OutputStream</code>, <code>Reader</code>, <code>Writer</code>.</p>
<p><strong>(Một điểm tuyệt vời của trừu tượng hóa)</strong></p>
<p>Mặc dù có rất nhiều phương thức IO, nhưng cốt lõi chỉ có 2: <code>read</code> và <code>write</code>.</p>
<p><strong>Lớp <code>InputStream</code></strong></p>
<ul>
<li><code>int read()</code>: Đọc dữ liệu</li>
<li><code>int read(byte b[], int off, int len)</code>: Đọc từ vị trí <code>off</code>, đọc <code>len</code> byte và đặt vào mảng <code>b</code></li>
<li><code>long skip(long n)</code>: Bỏ qua số byte chỉ định</li>
<li><code>int available()</code>: Trả về số byte có thể đọc</li>
<li><code>void close()</code>: Đóng stream, giải phóng tài nguyên</li>
</ul>
<p><strong>Lớp <code>OutputStream</code></strong></p>
<ul>
<li><code>void write(int b)</code>: Ghi một byte, mặc dù tham số là loại <code>int</code>, chỉ có 8 bit thấp sẽ được ghi, 24 bit cao sẽ bị bỏ qua (điều này sẽ được giải thích sau)</li>
<li><code>void write(byte b[], int off, int len)</code>: Ghi các byte từ mảng <code>b</code> từ vị trí <code>off</code>, dài <code>len</code></li>
<li><code>void flush()</code>: Bắt buộc làm trống, ghi dữ liệu từ bộ đệm ra</li>
<li><code>void close()</code>: Đóng stream</li>
</ul>
<p><strong>Lớp <code>Reader</code></strong></p>
<ul>
<li><code>int read()</code>: Đọc một ký tự</li>
<li><code>int read(char cbuf[], int off, int len)</code>: Đọc từ vị trí <code>off</code>, đọc <code>len</code> ký tự và đặt vào mảng <code>b</code></li>
<li><code>long skip(long n)</code>: Bỏ qua số ký tự chỉ định</li>
<li><code>int ready()</code>: Kiểm tra xem có thể đọc không</li>
<li><code>void close()</code>: Đóng stream</li>
</ul>
<p><strong>Lớp <code>Writer</code></strong></p>
<ul>
<li><code>void write(int c)</code>: Ghi một ký tự</li>
<li><code>void write(char cbuf[], int off, int len)</code>: Ghi các ký tự từ mảng <code>cbuf</code> từ vị trí <code>off</code>, dài <code>len</code></li>
<li><code>void flush()</code>: Bắt buộc làm trống, ghi dữ liệu từ bộ đệm ra</li>
<li><code>void close()</code>: Đóng stream</li>
</ul>
<p>Hiểu các phương thức trên, bạn đã nắm được linh hồn của IO.</p>
<p>Sự khác biệt giữa Byte Stream và character stream:</p>
<ul>
<li>Byte Stream thường dùng để xử lý các tệp hình ảnh, video, âm thanh, PPT, Word. character stream thường dùng để xử lý các tệp văn bản thuần túy, như tệp TXT, nhưng không thể xử lý các tệp hình ảnh, video. Nói một câu đơn giản: Byte Stream có thể xử lý mọi tệp, còn character stream chỉ có thể xử lý văn bản thuần túy.</li>
<li>Byte Stream bản thân không có bộ đệm, Buffered Byte Stream có bộ đệm cải thiện hiệu suất rất nhiều. Trong khi đó, character stream bản thân đã có bộ đệm, nên Bufferd character stream cải thiện hiệu suất không đáng kể.</li>
</ul>
<p>Ví dụ viết tệp, chúng ta sẽ xem xét mã nguồn của character stream, phát hiện thấy có sử dụng bộ đệm:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khai báo một mảng kiểu char, để ghi vào stream xuất</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] writeBuffer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Định nghĩa kích thước của mảng writeBuffer, phải &gt;= 1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> WRITE_BUFFER_SIZE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1024</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một phần của chuỗi đã cho vào stream xuất</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> write</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len) throws IOException {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Sử dụng từ khóa synchronized để đồng bộ hóa đoạn mã, đảm bảo an toàn stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    synchronized</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (lock) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        char</span><span style="color:#E06C75;--shiki-dark:#E06C75"> cbuf[]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Nếu len &lt;= WRITE_BUFFER_SIZE, thì sử dụng mảng writeBuffer để ghi</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> WRITE_BUFFER_SIZE) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Nếu writeBuffer là null, thì tạo một mảng char mới có kích thước WRITE_BUFFER_SIZE</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (writeBuffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">                writeBuffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[WRITE_BUFFER_SIZE]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">            }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">            cbuf </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> writeBuffer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {    </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu len &gt; WRITE_BUFFER_SIZE, thì không phân bổ bộ đệm lớn vĩnh viễn</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Tạo một mảng char mới có kích thước len</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">            cbuf </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[len]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Sao chép một phần của str (từ off, dài len) vào mảng cbuf</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        str</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getChars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(off, (off </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> len), cbuf, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Ghi dữ liệu từ mảng cbuf vào stream xuất</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        write</span><span style="color:#E06C75;--shiki-dark:#E06C75">(cbuf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đoạn mã này là phương thức <code>write</code> của lớp <code>OutputStreamWriter</code> trong thư viện IO của Java, có thể thấy kích thước của bộ đệm là 1024 ký tự.</p>
<p>Chúng ta hãy so sánh mã của character stream và Byte Stream khi viết tệp, sự khác biệt rất nhỏ.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Byte Stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"input.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// character stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"input.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>02. Phân loại theo đối tượng thao tác</h3>
<p>Hãy suy nghĩ kỹ, IO không phải là viết tắt của Input (Nhập) và Output (Xuất) sao:</p>
<ul>
<li>Input: Đọc dữ liệu từ bên ngoài vào bộ nhớ, ví dụ như đọc tệp từ ổ cứng vào bộ nhớ, đọc dữ liệu từ mạng vào bộ nhớ, v.v.</li>
<li>Output: Ghi dữ liệu từ bộ nhớ ra bên ngoài, ví dụ như ghi dữ liệu từ bộ nhớ vào tệp, xuất dữ liệu từ bộ nhớ ra mạng, v.v.</li>
</ul>
<p>Tất cả các chương trình, khi thực thi, đều hoạt động trên bộ nhớ. Một khi tắt máy, dữ liệu trong bộ nhớ sẽ mất đi. Nếu muốn lưu trữ lâu dài, cần phải xuất dữ liệu từ bộ nhớ ra bên ngoài, ví dụ như tệp.</p>
<p>Thao tác tệp là thao tác điển hình nhất và cũng là thao tác thường xuyên nhất trong IO. Bạn có thể suy nghĩ theo một góc độ khác, ví dụ như phân loại IO theo đối tượng thao tác, IO có thể được phân loại thành: file, array, pipe, basic data types, buffered, print, bject serialization/deserialization, và conversion, v.v.</p>
<figure><img src="https://ucc.alicdn.com/pic/developer-ecology/7afb2f6df4234d30bfb92517047e1c31.png" alt="Phân loại theo đối tượng thao tác" tabindex="0" loading="lazy"><figcaption>Phân loại theo đối tượng thao tác</figcaption></figure>
<h4><strong>1) File</strong></h4>
<p>File Stream là stream thao tác trực tiếp trên tệp, có thể chia thành Byte Stream (FileInputStream và FileOutputStream) và character stream (FileReader và FileWriter).</p>
<p>Ví dụ về FileInputStream:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khai báo một biến kiểu int b, dùng để lưu trữ byte được đọc vào</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileInputStream, dùng để đọc dữ liệu từ tệp fis.txt</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fis.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc tuần tự dữ liệu từ tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Chuyển byte đọc được thành ký tự ASCII tương ứng và in ra màn hình</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)b);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng đối tượng FileInputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fis1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Ví dụ về FileOutputStream:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileOutputStream, dùng để ghi dữ liệu vào tệp fos.txt</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fos.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu vào tệp, ở đây ghi mảng byte tương ứng với chuỗi "Tom"</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng đối tượng FileOutputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Ví dụ về FileReader:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khai báo một biến kiểu int b, dùng để lưu trữ ký tự được đọc vào</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileReader, dùng để đọc dữ liệu từ tệp read.txt</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileReader </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"read.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc tuần tự dữ liệu từ tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fileReader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Chuyển ký tự đọc được thành kiểu char và in ra màn hình</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)b);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng đối tượng FileReader, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileReader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Ví dụ về FileWriter:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileWriter, dùng để ghi dữ liệu vào tệp fw.txt</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileWriter </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fw.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chuyển chuỗi "Tom" thành mảng ký tự</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] chars </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toCharArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu vào tệp, ở đây ghi tất cả các ký tự trong mảng chars</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileWriter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(chars, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">chars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng đối tượng FileWriter, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileWriter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>File Stream cũng có thể được sử dụng để tạo, xóa, đổi tên tệp, v.v. Tham số thứ hai của hàm tạo FileOutputStream và FileWriter có thể chỉ định việc thêm dữ liệu vào cuối tệp.</p>
<p>Ví dụ mã:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">createNewFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tạo tệp thành công"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tệp đã tồn tại"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Xóa tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">delete</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Xóa tệp thành công"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Xóa tệp thất bại"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đổi tên tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> oldFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"old.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> newFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"new.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">oldFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">renameTo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(newFile)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đổi tên tệp thành công"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đổi tên tệp thất bại"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Khi bạn đã nắm vững việc nhập và xuất tệp, các thao tác khác cũng sẽ trở nên dễ dàng hơn, vì chúng không có sự khác biệt quá lớn.</p>
<h4><strong>2) Array (Bộ nhớ)</strong></h4>
<p>Thông thường, đối với các thao tác đọc và ghi tệp, việc sử dụng file stream kết hợp với buffered stream là đủ. Tuy nhiên, để nâng cao hiệu quả, việc đọc và ghi tệp thường xuyên không phải là ý tưởng tốt. Vì vậy, array stream (còn gọi là stream bộ nhớ) ra đời.</p>
<p>Ví dụ về ByteArrayInputStream:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng ByteArrayInputStream, dùng để đọc dữ liệu từ mảng byte</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">InputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> is </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ByteArrayInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">                "Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StandardCharsets</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UTF_8</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Định nghĩa một mảng byte để lưu trữ dữ liệu được đọc vào</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] flush </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Định nghĩa một biến để lưu trữ số byte được đọc vào mỗi lần</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc tuần tự dữ liệu từ mảng byte và in ra màn hình</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> !=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> is</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(flush)</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Chuyển đổi byte đọc được thành chuỗi tương ứng và in ra màn hình</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(flush, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng stream đầu vào, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">is</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ví dụ về ByteArrayOutputStream:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng ByteArrayOutputStream, dùng để ghi dữ liệu vào bộ nhớ đệm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ByteArrayOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ByteArrayOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Định nghĩa một mảng byte để lưu trữ dữ liệu cần ghi vào bộ nhớ đệm</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] info </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu vào bộ nhớ đệm, ở đây ghi tất cả byte trong mảng info</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(info, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chuyển đổi dữ liệu trong bộ nhớ đệm thành mảng byte</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] dest </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toByteArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng đối tượng ByteArrayOutputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Array stream có thể được sử dụng để đọc và ghi dữ liệu trong bộ nhớ, ví dụ như lưu trữ dữ liệu trong mảng byte để nén, mã hóa, hoặc tuần tự hóa. Ưu điểm của nó là không cần tạo tệp tạm thời, có thể nâng cao hiệu suất của chương trình. Tuy nhiên, array stream cũng có nhược điểm là chỉ có thể lưu trữ một lượng dữ liệu giới hạn, nếu dữ liệu quá lớn sẽ dẫn đến tràn bộ nhớ.</p>
<h4><strong>3) Pipe</strong></h4>
<p>Piped trong Java khác với pipe trong Unix/Linux. Trong Unix/Linux, các tiến trình khác nhau có thể giao tiếp với nhau qua pipe, nhưng trong Java, các bên giao tiếp phải nằm trong cùng một tiến trình, tức là trong cùng một JVM. Pipe cung cấp khả năng giao tiếp giữa các luồng trong cùng một tiến trình.</p>
<p>Một luồng có thể ghi dữ liệu vào <code>PipedOutputStream</code> và luồng khác có thể đọc dữ liệu từ <code>PipedInputStream</code> liên kết với nó.</p>
<p>Ví dụ về <code>PipedOutputStream</code> và <code>PipedInputStream</code>:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng PipedOutputStream và một đối tượng PipedInputStream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> PipedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pipedOutputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> PipedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> PipedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pipedInputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> PipedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(pipedOutputStream)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một luồng, ghi dữ liệu vào PipedOutputStream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75"> thread1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Runnable</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Chuyển đổi chuỗi "Tom" thành mảng byte và ghi vào PipedOutputStream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            pipedOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StandardCharsets</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UTF_8</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Đóng PipedOutputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            pipedOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">})</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một luồng, đọc dữ liệu từ PipedInputStream và in ra màn hình</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75"> thread2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Runnable</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Định nghĩa một mảng byte để lưu trữ dữ liệu được đọc vào</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            byte</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75">flush</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">];</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Định nghĩa một biến để lưu trữ số byte được đọc vào mỗi lần</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Đọc tuần tự dữ liệu từ mảng byte và in ra màn hình</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> !=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> pipedInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(flush))) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">                // Chuyển đổi byte đọc được thành chuỗi tương ứng và in ra màn hình</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(flush, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len));</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Đóng PipedInputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            pipedInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">})</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khởi động thread1 và thread2</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">thread1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">thread2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sử dụng pipe có thể thực hiện việc truyền dữ liệu giữa các luồng khác nhau, có thể được sử dụng để giao tiếp giữa các luồng, truyền dữ liệu, v.v. Tuy nhiên, pipe cũng có một số hạn chế, chẳng hạn như chỉ có thể sử dụng giữa các luồng trong cùng một JVM và không thể vượt qua các tiến trình JVM khác nhau.</p>
<h4><strong>4) Kiểu dữ liệu cơ bản</strong></h4>
<p>Stream nhập xuất kiểu dữ liệu cơ bản là một byte stream, stream này không chỉ có thể đọc và ghi byte và ký tự, mà còn có thể đọc và ghi các kiểu dữ liệu cơ bản.</p>
<p><code>DataInputStream</code> cung cấp một loạt các phương thức để đọc các kiểu dữ liệu cơ bản:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng DataInputStream, dùng để đọc dữ liệu từ tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">DataInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> dis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> DataInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"das.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc một byte và chuyển đổi nó thành kiểu byte</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readByte</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc hai byte và chuyển đổi chúng thành kiểu short</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">short</span><span style="color:#E06C75;--shiki-dark:#E06C75"> s </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readShort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc bốn byte và chuyển đổi chúng thành kiểu int</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc tám byte và chuyển đổi chúng thành kiểu long</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> l </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLong</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc bốn byte và chuyển đổi chúng thành kiểu float</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">float</span><span style="color:#E06C75;--shiki-dark:#E06C75"> f </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readFloat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc tám byte và chuyển đổi chúng thành kiểu double</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">double</span><span style="color:#E06C75;--shiki-dark:#E06C75"> d </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readDouble</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc một byte và chuyển đổi nó thành kiểu boolean</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bb </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readBoolean</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc hai byte và chuyển đổi chúng thành kiểu char</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ch </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readChar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng DataInputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>DataOutputStream</code> cung cấp một loạt các phương thức để ghi các kiểu dữ liệu cơ bản:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng DataOutputStream, dùng để ghi dữ liệu vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">DataOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> das </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> DataOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"das.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu byte vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeByte</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu short vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeShort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu int vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu long vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeLong</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">10000L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu float vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeFloat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">12.34F</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu double vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeDouble</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">12.56</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu boolean vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeBoolean</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu char vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeChar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng DataOutputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ngoài <code>DataInputStream</code> và <code>DataOutputStream</code>, Java IO còn cung cấp một số lớp luồng khác để đọc và ghi các kiểu dữ liệu cơ bản và chuỗi, bao gồm <code>ObjectInputStream</code> và <code>ObjectOutputStream</code> (dùng để đọc và ghi đối tượng).</p>
<p>Ví dụ mã:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] args) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> oos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"person.dat"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Person</span><span style="color:#E06C75;--shiki-dark:#E06C75"> p </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Person</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 20</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        oos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(p);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ois </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"person.dat"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Person</span><span style="color:#E06C75;--shiki-dark:#E06C75"> p </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (Person) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ois</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(p);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75"> | </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClassNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Mã trên tạo ra một đối tượng <code>Person</code>, ghi nó vào tệp tin, sau đó đọc đối tượng từ tệp tin và in ra màn hình console.</p>
<h4><strong>5) Buffer</strong></h4>
<p>CPU rất nhanh, nó nhanh hơn bộ nhớ 100 lần, nhanh hơn đĩa cứng hàng triệu lần. Điều đó có nghĩa là, tương tác giữa chương trình và bộ nhớ sẽ rất nhanh, trong khi tương tác với đĩa cứng sẽ tương đối chậm, điều này sẽ dẫn đến vấn đề về hiệu suất.</p>
<p>Để giảm tương tác giữa chương trình và đĩa cứng, nâng cao hiệu suất chương trình, buffered stream đã được giới thiệu, bao gồm các lớp có tiền tố "Buffer" như BufferedInputStream, BufferedOutputStream, BufferedReader, BufferedWriter.</p>
<p>Buffered stream thiết lập một vùng đệm trong bộ nhớ, chỉ khi vùng đệm lưu trữ đủ dữ liệu cần thao tác thì mới tương tác với bộ nhớ hoặc đĩa cứng. Nói đơn giản, đọc/ghi nhiều hơn một chút mỗi lần, giảm số lần đọc/ghi, nhờ đó nâng cao hiệu suất chương trình.<br>
Dưới đây là một ví dụ sử dụng <code>BufferedInputStream</code> để đọc tệp tin:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng BufferedInputStream, dùng để đọc dữ liệu từ tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"data.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một mảng byte làm vùng đệm</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc dữ liệu từ tệp tin và lưu trữ vào vùng đệm</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bytesRead</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((bytesRead </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> bis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Xử lý dữ liệu trong vùng đệm</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Ở đây chỉ đơn giản là chuyển đổi mảng byte đã đọc thành chuỗi và in ra</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, bytesRead));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng BufferedInputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong đoạn mã trên, trước tiên tạo một đối tượng <code>BufferedInputStream</code> để đọc dữ liệu từ tệp tin. Sau đó tạo một mảng byte làm vùng đệm, mỗi lần đọc dữ liệu sẽ lưu trữ dữ liệu vào vùng đệm. Quá trình đọc dữ liệu được thực hiện thông qua vòng lặp <code>while</code>, mỗi lần đọc dữ liệu xong sẽ xử lý dữ liệu trong vùng đệm. Cuối cùng đóng <code>BufferedInputStream</code>, giải phóng tài nguyên.</p>
<p>Dưới đây là một ví dụ sử dụng <code>BufferedOutputStream</code> để ghi vào tệp tin:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng BufferedOutputStream, dùng để ghi dữ liệu vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"data.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một mảng byte làm vùng đệm</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "hello world!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Làm mới vùng đệm, ghi dữ liệu từ vùng đệm vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng BufferedOutputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong đoạn mã trên, đầu tiên tạo một đối tượng <code>BufferedOutputStream</code> để ghi dữ liệu vào tệp tin. Sau đó tạo một mảng byte làm vùng đệm và ghi dữ liệu vào vùng đệm. Quá trình ghi dữ liệu được thực hiện thông qua phương thức <code>write()</code>, truyền mảng byte làm tham số cho phương thức <code>write()</code>. Cuối cùng, thông qua phương thức <code>flush()</code> ghi dữ liệu từ vùng đệm vào tệp tin, và thông qua phương thức <code>close()</code> đóng <code>BufferedOutputStream</code>, giải phóng tài nguyên.</p>
<p>Dưới đây là một ví dụ sử dụng <code>BufferedReader</code> để đọc tệp tin:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng BufferedReader, dùng để đọc dữ liệu từ tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> br </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"data.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc dữ liệu từ tệp tin và lưu trữ vào chuỗi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((line </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Xử lý dữ liệu đã đọc</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Ở đây chỉ đơn giản là in ra từng dòng chuỗi đã đọc</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(line);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng BufferedReader, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Trong đoạn mã trên, trước tiên tạo một đối tượng <code>BufferedReader</code> để đọc dữ liệu từ tệp tin. Sau đó sử dụng phương thức <code>readLine()</code> để đọc dữ liệu từ tệp tin, mỗi lần đọc một dòng dữ liệu và lưu trữ vào một chuỗi. Quá trình đọc dữ liệu được thực hiện thông qua vòng lặp <code>while</code>.</p>
<p>Dưới đây là một ví dụ sử dụng <code>BufferedWriter</code> để ghi vào tệp tin:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng BufferedWriter, dùng để ghi dữ liệu vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"data.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "abcdef"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Làm mới vùng đệm, ghi dữ liệu từ vùng đệm vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng BufferedWriter, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Trong đoạn mã trên, trước tiên tạo một đối tượng <code>BufferedWriter</code> để ghi dữ liệu vào tệp tin. Sau đó sử dụng phương thức <code>write()</code> để ghi dữ liệu vào vùng đệm. Quá trình ghi dữ liệu tương tự như sử dụng lớp <code>FileWriter</code>. Lưu ý rằng khi sử dụng <code>BufferedWriter</code> để ghi dữ liệu, dữ liệu sẽ được ghi vào vùng đệm trước, chỉ khi vùng đệm đầy hoặc gọi phương thức <code>flush()</code> thì dữ liệu trong vùng đệm mới được ghi vào tệp tin.</p>
<p>Cuối cùng, thông qua phương thức <code>flush()</code> ghi dữ liệu từ vùng đệm vào tệp tin, và thông qua phương thức <code>close()</code> đóng <code>BufferedWriter</code>, giải phóng tài nguyên.</p>
<p>Sử dụng buffered stream có thể nâng cao hiệu suất đọc ghi, giảm số lần đọc ghi đĩa hoặc mạng một cách thường xuyên, từ đó nâng cao hiệu suất chương trình. Tuy nhiên, khi sử dụng buffered stream cần chú ý kích thước của vùng đệm và thời điểm làm mới vùng đệm để tránh mất dữ liệu hoặc dữ liệu không đầy đủ.</p>
<h4><strong>6) Print</strong></h4>
<p>Print stream của Java là một tập hợp các lớp dùng để in dữ liệu ra ngoài, bao gồm hai lớp <code>PrintStream</code> và <code>PrintWriter</code>.</p>
<p>Có lẽ print stream là thứ mà lập trình viên Java sử dụng nhiều nhất trong suốt sự nghiệp của họ: <code>System.out</code> thực ra trả về một đối tượng <code>PrintStream</code>, có thể dùng để in ra các loại đối tượng khác nhau.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hello world！"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p><code>PrintStream</code> cuối cùng sẽ xuất ra dữ liệu dạng byte, trong khi <code>PrintWriter</code> thì mở rộng từ giao diện <code>Writer</code>, vì vậy các phương thức <code>print()/println()</code> của nó cuối cùng sẽ xuất ra dữ liệu dạng ký tự. Việc sử dụng <code>PrintWriter</code> gần như tương tự với <code>PrintStream</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> StringWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">PrintWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> PrintWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(buffer)) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    pw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abcd"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">buffer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span></code></pre>
</div><p>Trong ví dụ trên, đầu tiên tạo một <code>StringWriter</code> để lưu trữ dữ liệu dạng chuỗi. Sau đó, sử dụng <code>PrintWriter</code> để viết dữ liệu vào <code>StringWriter</code>. Cuối cùng, dữ liệu được in ra màn hình bằng cách chuyển đổi <code>StringWriter</code> thành chuỗi và in ra bằng <code>System.out.println()</code>.</p>
<h4><strong>7) Object Serialize/Deserialize</strong></h4>
<p>Tuần tự hóa bản chất là chuyển một đối tượng Java thành mảng byte, sau đó có thể lưu trữ nó vào file hoặc truyền qua mạng đến máy từ xa.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng ByteArrayOutputStream buffer, dùng để lưu trữ dữ liệu</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ByteArrayOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ByteArrayOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng câu lệnh try-with-resources để tạo một đối tượng ObjectOutputStream output, và liên kết nó với buffer</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> output </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(buffer)) {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Sử dụng phương thức writeUTF() để ghi chuỗi "abcdef" vào bộ đệm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    output</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeUTF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abcdef"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng phương thức toByteArray() để chuyển đổi dữ liệu trong bộ đệm thành mảng byte và xuất ra màn hình điều khiển</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">buffer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toByteArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()));</span></span></code></pre>
</div><p>Đối ứng với tuần tự hóa, có phản tuần tự hóa, tức là quá trình chuyển đổi mảng byte thành đối tượng Java.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> input </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Person.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)))) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> s </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readUTF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Đoạn mã này chủ yếu sử dụng các lớp <code>ByteArrayOutputStream</code> và <code>ObjectOutputStream</code> của Java để ghi chuỗi "abcdef" vào một bộ đệm mảng byte và chuyển đổi dữ liệu trong bộ đệm thành mảng byte và xuất ra màn hình điều khiển.</p>
<p>Quá trình thực thi cụ thể như sau:</p>
<ul>
<li>Tạo một đối tượng <code>ByteArrayOutputStream</code> buffer để lưu trữ dữ liệu.</li>
<li>Sử dụng câu lệnh try-with-resources để tạo một đối tượng <code>ObjectOutputStream</code> output và liên kết nó với buffer.</li>
<li>Sử dụng phương thức <code>writeUTF()</code> để ghi chuỗi "abcdef" vào bộ đệm.</li>
<li>Khi câu lệnh try-with-resources hoàn thành, nó sẽ tự động gọi phương thức <code>close()</code> của output để đóng luồng xuất và giải phóng tài nguyên.</li>
<li>Sử dụng phương thức <code>toByteArray()</code> để chuyển đổi dữ liệu trong bộ đệm thành mảng byte.</li>
<li>Sử dụng phương thức <code>Arrays.toString()</code> để chuyển đổi mảng byte thành chuỗi và xuất ra màn hình điều khiển.</li>
</ul>
<h4><strong>8) Conversion</strong></h4>
<p>InputStreamReader là một cầu nối từ byte stream sang character stream, nó sử dụng bộ mã ký tự chỉ định để đọc các byte và giải mã chúng thành các ký tự.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng InputStreamReader isr, sử dụng đối tượng FileInputStream để đọc nội dung của tệp demo.txt và chuyển đổi nó thành character stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">InputStreamReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> isr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> InputStreamReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"demo.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một mảng ký tự cha để lưu trữ dữ liệu ký tự được đọc, với độ dài của mảng là 1024</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] cha </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng phương thức read() để đọc dữ liệu từ isr và lưu trữ dữ liệu ký tự đã đọc vào mảng cha, trả về giá trị len là số lượng ký tự đã đọc được</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> isr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(cha);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chuyển đổi mảng cha từ vị trí 0 đến len thành chuỗi và xuất ra màn hình console</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(cha, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng InputStreamReader isr để giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">isr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Đoạn mã này sử dụng lớp InputStreamReader và FileInputStream của Java để đọc dữ liệu từ tệp demo.txt và chuyển đổi chúng thành character stream. Sau đó, nó lưu trữ dữ liệu ký tự đã đọc vào một mảng và xuất chuỗi kết quả ra màn hình console.</p>
<p>OutputStreamWriter chuyển đổi một đối tượng xuất character stream thành một đối tượng xuất byte stream, là cầu nối từ character stream đến byte stream.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng File f, đại diện cho tệp test.txt</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> f </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng OutputStreamWriter out, sử dụng đối tượng FileOutputStream để ghi dữ liệu vào tệp f và chuyển đổi byte stream thành character stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Writer</span><span style="color:#E06C75;--shiki-dark:#E06C75"> out </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> OutputStreamWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(f))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng phương thức write() để ghi chuỗi "hello world!!" vào tệp f</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hello world!!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng đối tượng Writer out để giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Việc sử dụng conversion stream giúp dễ dàng chuyển đổi giữa byte stream và character stream. Trong việc đọc và ghi tệp văn bản, thường sử dụng character stream, trong khi khi truyền dữ liệu qua mạng hoặc giao tiếp với thiết bị, thường sử dụng byte stream.</p>
<p>Ngoài ra, khi sử dụng conversion stream, cần chú ý đến vấn đề mã hóa ký tự. Nếu không chỉ định mã hóa ký tự, sẽ sử dụng mã hóa mặc định, có thể gây ra vấn đề về ký tự lạ. Do đó, khuyến khích luôn chỉ định mã hóa ký tự chính xác khi sử dụng conversion stream, để tránh các vấn đề liên quan đến ký tự lạ.</p>
<p>Bạn hãy xem, sau khi tôi tổng hợp, cảm giác như không còn nhiều vấn đề về IO nữa đúng không! Đối với các tình huống và nghiệp vụ khác nhau, chọn IO Stream tương ứng, cách sử dụng chỉ là đọc và ghi.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630135523.png" type="image/png"/>
    </item>
    <item>
      <title>File Stream</title>
      <link>https://vanhung4499.github.io/programming/java/IO/file.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/file.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">File Stream</source>
      <description>File Stream Trong các hoạt động IO, việc làm việc với tệp là phần phức tạp nhưng cũng là phần được sử dụng nhiều nhất, hầu hết các dự án của chúng ta đều có một lớp tiện ích gọi...</description>
      <category>java</category>
      <pubDate>Sun, 30 Jun 2024 16:14:55 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Trong các hoạt động IO, việc làm việc với tệp là phần phức tạp nhưng cũng là phần được sử dụng nhiều nhất, hầu hết các dự án của chúng ta đều có một lớp tiện ích gọi là FileUtil hoặc FileUtils.</p>
<p>Lớp <code>java.io.File</code> là lớp đặc biệt để thao tác với tệp, chú ý rằng chỉ có thể thao tác với chính tệp, không thể thao tác với nội dung của tệp, để làm việc với nội dung, cần sử dụng luồng vào ra.</p>
<p>Lớp <code>File</code> là một biểu diễn trừu tượng của tệp và thư mục, chủ yếu được sử dụng cho các hoạt động như tạo, tìm kiếm và xóa tệp và thư mục.</p>
<p>Làm sao để hiểu hai câu trên? Thực ra rất đơn giản!</p>
<p>Câu đầu tiên nói rằng <code>File</code> không liên quan đến stream, lớp <code>File</code> không thể đọc và ghi tệp, nghĩa là không thể nhập và xuất dữ liệu!</p>
<p>Câu thứ hai nói rằng <code>File</code> có thể đại diện cho <code>D:\\folder1</code> và <code>D:\\folder1\\file.txt</code>, phần trước là thư mục (Directory) và phần sau là tệp (file), lớp <code>File</code> được sử dụng để thao tác với cả hai.</p>
<h3>Các phương thức khởi tạo của lớp File</h3>
<p>Trong Java, mọi thứ đều là đối tượng và lớp File cũng không ngoại lệ. Bất kể là đối tượng nào cũng nên bắt đầu từ phương thức khởi tạo của đối tượng đó, vậy nên chúng ta hãy cùng phân tích các phương thức khởi tạo của lớp <code>File</code>.</p>
<p>Có ba phương thức khởi tạo thường được sử dụng:</p>
<ol>
<li>
<p><code>File(String pathname)</code>: Tạo một đối tượng File mới từ đường dẫn được chỉ định.</p>
</li>
<li>
<p><code>File(String parent, String child)</code>: Tạo một đối tượng File mới từ đường dẫn của thư mục cha (dưới dạng chuỗi) và tên tệp con.</p>
</li>
<li>
<p><code>File(File parent, String child)</code>: Tạo một đối tượng File mới từ thư mục cha (dưới dạng đối tượng File) và tên tệp con.</p>
</li>
</ol>
<p>Để hiểu rõ hơn, hãy xem ví dụ sau đây:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đường dẫn tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> path </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "/Users/username/123.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(path)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đường dẫn tệp tin khác</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> path2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "/Users/username/1/2.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(path2)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo từ thư mục cha và tên tệp con</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> parent </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "/Users/username/aaa"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> child </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "bbb.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file3 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> child)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo từ đối tượng thư mục cha và tên tệp con</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> parentDir </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/aaa"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> child2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "bbb.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file4 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(parentDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> child2)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lưu ý rằng trên macOS, dấu gạch chéo xuôi (<code>/</code>) được sử dụng làm ký tự phân cách trong đường dẫn, trong khi trên Windows, dấu gạch chéo ngược (<code>\</code>) được sử dụng. Vì vậy, khi xử lý đường dẫn, không nên sử dụng trực tiếp <code>/</code> hoặc <code>\</code>.</p>
<p>Trong Java, bạn có thể sử dụng <code>File.separator</code> để lấy ký tự phân cách đường dẫn, điều này sẽ tự động trả về ký tự phân cách đúng dựa trên hệ điều hành đang sử dụng.</p>
<p>Những điểm cần chú ý về lớp File:</p>
<ol>
<li>Một đối tượng File đại diện cho một tệp hoặc thư mục thực tế trên đĩa cứng.</li>
<li>Phương thức khởi tạo của lớp File không kiểm tra xem tệp hoặc thư mục có tồn tại thực sự hay không, vì vậy việc có hay không một tệp hoặc thư mục trong đường dẫn không ảnh hưởng đến việc tạo đối tượng File.</li>
</ol>
<h3>Các phương thức thông dụng của lớp File</h3>
<p>Các phương thức thông dụng của lớp File chủ yếu bao gồm các phương thức để lấy thông tin, lấy đường dẫn tuyệt đối và tương đối, kiểm tra và tạo/xóa tệp tin.</p>
<h4><strong>1) Các phương thức để lấy thông tin</strong></h4>
<ol>
<li>
<p><code>getAbsolutePath()</code>: Trả về đường dẫn tuyệt đối của đối tượng File.</p>
</li>
<li>
<p><code>getPath()</code>: Trả về đường dẫn của đối tượng File. Kết quả giống như <code>getAbsolutePath()</code>.</p>
</li>
<li>
<p><code>getName()</code>: Trả về tên của tệp tin hoặc thư mục.</p>
</li>
<li>
<p><code>length()</code>: Trả về độ dài của tệp tin, tính bằng byte.</p>
</li>
</ol>
<p>Đoạn mã kiểm tra sau đây dùng để thử nghiệm (chú ý thay đổi các đường dẫn theo máy tính của bạn):</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> f </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/aaa/bbb.java"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đường dẫn tuyệt đối của tệp tin: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đường dẫn được tạo: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tên của tệp tin: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Độ dài của tệp tin: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> " byte"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> f2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/aaa"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đường dẫn tuyệt đối của thư mục: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đường dẫn được tạo: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tên của thư mục: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khi đối tượng File đại diện cho một thư mục, phương thức length() không có ý nghĩa</span></span></code></pre>
</div><h4><strong>2) Đường dẫn tuyệt đối và tương đối</strong></h4>
<p>Đường dẫn tuyệt đối là đường dẫn đầy đủ bắt đầu từ gốc của hệ thống tệp tin, mô tả vị trí chính xác của một tệp tin hoặc thư mục trong hệ thống tệp tin. Trên Windows, đường dẫn tuyệt đối thường bắt đầu với ổ đĩa (ví dụ: "<code>C:\Program Files\Java\jdk1.8.0_291\bin\java.exe</code>"). Trên macOS và Linux, đường dẫn tuyệt đối thường bắt đầu với dấu gạch chéo (<code>/</code>), ví dụ: "<code>/usr/local/bin/python3</code>".</p>
<p>Đường dẫn tương đối là đường dẫn dựa trên thư mục làm việc hiện tại, mô tả mối quan hệ giữa một tệp tin hoặc thư mục và thư mục làm việc hiện tại. Trong Java, đường dẫn tương đối thường được tính từ thư mục chứa chương trình Java hiện tại. Ví dụ: "<code>config/config.properties</code>" nếu thư mục làm việc hiện tại là "<code>/Users/username/project</code>", thì đường dẫn tương đối sẽ là "<code>/Users/username/project/config/config.properties</code>".</p>
<p>Lưu ý:</p>
<ul>
<li>Trên hệ điều hành Windows, hệ thống tệp tin mặc định không phân biệt chữ hoa chữ thường, nghĩa là tên tệp và đường dẫn có thể sử dụng cả chữ hoa và chữ thường. Ví dụ: "<code>C:\Users\username\Documents\example.txt</code>" và "<code>C:\Users\Username\Documents\Example.txt</code>" đều chỉ cùng một tệp. Tuy nhiên, Windows cung cấp một tùy chọn phân biệt chữ hoa chữ thường có thể được kích hoạt khi định dạng ổ đĩa.</li>
<li>Trên hệ điều hành macOS và Linux (Unix), hệ thống tệp mặc định là phân biệt chữ hoa chữ thường. Ví dụ: Trong macOS, "<code>/Users/username/Documents/example.txt</code>" và "<code>/Users/username/Documents/Example.txt</code>" là hai tệp khác nhau.</li>
</ul>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ví dụ về đường dẫn tuyệt đối</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> absoluteFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/example/test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đường dẫn tuyệt đối: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> absoluteFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ví dụ về đường dẫn tương đối</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> relativeFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"example/test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đường dẫn tương đối: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> relativeFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span></code></pre>
</div><p>Thông qua những ví dụ này, bạn có thể hiểu rõ hơn về cách sử dụng các phương thức của lớp <code>File</code> trong Java để làm việc với tệp tin và thư mục.</p>
<h4><strong>3）Các phương thức để kiểm tra</strong></h4>
<ol>
<li>
<p><code>exists()</code> ：Kiểm tra xem tệp tin hoặc thư mục có tồn tại không.</p>
</li>
<li>
<p><code>isDirectory()</code> ：Kiểm tra xem đối tượng có phải là thư mục không.</p>
</li>
<li>
<p><code>isFile()</code> ：Kiểm tra xem đối tượng có phải là tệp tin không.</p>
</li>
</ol>
<p>Đoạn mã minh họa như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/example"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem tệp tin hoặc thư mục có tồn tại không</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tệp tin hoặc thư mục tồn tại"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tệp tin hoặc thư mục không tồn tại"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem đối tượng có phải là thư mục không</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isDirectory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đây là một thư mục"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đây không phải là một thư mục"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem đối tượng có phải là tệp tin không</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đây là một tệp tin"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đây không phải là một tệp tin"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4><strong>4）Các phương thức để tạo và xóa</strong></h4>
<ul>
<li><code>createNewFile()</code> ：Nếu tệp tin chưa tồn tại, tạo một tệp tin mới trống và trả về <code>true</code>; nếu tệp tin đã tồn tại, không tạo mới và trả về <code>false</code>.</li>
<li><code>delete()</code> ：Xóa tệp tin hoặc thư mục. Nếu là thư mục, chỉ có thể xóa nếu thư mục đó trống.</li>
<li><code>mkdir()</code> ：Chỉ có thể tạo một thư mục cấp độ một. Nếu thư mục cha không tồn tại, thao tác tạo thất bại. Trả về <code>true</code> nếu tạo thành công, trả về <code>false</code> nếu thất bại.</li>
<li><code>mkdirs()</code> ：Có thể tạo nhiều cấp thư mục. Nếu thư mục cha không tồn tại, sẽ được tạo kèm theo. Trả về <code>true</code> nếu tạo thành công hoặc thư mục đã tồn tại, trả về <code>false</code> nếu thất bại.</li>
</ul>
<p><strong>Trong phát triển thường sử dụng</strong> <code>mkdirs()</code>.</p>
<p>Đoạn mã thử nghiệm như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo tệp tin mới</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/example/test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">createNewFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tạo tệp tin thành công: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tạo tệp tin thất bại: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Xóa tệp tin</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">delete</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Xóa tệp tin thành công: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Xóa tệp tin thất bại: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo nhiều cấp thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> directory </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/example/subdir1/subdir2"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">directory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">mkdirs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tạo thư mục thành công: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> directory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tạo thư mục thất bại: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> directory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>5）Duyệt thư mục</h4>
<ul>
<li><code>String[] list()</code> ：Trả về một mảng String, biểu diễn tất cả các tệp con hoặc thư mục trong thư mục File này.</li>
<li><code>File[] listFiles()</code> ：Trả về một mảng File, biểu diễn tất cả các tệp con hoặc thư mục trong thư mục File này.</li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> directory </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/itwanger/Documents/Github/paicoding"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Liệt kê tên các tệp trong thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] files </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> directory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tên các tệp trong thư mục:"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#C678DD;--shiki-dark:#C678DD">:</span><span style="color:#E06C75;--shiki-dark:#E06C75"> files) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Liệt kê các tệp và thư mục con trong thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] filesAndDirs </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> directory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">listFiles</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Các tệp và thư mục con trong thư mục:"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileOrDir </span><span style="color:#C678DD;--shiki-dark:#C678DD">:</span><span style="color:#E06C75;--shiki-dark:#E06C75"> filesAndDirs) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tệp tin: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#C678DD;--shiki-dark:#C678DD"> if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isDirectory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Thư mục: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Lưu ý:</strong> Để sử dụng <code>listFiles()</code> để lấy danh sách các tệp hoặc thư mục con của một thư mục cụ thể, hai điều kiện sau phải được đảm bảo:</p>
<ol>
<li>Thư mục đã chỉ định phải tồn tại.</li>
<li>Thư mục đã chỉ định phải là một thư mục. Nếu không, có thể dẫn đến ngoại lệ NullPointerException.</li>
</ol>
<h4>6）Duyệt đệ quy</h4>
<p>Không cần nói nhiều, hãy xem ngay đoạn mã sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] args) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> directory </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/hnv99/Documents/Github"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Duyệt đệ quy các tệp và thư mục con trong thư mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    traverseDirectory</span><span style="color:#E06C75;--shiki-dark:#E06C75">(directory)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> traverseDirectory</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> directory) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Liệt kê tất cả các tệp và thư mục con trong thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    File</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] filesAndDirs </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> directory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">listFiles</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Duyệt qua từng tệp và thư mục con</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileOrDir </span><span style="color:#C678DD;--shiki-dark:#C678DD">:</span><span style="color:#E06C75;--shiki-dark:#E06C75"> filesAndDirs) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Nếu là tệp tin, xuất ra tên tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tệp tin: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#C678DD;--shiki-dark:#C678DD"> if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isDirectory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Nếu là thư mục, duyệt đệ quy vào thư mục con</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Thư mục: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            traverseDirectory</span><span style="color:#E06C75;--shiki-dark:#E06C75">(fileOrDir)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>RandomAccessFile</h3>
<p>RandomAccessFile là một lớp rất đặc biệt trong Java, nó không chỉ được sử dụng để đọc file mà còn để ghi file. Khác với các lớp IO khác như FileInputStream và FileOutputStream, RandomAccessFile cho phép bạn nhảy đến bất kỳ vị trí nào trong file và bắt đầu đọc hoặc ghi từ đó. Điều này làm cho nó rất phù hợp cho các tình huống cần truy cập dữ liệu ngẫu nhiên trong file, chẳng hạn như hệ thống cơ sở dữ liệu.</p>
<p>Dưới đây là một ví dụ về việc sử dụng RandomAccessFile để ghi và đọc file:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.io.IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.io.RandomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> RandomAccessFileDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> filePath</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "logs/java/abc.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Sử dụng RandomAccessFile để ghi file</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            writeToFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(filePath, </span><span style="color:#98C379;--shiki-dark:#98C379">"Hello, world!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Sử dụng RandomAccessFile để đọc file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> content</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> readFromFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(filePath);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Nội dung file: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> content);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> writeToFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> filePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">RandomAccessFile</span><span style="color:#E06C75;--shiki-dark:#E06C75"> randomAccessFile</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> RandomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(filePath, </span><span style="color:#98C379;--shiki-dark:#98C379">"rw"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Di chuyển con trỏ file tới cuối file (để nối thêm nội dung)</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            randomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">seek</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">randomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Ghi nội dung</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            randomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeUTF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(content);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> readFromFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> filePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        StringBuilder</span><span style="color:#E06C75;--shiki-dark:#E06C75"> content</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> StringBuilder</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">RandomAccessFile</span><span style="color:#E06C75;--shiki-dark:#E06C75"> randomAccessFile</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> RandomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(filePath, </span><span style="color:#98C379;--shiki-dark:#98C379">"r"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Di chuyển con trỏ file tới đầu file (để đọc từ đầu)</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            randomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">seek</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">append</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">randomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readUTF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Để tránh vấn đề lỗi font chữ tiếng Trung, chúng ta sử dụng các phương thức writeUTF và readUTF của RandomAccessFile, các phương thức này xử lý chuỗi sử dụng mã hóa UTF-8. Bạn có thể tự chạy đoạn mã này để trải nghiệm.</p>
<p>Tiếp theo, chúng ta sẽ đi vào chi tiết về các phương thức khởi tạo và các phương thức phổ biến của RandomAccessFile.</p>
<h4>Các phương thức khởi tạo</h4>
<p>RandomAccessFile chủ yếu có hai phương thức khởi tạo:</p>
<ul>
<li><code>RandomAccessFile(File file, String mode)</code>：Tạo một instance mới của RandomAccessFile sử dụng file object và mode truy cập cho trước.</li>
<li><code>RandomAccessFile(String name, String mode)</code>：Tạo một instance mới của RandomAccessFile sử dụng tên file và mode truy cập cho trước.</li>
</ul>
<p>Giá trị của mode có thể là:</p>
<ul>
<li>"r"：Mở file chỉ để đọc. Bất kỳ phương thức ghi nào cũng sẽ dẫn đến IOException.</li>
<li>"rw"：Mở file để đọc và ghi. Nếu file không tồn tại, nó sẽ được tạo ra.</li>
<li>"rws"：Mở file để đọc và ghi, yêu cầu mọi cập nhật nội dung hoặc siêu dữ liệu được ghi ngay lập tức xuống thiết bị lưu trữ dưới. Mode này đồng bộ và đảm bảo không mất dữ liệu trong trường hợp hệ thống sập.</li>
<li>"rwd"：Tương tự như "rws", mở file để đọc và ghi, nhưng yêu cầu chỉ ghi nội dung của file ngay lập tức. Siêu dữ liệu có thể được ghi trễ.</li>
</ul>
<h4>Các phương thức chính</h4>
<ul>
<li><code>long getFilePointer()</code>：Trả về vị trí hiện tại của con trỏ file.</li>
<li><code>long length()</code>：Trả về độ dài của file.</li>
<li><code>int read()</code>：Đọc một byte từ file.</li>
<li><code>int read(byte[] b)</code>：Đọc dữ liệu byte từ file và lưu vào mảng byte chỉ định.</li>
<li><code>int read(byte[] b, int off, int len)</code>：Đọc dữ liệu byte từ file và lưu vào mảng byte chỉ định, bắt đầu từ vị trí off và tối đa len byte.</li>
<li><code>String readLine()</code>：Đọc một dòng văn bản từ file.</li>
<li><code>readUTF()</code>：Đọc một chuỗi mã hóa UTF-8 từ file. Phương thức này trước tiên đọc hai byte cho thông tin độ dài, sau đó đọc dữ liệu byte UTF-8 dựa trên độ dài này và chuyển đổi chúng thành chuỗi Java. Điều này có nghĩa là khi sử dụng readUTF để đọc chuỗi, bạn cần đảm bảo rằng chuỗi trong file đã được ghi bằng writeUTF, để thông tin về độ dài và mã hóa được giữ nguyên.</li>
<li><code>void seek(long pos)</code>：Di chuyển con trỏ file đến vị trí pos trong file.</li>
<li><code>void write(byte[] b)</code>：Ghi tất cả byte của mảng byte chỉ định vào file.</li>
<li><code>void write(byte[] b, int off, int len)</code>：Ghi len byte từ mảng byte chỉ định vào file, bắt đầu từ vị trí off.</li>
<li><code>void write(int b)</code>：Ghi byte chỉ định vào file.</li>
<li><code>writeUTF(String str)</code>：Ghi một chuỗi mã hóa UTF-8 vào file. Phương thức này trước tiên ghi hai byte cho độ dài chuỗi UTF-8, sau đó ghi dữ liệu byte UTF-8 của chuỗi. Do đó, khi sử dụng writeUTF để ghi chuỗi, số byte thực tế được ghi sẽ nhiều hơn độ dài byte UTF-8 của chuỗi. Hai byte này được sử dụng để xác định độ dài chuỗi chính xác khi đọc.</li>
</ul>
<p>Hãy xem thêm ví dụ sau, kết hợp với những gì đã được trình bày, bạn sẽ hoàn toàn nắm vững về RandomAccessFile.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"logs/java/abc.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">RandomAccessFile</span><span style="color:#E06C75;--shiki-dark:#E06C75"> raf </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> RandomAccessFile</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "rw"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Ghi vào file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    raf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeUTF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Hello, world!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Di chuyển con trỏ file về đầu file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    raf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">seek</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đọc nội dung từ file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> content </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> raf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readUTF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Nội dung: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> content);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ví dụ này, chúng ta đầu tiên tạo một đối tượng file có tên là itwanger.txt. Sau đó, chúng ta sử dụng RandomAccessFile để mở file này ở chế độ đọc ghi.</p>
<p>Tiếp theo, chúng ta sử dụng phương thức writeUTF để ghi chuỗi "Hello, world!" vào file. Sau đó, chúng ta sử dụng seek để di chuyển con trỏ file về đầu file và sử dụng readUTF để đọc nội dung của file. Kết quả đầu ra sẽ là "Hello, world!".</p>
<p>Cuối cùng, chúng ta sử dụng câu lệnh try-with-resources để đảm bảo rằng RandomAccessFile sẽ được đóng đúng cách sau khi hoàn thành các thao tác.</p>
<h3>Apache FileUtils Class</h3>
<p>Lớp FileUtils là một lớp trong thư viện Apache Commons IO, cung cấp một số phương thức tiện ích để thao tác với các tệp và thư mục.</p>
<h4><strong>1）Sao chép tệp hoặc thư mục:</strong></h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> srcFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"đường/dẫn/đến/tệp/nguồn"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> destFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"đường/dẫn/đến/tệp/đích"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sao chép tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(srcFile, destFile);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sao chép thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyDirectory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(srcFile, destFile);</span></span></code></pre>
</div><h4><strong>2）Xóa tệp hoặc thư mục:</strong></h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"đường/dẫn/đến/tệp/hoặc/thư/mục"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Xóa tệp hoặc thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">delete</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file);</span></span></code></pre>
</div><p>Cần lưu ý rằng, để xóa một thư mục không trống, bạn cần xóa tất cả các tệp và thư mục con trước.</p>
<h4><strong>3）Di chuyển tệp hoặc thư mục:</strong></h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> srcFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"đường/dẫn/đến/tệp/nguồn"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> destFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"đường/dẫn/đến/tệp/đích"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Di chuyển tệp hoặc thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">moveFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(srcFile, destFile);</span></span></code></pre>
</div><h4><strong>4）Truy vấn thông tin về tệp hoặc thư mục:</strong></h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"đường/dẫn/đến/tệp/hoặc/thư/mục"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy thời gian sửa đổi của tệp hoặc thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Date</span><span style="color:#E06C75;--shiki-dark:#E06C75"> modifyTime </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">lastModified</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy kích thước của tệp hoặc thư mục</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> size </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">sizeOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy phần mở rộng của tên tệp hoặc thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> extension </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getExtension</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span></code></pre>
</div><p>Đó là một số phương thức quan trọng trong lớp FileUtils mà bạn có thể sử dụng để thực hiện các thao tác thường gặp khi làm việc với tệp và thư mục trong Java.</p>
<h3>Lớp FileUtil trong Hutool</h3>
<p>Lớp FileUtil là một công cụ thao tác tệp trong gói công cụ <a href="https://hutool.cn" target="_blank" rel="noopener noreferrer">Hutool</a>, cung cấp một loạt các phương thức đơn giản và dễ sử dụng để thực hiện các nhiệm vụ liên quan đến tệp trong Java.</p>
<p>Lớp FileUtil bao gồm các loại công cụ thao tác sau:</p>
<ul>
<li>Thao tác với tệp: bao gồm tạo mới, xóa, sao chép, di chuyển, đổi tên thư mục và tệp.</li>
<li>Kiểm tra tệp: kiểm tra xem tệp hoặc thư mục có trống không, có phải là thư mục, là tệp hay không.</li>
<li>Đường dẫn tuyệt đối: chuyển đổi tệp từ ClassPath thành tệp đường dẫn tuyệt đối.</li>
<li>Tên tệp: lấy tên chính của tệp, phần mở rộng của tệp.</li>
<li>Thao tác đọc: bao gồm đọc đối tượng Reader, đọc các phương thức đa dạng.</li>
<li>Thao tác ghi: bao gồm lấy Writer, các phương thức ghi đa dạng.</li>
</ul>
<p>Dưới đây là một số phương thức phổ biến trong lớp FileUtil:</p>
<ol>
<li><strong>copyFile</strong>: Sao chép tệp. Phương thức này sao chép tệp nguồn đã chỉ định vào tệp đích đã chỉ định.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> dest </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"FileUtilDemo2.java"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file, dest);</span></span></code></pre>
</div><ol start="2">
<li><strong>move</strong>: Di chuyển tệp hoặc thư mục. Phương thức này di chuyển tệp hoặc thư mục nguồn đã chỉ định đến tệp hoặc thư mục đích đã chỉ định.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">move</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file, dest, </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><ol start="3">
<li><strong>del</strong>: Xóa tệp hoặc thư mục. Phương thức này xóa tệp hoặc thư mục đã chỉ định, nếu không tồn tại thì ném ra ngoại lệ.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file);</span></span></code></pre>
</div><ol start="4">
<li><strong>rename</strong>: Đổi tên tệp hoặc thư mục. Phương thức này đổi tên tệp hoặc thư mục đã chỉ định thành tên mới đã chỉ định.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">rename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file, </span><span style="color:#98C379;--shiki-dark:#98C379">"FileUtilDemo3.java"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><ol start="5">
<li><strong>readLines</strong>: Đọc từng dòng dữ liệu từ tệp.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLines</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file, </span><span style="color:#98C379;--shiki-dark:#98C379">"UTF-8"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">forEach</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">println);</span></span></code></pre>
</div><p>Hãy khám phá thêm nhiều phương thức hữu ích khác trong mã nguồn của Hutool, đây là những công cụ sẽ giúp nâng cao khả năng lập trình của bạn.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Byte Stream</title>
      <link>https://vanhung4499.github.io/programming/java/IO/stream.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/stream.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Byte Stream</source>
      <description>Byte Stream Chúng ta cần phải nhấn mạnh rằng dữ liệu của mọi tệp (văn bản, video, hình ảnh) đều được lưu trữ dưới dạng nhị phân và được truyền tải dưới dạng nhị phân. Do đó, byt...</description>
      <category>java</category>
      <pubDate>Sun, 30 Jun 2024 16:14:55 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Chúng ta cần phải nhấn mạnh rằng dữ liệu của mọi tệp (văn bản, video, hình ảnh) đều được lưu trữ dưới dạng nhị phân và được truyền tải dưới dạng nhị phân. Do đó, byte stream có thể truyền tải dữ liệu của bất kỳ loại tệp nào.</p>
<h3>Byte Output Stream (OutputStream)</h3>
<p><code>java.io.OutputStream</code> là lớp cha của <strong>byte output stream</strong>, chúng ta hãy xem một số phương thức chung mà nó định nghĩa:</p>
<ol>
<li>
<p><code>close()</code> : Đóng output stream này và giải phóng tài nguyên hệ thống liên quan đến stream này.</p>
</li>
<li>
<p><code>flush()</code> : Xả output stream này và buộc các byte trong bộ đệm được ghi vào đích.</p>
</li>
<li>
<p><code>write(byte[] b)</code> : Ghi b.length byte từ mảng byte đã cho vào output stream này.</p>
</li>
<li>
<p><code>write(byte[] b, int off, int len)</code> : Ghi len byte từ mảng byte đã cho vào output stream này, bắt đầu từ vị trí offset off.</p>
</li>
</ol>
<h3>Lớp FileOutputStream</h3>
<p><code>OutputStream</code> có nhiều lớp con, và chúng ta sẽ bắt đầu với một trong những lớp con đơn giản nhất là <code>FileOutputStream</code>. Như tên gọi, đây là một output stream tệp được sử dụng để ghi dữ liệu vào tệp.</p>
<h4><strong>1) Các phương thức khởi tạo của FileOutputStream</strong></h4>
<ol>
<li>Sử dụng tên tệp để tạo đối tượng FileOutputStream.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileName </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "example.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(fileName)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Đoạn mã trên tạo một đối tượng FileOutputStream với tên tệp là "example.txt". <strong>Nếu tệp không tồn tại, nó sẽ tạo một tệp mới; nếu tệp đã tồn tại, nó sẽ ghi đè lên tệp hiện có</strong>.</p>
<ol start="2">
<li>Sử dụng đối tượng File để tạo đối tượng FileOutputStream.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"example.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Ví dụ về việc sử dụng FileOutputStream:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"example.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">  fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">  e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">      fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">      e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đoạn mã trên tạo một đối tượng FileOutputStream, ghi chuỗi "Tom" vào tệp "example.txt", và cuối cùng đóng output stream.</p>
<h4><strong>2) Ghi dữ liệu byte với FileOutputStream</strong></h4>
<p>Để ghi dữ liệu byte với FileOutputStream, chúng ta sử dụng chủ yếu các phương thức sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] b)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len)  </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi từ vị trí `off`, `len` byte</span></span></code></pre>
</div><p>① <strong>Ghi một byte</strong>: Phương thức <code>write(int b)</code> ghi từng byte một, ví dụ như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo stream với tên file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fos.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">     </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">97</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Byte thứ nhất</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">98</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Byte thứ hai</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Byte thứ ba</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Ký tự 'a' có <a href="https://javabetter.cn/basic-extra-meal/java-unicode.html" target="_blank" rel="noopener noreferrer">giá trị ASCII</a> là 97, 'b' là 98, 'c' là 99. Do đó, đoạn mã trên có thể được viết lại như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo stream với tên file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fos.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">     </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'a'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Byte thứ nhất</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'b'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Byte thứ hai</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'c'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Byte thứ ba</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Phương thức <code>write(int b)</code> ghi từng byte một, với tham số <code>b</code> là giá trị nguyên của byte cần ghi. Mỗi byte chỉ có 8 bit, do đó giá trị của <code>b</code> phải nằm trong khoảng từ 0 đến 255. Giá trị ngoài khoảng này sẽ bị cắt bỏ. Ví dụ, nếu <code>b</code> là -1, nó sẽ bị cắt thành 255; nếu <code>b</code> là 256, nó sẽ bị cắt thành 0.</p>
<p>Khi ghi <code>b</code> vào output stream, phương thức <code>write(int b)</code> chỉ ghi 8 bit thấp của <code>b</code>, bỏ qua 24 bit cao. Điều này là do trong Java, các kiểu số nguyên (bao gồm byte, short, int, long) được biểu diễn dưới dạng bù hai nhị phân trong bộ nhớ. Khi chuyển một giá trị số nguyên cho phương thức <code>write(int b)</code>, phương thức này chỉ giữ lại 8 bit thấp của biểu diễn bù hai nhị phân, bỏ qua 24 bit cao.</p>
<p>Ví dụ, nếu giá trị cần ghi là 0x12345678, biểu diễn bù hai nhị phân là 0001 0010 0011 0100 0101 0110 0111 1000. Khi sử dụng phương thức <code>write(int b)</code> để ghi giá trị này, chỉ có 8 bit thấp 0111 1000 được ghi ra, bỏ qua 24 bit cao 0001 0010 0011 0100 0101 0110. Điều này là lý do tại sao 24 bit cao của tham số <code>b</code> bị bỏ qua.</p>
<p>0111 1000 là số nhị phân 8 bit, tương đương với số thập phân là 120, tương ứng với ký tự ASCII là "x". Trong bảng mã ASCII, giá trị ASCII thập phân của ký tự "x" là 120. Do đó, nếu sử dụng phương thức <code>write(int b)</code> để ghi một giá trị byte là 0x78 (tức là 120 thập phân), kết quả sẽ là ký tự "x".</p>
<p>Hãy xem ví dụ sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"example.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">120</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'x'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">0x12345678</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Hãy xem kết quả:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630181913.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Thật là có 3 ký tự 'x'.</p>
<p>② <strong>Ghi một mảng byte</strong>: Phương thức <code>write(byte[] b)</code> cho phép ghi toàn bộ mảng byte, ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo stream với tên file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fos.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">     </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chuyển đổi chuỗi thành mảng byte</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu từ mảng byte</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>③ <strong>Ghi một phần mảng byte chỉ định</strong>: Phương thức <code>write(byte[] b, int off, int len)</code> cho phép ghi một phần mảng byte từ vị trí chỉ định, ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo stream với tên file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fos.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">     </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chuyển đổi chuỗi thành mảng byte</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "abcde"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi 2 byte bắt đầu từ chỉ số 2 (tức là "cd")</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><h4><strong>3) FileOutputStream thực hiện thêm dữ liệu, xuống dòng</strong></h4>
<p>Trong các ví dụ mã trên, mỗi lần chạy chương trình sẽ tạo một đối tượng stream mới, dẫn đến dữ liệu trong tệp cũng bị xóa đi. Nếu muốn giữ lại dữ liệu hiện có trong tệp và tiếp tục <strong>thêm dữ liệu mới</strong>, chúng ta phải làm thế nào? Và làm thế nào để thực hiện <strong>xuống dòng</strong>?</p>
<p>Thực tế, điều này rất đơn giản.</p>
<p>Chúng ta học hai phương thức khác của <code>FileOutputStream</code>, như sau:</p>
<ol>
<li>Sử dụng tên tệp và cờ thêm để tạo đối tượng FileOutputStream</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileName </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "example.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> append </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(fileName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> append)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Đoạn mã trên sử dụng tên tệp "example.txt" và cờ thêm để tạo đối tượng FileOutputStream, thêm dữ liệu vào cuối tệp. Nếu tệp không tồn tại, nó sẽ tạo một tệp mới; nếu tệp đã tồn tại, nó sẽ thêm dữ liệu vào cuối tệp.</p>
<ol start="2">
<li>Sử dụng đối tượng tệp và cờ thêm để tạo đối tượng FileOutputStream</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"example.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> append </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> append)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Đoạn mã trên sử dụng đối tượng tệp và cờ thêm để tạo đối tượng FileOutputStream, thêm dữ liệu vào cuối tệp.</p>
<p>Cả hai phương thức khởi tạo này đều yêu cầu một giá trị boolean trong tham số thứ hai, <code>true</code> có nghĩa là thêm dữ liệu, <code>false</code> có nghĩa là không thêm (tức là xóa dữ liệu hiện có).</p>
<p>Để thực hiện thêm dữ liệu, bạn có thể sử dụng mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo stream với tên tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fos.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">     </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chuyển đổi chuỗi thành mảng byte</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "abcde"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu từ mảng byte, sẽ thêm vào cuối tệp vì đã sử dụng cờ thêm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Chạy mã nhiều lần, bạn sẽ thấy dữ liệu được thêm vào liên tục.</p>
<p>Trong hệ điều hành Windows, ký tự xuống dòng là <code>\r\n</code>, mã trong mã là:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> filename </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "example.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(filename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Chế độ thêm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> content </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Tom</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\r\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Sử dụng kết hợp dấu xuống dòng và thêm dấu xuống dòng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Trong macOS, ký tự xuống dòng là <code>\n</code>, mã trong mã là:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> filename </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "example.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(filename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Chế độ thêm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> content </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Tom</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Chỉ sử dụng dấu xuống dòng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Nói thêm về ký tự xuống dòng và dấu xuống dòng.</p>
<p>Ký tự xuống dòng (<code>\r</code>) và dấu xuống dòng (<code>\n</code>) là các ký tự điều khiển phổ biến trên máy tính, dùng để chỉ định kết thúc dòng hoặc thực hiện việc xuống dòng. Cách sử dụng chúng có thể khác nhau trong các hệ điều hành và ngôn ngữ lập trình khác nhau.</p>
<p>Trên hệ điều hành Windows, thường sử dụng kết hợp dấu xuống dòng và dấu xuống dòng (<code>\r\n</code>) để kết thúc mỗi dòng. Trong tệp văn bản, mỗi dòng sẽ kết thúc bằng một kết hợp này. Điều này là do các máy in và thiết bị đầu cuối từng sử dụng kết hợp này để kết thúc dòng và thực hiện xuống dòng. Trên Windows, các công cụ chỉnh sửa văn bản và terminal cũng hỗ trợ sử dụng kết hợp dấu xuống dòng và dấu xuống dòng để kết thúc mỗi dòng.</p>
<p>Trong macOS và Linux, thường chỉ sử dụng dấu xuống dòng (<code>\n</code>) để kết thúc mỗi dòng. Trong tệp văn bản, mỗi dòng sẽ chỉ kết thúc bằng một dấu xuống dòng. Điều này là do các thiết bị đầu cuối Unix ban đầu chỉ cần dùng dấu xuống dòng để kết thúc dòng và thực hiện xuống dòng. Trên macOS và Linux, các công cụ chỉnh sửa văn bản và terminal cũng hỗ trợ việc sử dụng dấu xuống dòng để kết thúc mỗi dòng.</p>
<p>Trong các ngôn ngữ lập trình, thường cũng sử dụng dấu xuống dòng và dấu xuống dòng để thực hiện các hoạt động trên chuỗi. Ví dụ, trong Java, dấu xuống dòng có thể được biểu thị bằng "<code>\r</code>", và dấu xuống dòng có thể được biểu thị bằng "<code>\n</code>". Khi sử dụng input stream và xuất để đọc và ghi tệp, cũng cần chú ý đến cách sử dụng dấu xuống dòng và dấu xuống dòng và sự khác biệt giữa các hệ điều hành.</p>
<h3>Byte Input Stream (InputStream)</h3>
<p><code>java.io.InputStream</code> là lớp <strong>cha</strong> của <strong>byte input stream</strong>, chúng ta hãy xem qua một số phương thức chung của nó:</p>
<ol>
<li>
<p><code>close()</code> : Đóng input stream này và giải phóng tài nguyên hệ thống liên quan đến stream này.</p>
</li>
<li>
<p><code>int read()</code> : Đọc byte tiếp theo từ input stream.</p>
</li>
<li>
<p><code>read(byte[] b)</code> : Phương thức này trả về giá trị int biểu thị số byte đã đọc được, trả về số byte đã đọc nếu có, nếu không đọc được gì thì trả về -1.</p>
</li>
</ol>
<h3>Lớp FileInputStream</h3>
<p>InputStream có nhiều lớp con, chúng ta sẽ bắt đầu với lớp con đơn giản nhất là FileInputStream. Tên gợi ý rằng đây là input stream từ file, dùng để đọc dữ liệu từ file.</p>
<h4>1) Các phương thức khởi tạo của FileInputStream</h4>
<ol>
<li>
<p><code>FileInputStream(String name)</code>: Tạo một đối tượng FileInputStream và mở file có tên được chỉ định để đọc. Tên file được chỉ định bởi tham số <code>name</code>. Nếu file không tồn tại, sẽ ném ra ngoại lệ FileNotFoundException.</p>
</li>
<li>
<p><code>FileInputStream(File file)</code>: Tạo một đối tượng FileInputStream và mở file được biểu diễn bởi đối tượng File chỉ định để đọc.</p>
</li>
</ol>
<p>Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileInputStream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc nội dung của file</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) data);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng input stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><h4>2) Đọc dữ liệu byte bằng FileInputStream</h4>
<p>① Đọc byte: Phương thức <code>read()</code> sẽ đọc một byte và trả về giá trị nguyên của byte đó. Nếu đã đọc đến cuối file, sẽ trả về -1. Nếu xảy ra lỗi trong quá trình đọc, sẽ ném ra ngoại lệ IOException.</p>
<p>Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileInputStream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc nội dung của file</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) data);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng input stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>② Đọc bằng mảng byte: Phương thức <code>read(byte[] b)</code> sẽ đọc tối đa <code>b.length</code> byte từ stream và lưu chúng vào mảng đệm <code>b</code>.</p>
<p>Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileInputStream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc nội dung của file vào mảng đệm</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((count </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, count));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng input stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><h4>3) Sao chép ảnh bằng byte stream FileInputStream</h4>
<p>Nguyên lý rất đơn giản, là đọc thông tin ảnh vào byte stream nhập, sau đó dùng byte stream xuất để ghi vào file mới.</p>
<p>Ví dụ mã như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileInputStream để đọc file ảnh gốc</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"original.jpg"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileOutputStream để ghi file ảnh sao chép</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"copy.jpg"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một mảng đệm để lưu trữ dữ liệu được đọc</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc file ảnh gốc và ghi dữ liệu vào file ảnh sao chép</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((count </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, count);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng input stream và output stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Mã trên tạo một FileInputStream để đọc file ảnh gốc và FileOutputStream để ghi dữ liệu vào file ảnh sao chép. Sau đó, sử dụng vòng lặp while để từng bước đọc byte từ file gốc và ghi vào file sao chép. Cuối cùng, đóng cả FileInputStream và FileOutputStream để giải phóng tài nguyên.</p>
<h3>Tóm tắt</h3>
<p>InputStream là lớp trừu tượng của byte input stream, định nghĩa các phương thức để đọc dữ liệu byte như <code>read()</code>, <code>read(byte[] b)</code>, <code>read(byte[] b, int off, int len)</code> và nhiều phương thức khác. OutputStream là lớp trừu tượng của byte output stream, định nghĩa các phương thức để ghi dữ liệu byte như <code>write(int b)</code>, <code>write(byte[] b)</code>, <code>write(byte[] b, int off, int len)</code> và các phương thức khác. Cả hai lớp trừu tượng này là cơ sở của byte stream.</p>
<p>FileInputStream là lớp để đọc dữ liệu byte từ file, kế thừa từ InputStream. FileOutputStream là lớp để ghi dữ liệu byte vào file, kế thừa từ OutputStream. Cả hai lớp này là hai trong những lớp thực hiện phổ biến nhất của byte stream.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630181913.png" type="image/png"/>
    </item>
    <item>
      <title>About Me</title>
      <link>https://vanhung4499.github.io/about-me.html</link>
      <guid>https://vanhung4499.github.io/about-me.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">About Me</source>
      <description>About Me Profile Exploration &amp; geek enthusiast, software engineer, hackintosher | Currently focusing on backend development with main directions in Spring | Discovering a bigger...</description>
      <category>about</category>
      <pubDate>Sun, 12 Mar 2023 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[

<h2>Profile</h2>
<p><em>Exploration &amp; geek enthusiast, software engineer, hackintosher | Currently focusing on backend development with main directions in Spring | Discovering a bigger world together with you.</em></p>
<h2>Skills</h2>
<h3>Languages</h3>
<img src="https://skillicons.dev/icons?i=java,golang,javascript,ts,python,html,css,regex,md,bash&amp;theme=dark&amp;&amp;perline=10" alt="Skills">
<h3>Frameworks</h3>
<img src="https://skillicons.dev/icons?i=spring,nodejs,nestjs,react,nextjs,vue,redux&amp;theme=dark&amp;&amp;perline=10" alt="Skills">
<h3>Databases</h3>
<img src="https://skillicons.dev/icons?i=mysql,redis,mongodb,elasticsearch&amp;theme=dark&amp;&amp;perline=10" alt="Skills">
<h3>Others</h3>
<img src="https://skillicons.dev/icons?i=vim,idea,vscode,aws,figma,gradle,maven,npm,gcp,docker,kubernetes,git,github,gitlab,rabbitmq,kafka,jenkins,linux,postman,linkedin,stackoverflow,svg&amp;theme=dark&amp;&amp;perline=10" alt="Skills">
<h2>Github Summary</h2>
<img src="https://github-trophies.vercel.app/?username=vanhung4499&amp;theme=radical&amp;margin-w=25" alt="Github Summary">
<img src="https://github-readme-stats.vercel.app/api/top-langs/?username=vanhung4499&amp;theme=radical&amp;layout=compact&amp;bg_color=30,ef475d,904e95&amp;title_color=fff&amp;text_color=fff">
<img src="https://github-readme-stats.vercel.app/api?username=vanhung4499&amp;count_private=true&amp;show_icons=true&amp;theme=radical&amp;bg_color=30,ef475d,904e95&amp;title_color=fff&amp;text_color=fff">
<h2>Preview</h2>
<figure><img src="https://count.getloli.com/get/@:vanhung4499?theme=gelbooru-h" alt=":Augenestern-creator" tabindex="0" loading="lazy"><figcaption>:Augenestern-creator</figcaption></figure>
<h2>Activity Graph</h2>
<figure><a href="https://github.com/OrageKK/github-readme-activity-graph" target="_blank" rel="noopener noreferrer"><img src="https://github-readme-activity-graph-sandy.vercel.app/graph?username=vanhung4499&amp;theme=dracula" alt="Ashutosh's github activity graph" tabindex="0" loading="lazy"></a><figcaption>Ashutosh's github activity graph</figcaption></figure>
<h2>About This Site</h2>
<p><a href="/about">About</a></p>
]]></content:encoded>
      <enclosure url="https://count.getloli.com/get/@:vanhung4499?theme=gelbooru-h" type="image/"/>
    </item>
    <item>
      <title>About this site</title>
      <link>https://vanhung4499.github.io/about.html</link>
      <guid>https://vanhung4499.github.io/about.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">About this site</source>
      <description>About this site ✨📒 Record the process of building this site, and share some thoughts and experiences. Introduction My previous wiki was built with Quartz, which is a publish to...</description>
      <category>blog</category>
      <pubDate>Tue, 14 Mar 2023 21:45:45 GMT</pubDate>
      <content:encoded><![CDATA[
<div class="hint-container info">
<p class="hint-container-title">✨📒</p>
<p>Record the process of building this site, and share some thoughts and experiences.</p>
</div>
<h2>Introduction</h2>
<p>My previous wiki was built with <a href="https://quartz.jzhao.xyz/" target="_blank" rel="noopener noreferrer">Quartz</a>, which is a publish tool for obsidian nots. I have been using it for a long time, but I found that it is not very convenient to share and search because of the navigation and the structure of the page. So I need to find a better alternative.</p>
<p>After some searching on github, I found some good-looking wiki/blog sites. I tried some of them then the last choice of me is <a href="https://v2.vuepress.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">VuePress</a>, which is a static site generator based on Vue.js. It is very easy to use and has a lot of plugins and themes. I chose the <a href="https://theme-hope.vuejs.press/zh/" target="_blank" rel="noopener noreferrer">vuepress-theme-hope</a> theme, which is very beautiful and has a lot of features.</p>
<p>And I found a customized of hope theme, which is <a href="https://github.com/OrageKK/oragekk.github.io" target="_blank" rel="noopener noreferrer">https://github.com/OrageKK/oragekk.github.io</a>, It is very beautiful and has a lot of features. So I forked it and made some changes to fit my needs. Thanks to the author for the great work.</p>
<h2>Markdown Enhancement</h2>
<p>The Markdown effect of the hope theme is surprisingly good, and it supports many features that ordinary Markdown does not, such as custom containers, code blocks with tabs, and the most convenient feature of being able to write flowcharts directly. It also allows for optional highlight themes (the code highlighting on this site is based on shikiPlugin, which, although not as lightweight and efficient as the default prismjs, provides more accurate syntax highlighting). For specific effects, see here ☞ <a href="https://theme-hope.vuejs.press/guide/markdown/intro.html" target="_blank" rel="noopener noreferrer">Markdown Enhance</a>.</p>
<h2>Project Structure</h2>
<div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> .github</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> ISSUE_TEMPLATE</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Issue templates</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> bug-report.yml</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> workflows</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">       └──</span><span style="color:#98C379;--shiki-dark:#98C379"> deploy-docs.yml</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Deployment script</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> CNAME</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> LICENSE</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> README.md</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> api</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> proxy.js</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Cross-origin proxy</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> env.d.ts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> package.json</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> pnpm-lock.yaml</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> script</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> requirements.txt</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> submit.py</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # GitHub Actions script for submitting URLs</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> src</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> .vuepress</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> client.ts</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Client configuration file</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> components</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> MyCoverLink.vue</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Friend link component</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> Mylink.vue</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Card component</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> config.ts</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # VuePress configuration file</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> data</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Data</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> navbar</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> plugins</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> vuepress-plugin-canvas</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> vuepress-plugin-gradient-cover</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> vuepress-plugin-hitokoto</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> vuepress-plugin-live2DAssist</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> vuepress-plugin-popper</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> public</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> assets</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Resources</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> sidebar</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> styles</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> theme</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> api</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> bing.ts</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Bing daily wallpaper</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> components</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Custom components</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> index.ts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> layouts</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Custom layouts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> utils</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">       ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> busuanzi.pure.js</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Busuanzi statistics</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">       └──</span><span style="color:#98C379;--shiki-dark:#98C379"> time.ts</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Runtime</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> theme.ts</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Theme configuration file</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> README.md</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> tsconfig.json</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">└──</span><span style="color:#98C379;--shiki-dark:#98C379"> vercel.json</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Vercel configuration file</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Framework Support</h2>
<p><a href="https://v2.vuepress.vuejs.org/" target="_blank" rel="noopener noreferrer">vuepress2.x</a></p>
<h2>Theme Support</h2>
<p><a href="https://theme-hope.vuejs.press/" target="_blank" rel="noopener noreferrer">vuepress-theme-hope</a></p>
<h2>Markdown Editor</h2>
<p>I use <a href="https://obsidian.md/" target="_blank" rel="noopener noreferrer">Obsidian</a> to write markdown files, which is a very powerful markdown editor. It supports many features such as graph view, backlinks, and plugins. I highly recommend it.</p>
<p>To work along with VuePress, you only need create a new vault in <code>src</code> folder, and then you can write markdown files in it.</p>
<div class="hint-container tip">
<p class="hint-container-title">Tips</p>
<p>When you create a new vault, an <code>.obsidian</code> will be created in the <code>src</code> directory, this is Obsidian configs and plugins folder. You can ignore it in the <code>.gitignore</code> file to avoid uploading it to the repository.</p>
</div>
<h2>Customization</h2>
<p>I have customized the original theme as follows. The main customizations are divided into:</p>
<ol>
<li>
<p><strong>Custom Layouts</strong></p>
<ul>
<li><code>NotFound.vue</code></li>
<li><code>Layout.vue</code> (added a donation component)</li>
<li><code>News.vue</code> (layout for news list)</li>
</ul>
</li>
<li>
<p><strong>Custom Components</strong></p>
<ul>
<li><code>BlogHero.vue</code></li>
<li><code>PageFooter.vue</code></li>
<li><code>Sponsor.vue</code> (donation component) // Not used in my site</li>
<li><code>NewsList.vue</code> (news list)</li>
<li><code>NewsItem.vue</code> (news item)</li>
</ul>
</li>
<li>
<p><strong>Local Plugin Development</strong></p>
<ul>
<li><code>vuepress-plugin-canvas</code> (supports two types of dynamic backgrounds: rainbow background and geometric shapes)</li>
<li><code>vuepress-plugin-gradient-cover</code> (background overlay)</li>
<li><code>vuepress-plugin-hitokoto</code> (Hitokoto plugin) // Not used in my site</li>
<li><code>vuepress-plugin-live2DAssist</code> (assistant for Live2D; hides on pages with sidebars to avoid obstruction)</li>
<li><code>vuepress-plugin-popper</code> (mouse effect, based on <a href="https://github.com/moefyit/moefy-canvas" target="_blank" rel="noopener noreferrer">@moefy-canvas/theme-popper</a>)</li>
</ul>
</li>
<li>
<p><strong>External Content References</strong></p>
<ul>
<li><a href="https://github.com/oh-my-live2d/vuepress-plugin-oh-my-live2d" target="_blank" rel="noopener noreferrer">vuepress-plugin-oh-my-live2d</a> (Live2D plugin)</li>
<li>Busuanzi statistics</li>
<li><a href="https://github.com/moefyit/moefy-canvas" target="_blank" rel="noopener noreferrer">@moefy-canvas/theme-popper</a> (original plugin only supported VuePress 1.x, developed a localized plugin to support VuePress 2.x)</li>
<li><a href="https://v2.vuepress.vuejs.org/zh/reference/plugin/google-analytics.html" target="_blank" rel="noopener noreferrer">@vuepress/plugin-google-analytics</a> (supports Google Analytics 4, which replaces the old UA)</li>
</ul>
</li>
<li>
<p><strong>Configuration Content</strong></p>
<ul>
<li>Navbar</li>
<li>Sidebar</li>
<li>Comments using <a href="https://waline.js.org/" target="_blank" rel="noopener noreferrer">Waline</a></li>
<li>Search using <a href="https://plugin-search-pro.vuejs.press/" target="_blank" rel="noopener noreferrer">vuepress-plugin-search-pro</a></li>
<li>Enabled copyright plugin</li>
<li>Feed RSS plugin</li>
<li>Added article type - "News"; added image preview selector for news markdown images</li>
</ul>
</li>
<li>
<p><strong>Miscellaneous</strong></p>
<ul>
<li>Runtime statistics</li>
<li>CSS beautification</li>
<li>Introduced fonts: PinYu Handwriting, XiaXingKai</li>
<li>Added custom emojis for Waline and modified the display style</li>
<li>Personalized log</li>
<li>Automatically push new article URLs to search engines (Baidu, Bing, Google) 👉 <a href="/platform/github/github-action">Detailed Configuration</a></li>
</ul>
</li>
</ol>
<h2>Conclusion</h2>
<blockquote>
<p>This is an ongoing project, with continuous optimization.</p>
<p>Local plugins are available for anyone interested. The source code is open; click the GitHub icon in the top right corner to access it. And don't forget to leave a star! 🌟</p>
</blockquote>
]]></content:encoded>
    </item>
    <item>
      <title>Database</title>
      <link>https://vanhung4499.github.io/database/</link>
      <guid>https://vanhung4499.github.io/database/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Database</source>
      <category>database</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>DevOps</title>
      <link>https://vanhung4499.github.io/devops/</link>
      <guid>https://vanhung4499.github.io/devops/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">DevOps</source>
      <category>devops</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>DSA</title>
      <link>https://vanhung4499.github.io/dsa/</link>
      <guid>https://vanhung4499.github.io/dsa/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">DSA</source>
      <description>Data Structures and Algorithms Info Phần này hướng dẫn làm quen và thực hành với cấu trúc dữ liệu và giải thuật phục vụ cho vòng coding interview. Giải quyết các vấn đề trên Lee...</description>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<div class="hint-container info">
<p class="hint-container-title">Info</p>
<ul>
<li>Phần này hướng dẫn làm quen và thực hành với cấu trúc dữ liệu và giải thuật phục vụ cho vòng coding interview.</li>
<li>Giải quyết các vấn đề trên Leetcode!</li>
<li>Thật sự rất khó để tách biệt Data Structure và Algorithm, nên tôi sẽ viết lồng ghép giữa chúng vào các chủ đề lớn. Vì chúng thật sự là có mối liên hệ chặt chẽ với nhau!</li>
</ul>
</div>
<div class="hint-container info">
<p class="hint-container-title">Info</p>
<p>Python là ngôn ngữ chính mà tôi sử dụng trong phần này vì nó dễ đọc, dễ viết và dễ hiểu.</p>
</div>
<h2>Introduction</h2>
<blockquote>
<p>Giới thiệu về cấu trúc dữ liệu và giải thuật.</p>
</blockquote>
<ul>
<li><a href="./intro/introduction">Introduction to Data Structures and Algorithms</a></li>
<li><a href="/intro/complexity">Algorithm Complexity</a></li>
</ul>
<h2>Data Structures</h2>
<blockquote>
<p>Cấu trúc dữ liệu là cách tổ chức, lưu trữ và quản lý dữ liệu một cách hiệu quả.</p>
</blockquote>
<ul>
<li><a href="/ds/" target="_blank">Data Structures</a></li>
</ul>
<h2>Algorithms</h2>
<blockquote>
<p>Giải thuật là một tập hợp các hướng dẫn để giải quyết một vấn đề.</p>
</blockquote>
<ul>
<li><a href="/algo/" target="_blank">Alogrithms</a></li>
</ul>
<h2>LeetCode</h2>
<blockquote>
<p>Luyện tập giải các bài toán trên LeetCode.</p>
</blockquote>
<ul>
<li><a href="/leetcode/" target="_blank">LeetCode</a></li>
<li><a href="">LeetCode By Categories</a> Todo!</li>
<li><a href="">LeetCode Top 100</a> Todo!</li>
<li><a href="">LeetCode Top 200</a> Todo!</li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Framework</title>
      <link>https://vanhung4499.github.io/framework/</link>
      <guid>https://vanhung4499.github.io/framework/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Framework</source>
      <category>framework</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Interview</title>
      <link>https://vanhung4499.github.io/interview/</link>
      <guid>https://vanhung4499.github.io/interview/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Interview</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Programming</title>
      <link>https://vanhung4499.github.io/programming/</link>
      <guid>https://vanhung4499.github.io/programming/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Programming</source>
      <description>Programming Languages This section contains articles about programming languages.</description>
      <category>programming</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>This section contains articles about programming languages.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Projects</title>
      <link>https://vanhung4499.github.io/project/</link>
      <guid>https://vanhung4499.github.io/project/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Projects</source>
      <description>Projects My projects documentation.</description>
      <category>project</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>My projects documentation.</p>
]]></content:encoded>
    </item>
    <item>
      <title>dir template</title>
      <link>https://vanhung4499.github.io/templates/dir.html</link>
      <guid>https://vanhung4499.github.io/templates/dir.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">dir template</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Post</title>
      <link>https://vanhung4499.github.io/templates/post.html</link>
      <guid>https://vanhung4499.github.io/templates/post.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Post</source>
      <category>any</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Elastic Stack</title>
      <link>https://vanhung4499.github.io/database/elastic/</link>
      <guid>https://vanhung4499.github.io/database/elastic/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elastic Stack</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Filebeat Operation</title>
      <link>https://vanhung4499.github.io/database/elastic/filebeat-operation.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/filebeat-operation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Filebeat Operation</source>
      <description>Vận hành Filebeat Nền tảng Beats kết hợp nhiều trình thu thập dữ liệu đơn nhiệm. Chúng gửi dữ liệu từ hàng trăm, hàng nghìn hoặc hàng triệu máy và hệ thống đến Logstash hoặc Ela...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Nền tảng Beats kết hợp nhiều trình thu thập dữ liệu đơn nhiệm. Chúng gửi dữ liệu từ hàng trăm, hàng nghìn hoặc hàng triệu máy và hệ thống đến Logstash hoặc Elasticsearch.</p>
<p>Vì tôi chỉ tiếp xúc với Filebeat, nên bài viết này chỉ giới thiệu về vận hành của Filebeat.</p>
</blockquote>
<h2>1. Cài đặt Filebeat</h2>
<h3>1.1. Yêu cầu môi trường</h3>
<blockquote>
<p>Phiên bản: Elastic Stack 7.4</p>
</blockquote>
<h3>1.2. Các bước cài đặt</h3>
<p>Đối với hệ thống Unix / Linux, khuyến nghị sử dụng cách cài đặt sau đây vì nó khá phổ biến.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz</span></span>
<span class="line"><span>tar -zxf filebeat-6.1.1-linux-x86_64.tar.gz</span></span></code></pre>
</div><blockquote>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation.html" target="_blank" rel="noopener noreferrer">filebeat-installation</a></p>
</blockquote>
<h2>2. Cấu hình Filebeat</h2>
<blockquote>
<p>Đầu tiên, điều cần biết là: <code>filebeat.yml</code> là tệp cấu hình của Filebeat. Đường dẫn của nó có thể thay đổi tùy theo cách bạn cài đặt.</p>
<p>Tất cả các tệp cấu hình của sản phẩm Beat đều dựa trên định dạng <a href="http://www.yaml.org/" target="_blank" rel="noopener noreferrer">YAML</a>, và FileBeat cũng không ngoại lệ.</p>
<p>Để biết thêm về cấu hình Filebeat, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuring-howto-filebeat.html" target="_blank" rel="noopener noreferrer">Cấu hình Filebeat</a></p>
<p>Để biết thêm về định dạng tệp filebeat.yml, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/libbeat/6.1/config-file-format.html" target="_blank" rel="noopener noreferrer">Định dạng tệp filebeat.yml</a></p>
</blockquote>
<p>Ví dụ về một phần cấu hình filebeat.yml:</p>
<div class="language-yml" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">filebeat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        - </span><span style="color:#98C379;--shiki-dark:#98C379">/var/log/*.log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      multiline</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        pattern</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'^['</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">after</span></span></code></pre>
</div><h3>2.1. Các mục cấu hình quan trọng</h3>
<blockquote>
<p>Dưới đây, tôi sẽ liệt kê các mục cấu hình quan trọng của Filebeat.</p>
<p>Nếu bạn muốn tìm hiểu thêm về thông tin cấu hình, bạn có thể tham khảo:</p>
<p>Để biết thêm về cấu hình Filebeat, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuring-howto-filebeat.html" target="_blank" rel="noopener noreferrer">Cấu hình Filebeat</a></p>
<p>Để biết thêm về định dạng tệp filebeat.yml, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/libbeat/6.1/config-file-format.html" target="_blank" rel="noopener noreferrer">Định dạng tệp filebeat.yml</a></p>
</blockquote>
<h4>2.1.1. filebeat.prospectors</h4>
<p>(Trình theo dõi tệp) được sử dụng để chỉ định các tệp cần quan tâm.</p>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">filebeat.prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    enabled</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      - </span><span style="color:#98C379;--shiki-dark:#98C379">/var/log/*.log</span></span></code></pre>
</div><h4>2.1.2. output.elasticsearch</h4>
<p>Nếu bạn muốn Filebeat trực tiếp xuất dữ liệu đến Elasticsearch, bạn cần cấu hình output.elasticsearch.</p>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">output.elasticsearch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.1.42:9200'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span></code></pre>
</div><h4>2.1.3. output.logstash</h4>
<p>Nếu bạn muốn Filebeat xuất dữ liệu đến Logstash, sau đó Logstash sẽ xuất dữ liệu đến Elasticsearch, bạn cần cấu hình output.logstash.</p>
<blockquote>
<p><strong>Lưu ý</strong></p>
<p>So với việc xuất dữ liệu đến Elasticsearch, tôi khuyên bạn nên xuất dữ liệu đến Logstash.</p>
<p>Bởi vì khi Logstash và Filebeat làm việc cùng nhau, nếu Logstash bận xử lý dữ liệu, nó sẽ thông báo cho FileBeat làm chậm tốc độ đọc. Một khi tình trạng tắc nghẽn được giải quyết, FileBeat sẽ trở lại tốc độ ban đầu và tiếp tục truyền dữ liệu. Như vậy, có thể giảm thiểu tình trạng quá tải của đường truyền.</p>
</blockquote>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">output.logstash</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'127.0.0.1:5044'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span></code></pre>
</div><p>Ngoài ra, bạn cũng cần chỉ định plugin beats input trong tệp cấu hình của Logstash (như logstash.conf):</p>
<div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379">input {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  beats {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    port =&gt; 5044</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Cổng này cần phải giống với cổng trong filebeat.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Phần filter của tệp này được bình luận để chỉ ra rằng nó</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># là tùy chọn.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># filter {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">output {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  elasticsearch {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    hosts =&gt; "localhost:9200"</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    manage_template =&gt; false</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    index =&gt; "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    document_type =&gt; "%{[@metadata][type]}"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>2.1.4. setup.kibana</h4>
<p>Nếu bạn định sử dụng bảng điều khiển Kibana do Filebeat cung cấp, bạn cần cấu hình setup.kibana.</p>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">setup.kibana</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'localhost:5601'</span></span></code></pre>
</div><h4>2.1.5. setup.template.settings</h4>
<p>Trong Elasticsearch, <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/indices-templates.html" target="_blank" rel="noopener noreferrer">mẫu chỉ mục</a> được sử dụng để xác định cài đặt và ánh xạ, để xác định cách phân tích các trường.</p>
<p>Trong Filebeat, setup.template.settings được sử dụng để cấu hình mẫu chỉ mục.</p>
<p>Mẫu chỉ mục được Filebeat khuyên dùng được cài đặt bởi gói phần mềm Filebeat. Nếu bạn chấp nhận cấu hình mặc định trong tệp filebeat.yml, Filebeat sẽ tự động tải mẫu sau khi kết nối thành công với Elasticsearch.</p>
<p>Bạn có thể tắt tải mẫu tự động hoặc tải mẫu của riêng bạn bằng cách cấu hình các tùy chọn tải mẫu trong tệp cấu hình Filebeat. Bạn cũng có thể đặt các tùy chọn để thay đổi tên chỉ mục và mẫu chỉ mục.</p>
<blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-template.html" target="_blank" rel="noopener noreferrer">filebeat-template</a></p>
<p><strong>Ghi chú</strong></p>
<p>Nếu không cần thiết, hãy sử dụng mẫu chỉ mục mặc định trong tệp cấu hình Filebeat.</p>
</blockquote>
<h4>2.1.6. setup.dashboards</h4>
<p>Filebeat đi kèm với các bảng điều khiển Kibana mẫu. Trước khi sử dụng các bảng điều khiển, bạn cần tạo mẫu chỉ mục <code>filebeat-*</code> và tải các bảng điều khiển vào Kibana. Để làm điều này, bạn có thể chạy lệnh <code>setup</code> hoặc cấu hình tải bảng điều khiển trong tệp <code>filebeat.yml</code>.</p>
<p>Để tải các bảng điều khiển Filebeat vào Kibana, bạn cần kích hoạt công tắc trong cấu hình <code>filebeat.yml</code>:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>setup.dashboards.enabled: true</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-dashboards.html" target="_blank" rel="noopener noreferrer">configuration-dashboards</a></p>
</blockquote>
<h2>3. Lệnh Filebeat</h2>
<p>Filebeat cung cấp một loạt các lệnh để hoàn thành nhiều chức năng khác nhau.</p>
<p>Cách thực hiện lệnh:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./filebeat</span><span style="color:#98C379;--shiki-dark:#98C379"> COMMAND</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/command-line-options.html" target="_blank" rel="noopener noreferrer">command-line-options</a></p>
<p><strong>Ghi chú</strong></p>
<p>Theo quan điểm cá nhân, không cần phải nắm vững tất cả các lệnh dòng lệnh, vì hầu hết các chức năng đều có thể hoàn thành thông qua cấu hình. Và việc chỉ định chức năng thông qua dòng lệnh yêu cầu nhập cùng một tham số mỗi lần, không thuận lợi cho việc khởi động cố định.</p>
<p>Đương nhiên, lệnh khởi động quan trọng nhất là run.</p>
<p><strong>Ví dụ</strong> Khởi động bằng cách chỉ định tệp cấu hình</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./filebeat</span><span style="color:#98C379;--shiki-dark:#98C379"> run</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -e</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -c</span><span style="color:#98C379;--shiki-dark:#98C379"> filebeat.yml</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -d</span><span style="color:#98C379;--shiki-dark:#98C379"> "publish"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./filebeat</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -e</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -c</span><span style="color:#98C379;--shiki-dark:#98C379"> filebeat.yml</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -d</span><span style="color:#98C379;--shiki-dark:#98C379"> "publish"</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # run có thể bỏ qua</span></span></code></pre>
</div></blockquote>
<h2>4. Module Filebeat</h2>
<blockquote>
<p><a href="https://www.elastic.co/cn/products/beats/filebeat" target="_blank" rel="noopener noreferrer">Filebeat</a> và <a href="https://www.elastic.co/cn/products/beats/metricbeat" target="_blank" rel="noopener noreferrer">Metricbeat</a> tích hợp một loạt các module để đơn giản hóa quá trình thu thập, phân tích và hiển thị các định dạng nhật ký thông thường (như NGINX, Apache hoặc các chỉ số hệ thống như Redis hoặc Docker).</p>
</blockquote>
<ul>
<li>Cấu hình elasticsearch và kibana</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>output.elasticsearch:</span></span>
<span class="line"><span>  hosts: ["myEShost:9200"]</span></span>
<span class="line"><span>  username: "elastic"</span></span>
<span class="line"><span>  password: "elastic"</span></span>
<span class="line"><span>setup.kibana:</span></span>
<span class="line"><span>  host: "mykibanahost:5601"</span></span>
<span class="line"><span>  username: "elastic"</span></span>
<span class="line"><span>  password: "elastic</span></span></code></pre>
</div><blockquote>
<p>username và password là tùy chọn, nếu không cần xác thực thì không cần điền.</p>
</blockquote>
<ul>
<li>Khởi tạo môi trường</li>
</ul>
<p>Chạy lệnh dưới đây, filebeat sẽ tải mẫu chỉ mục được khuyến nghị.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>./filebeat setup -e</span></span></code></pre>
</div><ul>
<li>Chỉ định module</li>
</ul>
<p>Chạy lệnh dưới đây để chỉ định các module bạn muốn tải.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>./filebeat -e --modules system,nginx,mysql</span></span></code></pre>
</div><blockquote>
<p>Để biết thêm thông tin, bạn có thể tham khảo:</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-modules.html" target="_blank" rel="noopener noreferrer">Cấu hình module filebeat</a></li>
<li><a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules.html" target="_blank" rel="noopener noreferrer">Module hỗ trợ filebeat</a></li>
</ul>
</blockquote>
<h2>5. Tài liệu tham khảo</h2>
<ul>
<li><a href="https://www.elastic.co/cn/products/beats" target="_blank" rel="noopener noreferrer">Trang chủ Beats</a></li>
<li><a href="https://github.com/elastic/beats" target="_blank" rel="noopener noreferrer">Beats Github</a></li>
<li><a href="https://www.elastic.co/guide/en/beats/libbeat/current/index.html" target="_blank" rel="noopener noreferrer">Tài liệu chính thức Beats</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Filebeat</title>
      <link>https://vanhung4499.github.io/database/elastic/filebeat.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/filebeat.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Filebeat</source>
      <description>Elastic Stack và Filebeat Giới thiệu Beats là các đại lý truyền dữ liệu được cài đặt trên máy chủ. Beats có thể truyền dữ liệu trực tiếp đến Elasticsearch hoặc đến Logstash. img...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giới thiệu</h2>
<p>Beats là các đại lý truyền dữ liệu được cài đặt trên máy chủ.</p>
<p>Beats có thể truyền dữ liệu trực tiếp đến Elasticsearch hoặc đến Logstash.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/beats-platform.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Beats có nhiều loại, bạn có thể chọn loại phù hợp với nhu cầu thực tế của bạn.</p>
<p>Các loại phổ biến bao gồm:</p>
<ul>
<li><strong>Packetbeat:</strong>&nbsp;Trình phân tích gói dữ liệu mạng, cung cấp thông tin về các giao dịch được trao đổi giữa các máy chủ ứng dụng của bạn.</li>
<li><strong>Filebeat:</strong>&nbsp;Gửi các tệp nhật ký từ máy chủ của bạn.</li>
<li><strong>Metricbeat:</strong>&nbsp;Là một đại lý giám sát máy chủ, thu thập định kỳ các chỉ số từ hệ điều hành và dịch vụ đang chạy trên máy chủ.</li>
<li><strong>Winlogbeat:</strong>&nbsp;Cung cấp nhật ký sự kiện Windows.</li>
</ul>
<blockquote>
<p><strong>Tham khảo</strong></p>
<p>Các loại Beats khác có thể tham khảo tại:&nbsp;<a href="https://www.elastic.co/guide/en/beats/libbeat/current/community-beats.html" target="_blank" rel="noopener noreferrer">community-beats</a></p>
<p><strong>Chú ý</strong></p>
<p>Vì tôi chỉ sử dụng FileBeat trong công việc, nên nội dung sau chỉ giới thiệu về FileBeat.</p>
</blockquote>
<h3>FileBeat có tác dụng gì?</h3>
<p>So với Logstash, FileBeat nhẹ nhàng hơn.</p>
<p>Trong bất kỳ môi trường nào, ứng dụng đều có khả năng bị tắt. Filebeat đọc và chuyển tiếp các dòng nhật ký, nếu bị gián đoạn, nó sẽ nhớ tất cả các sự kiện ở vị trí khi trạng thái trực tuyến được khôi phục.</p>
<p>Filebeat có các mô-đun nội bộ (auditd, Apache, Nginx, System và MySQL) để đơn giản hóa việc thu thập, phân tích và trực quan hóa định dạng nhật ký phổ biến.</p>
<p>FileBeat không làm quá tải ống dẫn của bạn. Nếu FileBeat truyền dữ liệu đến Logstash, khi Logstash bận xử lý dữ liệu, nó sẽ thông báo cho FileBeat làm chậm tốc độ đọc. Khi tình trạng tắc nghẽn được giải quyết, FileBeat sẽ trở lại tốc độ ban đầu và tiếp tục truyền dữ liệu.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/filebeat.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h2>Cài đặt</h2>
<p>Đối với hệ thống Unix / Linux, bạn nên cài đặt theo cách sau vì nó khá phổ biến.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">wget</span><span style="color:#98C379;--shiki-dark:#98C379"> https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">tar</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -zxf</span><span style="color:#98C379;--shiki-dark:#98C379"> filebeat-6.1.1-linux-x86_64.tar.gz</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo:&nbsp;<a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation.html" target="_blank" rel="noopener noreferrer">filebeat-installation</a></p>
</blockquote>
<h2>Cấu hình</h2>
<h3>Tệp cấu hình</h3>
<p>Đầu tiên, điều cần biết là: <code>filebeat.yml</code> là tệp cấu hình của Filebeat. Đường dẫn của tệp cấu hình có thể thay đổi tùy thuộc vào cách bạn cài đặt.</p>
<p>Tất cả các sản phẩm trong loạt Beat đều dựa trên định dạng cấu hình <a href="http://www.yaml.org/" target="_blank" rel="noopener noreferrer">YAML</a>, và FileBeat cũng không phải là ngoại lệ.</p>
<p>Ví dụ về một phần cấu hình filebeat.yml:</p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">filebeat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        - </span><span style="color:#98C379;--shiki-dark:#98C379">/var/log/*.log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      multiline</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        pattern</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'^['</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">after</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm về cấu hình Filebeat, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuring-howto-filebeat.html" target="_blank" rel="noopener noreferrer">Cấu hình Filebeat</a></p>
<p>Để biết thêm về định dạng tệp filebeat.yml, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/libbeat/6.1/config-file-format.html" target="_blank" rel="noopener noreferrer">Định dạng tệp filebeat.yml</a></p>
</blockquote>
<h3>Các mục cấu hình quan trọng</h3>
<h4>filebeat.prospectors</h4>
<p>(Trình theo dõi tệp) được sử dụng để chỉ định các tệp cần quan tâm.</p>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">filebeat.prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    enabled</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      - </span><span style="color:#98C379;--shiki-dark:#98C379">/var/log/*.log</span></span></code></pre>
</div><h4>output.elasticsearch</h4>
<p>Nếu bạn muốn Filebeat trực tiếp xuất dữ liệu đến Elasticsearch, bạn cần cấu hình output.elasticsearch.</p>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">output.elasticsearch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.1.42:9200'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span></code></pre>
</div><h4>output.logstash</h4>
<p>Nếu bạn muốn Filebeat xuất dữ liệu đến Logstash, sau đó Logstash sẽ xuất dữ liệu đến Elasticsearch, bạn cần cấu hình output.logstash.</p>
<blockquote>
<p><strong>Lưu ý</strong></p>
<p>So với xuất dữ liệu đến Elasticsearch, tôi khuyên bạn nên xuất dữ liệu đến Logstash.</p>
<p>Bởi vì khi Logstash và Filebeat làm việc cùng nhau, nếu Logstash bận xử lý dữ liệu, nó sẽ thông báo cho FileBeat làm chậm tốc độ đọc. Một khi tình trạng tắc nghẽn được giải quyết, FileBeat sẽ trở lại tốc độ ban đầu và tiếp tục truyền dữ liệu. Như vậy, có thể giảm bớt tình trạng quá tải ống dẫn.</p>
</blockquote>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">output.logstash</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'127.0.0.1:5044'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span></code></pre>
</div><p>Ngoài ra, bạn cũng cần chỉ định plugin đầu vào beats trong tệp cấu hình Logstash (như logstash.conf):</p>
<div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379">input {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  beats {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    port =&gt; 5044</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Cổng này cần phải giống với cổng trong filebeat.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Phần filter của tệp này được bình luận để chỉ ra rằng nó là</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># tùy chọn.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># filter {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">output {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  elasticsearch {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    hosts =&gt; "localhost:9200"</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    manage_template =&gt; false</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    index =&gt; "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    document_type =&gt; "%{[@metadata][type]}"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>setup.kibana</h4>
<p>Nếu bạn dự định sử dụng bảng điều khiển Kibana do Filebeat cung cấp, bạn cần cấu hình setup.kibana.</p>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">setup.kibana</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'localhost:5601'</span></span></code></pre>
</div><h4>setup.template.settings</h4>
<p>Trong Elasticsearch, <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/indices-templates.html" target="_blank" rel="noopener noreferrer">mẫu chỉ mục</a> được sử dụng để định nghĩa cài đặt và ánh xạ, để xác định cách phân tích các trường.</p>
<p>Trong Filebeat, setup.template.settings được sử dụng để cấu hình mẫu chỉ mục.</p>
<p>Filebeat gợi ý mẫu chỉ mục được cài đặt bởi gói phần mềm Filebeat. Nếu bạn chấp nhận cấu hình mặc định trong tệp cấu hình filebeat.yml, Filebeat tự động tải mẫu sau khi kết nối thành công với Elasticsearch.</p>
<p>Bạn có thể vô hiệu hóa tải mẫu tự động hoặc tải mẫu của riêng bạn bằng cách cấu hình các tùy chọn tải mẫu trong tệp cấu hình Filebeat. Bạn cũng có thể đặt tùy chọn để thay đổi tên chỉ mục và mẫu chỉ mục.</p>
<blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-template.html" target="_blank" rel="noopener noreferrer">filebeat-template</a></p>
<p><strong>Chú ý</strong></p>
<p>Nếu không cần thiết, hãy sử dụng mẫu chỉ mục mặc định trong tệp cấu hình Filebeat.</p>
</blockquote>
<h4>setup.dashboards</h4>
<p>Filebeat đi kèm với các bảng điều khiển Kibana mẫu. Trước khi sử dụng bảng điều khiển, bạn cần tạo mẫu chỉ mục <code>filebeat-*</code> và tải bảng điều khiển vào Kibana. Để làm điều này, bạn có thể chạy lệnh <code>setup</code> hoặc cấu hình tải bảng điều khiển trong tệp <code>filebeat.yml</code>.</p>
<p>Để tải bảng điều khiển Filebeat vào Kibana, bạn cần bật chức năng trong cấu hình <code>filebeat.yml</code>:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>setup.dashboards.enabled: true</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-dashboards.html" target="_blank" rel="noopener noreferrer">configuration-dashboards</a></p>
</blockquote>
<h2>Lệnh</h2>
<p>Filebeat cung cấp một loạt các lệnh để hoàn thành nhiều chức năng.</p>
<p>Cách thực hiện lệnh:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./filebeat</span><span style="color:#98C379;--shiki-dark:#98C379"> COMMAND</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/command-line-options.html" target="_blank" rel="noopener noreferrer">command-line-options</a></p>
<p><strong>Chú ý</strong></p>
<p>Theo quan điểm cá nhân, không cần phải nắm bắt tất cả các lệnh, bởi vì hầu hết các chức năng đều có thể được hoàn thành thông qua cấu hình. Hơn nữa, việc chỉ định chức năng thông qua dòng lệnh đòi hỏi phải nhập cùng một tham số mỗi lần, điều này không thuận lợi cho việc khởi động cố định.</p>
<p>Quan trọng nhất, tất nhiên, là lệnh khởi động run.</p>
<p><strong>Ví dụ</strong> Khởi động bằng cách chỉ định tệp cấu hình</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./filebeat</span><span style="color:#98C379;--shiki-dark:#98C379"> run</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -e</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -c</span><span style="color:#98C379;--shiki-dark:#98C379"> filebeat.yml</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -d</span><span style="color:#98C379;--shiki-dark:#98C379"> "publish"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./filebeat</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -e</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -c</span><span style="color:#98C379;--shiki-dark:#98C379"> filebeat.yml</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -d</span><span style="color:#98C379;--shiki-dark:#98C379"> "publish"</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # run có thể bỏ qua</span></span></code></pre>
</div></blockquote>
<h2>Module</h2>
<p>Filebeat cung cấp một bộ module được xây dựng sẵn, cho phép bạn triển khai giải pháp giám sát log nhanh chóng và đi kèm với các bảng điều khiển mẫu và trực quan hóa dữ liệu. Những module này hỗ trợ các định dạng log phổ biến như Nginx, Apache2 và MySQL, v.v.</p>
<h3>Các bước để chạy module</h3>
<ul>
<li>Cấu hình elasticsearch và kibana</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>output.elasticsearch:</span></span>
<span class="line"><span>  hosts: ["myEShost:9200"]</span></span>
<span class="line"><span>  username: "elastic"</span></span>
<span class="line"><span>  password: "elastic"</span></span>
<span class="line"><span>setup.kibana:</span></span>
<span class="line"><span>  host: "mykibanahost:5601"</span></span>
<span class="line"><span>  username: "elastic"</span></span>
<span class="line"><span>  password: "elastic</span></span></code></pre>
</div><blockquote>
<p>username và password là tùy chọn, nếu không cần xác thực thì không cần điền.</p>
</blockquote>
<ul>
<li>Khởi tạo môi trường</li>
</ul>
<p>Chạy lệnh dưới đây, Filebeat sẽ tải mẫu chỉ mục được gợi ý.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>./filebeat setup -e</span></span></code></pre>
</div><ul>
<li>Chỉ định module</li>
</ul>
<p>Chạy lệnh dưới đây, chỉ định module bạn muốn tải.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>./filebeat -e --modules system,nginx,mysql</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-modules.html" target="_blank" rel="noopener noreferrer">Cấu hình module Filebeat</a> | <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules.html" target="_blank" rel="noopener noreferrer">Module được hỗ trợ bởi Filebeat</a></p>
</blockquote>
<h2>Nguyên lý</h2>
<p>Filebeat có hai thành phần chính:</p>
<p>harvester: chịu trách nhiệm đọc nội dung của một tệp. Nó sẽ đọc từng dòng nội dung của tệp và gửi nội dung đến đích xuất.</p>
<p>prospector: chịu trách nhiệm quản lý harvester và tìm tất cả các nguồn tệp cần đọc. Ví dụ, nếu kiểu là log, prospector sẽ duyệt qua tất cả các tệp phù hợp với yêu cầu trong đường dẫn đã chỉ định.</p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">filebeat.prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      - </span><span style="color:#98C379;--shiki-dark:#98C379">/var/log/*.log</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      - </span><span style="color:#98C379;--shiki-dark:#98C379">/var/path2/*.log</span></span></code></pre>
</div><p>Filebeat giữ trạng thái của mỗi tệp và thường xuyên làm mới trạng thái đĩa trong tệp đăng ký. Trạng thái được sử dụng để nhớ vị trí cuối cùng mà harvester đang đọc và đảm bảo tất cả các dòng log được gửi đi.</p>
<p>Filebeat lưu trạng thái gửi của mỗi sự kiện trong tệp đăng ký. Vì vậy, nó có thể đảm bảo rằng sự kiện được gửi ít nhất một lần đến đầu ra được cấu hình, không có dữ liệu bị mất.</p>
<h2>Tài liệu</h2>
<p><a href="https://www.elastic.co/guide/en/beats/libbeat/current/index.html" target="_blank" rel="noopener noreferrer">Tài liệu chính thức của Beats</a></p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/beats-platform.png" type="image/png"/>
    </item>
    <item>
      <title>Elastic Stack Kabina</title>
      <link>https://vanhung4499.github.io/database/elastic/kabina.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/kabina.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elastic Stack Kabina</source>
      <description>Elastic Stack: Kibana Discover Bằng cách nhấp vào Discover trong thanh điều hướng bên, bạn có thể xem chức năng truy vấn dữ liệu của Kibana. imgimg Trong thanh tìm kiếm, bạn có ...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Discover</h2>
<p>Bằng cách nhấp vào&nbsp;<code>Discover</code>&nbsp;trong thanh điều hướng bên, bạn có thể xem chức năng truy vấn dữ liệu của&nbsp;<code>Kibana</code>.</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/current/images/tutorial-discover.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Trong thanh tìm kiếm, bạn có thể nhập điều kiện truy vấn Elasticsearch để tìm kiếm dữ liệu của mình. Bạn có thể duyệt kết quả trên trang&nbsp;<code>Discover</code>&nbsp;và tạo các biểu đồ trực quan từ các tìm kiếm đã lưu trên trang&nbsp;<code>Visualize</code>.</p>
<p>Mô hình chỉ mục hiện tại được hiển thị dưới thanh truy vấn. Mô hình chỉ mục xác định chỉ mục nào được tìm kiếm khi gửi truy vấn. Để tìm kiếm một tập hợp chỉ mục khác nhau, chọn một mô hình khác từ menu thả xuống. Để thêm mô hình chỉ mục (index pattern), hãy chuyển đến&nbsp;<code>Management/Kibana/Index Patterns</code>&nbsp;và nhấp vào&nbsp;<code>Add New</code>.</p>
<p>Bạn có thể xây dựng tìm kiếm bằng cách sử dụng tên trường và giá trị bạn quan tâm. Đối với các trường số, bạn có thể sử dụng các toán tử so sánh như lớn hơn (&gt;), nhỏ hơn (&lt;) hoặc bằng (=). Bạn có thể liên kết các phần tử với các toán tử logic&nbsp;<code>AND</code>,&nbsp;<code>OR</code>&nbsp;và&nbsp;<code>NOT</code>, tất cả đều viết hoa.</p>
<p>Mặc định, mỗi tài liệu khớp sẽ hiển thị tất cả các trường. Để chọn các trường tài liệu để hiển thị, di chuyển chuột qua danh sách "Available fields", sau đó nhấp vào nút thêm bên cạnh mỗi trường bạn muốn bao gồm. Ví dụ, nếu chỉ thêm account_number, hiển thị sẽ thay đổi thành danh sách đơn giản bao gồm năm số tài khoản:</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-discover-3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h3>Ngữ pháp truy vấn</h3>
<p>Thanh tìm kiếm của Kibana tuân thủ ngữ pháp truy vấn được mô tả trong tài liệu&nbsp;<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html#query-string-syntax" target="_blank" rel="noopener noreferrer">query-string-syntax</a>.</p>
<p>Dưới đây là một số ngữ pháp truy vấn cơ bản.</p>
<p>Chuỗi truy vấn sẽ được phân tích thành một loạt các thuật ngữ và toán tử. Một thuật ngữ có thể là một từ (như: quick, brown) hoặc một cụm từ được bao quanh bởi dấu ngoặc kép (như "quick brown").</p>
<p>Các hoạt động truy vấn cho phép bạn tùy chỉnh tìm kiếm - dưới đây là các tùy chọn có sẵn.</p>
<h4>Tên trường</h4>
<p>Như đã nói trong truy vấn chuỗi, sẽ tìm kiếm <code>default_field</code> trong điều kiện tìm kiếm, nhưng bạn cũng có thể chỉ định các trường khác trong cú pháp truy vấn:</p>
<p>Ví dụ:</p>
<ul>
<li>Tìm kiếm từ khóa <code>active</code> trong trường <code>status</code></li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>status:active</span></span></code></pre>
</div><ul>
<li>Trường <code>title</code> chứa từ khóa <code>quick</code> hoặc <code>brown</code>. Nếu bạn bỏ qua toán tử <code>OR</code>, toán tử mặc định sẽ được sử dụng</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>title:(quick OR brown)</span></span>
<span class="line"><span>title:(quick brown)</span></span></code></pre>
</div><ul>
<li>Trường tác giả tìm cụm từ chính xác "John Smith", tức là tìm kiếm chính xác.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>author:"John Smith"</span></span></code></pre>
</div><ul>
<li>Bất kỳ trường nào <code>book.title</code>, <code>book.content</code> hoặc <code>book.date</code> đều chứa <code>quick</code> hoặc <code>brown</code> (lưu ý làm thế nào chúng tôi sử dụng <code>\*</code> để biểu thị ký tự đại diện)</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>book.\*:(quick brown)</span></span></code></pre>
</div><ul>
<li>Trường tiêu đề chứa bất kỳ giá trị không null nào</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>_exists_:title</span></span></code></pre>
</div><h4>Ký tự đại diện</h4>
<p>ELK cung cấp hai ký tự đại diện là ? và *.</p>
<ul>
<li><code>?</code> biểu thị bất kỳ ký tự đơn nào;</li>
<li><code>*</code> biểu thị bất kỳ không hoặc nhiều ký tự.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>qu?ck bro*</span></span></code></pre>
</div><blockquote>
<p><strong>Chú ý: Truy vấn ký tự đại diện sẽ sử dụng rất nhiều bộ nhớ và hiệu suất thực thi không tốt, vì vậy hãy sử dụng cẩn thận.</strong> &gt; <strong>Gợi ý</strong>: Ký tự đại diện tinh khiết <code>*</code> được viết vào truy vấn <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="noopener noreferrer">exists</a>, điều này đã cải thiện hiệu suất truy vấn. Do đó, ký tự đại diện <code>field：*</code> sẽ khớp với tài liệu chứa giá trị trống, như: <code>{“field”：“”}</code>, nhưng nếu trường bị mất hoặc giá trị được đặt thành null thì sẽ không khớp, như: <code>“field”：null}</code> &gt; <strong>Gợi ý</strong>: Sử dụng ký tự đại diện ở đầu một từ (ví dụ: <code>*ing</code>) tạo ra một lượng truy vấn rất lớn, vì tất cả các thuật ngữ trong chỉ mục đều cần được kiểm tra, chỉ trong trường hợp nó khớp. Bạn có thể vô hiệu hóa điều này bằng cách đặt <code>allow_leading_wildcard</code> thành <code>false</code>.</p>
</blockquote>
<h4>Biểu thức chính quy</h4>
<p>Bạn có thể sử dụng biểu thức chính quy trong chuỗi truy vấn bằng cách đặt chúng vào <code>/</code>.</p>
<p>Ví dụ:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>name:/joh?n(ath[oa]n)/</span></span></code></pre>
</div><p>Cú pháp biểu thức chính quy được hỗ trợ có thể được tham khảo tại: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html#regexp-syntax" target="_blank" rel="noopener noreferrer">Regular expression syntax</a></p>
<h4>Truy vấn mờ</h4>
<p>Chúng ta có thể sử dụng toán tử <code>~</code> để thực hiện truy vấn mờ.</p>
<p>Ví dụ:</p>
<p>Giả sử chúng ta thực sự muốn truy vấn</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quick brown forks</span></span></code></pre>
</div><p>Nhưng, do lỗi đánh máy, từ khóa truy vấn của chúng ta trở thành như sau, chúng ta vẫn có thể tìm thấy kết quả mong muốn.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quikc\~ brwn\~ foks\~</span></span></code></pre>
</div><p>Truy vấn mờ này sử dụng khoảng cách Damerau-Levenshtein để tìm tất cả các mục khớp với tối đa hai thay đổi. Các thay đổi được đề cập ở đây là việc chèn, xóa hoặc thay thế một ký tự duy nhất, hoặc hoán đổi hai ký tự liền kề.</p>
<p>Khoảng cách chỉnh sửa mặc định là <code>2</code>, nhưng khoảng cách chỉnh sửa <code>1</code> nên đủ để bắt được 80% lỗi đánh máy của con người. Nó có thể được chỉ định như:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quikc\~1</span></span></code></pre>
</div><h4>Tìm kiếm xấp xỉ</h4>
<p>Mặc dù truy vấn cụm từ (ví dụ, <code>john smith</code>) mong đợi tất cả các từ đều theo đúng thứ tự, nhưng tìm kiếm xấp xỉ cho phép các từ được chỉ định ở xa hơn hoặc được sắp xếp theo thứ tự khác nhau. Giống như truy vấn mờ có thể chỉ định khoảng cách chỉnh sửa tối đa cho các ký tự trong một từ, tìm kiếm xấp xỉ cũng cho phép chúng ta chỉ định khoảng cách chỉnh sửa tối đa cho các từ trong một cụm từ:</p>
<p>Ví dụ</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>"fox quick"\~5</span></span></code></pre>
</div><p>Văn bản trong trường càng gần với thứ tự gốc được chỉ định trong chuỗi truy vấn, tài liệu đó càng được coi là liên quan. Khi so sánh với truy vấn mẫu ở trên, cụm từ <code>"quick fox"</code> sẽ được coi là gần với điều kiện truy vấn hơn so với <code>"quick brown fox"</code>.</p>
<h4>Phạm vi</h4>
<p>Bạn có thể chỉ định phạm vi cho các trường ngày, số hoặc chuỗi. Phạm vi khoảng đóng được chỉ định bằng dấu ngoặc vuông <code>[min TO max]</code> và phạm vi khoảng mở được chỉ định bằng dấu ngoặc nhọn <code>{min TO max}</code>.</p>
<p>Hãy xem một số ví dụ.</p>
<ul>
<li>Tất cả các ngày trong năm 2012</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>date:[2012-01-01 TO 2012-12-31]</span></span></code></pre>
</div><ul>
<li>Số từ 1 đến 5</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>count:[1 TO 5]</span></span></code></pre>
</div><ul>
<li>Nhãn giữa <code>alpha</code> và <code>omega</code>, không bao gồm <code>alpha</code> và <code>omega</code></li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>tag:{alpha TO omega}</span></span></code></pre>
</div><ul>
<li>Số lớn hơn 10</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>count:[10 TO *]</span></span></code></pre>
</div><ul>
<li>Tất cả các ngày trước năm 2012</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>date:{* TO 2012-01-01}</span></span></code></pre>
</div><p>Ngoài ra, bạn cũng có thể kết hợp khoảng mở và khoảng đóng</p>
<ul>
<li>Số từ 1 đến 5, nhưng không bao gồm 5</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>count:[1 TO 5}</span></span></code></pre>
</div><p>Phạm vi không giới hạn ở một bên cũng có thể sử dụng cú pháp sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>age:&gt;10</span></span>
<span class="line"><span>age:&gt;=10</span></span>
<span class="line"><span>age:&lt;10</span></span>
<span class="line"><span>age:&lt;=10</span></span></code></pre>
</div><p>Tất nhiên, bạn cũng có thể sử dụng toán tử AND để nhận được giao của hai kết quả truy vấn</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>age:(&gt;=10 AND &lt;20)</span></span>
<span class="line"><span>age:(+&gt;=10 +&lt;20)</span></span></code></pre>
</div><h4>Boosting</h4>
<p>Sử dụng toán tử <code>^</code> để làm cho một thuật ngữ trở nên quan trọng hơn một thuật ngữ khác. Ví dụ, nếu chúng ta muốn tìm tất cả các tài liệu liên quan đến cáo, nhưng chúng ta đặc biệt quan tâm đến từ "nhanh":</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quick^2 fox</span></span></code></pre>
</div><p>Giá trị tăng cường mặc định là 1, nhưng có thể là bất kỳ số dương nào. Tăng cường giữa 0 và 1 giảm độ liên quan.</p>
<p>Tăng cường cũng có thể được áp dụng cho cụm từ hoặc nhóm:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>"john smith"^2   (foo bar)^4</span></span></code></pre>
</div><h4>Thao tác Boolean</h4>
<p>Theo mặc định, tất cả các từ đều tùy chọn miễn là có một từ phù hợp. Tìm kiếm <code>foo bar baz</code> sẽ tìm kiếm bất kỳ tài liệu nào chứa một hoặc nhiều từ <code>foo</code> hoặc <code>bar</code> hoặc <code>baz</code>. Chúng tôi đã thảo luận về <code>default_operator</code> ở trên, cho phép bạn yêu cầu tất cả các mục, nhưng cũng có các toán tử Boolean có thể được sử dụng trong chuỗi truy vấn để cung cấp nhiều kiểm soát hơn.</p>
<p>Toán tử ưa thích là <code>+</code> (thuật ngữ này phải tồn tại) và <code>-</code> (thuật ngữ này không được tồn tại). Tất cả các thuật ngữ khác là tùy chọn. Ví dụ, truy vấn này:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quick brown +fox -news</span></span></code></pre>
</div><p>Truy vấn này có nghĩa là:</p>
<ul>
<li>fox phải tồn tại</li>
<li>news không được tồn tại</li>
<li>quick và brown là tùy chọn</li>
</ul>
<p>Các toán tử quen thuộc <code>AND</code>, <code>OR</code> và <code>NOT</code> (cũng được viết là <code>&amp;&amp;</code>, <code>||</code> và <code>!</code>) cũng được hỗ trợ. Tuy nhiên, các toán tử này có mức độ ưu tiên: <code>NOT</code> ưu tiên hơn <code>AND</code>, <code>AND</code> ưu tiên hơn <code>OR</code>. Mặc dù <code>+</code> và <code>-</code> chỉ ảnh hưởng đến thuật ngữ ở bên phải của toán tử, nhưng <code>AND</code> và <code>OR</code> sẽ ảnh hưởng đến thuật ngữ ở cả hai bên.</p>
<h4>Nhóm</h4>
<p>Nhiều thuật ngữ hoặc mệnh đề có thể được kết hợp bằng cặp dấu ngoặc để tạo ra một truy vấn con</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>(quick OR brown) AND fox</span></span></code></pre>
</div><p>Bạn có thể sử dụng nhóm để định vị các trường cụ thể, hoặc để tăng cường kết quả của truy vấn con:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>status:(active OR pending) title:(full text search)^2</span></span></code></pre>
</div><h4>Từ dự trữ</h4>
<p>Nếu bạn cần sử dụng bất kỳ ký tự nào trong truy vấn của mình như một toán tử (thay vì là một toán tử), thì bạn nên sử dụng một dấu gạch chéo ngược để thoát khỏi chúng. Ví dụ, để tìm kiếm (1 + 1) = 2, bạn cần viết truy vấn là <code>\(1\+1\)\=2</code></p>
<p>Các ký tự dự trữ là: <code>+ - = &amp;&amp; || &gt; &lt; ! ( ) { } [ ] ^ " ~ * ? : \ /</code></p>
<p>Không thể thoát đúng các ký tự đặc biệt này có thể dẫn đến lỗi cú pháp, ngăn chặn truy vấn của bạn.</p>
<h4>Truy vấn rỗng</h4>
<p>Nếu chuỗi truy vấn trống hoặc chỉ chứa khoảng trắng, truy vấn sẽ tạo ra một tập kết quả trống.</p>
<h2>Visualize</h2>
<p>Để hiển thị dữ liệu của bạn dưới dạng trực quan, hãy nhấp vào <code>Visualize</code> trong thanh điều hướng bên.</p>
<p>Công cụ Visualize cho phép bạn xem dữ liệu theo nhiều cách khác nhau như biểu đồ tròn, biểu đồ cột, đồ thị đường, biểu đồ phân phối, v.v. Để bắt đầu, hãy nhấp vào <code>Create a visualization</code> màu xanh hoặc nút <code>+</code>.</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png" alt="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png" tabindex="0" loading="lazy"><figcaption><a href="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png</a></figcaption></figure>
<p>Có nhiều loại trực quan hóa để lựa chọn.</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png" alt="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png" tabindex="0" loading="lazy"><figcaption><a href="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png</a></figcaption></figure>
<p>Dưới đây là một số ví dụ về việc tạo biểu đồ:</p>
<h3>Pie</h3>
<p>Bạn có thể xây dựng biểu đồ trực quan từ tìm kiếm đã lưu hoặc nhập điều kiện tìm kiếm mới. Để nhập điều kiện tìm kiếm mới, trước tiên cần chọn một mô hình chỉ mục để xác định chỉ mục cần tìm kiếm.</p>
<p>Mặc định, tìm kiếm khớp với tất cả các tài liệu. Ban đầu, một "phần" chứa toàn bộ biểu đồ tròn:</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png" alt="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png" tabindex="0" loading="lazy"><figcaption><a href="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png</a></figcaption></figure>
<p>Để chỉ định dữ liệu nào được hiển thị trong biểu đồ, hãy sử dụng việc tổ chức chứa của Elasticsearch. Tổ chức chứa chỉ đơn giản là phân loại các tài liệu khớp với điều kiện tìm kiếm của bạn và được gọi là nhóm.</p>
<p>Xác định một tổ chức chứa cho mỗi phạm vi:</p>
<ol>
<li>Nhấp vào <code>Split Slices</code>.</li>
<li>Chọn <code>Terms</code> trong danh sách <code>Aggregation</code>. Lưu ý: Ở đây, "Terms" là trường hoặc nhãn đã được định nghĩa khi thu thập dữ liệu Elk.</li>
<li>Chọn <code>level.keyword</code> trong danh sách <code>Field</code>.</li>
<li>Nhấp vào nút <img src="https://www.elastic.co/guide/en/kibana/6.1/images/apply-changes-button.png" alt="images/apply-changes-button.png" loading="lazy"> để cập nhật biểu đồ.</li>
</ol>
<figure><img src="https://upload-images.jianshu.io/upload_images/3101171-7fb2042dc6d59520.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Sau khi hoàn thành, nếu bạn muốn lưu biểu đồ này, bạn có thể nhấp vào nút <code>Save</code> ở phía trên trang.</p>
<h3>Vertical Bar</h3>
<p>Chúng ta hãy xem cách tạo biểu đồ cột dọc.</p>
<ol>
<li>Nhấp vào <code>Create a visualization</code> màu xanh hoặc nút <code>+</code>. Chọn <code>Vertical Bar</code>.</li>
<li>Chọn mô hình chỉ mục. Vì bạn chưa xác định bất kỳ bucket nào, bạn sẽ thấy một thanh lớn hiển thị tổng số tài liệu khớp với truy vấn ký tự đại diện mặc định.</li>
<li>Xác định trường đại diện cho trục Y.</li>
<li>Xác định trường đại diện cho trục X.</li>
<li>Nhấp vào nút <img src="https://www.elastic.co/guide/en/kibana/6.1/images/apply-changes-button.png" alt="images/apply-changes-button.png" loading="lazy"> để cập nhật biểu đồ.</li>
</ol>
<figure><img src="https://upload-images.jianshu.io/upload_images/3101171-5aa7627284c19a56.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Sau khi hoàn thành, nếu bạn muốn lưu biểu đồ này, bạn có thể nhấp vào nút <code>Save</code> ở phía trên trang.</p>
<h2>Dashboard</h2>
<p><code>Dashboard</code> cho phép tổng hợp và chia sẻ tập hợp <code>Visualize</code>.</p>
<ol>
<li>Nhấp vào <code>Dashboard</code> trong thanh điều hướng bên.</li>
<li>Nhấp vào <code>Add</code> để hiển thị danh sách trực quan hóa đã lưu.</li>
<li>Nhấp vào <code>Visualize</code> đã lưu trước đó và sau đó nhấp vào mũi tên nhỏ ở cuối danh sách để đóng danh sách trực quan hóa.</li>
<li>Di chuột qua đối tượng trực quan sẽ hiển thị các điều khiển khung cho phép bạn chỉnh sửa, di chuyển, xóa và điều chỉnh kích thước đối tượng trực quan.</li>
</ol>
]]></content:encoded>
      <enclosure url="https://www.elastic.co/guide/en/kibana/current/images/tutorial-discover.png" type="image/png"/>
    </item>
    <item>
      <title>Kibana Operation</title>
      <link>https://vanhung4499.github.io/database/elastic/kibana-operation.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/kibana-operation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Kibana Operation</source>
      <description>Vận hành Kibana Thông qua Kibana, bạn có thể trực quan hóa Elasticsearch của mình và điều hướng trong Elastic Stack, cho phép bạn thực hiện các hoạt động khác nhau, từ theo dõi ...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Thông qua Kibana, bạn có thể trực quan hóa Elasticsearch của mình và điều hướng trong Elastic Stack, cho phép bạn thực hiện các hoạt động khác nhau, từ theo dõi tải truy vấn đến hiểu cách các yêu cầu chảy qua toàn bộ ứng dụng của bạn.</p>
<h2>1. Cài đặt</h2>
<h3>1.1. Yêu cầu hệ thống</h3>
<p>Phiên bản: Elastic Stack 7.4</p>
<h3>1.2. Các bước cài đặt</h3>
<p>Các bước cài đặt như sau:</p>
<ol>
<li>Tải gói phiên bản yêu cầu từ <a href="https://www.elastic.co/downloads/kibana" target="_blank" rel="noopener noreferrer">trang tải xuống chính thức của Kibana</a> và giải nén nó trên máy cục bộ của bạn.</li>
<li>Sửa tệp cấu hình <code>config/kibana.yml</code> và đặt <code>elasticsearch.url</code> để trỏ đến Elasticsearch của bạn.</li>
<li>Chạy <code>bin/kibana</code> (hoặc <code>bin\kibana.bat</code> trên Windows).</li>
<li>Truy cập Kibana trong trình duyệt của bạn tại địa chỉ <a href="http://localhost:5601" target="_blank" rel="noopener noreferrer">http://localhost:5601</a>.</li>
</ol>
<h2>2. Sử dụng</h2>
<h3>2.1. Khám phá (Discover)</h3>
<p>Nhấp vào <code>Discover</code> trong thanh điều hướng bên để truy cập chức năng truy vấn dữ liệu của Kibana.</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/current/images/tutorial-discover.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Trong thanh tìm kiếm, bạn có thể nhập các điều kiện truy vấn Elasticsearch để tìm kiếm dữ liệu của bạn. Bạn có thể duyệt qua kết quả trên trang <code>Discover</code> và tạo các trực quan hóa với các điều kiện tìm kiếm đã lưu trên trang <code>Visualize</code>.</p>
<p>Mẫu chỉ mục hiện tại được hiển thị dưới thanh tìm kiếm. Mẫu chỉ mục xác định các chỉ mục nào được tìm kiếm khi truy vấn được gửi. Để tìm kiếm một tập hợp chỉ mục khác, hãy chọn một mẫu khác từ menu thả xuống. Để thêm một mẫu chỉ mục, điều hướng đến <code>Management/Kibana/Index Patterns</code> và nhấp vào <code>Add New</code>.</p>
<p>Bạn có thể xây dựng các truy vấn bằng cách sử dụng tên trường và các giá trị quan tâm. Đối với các trường số, bạn có thể sử dụng các toán tử so sánh như lớn hơn (&gt;), nhỏ hơn (&lt;) hoặc bằng (=). Bạn có thể kết hợp các yếu tố với các toán tử logic <code>AND</code>, <code>OR</code> và <code>NOT</code>, tất cả viết hoa.</p>
<p>Mặc định, mỗi tài liệu khớp hiển thị tất cả các trường. Để chọn các trường tài liệu muốn hiển thị, di chuột qua danh sách "Các trường có sẵn" và nhấp vào nút thêm bên cạnh mỗi trường bạn muốn bao gồm. Ví dụ, nếu chỉ thêm account_number, hiển thị sẽ thay đổi thành một danh sách đơn giản chứa năm tài khoản:</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-discover-3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Thanh tìm kiếm trong Kibana tuân theo cú pháp chuỗi truy vấn được mô tả trong tài liệu <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html#query-string-syntax" target="_blank" rel="noopener noreferrer">query-string-syntax</a>.</p>
<p>Dưới đây là một số cú pháp truy vấn cơ bản nhất.</p>
<h4>2.1.1. Tên trường</h4>
<p>Như đã mô tả trong truy vấn chuỗi truy vấn, mặc định sẽ tìm kiếm trường default_field trong điều kiện tìm kiếm, nhưng bạn có thể chỉ định các trường khác trong cú pháp truy vấn:</p>
<p>Ví dụ:</p>
<ul>
<li>Tìm kiếm từ khóa "active" trong trường <code>status</code></li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>status:active</span></span></code></pre>
</div><ul>
<li>Tìm kiếm từ khóa "quick" hoặc "brown" trong trường <code>title</code>. Nếu bạn bỏ qua toán tử <code>OR</code>, toán tử mặc định sẽ được sử dụng.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>title:(quick OR brown)</span></span>
<span class="line"><span>title:(quick brown)</span></span></code></pre>
</div><ul>
<li>Tìm kiếm cụm từ chính xác "John Smith" trong trường <code>author</code>.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>author:"John Smith"</span></span></code></pre>
</div><ul>
<li>Tìm kiếm từ khóa "quick" hoặc "brown" trong bất kỳ trường nào (<code>book.title</code>, <code>book.content</code>, hoặc <code>book.date</code>). Lưu ý cách sử dụng <code>\*</code> để đại diện cho ký tự đại diện.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>book.\*:(quick brown)</span></span></code></pre>
</div><ul>
<li>Tìm kiếm các tài liệu có trường <code>title</code> chứa bất kỳ giá trị khác null nào.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>_exists_:title</span></span></code></pre>
</div><h4>2.1.2. Ký tự đại diện</h4>
<p>ELK cung cấp hai ký tự đại diện là <code>?</code> và <code>*</code>.</p>
<ul>
<li><code>?</code> đại diện cho bất kỳ ký tự duy nhất nào;</li>
<li><code>*</code> đại diện cho bất kỳ số ký tự nào, bao gồm cả không có ký tự.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>qu?ck bro*</span></span></code></pre>
</div><blockquote>
<p><strong>Lưu ý: Truy vấn ký tự đại diện sẽ sử dụng nhiều bộ nhớ và có hiệu suất thực hiện kém, vì vậy hãy sử dụng cẩn thận.</strong> &gt; <strong>Gợi ý</strong>: Truy vấn ký tự đại diện thuần túy <code>*</code> được viết dưới dạng truy vấn <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="noopener noreferrer">exists</a> để cải thiện hiệu suất truy vấn. Do đó, truy vấn <code>field:*</code> sẽ khớp với các tài liệu chứa giá trị rỗng như <code>{ "field": "" }</code>, nhưng không khớp nếu trường bị mất hoặc giá trị được đặt thành null như <code>{ "field": null }</code>. &gt; <strong>Gợi ý</strong>: Truy vấn bằng ký tự đại diện ở đầu từ (ví dụ: <code>*ing</code>) có lượng truy vấn đặc biệt lớn, vì tất cả các thuật ngữ trong chỉ mục phải được kiểm tra trong trường hợp có khớp. Bằng cách đặt <code>allow_leading_wildcard</code> thành <code>false</code>, bạn có thể tắt tính năng này.</p>
</blockquote>
<h4>2.1.3. Biểu thức chính quy</h4>
<p>Bạn có thể sử dụng biểu thức chính quy bằng cách bao bọc nó trong dấu <code>/</code> trong chuỗi truy vấn.</p>
<p>Ví dụ:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>name:/joh?n(ath[oa]n)/</span></span></code></pre>
</div><p>Cú pháp biểu thức chính quy được hỗ trợ có thể được tham khảo tại: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html#regexp-syntax" target="_blank" rel="noopener noreferrer">Regular expression syntax</a></p>
<h4>2.1.4. Truy vấn mờ</h4>
<p>Chúng ta có thể sử dụng toán tử <code>~</code> để thực hiện truy vấn mờ.</p>
<p>Ví dụ:</p>
<p>Giả sử chúng ta thực sự muốn tìm kiếm</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quick brown forks</span></span></code></pre>
</div><p>Nhưng do lỗi chính tả, từ khóa truy vấn của chúng ta trở thành như sau, nhưng vẫn có thể tìm thấy kết quả mong muốn.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quikc~ brwn~ foks~</span></span></code></pre>
</div><p>Truy vấn mờ này sử dụng khoảng cách Damerau-Levenshtein để tìm tất cả các mục khớp có tối đa hai thay đổi. Thay đổi có thể là việc chèn, xóa hoặc thay thế một ký tự đơn, hoặc hoán đổi vị trí của hai ký tự liền kề.</p>
<p>Khoảng cách chỉnh sửa mặc định là <code>2</code>, nhưng khoảng cách chỉnh sửa là <code>1</code> thường đủ để bắt được 80% lỗi chính tả của con người. Nó có thể được chỉ định như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quikc~1</span></span></code></pre>
</div><h4>2.1.5. Tìm kiếm gần đúng</h4>
<p>Mặc dù truy vấn cụm từ (ví dụ: <code>john smith</code>) mong đợi tất cả các thuật ngữ trong cụm từ đó có cùng thứ tự hoàn toàn, nhưng tìm kiếm gần đúng cho phép chỉ định các từ cụ thể được tách ra hoặc sắp xếp theo thứ tự khác nhau. Giống như truy vấn mờ có thể chỉ định khoảng cách chỉnh sửa tối đa cho các ký tự trong từ, tìm kiếm gần đúng cũng cho phép chúng ta chỉ định khoảng cách chỉnh sửa tối đa cho các từ trong cụm từ:</p>
<p>Ví dụ:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>"fox quick"~5</span></span></code></pre>
</div><p>Càng gần văn bản trong trường với thứ tự ban đầu được chỉ định trong chuỗi truy vấn, tài liệu đó càng được coi là liên quan. So với truy vấn ví dụ trên, cụm từ <code>"quick fox"</code> sẽ được coi là gần giống điều kiện truy vấn hơn <code>"quick brown fox"</code>.</p>
<h4>2.1.6. Phạm vi</h4>
<p>Chúng ta có thể chỉ định phạm vi cho các trường ngày tháng, số hoặc chuỗi. Phạm vi đóng cửa được chỉ định bằng cặp dấu ngoặc vuông <code>[min TO max]</code> và phạm vi mở được chỉ định bằng cặp dấu ngoặc nhọn <code>{min TO max}</code>.</p>
<p>Hãy xem một số ví dụ.</p>
<ul>
<li>Tất cả các ngày trong năm 2012</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>date:[2012-01-01 TO 2012-12-31]</span></span></code></pre>
</div><ul>
<li>Số từ 1 đến 5</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>count:[1 TO 5]</span></span></code></pre>
</div><ul>
<li>Các nhãn nằm giữa <code>alpha</code> và <code>omega</code>, không bao gồm <code>alpha</code> và <code>omega</code></li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>tag:{alpha TO omega}</span></span></code></pre>
</div><ul>
<li>Số lớn hơn hoặc bằng 10</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>count:[10 TO *]</span></span></code></pre>
</div><ul>
<li>Tất cả các ngày trước năm 2012</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>date:{* TO 2012-01-01}</span></span></code></pre>
</div><p>Ngoài ra, phạm vi mở và đóng cũng có thể được kết hợp sử dụng</p>
<ul>
<li>Mảng từ 1 đến 5, nhưng không bao gồm số 5</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>count:[1 TO 5}</span></span></code></pre>
</div><p>Phạm vi không bị ràng buộc ở một bên cũng có thể được sử dụng với cú pháp sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>age:&gt;10</span></span>
<span class="line"><span>age:&gt;=10</span></span>
<span class="line"><span>age:&lt;10</span></span>
<span class="line"><span>age:&lt;=10</span></span></code></pre>
</div><p>Tất nhiên, bạn cũng có thể sử dụng toán tử AND để lấy giao của hai kết quả truy vấn:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>age:(&gt;=10 AND &lt;20)</span></span>
<span class="line"><span>age:(+&gt;=10 +&lt;20)</span></span></code></pre>
</div><h4>2.1.7. Boosting</h4>
<p>Sử dụng toán tử <code>^</code> để làm cho một thuật ngữ quan trọng hơn một thuật ngữ khác. Ví dụ, nếu chúng ta muốn tìm kiếm tất cả các tài liệu liên quan đến con cáo, nhưng chúng ta đặc biệt quan tâm đến con cáo:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quick^2 fox</span></span></code></pre>
</div><p>Giá trị tăng cường mặc định là 1, nhưng nó có thể là bất kỳ số thực dương nào. Giá trị tăng cường từ 0 đến 1 giảm tính liên quan.</p>
<p>Tăng cường cũng có thể được áp dụng cho cụm từ hoặc nhóm:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>"john smith"^2   (foo bar)^4</span></span></code></pre>
</div><h4>2.1.8. Phép toán Boolean</h4>
<p>Mặc định, chỉ cần một từ khớp, tất cả các từ đều là tùy chọn. Tìm kiếm <code>foo bar baz</code> sẽ tìm kiếm bất kỳ tài liệu nào chứa một hoặc nhiều từ trong <code>foo</code>, <code>bar</code> hoặc <code>baz</code>. Chúng ta đã thảo luận về <code>default_operator</code> ở trên, cho phép bạn yêu cầu tất cả các mục, nhưng cũng có các toán tử Boolean có thể sử dụng trong chuỗi truy vấn để cung cấp sự kiểm soát nhiều hơn.</p>
<p>Các toán tử được ưu tiên sử dụng là <code>+</code> (thuật ngữ này phải tồn tại) và <code>-</code> (thuật ngữ này không được tồn tại). Tất cả các thuật ngữ khác là tùy chọn. Ví dụ, truy vấn này:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quick brown +fox -news</span></span></code></pre>
</div><p>Truy vấn này có nghĩa là:</p>
<ul>
<li><code>fox</code> phải tồn tại</li>
<li><code>news</code> không được tồn tại</li>
<li><code>quick</code> và <code>brown</code> là tùy chọn</li>
</ul>
<p>Các toán tử quen thuộc <code>AND</code>, <code>OR</code> và <code>NOT</code> (cũng có thể được viết là <code>&amp;&amp;</code>, <code>||</code> và <code>!</code>) cũng được hỗ trợ. Tuy nhiên, các toán tử này có mức độ ưu tiên nhất định: <code>NOT</code> ưu tiên hơn <code>AND</code>, <code>AND</code> ưu tiên hơn <code>OR</code>. Mặc dù <code>+</code> và <code>-</code> chỉ ảnh hưởng đến thuật ngữ bên phải của toán tử, nhưng <code>AND</code> và <code>OR</code> ảnh hưởng đến cả thuật ngữ bên trái và bên phải.</p>
<h4>2.1.9. Nhóm</h4>
<p>Nhiều thuật ngữ hoặc mệnh đề có thể được kết hợp trong cặp dấu ngoặc tròn để tạo thành một truy vấn con:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>(quick OR brown) AND fox</span></span></code></pre>
</div><p>Có thể sử dụng nhóm để xác định trường cụ thể hoặc cải thiện kết quả của truy vấn con:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>status:(active OR pending) title:(full text search)^2</span></span></code></pre>
</div><h4>2.1.10. Từ khóa đặc biệt</h4>
<p>Nếu bạn cần sử dụng bất kỳ ký tự nào trong truy vấn của mình là một toán tử (thay vì một toán tử), bạn nên sử dụng dấu gạch chéo ngược để tránh chúng. Ví dụ, để tìm kiếm (1 + 1) = 2, bạn cần viết truy vấn là <code>\(1\+1\)\=2</code></p>
<p>Các ký tự đặc biệt là: <code>+ - = &amp;&amp; || &gt; &lt; ! ( ) { } [ ] ^ " ~ * ? : \ /</code></p>
<p>Không thể thoát các ký tự đặc biệt này một cách chính xác có thể dẫn đến lỗi cú pháp và ngăn truy vấn của bạn hoạt động.</p>
<h4>2.1.11. Truy vấn trống</h4>
<p>Nếu chuỗi truy vấn là trống hoặc chỉ chứa khoảng trắng, truy vấn sẽ tạo ra một tập kết quả trống.</p>
<h3>2.2. Trực quan hóa</h3>
<p>Để hiển thị dữ liệu của bạn dưới dạng trực quan, hãy nhấp vào <code>Visualize</code> trong thanh điều hướng bên.</p>
<p>Công cụ Visualize cho phép bạn xem dữ liệu theo nhiều cách khác nhau, chẳng hạn như biểu đồ tròn, biểu đồ cột, biểu đồ đường, biểu đồ phân phối, v.v. Để bắt đầu, hãy nhấp vào <code>Create a visualization</code> hoặc nút <code>+</code> màu xanh lá cây.</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png" alt="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png" tabindex="0" loading="lazy"><figcaption><a href="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png</a></figcaption></figure>
<p>Có nhiều loại trực quan hóa để lựa chọn.</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png" alt="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png" tabindex="0" loading="lazy"><figcaption><a href="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png</a></figcaption></figure>
<p>Dưới đây, chúng ta sẽ tạo một số ví dụ biểu đồ:</p>
<h4>2.2.1. Pie</h4>
<p>Bạn có thể xây dựng một trực quan hóa từ tìm kiếm đã lưu hoặc nhập điều kiện tìm kiếm mới. Để nhập điều kiện tìm kiếm mới, trước tiên bạn cần chọn một mẫu chỉ mục để xác định chỉ mục bạn muốn tìm kiếm.</p>
<p>Mặc định, tìm kiếm khớp với tất cả các tài liệu. Ban đầu, một "miếng" chứa toàn bộ biểu đồ tròn:</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png" alt="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png" tabindex="0" loading="lazy"><figcaption><a href="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png</a></figcaption></figure>
<p>Để chỉ định dữ liệu nào hiển thị trong biểu đồ, hãy sử dụng bucket aggregation của Elasticsearch. Grouping aggregation chỉ là việc phân loại tài liệu khớp với điều kiện tìm kiếm của bạn thành các danh mục khác nhau, còn được gọi là bucket.</p>
<p>Định nghĩa một bucket cho mỗi phạm vi:</p>
<ol>
<li>Nhấp vào <code>Split Slices</code>.</li>
<li>Chọn <code>Terms</code> trong danh sách <code>Aggregation</code>. <em>Lưu ý: Các thuật ngữ ở đây là các trường hoặc nhãn đã được xác định khi thu thập dữ liệu Elk</em>.</li>
<li>Chọn <code>level.keyword</code> trong danh sách <code>Field</code>.</li>
<li>Nhấp vào <img src="https://www.elastic.co/guide/en/kibana/6.1/images/apply-changes-button.png" alt="images/apply-changes-button.png" loading="lazy"> để cập nhật biểu đồ.</li>
</ol>
<figure><img src="https://upload-images.jianshu.io/upload_images/3101171-7fb2042dc6d59520.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Sau khi hoàn thành, nếu bạn muốn lưu biểu đồ này, bạn có thể nhấp vào nút <code>Save</code> ở phía trên trang.</p>
<h4>2.2.2. Vertical Bar</h4>
<p>Chúng ta sẽ xem cách tạo biểu đồ cột dọc.</p>
<ol>
<li>Nhấp vào <code>Create a visualization</code> hoặc nút <code>+</code> màu xanh lá cây. Chọn <code>Vertical Bar</code>.</li>
<li>Chọn mẫu chỉ mục. Vì bạn chưa xác định bất kỳ bucket nào, bạn sẽ thấy một thanh lớn hiển thị tổng số tài liệu khớp với truy vấn mặc định.</li>
<li>Chỉ định trường đại diện cho trục Y.</li>
<li>Chỉ định trường đại diện cho trục X.</li>
<li>Nhấp vào <img src="https://www.elastic.co/guide/en/kibana/6.1/images/apply-changes-button.png" alt="images/apply-changes-button.png" loading="lazy"> để cập nhật biểu đồ.</li>
</ol>
<figure><img src="https://upload-images.jianshu.io/upload_images/3101171-5aa7627284c19a56.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Sau khi hoàn thành, nếu bạn muốn lưu biểu đồ này, bạn có thể nhấp vào nút <code>Save</code> ở phía trên trang.</p>
<h3>2.3. Báo cáo</h3>
<p><code>Báo cáo (Dashboard)</code> cho phép tổng hợp và chia sẻ tập hợp <code>Visualize</code>.</p>
<ol>
<li>Nhấp vào <code>Dashboard</code> trong thanh điều hướng bên.</li>
<li>Nhấp vào <code>Thêm hiển thị từ danh sách Visualize đã lưu</code>.</li>
<li>Nhấp vào <code>Visualize</code> đã lưu trước đó, sau đó nhấp vào mũi tên nhỏ ở cuối danh sách để đóng danh sách Visualize.</li>
<li>Khi di chuột qua đối tượng Visualize, các điều khiển container sẽ hiển thị cho phép bạn chỉnh sửa, di chuyển, xóa và điều chỉnh kích thước đối tượng Visualize.</li>
</ol>
<h2>3. FAQ</h2>
<h3>3.1. Cảnh báo Kibana No Default Index Pattern</h3>
<p><strong>Câu hỏi:</strong> Sau khi cài đặt ELK, khi truy cập trang Kibana, tôi nhận được cảnh báo lỗi sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Warning No default index pattern. You must select or create one to continue.</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>Unable to fetch mapping. Do you have indices matching the pattern?</span></span></code></pre>
</div><p>Điều này cho thấy logstash không ghi nhật ký vào elasticsearch.</p>
<p><strong>Giải pháp:</strong></p>
<p>Kiểm tra xem có vấn đề gì về giao tiếp giữa logstash và elasticsearch, thường là vấn đề nằm ở đây.</p>
<h2>4. Tài liệu tham khảo</h2>
<ul>
<li><a href="https://www.elastic.co/cn/products/kibana" target="_blank" rel="noopener noreferrer">Trang web chính thức của Kibana</a></li>
<li><a href="https://github.com/elastic/kibana" target="_blank" rel="noopener noreferrer">Kibana Github</a></li>
<li><a href="https://www.elastic.co/guide/en/kibana/current/index.html" target="_blank" rel="noopener noreferrer">Tài liệu chính thức của Kibana</a></li>
</ul>
]]></content:encoded>
      <enclosure url="https://www.elastic.co/guide/en/kibana/current/images/tutorial-discover.png" type="image/png"/>
    </item>
    <item>
      <title>Logstash Operation</title>
      <link>https://vanhung4499.github.io/database/elastic/logstash-operation.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/logstash-operation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Logstash Operation</source>
      <description>Dưới đây là bản dịch sang tiếng Việt của đoạn văn bạn yêu cầu: Vận hành Logstash Logstash là một pipeline xử lý dữ liệu phía máy chủ mã nguồn mở, có khả năng thu thập dữ liệu từ...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[<p>Dưới đây là bản dịch sang tiếng Việt của đoạn văn bạn yêu cầu:</p>
<h1>Vận hành Logstash</h1>
<blockquote>
<p><a href="https://github.com/elastic/logstash" target="_blank" rel="noopener noreferrer">Logstash</a> là một pipeline xử lý dữ liệu phía máy chủ mã nguồn mở, có khả năng thu thập dữ liệu từ nhiều nguồn, chuyển đổi dữ liệu và sau đó gửi dữ liệu đến "kho lưu trữ" yêu thích của bạn.</p>
</blockquote>
<h2>1. Cài đặt</h2>
<h3>1.1. Các bước cài đặt</h3>
<p>Các bước cài đặt như sau:</p>
<p>(1) Tải xuống gói phiên bản mong muốn từ <a href="https://www.elastic.co/downloads/logstash" target="_blank" rel="noopener noreferrer">địa chỉ tải xuống chính thức của logstash</a> và giải nén nó vào máy cục bộ.</p>
<p>(2) Thêm tệp <code>logstash.conf</code>, chỉ định các plugin bạn muốn sử dụng và cấu hình cho mỗi plugin. Dưới đây là một ví dụ đơn giản:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>input { stdin { } }</span></span>
<span class="line"><span>output {</span></span>
<span class="line"><span>  elasticsearch { hosts =&gt; ["localhost:9200"] }</span></span>
<span class="line"><span>  stdout { codec =&gt; rubydebug }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>(3) Chạy lệnh <code>bin/logstash -f logstash.conf</code> (trên Windows, chạy <code>bin/logstash.bat -f logstash.conf</code>)</p>
<h2>2. Cấu hình</h2>
<h3>2.1. Tệp cấu hình</h3>
<ul>
<li><strong><code>logstash.yml</code></strong>: Tệp cấu hình khởi động mặc định của logstash.</li>
<li><strong><code>jvm.options</code></strong>: Tệp cấu hình JVM của logstash.</li>
<li><strong><code>startup.options</code></strong> (Linux): Chứa các tùy chọn được sử dụng bởi tập lệnh cài đặt hệ thống trong <code>/usr/share/logstash/bin</code> để xây dựng các tập lệnh khởi động phù hợp cho hệ thống của bạn. Khi cài đặt gói logstash, tập lệnh cài đặt hệ thống sẽ được thực thi khi quá trình cài đặt kết thúc và sử dụng các cài đặt được chỉ định trong <code>startup.options</code> để đặt người dùng, nhóm, tên dịch vụ và mô tả dịch vụ.</li>
</ul>
<h3>2.2. Các mục cấu hình trong logstash.yml</h3>
<p>Dưới đây là một số mục cấu hình được trích dẫn, vui lòng xem thêm tại: <a href="https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html</a></p>
<p>| Tham số                    | Mô tả                                                                                                                                                                                                                                                                                                                                                            | Giá trị mặc định                                                                                                                         |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/3101171-cd876d79a14955b0.png" type="image/png"/>
    </item>
    <item>
      <title>Logstash</title>
      <link>https://vanhung4499.github.io/database/elastic/logstash.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/logstash.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Logstash</source>
      <description>Elastic Stack: Logstash Bài viết này tập trung vào Logstash, một thành phần của Elastic Technology Stack (ELK). Nếu bạn không quen với cách cài đặt, cấu hình và triển khai Elast...</description>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Bài viết này tập trung vào Logstash, một thành phần của Elastic Technology Stack (ELK).</p>
<p>Nếu bạn không quen với cách cài đặt, cấu hình và triển khai Elastic, bạn có thể tham khảo hướng dẫn: [[Elastic Quick Start|Bắt đầu nhanh với Elastic Technology Stack]])</p>
</blockquote>
<h2>Giới thiệu</h2>
<p>Logstash được sử dụng để vận chuyển và xử lý các logs, giao dịch hoặc dữ liệu khác của bạn.</p>
<h3>Tính năng</h3>
<p>Logstash là ống dẫn dữ liệu tốt nhất cho Elasticsearch.</p>
<p>Logstash tuân theo kiến trúc dựa trên plugin, cho phép tùy chỉnh thông qua các plugin ở các giai đoạn input, filter, output và codec. Cộng đồng Logstash cung cấp hơn 200 plugin có sẵn.</p>
<h3>Cách hoạt động</h3>
<p>Logstash bao gồm ba yếu tố cơ bản: <code>input</code>, <code>filter</code> và <code>output</code>. Có một yếu tố tùy chọn là <code>codec</code>.</p>
<p>Ba yếu tố này đại diện cho ba giai đoạn xử lý sự kiện của Logstash: input &gt; filter &gt; output.</p>
<figure><img src="https://www.elastic.co/guide/en/logstash/current/static/images/basic_logstash_pipeline.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<ul>
<li><code>input</code> có trách nhiệm thu thập dữ liệu từ nguồn dữ liệu.</li>
<li><code>filter</code> sửa đổi dữ liệu thành định dạng hoặc nội dung được chỉ định.</li>
<li><code>output</code> chuyển dữ liệu đến đích của nó.</li>
</ul>
<p>Trong các kịch bản thực tế, thường có nhiều input, output và filter. Logstash cho phép người dùng chọn và kết hợp các plugin cho mỗi giai đoạn dựa trên nhu cầu ứng dụng của họ.</p>
<p>Chi tiết về các plugin sẽ được thảo luận sau.</p>
<h2>Cấu hình</h2>
<h3>Tệp cấu hình</h3>
<ul>
<li><strong><code>logstash.yml</code></strong>: Tệp cấu hình khởi động mặc định cho Logstash.</li>
<li><strong><code>jvm.options</code></strong>: Tệp cấu hình JVM cho Logstash.</li>
<li><strong><code>startup.options</code></strong> (Linux): Chứa các tùy chọn được sử dụng bởi tập lệnh cài đặt hệ thống trong <code>/usr/share/logstash/bin</code> để xây dựng các tập lệnh khởi động phù hợp cho hệ thống của bạn. Tập lệnh cài đặt hệ thống được thực thi trong quá trình cài đặt và đặt các tùy chọn như người dùng, nhóm, tên dịch vụ và mô tả dịch vụ dựa trên các thiết lập được chỉ định trong <code>startup.options</code>.</li>
</ul>
<h3>Cài đặt logstash.yml</h3>
<p>Dưới đây là một số cài đặt được chọn lọc. Để biết thêm tùy chọn, vui lòng tham khảo: <a href="https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html</a></p>
<p>| Tham số                    | Mô tả                                                                                                                                                                                                                                                                                                                                                         | Giá trị mặc định                                                                                                                            |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://www.elastic.co/guide/en/logstash/current/static/images/basic_logstash_pipeline.png" type="image/png"/>
    </item>
    <item>
      <title>Elastic Overview</title>
      <link>https://vanhung4499.github.io/database/elastic/overview.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/overview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elastic Overview</source>
      <description>Elastic Stack Overview Elastic Stack thường được sử dụng làm giải pháp cho việc thu thập, truy xuất và trực quan hóa nhật ký (log). ELK là viết tắt của ba sản phẩm thuộc công ty...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><strong>Elastic Stack thường được sử dụng làm giải pháp cho việc thu thập, truy xuất và trực quan hóa nhật ký (log).</strong></p>
<p>ELK là viết tắt của ba sản phẩm thuộc công ty Elastic:&nbsp;<a href="https://www.elastic.co/products/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>,&nbsp;<a href="https://www.elastic.co/products/logstash" target="_blank" rel="noopener noreferrer">Logstash</a>&nbsp;và&nbsp;<a href="https://www.elastic.co/products/kibana" target="_blank" rel="noopener noreferrer">Kibana</a>.</p>
<p><a href="https://www.elastic.co/products/logstash" target="_blank" rel="noopener noreferrer">Logstash</a>&nbsp;được sử dụng để truyền và xử lý nhật ký, giao dịch hoặc dữ liệu khác.</p>
<p><a href="https://www.elastic.co/products/kibana" target="_blank" rel="noopener noreferrer">Kibana</a>&nbsp;được sử dụng để phân tích dữ liệu từ Elasticsearch và hiển thị chúng dưới dạng báo cáo trực quan.</p>
<p>Elastic Stack đã mở rộng thêm một số sản phẩm mới trên cơ sở của ELK, chẳng hạn như:&nbsp;<a href="https://www.elastic.co/products/beats" target="_blank" rel="noopener noreferrer">Beats</a>&nbsp;và&nbsp;<a href="https://www.elastic.co/products/x-pack" target="_blank" rel="noopener noreferrer">X-Pack</a>.</p>
</blockquote>
<h2>📖 Contents</h2>
]]></content:encoded>
    </item>
    <item>
      <title>Elastic Quick Start</title>
      <link>https://vanhung4499.github.io/database/elastic/quick-start.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/quick-start.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elastic Quick Start</source>
      <description>1. Hướng dẫn nhanh về Elastic Giấy phép mã nguồn mở: Apache 2.0 1. Giới thiệu 1.1. Elastic Stack là gì Elastic Stack còn được gọi là ELK Stack. ELK là viết tắt của ba sản phẩm c...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[<h2>1. Hướng dẫn nhanh về Elastic</h2>
<blockquote>
<p>Giấy phép mã nguồn mở: <a href="https://github.com/elastic/elasticsearch/tree/7.4/licenses/APACHE-LICENSE-2.0.txt" target="_blank" rel="noopener noreferrer">Apache 2.0</a></p>
</blockquote>
<h2>1. Giới thiệu</h2>
<h3>1.1. Elastic Stack là gì</h3>
<p><strong>Elastic Stack</strong> còn được gọi là <strong>ELK Stack</strong>.</p>
<p>ELK là viết tắt của ba sản phẩm của công ty Elastic: <a href="https://www.elastic.co/cn/products/elasticsearch" target="_blank" rel="noopener noreferrer">ElasticSearch</a>, <a href="https://www.elastic.co/cn/products/logstash" target="_blank" rel="noopener noreferrer">Logstash</a>, và <a href="https://www.elastic.co/cn/products/kibana" target="_blank" rel="noopener noreferrer">Kibana</a>.</p>
<ul>
<li>Elasticsearch là một công cụ tìm kiếm và phân tích.</li>
<li>Logstash là một pipeline xử lý dữ liệu phía máy chủ, có khả năng thu thập dữ liệu từ nhiều nguồn cùng một lúc, chuyển đổi dữ liệu, sau đó gửi dữ liệu đến các "kho lưu trữ" như Elasticsearch.</li>
<li>Kibana cho phép người dùng trực quan hóa dữ liệu trong Elasticsearch bằng các biểu đồ và biểu đồ.</li>
</ul>
<p>Elastic Stack là phiên bản cập nhật của ELK Stack, sản phẩm mới nhất đã giới thiệu các bộ thu thập dữ liệu chức năng đơn lẻ nhẹ và đặt tên cho chúng là <a href="https://www.elastic.co/beats" target="_blank" rel="noopener noreferrer">Beats</a>.</p>
<h3>1.2. Tại sao sử dụng Elastic Stack</h3>
<p>Đối với các công ty có quy mô nhất định, thường sẽ có nhiều ứng dụng và được triển khai trên một số lượng lớn máy chủ. Nhân viên vận hành và phát triển thường cần xem nhật ký để xác định vấn đề. Nếu ứng dụng được triển khai theo cụm, hãy tưởng tượng nếu bạn đăng nhập vào từng máy chủ để xem nhật ký, điều này sẽ tốn nhiều thời gian và công sức.</p>
<p>Với giải pháp ELK, bạn có thể thu thập, tìm kiếm và phân tích nhật ký cùng một lúc.</p>
<h3>1.3. Kiến trúc Elastic Stack</h3>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/deploy3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<blockquote>
<p><strong>Giải thích</strong></p>
<p>Đây là một sơ đồ kiến trúc của Elastic Stack. Từ hình trên, bạn có thể rõ ràng thấy hướng dòng dữ liệu.</p>
<ul>
<li><a href="https://www.elastic.co/products/beats" target="_blank" rel="noopener noreferrer">Beats</a> là một nền tảng truyền dữ liệu đơn chức năng, nó có thể gửi dữ liệu từ nhiều máy chủ đến Logstash hoặc ElasticSearch. Tuy nhiên, Beats không phải là một phần không thể thiếu, vì vậy bài viết này sẽ không giới thiệu.</li>
<li><a href="https://www.elastic.co/products/logstash" target="_blank" rel="noopener noreferrer">Logstash</a> là một pipeline thu thập dữ liệu động. Hỗ trợ thu thập dữ liệu theo nhiều cách như TCP/UDP/HTTP (cũng có thể nhận dữ liệu được Beats truyền đến), và xử lý dữ liệu để làm giàu hoặc trích xuất trường.</li>
<li><a href="https://www.elastic.co/products/elasticsearch" target="_blank" rel="noopener noreferrer">ElasticSearch</a> là một công cụ tìm kiếm và phân tích phân tán dựa trên JSON. Là trung tâm của ELK, nó lưu trữ dữ liệu tập trung.</li>
<li><a href="https://www.elastic.co/products/kibana" target="_blank" rel="noopener noreferrer">Kibana</a> là giao diện người dùng của ELK. Nó trực quan hóa dữ liệu đã thu thập (các báo cáo, dữ liệu hình học) và cung cấp giao diện để cấu hình, quản lý ELK.</li>
</ul>
</blockquote>
<h2>2. ElasticSearch</h2>
<blockquote>
<p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>&nbsp;là một công cụ tìm kiếm và phân tích dữ liệu phong cách RESTful, phân tán, có thể giải quyết nhiều trường hợp sử dụng xuất hiện liên tục. Là trung tâm của Elastic Stack, nó lưu trữ dữ liệu của bạn, giúp bạn khám phá các tình huống dự kiến và không dự kiến.</p>
</blockquote>
<h3>2.1. Giới thiệu về ElasticSearch</h3>
<p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>&nbsp;được phát triển dựa trên thư viện tìm kiếm&nbsp;<a href="https://github.com/apache/lucene-solr" target="_blank" rel="noopener noreferrer">Lucene</a>. Elasticsearch giấu đi sự phức tạp của Lucene, cung cấp giao diện API REST / Java dễ sử dụng (cũng như các giao diện API bằng ngôn ngữ khác).</p>
<p>Elasticsearch có thể được xem như một kho lưu trữ tài liệu, nơi nó&nbsp;<strong>chuyển đổi các cấu trúc dữ liệu phức tạp thành JSON để lưu trữ</strong>.</p>
<p><strong>ElasticSearch là một công cụ tìm kiếm toàn văn gần như thời gian thực</strong>, điều này có nghĩa là:</p>
<ul>
<li>Từ khi ghi dữ liệu đến khi dữ liệu có thể được tìm kiếm, có một độ trễ nhỏ (khoảng 1s)</li>
<li>Các hoạt động tìm kiếm và phân tích dựa trên ES có thể đạt được mức độ giây</li>
</ul>
<h4>2.1.1. Khái niệm cốt lõi</h4>
<ul>
<li><strong><code>Index</code></strong>&nbsp;có thể được coi là một tập hợp tối ưu của các tài liệu (document).</li>
<li>Mỗi&nbsp;<strong><code>document</code></strong>&nbsp;là một tập hợp các trường (field).</li>
<li><strong><code>Field</code></strong>&nbsp;là một cặp giá trị key-value chứa dữ liệu.</li>
<li>Theo mặc định, Elasticsearch xây dựng chỉ mục cho tất cả dữ liệu trong mỗi trường và mỗi trường chỉ mục đều có cấu trúc dữ liệu tối ưu hóa riêng.</li>
<li>Mỗi chỉ mục có thể có một hoặc nhiều loại (type).&nbsp;<code>Type</code>&nbsp;là một phân loại logic của chỉ mục,</li>
<li>Khi một máy không đủ để lưu trữ dữ liệu lớn, Elasticsearch có thể chia dữ liệu trong một chỉ mục thành nhiều&nbsp;<strong><code>shard</code></strong>.&nbsp;<strong><code>Shard</code></strong>&nbsp;được lưu trữ trên nhiều máy chủ. Với shard, bạn có thể mở rộng theo chiều ngang, lưu trữ nhiều dữ liệu hơn, cho phép các hoạt động tìm kiếm và phân tích được phân phối trên nhiều máy chủ, tăng cường throughput và hiệu suất. Mỗi shard đều là một chỉ mục lucene.</li>
<li>Bất kỳ máy chủ nào cũng có thể gặp sự cố hoặc bị tắt bất cứ lúc nào, lúc này shard có thể bị mất, do đó, bạn có thể tạo nhiều&nbsp;<strong><code>replica</code></strong>&nbsp;cho mỗi shard. Replica có thể cung cấp dịch vụ dự phòng khi shard gặp sự cố, đảm bảo dữ liệu không bị mất, nhiều replica cũng có thể tăng cường throughput và hiệu suất của hoạt động tìm kiếm. Primary shard (được thiết lập khi tạo chỉ mục, không thể sửa đổi, mặc định là 5), replica shard (có thể thay đổi số lượng bất cứ lúc nào, mặc định là 1), mặc định mỗi chỉ mục có 10 shard, 5 primary shard, 5 replica shard, cấu hình có sẵn tối thiểu, là 2 máy chủ.</li>
</ul>
<h3>2.2. Nguyên lý ElasticSearch</h3>
<h4>2.2.1. Quá trình ghi dữ liệu ES</h4>
<ul>
<li>Máy khách chọn một node và gửi yêu cầu đến, node này được gọi là&nbsp;<code>coordinating node</code>&nbsp;(nút điều phối).</li>
<li><code>Coordinating node</code>&nbsp;thực hiện&nbsp;<strong>định tuyến</strong>&nbsp;cho document và chuyển tiếp yêu cầu đến node tương ứng (có primary shard).</li>
<li><code>Primary shard</code>&nbsp;trên node thực tế xử lý yêu cầu, sau đó đồng bộ hóa dữ liệu với&nbsp;<code>replica node</code>.</li>
<li>Nếu&nbsp;<code>coordinating node</code>&nbsp;phát hiện&nbsp;<code>primary node</code>&nbsp;và tất cả&nbsp;<code>replica node</code>&nbsp;đều đã hoàn thành, nó sẽ trả lại kết quả phản hồi cho máy khách.</li>
</ul>
<h4>2.2.2. Quá trình đọc dữ liệu es</h4>
<p>Bạn có thể tìm kiếm theo&nbsp;<code>doc id</code>, sẽ dựa trên&nbsp;<code>doc id</code>&nbsp;để thực hiện hash, xác định xem lúc đó&nbsp;<code>doc id</code>&nbsp;đã được phân bổ vào shard nào, từ shard đó để tìm kiếm.</p>
<ul>
<li>Máy khách gửi yêu cầu đến&nbsp;<strong>bất kỳ</strong>&nbsp;một node, trở thành&nbsp;<code>coordinate node</code>.</li>
<li><code>Coordinate node</code>&nbsp;định tuyến&nbsp;<code>doc id</code>&nbsp;theo hash, chuyển yêu cầu đến node tương ứng, lúc này sẽ sử dụng thuật toán&nbsp;<strong>round-robin ngẫu nhiên</strong>, chọn ngẫu nhiên một trong số&nbsp;<code>primary shard</code>&nbsp;và tất cả các replica của nó, để cân bằng tải yêu cầu đọc.</li>
<li>Node nhận yêu cầu trả về document cho&nbsp;<code>coordinate node</code>.</li>
<li><code>Coordinate node</code>&nbsp;trả về document cho máy khách.</li>
</ul>
<h4>2.2.3. Nguyên lý cơ bản của việc ghi dữ liệu</h4>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223111949.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Đầu tiên, dữ liệu sẽ được ghi vào bộ đệm trong bộ nhớ (buffer), trong quá trình này dữ liệu không thể được tìm kiếm; đồng thời dữ liệu cũng được ghi vào tệp nhật ký translog.</p>
<p>Nếu bộ đệm gần như đầy, hoặc sau một khoảng thời gian nhất định, dữ liệu trong bộ đệm sẽ được&nbsp;<code>refresh</code>&nbsp;vào một&nbsp;<code>segment file</code>&nbsp;mới, nhưng lúc này dữ liệu không được ghi trực tiếp vào tệp&nbsp;<code>segment file</code> trên đĩa, mà phải đi vào&nbsp;<code>os cache</code>&nbsp;trước. Quá trình này được gọi là&nbsp;<code>refresh</code>.</p>
<p>Mỗi giây, ES sẽ ghi dữ liệu trong bộ đệm vào một&nbsp;<code>segment file</code>&nbsp;<strong>mới</strong>, mỗi giây sẽ tạo ra một tệp đĩa <code>segment file</code>&nbsp;<strong>mới</strong>, tệp&nbsp;<code>segment file</code> này sẽ lưu trữ dữ liệu được ghi vào bộ đệm trong 1 giây gần đây.</p>
<p>Tuy nhiên, nếu không có dữ liệu trong bộ đệm, thì tất nhiên không có quá trình refresh nào được thực hiện, nếu có dữ liệu trong bộ đệm, mặc định sẽ thực hiện một lần refresh mỗi giây, đẩy dữ liệu vào một&nbsp;<code>segment file</code>&nbsp;mới.</p>
<p>Trên hệ điều hành, tệp đĩa thực tế đều có một thứ gọi là&nbsp;<code>os cache</code>, tức là trước khi dữ liệu được ghi vào tệp đĩa, nó sẽ được đưa vào&nbsp;<code>os cache</code> trước, đầu tiên vào bộ nhớ cache cấp hệ điều hành. Chỉ cần dữ liệu trong bộ đệm được chuyển vào&nbsp;<code>os cache</code>&nbsp;thông qua hoạt động refresh, dữ liệu này có thể được tìm kiếm.</p>
<p>Tại sao nói rằng ES là&nbsp;<strong>gần như thời gian thực</strong>?&nbsp;<code>NRT</code>, tên đầy đủ là&nbsp;<code>near real-time</code>. Mặc định là refresh mỗi giây một lần, vì vậy ES là gần như thời gian thực, vì dữ liệu được ghi vào sau 1 giây mới có thể được tìm thấy. Bạn có thể sử dụng&nbsp;<code>restful api</code>&nbsp;của es hoặc&nbsp;<code>java api</code>&nbsp;để thực hiện một hoạt động refresh&nbsp;<strong>thủ công</strong>, tức là thủ công đưa dữ liệu trong bộ đệm vào&nbsp;<code>os cache</code>, để dữ liệu có thể được tìm kiếm ngay lập tức. Miễn là dữ liệu được đưa vào&nbsp;<code>os cache</code>, bộ đệm sẽ được làm sạch, vì không cần giữ bộ đệm nữa, dữ liệu đã được lưu trữ trong tệp nhật ký translog một lần.</p>
<p>Lặp lại các bước trên, dữ liệu mới liên tục vào bộ đệm và translog, liên tục ghi dữ liệu&nbsp;<code>buffer</code>&nbsp;vào một&nbsp;<code>segment file</code>&nbsp;mới sau mỗi lần&nbsp;<code>refresh</code>, sau mỗi lần&nbsp;<code>refresh</code>&nbsp;bộ đệm sẽ được làm sạch, translog sẽ được giữ lại. Khi quá trình này tiếp diễn, translog sẽ ngày càng lớn. Khi translog đạt đến một độ dài nhất định, nó sẽ kích hoạt hoạt động&nbsp;<code>commit</code>.</p>
<p>Bước đầu tiên của hoạt động commit là ghi dữ liệu hiện có trong bộ đệm vào&nbsp;<code>os cache</code>, sau đó làm sạch bộ đệm. Sau đó, ghi một&nbsp;<code>commit point</code>&nbsp;vào tệp đĩa, trong đó đánh dấu tất cả các&nbsp;<code>segment file</code>&nbsp;tương ứng với&nbsp;<code>commit point</code>&nbsp;này, đồng thời buộc&nbsp;<code>os cache</code>&nbsp;chứa tất cả dữ liệu hiện tại để được&nbsp;<code>fsync</code>&nbsp;vào tệp đĩa. Cuối cùng,&nbsp;<strong>xóa</strong>&nbsp;tệp nhật ký translog hiện tại, khởi động lại một translog, lúc này hoạt động commit đã hoàn thành.</p>
<p>Hoạt động commit này được gọi là&nbsp;<code>flush</code>. Mặc định là mỗi 30 phút tự động thực hiện một lần&nbsp;<code>flush</code>, nhưng nếu translog quá lớn, cũng sẽ kích hoạt&nbsp;<code>flush</code>. Hoạt động flush tương ứng với toàn bộ quá trình commit, chúng ta có thể thông qua api của es, thực hiện thủ công hoạt động flush, thủ công&nbsp;<code>fsync</code>&nbsp;dữ liệu trong&nbsp;<code>os cache</code>&nbsp;vào đĩa.</p>
<p>Tệp nhật ký translog có vai trò gì? Trước khi bạn thực hiện hoạt động commit, dữ liệu có thể đang nằm trong bộ đệm hoặc nằm trong&nbsp;<code>os cache</code>. Dù là bộ đệm hay&nbsp;<code>os cache</code>&nbsp;đều là bộ nhớ, nếu máy này bị hỏng, dữ liệu trong bộ nhớ sẽ mất hết. Vì vậy, cần ghi các hoạt động tương ứng của dữ liệu vào một tệp nhật ký đặc biệt là&nbsp;<code>translog</code>, nếu máy bị hỏng lúc này, khi khởi động lại, es sẽ tự động đọc dữ liệu từ tệp nhật ký translog và phục hồi vào bộ nhớ&nbsp;<code>buffer</code>&nbsp;và&nbsp;<code>os cache</code>.</p>
<p>Thực tế, translog cũng được ghi vào&nbsp;<code>os cache</code>&nbsp;trước, mặc định là mỗi 5 giây sẽ đẩy vào đĩa một lần, vì vậy mặc định, có thể có 5 giây dữ liệu chỉ nằm trong bộ đệm hoặc <code>os cache</code> hoặc tệp translog, không nằm trên đĩa, nếu máy này bị hỏng lúc này, sẽ&nbsp;<strong>mất</strong>&nbsp;5 giây dữ liệu. Nhưng hiệu suất như vậy tốt hơn, mất tối đa 5 giây dữ liệu. Bạn cũng có thể đặt translog để mỗi lần ghi phải&nbsp;<code>fsync</code>&nbsp;trực tiếp vào đĩa, nhưng hiệu suất sẽ kém hơn nhiều.</p>
<p>Thực tế, nếu bạn ở đây, nếu người phỏng vấn không hỏi bạn về vấn đề mất dữ liệu của es, bạn có thể tự hào với người phỏng vấn ở đây, bạn nói, thực tế es trước tiên là gần như thời gian thực, dữ liệu được ghi vào sau 1 giây mới có thể được tìm thấy; có thể mất dữ liệu. Có 5 giây dữ liệu, nằm trong bộ đệm,&nbsp;<code>os cache</code>&nbsp;của translog,&nbsp;<code>os cache</code>&nbsp;của&nbsp;<code>segment file</code>, không nằm trên đĩa, nếu máy này bị hỏng lúc này, sẽ dẫn đến&nbsp;<strong>mất</strong>&nbsp;5 giây dữ liệu.</p>
<p><strong>Tóm lại</strong>, dữ liệu được ghi vào bộ đệm trước, sau đó mỗi giây, dữ liệu sẽ được refresh vào&nbsp;<code>os cache</code>, khi dữ liệu đến&nbsp;<code>os cache</code>, dữ liệu có thể được tìm kiếm (đó là lý do tại sao chúng ta nói rằng từ khi dữ liệu được ghi vào cho đến khi có thể tìm kiếm, có độ trễ 1s). Mỗi 5 giây, dữ liệu sẽ được ghi vào tệp translog (do đó, nếu máy bị hỏng, tất cả dữ liệu trong bộ nhớ sẽ mất, tối đa sẽ mất 5s dữ liệu), khi translog lớn đến một mức độ nhất định, hoặc mặc định mỗi 30 phút, một hoạt động commit sẽ được kích hoạt, đẩy tất cả dữ liệu trong bộ đệm vào tệp&nbsp;<code>segment file</code>trên đĩa.</p>
<blockquote>
<p>Sau khi dữ liệu được ghi vào&nbsp;<code>segment file</code>, chỉ mục đảo ngược cũng sẽ được tạo ngay lập tức.</p>
</blockquote>
<h4>2.2.4. Nguyên lý cơ bản khi xóa/cập nhật dữ liệu</h4>
<p>Nếu là hoạt động xóa, khi commit sẽ tạo ra một tệp&nbsp;<code>.del</code>, trong đó đánh dấu một doc nhất định là trạng thái&nbsp;<code>deleted</code>, vì vậy khi tìm kiếm, dựa vào tệp&nbsp;<code>.del</code>, bạn sẽ biết liệu doc có bị xóa hay không.</p>
<p>Nếu là hoạt động cập nhật, nó sẽ đánh dấu doc gốc là trạng thái&nbsp;<code>deleted</code>&nbsp;và sau đó ghi một dữ liệu mới.</p>
<p>Mỗi khi bộ đệm được refresh, một&nbsp;<code>segment file</code>&nbsp;sẽ được tạo ra, vì vậy mặc định là một&nbsp;<code>segment file</code>&nbsp;mỗi giây, vì vậy&nbsp;<code>segment file</code>&nbsp;sẽ ngày càng nhiều, lúc này sẽ thường xuyên thực hiện merge. Mỗi lần merge, nhiều&nbsp;<code>segment file</code>&nbsp;sẽ được hợp nhất thành một, đồng thời ở đây, doc được đánh dấu là&nbsp;<code>deleted</code>&nbsp;sẽ được&nbsp;<strong>xóa vật lý</strong>, sau đó ghi&nbsp;<code>segment file</code>&nbsp;mới vào đĩa, ở đây sẽ ghi một&nbsp;<code>commit point</code>, đánh dấu tất cả&nbsp;<code>segment file</code>&nbsp;mới, sau đó mở&nbsp;<code>segment file</code>&nbsp;để tìm kiếm, và sau đó xóa&nbsp;<code>segment file</code>&nbsp;cũ.</p>
<h4>2.2.5. Lớp cơ bản Lucene</h4>
<p>Đơn giản, Lucene chỉ là một thư viện jar, bên trong nó chứa các mã thuật toán đã được đóng gói để tạo chỉ mục đảo ngược. Khi chúng ta phát triển bằng Java, chúng ta chỉ cần import thư viện jar Lucene, sau đó phát triển dựa trên API của Lucene.</p>
<p>Thông qua Lucene, chúng ta có thể tạo chỉ mục cho dữ liệu hiện có, Lucene sẽ tổ chức cấu trúc dữ liệu chỉ mục trên ổ đĩa cục bộ cho chúng ta.</p>
<h4>2.2.5. Chỉ mục đảo ngược</h4>
<p>Trong công cụ tìm kiếm, mỗi tài liệu đều có một ID tài liệu tương ứng, nội dung tài liệu được biểu diễn dưới dạng một tập hợp các từ khóa. Ví dụ, sau khi phân loại, tài liệu 1 đã trích xuất 20 từ khóa, mỗi từ khóa đều ghi lại số lần xuất hiện và vị trí xuất hiện của nó trong tài liệu.</p>
<p>Vậy, chỉ mục đảo ngược là ánh xạ từ&nbsp;<strong>từ khóa đến ID tài liệu</strong>, mỗi từ khóa đều tương ứng với một loạt tài liệu, trong đó tất cả các tài liệu đều xuất hiện từ khóa.</p>
<p>Ví dụ.</p>
<p>Có các tài liệu sau:</p>
<p>| DocId | Doc                                                                           |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/deploy3.png" type="image/png"/>
    </item>
    <item>
      <title>Elasticsearch</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Elasticsearch Aggregation</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/aggregation.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/aggregation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Aggregation</source>
      <description>Elasticsearch Aggregations Elasticsearch là một công cụ tìm kiếm toàn văn bản phân tán, lập chỉ mục và tìm kiếm là các chức năng cơ bản của Elasticsearch. Thực tế, chức năng Agg...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Elasticsearch là một công cụ tìm kiếm toàn văn bản phân tán, lập chỉ mục và tìm kiếm là các chức năng cơ bản của Elasticsearch. Thực tế, chức năng Aggregations của Elasticsearch cũng rất mạnh mẽ, cho phép thực hiện phân tích thống kê phức tạp trên dữ liệu. Elasticsearch cung cấp bốn loại chức năng phân tích tổng hợp chính, bao gồm <strong>aggregations chỉ số (metrics aggregations)</strong>, <strong>aggregations thùng (bucket aggregations)</strong>, <strong>aggregations ống (pipeline aggregations)</strong> và <strong>aggregations ma trận (matrix aggregations)</strong>. Aggregations ống và aggregations ma trận đang trong giai đoạn thử nghiệm theo thông báo chính thức, và sẽ được thay đổi hoàn toàn hoặc loại bỏ sau này, vì vậy chúng tôi sẽ không giải thích về aggregations ống và aggregations ma trận ở đây.</p>
<h2>Cấu trúc cụ thể của Aggregations</h2>
<p>Tất cả các aggregations, bất kể loại nào, đều tuân theo các quy tắc sau.</p>
<ul>
<li>Chúng được định nghĩa trong cùng một yêu cầu JSON như truy vấn, và bạn đánh dấu chúng bằng cách sử dụng khóa aggregations hoặc aggs. Bạn cần đặt tên cho mỗi aggregation, chỉ định loại của nó và các tùy chọn liên quan đến loại đó.</li>
<li>Chúng chạy trên kết quả của truy vấn. Các tài liệu không khớp với truy vấn sẽ không được tính, trừ khi bạn sử dụng aggregation global để bao gồm các tài liệu không khớp.</li>
<li>Chúng có thể lọc thêm kết quả của truy vấn mà không ảnh hưởng đến aggregation.</li>
</ul>
<p>Dưới đây là cấu trúc cơ bản của aggregation:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379">"aggregations"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">&lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Khóa</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggregation</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> ở</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> cấp</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> độ</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> cao</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> nhất,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> cũng</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> có</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> thể</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> viết</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> tắt</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> là</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggs</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "&lt;aggregation_name&gt;"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">&lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Tên</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> tùy</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> chỉnh</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> của</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggregation</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "&lt;aggregation_type&gt;"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">&lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Loại</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggregation,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> liên</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> quan</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> đến</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> chỉ</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> số</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> như</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> max,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> min,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> avg,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> sum,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> liên</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> quan</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> đến</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> thùng</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> như</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> terms,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> filter,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> v.v.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">            &lt;aggregation_body&gt;</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> &lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Thân</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggregation</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">trường</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> nào</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> sẽ</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> được</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> tổng</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> hợp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">có</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> thể</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> lấy</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> giá</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> trị</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> của</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> trường</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> hoặc</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> kết</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> quả</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> của</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> script</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        [,</span><span style="color:#98C379;--shiki-dark:#98C379">"meta"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {  </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">[&lt;meta_data_body&gt;]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } ]</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">?</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> &lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Meta</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        [,</span><span style="color:#98C379;--shiki-dark:#98C379">"aggregations"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">[&lt;sub_aggregation&gt;]+</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } ]</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">?</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> &lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Định</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> nghĩa</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> sub-aggregation</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> trong</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggregation</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    [,</span><span style="color:#98C379;--shiki-dark:#98C379">"&lt;aggregation_name_2&gt;"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } ]</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">*</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> &lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Tên</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> tùy</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> chỉnh</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> của</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggregation</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><ul>
<li><strong>Ở cấp độ cao nhất có một khóa aggregations, có thể viết tắt là aggs</strong>.</li>
<li>Ở cấp độ tiếp theo, bạn cần chỉ định tên cho aggregation. Bạn sẽ thấy tên này trong kết quả trả về của yêu cầu. Điều này rất hữu ích khi sử dụng nhiều aggregation trong cùng một yêu cầu, nó giúp bạn dễ dàng hiểu ý nghĩa của mỗi nhóm kết quả.</li>
<li>Cuối cùng, bạn phải chỉ định loại aggregation.</li>
</ul>
<blockquote>
<p>Giá trị phân tích tổng hợp có thể <strong>lấy từ giá trị của trường</strong> hoặc là <strong>kết quả của script</strong>.</p>
<p>Tuy nhiên, khi sử dụng kết quả của script, bạn cần chú ý đến hiệu suất và an toàn của script; mặc dù hầu hết các loại aggregation đều cho phép sử dụng script, nhưng script làm chậm aggregation vì script phải chạy trên mỗi tài liệu. Để tránh chạy script, bạn có thể tính toán trong giai đoạn lập chỉ mục.</p>
<p>Ngoài ra, script cũng có thể bị sử dụng để tấn công mã độc, hãy cố gắng sử dụng ngôn ngữ script trong sandbox.</p>
</blockquote>
<p>Ví dụ: Truy vấn tuổi trung bình của tất cả các cầu thủ là bao nhiêu, và cộng 188 vào mức lương trung bình của cầu thủ (cũng có thể hiểu là mức lương trung bình sau khi cộng thêm 188 cho mỗi cầu thủ).</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /player/_search?size=</span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "aggs"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "avg_age"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "avg"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "field"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "age"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "avg_salary_188"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "avg"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "script"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "source"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "doc.salary.value + 188"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Aggregations chỉ số</h2>
<p>Aggregations chỉ số (còn được gọi là aggregations đo lường) chủ yếu rút ra dữ liệu thống kê từ các nhóm tài liệu khác nhau, hoặc từ các thùng tài liệu từ các aggregations khác.</p>
<p>Những dữ liệu thống kê này thường đến từ các trường số, như giá trị nhỏ nhất hoặc trung bình. Người dùng có thể lấy từng dữ liệu thống kê riêng lẻ, hoặc cũng có thể sử dụng aggregations stats để lấy chúng cùng một lúc. Dữ liệu thống kê nâng cao hơn, như tổng bình phương hoặc độ lệch chuẩn, có thể được lấy thông qua aggregations extended stats.</p>
<h3>Max Aggregation</h3>
<p>Max Aggregation được sử dụng để thống kê giá trị lớn nhất. Ví dụ, để thống kê cuốn sách có giá cao nhất trong chỉ mục sales, và tính giá trị gấp đôi của giá đó, câu truy vấn như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /sales/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "max_price" : {</span></span>
<span class="line"><span>      "max" : {</span></span>
<span class="line"><span>        "field" : "price"</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    "max_price_2" : {</span></span>
<span class="line"><span>      "max" : {</span></span>
<span class="line"><span>        "field" : "price",</span></span>
<span class="line"><span>        "script": {</span></span>
<span class="line"><span>          "source": "_value * 2.0"</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Trường được chỉ định, trong script có thể lấy giá trị của trường bằng _value</strong>.</p>
<p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "max_price": {</span></span>
<span class="line"><span>      "value": 188.0</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    "max_price_2": {</span></span>
<span class="line"><span>      "value": 376.0</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Min Aggregation</h3>
<p>Min Aggregation được sử dụng để thống kê giá trị nhỏ nhất. Ví dụ, để thống kê cuốn sách có giá thấp nhất trong chỉ mục sales, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /sales/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "min_price" : {</span></span>
<span class="line"><span>      "min" : {</span></span>
<span class="line"><span>        "field" : "price"</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "min_price": {</span></span>
<span class="line"><span>      "value": 18.0</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Avg Aggregation</h3>
<p>Avg Aggregation được sử dụng để tính giá trị trung bình. Ví dụ, để thống kê điểm trung bình của kỳ thi trong chỉ mục exams, nếu không có điểm số, mặc định là 60 điểm, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /exams/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "avg_grade" : {</span></span>
<span class="line"><span>      "avg" : {</span></span>
<span class="line"><span>        "field" : "grade",</span></span>
<span class="line"><span>        "missing": 60</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p><strong>Nếu trường chỉ định không có giá trị, bạn có thể chỉ định giá trị mặc định bằng missing; nếu không chỉ định giá trị mặc định, tài liệu thiếu giá trị trường này sẽ bị bỏ qua (tính toán)</strong>.</p>
<p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "avg_grade": {</span></span>
<span class="line"><span>      "value": 78.0</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Ngoài tính toán aggregation trung bình thông thường, elasticsearch cũng cung cấp tính toán aggregation trung bình có trọng số, chi tiết xem tại <a href="https://www.knowledgedict.com/tutorial/elasticsearch-aggregations-metrics-weighted-avg-aggregation.html" target="_blank" rel="noopener noreferrer">Elasticsearch Aggregations chỉ số - Weighted Avg Aggregation</a>.</p>
<h3>Sum Aggregation</h3>
<p>Sum Aggregation được sử dụng để tính tổng. Ví dụ, để thống kê tổng giá của các mặt hàng có loại là "hat" trong chỉ mục sales, câu truy vấn như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /sales/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query" : {</span></span>
<span class="line"><span>    "constant_score" : {</span></span>
<span class="line"><span>      "filter" : {</span></span>
<span class="line"><span>        "match" : { "type" : "hat" }</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "hat_prices" : {</span></span>
<span class="line"><span>      "sum" : { "field" : "price" }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "hat_prices": {</span></span>
<span class="line"><span>      "value": 567.0</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Value Count Aggregation</h3>
<p>Value Count Aggregation có thể được sử dụng để đếm số lượng tài liệu theo trường. Ví dụ, để đếm số lượng tài liệu có trường author trong chỉ mục books, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /books/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "doc_count" : {</span></span>
<span class="line"><span>      "value_count" : { "field" : "author" }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "doc_count": {</span></span>
<span class="line"><span>      "value": 5</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Cardinality Aggregation</h3>
<p>Cardinality Aggregation được sử dụng cho thống kê cơ sở, nhiệm vụ của nó là thực hiện các hoạt động tương tự như distinct trong SQL, loại bỏ các mục trùng lặp trong tập hợp, sau đó đếm độ dài của tập hợp sau khi loại bỏ trùng lặp. Ví dụ, thực hiện hoạt động cardinality trên trường language trong chỉ mục books có thể đếm số lượng ngôn ngữ lập trình, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /books/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "all_lan" : {</span></span>
<span class="line"><span>      "cardinality" : { "field" : "language" }</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    "title_cnt" : {</span></span>
<span class="line"><span>      "cardinality" : { "field" : "title.keyword" }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p><strong>Giả sử trường title là kiểu văn bản (text), khi loại bỏ trùng lặp, bạn cần chỉ định keyword, có nghĩa là xem title như một thể thống nhất, tức là không phân tách từ để đếm</strong>.</p>
<p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "all_lan": {</span></span>
<span class="line"><span>      "value": 8</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    "title_cnt": {</span></span>
<span class="line"><span>      "value": 18</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Stats Aggregation</h3>
<p>Stats Aggregation được sử dụng để thống kê cơ bản, sẽ trả về 5 chỉ số count, max, min, avg và sum cùng một lúc. Ví dụ, để thống kê cơ bản liên quan đến điểm số trên trường grade trong chỉ mục exams, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /exams/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "grades_stats" : {</span></span>
<span class="line"><span>      "stats" : { "field" : "grade" }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "grades_stats": {</span></span>
<span class="line"><span>      "count": 2,</span></span>
<span class="line"><span>      "min": 50.0,</span></span>
<span class="line"><span>      "max": 100.0,</span></span>
<span class="line"><span>      "avg": 75.0,</span></span>
<span class="line"><span>      "sum": 150.0</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Extended Stats Aggregation</h3>
<p>Extended Stats Aggregation được sử dụng cho thống kê nâng cao, tương tự như thống kê cơ bản, nhưng sẽ có thêm một số kết quả thống kê sau, sum_of_squares (tổng bình phương), variance (phương sai), std_deviation (độ lệch chuẩn), std_deviation_bounds (khoảng giữa giá trị trung bình cộng/trừ hai độ lệch chuẩn). Để thống kê nâng cao liên quan đến điểm số trên trường grade trong chỉ mục exams, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /exams/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "grades_stats" : {</span></span>
<span class="line"><span>      "extended_stats" : { "field" : "grade" }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Kết quả aggregation như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "grades_stats": {</span></span>
<span class="line"><span>      "count": 2,</span></span>
<span class="line"><span>      "min": 50.0,</span></span>
<span class="line"><span>      "max": 100.0,</span></span>
<span class="line"><span>      "avg": 75.0,</span></span>
<span class="line"><span>      "sum": 150.0,</span></span>
<span class="line"><span>      "sum_of_squares": 12500.0,</span></span>
<span class="line"><span>      "variance": 625.0,</span></span>
<span class="line"><span>      "std_deviation": 25.0,</span></span>
<span class="line"><span>      "std_deviation_bounds": {</span></span>
<span class="line"><span>        "upper": 125.0,</span></span>
<span class="line"><span>        "lower": 25.0</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Percentiles Aggregation</h3>
<p>Percentiles Aggregation được sử dụng cho thống kê phân vị. Phân vị là một thuật ngữ thống kê, nếu ta sắp xếp một tập dữ liệu từ lớn đến nhỏ và tính toán phần trăm lũy kế tương ứng, giá trị của dữ liệu tương ứng với phân vị đó được gọi là phân vị của phân vị đó. Theo mặc định, các phân vị lũy kế là [ 1, 5, 25, 50, 75, 95, 99 ]. Ví dụ sau đây cho thấy cách thống kê phân vị thời gian tải trên trường load_time trong chỉ mục latency, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET latency/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "size": 0,</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "load_time_outlier" : {</span></span>
<span class="line"><span>      "percentiles" : {</span></span>
<span class="line"><span>        "field" : "load_time"</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p><strong>Cần lưu ý rằng, trường <code>load_time</code> như trên phải là loại số</strong>.</p>
<p>Kết quả tổng hợp như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "load_time_outlier": {</span></span>
<span class="line"><span>      "values" : {</span></span>
<span class="line"><span>        "1.0": 5.0,</span></span>
<span class="line"><span>        "5.0": 25.0,</span></span>
<span class="line"><span>        "25.0": 165.0,</span></span>
<span class="line"><span>        "50.0": 445.0,</span></span>
<span class="line"><span>        "75.0": 725.0,</span></span>
<span class="line"><span>        "95.0": 945.0,</span></span>
<span class="line"><span>        "99.0": 985.0</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Thống kê phân vị cũng có thể chỉ định tham số percents để chỉ định phân vị, như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET latency/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "size": 0,</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "load_time_outlier" : {</span></span>
<span class="line"><span>      "percentiles" : {</span></span>
<span class="line"><span>        "field" : "load_time",</span></span>
<span class="line"><span>        "percents": [60, 80, 95]</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Percentiles Ranks Aggregation</h3>
<p>Percentiles Ranks Aggregation có ý nghĩa ngược lại với Percentiles Aggregation, đó là muốn xem giá trị hiện tại nằm trong phạm vi nào (phân vị). Giả sử bạn kiểm tra xem giá trị hiện tại 500 và 600 nằm ở phân vị nào, phát hiện ra là 90.01 và 100, điều đó có nghĩa là 90.01% của các giá trị đều nằm trong phạm vi 500, và 100% của các giá trị nằm trong phạm vi 600.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET latency/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "size": 0,</span></span>
<span class="line"><span>    "aggs" : {</span></span>
<span class="line"><span>      "load_time_ranks" : {</span></span>
<span class="line"><span>        "percentile_ranks" : {</span></span>
<span class="line"><span>          "field" : "load_time",</span></span>
<span class="line"><span>          "values" : [500, 600]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p><strong>Trường <code>load_time</code> cũng phải là loại số</strong>.</p>
<p>Kết quả trả về sẽ tương tự như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "load_time_ranks": {</span></span>
<span class="line"><span>      "values" : {</span></span>
<span class="line"><span>        "500.0": 90.01,</span></span>
<span class="line"><span>        "600.0": 100.0</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Bạn có thể đặt tham số <code>keyed</code> là <code>true</code> để trả về các giá trị tương ứng như là key của các bucket, mặc định là <code>false</code>.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET latency/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "size": 0,</span></span>
<span class="line"><span>  "aggs": {</span></span>
<span class="line"><span>    "load_time_ranks": {</span></span>
<span class="line"><span>      "percentile_ranks": {</span></span>
<span class="line"><span>        "field": "load_time",</span></span>
<span class="line"><span>        "values": [500, 600],</span></span>
<span class="line"><span>        "keyed": true</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Kết quả trả về như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "load_time_ranks": {</span></span>
<span class="line"><span>      "values": [</span></span>
<span class="line"><span>        {</span></span>
<span class="line"><span>          "key": 500.0,</span></span>
<span class="line"><span>          "value": 90.01</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>        {</span></span>
<span class="line"><span>          "key": 600.0,</span></span>
<span class="line"><span>          "value": 100.0</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      ]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Bucket Aggregation</h2>
<p>Bucket có thể được hiểu như một cái thùng, nó sẽ duyệt qua nội dung của tài liệu, những gì phù hợp với một yêu cầu nhất định sẽ được đặt vào một thùng, phân thùng tương đương với group by trong SQL. Từ một góc độ khác, bạn có thể xem metric aggregation như là bucket aggregation đơn, tức là đặt tất cả tài liệu vào một thùng, trong khi bucket aggregation là multi-bucket aggregation, nó phân nhóm theo các điều kiện tương ứng.</p>
<p>| Loại                          | Mô tả/Trường hợp sử dụng                                                                                                                                                                                |<br>
| :</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Analyzer</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/analyzer.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/analyzer.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Analyzer</source>
      <description>Elasticsearch Analyzer Phân tích văn bản là quá trình chuyển đổi toàn bộ văn bản thành một chuỗi các từ (term/token), còn được gọi là phân từ. Trong Elasticsearch, phân từ được ...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Phân tích văn bản là quá trình chuyển đổi toàn bộ văn bản thành một chuỗi các từ (term/token), còn được gọi là phân từ. Trong Elasticsearch, phân từ được thực hiện thông qua analyzer (bộ phân tích), dù là chỉ mục hay tìm kiếm, đều cần sử dụng analyzer (bộ phân tích). Bộ phân tích, chia thành&nbsp;<strong>bộ phân tích được xây dựng sẵn</strong>&nbsp;và&nbsp;<strong>bộ phân tích tùy chỉnh</strong>.</p>
<p>Bộ phân tích có thể được phân loại thành ba phần là&nbsp;<strong>bộ lọc ký tự</strong>(<strong>Character Filters</strong>),&nbsp;<strong>bộ phân từ</strong>&nbsp;(<strong>Tokenizer</strong>) và&nbsp;<strong>bộ lọc từ</strong>&nbsp;(<strong>Token Filters</strong>). Thứ tự thực thi của nó như sau:</p>
<p><strong><em>character filters</em></strong>&nbsp;-&gt;&nbsp;<strong><em>tokenizer</em></strong>&nbsp;-&gt;&nbsp;<strong><em>token filters</em></strong></p>
<h2>Bộ lọc ký tự (Character Filters)</h2>
<p>Bộ lọc ký tự nhận đầu vào là văn bản gốc, nếu cấu hình nhiều hơn, nó sẽ thực hiện theo thứ tự cấu hình. Hiện tại ES có 3 loại bộ lọc ký tự chính:</p>
<ol>
<li><strong>html strip character filter</strong>: Loại bỏ các phần tử HTML khỏi văn bản và thay thế các thực thể HTML bằng giá trị giải mã của chúng (ví dụ, thay thế <strong><em><code>＆amp;</code></em></strong> bằng <strong><em><code>＆</code></em></strong>).</li>
<li><strong>mapping character filter</strong>: Tự định nghĩa một bản đồ ánh xạ, có thể thực hiện một số thay thế tùy chỉnh, như thường được sử dụng để thay đổi chữ hoa thành chữ thường cũng có thể được thiết lập tại đây.</li>
<li><strong>pattern replace character filter</strong>: Sử dụng biểu thức chính quy java để khớp các ký tự cần thay thế bằng chuỗi thay thế được chỉ định, ngoài ra, chuỗi thay thế có thể tham chiếu đến nhóm bắt trong biểu thức chính quy.</li>
</ol>
<h3>HTML strip character filter</h3>
<p>Ví dụ về HTML strip:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_analyze</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "tokenizer"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "keyword",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "char_filter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "html_strip"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "text"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "&lt;p&gt;I&amp;apos;m so &lt;b&gt;happy&lt;/b&gt;!&lt;/p&gt;"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Sau khi xử lý bằng bộ lọc ký tự <strong><em><code>html_strip</code></em></strong>, đầu ra như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[ \nI'm so happy!\n ]</span></span></code></pre>
</div><h3>Mapping character filter</h3>
<p>Mapping character filter nhận một bản đồ ánh xạ giữa khóa và giá trị (key =&gt; value) như tham số cấu hình, mỗi khi gặp một chuỗi trong văn bản gốc giống với khóa trong bản đồ ánh xạ, nó sẽ thay thế chuỗi đó bằng giá trị tương ứng của khóa.</p>
<p>Việc khớp chuỗi trong văn bản gốc với khóa trong bản đồ ánh xạ là tham lam, nếu có sự chồng chéo giữa các khóa trong bản đồ ánh xạ, nó sẽ ưu tiên <strong>khớp khóa dài nhất</strong>. Cũng có thể thay thế bằng chuỗi rỗng.</p>
<p>mapping char_filter không giống như html_strip có thể sử dụng ngay lập tức, nó cần được cấu hình trước khi sử dụng, nó có hai thuộc tính có thể cấu hình:</p>
<p>| Tên tham số              | Mô tả tham số                                                                                       |<br>
| :</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Cluster and Shard</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/cluster-shard.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/cluster-shard.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Cluster and Shard</source>
      <description>Elasticsearch Clusters và Shards Clusters Cluster trống Nếu chúng ta khởi động một nút đơn lẻ không chứa bất kỳ dữ liệu hay chỉ mục nào, cluster của chúng ta sẽ trông như một cl...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Clusters</h2>
<h3>Cluster trống</h3>
<p>Nếu chúng ta khởi động một nút đơn lẻ không chứa bất kỳ dữ liệu hay chỉ mục nào, cluster của chúng ta sẽ trông như một cluster với một nút nội dung trống.</p>
<p><strong>Hình 1. Cluster với nút nội dung trống</strong></p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/elas_0201.png" alt="Cluster với nút nội dung trống" tabindex="0" loading="lazy"><figcaption>Cluster với nút nội dung trống</figcaption></figure>
<p>Hình 1: Cluster chỉ có một nút trống</p>
<p>Một thực thể Elasticsearch đang chạy được gọi là một <strong>nút</strong>, và một <strong>cluster</strong> bao gồm một hoặc nhiều nút với cấu hình <code>cluster.name</code> giống nhau. Chúng cùng nhau chịu áp lực của dữ liệu và tải. Khi các nút được thêm vào hoặc loại bỏ khỏi cluster, cluster sẽ phân phối lại tất cả dữ liệu một cách đều.</p>
<p>Khi một nút được bầu làm <strong>nút chính</strong>, nó chịu trách nhiệm quản lý <strong>tất cả các thay đổi</strong> trong phạm vi cluster, chẳng hạn như thêm hoặc xóa chỉ mục, hoặc thêm hoặc xóa các nút, v.v. Nút chính không cần tham gia vào các thay đổi cấp độ tài liệu và tìm kiếm, vì vậy ngay cả khi lưu lượng tăng lên, nó sẽ không trở thành một nút cổ chai khi cluster chỉ có một nút chính. Bất kỳ nút nào cũng có thể trở thành nút chính. Cluster mẫu của chúng ta chỉ có một nút, vì vậy nó cũng trở thành nút chính.</p>
<p>Là người dùng, chúng ta có thể gửi yêu cầu đến bất kỳ nút nào trong cluster, bao gồm cả nút chính. Mỗi nút đều biết vị trí của bất kỳ tài liệu nào và có thể chuyển tiếp yêu cầu của chúng ta trực tiếp đến nút lưu trữ tài liệu mà chúng ta cần. Không quan trọng chúng ta gửi yêu cầu đến nút nào, nút đó có thể chịu trách nhiệm thu thập dữ liệu từ tất cả các nút chứa tài liệu mà chúng ta cần và trả kết quả cuối cùng cho máy khách. Elasticsearch quản lý tất cả mọi thứ này một cách trong suốt.</p>
<h3>Cluster Health</h3>
<p>Thông tin giám sát cluster của Elasticsearch chứa nhiều dữ liệu thống kê, trong đó quan trọng nhất là <em>sức khỏe của cluster</em>, được hiển thị là <code>green</code>, <code>yellow</code>, hoặc <code>red</code> trong trường <code>status</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cluster/health</span></span></code></pre>
</div><p>Trong một cluster trống không chứa bất kỳ chỉ mục nào, nó sẽ có nội dung trả về tương tự như sau:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "cluster_name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"elasticsearch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "status"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"green"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "timed_out"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_nodes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_data_nodes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_primary_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "relocating_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "initializing_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "unassigned_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Trường <code>status</code> chỉ ra liệu cluster hiện tại có hoạt động bình thường tổng thể hay không. Ba màu của nó có ý nghĩa như sau:</p>
<ul>
<li><strong><code>green</code></strong>: Tất cả các shard chính và shard phụ đều hoạt động bình thường.</li>
<li><strong><code>yellow</code></strong>: Tất cả các shard chính đều hoạt động bình thường, nhưng không phải tất cả các shard phụ đều hoạt động bình thường.</li>
<li><strong><code>red</code></strong>: Có shard chính không hoạt động bình thường.</li>
</ul>
<h3>Thêm chỉ mục</h3>
<p>Khi chúng ta thêm dữ liệu vào Elasticsearch, chúng ta cần sử dụng <em>chỉ mục</em> - nơi lưu trữ dữ liệu liên quan. Chỉ mục thực ra là không gian tên logic trỏ đến một hoặc nhiều shard vật lý.</p>
<p>Một <em>shard</em> là một <em>đơn vị công việc</em> cơ bản, nó chỉ lưu trữ một phần của tất cả dữ liệu. Bây giờ chúng ta chỉ cần biết một shard là một thể hiện của Lucene, và nó chính là một công cụ tìm kiếm hoàn chỉnh. Tài liệu của chúng ta được lưu trữ và chỉ mục trong shard, nhưng ứng dụng thực hiện tương tác trực tiếp với chỉ mục chứ không phải với shard.</p>
<p>Elasticsearch sử dụng shard để phân phối dữ liệu đến các nơi khác nhau trong cluster. shard là bộ chứa dữ liệu, tài liệu được lưu trữ trong shard, và shard được phân bổ đến các nút khác nhau trong cluster. Khi kích thước của cluster của bạn mở rộng hoặc thu hẹp, Elasticsearch sẽ tự động di chuyển shard giữa các nút, để dữ liệu vẫn được phân phối đều trong cluster.</p>
<p>Một shard có thể là shard <em>chính</em> hoặc shard <em>sao lưu</em>. Bất kỳ tài liệu nào trong chỉ mục đều thuộc về một shard chính, vì vậy số lượng shard chính quyết định lượng dữ liệu tối đa mà chỉ mục có thể lưu trữ.</p>
<blockquote>
<p>Kỹ thuật, một shard chính có thể lưu trữ tối đa <code>Integer.MAX_VALUE - 128</code> tài liệu, nhưng giá trị tối đa thực tế còn phụ thuộc vào tình huống sử dụng của bạn: bao gồm phần cứng bạn sử dụng, kích thước và độ phức tạp của tài liệu, cách chỉ mục và truy vấn tài liệu cũng như thời gian phản hồi mong đợi của bạn.</p>
</blockquote>
<p>Một shard sao lưu chỉ là một bản sao của shard chính. shard sao lưu đóng vai trò là bản sao dự phòng dư thừa để bảo vệ dữ liệu không bị mất khi xảy ra lỗi phần cứng, và cung cấp dịch vụ cho các hoạt động đọc như tìm kiếm và trả về tài liệu.</p>
<p>Số shard chính đã được xác định khi tạo chỉ mục, nhưng số shard sao lưu có thể được thay đổi bất cứ lúc nào.</p>
<p>Hãy tạo một chỉ mục có tên <code>blogs</code> trong một cluster với một nút trống. Theo mặc định, chỉ mục sẽ được phân bổ 5 shard chính, nhưng vì mục đích minh họa, chúng tôi sẽ phân bổ 3 shard chính và một bản sao (mỗi shard chính có một shard sao lưu):</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">PUT /blogs</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">   "settings"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "number_of_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "number_of_replicas"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">   }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Cluster của chúng ta hiện tại là <em>một cluster đơn nút có một chỉ mục</em>. Tất cả 3 shard chính đều được phân bổ tại <code>Node 1</code>.</p>
<p><strong>Hình 2. Cluster đơn nút có một chỉ mục</strong></p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/elas_0202.png" alt="Cluster đơn nút có một chỉ mục" tabindex="0" loading="lazy"><figcaption>Cluster đơn nút có một chỉ mục</figcaption></figure>
<p>Nếu chúng ta kiểm tra sức khỏe của cluster ngay bây giờ, chúng ta sẽ thấy nội dung sau:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "cluster_name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"elasticsearch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "status"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"yellow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "timed_out"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_nodes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_data_nodes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_primary_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "relocating_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "initializing_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "unassigned_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "delayed_unassigned_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_pending_tasks"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_in_flight_fetch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "task_max_waiting_in_queue_millis"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_shards_percent_as_number"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">50</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>Giá trị status của cluster là yellow</li>
<li>Số lượng shard sao lưu không được phân bổ cho bất kỳ nút nào</li>
</ul>
<p>Sức khỏe của cluster ở trạng thái <code>yellow</code> có nghĩa là tất cả các shard <em>chính</em> đều hoạt động bình thường (cluster có thể phục vụ tất cả các yêu cầu), nhưng không phải tất cả các shard <em>sao lưu</em> đều ở trạng thái bình thường. Thực tế, tất cả 3 shard sao lưu đều là <code>unassigned</code> - chúng không được phân bổ cho bất kỳ nút nào. Việc lưu trữ dữ liệu gốc và bản sao trên cùng một nút không có ý nghĩa, bởi vì một khi chúng ta mất nút đó, chúng ta cũng sẽ mất tất cả dữ liệu bản sao trên nút đó.</p>
<p>Hiện tại, cluster của chúng ta đang hoạt động bình thường, nhưng có nguy cơ mất dữ liệu khi xảy ra lỗi phần cứng.</p>
<h3>Thêm khả năng chuyển đổi khi gặp sự cố</h3>
<p>Khi chỉ có một nút đang hoạt động trong cluster, điều này có nghĩa là sẽ có một vấn đề về điểm lỗi đơn - không có sự dự phòng. May mắn thay, chúng ta chỉ cần khởi động thêm một nút nữa để ngăn chặn mất dữ liệu.</p>
<blockquote>
<p>Để kiểm tra tình hình sau khi khởi động nút thứ hai, bạn có thể khởi động một nút mới trong cùng một thư mục, hoàn toàn tuân theo cách khởi động nút đầu tiên (xem Cài đặt và chạy Elasticsearch). Nhiều nút có thể chia sẻ cùng một thư mục.</p>
<p>Khi bạn khởi động nút thứ hai trên cùng một máy, miễn là nó có cấu hình <code>cluster.name</code> giống với nút đầu tiên, nó sẽ tự động phát hiện cluster và tham gia vào đó. Tuy nhiên, khi khởi động nút trên các máy khác nhau, để tham gia vào cùng một cluster, bạn cần cấu hình danh sách host unicast có thể kết nối.</p>
</blockquote>
<p>Nếu chúng ta khởi động một nút thứ hai, cluster của chúng ta sẽ trở thành một cluster với hai nút - tất cả các shard chính và shard sao lưu đều đã được phân bổ.</p>
<p><strong>Hình 3. Cluster với hai nút - tất cả các shard chính và shard sao lưu đều đã được phân bổ</strong></p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/elas_0203.png" alt="Cluster với hai nút" tabindex="0" loading="lazy"><figcaption>Cluster với hai nút</figcaption></figure>
<p>Khi nút thứ hai tham gia vào cluster, 3 shard <em>sao lưu</em> sẽ được phân bổ cho nút này - mỗi shard chính có một shard sao lưu tương ứng. Điều này có nghĩa là khi bất kỳ nút nào trong cluster gặp sự cố, dữ liệu của chúng ta vẫn còn nguyên vẹn.</p>
<p>Tất cả các tài liệu mới được chỉ mục sẽ được lưu trữ trong shard chính, sau đó được sao chép song song đến shard sao lưu tương ứng. Điều này đảm bảo rằng chúng ta có thể lấy tài liệu từ shard chính cũng như từ shard sao lưu.</p>
<p><code>cluster-health</code> hiện tại hiển thị trạng thái là <code>green</code>, điều này cho thấy tất cả 6 shard (bao gồm 3 shard chính và 3 shard sao lưu) đều đang hoạt động bình thường.</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "cluster_name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"elasticsearch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "status"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"green"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "timed_out"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_nodes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_data_nodes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_primary_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "relocating_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "initializing_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "unassigned_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "delayed_unassigned_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_pending_tasks"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_in_flight_fetch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "task_max_waiting_in_queue_millis"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_shards_percent_as_number"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>Trạng thái <code>status</code> của cluster là <code>green</code></li>
</ul>
<p>Cluster của chúng ta hiện tại không chỉ đang hoạt động bình thường, mà còn ở trạng thái <em>luôn sẵn sàng</em>.</p>
<h3>Mở rộng ngang</h3>
<p>Làm thế nào để chúng ta mở rộng theo nhu cầu cho ứng dụng đang phát triển của chúng ta? Khi khởi động một nút thứ ba, cluster của chúng ta sẽ trở thành một cluster với ba nút - phân phối lại các shard để phân tán tải.</p>
<p><strong>Hình 4. Cluster với ba nút - phân phối lại các shard để phân tán tải</strong></p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/elas_0204.png" alt="Cluster với ba nút" tabindex="0" loading="lazy"><figcaption>Cluster với ba nút</figcaption></figure>
<p>Một shard từ <code>Node 1</code> và <code>Node 2</code> đã được di chuyển đến nút mới <code>Node 3</code>, bây giờ mỗi nút đều có 2 shard, thay vì 3 như trước. Điều này có nghĩa là tài nguyên phần cứng (CPU, RAM, I/O) của mỗi nút sẽ được chia sẻ cho ít shard hơn, hiệu suất của mỗi shard sẽ được cải thiện.</p>
<p>Một shard là một công cụ tìm kiếm hoàn chỉnh, nó có khả năng sử dụng tất cả các tài nguyên trên một nút. Chỉ mục của chúng ta có 6 shard (3 shard chính và 3 shard sao lưu) có thể mở rộng tối đa lên đến 6 nút, mỗi nút có một shard, và mỗi shard có toàn bộ tài nguyên của nút nơi nó đặt.</p>
<h2>Shard</h2>
<blockquote>
<ul>
<li>Tại sao tìm kiếm là <em>gần</em> thời gian thực?</li>
<li>Tại sao các hoạt động CRUD (Tạo - Đọc - Cập nhật - Xóa) trên tài liệu là <em>thời gian thực</em>?</li>
<li>Elasticsearch làm thế nào để đảm bảo các cập nhật được lưu trữ một cách bền vững mà không mất dữ liệu khi mất điện?</li>
<li>Tại sao việc xóa tài liệu không giải phóng không gian ngay lập tức?</li>
<li>API <code>refresh</code>, <code>flush</code>, và <code>optimize</code> làm gì và khi nào bạn nên sử dụng chúng?</li>
</ul>
</blockquote>
<h3>Làm cho văn bản có thể tìm kiếm</h3>
<p>Thách thức đầu tiên cần giải quyết là làm thế nào để làm cho văn bản có thể tìm kiếm. Các cơ sở dữ liệu truyền thống lưu trữ một giá trị duy nhất cho mỗi trường, nhưng điều này không đủ cho tìm kiếm toàn văn. Mỗi từ trong trường văn bản cần được tìm kiếm, điều này đối với cơ sở dữ liệu có nghĩa là cần có khả năng lập chỉ mục nhiều giá trị (ở đây là từ) cho một trường duy nhất.</p>
<p>Cấu trúc dữ liệu phù hợp nhất để hỗ trợ yêu cầu <em>nhiều giá trị cho một trường</em> là <em>chỉ mục đảo ngược</em> mà chúng ta đã giới thiệu trong chương <a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/inverted-index.html" target="_blank" rel="noopener noreferrer">Chỉ mục đảo ngược</a>. Chỉ mục đảo ngược bao gồm một danh sách đã sắp xếp, chứa tất cả các cá thể không trùng lặp xuất hiện trong tài liệu, hoặc được gọi là <em>cụm từ</em>, và cho mỗi cụm từ, chứa danh sách tất cả các tài liệu mà nó đã xuất hiện.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Term  | Doc 1 | Doc 2 | Doc 3 | ...</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/elas_0201.png" type="image/png"/>
    </item>
    <item>
      <title>Elasticsearch Index</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/es-index.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/es-index.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Index</source>
      <description>Elasticsearch Index Thao tác quản lý chỉ mục Quản lý chỉ mục Elasticsearch chủ yếu bao gồm cách tạo chỉ mục, xóa chỉ mục, cập nhật bản sao, quyền đọc ghi chỉ mục, cấu hình bí da...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Thao tác quản lý chỉ mục</h2>
<p>Quản lý chỉ mục Elasticsearch chủ yếu bao gồm cách tạo chỉ mục, xóa chỉ mục, cập nhật bản sao, quyền đọc ghi chỉ mục, cấu hình bí danh chỉ mục, và nhiều nội dung khác.</p>
<h3>Xóa chỉ mục</h3>
<p>Để xóa chỉ mục ES, bạn chỉ cần gửi một yêu cầu http delete đến giao diện http của cụm ES với chỉ mục được chỉ định, bạn có thể thực hiện điều này bằng lệnh curl, cụ thể như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">curl</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -X</span><span style="color:#98C379;--shiki-dark:#98C379"> DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> http://{es_host}:{es_http_port}/{index}</span></span></code></pre>
</div><p>Nếu xóa thành công, nó sẽ trả về thông tin như sau, ví dụ cụ thể như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">curl</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -X</span><span style="color:#98C379;--shiki-dark:#98C379"> DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> http://10.10.10.66:9200/my_index?pretty</span></span></code></pre>
</div><p>Để làm cho thông tin trả về dễ đọc hơn, chúng tôi đã thêm tham số pretty:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "acknowledged"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>Bí danh chỉ mục</h3>
<p>Bí danh chỉ mục ES là tên khác mà bạn đặt cho một hoặc nhiều chỉ mục, một ứng dụng điển hình là để thực hiện chuyển đổi mượt mà cho việc sử dụng chỉ mục.</p>
<p>Đầu tiên, tạo chỉ mục my_index, sau đó đặt bí danh my_alias để chỉ đến nó, ví dụ như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /my_index</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /my_index/_alias/my_alias</span></span></code></pre>
</div><p>Bạn cũng có thể thực hiện như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /_aliases</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "actions"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"add"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "index":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_index",</span><span style="color:#98C379;--shiki-dark:#98C379"> "alias":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_alias"</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Bạn cũng có thể thêm và xóa bí danh trong một yêu cầu:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /_aliases</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "actions"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"remove"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "index":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_index",</span><span style="color:#98C379;--shiki-dark:#98C379"> "alias":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_alias"</span><span style="color:#98C379;--shiki-dark:#98C379"> }},</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"add"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "index":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_index_v2",</span><span style="color:#98C379;--shiki-dark:#98C379"> "alias":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_alias"</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><blockquote>
<p>Cần lưu ý rằng, nếu bí danh và chỉ mục là một-một, bạn có thể sử dụng bí danh để lập chỉ mục hoặc truy vấn tài liệu. Tuy nhiên, nếu bí danh và chỉ mục là một-nhiều, việc sử dụng bí danh sẽ gây ra lỗi, vì ES không biết phải ghi tài liệu vào chỉ mục nào hoặc đọc tài liệu từ chỉ mục nào.</p>
</blockquote>
<p>Một ứng dụng điển hình của bí danh chỉ mục ES là chuyển đổi mượt mà, bạn có thể xem thêm chi tiết tại <a href="https://www.knowledgedict.com/tutorial/elasticsearch-index-smooth-shift.html" target="_blank" rel="noopener noreferrer">Phương pháp chuyển đổi mượt mà chỉ mục Elasticsearch (ES) không cần tắt máy (không cần khởi động lại)</a>.</p>
<h2>Giải thích Settings</h2>
<p>Cấu hình chỉ mục Elasticsearch chủ yếu được chia thành <strong>thuộc tính cấu hình tĩnh</strong> và <strong>thuộc tính cấu hình động</strong>. Thuộc tính cấu hình tĩnh không thể thay đổi sau khi tạo chỉ mục, trong khi thuộc tính cấu hình động có thể thay đổi bất cứ lúc nào.</p>
<p>API để thiết lập chỉ mục ES là <strong><em><code>_settings</code></em></strong>, ví dụ đầy đủ như sau:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /my_index</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "number_of_shards"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "number_of_replicas"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "refresh_interval"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "60s",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "analysis"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "filter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "tsconvert"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "stconvert",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "convert_type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "t2s",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "delimiter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> ","</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "synonym"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "synonym",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "synonyms_path"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "analysis/synonyms.txt"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "analyzer"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "ik_max_word_synonym"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "filter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "synonym"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "tsconvert"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "standard"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "lowercase"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "stop"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "tokenizer"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "ik_max_word"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "ik_smart_synonym"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "filter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "synonym"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "standard"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "lowercase"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "stop"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "tokenizer"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "ik_smart"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"mapping"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"coerce"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "false",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"ignore_malformed"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "false"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"indexing"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"slowlog"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"threshold"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">					"index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">						"warn"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "2s",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">						"info"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "1s"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">					}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">				}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"provided_name"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "hospital_202101070533",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"default_field"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "timestamp",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"parse"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"allow_unmapped_fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "false"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"requests"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"cache"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"enable"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"search"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"slowlog"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"threshold"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">					"fetch"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">						"warn"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "1s",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">						"info"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "200ms"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">					},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">					"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">						"warn"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "1s",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">						"info"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "500ms"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">					}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">				}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Thuộc tính cố định</h3>
<ul>
<li><strong><em><code>index.creation_date</code></em></strong>: Đúng như tên gọi, đây là dấu thời gian tạo chỉ mục.</li>
<li><strong><em><code>index.uuid</code></em></strong>: Thông tin uuid của chỉ mục.</li>
<li><strong><em><code>index.version.created</code></em></strong>: Phiên bản của chỉ mục.</li>
</ul>
<h3>Cấu hình tĩnh chỉ mục</h3>
<ul>
<li><strong><em><code>index.number_of_shards</code></em></strong>: Số lượng mảnh chính của chỉ mục, giá trị mặc định là <strong><em><code>5</code></em></strong>. Cấu hình này không thể thay đổi sau khi tạo chỉ mục; ở cấp độ es, bạn có thể thiết lập số lượng mảnh tối đa cho chỉ mục thông qua thuộc tính <strong><em><code>es.index.max_number_of_shards</code></em></strong>, mặc định là <strong><em><code>1024</code></em></strong>.</li>
<li><strong><em><code>index.codec</code></em></strong>: Thuật toán nén để lưu trữ dữ liệu, giá trị mặc định là <strong><em><code>LZ4</code></em></strong>. Các giá trị tùy chọn khác bao gồm <strong><em><code>best_compression</code></em></strong>, nó có tỷ lệ nén tốt hơn so với LZ4 (tức là chiếm ít không gian đĩa hơn, nhưng hiệu suất lưu trữ thấp hơn LZ4).</li>
<li><strong><em><code>index.routing_partition_size</code></em></strong>: Số lượng phân vùng định tuyến, nếu thiết lập tham số này, thuật toán định tuyến sẽ là: <code>( hash(_routing) + hash(_id) % index.routing_parttion_size ) % number_of_shards</code>. Nếu giá trị này không được thiết lập, thuật toán định tuyến sẽ là <code>hash(_routing) % number_of_shardings</code>, <code>_routing</code> mặc định là <code>_id</code>.</li>
</ul>
<p>Trong cấu hình tĩnh, một phần quan trọng là cấu hình phân tích (config analyzers).</p>
<ul>
<li>
<p><strong><code>index.analysis</code></strong></p>
<p>: Cấu hình ngoài cùng của phân tích, bên trong chủ yếu được chia thành char_filter, tokenizer, filter và analyzer.</p>
<ul>
<li><strong><em><code>char_filter</code></em></strong>: Định nghĩa bộ lọc ký tự mới.</li>
<li><strong><em><code>tokenizer</code></em></strong>: Định nghĩa tokenizer mới.</li>
<li><strong><em><code>filter</code></em></strong>: Định nghĩa bộ lọc token mới, như bộ lọc đồng nghĩa.</li>
<li><strong><em><code>analyzer</code></em></strong>: Cấu hình phân tích mới, thường là sự kết hợp của char_filter, tokenizer và một số bộ lọc token.</li>
</ul>
</li>
</ul>
<h3>Cấu hình động chỉ mục</h3>
<ul>
<li><strong><em><code>index.number_of_replicas</code></em></strong>: Số lượng bản sao của mảnh chính của chỉ mục, giá trị mặc định là <strong><em><code>1</code></em></strong>, giá trị này phải lớn hơn hoặc bằng 0, cấu hình này có thể thay đổi bất cứ lúc nào.</li>
<li><strong><em><code>index.refresh_interval</code></em></strong>: Tần suất thực hiện thao tác làm mới dữ liệu chỉ mục mới, thao tác này làm cho những thay đổi gần nhất đối với chỉ mục có thể nhìn thấy khi tìm kiếm, mặc định là <strong><em><code>1s</code></em></strong>. Bạn cũng có thể đặt là <strong><em><code>-1</code></em></strong> để vô hiệu hóa việc làm mới. Thông tin chi tiết hơn xem tại <a href="https://www.knowledgedict.com/tutorial/elasticsearch-refresh_interval-settings.html" target="_blank" rel="noopener noreferrer">Elasticsearch chỉnh sửa động refresh_interval cài đặt khoảng thời gian làm mới</a>.</li>
</ul>
<h2>Giải thích Mapping</h2>
<p>Trong Elasticsearch, <strong><code>Mapping</code></strong> (ánh xạ) được sử dụng để định rõ cách một tài liệu và các trường mà nó chứa được lưu trữ và lập chỉ mục. Bạn có thể định trước loại dữ liệu của các trường, trọng số của các trường, bộ phân tích, và các thuộc tính khác trong ánh xạ, giống như việc thiết lập loại dữ liệu cho các trường khi tạo bảng trong cơ sở dữ liệu quan hệ.</p>
<p>Mapping sẽ ánh xạ tài liệu json thành định dạng phẳng mà Lucene cần.</p>
<p>Một Mapping thuộc về một Type của chỉ mục</p>
<ul>
<li>Mỗi tài liệu đều thuộc về một Type</li>
<li>Một Type có một định nghĩa Mapping</li>
<li>Từ phiên bản 7.0 trở đi, không cần phải chỉ định thông tin type trong định nghĩa Mapping</li>
</ul>
<h3>Phân loại ánh xạ</h3>
<p>Trong Elasticsearch, ánh xạ có thể được chia thành ánh xạ tĩnh và ánh xạ động. Trong cơ sở dữ liệu quan hệ, trước khi ghi dữ liệu, bạn cần tạo bảng trước, trong câu lệnh tạo bảng, bạn sẽ khai báo thuộc tính của các trường. Tuy nhiên, trong Elasticsearch, bạn không cần phải làm như vậy. Một trong những tính năng quan trọng nhất của Elasticsearch là cho phép bạn khám phá dữ liệu càng nhanh càng tốt. Khi tài liệu được ghi vào Elasticsearch, nó sẽ tự động nhận biết loại của các trường. Cơ chế này được gọi là <strong>ánh xạ động</strong>, trong khi <strong>ánh xạ tĩnh</strong> là việc thiết lập thuộc tính của các trường trước khi ghi dữ liệu.</p>
<h4>Ánh xạ tĩnh</h4>
<p><strong>Ánh xạ tĩnh</strong> là việc chỉ định ánh xạ chỉ mục theo cách thủ công khi tạo chỉ mục. Ánh xạ tĩnh tương tự như việc chỉ định thuộc tính trường trong câu lệnh tạo bảng trong SQL. So với ánh xạ động, thông qua ánh xạ tĩnh, bạn có thể thêm các thông tin cấu hình chi tiết và chính xác hơn.</p>
<p>Cách định nghĩa một Mapping</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /books</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "type_one"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> any</span><span style="color:#98C379;--shiki-dark:#98C379"> mappings</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "type_two"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> any</span><span style="color:#98C379;--shiki-dark:#98C379"> mappings</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">        ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Ánh xạ động</h4>
<p><strong>Ánh xạ động</strong> là một cách thoải mái, cho phép bạn tạo chỉ mục và ghi tài liệu mà không cần thiết lập loại trường khi tạo chỉ mục. Loại của các trường trong tài liệu sẽ được Elasticsearch <strong>tự động nhận biết</strong>. Trong dự án thực tế, nếu bạn không chắc chắn về các trường sẽ có trong dữ liệu trước khi nhập, hoặc bạn không rõ về loại dữ liệu của các trường, việc sử dụng ánh xạ động sẽ rất phù hợp. Khi Elasticsearch gặp một trường mà nó chưa từng thấy trước đó trong tài liệu, nó sẽ sử dụng ánh xạ động để xác định loại của trường đó và tự động thêm trường đó vào ánh xạ, dựa vào giá trị của trường để tự động dự đoán loại trường theo bảng sau:</p>
<p>| Dữ liệu định dạng JSON | Loại trường được dự đoán tự động                                                       |<br>
| :</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Highlight Search and Display</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/highlight-search-display.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/highlight-search-display.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Highlight Search and Display</source>
      <description>Tìm kiếm và hiển thị nổi bật trong Elasticsearch Chức năng tìm kiếm nổi bật (highlight) của Elasticsearch cho phép bạn lấy đoạn tóm tắt nổi bật từ một hoặc nhiều trường trong kế...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Chức năng tìm kiếm nổi bật (highlight) của Elasticsearch cho phép bạn lấy đoạn tóm tắt nổi bật từ một hoặc nhiều trường trong kết quả tìm kiếm, để hiển thị vị trí phù hợp với truy vấn của người dùng. Khi bạn yêu cầu tìm kiếm nổi bật, trường highlight trong kết quả trả về sẽ bao gồm các trường nổi bật và các đoạn nổi bật. Elasticsearch mặc định sẽ đánh dấu từ khóa bằng thẻ <code>&lt;em&gt;&lt;/em&gt;</code>.</p>
<h2>Tham số tìm kiếm nổi bật</h2>
<p>ES cung cấp các tham số tìm kiếm nổi bật sau đây:</p>
<p>| Tham số                   | Mô tả                                                                                                                                                                                                                                                                                                                                                                                                             |<br>
| :</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Interview</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/interview.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/interview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Interview</source>
      <description>Tóm tắt phỏng vấn Elasticsearch Triển khai cụm Cấu hình triển khai ES: 5 nút (cấu hình: 8 nhân 64 G 1T), tổng cộng 320 G, 5 T. Khoảng 10+ chỉ mục, 5 phân đoạn, lượng dữ liệu mới...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Triển khai cụm</h2>
<p>Cấu hình triển khai ES:</p>
<p>5 nút (cấu hình: 8 nhân 64 G 1T), tổng cộng 320 G, 5 T.</p>
<p>Khoảng 10+ chỉ mục, 5 phân đoạn, lượng dữ liệu mới hàng ngày là khoảng 2G, 40 triệu bản ghi. Bản ghi được lưu trữ trong 30 ngày.</p>
<h2>Tối ưu hóa hiệu suất</h2>
<h3>filesystem cache</h3>
<p>Dữ liệu bạn ghi vào es, thực tế đã được ghi vào tệp trên đĩa,&nbsp;<strong>khi truy vấn</strong>, hệ điều hành sẽ tự động lưu trữ dữ liệu từ tệp trên đĩa vào&nbsp;<code>filesystem cache</code>.</p>
<p><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223081955.png" alt="image.png" loading="lazy"><br>
Cơ chế tìm kiếm của es phụ thuộc nặng nề vào&nbsp;<code>filesystem cache</code>&nbsp;cơ sở. Nếu bạn cung cấp thêm bộ nhớ cho&nbsp;<code>filesystem cache</code>, cố gắng để bộ nhớ có thể chứa tất cả các tệp dữ liệu chỉ mục&nbsp;<code>idx segment file</code>, thì khi bạn tìm kiếm, hầu như tất cả các hoạt động đều đi qua bộ nhớ, hiệu suất sẽ rất cao.</p>
<p>Hiệu suất có thể chênh lệch đến mức độ nào? Trong nhiều thử nghiệm và kiểm tra áp lực của chúng tôi trước đây, nếu đi qua đĩa, thì thời gian tìm kiếm chắc chắn là ở mức giây, từ 1 giây, 5 giây đến 10 giây. Nhưng nếu đi qua&nbsp;<code>filesystem cache</code>, nghĩa là đi qua bộ nhớ thuần túy, thì hiệu suất thường cao hơn một bậc so với việc đi qua đĩa, cơ bản là ở mức mili giây, từ vài mili giây đến vài trăm mili giây.</p>
<p>Ở đây có một ví dụ thực tế. Một công ty có 3 máy chủ es, mỗi máy chủ có vẻ như có nhiều bộ nhớ, 64G, tổng bộ nhớ là&nbsp;<code>64 * 3 = 192G</code>. Mỗi máy chủ cung cấp cho es jvm heap là&nbsp;<code>32G</code>, vì vậy phần còn lại cho&nbsp;<code>filesystem cache</code>&nbsp;chỉ là&nbsp;<code>32G</code>&nbsp;mỗi máy, tổng cộng trong cụm, cho&nbsp;<code>filesystem cache</code>&nbsp;chỉ là&nbsp;<code>32 * 3 = 96G</code>&nbsp;bộ nhớ. Tuy nhiên, vào thời điểm đó, tất cả các tệp dữ liệu chỉ mục trên đĩa, trên 3 máy, tổng cộng chiếm&nbsp;<code>1T</code>&nbsp;dung lượng đĩa, lượng dữ liệu es là&nbsp;<code>1T</code>, vì vậy lượng dữ liệu mỗi máy là&nbsp;<code>300G</code>. Hiệu suất tốt không? Bộ nhớ&nbsp;<code>filesystem cache</code>&nbsp;chỉ có 100G, chỉ một phần mười dữ liệu có thể được đặt trong bộ nhớ, phần còn lại đều ở trên đĩa, sau đó bạn thực hiện hoạt động tìm kiếm, hầu hết các hoạt động đều đi qua đĩa, hiệu suất chắc chắn sẽ kém.</p>
<p>Về cơ bản, nếu bạn muốn es hoạt động tốt, trường hợp tốt nhất là bộ nhớ máy của bạn có thể chứa ít nhất một nửa tổng lượng dữ liệu của bạn.</p>
<p>Dựa trên kinh nghiệm thực tế trong môi trường product của chúng tôi, trường hợp tốt nhất là chỉ lưu trữ một lượng dữ liệu nhỏ trong es, chỉ là những chỉ mục mà bạn cần&nbsp;<strong>tìm kiếm</strong>, nếu bộ nhớ dành cho&nbsp;<code>filesystem cache</code>&nbsp;là 100G, thì bạn nên kiểm soát lượng dữ liệu chỉ mục dưới&nbsp;<code>100G</code>. Trong trường hợp này, hầu hết dữ liệu của bạn đều đi qua bộ nhớ để tìm kiếm, hiệu suất rất cao, thường có thể trong vòng 1 giây.</p>
<p>Ví dụ, bạn hiện có một hàng dữ liệu.&nbsp;<code>id, name, age ….</code>&nbsp;30 trường. Nhưng bây giờ, bạn chỉ cần tìm kiếm dựa trên ba trường&nbsp;<code>id, name, age</code>. Nếu bạn ngây thơ ghi tất cả các trường của một hàng dữ liệu vào es, điều này sẽ dẫn đến việc&nbsp;<code>90%</code>&nbsp;dữ liệu không được sử dụng để tìm kiếm, nhưng vẫn chiếm không gian&nbsp;<code>filesystem cache</code>&nbsp;trên máy chủ es, dữ liệu mỗi hàng càng lớn,&nbsp;<code>filesystem cache</code>&nbsp;có thể lưu trữ càng ít dữ liệu. Thực tế, chỉ cần ghi vào es&nbsp;<strong>một số trường ít</strong>&nbsp;cần tìm kiếm, ví dụ, chỉ cần ghi vào es&nbsp;<code>id, name, age</code>&nbsp;ba trường, sau đó bạn có thể lưu trữ dữ liệu trường khác trong mysql/hbase, chúng tôi thường khuyến nghị sử dụng cấu trúc&nbsp;<code>es + hbase</code>.</p>
<p>Đặc điểm của hbase là&nbsp;<strong>phù hợp cho việc lưu trữ dữ liệu trực tuyến lớn</strong>, tức là hbase có thể ghi vào dữ liệu lớn, nhưng không nên thực hiện tìm kiếm phức tạp, chỉ cần thực hiện một số hoạt động đơn giản dựa trên id hoặc phạm vi. Tìm kiếm từ es dựa trên tên và tuổi, kết quả có thể chỉ là 20&nbsp;<code>doc id</code>, sau đó tìm kiếm&nbsp;<strong>dữ liệu đầy đủ</strong>&nbsp;tương ứng với mỗi&nbsp;<code>doc id</code>&nbsp;từ hbase, đưa ra, sau đó trả về cho phía trước.</p>
<p>Dữ liệu ghi vào es nên nhỏ hơn hoặc bằng, hoặc hơi lớn hơn dung lượng bộ nhớ của filesystem cache của es. Sau đó, bạn có thể mất 20ms để tìm kiếm từ es, sau đó tìm kiếm từ hbase dựa trên id được trả về từ es, tìm kiếm 20 bản ghi, có thể mất thêm 30ms, có thể bạn đã chơi như vậy trước đây, 1T dữ liệu đều đặt trong es, mỗi truy vấn đều mất 5~10s, bây giờ có thể hiệu suất sẽ cao hơn, mỗi truy vấn chỉ mất 50ms.</p>
<h3>Dữ liệu khởi động</h3>
<p>Giả sử, ngay cả khi bạn làm theo phương án đã nêu ở trên, lượng dữ liệu được ghi vào mỗi máy trong cụm es vẫn vượt quá gấp đôi&nbsp;<code>filesystem cache</code>, ví dụ, bạn ghi 60G dữ liệu vào một máy, nhưng&nbsp;<code>filesystem cache</code>&nbsp;chỉ có 30G, vẫn còn 30G dữ liệu ở trên đĩa.</p>
<p>Thực tế, bạn có thể thực hiện&nbsp;<strong>khởi động dữ liệu</strong>.</p>
<p>Ví dụ, nếu bạn nói về Weibo, bạn có thể lấy một số dữ liệu từ các người dùng VIP, những người thường xuyên được xem nhiều, bạn tự tạo một hệ thống phía sau, sau mỗi một thời gian, hệ thống phía sau của bạn sẽ tìm kiếm dữ liệu nóng, và đẩy vào&nbsp;<code>filesystem cache</code>, sau đó, khi người dùng thực sự đến xem dữ liệu nóng này, họ sẽ trực tiếp tìm kiếm từ bộ nhớ, rất nhanh.</p>
<p>Hoặc là thương mại điện tử, bạn có thể lấy một số sản phẩm được xem nhiều nhất thường xuyên, chẳng hạn như iPhone 15, dữ liệu nóng được tạo trước bằng một chương trình phía sau, sau mỗi phút, bạn tự động truy cập một lần, và đẩy vào&nbsp;<code>filesystem cache</code>.</p>
<p>Đối với những dữ liệu mà bạn cho là nóng, và thường xuyên có người truy cập, nên&nbsp;<strong>tạo một hệ thống khởi động bộ đệm chuyên dụng</strong>, tức là, sau mỗi một khoảng thời gian, truy cập trước vào dữ liệu nóng, để dữ liệu vào&nbsp;<code>filesystem cache</code>. Như vậy, khi người khác truy cập lần sau, hiệu suất chắc chắn sẽ tốt hơn nhiều.</p>
<h3>Phân tách nóng và lạnh</h3>
<p>es có thể thực hiện việc phân tách ngang tương tự như mysql, tức là, đặt một lượng lớn dữ liệu ít được truy cập, tần suất thấp vào một chỉ mục riêng biệt, sau đó đặt dữ liệu nóng được truy cập thường xuyên vào một chỉ mục riêng biệt. Tốt nhất là đặt&nbsp;<strong>dữ liệu lạnh vào một chỉ mục, sau đó đặt dữ liệu nóng vào một chỉ mục khác</strong>, điều này có thể đảm bảo rằng sau khi dữ liệu nóng được khởi động, hãy để chúng ở trong&nbsp;<code>filesystem os cache</code>&nbsp;càng nhiều càng tốt,&nbsp;<strong>đừng để dữ liệu lạnh xóa bỏ chúng</strong>.</p>
<p>Bạn xem, giả sử bạn có 6 máy, 2 chỉ mục, một cho dữ liệu lạnh, một cho dữ liệu nóng, mỗi chỉ mục có 3 shard. 3 máy đặt chỉ mục dữ liệu nóng, 3 máy khác đặt chỉ mục dữ liệu lạnh. Sau đó, bạn sẽ dành nhiều thời gian truy cập vào chỉ mục dữ liệu nóng, dữ liệu nóng có thể chiếm 10% tổng lượng dữ liệu, lúc này lượng dữ liệu rất nhỏ, gần như tất cả đều được giữ trong&nbsp;<code>filesystem cache</code>, điều này có thể đảm bảo rằng hiệu suất truy cập dữ liệu nóng rất cao. Nhưng đối với dữ liệu lạnh, nó nằm trong một chỉ mục khác, không ở cùng máy với chỉ mục dữ liệu nóng, không có liên hệ gì với nhau. Nếu có người truy cập dữ liệu lạnh, có thể nhiều dữ liệu đang ở trên đĩa, lúc này hiệu suất sẽ kém một chút, chỉ có 10% người truy cập dữ liệu lạnh, 90% người đang truy cập dữ liệu nóng, không sao cả.</p>
<h3>Thiết kế mô hình document</h3>
<p>Đối với MySQL, chúng ta thường xuyên có một số truy vấn liên kết phức tạp. Trong es, chúng ta nên xử lý như thế nào, truy vấn liên kết phức tạp trong es nên tránh sử dụng càng nhiều càng tốt, một khi sử dụng, hiệu suất thường không tốt.</p>
<p>Tốt nhất là hoàn thành liên kết trước trong hệ thống Java, và ghi dữ liệu đã liên kết trực tiếp vào es. Khi tìm kiếm, không cần sử dụng cú pháp tìm kiếm của es để hoàn thành truy vấn liên kết như join.</p>
<p>Thiết kế mô hình document rất quan trọng, nhiều hoạt động, không nên chờ đến khi tìm kiếm mới thực hiện các hoạt động phức tạp khác nhau. es hỗ trợ rất nhiều hoạt động, không nên cố gắng sử dụng es để thực hiện một số thao tác mà nó không làm tốt. Nếu thực sự có thao tác như vậy, hãy cố gắng hoàn thành nó khi thiết kế mô hình document, khi ghi dữ liệu. Ngoài ra, đối với một số hoạt động quá phức tạp, như join/nested/parent-child tìm kiếm nên tránh càng nhiều càng tốt, hiệu suất đều rất kém.</p>
<h3>Tối ưu hóa hiệu suất phân trang</h3>
<p>Phân trang của es khá khó khăn, tại sao? Ví dụ, giả sử bạn có 10 bản ghi trên mỗi trang, và bạn muốn truy vấn trang thứ 100, thực tế, nó sẽ lấy 1000 bản ghi đầu tiên được lưu trữ trên mỗi shard và đưa chúng vào một nút điều phối, nếu bạn có 5 shard, thì sẽ có 5000 bản ghi, sau đó nút điều phối sẽ xử lý và hợp nhất 5000 bản ghi này, sau đó lấy 10 bản ghi cuối cùng trên trang thứ 100.</p>
<p>Phân tán, bạn muốn xem 10 bản ghi trên trang thứ 100, không thể nói rằng từ 5 shard, mỗi shard chỉ xem 2 bản ghi, cuối cùng hợp nhất thành 10 bản ghi tại nút điều phối, phải không? Bạn&nbsp;<strong>phải</strong>&nbsp;lấy 1000 bản ghi từ mỗi shard, sau đó sắp xếp, lọc, v.v., dựa trên yêu cầu của bạn, sau đó phân trang một lần nữa, lấy dữ liệu trên trang thứ 100. Khi bạn lật trang, càng sâu, mỗi shard trả về càng nhiều dữ liệu, và thời gian xử lý của nút điều phối càng lâu, rất khó chịu. Vì vậy, khi sử dụng es để phân trang, bạn sẽ thấy rằng càng lật đến sau, càng chậm.</p>
<p>Chúng tôi cũng đã gặp vấn đề này trước đây, sử dụng es để phân trang, một số trang đầu tiên chỉ mất vài chục mili giây, khi lật đến trang thứ 10 hoặc vài chục trang, cơ bản mất 5~10 giây mới có thể lấy một trang dữ liệu.</p>
<p>Có giải pháp nào không?</p>
<h4>Không cho phép phân trang sâu (mặc định hiệu suất phân trang sâu rất kém)</h4>
<p>Nói với quản lý sản phẩm rằng, hệ thống của bạn không cho phép lật trang quá sâu, mặc định là càng lật sâu, hiệu suất càng kém.</p>
<h4>Tương tự như việc kéo xuống để hiển thị thêm sản phẩm được đề xuất trong ứng dụng</h4>
<p>Tương tự như trong Weibo, kéo xuống để làm mới Weibo, hiển thị từng trang, bạn có thể sử dụng <code>scroll api</code>. Đối với cách sử dụng, hãy tự tìm kiếm trên internet.</p>
<p>Scroll sẽ tạo ra một <strong>bản chụp toàn bộ dữ liệu</strong> cho bạn một lần, sau đó mỗi lần kéo xuống để lật trang tiếp theo sẽ thông qua việc di chuyển <strong>con trỏ</strong> <code>scroll_id</code>, nhận trang tiếp theo như vậy, hiệu suất sẽ cao hơn rất nhiều so với hiệu suất phân trang đã nói ở trên, cơ bản là ở mức mili giây.</p>
<p>Tuy nhiên, điểm duy nhất là, điều này phù hợp với việc lật trang khi kéo xuống giống như Weibo, <strong>không thể tùy ý nhảy đến bất kỳ trang nào</strong>. Nghĩa là, bạn không thể truy cập trang thứ 10 trước, sau đó đi đến trang thứ 120, sau đó lại quay lại trang thứ 58, không thể nhảy trang tùy ý. Vì vậy, nhiều sản phẩm hiện nay không cho phép bạn tùy ý lật trang, ứng dụng, cũng như một số trang web, chỉ cho phép bạn kéo xuống, lật từng trang một.</p>
<p>Khi khởi tạo, bạn phải chỉ định tham số <code>scroll</code>, thông báo cho es cần lưu trữ ngữ cảnh tìm kiếm này trong bao lâu. Bạn cần đảm bảo rằng người dùng sẽ không tiếp tục lật trang trong vài giờ, nếu không có thể sẽ thất bại do quá thời gian.</p>
<p>Ngoài việc sử dụng <code>scroll api</code>, bạn cũng có thể sử dụng <code>search_after</code>. Ý tưởng của <code>search_after</code> là sử dụng kết quả của trang trước để giúp tìm kiếm dữ liệu trên trang tiếp theo, rõ ràng, cách này cũng không cho phép bạn tùy ý lật trang, bạn chỉ có thể lật từng trang một. Khi khởi tạo, bạn cần sử dụng một trường giá trị duy nhất làm trường sắp xếp.</p>
<p><strong>1.1. Tối ưu hóa giai đoạn thiết kế</strong></p>
<p>(1) Dựa trên yêu cầu tăng trưởng kinh doanh, tạo chỉ mục dựa trên mẫu ngày, cuộn chỉ mục qua API roll over;</p>
<p>(2) Sử dụng bí danh để quản lý chỉ mục;</p>
<p>(3) Mỗi ngày vào lúc nửa đêm, thực hiện thao tác force_merge trên chỉ mục để giải phóng không gian;</p>
<p>(4) Sử dụng cơ chế phân tách nóng và lạnh, lưu trữ dữ liệu nóng vào SSD để cải thiện hiệu suất tìm kiếm; dữ liệu lạnh được thu nhỏ định kỳ để giảm bớt lưu trữ;</p>
<p>(5) Sử dụng curator để quản lý vòng đời chỉ mục;</p>
<p>(6) Chỉ đặt tokenizer một cách hợp lý cho các trường cần phân mảnh;</p>
<p>(7) Giai đoạn Mapping kết hợp đầy đủ các thuộc tính của từng trường, liệu có cần tìm kiếm, liệu có cần lưu trữ, v.v…….</p>
<p><strong>1.2. Tối ưu hóa viết</strong></p>
<p>(1) Thiết lập số lượng bản sao là 0 trước khi ghi;</p>
<p>(2) Tắt refresh_interval trước khi ghi, đặt là -1, vô hiệu hóa cơ chế làm mới;</p>
<p>(3) Trong quá trình ghi: sử dụng bulk để ghi hàng loạt;</p>
<p>(4) Phục hồi số lượng bản sao và khoảng thời gian làm mới sau khi ghi;</p>
<p>(5) Cố gắng sử dụng id tự động sinh.</p>
<p>1.3. Tối ưu hóa truy vấn</p>
<p>(1) Vô hiệu hóa wildcard;</p>
<p>(2) Vô hiệu hóa terms hàng loạt (trường hợp hàng trăm hàng nghìn);</p>
<p>(3) Tận dụng tối đa cơ chế chỉ mục đảo ngược, nếu có thể dùng loại keyword thì hãy dùng keyword;</p>
<p>(4) Khi lượng dữ liệu lớn, bạn có thể định chỉ mục dựa trên thời gian trước khi tìm kiếm;</p>
<p>(5) Thiết lập cơ chế định tuyến hợp lý.</p>
<p>1.4. Tối ưu hóa khác</p>
<p>Tối ưu hóa triển khai, tối ưu hóa kinh doanh, v.v.</p>
<p>Phần nêu trên chỉ đề cập đến một phần, người phỏng vấn sẽ cơ bản đánh giá kinh nghiệm thực hành hoặc vận hành trước đây của bạn.</p>
<h2>Nguyên lý hoạt động</h2>
<h3>Quá trình ghi dữ liệu es</h3>
<ul>
<li>Máy khách chọn một node để gửi yêu cầu đi, node này là <code>coordinating node</code> (nút điều phối).</li>
<li><code>Coordinating node</code> thực hiện <strong>định tuyến</strong> cho document, chuyển yêu cầu đến node tương ứng (có primary shard).</li>
<li><code>Primary shard</code> trên node thực tế xử lý yêu cầu, sau đó đồng bộ hóa dữ liệu với <code>replica node</code>.</li>
<li><code>Coordinating node</code> nếu phát hiện <code>primary node</code> và tất cả <code>replica node</code> đều đã hoàn thành, thì trả kết quả phản hồi cho máy khách.</li>
</ul>
<h3>Quá trình đọc dữ liệu es</h3>
<p>Có thể truy vấn thông qua <code>doc id</code>, sẽ dựa vào <code>doc id</code> để thực hiện hash, xác định lúc đó đã phân <code>doc id</code> vào shard nào, từ shard đó truy vấn.</p>
<ul>
<li>Máy khách gửi yêu cầu đến <strong>bất kỳ</strong> một node, trở thành <code>coordinate node</code>.</li>
<li><code>Coordinate node</code> thực hiện định tuyến hash cho <code>doc id</code>, chuyển yêu cầu đến node tương ứng, lúc này sẽ sử dụng thuật toán <strong>round-robin ngẫu nhiên</strong>, chọn ngẫu nhiên một trong số <code>primary shard</code> và tất cả các bản sao của nó, để cân bằng tải yêu cầu đọc.</li>
<li>Node nhận yêu cầu trả document cho <code>coordinate node</code>.</li>
<li><code>Coordinate node</code> trả document cho máy khách.</li>
</ul>
<h3>Quá trình tìm kiếm dữ liệu trong ES</h3>
<p>Điểm mạnh nhất của ES là thực hiện tìm kiếm toàn văn, ví dụ, bạn có ba dữ liệu:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Java is interesting</span></span>
<span class="line"><span>Java is so difficult to learn</span></span>
<span class="line"><span>J2EE is great</span></span></code></pre>
</div><p>Bạn tìm kiếm theo từ khóa&nbsp;<code>java</code>, nó sẽ tìm kiếm các&nbsp;<code>document</code>&nbsp;chứa&nbsp;<code>java</code>. ES sẽ trả về cho bạn: Java is interesting, Java is so difficult to learn</p>
<ul>
<li>Máy khách gửi yêu cầu đến một&nbsp;<code>coordinating node</code>.</li>
<li>Nút điều phối chuyển yêu cầu tìm kiếm đến&nbsp;<strong>tất cả</strong>&nbsp;<code>primary shard</code> hoặc&nbsp;<code>replica shard</code>&nbsp;tương ứng.</li>
<li>Giai đoạn truy vấn (query phase): mỗi shard sẽ trả lại kết quả tìm kiếm của mình (thực tế chỉ là một số&nbsp;<code>doc id</code>) cho nút điều phối, nút điều phối thực hiện các hoạt động như hợp nhất dữ liệu, sắp xếp, phân trang, etc., để tạo ra kết quả cuối cùng.</li>
<li>Giai đoạn lấy (fetch phase): sau đó, nút điều phối sẽ&nbsp;<strong>lấy</strong>&nbsp;dữ liệu&nbsp;<code>document</code>&nbsp;thực tế từ các node dựa trên&nbsp;<code>doc id</code>, và cuối cùng trả lại cho máy khách.</li>
</ul>
<blockquote>
<p>Yêu cầu ghi được ghi vào primary shard, sau đó đồng bộ hóa với tất cả các replica shard; yêu cầu đọc có thể được đọc từ primary shard hoặc replica shard, sử dụng thuật toán round-robin.</p>
</blockquote>
<h3>Nguyên lý cơ bản khi ghi dữ liệu</h3>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223111949.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Đầu tiên, dữ liệu sẽ được ghi vào bộ đệm trong bộ nhớ (buffer), trong quá trình này dữ liệu không thể được tìm kiếm; đồng thời dữ liệu cũng được ghi vào tệp nhật ký translog.</p>
<p>Nếu bộ đệm gần như đầy, hoặc sau một khoảng thời gian nhất định, dữ liệu trong bộ đệm sẽ được&nbsp;<code>refresh</code>&nbsp;vào một&nbsp;<code>segment file</code>&nbsp;mới, nhưng lúc này dữ liệu không được ghi trực tiếp vào tệp&nbsp;<code>segment file</code> trên đĩa, mà phải đi vào&nbsp;<code>os cache</code>&nbsp;trước. Quá trình này được gọi là&nbsp;<code>refresh</code>.</p>
<p>Mỗi giây, ES sẽ ghi dữ liệu trong bộ đệm vào một&nbsp;<code>segment file</code>&nbsp;<strong>mới</strong>, mỗi giây sẽ tạo ra một tệp đĩa <code>segment file</code>&nbsp;<strong>mới</strong>, tệp&nbsp;<code>segment file</code> này sẽ lưu trữ dữ liệu được ghi vào bộ đệm trong 1 giây gần đây.</p>
<p>Tuy nhiên, nếu không có dữ liệu trong bộ đệm, thì tất nhiên không có quá trình refresh nào được thực hiện, nếu có dữ liệu trong bộ đệm, mặc định sẽ thực hiện một lần refresh mỗi giây, đẩy dữ liệu vào một&nbsp;<code>segment file</code>&nbsp;mới.</p>
<p>Trên hệ điều hành, tệp đĩa thực tế đều có một thứ gọi là&nbsp;<code>os cache</code>, tức là trước khi dữ liệu được ghi vào tệp đĩa, nó sẽ được đưa vào&nbsp;<code>os cache</code> trước, đầu tiên vào bộ nhớ cache cấp hệ điều hành. Chỉ cần dữ liệu trong bộ đệm được chuyển vào&nbsp;<code>os cache</code>&nbsp;thông qua hoạt động refresh, dữ liệu này có thể được tìm kiếm.</p>
<p>Tại sao nói rằng ES là&nbsp;<strong>gần như thời gian thực</strong>?&nbsp;<code>NRT</code>, tên đầy đủ là&nbsp;<code>near real-time</code>. Mặc định là refresh mỗi giây một lần, vì vậy ES là gần như thời gian thực, vì dữ liệu được ghi vào sau 1 giây mới có thể được tìm thấy. Bạn có thể sử dụng&nbsp;<code>restful api</code>&nbsp;của es hoặc&nbsp;<code>java api</code>&nbsp;để thực hiện một hoạt động refresh&nbsp;<strong>thủ công</strong>, tức là thủ công đưa dữ liệu trong bộ đệm vào&nbsp;<code>os cache</code>, để dữ liệu có thể được tìm kiếm ngay lập tức. Miễn là dữ liệu được đưa vào&nbsp;<code>os cache</code>, bộ đệm sẽ được làm sạch, vì không cần giữ bộ đệm nữa, dữ liệu đã được lưu trữ trong tệp nhật ký translog một lần.</p>
<p>Lặp lại các bước trên, dữ liệu mới liên tục vào bộ đệm và translog, liên tục ghi dữ liệu&nbsp;<code>buffer</code>&nbsp;vào một&nbsp;<code>segment file</code>&nbsp;mới sau mỗi lần&nbsp;<code>refresh</code>, sau mỗi lần&nbsp;<code>refresh</code>&nbsp;bộ đệm sẽ được làm sạch, translog sẽ được giữ lại. Khi quá trình này tiếp diễn, translog sẽ ngày càng lớn. Khi translog đạt đến một độ dài nhất định, nó sẽ kích hoạt hoạt động&nbsp;<code>commit</code>.</p>
<p>Bước đầu tiên của hoạt động commit là ghi dữ liệu hiện có trong bộ đệm vào&nbsp;<code>os cache</code>, sau đó làm sạch bộ đệm. Sau đó, ghi một&nbsp;<code>commit point</code>&nbsp;vào tệp đĩa, trong đó đánh dấu tất cả các&nbsp;<code>segment file</code>&nbsp;tương ứng với&nbsp;<code>commit point</code>&nbsp;này, đồng thời buộc&nbsp;<code>os cache</code>&nbsp;chứa tất cả dữ liệu hiện tại để được&nbsp;<code>fsync</code>&nbsp;vào tệp đĩa. Cuối cùng,&nbsp;<strong>xóa</strong>&nbsp;tệp nhật ký translog hiện tại, khởi động lại một translog, lúc này hoạt động commit đã hoàn thành.</p>
<p>Hoạt động commit này được gọi là&nbsp;<code>flush</code>. Mặc định là mỗi 30 phút tự động thực hiện một lần&nbsp;<code>flush</code>, nhưng nếu translog quá lớn, cũng sẽ kích hoạt&nbsp;<code>flush</code>. Hoạt động flush tương ứng với toàn bộ quá trình commit, chúng ta có thể thông qua api của es, thực hiện thủ công hoạt động flush, thủ công&nbsp;<code>fsync</code>&nbsp;dữ liệu trong&nbsp;<code>os cache</code>&nbsp;vào đĩa.</p>
<p>Tệp nhật ký translog có vai trò gì? Trước khi bạn thực hiện hoạt động commit, dữ liệu có thể đang nằm trong bộ đệm hoặc nằm trong&nbsp;<code>os cache</code>. Dù là bộ đệm hay&nbsp;<code>os cache</code>&nbsp;đều là bộ nhớ, nếu máy này bị hỏng, dữ liệu trong bộ nhớ sẽ mất hết. Vì vậy, cần ghi các hoạt động tương ứng của dữ liệu vào một tệp nhật ký đặc biệt là&nbsp;<code>translog</code>, nếu máy bị hỏng lúc này, khi khởi động lại, es sẽ tự động đọc dữ liệu từ tệp nhật ký translog và phục hồi vào bộ nhớ&nbsp;<code>buffer</code>&nbsp;và&nbsp;<code>os cache</code>.</p>
<p>Thực tế, translog cũng được ghi vào&nbsp;<code>os cache</code>&nbsp;trước, mặc định là mỗi 5 giây sẽ đẩy vào đĩa một lần, vì vậy mặc định, có thể có 5 giây dữ liệu chỉ nằm trong bộ đệm hoặc <code>os cache</code> hoặc tệp translog, không nằm trên đĩa, nếu máy này bị hỏng lúc này, sẽ&nbsp;<strong>mất</strong>&nbsp;5 giây dữ liệu. Nhưng hiệu suất như vậy tốt hơn, mất tối đa 5 giây dữ liệu. Bạn cũng có thể đặt translog để mỗi lần ghi phải&nbsp;<code>fsync</code>&nbsp;trực tiếp vào đĩa, nhưng hiệu suất sẽ kém hơn nhiều.</p>
<p>Thực tế, nếu bạn ở đây, nếu người phỏng vấn không hỏi bạn về vấn đề mất dữ liệu của es, bạn có thể tự hào với người phỏng vấn ở đây, bạn nói, thực tế es trước tiên là gần như thời gian thực, dữ liệu được ghi vào sau 1 giây mới có thể được tìm thấy; có thể mất dữ liệu. Có 5 giây dữ liệu, nằm trong bộ đệm,&nbsp;<code>os cache</code>&nbsp;của translog,&nbsp;<code>os cache</code>&nbsp;của&nbsp;<code>segment file</code>, không nằm trên đĩa, nếu máy này bị hỏng lúc này, sẽ dẫn đến&nbsp;<strong>mất</strong>&nbsp;5 giây dữ liệu.</p>
<p><strong>Tóm lại</strong>, dữ liệu được ghi vào bộ đệm trước, sau đó mỗi giây, dữ liệu sẽ được refresh vào&nbsp;<code>os cache</code>, khi dữ liệu đến&nbsp;<code>os cache</code>, dữ liệu có thể được tìm kiếm (đó là lý do tại sao chúng ta nói rằng từ khi dữ liệu được ghi vào cho đến khi có thể tìm kiếm, có độ trễ 1s). Mỗi 5 giây, dữ liệu sẽ được ghi vào tệp translog (do đó, nếu máy bị hỏng, tất cả dữ liệu trong bộ nhớ sẽ mất, tối đa sẽ mất 5s dữ liệu), khi translog lớn đến một mức độ nhất định, hoặc mặc định mỗi 30 phút, một hoạt động commit sẽ được kích hoạt, đẩy tất cả dữ liệu trong bộ đệm vào tệp&nbsp;<code>segment file</code>trên đĩa.</p>
<blockquote>
<p>Sau khi dữ liệu được ghi vào&nbsp;<code>segment file</code>, chỉ mục đảo ngược cũng sẽ được tạo ngay lập tức.</p>
</blockquote>
<h3>Nguyên lý cơ bản khi xóa/cập nhật dữ liệu</h3>
<p>Nếu là hoạt động xóa, khi commit sẽ tạo ra một tệp&nbsp;<code>.del</code>, trong đó đánh dấu một doc nhất định là trạng thái&nbsp;<code>deleted</code>, vì vậy khi tìm kiếm, dựa vào tệp&nbsp;<code>.del</code>, bạn sẽ biết liệu doc có bị xóa hay không.</p>
<p>Nếu là hoạt động cập nhật, nó sẽ đánh dấu doc gốc là trạng thái&nbsp;<code>deleted</code>&nbsp;và sau đó ghi một dữ liệu mới.</p>
<p>Mỗi khi bộ đệm được refresh, một&nbsp;<code>segment file</code>&nbsp;sẽ được tạo ra, vì vậy mặc định là một&nbsp;<code>segment file</code>&nbsp;mỗi giây, vì vậy&nbsp;<code>segment file</code>&nbsp;sẽ ngày càng nhiều, lúc này sẽ thường xuyên thực hiện merge. Mỗi lần merge, nhiều&nbsp;<code>segment file</code>&nbsp;sẽ được hợp nhất thành một, đồng thời ở đây, doc được đánh dấu là&nbsp;<code>deleted</code>&nbsp;sẽ được&nbsp;<strong>xóa vật lý</strong>, sau đó ghi&nbsp;<code>segment file</code>&nbsp;mới vào đĩa, ở đây sẽ ghi một&nbsp;<code>commit point</code>, đánh dấu tất cả&nbsp;<code>segment file</code>&nbsp;mới, sau đó mở&nbsp;<code>segment file</code>&nbsp;để tìm kiếm, và sau đó xóa&nbsp;<code>segment file</code>&nbsp;cũ.</p>
<h3>Lớp cơ bản Lucene</h3>
<p>Đơn giản, Lucene chỉ là một thư viện jar, bên trong nó chứa các mã thuật toán đã được đóng gói để tạo chỉ mục đảo ngược. Khi chúng ta phát triển bằng Java, chúng ta chỉ cần import thư viện jar Lucene, sau đó phát triển dựa trên API của Lucene.</p>
<p>Thông qua Lucene, chúng ta có thể tạo chỉ mục cho dữ liệu hiện có, Lucene sẽ tổ chức cấu trúc dữ liệu chỉ mục trên ổ đĩa cục bộ cho chúng ta.</p>
<h3>Chỉ mục đảo ngược</h3>
<p>Trong công cụ tìm kiếm, mỗi tài liệu đều có một ID tài liệu tương ứng, nội dung tài liệu được biểu diễn dưới dạng một tập hợp các từ khóa. Ví dụ, sau khi phân loại, tài liệu 1 đã trích xuất 20 từ khóa, mỗi từ khóa đều ghi lại số lần xuất hiện và vị trí xuất hiện của nó trong tài liệu.</p>
<p>Vậy, chỉ mục đảo ngược là ánh xạ từ&nbsp;<strong>từ khóa đến ID tài liệu</strong>, mỗi từ khóa đều tương ứng với một loạt tài liệu, trong đó tất cả các tài liệu đều xuất hiện từ khóa.</p>
<p>Ví dụ.</p>
<p>Có các tài liệu sau:</p>
<p>| DocId | Doc                                                                           |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223081955.png" type="image/png"/>
    </item>
    <item>
      <title>Elasticsearch Intro</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/intro.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/intro.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Intro</source>
      <description>Giới thiệu về Elasticsearch Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu dựa trên Lucene, cung cấp một dịch vụ phân tán. Elasticsearch là một sản phẩm mã nguồn mở ...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu dựa trên Lucene, cung cấp một dịch vụ phân tán. Elasticsearch là một sản phẩm mã nguồn mở tuân thủ các điều khoản mã nguồn mở của Apache và hiện là công cụ tìm kiếm cấp doanh nghiệp phổ biến hiện nay.</p>
<p>Nó được sử dụng cho tìm kiếm toàn văn bản, tìm kiếm có cấu trúc, phân tích, và kết hợp ba yếu tố này:</p>
<ul>
<li>Wikipedia sử dụng Elasticsearch để cung cấp tìm kiếm toàn văn bản với đánh dấu từ khóa, cũng như các tính năng đề xuất tìm kiếm như&nbsp;<strong>tìm kiếm thời gian thực (search-as-you-type)</strong>&nbsp;và&nbsp;<strong>sửa lỗi tìm kiếm (did-you-mean)</strong>.</li>
<li>The Guardian sử dụng Elasticsearch để cung cấp phản hồi thời gian thực cho biên tập viên của họ bằng cách kết hợp dữ liệu nhật ký người dùng và dữ liệu mạng xã hội, giúp họ hiểu rõ phản ứng của công chúng đối với các bài viết mới xuất bản.</li>
<li>StackOverflow kết hợp tìm kiếm toàn văn bản với truy vấn vị trí địa lý và tính năng&nbsp;<strong>more-like-this</strong>&nbsp;để tìm các câu hỏi và câu trả lời liên quan.</li>
<li>Github sử dụng Elasticsearch để tìm kiếm 130 tỷ dòng code. (số liệu có thể thay đổi hàng giờ nên có thể sai lệch tại thời điểm viết)</li>
</ul>
<h2>Đặc điểm của Elasticsearch</h2>
<ul>
<li>Lưu trữ tệp thời gian thực phân tán, với mỗi trường được lập chỉ mục và có thể tìm kiếm.</li>
<li>Công cụ tìm kiếm phân tích thời gian thực phân tán.</li>
<li>Có thể mở rộng linh hoạt lên đến hàng trăm máy chủ, xử lý dữ liệu có cấu trúc hoặc không có cấu trúc ở cấp petabyte.</li>
<li>Sẵn sàng sử dụng ngay sau khi cài đặt, nó cung cấp nhiều giá trị mặc định hợp lý và ẩn đi lý thuyết công cụ tìm kiếm phức tạp đối với người mới học. Nó có thể được sử dụng trong môi trường product với yêu cầu học tập tối thiểu.</li>
</ul>
<h2>Lịch sử phát triển của Elasticsearch</h2>
<ul>
<li>Ngày 8 tháng 2 năm 2010, phiên bản công khai đầu tiên của Elasticsearch đã được phát hành.</li>
<li>Ngày 14 tháng 5 năm 2010, phiên bản ban đầu mang tính bước ngoặt <strong>0.7.0</strong> được phát hành, với các tính năng:
<ul>
<li>Mô-đun Zen Discovery tự động phát hiện;
<ul>
<li>Hỗ trợ cho Groovy Client;</li>
</ul>
</li>
<li>Cơ chế quản lý plugin đơn giản;
<ul>
<li>Hỗ trợ tốt hơn cho bộ tách từ icu;</li>
</ul>
</li>
<li>Nhiều API quản lý hơn.</li>
</ul>
</li>
<li>Đầu năm 2013, GitHub từ bỏ Solr và chọn Elasticsearch để thực hiện tìm kiếm cấp PB của mình.</li>
<li>Ngày 14 tháng 2 năm 2014, phiên bản <strong>1.0.0</strong> được phát hành, thêm các tính năng quan trọng sau:
<ul>
<li>Hỗ trợ cho Snapshot/Restore API backup recovery API;
<ul>
<li>Hỗ trợ cho Aggregations;</li>
</ul>
</li>
<li>Hỗ trợ cho cat API;
<ul>
<li>Hỗ trợ cho circuit breakers;</li>
</ul>
</li>
<li>Giới thiệu Doc values.</li>
</ul>
</li>
<li>Ngày 28 tháng 10 năm 2015, phiên bản <strong>2.0.0</strong> được phát hành, với các tính năng quan trọng sau:
<ul>
<li>Thêm Pipleline Aggregations;
<ul>
<li>Query/filter query merging, tất cả được hợp nhất vào query, thực hiện các truy vấn khác nhau theo các ngữ cảnh khác nhau;</li>
</ul>
</li>
<li>Cấu hình lưu trữ nén;
<ul>
<li>Mô-đun Rivers đã bị loại bỏ;</li>
</ul>
</li>
<li>Tính năng Multicast đã bị loại bỏ, trở thành một plugin, và một địa chỉ unicast phải được cấu hình trong môi trường sản xuất.</li>
</ul>
</li>
<li>Ngày 26 tháng 10 năm 2016, phiên bản <strong>5.0.0</strong> được phát hành, với các thay đổi tính năng lớn sau:
<ul>
<li>Hỗ trợ cho Lucene 6.x, giảm một nửa không gian đĩa; giảm một nửa thời gian lập chỉ mục; tăng 25% hiệu suất truy vấn; hỗ trợ cho IPV6;</li>
<li>Khóa đua được sử dụng để tránh cập nhật đồng thời của cùng một tài liệu đã được loại bỏ ở cấp Internal Engine, dẫn đến cải thiện hiệu suất 15%-20%;</li>
<li>Shrink API, có thể thu nhỏ số lượng shard thành các yếu tố của nó, ví dụ như nếu trước đây bạn có 15 shard, bạn có thể thu nhỏ thành 5 hoặc 3 hoặc 1, vì vậy chúng ta có thể tưởng tượng một tình huống như thế này, trong giai đoạn thu thập mà áp lực ghi là rất lớn, đặt đủ chỉ mục, tận dụng tối đa khả năng ghi song song của shard, sau khi chỉ mục được viết, thu nhỏ thành ít shard hơn, cải thiện hiệu suất truy vấn;
<ul>
<li>Cung cấp SDK client REST gốc Java đầu tiên;</li>
</ul>
</li>
<li>IngestNode, trước đây nếu bạn cần xử lý dữ liệu, nó được xử lý trước khi lập chỉ mục, ví dụ như logstash có thể cấu trúc và chuyển đổi nhật ký, bây giờ nó có thể được xử lý trực tiếp trong es;
<ul>
<li>Cung cấp script Painless, thay thế cho script Groovy;</li>
<li>Loại bỏ site plugins, có nghĩa là head, bigdesk không thể được cài đặt trực tiếp trong es nữa, nhưng có thể triển khai các trang độc lập (dù sao đó cũng là các tệp tĩnh) hoặc phát triển plugin kibana;</li>
<li>Thêm loại Sliced Scroll, bây giờ giao diện Scroll có thể được sử dụng để duyệt dữ liệu đồng thời. Mỗi yêu cầu Scroll có thể được chia thành nhiều yêu cầu Slice, có thể được hiểu là các lát, mỗi Slice là độc lập và song song, sử dụng Scroll để xây dựng lại hoặc duyệt sẽ nhanh hơn nhiều lần;</li>
<li>Thêm Profile API;</li>
<li>Thêm Rollover API;</li>
<li>Thêm Reindex;</li>
<li>Giới thiệu các loại trường mới Text/Keyword để thay thế String;</li>
<li>Giới hạn kích thước yêu cầu chỉ mục để tránh một số lượng lớn yêu cầu đồng thời làm quá tải ES;</li>
<li>Giới hạn số lượng shard trong một yêu cầu duy nhất, mặc định 1000.</li>
</ul>
</li>
</ul>
</li>
<li>Ngày 31 tháng 8 năm 2017, phiên bản <strong>6.0.0</strong> được phát hành, với các tính năng quan trọng sau:
<ul>
<li>Hỗ trợ cho Doc Values thưa thớt;
<ul>
<li>Index Sorting, tức là sắp xếp ở giai đoạn lập chỉ mục;</li>
</ul>
</li>
<li>Hỗ trợ cho số thứ tự, mỗi hoạt động es có một số thứ tự (tương tự như thiết kế tăng dần);
<ul>
<li>Nâng cấp cuộn mượt mà;</li>
</ul>
</li>
<li>Bắt đầu từ 6.0, không hỗ trợ nhiều loại trong một index;
<ul>
<li>Index-template inheritance, kế thừa phiên bản index, hiện tại các mẫu index đều được khớp và hợp nhất, điều này có thể gây ra một số vấn đề xung đột mẫu index, 6.0 sẽ chỉ khớp một, và index sẽ được xác minh khi tạo;</li>
<li>Load aware shard routing, định tuyến yêu cầu dựa trên tải, các yêu cầu tìm kiếm hiện tại là toàn nút polling, vì vậy nút hoạt động chậm nhất thường gây ra tăng độ trễ tổng thể, cách thực hiện mới sẽ tự động điều chỉnh độ dài hàng đợi dựa trên thời gian tiêu thụ của hàng đợi, độ dài hàng đợi của nút tải cao sẽ giảm, cho phép các nút khác chia sẻ áp lực nhiều hơn, tìm kiếm và chỉ mục sẽ dựa trên cơ chế này;</li>
<li>Các chỉ mục đã đóng cũng sẽ hỗ trợ xử lý tự động của bản sao để đảm bảo độ tin cậy của dữ liệu.</li>
</ul>
</li>
</ul>
</li>
<li>Ngày 10 tháng 4 năm 2019, phiên bản <strong>7.0.0</strong> được phát hành, với các tính năng quan trọng sau:
<ul>
<li>Thay đổi kết nối cụm: TransportClient đã bị loại bỏ, mã java của es7 chỉ có thể sử dụng restclient; đối với lập trình java, nên sử dụng High-level-rest-client để vận hành cụm ES;
<ul>
<li>Gói chương trình ES mặc định đóng gói jdk: phiên bản gói chương trình 7.x trở thành 300MB+, so với 6.x, gói lớn hơn 200MB+, đây chính là kích thước của JDK;</li>
<li>Sử dụng Lucene 9.0;
<ul>
<li>Chính thức loại bỏ hỗ trợ cho nhiều Type dưới một chỉ mục duy nhất, thời gian es6, chính thức đã nói rằng es7 sẽ xóa type, và thời gian es6, đã quy định rằng mỗi chỉ mục chỉ có thể có một loại. Trong es7, sử dụng _doc mặc định như là loại, chính thức nói trong phiên bản 8.x sẽ hoàn toàn loại bỏ loại. Phương thức yêu cầu API cũng gửi thay đổi, chẳng hạn như lấy một tài liệu của một ID cụ thể của một chỉ mục: GET index/_doc/id nơi chỉ mục và id là các giá trị cụ thể;</li>
</ul>
</li>
</ul>
</li>
<li>Giới thiệu một bộ cắt mạch bộ nhớ thực sự, có thể phát hiện chính xác hơn các yêu cầu không thể xử lý và ngăn chúng làm cho một nút duy nhất không ổn định;
<ul>
<li>Zen2 là lớp điều phối cụm hoàn toàn mới của Elasticsearch, cải thiện độ tin cậy, hiệu suất, và trải nghiệm người dùng, trở nên nhanh hơn, an toàn hơn, và dễ sử dụng hơn.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Các khái niệm về Elasticsearch</h2>
<p>Dưới đây là một số khái niệm cốt lõi của Elasticsearch. Hiểu rõ những khái niệm này từ đầu sẽ giúp bạn đơn giản hóa quá trình học Elasticsearch.</p>
<h3>Gần thời gian thực (NRT)</h3>
<p>Elasticsearch là một nền tảng tìm kiếm gần thời gian thực. Điều này có nghĩa là <strong>có một khoảng trễ nhỏ (thường là một giây) từ lúc lập chỉ mục cho một tài liệu cho đến khi tài liệu đó có thể được tìm kiếm</strong>.</p>
<h3>Chỉ mục (Index)</h3>
<p>Trong các ngữ cảnh khác nhau, "chỉ mục" có những ý nghĩa khác nhau:</p>
<ul>
<li>Chỉ mục (danh từ): Một&nbsp;<strong>chỉ mục</strong>&nbsp;tương tự như một&nbsp;<strong>cơ sở dữ liệu</strong>trong cơ sở dữ liệu quan hệ truyền thống, là một nơi chứa các tài liệu dạng quan hệ. Chỉ mục thực chất là một&nbsp;<strong>không gian tên logic</strong>&nbsp;trỏ đến một hoặc nhiều&nbsp;<strong>phân đoạn vật lý</strong>.</li>
<li>Chỉ mục (động từ): Chỉ mục một tài liệu có nghĩa là lưu trữ một tài liệu vào một&nbsp;<em>chỉ mục</em>&nbsp;(danh từ) để có thể được tìm kiếm và truy vấn. Điều này rất giống với từ khóa&nbsp;<code>INSERT</code>&nbsp;trong SQL, ngoại trừ khi tài liệu đã tồn tại, tài liệu mới sẽ thay thế tài liệu cũ.</li>
<li>Chỉ mục đảo ngược : Cơ sở dữ liệu quan hệ tăng tốc độ truy vấn dữ liệu bằng cách thêm một chỉ mục, chẳng hạn như một chỉ mục cây B, vào các cột được chỉ định. Elasticsearch và Lucene sử dụng một cấu trúc gọi là&nbsp;<strong>chỉ mục đảo ngược</strong>&nbsp;để đạt được mục đích tương tự.</li>
</ul>
<p>Chỉ mục của Mapping và Setting</p>
<ul>
<li><strong><code>Mapping</code></strong>&nbsp;xác định kiểu của các trường tài liệu</li>
<li><strong><code>Setting</code></strong>&nbsp;xác định phân phối dữ liệu khác nhau</li>
</ul>
<p>Ví dụ:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "settings"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">...</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> any</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> settings</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> ...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "mappings"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "type_one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">...</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> any</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> mappings</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> ...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "type_two"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">...</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> any</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> mappings</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> ...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">        ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Chỉ mục đảo ngược</h4>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223160504.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h4>index template</h4>
<p><strong><code>index template</code></strong> (mẫu chỉ mục) giúp người dùng đặt Mapping và Setting, và tự động khớp chúng với chỉ mục mới được tạo theo một quy tắc nhất định.</p>
<ul>
<li>Mẫu chỉ có hiệu lực khi một chỉ mục được tạo. Việc sửa đổi mẫu sẽ không ảnh hưởng đến các chỉ mục đã tạo.</li>
<li>Bạn có thể đặt nhiều mẫu chỉ mục, các thiết lập này sẽ được kết hợp lại với nhau.</li>
<li>Bạn có thể chỉ định giá trị order để kiểm soát quá trình kết hợp.</li>
</ul>
<p>Khi tạo mới một chỉ mục:</p>
<ul>
<li>Áp dụng Mapping và Setting mặc định của ES</li>
<li>Áp dụng các thiết lập trong mẫu chỉ mục có giá trị order thấp</li>
<li>Áp dụng các thiết lập trong mẫu chỉ mục có giá trị order cao, các thiết lập trước đó sẽ bị ghi đè</li>
<li>Áp dụng Mapping và Setting được chỉ định bởi người dùng khi tạo chỉ mục, và ghi đè các thiết lập trong mẫu trước đó.</li>
</ul>
<p>Ví dụ: Tạo mẫu chỉ mục mặc định</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> _template/template_default</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "index_patterns"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"*"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "order"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "version"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "number_of_shards"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "number_of_replicas"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /_template/template_test</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "index_patterns"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"test*"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "order"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "number_of_shards"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "number_of_replicas"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "date_detection"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> false</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "numeric_detection"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Kiểm tra mẫu chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_template/template_default</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_template/temp</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Ghi dữ liệu mới, chỉ mục bắt đầu bằng test</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> testtemplate/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "someNumber"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "someDate"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "2019/01/01"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> testtemplate/_mapping</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> testtemplate/_settings</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> testmy</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"number_of_replicas"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">:5</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> testmy/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "key"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "value"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> testmy/_settings</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> testmy</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> /_template/template_default</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> /_template/template_test</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>dynamic template</h4>
<ul>
<li>Dựa vào kiểu dữ liệu được ES nhận biết, kết hợp với tên trường, để đặt động kiểu trường:
<ul>
<li>Tất cả các kiểu chuỗi đều được đặt thành Keyword, hoặc tắt trường keyword.</li>
<li>Các trường bắt đầu bằng "is" đều được đặt thành boolean.</li>
<li>Các trường bắt đầu bằng "long_" đều được đặt thành kiểu long.</li>
</ul>
</li>
<li>Mẫu động được định nghĩa trong Mapping của một chỉ mục.</li>
<li>Mẫu có một tên.</li>
<li>Quy tắc khớp là một mảng.</li>
<li>Đặt Mapping cho các trường khớp.</li>
</ul>
<p>Ví dụ:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Dynaminc Mapping dựa trên kiểu và tên trường</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "firstName"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Ruan",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "isVIP"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index/_mapping</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "dynamic_templates"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "strings_as_boolean"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "match_mapping_type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "string",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "is*",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "mapping"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "boolean"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "strings_as_keywords"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "match_mapping_type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "string",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "mapping"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "keyword"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index/_mapping</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Kết hợp với đường dẫn</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "dynamic_templates"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "full_name"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "path_match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "name.*",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "path_unmatch"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "*.middle",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "mapping"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "text",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "copy_to"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "full_name"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index/_mapping</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "name"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "first"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "John",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "middle"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Winston",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "last"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Lennon"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index/_search?q=full_name:John</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3><s>Kiểu (Type)</s></h3>
<p><s>Kiểu là một phân loại hay phân vùng theo ý nghĩa logic, cho phép tạo nhiều loại trong cùng một chỉ mục. Bản chất, nó tương đương với một điều kiện lọc, các phiên bản cao hơn sẽ loại bỏ khái niệm loại.</s></p>
<blockquote>
<p><s><strong>Từ phiên bản 6.0.0 trở đi, loại đã bị loại bỏ</strong></s></p>
</blockquote>
<h3>Tài liệu (Document)</h3>
<p>Elasticsearch là hướng tới tài liệu, <strong>tài liệu là đơn vị nhỏ nhất của tất cả dữ liệu có thể tìm kiếm</strong>.</p>
<p>Elasticsearch sử dụng <a href="http://en.wikipedia.org/wiki/Json" target="_blank" rel="noopener noreferrer"><em>JSON</em></a> làm định dạng tuần tự hóa cho tài liệu.</p>
<p>Trong chỉ mục/loại, bạn có thể lưu trữ bất kỳ số lượng tài liệu nào theo nhu cầu.</p>
<p>Mỗi tài liệu đều có một <strong>ID duy nhất</strong></p>
<ul>
<li>Người dùng có thể tự chỉ định</li>
<li>Hoặc được Elasticsearch tự động tạo</li>
</ul>
<h4>Metadata của tài liệu</h4>
<p>Một tài liệu không chỉ chứa dữ liệu của nó, mà còn chứa <strong>metadata</strong> - thông tin về tài liệu.</p>
<ul>
<li><code>_index</code>: Tài liệu được lưu trữ ở đâu</li>
<li><code>_type</code>: Loại đối tượng mà tài liệu đại diện</li>
<li><code>_id</code>: Định danh duy nhất của tài liệu</li>
<li><code>_source</code>: Dữ liệu Json gốc của tài liệu</li>
<li><code>_all</code>: Tích hợp tất cả nội dung của các trường vào trường này, đã bị loại bỏ</li>
<li><code>_version</code>: Thông tin phiên bản của tài liệu</li>
<li><code>_score</code>: Điểm liên quan</li>
</ul>
<p>Ví dụ:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"megacorp"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"employee"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_version"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "found"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_source"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "first_name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"John"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "last_name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Smith"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "age"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "about"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"I love to go rock climbing"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "interests"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"sports"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"music"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>Nút (Node)</h3>
<h4>Giới thiệu về nút</h4>
<p>Một thực thể Elasticsearch đang chạy được gọi là một <strong>nút</strong>.</p>
<p>Thực thể Elasticsearch về cơ bản là một tiến trình Java. Một máy có thể chạy nhiều tiến trình Elasticsearch, nhưng môi trường product nên chạy một tiến trình Elasticsearch trên một máy.</p>
<p>Mỗi nút đều có tên, được cấu hình thông qua tệp cấu hình, hoặc chỉ định khi khởi động thông qua <code>-E node.name=node1</code>.</p>
<p>Sau khi mỗi nút khởi động, nó sẽ được gán một UID, được lưu trong thư mục <code>data</code>.</p>
<h4>Loại nút</h4>
<ul>
<li><strong>Nút chính (master node)</strong>: Mỗi nút đều lưu trữ trạng thái của cụm, chỉ có nút chính mới có thể sửa đổi thông tin trạng thái của cụm (đảm bảo tính nhất quán của dữ liệu). <strong>Trạng thái cụm</strong> duy trì thông tin sau:
<ul>
<li>Thông tin về tất cả các nút</li>
<li>Tất cả các chỉ mục và thông tin liên quan đến mapping và setting</li>
<li>Thông tin định tuyến phân đoạn</li>
</ul>
</li>
<li><strong>Nút ứng cử (master eligible node)</strong>: Nút ứng cử có thể tham gia vào quá trình bầu chọn chính. Nút khởi động đầu tiên sẽ tự bầu làm nút chính.
<ul>
<li>Sau khi mỗi nút khởi động, mặc định là nút ứng cử, có thể bị cấm thông qua cấu hình <code>node.master: false</code></li>
</ul>
</li>
<li><strong>Nút dữ liệu (data node)</strong>: Chịu trách nhiệm lưu trữ dữ liệu phân đoạn.</li>
<li><strong>Nút điều phối (coordinating node)</strong>: Chịu trách nhiệm nhận yêu cầu từ khách hàng, phân phối yêu cầu đến nút thích hợp, cuối cùng tổng hợp kết quả lại với nhau. Mỗi nút Elasticsearch mặc định đều là nút điều phối (coordinating node).</li>
<li><strong>Nút lạnh/nóng (warm/hot node)</strong>: Dành cho các nút dữ liệu (data node) với cấu hình phần cứng khác nhau, để thực hiện kiến trúc Hot &amp; Warm, giảm chi phí triển khai cụm.</li>
<li><strong>Nút học máy (machine learning node)</strong>: Chịu trách nhiệm thực hiện công việc học máy, được sử dụng để phát hiện bất thường.</li>
</ul>
<h4>Cấu hình nút</h4>
<p>| Tham số cấu hình | Giá trị mặc định | Giải thích                               |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223160504.png" type="image/png"/>
    </item>
    <item>
      <title>Elasticsearch Mapping</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/mapping.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/mapping.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Mapping</source>
      <description>Elasticsearch Mapping Trong Elasticsearch, Mapping (ánh xạ) được sử dụng để xác định cách một tài liệu cùng với các trường bên trong nó được lưu trữ và lập chỉ mục. Mapping cho ...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Trong Elasticsearch, <strong><code>Mapping</code></strong> (ánh xạ) được sử dụng để xác định cách một tài liệu cùng với các trường bên trong nó được lưu trữ và lập chỉ mục. Mapping cho phép bạn xác định trước các thuộc tính như kiểu dữ liệu của các trường, trọng số của các trường, bộ phân tích từ và các thuộc tính khác, giống như việc thiết lập các trường khi tạo bảng trong cơ sở dữ liệu quan hệ.</p>
<p>Mapping sẽ ánh xạ tài liệu JSON thành định dạng phẳng mà Lucene cần.</p>
<p>Mỗi Mapping thuộc về một Type của chỉ mục.</p>
<ul>
<li>Mỗi tài liệu đều thuộc về một Type.</li>
<li>Một Type có một định nghĩa Mapping.</li>
<li>Từ phiên bản 7.0 trở đi, không cần phải chỉ định thông tin type trong định nghĩa Mapping.</li>
</ul>
<p>Mỗi <code>document</code> là một tập hợp của <code>field</code>, mỗi <code>field</code> đều có kiểu dữ liệu của riêng nó. Khi ánh xạ dữ liệu, bạn có thể tạo một <code>mapping</code> chứa danh sách <code>field</code> liên quan đến <code>document</code>. Định nghĩa ánh xạ cũng bao gồm các <code>field</code> metadata, như <code>_source</code>, nó tùy chỉnh cách xử lý metadata liên quan đến <code>document</code>.</p>
<h2>Cách ánh xạ</h2>
<p>Trong Elasticsearch, ánh xạ có thể được chia thành ánh xạ tĩnh và ánh xạ động. Trong cơ sở dữ liệu quan hệ, trước khi ghi dữ liệu, bạn cần tạo bảng và khai báo thuộc tính của các trường trong câu lệnh tạo bảng. Tuy nhiên, trong Elasticsearch, điều này không cần thiết. Một trong những tính năng quan trọng nhất của Elasticsearch là cho phép bạn bắt đầu khám phá dữ liệu càng nhanh càng tốt. Khi tài liệu được ghi vào Elasticsearch, nó sẽ tự động nhận biết kiểu dữ liệu của các trường. Cơ chế này được gọi là <strong>ánh xạ động</strong>. Trong khi đó, <strong>ánh xạ tĩnh</strong> là việc thiết lập thuộc tính của các trường trước khi ghi dữ liệu.</p>
<h3>Ánh xạ tĩnh</h3>
<p>ES gọi ánh xạ tĩnh là <strong>ánh xạ rõ ràng (<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/explicit-mapping.html" target="_blank" rel="noopener noreferrer">Explicit mapping</a>)</strong>. <strong>Ánh xạ tĩnh</strong> là việc chỉ định rõ ràng ánh xạ chỉ mục khi tạo chỉ mục. Ánh xạ tĩnh tương tự như việc chỉ định thuộc tính trường trong câu lệnh tạo bảng trong SQL. So với ánh xạ động, thông qua ánh xạ tĩnh, bạn có thể thêm các thông tin cấu hình chi tiết và chính xác hơn. Ví dụ:</p>
<ul>
<li>Những trường chuỗi nào nên được coi là trường toàn văn bản.</li>
<li>Những trường nào chứa số, ngày hoặc vị trí địa lý.</li>
<li>Định dạng của giá trị ngày.</li>
<li>Các quy tắc tùy chỉnh để kiểm soát việc thêm trường động.</li>
</ul>
<p>【Ví dụ】Khi tạo chỉ mục, chỉ định rõ ràng mapping</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">PUT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> /</span><span style="color:#E06C75;--shiki-dark:#E06C75">my</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#E06C75;--shiki-dark:#E06C75">index</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">000001</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "mappings"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "properties"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">      "age"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:    { </span><span style="color:#98C379;--shiki-dark:#98C379">"type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"integer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">      "email"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:  { </span><span style="color:#98C379;--shiki-dark:#98C379">"type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"keyword"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">      "name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:   { </span><span style="color:#98C379;--shiki-dark:#98C379">"type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>【Ví dụ】Trong chỉ mục đã tồn tại, chỉ định thuộc tính của một trường</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">PUT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> /</span><span style="color:#E06C75;--shiki-dark:#E06C75">my</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#E06C75;--shiki-dark:#E06C75">index</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">000001</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">/</span><span style="color:#E06C75;--shiki-dark:#E06C75">_mapping</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "properties"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "employee-id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">      "type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"keyword"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">      "index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>【Ví dụ】Xem mapping</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /my-index-000001/_mapping</span></span></code></pre>
</div><p>【Ví dụ】Xem mapping của một trường cụ thể</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /my-index-000001/_mapping/field/employee-id</span></span></code></pre>
</div><h3>Ánh xạ động</h3>
<p>Cơ chế ánh xạ động cho phép người dùng không cần định nghĩa thủ công ánh xạ, Elasticsearch sẽ tự động nhận biết kiểu dữ liệu của các trường. Trong các dự án thực tế, nếu đối tác không biết trước các trường nào sẽ xuất hiện trong dữ liệu được nhập vào, hoặc không rõ kiểu dữ liệu của các trường, việc sử dụng ánh xạ động sẽ rất phù hợp. Khi Elasticsearch gặp một trường chưa từng thấy trước đó trong một tài liệu, nó sẽ sử dụng ánh xạ động để xác định kiểu của trường và tự động thêm trường đó vào ánh xạ.</p>
<p>Ví dụ: Tạo một chỉ mục tên là <code>data</code>, với kiểu <code>mapping</code> là <code>_doc</code>, và có một trường kiểu <code>long</code> tên <code>count</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> data/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"count"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span></code></pre>
</div><h4>Ánh xạ động trường</h4>
<p>Ánh xạ động trường (<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic-field-mapping.html" target="_blank" rel="noopener noreferrer">Dynamic field mappings</a>) là quy tắc để quản lý việc phát hiện trường động. Khi Elasticsearch phát hiện một trường mới trong một tài liệu, theo mặc định, nó sẽ tự động thêm trường đó vào ánh xạ kiểu.</p>
<p>Trong ánh xạ, bạn có thể mở ánh xạ động bằng cách đặt tham số <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic.html" target="_blank" rel="noopener noreferrer"><code>dynamic</code></a> thành <code>true</code> hoặc <code>runtime</code>.</p>
<p>Các tùy chọn khác nhau của tham số <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic.html" target="_blank" rel="noopener noreferrer"><code>dynamic</code></a> có các chức năng như sau:</p>
<p>| Giá trị lựa chọn | Mô tả |<br>
|</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Operation</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/operation.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/operation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Operation</source>
      <description>Elasticsearch Operation Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu phân tán, hỗ trợ RESTful, có khả năng giải quyết một số lượng ngày càng tăng các trường hợp sử...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a> là một công cụ tìm kiếm và phân tích dữ liệu phân tán, hỗ trợ RESTful, có khả năng giải quyết một số lượng ngày càng tăng các trường hợp sử dụng. Là trung tâm của Elastic Stack, nó lưu trữ dữ liệu của bạn tập trung để tìm kiếm nhanh chóng, tinh chỉnh độ liên quan, và phân tích mạnh mẽ có thể mở rộng dễ dàng.</p>
</blockquote>
<h2>Cài đặt Elasticsearch</h2>
<blockquote>
<p><a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener noreferrer">Hướng dẫn tải và cài đặt chính thức của Elasticsearch</a></p>
</blockquote>
<p>(1) Tải và giải nén</p>
<p>Truy cập <a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener noreferrer">địa chỉ tải chính thức</a>, chọn phiên bản cần thiết, tải và giải nén về máy của bạn.</p>
<p>(2) Chạy</p>
<p>Chạy <code>bin/elasticsearch</code> (Trên hệ thống Windows, chạy <code>bin\elasticsearch.bat</code>)</p>
<p>(3) Truy cập</p>
<p>Thực hiện <code>curl http://localhost:9200/</code> để kiểm tra xem dịch vụ đã khởi động chưa</p>
<h2>Lập kế hoạch cho Cluster Elasticsearch</h2>
<p>Cluster Elasticsearch cần được lập kế hoạch một cách hợp lý dựa trên tình hình thực tế của doanh nghiệp.</p>
<p>Các điểm cần xem xét:</p>
<ul>
<li>Cần triển khai bao nhiêu node trong cluster?</li>
<li>Có bao nhiêu index?</li>
<li>Mỗi index có bao nhiêu dữ liệu?</li>
<li>Mỗi index có bao nhiêu shard?</li>
</ul>
<p>Một kế hoạch tham khảo:</p>
<ul>
<li>3 máy, mỗi máy là 6-core 64G.</li>
<li>Tăng hàng ngày của cluster ES của chúng tôi là khoảng 20 triệu bản ghi, dữ liệu tăng hàng ngày là khoảng 500MB, dữ liệu tăng hàng tháng là khoảng 600 triệu, 15G. Hệ thống đã hoạt động trong vài tháng, và bây giờ tổng lượng dữ liệu trong cluster ES là khoảng 100G.</li>
<li>Hiện tại có 5 index trực tuyến (điều này được kết hợp với doanh nghiệp của bạn, xem dữ liệu nào của bạn có thể đặt trong ES), mỗi index có khối lượng dữ liệu là khoảng 20G, vì vậy trong khối lượng dữ liệu này, chúng tôi phân bổ 8 shard cho mỗi index, đó là 3 shard nhiều hơn mặc định là 5 shard.</li>
</ul>
<h2>Cấu hình Elasticsearch</h2>
<p>Tệp cấu hình mặc định của ES là <code>config/elasticsearch.yml</code></p>
<p>Dưới đây là một số thông tin cơ bản về cấu hình:</p>
<div class="language-yml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">cluster.name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">elasticsearch</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Cấu hình tên cụm của es, mặc định là elasticsearch, es sẽ tự động phát hiện es trong cùng một shard mạng, nếu có nhiều cụm trong cùng một shard mạng, thuộc tính này có thể được sử dụng để phân biệt các cụm khác nhau.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">node.name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Franz Kafka'</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Tên node, mặc định được chỉ định một cách ngẫu nhiên từ danh sách tên, danh sách này nằm trong tệp name.txt trong thư mục cấu hình trong gói jar es, trong đó có nhiều tên thú vị được thêm bởi các tác giả.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">node.master</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xác định node này có đủ điều kiện để được bầu làm node hay không, mặc định là true, es mặc định là máy đầu tiên trong cụm là master, nếu máy này bị treo thì sẽ bầu lại master.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">node.data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xác định node này có lưu trữ dữ liệu index hay không, mặc định là true.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.number_of_shards</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt số lượng mảnh shard mặc định cho index, mặc định là 5 mảnh.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.number_of_replicas</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt số lượng bản sao mặc định cho index, mặc định là 1 bản sao.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">path.conf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">/path/to/conf</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt đường dẫn lưu trữ tệp cấu hình, mặc định là thư mục config trong thư mục gốc es.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">path.data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">/path/to/data</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt đường dẫn lưu trữ dữ liệu index, mặc định là thư mục data trong thư mục gốc es, có thể đặt nhiều đường dẫn lưu trữ, phân cách bằng dấu phẩy, ví dụ:</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#path.data: /path/to/data1,/path/to/data2</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">path.work</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">/path/to/work</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt đường dẫn lưu trữ tệp tạm thời, mặc định là thư mục work trong thư mục gốc es.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">path.logs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">/path/to/logs</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt đường dẫn lưu trữ tệp nhật ký, mặc định là thư mục logs trong thư mục gốc es</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">path.plugins</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">/path/to/plugins</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt đường dẫn lưu trữ plugin, mặc định là thư mục plugins trong thư mục gốc es</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">bootstrap.mlockall</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt true để khóa bộ nhớ. Bởi vì khi jvm bắt đầu swapping thì hiệu suất của es sẽ giảm, vì vậy để đảm bảo nó không swap, bạn có thể đặt hai biến môi trường ES_MIN_MEM và ES_MAX_MEM thành cùng một giá trị, và đảm bảo máy có đủ bộ nhớ để phân bổ cho es. Đồng thời, bạn cũng phải cho phép tiến trình elasticsearch có thể khóa bộ nhớ, trên linux bạn có thể sử dụng lệnh `ulimit -l unlimited`.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">network.bind_host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">192.168.0.1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt địa chỉ ip được liên kết, có thể là ipv4 hoặc ipv6, mặc định là 0.0.0.0.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">network.publish_host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">192.168.0.1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt địa chỉ ip mà các node khác và node này tương tác, nếu không đặt nó sẽ tự động xác định, giá trị phải là một địa chỉ ip thực sự.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">network.host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">192.168.0.1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Tham số này được sử dụng để đồng thời đặt bind_host và publish_host ở trên.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">transport.tcp.port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">9300</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt cổng tcp để tương tác giữa các node, mặc định là 9300.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">transport.tcp.compress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt liệu có nén dữ liệu khi truyền tải tcp hay không, mặc định là false, không nén.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">http.port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">9200</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt cổng http phục vụ bên ngoài, mặc định là 9200.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">http.max_content_length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">100mb</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt dung lượng tối đa của nội dung, mặc định là 100mb</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">http.enabled</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Có sử dụng giao thức http để cung cấp dịch vụ bên ngoài hay không, mặc định là true, được mở.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">gateway.type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">local</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Loại gateway, mặc định là local tức là hệ thống tệp cục bộ, có thể đặt là hệ thống tệp cục bộ, hệ thống tệp phân tán, HDFS của hadoop, và máy chủ s3 của amazon, cách đặt hệ thống tệp khác sẽ được nói chi tiết vào lần sau.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">gateway.recover_after_nodes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt số lượng node trong cụm khi khởi động để khôi phục dữ liệu, mặc định là 1.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">gateway.recover_after_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">5m</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt thời gian chờ tối đa để khởi tạo quá trình khôi phục dữ liệu, mặc định là 5 phút.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">gateway.expected_nodes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt số lượng node trong cụm này, mặc định là 2, một khi N node này được khởi động, quá trình khôi phục dữ liệu sẽ được bắt đầu ngay lập tức.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">cluster.routing.allocation.node_initial_primaries_recoveries</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Khi khôi phục dữ liệu ban đầu, số lượng luồng khôi phục đồng thời, mặc định là 4.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">cluster.routing.allocation.node_concurrent_recoveries</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Khi thêm hoặc xóa node hoặc cân bằng tải, số lượng luồng khôi phục đồng thời, mặc định là 2.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">indices.recovery.max_size_per_sec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt băng thông giới hạn khi khôi phục dữ liệu, ví dụ 100mb, mặc định là 0, tức không giới hạn.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">indices.recovery.concurrent_streams</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt tham số này để giới hạn số lượng luồng đồng thời mở tối đa khi khôi phục dữ liệu từ các mảnh khác, mặc định là 5.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">discovery.zen.minimum_master_nodes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt tham số này để đảm bảo rằng các node trong cụm có thể biết được số lượng tối thiểu N node khác có đủ điều kiện làm master. Mặc định là 1, đối với cụm lớn, có thể đặt giá trị lớn hơn một chút (2-4)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">discovery.zen.ping.timeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">3s</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt thời gian chờ kết nối ping khi tự động phát hiện các node khác trong cụm, mặc định là 3 giây, đối với môi trường mạng kém, có thể đặt giá trị cao hơn để ngăn chặn lỗi khi phát hiện tự động.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">discovery.zen.ping.multicast.enabled</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt liệu có mở phát hiện node đa phát hay không, mặc định là true.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">discovery.zen.ping.unicast.hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'host1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'host2:port'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'host3[portX-portY]'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt danh sách ban đầu của các node master trong cụm, các node mới tham gia cụm có thể được phát hiện tự động thông qua các node này.</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Elasticsearch FAQ</h2>
<h3>Elasticsearch không cho phép chạy với quyền root</h3>
<p><strong>Vấn đề:</strong> Trong môi trường Linux, Elasticsearch không cho phép chạy với quyền root.</p>
<p>Nếu bạn chạy Elasticsearch dưới quyền root, bạn sẽ nhận được lỗi sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>can not run elasticsearch as root</span></span></code></pre>
</div><p><strong>Cách giải quyết:</strong> Chạy Elasticsearch dưới tài khoản không có quyền root</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Tạo nhóm người dùng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">groupadd</span><span style="color:#98C379;--shiki-dark:#98C379"> elk</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Tạo người dùng mới, -g elk đặt nhóm người dùng của nó thành elk, -p elk đặt mật khẩu của nó thành elk</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">useradd</span><span style="color:#98C379;--shiki-dark:#98C379"> elk</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -g</span><span style="color:#98C379;--shiki-dark:#98C379"> elk</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span><span style="color:#98C379;--shiki-dark:#98C379"> elk</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Thay đổi chủ sở hữu của thư mục /opt và các tệp bên trong thành elk:elk</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">chown</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -R</span><span style="color:#98C379;--shiki-dark:#98C379"> elk:elk</span><span style="color:#98C379;--shiki-dark:#98C379"> /opt</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Giả sử bạn đã cài đặt elasticsearch trong thư mục opt</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Chuyển đổi tài khoản</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">su</span><span style="color:#98C379;--shiki-dark:#98C379"> elk</span></span></code></pre>
</div><h3>vm.max_map_count không thấp hơn 262144</h3>
<p><strong>Vấn đề:</strong> <code>vm.max_map_count</code> biểu thị kích thước bộ nhớ ảo, đây là một tham số kernel. Elasticsearch yêu cầu <code>vm.max_map_count</code> không thấp hơn 262144.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</span></span></code></pre>
</div><p><strong>Cách giải quyết:</strong></p>
<p>Bạn có thể thực hiện lệnh sau để đặt <code>vm.max_map_count</code>, nhưng sau khi khởi động lại, nó sẽ trở lại giá trị ban đầu.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>sysctl -w vm.max_map_count=262144</span></span></code></pre>
</div><p>Cách làm lâu dài là sửa đổi tham số <code>vm.max_map_count</code> trong tệp <code>/etc/sysctl.conf</code>:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>echo "vm.max_map_count=262144" &gt; /etc/sysctl.conf</span></span>
<span class="line"><span>sysctl -p</span></span></code></pre>
</div><blockquote>
<p><strong>Lưu ý</strong></p>
<p>Nếu môi trường chạy là docker container, có thể sẽ hạn chế việc thực hiện sysctl để sửa đổi tham số kernel.</p>
<p>Trong trường hợp này, bạn chỉ có thể chọn sửa đổi tham số trên máy chủ chủ.</p>
</blockquote>
<h3>nofile không thấp hơn 65536</h3>
<p><strong>Vấn đề:</strong> <code>nofile</code> biểu thị số lượng tệp tối đa mà một quá trình có thể mở. Quá trình Elasticsearch yêu cầu số lượng tệp tối đa có thể mở không thấp hơn 65536.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]</span></span></code></pre>
</div><p><strong>Cách giải quyết:</strong></p>
<p>Sửa đổi tham số <code>nofile</code> trong tệp <code>/etc/security/limits.conf</code>:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>echo "* soft nofile 65536" &gt; /etc/security/limits.conf</span></span>
<span class="line"><span>echo "* hard nofile 131072" &gt; /etc/security/limits.conf</span></span></code></pre>
</div><h3>nproc không thấp hơn 2048</h3>
<p><strong>Vấn đề:</strong> <code>nproc</code> biểu thị số lượng tối đa của các thread. Elasticsearch yêu cầu số lượng tối đa thread không thấp hơn 2048.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>max number of threads [1024] for user [user] is too low, increase to at least [2048]</span></span></code></pre>
</div><p><strong>Cách giải quyết:</strong></p>
<p>Sửa đổi tham số <code>nproc</code> trong tệp <code>/etc/security/limits.conf</code>:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>echo "* soft nproc 2048" &gt; /etc/security/limits.conf</span></span>
<span class="line"><span>echo "* hard nproc 4096" &gt; /etc/security/limits.conf</span></span></code></pre>
</div><h2>Tài liệu tham khảo</h2>
<ul>
<li><a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener noreferrer">Hướng dẫn tải và cài đặt Elasticsearch chính thức</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html#rpm" target="_blank" rel="noopener noreferrer">Cài đặt Elasticsearch với RPM</a></li>
<li><a href="http://siye1982.github.io/2015/09/17/es-optimize/" target="_blank" rel="noopener noreferrer">Tích lũy sử dụng Elasticsearch</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch performance optimization</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/optimization.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/optimization.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch performance optimization</source>
      <description>Tối ưu hóa hiệu suất Elasticsearch Elasticsearch là công cụ tìm kiếm cấp doanh nghiệp phổ biến hiện nay, được thiết kế để hoạt động trong môi trường đám mây, có khả năng tìm kiế...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Elasticsearch là công cụ tìm kiếm cấp doanh nghiệp phổ biến hiện nay, được thiết kế để hoạt động trong môi trường đám mây, có khả năng tìm kiếm thời gian thực, ổn định, đáng tin cậy, nhanh chóng và dễ dàng cài đặt. Dù là một sản phẩm sẵn sàng sử dụng ngay sau khi mở hộp, sau khi đưa vào môi trường sản xuất, chúng ta không thể đảm bảo được hiệu suất và ổn định của nó. Việc tăng cường hiệu suất dịch vụ dựa trên tình hình thực tế có rất nhiều kỹ thuật. Trong chương này, chúng tôi sẽ chia sẻ những kinh nghiệm tối ưu hóa hiệu suất Elasticsearch từ thực tiễn, chủ yếu từ các khía cạnh như tối ưu hóa cấu hình phần cứng, cài đặt tối ưu hóa chỉ mục, tối ưu hóa truy vấn, tối ưu hóa cấu trúc dữ liệu, tối ưu hóa kiến trúc cụm.</p>
<h2>Tối ưu hóa cấu hình phần cứng</h2>
<p>Nâng cấp cấu hình phần cứng luôn là phương pháp tăng cường khả năng phục vụ nhanh chóng và hiệu quả nhất, ba yếu tố có thể ảnh hưởng đến hiệu suất ứng dụng ở cấp độ hệ thống bao gồm: CPU, bộ nhớ và IO, có thể tối ưu hóa hiệu suất ES từ ba khía cạnh này.</p>
<h3>Cấu hình CPU</h3>
<p>Nói chung, có một số lý do khiến CPU bận rộn:</p>
<ol>
<li>Có vòng lặp vô hạn, không chặn, khớp mẫu thông thường hoặc chỉ tính toán trong luồng;</li>
<li>Xảy ra GC thường xuyên;</li>
<li>Chuyển đổi ngữ cảnh của nhiều luồng;</li>
</ol>
<p>Hầu hết các triển khai Elasticsearch thường không đặt yêu cầu cao đối với CPU. Do đó, so với các tài nguyên khác, việc cấu hình bao nhiêu (CPU) không quan trọng lắm. Bạn nên chọn bộ xử lý hiện đại có nhiều nhân, máy chủ trong cụm thường sử dụng từ 2 đến 8 nhân. <strong>Nếu bạn phải chọn giữa CPUs nhanh hơn và số lượng nhân nhiều hơn, việc chọn số lượng nhân nhiều hơn sẽ tốt hơn</strong>. Số lượng nhân bổ sung cung cấp đồng thời nhiều hơn rất nhiều so với tốc độ xung nhịp nhanh hơn một chút.</p>
<h3>Cấu hình bộ nhớ</h3>
<p>Nếu có một loại tài nguyên nào đó sẽ được tiêu thụ trước tiên, đó có thể là bộ nhớ. Sắp xếp và tổng hợp đều tiêu thụ nhiều bộ nhớ, vì vậy việc có đủ không gian heap để xử lý chúng là rất quan trọng. Ngay cả khi không gian heap khá nhỏ, nó cũng có thể cung cấp thêm bộ nhớ cho bộ đệm tệp hệ điều hành. Bởi vì nhiều cấu trúc dữ liệu mà Lucene sử dụng dựa trên định dạng dựa trên đĩa, Elasticsearch tận dụng bộ đệm hệ điều hành có thể tạo ra hiệu quả lớn.</p>
<p><strong>Máy có bộ nhớ 64 GB là rất lý tưởng</strong>, nhưng máy 32 GB và 16 GB cũng rất phổ biến. Dưới 8 GB sẽ phản tác dụng (bạn cuối cùng sẽ cần rất nhiều máy nhỏ), máy có bộ nhớ lớn hơn 64 GB cũng sẽ gặp vấn đề.</p>
<p>Do ES được xây dựng dựa trên lucene, và sức mạnh của thiết kế lucene nằm ở chỗ lucene có thể tận dụng tốt bộ nhớ hệ điều hành để lưu trữ dữ liệu chỉ mục, để cung cấp hiệu suất truy vấn nhanh. Các tệp phân đoạn chỉ mục của lucene được lưu trữ trong một tệp duy nhất và không thay đổi, đối với hệ điều hành, có thể giữ tệp chỉ mục trong bộ đệm một cách thân thiện, để truy cập nhanh; do đó, chúng ta cần để một nửa bộ nhớ vật lý cho lucene; nửa còn lại của bộ nhớ vật lý để cho ES (JVM heap).</p>
<h4>Phân bổ bộ nhớ</h4>
<p>Khi bộ nhớ máy nhỏ hơn 64G, tuân theo nguyên tắc chung, 50% cho ES, 50% cho lucene.</p>
<p>Khi bộ nhớ máy lớn hơn 64G, tuân theo nguyên tắc sau:</p>
<ul>
<li>Nếu cảnh sử dụng chính là tìm kiếm toàn văn bản, thì nên cấp 4~32G bộ nhớ cho ES Heap; bộ nhớ khác để cho hệ điều hành, cho lucene sử dụng (segments cache), để cung cấp hiệu suất truy vấn nhanh hơn.</li>
<li>Nếu cảnh sử dụng chính là tổng hợp hoặc sắp xếp, và hầu hết là numerics, dates, geo_points và các loại ký tự not_analyzed, nên cấp 4~32G bộ nhớ cho ES Heap; bộ nhớ khác để cho hệ điều hành, cho lucene sử dụng, cung cấp hiệu suất tổng hợp, sắp xếp nhanh hơn dựa trên tài liệu.</li>
<li>Nếu cảnh sử dụng là tổng hợp hoặc sắp xếp, và tất cả đều dựa trên dữ liệu ký tự analyzed, thì cần nhiều heap size hơn, nên chạy nhiều thực thể ES trên máy, mỗi thực thể giữ không vượt quá 50% cài đặt heap ES (nhưng không vượt quá 32 G, khi heap memory được cài đặt dưới 32 G, JVM sử dụng kỹ thuật nén chỉ số đối tượng để tiết kiệm không gian), hơn 50% để cho lucene.</li>
</ul>
<h4>Vô hiệu hóa swap</h4>
<p>Vô hiệu hóa swap, một khi cho phép trao đổi bộ nhớ với đĩa, sẽ gây ra vấn đề về hiệu suất nghiêm trọng. Có thể thông qua <code>bootstrap.memory_lock: true</code> trong elasticsearch.yml, để giữ JVM khóa bộ nhớ, đảm bảo hiệu suất của ES.</p>
<h4>Cài đặt GC</h4>
<p>Giữ cài đặt GC hiện tại, cài đặt mặc định là: Concurrent-Mark and Sweep (CMS), không chuyển sang G1 GC, vì hiện tại G1 vẫn có rất nhiều BUG.</p>
<p>Giữ cài đặt hiện tại của thread pool, hiện tại cài đặt thread pool của ES đã có nhiều cài đặt tối ưu hóa so với 1.X, giữ nguyên là được; kích thước thread pool mặc định bằng số lượng lõi CPU. Nếu cần thay đổi, cài đặt theo công thức ((số lượng lõi CPU * 3) / 2) + 1; không được vượt quá gấp đôi số lượng lõi CPU; nhưng không nên thay đổi cấu hình mặc định, nếu không sẽ gây tổn thương cho CPU.</p>
<h3>Đĩa</h3>
<p>Đĩa quan trọng đối với tất cả các cụm, đặc biệt quan trọng đối với các cụm có lượng ghi lớn (ví dụ như những cụm lưu trữ dữ liệu nhật ký). Đĩa là hệ thống con chậm nhất trên máy chủ, điều này có nghĩa là những cụm có lượng ghi lớn dễ dàng làm cho đĩa bão hòa, khiến nó trở thành nút thắt cổ chai của cụm.</p>
<p><strong>Trong phạm vi chịu đựng được áp lực kinh tế, hãy sử dụng ổ đĩa thể rắn (SSD) càng nhiều càng tốt</strong>. So với bất kỳ phương tiện quay nào (ổ đĩa cứng cơ học, băng từ, v.v.), ổ đĩa thể rắn sẽ tăng cường IO đáng kể, dù là ghi ngẫu nhiên hay ghi tuần tự.</p>
<blockquote>
<p>Nếu bạn đang sử dụng SSD, hãy đảm bảo rằng trình lập lịch I/O của hệ thống bạn được cấu hình đúng. Khi bạn ghi dữ liệu vào đĩa, trình lập lịch I/O quyết định khi nào thực sự gửi dữ liệu đến đĩa. Hầu hết các phiên bản *nix mặc định có trình lập lịch là cfq (Completely Fair Queuing).</p>
<p>Trình lập lịch phân bổ thời gian cho mỗi quy trình. Và tối ưu hóa việc chuyển các hàng đợi lớn đến đĩa. Nhưng nó được tối ưu hóa cho phương tiện quay: đặc tính cố hữu của ổ đĩa cơ học có nghĩa là việc ghi dữ liệu vào đĩa dựa trên bố cục vật lý sẽ hiệu quả hơn.</p>
<p>Điều này không hiệu quả đối với SSD, mặc dù không liên quan đến ổ đĩa cơ học. Tuy nhiên, deadline hoặc noop nên được sử dụng. Trình lập lịch deadline tối ưu hóa dựa trên thời gian chờ ghi, trong khi noop chỉ là một hàng đợi FIFO đơn giản.</p>
<p>Thay đổi đơn giản này có thể tạo ra sự khác biệt đáng kể. Chỉ cần sử dụng trình lập lịch đúng, chúng tôi đã thấy khả năng ghi tăng lên 500 lần.</p>
</blockquote>
<p><strong>Nếu bạn sử dụng phương tiện quay (như ổ đĩa cơ học), hãy cố gắng có được ổ đĩa nhanh nhất có thể (ổ đĩa máy chủ hiệu suất cao, ổ đĩa 15k RPM)</strong>.</p>
<p><strong>Sử dụng RAID0 là cách hiệu quả để tăng tốc độ đĩa, đối với cả ổ đĩa cơ học và SSD</strong>. Không cần phải sử dụng gương hoặc các biến thể RAID khác, bởi vì Elasticsearch đã cung cấp chức năng sao lưu ở cấp độ tự thân thông qua các bản sao, vì vậy không cần sử dụng chức năng sao lưu của đĩa, đồng thời nếu sử dụng chức năng sao lưu của đĩa, sẽ ảnh hưởng lớn đến tốc độ ghi.</p>
<p><strong>Cuối cùng, hãy tránh sử dụng lưu trữ kết nối mạng (NAS)</strong>. Mọi người thường tuyên bố rằng giải pháp NAS của họ nhanh hơn và đáng tin cậy hơn so với ổ đĩa cục bộ. Bỏ qua những tuyên bố này, chúng tôi chưa bao giờ thấy NAS đáng giá cho sự quảng cáo lớn của nó. NAS thường rất chậm, hiển thị độ trễ lớn hơn và phương sai độ trễ trung bình rộng hơn, và nó là điểm lỗi đơn.</p>
<h2>Cài đặt tối ưu hóa chỉ mục</h2>
<p>Tối ưu hóa chỉ mục chủ yếu tập trung vào việc tối ưu hóa ở mức độ chèn của Elasticsearch, tốc độ chỉ mục của Elasticsearch thực sự khá nhanh, dữ liệu cụ thể, chúng ta có thể tham khảo dữ liệu benchmark chính thức. Chúng ta có thể tối ưu hóa chỉ mục dựa trên các yêu cầu khác nhau.</p>
<h3>Gửi hàng loạt</h3>
<p>Khi có rất nhiều dữ liệu cần gửi, nên sử dụng gửi hàng loạt (hoạt động Bulk); ngoài ra, khi sử dụng yêu cầu bulk, mỗi yêu cầu không nên vượt quá vài chục MB, vì nếu quá lớn sẽ dẫn đến việc sử dụng quá nhiều bộ nhớ.</p>
<p>Ví dụ, trong quá trình thực thi ELK, Logstash indexer gửi dữ liệu vào Elasticsearch, kích thước batch có thể hoạt động như một điểm tối ưu hóa. Tuy nhiên, kích thước tối ưu cần phải xác định dựa trên kích thước tài liệu và hiệu suất máy chủ.</p>
<p>Ví dụ, trong Logstash, nếu kích thước tài liệu gửi vượt quá 20MB, Logstash sẽ chia một yêu cầu hàng loạt thành nhiều yêu cầu hàng loạt.</p>
<p>Nếu trong quá trình gửi, bạn gặp phải ngoại lệ EsRejectedExecutionException, thì điều này cho thấy hiệu suất chỉ mục của cụm đã đạt đến giới hạn. Trong trường hợp này, bạn cần tăng nguồn lực của cụm máy chủ hoặc giảm tốc độ thu thập dữ liệu dựa trên quy tắc kinh doanh, ví dụ chỉ thu thập nhật ký cấp Warn, Error trở lên.</p>
<h3>Tăng khoảng thời gian Refresh</h3>
<p>Để tăng hiệu suất chỉ mục, Elasticsearch sử dụng chiến lược ghi trễ khi ghi dữ liệu, tức là dữ liệu được ghi vào bộ nhớ trước, khi vượt quá 1 giây mặc định (index.refresh_interval) sẽ thực hiện một hoạt động ghi, tức là làm mới dữ liệu segment trong bộ nhớ vào đĩa, lúc này chúng ta mới có thể tìm kiếm dữ liệu. Đây là lý do tại sao Elasticsearch cung cấp chức năng tìm kiếm gần thời gian thực, chứ không phải là tìm kiếm thời gian thực.</p>
<p>Nếu hệ thống của chúng ta không đặt yêu cầu cao về độ trễ dữ liệu, chúng ta <strong>có thể tăng khoảng thời gian làm mới để giảm áp lực hợp nhất segment và tăng tốc độ chỉ mục</strong>. Ví dụ, trong quá trình theo dõi toàn bộ chuỗi, chúng tôi đã đặt <code>index.refresh_interval</code> thành 30 giây, giảm số lần làm mới. Một ví dụ khác, khi tiến hành chỉ mục toàn bộ, bạn có thể tạm thời tắt số lần làm mới, tức là đặt <code>index.refresh_interval</code> thành -1, sau khi dữ liệu được nhập thành công, hãy mở lại chế độ bình thường, ví dụ 30 giây.</p>
<blockquote>
<p>Khi tải dữ liệu lớn, bạn có thể tạm thời không sử dụng refresh và repliccas, đặt index.refresh_interval thành -1, đặt index.number_of_replicas thành 0.</p>
</blockquote>
<h3>Chỉnh sửa cài đặt index_buffer_size</h3>
<p>Cài đặt bộ đệm chỉ mục có thể kiểm soát bao nhiêu bộ nhớ được phân bổ cho quá trình chỉ mục. Đây là một cấu hình toàn cầu, sẽ được áp dụng cho tất cả các phân đoạn khác nhau trên một nút.</p>
<div class="language-yml" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">indices.memory.index_buffer_size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">10%</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">indices.memory.min_index_buffer_size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">48mb</span></span></code></pre>
</div><p><code>indices.memory.index_buffer_size</code> chấp nhận một phần trăm hoặc một giá trị biểu thị kích thước byte. Mặc định là 10%, có nghĩa là 10% tổng bộ nhớ được phân bổ cho nút được sử dụng để làm kích thước bộ đệm chỉ mục. Giá trị này được chia cho các phân đoạn (shards) khác nhau. Nếu bạn đặt phần trăm, bạn cũng có thể đặt <code>min_index_buffer_size</code> (mặc định là 48mb) và <code>max_index_buffer_size</code> (mặc định không có giới hạn trên).</p>
<h3>Chỉnh sửa cài đặt liên quan đến translog</h3>
<p>Một là kiểm soát tần suất hoạt động từ bộ nhớ đến ổ cứng, để giảm IO ổ cứng. Bạn có thể đặt thời gian sync_interval lớn hơn. Mặc định là 5 giây.</p>
<div class="language-yml" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.translog.sync_interval</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">5s</span></span></code></pre>
</div><p>Bạn cũng có thể kiểm soát kích thước khối dữ liệu tranlog, khi đạt đến kích thước threshold, dữ liệu mới sẽ được flush vào tệp chỉ mục lucene. Mặc định là 512mb.</p>
<div class="language-yml" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.translog.flush_threshold_size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">512mb</span></span></code></pre>
</div><h3>Chú ý sử dụng trường _id</h3>
<p>Trong việc sử dụng trường _id, bạn nên tránh tùy chỉnh _id để tránh quản lý phiên bản dựa trên ID; nên sử dụng chiến lược tạo ID mặc định của ES hoặc sử dụng ID kiểu số làm khóa chính.</p>
<h3>Chú ý sử dụng trường _all và trường _source</h3>
<p>Bạn nên chú ý đến việc sử dụng trường _all và trường _source, tùy thuộc vào tình huống và nhu cầu, trường _all bao gồm tất cả các trường chỉ mục, thuận tiện cho việc tìm kiếm toàn văn, nếu không có nhu cầu này, có thể tắt; _source lưu trữ nội dung tài liệu gốc, nếu không có nhu cầu lấy dữ liệu tài liệu gốc, có thể định nghĩa các trường được đưa vào _source bằng cách đặt thuộc tính includes, excludes.</p>
<h3>Sử dụng thuộc tính index một cách hợp lý</h3>
<p>Hãy sử dụng thuộc tính index một cách hợp lý, analyzed và not_analyzed, kiểm soát trường có phải là từ vựng hay không dựa trên yêu cầu kinh doanh. Chỉ cần các trường yêu cầu groupby, khi cấu hình, đặt thành not_analyzed để tăng hiệu suất truy vấn hoặc phân loại.</p>
<h3>Giảm số lượng bản sao</h3>
<p>Elasticsearch mặc định số lượng bản sao là 3, mặc dù điều này sẽ cải thiện khả năng sẵn có của cụm, tăng số lượng truy vấn đồng thời, nhưng cũng sẽ ảnh hưởng đến hiệu suất ghi chỉ mục.</p>
<p>Trong quá trình chỉ mục, cần gửi tài liệu được cập nhật đến các nút bản sao, chờ nút bản sao hoạt động sau đó trả về kết thúc. Khi sử dụng Elasticsearch để tìm kiếm kinh doanh, nên đặt số lượng bản sao là 3, nhưng trong hệ thống nhật ký ELK nội bộ, hệ thống theo dõi phân tán, hoàn toàn có thể đặt số lượng bản sao là 1.</p>
<h2>Tối ưu hóa về truy vấn</h2>
<p>Khi Elasticsearch được sử dụng như một truy vấn gần thời gian thực cho tìm kiếm kinh doanh, việc tối ưu hóa hiệu suất truy vấn trở nên rất quan trọng.</p>
<h3>Tối ưu hóa định tuyến</h3>
<p>Khi chúng tôi truy vấn một tài liệu, Elasticsearch làm thế nào để biết một tài liệu nên được lưu trữ trong phân đoạn nào? Thực tế, nó được tính toán thông qua công thức sau đây.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>shard = hash(routing) % number_of_primary_shards</span></span></code></pre>
</div><p>Giá trị mặc định của routing là id của tài liệu, nhưng cũng có thể sử dụng giá trị tùy chỉnh, chẳng hạn như ID người dùng.</p>
<h4>Truy vấn không có routing</h4>
<p>Khi truy vấn, vì không biết dữ liệu cần truy vấn cụ thể nằm trên phân đoạn nào, nên toàn bộ quá trình được chia thành 2 bước:</p>
<ol>
<li>Phân phối: Khi yêu cầu đến nút điều phối, nút điều phối sẽ phân phối yêu cầu truy vấn đến mỗi phân đoạn.</li>
<li>Tổng hợp: Nút điều phối thu thập kết quả truy vấn từ mỗi phân đoạn, sau đó sắp xếp kết quả truy vấn, sau đó trả về kết quả cho người dùng.</li>
</ol>
<h4>Truy vấn có routing</h4>
<p>Khi truy vấn, có thể trực tiếp xác định một phân đoạn truy vấn dựa trên thông tin routing, không cần truy vấn tất cả các phân đoạn, sau đó sắp xếp thông qua nút điều phối.</p>
<p>Như truy vấn người dùng tùy chỉnh ở trên, nếu routing được đặt là userid, thì có thể trực tiếp truy vấn ra dữ liệu, hiệu quả tăng rất nhiều.</p>
<h3>Filter VS Query</h3>
<p>Nếu có thể, hãy sử dụng ngữ cảnh bộ lọc (Filter) thay vì ngữ cảnh truy vấn (Query)</p>
<ul>
<li>Query: Tài liệu này khớp với câu truy vấn con này ở mức độ nào?</li>
<li>Filter: Tài liệu này có khớp với câu truy vấn con không?</li>
</ul>
<p>Elasticsearch chỉ cần trả lời "có" hoặc "không" cho các truy vấn Filter, không cần tính điểm liên quan như truy vấn Query, đồng thời kết quả Filter có thể được lưu vào bộ nhớ cache.</p>
<h3>Phân trang sâu</h3>
<p>Trong quá trình sử dụng Elasticsearch, nên tránh việc phân trang lớn xảy ra.</p>
<p>Truy vấn phân trang thông thường đều bắt đầu từ from và lấy size bản ghi, điều này yêu cầu truy vấn và xếp hạng from+size bản ghi đầu tiên trong mỗi phân đoạn. Nút điều phối thu thập from+size bản ghi đầu tiên từ mỗi phân đoạn. Nút điều phối sẽ nhận được N*(from+size) bản ghi, sau đó sắp xếp chúng, sau đó trả về from đến from+size bản ghi. Nếu from hoặc size rất lớn, số lượng bản ghi tham gia sắp xếp sẽ tăng lên nhiều, cuối cùng sẽ làm tăng tiêu hao tài nguyên CPU.</p>
<p>Có thể giải quyết vấn đề này bằng cách sử dụng scroll và scroll-scan hiệu quả của Elasticsearch.</p>
<p>Cũng có thể kết hợp với đặc điểm kinh doanh thực tế, nếu kích thước id tài liệu và thời gian tạo tài liệu là đồng nhất và có thứ tự, có thể sử dụng id tài liệu làm offset phân trang, và đặt nó làm một điều kiện truy vấn phân trang.</p>
<h3>Sử dụng script một cách hợp lý</h3>
<p>Chúng ta biết rằng việc sử dụng script chủ yếu có 3 hình thức, cách biên dịch động nội tuyến, lưu trữ trong thư viện chỉ mục _script và lưu trữ dưới dạng script tệp; cảnh báo thông thường là sắp xếp thô, nên sử dụng cách thứ hai để lưu trữ script trong thư viện chỉ mục _script trước, để biên dịch trước, sau đó sử dụng thông qua id script và kết hợp với params, có thể đạt được mô hình (logic) và dữ liệu đã được phân tách, đồng thời dễ dàng mở rộng và bảo dưỡng mô-đun script. Vui lòng tham khảo chi tiết về nội dung script ES tại <a href="https://www.knowledgedict.com/tutorial/elasticsearch-script.html" target="_blank" rel="noopener noreferrer">Giải thích chi tiết về mô-đun script Elasticsearch</a>.</p>
<h2>Tối ưu hóa cấu trúc dữ liệu</h2>
<p>Dựa trên các tình huống sử dụng của Elasticsearch, cấu trúc dữ liệu tài liệu nên được kết hợp với tình huống sử dụng, loại bỏ dữ liệu không cần thiết và không hợp lý.</p>
<h3>Giảm thiểu các trường không cần thiết</h3>
<p>Nếu Elasticsearch được sử dụng cho dịch vụ tìm kiếm kinh doanh, một số trường không cần thiết để tìm kiếm nên không được lưu trong ES. Điều này không chỉ tiết kiệm không gian, mà còn cải thiện hiệu suất tìm kiếm với cùng một lượng dữ liệu.</p>
<p>Tránh sử dụng giá trị động làm trường, việc tăng mapping động có thể dẫn đến sự cố ở cụm; tương tự, cần kiểm soát số lượng trường, không lập chỉ mục cho các trường không được sử dụng trong kinh doanh. Kiểm soát số lượng trường chỉ mục, độ sâu của mapping, loại trường chỉ mục, là quan trọng nhất trong việc tối ưu hóa hiệu suất ES.</p>
<p>Dưới đây là một số cài đặt mặc định của ES về số lượng trường, độ sâu mapping:</p>
<div class="language-yml" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.mapping.nested_objects.limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10000</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.mapping.total_fields.limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1000</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.mapping.depth.limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">20</span></span></code></pre>
</div><h3>Nested Object vs Parent/Child</h3>
<p>Hạn chế sử dụng các trường nested hoặc parent/child, không sử dụng nếu không cần thiết; nested query chậm, parent/child query còn chậm hơn, chậm hơn nested query hàng trăm lần; vì vậy, nếu có thể giải quyết ở giai đoạn thiết kế mapping (thiết kế bảng rộng lớn hoặc sử dụng cấu trúc dữ liệu thông minh), thì không nên sử dụng mapping quan hệ cha-con.</p>
<p>Nếu bạn cần sử dụng nested fields, hãy đảm bảo không có quá nhiều trường nested, hiện tại giới hạn mặc định của ES là 50. Bởi vì đối với 1 tài liệu, mỗi trường nested sẽ tạo ra một tài liệu độc lập, điều này sẽ làm tăng số lượng tài liệu một cách đáng kể, ảnh hưởng đến hiệu suất truy vấn, đặc biệt là hiệu suất JOIN.</p>
<div class="language-yml" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.mapping.nested_fields.limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">50</span></span></code></pre>
</div><p>| So sánh | Nested Object                        | Parent/Child                                       |<br>
| :</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Overview</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/overview.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/overview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Overview</source>
      <description>Elasticsearch MOC Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu dựa trên Lucene, cung cấp một dịch vụ phân tán. Elasticsearch là một sản phẩm mã nguồn mở tuân theo ...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu dựa trên Lucene, cung cấp một dịch vụ phân tán. Elasticsearch là một sản phẩm mã nguồn mở tuân theo các điều khoản mã nguồn mở của Apache và hiện đang là công cụ tìm kiếm doanh nghiệp phổ biến.</p>
</blockquote>
<h2>📖 Contents</h2>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Query</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/query.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/query.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Query</source>
      <description>Elasticsearch Query Câu truy vấn Elasticsearch sử dụng interface dựa trên phong cách RESTful được đóng gói thành đối tượng JSON, được gọi là Query DSL. Elasticsearch chia các tr...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Câu truy vấn Elasticsearch sử dụng interface dựa trên phong cách RESTful được đóng gói thành đối tượng JSON, được gọi là Query DSL. Elasticsearch chia các truy vấn thành các loại chính sau: <strong>truy vấn toàn văn</strong>, <strong>truy vấn từ khoá</strong>, <strong>truy vấn kết hợp</strong>, <strong>truy vấn lồng nhau</strong>, <strong>truy vấn vị trí</strong>, <strong>truy vấn đặc biệt</strong>. Một cách phân loại khác của Elasticsearch truy vấn dựa vào cơ chế, một là dựa vào từ khoá truy vấn được người dùng nhập vào, thông qua mô hình xếp hạng để tính toán <strong>mức độ liên quan</strong> giữa tài liệu và từ khoá truy vấn, và trả về dựa trên thứ tự điểm số; cách khác là <strong>cơ chế lọc</strong>, chỉ lọc tài liệu dựa trên điều kiện lọc, không tính toán điểm số, tốc độ tương đối nhanh hơn.</p>
<h2>Truy vấn toàn văn</h2>
<p>Truy vấn toàn văn ES chủ yếu được sử dụng trên các trường toàn văn, chủ yếu xem xét mức độ liên quan (Relevance) giữa từ khoá truy vấn và tài liệu.</p>
<h3>intervals query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-intervals-query.html" target="_blank" rel="noopener noreferrer"><strong><code>intervals query</code></strong></a> trả về tài liệu dựa trên thứ tự và độ tương quan của từ khoá khớp.</p>
<p>intervals query sử dụng <strong>quy tắc khớp</strong>, các quy tắc này được áp dụng cho các term trong trường đã chỉ định.</p>
<p>Ví dụ: Ví dụ dưới đây tìm kiếm trường <code>query</code>, giá trị tìm kiếm là <code>my favorite food</code>, không có bất kỳ khoảng trắng nào; sau đó là trường <code>my_text</code> tìm kiếm term khớp <code>hot water</code>, <code>cold porridge</code>.</p>
<p>Khi giá trị của my_text là <code>my favorite food is cold porridge</code>, nó sẽ khớp thành công, nhưng <code>when it's cold my favorite food is porridge</code> thì không khớp.</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> _search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "intervals"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "my_text"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "all_of"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "ordered"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "intervals"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "match"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "my favorite food",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "max_gaps"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "ordered"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">              }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "any_of"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "intervals"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"match"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "hot water"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"match"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "cold porridge"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">              }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>match query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html" target="_blank" rel="noopener noreferrer"><strong><code>match query</code></strong></a> <strong>được sử dụng để tìm kiếm một trường đơn</strong>, đầu tiên sẽ phân tích câu truy vấn (qua analyzer), chủ yếu là để tách câu truy vấn thành các từ, sau khi tách từ, bất kỳ từ nào trong câu truy vấn khớp, tài liệu sẽ được tìm thấy, theo mặc định, nó tương đương với việc thực hiện hoạt động khớp or sau khi tách từ.</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html" target="_blank" rel="noopener noreferrer"><strong><code>match query</code></strong></a> là truy vấn tiêu chuẩn để thực hiện tìm kiếm toàn văn, bao gồm các tùy chọn khớp mờ.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "customer_full_name"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "George Hubbard"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Tương đương với hoạt động khớp <code>or</code>, như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "customer_full_name"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "George Hubbard",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "or"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>match query viết tắt</h4>
<p>Bạn có thể đơn giản hóa cú pháp truy vấn khớp bằng cách kết hợp tham số <code>&lt;field&gt;</code> và <code>query</code>.</p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "message"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "this is a test"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>match query hoạt động như thế nào</h4>
<p>Truy vấn khớp là kiểu boolean. Điều này có nghĩa là nó sẽ phân tích văn bản được cung cấp, quá trình phân tích sẽ xây dựng một truy vấn boolean từ văn bản được cung cấp. Tham số <code>operator</code> có thể được đặt thành <code>or</code> hoặc <code>and</code> để kiểm soát các mệnh đề con boolean (mặc định là <code>or</code>). Bạn có thể sử dụng tham số <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-minimum-should-match.html" target="_blank" rel="noopener noreferrer"><code>minimum_should_match</code></a> để đặt số lượng tối thiểu các mệnh đề <code>should</code> tùy chọn cần phải khớp.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "customer_full_name"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "George Hubbard",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "and"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Bạn có thể đặt <code>analyzer</code> để kiểm soát analyzer nào sẽ thực hiện quá trình phân tích văn bản. Nó mặc định là analyzer đã được định rõ trong định nghĩa mapping trường hoặc analyzer tìm kiếm mặc định.</p>
<p>Tham số <code>lenient</code> có thể được đặt thành <code>true</code> để bỏ qua các ngoại lệ do không khớp kiểu dữ liệu, chẳng hạn như cố gắng truy vấn chuỗi số trên trường số. Mặc định là <code>false</code>.</p>
<h4>match query khớp mờ</h4>
<p><code>fuzziness</code> cho phép khớp mờ dựa trên loại trường đang được truy vấn. Xem cấu hình <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/common-options.html#fuzziness" target="_blank" rel="noopener noreferrer">Fuzziness</a>.</p>
<p>Trong trường hợp này, bạn có thể đặt <code>prefix_length</code> và <code>max_expansions</code> để kiểm soát khớp mờ. Nếu đã đặt các tùy chọn mờ, truy vấn sẽ sử dụng <code>top_terms_blended_freqs_${max_expansions}</code> làm phương pháp viết lại của nó, tham số <code>fuzzy_rewrite</code> cho phép kiểm soát cách truy vấn sẽ được viết lại.</p>
<p>Theo mặc định, cho phép đảo ngược mờ (<code>ab</code> → <code>ba</code>), nhưng có thể bị vô hiệu hóa bằng cách đặt <code>fuzzy_transpositions</code> thành <code>false</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "message"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "this is a testt",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "fuzziness"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "AUTO"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>zero terms query</h4>
<p>Nếu analyzer được sử dụng loại bỏ tất cả các token trong truy vấn, thì hành vi mặc định là không khớp với bất kỳ tài liệu nào. Bạn có thể sử dụng tùy chọn <code>zero_terms_query</code> để thay đổi hành vi mặc định, nó chấp nhận <code>none</code> (mặc định) và <code>all</code> (tương đương với truy vấn <code>match_all</code>).</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "message"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "to be or not to be",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "and",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "zero_terms_query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "all"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>match_bool_prefix query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-bool-prefix-query.html" target="_blank" rel="noopener noreferrer"><strong><code>match_bool_prefix query</code></strong></a> phân tích đầu vào của nó và xây dựng một truy vấn boolean dựa trên các từ này. Mỗi từ, ngoại trừ từ cuối cùng, được sử dụng trong một truy vấn từ. Từ cuối cùng được sử dụng trong một <code>prefix query</code>.</p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_bool_prefix"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "message"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "quick brown f"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Tương đương với</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "bool"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "should"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "message":</span><span style="color:#98C379;--shiki-dark:#98C379"> "quick"</span><span style="color:#98C379;--shiki-dark:#98C379"> }},</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "message":</span><span style="color:#98C379;--shiki-dark:#98C379"> "brown"</span><span style="color:#98C379;--shiki-dark:#98C379"> }},</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"prefix"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "message":</span><span style="color:#98C379;--shiki-dark:#98C379"> "f"}}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Một sự khác biệt quan trọng giữa <code>match_bool_prefix query</code> và <code>match_phrase_prefix query</code> là: <code>match_phrase_prefix query</code> sẽ khớp các term của nó như một cụm từ, nhưng <code>match_bool_prefix query</code> có thể khớp các term của nó ở bất kỳ vị trí nào.</p>
<p>Ví dụ truy vấn <code>match_bool_prefix query</code> ở trên có thể khớp với các trường chứa <code>quick brown fox</code>, nhưng nó cũng có thể khớp nhanh với <code>brown fox</code>. Nó cũng có thể khớp với các trường chứa <code>quick</code>, <code>brown</code> và bắt đầu bằng <code>f</code>, xuất hiện ở bất kỳ vị trí nào.</p>
<h3>match_phrase query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html" target="_blank" rel="noopener noreferrer"><strong><code>match_phrase query</code></strong></a> tức là khớp cụm từ, đầu tiên nó sẽ tách nội dung query thành các từ, bộ tách từ có thể được tùy chỉnh, đồng thời tài liệu cũng phải đáp ứng hai điều kiện sau đây mới được tìm kiếm:</p>
<ol>
<li><strong>Tất cả các từ sau khi tách phải xuất hiện trong trường này (tương đương với hoạt động and)</strong>.</li>
<li><strong>Thứ tự của các từ trong trường phải phù hợp</strong>.</li>
</ol>
<p>Ví dụ, có 3 tài liệu sau, sử dụng <strong><code>match_phrase</code></strong> để truy vấn "How are you", chỉ có hai tài liệu đầu tiên được khớp:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> demo/_create/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "How are you"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> demo/_create/2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "How are you, Jack?"}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> demo/_create/3</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "are you"}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> demo/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_phrase"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "How are you"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>Ghi chú:</p>
<p>Một tài liệu được xác định là khớp với cụm từ "How are you" phải đáp ứng các yêu cầu sau đây:</p>
<ul>
<li>How, are và you cần phải xuất hiện trong trường.</li>
<li>Vị trí của are phải lớn hơn vị trí của How là 1.</li>
<li>Vị trí của you phải lớn hơn vị trí của How là 2.</li>
</ul>
</blockquote>
<h3>match_phrase_prefix query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html" target="_blank" rel="noopener noreferrer"><strong><code>match_phrase_prefix query</code></strong></a> tương tự như <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html" target="_blank" rel="noopener noreferrer"><strong><code>match_phrase query</code></strong></a>, chỉ khác là <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html" target="_blank" rel="noopener noreferrer"><strong><code>match_phrase_prefix query</code></strong></a> sẽ xem term cuối cùng như một prefix match.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> demo/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_phrase_prefix"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "are yo"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Trong ví dụ này, Elasticsearch sẽ tìm kiếm các tài liệu có trường "desc" chứa cụm từ bắt đầu bằng "are yo". Cụm từ này có thể hoàn thành với bất kỳ từ nào bắt đầu bằng "yo", chẳng hạn như "you" hoặc "yoga". Điều này có thể hữu ích khi bạn muốn tìm kiếm một cụm từ nhưng chỉ biết một phần của nó.</p>
<h3>multi_match query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html" target="_blank" rel="noopener noreferrer"><strong><code>multi_match query</code></strong></a> là một phiên bản nâng cấp của <strong><code>match query</code></strong>, <strong>được sử dụng để tìm kiếm trên nhiều trường</strong>.</p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "multi_match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 34.98,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "taxful_total_price"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "taxless_total_price"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Trường tìm kiếm của <strong><code>multi_match query</code></strong> có thể được chỉ định bằng cách sử dụng ký tự đại diện, ví dụ như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "multi_match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 34.98,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "taxful_*"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "taxless_total_price"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Đồng thời, bạn cũng có thể <strong>chỉ định trọng số của trường tìm kiếm bằng cách sử dụng ký hiệu mũ</strong>.</p>
<p>Ví dụ: chỉ định trọng số của trường taxful_total_price là gấp ba lần trường taxless_total_price, lệnh như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "multi_match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 34.98,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "taxful_total_price^3"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "taxless_total_price"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Điều này có nghĩa là kết quả tìm kiếm từ trường "taxful_total_price" sẽ có trọng số cao hơn ba lần so với kết quả từ trường "taxless_total_price".</p>
<h3>combined_fields query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-combined-fields-query.html" target="_blank" rel="noopener noreferrer"><strong><code>combined_fields query</code></strong></a> hỗ trợ tìm kiếm nhiều trường văn bản, giống như nội dung của chúng đã được lập chỉ mục vào một trường kết hợp. Truy vấn này tạo ra một góc nhìn dựa trên term của chuỗi đầu vào: đầu tiên nó phân tích chuỗi truy vấn thành các term độc lập, sau đó tìm kiếm mỗi term trong tất cả các trường. Khi kết quả phù hợp có thể trải qua nhiều trường văn bản, truy vấn này đặc biệt hữu ích, ví dụ như tiêu đề, tóm tắt và nội dung của một bài viết:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "combined_fields"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">      "database systems",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">     [ </span><span style="color:#98C379;--shiki-dark:#98C379">"title",</span><span style="color:#98C379;--shiki-dark:#98C379"> "abstract",</span><span style="color:#98C379;--shiki-dark:#98C379"> "body"],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">   "and"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Trọng số tiền tố trường</h4>
<p>Trọng số tiền tố trường được tính toán dựa trên mô hình trường kết hợp. Ví dụ, nếu trọng số của trường tiêu đề là 2, thì khi tính điểm độ phù hợp, mỗi term tạo ra từ trường tiêu đề sẽ được tính điểm như thể nó xuất hiện hai lần.</p>
<h3>common_terms query</h3>
<blockquote>
<p>Đã bị loại bỏ từ phiên bản 7.3.0</p>
</blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-common-terms-query.html" target="_blank" rel="noopener noreferrer"><strong><code>common_terms query</code></strong></a> là một giải pháp để cải thiện độ chính xác và độ bao phủ của tìm kiếm mà không làm giảm hiệu suất, thay thế cho việc sử dụng từ dừng (stop words).</p>
<p>Mỗi từ trong truy vấn đều có một chi phí nhất định. Ví dụ, khi tìm kiếm "The brown fox", truy vấn sẽ được phân tích thành ba từ: "the", "brown", và "fox", mỗi từ sẽ thực hiện một truy vấn trong chỉ mục. Rõ ràng, số lượng tài liệu chứa "the" rất nhiều, so với các từ khác, tầm quan trọng của "the" thấp hơn nhiều. Cách giải quyết truyền thống là coi "the" là một từ dừng, loại bỏ từ dừng có thể giảm kích thước chỉ mục và giảm việc thu hẹp từ dừng khi tìm kiếm.</p>
<p>Tuy nhiên, mặc dù từ dừng không ảnh hưởng nhiều đến việc đánh giá tài liệu, nhưng khi từ dừng vẫn có ý nghĩa quan trọng, việc loại bỏ từ dừng không phải là giải pháp hoàn hảo. Nếu loại bỏ từ dừng, bạn không thể phân biệt "happy" và "not happy", "The" trong "To be or not to be" sẽ không tồn tại trong chỉ mục, làm giảm độ chính xác và độ bao phủ của tìm kiếm.</p>
<p><code>common_terms query</code> cung cấp một giải pháp, nó chia những từ sau khi phân tách truy vấn thành từ quan trọng (từ có tần suất thấp) và từ không quan trọng (từ có tần suất cao, cũng chính là từ dừng trước đây). Khi tìm kiếm, đầu tiên tìm kiếm tài liệu phù hợp với từ quan trọng, những tài liệu này là những tài liệu mà từ xuất hiện ít và ảnh hưởng lớn đến việc đánh giá. Sau đó, thực hiện truy vấn thứ hai, tìm kiếm từ có tần suất cao ảnh hưởng ít đến việc đánh giá, nhưng không tính điểm cho tất cả tài liệu, chỉ tính điểm cho tài liệu đã phù hợp trong truy vấn đầu tiên. Nếu một truy vấn chỉ chứa từ có tần suất cao, thì sẽ thực hiện một truy vấn độc lập thông qua toán tử "and", nói cách khác, sẽ tìm kiếm tất cả các từ.</p>
<p>Từ là từ có tần suất cao hay tần suất thấp được thiết lập thông qua giá trị ngưỡng cutoff frequency, có thể là tần suất tuyệt đối (tần suất lớn hơn 1) hoặc tần suất tương đối (0 ~ 1). Điểm thú vị nhất của <code>common_terms query</code> là nó có thể tự điều chỉnh từ dừng cho lĩnh vực cụ thể, ví dụ, trên trang web lưu trữ video, các từ có tần suất cao như "clip" hoặc "video" sẽ tự động được coi là từ dừng, không cần duy trì danh sách thủ công.</p>
<p>Ví dụ, từ có tần suất xuất hiện trong tài liệu lớn hơn 0.1% sẽ được coi là từ có tần suất cao, từ có tần suất có thể được kết nối bằng các tham số low_freq_operator và high_freq_operator. Thiết lập toán tử từ có tần suất thấp là "and" để tất cả các từ có tần suất thấp đều phải tìm kiếm, ví dụ mã như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> books/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"common"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"body"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "nelly the elephant as a cartoon",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"cutoff_frequency"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 0.001,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"low_freq_operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "and"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Hoạt động trên tương đương với:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> books/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"bool"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"must"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "body":</span><span style="color:#98C379;--shiki-dark:#98C379"> "nelly"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "body":</span><span style="color:#98C379;--shiki-dark:#98C379"> "elephant"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "body":</span><span style="color:#98C379;--shiki-dark:#98C379"> "cartoon"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"should"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "body":</span><span style="color:#98C379;--shiki-dark:#98C379"> "the"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "body":</span><span style="color:#98C379;--shiki-dark:#98C379"> "as"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "body":</span><span style="color:#98C379;--shiki-dark:#98C379"> "a"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>query_string query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html" target="_blank" rel="noopener noreferrer"><strong><code>query_string query</code></strong></a> là một loại truy vấn gắn kết chặt chẽ với cú pháp truy vấn của Lucene, cho phép sử dụng nhiều từ khóa điều kiện đặc biệt (như: AND | OR | NOT) trong một câu truy vấn để tìm kiếm trên nhiều trường, khuyến nghị cho người dùng đã quen với cú pháp truy vấn của Lucene.</p>
<p>Người dùng có thể sử dụng <code>query_string query</code> để tạo các truy vấn phức tạp bao gồm ký tự đại diện, tìm kiếm trên nhiều trường, v.v. Mặc dù là phổ biến, nhưng truy vấn là nghiêm ngặt, nếu chuỗi truy vấn chứa bất kỳ cú pháp không hợp lệ nào, sẽ trả về lỗi.</p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "query_string"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "(new york city) OR (big apple)",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "default_field"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "content"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>simple_query_string query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html" target="_blank" rel="noopener noreferrer"><strong><code>simple_query_string query</code></strong></a> là một loại truy vấn phù hợp để trực tiếp tiếp xúc với người dùng và có cú pháp truy vấn rất hoàn chỉnh, chấp nhận cú pháp truy vấn của Lucene, không ném ra ngoại lệ nếu có lỗi trong quá trình phân tích cú pháp.</p>
<p>Mặc dù cú pháp nghiêm ngặt hơn <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html" target="_blank" rel="noopener noreferrer"><strong><code>query_string query</code></strong></a>, nhưng <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html" target="_blank" rel="noopener noreferrer"><strong><code>simple_query_string query</code></strong></a> không trả về lỗi cú pháp không hợp lệ. Ngược lại, nó sẽ bỏ qua bất kỳ phần không hợp lệ nào của chuỗi truy vấn.</p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "simple_query_string"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\"</span><span style="color:#98C379;--shiki-dark:#98C379">fried eggs</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\"</span><span style="color:#98C379;--shiki-dark:#98C379"> +(eggplant | potato) -frittata",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"title^5"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"body"],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "default_operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "and"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Ý nghĩa của simple_query_string</h4>
<ul>
<li><code>+</code>: tương đương với toán tử AND</li>
<li><code>|</code>: tương đương với toán tử OR</li>
<li><code>-</code>: tương đương với toán tử NOT</li>
<li><code>"</code>: bao quanh một số token để chỉ ra cụm từ dùng để tìm kiếm</li>
<li><code>*</code>: sau một từ để chỉ ra truy vấn tiền tố</li>
<li><code>(</code> và <code>)</code>: chỉ ra mức độ ưu tiên</li>
<li><code>~N</code>: sau một từ để chỉ ra khoảng cách chỉnh sửa (mờ)</li>
<li><code>~N</code>: sau một cụm từ để chỉ ra lượng tràn</li>
</ul>
<p>Lưu ý: Để sử dụng các ký tự trên, hãy sử dụng dấu gạch chéo ngược <code>/</code> để thoát.</p>
<h3>Ví dụ hoàn chỉnh về truy vấn toàn văn</h3>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Đặt position_increment_gap</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> groups</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> groups</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "properties"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "names"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "text",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "position_increment_gap"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> groups/_mapping</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> groups/_doc</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "names"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [ </span><span style="color:#98C379;--shiki-dark:#98C379">"John Water",</span><span style="color:#98C379;--shiki-dark:#98C379"> "Water Smith"]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> groups/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_phrase"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "names"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Water Water",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "slop"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 100</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> groups/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_phrase"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "names"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Water Smith"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> groups</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ví dụ này, chúng tôi thiết lập <code>position_increment_gap</code> cho trường "names" trong chỉ mục "groups". <code>position_increment_gap</code> được sử dụng để kiểm soát cách Elasticsearch xử lý các mảng của chuỗi văn bản khi thực hiện truy vấn cụm từ. Trong trường hợp này, nó được cài đặt là 0, có nghĩa là không có khoảng cách giữa các phần tử trong mảng.</p>
<p>Sau đó, chúng tôi thêm một tài liệu vào chỉ mục, với trường "names" bao gồm hai chuỗi: "John Water" và "Water Smith".</p>
<p>Tiếp theo, chúng tôi thực hiện hai truy vấn <code>match_phrase</code> khác nhau. Truy vấn đầu tiên tìm kiếm cụm từ "Water Water" với một "slop" (cho phép sự không khớp) là 100. Truy vấn thứ hai tìm kiếm cụm từ "Water Smith".</p>
<p>Cuối cùng, chúng tôi xóa chỉ mục "groups".</p>
<h2>Truy vấn từ khóa</h2>
<p><strong><code>Term</code> (từ khóa) là đơn vị nhỏ nhất để diễn đạt ý nghĩa</strong>. Cả việc tìm kiếm và xử lý ngôn ngữ tự nhiên bằng mô hình ngôn ngữ thống kê đều cần xử lý Term.</p>
<p>Truy vấn toàn văn sẽ phân tích chuỗi truy vấn trước khi thực hiện truy vấn.</p>
<p>Khác với truy vấn toàn văn, truy vấn từ khóa không phân tách từ, mà coi đầu vào là một thể thống nhất, tìm kiếm các từ khóa chính xác trong chỉ mục đảo ngược và sử dụng công thức tính toán độ liên quan cho mỗi tài liệu chứa từ khóa đó. Nói cách khác: <strong>truy vấn từ khóa là việc khớp chính xác từ khóa</strong>. Truy vấn từ khóa thường được sử dụng cho dữ liệu có cấu trúc, như số, ngày và kiểu liệt kê.</p>
<p>Các loại truy vấn từ khóa bao gồm:</p>
<ul>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="noopener noreferrer"><code>exists</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html" target="_blank" rel="noopener noreferrer"><code>fuzzy</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html" target="_blank" rel="noopener noreferrer"><code>ids</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-prefix-query.html" target="_blank" rel="noopener noreferrer"><code>prefix</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html" target="_blank" rel="noopener noreferrer"><code>range</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html" target="_blank" rel="noopener noreferrer"><code>regexp</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" target="_blank" rel="noopener noreferrer"><code>term</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-query.html" target="_blank" rel="noopener noreferrer"><code>terms</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-type-query.html" target="_blank" rel="noopener noreferrer"><code>type</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html" target="_blank" rel="noopener noreferrer"><code>wildcard</code> query</a></strong></li>
</ul>
<h3>exists query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="noopener noreferrer"><strong><code>exists query</code></strong></a> sẽ trả về các tài liệu có ít nhất một giá trị không trống trong trường.</p>
<p>Vì nhiều lý do, trường của tài liệu có thể không tồn tại giá trị chỉ mục:</p>
<ul>
<li>Trường trong JSON là <code>null</code> hoặc <code>[]</code></li>
<li>Trường này được cấu hình <code>"index" : false</code> trong mapping</li>
<li>Độ dài giá trị trường vượt quá cài đặt <code>ignore_above</code> trong mapping</li>
<li>Định dạng giá trị trường không đúng và <code>ignore_malformed</code> đã được định nghĩa trong mapping</li>
</ul>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "exists"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "field"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "email"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Các tài liệu sau sẽ khớp với truy vấn trên:</p>
<ul>
<li><code>{ "user" : "jane" }</code> có trường user và không trống.</li>
<li><code>{ "user" : "" }</code> có trường user, giá trị là chuỗi trống.</li>
<li><code>{ "user" : "-" }</code> có trường user, giá trị không trống.</li>
<li><code>{ "user" : [ "jane" ] }</code> có trường user, giá trị không trống.</li>
<li><code>{ "user" : [ "jane", null ] }</code> có trường user, chỉ cần có ít nhất một giá trị không trống.</li>
</ul>
<p>Các tài liệu sau sẽ không khớp:</p>
<ul>
<li><code>{ "user" : null }</code> có trường user nhưng giá trị trống.</li>
<li><code>{ "user" : [] }</code> có trường user nhưng giá trị trống.</li>
<li><code>{ "user" : [null] }</code> có trường user nhưng giá trị trống.</li>
<li><code>{ "foo" : "bar" }</code> không có trường user.</li>
</ul>
<h3>fuzzy query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html" target="_blank" rel="noopener noreferrer"><strong><code>fuzzy query</code></strong> (truy vấn mờ)</a> trả về các tài liệu chứa các từ tương tự với từ tìm kiếm. ES sử dụng <a href="https://en.wikipedia.org/wiki/Levenshtein_distance" target="_blank" rel="noopener noreferrer">Khoảng cách chỉnh sửa Levenshtein</a> để đo độ tương tự hoặc mờ.</p>
<p>Khoảng cách chỉnh sửa là số lượng thay đổi ký tự đơn lẻ cần thiết để chuyển đổi một thuật ngữ thành thuật ngữ khác. Những thay đổi này có thể bao gồm:</p>
<ul>
<li>Thay đổi một ký tự: (<strong>b</strong>ox -&gt; <strong>f</strong>ox)</li>
<li>Xóa một ký tự: (<strong>b</strong>lack -&gt; lack)</li>
<li>Thêm một ký tự: (sic -&gt; sic<strong>k</strong>)</li>
<li>Đảo ngược hai ký tự liền kề: (<strong>ac</strong>t → <strong>ca</strong>t)</li>
</ul>
<p>Để tìm các từ khóa tương tự, truy vấn mờ sẽ tạo ra tất cả các biến thể hoặc tập mở rộng có thể của từ khóa tìm kiếm trong khoảng cách chỉnh sửa được chỉ định. Sau đó, nó trả về các tài liệu khớp hoàn toàn với bất kỳ tập mở rộng nào.</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> books/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "fuzzy"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "user.id"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "ki",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "fuzziness"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "AUTO",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "max_expansions"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 50,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "prefix_length"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "transpositions"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "rewrite"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "constant_score"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lưu ý: Nếu <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html#query-dsl-allow-expensive-queries" target="_blank" rel="noopener noreferrer"><code>search.allow_expensive_queries</code></a> đã được cấu hình, thì truy vấn mờ không thể được thực thi.</p>
<h3>ids query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html" target="_blank" rel="noopener noreferrer"><strong><code>ids query</code></strong></a> trả về các tài liệu dựa trên ID. Truy vấn này sử dụng ID tài liệu được lưu trữ trong trường <code>_id</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "ids"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "values"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"4",</span><span style="color:#98C379;--shiki-dark:#98C379"> "100"]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>prefix query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-prefix-query.html#prefix-query-ex-request" target="_blank" rel="noopener noreferrer"><strong><code>prefix query</code></strong></a> được sử dụng để truy vấn các tài liệu có chứa tiền tố chỉ định trong một trường nào đó.</p>
<p>Ví dụ, để truy vấn các tài liệu có <code>user.id</code> chứa các từ khóa bắt đầu bằng <code>ki</code>, tất cả các tài liệu chứa các từ khóa như <code>kind</code>, <code>kid</code> và bất kỳ từ khóa nào khác bắt đầu bằng <code>ki</code> sẽ được khớp.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "prefix"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "user.id"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "ki"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>range query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html" target="_blank" rel="noopener noreferrer"><strong><code>range query</code></strong></a> hay truy vấn phạm vi, được sử dụng để khớp các tài liệu có trường số, ngày hoặc chuỗi trong một phạm vi nhất định. Ví dụ, tìm kiếm những quyển sách có giá từ 50 đến 100, hoặc những quyển sách được xuất bản từ năm 2015 đến năm 2019. <strong>Truy vấn phạm vi chỉ có thể truy vấn một trường, không thể áp dụng trên nhiều trường</strong>.</p>
<p>Truy vấn phạm vi hỗ trợ các tham số sau:</p>
<ul>
<li><strong><code>gt</code></strong>: lớn hơn</li>
<li><strong><code>gte</code></strong>: lớn hơn hoặc bằng</li>
<li><strong><code>lt</code></strong>: nhỏ hơn</li>
<li><strong><code>lte</code></strong>: nhỏ hơn hoặc bằng</li>
<li><strong><code>format</code></strong>: nếu trường là loại Date, bạn có thể đặt định dạng ngày</li>
<li><strong><code>time_zone</code></strong>: múi giờ</li>
<li><strong><code>relation</code></strong>: chỉ ra cách truy vấn phạm vi khớp với các giá trị trường phạm vi.
<ul>
<li><strong><code>INTERSECTS</code> (Mặc định)</strong>: Khớp với các tài liệu có giá trị trường phạm vi giao nhau với truy vấn.</li>
<li><strong><code>CONTAINS</code></strong>: Khớp với các tài liệu hoàn toàn chứa giá trị trường của truy vấn.</li>
<li><strong><code>WITHIN</code></strong>: Khớp với các tài liệu có giá trị trường phạm vi hoàn toàn trong phạm vi truy vấn.</li>
</ul>
</li>
</ul>
<p>Ví dụ: Truy vấn phạm vi số</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "range"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "taxful_total_price"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "gt"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 10,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "lte"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 50</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Ví dụ: Truy vấn phạm vi ngày</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "range"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "order_date"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "time_zone"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "+00:00",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "gte"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "2018-01-01T00:00:00",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "lte"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "now"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>regexp query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html" target="_blank" rel="noopener noreferrer"><strong><code>regexp query</code></strong></a> trả về các tài liệu thuộc về các term khớp với biểu thức chính quy.</p>
<p><a href="https://vi.wikipedia.org/wiki/Bi%E1%BB%83u_th%E1%BB%A9c_ch%C3%ADnh_quy" target="_blank" rel="noopener noreferrer">Biểu thức chính quy</a> là một phương pháp sử dụng các ký tự đại diện để khớp với các mô hình dữ liệu, được gọi là toán tử.</p>
<p>Ví dụ: Tìm kiếm dưới đây trả về các tài liệu có trường <code>user.id</code> chứa bất kỳ từ nào bắt đầu bằng <code>k</code> và kết thúc bằng <code>y</code>. Toán tử <code>.*</code> khớp với bất kỳ ký tự nào với bất kỳ độ dài nào, bao gồm cả không có ký tự. Các từ khớp có thể bao gồm <code>ky</code>, <code>kay</code> và <code>kimchy</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "regexp"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "user.id"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "k.*y",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "flags"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "ALL",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "case_insensitive"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "max_determinized_states"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 10000,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "rewrite"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "constant_score"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Nếu <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html#query-dsl-allow-expensive-queries" target="_blank" rel="noopener noreferrer"><code>search.allow_expensive_queries</code></a> được cấu hình, thì <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html" target="_blank" rel="noopener noreferrer"><strong><code>regexp query</code></strong></a> sẽ bị vô hiệu hóa.</p>
</blockquote>
<h3>term query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" target="_blank" rel="noopener noreferrer"><strong><code>term query</code></strong></a> được sử dụng để tìm các tài liệu có chứa từ cụ thể trong một trường cụ thể. Truy vấn term không được phân tích, chỉ khi từ truy vấn và từ trong tài liệu khớp chính xác thì mới được tìm kiếm. Các tình huống áp dụng bao gồm tìm kiếm tên người, tên địa điểm và các yêu cầu khớp chính xác khác.</p>
<p>Ví dụ:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 1. Tạo một chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "properties"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "full_text"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "type":</span><span style="color:#98C379;--shiki-dark:#98C379"> "text"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 2. Sử dụng từ khóa "Quick Brown Foxes!" để tìm kiếm trường "full_text"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "full_text"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quick Brown Foxes!"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 3. Sử dụng term query</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001/_search?pretty</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "full_text"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quick Brown Foxes!"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Vì trường full_text không còn chứa Term chính xác - "Quick Brown Foxes!", nên term query không tìm thấy kết quả nào</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 4. Sử dụng match query</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001/_search?pretty</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "full_text"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quick Brown Foxes!"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>⚠️ Lưu ý: Nên tránh sử dụng term query để truy vấn các trường text.</p>
<p>Theo mặc định, Elasticsearch phân tích các giá trị của trường text, điều này khiến việc tìm kiếm khớp chính xác với giá trị của trường text trở nên khó khăn.</p>
<p>Để tìm kiếm giá trị của trường text, bạn nên sử dụng match query.</p>
</blockquote>
<h3>terms query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-query.html" target="_blank" rel="noopener noreferrer"><strong><code>terms query</code></strong></a> giống với <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" target="_blank" rel="noopener noreferrer"><strong><code>term query</code></strong></a>, nhưng có thể tìm kiếm nhiều giá trị.</p>
<p>Các tham số truy vấn terms query:</p>
<ul>
<li><strong><code>index</code></strong>: Tên chỉ mục</li>
<li><strong><code>id</code></strong>: ID tài liệu</li>
<li><strong><code>path</code></strong>: Tên của trường mà từ đó lấy giá trị trường, tức từ khóa tìm kiếm</li>
<li><strong><code>routing</code></strong> (tùy chọn): Giá trị định tuyến tùy chỉnh của tài liệu từ đó lấy giá trị term. Nếu giá trị định tuyến tùy chỉnh đã được cung cấp khi lập chỉ mục tài liệu, thì tham số này là bắt buộc.</li>
</ul>
<p>Ví dụ:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 1. Tạo một chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "properties"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "color"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "type":</span><span style="color:#98C379;--shiki-dark:#98C379"> "keyword"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 2. Ghi một tài liệu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "color"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "blue"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "green"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 3. Ghi một tài liệu khác</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001/_doc/2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "color"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "blue"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 3. Sử dụng terms query</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001/_search?pretty</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "terms"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "color"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "my-index-000001",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "id"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "2",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "path"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "color"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>type query</h3>
<blockquote>
<p>Đã bị loại bỏ sau phiên bản 7.0.0</p>
</blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-type-query.html" target="_blank" rel="noopener noreferrer"><strong><code>type query</code></strong></a> được sử dụng để truy vấn các tài liệu có loại cụ thể.</p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "_doc"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Tuy nhiên, từ phiên bản 7.0.0 trở đi, Elasticsearch đã loại bỏ hỗ trợ cho nhiều loại tài liệu trong một chỉ mục. Do đó, <code>type query</code> không còn được sử dụng nữa. Thay vào đó, bạn có thể sử dụng các cấu trúc dữ liệu khác nhau trong cùng một tài liệu hoặc sử dụng nhiều chỉ mục.</p>
<h3>wildcard query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html" target="_blank" rel="noopener noreferrer"><strong><code>wildcard query</code></strong></a> là truy vấn sử dụng ký tự đại diện, trả về các tài liệu khớp với mô hình ký tự đại diện.</p>
<p><code>?</code> được sử dụng để khớp với một ký tự bất kỳ, <code>*</code> được sử dụng để khớp với không hoặc nhiều ký tự.</p>
<p>Ví dụ: Truy vấn dưới đây trả về các tài liệu mà trường <code>user.id</code> chứa các thuật ngữ bắt đầu bằng <code>ki</code> và kết thúc bằng <code>y</code>. Các khớp này có thể bao gồm <code>kiy</code>, <code>kity</code> hoặc <code>kimchy</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "wildcard"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "user.id"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "ki*y",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "boost"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1.0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "rewrite"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "constant_score"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Nếu <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html#query-dsl-allow-expensive-queries" target="_blank" rel="noopener noreferrer"><code>search.allow_expensive_queries</code></a> được cấu hình, thì <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html" target="_blank" rel="noopener noreferrer"><strong><code>wildcard query</code></strong></a> sẽ bị vô hiệu hóa.</p>
</blockquote>
<h3>Ví dụ hoàn chỉnh về truy vấn từ khoá</h3>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> products</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> products</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "number_of_shards"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /products/_bulk</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id":</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"productID"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "XHDK-A-1293-#fJ3","desc":"iPhone"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id":</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"productID"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "KDKE-B-9947-#kL5","desc":"iPad"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id":</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"productID"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "JODL-X-1937-#pV7","desc":"MBP"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /products</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /products/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        //</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "iPhone"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"iphone"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /products/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "desc.keyword"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        //</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "iPhone"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        //</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"iphone"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /products/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "productID"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "XHDK-A-1293-#fJ3"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /products/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  //</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"explain"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "productID.keyword"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "XHDK-A-1293-#fJ3"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /products/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "explain"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "constant_score"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "filter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "productID.keyword"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "XHDK-A-1293-#fJ3"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ví dụ trên, chúng ta đã tạo một chỉ mục <code>products</code> với một số tài liệu. Mỗi tài liệu có hai trường là <code>productID</code> và <code>desc</code>.</p>
<p>Sau đó, chúng ta thực hiện một số truy vấn từ ngữ (<code>term query</code>) khác nhau. Truy vấn từ ngữ được sử dụng để tìm các tài liệu mà một trường cụ thể chứa một giá trị cụ thể.</p>
<p>Trong các truy vấn, chúng ta có thể thấy rằng Elasticsearch phân biệt chữ hoa và chữ thường. Ví dụ, truy vấn từ ngữ với giá trị "iphone" sẽ không trả về tài liệu mà trường <code>desc</code> có giá trị "iPhone".</p>
<p>Ngoài ra, chúng ta cũng thấy rằng chúng ta có thể sử dụng trường <code>keyword</code> để thực hiện truy vấn không phân biệt chữ hoa và chữ thường.</p>
<p>Cuối cùng, chúng ta cũng thấy rằng chúng ta có thể sử dụng <code>constant_score</code> để áp dụng điểm số cố định cho tất cả các tài liệu khớp.</p>
<h2>Truy vấn kết hợp</h2>
<p>Truy vấn kết hợp là việc kết hợp một số truy vấn đơn giản lại với nhau để đáp ứng các yêu cầu truy vấn phức tạp hơn. Ngoài ra, truy vấn kết hợp cũng có thể điều khiển hành vi của các truy vấn khác.</p>
<h3>bool query</h3>
<p>Truy vấn bool có thể kết hợp bất kỳ số lượng truy vấn đơn giản nào, sử dụng các tùy chọn must, should, must_not, filter để biểu thị logic giữa các truy vấn đơn giản. Mỗi tùy chọn có thể xuất hiện từ 0 đến nhiều lần, ý nghĩa của chúng như sau:</p>
<ul>
<li>must: tài liệu phải khớp với các điều kiện truy vấn trong tùy chọn must, tương đương với AND trong logic, và tham gia vào việc đánh giá mức độ liên quan của tài liệu.</li>
<li>should: tài liệu có thể khớp hoặc không khớp với các điều kiện truy vấn trong tùy chọn should, tương đương với OR trong logic, và tham gia vào việc đánh giá mức độ liên quan của tài liệu.</li>
<li>must_not: ngược lại với must, các tài liệu khớp với các điều kiện truy vấn trong tùy chọn must_not sẽ không được trả về; điều cần lưu ý là <strong>câu lệnh must_not không ảnh hưởng đến việc đánh giá điểm, nó chỉ loại bỏ các tài liệu không liên quan</strong>.</li>
<li>filter: giống như must, chỉ các tài liệu khớp với các điều kiện truy vấn trong tùy chọn filter mới được trả về, <strong>nhưng filter không đánh giá điểm, chỉ có chức năng lọc, ngược lại với must_not</strong>.</li>
</ul>
<p>Giả sử bạn muốn tìm kiếm các cuốn sách có tiêu đề chứa từ khóa java, giá không cao hơn 70, mô tả có thể chứa hoặc không chứa máy ảo, bạn có thể tạo truy vấn bool như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query": {</span></span>
<span class="line"><span>    "bool": {</span></span>
<span class="line"><span>      "filter": {</span></span>
<span class="line"><span>        "term": {</span></span>
<span class="line"><span>          "status": 1</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      "must_not": {</span></span>
<span class="line"><span>        "range": {</span></span>
<span class="line"><span>          "price": {</span></span>
<span class="line"><span>            "gte": 70</span></span>
<span class="line"><span>          }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      "must": {</span></span>
<span class="line"><span>        "match": {</span></span>
<span class="line"><span>          "title": "java"</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      "should": [</span></span>
<span class="line"><span>        {</span></span>
<span class="line"><span>          "match": {</span></span>
<span class="line"><span>            "description": "máy ảo"</span></span>
<span class="line"><span>          }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      ],</span></span>
<span class="line"><span>      "minimum_should_match": 1</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Để biết thêm thông tin chi tiết về truy vấn bool, hãy tham khảo <a href="https://www.knowledgedict.com/tutorial/elasticsearch-query-bool.html" target="_blank" rel="noopener noreferrer">bool query（truy vấn kết hợp）chi tiết</a>.</p>
<h3>Truy vấn boosting</h3>
<p>Truy vấn boosting được sử dụng trong các tình huống cần điều chỉnh điểm số của hai truy vấn. Truy vấn boosting sẽ đóng gói hai truy vấn lại với nhau và giảm điểm số của một trong hai truy vấn.</p>
<p>Truy vấn boosting bao gồm ba phần: positive, negative và negative_boost. Điểm số của truy vấn trong phần positive được giữ nguyên, truy vấn trong phần negative sẽ giảm điểm số của tài liệu, và negative_boost chỉ định giá trị giảm trong phần negative. Nếu chúng ta muốn giảm điểm số của các cuốn sách xuất bản trước năm 2015, chúng ta có thể tạo một truy vấn boosting, truy vấn như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"boosting": {</span></span>
<span class="line"><span>			"positive": {</span></span>
<span class="line"><span>				"match": {</span></span>
<span class="line"><span>					"title": "python"</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"negative": {</span></span>
<span class="line"><span>				"range": {</span></span>
<span class="line"><span>					"publish_time": {</span></span>
<span class="line"><span>						"lte": "2015-01-01"</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"negative_boost": 0.2</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong truy vấn boosting, chúng ta đã chỉ định yếu tố ức chế là 0.2, điểm số của các tài liệu có giá trị publish_time sau ngày 01-01-2015 không thay đổi, điểm số của các tài liệu có giá trị publish_time trước ngày 01-01-2015 sẽ là 0.2 lần điểm số gốc.</p>
<h3>Truy vấn constant_score</h3>
<p>Truy vấn constant_score đóng gói một truy vấn filter và trả về các tài liệu phù hợp với điều kiện truy vấn của bộ lọc, với điểm số liên quan của tất cả chúng đều bằng giá trị của tham số _boost_ (có thể hiểu là điểm số liên quan ban đầu dựa trên tf-idf hoặc bm25 được cố định là 1.0, vì vậy điểm số cuối cùng là <em>1.0 * boost</em>, tức là bằng giá trị của tham số <em>boost</em>). Truy vấn dưới đây sẽ trả về các tài liệu có trường title chứa từ khóa <em>elasticsearch</em>, với điểm số của tất cả các tài liệu đều là 1.8:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query": {</span></span>
<span class="line"><span>    "constant_score": {</span></span>
<span class="line"><span>      "filter": {</span></span>
<span class="line"><span>        "term": {</span></span>
<span class="line"><span>          "title": "elasticsearch"</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      "boost": 1.8</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Truy vấn dis_max</h3>
<p>Truy vấn dis_max có một số liên hệ nhưng cũng có sự khác biệt với truy vấn bool. Truy vấn dis_max hỗ trợ nhiều truy vấn song song, có thể trả về bất kỳ loại tài liệu nào phù hợp với bất kỳ điều kiện truy vấn con nào. Khác với cách truy vấn bool có thể kết hợp điểm số của tất cả các truy vấn phù hợp, truy vấn dis_max chỉ sử dụng điểm số của điều kiện truy vấn phù hợp nhất. Hãy xem ví dụ dưới đây:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"dis_max": {</span></span>
<span class="line"><span>			"tie_breaker": 0.7,</span></span>
<span class="line"><span>			"boost": 1.2,</span></span>
<span class="line"><span>			"queries": [{</span></span>
<span class="line"><span>					"term": {</span></span>
<span class="line"><span>						"age": 34</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				},</span></span>
<span class="line"><span>				{</span></span>
<span class="line"><span>					"term": {</span></span>
<span class="line"><span>						"age": 35</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			]</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Truy vấn function_score</h3>
<p>Truy vấn function_score có thể chỉnh sửa điểm số của các tài liệu được truy vấn, loại truy vấn này rất hữu ích trong một số trường hợp, chẳng hạn như khi chi phí tính toán điểm số của tài liệu bằng hàm điểm số là quá cao, người dùng có thể thay thế cách tính điểm số truyền thống bằng cách sử dụng bộ lọc kết hợp với hàm điểm số tùy chỉnh.</p>
<p>Khi sử dụng truy vấn function_score, người dùng cần định nghĩa một truy vấn và một hoặc nhiều hàm điểm số, hàm điểm số sẽ tính toán điểm số cho mỗi tài liệu được truy vấn.</p>
<p>Truy vấn dưới đây sẽ trả về tất cả các tài liệu trong chỉ mục books, với điểm số tối đa của tài liệu là 5, điểm số của mỗi tài liệu được tạo ngẫu nhiên, chế độ tính trọng số là chế độ nhân.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query": {</span></span>
<span class="line"><span>    "function_score": {</span></span>
<span class="line"><span>      "query": {</span></span>
<span class="line"><span>        "match_all": {}</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      "boost": "5",</span></span>
<span class="line"><span>      "random_score": {},</span></span>
<span class="line"><span>      "boost_mode": "multiply"</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Sử dụng script để tùy chỉnh công thức điểm số, ở đây chúng tôi lấy căn bậc hai của một phần mười giá trị price làm điểm số cho mỗi tài liệu, truy vấn như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query": {</span></span>
<span class="line"><span>    "function_score": {</span></span>
<span class="line"><span>      "query": {</span></span>
<span class="line"><span>        "match": {</span></span>
<span class="line"><span>          "title": "java"</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      "script_score": {</span></span>
<span class="line"><span>        "inline": "Math.sqrt(doc['price'].value/10)"</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Để biết thêm chi tiết về function_score, vui lòng xem <a href="https://www.knowledgedict.com/tutorial/elasticsearch-function_score.html" target="_blank" rel="noopener noreferrer">Elasticsearch function_score truy vấn giải thích mạnh nhất</a>.</p>
<h3>Truy vấn indices</h3>
<p>Truy vấn indices phù hợp với các tình huống cần truy vấn giữa nhiều chỉ mục, nó cho phép chỉ định danh sách tên chỉ mục và truy vấn nội bộ. Trong truy vấn indices, có hai phần là query và no_match_query. Phần query được sử dụng để tìm kiếm tài liệu trong danh sách chỉ mục được chỉ định, trong khi điều kiện truy vấn trong no_match_query được sử dụng để tìm kiếm tài liệu ngoài danh sách chỉ mục được chỉ định. Truy vấn sau đây tìm kiếm các tài liệu trong chỉ mục books và books2 có trường title chứa từ khóa "javascript", và các tài liệu trong các chỉ mục khác có trường title chứa "basketball". Truy vấn như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"indices": {</span></span>
<span class="line"><span>			"indices": ["books", "books2"],</span></span>
<span class="line"><span>			"query": {</span></span>
<span class="line"><span>				"match": {</span></span>
<span class="line"><span>					"title": "javascript"</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"no_match_query": {</span></span>
<span class="line"><span>				"term": {</span></span>
<span class="line"><span>					"title": "basketball"</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Truy vấn lồng</h2>
<p>Trong hệ thống phân tán như Elasticsearch, việc thực hiện truy vấn kết nối theo phong cách SQL toàn diện có chi phí cao và không khả thi. Thay vào đó, để thực hiện mở rộng theo quy mô chiều ngang, Elasticsearch cung cấp hai hình thức join sau:</p>
<ul>
<li>
<p>Truy vấn lồng (nested query)</p>
<p>Các tài liệu có thể chứa các trường kiểu lồng, các trường này được sử dụng để chỉ mục một số đối tượng mảng, mỗi đối tượng có thể được truy vấn như một tài liệu độc lập.</p>
</li>
<li>
<p>Truy vấn has_child (có truy vấn con) và truy vấn has_parent (có truy vấn cha)</p>
<p>Mối quan hệ cha-con có thể tồn tại giữa hai loại tài liệu trong một chỉ mục duy nhất. Truy vấn has_child sẽ trả về các tài liệu cha mà tài liệu con của chúng đáp ứng truy vấn cụ thể, trong khi has_parent sẽ trả về các tài liệu con mà tài liệu cha của chúng đáp ứng truy vấn cụ thể.</p>
</li>
</ul>
<h3>Truy vấn lồng</h3>
<p>Các tài liệu có thể chứa các trường kiểu lồng, các trường này được sử dụng để chỉ mục một số đối tượng mảng, mỗi đối tượng có thể được truy vấn như một tài liệu độc lập (sử dụng truy vấn lồng).</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUT /my_index</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"mappings": {</span></span>
<span class="line"><span>		"type1": {</span></span>
<span class="line"><span>			"properties": {</span></span>
<span class="line"><span>				"obj1": {</span></span>
<span class="line"><span>					"type": "nested"</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Truy vấn has_child</h3>
<p>Mối quan hệ cha-con giữa các tài liệu được khai báo trong lúc tạo chỉ mục, trong ví dụ này, chúng ta sẽ sử dụng nhân viên (employee) và chi nhánh (branch) làm ví dụ, chúng thuộc về các loại khác nhau, tương đương với hai bảng trong cơ sở dữ liệu. Nếu chúng ta muốn liên kết nhân viên với thành phố mà họ làm việc, chúng ta cần thông báo cho Elasticsearch về mối quan hệ cha-con giữa các tài liệu, trong đó employee là loại con, và branch là loại cha. Chúng ta khai báo mối quan hệ này trong lúc tạo chỉ mục, thực hiện lệnh sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUT /company</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"mappings": {</span></span>
<span class="line"><span>		"branch": {},</span></span>
<span class="line"><span>		"employee": {</span></span>
<span class="line"><span>			"parent": { "type": "branch" }</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Sử dụng bulk api để chỉ mục tài liệu dưới loại branch, lệnh như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>POST company/branch/_bulk</span></span>
<span class="line"><span>{ "index": { "_id": "london" }}</span></span>
<span class="line"><span>{ "name": "London Westminster","city": "London","country": "UK" }</span></span>
<span class="line"><span>{ "index": { "_id": "liverpool" }}</span></span>
<span class="line"><span>{ "name": "Liverpool Central","city": "Liverpool","country": "UK" }</span></span>
<span class="line"><span>{ "index": { "_id": "paris" }}</span></span>
<span class="line"><span>{ "name": "Champs Elysees","city": "Paris","country": "France" }</span></span></code></pre>
</div><p>Thêm dữ liệu nhân viên:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>POST company/employee/_bulk</span></span>
<span class="line"><span>{ "index": { "_id": 1,"parent":"london" }}</span></span>
<span class="line"><span>{ "name": "Alice Smith","dob": "1970-10-24","hobby": "hiking" }</span></span>
<span class="line"><span>{ "index": { "_id": 2,"parent":"london" }}</span></span>
<span class="line"><span>{ "name": "Mark Tomas","dob": "1982-05-16","hobby": "diving" }</span></span>
<span class="line"><span>{ "index": { "_id": 3,"parent":"liverpool" }}</span></span>
<span class="line"><span>{ "name": "Barry Smith","dob": "1979-04-01","hobby": "hiking" }</span></span>
<span class="line"><span>{ "index": { "_id": 4,"parent":"paris" }}</span></span>
<span class="line"><span>{ "name": "Adrien Grand","dob": "1987-05-11","hobby": "horses" }</span></span></code></pre>
</div><p>Để truy vấn tài liệu cha thông qua tài liệu con, chúng ta sử dụng truy vấn has_child. Ví dụ, để tìm kiếm các chi nhánh có nhân viên sinh sau năm 1980, nhân viên sinh sau năm 1980 bao gồm Mark Thomas và Adrien Grand, họ làm việc tại London và Paris tương ứng. Chúng ta thực hiện lệnh truy vấn sau để xác minh:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET company/branch/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"has_child": {</span></span>
<span class="line"><span>			"type": "employee",</span></span>
<span class="line"><span>			"query": {</span></span>
<span class="line"><span>				"range": { "dob": { "gte": "1980-01-01" } }</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Tìm kiếm những chi nhánh có nhân viên tên là "Alice Smith", vì chúng ta sử dụng truy vấn match, nó sẽ được phân tích thành "Alice" và "Smith", vì vậy chi nhánh mà Alice Smith và Barry Smith làm việc sẽ được khớp. Chúng ta thực hiện lệnh truy vấn sau để xác minh:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET company/branch/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"has_child": {</span></span>
<span class="line"><span>			"type": "employee",</span></span>
<span class="line"><span>			"score_mode": "max",</span></span>
<span class="line"><span>			"query": {</span></span>
<span class="line"><span>				"match": { "name": "Alice Smith" }</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Chúng ta có thể sử dụng min_children để chỉ định số lượng tối thiểu của tài liệu con. Ví dụ, để tìm kiếm những chi nhánh có ít nhất hai nhân viên, chúng ta thực hiện lệnh truy vấn sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET company/branch/_search?pretty</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"has_child": {</span></span>
<span class="line"><span>			"type": "employee",</span></span>
<span class="line"><span>			"min_children": 2,</span></span>
<span class="line"><span>			"query": {</span></span>
<span class="line"><span>				"match_all": {}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Truy vấn has_parent</h3>
<p>Để truy vấn tài liệu con thông qua tài liệu cha, chúng ta sử dụng truy vấn has_parent. Ví dụ, để tìm kiếm những nhân viên làm việc ở UK, chúng ta thực hiện lệnh truy vấn sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET company/employee/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"has_parent": {</span></span>
<span class="line"><span>			"parent_type": "branch",</span></span>
<span class="line"><span>			"query": {</span></span>
<span class="line"><span>				"match": { "country": "UK" }</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h2>Truy vấn vị trí</h2>
<p>Elasticsearch có thể tìm kiếm dữ liệu của loại điểm địa lý (geo_point) và hình dạng địa lý (geo_shape). Để thuận tiện cho việc học, chúng ta sẽ chuẩn bị một số tọa độ địa lý của các thành phố để làm dữ liệu thử nghiệm, mỗi tài liệu đều bao gồm hai trường là tên thành phố và tọa độ địa lý. Tọa độ này được lấy từ một vị trí ở trung tâm của mỗi thành phố. Đầu tiên, hãy lưu nội dung sau vào tệp geo.json:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{"index":{ "_index":"geo","_type":"city","_id":"1" }}</span></span>
<span class="line"><span>{"name":"Bắc Kinh","location":"39.9088145109,116.3973999023"}</span></span>
<span class="line"><span>{"index":{ "_index":"geo","_type":"city","_id": "2" }}</span></span>
<span class="line"><span>{"name":"Urumqi","location":"43.8266300000,87.6168800000"}</span></span>
<span class="line"><span>{"index":{ "_index":"geo","_type":"city","_id":"3" }}</span></span>
<span class="line"><span>{"name":"Tây An","location":"34.3412700000,108.9398400000"}</span></span>
<span class="line"><span>{"index":{ "_index":"geo","_type":"city","_id":"4" }}</span></span>
<span class="line"><span>{"name":"Zhengzhou","location":"34.7447157466,113.6587142944"}</span></span>
<span class="line"><span>{"index":{ "_index":"geo","_type":"city","_id":"5" }}</span></span>
<span class="line"><span>{"name":"Hàng Châu","location":"30.2294080260,120.1492309570"}</span></span>
<span class="line"><span>{"index":{ "_index":"geo","_type":"city","_id":"6" }}</span></span>
<span class="line"><span>{"name":"Jinan","location":"36.6518400000,117.1200900000"}</span></span></code></pre>
</div><p>Tạo một chỉ mục và thiết lập ánh xạ:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUT geo</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"mappings": {</span></span>
<span class="line"><span>		"city": {</span></span>
<span class="line"><span>			"properties": {</span></span>
<span class="line"><span>				"name": {</span></span>
<span class="line"><span>					"type": "keyword"</span></span>
<span class="line"><span>				},</span></span>
<span class="line"><span>				"location": {</span></span>
<span class="line"><span>					"type": "geo_point"</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sau đó thực hiện lệnh nhập hàng loạt:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>curl -XPOST "http://localhost:9200/_bulk?pretty" --data-binary @geo.json</span></span></code></pre>
</div><h3>Truy vấn geo_distance</h3>
<p>Truy vấn geo_distance có thể tìm kiếm các tài liệu điểm địa lý nằm trong phạm vi xác định từ một điểm trung tâm. Ví dụ, để tìm kiếm các thành phố nằm trong bán kính 200km từ Thanh Đô, kết quả tìm kiếm sẽ trả về Bắc Kinh, lệnh như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET geo/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"bool": {</span></span>
<span class="line"><span>			"must": {</span></span>
<span class="line"><span>				"match_all": {}</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"filter": {</span></span>
<span class="line"><span>				"geo_distance": {</span></span>
<span class="line"><span>					"distance": "200km",</span></span>
<span class="line"><span>					"location": {</span></span>
<span class="line"><span>						"lat": 39.0851000000,</span></span>
<span class="line"><span>						"lon": 117.1993700000</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sắp xếp các thành phố theo khoảng cách đến Bắc Kinh:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET geo/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query": {</span></span>
<span class="line"><span>    "match_all": {}</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  "sort": [{</span></span>
<span class="line"><span>    "_geo_distance": {</span></span>
<span class="line"><span>      "location": "39.9088145109,116.3973999023",</span></span>
<span class="line"><span>      "unit": "km",</span></span>
<span class="line"><span>      "order": "asc",</span></span>
<span class="line"><span>      "distance_type": "plane"</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }]</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Trong đó, trường location tương ứng với trường kinh độ và vĩ độ; unit là <code>km</code>, nghĩa là khoảng cách sẽ được ghi vào khóa sort của mỗi kết quả trả về theo đơn vị <code>km</code>; distance_type là <code>plane</code>, nghĩa là sử dụng phương pháp tính toán <code>plane</code> nhanh nhưng độ chính xác hơi kém.</p>
<h3>Truy vấn geo_bounding_box</h3>
<p>Truy vấn geo_bounding_box được sử dụng để tìm kiếm các tọa độ địa lý nằm trong một hình chữ nhật xác định. Truy vấn xác định một hình chữ nhật bằng hai điểm, sau đó tìm kiếm các tài liệu phù hợp trong khu vực hình chữ nhật.</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET geo/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"bool": {</span></span>
<span class="line"><span>			"must": {</span></span>
<span class="line"><span>				"match_all": {}</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"filter": {</span></span>
<span class="line"><span>				"geo_bounding_box": {</span></span>
<span class="line"><span>					"location": {</span></span>
<span class="line"><span>						"top_left": {</span></span>
<span class="line"><span>							"lat": 38.4864400000,</span></span>
<span class="line"><span>							"lon": 106.2324800000</span></span>
<span class="line"><span>						},</span></span>
<span class="line"><span>						"bottom_right": {</span></span>
<span class="line"><span>							"lat": 28.6820200000,</span></span>
<span class="line"><span>							"lon": 115.8579400000</span></span>
<span class="line"><span>						}</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Truy vấn geo_polygon</h3>
<p>Truy vấn geo_polygon được sử dụng để tìm kiếm các điểm địa lý nằm trong một đa giác xác định. Ví dụ, Hohhot, Chongqing và Thượng Hải tạo thành một tam giác, truy vấn các thành phố nằm trong khu vực tam giác này, lệnh như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET geo/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"bool": {</span></span>
<span class="line"><span>			"must": {</span></span>
<span class="line"><span>				"match_all": {}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		},</span></span>
<span class="line"><span>		"filter": {</span></span>
<span class="line"><span>			"geo_polygon": {</span></span>
<span class="line"><span>				"location": {</span></span>
<span class="line"><span>					"points": [{</span></span>
<span class="line"><span>						"lat": 40.8414900000,</span></span>
<span class="line"><span>						"lon": 111.7519900000</span></span>
<span class="line"><span>					}, {</span></span>
<span class="line"><span>						"lat": 29.5647100000,</span></span>
<span class="line"><span>						"lon": 106.5507300000</span></span>
<span class="line"><span>					}, {</span></span>
<span class="line"><span>						"lat": 31.2303700000,</span></span>
<span class="line"><span>						"lon": 121.4737000000</span></span>
<span class="line"><span>					}]</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Truy vấn geo_shape</h3>
<p>Truy vấn geo_shape được sử dụng để tìm kiếm dữ liệu địa lý kiểu geo_shape, có ba mối quan hệ giữa các hình dạng địa lý là giao nhau, chứa và không giao nhau. Tạo một chỉ mục mới để thử nghiệm, trong đó loại trường location được đặt là geo_shape.</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUT geoshape</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"mappings": {</span></span>
<span class="line"><span>		"city": {</span></span>
<span class="line"><span>			"properties": {</span></span>
<span class="line"><span>				"name": {</span></span>
<span class="line"><span>					"type": "keyword"</span></span>
<span class="line"><span>				},</span></span>
<span class="line"><span>				"location": {</span></span>
<span class="line"><span>					"type": "geo_shape"</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Về thứ tự kinh độ và vĩ độ, chúng ta cần lưu ý rằng, đối với trường kiểu geo_point, vĩ độ đứng trước kinh độ, nhưng đối với điểm trong kiểu geo_shape, kinh độ đứng trước vĩ độ.</p>
<p>Chúng ta có thể viết dòng kết nối Tây An và Zhengzhou vào chỉ mục:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>POST geoshape/city/1</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"name": "Tây An-Zhengzhou",</span></span>
<span class="line"><span>	"location": {</span></span>
<span class="line"><span>		"type": "linestring",</span></span>
<span class="line"><span>		"coordinates": [</span></span>
<span class="line"><span>			[108.9398400000, 34.3412700000],</span></span>
<span class="line"><span>			[113.6587142944, 34.7447157466]</span></span>
<span class="line"><span>		]</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Truy vấn hình dạng địa lý nằm trong hình chữ nhật được tạo bởi Yinchuan và Nanchang làm các điểm trên đường chéo, vì đường thẳng từ Tây An đến Zhengzhou nằm trong khu vực hình chữ nhật này, vì vậy nó có thể được truy vấn. Lệnh như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET geoshape/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"bool": {</span></span>
<span class="line"><span>			"must": {</span></span>
<span class="line"><span>				"match_all": {}</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"filter": {</span></span>
<span class="line"><span>				"geo_shape": {</span></span>
<span class="line"><span>					"location": {</span></span>
<span class="line"><span>						"shape": {</span></span>
<span class="line"><span>							"type": "envelope",</span></span>
<span class="line"><span>							"coordinates": [</span></span>
<span class="line"><span>								[106.23248, 38.48644],</span></span>
<span class="line"><span>								[115.85794, 28.68202]</span></span>
<span class="line"><span>							]</span></span>
<span class="line"><span>						},</span></span>
<span class="line"><span>						"relation": "within"</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Truy vấn more_like_this</h3>
<p>Truy vấn more_like_this có thể tìm kiếm các tài liệu tương tự với văn bản cung cấp, thường được sử dụng trong các tình huống như đề xuất văn bản tương tự. Lệnh truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"more_like_this": {</span></span>
<span class="line"><span>			"fields": ["title", "description"],</span></span>
<span class="line"><span>			"like": "java virtual machine",</span></span>
<span class="line"><span>			"min_term_freq": 1,</span></span>
<span class="line"><span>			"max_query_terms": 12</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Các tham số tùy chọn và mô tả giá trị của chúng như sau:</p>
<ul>
<li>fields: các trường cần phù hợp, mặc định là trường _all.</li>
<li>like: văn bản cần phù hợp.</li>
<li>min_term_freq: tần suất tối thiểu của các thuật ngữ trong tài liệu, mặc định là 2, các tài liệu có tần suất thấp hơn sẽ bị bỏ qua.</li>
<li>max_query_terms: số lượng thuật ngữ tối đa có thể có trong truy vấn, mặc định là 25.</li>
<li>min_doc_freq: tần suất tài liệu tối thiểu, mặc định là 5.</li>
<li>max_doc_freq: tần suất tài liệu tối đa.</li>
<li>min_word_length: độ dài tối thiểu của từ.</li>
<li>max_word_length: độ dài tối đa của từ.</li>
<li>stop_words: danh sách các từ dừng.</li>
<li>analyzer: bộ phân tích.</li>
<li>minimum_should_match: số lượng thuật ngữ tối thiểu mà tài liệu cần phù hợp, mặc định là 30% số thuật ngữ sau khi phân tích truy vấn.</li>
<li>boost_terms: trọng số của các thuật ngữ.</li>
<li>include: liệu có nên trả về tài liệu đầu vào như một kết quả hay không.</li>
<li>boost: trọng số của toàn bộ truy vấn, mặc định là 1.0.</li>
</ul>
<h3>Truy vấn script</h3>
<p>Elasticsearch hỗ trợ việc sử dụng script để truy vấn. Ví dụ, để tìm kiếm các tài liệu có giá lớn hơn 180, lệnh như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query": {</span></span>
<span class="line"><span>    "script": {</span></span>
<span class="line"><span>      "script": {</span></span>
<span class="line"><span>        "inline": "doc['price'].value &gt; 180",</span></span>
<span class="line"><span>        "lang": "painless"</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Truy vấn percolate</h3>
<p>Trong hầu hết các trường hợp, chúng ta thường viết tài liệu vào Elasticsearch trước, sau đó sử dụng câu lệnh truy vấn để tìm kiếm tài liệu. Truy vấn percolate làm điều ngược lại, nó đăng ký các điều kiện truy vấn trước, sau đó dựa vào tài liệu để truy vấn query. Ví dụ, trong chỉ mục my-index có một loại laptop, tài liệu có hai trường là price và name, trong mapping, chúng ta định nghĩa một trường percolator là query, lệnh như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUT my-index</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"mappings": {</span></span>
<span class="line"><span>		"laptop": {</span></span>
<span class="line"><span>			"properties": {</span></span>
<span class="line"><span>				"price": { "type": "long" },</span></span>
<span class="line"><span>				"name": { "type": "text" }</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"queries": {</span></span>
<span class="line"><span>				"properties": {</span></span>
<span class="line"><span>					"query": { "type": "percolator" }</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đăng ký một bool query, trong đó bool query bao gồm một range query, yêu cầu trường price có giá trị nhỏ hơn hoặc bằng 10000, và trường name chứa từ khóa macbook:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUT /my-index/queries/1?refresh</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"bool": {</span></span>
<span class="line"><span>			"must": [{</span></span>
<span class="line"><span>				"range": { "price": { "lte": 10000 } }</span></span>
<span class="line"><span>			}, {</span></span>
<span class="line"><span>				"match": { "name": "macbook" }</span></span>
<span class="line"><span>			}]</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Truy vấn query dựa vào tài liệu:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /my-index/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"percolate": {</span></span>
<span class="line"><span>			"field": "query",</span></span>
<span class="line"><span>			"document_type": "laptop",</span></span>
<span class="line"><span>			"document": {</span></span>
<span class="line"><span>				"price": 9999,</span></span>
<span class="line"><span>				"name": "macbook pro on sale"</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Tài liệu phù hợp với điều kiện trong query, kết quả trả về có thể tìm thấy bool query đã đăng ký ở trên. Truy vấn percolate có tính năng này phù hợp với các tình huống như phân loại dữ liệu, định tuyến dữ liệu, giám sát sự kiện và cảnh báo.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Quick Start</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/quick-start.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/quick-start.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Quick Start</source>
      <description>Elasticsearch: Quick Start Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu phân tán, theo phong cách RESTful, có khả năng giải quyết nhiều tình huống khác nhau đang l...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><strong><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>&nbsp;là một công cụ tìm kiếm và phân tích dữ liệu phân tán, theo phong cách RESTful</strong>, có khả năng giải quyết nhiều tình huống khác nhau đang liên tục xuất hiện. Là trung tâm của Elastic Stack, nó lưu trữ dữ liệu của bạn một cách tập trung, giúp bạn khám phá những điều dự kiến và không dự kiến.</p>
<p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>&nbsp;được phát triển dựa trên thư viện tìm kiếm&nbsp;<a href="https://github.com/apache/lucene-solr" target="_blank" rel="noopener noreferrer">Lucene</a>. Elasticsearch ẩn đi sự phức tạp của Lucene và cung cấp interface API REST / Java dễ sử dụng (cũng như các interface API bằng ngôn ngữ khác).</p>
<p><em>Dưới đây sẽ gọi tắt là ES</em>.</p>
</blockquote>
<h2>Giới thiệu Elasticsearch</h2>
<p><strong><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>&nbsp;là một công cụ tìm kiếm và phân tích dữ liệu phân tán, theo phong cách RESTful</strong>, có khả năng giải quyết nhiều tình huống khác nhau đang liên tục xuất hiện. Là trung tâm của Elastic Stack, nó lưu trữ dữ liệu của bạn một cách tập trung, giúp bạn khám phá những điều dự kiến và không dự kiến.</p>
<p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>&nbsp;<strong>được phát triển dựa trên thư viện tìm kiếm&nbsp;<a href="https://github.com/apache/lucene-solr" target="_blank" rel="noopener noreferrer">Lucene</a></strong>. Elasticsearch ẩn đi sự phức tạp của Lucene và cung cấp interface API REST / Java dễ sử dụng (cũng như các interface API bằng ngôn ngữ khác).</p>
<p>Elasticsearch có thể coi là một kho lưu trữ tài liệu, nó&nbsp;<strong>chuẩn hóa cấu trúc dữ liệu phức tạp thành JSON để lưu trữ</strong>.</p>
<p><strong>Elasticsearch là một công cụ tìm kiếm toàn văn gần như thời gian thực</strong>, điều này có nghĩa là:</p>
<ul>
<li>Từ khi ghi dữ liệu cho đến khi dữ liệu có thể được tìm kiếm, có một độ trễ nhỏ (khoảng 1 giây)</li>
<li>Thực hiện tìm kiếm và phân tích dựa trên ES có thể đạt đến mức giây.</li>
</ul>
<h3>Khái niệm cốt lõi</h3>
<p><code>index -&gt; type -&gt; mapping -&gt; document -&gt; field</code></p>
<h4>Cluster</h4>
<p>Một cluster bao gồm nhiều node, mỗi node thuộc về cluster nào được quyết định thông qua một cấu hình. Đối với các ứng dụng vừa và nhỏ, ban đầu một cluster chỉ có một node là bình thường.</p>
<h4>Node</h4>
<p>Node là một node trong cluster, mỗi node cũng có một tên, mặc định là được phân bổ ngẫu nhiên. Mặc định, node sẽ tham gia vào một cluster có tên là&nbsp;<code>elasticsearch</code>. Nếu bạn khởi động một loạt node trực tiếp, chúng sẽ tự động hình thành một cluster elasticsearch, tất nhiên một node cũng có thể hình thành một cluster elasticsearch.</p>
<h4>Index</h4>
<p><strong>Có thể coi là tập hợp tối ưu của các tài liệu (document).</strong></p>
<p>ES sẽ xây dựng chỉ mục cho tất cả các trường, sau khi xử lý, nó sẽ được ghi vào một chỉ mục đảo ngược (Inverted Index). Khi tìm kiếm dữ liệu, chỉ cần tìm kiếm chỉ mục này.</p>
<p>Vì vậy, đơn vị quản lý dữ liệu hàng đầu của ES được gọi là Index (chỉ mục). Nó tương đương với một cơ sở dữ liệu đơn lẻ. Mỗi Index (hay cơ sở dữ liệu) phải có tên viết thường.</p>
<h4>Type</h4>
<p>Mỗi chỉ mục có thể chứa một hoặc nhiều loại (type).&nbsp;<code>Type</code>&nbsp;là một phân loại logic của index.</p>
<p>Các Type khác nhau nên có cấu trúc (schema) tương tự, ví dụ, trường&nbsp;<code>id</code>&nbsp;không thể là chuỗi trong một nhóm này, trong khi là giá trị số trong một nhóm khác. Đây là một&nbsp;<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/mapping.html" target="_blank" rel="noopener noreferrer">khác biệt</a>&nbsp;so với bảng của cơ sở dữ liệu quan hệ. Dữ liệu có tính chất hoàn toàn khác nhau (như&nbsp;<code>products</code>và&nbsp;<code>logs</code>) nên được lưu trữ dưới dạng hai Index, chứ không phải là hai Type trong một Index (mặc dù có thể làm được).</p>
<blockquote>
<p>Chú ý: Theo&nbsp;<a href="https://www.elastic.co/blog/index-type-parent-child-join-now-future-in-elasticsearch" target="_blank" rel="noopener noreferrer">kế hoạch</a>, phiên bản Elastic 6.x chỉ cho phép mỗi Index chứa một Type, phiên bản 7.x sẽ hoàn toàn loại bỏ Type.</p>
</blockquote>
<h4>Document</h4>
<p>Trong mỗi Index, mỗi bản ghi được gọi là Document. Nhiều Document tạo nên một Index.</p>
<p>Mỗi&nbsp;<strong><code>tài liệu (document)</code></strong>&nbsp;là một tập hợp các trường (field).</p>
<p>Document sử dụng định dạng JSON, dưới đây là một ví dụ.</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">	"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Hung Nguyen"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">	"title"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Engineer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">	"desc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Database management"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Các Document trong cùng một Index không yêu cầu có cấu trúc (scheme) giống nhau, nhưng tốt nhất nên giữ giống nhau, điều này có lợi cho việc cải thiện hiệu suất tìm kiếm.</p>
<h4>Field</h4>
<p><strong><code>Trường (field)</code></strong>&nbsp;là cặp khóa-giá trị chứa dữ liệu.</p>
<p>Theo mặc định, Elasticsearch xây dựng chỉ mục cho tất cả dữ liệu trong mỗi trường, và mỗi trường chỉ mục có cấu trúc dữ liệu tối ưu riêng.</p>
<h4>Shard</h4>
<p>Khi một máy duy nhất không đủ để lưu trữ lượng dữ liệu lớn, Elasticsearch có thể chia dữ liệu trong một chỉ mục thành nhiều&nbsp;<strong><code>shard</code></strong>.&nbsp;<strong><code>Shard</code></strong>&nbsp;được lưu trữ trên nhiều máy chủ. Với shard, bạn có thể mở rộng theo chiều ngang, lưu trữ nhiều dữ liệu hơn, cho phép các hoạt động tìm kiếm và phân tích được phân phối trên nhiều máy chủ, cải thiện throughput và hiệu suất. Mỗi shard đều là một chỉ mục lucene.</p>
<h4>Replica</h4>
<p>Bất kỳ máy chủ nào cũng có thể gặp sự cố hoặc ngừng hoạt động bất cứ lúc nào, lúc này shard có thể bị mất, do đó, bạn có thể tạo nhiều&nbsp;<strong><code>bản sao (replica)</code></strong>&nbsp;cho mỗi shard. Bản sao có thể cung cấp dịch vụ dự phòng khi shard gặp sự cố, đảm bảo dữ liệu không bị mất, nhiều bản sao còn có thể cải thiện throughput và hiệu suất của hoạt động tìm kiếm. Shard chính (được thiết lập một lần khi tạo chỉ mục, không thể sửa đổi, mặc định là 5), shard bản sao (số lượng có thể được sửa đổi bất cứ lúc nào, mặc định là 1), mặc định mỗi chỉ mục có 10 shard, 5 shard chính, 5 shard bản sao, cấu hình cao có sẵn tối thiểu, là 2 máy chủ.</p>
<h4>ES - Khái niệm cốt lõi vs. DB - Khái niệm cốt lõi</h4>
<p>| ES       | DB               |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223094001.png" type="image/png"/>
    </item>
    <item>
      <title>Elasticsearch REST API</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/rest-api.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/rest-api.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch REST API</source>
      <description>Elasticsearch Rest API Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu phân tán, theo phong cách RESTful, có khả năng giải quyết nhiều tình huống sử dụng mới xuất hiệ...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><strong><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a> là một công cụ tìm kiếm và phân tích dữ liệu phân tán, theo phong cách RESTful</strong>, có khả năng giải quyết nhiều tình huống sử dụng mới xuất hiện. Là trung tâm của Elastic Stack, nó lưu trữ dữ liệu tập trung của bạn, giúp bạn phát hiện những sự kiện dự kiến và không dự kiến.</p>
<p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a> được phát triển dựa trên thư viện tìm kiếm <a href="https://github.com/apache/lucene-solr" target="_blank" rel="noopener noreferrer">Lucene</a>. Elasticsearch ẩn đi sự phức tạp của Lucene, cung cấp giao diện API REST / Java dễ sử dụng (ngoài ra còn có các giao diện API bằng ngôn ngữ khác).</p>
<p><em>Dưới đây gọi tắt là ES</em>.</p>
<p>Tài liệu chi tiết nhất về REST API nên tham khảo: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/rest-apis.html" target="_blank" rel="noopener noreferrer">ES Official REST API</a></p>
</blockquote>
<h2>Cú pháp ElasticSearch Rest API</h2>
<p>Các phần thành phần của yêu cầu gửi đến Elasticsearch giống như các yêu cầu HTTP thông thường khác:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">curl</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -X</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66">VERB</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#98C379;--shiki-dark:#98C379"> '&lt;PROTOCOL&gt;://&lt;HOST&gt;:&lt;PORT&gt;/&lt;PATH&gt;?&lt;QUERY_STRING&gt;'</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -d</span><span style="color:#98C379;--shiki-dark:#98C379"> '&lt;BODY&gt;'</span></span></code></pre>
</div><ul>
<li><code>VERB</code>：Phương thức HTTP, hỗ trợ: <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>HEAD</code>, <code>DELETE</code></li>
<li><code>PROTOCOL</code>：giao thức http hoặc https (chỉ có thể sử dụng khi có proxy https phía trước Elasticsearch)</li>
<li><code>HOST</code>：tên máy chủ của bất kỳ nút nào trong cụm Elasticsearch, nếu là nút trên máy cục bộ, thì gọi là localhost</li>
<li><code>PORT</code>：cổng dịch vụ HTTP của Elasticsearch, mặc định là 9200</li>
<li><code>PATH</code>：đường dẫn API (ví dụ: <code>_count</code> sẽ trả về số lượng tài liệu trong cụm),</li>
<li><code>PATH</code>：có thể chứa nhiều thành phần, ví dụ <code>_cluster/stats</code> hoặc <code>_nodes/stats/jvm</code></li>
<li><code>QUERY_STRING</code>：một số tham số truy vấn tùy chọn, ví dụ tham số ?pretty sẽ làm cho yêu cầu trả về dữ liệu JSON dễ đọc hơn</li>
<li><code>BODY</code>：một cơ thể yêu cầu ở định dạng JSON (nếu yêu cầu cần)</li>
</ul>
<p>ElasticSearch Rest API được chia thành hai loại:</p>
<ul>
<li><strong>URI Search</strong>：sử dụng tham số truy vấn trong URL</li>
<li><strong>Request Body Search</strong>：dựa trên DSL định dạng JSON, hoàn chỉnh hơn</li>
</ul>
<p>Ví dụ về URI Search:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220530072511.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Ví dụ về Request Body Search:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220530072654.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2>Index API</h2>
<blockquote>
<p>Tài liệu tham khảo: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-indices.html" target="_blank" rel="noopener noreferrer">Elasticsearch Official cat Index API</a></p>
</blockquote>
<h3>Tạo chỉ mục</h3>
<p>Để tạo mới Index, bạn có thể gửi trực tiếp yêu cầu <code>PUT</code> đến máy chủ ES.</p>
<p>Cú pháp:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /my_index</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> any</span><span style="color:#98C379;--shiki-dark:#98C379"> settings</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "type_one"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> any</span><span style="color:#98C379;--shiki-dark:#98C379"> mappings</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "type_two"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> any</span><span style="color:#98C379;--shiki-dark:#98C379"> mappings</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">        ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /user</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "number_of_shards"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 3,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "number_of_replicas"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Máy chủ trả về một đối tượng JSON, trong đó trường <code>acknowledged</code> biểu thị hoạt động thành công.</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#98C379;--shiki-dark:#98C379">"acknowledged"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">"shards_acknowledged"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">"index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span><span style="color:#98C379;--shiki-dark:#98C379">"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Nếu bạn muốn vô hiệu hóa việc tạo tự động chỉ mục, bạn có thể thêm cấu hình sau vào <code>config/elasticsearch.yml</code> trong mỗi nút:</p>
<div class="language-js" data-ext="js" data-title="js"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">action</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E06C75;--shiki-dark:#E06C75">auto_create_index</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span></code></pre>
</div><h3>Xóa chỉ mục</h3>
<p>Tiếp theo, chúng ta có thể gửi yêu cầu <code>DELETE</code> để xóa chỉ mục này.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> /user</span></span></code></pre>
</div><p>Xóa nhiều chỉ mục</p>
<div class="language-js" data-ext="js" data-title="js"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">DELETE</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> /</span><span style="color:#E06C75;--shiki-dark:#E06C75">index_one</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75">index_two</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">DELETE</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> /</span><span style="color:#E06C75;--shiki-dark:#E06C75">index_</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">*</span></span></code></pre>
</div><h3>Xem chỉ mục</h3>
<p>Bạn có thể sử dụng yêu cầu GET để xem thông tin về chỉ mục</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem thông tin liên quan đến chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem tổng số tài liệu trong chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_count</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem 10 tài liệu đầu tiên để hiểu định dạng tài liệu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># _cat indices API</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem các chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/indices/kibana</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span><span style="color:#98C379;--shiki-dark:#98C379">?v</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">s</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">index</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem chỉ mục có trạng thái là xanh</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/indices?v</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">health</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">green</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Sắp xếp theo số lượng tài liệu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/indices?v</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">s</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">docs.count:desc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem các trường cụ thể</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/indices/kibana</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span><span style="color:#98C379;--shiki-dark:#98C379">?pri</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">v</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">health,index,pri,rep,docs.count,mt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem bộ nhớ mà chỉ mục sử dụng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/indices?v</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">i,tm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">s</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">tm:desc</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Bí danh chỉ mục</h3>
<p>Bí danh chỉ mục trong ES chính là tên khác mà bạn đặt cho một hoặc nhiều chỉ mục. Một ứng dụng điển hình là việc chuyển mượt mà giữa các chỉ mục.</p>
<p>Đầu tiên, tạo chỉ mục my_index, sau đó đặt bí danh my_alias cho nó, ví dụ như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /my_index</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /my_index/_alias/my_alias</span></span></code></pre>
</div><p>Bạn cũng có thể thực hiện như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /_aliases</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "actions"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"add"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "index":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_index",</span><span style="color:#98C379;--shiki-dark:#98C379"> "alias":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_alias"</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Bạn cũng có thể trong một yêu cầu thêm và xóa bí danh:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /_aliases</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "actions"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"remove"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "index":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_index",</span><span style="color:#98C379;--shiki-dark:#98C379"> "alias":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_alias"</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"add"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "index":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_index_v2",</span><span style="color:#98C379;--shiki-dark:#98C379"> "alias":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_alias"</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><blockquote>
<p>Điều cần lưu ý là nếu bí danh và chỉ mục là một-đối-một, bạn có thể sử dụng bí danh để lập chỉ mục hoặc truy vấn tài liệu. Tuy nhiên, nếu bí danh và chỉ mục là một-đối-nhiều, việc sử dụng bí danh sẽ gây ra lỗi, vì ES không biết nên viết tài liệu vào chỉ mục nào hoặc đọc tài liệu từ chỉ mục nào.</p>
</blockquote>
<p>Một ứng dụng điển hình của bí danh chỉ mục ES là việc chuyển mượt mà giữa các chỉ mục. Để biết thêm chi tiết, bạn có thể xem <a href="https://www.knowledgedict.com/tutorial/elasticsearch-index-smooth-shift.html" target="_blank" rel="noopener noreferrer">Phương pháp chuyển mượt mà giữa các chỉ mục Elasticsearch (ES) mà không cần tắt máy (không cần khởi động lại)</a>.</p>
<h3>Mở/Đóng chỉ mục</h3>
<p>Bằng cách thêm <code>_close</code> hoặc <code>_open</code> vào <code>POST</code>, bạn có thể mở hoặc đóng chỉ mục.</p>
<p>Mở chỉ mục</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Mở chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_open</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đóng chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_close</span></span></code></pre>
</div><h2>Tài liệu</h2>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">############Create Document############</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#create document. _id is automatically generated</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_doc</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Mike",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "post_date"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2019-04-15T14:12:12",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "message"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "trying out Kibana"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#create document. Specify Id. If id already exists, an error is returned</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_doc/1?op_type=create</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Jack",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "post_date"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2019-05-15T14:12:12",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "message"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "trying out Elasticsearch"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#create document. Specify ID. If it already exists, an error is returned</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_create/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">     "user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Jack",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "post_date"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2019-05-15T14:12:12",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "message"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "trying out Elasticsearch"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">### Get Document by ID</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Get the document by ID</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_doc/1</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">###  Index &amp; Update</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Update specified ID  (delete first, then write)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_doc/1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Mike"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#GET users/_doc/1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Add fields to the original document</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_update/1/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "doc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "post_date"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2019-05-15T14:12:12",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "message"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "trying out Elasticsearch"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">### Delete by Id</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Delete document</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_doc/1</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">### Bulk Operations</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Execute twice, check the result each time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Execute the first time</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> _bulk</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"field1"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value1"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"delete"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"create"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test2",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "3"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"field1"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value3"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"update"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test"}</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"doc"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"field2"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value2"}</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Execute the second time</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> _bulk</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"field1"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value1"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"delete"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"create"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test2",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "3"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"field1"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value3"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"update"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test"}</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"doc"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"field2"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value2"}</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">### mget Operations</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_mget</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "docs"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Specify index in URI</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /test/_mget</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "docs"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_mget</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "docs"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> false</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"field3"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"field4"]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "3",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "include"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "exclude"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"user.location"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">### msearch Operations</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_msearch</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"match_all"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {}},"size":1}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "kibana_sample_data_flights"}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"match_all"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {}},"size":2}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">### Clear Test Data</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Clear data</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> users</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> test</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> test2</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Tạo tài liệu</h3>
<h4>Xác định ID</h4>
<p>Định dạng cú pháp:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /_index/_type/_create/_id</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /user/_doc/_create/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "user"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Trương Tam",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "title"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Kỹ sư",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quản lý cơ sở dữ liệu"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Xác định Id, nếu id đã tồn tại, sẽ báo lỗi</p>
</blockquote>
<h4>Tự động tạo ID</h4>
<p>Khi thêm bản ghi mới, bạn cũng có thể không xác định Id, lúc này bạn cần thay đổi yêu cầu thành POST.</p>
<p>Định dạng cú pháp:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /_index/_type</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /user/_doc</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "user"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Trương Tam",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "title"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Kỹ sư",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quản trị viên siêu cấp"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>Xóa tài liệu</h3>
<p>Định dạng cú pháp:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> /_index/_doc/_id</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> /user/_doc/1</span></span></code></pre>
</div><h3>Cập nhật tài liệu</h3>
<h4>Xóa trước, sau đó viết vào</h4>
<p>Định dạng cú pháp:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /_index/_type/_id</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /user/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "user"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Lý Tứ",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "title"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Kỹ sư",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quản trị viên siêu cấp"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Thêm trường vào tài liệu gốc</h4>
<p>Định dạng cú pháp:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /_index/_update/_id</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /user/_update/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "doc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "age"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "30"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>Truy vấn tài liệu</h3>
<h4>Truy vấn theo ID cụ thể</h4>
<p>Định dạng cú pháp:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /_index/_type/_id</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /user/_doc/1</span></span></code></pre>
</div><p>Kết quả:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"_doc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_version"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_seq_no"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">536248</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_primary_term"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "found"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_source"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Trương Tam"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "title"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kỹ sư"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "desc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Quản lý cơ sở dữ liệu"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Trong dữ liệu trả về, trường <code>found</code> biểu thị truy vấn thành công, trường <code>_source</code> trả về bản gốc của bản ghi.</p>
<p>Nếu id không chính xác, dữ liệu sẽ không được tìm thấy, và trường <code>found</code> sẽ là <code>false</code></p>
<h4>Truy vấn tất cả các bản ghi</h4>
<p>Sử dụng phương thức <code>GET</code>, yêu cầu trực tiếp đến <code>/index/type/_search</code>, tất cả các bản ghi sẽ được trả về.</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> curl</span><span style="color:#98C379;--shiki-dark:#98C379"> 'localhost:9200/user/admin/_search?pretty'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "took"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "timed_out"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> false</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "_shards"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "total"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 3,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "successful"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 3,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "skipped"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "failed"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "hits"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "total"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 2,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "max_score"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 1.0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "hits"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "user",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_type"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "admin",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "WWuoDG8BHwECs7SiYn93",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_score"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 1.0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Lý Tứ",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "title"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Kỹ sư",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "desc"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quản lý hệ thống"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "user",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_type"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "admin",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_score"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 1.0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Trương Tam",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "title"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Kỹ sư",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "desc"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quản trị viên siêu cấp"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong kết quả trả về ở trên, trường <code>took</code> biểu thị thời gian tiêu tốn cho thao tác này (đơn vị là mili giây), trường <code>timed_out</code> biểu thị liệu có quá thời gian hay không, trường <code>hits</code> biểu thị các bản ghi đã truy vấn được, trong đó các trường con có ý nghĩa như sau.</p>
<ul>
<li><code>total</code>: số lượng bản ghi trả về, trong trường hợp này là 2.</li>
<li><code>max_score</code>: mức độ khớp cao nhất, trong trường hợp này là <code>1.0</code>.</li>
<li><code>hits</code>: mảng các bản ghi trả về.</li>
</ul>
<p>Trong các bản ghi trả về, mỗi bản ghi đều có một trường <code>_score</code>, biểu thị mức độ khớp, mặc định là được sắp xếp theo trường này theo thứ tự giảm dần.</p>
<h3>Tìm kiếm toàn văn</h3>
<p>ES sử dụng <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl.html" target="_blank" rel="noopener noreferrer">cú pháp truy vấn</a> độc đáo của chính nó, yêu cầu các yêu cầu GET đi kèm với dữ liệu.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> curl</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -H</span><span style="color:#98C379;--shiki-dark:#98C379"> 'Content-Type: application/json'</span><span style="color:#98C379;--shiki-dark:#98C379"> 'localhost:9200/user/admin/_search?pretty'</span><span style="color:#D19A66;--shiki-dark:#D19A66">  -d</span><span style="color:#98C379;--shiki-dark:#98C379"> '</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">"query" : { "match" : { "desc" : "quản lý" }}</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">}'</span></span></code></pre>
</div><p>Đoạn mã trên sử dụng <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl-match-query.html" target="_blank" rel="noopener noreferrer">Match Query</a>, với điều kiện khớp được chỉ định là trường <code>desc</code> chứa từ "quản lý". Kết quả trả về như sau.</p>
<div class="language-javascript line-numbers-mode" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "took"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "timed_out"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "total"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "successful"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "skipped"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "failed"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "hits"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "total"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "max_score"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">0.38200712</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "hits"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"admin"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"WWuoDG8BHwECs7SiYn93"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_score"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">0.38200712</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_source"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"Lý Tứ"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "title"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"Kỹ sư"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "desc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"Quản lý hệ thống"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"admin"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_score"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">0.3487891</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_source"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"Trương Tam"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "title"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"Kỹ sư"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "desc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"Quản trị viên siêu cấp"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Elastic mặc định trả về 10 kết quả mỗi lần, bạn có thể thay đổi cài đặt này thông qua trường <code>size</code>, và cũng có thể chỉ định vị trí thông qua trường <code>from</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> curl</span><span style="color:#98C379;--shiki-dark:#98C379"> 'localhost:9200/user/admin/_search'</span><span style="color:#D19A66;--shiki-dark:#D19A66">  -d</span><span style="color:#98C379;--shiki-dark:#98C379"> '</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "query" : { "match" : { "desc" : "quản lý" }},</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "from": 1,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "size": 1</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">}'</span></span></code></pre>
</div><p>Đoạn mã trên chỉ định, bắt đầu từ vị trí 1 (mặc định là bắt đầu từ vị trí 0), chỉ trả về một kết quả.</p>
<h3>Phép toán logic</h3>
<p>Nếu có nhiều từ khóa tìm kiếm, Elastic coi chúng là mối quan hệ <code>or</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> curl</span><span style="color:#98C379;--shiki-dark:#98C379"> 'localhost:9200/user/admin/_search'</span><span style="color:#D19A66;--shiki-dark:#D19A66">  -d</span><span style="color:#98C379;--shiki-dark:#98C379"> '</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">"query" : { "match" : { "desc" : "phần mềm hệ thống" }}</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">}'</span></span></code></pre>
</div><p>Đoạn mã trên tìm kiếm <code>phần mềm or hệ thống</code>.</p>
<p>Nếu bạn muốn thực hiện tìm kiếm <code>and</code> với nhiều từ khóa, bạn phải sử dụng <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl-bool-query.html" target="_blank" rel="noopener noreferrer">Bool Query</a>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> curl</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -H</span><span style="color:#98C379;--shiki-dark:#98C379"> 'Content-Type: application/json'</span><span style="color:#98C379;--shiki-dark:#98C379"> 'localhost:9200/user/admin/_search?pretty'</span><span style="color:#D19A66;--shiki-dark:#D19A66">  -d</span><span style="color:#98C379;--shiki-dark:#98C379"> '</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379"> "query": {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "bool": {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">   "must": [</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    { "match": { "desc": "quản lý" } },</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    { "match": { "desc": "siêu cấp" } }</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">   ]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  }</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">}'</span></span></code></pre>
</div><h3>Thực hiện hàng loạt</h3>
<p>Hỗ trợ thực hiện các hoạt động trên các chỉ mục khác nhau trong một lần gọi API</p>
<p>Hỗ trợ bốn loại hoạt động</p>
<ul>
<li>index</li>
<li>create</li>
<li>update</li>
<li>delete</li>
</ul>
<p>Nếu một hoạt động đơn lẻ thất bại, điều này sẽ không ảnh hưởng đến các hoạt động khác.</p>
<p>Kết quả trả về bao gồm kết quả của từng hoạt động được thực hiện.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> _bulk</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"field1"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value1"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"delete"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"create"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test2",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "3"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"field1"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value3"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"update"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test"}</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"doc"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"field2"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value2"}</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Nếu ví dụ trên được thực hiện nhiều lần, kết quả sẽ không giống nhau.</p>
</blockquote>
<h3>Đọc hàng loạt</h3>
<p>Đọc nhiều chỉ mục</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_mget</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "docs"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Đọc một chỉ mục</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /test/_mget</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "docs"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_mget</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "docs"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> false</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"field3"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"field4"]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "3",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "include"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "exclude"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"user.location"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Truy vấn hàng loạt</h3>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_msearch</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"match_all"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {}},"size":1}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "kibana_sample_data_flights"}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"match_all"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {}},"size":2}</span></span></code></pre>
</div><h3>Tìm kiếm URI</h3>
<p>Tìm kiếm URI Elasticsearch tuân theo ngữ cảnh QueryString, dạng như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=</span><span style="color:#D19A66;--shiki-dark:#D19A66">2012</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">df</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">sort</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">year:desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">from</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">size</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">timeout</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">1s</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><ul>
<li><strong><code>q</code></strong> chỉ định câu truy vấn, sử dụng ngữ cảnh QueryString</li>
<li><strong><code>df</code></strong> là trường mặc định, nếu không chỉ định</li>
<li><strong><code>sort</code></strong> sắp xếp: <code>from</code> và <code>size</code> được sử dụng cho phân trang</li>
<li><strong><code>profile</code></strong> có thể xem cách thực hiện truy vấn</li>
</ul>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:2012</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">sort</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">year:desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">from</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">size</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">timeout</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">1s</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Term và Phrase</h4>
<p>Beautiful Mind tương đương với Beautiful OR Mind</p>
<p>"Beautiful Mind" tương đương với Beautiful AND Mind</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn Term</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:Beautiful</span><span style="color:#98C379;--shiki-dark:#98C379"> Mind</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Sử dụng dấu ngoặc kép, Truy vấn Phrase</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:"Beautiful Mind"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Nhóm và dấu ngoặc kép</h4>
<p>title:(Beautiful AND Mind)</p>
<p>title="Beautiful Mind"</p>
<h4>AND, OR, NOT hoặc &amp;&amp;, ||, !</h4>
<blockquote>
<p>Chú ý: AND, OR, NOT phải viết HOA</p>
</blockquote>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Toán tử boolean</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">Beautiful</span><span style="color:#98C379;--shiki-dark:#98C379"> AND</span><span style="color:#98C379;--shiki-dark:#98C379"> Mind</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">Beautiful</span><span style="color:#98C379;--shiki-dark:#98C379"> NOT</span><span style="color:#98C379;--shiki-dark:#98C379"> Mind</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Truy vấn phạm vi</h4>
<ul>
<li><code>[]</code> biểu thị khoảng đóng</li>
<li><code>{}</code> biểu thị khoảng mở</li>
</ul>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn phạm vi, cú pháp khoảng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:beautiful</span><span style="color:#98C379;--shiki-dark:#98C379"> AND</span><span style="color:#98C379;--shiki-dark:#98C379"> year:{</span><span style="color:#D19A66;--shiki-dark:#D19A66">2010</span><span style="color:#98C379;--shiki-dark:#98C379"> TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 2018%7D</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:beautiful</span><span style="color:#98C379;--shiki-dark:#98C379"> AND</span><span style="color:#98C379;--shiki-dark:#98C379"> year:[</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span><span style="color:#98C379;--shiki-dark:#98C379"> TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 2018]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Ký hiệu toán học</h4>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Hồ sơ sau năm 2010</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=year</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:&gt;</span><span style="color:#98C379;--shiki-dark:#98C379">2010</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Hồ sơ từ năm 2010 đến năm 2018</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=year:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(&gt;2010 &amp;&amp; &lt;</span><span style="color:#98C379;--shiki-dark:#98C379">=2018</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Hồ sơ từ năm 2010 đến năm 2018</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=year:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">+</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#98C379;--shiki-dark:#98C379">2010</span><span style="color:#98C379;--shiki-dark:#98C379"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#98C379;--shiki-dark:#98C379">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">2018</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>Truy vấn dùng ký tự đại diện</h4>
<ul>
<li><code>?</code> đại diện cho 1 ký tự</li>
<li><code>*</code> đại diện cho 0 hoặc nhiều ký tự</li>
</ul>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:mi?d</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:b</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Biểu thức chính quy</h4>
<p>title:[bt]oy</p>
<h4>Kết hợp mờ và truy vấn gần đúng</h4>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Độ tương tự trong khoảng 1 ký tự</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:beautifl~1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Độ tương tự trong khoảng 2 ký tự</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:"Lord Rings"~2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>Request Body &amp; DSL</h3>
<p>Ngoài phương pháp tìm kiếm URI, Elasticsearch còn hỗ trợ việc gửi câu truy vấn thông qua Http Request Body.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /kibana_sample_data_ecommerce/_search?ignore_unavailable=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	  "match_all"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Phân trang</h4>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /kibana_sample_data_ecommerce/_search?ignore_unavailable=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "true",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "from"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "size"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 10,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_all"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Sắp xếp</h4>
<p>Tốt nhất là sắp xếp trên trường dạng số hoặc ngày</p>
<p>Bởi vì khi sắp xếp trên trường có nhiều giá trị hoặc đã được phân tích, hệ thống sẽ chọn một giá trị, không thể biết giá trị đó là gì</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /kibana_sample_data_ecommerce/_search?ignore_unavailable=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "true",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "sort"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "order_date"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "desc"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "from"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "size"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 10,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_all"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Lọc _source</h4>
<p>Nếu <code>_source</code> không được lưu trữ, thì chỉ trả về metadata của các tài liệu khớp</p>
<p><code>_source</code> hỗ trợ sử dụng ký tự đại diện, ví dụ: <code>_source["name*", "desc*"]</code></p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /kibana_sample_data_ecommerce/_search?ignore_unavailable=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "true",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "_source"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "order_date"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "category.keyword"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "from"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "size"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 10,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_all"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Trường script</h4>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /kibana_sample_data_ecommerce/_search?ignore_unavailable=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "true",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "script_fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "new_field"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "script"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "lang"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "painless",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "source"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"doc['order_date'].value+' hello'"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "from"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "size"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 10,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_all"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>Sử dụng biểu thức truy vấn - Match</h4>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> movies/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "title"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "last christmas"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> movies/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "title"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "last christmas",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "and"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>Tìm kiếm cụm từ - Match Phrase</h4>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> movies/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_phrase"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "title"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "last christmas"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h2>Cluster API</h2>
<blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster.html" target="_blank" rel="noopener noreferrer">Elasticsearch Official Cluster API</a></p>
</blockquote>
<p>Một số API cấp cluster có thể được thực thi trên một tập con của các node, những node này có thể được chỉ định bằng bộ lọc node. Ví dụ, các API quản lý task, thống kê node và thông tin node đều có thể báo cáo kết quả từ một nhóm các node đã lọc thay vì tất cả các node.</p>
<p>Bộ lọc node được viết dưới dạng danh sách bộ lọc đơn lẻ được phân tách bằng dấu phẩy, mỗi bộ lọc thêm hoặc loại bỏ các node từ tập con đã chọn. Mỗi bộ lọc có thể là một trong những điều sau:</p>
<ul>
<li><code>_all</code>: thêm tất cả các node vào tập con</li>
<li><code>_local</code>: thêm node cục bộ vào tập con</li>
<li><code>_master</code>: thêm node master hiện tại vào tập con</li>
<li>Thêm các node khớp theo ID node hoặc tên node vào tập con</li>
<li>Thêm các node khớp theo địa chỉ IP hoặc tên máy chủ vào tập con</li>
<li>Sử dụng ký tự đại diện, thêm các node có tên, tên địa chỉ hoặc tên máy chủ khớp vào tập con</li>
<li><code>master:true</code>, <code>data:true</code>, <code>ingest:true</code>, <code>voting_only:true</code>, <code>ml:true</code> hoặc <code>coordinating_only:true</code>, tương ứng có nghĩa là thêm tất cả các node master, tất cả các node dữ liệu, tất cả các node ingest, tất cả các node chỉ bỏ phiếu, tất cả các node machine learning và tất cả các node điều phối vào tập con.</li>
<li><code>master:false</code>, <code>data:false</code>, <code>ingest:false</code>, <code>voting_only:true</code>, <code>ml:false</code> hoặc <code>coordinating_only:false</code>, tương ứng có nghĩa là loại trừ tất cả các node master, tất cả các node dữ liệu, tất cả các node ingest, tất cả các node chỉ bỏ phiếu, tất cả các node machine learning và tất cả các node điều phối ra khỏi tập con.</li>
<li>Mô hình ghép cặp, sử dụng ký tự đại diện <code>*</code>, theo dạng <code>attrname:attrvalue</code>, thêm tất cả các node có thuộc tính node tùy chỉnh vào tập con, tên và giá trị của nó khớp với mô hình tương ứng. Thuộc tính node tùy chỉnh được thiết lập trong tệp cấu hình theo dạng <code>node.attr.attrname: attrvalue</code>.</li>
</ul>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Nếu không có bộ lọc, mặc định là truy vấn tất cả các node</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn tất cả các node</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/_all</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn node cục bộ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/_local</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn node master</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/_master</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn node theo tên (hỗ trợ ký tự đại diện)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/node_name_goes_here</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/node_name_goes_</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn node theo địa chỉ (hỗ trợ ký tự đại diện)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/10.0.0.3,10.0.0.4</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/10.0.0.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn node theo quy tắc</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/_all,master:</span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/data:</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#98C379;--shiki-dark:#98C379">,ingest:</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/coordinating_only:</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/master:</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#98C379;--shiki-dark:#98C379">,voting_only:</span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn node theo thuộc tính tùy chỉnh (ví dụ: truy vấn các node có thuộc tính node.attr.rack:2 trong tệp cấu hình)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/rack:2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/ra</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span><span style="color:#98C379;--shiki-dark:#98C379">:2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/ra</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span><span style="color:#98C379;--shiki-dark:#98C379">:2</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Cluster Health API</h3>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cluster/health</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cluster/health?level=shards</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cluster/health/kibana_sample_data_ecommerce,kibana_sample_data_flights</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cluster/health/kibana_sample_data_flights?level=shards</span></span></code></pre>
</div><h3>Cluster State API</h3>
<p>Cluster State API trả về metadata biểu thị trạng thái toàn bộ cluster.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cluster/state</span></span></code></pre>
</div><h2>Nodes API</h2>
<blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-nodes.html" target="_blank" rel="noopener noreferrer">Elasticsearch Official cat Nodes API</a> - Trả về thông tin về các node trong cluster.</p>
</blockquote>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem các trường mặc định</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/nodes?v=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem các trường chỉ định</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/nodes?v=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">id,ip,port,v,m</span></span></code></pre>
</div><h2>Shards API</h2>
<blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-shards.html" target="_blank" rel="noopener noreferrer">Elasticsearch Official cat Shards API</a> - Lệnh shards cung cấp một cái nhìn chi tiết về shard nào thuộc về node nào. Nó sẽ cho bạn biết nó là primary hay replica, số lượng tài liệu, số byte mà nó chiếm trên đĩa và node mà nó đang nằm trên.</p>
</blockquote>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem các trường mặc định</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/shards</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn shard theo tên (hỗ trợ ký tự đại diện)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/shards/my-index-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem các trường chỉ định</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/shards?h=index,shard,prirep,state,unassigned.reason</span></span></code></pre>
</div><h2>Monitoring API</h2>
<p>Trong Elasticsearch, các thông tin liên quan đến sức khỏe, thống kê, v.v. của cluster đều xoay quanh <code>cat</code> API.</p>
<p>Bằng cách gửi yêu cầu GET đến cat, dưới đây là tất cả các API có sẵn:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">=^</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">.</span><span style="color:#98C379;--shiki-dark:#98C379">^=</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/allocation</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/shards</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/shards/</span><span style="color:#98C379;--shiki-dark:#98C379">{index}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/master</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/nodes</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/tasks</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/indices</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/indices/</span><span style="color:#98C379;--shiki-dark:#98C379">{index}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/segments</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/segments/</span><span style="color:#98C379;--shiki-dark:#98C379">{index}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/count</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/count/</span><span style="color:#98C379;--shiki-dark:#98C379">{index}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/recovery</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/recovery/</span><span style="color:#98C379;--shiki-dark:#98C379">{index}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/health</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/pending_tasks</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/aliases</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/aliases/</span><span style="color:#98C379;--shiki-dark:#98C379">{</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">alias</span><span style="color:#98C379;--shiki-dark:#98C379">}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/thread_pool</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/thread_pool/</span><span style="color:#98C379;--shiki-dark:#98C379">{thread_pools}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/plugins</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/fielddata</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/fielddata/</span><span style="color:#98C379;--shiki-dark:#98C379">{fields}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/nodeattrs</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/repositories</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/snapshots/</span><span style="color:#98C379;--shiki-dark:#98C379">{repository}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/templates</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Tài liệu tham khảo</h2>
<ul>
<li><strong>Chính thức</strong>
<ul>
<li><a href="https://www.elastic.co/products/elasticsearch" target="_blank" rel="noopener noreferrer">Trang chủ Elasticsearch</a></li>
<li><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch Github</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank" rel="noopener noreferrer">Tài liệu chính thức Elasticsearch</a></li>
</ul>
</li>
</ul>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220530072511.png" type="image/png"/>
    </item>
    <item>
      <title>Elasticsearch Sorting</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/sorting.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/sorting.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Sorting</source>
      <description>Elasticsearch Sorting Sắp xếp Elasticsearch Trong Elasticsearch, mặc định được sắp xếp theo đánh giá liên quan (_score) theo thứ tự giảm dần, hoặc có thể sắp xếp theo giá trị củ...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[<p>Elasticsearch Sorting</p>
<h1>Sắp xếp Elasticsearch</h1>
<p>Trong Elasticsearch, mặc định được sắp xếp theo <strong>đánh giá liên quan (_score)</strong> theo thứ tự giảm dần, hoặc có thể sắp xếp theo <strong>giá trị của trường</strong>, <strong>sắp xếp nhiều cấp</strong>, <strong>sắp xếp trường nhiều giá trị</strong>, <strong>sắp xếp dựa trên vị trí địa lý (geo)</strong> và <strong>sắp xếp tùy chỉnh bằng script</strong>. Ngoài ra, đánh giá liên quan cũng có thể được sử dụng để đánh giá lại với rescore hai, ba lần, nó có thể giới hạn kích thước cửa sổ (window size) cho việc đánh giá lại và chỉnh sửa điểm số của các tài liệu trong phạm vi tác động, từ đó đạt được mục tiêu kiểm soát kết quả liên quan một cách tinh vi.</p>
<h2>Sắp xếp liên quan mặc định</h2>
<p>Trong Elasticsearch, mặc định, các tài liệu được sắp xếp theo thứ tự giảm dần của điểm liên quan, trường tương ứng với điểm liên quan được biểu thị bằng <code>_score</code>, đây là kiểu số thực, điểm <code>_score</code> càng cao, liên quan càng cao. Mô hình đánh giá có thể được chỉ định thông qua tham số <code>similarity</code> trong ánh xạ.</p>
<p>Thuật toán tương tự có thể được chỉ định theo trường, chỉ cần chọn trong ánh xạ cho các trường khác nhau, nếu bạn muốn chỉnh sửa thuật toán tương tự của trường hiện có, bạn chỉ có thể đạt được mục tiêu này bằng cách xây dựng lại chỉ mục cho dữ liệu. Đối với thuật toán tương tự es hơn, bạn có thể tham khảo <a href="https://www.knowledgedict.com/tutorial/elasticsearch-similarity.html" target="_blank" rel="noopener noreferrer">Sự hiểu biết sâu sắc về thuật toán tương tự es (tính điểm liên quan)</a>.</p>
<h3>Mô hình TF-IDF</h3>
<p>Trước phiên bản 5.4 của Elasticsearch, các trường kiểu text mặc định sử dụng mô hình không gian vector dựa trên tf-idf.</p>
<p>Khi bắt đầu tính điểm, Elasticsearch sử dụng tần suất của từ khóa được tìm kiếm và mức độ phổ biến của nó để ảnh hưởng đến điểm. Một giải thích ngắn gọn là, <strong>càng nhiều lần một từ khóa xuất hiện trong một tài liệu, nó càng liên quan; tuy nhiên, nếu từ khóa xuất hiện trong nhiều tài liệu khác nhau, nó càng không liên quan</strong>. Điều này được gọi là TF-IDF, TF là <strong>tần suất từ</strong> (term frequency), IDF là <strong>tần suất tài liệu nghịch đảo</strong> (inverse document frequency).</p>
<p>Cách tiếp cận chính để đánh giá một tài liệu là đếm số lần một từ khóa xuất hiện trong văn bản. Ví dụ, nếu người dùng tìm kiếm một buổi họp về Elasticsearch trong khu vực của họ, họ muốn nhóm thảo luận về Elasticsearch được hiển thị đầu tiên.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>"We will discuss Elasticsearch at the next Big Data group."</span></span>
<span class="line"><span>"Tuesday the Elasticsearch team will gather to answer questions about Elasticsearch."</span></span></code></pre>
</div><p>Câu đầu tiên đề cập đến Elasticsearch một lần, trong khi câu thứ hai đề cập đến Elasticsearch hai lần, vì vậy tài liệu chứa câu thứ hai nên có điểm số cao hơn so với tài liệu chứa câu đầu tiên. Nếu chúng ta đề cập đến số lượng, tần suất từ (TF) của câu đầu tiên là 1, trong khi tần suất từ của câu thứ hai sẽ là 2.</p>
<p>Tần suất tài liệu nghịch đảo phức tạp hơn một chút so với tần suất từ. Mô tả tuyệt vời này có nghĩa là, nếu một từ (thông thường là một từ, nhưng không nhất thiết phải là một từ) xuất hiện nhiều lần trong các tài liệu khác nhau của chỉ mục, thì nó sẽ không quan trọng. Ví dụ sau sẽ giải thích điều này một cách dễ dàng hơn.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>"We use Elasticsearch to power the search for our website."</span></span>
<span class="line"><span>"The developers like Elasticsearch so far."</span></span>
<span class="line"><span>"The scoring of documents is calculated by the scoring formula."</span></span></code></pre>
</div><p>Trong ví dụ trên, cần hiểu những điểm sau:</p>
<ul>
<li>Tần suất tài liệu của từ khóa "Elasticsearch" là 2 (vì nó xuất hiện trong hai tài liệu). Tần suất tài liệu nghịch đảo xuất phát từ việc nhân điểm với 1/DF, nơi DF là tần suất tài liệu của từ khóa. Điều này có nghĩa là, do từ khóa có tần suất tài liệu cao hơn, trọng số của nó sẽ giảm.</li>
<li>Tần suất tài liệu của từ khóa "the" là 3, vì nó xuất hiện trong tất cả ba tài liệu. Lưu ý rằng, mặc dù "the" xuất hiện hai lần trong tài liệu cuối cùng, tần suất tài liệu của nó vẫn là 3. Điều này là bởi vì tần suất tài liệu nghịch đảo chỉ kiểm tra xem một từ khóa có xuất hiện trong một tài liệu nào đó hay không, chứ không kiểm tra xem nó xuất hiện bao nhiêu lần. Điều đó nên là mối quan tâm của tần suất từ.</li>
</ul>
<p>Tần suất tài liệu nghịch đảo là một yếu tố quan trọng, được sử dụng để cân nhắc tần suất từ. Ví dụ, xem xét một người dùng tìm kiếm từ khóa "the score", từ "the" xuất hiện gần như trong mọi văn bản tiếng Anh thông thường, nếu nó không được cân nhắc, tần suất từ của từ "the" sẽ hoàn toàn che mờ tần suất từ của từ "score". Tần suất tài liệu nghịch đảo IDF cân nhắc ảnh hưởng liên quan của từ thông dụng như "the", vì vậy điểm liên quan thực tế sẽ mô tả chính xác hơn từ khóa của truy vấn.</p>
<p>Một khi tần suất từ TF và tần suất tài liệu nghịch đảo IDF đã được tính toán, bạn có thể sử dụng công thức TF-IDF để tính điểm của tài liệu.</p>
<h3>Mô hình BM25</h3>
<p>Sau phiên bản 5.4 của Elasticsearch, đối với trường kiểu text, mặc định sử dụng mô hình đánh giá BM25, không phải mô hình không gian vector dựa trên tf-idf, mô hình đánh giá có thể được chỉ định thông qua tham số <code>similarity</code> trong ánh xạ.</p>
<h2>Sắp xếp theo giá trị của trường</h2>
<p>Trong Elasticsearch, để sắp xếp theo giá trị của một trường, bạn có thể sử dụng tham số <code>sort</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> books/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "sort"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "price"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "order"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "desc"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Kết quả trả về như sau:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "took"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">132</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "timed_out"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "total"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "successful"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "skipped"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "failed"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "hits"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "total"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">749244</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "max_score"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "hits"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "_index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "_type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"book"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"8456479"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "_score"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "_source"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          "id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">8456479</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          "price"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1580.00</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">          ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "sort"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">          1580.00</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      },</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">      ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Từ kết quả trả về trên, có thể thấy, <code>max_score</code> và <code>_score</code> đều trả về <code>null</code>, và trường <code>sort</code> được thêm vào, chứa giá trị của trường được sắp xếp. Việc tính toán <code>_score</code> tốn kém, nếu không sắp xếp theo mức độ liên quan, việc ghi lại <code>_score</code> không có ý nghĩa. Nếu bạn vẫn muốn tính toán <code>_score</code> dù sao, bạn có thể đặt tham số <code>track_scores</code> thành <code>true</code>.</p>
<h2>Sắp xếp nhiều trường</h2>
<p>Nếu chúng ta muốn kết hợp price, date và _score để truy vấn, và kết quả phù hợp đầu tiên được sắp xếp theo giá, sau đó được sắp xếp theo ngày, và cuối cùng được sắp xếp theo mức độ liên quan, ví dụ cụ thể như sau:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> books/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"bool"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"must"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "content":</span><span style="color:#98C379;--shiki-dark:#98C379"> "java"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"filter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "user_id":</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4868438</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"sort"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"price"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"order"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "desc"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}, {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"date"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"order"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "desc"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}, {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"_score"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"order"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "desc"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Thứ tự của các điều kiện sắp xếp rất quan trọng. Kết quả đầu tiên được sắp xếp theo điều kiện đầu tiên, chỉ khi giá trị <code>sort</code> đầu tiên của tập kết quả hoàn toàn giống nhau, kết quả mới được sắp xếp theo điều kiện thứ hai, và cứ tiếp tục như vậy.</p>
<p>Sắp xếp nhiều cấp không nhất thiết phải bao gồm <code>_score</code>. Bạn có thể sắp xếp theo một số trường khác nhau, như khoảng cách địa lý hoặc giá trị được tính toán bằng script.</p>
<h2>Sắp xếp trường có nhiều giá trị</h2>
<p>Một trường hợp là sắp xếp khi trường có nhiều giá trị, cần nhớ rằng các giá trị này không có thứ tự cố định; một trường có nhiều giá trị chỉ đơn giản là một bộ giá trị nhiều, vậy nên chọn giá trị nào để sắp xếp?</p>
<p>Đối với số hoặc ngày, bạn có thể giảm trường nhiều giá trị thành một giá trị duy nhất, điều này có thể được thực hiện bằng cách sử dụng chế độ sắp xếp <code>min</code>, <code>max</code>, <code>avg</code> hoặc <code>sum</code>. Ví dụ, bạn có thể sắp xếp theo ngày sớm nhất trong mỗi trường date, thông qua cách sau:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379">"sort"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "dates"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "order"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"asc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "mode"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:  </span><span style="color:#98C379;--shiki-dark:#98C379">"min"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h2>Sắp xếp theo khoảng cách địa lý</h2>
<p>Elasticsearch sử dụng <code>_geo_distance</code> để sắp xếp theo khoảng cách địa lý, như ví dụ sau:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "sort"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "_geo_distance"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "es_location_field"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : [</span><span style="color:#D19A66;--shiki-dark:#D19A66">116.407526</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">39.904030</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "order"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"asc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "unit"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"km"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "mode"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"min"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "distance_type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"plane"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "query"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    ......</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Các tùy chọn của <code>_geo_distance</code> cụ thể như sau:</p>
<ul>
<li>Trường <code>es_location_field</code> trong ví dụ trên là tên của trường lưu trữ dữ liệu kinh độ và vĩ độ trong Elasticsearch.</li>
<li><code>order</code>: chỉ định sắp xếp theo khoảng cách tăng dần hoặc giảm dần, tương ứng với <code>asc</code> và <code>desc</code>.</li>
<li><code>unit</code>: đơn vị tính khoảng cách, mặc định là <code>m</code>, biểu thị mét (meters), các tùy chọn khác bao gồm <code>mi</code>, <code>cm</code>, <code>mm</code>, <code>NM</code>, <code>km</code>, <code>ft</code>, <code>yd</code> và <code>in</code>.</li>
<li><code>mode</code>: khi xử lý dữ liệu mảng (nhiều giá trị), chỉ định chế độ lấy giá trị, các tùy chọn bao gồm <code>min</code>, <code>max</code>, <code>sum</code>, <code>avg</code> và <code>median</code>. Khi sắp xếp theo thứ tự tăng dần, mặc định là <code>min</code>; khi sắp xếp theo thứ tự giảm dần, mặc định là <code>max</code>.</li>
<li><code>distance_type</code>: đặt cách tính toán khoảng cách, các tùy chọn bao gồm <code>sloppy_arc</code>, <code>arc</code> và <code>plane</code>. Mặc định là <code>sloppy_arc</code>. <code>arc</code> có độ chính xác tương đối cao hơn nhưng tốc độ sẽ giảm đáng kể, <code>plane</code> thì tốc độ tính toán nhanh nhưng không chính xác với khoảng cách dài.</li>
<li><code>ignore_unmapped</code>: khi gặp trường chưa được ánh xạ, có nên bỏ qua không, các tùy chọn bao gồm <code>true</code> và <code>false</code>. Mặc định là <code>false</code>, tức là nếu gặp trường chưa được ánh xạ, truy vấn sẽ gây ra ngoại lệ; nếu đặt là <code>true</code>, nó sẽ bỏ qua các trường chưa được ánh xạ và không khớp với bất kỳ tài liệu nào trong truy vấn này.</li>
<li><code>validation_method</code>: chỉ định cách kiểm tra dữ liệu kinh độ và vĩ độ, các tùy chọn bao gồm <code>IGNORE_MALFORMED</code>, <code>COERCE</code> và <code>STRICT</code>. <code>IGNORE_MALFORMED</code> cho phép chấp nhận điểm địa lý có vĩ độ hoặc kinh độ không hợp lệ, tức là bỏ qua dữ liệu; <code>COERCE</code> cố gắng đoán và chuyển đổi thành tọa độ địa lý chính xác; <code>STRICT</code> là giá trị mặc định, tức là sẽ ném ra ngoại lệ khi gặp tọa độ địa lý không chính xác.</li>
</ul>
<h2>Tài liệu tham khảo</h2>
<ul>
<li><a href="https://www.knowledgedict.com/tutorial/elasticsearch-intro.html" target="_blank" rel="noopener noreferrer">Hướng dẫn Elasticsearch</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>MongoDB</title>
      <link>https://vanhung4499.github.io/database/mongodb/</link>
      <guid>https://vanhung4499.github.io/database/mongodb/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>MongoDB Aggreation</title>
      <link>https://vanhung4499.github.io/database/mongodb/aggreation.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/aggreation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Aggreation</source>
      <description>Các hoạt động tổng hợp trong MongoDB Các hoạt động tổng hợp trong MongoDB xử lý các bản ghi dữ liệu và trả về kết quả tính toán. Các hoạt động tổng hợp nhóm các giá trị từ nhiều...</description>
      <category>mongodb</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Các hoạt động tổng hợp trong MongoDB xử lý các bản ghi dữ liệu và trả về kết quả tính toán. Các hoạt động tổng hợp nhóm các giá trị từ nhiều tài liệu và có thể thực hiện các thao tác khác nhau trên dữ liệu nhóm để trả về một kết quả duy nhất. MongoDB cung cấp ba cách thực hiện hoạt động tổng hợp: Pipeline, Map-Reduce và các phương pháp tổng hợp đơn lẻ.</p>
<h2>Pipeline</h2>
<h3>Giới thiệu về Pipeline</h3>
<p>Khung tổng hợp của MongoDB được xây dựng dựa trên khái niệm của Pipeline xử lý dữ liệu.</p>
<p><strong>MongoDB hỗ trợ hoạt động tổng hợp thông qua phương thức <a href="https://docs.mongodb.com/manual/reference/method/db.collection.aggregate/#db.collection.aggregate" target="_blank" rel="noopener noreferrer"><code>db.collection.aggregate()</code></a></strong>. Ngoài ra, MongoDB cung cấp lệnh <a href="https://docs.mongodb.com/manual/reference/command/aggregate/#dbcmd.aggregate" target="_blank" rel="noopener noreferrer"><code>aggregate</code></a> để thực hiện pipeline.</p>
<p>Pipeline của MongoDB bao gồm nhiều giai đoạn (<a href="https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/#aggregation-pipeline-operator-reference" target="_blank" rel="noopener noreferrer">stages</a>). Mỗi giai đoạn sẽ chuyển đổi các tài liệu khi chúng đi qua pipeline. Một giai đoạn không cần tạo ra một tài liệu đầu ra cho mỗi tài liệu đầu vào. Ví dụ, một số giai đoạn có thể tạo ra các tài liệu mới hoặc lọc các tài liệu.</p>
<p>Cùng một giai đoạn có thể xuất hiện nhiều lần trong pipeline, trừ các giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/out/#pipe._S_out" target="_blank" rel="noopener noreferrer"><code>$out</code></a>, <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/merge/#pipe._S_merge" target="_blank" rel="noopener noreferrer"><code>$merge</code></a>, và <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/geoNear/#pipe._S_geoNear" target="_blank" rel="noopener noreferrer"><code>$geoNear</code></a>. Tất cả các giai đoạn pipeline có sẵn có thể được tham khảo tại: <a href="https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/#aggregation-pipeline-operator-reference" target="_blank" rel="noopener noreferrer">Aggregation Pipeline Stages</a>.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200921092725.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<ul>
<li>Giai đoạn đầu tiên: Giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer"><code>$match</code></a> lọc các tài liệu theo trường trạng thái và chuyển các tài liệu có trạng thái là "A" sang giai đoạn tiếp theo.</li>
<li>Giai đoạn thứ hai: Giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group" target="_blank" rel="noopener noreferrer"><code>$group</code></a> nhóm các tài liệu theo trường cust_id để tính tổng số tiền cho mỗi cust_id duy nhất.</li>
</ul>
<p>Các giai đoạn pipeline cơ bản cung cấp bộ lọc, tương tự như truy vấn, và chuyển đổi tài liệu đầu ra (thay đổi hình thức tài liệu đầu ra).</p>
<p>Các hoạt động pipeline khác cung cấp các công cụ để nhóm và sắp xếp các tài liệu theo trường cụ thể, cũng như tổng hợp nội dung của mảng (bao gồm cả mảng tài liệu). Ngoài ra, các giai đoạn pipeline có thể sử dụng các toán tử để thực hiện các nhiệm vụ như tính trung bình hoặc kết hợp chuỗi.</p>
<p>Pipeline tổng hợp cũng có thể hoạt động trên tập hợp phân đoạn.</p>
<h3>Tối ưu hóa Pipeline</h3>
<h4>Tối ưu hóa Projection</h4>
<p>Pipeline có thể xác định xem chỉ cần các trường bắt buộc trong tài liệu để có được kết quả.</p>
<h4>Tối ưu hóa tuần tự Pipeline</h4>
<p>Tối ưu hóa tuần tự (<code>$project</code>, <code>$unset</code>, <code>$addFields</code>, <code>$set</code>) + <code>$match</code></p>
<p>Đối với Pipeline có chứa các giai đoạn chiếu (<a href="https://docs.mongodb.com/manual/reference/operator/aggregation/unset/#pipe._S_unset" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 81: …gation/project/#̲pipe._S_project…" style="color:#cc0000">project](https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project) hoặc [</span>unset</a> hoặc <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/set/#pipe._S_set" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 85: …tion/addFields/#̲pipe._S_addFiel…" style="color:#cc0000">addFields](https://docs.mongodb.com/manual/reference/operator/aggregation/addFields/#pipe._S_addFields) hoặc [</span>set</a>) và theo sau là giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 77: …regation/match/#̲pipe._S_match),…" style="color:#cc0000">match](https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match), MongoDB sẽ di chuyển bộ lọc của tất cả các giai đoạn [</span>match</a> không cần thiết tính toán các giá trị trong giai đoạn chiếu, thành một giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer">$match</a> mới trước giai đoạn chiếu.</p>
<p>Nếu Pipeline chứa nhiều giai đoạn chiếu và/hoặc giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 77: …regation/match/#̲pipe._S_match),…" style="color:#cc0000">match](https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match), MongoDB sẽ thực hiện tối ưu hóa này cho mỗi giai đoạn [</span>match</a>, di chuyển bộ lọc <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer">$match</a> vào trước tất cả các giai đoạn chiếu không phụ thuộc vào nó.</p>
<p>【Ví dụ】Ví dụ tối ưu hóa tuần tự Pipeline</p>
<p>Trước tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$addFields</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    maxTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$max</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"$times"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    minTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$min</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"$times"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">} },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$project</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">times</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">maxTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">minTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    avgTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$avg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"$maxTime"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"$minTime"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">] }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">} },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Joe Schmoe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    maxTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$lt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    minTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$gt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    avgTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$gt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">} }</span></span></code></pre>
</div><p>Sau tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Joe Schmoe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$addFields</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    maxTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$max</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"$times"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    minTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$min</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"$times"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">} },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">maxTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$lt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, </span><span style="color:#E06C75;--shiki-dark:#E06C75">minTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$gt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$project</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">times</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">maxTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">minTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    avgTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$avg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"$maxTime"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"$minTime"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">] }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">} },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">avgTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$gt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } } }</span></span></code></pre>
</div><p>Giải thích:</p>
<p><code>{ name: "Joe Schmoe" }</code> không cần tính toán bất kỳ giá trị nào trong giai đoạn chiếu, vì vậy nó có thể đặt ở đầu tiên.</p>
<p><code>{ avgTime: { $gt: 7 } }</code> phụ thuộc vào trường <code>avgTime</code> của giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project" target="_blank" rel="noopener noreferrer">$project</a>, nên không thể di chuyển.</p>
<p>Trường <code>maxTime</code> và <code>minTime</code> được phụ thuộc vào giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 85: …tion/addFields/#̲pipe._S_addFiel…" style="color:#cc0000">undefined</span>match</a> mới được tạo ra và đặt trước giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project" target="_blank" rel="noopener noreferrer">$project</a>.</p>
<h4>Tối ưu hóa song song Pipeline</h4>
<p>Nếu có thể, giai đoạn tối ưu hóa sẽ kết hợp các giai đoạn Pipeline vào giai đoạn trước đó. Thông thường, việc kết hợp xảy ra sau tối ưu hóa lại thứ tự của bất kỳ chuỗi nào.</p>
<h5><code>$sort</code> + <code>$limit</code></h5>
<p>Khi <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 75: …gregation/sort/#̲pipe._S_sort) đ…" style="color:#cc0000">sort](https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort) đứng trước [</span>limit</a> và không có giai đoạn trung gian nào thay đổi số lượng tài liệu (ví dụ: <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 79: …egation/unwind/#̲pipe._S_unwind)…" style="color:#cc0000">unwind](https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind), [</span>group</a>), trình tối ưu hóa có thể kết hợp <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 77: …regation/limit/#̲pipe._S_limit) …" style="color:#cc0000">limit](https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit) vào [</span>sort</a>. Nếu có giai đoạn trung gian thay đổi số lượng tài liệu giữa <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 75: …gregation/sort/#̲pipe._S_sort) v…" style="color:#cc0000">sort](https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort) và [</span>limit</a>, MongoDB sẽ không kết hợp <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 77: …regation/limit/#̲pipe._S_limit) …" style="color:#cc0000">limit](https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit) vào [</span>sort</a>.</p>
<p>【Ví dụ】<code>$sort</code> + <code>$limit</code></p>
<p>Trước tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$sort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : { </span><span style="color:#E06C75;--shiki-dark:#E06C75">age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$project</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : { </span><span style="color:#E06C75;--shiki-dark:#E06C75">age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span></code></pre>
</div><p>Sau tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "$sort"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">       "sortKey"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "age"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">       },</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">       "limit"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">NumberLong</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">},</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#98C379;--shiki-dark:#98C379">"$project"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">         "age"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">         "status"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">         "name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h5><code>$limit</code> + <code>$limit</code></h5>
<p>Nếu một <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 77: …regation/limit/#̲pipe._S_limit) …" style="color:#cc0000">limit](https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit) ngay sau một [</span>limit</a> khác, chúng có thể được kết hợp thành một.</p>
<p>Trước tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span></code></pre>
</div><p>Sau tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  $limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h5><code>$skip</code> + <code>$skip</code></h5>
<p>Nếu một <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/skip/#pipe._S_skip" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 75: …gregation/skip/#̲pipe._S_skip) n…" style="color:#cc0000">skip](https://docs.mongodb.com/manual/reference/operator/aggregation/skip/#pipe._S_skip) ngay sau một [</span>skip</a> khác, chúng có thể được kết hợp thành một.</p>
<p>Trước tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$skip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$skip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span></code></pre>
</div><p>Sau tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  $skip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h5><code>$match</code> + <code>$match</code></h5>
<p>Nếu một <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 77: …regation/match/#̲pipe._S_match) …" style="color:#cc0000">match](https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match) ngay sau một [</span>match</a> khác, chúng có thể được kết hợp thành một bằng <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/and/#exp._S_and" target="_blank" rel="noopener noreferrer">$and</a>.</p>
<p>Trước tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">year</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2014</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"A"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } }</span></span></code></pre>
</div><p>Sau tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  $match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    $and</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">year</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2014</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, { </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h5><code>$lookup</code> + <code>$unwind</code></h5>
<p>Nếu một <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 79: …egation/unwind/#̲pipe._S_unwind)…" style="color:#cc0000">unwind](https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind) ngay sau một [</span>lookup</a> và <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 79: …egation/unwind/#̲pipe._S_unwind)…" style="color:#cc0000">unwind](https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind) được thực hiện trên trường as của [</span>lookup</a>, trình tối ưu hóa có thể kết hợp <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 79: …egation/unwind/#̲pipe._S_unwind)…" style="color:#cc0000">unwind](https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind) vào [</span>lookup</a> để tránh tạo ra các tài liệu trung gian lớn hơn.</p>
<p>Trước tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  $lookup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"otherCollection"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"resultingArray"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    localField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"x"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    foreignField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"y"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">},</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$unwind</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"$resultingArray"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Sau tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  $lookup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"otherCollection"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"resultingArray"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    localField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"x"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    foreignField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"y"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    unwinding</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">preserveNullAndEmptyArrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>Giới hạn của Pipeline</h3>
<p>Mỗi tài liệu trong tập kết quả bị giới hạn bởi kích thước tài liệu BSON (hiện tại là 16 MB).</p>
<p>Giới hạn bộ nhớ của Pipeline là 100 MB.</p>
<h2>Map-Reduce</h2>
<blockquote>
<p>Pipeline tổng hợp cung cấp hiệu suất tốt hơn và giao diện nhất quán hơn so với map-reduce.</p>
</blockquote>
<p>Map-reduce là một mô hình xử lý dữ liệu được sử dụng để tổng hợp một lượng lớn dữ liệu thành kết quả tổng hợp hữu ích. Để thực hiện thao tác map-reduce, MongoDB cung cấp lệnh cơ sở dữ liệu <a href="https://docs.mongodb.com/manual/reference/command/mapReduce/#dbcmd.mapReduce" target="_blank" rel="noopener noreferrer"><code>mapReduce</code></a>.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724012524.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Trong quá trình trên, MongoDB áp dụng giai đoạn map cho mỗi tài liệu đầu vào (tức là tài liệu trong bộ sưu tập khớp với điều kiện truy vấn). Hàm map phân phối nhiều cặp khóa-giá trị. Đối với các khóa có nhiều giá trị, MongoDB áp dụng giai đoạn reduce, giai đoạn này thu thập và tổng hợp dữ liệu tổng hợp. Sau đó, MongoDB lưu kết quả vào bộ sưu tập. Tùy chọn, đầu ra của hàm reduce có thể được tổng hợp thêm bằng hàm finalize.</p>
<p>Tất cả các hàm map-reduce trong MongoDB đều là JavaScript và chạy trong quá trình mongod. Thao tác map-reduce nhận đầu vào là tài liệu của một bộ sưu tập và có thể thực hiện bất kỳ sắp xếp và giới hạn nào trước giai đoạn map. mapReduce có thể trả về kết quả của thao tác map-reduce dưới dạng tài liệu hoặc ghi kết quả vào bộ sưu tập.</p>
<h2>Phương pháp tổng hợp đơn mục đích</h2>
<p>MongoDB hỗ trợ các phương pháp tổng hợp đơn mục đích sau đây:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.estimatedDocumentCount/#db.collection.estimatedDocumentCount" target="_blank" rel="noopener noreferrer"><code>db.collection.estimatedDocumentCount()</code></a>: Đếm ước lượng số lượng tài liệu trong một bộ sưu tập.</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.count/#db.collection.count" target="_blank" rel="noopener noreferrer"><code>db.collection.count()</code></a>: Đếm số lượng tài liệu trong một bộ sưu tập.</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.distinct/#db.collection.distinct" target="_blank" rel="noopener noreferrer"><code>db.collection.distinct()</code></a>: Lấy các giá trị duy nhất từ một trường trong một bộ sưu tập.</li>
</ul>
<p>Tất cả các thao tác này tổng hợp các tài liệu trong một bộ sưu tập duy nhất. Mặc dù các thao tác này cung cấp cách tiếp cận đơn giản cho các quy trình tổng hợp thông thường, nhưng chúng thiếu tính linh hoạt và tính năng phong phú so với pipeline tổng hợp và map-reduce.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724012551.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h2>So sánh Aggregation trong SQL và MongoDB</h2>
<p>Pipeline trong MongoDB cung cấp nhiều phép toán tương đương với các câu lệnh hoặc hàm tổng hợp phổ biến trong SQL.</p>
<p>Bảng dưới đây tóm tắt sự tương ứng giữa các câu lệnh hoặc khái niệm tổng hợp SQL phổ biến và các phép toán tổng hợp MongoDB:</p>
<p>| SQL Terms, Functions, and Concepts | MongoDB Aggregation Operators                                                                                                                                                                             |<br>
| :</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200921092725.png" type="image/png"/>
    </item>
    <item>
      <title>MongoDB CRUD Operations</title>
      <link>https://vanhung4499.github.io/database/mongodb/crud.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/crud.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB CRUD Operations</source>
      <description>Các thao tác CRUD trong MongoDB I. Các thao tác CRUD cơ bản Các thao tác CRUD trong MongoDB là các thao tác đọc và ghi dữ liệu vào tài liệu (document). Thao tác Create (Tạo) Mon...</description>
      <category>mongodb</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>I. Các thao tác CRUD cơ bản</h2>
<p>Các thao tác CRUD trong MongoDB là các thao tác đọc và ghi dữ liệu vào tài liệu (document).</p>
<h3>Thao tác Create (Tạo)</h3>
<p>MongoDB cung cấp các thao tác sau để chèn tài liệu vào một bộ sưu tập (collection):</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.insertOne/#db.collection.insertOne" target="_blank" rel="noopener noreferrer"><code>db.collection.insertOne()</code></a>: Chèn một tài liệu vào bộ sưu tập.</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.insertMany/#db.collection.insertMany" target="_blank" rel="noopener noreferrer"><code>db.collection.insertMany()</code></a>: Chèn nhiều tài liệu vào bộ sưu tập.</li>
</ul>
<blockquote>
<p>Lưu ý: Các thao tác trên đều là thao tác nguyên tử.</p>
</blockquote>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200924112342.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Đặc điểm của thao tác chèn:</p>
<ul>
<li>Tất cả các thao tác ghi trong MongoDB đều là thao tác nguyên tử cấp tài liệu duy nhất.</li>
<li>Nếu bộ sưu tập mà bạn muốn chèn không tồn tại, thì thao tác chèn sẽ tự động tạo bộ sưu tập đó.</li>
<li>Trong MongoDB, mỗi tài liệu được lưu trữ trong một bộ sưu tập cần có một trường <a href="https://docs.mongodb.com/manual/reference/glossary/#term-id" target="_blank" rel="noopener noreferrer"><code>_id</code></a> duy nhất làm khóa chính. Nếu tài liệu chèn thiếu trường <code>_id</code>, thì trình điều khiển MongoDB sẽ tự động tạo ra trường <code>_id</code> dưới dạng ObjectId.</li>
<li>Bạn có thể điều chỉnh cấp độ xác nhận của thao tác ghi trong MongoDB.</li>
</ul>
<p>【Ví dụ】Ví dụ chèn một tài liệu:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insertOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">({</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'canvas'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  tags</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'cotton'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">28</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">35.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">})</span></span></code></pre>
</div><p>【Ví dụ】Ví dụ chèn nhiều tài liệu:</p>
<div class="language-javascript line-numbers-mode" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insertMany</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'journal'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    tags</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'blank'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'red'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">14</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">21</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'mat'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    tags</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'gray'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">27.9</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">35.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'mousepad'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    tags</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'gel'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'blue'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">19</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">22.85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Thao tác Read (Đọc)</h3>
<p>MongoDB cung cấp phương thức <a href="https://docs.mongodb.com/manual/reference/method/db.collection.find/#db.collection.find" target="_blank" rel="noopener noreferrer"><code>db.collection.find()</code></a> để truy vấn tài liệu.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200924113832.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h3>Thao tác Update (Cập nhật)</h3>
<p>MongoDB cung cấp các thao tác sau để cập nhật tài liệu trong một bộ sưu tập:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.updateOne/#db.collection.updateOne" target="_blank" rel="noopener noreferrer"><code>db.collection.updateOne()</code></a>: Cập nhật một tài liệu.</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.updateMany/#db.collection.updateMany" target="_blank" rel="noopener noreferrer"><code>db.collection.updateMany()</code></a>: Cập nhật nhiều tài liệu.</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.replaceOne/#db.collection.replaceOne" target="_blank" rel="noopener noreferrer"><code>db.collection.replaceOne()</code></a>: Thay thế một tài liệu.</li>
</ul>
<p>Cú pháp:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.updateOne/#db.collection.updateOne" target="_blank" rel="noopener noreferrer"><code>db.collection.updateOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.updateMany/#db.collection.updateMany" target="_blank" rel="noopener noreferrer"><code>db.collection.updateMany(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.replaceOne/#db.collection.replaceOne" target="_blank" rel="noopener noreferrer"><code>db.collection.replaceOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></a></li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200924114043.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>【Ví dụ】Chèn dữ liệu thử nghiệm:</p>
<div class="language-javascript line-numbers-mode" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insertMany</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'canvas'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">28</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">35.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'journal'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">14</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">21</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'mat'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">27.9</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">35.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'mousepad'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">19</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">22.85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'P'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'notebook'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">50</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">8.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'in'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'P'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'paper'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">8.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'in'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'D'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'planner'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">75</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">22.85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">30</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'D'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'postcard'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">45</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">15.25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'sketchbook'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">80</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">14</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">21</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'sketch pad'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">95</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">22.85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">30.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【Ví dụ】Cập nhật một tài liệu:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">updateOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'paper'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    $set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#98C379;--shiki-dark:#98C379">'size.uom'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'P'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    $currentDate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">lastModified</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><p>【Ví dụ】Cập nhật nhiều tài liệu:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">updateMany</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$lt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">50</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    $set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#98C379;--shiki-dark:#98C379">'size.uom'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'in'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'P'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    $currentDate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">lastModified</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><p>【Ví dụ】Thay thế một tài liệu:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">replaceOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'paper'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'paper'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    instock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      { </span><span style="color:#E06C75;--shiki-dark:#E06C75">warehouse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">60</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      { </span><span style="color:#E06C75;--shiki-dark:#E06C75">warehouse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'B'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">40</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><p>Đặc điểm của thao tác cập nhật:</p>
<ul>
<li>Tất cả các thao tác ghi trong MongoDB đều là thao tác nguyên tử cấp tài liệu duy nhất.</li>
<li>Một khi đã được thiết lập, không thể cập nhật hoặc thay thế trường <a href="https://docs.mongodb.com/manual/reference/glossary/#term-id" target="_blank" rel="noopener noreferrer"><code>_id</code></a>.</li>
<li>MongoDB sẽ giữ nguyên thứ tự các trường trong tài liệu sau khi thực hiện thao tác ghi, trừ khi:
<ul>
<li>Trường <code>_id</code> luôn là trường đầu tiên trong tài liệu.</li>
<li>Các thao tác cập nhật bao gồm việc đổi tên trường có thể dẫn đến sắp xếp lại các trường trong tài liệu.</li>
</ul>
</li>
<li>Nếu thao tác cập nhật chứa <code>upsert: true</code> và không có tài liệu nào khớp với bộ lọc, MongoDB sẽ chèn một tài liệu mới; nếu có tài liệu khớp, MongoDB sẽ cập nhật hoặc thay thế các tài liệu đó.</li>
</ul>
<h3>Thao tác Delete (Xóa)</h3>
<p>MongoDB cung cấp các thao tác sau để xóa tài liệu trong một bộ sưu tập:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.deleteOne/#db.collection.deleteOne" target="_blank" rel="noopener noreferrer"><code>db.collection.deleteOne()</code></a>: Xóa một tài liệu.</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.deleteMany/#db.collection.deleteMany" target="_blank" rel="noopener noreferrer"><code>db.collection.deleteMany()</code></a>: Xóa nhiều tài liệu.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200924120007.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Đặc điểm của thao tác xóa:</p>
<ul>
<li>Tất cả các thao tác ghi trong MongoDB đều là thao tác nguyên tử cấp tài liệu duy nhất.</li>
</ul>
<h2>II. Thao tác ghi hàng loạt</h2>
<p>MongoDB hỗ trợ thao tác ghi hàng loạt (bao gồm chèn hàng loạt, cập nhật hàng loạt, xóa hàng loạt) thông qua phương thức <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite" target="_blank" rel="noopener noreferrer"><code>db.collection.bulkWrite()</code></a>.</p>
<p>Ngoài ra, phương thức <a href="https://docs.mongodb.com/manual/reference/method/db.collection.insertMany/#db.collection.insertMany" target="_blank" rel="noopener noreferrer"><code>db.collection.insertMany()</code></a> cũng hỗ trợ thao tác chèn hàng loạt.</p>
<h3>Thao tác có thứ tự và không có thứ tự</h3>
<p>Thao tác ghi hàng loạt có thể được thực hiện theo thứ tự hoặc không có thứ tự.</p>
<ul>
<li>Đối với danh sách có thứ tự, MongoDB thực hiện các thao tác theo thứ tự. Nếu có lỗi xảy ra trong quá trình xử lý thao tác ghi, MongoDB sẽ không xử lý các thao tác ghi còn lại trong danh sách.</li>
<li>Đối với danh sách không có thứ tự, MongoDB có thể thực hiện các thao tác song song, nhưng không đảm bảo hành vi này. Nếu có lỗi xảy ra trong quá trình xử lý thao tác ghi, MongoDB sẽ tiếp tục xử lý các thao tác ghi còn lại trong danh sách.</li>
</ul>
<p>Thực hiện các thao tác có thứ tự trên một tập hợp phân đoạn thường chậm hơn thực hiện các thao tác không có thứ tự, vì đối với các thao tác có thứ tự, mỗi thao tác phải chờ đợi thao tác trước hoàn thành.</p>
<p>Mặc định, <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite" target="_blank" rel="noopener noreferrer"><code>bulkWrite()</code></a> thực hiện các thao tác có thứ tự. Để chỉ định các thao tác ghi không có thứ tự, hãy đặt <code>ordered: false</code> trong tài liệu tùy chọn.</p>
<h3>Phương thức bulkWrite()</h3>
<p><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite" target="_blank" rel="noopener noreferrer"><code>bulkWrite()</code></a> hỗ trợ các thao tác ghi sau đây:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-insertone" target="_blank" rel="noopener noreferrer">insertOne</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-updateonemany" target="_blank" rel="noopener noreferrer">updateOne</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-updateonemany" target="_blank" rel="noopener noreferrer">updateMany</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-replaceone" target="_blank" rel="noopener noreferrer">replaceOne</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-deleteonemany" target="_blank" rel="noopener noreferrer">deleteOne</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-deleteonemany" target="_blank" rel="noopener noreferrer">deleteMany</a></li>
</ul>
<p>【Ví dụ】Ví dụ về thao tác ghi hàng loạt:</p>
<div class="language-javascript line-numbers-mode" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">  db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">characters</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">bulkWrite</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      insertOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        document</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Dithras'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'barbarian'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          lvl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      insertOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        document</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Taeln'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'fighter'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          lvl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      updateOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        filter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Eldon'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Critical Injury'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#E06C75;--shiki-dark:#E06C75">deleteOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">filter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Brisbane'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      replaceOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        filter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Meldane'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        replacement</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Tanys'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'oracle'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">lvl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ])</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E06C75;--shiki-dark:#E06C75">e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E06C75;--shiki-dark:#E06C75">e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Chiến lược thao tác ghi hàng loạt</h3>
<p>Các thao tác chèn hàng loạt lớn (bao gồm chèn dữ liệu ban đầu hoặc nhập dữ liệu thường xuyên) có thể ảnh hưởng đến hiệu suất của cụm phân đoạn. Đối với thao tác chèn hàng loạt, hãy xem xét các chiến lược sau:</p>
<h4>Trước khi tách collection</h4>
<p>Nếu tập hợp phân đoạn rỗng, tập hợp đó chỉ có một phân đoạn ban đầu nằm trên một phân đoạn duy nhất. Sau đó, MongoDB phải mất một khoảng thời gian để nhận dữ liệu, tạo các phân đoạn và phân phối các phân đoạn đã tách đến các phân đoạn khả dụng. Để tránh chi phí hiệu suất này, bạn có thể tiền tách collection theo hướng dẫn về tách phân đoạn trong cụm phân đoạn.</p>
<h4>Thao tác ghi không có thứ tự</h4>
<p>Để cải thiện hiệu suất ghi vào cụm phân đoạn, hãy sử dụng <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite" target="_blank" rel="noopener noreferrer"><code>bulkWrite()</code></a> và đặt tham số tùy chọn <code>ordered</code> thành false. <a href="https://docs.mongodb.com/manual/reference/program/mongos/#bin.mongos" target="_blank" rel="noopener noreferrer"><code>mongos</code></a> có thể cố gắng gửi các thao tác ghi đến nhiều phân đoạn cùng một lúc. Đối với tập hợp trống, hãy tiền tách collection theo hướng dẫn tách phân đoạn trong cụm phân đoạn.</p>
<h4>Tránh luồng dữ liệu đơn điệu</h4>
<p>Nếu trong một thao tác chèn, khóa phân đoạn tăng dần, tất cả dữ liệu chèn sẽ được lưu trữ trong phân đoạn cuối cùng của tập hợp, tức là chỉ lưu trữ trong một phân đoạn. Do đó, khả năng chèn của cụm sẽ không bao giờ vượt quá khả năng chèn của một phân đoạn duy nhất.</p>
<p>Nếu lượng dữ liệu chèn lớn hơn khả năng chèn của một phân đoạn duy nhất và không thể tránh được khóa phân đoạn tăng dần, hãy xem xét các sửa đổi sau đây cho ứng dụng:</p>
<ul>
<li>Đảo ngược các bit nhị phân của khóa phân đoạn. Điều này giữ nguyên thông tin và tránh liên kết thứ tự chèn với sự gia tăng giá trị.</li>
<li>Hoán đổi 16 bit đầu tiên và cuối cùng của khóa để chèn "ngẫu nhiên".</li>
</ul>
<h2>So sánh SQL và MongoDB</h2>
<h3>Thuật ngữ và Khái niệm</h3>
<p>| Thuật ngữ và Khái niệm SQL    | Thuật ngữ và Khái niệm MongoDB                                                                                                                                                                                                                         |<br>
|:</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200924112342.svg" type="image/svg+xml"/>
    </item>
    <item>
      <title>MongoDB Guide</title>
      <link>https://vanhung4499.github.io/database/mongodb/guide.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/guide.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Guide</source>
      <description>Hướng dẫn MongoDB Giới thiệu MongoDB là một cơ sở dữ liệu dựa trên hệ thống lưu trữ tệp phân tán. Được viết bằng ngôn ngữ C++. Mục tiêu là cung cấp một giải pháp lưu trữ dữ liệu...</description>
      <category>mongodb</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giới thiệu</h2>
<p>MongoDB là một cơ sở dữ liệu dựa trên hệ thống lưu trữ tệp phân tán. Được viết bằng ngôn ngữ C++. Mục tiêu là cung cấp một giải pháp lưu trữ dữ liệu có khả năng mở rộng và hiệu suất cao cho các ứng dụng web.</p>
<p>MongoDB lưu trữ dữ liệu dưới dạng tài liệu, cấu trúc dữ liệu bao gồm các cặp khóa-giá trị (key-value). Tài liệu trong MongoDB tương tự như đối tượng JSON. Giá trị của trường có thể chứa các tài liệu khác, mảng và mảng tài liệu.</p>
<h3>Phát triển của MongoDB</h3>
<ul>
<li>Phiên bản 1.x - Hỗ trợ sao chép và phân đoạn</li>
<li>Phiên bản 2.x - Các tính năng cơ sở dữ liệu phong phú hơn</li>
<li>Phiên bản 3.x - WiredTiger và hệ sinh thái xung quanh</li>
<li>Phiên bản 4.x - Hỗ trợ giao dịch phân tán</li>
</ul>
<h3>MongoDB và RDBMS</h3>
<p>| Tính năng   | MongoDB                                          | RDBMS    |<br>
|</p>
]]></content:encoded>
    </item>
    <item>
      <title>MongoDB Model Example</title>
      <link>https://vanhung4499.github.io/database/mongodb/model-example.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/model-example.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Model Example</source>
      <description>Ví dụ về mô hình hóa MongoDB Mô hình quan hệ Mô hình nhúng tài liệu một một Mô hình nhúng tài liệu một-một - Mô hình nhúng tài liệu Kết hợp thành: Mô hình nhúng tài liệu một-một...</description>
      <category>db</category>
      <category>mongodb</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Mô hình quan hệ</h2>
<h3>Mô hình nhúng tài liệu một một</h3>
<h4>Mô hình nhúng tài liệu một-một - Mô hình nhúng tài liệu</h4>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// patron document</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Joe Bookreader"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// address document</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   patron_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// reference to patron document</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   street</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"123 Fake Street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   city</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Faketon"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   state</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   zip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"12345"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Kết hợp thành:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Joe Bookreader"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "address"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"123 Fake Street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "city"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Faketon"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "state"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "zip"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"12345"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Mô hình nhúng tài liệu một-một - Mô hình con</h4>
<p>Giả sử, có một bộ sưu tập định nghĩa thông tin về phim:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "title"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"The Arrival of a Train"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "year"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1896</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "runtime"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "released"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"01-25-1896"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "poster"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"http://ia.media-imdb.com/images/M/MV5BMjEyNDk5MDYzOV5BMl5BanBnXkFtZTgwNjIxMTEwMzE@._V1_SX300.jpg"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "plot"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, ..."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "fullplot"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, the line dissolves. The doors of the railway-cars open, and people on the platform help passengers to get off."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "lastupdated"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2015-08-15T10:06:53"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"movie"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "directors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Auguste Lumière"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Louis Lumière"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "imdb"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "rating"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">7.3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "votes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5043</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">12</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "countries"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"France"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "genres"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Documentary"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Short"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "tomatoes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "viewer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "rating"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3.7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "numReviews"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">59</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "lastUpdated"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2020-01-09T00:02:53"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ứng dụng, có một số tình huống chỉ cần hiển thị thông tin tóm tắt về phim, không cần hiển thị thông tin chi tiết như fullplot, poster. Vì vậy, chúng ta có thể xem xét việc chia cấu trúc ban đầu thành hai phần và liên kết chúng thông qua trường id.</p>
<p>Bộ sưu tập movie dùng để hiển thị thông tin tóm tắt</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// movie collection</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "title"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"The Arrival of a Train"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "year"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1896</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "runtime"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "released"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"1896-01-25"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"movie"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "directors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Auguste Lumière"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Louis Lumière"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "countries"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"France"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "genres"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Documentary"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Short"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Bộ sưu tập movie_details dùng để hiển thị thông tin chi tiết</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// movie_details collection</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">156</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "movie_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// tham chiếu đến bộ sưu tập movie</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "poster"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"http://ia.media-imdb.com/images/M/MV5BMjEyNDk5MDYzOV5BMl5BanBnXkFtZTgwNjIxMTEwMzE@._V1_SX300.jpg"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "plot"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, ..."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "fullplot"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, the line dissolves. The doors of the railway-cars open, and people on the platform help passengers to get off."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "lastupdated"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2015-08-15T10:06:53"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "imdb"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "rating"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">7.3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "votes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5043</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">12</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "tomatoes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "viewer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "rating"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3.7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "numReviews"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">59</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "lastUpdated"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2020-01-29T00:02:53"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Mô hình nhúng tài liệu một-nhiều</h3>
<h4>Mô hình nhúng tài liệu một-nhiều - Mô hình nhúng tài liệu</h4>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tài liệu patron</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Joe Bookreader"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tài liệu địa chỉ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   patron_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// tham chiếu đến tài liệu patron</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   street</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"123 Fake Street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   city</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Faketon"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   state</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   zip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"12345"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   patron_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   street</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"1 Some Other Street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   city</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Boston"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   state</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   zip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"12345"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kết hợp thành:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Joe Bookreader"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "addresses"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"123 Fake Street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "city"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Faketon"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "state"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "zip"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"12345"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"1 Some Other Street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "city"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Boston"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "state"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "zip"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"12345"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>Mô hình nhúng tài liệu một-nhiều - Mô hình con</h4>
<p>Xem xét một bộ sưu tập đại diện cho thông tin sản phẩm trên một trang web thương mại điện tử:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Super Widget"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "description"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"This is the most useful item in your toolbox."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "price"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"value"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">NumberDecimal(</span><span style="color:#98C379;--shiki-dark:#98C379">"119.99"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"currency"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"USD"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "reviews"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">786</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"This is indeed an amazing widget."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2019-02-18"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">785</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Trina"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Nice product. Slow shipping."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2019-02-17"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    ...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Hans"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Meh, it's okay."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2017-12-06"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Các đánh giá được sắp xếp theo thứ tự thời gian giảm dần. Khi người dùng truy cập trang sản phẩm, ứng dụng sẽ tải lên mười đánh giá gần đây nhất. Thay vì lưu trữ tất cả các đánh giá cùng với thông tin sản phẩm, chúng ta có thể chia bộ sưu tập thành hai bộ sưu tập, một bộ sưu tập chứa thông tin sản phẩm và mười đánh giá gần đây nhất:</p>
<p>Bộ sưu tập sản phẩm lưu trữ thông tin về mỗi sản phẩm, bao gồm mười đánh giá gần đây nhất:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Super Widget"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "description"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"This is the most useful item in your toolbox."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "price"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"value"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">NumberDecimal(</span><span style="color:#98C379;--shiki-dark:#98C379">"119.99"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"currency"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"USD"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "reviews"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">786</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"This is indeed an amazing widget."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2019-02-18"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">776</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Pablo"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Amazing!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2019-02-16"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Bộ sưu tập chi tiết đánh giá lưu trữ tất cả các đánh giá:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">786</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "product_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"This is indeed an amazing widget."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2019-02-18"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">785</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "product_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Trina"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Nice product. Slow shipping."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2019-02-17"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "product_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Hans"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Meh, it's okay."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2017-12-06"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Mô hình một-nhiều dựa trên tài liệu tham chiếu</h3>
<p>Xem xét ví dụ sau về mối quan hệ giữa nhà xuất bản và sách.</p>
<p>Ví dụ này cho thấy lợi ích của việc sử dụng tài liệu tham chiếu để tránh việc lặp lại thông tin về nhà xuất bản.</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB: The Definitive Guide"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   author</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [ </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina Chodorow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Mike Dirolf"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ],</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   published_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2010-09-24"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   pages</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">216</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   language</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"English"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   publisher</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">              name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"O'Reilly Media"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">              founded</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1980</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">              location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"CA"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"50 Tips and Tricks for MongoDB Developer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   author</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina Chodorow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   published_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2011-05-06"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   pages</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">68</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   language</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"English"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   publisher</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">              name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"O'Reilly Media"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">              founded</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1980</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">              location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"CA"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Để tránh việc lặp lại thông tin về nhà xuất bản, chúng ta có thể sử dụng tài liệu tham chiếu và lưu trữ thông tin về nhà xuất bản riêng biệt khỏi sách. Khi sử dụng tham chiếu, cách mà mối quan hệ tăng lên sẽ quyết định nơi lưu trữ tham chiếu. Nếu số lượng sách của mỗi nhà xuất bản ít và tăng trưởng có giới hạn, đôi khi việc lưu trữ tham chiếu sách trong tài liệu nhà xuất bản có thể hữu ích. Ngược lại, nếu số lượng sách của mỗi nhà xuất bản không bị giới hạn, mô hình dữ liệu này sẽ dẫn đến một mảng không đổi và không ngừng tăng, như ví dụ dưới đây:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"O'Reilly Media"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   founded</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1980</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"CA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   books</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66">123456789</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">234567890</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">123456789</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB: The Definitive Guide"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    author</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [ </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina Chodorow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Mike Dirolf"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ],</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    published_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2010-09-24"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    pages</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">216</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    language</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"English"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">234567890</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"50 Tips and Tricks for MongoDB Developer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   author</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina Chodorow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   published_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2011-05-06"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   pages</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">68</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   language</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"English"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Để tránh mảng không đổi và không ngừng tăng, hãy lưu trữ tham chiếu đến nhà xuất bản trong tài liệu sách:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"oreilly"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"O'Reilly Media"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   founded</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1980</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"CA"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">123456789</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB: The Definitive Guide"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   author</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [ </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina Chodorow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Mike Dirolf"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ],</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   published_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2010-09-24"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   pages</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">216</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   language</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"English"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   publisher_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"oreilly"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">234567890</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"50 Tips and Tricks for MongoDB Developer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   author</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina Chodorow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   published_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2011-05-06"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   pages</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">68</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   language</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"English"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   publisher_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"oreilly"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Mô hình cây có cấu trúc</h2>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200911194846.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h3>Mô hình cây có cấu trúc với nút cha</h3>
<p>Cấu trúc trên có thể được biểu diễn bằng cách sử dụng tham chiếu cha:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.insertMany([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"dbm"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Languages"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
</div><ul>
<li>
<p>Truy vấn nút cha của một nút:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.findOne( { _id: "MongoDB" } ).parent</span></span></code></pre>
</div></li>
<li>
<p>Có thể tạo chỉ mục trên trường cha để tìm kiếm nhanh nút cha:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.createIndex( { parent: 1 } )</span></span></code></pre>
</div></li>
<li>
<p>Có thể tìm thấy các nút con trực tiếp thông qua truy vấn trường cha:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.find( { parent: "Databases" } )</span></span></code></pre>
</div></li>
<li>
<p>Để truy vấn cây con, bạn có thể tham khảo: <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/graphLookup/#pipe._S_graphLookup" target="_blank" rel="noopener noreferrer"><code>$graphLookup</code></a>.</p>
</li>
</ul>
<h3>Mô hình cây có cấu trúc với nút con</h3>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.insertMany([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"children"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [] },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"dbm"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"children"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [] },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"children"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"dbm"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">] },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Languages"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"children"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [] },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"children"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Languages"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">] },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"children"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">] }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
</div><ul>
<li>
<p>Truy vấn các nút con của một nút:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.findOne( { _id: "Databases" } ).children</span></span></code></pre>
</div></li>
<li>
<p>Có thể tạo chỉ mục trên trường children để tìm kiếm nhanh các nút con:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.createIndex( { children: 1 } )</span></span></code></pre>
</div></li>
<li>
<p>Có thể truy vấn các nút thông qua trường children để tìm kiếm nút cha và các nút anh em:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.find( { children: "MongoDB" } )</span></span></code></pre>
</div></li>
</ul>
<h3>Mô hình cây có cấu trúc với tổ tiên</h3>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.insertMany([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"dbm"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Languages"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">], </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [], </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>
<p>Truy vấn tổ tiên của một nút hoặc đường dẫn là nhanh chóng và trực tiếp:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.findOne({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }).ancestors</span></span></code></pre>
</div></li>
<li>
<p>Có thể tạo chỉ mục trên trường ancestors để tìm kiếm nhanh các nút tổ tiên:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.createIndex({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">"ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> })</span></span></code></pre>
</div></li>
<li>
<p>Có thể truy vấn tất cả các con cháu của một nút thông qua trường ancestors:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.find({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">"ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> })</span></span></code></pre>
</div></li>
</ul>
<h3>Mô hình cây có đường dẫn cụ thể</h3>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.insertMany([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"path"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"path"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">",Books,"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"path"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">",Books,Programming,"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Languages"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"path"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">",Books,Programming,"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"path"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">",Books,Programming,Databases,"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"dbm"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"path"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">",Books,Programming,Databases,"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
</div><ul>
<li>
<p>Có thể truy vấn để lấy toàn bộ cây và sắp xếp theo trường đường dẫn:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.find().sort( { path: 1 } )</span></span></code></pre>
</div></li>
<li>
<p>Có thể sử dụng biểu thức chính quy trên trường path để tìm kiếm các con cháu của Programming:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.find( { path: /,Programming,/ } )</span></span></code></pre>
</div></li>
<li>
<p>Có thể truy vấn các con cháu của Books, trong đó Books cũng nằm ở cấp cao nhất của cấu trúc:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.find( { path: /^,Books,/ } )</span></span></code></pre>
</div></li>
<li>
<p>Để tạo chỉ mục trên trường path, hãy sử dụng lệnh sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.createIndex( { path: 1 } )</span></span></code></pre>
</div></li>
</ul>
<h3>Mô hình cây có tập hợp lồng nhau</h3>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200911204252.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">categories</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insertMany</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Books'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">12</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Programming'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Books'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Languages'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Programming'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Databases'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Programming'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'MongoDB'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Databases'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'dbm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Databases'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">8</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">9</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
</div><p>Có thể truy vấn để lấy các con cháu của một nút:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">var</span><span style="color:#E06C75;--shiki-dark:#E06C75"> databaseCategory</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">categories</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">findOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Databases'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> })</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">categories</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">find</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">({</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$gt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">databaseCategory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$lt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">databaseCategory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">})</span></span></code></pre>
</div><h2>Mẫu thiết kế</h2>
<h3>Tài liệu lớn, nhiều cột, nhiều chỉ mục</h3>
<p>Giải pháp là: Chuyển đổi từ cột sang hàng</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200919225901.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h3>Quản lý các phiên bản tài liệu khác nhau</h3>
<p>Định dạng tài liệu MongoDB rất linh hoạt, điều này có thể gây khó khăn trong việc duy trì các phiên bản.</p>
<p>Giải pháp là: Có thể thêm một trường số phiên bản</p>
<ul>
<li>Nhanh chóng lọc bỏ các tài liệu không cần nâng cấp</li>
<li>Khi nâng cấp, xử lý khác nhau cho các tài liệu có phiên bản khác nhau</li>
</ul>
<h3>Thống kê lượt nhấp vào trang web</h3>
<p>Yêu cầu độ chính xác của dữ liệu thống kê không quá quan trọng.</p>
<p>Giải pháp: Sử dụng tính toán gần đúng</p>
<p>Ghi lại sau mỗi 10 lần nhấp:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">"$inc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"views"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } }</span></span></code></pre>
</div><h3>Thống kê chính xác</h3>
<p>Giải pháp: Sử dụng tổng hợp trước</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200911194846.svg" type="image/svg+xml"/>
    </item>
    <item>
      <title>MongoDB Modeling</title>
      <link>https://vanhung4499.github.io/database/mongodb/modeling.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/modeling.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Modeling</source>
      <description>Mô hình hóa MongoDB Mô hình dữ liệu của MongoDB là một mô hình linh hoạt, trong khi cơ sở dữ liệu quan hệ yêu cầu bạn định nghĩa cấu trúc mô hình bảng trước khi chèn dữ liệu. Tu...</description>
      <category>mongodb</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Mô hình dữ liệu của MongoDB là một mô hình linh hoạt, trong khi cơ sở dữ liệu quan hệ yêu cầu bạn định nghĩa cấu trúc mô hình bảng trước khi chèn dữ liệu. Tuy nhiên, trong MongoDB, tài liệu không giới hạn cấu trúc. Điều này giúp dễ dàng ánh xạ giữa đối tượng và tài liệu cơ sở dữ liệu. Ngay cả khi có sự thay đổi lớn giữa các bản ghi dữ liệu, mỗi tài liệu vẫn có thể ánh xạ tốt vào các bản ghi khác nhau. Tuy nhiên, trong thực tế, các tài liệu trong cùng một bộ sưu tập thường có cấu trúc tương tự nhau.</p>
<p>Việc thiết kế mô hình dữ liệu là một quá trình đầy thách thức, đòi hỏi cân nhắc và cân nhắc giữa yêu cầu ứng dụng, hiệu suất của cơ sở dữ liệu và mô hình đọc/ghi dữ liệu. Khi thiết kế mô hình dữ liệu, hãy cân nhắc yêu cầu ứng dụng với mô hình sử dụng dữ liệu (như truy vấn, cập nhật và xử lý) cũng như cấu trúc tự nhiên của dữ liệu.</p>
<h2>Nhập môn mô hình hoá dữ liệu MongoDB</h2>
<blockquote>
<p>Tham khảo: <a href="https://docs.mongodb.com/guides/server/introduction/#what-you-ll-need" target="_blank" rel="noopener noreferrer">https://docs.mongodb.com/guides/server/introduction/#what-you-ll-need</a></p>
</blockquote>
<h3>(1) Xác định tập dữ liệu</h3>
<p>Khi cần tạo lưu trữ dữ liệu, trước hết cần đặt câu hỏi: Dữ liệu nào cần được lưu trữ? Các trường này liên quan như thế nào?</p>
<p>Đây là quá trình thiết kế dữ liệu. Mục tiêu là <strong>trừu tượng hóa yêu cầu kinh doanh thành mô hình logic</strong>.</p>
<p>Giả sử có một tình huống như sau: Chúng ta cần xây dựng cơ sở dữ liệu để theo dõi vật liệu và số lượng, kích thước, nhãn hiệu và xếp hạng của chúng.</p>
<p>Nếu lưu trữ trong RDBMS, có thể có bảng dữ liệu như sau:</p>
<p>| name     | quantity | size        | status | tags                     | rating |<br>
| :</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200910193231.png" type="image/png"/>
    </item>
    <item>
      <title>MongoDB Index</title>
      <link>https://vanhung4499.github.io/database/mongodb/mongo-index.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/mongo-index.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Index</source>
      <description>MongoDB Index Giới thiệu về Index trong MongoDB Tác dụng của Index MongoDB định nghĩa các chỉ mục trên cấp dữ liệu của collection. Chỉ mục thường có thể cải thiện đáng kể hiệu s...</description>
      <category>mongodb</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giới thiệu về Index trong MongoDB</h2>
<h3>Tác dụng của Index</h3>
<p><strong>MongoDB định nghĩa các chỉ mục trên cấp dữ liệu của collection</strong>.</p>
<p>Chỉ mục thường có thể cải thiện đáng kể hiệu suất của truy vấn. Nếu <strong>không có chỉ mục</strong>, MongoDB sẽ phải quét qua từng tài liệu trong collection và chọn ra những bản ghi phù hợp với điều kiện truy vấn.</p>
<p>Việc quét toàn bộ collection như vậy là không hiệu quả, đặc biệt khi xử lý lượng dữ liệu lớn. Truy vấn có thể mất vài chục giây hoặc thậm chí vài phút, điều này là không chấp nhận được về hiệu suất.</p>
<p>Chỉ mục là một cấu trúc dữ liệu đặc biệt, được lưu trữ trong một tập hợp dữ liệu dễ dàng duyệt và đọc. Chỉ mục sắp xếp các giá trị của một cột hoặc nhiều cột trong bảng cơ sở dữ liệu.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200921210621.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h3>Phương thức createIndex()</h3>
<p><strong>MongoDB sử dụng phương thức <code>createIndex()</code> để tạo chỉ mục</strong>.</p>
<p>Cú pháp của <code>createIndex()</code> như sau:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">collection</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">createIndex</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">( &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">key</span><span style="color:#D19A66;--shiki-dark:#D19A66;font-style:italic;--shiki-dark-font-style:italic"> and</span><span style="color:#D19A66;--shiki-dark:#D19A66;font-style:italic;--shiki-dark-font-style:italic"> index</span><span style="color:#D19A66;--shiki-dark:#D19A66;font-style:italic;--shiki-dark-font-style:italic"> type</span><span style="color:#D19A66;--shiki-dark:#D19A66;font-style:italic;--shiki-dark-font-style:italic"> specification</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;, &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">options</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; )</span></span></code></pre>
</div><p>Danh sách các tham số tùy chọn của <code>createIndex()</code> như sau:</p>
<p>| Tham số            | Kiểu dữ liệu | Mô tả                                                                                                                                           |<br>
| :</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200921210621.svg" type="image/svg+xml"/>
    </item>
    <item>
      <title>MongoDB Operation</title>
      <link>https://vanhung4499.github.io/database/mongodb/operation.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/operation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Operation</source>
      <description>Vận hành MongoDB Cài đặt MongoDB Windows (1) Tải xuống và giải nén Truy cập vào trang web chính thức để tải xuống MongoDB và chọn phiên bản phù hợp tại: Download MongoDB Communi...</description>
      <category>mongodb</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Cài đặt MongoDB</h2>
<h3>Windows</h3>
<p>(1) Tải xuống và giải nén</p>
<p>Truy cập vào trang web chính thức để tải xuống MongoDB và chọn phiên bản phù hợp tại: <a href="https://www.mongodb.com/try/download/community" target="_blank" rel="noopener noreferrer">Download MongoDB Community Server | MongoDB</a></p>
<p>(2) Tạo thư mục dữ liệu</p>
<p>MongoDB lưu trữ dữ liệu trong thư mục db. Tuy nhiên, thư mục này không được tự động tạo ra, chúng ta cần tạo nó sau khi cài đặt.</p>
<p>Ví dụ: <code>D:\Tools\Server\mongodb\mongodb-4.4.0\data\db</code></p>
<p>(3) Chạy dịch vụ MongoDB</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mongod</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --dbpath</span><span style="color:#98C379;--shiki-dark:#98C379"> D:</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\T</span><span style="color:#98C379;--shiki-dark:#98C379">ools</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\S</span><span style="color:#98C379;--shiki-dark:#98C379">erver</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\m</span><span style="color:#98C379;--shiki-dark:#98C379">ongodb</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\m</span><span style="color:#98C379;--shiki-dark:#98C379">ongodb-4.4.0</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\d</span><span style="color:#98C379;--shiki-dark:#98C379">ata</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\d</span><span style="color:#98C379;--shiki-dark:#98C379">b</span></span></code></pre>
</div><p>(4) Kết nối với MongoDB từ máy khách</p>
<p>Bạn có thể kết nối với MongoDB bằng cách chạy lệnh <code>mongo.exe</code> trong cửa sổ dòng lệnh.</p>
<p>(5) Cấu hình dịch vụ MongoDB</p>
<h3>Linux</h3>
<p>(1) Cài đặt bằng gói cài đặt</p>
<p>Trước khi cài đặt, chúng ta cần cài đặt các gói phụ thuộc cho các nền tảng Linux.</p>
<p><strong>Red Hat/CentOS:</strong></p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>sudo yum install libcurl openssl</span></span></code></pre>
</div><p><strong>Ubuntu 18.04 LTS ("Bionic")/Debian 10 "Buster":</strong></p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>sudo apt-get install libcurl4 openssl</span></span></code></pre>
</div><p><strong>Ubuntu 16.04 LTS ("Xenial")/Debian 9 "Stretch":</strong></p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>sudo apt-get install libcurl3 openssl</span></span></code></pre>
</div><p>(2) Tạo thư mục dữ liệu</p>
<p>Mặc định, MongoDB sẽ khởi tạo hai thư mục sau khi khởi động:</p>
<ul>
<li>Thư mục lưu trữ dữ liệu: /var/lib/mongodb</li>
<li>Thư mục ghi nhật ký: /var/log/mongodb</li>
</ul>
<p>Trước khi khởi động, chúng ta có thể tạo hai thư mục này và đặt quyền đọc và ghi cho người dùng hiện tại:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sudo</span><span style="color:#98C379;--shiki-dark:#98C379"> mkdir</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span><span style="color:#98C379;--shiki-dark:#98C379"> /var/lib/mongo</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sudo</span><span style="color:#98C379;--shiki-dark:#98C379"> mkdir</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span><span style="color:#98C379;--shiki-dark:#98C379"> /var/log/mongodb</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sudo</span><span style="color:#98C379;--shiki-dark:#98C379"> chown</span><span style="color:#98C379;--shiki-dark:#98C379"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">whoami</span><span style="color:#98C379;--shiki-dark:#98C379">`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> /var/lib/mongo</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     # Đặt quyền</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sudo</span><span style="color:#98C379;--shiki-dark:#98C379"> chown</span><span style="color:#98C379;--shiki-dark:#98C379"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">whoami</span><span style="color:#98C379;--shiki-dark:#98C379">`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> /var/log/mongodb</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">   # Đặt quyền</span></span></code></pre>
</div><p>(3) Chạy dịch vụ MongoDB</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mongod</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --dbpath</span><span style="color:#98C379;--shiki-dark:#98C379"> /var/lib/mongo</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --logpath</span><span style="color:#98C379;--shiki-dark:#98C379"> /var/log/mongodb/mongod.log</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --fork</span></span></code></pre>
</div><p>Mở tệp /var/log/mongodb/mongod.log và kiểm tra thông tin sau, nếu xuất hiện, điều đó có nghĩa là khởi động thành công.</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># tail -10f /var/log/mongodb/mongod.log</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2020-07-09T12:20:17.391+0800</span><span style="color:#98C379;--shiki-dark:#98C379"> I</span><span style="color:#98C379;--shiki-dark:#98C379">  NETWORK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  [listener] Listening on /tmp/mongodb-27017.sock</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2020-07-09T12:20:17.392+0800</span><span style="color:#98C379;--shiki-dark:#98C379"> I</span><span style="color:#98C379;--shiki-dark:#98C379">  NETWORK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  [listener] Listening on 127.0.0.1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2020-07-09T12:20:17.392+0800</span><span style="color:#98C379;--shiki-dark:#98C379"> I</span><span style="color:#98C379;--shiki-dark:#98C379">  NETWORK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  [listener] waiting </span><span style="color:#C678DD;--shiki-dark:#C678DD">for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> connections on port </span><span style="color:#D19A66;--shiki-dark:#D19A66">27017</span></span></code></pre>
</div><p>(4) Kết nối với MongoDB từ máy khách</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">cd</span><span style="color:#98C379;--shiki-dark:#98C379"> /usr/local/mongodb4/bin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./mongo</span></span></code></pre>
</div><h3>Thiết lập tên người dùng và mật khẩu</h3>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; use admin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">chuyển</span><span style="color:#98C379;--shiki-dark:#98C379"> sang</span><span style="color:#98C379;--shiki-dark:#98C379"> db</span><span style="color:#98C379;--shiki-dark:#98C379"> admin</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; db.createUser({"user":"root","pwd":"root","roles":[{"role":"userAdminAnyDatabase","db":"admin"}]})</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Thêm</span><span style="color:#98C379;--shiki-dark:#98C379"> người</span><span style="color:#98C379;--shiki-dark:#98C379"> dùng</span><span style="color:#98C379;--shiki-dark:#98C379"> thành</span><span style="color:#98C379;--shiki-dark:#98C379"> công:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "root",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "roles"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                        "role"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "userAdminAnyDatabase",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                        "db"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "admin"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span></code></pre>
</div><h2>Sao lưu và khôi phục dữ liệu</h2>
<h3>Sao lưu dữ liệu</h3>
<p>Trong MongoDB, chúng ta sử dụng lệnh <code>mongodump</code> để sao lưu dữ liệu MongoDB. Lệnh này cho phép xuất tất cả dữ liệu vào một thư mục được chỉ định.</p>
<p>Cú pháp lệnh <code>mongodump</code> như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>mongodump -h dbhost -d dbname -o dbdirectory</span></span></code></pre>
</div><ul>
<li>-h: Địa chỉ máy chủ MongoDB, ví dụ: 127.0.0.1, cũng có thể chỉ định cổng: 127.0.0.1:27017.</li>
<li>-d: Tên cơ sở dữ liệu cần sao lưu, ví dụ: test.</li>
<li>-o: Đường dẫn lưu trữ dữ liệu sao lưu, ví dụ: c:\data\dump. Trước khi sao lưu, thư mục này cần được tạo trước. Sau khi sao lưu hoàn tất, MongoDB sẽ tự động tạo một thư mục test trong thư mục dump, chứa dữ liệu sao lưu của cơ sở dữ liệu đó.</li>
</ul>
<p>Các tham số tùy chọn cho lệnh <code>mongodump</code> như sau:</p>
<p>| Cú pháp                                              | Mô tả                           | Ví dụ                                             |<br>
| :</p>
]]></content:encoded>
    </item>
    <item>
      <title>MongoDB Overview</title>
      <link>https://vanhung4499.github.io/database/mongodb/overview.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/overview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Overview</source>
      <description>MongoDB MOC MongoDB là một cơ sở dữ liệu phân tán dựa trên tài liệu, được viết bằng ngôn ngữ C++. Nó nhằm mục đích cung cấp một giải pháp lưu trữ dữ liệu có hiệu suất cao và có ...</description>
      <category>mongodb</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>MongoDB là một cơ sở dữ liệu phân tán dựa trên tài liệu, được viết bằng ngôn ngữ C++. Nó nhằm mục đích cung cấp một giải pháp lưu trữ dữ liệu có hiệu suất cao và có khả năng mở rộng cho các ứng dụng web.</p>
<p>MongoDB là một sản phẩm nằm giữa cơ sở dữ liệu quan hệ và cơ sở dữ liệu phi quan hệ. Nó là cơ sở dữ liệu phi quan hệ có tính năng phong phú nhất và giống nhất với cơ sở dữ liệu quan hệ. Nó hỗ trợ cấu trúc dữ liệu rất linh hoạt, sử dụng định dạng bson tương tự như json, do đó có thể lưu trữ các loại dữ liệu phức tạp.</p>
<p>Điểm đặc biệt lớn nhất của MongoDB là ngôn ngữ truy vấn mạnh mẽ mà nó hỗ trợ. Cú pháp của nó tương tự như ngôn ngữ truy vấn hướng đối tượng, gần như có thể thực hiện hầu hết các chức năng truy vấn của cơ sở dữ liệu quan hệ trên một bảng duy nhất, và còn hỗ trợ tạo chỉ mục cho dữ liệu.</p>
</blockquote>
<h2>📖 Contents</h2>
]]></content:encoded>
    </item>
    <item>
      <title>MongoDB Replication</title>
      <link>https://vanhung4499.github.io/database/mongodb/replication.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/replication.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Replication</source>
      <description>Sao lưu trong MongoDB Sao lưu có thể cung cấp tính sẵn có dự phòng và tăng cường khả năng sẵn có của dữ liệu. Sử dụng nhiều bản sao dữ liệu trên các máy chủ cơ sở dữ liệu khác n...</description>
      <category>db</category>
      <category>mongodb</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Sao lưu có thể <strong>cung cấp tính sẵn có dự phòng và tăng cường khả năng sẵn có của dữ liệu</strong>. Sử dụng nhiều bản sao dữ liệu trên các máy chủ cơ sở dữ liệu khác nhau có thể cung cấp khả năng chống lỗi trong trường hợp một máy chủ cơ sở dữ liệu bị sự cố và dữ liệu bị mất.</p>
<p>Trong một số trường hợp, sao lưu cũng có thể <strong>cung cấp khả năng xử lý đọc lớn hơn</strong>. Vì khách hàng có thể gửi các hoạt động đọc đến các máy chủ khác nhau. Việc duy trì các bản sao dữ liệu trên các trung tâm dữ liệu khác nhau cũng có thể cải thiện tính cục bộ của dữ liệu và khả năng sẵn có của ứng dụng phân tán. Bạn cũng có thể duy trì các bản sao khác nhau cho mục đích đặc biệt như phục hồi sau thảm họa, báo cáo hoặc sao lưu.</p>
<h2>Bản sao dữ liệu MongoDB</h2>
<p>Bản sao dữ liệu trong MongoDB là một nhóm quy trình mongod duy trì cùng một tập hợp dữ liệu. Một bản sao dữ liệu bao gồm nhiều thành viên dữ liệu và một thành viên trọng tâm (tùy chọn). Trong các thành viên dữ liệu, chỉ có một thành viên được coi là chính và các thành viên khác được coi là phụ.</p>
<p><strong>Thành viên chính chịu trách nhiệm nhận tất cả các hoạt động ghi</strong>. Một bản sao dữ liệu chỉ có thể có một thành viên chính và có thể xác nhận rằng các hoạt động ghi trên các nút trong cụm bằng cách sử dụng <a href="https://docs.mongodb.com/manual/reference/write-concern/#writeconcern.%22majority%22" target="_blank" rel="noopener noreferrer"><code>{ w: "majority" }</code></a>.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920165054.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p><strong>Các thành viên phụ sao chép nhật ký hoạt động của thành viên chính và áp dụng các hoạt động này vào tập dữ liệu của mình</strong> để đồng bộ dữ liệu với thành viên chính. Nếu thành viên chính không khả dụng, một thành viên phụ đủ điều kiện sẽ được bầu làm thành viên chính mới.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920165055.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Trong một số trường hợp (ví dụ: chỉ có một thành viên chính và một thành viên phụ do hạn chế về chi phí), bạn có thể chọn thêm một quy trình mongod làm thành viên trọng tâm trong bản sao dữ liệu. Thành viên trọng tâm tham gia vào quá trình bầu cử nhưng không lưu trữ dữ liệu (không cung cấp dự phòng dữ liệu).</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920165053.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Thành viên trọng tâm luôn là thành viên trọng tâm. Trong quá trình bầu cử, thành viên chính có thể bị giáng cấp thành thành viên phụ và thành viên phụ có thể được thăng cấp thành thành viên chính.</p>
<h2>Sao lưu không đồng bộ</h2>
<h3>Hoạt động chậm</h3>
<p>Các thành viên phụ sao chép nhật ký hoạt động của thành viên chính và áp dụng các hoạt động này vào tập dữ liệu của mình. Bằng cách đồng bộ hóa dữ liệu từ thành viên chính, ngay cả khi một hoặc nhiều thành viên gặp sự cố, bản sao dữ liệu (cụm MongoDB) vẫn có thể tiếp tục hoạt động.</p>
<p>Từ phiên bản 4.2 trở đi, các thành viên phụ trong bản sao dữ liệu ghi lại các hoạt động chậm (thời gian hoạt động dài hơn ngưỡng được đặt). Những hoạt động chậm này được ghi lại trong <a href="https://docs.mongodb.com/manual/reference/program/mongod/#cmdoption-mongod-logpath" target="_blank" rel="noopener noreferrer">nhật ký chẩn đoán</a> của <a href="https://docs.mongodb.com/manual/reference/log-messages/#REPL" target="_blank" rel="noopener noreferrer">REPL</a> và được ghi nhận trong thông báo nhật ký văn bản với văn bản <code>op: &lt;oplog entry&gt;</code> đã mất <code>&lt;num&gt;ms</code>. Những mục nhật ký hoạt động chậm này chỉ phụ thuộc vào ngưỡng hoạt động chậm và không phụ thuộc vào cấp độ nhật ký (cấp độ hệ thống hoặc cấp độ thành phần), cấu hình hoặc tỷ lệ mẫu hoạt động chậm. Các bộ thu thập không ghi lại các mục nhật ký hoạt động chậm.</p>
<h3>Độ trễ và kiểm soát luồng</h3>
<p>Độ trễ sao lưu (Replication lag) là thời gian mất để sao chép các hoạt động ghi từ thành viên chính sang thành viên phụ. Thời gian trễ ngắn là chấp nhận được, nhưng với độ trễ sao lưu tăng lên, có thể gặp vấn đề nghiêm trọng, ví dụ như áp lực bộ nhớ đệm trên thành viên chính.</p>
<p>Từ MongoDB 4.2 trở đi, quản trị viên có thể giới hạn tốc độ ghi của thành viên chính để giữ cho hầu hết thời gian trễ dưới ngưỡng tối đa được cấu hình <a href="https://docs.mongodb.com/manual/reference/parameters/#param.flowControlTargetLagSeconds" target="_blank" rel="noopener noreferrer"><code>flowControlTargetLagSeconds</code></a>.</p>
<p>Mặc định, kiểm soát luồng được bật.</p>
<p>Khi kiểm soát luồng được kích hoạt, khi thời gian trễ tiến đến <a href="https://docs.mongodb.com/manual/reference/parameters/#param.flowControlTargetLagSeconds" target="_blank" rel="noopener noreferrer"><code>flowControlTargetLagSeconds</code></a>, các hoạt động ghi trên thành viên chính phải nhận được mã thông báo trước khi khóa và thực hiện hoạt động ghi. Bằng cách giới hạn số lượng mã thông báo được phát ra mỗi giây, cơ chế kiểm soát luồng cố gắng giữ cho thời gian trễ dưới mục tiêu.</p>
<h2>Chuyển đổi lỗi</h2>
<p>Khi thời gian giao tiếp giữa thành viên chính và các thành viên khác trong cụm vượt quá <a href="https://docs.mongodb.com/manual/reference/replica-configuration/#rsconf.settings.electionTimeoutMillis" target="_blank" rel="noopener noreferrer"><code>electionTimeoutMillis</code></a> được cấu hình (mặc định là 10 giây), các thành viên phù hợp sẽ yêu cầu một cuộc bầu cử và đề cử chính mình làm thành viên chính mới. Cụm cố gắng hoàn thành cuộc bầu cử và khôi phục hoạt động bình thường.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920175429.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Trước khi hoàn thành cuộc bầu cử, bản sao dữ liệu không thể xử lý các hoạt động ghi. Nếu bản sao dữ liệu được cấu hình để chạy khi thành viên chính không khả dụng, nó có thể tiếp tục cung cấp truy vấn đọc.</p>
<p>Nếu cấu hình bản sao dữ liệu mặc định là chạy khi thành viên chính không khả dụng, nó sẽ tiếp tục đáp ứng các truy vấn đọc trong khi chờ cuộc bầu cử và sau đó tiếp tục ghi lại hoạt động ghi từ thành viên chính mới.</p>
<p>Ứng dụng kết nối nên bao gồm xử lý lỗi tự động và tái thử lại cho việc chuyển đổi lỗi tự động và cuộc bầu cử tiếp theo. Từ MongoDB 3.6 trở đi, các trình điều khiển MongoDB có thể phát hiện sự mất kết nối với thành viên chính và có thể tự động thử lại một số hoạt động ghi.</p>
<p>Từ MongoDB 4.4 trở đi, MongoDB cung cấp đọc gương: nó sẽ nói trước dữ liệu gần đây của thành viên có thể bầu cử (thành viên ưu tiên lớn hơn 0). Việc nói trước bộ nhớ đệm của thành viên có thể bầu cử có thể giúp khôi phục nhanh hơn sau cuộc bầu cử.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920165054.svg" type="image/svg+xml"/>
    </item>
    <item>
      <title>MongoDB Sharding</title>
      <link>https://vanhung4499.github.io/database/mongodb/sharding.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/sharding.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Sharding</source>
      <description>MongoDB Phân đoạn Giới thiệu về cụm phân đoạn Khi MongoDB cần lưu trữ dữ liệu lớn, một nút đơn không đủ để lưu trữ toàn bộ dữ liệu và có thể không cung cấp được hiệu suất đáng h...</description>
      <category>db</category>
      <category>mongodb</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giới thiệu về cụm phân đoạn</h2>
<p>Khi MongoDB cần lưu trữ dữ liệu lớn, một nút đơn không đủ để lưu trữ toàn bộ dữ liệu và có thể không cung cấp được hiệu suất đáng hài lòng. Do đó, chúng ta có thể sử dụng cơ chế phân đoạn của MongoDB để hỗ trợ mở rộng theo chiều ngang.</p>
<h3>Đặc điểm của cụm phân đoạn</h3>
<p>Hoàn toàn trong suốt với ứng dụng</p>
<p>Cân bằng dữ liệu tự động</p>
<p>Mở rộng động</p>
<p>Cung cấp ba phương pháp phân đoạn khác nhau</p>
<h3>Các thành phần của cụm phân đoạn</h3>
<p>Cụm phân đoạn MongoDB bao gồm các thành phần sau:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/core/sharded-cluster-shards/" target="_blank" rel="noopener noreferrer">shard</a>: Mỗi phân đoạn chứa một phần con của dữ liệu phân đoạn. Mỗi phân đoạn có thể triển khai như một bộ nhân bản.</li>
<li><a href="https://docs.mongodb.com/manual/core/sharded-cluster-query-router/" target="_blank" rel="noopener noreferrer">mongos</a>: mongos hoạt động như một bộ định tuyến truy vấn, cung cấp giao diện giữa ứng dụng khách hàng và cụm phân đoạn. Từ phiên bản MongoDB 4.4 trở đi, mongos có thể hỗ trợ <a href="https://docs.mongodb.com/manual/core/sharded-cluster-query-router/#mongos-hedged-reads" target="_blank" rel="noopener noreferrer">hedged reads</a> để giảm thiểu độ trễ.</li>
<li><a href="https://docs.mongodb.com/manual/core/sharded-cluster-config-servers/" target="_blank" rel="noopener noreferrer">config servers</a>: Cung cấp lưu trữ dữ liệu siêu dữ liệu và ánh xạ phân phối dữ liệu.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724020005.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h3>Phân phối của cụm phân đoạn</h3>
<p><strong>Cụm sao chép MongoDB được phân phối theo bộ sưu tập</strong>, phân phối dữ liệu trên các phân đoạn trong cụm. Tối đa cho phép 1024 phân đoạn.</p>
<p>Dữ liệu giữa các phân đoạn trong cụm sao chép MongoDB không trùng lặp, chỉ khi tất cả các phân đoạn đều hoạt động bình thường, cụm mới hoạt động đầy đủ.</p>
<p>Cơ sở dữ liệu MongoDB có thể chứa cả bộ sưu tập đã phân đoạn và chưa phân đoạn. Các bộ sưu tập đã phân đoạn sẽ được phân phối trên các nút trong cụm. Trong khi đó, các bộ sưu tập chưa phân đoạn được lưu trữ trên nút chính. Mỗi cơ sở dữ liệu có nút chính riêng của nó.</p>
<p>Bộ sưu tập đã phân đoạn và chưa phân đoạn:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920212159.svg" alt="20200920212159.svg" tabindex="0" loading="lazy"><figcaption>20200920212159.svg</figcaption></figure>
<h3>Nút định tuyến mongos</h3>
<p>Để kết nối với <a href="https://docs.mongodb.com/manual/reference/glossary/#term-sharded-cluster" target="_blank" rel="noopener noreferrer">cụm phân đoạn MongoDB</a>, bạn phải kết nối với bộ định tuyến <a href="https://docs.mongodb.com/manual/reference/glossary/#term-mongos" target="_blank" rel="noopener noreferrer"><code>mongos</code></a>. Điều này bao gồm cả các bộ sưu tập đã phân đoạn và chưa phân đoạn. Khách hàng không nên kết nối trực tiếp với các nút phân đoạn để thực hiện các hoạt động đọc và ghi.</p>
<p>Cách kết nối với <a href="https://docs.mongodb.com/manual/reference/program/mongos/#bin.mongos" target="_blank" rel="noopener noreferrer"><code>mongos</code></a> tương tự như kết nối với <a href="https://docs.mongodb.com/manual/reference/program/mongod/#bin.mongod" target="_blank" rel="noopener noreferrer"><code>mongod</code></a>, ví dụ như thông qua <a href="https://docs.mongodb.com/manual/reference/program/mongo/#bin.mongo" target="_blank" rel="noopener noreferrer"><code>mongo</code></a> shell hoặc <a href="https://docs.mongodb.com/drivers/?jump=docs" target="_blank" rel="noopener noreferrer">MongoDB driver</a>.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920212157.svg" alt="20200920212157.svg" tabindex="0" loading="lazy"><figcaption>20200920212157.svg</figcaption></figure>
<p>Vai trò của nút định tuyến:</p>
<ul>
<li>Cung cấp điểm vào duy nhất cho cụm</li>
<li>Chuyển tiếp yêu cầu từ ứng dụng</li>
<li>Chọn nút dữ liệu phù hợp để đọc và ghi</li>
<li>Kết hợp kết quả từ nhiều nút dữ liệu</li>
</ul>
<p>Thường thì, nên có ít nhất 2 nút định tuyến mongos.</p>
<h1>Khóa phân đoạn</h1>
<p>MongoDB sử dụng khóa phân đoạn để phân phối các tài liệu trong bộ sưu tập giữa các phân đoạn. Khóa phân đoạn được tạo thành từ một hoặc nhiều trường trong tài liệu.</p>
<ul>
<li>Từ phiên bản MongoDB 4.4 trở đi, các tài liệu trong bộ sưu tập phân đoạn có thể thiếu trường khóa phân đoạn. Khi phân phối tài liệu qua các phân đoạn, việc thiếu trường khóa phân đoạn sẽ được coi như có giá trị rỗng, nhưng không được sử dụng trong các truy vấn định tuyến.</li>
<li>Trong MongoDB 4.2 và các phiên bản cũ hơn, trường khóa phân đoạn phải tồn tại trong mỗi tài liệu trong bộ sưu tập phân đoạn.</li>
</ul>
<p>Lựa chọn khóa phân đoạn khi phân đoạn bộ sưu tập.</p>
<ul>
<li>Từ phiên bản MongoDB 4.4 trở đi, bạn có thể tối ưu hóa khóa phân đoạn của bộ sưu tập bằng cách thêm một hoặc nhiều trường hậu tố vào khóa hiện có.</li>
<li>Trong MongoDB 4.2 và các phiên bản cũ hơn, không thể thay đổi lựa chọn khóa phân đoạn sau khi đã phân đoạn.</li>
</ul>
<p>Giá trị khóa phân đoạn của tài liệu xác định phân phối của nó trên các phân đoạn</p>
<ul>
<li>Từ phiên bản MongoDB 4.2 trở đi, bạn có thể cập nhật giá trị khóa phân đoạn của tài liệu trừ khi trường khóa phân đoạn của bạn là trường không thể thay đổi như _id.</li>
<li>Trong MongoDB 4.0 và các phiên bản cũ hơn, giá trị trường khóa phân đoạn của tài liệu là không thể thay đổi.</li>
</ul>
<p>Chỉ mục khóa phân đoạn: Để phân đoạn một bộ sưu tập đã được điền, bộ sưu tập đó phải có một chỉ mục bắt đầu bằng khóa phân đoạn. Khi phân đoạn một bộ sưu tập trống, MongoDB sẽ tạo một chỉ mục hỗ trợ cho khóa phân đoạn đã chỉ định nếu bộ sưu tập đó chưa có chỉ mục phù hợp.</p>
<p>Chiến lược phân đoạn: Lựa chọn khóa phân đoạn ảnh hưởng đến hiệu suất, hiệu quả và khả năng mở rộng của cụm phân đoạn. Lựa chọn khóa phân đoạn và chỉ mục phụ trợ cũng ảnh hưởng đến chiến lược phân đoạn mà cụm có thể sử dụng.</p>
<p>MongoDB phân đoạn dữ liệu. Mỗi phân đoạn có giới hạn dựa trên khóa phân đoạn.</p>
<p>Để đảm bảo phân phối đồng đều của các phân đoạn trên toàn cụm, trình cân bằng chạy trong nền và di chuyển các phân đoạn trên các phân đoạn.</p>
<h2>Chiến lược phân đoạn</h2>
<p>MongoDB hỗ trợ hai chiến lược phân đoạn: Phân đoạn theo băm và phân đoạn theo phạm vi.</p>
<h3>Phân đoạn theo băm</h3>
<p>Chiến lược phân đoạn theo băm tính toán giá trị băm của trường khóa phân đoạn; sau đó, mỗi <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener noreferrer">chunk</a> được gán một phạm vi dựa trên giá trị khóa phân đoạn.</p>
<blockquote>
<p>Lưu ý: Khi giải quyết truy vấn sử dụng chỉ mục băm, MongoDB tự động tính toán giá trị băm, không cần ứng dụng tính toán giá trị băm.</p>
</blockquote>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920213343.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Mặc dù các phạm vi khóa phân đoạn có thể "gần nhau", nhưng giá trị băm của chúng không thể có khả năng nằm trên cùng một <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener noreferrer">chunk</a>. Phân phối dữ liệu dựa trên băm giúp phân phối dữ liệu đồng đều hơn, đặc biệt là trong các tập dữ liệu mà khóa phân đoạn thay đổi một cách đơn điệu.</p>
<p>Tuy nhiên, phân đoạn theo băm có nghĩa là các truy vấn phạm vi trên khóa phân đoạn không thể được hướng đến một phân đoạn duy nhất, dẫn đến nhiều hoạt động truyền phát trong phạm vi cụm.</p>
<h3>Phân đoạn theo phạm vi</h3>
<p>Phân đoạn theo phạm vi chia dữ liệu thành nhiều phạm vi dựa trên giá trị khóa phân đoạn. Sau đó, mỗi <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener noreferrer">chunk</a> được gán một phạm vi dựa trên giá trị khóa phân đoạn.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920213345.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Các giá trị khóa phân đoạn tương đối gần nhau có khả năng nằm trên cùng một <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener noreferrer">chunk</a>. Hiệu suất của phân đoạn theo phạm vi phụ thuộc vào lựa chọn khóa phân đoạn. Lựa chọn khóa phân đoạn không tốt có thể dẫn đến phân phối dữ liệu không đồng đều, gây suy giảm một số lợi ích của phân đoạn hoặc gây ra hạn chế hiệu suất.</p>
<h2>Vùng trong cụm phân đoạn</h2>
<p>Vùng có thể cải thiện tính cục bộ của dữ liệu trong cụm phân đoạn chạy trên nhiều trung tâm dữ liệu.</p>
<p>Trong cụm phân đoạn, có thể tạo ra các <a href="https://docs.mongodb.com/manual/reference/glossary/#term-zone" target="_blank" rel="noopener noreferrer">vùng</a> dữ liệu dựa trên khóa phân đoạn. Mỗi vùng có thể được liên kết với một hoặc nhiều phân đoạn trong cụm. Một phân đoạn có thể được liên kết với bất kỳ số lượng vùng nào. Trong cụm cân bằng, MongoDB chỉ di chuyển các <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener noreferrer">chunk</a> mà vùng bao phủ tới phân đoạn liên quan đến vùng đó.</p>
<p>Mỗi vùng bao phủ một hoặc nhiều phạm vi giá trị khóa phân đoạn. Mỗi phạm vi bao phủ luôn bao gồm cả giới hạn trên và giới hạn dưới của nó.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920214854.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Khi xác định các phạm vi mới để bao phủ vùng, phải sử dụng các trường có trong khóa phân đoạn. Nếu sử dụng khóa phân đoạn kết hợp, phạm vi phải bao gồm tiền tố của khóa phân đoạn.</p>
<p>Khi lựa chọn khóa phân đoạn, nên xem xét các vùng có thể sử dụng trong tương lai.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724020005.png" type="image/png"/>
    </item>
    <item>
      <title>MongoDB Transaction</title>
      <link>https://vanhung4499.github.io/database/mongodb/transaction.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/transaction.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Transaction</source>
      <description>Giao dịch trong MongoDB writeConcern có thể xác định số lượng node cần xác nhận để ghi thành công. Mặc định: Không có thiết lập nào cho replica set nhiều node, do đó có thể mất ...</description>
      <category>mongodb</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>writeConcern có thể xác định số lượng node cần xác nhận để ghi thành công.</p>
<ul>
<li>Mặc định: Không có thiết lập nào cho replica set nhiều node, do đó có thể mất dữ liệu.</li>
<li><code>w: "majority"</code>: Được coi là ghi thành công nếu hầu hết các node xác nhận.</li>
<li><code>w: "all"</code>: Chỉ được coi là ghi thành công nếu tất cả các node xác nhận.</li>
</ul>
<p>journal xác định cách xem ghi thành công. Có các giá trị sau:</p>
<ul>
<li><code>true</code>: Chỉ được coi là ghi thành công khi hoạt động ghi được lưu vào tập tin nhật ký (journal).</li>
<li><code>false</code>: Chỉ được coi là ghi thành công khi hoạt động ghi được lưu trong bộ nhớ.</li>
</ul>
<p>【Ví dụ】Sử dụng tham số writeConcern trong một cụm</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, { </span><span style="color:#E06C75;--shiki-dark:#E06C75">writeConcern</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'majoriy'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } })</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, { </span><span style="color:#E06C75;--shiki-dark:#E06C75">writeConcern</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'4'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } })</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, { </span><span style="color:#E06C75;--shiki-dark:#E06C75">writeConcern</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'all'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } })</span></span></code></pre>
</div><p>【Ví dụ】Cấu hình node trễ để mô phỏng độ trễ mạng</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>conf=rs.conf()</span></span>
<span class="line"><span>conf.memebers[2].slaveDelay=5</span></span>
<span class="line"><span>conf.memebers[2].priority=0</span></span>
<span class="line"><span>rs.reconfig(conf)</span></span></code></pre>
</div>]]></content:encoded>
    </item>
    <item>
      <title>MySQL</title>
      <link>https://vanhung4499.github.io/database/mysql/</link>
      <guid>https://vanhung4499.github.io/database/mysql/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>MySQL Architecture</title>
      <link>https://vanhung4499.github.io/database/mysql/architecture.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/architecture.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Architecture</source>
      <description>MySQL Architecture Kiến trúc cơ bản Nói chung, MySQL có thể được chia thành hai phần: lớp máy chủ và lớp lưu trữ. Lớp máy chủ bao gồm các thành phần như kết nối, bộ nhớ cache tr...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Kiến trúc cơ bản</h2>
<p>Nói chung, MySQL có thể được chia thành hai phần: lớp máy chủ và lớp lưu trữ.</p>
<p><strong>Lớp máy chủ</strong> bao gồm các thành phần như kết nối, bộ nhớ cache truy vấn, trình phân tích, trình tối ưu hóa, trình thực thi, vv. Nó bao gồm hầu hết các chức năng và dịch vụ cốt lõi của MySQL, cũng như tất cả các hàm tích hợp (như hàm ngày tháng, thời gian, toán học và mã hóa), tất cả các chức năng chung cho tất cả các lưu trữ (như thủ tục lưu trữ, trigger, view, vv).</p>
<p><strong>Lớp lưu trữ</strong> chịu trách nhiệm lưu trữ và truy xuất dữ liệu. Kiến trúc của nó là một kiến trúc cắm, hỗ trợ nhiều lưu trữ như InnoDB, MyISAM, Memory, vv. Hiện nay, lưu trữ phổ biến nhất là InnoDB, nó đã trở thành lưu trữ mặc định từ phiên bản MySQL 5.5.5 trở đi.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/mysql-workflow.drawio.png" alt="mysql-workflow" tabindex="0" loading="lazy"><figcaption>mysql-workflow</figcaption></figure>
<h2>Quá trình truy vấn</h2>
<p>Câu lệnh SQL được thực hiện như thế nào trong MySQL?</p>
<p>Quá trình thực hiện truy vấn MySQL tổng cộng có 6 bước, tương ứng với 6 thành phần:</p>
<ol>
<li>Kết nối: Kết nối giữa máy khách và máy chủ MySQL; Kết nối chịu trách nhiệm thiết lập kết nối với máy khách, xác định quyền truy cập và duy trì quản lý kết nối.</li>
<li>MySQL kiểm tra bộ nhớ cache truy vấn trước tiên. Nếu truy vấn được lưu trong bộ nhớ cache, kết quả sẽ được trả về ngay lập tức. Nếu không, chuyển sang bước tiếp theo.</li>
<li>Máy chủ MySQL thực hiện phân tích SQL: phân tích cú pháp, phân tích từ vựng.</li>
<li>Máy chủ MySQL sử dụng trình tối ưu hóa để tạo ra kế hoạch thực thi tương ứng.</li>
<li>Máy chủ MySQL gọi API lưu trữ để thực hiện truy vấn dựa trên kế hoạch thực hiện.</li>
<li>Máy chủ MySQL trả kết quả cho máy khách, đồng thời lưu kết quả truy vấn vào bộ nhớ cache.</li>
</ol>
<h3>(1) Kết nối</h3>
<p>Bước đầu tiên khi sử dụng MySQL là kết nối vào cơ sở dữ liệu. <strong>Kết nối chịu trách nhiệm thiết lập kết nối với máy chủ MySQL, xác định quyền truy cập và duy trì quản lý kết nối</strong>.</p>
<p>Giao tiếp giữa máy khách và máy chủ MySQL là một chế độ bán song công: vào bất kỳ thời điểm nào, máy chủ có thể gửi dữ liệu cho máy khách hoặc máy khách có thể gửi dữ liệu cho máy chủ. Máy khách gửi một gói dữ liệu duy nhất chứa yêu cầu truy vấn cho máy chủ, vì vậy nếu câu lệnh truy vấn dài, bạn cần thiết lập tham số <code>max_allowed_packet</code>. Tuy nhiên, nếu câu lệnh truy vấn quá lớn, máy chủ sẽ từ chối nhận thêm dữ liệu và ném ra một ngoại lệ.</p>
<p>Lệnh kết nối MySQL của khách hàng: <code>mysql -h&lt;host&gt; -P&lt;port&gt; -u&lt;username&gt; -p&lt;password&gt;</code>. Nếu không chỉ định mật khẩu, bạn sẽ được yêu cầu nhập mật khẩu trước khi truy cập.</p>
<p>Sau khi thiết lập kết nối, nếu không có hoạt động tiếp theo, kết nối sẽ ở trạng thái không hoạt động và bạn có thể thấy nó trong lệnh <code>show processlist</code>. Nếu khách hàng không hoạt động trong thời gian quá lâu, kết nối sẽ tự động bị đóng. Thời gian duy trì kết nối của khách hàng được điều chỉnh bằng tham số <code>wait_timeout</code>, giá trị mặc định là 8 giờ. Nếu kết nối bị đóng và khách hàng gửi yêu cầu truy vấn, bạn sẽ nhận được thông báo lỗi "Lost connection to MySQL server during query". Trong trường hợp này, bạn cần phải kết nối lại và thực hiện yêu cầu truy vấn.</p>
<p>Quá trình thiết lập kết nối thường là phức tạp, do đó, khuyến nghị giảm thiểu số lần thiết lập kết nối trong quá trình sử dụng và sử dụng kết nối dài hơn. Để tăng cường việc tái sử dụng kết nối cơ sở dữ liệu trong chương trình, thường sử dụng bể kết nối cơ sở dữ liệu để quản lý và duy trì.</p>
<p>Tuy nhiên, nếu chỉ sử dụng kết nối dài hơn, bạn có thể nhận thấy rằng MySQL sử dụng bộ nhớ nhanh hơn. Điều này là do MySQL sử dụng bộ nhớ tạm thời trong quá trình thực thi và giữ tài nguyên kết nối. Những tài nguyên này chỉ được giải phóng khi kết nối bị đóng. Do đó, nếu tích lũy kết nối dài hơn, có thể dẫn đến sự sử dụng bộ nhớ quá lớn và bị hệ thống giết (OOM). Khi xảy ra hiện tượng này, MySQL sẽ khởi động lại một cách bất thường.</p>
<p>Làm thế nào để giải quyết vấn đề này? Bạn có thể xem xét hai giải pháp sau đây.</p>
<ul>
<li><strong>Đóng kết nối dài hơn định kỳ</strong>: Sử dụng một khoảng thời gian hoặc kiểm tra trong chương trình, sau khi thực hiện một hoạt động chiếm nhiều bộ nhớ, đóng kết nối và sau đó thực hiện kết nối lại khi cần truy vấn.</li>
<li>Nếu bạn đang sử dụng phiên bản MySQL 5.7 trở lên, bạn có thể sử dụng <code>mysql_reset_connection</code> để khởi tạo lại tài nguyên kết nối sau mỗi hoạt động lớn. Quá trình này không cần phải kết nối lại và xác thực quyền, nhưng sẽ khôi phục kết nối về trạng thái ban đầu khi tạo ra.</li>
</ul>
<h3>(2) Bộ nhớ cache truy vấn</h3>
<blockquote>
<p><strong>Không khuyến nghị sử dụng bộ nhớ cache truy vấn, vì thường có nhiều hại hơn lợi ích</strong>.</p>
</blockquote>
<p>Trước khi phân tích một câu lệnh truy vấn, nếu bộ nhớ cache truy vấn được bật, MySQL sẽ kiểm tra xem câu lệnh truy vấn này có trúng kết quả trong bộ nhớ cache không. Nếu truy vấn hiện tại trùng khớp với dữ liệu trong bộ nhớ cache, sau khi kiểm tra quyền của người dùng, kết quả sẽ được trả về trực tiếp từ bộ nhớ cache. Trong trường hợp này, truy vấn không được phân tích, không tạo kế hoạch thực hiện, và không thực hiện.</p>
<p>MySQL lưu trữ bộ nhớ cache trong một bảng tham chiếu (đừng hiểu nhầm là <code>table</code>, có thể coi nó là một cấu trúc dữ liệu giống <code>HashMap</code>), được chỉ mục bằng một giá trị băm được tính toán từ các yếu tố có thể ảnh hưởng đến kết quả truy vấn, bao gồm truy vấn hiện tại, cơ sở dữ liệu hiện tại và số phiên bản giao thức khách hàng. Vì vậy, bất kỳ sự khác biệt nào trong các ký tự (ví dụ: khoảng trắng, chú thích) cũng sẽ khiến bộ nhớ cache không trùng khớp.</p>
<p><strong>Nếu truy vấn chứa bất kỳ hàm người dùng, hàm lưu trữ, biến người dùng, bảng tạm thời hoặc bảng hệ thống trong cơ sở dữ liệu mysql, kết quả truy vấn sẽ không được lưu vào bộ nhớ cache</strong>. Ví dụ, các hàm <code>NOW()</code> hoặc <code>CURRENT_DATE()</code> sẽ trả về kết quả khác nhau dựa trên thời gian truy vấn, và các truy vấn chứa <code>CURRENT_USER</code> hoặc <code>CONNECTION_ID()</code> sẽ trả về kết quả khác nhau dựa trên người dùng, việc lưu kết quả truy vấn như vậy không có ý nghĩa.</p>
<p><strong>Không khuyến nghị sử dụng bộ nhớ cache truy vấn, vì thường có nhiều hại hơn lợi ích</strong>. Tỷ lệ trúng kết quả của bộ nhớ cache truy vấn thường rất thấp, chỉ cần có bất kỳ cập nhật nào trên một bảng, tất cả các bộ nhớ cache truy vấn của bảng đó sẽ bị xóa. Do đó, khả năng trúng kết quả của bộ nhớ cache truy vấn trong cơ sở dữ liệu có áp lực cập nhật lớn sẽ rất thấp. Trừ khi bạn có một bảng tĩnh và chỉ cần cập nhật một lần trong thời gian dài. Ví dụ, một bảng cấu hình hệ thống, trong trường hợp này, truy vấn trên bảng này sẽ phù hợp với việc sử dụng bộ nhớ cache truy vấn.</p>
<p>May mắn thay, MySQL cũng cung cấp cách "sử dụng theo yêu cầu". Bạn có thể đặt tham số <code>query_cache_type</code> thành <code>DEMAND</code>, điều này sẽ không sử dụng bộ nhớ cache truy vấn cho các câu lệnh SQL mặc định. Đối với các câu lệnh SQL mà bạn muốn sử dụng bộ nhớ cache truy vấn, bạn có thể sử dụng <code>SQL_CACHE</code> để chỉ định, giống như câu lệnh dưới đây:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> SQL_CACHE * </span><span style="color:#C678DD;--shiki-dark:#C678DD">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> T </span><span style="color:#C678DD;--shiki-dark:#C678DD">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Phiên bản MySQL 8.0 đã loại bỏ hoàn toàn chức năng bộ nhớ cache truy vấn.</p>
</blockquote>
<h3>(3) Phân tích cú pháp</h3>
<p>Nếu không trúng kết quả bộ nhớ cache truy vấn, quá trình thực thi câu lệnh sẽ bắt đầu. Trước tiên, MySQL cần biết bạn muốn làm gì, vì vậy nó cần phân tích câu lệnh SQL. MySQL sử dụng từ khóa để phân tích câu lệnh SQL và tạo ra một cây phân tích cú pháp tương ứng. Trong quá trình này, trình phân tích sử dụng các quy tắc cú pháp để xác minh và phân tích cây phân tích cú pháp của bạn. Ví dụ, trình phân tích sẽ nhận ra từ khóa "select" bạn nhập và xác định đây là một câu lệnh truy vấn. Nó cũng sẽ nhận ra chuỗi "T" là "tên bảng T" và chuỗi "ID" là "cột ID".</p>
<ul>
<li>Trình phân tích đầu tiên thực hiện "phân tích từ vựng". Bạn nhập vào một câu lệnh SQL gồm nhiều chuỗi và dấu cách, MySQL cần xác định các chuỗi đó đại diện cho cái gì. MySQL nhận ra từ khóa "select" từ bạn nhập vào, đó là một câu lệnh truy vấn. Nó cũng nhận ra chuỗi "T" là "tên bảng T" và chuỗi "ID" là "cột ID".</li>
<li>Tiếp theo, thực hiện "phân tích cú pháp". Dựa trên kết quả phân tích từ vựng, trình phân tích cú pháp sẽ xác định xem câu lệnh SQL bạn nhập có đáp ứng cú pháp của MySQL không. Nếu câu lệnh của bạn không đúng, bạn sẽ nhận được thông báo lỗi "You have an error in your SQL syntax", ví dụ như câu lệnh select bị thiếu chữ cái "s".</li>
</ul>
<h3>(4) Tối ưu hóa truy vấn</h3>
<p>Sau khi hoàn thành phân tích và xác định câu lệnh SQL, MySQL sẽ tiến hành tối ưu hóa truy vấn.</p>
<p>Sau khi hoàn thành phân tích và xác định cây phân tích cú pháp, MySQL sẽ chuyển đổi nó thành kế hoạch thực hiện tương ứng. Trong hầu hết các trường hợp, một truy vấn có thể có nhiều cách thực hiện, nhưng kết quả cuối cùng vẫn là cùng một. Nhiệm vụ của trình tối ưu hóa là tìm ra kế hoạch thực hiện tốt nhất trong số đó.</p>
<p>MySQL sử dụng trình tối ưu hóa dựa trên chi phí, nó cố gắng dự đoán chi phí của một truy vấn khi sử dụng một kế hoạch thực hiện cụ thể và chọn kế hoạch có chi phí nhỏ nhất. Trong MySQL, bạn có thể sử dụng giá trị <code>last_query_cost</code> của phiên truy vấn hiện tại để tính toán chi phí truy vấn hiện tại.</p>
<div class="language-ruby" data-ext="ruby" data-title="ruby"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> select</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> *</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> from t_message limit </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">...</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Omit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> result set</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> show status like </span><span style="color:#98C379;--shiki-dark:#98C379">'last_query_cost'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/mysql-workflow.drawio.png" type="image/png"/>
    </item>
    <item>
      <title>MySQL Configuration</title>
      <link>https://vanhung4499.github.io/database/mysql/configuration.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/configuration.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Configuration</source>
      <description>Cấu hình MySQL Phiên bản: mysql Cấu hình cơ bản Giải thích các cấu hình</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Phiên bản: <img src="https://img.shields.io/badge/mysql-8.0-blue" alt="mysql" loading="lazy"></p>
</blockquote>
<h2>Cấu hình cơ bản</h2>
<div class="language-ini" data-ext="ini" data-title="ini"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">[mysqld]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># GENERAL</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://img.shields.io/badge/mysql-8.0-blue" type="image/"/>
    </item>
    <item>
      <title>MySQL Storage Engine</title>
      <link>https://vanhung4499.github.io/database/mysql/engine.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/engine.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Storage Engine</source>
      <description>MySQL Storage Engine Các storage engine trong MySQL Trong hệ thống tệp, MySQL lưu mỗi cơ sở dữ liệu (cũng có thể gọi là schema) dưới dạng một thư mục con trong thư mục dữ liệu. ...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Các storage engine trong MySQL</h2>
<p>Trong hệ thống tệp, MySQL lưu mỗi cơ sở dữ liệu (cũng có thể gọi là schema) dưới dạng một thư mục con trong thư mục dữ liệu. Khi tạo bảng, MySQL sẽ tạo một tệp <code>.frm</code> cùng tên với bảng trong thư mục cơ sở dữ liệu để lưu định nghĩa của bảng. Vì MySQL sử dụng các thư mục và tệp hệ thống tệp để lưu định nghĩa cơ sở dữ liệu và bảng, tính nhạy cảm chữ hoa chữ thường phụ thuộc vào nền tảng cụ thể. Trong Windows, tính nhạy cảm chữ hoa chữ thường không được áp dụng; trong các hệ thống tương tự Unix, tính nhạy cảm chữ hoa chữ thường được áp dụng. <strong>Các storage engine khác nhau lưu trữ dữ liệu và chỉ mục theo cách khác nhau, nhưng định nghĩa bảng thì được xử lý thống nhất ở tầng dịch vụ của MySQL.</strong></p>
<p>MySQL sử dụng các storage engine dưới dạng plugin, mỗi storage engine nhắm đến một môi trường ứng dụng cơ sở dữ liệu cụ thể. Đồng thời, MySQL mã nguồn mở còn cho phép các nhà phát triển thiết lập các storage engine riêng của họ. Dưới đây là một số storage engine phổ biến:</p>
<ul>
<li>storage engine InnoDB: Đây là storage engine mặc định từ phiên bản MySQL 5.5 trở đi, với đặc điểm lớn nhất là hỗ trợ giao dịch, khóa cấp hàng, và ràng buộc khóa ngoại.</li>
<li>storage engine MyISAM: Là storage engine mặc định trước phiên bản MySQL 5.5, không hỗ trợ giao dịch, cũng không hỗ trợ khóa ngoại, nhưng có đặc điểm lớn nhất là tốc độ nhanh và chiếm ít tài nguyên.</li>
<li>storage engine Memory: Sử dụng bộ nhớ hệ thống làm phương tiện lưu trữ để có được tốc độ phản hồi nhanh hơn. Tuy nhiên, nếu quá trình mysqld bị sập, tất cả dữ liệu sẽ bị mất, do đó chỉ nên sử dụng storage engine Memory khi dữ liệu là tạm thời.</li>
<li>storage engine NDB: Còn được gọi là storage engine NDB Cluster, chủ yếu được sử dụng cho môi trường cụm phân tán MySQL Cluster, tương tự như cụm RAC của Oracle.</li>
<li>storage engine Archive: Có cơ chế nén tốt, dùng để lưu trữ tệp. Khi yêu cầu ghi dữ liệu, sẽ thực hiện nén, do đó thường được dùng để làm kho lưu trữ.</li>
</ul>
<h2>Các thao tác liên quan đến storage engine</h2>
<h3>Lệnh show storage engine</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Xem các storage engine được hỗ trợ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW ENGINES;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Xem storage engine mặc định</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW VARIABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD">LIKE</span><span style="color:#98C379;--shiki-dark:#98C379"> 'storage_engine'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Xem storage engine của một bảng cụ thể</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW </span><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#98C379;--shiki-dark:#98C379"> `table_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Xem storage engine của một bảng cụ thể trong một cơ sở dữ liệu</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW </span><span style="color:#C678DD;--shiki-dark:#C678DD">TABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> STATUS</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LIKE</span><span style="color:#98C379;--shiki-dark:#98C379"> 'table_name'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW </span><span style="color:#C678DD;--shiki-dark:#C678DD">TABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> STATUS</span><span style="color:#C678DD;--shiki-dark:#C678DD"> FROM</span><span style="color:#98C379;--shiki-dark:#98C379"> `database_name`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WHERE</span><span style="color:#98C379;--shiki-dark:#98C379"> `name`</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "table_name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h2>Các lệnh thiết lập storage engine</h2>
<h3>Lệnh tạo và thay đổi storage engine</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Chỉ định storage engine khi tạo bảng, nếu không chỉ định rõ, mặc định là INNODB</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (i </span><span style="color:#C678DD;--shiki-dark:#C678DD">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) ENGINE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> INNODB;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> t2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (i </span><span style="color:#C678DD;--shiki-dark:#C678DD">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) ENGINE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> CSV;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> t3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (i </span><span style="color:#C678DD;--shiki-dark:#C678DD">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) ENGINE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> MEMORY;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Thay đổi storage engine</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">ALTER</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> t ENGINE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> InnoDB;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Thay đổi storage engine mặc định, cũng có thể thay đổi trong tệp cấu hình </span><span style="color:#D19A66;--shiki-dark:#D19A66">my</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">cnf</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> default_storage_engine</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">NDBCLUSTER;</span></span></code></pre>
</div><p>Mặc định, mỗi khi <code>CREATE TABLE</code> hoặc <code>ALTER TABLE</code> không thể sử dụng storage engine mặc định, sẽ tạo ra một cảnh báo. Để ngăn chặn hành vi gây nhầm lẫn khi storage engine yêu cầu không khả dụng, có thể kích hoạt chế độ <code>NO_ENGINE_SUBSTITUTION SQL</code>. Nếu bộ máy yêu cầu không khả dụng, thiết lập này sẽ tạo ra lỗi thay vì cảnh báo và sẽ không tạo hoặc thay đổi bảng.</p>
<h2>Giới thiệu về các storage engine MySQL</h2>
<h3>Các storage engine tích hợp trong MySQL</h3>
<ul>
<li><strong>InnoDB</strong> - InnoDB là storage engine mặc định từ phiên bản MySQL 5.5 trở đi. Nó cung cấp khóa cấp hàng và ràng buộc khóa ngoại. Hiệu suất tốt và hỗ trợ tự động phục hồi sau khi gặp sự cố.</li>
<li><strong>MyISAM</strong> - Trước phiên bản MySQL 5.5, MyISAM là storage engine mặc định. Nó có nhiều tính năng nhưng không hỗ trợ giao dịch, không hỗ trợ khóa cấp hàng và khóa ngoại, và không có khả năng phục hồi sau sự cố.</li>
<li><strong>CSV</strong> - Có thể xử lý tệp CSV như bảng MySQL, nhưng bảng này không hỗ trợ chỉ mục.</li>
<li><strong>Memory</strong> - Lưu trữ dữ liệu trong bộ nhớ để có tốc độ phản hồi nhanh hơn. Tuy nhiên, nếu quá trình mysqld gặp sự cố, tất cả dữ liệu sẽ bị mất.</li>
<li><strong>NDB</strong> - Còn gọi là storage engine NDB Cluster, chủ yếu dùng cho môi trường cụm phân tán MySQL Cluster, tương tự như cụm RAC của Oracle.</li>
<li><strong>Archive</strong> - storage engine Archive rất phù hợp để lưu trữ dữ liệu.
<ul>
<li>storage engine Archive chỉ hỗ trợ thao tác <code>INSERT</code> và <code>SELECT</code>.</li>
<li>storage engine Archive sử dụng thuật toán nén zlib, với tỷ lệ nén có thể đạt 1:10.</li>
</ul>
</li>
</ul>
<h3>Cách chọn storage engine phù hợp</h3>
<p>Phần lớn trường hợp, InnoDB là lựa chọn đúng đắn, trừ khi cần các tính năng mà InnoDB không có.</p>
<p>Nếu ứng dụng cần chọn storage engine khác InnoDB, có thể xem xét các yếu tố sau:</p>
<ul>
<li><strong>Giao dịch</strong>: Nếu kịch bản kinh doanh là OLTP, thì InnoDB là storage engine được ưu tiên. Nếu không cần hỗ trợ giao dịch và chủ yếu là các thao tác SELECT và INSERT, MyISAM là lựa chọn tốt. Vì vậy, nếu MySQL được triển khai theo mô hình chủ - phụ và tách biệt đọc/ghi, có thể làm như sau: nút chính chỉ hỗ trợ ghi, bộ máy mặc định là InnoDB; nút phụ chỉ hỗ trợ đọc, bộ máy mặc định là MyISAM.</li>
<li><strong>Đồng thời</strong>: MyISAM chỉ hỗ trợ khóa cấp bảng, trong khi InnoDB hỗ trợ khóa cấp hàng. Do đó, InnoDB có hiệu suất đồng thời cao hơn.</li>
<li><strong>Khóa ngoại</strong>: InnoDB hỗ trợ khóa ngoại.</li>
<li><strong>Sao lưu</strong>: InnoDB hỗ trợ sao lưu nóng trực tuyến.</li>
<li><strong>Phục hồi sau sự cố</strong>: Khả năng hư hỏng sau sự cố của MyISAM cao hơn nhiều so với InnoDB, và tốc độ phục hồi cũng chậm hơn.</li>
<li><strong>Tính năng khác</strong>: MyISAM hỗ trợ bảng nén và chỉ mục dữ liệu không gian.</li>
</ul>
<h2>Giới thiệu về InnoDB</h2>
<p>InnoDB là storage engine mặc định từ phiên bản MySQL 5.5 trở đi. Chỉ nên sử dụng storage engine khác khi cần các tính năng mà InnoDB không hỗ trợ.</p>
<p>InnoDB cũng sử dụng cây B+ (B+Tree) làm cấu trúc chỉ mục, nhưng cách thực hiện cụ thể rất khác so với MyISAM. Trong MyISAM, tệp chỉ mục và tệp dữ liệu là tách biệt, tệp chỉ mục chỉ lưu trữ địa chỉ của bản ghi dữ liệu. Trong <strong>InnoDB, tệp dữ liệu của bảng chính là một cấu trúc chỉ mục B+Tree</strong>. Các nút lá (leaf node) của cây này chứa toàn bộ bản ghi dữ liệu. <strong>Chỉ mục này sử dụng khóa chính của bảng làm khóa</strong>, do đó, <strong>tệp dữ liệu của bảng InnoDB chính là chỉ mục chính</strong>.</p>
<p>InnoDB sử dụng MVCC (Multi-Version Concurrency Control) để hỗ trợ khả năng xử lý đồng thời cao, và thực hiện bốn mức độ cô lập tiêu chuẩn. Mức độ mặc định là đọc lặp lại (REPEATABLE READ) và sử dụng khóa khoảng (next-key locking) để ngăn chặn hiện tượng đọc ảo.</p>
<p>InnoDB được xây dựng dựa trên chỉ mục nhóm (clustered index), khác biệt lớn so với các storage engine khác. Dữ liệu được lưu trong chỉ mục, giúp tránh việc đọc từ đĩa trực tiếp, do đó cải thiện hiệu suất truy vấn.</p>
<p>InnoDB đã thực hiện nhiều tối ưu nội bộ, bao gồm đọc dữ liệu từ đĩa theo dự đoán, chỉ mục băm thích ứng tự động tạo để tăng tốc độ đọc, và vùng đệm chèn giúp tăng tốc độ chèn dữ liệu.</p>
<p>InnoDB hỗ trợ sao lưu nóng trực tuyến thực sự. Các storage engine khác không hỗ trợ sao lưu nóng trực tuyến; để có được chế độ xem nhất quán, cần phải dừng tất cả các thao tác ghi vào bảng, và trong môi trường đọc ghi hỗn hợp, việc dừng ghi cũng có thể đồng nghĩa với việc dừng đọc.</p>
<h3>Cấu trúc tệp vật lý của InnoDB:</h3>
<ul>
<li><strong>Tệp <code>.frm</code></strong>: Chứa thông tin siêu dữ liệu liên quan đến bảng, bao gồm thông tin định nghĩa cấu trúc bảng.</li>
<li><strong>Tệp <code>.ibd</code> hoặc <code>.ibdata</code></strong>: Chứa dữ liệu của InnoDB. Có hai cách lưu trữ dữ liệu InnoDB có thể được cấu hình:
<ul>
<li><strong>Không gian bảng riêng lẻ (file-per-table)</strong>: Sử dụng tệp <code>.ibd</code>, mỗi bảng có một tệp <code>.ibd</code>.</li>
<li><strong>Không gian bảng chia sẻ (shared-tablespace)</strong>: Sử dụng tệp <code>.ibdata</code>, tất cả các bảng dùng chung một tệp <code>.ibdata</code> (hoặc nhiều tệp, có thể cấu hình).</li>
</ul>
</li>
</ul>
<h2>Kiến trúc lưu trữ InnoDB</h2>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202406241406713.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Kiến trúc lưu trữ của InnoDB được chia thành cấu trúc bộ nhớ và cấu trúc đĩa.</p>
<h3>Cấu trúc bộ nhớ của InnoDB:</h3>
<ul>
<li><strong>Buffer Pool</strong>: Vùng đệm chính lưu trữ dữ liệu và chỉ mục được đọc từ đĩa.</li>
<li><strong>Change Buffer</strong>: Vùng đệm thay đổi lưu trữ các thay đổi đối với chỉ mục không duy nhất.</li>
<li><strong>Adaptive Hash Index</strong>: Chỉ mục băm thích ứng tự động tạo để tăng tốc độ truy vấn.</li>
<li><strong>Log Buffer</strong>: Vùng đệm ghi lại các thay đổi trước khi được ghi vào tệp nhật ký.</li>
</ul>
<h3>Cấu trúc đĩa của InnoDB:</h3>
<ul>
<li><strong>Tablespace</strong>: Không gian lưu trữ các tệp dữ liệu và chỉ mục.</li>
<li><strong>Doublewrite Buffer</strong>: Vùng đệm ghi đôi để đảm bảo tính toàn vẹn dữ liệu.</li>
<li><strong>Redo log</strong>: Nhật ký ghi lại các thay đổi để phục hồi sau sự cố.</li>
<li><strong>Undo log</strong>: Nhật ký hoàn tác giúp hỗ trợ giao dịch và khôi phục trạng thái trước đó của dữ liệu.</li>
</ul>
<p>InnoDB mang lại nhiều lợi ích về hiệu suất và độ tin cậy nhờ các tính năng và cấu trúc lưu trữ tiên tiến.</p>
<h2>Không gian bảng InnoDB</h2>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202406241406812.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h3>Dòng (Row)</h3>
<p>Các bản ghi trong bảng cơ sở dữ liệu được lưu trữ theo dòng (row), mỗi dòng bản ghi có cấu trúc lưu trữ khác nhau tùy thuộc vào định dạng dòng. Sau này chúng ta sẽ giới thiệu chi tiết về định dạng dòng của InnoDB, đây cũng là nội dung chính của bài viết này.</p>
<h3>Trang (Page)</h3>
<p>Bản ghi được lưu trữ theo dòng, nhưng việc đọc cơ sở dữ liệu không phải theo "dòng", vì nếu vậy mỗi lần đọc (một lần thao tác I/O) chỉ xử lý một dòng dữ liệu, hiệu quả sẽ rất thấp. Do đó, <strong>dữ liệu của InnoDB được đọc và ghi theo đơn vị "trang"</strong>. Điều này có nghĩa là khi cần đọc một bản ghi, không phải đọc chỉ một dòng từ đĩa, mà là đọc cả một trang vào bộ nhớ.</p>
<p><strong>Mặc định mỗi trang có kích thước 16KB</strong>, có nghĩa là đảm bảo không gian lưu trữ liên tục tối đa 16KB. Trang là đơn vị quản lý nhỏ nhất của đĩa trong storage engine InnoDB, nghĩa là mỗi lần cơ sở dữ liệu đọc ghi ít nhất là 16KB, đọc từ đĩa vào bộ nhớ ít nhất là 16K, và ghi từ bộ nhớ ra đĩa ít nhất là 16K.</p>
<p>Có nhiều loại trang, phổ biến nhất là trang dữ liệu, trang nhật ký undo, trang tràn, v.v. Các bản ghi trong bảng được quản lý bởi "trang dữ liệu", cấu trúc của trang dữ liệu không được đề cập chi tiết ở đây. Bạn có thể tham khảo bài viết này để biết thêm chi tiết: <a href="https://xiaolincoding.com/mysql/index/page.html" target="_blank" rel="noopener noreferrer">Thay đổi góc nhìn về cây B+</a>.</p>
<p>Nói chung, bạn chỉ cần biết các bản ghi trong bảng được lưu trữ trong "trang dữ liệu".</p>
<h3>Vùng (Extent)</h3>
<p>Chúng ta biết rằng storage engine InnoDB tổ chức dữ liệu bằng cây B+ (B+Tree). Trong cây B+, mỗi tầng được kết nối bằng danh sách liên kết hai chiều. Nếu phân bổ không gian lưu trữ theo đơn vị trang, vị trí vật lý của hai trang liền kề trong danh sách liên kết có thể không liên tiếp, có thể rất xa nhau, điều này dẫn đến nhiều thao tác I/O ngẫu nhiên, rất chậm.</p>
<p>Giải pháp rất đơn giản, làm cho vị trí vật lý của các trang liền kề trong danh sách liên kết cũng liền kề, như vậy có thể sử dụng I/O tuần tự. Điều này cải thiện hiệu suất khi thực hiện các truy vấn phạm vi (quét các nút lá).</p>
<p>Cách cụ thể để giải quyết vấn đề này là gì?</p>
<p><strong>Khi lượng dữ liệu trong bảng lớn, việc phân bổ không gian cho một chỉ mục không còn theo đơn vị trang, mà theo đơn vị vùng (extent). Mỗi vùng có kích thước 1MB, đối với trang 16KB, 64 trang liên tiếp sẽ tạo thành một vùng. Điều này làm cho vị trí vật lý của các trang liền kề trong danh sách liên kết cũng liền kề, và có thể sử dụng I/O tuần tự</strong>.</p>
<h3>Đoạn (Segment)</h3>
<p>Không gian bảng được tạo thành từ các đoạn (segment), mỗi đoạn gồm nhiều vùng (extent). Các đoạn thường được chia thành đoạn dữ liệu, đoạn chỉ mục và đoạn hoàn tác.</p>
<ul>
<li><strong>Đoạn chỉ mục</strong>: Chứa các vùng của các nút không phải lá của cây B+.</li>
<li><strong>Đoạn dữ liệu</strong>: Chứa các vùng của các nút lá của cây B+.</li>
<li><strong>Đoạn hoàn tác</strong>: Chứa các vùng của dữ liệu hoàn tác.</li>
</ul>
<p>Vậy là chúng ta đã hoàn thành việc mô tả cấu trúc của không gian bảng. Tiếp theo, chúng ta sẽ nói chi tiết về định dạng dòng của InnoDB.</p>
<p>Việc giới thiệu vòng quanh này nhằm giúp bạn hiểu dòng bản ghi được lưu trữ ở tệp nào và khu vực nào trong không gian bảng này, từ góc nhìn từ trên xuống. Điều này giúp bạn hiểu rõ hơn và không thấy mơ hồ.</p>
<h2>Cấu trúc bộ nhớ InnoDB</h2>
<h3>Bộ đệm (Buffer Pool)</h3>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202406241416178.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Bộ đệm dùng để tăng tốc độ truy cập và chỉnh sửa dữ liệu bằng cách lưu trữ dữ liệu nóng trong bộ nhớ, giảm thiểu tối đa I/O từ đĩa và tăng tốc độ đọc và ghi dữ liệu nóng.</p>
<p>Dữ liệu trong Buffer Pool được lưu trữ theo đơn vị trang và được quản lý bằng cấu trúc danh sách liên kết đơn theo đơn vị trang. Do giới hạn của bộ nhớ, Buffer Pool chỉ có thể chứa được dữ liệu nóng nhất. Buffer Pool sử dụng thuật toán LRU (Least Recently Used) để loại bỏ dữ liệu không nóng.</p>
<p>Dựa trên nguyên lý cục bộ thời gian và không gian, Buffer Pool lưu trữ các trang dữ liệu hoạt động hiện tại bằng cách sử dụng cơ chế đọc trước (Read-ahead) để lưu trữ các trang dữ liệu gần dữ liệu mục tiêu.</p>
<p>Cơ chế đọc trước dẫn đến vấn đề đọc trước thất bại. InnoDB sử dụng cơ chế phân chia thế hệ để giải quyết vấn đề này: chia Buffer Pool thành hai phần là New SubList và Old SubList, đặt các trang dữ liệu mới đọc vào đầu Old SubList, các trang dữ liệu trong Old SubList được truy cập lại sẽ được đặt vào đầu New SubList; các trang dữ liệu lạnh thất bại trong việc đọc trước sẽ nhanh chóng bị loại bỏ khỏi Old SubList mà không ảnh hưởng đến dữ liệu nóng trong New SubList.</p>
<p>InnoDB sử dụng cơ chế cửa sổ thời gian (Time Window) để giải quyết vấn đề ô nhiễm bộ đệm: đối với các trang dữ liệu trong Old SubList, chúng phải ở lại Old SubList trong một khoảng thời gian nhất định rồi mới được chuyển vào New SubList nếu được truy cập lại. Cửa sổ mặc định là 1 giây.</p>
<p>Đối với truy vấn dữ liệu trong Buffer Pool, InnoDB sẽ đọc và trả về trực tiếp; đối với sửa đổi dữ liệu trong Buffer Pool, InnoDB sẽ sửa trực tiếp trong Buffer Pool và ghi sửa đổi vào redo Log. Khi trang dữ liệu bị thuật toán LRU loại bỏ, nó sẽ được ghi vào đĩa, nếu hệ thống gặp sự cố trước khi được ghi vào đĩa, sẽ sử dụng redo Log để khôi phục khi khởi động lại.</p>
<h3>Bộ đệm thay đổi (Change Buffer)</h3>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202406241416527.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Change Buffer dùng để tăng tốc độ ghi vào chỉ mục thứ cấp của dữ liệu không nóng. Do tính không liên tục của dữ liệu chỉ mục thứ cấp, việc sửa đổi chỉ mục thứ cấp yêu cầu I/O đĩa thường xuyên, tiêu tốn nhiều hiệu năng. Change Buffer lưu trữ các thao tác sửa đổi chỉ mục thứ cấp và ghi vào redo log. Khi Change Buffer đạt đến một lượng nhất định hoặc hệ thống ít bận rộn, nó sẽ thực hiện thao tác <code>ibuf merge</code> để ghi sửa đổi vào đĩa. Change Buffer có vùng lưu trữ bền bỉ trong không gian bảng hệ thống.</p>
<p>Kích thước Change Buffer mặc định chiếm 25% Buffer Pool, được khởi tạo khi khởi động máy chủ. Cấu trúc vật lý của nó là một cây B-Tree gọi là <code>ibuf</code>. Điều kiện sử dụng Change Buffer là:</p>
<ul>
<li>InnoDB bật <code>innodb_change_buffering</code> và bảng hiện tại không có thao tác <code>flush</code>.</li>
<li>Chỉ sửa đổi các nút lá của cây chỉ mục thứ cấp và trang chỉ mục không nằm trong Buffer Pool.</li>
<li>Đối với chỉ mục thứ cấp duy nhất, chỉ có thao tác xóa có thể được lưu vào bộ đệm.</li>
</ul>
<p>Thời điểm thực hiện <code>ibuf merge</code>:</p>
<ul>
<li>Khi người dùng sử dụng chỉ mục thứ cấp để truy vấn.</li>
<li>Khi dự đoán rằng không gian trang sẽ không đủ khi lưu trữ thao tác chèn, có thể dẫn đến phân chia trang chỉ mục.</li>
<li>Khi thao tác lưu trữ lần này dẫn đến phân chia trang cây ibuf và kích thước Change Buffer vượt quá giới hạn sau khi phân loại.</li>
<li>Khi luồng master thực hiện lệnh <code>merge</code>.</li>
<li>Khi người dùng thực hiện thao tác <code>flush</code> trên bảng.</li>
</ul>
<h3>Chỉ mục băm thích nghi (Adaptive Hash Index)</h3>
<p>Chỉ mục băm thích nghi (Adaptive Hash Index, AHI) dùng để tăng tốc độ truy vấn cho các trang dữ liệu nóng. Khi sử dụng chỉ mục cụm (clustered index) để định vị trang dữ liệu, cần đi từ nút gốc đến nút lá của cây chỉ mục, thường mất 3-4 lần truy vấn. InnoDB phân tích việc sử dụng chỉ mục và các trường chỉ mục để tạo hoặc xóa chỉ mục băm một cách tự động.</p>
<p>AHI áp dụng cho các trang dữ liệu và chỉ mục được truy vấn thường xuyên. Vì trang dữ liệu là một phần của chỉ mục cụm, AHI được xây dựng trên chỉ mục. <strong>Đối với chỉ mục thứ cấp, nếu trúng AHI, sẽ lấy trực tiếp con trỏ bản ghi từ chỉ mục thứ cấp trong AHI và sau đó theo khóa chính tìm dữ liệu dọc theo chỉ mục cụm; nếu truy vấn chỉ mục cụm cũng trúng AHI, sẽ trả về trực tiếp con trỏ bản ghi của trang dữ liệu mục tiêu, từ đó có thể định vị trang dữ liệu trực tiếp theo con trỏ bản ghi</strong>.</p>
<p>Kích thước AHI là 1/64 của Buffer Pool. Từ MySQL 5.7 trở đi, AHI hỗ trợ phân vùng để giảm cạnh tranh trên khóa AHI toàn cục, mặc định là 8 phân vùng.</p>
<h3>Bộ đệm nhật ký (Log Buffer)</h3>
<p>Bộ đệm nhật ký (Log Buffer) được dùng để lưu trữ tạm thời các dữ liệu nhật ký cần ghi vào đĩa. Tất cả các thao tác sửa đổi của InnoDB sẽ được ghi vào các tệp nhật ký như redo log, undo log. Nếu mỗi lần sửa đổi đều được ghi trực tiếp vào đĩa, sẽ gây ra rất nhiều I/O. Log Buffer tối ưu vấn đề này bằng cách lưu trữ các thao tác sửa đổi trong vùng nhớ này trước, sau đó định kỳ ghi hàng loạt vào đĩa.</p>
<p>Kích thước của bộ đệm nhật ký có thể được điều chỉnh bằng cấu hình <code>innodb_log_buffer_size</code>, mặc định là 16MB.</p>
<h2>MyISAM</h2>
<p>MyISAM là hệ thống lưu trữ mặc định của MySQL trước phiên bản 5.5.</p>
<p>MyISAM được thiết kế đơn giản với dữ liệu được lưu trữ theo định dạng nén. MyISAM thích hợp cho dữ liệu chỉ đọc, hoặc bảng nhỏ có thể chấp nhận các thao tác sửa chữa.</p>
<p>MyISAM sử dụng cấu trúc B+Tree cho chỉ mục, trong đó <strong>nút lá của trường dữ liệu lưu trữ địa chỉ của các bản ghi dữ liệu</strong>.</p>
<p>MyISAM cung cấp nhiều tính năng như: chỉ mục toàn văn, bảng nén, và các hàm không gian. Tuy nhiên, MyISAM không hỗ trợ giao dịch và khóa cấp hàng. MyISAM cũng không hỗ trợ khôi phục an toàn sau khi hệ thống gặp sự cố.</p>
<p>Cấu trúc tệp vật lý của MyISAM:</p>
<ul>
<li>Tệp <code>.frm</code>: lưu trữ thông tin siêu dữ liệu liên quan đến bảng, bao gồm định nghĩa cấu trúc bảng.</li>
<li>Tệp <code>.MYD</code> (<code>MYData</code>): dành riêng cho MyISAM để lưu trữ dữ liệu của bảng MyISAM.</li>
<li>Tệp <code>.MYI</code> (<code>MYIndex</code>): dành riêng cho MyISAM để lưu trữ thông tin liên quan đến chỉ mục của bảng MyISAM.</li>
</ul>
<h2>So sánh InnoDB và MyISAM</h2>
<p>Bảng so sánh giữa InnoDB và MyISAM:</p>
<p>| Đối chiếu    | MyISAM                                        | InnoDB                           |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202406241406713.png" type="image/png"/>
    </item>
    <item>
      <title>MySQL Guide</title>
      <link>https://vanhung4499.github.io/database/mysql/guide.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/guide.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Guide</source>
      <description>MySQL Guide Kiến trúc MySQL Để hiểu MySQL, tốt nhất là hiểu cách MySQL hoạt động ở mức độ tổng quát. Tham khảo: MySQL Architecture Storage Engine MySQL hỗ trợ nhiều loại storage...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Kiến trúc MySQL</h2>
<p>Để hiểu MySQL, tốt nhất là hiểu cách MySQL hoạt động ở mức độ tổng quát.</p>
<p>Tham khảo:&nbsp;<a href="architecture">MySQL Architecture</a></p>
<h2>Storage Engine</h2>
<p>MySQL hỗ trợ nhiều loại storage engine, mỗi loại có ưu và nhược điểm riêng.</p>
<p>Tham khảo:&nbsp;<a href="storage-engine">MySQL Storage Engine</a></p>
<h2>Kiểu dữ liệu</h2>
<h3>Kiểu số nguyên</h3>
<p><code>TINYINT</code>,&nbsp;<code>SMALLINT</code>,&nbsp;<code>MEDIUMINT</code>,&nbsp;<code>INT</code>,&nbsp;<code>BIGINT</code>&nbsp;lần lượt sử dụng 8, 16, 24, 32, 64 bit không gian lưu trữ, trong hầu hết các trường hợp, càng nhỏ càng tốt.</p>
<p><strong><code>UNSIGNED</code>&nbsp;chỉ ra rằng không cho phép giá trị âm, có thể tăng giới hạn trên cùng của số dương</strong>.</p>
<p>Số trong&nbsp;<code>INT(11)</code>&nbsp;chỉ quy định số ký tự hiển thị cho cột trong công cụ tương tác, không có ý nghĩa với việc lưu trữ và tính toán.</p>
<h3>Kiểu số thực</h3>
<p><code>FLOAT</code>&nbsp;và&nbsp;<code>DOUBLE</code>&nbsp;là kiểu số thực.</p>
<p>Kiểu&nbsp;<code>DECIMAL</code>&nbsp;chủ yếu được sử dụng cho tính toán chính xác, tuy nhiên nó tốn kém và chỉ nên sử dụng&nbsp;<code>DECIMAL</code>&nbsp;khi tính toán số thập phân chính xác - ví dụ: lưu trữ dữ liệu tài chính. Khi có số lượng dữ liệu lớn, có thể sử dụng&nbsp;<code>BIGINT</code>&nbsp;thay thế&nbsp;<code>DECIMAL</code>.</p>
<p><code>FLOAT</code>,&nbsp;<code>DOUBLE</code>&nbsp;và&nbsp;<code>DECIMAL</code>&nbsp;có thể chỉ định chiều rộng cột, ví dụ&nbsp;<code>DECIMAL(18, 9)</code>&nbsp;chỉ ra tổng cộng 18 chữ số, 9 chữ số được sử dụng để lưu trữ phần thập phân.</p>
<h3>Kiểu chuỗi</h3>
<p>Chủ yếu có hai loại kiểu chuỗi là&nbsp;<code>CHAR</code>&nbsp;và&nbsp;<code>VARCHAR</code>, một loại là cố định, một loại là biến đổi.</p>
<p><strong>Kiểu biến đổi&nbsp;<code>VARCHAR</code>&nbsp;này có thể tiết kiệm không gian vì chỉ cần lưu trữ nội dung cần thiết. Tuy nhiên, khi thực hiện UPDATE, có thể làm cho hàng trở nên dài hơn so với ban đầu</strong>. Khi vượt quá kích thước mà một trang có thể chứa, sẽ có thêm hoạt động. MyISAM sẽ chia hàng thành các đoạn khác nhau để lưu trữ, trong khi InnoDB cần phải chia trang để đưa hàng vào trang.</p>
<p><code>VARCHAR</code>&nbsp;sẽ giữ các khoảng trắng ở cuối chuỗi, trong khi&nbsp;<code>CHAR</code>&nbsp;sẽ xóa chúng.</p>
<h3>Thời gian và ngày tháng</h3>
<p>MySQL cung cấp hai loại ngày tháng tương tự nhau:&nbsp;<code>DATATIME</code>&nbsp;và&nbsp;<code>TIMESTAMP</code>.</p>
<h4>DATATIME</h4>
<p>Có thể lưu trữ ngày tháng và thời gian từ năm 1001 đến năm 9999, với độ chính xác đến giây, sử dụng 8 byte không gian lưu trữ.</p>
<p>Nó không phụ thuộc vào múi giờ.</p>
<p>Mặc định, MySQL hiển thị giá trị DATATIME dưới dạng có thể sắp xếp, không gây hiểu lầm, ví dụ: "2008-01-16 22:37:08", đây là cách biểu diễn ngày tháng và thời gian được định nghĩa bởi tiêu chuẩn ANSI.</p>
<h4>TIMESTAMP</h4>
<p>Tương tự như dấu thời gian UNIX, lưu trữ số giây kể từ năm 1970, sử dụng 4 byte, chỉ có thể biểu diễn từ năm 1970 đến năm 2038.</p>
<p>Nó phụ thuộc vào múi giờ, có nghĩa là một dấu thời gian có thể đại diện cho thời gian cụ thể khác nhau trong các múi giờ khác nhau.</p>
<p>MySQL cung cấp hàm FROM_UNIXTIME() để chuyển đổi dấu thời gian UNIX thành ngày tháng và cung cấp hàm UNIX_TIMESTAMP() để chuyển đổi ngày tháng thành dấu thời gian UNIX.</p>
<p>Mặc định, nếu không chỉ định giá trị cột TIMESTAMP khi chèn, giá trị này sẽ được đặt thành thời gian hiện tại.</p>
<p>Nên sử dụng TIMESTAMP nếu có thể, vì nó có hiệu suất cao hơn so với DATETIME.</p>
<h3>BLOB và TEXT</h3>
<p><code>BLOB</code>&nbsp;và&nbsp;<code>TEXT</code>&nbsp;đều được thiết kế để lưu trữ dữ liệu lớn, cái trước là dữ liệu nhị phân, cái sau là dữ liệu chuỗi.</p>
<p>Không thể sắp xếp hoặc tạo chỉ mục cho toàn bộ nội dung của kiểu&nbsp;<code>BLOB</code>&nbsp;và&nbsp;<code>TEXT</code>.</p>
<h3>Kiểu enum</h3>
<p>Trong hầu hết các trường hợp, không cần sử dụng kiểu enum. Một trong những nhược điểm của kiểu enum là danh sách chuỗi enum là cố định, việc thêm và xóa chuỗi (lựa chọn enum) phải sử dụng&nbsp;<code>ALTER TABLE</code>&nbsp;(nếu chỉ thêm vào cuối danh sách, không cần xây dựng lại bảng).</p>
<h3>Lựa chọn kiểu dữ liệu</h3>
<ul>
<li>Kiểu số nguyên thường là lựa chọn tốt nhất cho cột định danh, vì chúng nhanh chóng và có thể sử dụng&nbsp;<code>AUTO_INCREMENT</code>.</li>
<li>Kiểu&nbsp;<code>ENUM</code>&nbsp;và&nbsp;<code>SET</code>&nbsp;thường là lựa chọn tồi, nên tránh sử dụng chúng.</li>
<li>Nên tránh sử dụng kiểu chuỗi làm cột định danh, vì chúng chiếm không gian và thường chậm hơn kiểu số. Đối với các chuỗi ngẫu nhiên như&nbsp;<code>MD5</code>,&nbsp;<code>SHA</code>,&nbsp;<code>UUID</code>, do tính ngẫu nhiên, nên lưu trữ dưới dạng số lượng lớn, có thể sử dụng&nbsp;<code>BIGINT</code>&nbsp;thay cho&nbsp;<code>DECIMAL</code>. Để lưu trữ UUID, nên xóa dấu&nbsp;<code>-</code>; cách tốt hơn là chuyển đổi giá trị UUID thành số 16 byte bằng cách sử dụng hàm&nbsp;<code>UNHEX()</code>&nbsp;và lưu trữ trong cột&nbsp;<code>BINARY(16)</code>, khi truy vấn, có thể định dạng lại thành định dạng hexa bằng cách sử dụng hàm&nbsp;<code>HEX()</code>.</li>
</ul>
<h2>Chỉ mục</h2>
<p>Chi tiết xem:&nbsp;<a href="mysql-index">MySQL Index</a></p>
<h2>Khóa</h2>
<p>Chi tiết xem:&nbsp;<a href="locks">MySQL Locks</a></p>
<h2>Giao dịch</h2>
<p>Chi tiết xem:&nbsp;<a href="transactions">MySQL Transactions</a></p>
<h2>Tối ưu hiệu suất</h2>
<p>Chi tiết xem:&nbsp;<a href="performance-optimization">MySQL Performance Optimization</a></p>
<h2>Replication</h2>
<h3>Sao chép Master-Slave</h3>
<p>MySQL hỗ trợ hai phương pháp sao chép: sao chép dựa trên hàng và sao chép dựa trên câu lệnh.</p>
<p>Cả hai phương pháp đều ghi lại nhật ký nhị phân trên máy chủ chính và sau đó chạy lại nhật ký trên máy chủ phụ để thực hiện sao chép dữ liệu không đồng bộ. Điều này có nghĩa là quá trình sao chép có độ trễ và trong khoảng thời gian này, dữ liệu trên máy chủ chính và máy chủ phụ có thể không nhất quán.</p>
<p>Chủ yếu liên quan đến ba luồng: luồng nhật ký nhị phân, luồng I/O và luồng SQL.</p>
<ul>
<li><strong>Luồng nhật ký nhị phân</strong>: Đảm nhiệm việc ghi dữ liệu thay đổi từ máy chủ chính vào tệp nhật ký nhị phân (binlog).</li>
<li><strong>Luồng I/O</strong>: Đảm nhiệm đọc tệp nhật ký nhị phân từ máy chủ chính và ghi vào nhật ký chuyển tiếp trên máy chủ phụ.</li>
<li><strong>Luồng SQL</strong>: Đảm nhiệm đọc nhật ký chuyển tiếp và thực thi các câu lệnh SQL.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721153816.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h3>Phân tách đọc ghi</h3>
<p>Máy chủ chính được sử dụng để xử lý các hoạt động ghi và các hoạt động đọc có yêu cầu thời gian thực cao, trong khi máy chủ phụ được sử dụng để xử lý các hoạt động đọc.</p>
<p>Phân tách đọc ghi thường được thực hiện thông qua proxy, trong đó máy chủ proxy nhận các yêu cầu đọc và ghi từ ứng dụng, sau đó quyết định chuyển tiếp yêu cầu đến máy chủ nào.</p>
<p>Phân tách đọc ghi trong MySQL có thể cải thiện hiệu suất vì:</p>
<ul>
<li>Máy chủ chính và máy chủ phụ chịu trách nhiệm cho các hoạt động đọc và ghi riêng biệt, giảm đáng kể sự cạnh tranh khóa;</li>
<li>Máy chủ phụ có thể được cấu hình để sử dụng hệ thống lưu trữ MyISAM, cải thiện hiệu suất truy vấn và tiết kiệm tài nguyên hệ thống;</li>
<li>Tăng tính dự phòng, cải thiện khả năng sẵn có.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/master-slave-proxy.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721153816.png" type="image/png"/>
    </item>
    <item>
      <title>Lock</title>
      <link>https://vanhung4499.github.io/database/mysql/lock.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/lock.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Lock</source>
      <description>MySQL Lock Khóa lạc quan và khóa bi quan Đảm bảo không làm hỏng tính cô lập, tính thống nhất và tính thống nhất của cơ sở dữ liệu khi nhiều giao dịch truy cập cùng một dữ liệu t...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Khóa lạc quan và khóa bi quan</h2>
<p>Đảm bảo không làm hỏng tính cô lập, tính thống nhất và tính thống nhất của cơ sở dữ liệu khi nhiều giao dịch truy cập cùng một dữ liệu trong cùng một thời điểm, <strong>khóa lạc quan và khóa bi quan là các phương pháp kỹ thuật được sử dụng chính cho kiểm soát đồng thời</strong>.</p>
<ul>
<li><strong><code>Khóa bi quan</code></strong> - Giả định xảy ra xung đột đồng thời và chặn mọi hoạt động có thể vi phạm tính toàn vẹn dữ liệu.
<ul>
<li>Khóa giao dịch ngay sau khi truy vấn dữ liệu, và chỉ mở khóa khi giao dịch được cam kết (<code>COMMIT</code>).</li>
<li>Cách thực hiện: <strong>Sử dụng cơ chế khóa trong cơ sở dữ liệu</strong>.</li>
</ul>
</li>
<li><strong><code>Khóa lạc quan</code></strong> - Giả định không xảy ra xung đột đồng thời và chỉ kiểm tra vi phạm tính toàn vẹn dữ liệu khi thực hiện thao tác gửi đi.
<ul>
<li>Khóa giao dịch khi thay đổi dữ liệu và sử dụng phiên bản để khóa.</li>
<li>Cách thực hiện: <strong>Sử dụng phiên bản hoặc dấu thời gian</strong>.</li>
</ul>
</li>
</ul>
<p>【Ví dụ】Ví dụ về khóa lạc quan</p>
<p>Bảng hàng hóa (goods) có một trường status, trong đó status = 1 cho biết hàng hóa chưa được đặt hàng, status = 2 cho biết hàng hóa đã được đặt hàng, vì vậy khi đặt hàng cho một mặt hàng cần đảm bảo status của mặt hàng đó là 1. Giả sử id của mặt hàng là 1.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD">version</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> t_goods </span><span style="color:#C678DD;--shiki-dark:#C678DD">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">#{id}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> t_goods</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">set</span><span style="color:#C678DD;--shiki-dark:#C678DD"> status</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD">version</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD">version</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">+</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">#{id} </span><span style="color:#C678DD;--shiki-dark:#C678DD">and</span><span style="color:#C678DD;--shiki-dark:#C678DD"> version</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">#{</span><span style="color:#C678DD;--shiki-dark:#C678DD">version</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">};</span></span></code></pre>
</div><h2>Khóa bảng và khóa hàng</h2>
<p>Dựa trên phạm vi khóa của cơ sở dữ liệu, MySQL cung cấp hai loại khóa: khóa hàng và khóa bảng.</p>
<ul>
<li><strong>Khóa bảng (table lock)</strong> - Khóa toàn bộ bảng. Trước khi người dùng thực hiện thao tác ghi trên bảng, cần có khóa ghi, điều này sẽ chặn tất cả các hoạt động đọc và ghi của người dùng khác trên bảng đó. Chỉ khi không có khóa ghi, người dùng khác mới có thể nhận được khóa đọc và các khóa đọc không chặn lẫn nhau.</li>
<li><strong>Khóa hàng (row lock)</strong> - Khóa các bản ghi hàng định. Điều này cho phép các tiến trình khác vẫn có thể thực hiện các hoạt động trên các bản ghi khác trong cùng một bảng.</li>
</ul>
<p>Nên chỉ khóa các dữ liệu cần thay đổi, không phải tất cả tài nguyên. <strong>Càng khóa ít dữ liệu, tần suất cạnh tranh khóa càng ít, độ đồng thời của hệ thống càng cao</strong>. Tuy nhiên, việc khóa cần tiêu tốn tài nguyên và các hoạt động liên quan đến khóa (bao gồm lấy khóa, giải phóng khóa và kiểm tra trạng thái khóa) đều làm tăng chi phí của hệ thống. Do đó, <strong>độ đồng thời của khóa càng nhỏ, chi phí của hệ thống càng lớn</strong>.</p>
<p>Khi chọn mức độ chi tiết của khóa, cần phải cân bằng giữa chi phí khóa và độ đồng thời của hệ thống.</p>
<p>Trong <code>InnoDB</code>, <strong>khóa hàng được thực hiện bằng cách khóa các mục nhập chỉ mục (index entry) trên chỉ mục (index)</strong>. <strong>Nếu không có chỉ mục, <code>InnoDB</code> sẽ khóa bản ghi thông qua chỉ mục cụm ẩn</strong>.</p>
<h2>Khóa đọc và khóa ghi</h2>
<ul>
<li>Khóa độc quyền (Exclusive), viết tắt là khóa X, còn được gọi là khóa ghi. Cách sử dụng: <code>SELECT … FOR UPDATE;</code></li>
<li>Khóa chia sẻ (Shared), viết tắt là khóa S, còn được gọi là khóa đọc. Cách sử dụng: <code>SELECT … LOCK IN SHARE MODE;</code></li>
</ul>
<p>Mối quan hệ giữa khóa ghi và khóa đọc, nói một cách đơn giản: <strong>Khi có khóa độc quyền tồn tại, các giao dịch khác không thể thực hiện bất kỳ hoạt động nào</strong>.</p>
<p><strong>Khóa hàng, khóa khoảng (gap lock) và khóa next-key trong <code>InnoDB</code> đều thuộc loại khóa độc quyền</strong>.</p>
<h2>Khóa ý định</h2>
<p><strong>Khi có khóa bảng và khóa hàng cùng tồn tại, trước tiên phải yêu cầu khóa ý định (khóa bảng, nhưng không phải khóa thực sự), sau đó mới nhận được khóa hàng</strong>. Sử dụng khóa ý định (Intention Lock) có thể dễ dàng hỗ trợ nhiều mức khóa.</p>
<p><strong>Khóa ý định được <code>InnoDB</code> tự động thêm vào, không cần can thiệp của người dùng</strong>.</p>
<p>Khi có khóa hàng và khóa bảng, giao dịch T muốn khóa bảng A bằng khóa X, chỉ cần kiểm tra xem có giao dịch khác đã khóa bảng A hoặc một hàng nào đó trong bảng A bằng khóa X/IX/S/IS chưa. Nếu đã khóa, có nghĩa là có giao dịch khác đang sử dụng bảng này hoặc khóa của một hàng trong bảng này, do đó giao dịch T không thể khóa thành công.</p>
<p>Các quy tắc khóa ý định:</p>
<ul>
<li>IX/IS là khóa bảng;</li>
<li>X/S là khóa hàng.</li>
<li>Trước khi một giao dịch nhận khóa S cho một hàng dữ liệu nào đó, trước tiên phải nhận khóa IS hoặc khóa mạnh hơn trên bảng;</li>
<li>Trước khi một giao dịch nhận khóa X cho một hàng dữ liệu nào đó, trước tiên phải nhận khóa IX hoặc khóa mạnh hơn trên bảng.</li>
</ul>
<p>Bằng cách giới thiệu khóa ý định, giao dịch T muốn khóa bảng A bằng khóa X chỉ cần kiểm tra xem có giao dịch khác đã khóa A bằng khóa X/IX/S/IS chưa, nếu đã khóa thì có nghĩa là có giao dịch khác đang sử dụng bảng này hoặc một hàng trong bảng này, do đó giao dịch T không thể khóa thành công.</p>
<p>Các quan hệ khóa khác nhau như sau:</p>
<table>
<thead>
<tr>
<th style="text-align:center">-</th>
<th style="text-align:center">X</th>
<th style="text-align:center">IX</th>
<th style="text-align:center">S</th>
<th style="text-align:center">IS</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">X</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td style="text-align:center">IX</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✔️</td>
</tr>
<tr>
<td style="text-align:center">S</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
</tr>
<tr>
<td style="text-align:center">IS</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
</tr>
</tbody>
</table>
<p>Giải thích:</p>
<ul>
<li>Bất kỳ khóa IS/IX nào cũng tương thích với nhau, vì chúng chỉ đại diện cho việc muốn khóa bảng, không phải khóa thực sự;</li>
<li>Quan hệ tương thích áp dụng cho khóa cấp bảng, trong khi khóa IX cấp bảng và khóa X cấp hàng tương thích với nhau. Hai giao dịch có thể đặt khóa X trên hai hàng dữ liệu (Giao dịch T1 muốn đặt khóa X trên hàng R1, Giao dịch T2 muốn đặt khóa X trên hàng R2 của cùng một bảng. Cả hai giao dịch đều cần phải đặt khóa IX trên bảng này, nhưng các loại khóa này là tương thích và tương thích với khoá X cấp hàng nghĩa là cả hai giao dịch có thể khoá thành công và chỉnh sửa hai hàng dữ liệu trong cùng một bảng).</li>
</ul>
<h2>MVCC</h2>
<p><strong>Điều khiển đồng thời đa phiên bản (Multi-Version Concurrency Control, MVCC)</strong>&nbsp;có thể coi là một biến thể của khóa cấp hàng. Trong nhiều trường hợp, nó tránh được các hoạt động khóa, do đó có chi phí thấp hơn. Không chỉ có Mysql, các cơ sở dữ liệu khác như Oracle, PostgreSQL cũng đã triển khai MVCC của riêng họ, không có tiêu chuẩn thống nhất cho cơ chế triển khai.</p>
<p>MVCC là một cách cụ thể để triển khai cấp độ cô lập trong động cơ lưu trữ InnoDB, <strong>được sử dụng để triển khai cấp độ đọc đã cam kết và đọc lặp lại</strong>. Cấp độ đọc chưa cam kết luôn đọc dòng dữ liệu mới nhất, yêu cầu thấp, không cần sử dụng MVCC. Cấp độ tuần tự hóa yêu cầu khóa tất cả các dòng dữ liệu đọc, không thể triển khai chỉ bằng MVCC.</p>
<h3>Ý tưởng của MVCC</h3>
<p>Việc khóa có thể giải quyết vấn đề nhất quán đồng thời xảy ra khi nhiều giao dịch được thực hiện cùng một lúc. Trong các tình huống thực tế, thao tác đọc thường nhiều hơn thao tác ghi, do đó, khóa đọc và ghi được giới thiệu để tránh các hoạt động khóa không cần thiết, chẳng hạn như không có mối quan hệ cạnh tranh giữa đọc và đọc. Thao tác đọc và ghi trong khóa đọc và ghi vẫn tương đối cạnh tranh.</p>
<p>Ý tưởng của MVCC là:</p>
<ul>
<li><strong>Lưu trữ bản chụp (snapshot) của dữ liệu tại một thời điểm nào đó, các thao tác ghi (DELETE, INSERT, UPDATE) cập nhật bản chụp phiên bản mới nhất; trong khi các thao tác đọc truy cập bản chụp phiên bản cũ, không có mối quan hệ cạnh tranh</strong>. Điều này tương tự như&nbsp;<code>CopyOnWrite</code>.</li>
<li>Đọc bẩn và đọc lại không nhất quán là do&nbsp;<strong>giao dịch đọc các thay đổi chưa được giao dịch khác cam kết</strong>. Khi giao dịch thực hiện thao tác đọc, để giải quyết vấn đề đọc bẩn và đọc không nhất quán,&nbsp;<strong>MVCC quy định chỉ có thể đọc bản chụp đã cam kết</strong>. Tất nhiên, một giao dịch có thể đọc bản chụp chưa được cam kết của chính nó, điều này không được coi là đọc bẩn.</li>
</ul>
<h3>Số phiên bản</h3>
<p>Triển khai MVCC của InnoDB là: lưu trữ hai cột ẩn sau mỗi dòng ghi, một cột lưu trữ thời gian tạo dòng, cột còn lại lưu trữ thời gian hết hạn của dòng (thời gian ở đây có nghĩa là số phiên bản hệ thống). Mỗi khi bắt đầu một giao dịch mới, số phiên bản hệ thống sẽ tự động tăng lên, số phiên bản hệ thống tại thời điểm bắt đầu giao dịch sẽ được sử dụng làm số phiên bản của giao dịch, để so sánh với số phiên bản của mỗi dòng ghi được truy vấn.</p>
<ul>
<li>Số phiên bản hệ thống&nbsp;<code>SYS_ID</code>: là một số tăng dần, mỗi khi bắt đầu một giao dịch mới, số phiên bản hệ thống sẽ tự động tăng lên.</li>
<li>Số phiên bản giao dịch&nbsp;<code>TRX_ID</code>: số phiên bản hệ thống tại thời điểm bắt đầu giao dịch.</li>
</ul>
<h3>Undo log</h3>
<p>MVCC của nhiều phiên bản đề cập đến việc lưu trữ nhiều bản chụp, bản chụp được lưu trữ trong Undo log, log này kết nối tất cả các bản chụp của một dòng dữ liệu thông qua con trỏ rollback&nbsp;<code>ROLL_PTR</code>.</p>
<p>Ví dụ, trong MySQL, tạo một bảng t, bao gồm khóa chính id và một trường x. Chúng ta chèn một dòng dữ liệu trước, sau đó thực hiện hai lần cập nhật trên dòng đó.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> t(id, x) </span><span style="color:#C678DD;--shiki-dark:#C678DD">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> t </span><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> x</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">"b"</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> t </span><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> x</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">"c"</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Vì không sử dụng&nbsp;<code>START TRANSACTION</code>&nbsp;để thực hiện các hoạt động trên như một giao dịch, theo cơ chế&nbsp;<code>AUTOCOMMIT</code>&nbsp;của MySQL, mỗi hoạt động sẽ được coi là một giao dịch, vì vậy tổng cộng có ba giao dịch.<br>
Trong bản chụp, ngoài việc ghi lại số phiên bản của giao dịch <code>TRX_ID</code> và các hoạt động, còn có một trường DEL kiểu bit để đánh dấu xem liệu nó đã bị xóa hay chưa.</p>
<p><code>INSERT</code>, <code>UPDATE</code>, và <code>DELETE</code> sẽ tạo ra một bản ghi nhật ký và ghi số phiên bản giao dịch <code>TRX_ID</code>. <code>DELETE</code> có thể coi là một loại đặc biệt của <code>UPDATE</code>, ngoài ra còn thiết lập trường DEL thành 1.</p>
<h3>ReadView</h3>
<p>MVCC duy trì một&nbsp;<code>consistent read view</code>, chứa danh sách các giao dịch chưa được cam kết trong hệ thống&nbsp;<code>TRX_IDs {TRX_ID_1, TRX_ID_2, …}</code>, cùng với giá trị nhỏ nhất và lớn nhất của danh sách đó&nbsp;<code>TRX_ID_MIN</code>&nbsp;và&nbsp;<code>TRX_ID_MAX</code>.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/mysql-mvcc-readview.png" alt="mysql-mvcc-readview.png" tabindex="0" loading="lazy"><figcaption>mysql-mvcc-readview.png</figcaption></figure>
<p>Như vậy, đối với thời điểm bắt đầu của giao dịch hiện tại, một phiên bản dữ liệu hàng <code>trx_id</code> có thể có các trường hợp sau:</p>
<ol>
<li>Nếu nằm trong phần màu xanh lá cây, đó chỉ là phiên bản của một giao dịch đã được cam kết hoặc được tạo bởi chính giao dịch hiện tại, dữ liệu này có thể nhìn thấy.</li>
<li>Nếu nằm trong phần màu đỏ, đó chỉ là phiên bản được tạo bởi một giao dịch sẽ được khởi động trong tương lai, nó chắc chắn không thể nhìn thấy.</li>
<li>Nếu nằm trong phần màu cam, có hai trường hợp:
<ul>
<li>Nếu hàng <code>trx_id</code> có trong mảng, đó chỉ là phiên bản được tạo bởi một giao dịch chưa được cam kết, không thể nhìn thấy.</li>
<li>Nếu hàng <code>trx_id</code> không có trong mảng, đó chỉ là phiên bản được tạo bởi một giao dịch đã được cam kết, có thể nhìn thấy.</li>
</ul>
</li>
</ol>
<p>Khi thực hiện thao tác&nbsp;<code>SELECT</code>, ta có thể xác định được khả năng sử dụng bản chụp hàng dữ liệu dựa trên mối quan hệ giữa <code>TRX_ID</code> của bản chụp và <code>TRX_ID_MIN</code> cũng như <code>TRX_ID_MAX</code>.</p>
<ul>
<li><code>TRX_ID</code>&nbsp;&lt;&nbsp;<code>TRX_ID_MIN</code>, đó là phiên bản dòng dữ liệu đã được thay đổi trước tất cả các giao dịch chưa được cam kết hiện tại, do đó có thể sử dụng.</li>
<li><code>TRX_ID</code>&nbsp;&gt;&nbsp;<code>TRX_ID_MAX</code>, đó là phiên bản dòng dữ liệu đã được thay đổi sau khi giao dịch bắt đầu, do đó không thể sử dụng.</li>
<li><code>TRX_ID_MIN</code>&nbsp;&lt;=&nbsp;<code>TRX_ID</code>&nbsp;&lt;=&nbsp;<code>TRX_ID_MAX</code>, cần xác định dựa trên cấp độ cô lập:
<ul>
<li>Đọc đã cam kết: Nếu&nbsp;<code>TRX_ID</code>&nbsp;có trong danh sách&nbsp;<code>TRX_IDs</code>, đó là phiên bản dòng dữ liệu tương ứng với giao dịch chưa được cam kết, do đó phiên bản này không thể sử dụng. Nếu không, đó là phiên bản đã được cam kết, có thể sử dụng.</li>
<li>Đọc lặp lại: không thể sử dụng cả hai. Vì nếu có thể sử dụng, thì các giao dịch khác cũng có thể đọc phiên bản dòng dữ liệu này và thực hiện thay đổi, khiến giá trị đọc của giao dịch hiện tại thay đổi, tức là xảy ra vấn đề đọc lặp lại không nhất quán.</li>
</ul>
</li>
</ul>
<p>Trong trường hợp không thể sử dụng bản chụp hàng dữ liệu, cần tìm đến chỉ số cuộn <code>ROLL_PTR</code> trong Undo Log để tìm bản chụp tiếp theo và tiến hành kiểm tra như đã nêu ở trên.</p>
<h3>Đọc bản chụp và đọc hiện tại</h3>
<p><strong>Đọc bản chụp</strong></p>
<p>Thao tác <code>SELECT</code> của MVCC là dữ liệu trong bản chụp, không cần thực hiện hoạt động khóa.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#C678DD;--shiki-dark:#C678DD"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ...;</span></span></code></pre>
</div><p><strong>Đọc hiện tại</strong></p>
<p>Các hoạt động khác của MVCC sẽ thay đổi cơ sở dữ liệu (<code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>) cần thực hiện hoạt động khóa để đọc dữ liệu mới nhất. Có thể thấy MVCC không hoàn toàn không sử dụng khóa, mà chỉ tránh việc áp dụng khóa cho <code>SELECT</code>.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">INSERT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">DELETE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Khi thực hiện thao tác <code>SELECT</code>, có thể bắt buộc chỉ định thực hiện khóa. Câu lệnh đầu tiên yêu cầu khóa S, câu lệnh thứ hai yêu cầu khóa X.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#C678DD;--shiki-dark:#C678DD"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ? lock </span><span style="color:#C678DD;--shiki-dark:#C678DD">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> share mode;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#C678DD;--shiki-dark:#C678DD"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ? </span><span style="color:#C678DD;--shiki-dark:#C678DD">for</span><span style="color:#C678DD;--shiki-dark:#C678DD"> update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h2>Khóa hàng</h2>
<p>Có ba thuật toán cụ thể để triển khai khóa hàng (row lock): khóa bản ghi (record lock), Khoá khoảng (gap lock) và khóa next-key.</p>
<ul>
<li><code>Khóa bản ghi (Record Lock)</code> - <strong>Khóa hàng bằng cách khóa các mục chỉ mục (index entry), nếu không có chỉ mục thì sử dụng khóa bảng</strong>.</li>
<li><code>Khoá khoảng (Gap Lock)</code> - <strong>Khoá khoảng giữa các mục chỉ mục (index entry)</strong>. Khoá khoảng giữa các mục chỉ mục, nhưng không bao gồm chính mục chỉ mục đó. Ví dụ, khi một giao dịch thực hiện câu lệnh sau, các giao dịch khác không thể chèn giá trị 15 vào cột c trong bảng t: <code>SELECT c FROM t WHERE c BETWEEN 10 and 20 FOR UPDATE;</code>. Trong MySQL, Khoá khoảng mặc định là được bật, tức là giá trị của tham số <code>innodb_locks_unsafe_for_binlog</code> là <code>disable</code>, và mặc định trong MySQL là cấp độ cô lập giao dịch RR.</li>
<li><code>Khóa next-key</code> - Đây là sự kết hợp của <code>Khóa bản ghi (record lock)</code> và <code>Khoá khoảng (gap lock)</code>. Nó không chỉ khóa một mục chỉ mục trên một bản ghi, mà còn khoá khoảng giữa các chỉ mục. Nó khóa một khoảng mở phía trước và đóng phía sau.</li>
</ul>
<p>Chỉ có cáchoạt động cụ thể trong cấp độ cô lập đọc có thể lặp lại hoặc cao hơn mới sẽ nhận được khóa khoảng (gap lock) hoặc khóa next-key. Trong các câu lệnh <code>SELECT</code>, <code>UPDATE</code> và <code>DELETE</code>, ngoại trừ các truy vấn dựa trên chỉ mục duy nhất, các truy vấn dựa trên chỉ mục khác đều lấy khoá khoảng hoặc khóa next-key, tức là khóa phạm vi quét của chúng. Chỉ mục khóa chính cũng được coi là chỉ mục duy nhất, vì vậy chỉ mục khóa chính không sử dụng khóa khoảng (gap lock) hoặc khóa next-key.</p>
<p>MVCC không thể giải quyết vấn đề đọc lại không nhất quán, <strong>khóa next-key được tạo ra để giải quyết vấn đề đọc lại không nhất quán</strong>. Trong cấp độ cô lập đọc có thể lặp lại (<code>REPEATABLE READ</code>), sử dụng <strong>MVCC + Khóa next-key</strong> có thể giải quyết vấn đề đọc lại không nhất quán.</p>
<p>Chỉ mục được chia thành chỉ mục khóa chính (primary index) và chỉ mục khoá phụ (không phải khóa chính - non-primary index). Nếu một câu lệnh SQL thao tác trên chỉ mục khóa chính, MySQL sẽ khóa chỉ mục khóa chính đó; nếu một câu lệnh thao tác trên chỉ mục khoá phụ, MySQL sẽ khóa chỉ mục khoá phụ đó trước, sau đó khóa chỉ mục khóa chính liên quan. Trong các câu lệnh <code>UPDATE</code> và <code>DELETE</code>, MySQL không chỉ khóa tất cả các bản ghi chỉ mục được quét bởi điều kiện <code>WHERE</code>, mà còn khóa các giá trị liền kề, còn được gọi là <code>khóa next-key</code>.</p>
<p>Khi hai giao dịch được thực hiện đồng thời, một giao dịch khóa chỉ mục khoá chính và đang chờ đợi các chỉ mục liên quan. Giao dịch khác khóa chỉ mục khoá phụ và đang chờ đợi chỉ mục khoá chính liên quan. Điều này dẫn đến tình trạng bế tắc. Sau khi xảy ra tình trạng bế tắc, <code>InnoDB</code> thường có thể phát hiện và làm cho một giao dịch giải phóng khóa và rollback, và giao dịch khác tiếp tục lấy khóa để hoàn thành giao dịch.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/mysql-mvcc-readview.png" type="image/png"/>
    </item>
    <item>
      <title>MySQL Index</title>
      <link>https://vanhung4499.github.io/database/mysql/mysql-index.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/mysql-index.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Index</source>
      <description>MySQL Index Chỉ mục là một phương pháp quan trọng để cải thiện hiệu suất truy vấn trong MySQL, nhưng quá nhiều chỉ mục có thể dẫn đến sử dụng đĩa cao và chiếm nhiều bộ nhớ, ảnh ...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Chỉ mục là một phương pháp quan trọng để cải thiện hiệu suất truy vấn trong MySQL, nhưng quá nhiều chỉ mục có thể dẫn đến sử dụng đĩa cao và chiếm nhiều bộ nhớ, ảnh hưởng đến hiệu suất tổng thể của ứng dụng. Nên tránh việc thêm chỉ mục sau khi đã triển khai, vì sau đó có thể cần giám sát nhiều truy vấn SQL để xác định vị trí của vấn đề, và thời gian thêm chỉ mục nhất định là lớn hơn thời gian ban đầu để thêm chỉ mục, điều này cho thấy việc thêm chỉ mục cũng rất có tính kỹ thuật.</p>
<p>Tiếp theo, tôi sẽ giới thiệu cho bạn một loạt các chiến lược tạo chỉ mục hiệu suất cao và nguyên tắc làm việc đằng sau mỗi chiến lược. Tuy nhiên, trước khi đi vào chi tiết, hãy tìm hiểu một số thuật toán và cấu trúc dữ liệu liên quan đến chỉ mục, điều này sẽ giúp bạn hiểu rõ hơn nội dung sau này.</p>
</blockquote>
<h2>Giới thiệu về chỉ mục</h2>
<p><strong>Chỉ mục là một cấu trúc dữ liệu trong cơ sở dữ liệu được sử dụng để cải thiện hiệu suất tìm kiếm</strong>.</p>
<p>Chỉ mục là yếu tố quan trọng cho hiệu suất tốt, khi dữ liệu nhỏ và tải không cao, tác động của chỉ mục không thể thấy rõ; nhưng khi dữ liệu tăng dần, hiệu suất sẽ giảm đáng kể. Do đó, tối ưu chỉ mục là biện pháp hiệu quả nhất để tối ưu hiệu suất truy vấn.</p>
<h3>Ưu và nhược điểm của chỉ mục</h3>
<p>B-Tree là cấu trúc dữ liệu chỉ mục phổ biến nhất, lưu trữ dữ liệu theo thứ tự, vì vậy MySQL có thể được sử dụng để thực hiện các hoạt động&nbsp;<code>ORDER BY</code>&nbsp;và&nbsp;<code>GROUP BY</code>. Vì dữ liệu được sắp xếp, B-Tree cũng sẽ lưu trữ các giá trị cột liên quan cùng nhau. Cuối cùng, vì chỉ mục lưu trữ các giá trị cột thực tế, nên một số truy vấn chỉ cần sử dụng chỉ mục để hoàn thành toàn bộ truy vấn.</p>
<p>✔ Ưu điểm của chỉ mục:</p>
<ul>
<li><strong>Chỉ mục giảm đáng kể lượng dữ liệu cần quét bởi máy chủ, từ đó tăng tốc độ truy vấn</strong>.</li>
<li><strong>Chỉ mục có thể giúp máy chủ tránh sắp xếp và bảng tạm thời</strong>.</li>
<li><strong>Chỉ mục có thể biến I/O ngẫu nhiên thành I/O tuần tự</strong>.</li>
<li>Các cơ sở dữ liệu hỗ trợ khóa hàng, chẳng hạn như InnoDB, sẽ khóa khi truy cập hàng.&nbsp;<strong>Sử dụng chỉ mục có thể giảm số lượng hàng truy cập, từ đó giảm sự cạnh tranh khóa và tăng cường đồng thời</strong>.</li>
<li>Chỉ mục duy nhất đảm bảo tính duy nhất của mỗi hàng dữ liệu, sử dụng chỉ mục có thể tận dụng được trình tối ưu hóa ẩn, cải thiện hiệu suất hệ thống.</li>
</ul>
<p>❌ Nhược điểm của chỉ mục:</p>
<ul>
<li><strong>Tạo và duy trì chỉ mục mất thời gian</strong>, điều này tăng theo lượng dữ liệu.</li>
<li><strong>Chỉ mục chiếm không gian vật lý bổ sung</strong>, ngoài không gian dữ liệu của bảng, mỗi chỉ mục cũng cần một không gian vật lý nhất định, nếu tạo chỉ mục kết hợp, không gian cần thiết sẽ lớn hơn.</li>
<li><strong>Có thể cần cập nhật chỉ mục khi thực hiện các hoạt động ghi (<code>INSERT</code>/<code>UPDATE</code>/<code>DELETE</code>)</strong>, dẫn đến giảm hiệu suất ghi của cơ sở dữ liệu.</li>
</ul>
<h3>Khi nào sử dụng chỉ mục</h3>
<blockquote>
<p>Chỉ mục có thể dễ dàng nâng cao hiệu suất truy vấn một vài cấp số nhân.</p>
</blockquote>
<p>✔ Trường hợp&nbsp;<strong>thích hợp</strong>&nbsp;sử dụng chỉ mục:</p>
<ul>
<li><strong>Thao tác đọc thường xuyên (<code>SELECT</code>)</strong>.</li>
<li><strong>Dữ liệu trong bảng lớn</strong>.</li>
<li><strong>Tên cột thường xuất hiện trong điều kiện&nbsp;<code>WHERE</code>&nbsp;hoặc điều kiện kết nối (<code>JOIN</code>)</strong>.</li>
</ul>
<p>❌ Trường hợp&nbsp;<strong>không thích hợp</strong>&nbsp;sử dụng chỉ mục:</p>
<ul>
<li><strong>Thao tác ghi thường xuyên (<code>INSERT</code>/<code>UPDATE</code>/<code>DELETE</code>)</strong>, điều này có nghĩa là cần cập nhật chỉ mục.</li>
<li><strong>Tên cột không thường xuất hiện trong điều kiện&nbsp;<code>WHERE</code>&nbsp;hoặc điều kiện kết nối (<code>JOIN</code>)</strong>, điều này có nghĩa là chỉ mục thường không được tìm thấy, không có ý nghĩa và tăng chi phí không gian.</li>
<li><strong>Bảng rất nhỏ</strong>, trong hầu hết các trường hợp, quét toàn bộ bảng đơn giản hơn và hiệu quả hơn cho bảng rất nhỏ.</li>
<li><strong>Bảng cỡ lớn đặc biệt</strong>, chi phí tạo và sử dụng chỉ mục sẽ tăng lên. Có thể xem xét sử dụng kỹ thuật phân vùng hoặc NoSQL.</li>
</ul>
<h2>Cấu trúc dữ liệu của chỉ mục</h2>
<p>Trong MySQL, chỉ mục được thực hiện ở bộ lưu trữ (storage engine), chứ không phải ở lớp máy chủ. Do đó, không có tiêu chuẩn chỉ mục chung; cấu trúc dữ liệu chỉ mục có thể khác nhau cho các storage engine khác nhau.</p>
<h3>Mảng (Array)</h3>
<p>Mảng là một cấu trúc dữ liệu lưu trữ dữ liệu trong một không gian bộ nhớ liên tục và hỗ trợ truy cập ngẫu nhiên.</p>
<p>Mảng được sắp xếp có thể sử dụng thuật toán tìm kiếm nhị phân, có độ phức tạp thời gian là <strong>O(log n)</strong>, cho cả truy vấn bằng giá trị và truy vấn theo phạm vi.</p>
<p>Tuy nhiên, mảng có hai hạn chế quan trọng:</p>
<ul>
<li>Kích thước không gian mảng cố định, nếu cần mở rộng chỉ có thể sử dụng cách sao chép mảng.</li>
<li>Thời gian phức tạp của việc chèn và xóa là O(n).</li>
</ul>
<p>Điều này có nghĩa là, nếu sử dụng mảng làm chỉ mục và muốn đảm bảo mảng được sắp xếp, thì việc cập nhật sẽ tốn kém.</p>
<h3>Chỉ mục băm (Hash Index)</h3>
<p>Bảng băm là một cấu trúc dữ liệu lưu trữ dữ liệu dưới dạng cặp khóa - giá trị (key-value), trong đó chúng ta chỉ cần nhập giá trị cần tìm kiếm là khóa (key), chúng ta sẽ tìm thấy giá trị tương ứng.</p>
<p><strong>Bảng băm</strong>&nbsp;sử dụng&nbsp;<strong>hàm băm</strong>&nbsp;để tổ chức dữ liệu, hỗ trợ việc chèn và tìm kiếm nhanh chóng. Cấu trúc dữ liệu bảng băm thực chất là một mảng, với ý tưởng là: sử dụng hàm băm để chuyển đổi khóa thành chỉ mục mảng, sử dụng tính chất truy cập ngẫu nhiên của mảng, cho phép chúng ta tìm kiếm trong thời gian O(1).</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220320201844.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Có hai loại bảng băm khác nhau:&nbsp;<strong>bảng băm tập hợp</strong>&nbsp;và&nbsp;<strong>bảng băm ánh xạ</strong>.</p>
<ul>
<li><strong>Bảng băm tập hợp</strong>&nbsp;là một cấu trúc dữ liệu để lưu trữ các giá trị không trùng lặp.</li>
<li><strong>Bảng băm ánh xạ</strong>&nbsp;là một cấu trúc dữ liệu để lưu trữ cặp khóa - giá trị, trong đó giá trị được liên kết với khóa.</li>
</ul>
<p>Chỉ mục băm dựa trên bảng băm để triển khai,&nbsp;<strong>chỉ hỗ trợ truy vấn so sánh bằng</strong>. Đối với mỗi hàng dữ liệu, chỉ mục băm sẽ tính toán một mã băm (hashcode) cho tất cả các cột chỉ mục và lưu trữ mã băm trong chỉ mục, đồng thời lưu trữ con trỏ đến mỗi hàng dữ liệu trong bảng băm.</p>
<p>Trong Mysql, chỉ có lưu trữ bộ nhớ (Memory) hiển thị hỗ trợ chỉ mục băm.</p>
<p>✔ Ưu điểm của chỉ mục băm:</p>
<ul>
<li>Vì cấu trúc dữ liệu chỉ mục gọn nhẹ, nên&nbsp;<strong>tốc độ truy vấn rất nhanh</strong>.</li>
</ul>
<p>❌ Nhược điểm của chỉ mục băm:</p>
<ul>
<li>Giá trị chỉ mục không bao gồm giá trị cột, do đó không thể sử dụng giá trị chỉ mục để tránh đọc hàng. Tuy nhiên, việc truy cập hàng trong bộ nhớ nhanh, vì vậy trong hầu hết các trường hợp, điều này không ảnh hưởng đến hiệu suất.</li>
<li>Dữ liệu chỉ mục băm không được sắp xếp theo giá trị chỉ mục, do đó&nbsp;<strong>không thể sử dụng để sắp xếp</strong>.</li>
<li>Chỉ mục băm&nbsp;<strong>không hỗ trợ truy vấn phạm vi</strong>, vì chỉ mục băm sử dụng toàn bộ nội dung cột chỉ mục để tính toán băm. Ví dụ, trên cột dữ liệu (A, B) xây dựng chỉ mục băm, nếu truy vấn chỉ có cột dữ liệu A, không thể sử dụng chỉ mục này.</li>
<li>Chỉ mục băm có thể gặp&nbsp;<strong>xung đột băm</strong>:
<ul>
<li>Khi xảy ra xung đột băm, phải duyệt qua tất cả các con trỏ hàng trong danh sách liên kết, so sánh từng hàng một cho đến khi tìm thấy hàng phù hợp.</li>
<li>Nếu xung đột băm nhiều, việc duy trì chỉ mục sẽ tốn kém.</li>
</ul>
</li>
</ul>
<blockquote>
<p>Vì các hạn chế trên, chỉ mục băm chỉ phù hợp cho các tình huống cụ thể. Tuy nhiên, một khi sử dụng chỉ mục băm, hiệu suất cải thiện sẽ rất đáng kể.</p>
</blockquote>
<h3>Chỉ mục B-Tree</h3>
<p>Thường khi nói về chỉ mục, chúng ta đề cập đến chỉ mục B-Tree, đây là loại chỉ mục phổ biến nhất trong cơ sở dữ liệu quan hệ, hầu hết các động cơ lưu trữ đều hỗ trợ loại chỉ mục này. Từ <code>B-Tree</code> được sử dụng trong MySQL trong các câu lệnh&nbsp;<code>CREATE TABLE</code>&nbsp;hoặc các câu lệnh khác, nhưng thực tế các storage engine khác nhau có thể sử dụng các cấu trúc dữ liệu khác nhau, ví dụ như InnoDB sử dụng <code>B+Tree</code>.</p>
<p>Trong B+Tree, chữ <code>B</code> đề cập đến từ <code>balance</code>, có nghĩa là cân bằng. Cần lưu ý rằng chỉ mục B+Tree không thể tìm ra hàng cụ thể cho một giá trị khóa đã cho, nó chỉ tìm ra trang chứa dòng dữ liệu được tìm kiếm và sau đó cơ sở dữ liệu sẽ đọc trang vào bộ nhớ và tiếp tục tìm kiếm trong bộ nhớ để cuối cùng thu được dữ liệu mong muốn.</p>
<h4>Cây tìm kiếm nhị phân</h4>
<p>Cây tìm kiếm nhị phân có đặc điểm là mỗi nút con trái nhỏ hơn nút cha và nút cha nhỏ hơn nút con phải. Độ phức tạp thời gian truy vấn của nó là $$O(log(N))$$.</p>
<p>Tuy nhiên, để duy trì độ phức tạp truy vấn $$O(log(N))$$, bạn cần đảm bảo rằng cây này là một cây tìm kiếm nhị phân cân bằng. Để đảm bảo điều này, độ phức tạp thời gian cập nhật cũng là $$O(log(N))$$.</p>
<p>Khi dữ liệu trong cơ sở dữ liệu tăng lên, kích thước chỉ mục cũng tăng lên và không thể lưu trữ toàn bộ chỉ mục trong bộ nhớ. Do đó, chỉ mục thường được lưu trữ dưới dạng tệp trên đĩa. Trong quá trình tìm kiếm chỉ mục, sẽ có sự tiêu tốn I/O đĩa, so với truy cập bộ nhớ, tiêu tốn I/O đĩa cao hơn một vài lần. Hãy tưởng tượng xem một cây nhị phân có hàng triệu nút sâu đến đâu? Nếu đặt cây nhị phân có độ sâu lớn như vậy lên đĩa, mỗi lần đọc một nút, sẽ cần một lần đọc I/O đĩa, rõ ràng thời gian tìm kiếm như vậy là không chấp nhận được. Vậy làm thế nào để giảm số lần truy cập I/O trong quá trình tìm kiếm?</p>
<p>Một phương pháp hiệu quả là giảm độ sâu của cây, biến cây nhị phân thành cây nhiều nhánh (multiway search tree), và&nbsp;<strong>B+ tree là một loại cây nhiều nhánh</strong>.</p>
<h4>B+Tree</h4>
<p>B+Tree là một cấu trúc dữ liệu dùng để tạo chỉ mục, phù hợp cho việc tìm kiếm toàn bộ khóa, tìm kiếm phạm vi khóa và tìm kiếm tiền tố khóa. Tuy nhiên, tìm kiếm tiền tố khóa chỉ áp dụng cho việc tìm kiếm tiền tố bên trái.</p>
<p>Để hiểu B+Tree, chỉ cần hiểu hai đặc điểm quan trọng nhất của nó:</p>
<ul>
<li>Thứ nhất, tất cả các khóa (có thể hiểu là dữ liệu) được lưu trữ trong các nút lá, các nút không phải lá không lưu trữ dữ liệu thực sự, tất cả các nút ghi nhận được sắp xếp theo thứ tự giá trị khóa và được lưu trữ trên cùng một tầng nút lá.</li>
<li>Thứ hai, tất cả các nút lá được kết nối bằng con trỏ. Hình ảnh dưới đây là một cây B+ được đơn giản hóa.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200304235424.jpg" alt="b-tree-index" tabindex="0" loading="lazy"><figcaption>b-tree-index</figcaption></figure>
<p>Dựa trên nội dung của các nút lá, loại chỉ mục được chia thành chỉ mục khóa chính và chỉ mục không phải khóa chính.</p>
<ul>
<li><strong>Chỉ mục khóa chính</strong>&nbsp;(clustered index), còn được gọi là chỉ mục chính, chỉ mục cụm, nút lá lưu trữ toàn bộ dữ liệu hàng. Vì không thể lưu trữ hàng dữ liệu ở hai vị trí khác nhau cùng một lúc, nên&nbsp;<strong>một bảng chỉ có thể có một chỉ mục khóa chính</strong>.&nbsp;<strong>Chỉ mục khóa chính của InnoDB thực tế là lưu trữ cả chỉ mục B-Tree và hàng dữ liệu trong cùng một cấu trúc</strong>.</li>
<li>Chỉ mục không phải khóa chính (non-clustered index) lưu trữ giá trị khóa chính tương ứng với khóa. Trong InnoDB, chỉ mục không phải khóa chính còn được gọi là chỉ mục phụ (secondary index). Dữ liệu được lưu trữ ở một vị trí, chỉ mục được lưu trữ ở một vị trí khác, chỉ mục chứa con trỏ đến vị trí dữ liệu. Có thể có nhiều chỉ mục phụ, tối đa 249.</li>
</ul>
<p><strong>Phân cụm (clustered) có nghĩa là các hàng dữ liệu và giá trị khóa liền kề được lưu trữ cùng nhau một cách nhỏ gọn. Do đó việc truy cập nhanh chóng</strong>. Vì không thể lưu trữ hàng dữ liệu trong hai vị trí khác nhau cùng một lúc, nên <strong>một bảng chỉ có thể có một chỉ số cụm</strong>.</p>
<p><strong>Sự khác biệt giữa truy vấn chỉ mục phân cụm và truy vấn chỉ mục không phân cụm</strong></p>
<ul>
<li>Nếu câu lệnh là&nbsp;<code>SELECT * FROM T WHERE ID = 500</code>, tức là truy vấn chỉ mục phân cụm, chỉ cần tìm kiếm B+Tree của ID;</li>
<li>Nếu câu lệnh là&nbsp;<code>SELECT * FROM T WHERE k = 5</code>, tức là truy vấn chỉ mục không phân cụm, cần tìm kiếm cây chỉ mục k trước, tìm giá trị ID là 500, sau đó tìm kiếm cây chỉ mục ID. Quá trình này được gọi là&nbsp;<strong>truy vấn lại</strong>.</li>
</ul>
<p>Nghĩa là,&nbsp;<strong>truy vấn dựa trên chỉ mục không phân cụm cần quét hai cây chỉ mục</strong>. Do đó, chúng ta nên ưu tiên sử dụng truy vấn khóa chính.</p>
<p><strong>Rõ ràng, độ dài khóa chính càng nhỏ thì nút lá chỉ mục không phải khóa chính càng nhỏ, chỉ mục không phân cụm chiếm ít không gian hơn.</strong></p>
<p>Khóa chính tự tăng là khóa chính được định nghĩa trên cột tự tăng, trong câu lệnh tạo bảng thường được định nghĩa như sau: <code>NOT NULL PRIMARY KEY AUTO_INCREMENT</code>. Về mặt hiệu suất và không gian lưu trữ, khóa chính tự tăng thường là lựa chọn hợp lý hơn. Có trường hợp nào phù hợp để sử dụng trường kinh doanh làm khóa chính không? Có. Ví dụ, một số yêu cầu kịch bản kinh doanh như sau:</p>
<ul>
<li>Chỉ có một chỉ mục;</li>
<li>Chỉ mục này phải là chỉ mục duy nhất.</li>
</ul>
<p>Vì không có chỉ mục khác, không cần xem xét vấn đề kích thước nút lá chỉ mục không phải khóa chính.</p>
<p>Lúc này, chúng ta nên ưu tiên áp dụng nguyên tắc "ưu tiên sử dụng truy vấn khóa chính", trực tiếp đặt chỉ mục này làm khóa chính, có thể tránh việc mỗi lần truy vấn đều cần tìm kiếm hai cây.</p>
<h3>Chỉ mục toàn văn bản (Full-Text Index)</h3>
<p>MyISAM hỗ trợ chỉ mục toàn văn bản, được sử dụng để tìm kiếm từ khóa trong văn bản thay vì so sánh trực tiếp. Điều kiện tìm kiếm được sử dụng là <code>MATCH AGAINST</code> thay vì <code>WHERE</code> thông thường.</p>
<p>Chỉ mục toàn văn bản thường sử dụng cấu trúc dữ liệu chỉ mục đảo ngược (inverted index), nó ghi lại ánh xạ từ khóa đến tài liệu chứa nó.</p>
<p>InnoDB Storage Engine hỗ trợ chỉ mục toàn văn bản từ phiên bản MySQL 5.6.4.</p>
<h3>Chỉ mục không gian</h3>
<p>Lưu trữ MyISAM hỗ trợ chỉ mục không gian (R-Tree), được sử dụng để lưu trữ dữ liệu địa lý. Chỉ mục không gian sẽ tổ chức dữ liệu từ tất cả các chiều để tìm kiếm hiệu quả bằng bất kỳ kết hợp nào của các chiều.</p>
<p>Cần sử dụng các hàm liên quan đến GIS để duy trì dữ liệu.</p>
<h2>Các loại chỉ mục</h2>
<p>Các hệ thống cơ sở dữ liệu quan hệ phổ biến thường hỗ trợ các loại chỉ mục sau:</p>
<h3>Chỉ mục khóa chính (<code>PRIMARY</code>)</h3>
<p>Chỉ mục khóa chính: Đây là một loại chỉ mục đặc biệt, không cho phép giá trị trống. Một bảng chỉ có thể có một chỉ mục khóa chính (thực tế là chỉ mục gom cụm trong InnoDB) và thường được tạo cùng với việc tạo bảng.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">` (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    `id`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ...</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    PRIMARY KEY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#98C379;--shiki-dark:#98C379">`id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><h3>Chỉ mục duy nhất (<code>UNIQUE</code>)</h3>
<p>Chỉ mục duy nhất: Các giá trị trong cột chỉ mục phải là duy nhất, nhưng cho phép giá trị trống. Nếu đó là chỉ mục kết hợp, thì sự kết hợp của các giá trị cột phải là duy nhất.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">` (</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ...</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    UNIQUE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> indexName (title(</span><span style="color:#C678DD;--shiki-dark:#C678DD">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">))</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><h3>Chỉ mục thông thường (<code>INDEX</code>)</h3>
<p>Chỉ mục thông thường: Đây là loại chỉ mục cơ bản, không có bất kỳ ràng buộc nào.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">` (</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ...</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    INDEX</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> index_name (title(</span><span style="color:#C678DD;--shiki-dark:#C678DD">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">))</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><h3>Chỉ mục toàn văn (<code>FULLTEXT</code>)</h3>
<p>Chỉ mục toàn văn: Chủ yếu được sử dụng để tìm kiếm từ khóa trong văn bản, thay vì so sánh trực tiếp với các giá trị trong chỉ mục.</p>
<p>Chỉ mục toàn văn khác biệt rất nhiều so với các loại chỉ mục khác, nó giống như một công cụ tìm kiếm hơn là một tham số so sánh trong câu lệnh WHERE. Chỉ mục toàn văn được sử dụng kết hợp với phép toán <code>match against</code>, thay vì sử dụng câu lệnh WHERE thông thường kèm theo LIKE. Chỉ mục toàn văn có thể được sử dụng trong <code>CREATE TABLE</code>, <code>ALTER TABLE</code>, <code>CREATE INDEX</code>, nhưng hiện tại chỉ có thể tạo chỉ mục toàn văn trên các cột kiểu <code>char</code>, <code>varchar</code> và <code>text</code>. Đáng lưu ý là, khi có số lượng dữ liệu lớn, việc đưa dữ liệu vào một bảng không có chỉ mục toàn cục trước, sau đó tạo chỉ mục toàn văn bằng cách sử dụng <code>CREATE INDEX</code> sẽ nhanh hơn việc tạo chỉ mục toàn văn trước khi đưa dữ liệu vào.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">` (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    `content`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> text</span><span style="color:#C678DD;--shiki-dark:#C678DD"> CHARACTER</span><span style="color:#C678DD;--shiki-dark:#C678DD"> NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ...</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    FULLTEXT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (content)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><h3>Chỉ mục kết hợp</h3>
<p>Chỉ mục kết hợp: Đây là chỉ mục được tạo trên nhiều trường, chỉ khi trường đầu tiên trong điều kiện truy vấn sử dụng chỉ mục, chỉ mục mới được sử dụng. Khi sử dụng chỉ mục kết hợp, cần tuân theo tập hợp tiền tố tối đa bên trái.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">` (</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ...</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    INDEX</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> index_name (title(</span><span style="color:#C678DD;--shiki-dark:#C678DD">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">), title(</span><span style="color:#C678DD;--shiki-dark:#C678DD">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">), ...)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><h2>Chiến lược lập chỉ mục</h2>
<p>Giả sử có bảng sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">t</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">` (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  `id`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  `city`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  `name`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  `age`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  `addr`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">128</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">DEFAULT</span><span style="color:#C678DD;--shiki-dark:#C678DD"> NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  PRIMARY KEY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#98C379;--shiki-dark:#98C379">`id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  KEY</span><span style="color:#98C379;--shiki-dark:#98C379"> `city`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#98C379;--shiki-dark:#98C379">`city`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) ENGINE</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">InnoDB;</span></span></code></pre>
</div><h3>Nguyên tắc cơ bản của lập chỉ mục</h3>
<ul>
<li><strong>Không phải càng nhiều chỉ mục càng tốt, không nên tạo chỉ mục cho tất cả các cột</strong>. Cần xem xét chi phí duy trì chỉ mục, không gian chiếm dụng và chi phí của việc truy vấn lại dữ liệu. Chỉ tạo chỉ mục khi cần thiết và cần đảm bảo chỉ mục nhẹ nhàng. Khi tạo chỉ mục kết hợp nhiều cột, cần cố gắng sử dụng chỉ mục để thực hiện truy vấn dữ liệu và giảm thiểu chi phí truy vấn lại dữ liệu.</li>
<li><strong>Tránh tạo chỉ mục trùng lặp và không cần thiết</strong>.</li>
<li><strong>Xem xét xóa các chỉ mục không được sử dụng</strong>.</li>
<li><strong>Mở rộng chỉ mục hiện có thay vì tạo mới chỉ mục</strong>.</li>
<li><strong>Các cột được sử dụng thường xuyên làm điều kiện lọc nên xem xét việc tạo chỉ mục</strong>.</li>
</ul>
<h3>Cột độc lập</h3>
<p><strong>"Cột độc lập" có nghĩa là các cột được lập chỉ mục không thể là một phần của biểu thức, chúng cũng không thể là tham số của hàm</strong>&nbsp;.</p>
<p><strong>Việc thực hiện các phép toán trên trường chỉ mục có thể gây thiệt hại đến tính tuần tự của giá trị chỉ mục, do đó trình tối ưu quyết định từ chối sử dụng chức năng tìm kiếm cây.</strong></p>
<p>Nếu các cột trong truy vấn không phải là các cột độc lập, cơ sở dữ liệu sẽ không sử dụng chỉ mục.</p>
<p>❌ Ví dụ không đúng:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> actor_id </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> actor </span><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> actor_id + </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ... </span><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> TO_DAYS(current_date) - TO_DAYS(date_col) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Chỉ mục che phủ</h3>
<p><strong>Chỉ mục che phủ là chỉ mục mà thông tin trên chỉ mục đủ để đáp ứng yêu cầu truy vấn, không cần truy vấn lại dữ liệu</strong>.</p>
<p>【Ví dụ】Truy vấn phạm vi</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">create</span><span style="color:#C678DD;--shiki-dark:#C678DD"> table</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> T</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">ID </span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#C678DD;--shiki-dark:#C678DD"> primary key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">k </span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#C678DD;--shiki-dark:#C678DD"> NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> DEFAULT</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">s </span><span style="color:#C678DD;--shiki-dark:#C678DD">varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> DEFAULT</span><span style="color:#98C379;--shiki-dark:#98C379"> ''</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">index</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> k(k))</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">engine</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">InnoDB;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">insert into</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> T </span><span style="color:#C678DD;--shiki-dark:#C678DD">values</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'aa'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),(</span><span style="color:#D19A66;--shiki-dark:#D19A66">200</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">'bb'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),(</span><span style="color:#D19A66;--shiki-dark:#D19A66">300</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">'cc'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),(</span><span style="color:#D19A66;--shiki-dark:#D19A66">500</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">'ee'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),(</span><span style="color:#D19A66;--shiki-dark:#D19A66">600</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">'ff'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),(</span><span style="color:#D19A66;--shiki-dark:#D19A66">700</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">'gg'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> T </span><span style="color:#C678DD;--shiki-dark:#C678DD">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> k </span><span style="color:#C678DD;--shiki-dark:#C678DD">between</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#C678DD;--shiki-dark:#C678DD"> and</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span></span></code></pre>
</div><p>Cần thực hiện bao nhiêu lần tìm kiếm cây, quét qua bao nhiêu hàng?</p>
<ol>
<li>Tìm kiếm bản ghi với k=3 trên cây chỉ mục k, lấy ID = 300;</li>
<li>Tìm kiếm bản ghi với ID = 300 trên cây chỉ mục ID, lấy R3;</li>
<li>Tìm kiếm bản ghi với k=5 trên cây chỉ mục k, lấy ID = 500;</li>
<li>Tìm kiếm bản ghi với ID = 500 trên cây chỉ mục ID, lấy R4;</li>
<li>Tìm kiếm bản ghi với k=6 trên cây chỉ mục k, không thỏa mãn điều kiện, kết thúc vòng lặp.</li>
</ol>
<p>Trong quá trình này, quá trình tìm kiếm lại trên cây chỉ mục chính được gọi là truy vấn lại. Có thể thấy, quá trình truy vấn này đọc 3 bản ghi trên cây chỉ mục k (bước 1, 3 và 5) và truy vấn lại hai lần (bước 2 và 4).</p>
<p>Nếu câu lệnh thực hiện là select ID from T where k between 3 and 5, chỉ cần lấy giá trị ID, và giá trị ID đã có trên cây chỉ mục k, do đó có thể trả kết quả truy vấn trực tiếp mà không cần truy vấn lại. Chỉ mục chứa tất cả các giá trị cần truy vấn, được gọi là chỉ mục che phủ.</p>
<p><strong>Do chỉ mục che phủ giảm số lần tìm kiếm cây, đáng kể cải thiện hiệu suất truy vấn, nên sử dụng chỉ mục che phủ là một biện pháp tối ưu hiệu suất phổ biến</strong>.</p>
<h3>Sử dụng chỉ mục để sắp xếp</h3>
<p>MySQL có hai cách để tạo kết quả sắp xếp: thông qua thao tác sắp xếp hoặc quét theo thứ tự chỉ mục.</p>
<p><strong>Chỉ mục tốt là chỉ mục có thể được sử dụng để sắp xếp và tìm kiếm hàng</strong>. Điều này cho phép kết quả được truy xuất trực tiếp từ chỉ mục mà không cần sắp xếp lại.</p>
<p>Khi sử dụng chỉ mục để sắp xếp, cần đảm bảo chỉ mục được chọn đủ để thực hiện truy vấn dữ liệu và giảm thiểu chi phí truy vấn lại dữ liệu.</p>
<p>Quá trình thực hiện truy vấn sẽ như sau:</p>
<ol>
<li>Tìm kiếm bản ghi đầu tiên trong chỉ mục (city, name, age) thỏa mãn điều kiện city='Hà Nội' và lấy giá trị city, name và age làm một phần của kết quả trực tiếp trả về;</li>
<li>Lấy bản ghi tiếp theo từ chỉ mục (city, name, age) và lấy giá trị city, name và age làm một phần của kết quả trực tiếp trả về;</li>
<li>Lặp lại bước 2 cho đến khi tìm thấy bản ghi thứ 1000 hoặc không thỏa mãn điều kiện city='Hà Nội' thì kết thúc vòng lặp.</li>
</ol>
<h3>Chỉ mục tiền tố</h3>
<p>Đôi khi cần tạo chỉ mục cho các cột có độ dài lớn, điều này sẽ làm cho chỉ mục trở nên lớn và chậm.</p>
<p>Trong trường hợp này, có thể sử dụng chỉ mục tiền tố, chỉ lưu trữ một phần đầu của chuỗi, điều này có thể <strong>tiết kiệm không gian chỉ mục đáng kể và cải thiện hiệu suất chỉ mục</strong>. Tuy nhiên, điều này cũng <strong>giảm tính chọn lọc của chỉ mục</strong>. Đối với các cột văn bản như <code>BLOB</code>/<code>TEXT</code>/<code>VARCHAR</code> không thể tạo chỉ mục đầy đủ, vì hầu hết các cơ sở dữ liệu không cho phép tạo chỉ mục đầy đủ cho các cột này.</p>
<p><strong>Tính chọn lọc của chỉ mục</strong> là tỷ lệ giữa các giá trị chỉ mục không trùng nhau và tổng số bản ghi trong bảng dữ liệu. Giá trị tối đa là 1, khi đó mỗi bản ghi có một chỉ mục duy nhất tương ứng. Độ chọn lọc càng cao, hiệu suất truy vấn cũng càng cao. Nếu có nhiều chỉ mục tiền tố khớp với điều kiện, ta phải quét từng cái cho đến khi tìm được bản ghi chính xác cuối cùng.</p>
<p><strong>Sử dụng chỉ mục tiền tố và xác định độ dài, bạn có thể tiết kiệm không gian mà không cần tăng thêm quá nhiều chi phí truy vấn.</strong></p>
<p>Lựa chọn độ dài chỉ mục tiền tố phù hợp làm thế nào?</p>
<p>Có thể sử dụng câu lệnh sau để tính toán số lượng giá trị khác nhau trên cột:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">select</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">distinct</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> email) </span><span style="color:#C678DD;--shiki-dark:#C678DD">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> L </span><span style="color:#C678DD;--shiki-dark:#C678DD">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> SUser;</span></span></code></pre>
</div><p>Sau đó, lần lượt chọn các độ dài tiền tố khác nhau để xem giá trị này, ví dụ: chúng ta muốn xem tiền tố từ 4 đến 7 ký tự, có thể sử dụng câu lệnh sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">select</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">  count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">distinct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(email,</span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)）</span><span style="color:#C678DD;--shiki-dark:#C678DD">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> L4,</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">  count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">distinct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(email,</span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)）</span><span style="color:#C678DD;--shiki-dark:#C678DD">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> L5,</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">  count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">distinct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(email,</span><span style="color:#D19A66;--shiki-dark:#D19A66">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)）</span><span style="color:#C678DD;--shiki-dark:#C678DD">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> L6,</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">  count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">distinct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(email,</span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)）</span><span style="color:#C678DD;--shiki-dark:#C678DD">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> L7,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> SUser;</span></span></code></pre>
</div><p>Tất nhiên, <strong>sử dụng chỉ mục tiền tố có thể làm giảm độ phân biệt</strong>, vì vậy bạn cần thiết lập trước tỷ lệ chấp nhận được của sự giảm này, ví dụ như 5%. Sau đó, trong các kết quả trả về từ L4~L7, hãy tìm các giá trị không nhỏ hơn L * 95%, giả sử ở đây cả L6 và L7 đều thỏa mãn điều kiện này, bạn có thể chọn chiều dài tiền tố là 6.</p>
<p>Ngoài ra, <strong><code>ORDER BY</code> không thể sử dụng chỉ mục tiền tố, không thể sử dụng chỉ mục tiền tố làm chỉ mục che phủ</strong>.</p>
<h3>Nguyên tắc khớp trước tối đa</h3>
<p>Không chỉ là toàn bộ định nghĩa chỉ mục, chỉ cần đáp ứng khớp trước tối đa, chỉ mục có thể được sử dụng để tăng tốc tìm kiếm. Khớp trước tối đa có thể là N cột đầu tiên của chỉ mục kết hợp hoặc M ký tự đầu tiên của chỉ mục chuỗi.</p>
<p>MySQL sẽ tiếp tục khớp từ trái sang phải cho đến khi gặp các truy vấn phạm vi (<code>&gt;</code>,<code>&lt;</code>,<code>BETWEEN</code>,<code>LIKE</code>).</p>
<ul>
<li>Chỉ mục có thể đơn giản như một cột (a) hoặc phức tạp như nhiều cột (a, b, c, d), tức là chỉ mục kết hợp.</li>
<li>Nếu đó là chỉ mục kết hợp, thì khóa cũng bao gồm nhiều cột, đồng thời, chỉ mục chỉ có thể được sử dụng để tìm kiếm khóa có sẵn (bằng nhau), khi gặp truy vấn phạm vi (<code>&gt;</code>,<code>&lt;</code>,<code>BETWEEN</code>,<code>LIKE</code>), nó sẽ không thể khớp tiếp theo, sau đó rơi vào tìm kiếm tuyến tính.</li>
<li>Do đó, <strong>thứ tự cột quyết định số cột có thể khớp được</strong>.</li>
</ul>
<p><strong>Không nên tạo chỉ mục độc lập cho mỗi cột</strong>.</p>
<p><strong>Hãy đặt cột có khả năng chọn lọc cao hoặc cơ sở số lượng lớn ở đầu danh sách các cột kết hợp</strong>. Tuy nhiên, đôi khi cũng cần xem xét các yếu tố như sắp xếp, nhóm và điều kiện phạm vi trong mệnh đề <code>WHERE</code>, những yếu tố này cũng ảnh hưởng đáng kể đến hiệu suất truy vấn.</p>
<p>Ví dụ: <code>a = 1 and b = 2 and c &gt; 3 and d = 4</code>，nếu tạo chỉ mục theo thứ tự (a,b,c,d)，thì d sẽ không được sử dụng chỉ mục. Nếu tạo chỉ mục theo thứ tự (a,b,d,c)，thì cũng có thể sử dụng chỉ mục cho tất cả các cột. Thứ tự a,b,d có thể được sắp xếp theo bất kỳ cách nào.</p>
<p>Hãy đặt cột chỉ mục có tính chọn lọc cao nhất ở phía trước, tính chọn lọc của chỉ mục được hiểu là tỷ lệ giữa giá trị chỉ mục không trùng và tổng số bản ghi. Giá trị tối đa là 1, khi đó mỗi bản ghi sẽ có duy nhất một chỉ mục tương ứng. Độ chọn lọc càng cao thì hiệu suất truy vấn cũng càng cao.</p>
<p>Ví dụ như kết quả hiển thị dưới đây, tính chọn lọc của customer_id có mức độ ưu tiên cao hơn so với staff_id, do đó tốt nhất là để cột customer_id được đặt trước trong chỉ mục kết hợp.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">DISTINCT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> staff_id)/</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(*) </span><span style="color:#C678DD;--shiki-dark:#C678DD">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> staff_id_selectivity,</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">DISTINCT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> customer_id)/</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(*) </span><span style="color:#C678DD;--shiki-dark:#C678DD">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> customer_id_selectivity,</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(*)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> payment;</span></span></code></pre>
</div><div class="language-batch" data-ext="batch" data-title="batch"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">   staff_id_selectivity: 0.0001</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">customer_id_selectivity: 0.0373</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">               COUNT(*): </span><span style="color:#D19A66;--shiki-dark:#D19A66">16049</span></span></code></pre>
</div><h3>Phép = và in có thể không tuân theo thứ tự</h3>
<p><strong>Không cần quan tâm đến thứ tự của <code>=</code> và <code>IN</code></strong>，MySQL sẽ tự động tối ưu thứ tự của các điều kiện này để khớp với số lượng cột chỉ mục càng nhiều càng tốt.</p>
<p>【Ví dụ】Nếu có chỉ mục (a, b, c, d), câu truy vấn có điều kiện <code>c &gt; 3 and b = 2 and a = 1 and d &lt; 4</code> và <code>a = 1 and c &gt; 3 and b = 2 and d &lt; 4</code> đều có thể. MySQL sẽ tự động tối ưu thành <code>a = 1 and b = 2 and c &gt; 3 and d &lt; 4</code>, và tìm kiếm theo thứ tự a, b, c, d.</p>
<h2>Thực hành tốt nhất cho chỉ mục</h2>
<p>Việc tạo chỉ mục không đảm bảo sẽ mang lại hiệu quả. Ví dụ, không tuân thủ chỉ mục tiền tố, nguyên tắc khớp trước tối đa, điều kiện truy vấn liên quan đến tính toán hàm, v.v. đều không thể sử dụng chỉ mục. Ngoài ra, ngay cả khi câu lệnh SQL thỏa mãn điều kiện sử dụng chỉ mục, MySQL cũng sẽ đánh giá chi phí của các phương pháp truy vấn khác nhau để quyết định xem có sử dụng chỉ mục hay không và sử dụng chỉ mục nào.</p>
<p>Do đó, khi cố gắng tối ưu hiệu suất SQL bằng cách sử dụng chỉ mục, hãy chắc chắn xác nhận xem chỉ mục có thể cải thiện hiệu suất thực tế hay không thông qua chiến lược thực thi (<code>EXPLAIN</code>) hoặc hiệu quả thực tế. Nếu có thắc mắc về kế hoạch thực thi được cung cấp bởi <code>EXPLAIN</code>, bạn cũng có thể sử dụng <code>optimizer_trace</code> để xem kế hoạch thực thi chi tiết để phân tích tiếp.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220320201844.png" type="image/png"/>
    </item>
    <item>
      <title>MySQL Opearation</title>
      <link>https://vanhung4499.github.io/database/mysql/opearation.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/opearation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Opearation</source>
      <description>MySQL Operation Nếu công ty của bạn có DBA, thì tôi xin chúc mừng bạn, bạn có thể bỏ qua việc quản trị Mysql. Nếu công ty của bạn không có DBA, hãy học cách thực hiện các hoạt đ...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Nếu công ty của bạn có DBA, thì tôi xin chúc mừng bạn, bạn có thể bỏ qua việc quản trị Mysql. Nếu công ty của bạn không có DBA, hãy học cách thực hiện các hoạt động quản trị cơ bản của Mysql, đó là điều cần thiết để tự bảo vệ mình khi hoạt động trong lĩnh vực này.</p>
</blockquote>
<h2>Cài đặt và triển khai</h2>
<h3>Cài đặt trên Windows</h3>
<p>(1) Tải phiên bản Mysql 5.7 Portable (không cần cài đặt)</p>
<p>Link tải: <a href="https://dev.mysql.com/downloads/mysql/5.7.html#downloads" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/downloads/mysql/5.7.html#downloads</a></p>
<p>(2) Giải nén và tạo file my.ini trong thư mục gốc</p>
<p>Ví dụ file my.ini:</p>
<div class="language-ini line-numbers-mode" data-ext="ini" data-title="ini"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">[mysqld]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Thiết lập cổng 3306</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> 3306</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Thiết lập đường dẫn cài đặt mysql, thay đổi đường dẫn này cho phù hợp với thư mục bạn giải nén</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">basedir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">D:\\Tools\\DB\\mysql\\mysql-5.7.31</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Số kết nối tối đa</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">max_connections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">200</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Mysql sử dụng bộ ký tự mặc định là latin1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">character-set-server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">utf8</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Thiết lập engine lưu trữ mặc định cho bảng mới</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">default-storage-engine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">INNODB</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">[client]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Thiết lập bộ ký tự mặc định cho client mysql</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">default-character-set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">utf8</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) Thực hiện các lệnh cài đặt</p>
<p>Trên cửa sổ CMD, thực hiện lần lượt các lệnh cài đặt sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>cd D:\\Tools\\DB\\mysql\\mysql-5.7.31</span></span>
<span class="line"><span>mysqld --initialize</span></span>
<span class="line"><span>mysqld -install</span></span></code></pre>
</div><p>Giải thích:</p>
<ul>
<li><code>mysqld --initialize</code> sẽ tự động khởi tạo và tạo thư mục data.</li>
<li><code>mysqld -install</code> sẽ cài đặt dịch vụ mysql.</li>
</ul>
<p>(4) Khởi động dịch vụ</p>
<p>Trên cửa sổ CMD, thực hiện lệnh <code>net start mysql</code> để khởi động dịch vụ.</p>
<h3>Cài đặt trên CentOS</h3>
<blockquote>
<p>Bài viết này chỉ giới thiệu cách cài đặt thông qua gói rpm</p>
</blockquote>
<h4>Cài đặt nguồn yum của mysql</h4>
<p>Link tải chính thức: <a href="https://dev.mysql.com/downloads/repo/yum/" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/downloads/repo/yum/</a></p>
<p>(1) Tải gói yum</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">wget</span><span style="color:#98C379;--shiki-dark:#98C379"> https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm</span></span></code></pre>
</div><p>(2) Cài đặt tệp repo yum và cập nhật bộ nhớ cache yum</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">rpm</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -ivh</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql80-community-release-el7-1.noarch.rpm</span></span></code></pre>
</div><p>Kết quả thực hiện:</p>
<p>Sẽ tạo ra hai tệp repo trong thư mục /etc/yum.repos.d/</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> ls</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">grep</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community.repo</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-source.repo</span></span></code></pre>
</div><p>Cập nhật yum:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">yum</span><span style="color:#98C379;--shiki-dark:#98C379"> clean</span><span style="color:#98C379;--shiki-dark:#98C379"> all</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">yum</span><span style="color:#98C379;--shiki-dark:#98C379"> makecache</span></span></code></pre>
</div><p>(3) Kiểm tra trạng thái cài đặt rpm</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> yum</span><span style="color:#98C379;--shiki-dark:#98C379"> search</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">grep</span><span style="color:#98C379;--shiki-dark:#98C379"> server</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-common.i686</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> database</span><span style="color:#98C379;--shiki-dark:#98C379"> common</span><span style="color:#98C379;--shiki-dark:#98C379"> files</span><span style="color:#98C379;--shiki-dark:#98C379"> for</span><span style="color:#98C379;--shiki-dark:#98C379"> server</span><span style="color:#98C379;--shiki-dark:#98C379"> and</span><span style="color:#98C379;--shiki-dark:#98C379"> client</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-common.x86_64</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> database</span><span style="color:#98C379;--shiki-dark:#98C379"> common</span><span style="color:#98C379;--shiki-dark:#98C379"> files</span><span style="color:#98C379;--shiki-dark:#98C379"> for</span><span style="color:#98C379;--shiki-dark:#98C379"> server</span><span style="color:#98C379;--shiki-dark:#98C379"> and</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-test.x86_64</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> Test</span><span style="color:#98C379;--shiki-dark:#98C379"> suite</span><span style="color:#98C379;--shiki-dark:#98C379"> for</span><span style="color:#98C379;--shiki-dark:#98C379"> the</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> database</span><span style="color:#98C379;--shiki-dark:#98C379"> server</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">                       :</span><span style="color:#98C379;--shiki-dark:#98C379"> administering</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> servers</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-server.x86_64</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> A</span><span style="color:#98C379;--shiki-dark:#98C379"> very</span><span style="color:#98C379;--shiki-dark:#98C379"> fast</span><span style="color:#98C379;--shiki-dark:#98C379"> and</span><span style="color:#98C379;--shiki-dark:#98C379"> reliable</span><span style="color:#98C379;--shiki-dark:#98C379"> SQL</span><span style="color:#98C379;--shiki-dark:#98C379"> database</span><span style="color:#98C379;--shiki-dark:#98C379"> server</span></span></code></pre>
</div><p>Sau khi cài đặt mysql bằng yum, sẽ có một số thư mục quan trọng:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>## Tệp cấu hình</span></span>
<span class="line"><span>/etc/my.cnf</span></span>
<span class="line"><span>## Thư mục cơ sở dữ liệu</span></span>
<span class="line"><span>/var/lib/mysql/</span></span>
<span class="line"><span>## Tệp cấu hình</span></span>
<span class="line"><span>/usr/share/mysql (lệnh mysql.server và tệp cấu hình)</span></span>
<span class="line"><span>## Các lệnh liên quan</span></span>
<span class="line"><span>/usr/bin (mysqladmin, mysqldump và các lệnh khác)</span></span>
<span class="line"><span>## Tệp khởi động</span></span>
<span class="line"><span>/usr/lib/systemd/system/mysqld.service (đăng ký dịch vụ systemd)</span></span></code></pre>
</div><p>(4) Cài đặt máy chủ mysql</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">yum</span><span style="color:#98C379;--shiki-dark:#98C379"> install</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql-community-server</span></span></code></pre>
</div><h4>Quản lý dịch vụ mysql</h4>
<p>Sau khi cài đặt mysql bằng yum, sẽ có một dịch vụ systemd có tên <code>mysqld</code>.</p>
<p>Quản lý dịch vụ rất đơn giản:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">## Kiểm tra trạng thái</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> status</span><span style="color:#98C379;--shiki-dark:#98C379"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">## Kích hoạt dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> enable</span><span style="color:#98C379;--shiki-dark:#98C379"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">## Vô hiệu hóa dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> disable</span><span style="color:#98C379;--shiki-dark:#98C379"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">## Khởi động dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> start</span><span style="color:#98C379;--shiki-dark:#98C379"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">## Khởi động lại dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> restart</span><span style="color:#98C379;--shiki-dark:#98C379"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">## Dừng dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> stop</span><span style="color:#98C379;--shiki-dark:#98C379"> mysqld</span></span></code></pre>
</div><h3>Khởi tạo mật khẩu cho cơ sở dữ liệu</h3>
<p>Xem mật khẩu tạm thời:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> grep</span><span style="color:#98C379;--shiki-dark:#98C379"> "password"</span><span style="color:#98C379;--shiki-dark:#98C379"> /var/log/mysqld.log</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2018-09-30T03:13:41.727736Z</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [Note] [MY-010454] [Server] A temporary password is generated </span><span style="color:#C678DD;--shiki-dark:#C678DD">for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> root@localhost: %:lt+srWu4k1</span></span></code></pre>
</div><p>Thực hiện lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -uroot</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66">temporary_password</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span></code></pre>
</div><p>Nhập mật khẩu tạm thời để truy cập vào mysql. Nếu bạn muốn thay đổi mật khẩu, thực hiện lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">ALTER</span><span style="color:#98C379;--shiki-dark:#98C379"> USER</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'@'localhost'</span><span style="color:#98C379;--shiki-dark:#98C379"> IDENTIFIED</span><span style="color:#98C379;--shiki-dark:#98C379"> BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'your_password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Lưu ý: Mật khẩu mặc định có độ mạnh trung bình, bao gồm chữ hoa, chữ thường, chữ số và ký tự đặc biệt. Bạn chỉ có thể thay đổi cấu hình để sử dụng mật khẩu đơn giản hơn sau khi đã thay đổi thành công mật khẩu.</p>
<h3>Cấu hình truy cập từ xa</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">root</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'your_password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ALL </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">ALTER</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'your_password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">FLUSH PRIVILEGES;</span></span></code></pre>
</div><h3>Bỏ qua xác thực đăng nhập</h3>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">vim</span><span style="color:#98C379;--shiki-dark:#98C379"> /etc/my.cnf</span></span></code></pre>
</div><p>Thêm dòng <code>skip-grant-tables</code> dưới phần <code>[mysqld]</code>.</p>
<p>Chức năng này cho phép bỏ qua xác thực đăng nhập, nghĩa là bạn có thể đăng nhập vào root với bất kỳ mật khẩu nào.</p>
<p>Thực hiện <code>systemctl restart mysqld</code> để khởi động lại mysql.</p>
<h3>Kết nối từ máy khách</h3>
<p>Cú pháp: <code>mysql -h&lt;host&gt; -P&lt;port&gt; -u&lt;username&gt; -p&lt;password&gt;</code></p>
<p>Nếu không chỉ định mật khẩu một cách rõ ràng, bạn sẽ được yêu cầu nhập mật khẩu trước khi truy cập.</p>
<p>【Ví dụ】Kết nối đến Mysql cục bộ</p>
<div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -h</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 127.0.0.1</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -P</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3306</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -u</span><span style="color:#98C379;--shiki-dark:#98C379"> root</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Enter</span><span style="color:#98C379;--shiki-dark:#98C379"> password:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Welcome</span><span style="color:#98C379;--shiki-dark:#98C379"> to</span><span style="color:#98C379;--shiki-dark:#98C379"> the</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> monitor.</span><span style="color:#98C379;--shiki-dark:#98C379">  Commands</span><span style="color:#98C379;--shiki-dark:#98C379"> end</span><span style="color:#98C379;--shiki-dark:#98C379"> with</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ; </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">or</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> \g</span><span style="color:#98C379;--shiki-dark:#98C379">.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Your</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> connection</span><span style="color:#98C379;--shiki-dark:#98C379"> id</span><span style="color:#98C379;--shiki-dark:#98C379"> is</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 13501</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Server</span><span style="color:#98C379;--shiki-dark:#98C379"> version:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 8.0.19</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> Community</span><span style="color:#98C379;--shiki-dark:#98C379"> Server</span><span style="color:#98C379;--shiki-dark:#98C379"> -</span><span style="color:#98C379;--shiki-dark:#98C379"> GPL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Copyright</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Oracle</span><span style="color:#98C379;--shiki-dark:#98C379"> is</span><span style="color:#98C379;--shiki-dark:#98C379"> a</span><span style="color:#98C379;--shiki-dark:#98C379"> registered</span><span style="color:#98C379;--shiki-dark:#98C379"> trademark</span><span style="color:#98C379;--shiki-dark:#98C379"> of</span><span style="color:#98C379;--shiki-dark:#98C379"> Oracle</span><span style="color:#98C379;--shiki-dark:#98C379"> Corporation</span><span style="color:#98C379;--shiki-dark:#98C379"> and/or</span><span style="color:#98C379;--shiki-dark:#98C379"> its</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">affiliates.</span><span style="color:#98C379;--shiki-dark:#98C379"> Other</span><span style="color:#98C379;--shiki-dark:#98C379"> names</span><span style="color:#98C379;--shiki-dark:#98C379"> may</span><span style="color:#98C379;--shiki-dark:#98C379"> be</span><span style="color:#98C379;--shiki-dark:#98C379"> trademarks</span><span style="color:#98C379;--shiki-dark:#98C379"> of</span><span style="color:#98C379;--shiki-dark:#98C379"> their</span><span style="color:#98C379;--shiki-dark:#98C379"> respective</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">owners.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Type</span><span style="color:#98C379;--shiki-dark:#98C379"> 'help;'</span><span style="color:#98C379;--shiki-dark:#98C379"> or</span><span style="color:#98C379;--shiki-dark:#98C379"> '\h'</span><span style="color:#98C379;--shiki-dark:#98C379"> for</span><span style="color:#98C379;--shiki-dark:#98C379"> help.</span><span style="color:#98C379;--shiki-dark:#98C379"> Type</span><span style="color:#98C379;--shiki-dark:#98C379"> '\c'</span><span style="color:#98C379;--shiki-dark:#98C379"> to</span><span style="color:#98C379;--shiki-dark:#98C379"> clear</span><span style="color:#98C379;--shiki-dark:#98C379"> the</span><span style="color:#98C379;--shiki-dark:#98C379"> current</span><span style="color:#98C379;--shiki-dark:#98C379"> input</span><span style="color:#98C379;--shiki-dark:#98C379"> statement.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Xem kết nối</h3>
<p>Sau khi kết nối thành công, nếu bạn không có hoạt động tiếp theo, kết nối sẽ ở trạng thái rảnh rỗi và bạn có thể thấy nó trong lệnh <code>show processlist</code>. Nếu máy khách không có hoạt động trong một khoảng thời gian dài, trình kết nối sẽ tự động đóng nó. Thời gian này được điều chỉnh bởi tham số <code>wait_timeout</code>, giá trị mặc định là 8 giờ.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200714115031.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h3>Tạo người dùng</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">username</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'host'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Giải thích:</p>
<ul>
<li>username: Tên người dùng bạn muốn tạo</li>
<li>host: Xác định người dùng có thể đăng nhập từ máy chủ nào. Nếu là người dùng cục bộ, bạn có thể sử dụng localhost. Nếu bạn muốn người dùng có thể đăng nhập từ bất kỳ máy chủ từ xa nào, bạn có thể sử dụng ký tự đại diện <code>%</code>.</li>
<li>password: Mật khẩu đăng nhập của người dùng. Mật khẩu có thể để trống. Nếu để trống, người dùng có thể đăng nhập vào máy chủ mà không cần mật khẩu.</li>
</ul>
<p>Ví dụ:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">dog</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'localhost'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> '123456'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">pig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.1.101_'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENDIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> '123456'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">pig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> '123456'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">pig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> ''</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">pig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Trong Mysql 8, xác thực mặc định không còn là <code>password</code>. Vì vậy, khi tạo người dùng, <code>create user 'username'@'%' identified by 'password';</code> không thể kết nối từ máy khách.</p>
<p>Vì vậy, bạn cần thêm <code>IDENTIFIED WITH mysql_native_password</code>, ví dụ: <code>CREATE USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY '123456';</code></p>
</blockquote>
<h3>Xem người dùng</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xem tất cả người dùng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT DISTINCT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> CONCAT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'User: '''</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, user, </span><span style="color:#98C379;--shiki-dark:#98C379">'''@'''</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, host, </span><span style="color:#98C379;--shiki-dark:#98C379">''';'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> query</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66"> mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Cấp quyền</h3>
<p>Cú pháp:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> privileges </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#D19A66;--shiki-dark:#D19A66"> databasename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">tablename</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'username'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'host'</span></span></code></pre>
</div><p>Giải thích:</p>
<ul>
<li>privileges: Các quyền thực hiện của người dùng, như <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, vv. Nếu muốn cấp tất cả quyền, sử dụng <code>ALL</code>.</li>
<li>databasename: Tên cơ sở dữ liệu.</li>
<li>tablename: Tên bảng. Nếu muốn cấp quyền cho người dùng trên tất cả cơ sở dữ liệu và bảng, bạn có thể sử dụng <code>*.*</code>.</li>
</ul>
<p>Ví dụ:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">INSERT</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ON</span><span style="color:#D19A66;--shiki-dark:#D19A66"> test</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">user</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'pig'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ALL </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'pig'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ALL </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> maindataplus.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'pig'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Lưu ý:</p>
<p>Người dùng được cấp quyền bằng các lệnh trên không thể cấp quyền cho người dùng khác. Nếu bạn muốn cho phép người dùng cấp quyền, sử dụng lệnh sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Cấu hình quyền cụ thể cho người dùng đã chỉ định</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> privileges </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#D19A66;--shiki-dark:#D19A66"> databasename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">tablename</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'username'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'host'</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WITH</span><span style="color:#C678DD;--shiki-dark:#C678DD"> GRANT</span><span style="color:#C678DD;--shiki-dark:#C678DD"> OPTION</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Gán tất cả quyền cho người dùng root</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ALL </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WITH</span><span style="color:#C678DD;--shiki-dark:#C678DD"> GRANT</span><span style="color:#C678DD;--shiki-dark:#C678DD"> OPTION</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Thu hồi quyền</h3>
<p>Cú pháp:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">REVOKE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> privilege </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#D19A66;--shiki-dark:#D19A66"> databasename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">tablename</span><span style="color:#C678DD;--shiki-dark:#C678DD"> FROM</span><span style="color:#98C379;--shiki-dark:#98C379"> 'username'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'host'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Giải thích:</p>
<p>privilege, databasename, tablename: Tương tự như phần cấp quyền.</p>
<p>Ví dụ:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">REVOKE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SELECT</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#98C379;--shiki-dark:#98C379"> 'pig'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Lưu ý:</p>
<p>Nếu bạn đã cấp quyền cho người dùng <code>'pig'@'%'</code> như sau (hoặc tương tự): <code>GRANT SELECT ON test.user TO 'pig'@'%'</code>, thì việc sử dụng lệnh <code>REVOKE SELECT ON *.* FROM 'pig'@'%';</code> sẽ không thu hồi quyền <code>SELECT</code> của người dùng trên bảng <code>user</code> trong cơ sở dữ liệu <code>test</code>. Ngược lại, nếu quyền được cấp bằng <code>GRANT SELECT ON *.* TO 'pig'@'%';</code>, thì lệnh <code>REVOKE SELECT ON test.user FROM 'pig'@'%';</code> cũng không thu hồi quyền <code>SELECT</code> của người dùng trên bảng <code>user</code> trong cơ sở dữ liệu <code>test</code>.</p>
<p>Bạn có thể sử dụng lệnh <code>SHOW GRANTS FOR 'pig'@'%';</code> để xem thông tin chi tiết.</p>
<h3>Xem quyền</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xem quyền của người dùng</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW GRANTS </span><span style="color:#C678DD;--shiki-dark:#C678DD">FOR</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Thay đổi mật khẩu người dùng</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> PASSWORD</span><span style="color:#C678DD;--shiki-dark:#C678DD"> FOR</span><span style="color:#98C379;--shiki-dark:#98C379"> 'username'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'host'</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> PASSWORD</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'newpassword'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Nếu đang đăng nhập với người dùng hiện tại, sử dụng:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> PASSWORD</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> PASSWORD</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"newpassword"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> PASSWORD</span><span style="color:#C678DD;--shiki-dark:#C678DD"> FOR</span><span style="color:#98C379;--shiki-dark:#98C379"> 'pig'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> PASSWORD</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"123456"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>Sao lưu và khôi phục</h3>
<p>Để sao lưu dữ liệu MySQL, chúng ta sử dụng lệnh mysqldump.</p>
<p>Mysqldump sẽ sao lưu dữ liệu trong cơ sở dữ liệu thành một tệp văn bản, cấu trúc bảng và dữ liệu của bảng sẽ được lưu trữ trong tệp văn bản được tạo ra.</p>
<p>Sao lưu:</p>
<h4>Sao lưu một cơ sở dữ liệu</h4>
<p>Cú pháp:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysqldump -h </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -P</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -u</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -p</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD">database</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> [&lt;table1&gt; &lt;table2&gt; ...]</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> backup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">sql</span></span></code></pre>
</div><ul>
<li><strong><code>host</code></strong> - Máy chủ Mysql</li>
<li><strong><code>port</code></strong> - Cổng của máy chủ Mysql</li>
<li><strong><code>username</code></strong> - Tên người dùng cơ sở dữ liệu</li>
<li><strong><code>dbname</code></strong> - Tên cơ sở dữ liệu</li>
<li>Tham số table1 và table2 đại diện cho tên các bảng cần sao lưu, nếu để trống thì sao lưu toàn bộ cơ sở dữ liệu;</li>
<li>Tham số BackupName.sql đại diện cho tên tệp sao lưu được tạo ra, bạn có thể thêm đường dẫn tuyệt đối trước tên tệp. Thông thường, cơ sở dữ liệu được sao lưu thành một tệp có phần mở rộng là sql.</li>
</ul>
<h4>Sao lưu nhiều cơ sở dữ liệu</h4>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysqldump -u </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -p </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">--databases &lt;database1&gt; &lt;database2&gt; ... &gt; backup.sql</span></span></code></pre>
</div><h4>Sao lưu tất cả cơ sở dữ liệu</h4>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysqldump -u </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -p </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">--all-databases &gt; backup.sql</span></span></code></pre>
</div><h4>Khôi phục một cơ sở dữ liệu</h4>
<p>Để khôi phục dữ liệu MySQL, chúng ta sử dụng lệnh mysql.</p>
<p>Cú pháp:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql -h </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -P</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -u</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -p</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD">database</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> backup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">sql</span></span></code></pre>
</div><h4>Khôi phục tất cả cơ sở dữ liệu</h4>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql -u</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -p </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">--all-databases &lt; backup.sql</span></span></code></pre>
</div><h3>Gỡ cài đặt</h3>
<p>(1) Xem MySQL đã được cài đặt</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> rpm</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -qa</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">grep</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -i</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">perl-DBD-MySQL-4.023-6.el7.x86_64</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql80-community-release-el7-1.noarch</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-common-8.0.12-1.el7.x86_64</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-client-8.0.12-1.el7.x86_64</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-libs-compat-8.0.12-1.el7.x86_64</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-libs-8.0.12-1.el7.x86_64</span></span></code></pre>
</div><p>(2) Gỡ cài đặt MySQL</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">yum</span><span style="color:#98C379;--shiki-dark:#98C379"> remove</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql-community-server.x86_64</span></span></code></pre>
</div><h3>Triển khai Master-Slave</h3>
<p>Giả sử bạn cần cấu hình một môi trường máy chủ Master-Slave cho MySQL:</p>
<ul>
<li>Node Master: 192.168.8.10</li>
<li>Node Slave: 192.168.8.11</li>
</ul>
<h4>Các bước trên Node Master</h4>
<p>(1) Sửa đổi cấu hình và khởi động lại</p>
<p>Chạy lệnh <code>vi /etc/my.cnf</code> và thêm cấu hình sau:</p>
<div class="language-ini" data-ext="ini" data-title="ini"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">[mysqld]</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">server-id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">log_bin</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">/var/lib/mysql/binlog</span></span></code></pre>
</div><ul>
<li><code>server-id</code> - Số ID của máy chủ. Trong kiến trúc Master-Slave, mỗi máy phải có một ID duy nhất.</li>
<li><code>log_bin</code> - Đường dẫn và tên tệp nhật ký đồng bộ, hãy đảm bảo rằng thư mục này có quyền ghi cho MySQL;</li>
</ul>
<p>Sau khi chỉnh sửa, khởi động lại MySQL để áp dụng cấu hình mới:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">systemctl </span><span style="color:#C678DD;--shiki-dark:#C678DD">restart</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql</span></span></code></pre>
</div><p>(2) Tạo người dùng cho đồng bộ hoá</p>
<p>Truy cập vào bảng điều khiển MySQL:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>$ mysql -u root -p</span></span>
<span class="line"><span>Password:</span></span></code></pre>
</div><p>Thực hiện các câu lệnh SQL sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- a. Tạo người dùng slave</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Cấp quyền REPLICATION SLAVE cho slave</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'slave'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- b. Hoặc, tạo người dùng slave và cho phép người dùng đăng nhập từ bất kỳ máy chủ nào</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Nếu có nhiều slave và bạn muốn tất cả các slave sử dụng cùng một tên người dùng và mật khẩu, bạn có thể sử dụng cách này</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'slave'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Làm mới thông tin bảng phân quyền</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">FLUSH PRIVILEGES;</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Trong MySQL 8, phương thức xác thực mặc định không còn là <code>password</code>. Vì vậy, khi tạo người dùng, <code>create user 'username'@'%' identified by 'password';</code> không thể kết nối từ máy khách. Vì vậy, bạn cần thêm <code>IDENTIFIED WITH mysql_native_password BY 'password'</code> khi tạo người dùng.</p>
</blockquote>
<p>SQL quản lý người dùng bổ sung:</p>
<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xem tất cả người dùng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT DISTINCT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> CONCAT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'User: '''</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, user, </span><span style="color:#98C379;--shiki-dark:#98C379">'''@'''</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, host, </span><span style="color:#98C379;--shiki-dark:#98C379">''';'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> query</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66"> mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xem quyền của người dùng</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW GRANTS </span><span style="color:#C678DD;--shiki-dark:#C678DD">FOR</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Tạo người dùng</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- a. Tạo người dùng slave và chỉ cho phép người dùng đăng nhập từ máy chủ 192.168.8.11</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.8.11'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Cấp quyền REPLICATION SLAVE cho slave</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'slave'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.8.11'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xóa người dùng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#98C379;--shiki-dark:#98C379"> 'slave'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.8.11'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) Thêm khóa đọc</p>
<p>Để đảm bảo dữ liệu trên máy chủ chính và máy chủ phụ giữ nguyên, chúng ta sẽ thêm khóa đọc cho MySQL, biến nó thành chỉ có thể đọc.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> FLUSH TABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#C678DD;--shiki-dark:#C678DD"> READ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> LOCK;</span></span></code></pre>
</div><p>(4) Xem trạng thái của máy chủ chính</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> show </span><span style="color:#C678DD;--shiki-dark:#C678DD">master</span><span style="color:#C678DD;--shiki-dark:#C678DD"> status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">+</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200714115031.png" type="image/png"/>
    </item>
    <item>
      <title>MySQL Optimization</title>
      <link>https://vanhung4499.github.io/database/mysql/optimization.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/optimization.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Optimization</source>
      <description>MySQL Optimization Slow Query (Truy vấn chậm) Nhật ký truy vấn chậm có thể giúp chúng ta tìm ra các câu lệnh SQL thực thi chậm. Bạn có thể kiểm tra xem nhật ký truy vấn chậm có ...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Slow Query (Truy vấn chậm)</h2>
<p>Nhật ký truy vấn chậm có thể giúp chúng ta tìm ra các câu lệnh SQL thực thi chậm.</p>
<p>Bạn có thể kiểm tra xem nhật ký truy vấn chậm có được bật hay không bằng cách sử dụng lệnh sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> show variables </span><span style="color:#C678DD;--shiki-dark:#C678DD">like</span><span style="color:#98C379;--shiki-dark:#98C379"> '%slow_query_log%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">+</span></span></code></pre>
</div>]]></content:encoded>
    </item>
    <item>
      <title>MySQL Overview</title>
      <link>https://vanhung4499.github.io/database/mysql/overview.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/overview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Overview</source>
      <description>MySQL Overview Contents</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Contents</h2>
]]></content:encoded>
    </item>
    <item>
      <title>MySQL Replication</title>
      <link>https://vanhung4499.github.io/database/mysql/replication.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/replication.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Replication</source>
      <description>MySQL Replication Replication Replication là một phương pháp phổ biến để giải quyết vấn đề có sẵn cao của hệ thống. Ý tưởng cơ bản là: không nên để tất cả trứng vào một giỏ. Vấn...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Replication</h2>
<p>Replication là một phương pháp phổ biến để giải quyết vấn đề có sẵn cao của hệ thống. Ý tưởng cơ bản là: không nên để tất cả trứng vào một giỏ.</p>
<p>Vấn đề cơ bản mà replication giải quyết là đồng bộ hóa dữ liệu của một máy chủ với các máy chủ khác. Dữ liệu từ một máy chủ chính có thể được replication đến nhiều máy chủ dự phòng, và các máy chủ dự phòng có thể được cấu hình thành một máy chủ chính cho một máy chủ khác. Có nhiều cách khác nhau để kết hợp máy chủ chính và máy chủ dự phòng.</p>
<p>MySQL hỗ trợ hai phương pháp replication: replication dựa trên hàng và replication dựa trên câu lệnh. Cả hai phương pháp đều sử dụng cách ghi lại bin log trên máy chủ chính và chạy lại log trên máy chủ dự phòng để thực hiện replication dữ liệu bất đồng bộ. Điều này có nghĩa là quá trình replication có độ trễ và trong khoảng thời gian này, dữ liệu giữa máy chủ chính và máy chủ phụ có thể không đồng nhất.</p>
<h3>Cách thức hoạt động của replication</h3>
<p>Trong MySQL, quá trình replication được chia thành ba bước, mỗi bước do một luồng hoàn thành:</p>
<ul>
<li><strong>Luồng binlog dump</strong> - Trên máy chủ chính có một luồng đặc biệt gọi là luồng binlog dump, chịu trách nhiệm ghi các thay đổi dữ liệu từ máy chủ chính vào binlog.</li>
<li><strong>Luồng I/O</strong> - Trên máy chủ dự phòng có một luồng I/O, chịu trách nhiệm đọc binlog từ máy chủ chính và ghi vào log trung gian (relay log) của máy chủ dự phòng.</li>
<li><strong>Luồng SQL</strong> - Trên máy chủ dự phòng có một luồng SQL, chịu trách nhiệm đọc log trung gian (relay log) và thực hiện lại các câu lệnh SQL từ đó.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624154231.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Kiến ​​trúc này giải quyết vấn đề giải phóng dữ liệu và đồng bộ hóa dữ liệu bất đồng bộ. Tuy nhiên, kiến ​​trúc này cũng giới hạn quá trình replication, điểm quan trọng nhất là các truy vấn đang chạy song song trên máy chủ chính phải được thực hiện tuần tự trên máy chủ dự phòng, vì chỉ có một luồng SQL để chạy lại các sự kiện trong relay log.</p>
<h3>Cấu hình replication Master-Slave</h3>
<p>Giả sử bạn cần cấu hình một cặp nút MySQL Master-Slave với môi trường sau đây:</p>
<ul>
<li>Nút Master: 192.168.8.10</li>
<li>Nút Slave: 192.168.8.11</li>
</ul>
<h4>Các bước trên nút Master</h4>
<ol>
<li>
<p><strong>Sửa đổi cấu hình và khởi động lại</strong></p>
<p>Sử dụng lệnh <code>vi /etc/my.cnf</code>, thêm các cấu hình sau:</p>
</li>
</ol>
<div class="language-ini" data-ext="ini" data-title="ini"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">[mysqld]</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">server-id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">log_bin</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">/var/lib/mysql/binlog</span></span></code></pre>
</div><ul>
<li><code>server-id</code> - ID duy nhất của máy chủ trong kiến ​​trúc Master-Slave.</li>
<li><code>log_bin</code> - Đường dẫn và tên tập tin log để đồng bộ, đảm bảo thư mục này có quyền ghi của MySQL.</li>
</ul>
<p>Sau khi chỉnh sửa, khởi động lại MySQL để cập nhật cấu hình:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> restart</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql</span></span></code></pre>
</div><ol start="2">
<li><strong>Tạo người dùng đồng bộ</strong></li>
</ol>
<p>Truy cập vào MySQL console:</p>
<div class="language-sh" data-ext="sh" data-title="sh"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -u</span><span style="color:#98C379;--shiki-dark:#98C379"> root</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Password:</span></span></code></pre>
</div><p>Thực thi các lệnh SQL sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- a. Tạo người dùng 'slave' có thể đăng nhập từ bất kỳ địa chỉ IP nào</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">   CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">   GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'slave'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">   -- b. Hoặc, tạo người dùng 'slave' có thể đăng nhập từ một địa chỉ IP cụ thể</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">   CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.8.11'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">   GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'slave'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.8.11'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">   -- Làm mới lại các quyền</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">   FLUSH PRIVILEGES;</span></span></code></pre>
</div><p>Để đảm bảo tương thích với MySQL 8 trở lên, sử dụng <code>mysql_native_password</code> cho phương thức xác thực.</p>
<ol start="3">
<li><strong>Khóa đọc</strong></li>
</ol>
<p>Để đồng bộ dữ liệu giữa Master và Slave, khóa đọc trên Master:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">   mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> FLUSH TABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#C678DD;--shiki-dark:#C678DD"> READ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> LOCK;</span></span></code></pre>
</div><ol start="4">
<li><strong>Xem trạng thái của Master</strong></li>
</ol>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">   mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> SHOW </span><span style="color:#C678DD;--shiki-dark:#C678DD">MASTER</span><span style="color:#C678DD;--shiki-dark:#C678DD"> STATUS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">   +</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624154231.png" type="image/png"/>
    </item>
    <item>
      <title>MySQL Transaction</title>
      <link>https://vanhung4499.github.io/database/mysql/transaction.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/transaction.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Transaction</source>
      <description>MySQL Transaction Không phải tất cả các engine lưu trữ của MySQL đều hỗ trợ giao dịch. Các engine lưu trữ hỗ trợ giao dịch bao gồm: InnoDB và NDB Cluster. Các engine lưu trữ khô...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Không phải tất cả các engine lưu trữ của MySQL đều hỗ trợ giao dịch. Các engine lưu trữ hỗ trợ giao dịch bao gồm:&nbsp;<code>InnoDB</code>&nbsp;và&nbsp;<code>NDB Cluster</code>. Các engine lưu trữ không hỗ trợ giao dịch bao gồm:&nbsp;<code>MyISAM</code>.</p>
<p>Người dùng có thể chọn engine lưu trữ phù hợp dựa trên việc có cần xử lý giao dịch hay không (xử lý giao dịch có thể đảm bảo an toàn dữ liệu nhưng sẽ tăng chi phí hệ thống).</p>
</blockquote>
<h2>Giới thiệu về giao dịch</h2>
<blockquote>
<p>Giao dịch đơn giản là:&nbsp;<strong>Tất cả các hoạt động trong một phiên làm việc phải thành công hoặc thất bại cùng nhau</strong>. Cụ thể hơn, giao dịch là một nhóm các hoạt động tuân thủ các đặc điểm ACID, có thể được gửi đi bằng cách sử dụng&nbsp;<code>Commit</code>&nbsp;để xác nhận giao dịch hoặc sử dụng&nbsp;<code>Rollback</code>&nbsp;để hoàn tác giao dịch.</p>
</blockquote>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/185b9c49-4c13-4241-a848-fbff85c03a64.png" alt="185b9c49-4c13-4241-a848-fbff85c03a64.png" tabindex="0" loading="lazy"><figcaption>185b9c49-4c13-4241-a848-fbff85c03a64.png</figcaption></figure>
<p><strong>Giao dịch là một nhóm các câu lệnh SQL nguyên tử</strong>. Cụ thể hơn, giao dịch là một nhóm các hoạt động tuân thủ các đặc điểm ACID.</p>
<p><strong>Các câu lệnh SQL trong giao dịch phải được thực thi hoàn toàn thành công hoặc thất bại hoàn toàn</strong>.</p>
<p><strong>Các cơ chế cách ly giao dịch khác nhau có thể được thực hiện bằng cách sử dụng khóa</strong>.</p>
<p>Hãy tưởng tượng nếu không có giao dịch, trong môi trường đồng thời, có thể xảy ra việc mất mát thay đổi.</p>
<p>Hai luồng T1&nbsp;và T2&nbsp;đều thay đổi dữ liệu, T1&nbsp;thay đổi trước, T2&nbsp;thay đổi sau, thay đổi của T2&nbsp;ghi đè lên thay đổi của T1.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002023.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h2>Cách sử dụng giao dịch</h2>
<h3>Các lệnh xử lý giao dịch</h3>
<p>Trong MySQL, sử dụng câu lệnh&nbsp;<code>START TRANSACTION</code>&nbsp;để bắt đầu một giao dịch; sử dụng câu lệnh&nbsp;<code>COMMIT</code>&nbsp;để xác nhận tất cả các thay đổi; sử dụng câu lệnh&nbsp;<code>ROLLBACK</code>&nbsp;để hoàn tác tất cả các thay đổi. Không thể hoàn tác câu lệnh&nbsp;<code>SELECT</code>, việc hoàn tác câu lệnh&nbsp;<code>SELECT</code>&nbsp;cũng không có ý nghĩa; cũng không thể hoàn tác câu lệnh&nbsp;<code>CREATE</code>&nbsp;và&nbsp;<code>DROP</code>.</p>
<ul>
<li><code>START TRANSACTION</code>&nbsp;- Câu lệnh dùng để đánh dấu điểm bắt đầu của giao dịch.</li>
<li><code>SAVEPOINT</code>&nbsp;- Câu lệnh dùng để tạo điểm lưu trữ.</li>
<li><code>ROLLBACK TO</code>&nbsp;- Câu lệnh dùng để hoàn tác đến điểm lưu trữ đã chỉ định; nếu không có điểm lưu trữ được đặt, nó sẽ hoàn tác đến câu lệnh&nbsp;<code>START TRANSACTION</code>.</li>
<li><code>COMMIT</code>&nbsp;- Xác nhận giao dịch.</li>
</ul>
<p>Ví dụ xử lý giao dịch:</p>
<p>(1) Tạo một bảng ví dụ</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xóa bảng user nếu tồn tại</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> IF</span><span style="color:#C678DD;--shiki-dark:#C678DD"> EXISTS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> user;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Tạo bảng user</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  id </span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) unsigned </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379">'Id'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  username </span><span style="color:#C678DD;--shiki-dark:#C678DD">varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">64</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> DEFAULT</span><span style="color:#98C379;--shiki-dark:#98C379"> 'default'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379">'Tên đăng nhập'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  password</span><span style="color:#C678DD;--shiki-dark:#C678DD"> varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">64</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> DEFAULT</span><span style="color:#98C379;--shiki-dark:#98C379"> 'default'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379">'Mật khẩu'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  email </span><span style="color:#C678DD;--shiki-dark:#C678DD">varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">64</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> DEFAULT</span><span style="color:#98C379;--shiki-dark:#98C379"> 'default'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379">'Email'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) COMMENT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'Bảng người dùng'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>(2) Thực hiện các hoạt động giao dịch</p>
<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Bắt đầu giao dịch</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">START TRANSACTION</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Thực hiện hoạt động A</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#98C379;--shiki-dark:#98C379"> `user`</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'root1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'root1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'xxxx@163.com'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Tạo điểm lưu trữ updateA</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SAVEPOINT updateA;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Thực hiện hoạt động B</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#98C379;--shiki-dark:#98C379"> `user`</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'root2'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'root2'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'xxxx@163.com'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Hoàn tác đến điểm lưu trữ updateA</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">ROLLBACK</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> updateA;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xác nhận giao dịch, chỉ hoạt động A được áp dụng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">COMMIT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) Kết quả thực thi</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> user;</span></span></code></pre>
</div><p>Kết quả:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>1	root1	root1	xxxx@163.com</span></span></code></pre>
</div><h3>AUTOCOMMIT</h3>
<p><strong>Mặc định, MySQL sử dụng chế độ xác nhận ngầm (<code>autocommit</code>)</strong>. Mỗi câu lệnh được thực thi được coi là một giao dịch và được xác nhận. Khi gặp câu lệnh&nbsp;<code>START TRANSACTION</code>, chế độ xác nhận ngầm sẽ bị tắt; sau khi thực hiện câu lệnh&nbsp;<code>COMMIT</code>&nbsp;hoặc&nbsp;<code>ROLLBACK</code>, giao dịch sẽ tự động đóng và chế độ xác nhận ngầm sẽ được khôi phục.</p>
<p>Bằng cách sử dụng&nbsp;<code>set autocommit=0</code>, bạn có thể hủy bỏ xác nhận tự động cho đến khi&nbsp;<code>set autocommit=1</code>&nbsp;được thực hiện; cờ&nbsp;<code>autocommit</code>&nbsp;được áp dụng cho mỗi kết nối chứ không phải cho máy chủ.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xem cờ AUTOCOMMIT</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW VARIABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD">LIKE</span><span style="color:#98C379;--shiki-dark:#98C379"> 'AUTOCOMMIT'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Tắt AUTOCOMMIT</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> autocommit </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Bật AUTOCOMMIT</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> autocommit </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h1>ACID</h1>
<p>ACID là bốn yếu tố cơ bản để đảm bảo thực hiện giao dịch đúng đắn trong cơ sở dữ liệu.</p>
<ul>
<li><strong>Tính nguyên tử (Atomicity)</strong>
<ul>
<li>Giao dịch được coi là đơn vị nhỏ nhất không thể chia tách, tất cả các hoạt động trong giao dịch phải được thực hiện hoàn toàn thành công hoặc hoàn toàn thất bại.</li>
<li>Rollback có thể được thực hiện bằng cách sử dụng nhật ký, nhật ký ghi lại các thay đổi được thực hiện trong giao dịch và thực hiện ngược lại các thay đổi này khi rollback.</li>
</ul>
</li>
<li><strong>Tính nhất quán (Consistency)</strong>
<ul>
<li>Cơ sở dữ liệu duy trì trạng thái nhất quán trước và sau khi thực hiện giao dịch.</li>
<li>Trong trạng thái nhất quán, kết quả đọc của tất cả các giao dịch đối với một dữ liệu là giống nhau.</li>
</ul>
</li>
<li><strong>Tính cô lập (Isolation)</strong>
<ul>
<li>Sự thay đổi mà một giao dịch thực hiện không được nhìn thấy bởi các giao dịch khác cho đến khi nó được cam kết.</li>
</ul>
</li>
<li><strong>Tính bền vững (Durability)</strong>
<ul>
<li>Khi một giao dịch được cam kết, các thay đổi mà nó thực hiện sẽ được lưu trữ vĩnh viễn trong cơ sở dữ liệu. Ngay cả khi hệ thống gặp sự cố, kết quả của giao dịch vẫn không bị mất.</li>
<li>Điều này có thể được đạt được bằng sao lưu và khôi phục cơ sở dữ liệu, trong trường hợp hệ thống gặp sự cố.</li>
</ul>
</li>
</ul>
<p><strong>Hệ thống cơ sở dữ liệu hỗ trợ giao dịch phải có bốn tính chất này, nếu không, không thể đảm bảo tính chính xác của dữ liệu trong quá trình giao dịch.</strong></p>
<ul>
<li>Chỉ khi tuân thủ tính nhất quán, kết quả thực hiện của giao dịch mới là chính xác.</li>
<li>Trong trường hợp không có sự cạnh tranh, khi giao dịch được thực hiện tuần tự, tính cô lập sẽ được đảm bảo. Khi đó, chỉ cần đảm bảo tính nguyên tử, tính nhất quán cũng sẽ được đảm bảo.</li>
<li>Trong trường hợp có sự cạnh tranh, khi nhiều giao dịch được thực hiện song song, giao dịch không chỉ cần đảm bảo tính nguyên tử mà còn cần đảm bảo tính cô lập để đảm bảo tính nhất quán.</li>
<li>Tính bền vững của giao dịch là để xử lý trường hợp hệ thống gặp sự cố.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/acid.png" alt="acid.png" tabindex="0" loading="lazy"><figcaption>acid.png</figcaption></figure>
<blockquote>
<p>Mysql mặc định sử dụng chế độ tự động cam kết (<code>AUTO COMMIT</code>). Điều này có nghĩa là nếu không sử dụng rõ ràng câu lệnh&nbsp;<code>START TRANSACTION</code>&nbsp;để bắt đầu một giao dịch, mỗi câu lệnh truy vấn sẽ được coi là một giao dịch và tự động cam kết.</p>
</blockquote>
<h2>Các cấp độ cô lập giao dịch</h2>
<h3>Giới thiệu về cấp độ cô lập giao dịch</h3>
<p>Trong môi trường đồng thời, rất khó đảm bảo tính cô lập của giao dịch, do đó sẽ xuất hiện nhiều vấn đề về tính nhất quán:</p>
<ul>
<li><strong>Mất mát thay đổi</strong></li>
<li><strong>Đọc bẩn (Dirty Read)</strong></li>
<li><strong>Đọc không nhất quán (Non-Repeatable Read)</strong></li>
<li><strong>Đọc ảo (Phantom Read)</strong></li>
</ul>
<p>Trong tiêu chuẩn SQL, xác định bốn cấp độ cô lập giao dịch (từ thấp đến cao):</p>
<ul>
<li><strong>Đọc chưa cam kết (Read Uncommitted)</strong></li>
<li><strong>Đọc đã cam kết (Read Committed)</strong></li>
<li><strong>Đọc lặp lại (Repeatable Read)</strong></li>
<li><strong>Serializable (Serializable)</strong></li>
</ul>
<p>Xem và thiết lập cấp độ cô lập giao dịch trong MySQL:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xem cấp độ cô lập giao dịch</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW VARIABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD">LIKE</span><span style="color:#98C379;--shiki-dark:#98C379"> 'transaction_isolation'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Thiết lập cấp độ cô lập giao dịch là READ UNCOMMITTED</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SESSION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> READ</span><span style="color:#C678DD;--shiki-dark:#C678DD"> UNCOMMITTED</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Thiết lập cấp độ cô lập giao dịch là READ COMMITTED</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SESSION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> READ</span><span style="color:#C678DD;--shiki-dark:#C678DD"> COMMITTED</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Thiết lập cấp độ cô lập giao dịch là REPEATABLE READ</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SESSION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> REPEATABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> READ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Thiết lập cấp độ cô lập giao dịch là SERIALIZABLE</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SESSION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SERIALIZABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Đọc chưa cam kết</h3>
<p><strong><code>Đọc chưa cam kết (Read Uncommitted)</code></strong>&nbsp;có nghĩa là: Các thay đổi trong giao dịch, ngay cả khi chưa được cam kết, cũng có thể nhìn thấy bởi các giao dịch khác.</p>
<p>Vấn đề của đọc chưa cam kết: Giao dịch có thể đọc dữ liệu chưa được cam kết, còn được gọi là&nbsp;<strong>đọc bẩn (Dirty Read)</strong>.</p>
<p>T1&nbsp;thay đổi một dữ liệu, T2&nbsp;sau đó đọc dữ liệu này. Nếu T1&nbsp;hủy bỏ thay đổi này, thì dữ liệu đọc bởi T2&nbsp;là dữ liệu bẩn.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202307210021321.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h3>Đọc đã cam kết</h3>
<p><strong><code>Đọc đã cam kết (Read Committed)</code></strong>&nbsp;có nghĩa là: Các thay đổi trong giao dịch chỉ có thể nhìn thấy bởi các giao dịch khác sau khi đã được cam kết. Nó giải quyết vấn đề đọc dơ bẩn.</p>
<p>Đọc đã cam kết là cấp độ cô lập mặc định của hầu hết các cơ sở dữ liệu.</p>
<p>Vấn đề của đọc đã cam kết: Khi thực hiện hai lần truy vấn giống nhau, kết quả có thể không nhất quán.</p>
<p>T2&nbsp;đọc một dữ liệu, T1&nbsp;thay đổi dữ liệu này. Nếu T2&nbsp;đọc dữ liệu này lần nữa, kết quả đọc sẽ khác với kết quả đọc lần đầu.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002326.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h3>Đọc lặp lại</h3>
<p><strong><code>Đọc lặp lại (Repeatable Read)</code></strong>&nbsp;có nghĩa là: Đảm bảo kết quả của việc đọc nhiều lần cùng một dữ liệu trong cùng một giao dịch là giống nhau. Đọc lặp lại giải quyết vấn đề đọc không nhất quán.</p>
<p>Đọc lặp lại là cấp độ cô lập mặc định của MySQL.</p>
<p>Vấn đề của đọc lặp lại: Khi một giao dịch T1 đọc một phạm vi dữ liệu, giao dịch T2 chèn một bản ghi mới vào phạm vi đó, sau đó giao dịch T1 đọc lại phạm vi dữ liệu này, kết quả đọc sẽ khác với kết quả đọc lần đầu, được gọi là&nbsp;<strong>đọc ảo (Phantom Read)</strong>.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002333.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h3>Tuần tự hoá</h3>
<p><strong><code>Tuần tự hoá (Serializable)</code></strong>&nbsp;có nghĩa là: Buộc giao dịch thực hiện tuần tự, khóa đọc và ghi cho cùng một hàng dữ liệu. Nếu xảy ra xung đột khóa, giao dịch phía trước phải chờ giao dịch phía sau giải phóng khóa.</p>
<p>Thực hiện giao dịch tuần tự sẽ tránh tất cả các vấn đề đồng thời. Chiến lược tuần tự hóa sẽ khóa từng hàng dữ liệu được đọc, điều này có thể dẫn đến nhiều thời gian chờ và cạnh tranh khóa. Điều này gần như không thể chấp nhận được đối với các ứng dụng có độ tải cao, vì vậy thường không sử dụng cấp độ này.</p>
<h3>Tóm tắt về các cấp độ cô lập</h3>
<ul>
<li><strong><code>Đọc chưa cam kết (Read Uncommitted)</code></strong>&nbsp;- Các thay đổi trong giao dịch, ngay cả khi chưa được cam kết, cũng có thể nhìn thấy bởi các giao dịch khác.</li>
<li><strong><code>Đọc đã cam kết (Read Committed)</code></strong>&nbsp;- Các thay đổi trong giao dịch chỉ có thể nhìn thấy bởi các giao dịch khác sau khi đã được cam kết.</li>
<li><strong><code>Đọc lặp lại (Repeatable Read)</code></strong>&nbsp;- Đảm bảo kết quả của việc đọc nhiều lần cùng một dữ liệu trong cùng một giao dịch là giống nhau.</li>
<li><strong><code>Tuần tự hoá (Serializable)</code></strong>&nbsp;- Buộc giao dịch thực hiện tuần tự, khóa đọc và ghi cho cùng một hàng dữ liệu.</li>
</ul>
<p>Các vấn đề được giải quyết bởi các cấp độ cô lập giao dịch:</p>
<p>| Cấp độ cô lập | Mất mát thay đổi | Đọc bẩn | Đọc không nhất quán | Đọc ảo |<br>
| :</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/185b9c49-4c13-4241-a848-fbff85c03a64.png" type="image/png"/>
    </item>
    <item>
      <title>Redis</title>
      <link>https://vanhung4499.github.io/database/redis/</link>
      <guid>https://vanhung4499.github.io/database/redis/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Redis In Action</title>
      <link>https://vanhung4499.github.io/database/redis/action.html</link>
      <guid>https://vanhung4499.github.io/database/redis/action.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis In Action</source>
      <description>Redis in action Redis có thể được áp dụng trong nhiều tình huống, dưới đây là một số tình huống sử dụng phổ biến. Bộ nhớ đệm Bộ nhớ đệm là kịch bản ứng dụng phổ biến nhất của Re...</description>
      <category>db</category>
      <category>redis</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Redis có thể được áp dụng trong nhiều tình huống, dưới đây là một số tình huống sử dụng phổ biến.</p>
</blockquote>
<h2>Bộ nhớ đệm</h2>
<p>Bộ nhớ đệm là kịch bản ứng dụng phổ biến nhất của Redis.</p>
<p>Redis có nhiều loại dữ liệu và lệnh hoạt động phong phú, đồng thời có các tính năng hiệu suất cao và tính sẵn sàng cao, khiến nó rất phù hợp cho bộ nhớ đệm phân tán.</p>
<blockquote>
<p>Nguyên tắc cơ bản của việc sử dụng cache, vui lòng tham khảo phần <a href=""><strong>Nguyên tắc cơ bản của cache</strong></a>.</p>
</blockquote>
<h2>BitMap và BloomFilter</h2>
<p>Redis không chỉ hỗ trợ 5 loại dữ liệu cơ bản mà còn có BitMap và BloomFilter (bộ lọc Bloom, có thể được hỗ trợ thông qua Redis Module).</p>
<p>BitMap và BloomFilter đều có thể giải quyết vấn đề xuyên thấu bộ nhớ đệm. Điểm quan trọng là: lọc ra các dữ liệu không thể tồn tại.</p>
<blockquote>
<p>Vấn đề cache penetration có thể được tìm hiểu tại: [<strong>Nguyên tắc cơ bản của cache</strong>]</p>
</blockquote>
<h3>BitMap</h3>
<ul>
<li>BitMap thích hợp cho các tập dữ liệu nhỏ.</li>
<li>Dùng để hiệu quả đánh dấu sự tồn tại của các dữ liệu, từ đó giúp loại bỏ các truy vấn không cần thiết.</li>
</ul>
<h3>BloomFilter</h3>
<ul>
<li>BloomFilter thích hợp cho các tập dữ liệu lớn.</li>
<li>Sử dụng để kiểm tra xem một phần tử có tồn tại trong tập dữ liệu hay không, mà không cần phải lấy toàn bộ dữ liệu từ bộ nhớ đệm.</li>
</ul>
<h2>Khóa phân tán (Distributed Lock)</h2>
<p>Sử dụng Redis như một khóa phân tán có những điểm cơ bản sau:</p>
<ul>
<li><strong>Sự độc quyền</strong>: Sử dụng <code>setnx</code> để chiếm giữ khóa.</li>
<li><strong>Tránh không giải phóng khóa mãi mãi</strong>: Sử dụng <code>expire</code> để đặt thời gian hết hạn, tránh tình trạng giữ khóa mãi mãi gây tắc nghẽn.</li>
<li><strong>Tính nguyên tử</strong>: <code>setnx</code> và <code>expire</code> phải được thực hiện như một lệnh nguyên tử, tránh tình trạng chiếm giữ khóa xong máy chủ bị sập mà không kịp đặt expire, dẫn đến không giải phóng khóa.</li>
</ul>
<blockquote>
<p>Để biết thêm về các cách triển khai khóa phân tán và chi tiết, vui lòng tham khảo: <a href=""><strong>Nguyên tắc cơ bản của khóa phân tán</strong></a></p>
</blockquote>
<h2>keys và scan</h2>
<p>Sử dụng lệnh <code>keys</code> để quét danh sách các key theo một mẫu nhất định.</p>
<p>Nếu Redis đó đang phục vụ dịch vụ trực tuyến, việc sử dụng lệnh <code>keys</code> sẽ gặp vấn đề:</p>
<p>Đầu tiên, Redis là hệ thống đơn luồng. Lệnh <code>keys</code> sẽ gây chặn luồng một khoảng thời gian, dẫn đến dừng dịch vụ trực tuyến cho đến khi lệnh được thực thi xong.</p>
<p>Trong trường hợp này, có thể sử dụng lệnh <code>scan</code>. Lệnh <code>scan</code> cho phép trích xuất danh sách các key theo mẫu mà không chặn luồng. Tuy nhiên, có thể xảy ra sự trùng lặp nhất định, và cần thực hiện loại bỏ trùng lặp ở phía máy khách, tuy nhiên tổng thời gian thực hiện có thể dài hơn so với việc sử dụng trực tiếp lệnh <code>keys</code>.</p>
<p>Tuy nhiên, các lệnh duyệt tăng dần cũng không phải là không có điểm yếu: ví dụ, lệnh <code>SMEMBERS</code> có thể trả về tất cả các phần tử hiện có trong tập hợp, nhưng đối với các lệnh duyệt tăng dần như <code>SCAN</code>, do quá trình duyệt tăng dần có thể sửa đổi các key, nên chỉ có thể đảm bảo giới hạn đối với các phần tử được trả về.</p>
<h2>Xử lý các Key lớn trong Redis</h2>
<h3>Key lớn Redis là gì?</h3>
<p>Key lớn trong Redis không chỉ đơn thuần là giá trị của key lớn mà là giá trị mà key đó đang lưu trữ.</p>
<p>Thường thì hai trường hợp sau được gọi là "Key lớn":</p>
<ul>
<li>Giá trị của kiểu String lớn hơn 10 KB;</li>
<li>Số lượng phần tử trong các kiểu Hash, List, Set, ZSet lớn hơn 5000 phần tử</li>
</ul>
<h3>Key lớn có thể gây ra vấn đề gì?</h3>
<p>Key lớn có thể gây ra các vấn đề sau đây:</p>
<ul>
<li><strong>Chặn thời gian chờ của khách hàng</strong>: Do Redis xử lý các lệnh theo luồng đơn, các thao tác với key lớn có thể tốn nhiều thời gian, làm cho Redis bị chặn và khách hàng không nhận được phản hồi trong một thời gian dài.</li>
<li><strong>Gây ra nghẽn mạng</strong>: Việc truy xuất key lớn tạo ra lưu lượng mạng lớn. Ví dụ, nếu một key có kích thước là 1 MB và có 1000 lần truy cập mỗi giây, điều này có thể tạo ra 1000 MB lưu lượng mạng mỗi giây, gây khó khăn cho máy chủ có card mạng gigabit.</li>
<li><strong>Chặn luồng làm việc</strong>: Xóa một key lớn có thể chặn luồng làm việc, không cho phép xử lý các lệnh tiếp theo.</li>
<li><strong>Phân phối bộ nhớ không đồng đều</strong>: Trong mô hình cụm, nếu một số node Redis chứa các key lớn, chúng có thể chiếm nhiều bộ nhớ hơn và tạo ra một số lượng truy vấn mỗi giây (QPS) lớn hơn.</li>
</ul>
<h3>Làm thế nào để tìm kiếm các Key lớn?</h3>
<p><strong><em>1. Sử dụng redis-cli --bigkeys để tìm kiếm các key lớn</em></strong></p>
<p>Bạn có thể sử dụng lệnh <code>redis-cli --bigkeys</code> để tìm kiếm các key lớn trong Redis:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis-cli</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -h</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 127.0.0.1</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 6379</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -a</span><span style="color:#98C379;--shiki-dark:#98C379"> "password"</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --</span><span style="color:#98C379;--shiki-dark:#98C379"> bigkeys</span></span></code></pre>
</div><p>Lưu ý khi sử dụng:</p>
<ul>
<li>Nên thực hiện lệnh này trên các node slave thay vì node master. Việc thực hiện trên node master có thể gây ra sự chậm trễ.</li>
<li>Nếu không có node slave, bạn nên chọn thời điểm thấp điểm của tải hoạt động của Redis để thực hiện quét, nhằm tránh ảnh hưởng đến hoạt động bình thường của hệ thống. Hoặc bạn có thể sử dụng tham số <code>-i</code> để điều chỉnh khoảng thời gian quét và tránh giảm hiệu suất trong thời gian dài.</li>
</ul>
<p><strong>Nhược điểm của phương pháp này:</strong></p>
<ul>
<li>Phương pháp này chỉ trả về key lớn nhất trong mỗi loại, không phải là danh sách các key lớn nhất.</li>
<li>Đối với các loại tập hợp, phương pháp này chỉ thống kê số lượng các phần tử trong tập hợp, không phải dung lượng thực tế chiếm giữ. Điều này có nghĩa là một tập hợp có nhiều phần tử không nhất thiết phải chiếm nhiều bộ nhớ nếu mỗi phần tử có dung lượng nhỏ.</li>
</ul>
<p><strong><em>2. Sử dụng lệnh SCAN để tìm kiếm các key lớn</em></strong></p>
<p>Bạn có thể sử dụng lệnh SCAN để quét toàn bộ cơ sở dữ liệu Redis và sau đó sử dụng lệnh TYPE để lấy loại của từng key được trả về.</p>
<p>Đối với các key là kiểu String, bạn có thể sử dụng lệnh STRLEN để lấy độ dài của chuỗi, tức là số byte chiếm giữ trong bộ nhớ.</p>
<p>Đối với các kiểu tập hợp, có hai cách để biết được kích thước bộ nhớ mà chúng chiếm giữ:</p>
<ul>
<li>
<p>Nếu bạn có thể biết trước kích thước trung bình của các phần tử trong tập hợp từ lớp kinh doanh, bạn có thể sử dụng các lệnh sau để lấy số lượng các phần tử trong tập hợp và sau đó nhân với kích thước trung bình của từng phần tử: Lệnh LLEN cho List, HLEN cho Hash, SCARD cho Set và ZCARD cho Sorted Set.</p>
</li>
<li>
<p>Nếu bạn không thể biết trước kích thước các phần tử trong tập hợp, bạn có thể sử dụng lệnh MEMORY USAGE (yêu cầu Redis phiên bản 4.0 trở lên) để truy vấn kích thước bộ nhớ mà một key đang chiếm giữ.</p>
</li>
</ul>
<p><strong><em>3. Sử dụng công cụ RdbTools để tìm kiếm các key lớn</em></strong></p>
<p>Bạn có thể sử dụng công cụ RdbTools, một công cụ mã nguồn mở của bên thứ ba, để phân tích các tập tin chụp Redis (RDB) và tìm kiếm các key lớn trong đó.</p>
<p>Ví dụ, bạn có thể sử dụng lệnh sau để xuất các key có kích thước lớn hơn 10 KB vào một tệp bảng:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">rdb</span><span style="color:#98C379;--shiki-dark:#98C379"> dump.rdb</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -c</span><span style="color:#98C379;--shiki-dark:#98C379"> memory</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --bytes</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10240</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -f</span><span style="color:#98C379;--shiki-dark:#98C379"> redis.csv</span></span></code></pre>
</div><h3>Làm thế nào để xóa key lớn?</h3>
<p>Quá trình xóa key trong Redis thực chất là giải phóng không gian bộ nhớ mà key đó đang chiếm dụng. Tuy nhiên, việc giải phóng bộ nhớ chỉ là bước đầu tiên. Để quản lý không gian bộ nhớ một cách hiệu quả hơn, khi ứng dụng giải phóng bộ nhớ, hệ điều hành cần phải chèn các khối bộ nhớ được giải phóng vào một danh sách liên kết các khối bộ nhớ trống, để sau này có thể quản lý và phân bổ lại. Quá trình này mất một khoảng thời gian nhất định và có thể làm chặn ứng dụng hiện tại đang giải phóng bộ nhớ.</p>
<p>Do đó, nếu giải phóng một lượng lớn bộ nhớ cùng một lúc, thời gian thực hiện các thao tác trên danh sách khối bộ nhớ trống sẽ tăng lên. Điều này có thể dẫn đến chặn trong quá trình chính của Redis. Nếu quá trình chính bị chặn, các yêu cầu khác có thể gặp phải vấn đề vượt thời gian, dẫn đến tình trạng kết nối Redis bị tiêu tốn hết và gây ra các vấn đề khác.</p>
<p>Vì vậy, khi thực hiện hành động xóa key lớn trong Redis, chúng ta cần phải cẩn thận. Dưới đây là hai phương pháp để làm điều này:</p>
<ul>
<li>Xóa key theo từng đợt (phân lô xóa)</li>
<li>Xóa key bất đồng bộ (Redis phiên bản 4.0 trở lên)</li>
</ul>
<h4>Xoá theo đợt</h4>
<p><strong>1. Xóa Hash lớn:</strong></p>
<ul>
<li>Sử dụng lệnh <code>hscan</code> để lấy 100 trường (fields) mỗi lần.</li>
<li>Sau đó sử dụng lệnh <code>hdel</code> để xóa từng trường một.</li>
</ul>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> del_large_hash</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    r </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">StrictRedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'redis-host1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    large_hash_key </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "xxx"</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  # Tên key hash lớn cần xóa</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    cursor </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> '0'</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> cursor </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        cursor, data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hscan</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_hash_key, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">cursor</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">cursor, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">count</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> field, value </span><span style="color:#C678DD;--shiki-dark:#C678DD">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> data.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">items</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hdel</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_hash_key, field)</span></span></code></pre>
</div><p><strong>2. Xóa List lớn:</strong></p>
<ul>
<li>Sử dụng lệnh <code>ltrim</code> để mỗi lần chỉ giữ lại một phần nhỏ của list.</li>
</ul>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> del_large_list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    r </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">StrictRedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'redis-host1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    large_list_key </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> 'xxx'</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  # Tên key list lớn cần xóa</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">llen</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_list_key) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ltrim</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_list_key, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">101</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)  </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Chỉ giữ lại 100 phần tử cuối cùng của list</span></span></code></pre>
</div><p><strong>3. Xóa Set lớn:</strong></p>
<ul>
<li>Sử dụng lệnh <code>sscan</code> để quét từng phần tử của set (100 phần tử mỗi lần).</li>
<li>Sử dụng lệnh <code>srem</code> để xóa từng phần tử một.</li>
</ul>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> del_large_set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    r </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">StrictRedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'redis-host1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    large_set_key </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> 'xxx'</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">   # Tên key set lớn cần xóa</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    cursor </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> '0'</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> cursor </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        cursor, data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">sscan</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_set_key, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">cursor</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">cursor, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">count</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> member </span><span style="color:#C678DD;--shiki-dark:#C678DD">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> data:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">srem</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_set_key, member)</span></span></code></pre>
</div><p><strong>4. Xóa Sorted Set lớn:</strong></p>
<ul>
<li>Sử dụng lệnh <code>zremrangebyrank</code> để xóa một lượng phần tử hàng đầu của Sorted Set.</li>
</ul>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> del_large_sortedset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    r </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">StrictRedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'redis-host1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    large_sortedset_key </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> 'xxx'</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  # Tên key Sorted Set lớn cần xóa</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zcard</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_sortedset_key) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zremrangebyrank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_sortedset_key, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)  </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xóa 100 phần tử đầu tiên của Sorted Set</span></span></code></pre>
</div><h4>Xoá bất đồng bộ</h4>
<p>Từ phiên bản Redis 4.0 trở đi, bạn có thể sử dụng <strong>xóa bất đồng bộ</strong> bằng cách sử dụng lệnh <strong>unlink</strong> thay vì <strong>del</strong> để xóa các key.</p>
<p>Khi đó, Redis sẽ đưa key này vào một luồng bất đồng bộ để thực hiện xóa, điều này giúp tránh chặn luồng chính.</p>
<p>Ngoài việc sử dụng lệnh unlink để thực hiện xóa bất đồng bộ, bạn cũng có thể cấu hình tham số để tự động thực hiện xóa bất đồng bộ trong một số trường hợp cụ thể.</p>
<p>Có tổng cộng 4 cài đặt mặc định như sau:</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>lazyfree-lazy-eviction no</span></span>
<span class="line"><span>lazyfree-lazy-expire no</span></span>
<span class="line"><span>lazyfree-lazy-server-del</span></span>
<span class="line"><span>noslave-lazy-flush no</span></span></code></pre>
</div><ul>
<li>
<p><strong>lazyfree-lazy-eviction</strong>: Được sử dụng để xác định liệu Redis có nên kích hoạt cơ chế xóa lười biếng khi bộ nhớ vượt quá giới hạn maxmemory hay không.</p>
</li>
<li>
<p><strong>lazyfree-lazy-expire</strong>: Xác định liệu Redis có nên kích hoạt cơ chế xóa lười biếng cho các key hết hạn không.</p>
</li>
<li>
<p><strong>lazyfree-lazy-server-del</strong>: Một số lệnh khi xử lý các key đã tồn tại, ví dụ như lệnh rename, nếu key đích đã tồn tại thì Redis sẽ trước tiên xóa key đích này. Nếu key này là một big key, việc xóa có thể gây ra vấn đề chặn. Cài đặt này xác định liệu Redis có nên kích hoạt cơ chế xóa lười biếng trong trường hợp này hay không.</p>
</li>
<li>
<p><strong>noslave-lazy-flush</strong>: Đối với slave (nút con), khi nó tải tệp RDB của master thì trước đó nó sẽ thực hiện lệnh flushall để xóa dữ liệu của nó. Cài đặt này xác định liệu Redis có nên kích hoạt cơ chế xóa lười biếng trong trường hợp này hay không.</p>
</li>
</ul>
<p>Đề xuất nên kích hoạt các cài đặt như lazyfree-lazy-eviction, lazyfree-lazy-expire, lazyfree-lazy-server-del để cải thiện hiệu suất thực thi của luồng chính trong Redis.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Redis Advanced Data Types</title>
      <link>https://vanhung4499.github.io/database/redis/advanced-data-types.html</link>
      <guid>https://vanhung4499.github.io/database/redis/advanced-data-types.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Advanced Data Types</source>
      <description>Redis Advanced Data Types Redis hỗ trợ các kiểu dữ liệu nâng cao như BitMap, HyperLogLog, GEO và Stream. Hiểu được đặc tính của các kiểu dữ liệu này và áp dụng linh hoạt và hiệu...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Redis hỗ trợ các kiểu dữ liệu nâng cao như BitMap, HyperLogLog, GEO và Stream. Hiểu được đặc tính của các kiểu dữ liệu này và áp dụng linh hoạt và hiệu quả vào từng kịch bản nghiệp vụ cụ thể là rất quan trọng khi sử dụng Redis để mô hình hóa dữ liệu.</p>
<h2>BitMap</h2>
<h3>Giới thiệu về BitMap</h3>
<p>BitMap, như tên gọi, là một chuỗi liên tục các số nhị phân (0 và 1) trong đó các phần tử được truy cập bằng các offset. Vì bit là đơn vị nhỏ nhất trong máy tính, việc sử dụng BitMap để lưu trữ có thể <strong>tiết kiệm rất nhiều không gian</strong>, đặc biệt phù hợp cho các kịch bản thống kê nhị phân với tập dữ liệu lớn. Ví dụ, trong một hệ thống nơi mà người dùng được biểu diễn bằng các ID người dùng tăng dần, BitMap có thể lưu trữ hiệu quả trạng thái đăng nhập của từng người dùng. Với BitMap, hệ thống có thể xử lý đến 4 tỷ người dùng (khoảng $$2^{32}$$), chỉ cần 512 MB bộ nhớ để lưu trữ trạng thái đăng nhập.</p>
<h3>Thực hiện BitMap</h3>
<p>Trong thực tế, <strong>BitMap không phải là một cấu trúc dữ liệu độc lập mà là một tập hợp các phép toán bit được thực hiện trên chuỗi String</strong>.</p>
<p>Với Redis, các chuỗi là an toàn cho dữ liệu nhị phân và có thể lưu trữ đến 512 MB độ dài. Do đó, BitMap cho phép thiết lập đến $$2^{32}$$ bit khác nhau, giúp quản lý dữ liệu nhị phân quy mô lớn một cách hiệu quả trong Redis, tận dụng khả năng lưu trữ và thao tác tối ưu của nó.</p>
<h3>Các Lệnh BitMap</h3>
<p>| Lệnh     | Hành động                                                |<br>
|</p>
]]></content:encoded>
    </item>
    <item>
      <title>Redis Basic Data Types</title>
      <link>https://vanhung4499.github.io/database/redis/basic-data-types.html</link>
      <guid>https://vanhung4499.github.io/database/redis/basic-data-types.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Basic Data Types</source>
      <description>Redis Basic Data Types Redis cung cấp nhiều loại dữ liệu, mỗi loại dữ liệu đều có các lệnh hỗ trợ phong phú. Khi sử dụng Redis, không chỉ cần hiểu các đặc điểm của các loại dữ l...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Redis cung cấp nhiều loại dữ liệu, mỗi loại dữ liệu đều có các lệnh hỗ trợ phong phú.</p>
<p>Khi sử dụng Redis, không chỉ cần hiểu các đặc điểm của các loại dữ liệu, mà còn cần linh hoạt và hiệu quả trong việc sử dụng các loại dữ liệu này để xây dựng mô hình dữ liệu phù hợp với kịch bản nghiệp vụ.</p>
<p>Các loại dữ liệu cơ bản mà Redis hỗ trợ:</p>
<ul>
<li><strong>STRING</strong>: Chuỗi</li>
<li><strong>HASH</strong>: Bảng băm</li>
<li><strong>LIST</strong>: List</li>
<li><strong>SET</strong>: Tập hợp</li>
<li><strong>ZSET</strong>: Tập hợp có thứ tự</li>
</ul>
<p>Các loại dữ liệu nâng cao mà Redis hỗ trợ:</p>
<ul>
<li><strong>BitMap</strong>: Bản đồ bit</li>
<li><strong>HyperLogLog</strong>: Đếm dữ liệu khổng lồ</li>
<li><strong>GEO</strong>: Dữ liệu vị trí địa lý</li>
<li><strong>Stream</strong>: Dữ liệu luồng</li>
</ul>
<p>Sử dụng Redis, không chỉ cần hiểu các đặc tính của các loại dữ liệu mà còn cần linh hoạt và hiệu quả trong việc sử dụng các loại dữ liệu này để xây dựng mô hình theo từng tình huống cụ thể của nghiệp vụ.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624195542.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h2>Các kiểu dữ liệu cơ bản của Redis</h2>
<p>|Kiểu dữ liệu|Giá trị có thể lưu trữ|Các hoạt động|<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624195542.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Cluster</title>
      <link>https://vanhung4499.github.io/database/redis/cluster.html</link>
      <guid>https://vanhung4499.github.io/database/redis/cluster.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Cluster</source>
      <description>Redis Cluster Redis Cluster là một giải pháp cơ sở dữ liệu phân tán được cung cấp bởi Redis. Vì là một hệ thống phân tán, nó tự nhiên có các tính chất cơ bản của hệ thống phân t...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><strong>Redis Cluster</strong> là một giải pháp cơ sở dữ liệu phân tán được cung cấp bởi Redis.</p>
<p>Vì là một hệ thống phân tán, nó tự nhiên có các tính chất cơ bản của hệ thống phân tán: có thể mở rộng, có sẵn và nhất quán.</p>
<ul>
<li>Redis Cluster phân vùng dữ liệu bằng cách chia các khe băm (hash slot) để chia sẻ dữ liệu.</li>
<li>Redis Cluster sử dụng mô hình master-slave đồng bộ để cung cấp tính năng sao chép và chuyển giao lỗi, đảm bảo tính sẵn có cao cho Redis Cluster.</li>
<li>Theo lý thuyết CAP, không thể đạt được Consistency, Availability và Partition tolerance cùng một lúc, và Redis Cluster chọn lựa chọn AP. Các nút trong Redis Cluster giao tiếp bất đồng bộ, không đảm bảo tính nhất quán mạnh, nhưng cố gắng đạt được tính nhất quán cuối cùng.</li>
</ul>
</blockquote>
<h2>1. Phân vùng Redis Cluster</h2>
<h3>1.1. Các nút trong Cluster</h3>
<p>Redis Cluster bao gồm nhiều nút, khi một nút khởi động, các nút này ban đầu là độc lập với nhau. <strong>Các nút kết nối với nhau bằng cách gửi tin nhắn "CLUSTER MEET" để thêm các nút khác vào cụm của mình</strong>.</p>
<p>Bằng cách gửi lệnh "CLUSTER MEET" đến một nút, nút hiện tại sẽ kết nối với nút được chỉ định bởi IP và PORT, và khi kết nối thành công, nút hiện tại sẽ thêm nút được chỉ định vào cụm của mình.</p>
<p><strong>Các nút trong Redis Cluster lưu trữ cặp khóa-giá trị và thời gian hết hạn giống như trong Redis đơn</strong>.</p>
<p>Redis Cluster có các nút chính (master) và nút phụ (slave), trong đó nút chính được sử dụng để xử lý các khe băm (slot), và nút phụ được sử dụng để sao chép một nút chính cụ thể và thay thế nút chính khi nút chính bị lỗi.</p>
<h3>1.2. Phân chia Hash Slot</h3>
<p>Vấn đề chính cần giải quyết trong lưu trữ phân tán là phân chia&nbsp;<strong>toàn bộ tập dữ liệu</strong>&nbsp;theo&nbsp;<strong>quy tắc phân vùng</strong>&nbsp;thành&nbsp;<strong>nhiều phân vùng</strong>&nbsp;trên&nbsp;<strong>nhiều nút</strong>, mỗi nút chịu trách nhiệm cho một phần dữ liệu của toàn bộ.</p>
<p><strong>Redis Cluster sử dụng phân chia hash slot để phân vùng dữ liệu</strong>. Redis Cluster chia toàn bộ cơ sở dữ liệu thành 16384 hash slot (khe hash), mỗi khóa trong cơ sở dữ liệu thuộc một trong số 16384 khe hash này, và mỗi nút trong cụm có thể xử lý từ 0 đến tối đa 16384 khe hash.&nbsp;<strong>Nếu có bất kỳ khe hash nào không được xử lý, cụm Redis sẽ được đánh dấu là offline</strong>.</p>
<p>Bằng cách gửi lệnh&nbsp;<a href="https://redis.io/commands/cluster-addslots" target="_blank" rel="noopener noreferrer"><code>CLUSTER ADDSLOTS</code></a>&nbsp;đến một nút, bạn có thể gán một hoặc nhiều khe hash cho nút đó.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>&gt; CLUSTER ADDSLOTS 1 2 3</span></span>
<span class="line"><span>OK</span></span></code></pre>
</div><p>Mỗi nút trong cụm chịu trách nhiệm cho một phần khe hash. Ví dụ, trong một cụm có 3 nút:</p>
<ul>
<li>Nút A chịu trách nhiệm cho khe hash từ 0 đến 5500.</li>
<li>Nút B chịu trách nhiệm cho khe hash từ 5501 đến 11000.</li>
<li>Nút C chịu trách nhiệm cho khe hash từ 11001 đến 16384.</li>
</ul>
<h3>1.3. Địa chỉ</h3>
<p>Khi máy khách gửi một lệnh liên quan đến khóa cơ sở dữ liệu cho nút, nút nhận lệnh sẽ tính toán xem lệnh cần xử lý thuộc về khe nào của cơ sở dữ liệu và kiểm tra xem khe này có được giao cho nút hiện tại không:</p>
<ul>
<li>Nếu khe chứa khóa được giao cho nút hiện tại, nút hiện tại sẽ thực hiện lệnh.</li>
<li>Nếu khe chứa khóa không được giao cho nút hiện tại, nút sẽ trả về một lỗi MOVED cho máy khách, hướng dẫn máy khách chuyển hướng đến nút đúng.</li>
</ul>
<h4>1.3.1. Tính toán khe mà khóa thuộc về</h4>
<p>Giải thuật để quyết định một khóa nên được giao cho khe nào là: <strong>tính toán kết quả CRC16 của khóa và sau đó lấy phần dư của kết quả chia cho 16834</strong>.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>HASH_SLOT = CRC16(KEY) mod 16384</span></span></code></pre>
</div><p>Khi nút tính toán khe mà khóa thuộc về là i, nút sẽ kiểm tra các điều kiện sau để xác định xem khe có được giao cho nút hay không:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>clusterState.slots[i] == clusterState.myself</span></span></code></pre>
</div><h4>1.3.2. Lỗi MOVED</h4>
<p>Khi nút phát hiện rằng khe chứa khóa không được giao cho nút hiện tại, nút sẽ trả về một lỗi <code>MOVED</code>, hướng dẫn máy khách chuyển hướng đến nút đang chịu trách nhiệm khe đó.</p>
<p>Định dạng lỗi <code>MOVED</code> như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>MOVED &lt;khe&gt; &lt;ip&gt;:&lt;port&gt;</span></span></code></pre>
</div><blockquote>
<p>Hiểu theo cách cá nhân: Hành động MOVED này tương tự như chuyển hướng trong giao thức HTTP.</p>
</blockquote>
<h3>1.4. Tái phân vùng</h3>
<p><strong>Hoạt động tái phân vùng trong Redis Cluster cho phép chuyển một số lượng bất kỳ các khe băm đã được giao cho một nút (nút nguồn) sang một nút khác (nút đích), và các cặp khóa-giá trị liên quan đến các khe băm đó cũng sẽ được di chuyển từ nút nguồn sang nút đích</strong>.</p>
<p>Hoạt động tái phân vùng&nbsp;<strong>có thể được thực hiện trực tuyến</strong>, trong quá trình tái phân vùng, Redis Cluster không cần tắt máy và cả nút nguồn và nút đích đều có thể tiếp tục xử lý các yêu cầu lệnh.</p>
<p>Hoạt động tái phân vùng trong Redis Cluster được thực hiện bởi công cụ quản lý Redis Cluster&nbsp;<strong>redis-trib</strong>, nó gửi các lệnh đến nút nguồn và nút đích để thực hiện tái phân vùng.</p>
<h3>1.5. Lỗi ASK</h3>
<p>Lỗi&nbsp;<code>ASK</code>&nbsp;khác với lỗi&nbsp;<code>MOVED</code>&nbsp;ở chỗ:&nbsp;<strong>Lỗi&nbsp;<code>ASK</code>&nbsp;chỉ là một biện pháp tạm thời được sử dụng trong quá trình di chuyển khe băm</strong>, sau khi khách hàng nhận được lỗi&nbsp;<code>ASK</code>&nbsp;về khe băm X, khách hàng chỉ sẽ chuyển hướng yêu cầu lệnh liên quan đến khe băm X sang nút được chỉ định trong lần yêu cầu lệnh tiếp theo, nhưng việc chuyển hướng này sẽ không ảnh hưởng đến các yêu cầu lệnh liên quan đến khe băm X trong tương lai, khách hàng vẫn sẽ gửi yêu cầu lệnh liên quan đến khe băm X đến nút hiện tại đang chịu trách nhiệm xử lý khe băm X, trừ khi lỗi&nbsp;<code>ASK</code>&nbsp;xuất hiện một lần nữa.</p>
<h2>2. Redis Cluster - Quá trình chuyển giao khi xảy ra sự cố</h2>
<h3>2.1. Sao chép</h3>
<p>Cơ chế sao chép Redis có thể được tham khảo tại: [[Redis Replication]]</p>
<h3>2.2. Phát hiện sự cố</h3>
<p><strong>Mỗi nút trong cụm Redis sẽ định kỳ gửi tin nhắn PING đến các nút khác trong cụm để kiểm tra xem chúng có hoạt động không</strong>.</p>
<p>Trạng thái của mỗi nút có thể được chia thành:</p>
<ul>
<li>Trạng thái trực tuyến;</li>
<li>Trạng thái ngoại tuyến (FAIL);</li>
<li>Trạng thái nghi ngờ ngoại tuyến (PFAIL), tức là không có phản hồi PING trong khoảng thời gian quy định;</li>
</ul>
<h3>2.3. Chuyển giao khi xảy ra sự cố</h3>
<ol>
<li>Trong số tất cả các nút con của nút chính bị xảy ra sự cố, một nút con sẽ được chọn.</li>
<li>Nút con được chọn sẽ thực hiện lệnh <code>SLAVEOF no one</code>, trở thành nút chính mới.</li>
<li>Nút chính mới sẽ hủy bỏ việc gán khe cho nút chính đã bị xảy ra sự cố và gán tất cả các khe này cho chính nó.</li>
<li>Nút chính mới sẽ phát sóng một tin nhắn PONG đến cụm Redis, thông báo rằng nút con này đã trở thành nút chính mới.</li>
</ol>
<h3>2.4. Bầu chọn nút chính mới</h3>
<p>Quá trình bầu chọn nút chính mới trong Redis Cluster dựa trên thuật toán đồng thuận: Raft.</p>
<h2>3. Giao tiếp trong Redis Cluster</h2>
<p>Các nút trong cụm Redis giao tiếp thông qua việc gửi và nhận các tin nhắn.</p>
<p>Có năm loại tin nhắn chính mà các nút trong cụm Redis gửi đi:</p>
<ul>
<li><code>MEET</code> - Yêu cầu nút nhận tham gia vào cụm mà nút gửi đang tham gia.</li>
<li><code>PING</code> - Mỗi nút trong cụm Redis sẽ chọn ngẫu nhiên năm nút từ danh sách nút đã biết và gửi tin nhắn PING đến năm nút này, nhằm kiểm tra xem các nút đã chọn có hoạt động không.</li>
<li><code>PONG</code> - Khi nút nhận được tin nhắn MEET hoặc PING từ nút gửi, nó sẽ trả lời bằng một tin nhắn PONG.</li>
<li><code>FAIL</code> - Khi một nút chính A xác định rằng một nút chính B đã vào trạng thái FAIL, nút A sẽ phát sóng một tin nhắn FAIL về nút B cho toàn bộ cụm Redis, tất cả các nút nhận được tin nhắn này sẽ đánh dấu nút B là đã ngoại tuyến.</li>
<li><code>PUBLISH</code> - Khi một nút nhận được một lệnh PUBLISH, nó sẽ thực hiện lệnh này và phát sóng một tin nhắn PUBLISH đến cụm Redis, tất cả các nút nhận được tin nhắn này sẽ thực hiện cùng một lệnh PUBLISH.</li>
</ul>
<h2>4. Ứng dụng của Redis Cluster</h2>
<h3>4.1. Giới hạn chức năng của cụm</h3>
<p>Redis Cluster so với Redis đơn lẻ có một số giới hạn chức năng, các nhà phát triển cần hiểu trước và tránh khi sử dụng.</p>
<ul>
<li>Hỗ trợ hạn chế cho các hoạt động <strong>đa khóa</strong>: Các hoạt động như <code>mset</code>, <code>mget</code> chỉ hỗ trợ cho các khóa có cùng giá trị <code>slot</code>. Các khóa được ánh xạ vào các <code>slot</code> khác nhau không được hỗ trợ.</li>
<li>Hỗ trợ hạn chế cho các hoạt động <strong>giao dịch</strong>: Chỉ hỗ trợ giao dịch cho nhiều khóa trên cùng một nút. Khi nhiều khóa phân tán trên các nút khác nhau, không thể sử dụng chức năng giao dịch.</li>
<li>Không thể ánh xạ một đối tượng khóa lớn như <code>hash</code>, <code>list</code> vào các nút khác nhau. <code>Key</code> được coi là đơn vị phân vùng dữ liệu.</li>
<li>Không hỗ trợ <strong>nhiều không gian cơ sở dữ liệu</strong>: Redis đơn lẻ có thể hỗ trợ <code>16</code> không gian cơ sở dữ liệu (<code>db0 ~ db15</code>), trong khi chế độ cụm chỉ hỗ trợ sử dụng một không gian cơ sở dữ liệu duy nhất, tức là <code>db0</code>.</li>
<li><strong>Sao chép</strong> chỉ hỗ trợ một cấp: Các nút con chỉ có thể sao chép từ nút chính, không hỗ trợ cấu trúc sao chép cây lồng nhau.</li>
</ul>
<h3>4.2. Giới hạn quy mô cụm</h3>
<p>Redis Cluster dễ sử dụng. Các chức năng phân vùng, sao chép chính và mở rộng linh hoạt đều được tự động hóa, chỉ cần triển khai đơn giản là có thể có một cụm Redis lớn với khả năng chứa lượng dữ liệu lớn, đáng tin cậy và có sẵn cao, và đối với ứng dụng, nó gần như là trong suốt.</p>
<p>Vì vậy, Redis Cluster rất phù hợp để xây dựng các cụm Redis trung bình và nhỏ, trong đó có khoảng vài đến vài chục nút.</p>
<p>Tuy nhiên, Redis Cluster không phù hợp để xây dựng các cụm quy mô lớn, chủ yếu là do nó sử dụng một thiết kế phi tập trung.</p>
<p>Trên mỗi nút Redis, nó lưu trữ một bảng ánh xạ giữa tất cả các khe và nút, khách hàng có thể truy cập vào bất kỳ nút nào và sau đó thông qua lệnh chuyển hướng, tìm ra nút chứa dữ liệu. Vậy, bảng ánh xạ này được cập nhật như thế nào? Redis Cluster sử dụng giao thức lan truyền tin đồn (Gossip) để truyền bá các thay đổi cấu hình cụm.</p>
<p>Ưu điểm của Gossip là phi tập trung; nhược điểm là tốc độ truyền bá chậm và càng lớn quy mô cụm, tốc độ truyền bá càng chậm.</p>
<h3>4.3. Cấu hình cụm</h3>
<p>Trước khi triển khai một cụm Redis, chúng ta sẽ giới thiệu các tham số cấu hình trong tệp redis.conf của cụm.</p>
<ul>
<li><strong>cluster-enabled</strong> <code>&lt;yes/no&gt;</code> - Nếu được cấu hình là "yes", chức năng cụm sẽ được bật và Redis instance sẽ là một nút trong cụm, nếu không, nó sẽ là một instance Redis đơn lẻ.</li>
<li><strong>cluster-config-file</strong> <code>&lt;filename&gt;</code> - Lưu ý: Mặc dù tên cấu hình này được gọi là "tệp cấu hình cụm", nhưng tệp cấu hình này không thể chỉnh sửa thủ công, nó là một tệp cấu hình tự động được duy trì bởi các nút cụm, chủ yếu để ghi lại thông tin về các nút trong cụm, trạng thái của chúng và một số tham số bền vững, để khôi phục trạng thái này khi khởi động lại. Thông thường, tệp này sẽ được cập nhật sau khi nhận được yêu cầu.</li>
<li><strong>cluster-node-timeout</strong> <code>&lt;milliseconds&gt;</code> - Đây là thời gian tối đa mà một nút trong cụm có thể mất kết nối. Nếu vượt quá thời gian này, nút sẽ được coi là gặp sự cố. Nếu một nút chính vẫn không thể kết nối sau thời gian này, nút con của nó sẽ tiếp tục chuyển đổi thành nút chính. Lưu ý, nếu một nút không thể kết nối với hầu hết các nút chính trong thời gian này, nó sẽ ngừng nhận bất kỳ yêu cầu nào.</li>
<li><strong>cluster-slave-validity-factor</strong> <code>&lt;factor&gt;</code> - Nếu được đặt thành 0, bất kể mất kết nối giữa nút con và nút chính đã kéo dài bao lâu, nút con sẽ cố gắng trở thành nút chính. Nếu được đặt thành một số dương, thì thời gian mà cluster-node-timeout nhân với cluster-slave-validity-factor sẽ là thời gian hiệu quả của nút con sau khi mất kết nối với nút chính, vượt quá thời gian này, nút con sẽ không chuyển đổi thành nút chính. Giả sử cluster-node-timeout = 5, cluster-slave-validity-factor = 10, nếu nút con mất kết nối với nút chính quá 50 giây, nó sẽ không thể trở thành nút chính. Lưu ý, nếu tham số này được cấu hình thành một số dương, có thể xảy ra tình huống mà một nút chính không thể được thay thế bởi bất kỳ nút con nào, dẫn đến cụm không hoạt động, trong trường hợp này, chỉ khi nút chính ban đầu trở lại cụm, cụm mới hoạt động trở lại.</li>
<li><strong>cluster-migration-barrier</strong> <code>&lt;count&gt;</code> - Số lượng tối thiểu của nút con cần thiết cho một nút chính, chỉ khi đạt được số lượng này, khi nút chính gặp sự cố, nút con của nó mới được chuyển đổi. Chi tiết hơn về việc sao chép nút con sang một phần, hãy xem phần sau của hướng dẫn này.</li>
<li><strong>cluster-require-full-coverage</strong> <code>&lt;yes/no&gt;</code> - Khi một số nút không khả dụng trong một phần key, nếu tham số này được cấu hình thành "yes" (giá trị mặc định), cụm sẽ ngừng nhận các hoạt động; nếu tham số này được cấu hình thành "no", cụm vẫn cung cấp hoạt động đọc cho các key trên các nút có thể truy cập.</li>
</ul>
<h2>5. Các giải pháp cụm Redis khác</h2>
<p>Redis Cluster không phù hợp cho việc xây dựng các cụm Redis quy mô lớn, do đó, nếu bạn muốn xây dựng một cụm Redis quy mô lớn, bạn cần chọn các giải pháp thay thế. Thông thường có ba loại giải pháp:</p>
<ul>
<li>Giải pháp phân vùng khách hàng (Client-side sharding)</li>
<li>Giải pháp phân vùng trung gian (Proxy-based sharding)</li>
<li>Giải pháp định tuyến truy vấn (Query routing)</li>
</ul>
<h3>5.1. Giải pháp phân vùng khách hàng (Client-side sharding)</h3>
<p>Trong giải pháp này, <strong>khách hàng</strong> tự quyết định dữ liệu sẽ được <strong>lưu trữ</strong> trên nút Redis nào hoặc dữ liệu sẽ được <strong>đọc</strong> từ nút Redis nào. Ý tưởng chính là sử dụng thuật toán <strong>hashing</strong> để phân tán các khóa Redis, thông qua hàm <strong>hash</strong>, các khóa cụ thể sẽ được <strong>ánh xạ</strong> vào các nút Redis cụ thể.</p>
<p>Giải pháp phân vùng khách hàng phổ biến là Redis Sharding, đây là phương pháp <strong>cụm nhiều phiên bản</strong> Redis được sử dụng rộng rãi trước khi Redis Cluster ra đời. Thư viện điều khiển Redis cho Java <a href="https://github.com/redis/jedis" target="_blank" rel="noopener noreferrer"><strong>Jedis</strong></a> hỗ trợ chức năng Redis Sharding, bao gồm ShardedJedis và ShardedJedisPool kết hợp với <strong>bể cache</strong>.</p>
<ul>
<li><strong>Ưu điểm</strong>: Không sử dụng <strong>phần mềm trung gian</strong>, quy tắc phân vùng có thể được kiểm soát, cấu hình đơn giản, không có sự phụ thuộc giữa các nút, dễ dàng mở rộng tuyến tính, linh hoạt.</li>
<li><strong>Nhược điểm</strong>: <strong>Khách hàng</strong> không thể <strong>tự động thêm/xóa</strong> nút dịch vụ, khách hàng phải tự quản lý quy tắc <strong>phân phối</strong>, không có <strong>chia sẻ kết nối</strong> giữa các khách hàng, dẫn đến lãng phí kết nối.</li>
</ul>
<h3>5.2. Giải pháp phân vùng trung gian (Proxy-based sharding)</h3>
<p>Trong giải pháp này, <strong>khách hàng</strong> gửi yêu cầu đến một <strong>thành phần trung gian</strong>, <strong>thành phần trung gian</strong> phân tích dữ liệu của khách hàng và chuyển tiếp yêu cầu đến nút Redis chính xác, sau đó trả kết quả về cho khách hàng.</p>
<ul>
<li><strong>Ưu điểm</strong>: Giảm đơn giản hóa <strong>phân tán logic</strong> của khách hàng, khách hàng kết nối một cách <strong>trong suốt</strong>, chi phí chuyển tiếp và lưu trữ được <strong>tách biệt</strong>.</li>
<li><strong>Nhược điểm</strong>: Thêm một <strong>lớp trung gian</strong>, tăng độ phức tạp của kiến trúc và hiệu suất.</li>
</ul>
<p>Các giải pháp phân vùng trung gian phổ biến bao gồm <strong><a href="https://github.com/twitter/twemproxy" target="_blank" rel="noopener noreferrer">Twemproxy</a></strong> và <strong><a href="https://github.com/CodisLabs/codis" target="_blank" rel="noopener noreferrer">Codis</a></strong>.</p>
<h4>5.2.1. Twemproxy</h4>
<p><strong><a href="https://github.com/twitter/twemproxy" target="_blank" rel="noopener noreferrer">Twemproxy</a></strong>, còn được gọi là "nutcraker", là một chương trình trung gian Redis và Memcache mã nguồn mở của Twitter.</p>
<p><strong><a href="https://github.com/twitter/twemproxy" target="_blank" rel="noopener noreferrer">Twemproxy</a></strong> hoạt động như một trung gian, có thể chấp nhận truy cập từ nhiều chương trình và dựa trên quy tắc định tuyến, chuyển tiếp yêu cầu đến các máy chủ Redis phía sau và trả kết quả trở lại. <strong><a href="https://github.com/twitter/twemproxy" target="_blank" rel="noopener noreferrer">Twemproxy</a></strong> có vấn đề về <strong>điểm đơn</strong> và cần phải kết hợp với Lvs và Keepalived để có giải pháp <strong>cao nhất</strong>.</p>
<ul>
<li><strong>Ưu điểm</strong>: Phạm vi ứng dụng rộng, ổn định, <strong>cao nhất</strong> cho lớp trung gian.</li>
<li><strong>Nhược điểm</strong>: Không thể <strong>mở rộng/ thu hẹp</strong> một cách mượt mà, không có giao diện quản lý <strong>trực quan</strong>, không thể tự động chuyển tiếp khi xảy ra sự cố.</li>
</ul>
<h4>5.2.2. Codis</h4>
<p><a href="https://github.com/CodisLabs/codis" target="_blank" rel="noopener noreferrer"><strong>Codis</strong></a> là một giải pháp Redis <strong>phân tán</strong>. Đối với ứng dụng trên cùng, kết nối với Codis-Proxy và kết nối trực tiếp với Redis-Server gốc không có sự khác biệt. <a href="https://github.com/CodisLabs/codis" target="_blank" rel="noopener noreferrer"><strong>Codis</strong></a> xử lý việc chuyển tiếp yêu cầu và làm việc không ngừng để di chuyển dữ liệu mà không cần tắt máy. <a href="https://github.com/CodisLabs/codis" target="_blank" rel="noopener noreferrer"><strong>Codis</strong></a> sử dụng một lớp trung gian <strong>không có trạng thái</strong>, đối với <strong>khách hàng</strong>, mọi thứ đều trong suốt.</p>
<ul>
<li><strong>Ưu điểm</strong>: Cung cấp <strong>khả năng cao</strong> cho Proxy và Redis gốc, <strong>phân vùng dữ liệu</strong> và <strong>cân bằng tự động</strong>, cung cấp giao diện dòng lệnh và RESTful API, cung cấp giao diện <strong>giám sát</strong> và <strong>quản lý</strong>, cho phép <strong>thêm/xóa</strong> nút Redis động.</li>
<li><strong>Nhược điểm</strong>: <strong>Triển khai kiến trúc</strong> và <strong>cấu hình</strong> phức tạp, không hỗ trợ <strong>đa trụ sở</strong> và <strong>đa người dùng</strong>, không hỗ trợ <strong>quản lý xác thực</strong>.</li>
</ul>
<h3>5.3. Giải pháp định tuyến truy vấn (Query routing)</h3>
<p>Trong giải pháp này, <strong>khách hàng</strong> gửi yêu cầu đến một <strong>nút Redis</strong> bất kỳ, sau đó Redis sẽ <strong>chuyển tiếp</strong> yêu cầu đến <strong>nút Redis</strong> chính xác. Redis Cluster thực hiện một hình thức <strong>định tuyến truy vấn kết hợp</strong>, nhưng không phải là chuyển tiếp yêu cầu từ một nút Redis sang một nút Redis khác, mà là thông qua <strong>chuyển hướng</strong> trực tiếp từ <strong>khách hàng</strong> đến nút Redis chứa dữ liệu.</p>
<ul>
<li><strong>Ưu điểm</strong>: <strong>Phi tập trung</strong>, dữ liệu được lưu trữ và phân phối trên nhiều nút Redis, có thể mở rộng/thu hẹp nút một cách mượt mà, hỗ trợ <strong>cao nhất</strong> và <strong>chuyển tiếp tự động</strong> khi xảy ra sự cố, chi phí quản trị thấp.</li>
<li><strong>Nhược điểm</strong>: Phụ thuộc nặng vào công cụ Redis-trib, thiếu <strong>giám sát quản lý</strong>, phải dựa vào Smart Client (<strong>duy trì kết nối</strong>, <strong>bộ nhớ đệm bảng định tuyến</strong>, hỗ trợ <code>MultiOp</code> và <code>Pipeline</code>). Kiểm tra <strong>Failover</strong> của nút mất thời gian, không thể phân biệt dữ liệu <strong>lạnh/hot</strong> dựa trên thống kê.</li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Redis Data Structures</title>
      <link>https://vanhung4499.github.io/database/redis/data-structures.html</link>
      <guid>https://vanhung4499.github.io/database/redis/data-structures.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Data Structures</source>
      <description>Redis Data Structures SDS Giới thiệu về SDS SDS là viết tắt của Simple Dynamic String, tức là Chuỗi Động Đơn Giản. Redis đã tối ưu SDS để thay thế chuỗi C trong việc biểu diễn n...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>SDS</h2>
<h3>Giới thiệu về SDS</h3>
<p>SDS là viết tắt của Simple Dynamic String, tức là <strong>Chuỗi Động Đơn Giản</strong>. Redis đã tối ưu SDS để thay thế chuỗi C trong việc biểu diễn nội dung chuỗi. Ngoài ra, SDS còn được Redis sử dụng như là vùng đệm (buffer), chẳng hạn như vùng đệm AOF trong mô đun AOF và vùng đệm đầu vào trong trạng thái của khách hàng.</p>
<p>So với chuỗi C, SDS có những ưu điểm sau:</p>
<p>| Chuỗi C                                              | SDS                                                  |<br>
| :</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624213746.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Event</title>
      <link>https://vanhung4499.github.io/database/redis/event.html</link>
      <guid>https://vanhung4499.github.io/database/redis/event.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Event</source>
      <description>Redis Event Máy chủ Redis là một chương trình điều khiển sự kiện, máy chủ cần xử lý hai loại sự kiện: Sự kiện tệp (file event) - Máy chủ Redis giao tiếp với các khách hàng hoặc ...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Máy chủ Redis là một chương trình điều khiển sự kiện, máy chủ cần xử lý hai loại sự kiện:</p>
<ul>
<li><strong>Sự kiện tệp (file event)</strong> - Máy chủ Redis giao tiếp với các khách hàng hoặc các máy chủ khác thông qua các socket. Sự kiện tệp là một sự trừu tượng của các thao tác trên socket. Giao tiếp giữa máy chủ và khách hàng (hoặc các máy chủ khác) sẽ tạo ra các sự kiện tệp, và máy chủ sẽ hoàn thành một loạt các thao tác giao tiếp mạng bằng cách lắng nghe và xử lý các sự kiện này.</li>
<li><strong>Sự kiện thời gian (time event)</strong> - Máy chủ Redis có một số thao tác cần được thực hiện vào một thời điểm nhất định. Sự kiện thời gian là một sự trừu tượng của các thao tác định kỳ này.</li>
</ul>
</blockquote>
<h2>Sự kiện tệp</h2>
<p>Redis đã phát triển bộ xử lý sự kiện mạng của riêng mình dựa trên mô hình Reactor.</p>
<ul>
<li>Bộ xử lý sự kiện tệp của Redis sử dụng chương trình I/O đa luồng để lắng nghe đồng thời nhiều socket và liên kết các trình xử lý sự kiện khác nhau cho các socket dựa trên nhiệm vụ hiện tại của socket.</li>
<li>Khi socket đang được lắng nghe sẵn sàng thực hiện các thao tác kết nối phản hồi, đọc, ghi, hoặc đóng, các sự kiện tệp tương ứng với các thao tác này sẽ được tạo ra. Lúc này, bộ xử lý sự kiện tệp sẽ gọi các trình xử lý sự kiện đã liên kết trước đó với socket để xử lý các sự kiện này.</li>
</ul>
<p>Mặc dù bộ xử lý sự kiện tệp chạy theo cách đơn luồng, nhưng thông qua việc sử dụng chương trình I/O đa luồng để lắng nghe nhiều socket, bộ xử lý sự kiện tệp đã đạt được mô hình giao tiếp mạng hiệu suất cao.</p>
<p>Bộ xử lý sự kiện tệp bao gồm bốn thành phần: socket, chương trình I/O đa luồng, bộ phân phối sự kiện tệp, và trình xử lý sự kiện.</p>
<h2>Sự kiện thời gian</h2>
<p>Sự kiện thời gian được chia thành:</p>
<ul>
<li><strong>Sự kiện định thời</strong>: cho phép một đoạn chương trình được thực thi một lần vào thời điểm được chỉ định.</li>
<li><strong>Sự kiện chu kỳ</strong>: cho phép một đoạn chương trình được thực thi định kỳ sau khoảng thời gian được chỉ định.</li>
</ul>
<p>Redis lưu trữ tất cả các sự kiện thời gian trong một danh sách liên kết không có thứ tự. Mỗi khi bộ xử lý sự kiện thời gian chạy, nó sẽ duyệt qua toàn bộ danh sách để tìm các sự kiện thời gian đã đến hạn và gọi các trình xử lý sự kiện tương ứng.</p>
<h2>Lập lịch và thực thi sự kiện</h2>
<p>Máy chủ Redis cần liên tục lắng nghe các sự kiện tệp trên các socket để xử lý các sự kiện tệp đó. Tuy nhiên, không thể chỉ lắng nghe mãi mà không quan tâm đến các sự kiện thời gian, nếu không các sự kiện thời gian sẽ không được thực thi đúng lúc. Do đó, thời gian lắng nghe cần được xác định dựa trên sự kiện thời gian gần nhất so với thời điểm hiện tại.</p>
<p>Việc lập lịch và thực thi sự kiện được quản lý bởi hàm <code>aeProcessEvents</code>, với mã giả như sau:</p>
<div class="language-python line-numbers-mode" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> aeProcessEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Lấy sự kiện thời gian gần nhất so với thời gian hiện tại</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    time_event </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> aeSearchNearestTimer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Tính toán khoảng thời gian còn lại cho đến khi sự kiện gần nhất xảy ra</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> time_event.when </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> unix_ts_now</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Nếu sự kiện đã đến hạn, giá trị của remaind_ms có thể âm, đặt nó bằng 0</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Tạo timeval dựa trên giá trị remaind_ms</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    timeval </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> create_timeval_with_ms</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(remaind_ms)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Chặn và chờ đợi sự kiện tệp phát sinh, thời gian chặn tối đa được quyết định bởi timeval</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    aeApiPoll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(timeval)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Xử lý tất cả các sự kiện tệp đã phát sinh</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    procesFileEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Xử lý tất cả các sự kiện thời gian đã đến hạn</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    processTimeEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đặt hàm <code>aeProcessEvents</code> trong một vòng lặp, cùng với các hàm khởi tạo và dọn dẹp, sẽ tạo thành hàm chính của máy chủ Redis, mã giả như sau:</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Khởi tạo máy chủ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    init_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Liên tục xử lý sự kiện cho đến khi máy chủ tắt</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> server_is_not_shutdown</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        aeProcessEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Máy chủ tắt, thực hiện các thao tác dọn dẹp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    clean_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span></code></pre>
</div><h2>Lập lịch và thực thi sự kiện</h2>
<h3>Cách thức hoạt động</h3>
<p>Máy chủ cần liên tục lắng nghe các sự kiện tệp để xử lý chúng. Tuy nhiên, để đảm bảo các sự kiện thời gian cũng được thực thi đúng lúc, thời gian lắng nghe các sự kiện tệp được xác định dựa trên thời điểm xảy ra sự kiện thời gian gần nhất.</p>
<h3>Quá trình xử lý sự kiện</h3>
<ol>
<li>Lấy sự kiện thời gian gần nhất so với thời gian hiện tại.</li>
<li>Tính toán khoảng thời gian còn lại cho đến khi sự kiện xảy ra.</li>
<li>Nếu sự kiện đã đến hạn, đặt thời gian còn lại bằng 0.</li>
<li>Tạo giá trị timeval dựa trên thời gian còn lại.</li>
<li>Chặn và chờ đợi sự kiện tệp, thời gian chặn tối đa được quyết định bởi timeval.</li>
<li>Xử lý tất cả các sự kiện tệp đã phát sinh.</li>
<li>Xử lý tất cả các sự kiện thời gian đã đến hạn.</li>
</ol>
<h3>Vòng lặp chính của máy chủ</h3>
<p>Máy chủ Redis liên tục chạy vòng lặp để xử lý các sự kiện cho đến khi máy chủ tắt. Quy trình bao gồm khởi tạo máy chủ, xử lý sự kiện liên tục và thực hiện các thao tác dọn dẹp khi máy chủ tắt.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Redis Expire Delete</title>
      <link>https://vanhung4499.github.io/database/redis/expire.html</link>
      <guid>https://vanhung4499.github.io/database/redis/expire.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Expire Delete</source>
      <description>Redis Expire Delete Xóa khi hết hạn trong Redis Redis cho phép thiết lập thời gian tồn tại (ttl) cho mỗi khóa và tự động xóa khóa khi nó hết hạn. Thiết lập thời gian sống hoặc t...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h3>Xóa khi hết hạn trong Redis</h3>
<p>Redis cho phép thiết lập thời gian tồn tại (ttl) cho mỗi khóa và tự động xóa khóa khi nó hết hạn.</p>
<h4>Thiết lập thời gian sống hoặc thời gian hết hạn của khóa</h4>
<p>Trong Redis, các lệnh liên quan đến thời gian sống của khóa như sau:</p>
<p>| Lệnh                                                | Mô tả                                    |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/dunwu/images/master/snap/202309171537744.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Guide</title>
      <link>https://vanhung4499.github.io/database/redis/guide.html</link>
      <guid>https://vanhung4499.github.io/database/redis/guide.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Guide</source>
      <description>Hướng dẫn Redis 1. Giới thiệu về Redis Redis là một cơ sở dữ liệu key-value nhanh chóng và không phụ thuộc vào quan hệ (NoSQL) được lưu trữ trong bộ nhớ, có thể ánh xạ giữa các ...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>1. Giới thiệu về Redis</h2>
<blockquote>
<p>Redis là một cơ sở dữ liệu key-value nhanh chóng và không phụ thuộc vào quan hệ (NoSQL) được lưu trữ trong bộ nhớ, có thể ánh xạ giữa các khóa và năm loại giá trị khác nhau.</p>
<p>Loại khóa chỉ có thể là chuỗi, các loại giá trị được hỗ trợ bao gồm: chuỗi, danh sách, tập hợp, tập hợp có thứ tự và bảng băm.</p>
</blockquote>
<h3>Các trường hợp sử dụng Redis</h3>
<ul>
<li><strong>Bộ nhớ đệm</strong> - Đặt dữ liệu hot vào bộ nhớ, đặt giới hạn sử dụng bộ nhớ tối đa và chiến lược loại bỏ hết hạn để đảm bảo tỷ lệ trúng đích của bộ nhớ đệm.</li>
<li><strong>Bộ đếm</strong> - Cơ sở dữ liệu bộ nhớ này hỗ trợ các hoạt động đọc và ghi bộ đếm thường xuyên.</li>
<li><strong>Giới hạn ứng dụng</strong> - Hạn chế lưu lượng truy cập vào một trang web.</li>
<li><strong>Hàng đợi tin nhắn</strong> - Sử dụng kiểu dữ liệu danh sách, đó là danh sách liên kết hai chiều.</li>
<li><strong>Bảng tìm kiếm</strong> - Sử dụng kiểu dữ liệu HASH.</li>
<li><strong>Phép giao của tập hợp</strong> - Sử dụng kiểu dữ liệu SET, ví dụ như tìm những người bạn chung của hai người dùng.</li>
<li><strong>Bảng xếp hạng</strong> - Sử dụng kiểu dữ liệu ZSET.</li>
<li><strong>Phiên phân tán</strong> - Lưu trữ phiên của nhiều máy chủ ứng dụng vào Redis để đảm bảo tính nhất quán của phiên.</li>
<li><strong>Khóa phân tán</strong> - Ngoài việc sử dụng SETNX để triển khai khóa phân tán, bạn cũng có thể sử dụng khóa phân tán RedLock do chính thức cung cấp.</li>
</ul>
<h3>Ưu điểm của Redis</h3>
<ul>
<li>Hiệu suất cao - Redis có thể đọc với tốc độ 110.000 lần / giây và ghi với tốc độ 81.000 lần / giây.</li>
<li>Loại dữ liệu phong phú - Hỗ trợ chuỗi, danh sách, tập hợp, tập hợp có thứ tự và bảng băm.</li>
<li>Tính nguyên tử - Tất cả các hoạt động của Redis đều có tính nguyên tử. Một hoạt động đơn lẻ là nguyên tử. Nhiều hoạt động cũng hỗ trợ giao dịch, tức là nguyên tử, bằng cách bao gồm các chỉ thị MULTI và EXEC.</li>
<li>Dữ liệu bền vững - Redis hỗ trợ việc lưu trữ dữ liệu. Có thể lưu trữ dữ liệu trong bộ nhớ và khôi phục lại khi khởi động lại.</li>
<li>Sao lưu - Redis hỗ trợ sao lưu dữ liệu, tức là sao lưu dữ liệu theo chế độ master-slave.</li>
<li>Tính năng phong phú - Redis cũng hỗ trợ xuất bản / đăng ký, thông báo, hết hạn khóa, v.v.</li>
</ul>
<h3>Redis và Memcached</h3>
<p>Redis và Memcached thường được so sánh vì cả hai đều có thể được sử dụng làm bộ nhớ đệm, nhưng chúng có một số khác biệt chính như sau:</p>
<p><strong>Loại dữ liệu</strong></p>
<ul>
<li>Memcached chỉ hỗ trợ kiểu dữ liệu chuỗi;</li>
<li>Trong khi đó, Redis hỗ trợ năm loại dữ liệu khác nhau, giúp nó giải quyết vấn đề một cách linh hoạt hơn.</li>
</ul>
<p><strong>Dữ liệu bền vững</strong></p>
<ul>
<li>Memcached không hỗ trợ tính năng bền vững;</li>
<li>Redis hỗ trợ hai chính sách bền vững: RDB Snapshot và AOF Log.</li>
</ul>
<p><strong>Phân tán</strong></p>
<ul>
<li>Memcached không hỗ trợ phân tán, chỉ có thể triển khai lưu trữ phân tán bằng cách sử dụng thuật toán phân tán như băm nhất quán trên máy khách, điều này yêu cầu tính toán vị trí dữ liệu trên máy khách khi lưu trữ và truy vấn.</li>
<li>Redis Cluster hỗ trợ phân tán.</li>
</ul>
<p><strong>Quản lý bộ nhớ</strong></p>
<ul>
<li>Memcached chia bộ nhớ thành các khối có độ dài cố định để lưu trữ dữ liệu, giải quyết hoàn toàn vấn đề mảnh vụn bộ nhớ, nhưng phương pháp này làm giảm hiệu suất sử dụng bộ nhớ, ví dụ: nếu kích thước khối là 128 byte và chỉ lưu trữ 100 byte dữ liệu, thì 28 byte còn lại sẽ bị lãng phí.</li>
<li>Trong Redis, không phải tất cả dữ liệu đều được lưu trữ trong bộ nhớ, một số giá trị không được sử dụng trong thời gian dài có thể được trao đổi sang đĩa. Dữ liệu của Memcached sẽ luôn nằm trong bộ nhớ.</li>
</ul>
<h3>Tại sao Redis nhanh</h3>
<p>Redis có thể đạt được QPS đơn lẻ lên đến 100.000.</p>
<p>Redis sử dụng mô hình đơn luồng (Redis 6.0 đã hỗ trợ mô hình đa luồng), tại sao nó vẫn có thể đạt được đồng thời cao như vậy?</p>
<ul>
<li>Redis hoàn toàn dựa trên hoạt động bộ nhớ.</li>
<li>Cấu trúc dữ liệu của Redis đơn giản.</li>
<li>Sử dụng mô hình đơn luồng để tránh việc chuyển đổi ngữ cảnh và cạnh tranh giữa các luồng.</li>
<li>Sử dụng mô hình I/O multiplexing (I/O không chặn).</li>
</ul>
<blockquote>
<p>I/O multiplexing</p>
<p>Mô hình I/O multiplexing là khả năng theo dõi cùng một lúc nhiều luồng I/O sự kiện của select, poll, epoll. Khi không hoạt động, nó sẽ chặn luồng hiện tại và khi một hoặc nhiều luồng có sự kiện I/O, nó sẽ được đánh thức từ trạng thái chặn và sau đó chương trình sẽ kiểm tra tất cả các luồng I/O (epoll chỉ kiểm tra các luồng thực sự gửi sự kiện), và chỉ xử lý từng luồng sẵn sàng, điều này tránh các hoạt động không hữu ích lớn.</p>
</blockquote>
<h2>2. Các kiểu dữ liệu trong Redis</h2>
<p>Redis có các kiểu dữ liệu cơ bản: STRING, HASH, LIST, SET, ZSET</p>
<p>Redis cũng có các kiểu dữ liệu nâng cao: BitMap, HyperLogLog, GEO</p>
<p>💡 Để biết thêm thông tin chi tiết về các tính năng và nguyên lý, vui lòng tham khảo: [[Redis Data Types and Applications]]</p>
<h2>3. Xóa dữ liệu không sử dụng trong Redis</h2>
<h3>Điểm chính về xóa dữ liệu trong bộ nhớ</h3>
<ul>
<li><strong>Bộ nhớ tối đa</strong> - Redis cho phép đặt giá trị tối đa của bộ nhớ thông qua tham số <code>maxmemory</code>.</li>
<li><strong>Thời gian hết hạn</strong> - Là cơ chế quan trọng để xóa dữ liệu vô hiệu, trong các lệnh Redis cung cấp, <code>EXPIRE</code>, <code>EXPIREAT</code>, <code>PEXPIRE</code>, <code>PEXPIREAT</code>, <code>SETEX</code> và <code>PSETEX</code> được sử dụng để đặt thời gian hết hạn cho một cặp khóa-giá trị. Khi một cặp khóa-giá trị được liên kết với thời gian hết hạn, nó sẽ tự động bị xóa sau khi hết hạn (hoặc nói cách khác, trở thành không thể truy cập).</li>
<li><strong>Chiến lược xóa</strong> - Khi lưu trữ dữ liệu vào Redis, khi không gian bộ nhớ còn lại không đủ để lưu trữ dữ liệu mới, Redis sẽ thực hiện chiến lược xóa dữ liệu để giải phóng một phần nội dung và đảm bảo dữ liệu mới có thể được lưu trữ trong bộ nhớ. Cơ chế xóa dữ liệu trong bộ nhớ nhằm tối ưu hóa việc sử dụng bộ nhớ, bằng cách đổi lấy một số lần không trúng đích để sử dụng bộ nhớ, đảm bảo rằng dữ liệu được lưu trữ trong bộ nhớ Redis là dữ liệu nóng.</li>
<li><strong>LRU không chính xác</strong> - Trên thực tế, Redis không triển khai LRU đáng tin cậy, có nghĩa là việc xóa khóa không nhất thiết là khóa không được sử dụng lâu nhất.</li>
</ul>
<h3>Thời gian hết hạn của khóa chính</h3>
<p>Redis có thể đặt thời gian hết hạn cho mỗi khóa, khi khóa hết hạn, nó sẽ tự động bị xóa.</p>
<p>Đối với các cấu trúc dữ liệu như bảng băm, chỉ có thể đặt thời gian hết hạn cho toàn bộ khóa (toàn bộ bảng băm), không thể đặt thời gian hết hạn cho từng phần tử trong khóa.</p>
<p>Có thể sử dụng <code>EXPIRE</code> hoặc <code>EXPIREAT</code> để đặt thời gian hết hạn cho khóa.</p>
<blockquote>
<p>🔔 Lưu ý: Nếu thời gian <code>EXPIRE</code> được đặt là số âm, thời gian dấu thời gian <code>EXPIREAT</code> là thời gian hết hạn, khóa sẽ bị xóa trực tiếp.</p>
</blockquote>
<p>Ví dụ:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">SET</span><span style="color:#98C379;--shiki-dark:#98C379"> mykey</span><span style="color:#98C379;--shiki-dark:#98C379"> "Hello"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">"OK"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">EXPIRE</span><span style="color:#98C379;--shiki-dark:#98C379"> mykey</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">TTL</span><span style="color:#98C379;--shiki-dark:#98C379"> mykey</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">10</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">SET</span><span style="color:#98C379;--shiki-dark:#98C379"> mykey</span><span style="color:#98C379;--shiki-dark:#98C379"> "Hello World"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">"OK"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">TTL</span><span style="color:#98C379;--shiki-dark:#98C379"> mykey</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">-1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span></code></pre>
</div><h3>Chiến lược xóa dữ liệu</h3>
<p>Xóa dữ liệu trong bộ nhớ chỉ là một tính năng mà Redis cung cấp, để triển khai tốt hơn tính năng này, cần cung cấp các chiến lược khác nhau cho các tình huống ứng dụng khác nhau, vấn đề cần giải quyết bao gồm cách chọn không gian khóa để xóa? Làm thế nào để chọn khóa để xóa trong không gian khóa?</p>
<p>Redis cung cấp các chiến lược xóa dữ liệu sau để người dùng lựa chọn:</p>
<ul>
<li><strong><code>noeviction</code></strong> - Khi sử dụng bộ nhớ đạt đến ngưỡng, tất cả các lệnh yêu cầu cấp phát bộ nhớ sẽ báo lỗi. Đây là chiến lược mặc định của Redis.</li>
<li><strong><code>allkeys-lru</code></strong> - Trong không gian khóa chính, ưu tiên xóa khóa không được sử dụng gần đây nhất.</li>
<li><strong><code>allkeys-random</code></strong> - Trong không gian khóa chính, xóa ngẫu nhiên một khóa.</li>
<li><strong><code>volatile-lru</code></strong> - Trong không gian khóa có thời gian hết hạn, ưu tiên xóa khóa không được sử dụng gần đây nhất.</li>
<li><strong><code>volatile-random</code></strong> - Trong không gian khóa có thời gian hết hạn, xóa ngẫu nhiên một khóa.</li>
<li><strong><code>volatile-ttl</code></strong> - Trong không gian khóa có thời gian hết hạn, ưu tiên xóa khóa có thời gian hết hạn sớm hơn.</li>
</ul>
<h3>Lựa chọn chiến lược xóa dữ liệu</h3>
<ul>
<li>Nếu <strong>dữ liệu phân bố theo phân phối mũ (có dữ liệu nóng, một số dữ liệu truy cập thường xuyên, một số dữ liệu truy cập ít), hãy sử dụng <code>allkeys-lru</code></strong>.</li>
<li>Nếu <strong>dữ liệu phân bố đồng đều (tần suất truy cập dữ liệu tương đương), hãy sử dụng <code>allkeys-random</code></strong>.</li>
<li>Nếu muốn <strong>sử dụng các giá trị TTL khác nhau để gợi ý cho Redis những khóa nào nên bị xóa, hãy sử dụng <code>volatile-ttl</code></strong>.</li>
<li><strong><code>volatile-lru</code> và <code>volatile-random</code> phù hợp cho các tình huống vừa sử dụng bộ nhớ cache vừa sử dụng lưu trữ bền vững</strong>, tuy nhiên, chúng ta cũng có thể đạt được cùng hiệu quả bằng cách sử dụng hai phiên bản Redis.</li>
<li><strong>Đặt thời gian hết hạn cho khóa thực tế sẽ tiêu tốn nhiều bộ nhớ hơn, do đó, khuyến nghị sử dụng chiến lược <code>allkeys-lru</code> để sử dụng bộ nhớ hiệu quả hơn</strong>.</li>
</ul>
<h3>Triển khai nội bộ</h3>
<p>Có hai cách chính để Redis xóa khóa không hợp lệ:</p>
<ul>
<li>Phương pháp tiêu cực (passive way), khi khóa được truy cập và phát hiện rằng nó không hợp lệ, nó sẽ bị xóa.</li>
<li>Phương pháp tích cực (active way), định kỳ lựa chọn một số khóa không hợp lệ từ không gian khóa có thời gian hết hạn và xóa chúng.</li>
<li>Xóa tích cực: Khi bộ nhớ đã sử dụng vượt quá giới hạn <code>maxmemory</code>, kích hoạt chiến lược xóa tích cực, chiến lược này được cấu hình bằng tham số khởi động để xác định thời gian hết hạn chính xác của khóa được duy trì trong từ điển <code>expires</code>.</li>
</ul>
<h2>4. Lưu trữ dữ liệu trong Redis</h2>
<p>Redis là một cơ sở dữ liệu lưu trữ trong bộ nhớ, để đảm bảo dữ liệu không bị mất sau khi máy chủ gặp sự cố, cần lưu trữ dữ liệu từ bộ nhớ xuống đĩa cứng.</p>
<p>Redis hỗ trợ hai phương pháp lưu trữ dữ liệu: RDB và AOF.</p>
<ul>
<li><strong>RDB (Redis Database) là phương pháp chụp nhanh, nó lưu trữ tất cả dữ liệu Redis tại một thời điểm cụ thể vào một tập tin nhị phân được nén (tập tin RDB)</strong>.</li>
<li>AOF (Append Only File) là một tập tin nhật ký văn bản, nó ghi lại tất cả các lệnh ghi vào cuối tập tin AOF để ghi lại sự thay đổi dữ liệu. Khi máy chủ khởi động lại, nó sẽ tải và thực thi các lệnh này để khôi phục dữ liệu gốc. AOF thích hợp để sử dụng làm <strong>bản sao lưu nóng</strong>.</li>
</ul>
<p>💡 Để biết thêm thông tin chi tiết về các tính năng và nguyên lý, vui lòng tham khảo: [[Redis Persistence]]</p>
<h2>5. Sự kiện trong Redis</h2>
<p>Redis là một máy chủ sự kiện, nó xử lý hai loại sự kiện:</p>
<ul>
<li>
<p><strong>Sự kiện tập tin (file event)</strong>&nbsp;- Redis giao tiếp với khách hàng hoặc các máy chủ khác thông qua socket, sự kiện tập tin là một trừu tượng hóa của hoạt động trên socket. Giao tiếp giữa máy chủ và khách hàng (hoặc các máy chủ khác) tạo ra các sự kiện tập tin, và máy chủ xử lý và xử lý các sự kiện này bằng cách lắng nghe và xử lý chúng.</p>
</li>
<li>
<p><strong>Sự kiện thời gian (time event)</strong>&nbsp;- Redis cần thực hiện một số hoạt động vào một thời điểm nhất định, sự kiện thời gian là một trừu tượng của các hoạt động định thời này.</p>
</li>
</ul>
<h3>Sự kiện tập tin</h3>
<p>Redis đã phát triển trình xử lý sự kiện mạng của riêng mình dựa trên mô hình Reactor.</p>
<ul>
<li>Trình xử lý sự kiện tập tin của Redis sử dụng trình điều khiển I/O đa kênh để lắng nghe đồng thời nhiều socket và liên kết các trình xử lý sự kiện khác nhau với các socket tương ứng dựa trên nhiệm vụ hiện tại của socket.</li>
<li>Khi socket được lắng nghe đã sẵn sàng để thực hiện kết nối, đọc, ghi hoặc đóng, sự kiện tập tin tương ứng sẽ xảy ra và trình xử lý sự kiện tập tin sẽ gọi trình xử lý sự kiện đã được liên kết trước đó với socket để xử lý các sự kiện này.</li>
</ul>
<p>Mặc dù trình xử lý sự kiện tập tin chạy dưới dạng một luồng đơn, nhưng bằng cách sử dụng trình điều khiển I/O đa kênh để lắng nghe nhiều socket, trình xử lý sự kiện tập tin đã triển khai mô hình giao tiếp mạng hiệu suất cao.</p>
<p>Trình xử lý sự kiện tập tin bao gồm bốn thành phần: socket, trình điều khiển I/O đa kênh (I/O Multiplexing), bộ phân phối sự kiện tập tin và trình xử lý sự kiện.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724111451.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h3>Sự kiện thời gian</h3>
<p>Sự kiện thời gian được chia thành hai loại:</p>
<ul>
<li><strong>Sự kiện định thời</strong>: là việc cho phép một đoạn chương trình được thực thi một lần trong khoảng thời gian đã chỉ định;</li>
<li><strong>Sự kiện định kỳ</strong>: là sự kiện cho phép một đoạn chương trình thực thi mỗi khoảng thời gian cụ thể.</li>
</ul>
<p>Redis lưu trữ tất cả các sự kiện thời gian trong một danh sách liên kết không tuần tự. Khi trình thực thi sự kiện thời gian chạy, nó sẽ duyệt qua toàn bộ danh sách liên kết để tìm các sự kiện thời gian đã đến và gọi trình xử lý sự kiện tương ứng.</p>
<h3>Lập lịch và thực thi sự kiện</h3>
<p>Để nhận được các sự kiện tập tin chờ xử lý, máy chủ cần lắng nghe liên tục các socket, nhưng không thể lắng nghe mãi mãi, nếu không sự kiện thời gian sẽ không thể được thực hiện trong thời gian quy định. Do đó, thời gian lắng nghe phải được xác định dựa trên sự kiện thời gian gần nhất.</p>
<p>Lập lịch và thực thi sự kiện được thực hiện bởi hàm aeProcessEvents, mã giả như sau:</p>
<div class="language-python line-numbers-mode" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> aeProcessEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Tìm sự kiện thời gian gần nhất đã đến</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    time_event </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> aeSearchNearestTimer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Tính toán thời gian còn lại đến sự kiện thời gian gần nhất</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> time_event.when </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> unix_ts_now</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Nếu sự kiện đã đến, giá trị remaind_ms có thể là số âm, đặt nó thành 0</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Tạo timeval dựa trên remaind_ms</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    timeval </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> create_timeval_with_ms</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(remaind_ms)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Chờ và chặn để chờ sự kiện tập tin xảy ra, thời gian chặn tối đa được xác định bởi timeval được truyền vào</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    aeApiPoll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(timeval)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Xử lý tất cả các sự kiện tập tin đã xảy ra</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    processFileEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Xử lý tất cả các sự kiện thời gian đã đến</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    processTimeEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đặt hàm aeProcessEvents trong một vòng lặp, kèm theo các hàm khởi tạo và dọn dẹp, sẽ tạo thành hàm chính của máy chủ Redis, mã giả như sau:</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Khởi tạo máy chủ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    init_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Xử lý sự kiện liên tục cho đến khi máy chủ tắt</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> server_is_not_shutdown</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        aeProcessEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Máy chủ tắt, thực hiện dọn dẹp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    clean_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span></code></pre>
</div><h2>6. Giao dịch trong Redis</h2>
<blockquote>
<p><strong>Redis không cung cấp giao dịch nghiêm ngặt, Redis chỉ đảm bảo thực hiện các lệnh theo thứ tự và đảm bảo thực hiện tất cả các lệnh, nhưng khi một lệnh thực hiện không thành công, nó sẽ tiếp tục thực hiện các lệnh tiếp theo mà không có quá trình rollback</strong>.</p>
</blockquote>
<p><code>MULTI</code>, <code>EXEC</code>, <code>DISCARD</code> và <code>WATCH</code> là các lệnh liên quan đến giao dịch trong Redis.</p>
<p>Giao dịch cho phép thực hiện nhiều lệnh cùng một lúc và có hai cam kết quan trọng sau:</p>
<ul>
<li>Giao dịch là một hoạt động cô lập độc lập: Tất cả các lệnh trong giao dịch sẽ được thực hiện theo thứ tự và tuần tự. Trong quá trình thực hiện giao dịch, nó sẽ không bị gián đoạn bởi các yêu cầu lệnh từ khách hàng khác.</li>
<li>Giao dịch là một hoạt động nguyên tử: Tất cả các lệnh trong giao dịch sẽ được thực hiện hoặc không được thực hiện.</li>
</ul>
<h3>MULTI</h3>
<p><strong>Lệnh <a href="https://redis.io/commands/multi" target="_blank" rel="noopener noreferrer"><code>MULTI</code></a> được sử dụng để bắt đầu một giao dịch, nó luôn trả về OK.</strong></p>
<p>Sau khi thực hiện <code>MULTI</code>, khách hàng có thể tiếp tục gửi bất kỳ số lượng lệnh nào đến máy chủ, các lệnh này sẽ không được thực hiện ngay lập tức mà sẽ được đặt vào một hàng đợi. Khi lệnh <code>EXEC</code> được gọi, tất cả các lệnh trong hàng đợi sẽ được thực hiện.</p>
<p>Dưới đây là một ví dụ về giao dịch, nó tăng giá trị của hai khóa <code>foo</code> và <code>bar</code> một cách nguyên tử:</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> MULTI</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">OK</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> INCR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> foo</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">QUEUED</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> INCR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> bar</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">QUEUED</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> EXEC</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) (integer) </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) (integer) </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span></code></pre>
</div><h3>EXEC</h3>
<p><strong>Lệnh <a href="https://redis.io/commands/exec" target="_blank" rel="noopener noreferrer"><code>EXEC</code></a> được sử dụng để kích hoạt và thực hiện tất cả các lệnh trong giao dịch.</strong></p>
<ul>
<li>Nếu khách hàng mở một giao dịch bằng cách sử dụng <code>MULTI</code> nhưng không thực hiện thành công <code>EXEC</code>, tất cả các lệnh trong giao dịch sẽ không được thực hiện.</li>
<li>Trên một khía cạnh khác, nếu khách hàng thực hiện thành công <code>EXEC</code> sau khi mở giao dịch, tất cả các lệnh trong giao dịch sẽ được thực hiện.</li>
</ul>
<h3>DISCARD</h3>
<p><strong>Khi thực hiện lệnh <a href="https://redis.io/commands/discard" target="_blank" rel="noopener noreferrer"><code>DISCARD</code></a>, giao dịch sẽ bị hủy bỏ, hàng đợi giao dịch sẽ được xóa và khách hàng sẽ thoát khỏi trạng thái giao dịch.</strong></p>
<p>Ví dụ:</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> foo </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">OK</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> MULTI</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">OK</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> INCR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> foo</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">QUEUED</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> DISCARD</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">OK</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> GET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> foo</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">"1"</span></span></code></pre>
</div><h3>WATCH</h3>
<p><strong>Lệnh <a href="https://redis.io/commands/watch" target="_blank" rel="noopener noreferrer"><code>WATCH</code></a> trong Redis cung cấp hành vi check-and-set (CAS) cho giao dịch.</strong></p>
<p>Các khóa được theo dõi bởi WATCH sẽ được giám sát và phát hiện xem chúng có bị thay đổi không. Nếu ít nhất một khóa được theo dõi đã được thay đổi trước khi EXEC được thực thi, toàn bộ giao dịch sẽ bị hủy bỏ và EXEC sẽ trả về nil-reply để chỉ ra giao dịch đã thất bại.</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">WATCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mykey</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">val </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> GET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mykey</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">val </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> val </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">MULTI</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mykey </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">$</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">val</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">EXEC</span></span></code></pre>
</div><p>Sử dụng mã trên, nếu giá trị của mykey được thay đổi bởi một khách hàng khác sau khi WATCH được thực thi và trước khi EXEC được thực thi, giao dịch của khách hàng hiện tại sẽ thất bại. Chương trình cần làm là lặp lại thao tác này cho đến khi không có xung đột xảy ra.</p>
<p>Hình thức khóa này được gọi là khóa lạc quan (optimistic lock), đây là một cơ chế khóa rất mạnh mẽ. Và vì hầu hết các khách hàng thường truy cập vào các khóa khác nhau, xung đột xảy ra rất ít, nên thường không cần phải thử lại.</p>
<p>WATCH yêu cầu EXEC chỉ được thực thi khi tất cả các khóa được giám sát không bị thay đổi. Nếu điều kiện này không được đáp ứng, giao dịch sẽ không được thực thi.</p>
<p>Lệnh WATCH có thể được gọi nhiều lần. Giám sát các khóa bắt đầu có hiệu lực sau khi WATCH được thực thi và kết thúc khi EXEC được gọi.</p>
<p>Người dùng cũng có thể giám sát nhiều khóa trong một lệnh WATCH, ví dụ:</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">redis</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> WATCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> key1 key2 key3</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">OK</span></span></code></pre>
</div><h4>Các tình huống hủy WATCH</h4>
<p>Khi EXEC được gọi, giám sát cho tất cả các khóa sẽ bị hủy bỏ, bất kể giao dịch có được thực thi thành công hay không.</p>
<p>Ngoài ra, khi khách hàng ngắt kết nối, giám sát của khách hàng đối với các khóa cũng sẽ bị hủy bỏ.</p>
<p>Sử dụng lệnh UNWATCH không có tham số có thể hủy bỏ giám sát cho tất cả các khóa. Đối với một số giao dịch yêu cầu thay đổi nhiều khóa, đôi khi chương trình cần khóa đồng thời nhiều khóa và kiểm tra xem giá trị hiện tại của các khóa đó có đáp ứng yêu cầu của chương trình hay không. Khi giá trị không đáp ứng yêu cầu, có thể sử dụng lệnh UNWATCH để hủy bỏ giám sát hiện tại, từ bỏ giao dịch này và chờ đợi lần thử giao dịch tiếp theo.</p>
<h4>Sử dụng WATCH để tạo thao tác nguyên tử</h4>
<p>WATCH có thể được sử dụng để tạo ra các thao tác nguyên tử không được tích hợp sẵn trong Redis.</p>
<p>Ví dụ, đoạn mã sau triển khai lệnh ZPOP tự tạo, nó có thể lấy ra phần tử có điểm số nhỏ nhất trong tập hợp có thứ tự:</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">WATCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> zset</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">element </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> ZRANGE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> zset </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">MULTI</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">ZREM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> zset element</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">EXEC</span></span></code></pre>
</div><h3>Rollback</h3>
<p><strong>Redis không hỗ trợ rollback</strong>. Lý do Redis không hỗ trợ rollback:</p>
<ul>
<li>Lệnh Redis chỉ thất bại do cú pháp sai hoặc lệnh được sử dụng trên loại khóa sai.</li>
<li>Vì không cần hỗ trợ rollback, nên Redis có thể giữ cho nội bộ đơn giản và nhanh chóng.</li>
</ul>
<h2>7. Redis Pipeline</h2>
<p>Redis là một dịch vụ TCP dựa trên mô hình C/S và giao thức yêu cầu/phản hồi. Redis hỗ trợ công nghệ Pipeline. Công nghệ Pipeline cho phép gửi yêu cầu theo cách bất đồng bộ, tức là cho phép gửi yêu cầu mới trong khi đáp ứng của yêu cầu cũ vẫn chưa trả về. Phương pháp này có thể cải thiện đáng kể hiệu suất truyền tải.</p>
<p>Khi cần thực thi một loạt lệnh Redis, nếu thực thi từng lệnh một, rõ ràng là rất không hiệu quả. Để giảm số lần truyền thông và giảm độ trễ, có thể sử dụng chức năng Pipeline của Redis. Chức năng Pipeline của Redis không cung cấp hỗ trợ dòng lệnh, nhưng nó được triển khai trong các phiên bản khách hàng của nhiều ngôn ngữ.</p>
<p>Lấy ví dụ với Jedis:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Pipeline</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pipe </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">pipelined</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">multi</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"login:"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, token, user);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"recent:"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, timestamp, token);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (item </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"viewed:"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> token, timestamp, item);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zremrangeByRank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"viewed:"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> token, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">26</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zincrby</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"viewed:"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, item);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">exec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><blockquote>
<p>🔔 Lưu ý: Khi gửi các lệnh bằng Pipeline, Redis Server sẽ đặt một số yêu cầu vào hàng đợi bộ nhớ cache (chiếm bộ nhớ), và sau khi thực thi xong, gửi kết quả một lần duy nhất. Nếu cần gửi một số lượng lớn lệnh, sẽ chiếm nhiều bộ nhớ, do đó nên xử lý theo số lượng hợp lý và chia thành các lô để xử lý.</p>
</blockquote>
<h2>8. Redis Publish/Subscribe</h2>
<p>Redis cung cấp 5 lệnh Publish/Subscribe:</p>
<p>| Lệnh           | Mô tả                                                                |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724111451.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Interview</title>
      <link>https://vanhung4499.github.io/database/redis/interview.html</link>
      <guid>https://vanhung4499.github.io/database/redis/interview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Interview</source>
      <description>Redis Interview Giới thiệu về Redis Redis là gì 【Câu hỏi】 Redis là gì? Redis có những tính năng và đặc điểm gì? 【Trả lời】 Redis là gì: Redis là một cơ sở dữ liệu &amp;quot;in-memory&amp;quot; mã ...</description>
      <category>redis</category>
      <category>interview</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giới thiệu về Redis</h2>
<h3>Redis là gì</h3>
<p>【Câu hỏi】</p>
<ul>
<li>Redis là gì?</li>
<li>Redis có những tính năng và đặc điểm gì?</li>
</ul>
<p>【Trả lời】</p>
<p>Redis là gì:</p>
<p><strong>Redis là một cơ sở dữ liệu "in-memory" mã nguồn mở</strong>. Vì Redis triển khai các thao tác đọc ghi hoàn toàn trong bộ nhớ, do đó, <strong>tốc độ đọc ghi của nó rất nhanh</strong>.</p>
<ul>
<li><strong>Hiệu suất cao</strong> - Do các thao tác đọc ghi của Redis đều triển khai trong bộ nhớ, nên hiệu suất rất cao.</li>
<li><strong>Khả năng xử lý song song cao</strong> - Redis đơn lẻ có thể đạt QPS (số yêu cầu mỗi giây) lên đến 10.0000+, gần gấp 10 lần so với MySQL.</li>
</ul>
<p>Redis thường được sử dụng trong các trường hợp như <strong>bộ nhớ đệm, hàng đợi tin nhắn, khóa phân tán, v.v.</strong>.</p>
<p>Tính năng và đặc điểm của Redis:</p>
<ul>
<li><strong>Redis hỗ trợ nhiều kiểu dữ liệu</strong>. Như: String (chuỗi), Hash (băm), List (danh sách), Set (tập hợp), Zset (tập hợp có thứ tự), Bitmaps (bản đồ bit), HyperLogLog (thống kê cardinal), GEO (không gian địa lý), Stream (dòng).</li>
<li><strong>Redis sử dụng mô hình "đơn luồng" để đọc ghi</strong>, do đó, các thao tác của nó có tính <strong>nguyên tử</strong>.</li>
<li>Redis hỗ trợ hai chiến lược lưu trữ: RDB và AOF.</li>
<li>Redis có nhiều giải pháp khả dụng cao: chế độ <strong>sao chép Master-Slave</strong>, chế độ <strong>sentinel</strong>, chế độ <strong>cụm</strong>.</li>
<li>Redis hỗ trợ nhiều tính năng phong phú như: <strong>giao dịch</strong>, <strong>kịch bản Lua</strong>, <strong>xuất bản/đăng ký</strong>, <strong>xóa dữ liệu hết hạn</strong>, <strong>loại bỏ bộ nhớ</strong>, v.v.</li>
</ul>
<h3>Các trường hợp ứng dụng của Redis</h3>
<p>【Câu hỏi】</p>
<ul>
<li>Redis có những trường hợp ứng dụng nào?</li>
</ul>
<p>【Trả lời】</p>
<ul>
<li><strong>Bộ nhớ đệm</strong> - Đặt dữ liệu nóng vào bộ nhớ, thiết lập giới hạn sử dụng bộ nhớ tối đa và chiến lược loại bỏ hết hạn để đảm bảo tỷ lệ truy xuất bộ nhớ đệm.</li>
<li><strong>Bộ đếm</strong> - Redis là cơ sở dữ liệu trong bộ nhớ có thể hỗ trợ các thao tác đọc ghi thường xuyên của bộ đếm.</li>
<li><strong>Giới hạn truy cập ứng dụng</strong> - Giới hạn lưu lượng truy cập vào một trang web.</li>
<li><strong>Hàng đợi tin nhắn</strong> - Sử dụng kiểu dữ liệu List, là một danh sách liên kết hai chiều.</li>
<li><strong>Bảng tra cứu</strong> - Sử dụng kiểu dữ liệu HASH.</li>
<li><strong>Tính toán tập hợp</strong> - Sử dụng kiểu dữ liệu SET, ví dụ như để tìm bạn chung của hai người dùng.</li>
<li><strong>Bảng xếp hạng</strong> - Sử dụng kiểu dữ liệu ZSET.</li>
<li><strong>Session phân tán</strong> - Session của nhiều máy chủ ứng dụng đều được lưu trữ trong Redis để đảm bảo tính nhất quán của Session.</li>
<li><strong>Khóa phân tán</strong> - Ngoài việc sử dụng SETNX để triển khai khóa phân tán, bạn còn có thể sử dụng RedLock - khóa phân tán chính thức do Redis cung cấp.</li>
</ul>
<h3>Redis vs. Memcached</h3>
<p>【Câu hỏi】</p>
<ul>
<li>Redis và Memcached có những điểm giống nhau nào?</li>
<li>Redis và Memcached có những khác biệt nào?</li>
<li>Khi lựa chọn công nghệ bộ nhớ đệm phân tán, nên chọn Redis hay Memcached, tại sao?</li>
</ul>
<p>【Trả lời】</p>
<p><strong>Điểm giống nhau giữa Redis và Memcached</strong>:</p>
<ol>
<li>Cả hai đều là cơ sở dữ liệu trong bộ nhớ, do đó hiệu suất đều rất cao.</li>
<li>Cả hai đều có chiến lược hết hạn.</li>
</ol>
<p>Vì hai điểm trên, chúng thường được sử dụng làm bộ nhớ đệm.</p>
<p><strong>Điểm khác nhau giữa Redis và Memcached</strong>:</p>
<p>|                 | Redis                                                                             | Memcached                                                                                                                                                                                                                                                  |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://redis.io/docs/management/optimization/benchmarks/Connections_chart.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Operations</title>
      <link>https://vanhung4499.github.io/database/redis/operations.html</link>
      <guid>https://vanhung4499.github.io/database/redis/operations.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Operations</source>
      <description>Quản trị Redis Redis là một cơ sở dữ liệu key-value có hiệu suất cao. Thao tác SET có thể đạt tới 110.000 lần mỗi giây; thao tác GET có thể đạt tới 81.000 lần mỗi giây. 1. Cài đ...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><strong>Redis</strong> là một cơ sở dữ liệu key-value có hiệu suất cao.</p>
<p>Thao tác SET có thể đạt tới 110.000 lần mỗi giây; thao tác GET có thể đạt tới 81.000 lần mỗi giây.</p>
</blockquote>
<h2>1. Cài đặt Redis</h2>
<h3>Cài đặt trên Windows</h3>
<p><strong>Đường dẫn tải về:</strong> <a href="https://github.com/MSOpenTech/redis/releases" target="_blank" rel="noopener noreferrer">https://github.com/MSOpenTech/redis/releases</a>.</p>
<p>Redis hỗ trợ cả phiên bản 32-bit và 64-bit. Bạn cần chọn phiên bản phù hợp với hệ điều hành của bạn. Tại đây, chúng ta tải xuống tệp nén <strong>Redis-x64-xxx.zip</strong> và giải nén vào ổ đĩa C, sau đó đổi tên thư mục thành <strong>redis</strong>.</p>
<p>Mở cửa sổ <strong>cmd</strong> và sử dụng lệnh cd để chuyển đến thư mục <strong>C:\redis</strong>, chạy lệnh <strong>redis-server.exe redis.windows.conf</strong>.</p>
<p>Nếu muốn tiện lợi hơn, bạn có thể thêm đường dẫn của Redis vào biến môi trường hệ thống, điều này sẽ giúp bạn không cần phải nhập đường dẫn mỗi lần sử dụng. Bạn có thể bỏ qua phần redis.windows.conf nếu muốn, nếu bỏ qua, Redis sẽ sử dụng cấu hình mặc định.</p>
<p>Bây giờ mở một cửa sổ cmd mới, không đóng cửa sổ cũ, vì nếu đóng thì bạn sẽ không thể truy cập vào máy chủ dịch vụ nữa.</p>
<p>Chuyển đến thư mục redis và chạy lệnh <strong>redis-cli.exe -h 127.0.0.1 -p 6379</strong>.</p>
<h3>Cài đặt trên Linux</h3>
<p><strong>Đường dẫn tải về:</strong> <a href="http://redis.io/download" target="_blank" rel="noopener noreferrer">http://redis.io/download</a>, tải phiên bản mới nhất.</p>
<p>Tải xuống, giải nén và biên dịch Redis:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">wget</span><span style="color:#98C379;--shiki-dark:#98C379"> http://download.redis.io/releases/redis-5.0.4.tar.gz</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">tar</span><span style="color:#98C379;--shiki-dark:#98C379"> xzf</span><span style="color:#98C379;--shiki-dark:#98C379"> redis-5.0.4.tar.gz</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">cd</span><span style="color:#98C379;--shiki-dark:#98C379"> redis-5.0.4</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">make</span></span></code></pre>
</div><p>Để biên dịch mã nguồn Redis, bạn cần cài đặt gcc-c++ và tcl. Nếu bạn đang sử dụng CentOS, bạn có thể cài đặt bằng lệnh <code>yum install -y gcc-c++ tcl</code>.</p>
<p>Sau khi giải nén, điều hướng đến thư mục <code>src</code> và khởi động Redis bằng lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">src/redis-server</span></span></code></pre>
</div><p>Bạn có thể sử dụng client tích hợp để tương tác với Redis:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> src/redis-cli</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">set</span><span style="color:#98C379;--shiki-dark:#98C379"> foo</span><span style="color:#98C379;--shiki-dark:#98C379"> bar</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">OK</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">get</span><span style="color:#98C379;--shiki-dark:#98C379"> foo</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">"bar"</span></span></code></pre>
</div><h3>Cài đặt trên Ubuntu</h3>
<p>Trên hệ điều hành Ubuntu, bạn có thể cài đặt Redis bằng các lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sudo</span><span style="color:#98C379;--shiki-dark:#98C379"> apt-get</span><span style="color:#98C379;--shiki-dark:#98C379"> update</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sudo</span><span style="color:#98C379;--shiki-dark:#98C379"> apt-get</span><span style="color:#98C379;--shiki-dark:#98C379"> install</span><span style="color:#98C379;--shiki-dark:#98C379"> redis-server</span></span></code></pre>
</div><h3>Tự động khởi động khi máy khởi động</h3>
<ul>
<li>Cấu hình tự động khởi động: <code>echo "/usr/local/bin/redis-server /etc/redis.conf" &gt;&gt; /etc/rc.local</code></li>
</ul>
<h3>Mở cổng trên tường lửa</h3>
<ul>
<li>Thêm quy tắc: <code>iptables -I INPUT -p tcp -m tcp --dport 6379 -j ACCEPT</code></li>
<li>Lưu quy tắc: <code>service iptables save</code></li>
<li>Khởi động lại iptables: <code>service iptables restart</code></li>
</ul>
<h3>Kịch bản cài đặt Redis</h3>
<blockquote>
<p>Kịch bản cài đặt cho môi trường CentOS 7</p>
</blockquote>
<p><strong>Hướng dẫn cài đặt</strong></p>
<ul>
<li>Cài đặt Redis bằng cách biên dịch và đăng ký nó như một dịch vụ systemd</li>
<li>Đường dẫn cài đặt là: <code>/usr/local/redis</code></li>
<li>Phiên bản mặc định là <code>5.0.4</code>, cổng mặc định là <code>6379</code>, mật khẩu truy cập là trống</li>
</ul>
<p><strong>Cách sử dụng</strong></p>
<ul>
<li>Cài đặt mặc định - Chạy bất kỳ lệnh nào sau đây:</li>
</ul>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">curl</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -o-</span><span style="color:#98C379;--shiki-dark:#98C379"> https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">bash</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">wget</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -qO-</span><span style="color:#98C379;--shiki-dark:#98C379"> https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">bash</span></span></code></pre>
</div><ul>
<li>Cài đặt tùy chỉnh - Tải xuống kịch bản và chạy theo định dạng sau:</li>
</ul>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sh</span><span style="color:#98C379;--shiki-dark:#98C379"> redis-install.sh</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [version] [port] [password]</span></span></code></pre>
</div><p>Giải thích các tham số:</p>
<ul>
<li><code>version</code> - số phiên bản Redis</li>
<li><code>port</code> - số cổng dịch vụ Redis</li>
<li><code>password</code> - mật khẩu truy cập</li>
</ul>
<h2>2. Sử dụng và cấu hình Redis đơn</h2>
<h3>Khởi động Redis</h3>
<p><strong>Khởi động dịch vụ Redis</strong></p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">cd</span><span style="color:#98C379;--shiki-dark:#98C379"> /usr/local/redis/src</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./redis-server</span></span></code></pre>
</div><p><strong>Khởi động client Redis</strong></p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">cd</span><span style="color:#98C379;--shiki-dark:#98C379"> /usr/local/redis/src</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./redis-cli</span></span></code></pre>
</div><p><strong>Kiểm tra Redis đã khởi động chưa</strong></p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis-cli</span></span></code></pre>
</div><p>Lệnh trên sẽ mở một terminal như sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#98C379;--shiki-dark:#98C379"> 127.0.0.1:637</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">9&gt;</span></span></code></pre>
</div><p>127.0.0.1 là địa chỉ IP của máy local, 6379 là cổng của dịch vụ Redis. Bây giờ chúng ta gõ lệnh PING.</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#98C379;--shiki-dark:#98C379"> 127.0.0.1:637</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">9&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">ping</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PONG</span></span></code></pre>
</div><p>Điều này chứng tỏ chúng ta đã khởi động Redis thành công.</p>
<h3>Cấu hình Redis thông thường</h3>
<blockquote>
<p>Tệp cấu hình mặc định của Redis là <code>redis.conf</code> trong thư mục gốc.</p>
<p>Nếu bạn muốn chỉ định một tệp cấu hình cụ thể, bạn cần sử dụng lệnh: <code>./redis-server -c xxx.conf</code></p>
<p>Sau mỗi lần thay đổi cấu hình, bạn cần khởi động lại Redis để áp dụng thay đổi.</p>
<p>Cấu hình mặc định của Redis:</p>
<ul>
<li>Tài liệu mô tả bản thân <a href="https://raw.githubusercontent.com/antirez/redis/2.8/redis.conf" target="_blank" rel="noopener noreferrer">redis.conf cho Redis 2.8</a></li>
<li>Tài liệu mô tả bản thân <a href="https://raw.githubusercontent.com/antirez/redis/2.6/redis.conf" target="_blank" rel="noopener noreferrer">redis.conf cho Redis 2.6</a>.</li>
<li>Tài liệu mô tả bản thân <a href="https://raw.githubusercontent.com/antirez/redis/2.4/redis.conf" target="_blank" rel="noopener noreferrer">redis.conf cho Redis 2.4</a>.</li>
</ul>
<p>Từ Redis 2.6 trở đi, bạn có thể truyền các tham số cấu hình Redis trực tiếp từ dòng lệnh. Phương pháp này có thể được sử dụng cho mục đích kiểm tra.</p>
</blockquote>
<h3>Đặt Redis làm tiến trình nền</h3>
<p>Redis mặc định không chạy như một tiến trình nền, nhưng thông thường chúng ta sẽ đặt Redis làm tiến trình nền. Cấu hình: <code>daemonize yes</code></p>
<h4>Truy cập từ xa</h4>
<p>Redis mặc định ràng buộc với địa chỉ 127.0.0.1, điều này chỉ cho phép truy cập từ máy cục bộ. Nếu bạn muốn cho phép truy cập từ xa vào Redis, bạn cần cấu hình: <code>bind 0.0.0.0</code></p>
<h4>Đặt mật khẩu</h4>
<p>Redis mặc định không yêu cầu mật khẩu khi truy cập. Nếu bạn muốn đặt mật khẩu, bạn cần cấu hình như sau:</p>
<ul>
<li><code>protected-mode yes</code></li>
<li><code>requirepass &lt;mật khẩu&gt;</code></li>
</ul>
<h4>Bảng tham số cấu hình</h4>
<p>| Cấu hình                                                                                                                                                                                                               | Mô tả                                                                                                                                                                                                                                                                                   |<br>
| :</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230725005340.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Overview</title>
      <link>https://vanhung4499.github.io/database/redis/overview.html</link>
      <guid>https://vanhung4499.github.io/database/redis/overview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Overview</source>
      <description>Redis Overview Redis là một ứng dụng phổ biến nhất trong việc sử dụng như một bộ đệm phân tán. Để hiểu rõ về Redis, cần nắm vững nguyên lý của bộ đệm và vai trò của Redis như mộ...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Redis là một ứng dụng phổ biến nhất trong việc sử dụng như một bộ đệm phân tán.</p>
<p>Để hiểu rõ về Redis, cần nắm vững nguyên lý của bộ đệm và vai trò của Redis như một giải pháp bộ đệm trong hệ thống ứng dụng.</p>
</blockquote>
<h2>📖 Contents</h2>
]]></content:encoded>
    </item>
    <item>
      <title>Redis Persistence</title>
      <link>https://vanhung4499.github.io/database/redis/persistence.html</link>
      <guid>https://vanhung4499.github.io/database/redis/persistence.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Persistence</source>
      <description>Lưu trữ bền vững trong Redis Redis là cơ sở dữ liệu trong bộ nhớ (in-memory). Để đảm bảo dữ liệu không bị mất sau khi xảy ra sự cố, dữ liệu trong bộ nhớ cần phải được lưu vào đĩ...</description>
      <category>redis</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Redis là cơ sở dữ liệu trong bộ nhớ (in-memory). Để đảm bảo dữ liệu không bị mất sau khi xảy ra sự cố, dữ liệu trong bộ nhớ cần phải được lưu vào đĩa cứng.</p>
<p>Redis hỗ trợ hai phương pháp kiên trì: RDB và AOF. Hai phương pháp kiên trì này có thể được sử dụng đồng thời hoặc riêng biệt.</p>
</blockquote>
<h2>RDB</h2>
<h3>Giới thiệu về RDB</h3>
<p><strong>RDB (Redis Database Backup)</strong> hay còn gọi là "bản snapshot", là quá trình lưu trữ tất cả các cặp khóa-giá trị của cơ sở dữ liệu Redis vào một tệp nhị phân nén gọi là "tệp RDB" vào một thời điểm cụ thể trong quá trình hoạt động.</p>
<p><strong>Lưu trữ RDB</strong> có thể được thực hiện "thủ công" hoặc "tự động" theo định kỳ.</p>
<p><strong>Tệp RDB</strong> được tải khi máy chủ Redis được "khởi động" làm việc "tự động".</p>
<p>Với từng loại cặp khóa-giá trị khác nhau, tệp RDB sẽ sử dụng cách lưu trữ khác nhau.</p>
<p>Sau khi tạo tệp RDB, người dùng có thể sao lưu RDB, sao chép RDB sang các máy chủ khác để tạo bản sao của máy chủ có cùng dữ liệu, hoặc sử dụng khi khởi động lại máy chủ. Tóm lại, <strong>RDB thích hợp cho việc "sao lưu lạnh"</strong>.</p>
<h3>Ưu điểm và Nhược điểm của RDB</h3>
<p><strong>Ưu điểm của RDB</strong></p>
<ul>
<li>
<p><strong>Kích thước nhỏ và phù hợp cho việc sao lưu “lạnh”</strong>: Tệp RDB rất gọn nhẹ và thích hợp để sử dụng làm sao lưu định kỳ. Bạn có thể lên lịch sao lưu theo nhu cầu, ví dụ mỗi giờ lưu trữ dữ liệu trong vòng 24 giờ qua, và mỗi ngày lưu trữ dữ liệu trong vòng 30 ngày qua. Như vậy, ngay cả khi xảy ra sự cố, bạn cũng có thể khôi phục dữ liệu thành các phiên bản khác nhau theo nhu cầu.</p>
</li>
<li>
<p><strong>Tối ưu hiệu năng</strong>: Khi tạo tệp RDB, quá trình chỉ yêu cầu tiến trình cha của Redis fork ra một tiến trình con, và toàn bộ công việc sau đó được tiến trình con thực hiện. Tiến trình cha không cần thực hiện thêm thao tác IO nào, do đó phương pháp lưu trữ bằng RDB có thể tối đa hóa hiệu suất của Redis.</p>
</li>
<li>
<p><strong>Phục hồi nhanh chóng với tập dữ liệu lớn</strong>: Khi phục hồi dữ liệu từ RDB, quá trình này thường nhanh hơn so với AOF.</p>
</li>
</ul>
<p><strong>Nhược điểm của RDB</strong></p>
<ul>
<li>
<p><strong>Rủi ro mất dữ liệu</strong>: Nếu hệ thống gặp sự cố, dữ liệu sau lần tạo bản sao RDB cuối cùng sẽ bị mất đi. Nếu bạn muốn giảm thiểu mất dữ liệu trong trường hợp Redis dừng đột ngột (ví dụ như mất điện), thì phương pháp lưu trữ bằng RDB không phù hợp. Mặc dù bạn có thể cấu hình các điểm lưu trữ khác nhau (ví dụ, mỗi 5 phút và có 100 thao tác ghi vào tập dữ liệu), việc lưu trữ toàn bộ dữ liệu hoàn chỉnh của Redis là một công việc tương đối nặng nề. Thông thường, bạn sẽ thực hiện lưu trữ đầy đủ mỗi 5 phút hoặc lâu hơn, và nếu Redis ngừng hoạt động đột ngột, bạn có thể mất vài phút dữ liệu.</p>
</li>
<li>
<p><strong>Thời gian lưu trữ dài khi tập dữ liệu lớn</strong>: Khi tập dữ liệu lớn, quá trình fork để lưu trữ RDB có thể tốn nhiều thời gian. Điều này có thể dẫn đến việc Redis không thể phản hồi yêu cầu từ người dùng trong vài mili giây. Nếu tập dữ liệu quá lớn và hiệu suất CPU không tốt, tình trạng này có thể kéo dài lên đến 1 giây. AOF cũng cần phải fork, nhưng bạn có thể điều chỉnh tần suất viết lại tệp nhật ký để tăng tính bền bỉ của tập dữ liệu.</p>
</li>
</ul>
<h3>Tạo tệp RDB</h3>
<p>Redis cung cấp hai lệnh để tạo tệp RDB: <a href="https://redis.io/commands/save" target="_blank" rel="noopener noreferrer"><strong><code>SAVE</code></strong></a> và <a href="https://redis.io/commands/bgsave" target="_blank" rel="noopener noreferrer"><strong><code>BGSAVE</code></strong></a>.</p>
<p><strong>Lệnh <code>SAVE</code></strong> được thực thi bởi tiến trình máy chủ trực tiếp và sẽ chặn (block) máy chủ cho đến khi tệp RDB được tạo xong. Trong thời gian chặn này, máy chủ sẽ không thể phản hồi bất kỳ yêu cầu lệnh nào khác.</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; SAVE</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">"OK"</span></span></code></pre>
</div><p><strong>Lệnh <code>BGSAVE</code></strong> khởi động một tiến trình con (fork) để tạo tệp RDB, do đó máy chủ tiếp tục xử lý các yêu cầu lệnh trong khi quá trình tạo tệp RDB diễn ra. Vì vậy, lệnh này không làm chặn máy chủ.</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; BGSAVE</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">"Background saving started"</span></span></code></pre>
</div><blockquote>
<p>🔔 <strong>【Chú ý】</strong></p>
<p><code>BGSAVE</code> sử dụng công nghệ sao chép khi ghi (Copy-On-Write, viết khi sao chép).</p>
<p>Trong quá trình thực thi <code>BGSAVE</code>, các lệnh <code>SAVE</code>, <code>BGSAVE</code>, và <code>BGREWRITEAOF</code> sẽ bị từ chối để tránh xung đột đua ra giữa <code>BGSAVE</code> hiện tại và các hoạt động khác, nhằm tối ưu hóa hiệu suất.</p>
</blockquote>
<p>Quá trình tạo tệp RDB được thực hiện bởi hàm <code>rdb.c/rdbSave</code> trong mã nguồn Redis.</p>
<h3>Tải tệp RDB</h3>
<p>Redis thực hiện việc tải tệp RDB khi máy chủ khởi động mà không cần lệnh đặc biệt để thực hiện điều này.</p>
<p><strong>Việc tải tệp RDB xảy ra tự động khi máy chủ Redis khởi động</strong>. Trong quá trình này, máy chủ sẽ ở trạng thái chặn (block) cho đến khi quá trình tải RDB hoàn tất.</p>
<p>Quá trình tải RDB được thực hiện bởi hàm <code>rdb.c/rdbLoad</code> trong mã nguồn Redis.</p>
<blockquote>
<p>🔔 <strong>【Chú ý】</strong></p>
<p>Do tần suất cập nhật của AOF thường cao hơn so với RDB:</p>
<ul>
<li>Nếu máy chủ có AOF được kích hoạt, máy chủ sẽ ưu tiên sử dụng AOF để khôi phục dữ liệu.</li>
<li>Chỉ khi AOF bị tắt, máy chủ mới sử dụng tệp RDB để khôi phục dữ liệu.</li>
</ul>
</blockquote>
<p>Điều này đảm bảo rằng Redis luôn sử dụng cơ chế lưu trữ phù hợp nhất để đảm bảo an toàn và khôi phục dữ liệu một cách hiệu quả khi khởi động lại.</p>
<h3>Tự động sao lưu định kì</h3>
<p>Redis hỗ trợ tự động thực hiện lệnh <code>BGSAVE</code> theo khoảng thời gian được cấu hình trong tệp <code>redis.conf</code> bằng cách sử dụng tùy chọn <code>save</code>. Tùy chọn <code>save</code> cho phép thiết lập nhiều điều kiện lưu trữ, và khi bất kỳ điều kiện nào được đáp ứng, máy chủ Redis sẽ thực hiện lệnh <code>BGSAVE</code>.</p>
<p><strong>Ví dụ cấu hình tự động lưu trữ trong <code>redis.conf</code>:</strong></p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Trong vòng 900 giây, ít nhất có 1 lần thay đổi cơ sở dữ liệu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">save</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 900</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Trong vòng 300 giây, ít nhất có 10 lần thay đổi cơ sở dữ liệu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">save</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 300</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Trong vòng 60 giây, ít nhất có 10000 lần thay đổi cơ sở dữ liệu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">save</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 60</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10000</span></span></code></pre>
</div><p>Khi bất kỳ điều kiện nào được đáp ứng, Redis sẽ thực hiện lệnh <code>BGSAVE</code>.</p>
<p><strong>Định nghĩa các điều kiện lưu trữ trong <code>redis.h/redisServer</code>:</strong></p>
<div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">struct</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redisServer {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Mảng lưu trữ các điều kiện lưu trữ</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    struct</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> saveparam </span><span style="color:#C678DD;--shiki-dark:#C678DD">*</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">saveparams;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Số lần thay đổi cơ sở dữ liệu kể từ lần SAVE cuối cùng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    long</span><span style="color:#C678DD;--shiki-dark:#C678DD"> long</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> dirty;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Thời điểm thực hiện SAVE lần cuối</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    time_t</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> lastsave;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Cấu trúc điều kiện lưu trữ của máy chủ (các điều kiện tự động thực hiện BGSAVE)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">struct</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> saveparam {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Thời gian giới hạn (seconds)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    time_t</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> seconds;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Số lần thay đổi</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> changes;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">};</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Mảng <code>saveparams</code> trong <code>redisServer</code> duy trì các điều kiện lưu trữ tự động.</p>
<p>Mỗi khi thành công thực hiện một lệnh chỉnh sửa, biến <code>dirty</code> sẽ tăng lên 1 đơn vị; <code>lastsave</code> ghi lại thời điểm lần SAVE cuối cùng được thực hiện. Redis sử dụng hàm <code>serverCron</code> để định kỳ kiểm tra xem các điều kiện được cấu hình trong <code>save</code> có được đáp ứng không. Nếu đáp ứng, Redis sẽ thực hiện lệnh <code>BGSAVE</code>.</p>
<h3>Cấu trúc của tệp RDB</h3>
<p><strong>Tệp RDB là một tệp nhị phân được nén</strong> và được chia thành nhiều phần khác nhau tùy thuộc vào loại dữ liệu (STRING, HASH, LIST, SET, SORTED SET).</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/redis-rdb-structure.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Redis cung cấp công cụ <code>redis-check-dump</code> để kiểm tra tệp RDB.</p>
<h3>Cấu hình RDB</h3>
<p>Mặc định, Redis cấu hình RDB như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>save 900 1</span></span>
<span class="line"><span>save 300 10</span></span>
<span class="line"><span>save 60 10000</span></span>
<span class="line"><span>stop-writes-on-bgsave-error yes</span></span>
<span class="line"><span>rdbcompression yes</span></span>
<span class="line"><span>rdbchecksum yes</span></span>
<span class="line"><span>dbfilename dump.rdb</span></span>
<span class="line"><span>dir ./</span></span></code></pre>
</div><p>Các tùy chọn liên quan đến RDB trong tệp cấu hình <code>redis.conf</code> của Redis:</p>
<ul>
<li><code>save</code>: Redis sẽ tự động thực hiện lệnh <code>BGSAVE</code> theo các điều kiện được cấu hình trong <code>save</code>.</li>
<li><code>stop-writes-on-bgsave-error</code>: Dừng ghi khi có lỗi trong quá trình <code>BGSAVE</code>.</li>
<li><code>rdbcompression</code>: Bật/tắt nén RDB.</li>
<li><code>rdbchecksum</code>: Kiểm tra dữ liệu RDB.</li>
<li><code>dbfilename</code>: Tên tệp RDB.</li>
<li><code>dir</code>: Thư mục lưu trữ tệp RDB và AOF.</li>
</ul>
<h2>2. AOF</h2>
<h3>Giới thiệu về AOF</h3>
<p><code>AOF (Append Only File)</code> là một tệp ghi log mà Redis sử dụng để lưu trữ tất cả các lệnh ghi vào cơ sở dữ liệu. Khi máy chủ khởi động lại, Redis sẽ nạp và thực thi các lệnh từ tệp AOF này để khôi phục dữ liệu gốc. AOF được coi là phương pháp "sao lưu nóng".</p>
<p>AOF có thể được bật bằng cách đặt cấu hình <code>appendonly yes</code>.</p>
<h3>Ưu điểm và nhược điểm của AOF</h3>
<p><strong>Ưu điểm của AOF</strong></p>
<ul>
<li><strong>Giảm thiểu mất mát dữ liệu so với RDB</strong>: Khi hệ thống gặp sự cố, AOF thường mất ít dữ liệu hơn RDB. Bạn có thể cấu hình các chiến lược fsync khác nhau như không có fsync, fsync mỗi giây, hoặc fsync mỗi lần ghi. Với chiến lược mặc định fsync mỗi giây, Redis vẫn duy trì hiệu suất tốt và chỉ mất tối đa 1 giây dữ liệu khi có sự cố.</li>
<li><strong>Khả năng sửa chữa tệp AOF</strong>: Tệp AOF là một tệp log chỉ thêm vào (append-only), do đó không cần phải thực hiện seek khi ghi. Ngay cả khi một số lệnh ghi không được hoàn thành do lý do nào đó (ví dụ như không gian ổ đĩa đầy), bạn vẫn có thể sửa chữa vấn đề này bằng công cụ <code>redis-check-aof</code>.</li>
<li><strong>Nén tệp AOF</strong>: Redis có thể tự động tái viết (rewrite) tệp AOF khi nó trở nên quá lớn. Tệp AOF mới sau khi tái viết chỉ chứa các lệnh tối thiểu cần thiết để khôi phục dữ liệu hiện tại. Quá trình tái viết hoàn toàn an toàn vì Redis vẫn tiếp tục ghi các lệnh vào tệp AOF hiện có trong khi tạo ra tệp AOF mới. Khi tệp AOF mới được tạo xong, Redis sẽ chuyển sang sử dụng tệp AOF mới và tiếp tục ghi vào đó.</li>
<li><strong>Dễ đọc và phân tích</strong>: Tệp AOF lưu trữ tất cả các lệnh ghi vào cơ sở dữ liệu theo đúng thứ tự. Do đó, nội dung của tệp AOF rất dễ đọc và phân tích. Bạn có thể dễ dàng xuất tệp AOF hoặc phân tích nó. Ví dụ, nếu bạn vô tình thực hiện lệnh FLUSHALL, nhưng tệp AOF chưa bị tái viết, bạn có thể dừng máy chủ, loại bỏ lệnh FLUSHALL cuối cùng từ tệp AOF và khởi động lại Redis để khôi phục dữ liệu trước khi thực hiện FLUSHALL.</li>
</ul>
<p><strong>Nhược điểm của AOF</strong></p>
<ul>
<li><strong>Kích thước tệp AOF thường lớn hơn RDB</strong>: Đối với cùng một bộ dữ liệu, tệp AOF thường có kích thước lớn hơn tệp RDB.</li>
<li><strong>Khôi phục bộ dữ liệu lớn từ AOF có thể chậm hơn RDB</strong>: Tùy thuộc vào chiến lược fsync được sử dụng, AOF có thể chậm hơn so với RDB trong quá trình khôi phục dữ liệu lớn. Tuy nhiên, với fsync mỗi giây, hiệu suất của AOF vẫn rất cao và có thể xứng đáng với tốc độ của RDB. Tuy nhiên, trong các tải ghi lớn, RDB có thể cung cấp thời gian đáp ứng tối đa đáng tin cậy hơn.</li>
</ul>
<h3>Tạo AOF</h3>
<p><strong>Các yêu cầu lệnh Redis sẽ được lưu vào vùng đệm AOF, sau đó được ghi và đồng bộ hóa định kỳ vào tệp AOF.</strong></p>
<p>Việc triển khai AOF có thể chia thành ba bước: ghi lệnh (append), ghi tệp và đồng bộ hóa tệp (sync).</p>
<ul>
<li>
<p><strong>Ghi lệnh (append)</strong> - Khi chức năng AOF của máy chủ Redis được bật, máy chủ sẽ thêm lệnh ghi sẽ thực thi vào cuối vùng đệm AOF dưới dạng giao thức lệnh Redis.</p>
</li>
<li>
<p><strong>Ghi tệp và đồng bộ hóa tệp</strong></p>
<ul>
<li>Quá trình sự kiện của máy chủ Redis là một vòng lặp sự kiện, trong đó sự kiện tệp chịu trách nhiệm nhận yêu cầu lệnh từ khách hàng và gửi phản hồi lệnh cho khách hàng. Trong khi đó, sự kiện thời gian chịu trách nhiệm thực hiện các chức năng chạy định kỳ như <code>serverCron</code>.</li>
<li>Vì máy chủ có thể thực hiện lệnh ghi khi xử lý sự kiện tệp, các lệnh ghi này sẽ được thêm vào vùng đệm AOF. Trước khi kết thúc vòng lặp sự kiện, máy chủ sẽ kiểm tra nội dung vùng đệm AOF dựa trên tùy chọn <code>appendfsync</code> để quyết định xem liệu nội dung này có cần được ghi vào và đồng bộ hóa với tệp AOF hay không.</li>
</ul>
</li>
</ul>
<p>Tùy chọn <code>appendfsync</code> quyết định hành vi bền vững của AOF như sau:</p>
<ul>
<li><strong><code>always</code></strong> - Ghi tất cả nội dung từ vùng đệm AOF vào và đồng bộ hóa với tệp AOF. Phương pháp này đảm bảo an toàn dữ liệu nhất nhưng hiệu suất thấp nhất.</li>
<li><strong><code>no</code></strong> - Ghi tất cả nội dung từ vùng đệm AOF vào tệp AOF nhưng không đồng bộ hóa, thời điểm đồng bộ hóa phụ thuộc vào hệ điều hành. Đây là phương pháp dữ liệu không an toàn nhất, mọi dữ liệu chưa kịp đồng bộ hóa khi gặp sự cố sẽ bị mất.</li>
<li><strong><code>everysec</code></strong> - Tùy chọn mặc định của <code>appendfsync</code>. Ghi tất cả nội dung từ vùng đệm AOF vào tệp AOF, và nếu thời gian từ lần đồng bộ hóa AOF trước đó đã quá 1 giây, sẽ tiếp tục đồng bộ hóa. Thao tác này được thực hiện bởi một luồng đặc biệt, đảm bảo hiệu suất đủ tốt và chỉ mất dữ liệu trong vòng một giây nếu có sự cố.</li>
</ul>
<p>Lựa chọn của <code>appendfsync</code> ảnh hưởng đáng kể đến tính bảo mật của chức năng bền vững của AOF và hiệu suất của máy chủ Redis.</p>
<h3>Tải lại AOF</h3>
<p>AOF (Append Only File) là một phương pháp lưu trữ dữ liệu trong Redis bằng cách ghi tất cả các lệnh ghi vào một tệp log. Khi máy chủ Redis khởi động lại sau một sự cố hoặc tái khởi động, AOF được sử dụng để tái tạo lại trạng thái cơ sở dữ liệu trước khi máy chủ tắt.</p>
<p>Quá trình tải lại AOF được thực hiện như sau:</p>
<ol>
<li>
<p><strong>Khởi động chương trình tải lại của máy chủ</strong>: Khi Redis bắt đầu, nó khởi động một quy trình đặc biệt để tải lại dữ liệu từ tệp AOF.</p>
</li>
<li>
<p><strong>Tạo một khách hàng giả</strong>: Do lệnh Redis chỉ có thể thực thi trong ngữ cảnh khách hàng, Redis cần tạo ra một khách hàng giả để thực hiện và thực thi các lệnh trong tệp AOF.</p>
</li>
<li>
<p><strong>Phân tích và đọc lệnh ghi từ tệp AOF</strong>: Chương trình tải lại sẽ bắt đầu đọc và phân tích các lệnh ghi trong tệp AOF. Mỗi lệnh được lưu trong tệp AOF dưới định dạng giao thức lệnh Redis.</p>
</li>
<li>
<p><strong>Thực thi lệnh bằng khách hàng giả</strong>: Sau khi phân tích, chương trình tải lại sẽ sử dụng khách hàng giả để thực thi mỗi lệnh ghi từ tệp AOF. Điều này có nghĩa là Redis sẽ thực hiện mọi thay đổi dữ liệu được lưu trong các lệnh ghi này.</p>
</li>
<li>
<p><strong>Lặp lại quá trình đọc và thực thi lệnh</strong>: Quá trình đọc và thực thi lệnh sẽ tiếp tục cho đến khi tất cả các lệnh ghi từ tệp AOF được xử lý hoàn tất.</p>
</li>
<li>
<p><strong>Hoàn thành quá trình tải lại</strong>: Sau khi tất cả các lệnh đã được thực thi từ tệp AOF, quá trình tải lại sẽ kết thúc và Redis sẵn sàng hoạt động với dữ liệu được phục hồi từ tệp AOF.</p>
</li>
</ol>
<h3>Viết lại AOF</h3>
<p>Dưới sự hoạt động liên tục của Redis, kích thước của tệp AOF cũng sẽ không ngừng tăng lên, điều này gây ra hai vấn đề chính:</p>
<ul>
<li>AOF có thể làm đầy không gian lưu trữ trên đĩa.</li>
<li>Khi Redis khởi động lại, tất cả các lệnh ghi trong tệp AOF phải được thực thi để khôi phục lại tập dữ liệu. Nếu kích thước của AOF quá lớn, thời gian để thực hiện quá trình khôi phục cũng sẽ rất lâu.</li>
</ul>
<p>Để giải quyết vấn đề về kích thước của tệp AOF phình ra, Redis cung cấp tính năng ghi lại AOF (AOF rewrite) để nén tệp AOF. <strong>Quá trình ghi lại AOF tạo ra một tệp AOF mới, tệp này giữ nguyên trạng thái cơ sở dữ liệu như trong tệp AOF ban đầu, nhưng kích thước nhỏ hơn</strong>.</p>
<p>Quá trình ghi lại AOF không phải là đọc và phân tích nội dung của tệp AOF hiện tại, mà là trực tiếp đọc trạng thái cơ sở dữ liệu hiện tại từ Redis. Nghĩa là từng giá trị hiện tại của các khóa trong cơ sở dữ liệu được đọc và ghi vào tệp mới bằng một lệnh duy nhất, thay thế cho những lệnh có thể đã trùng lặp từ trước.</p>
<h3>AOF Đồng Bộ Hóa Nền</h3>
<p>Là một tính năng hỗ trợ, rõ ràng Redis không muốn khi thực hiện việc ghi lại AOF làm ảnh hưởng đến việc nhận các lệnh Redis dịch vụ khác. Do đó, Redis quyết định sử dụng lệnh <code>BGREWRITEAOF</code> để tạo một tiến trình con để chịu trách nhiệm tái viết tệp AOF, tương tự như cách làm của <code>BGSAVE</code>.</p>
<ul>
<li>Khi thực hiện lệnh <code>BGREWRITEAOF</code>, máy chủ Redis duy trì một vùng đệm tái viết AOF. Khi tiến trình con tái viết AOF bắt đầu làm việc, Redis sau mỗi lần thực hiện một lệnh ghi, cả hai gửi lệnh này đến vùng đệm ghi AOF và vùng đệm tái viết AOF.</li>
<li>Vì tiến trình con và tiến trình chính không hoạt động trong cùng một tiến trình, do đó quá trình tái viết AOF không ảnh hưởng đến quá trình ghi và đồng bộ hóa AOF. Khi tiến trình con hoàn thành công việc tạo tệp AOF mới, máy chủ sẽ thêm tất cả nội dung từ vùng đệm tái viết vào cuối tệp AOF mới, đảm bảo rằng trạng thái cơ sở dữ liệu được lưu trữ trong hai tệp AOF cũ và mới là như nhau.</li>
</ul>
<blockquote>
<p>Quá trình thực hiện lệnh <code>BGREWRITEAOF</code> sử dụng kỹ thuật sao chép khi ghi (Copy-On-Write, viết tắt là CoW).</p>
</blockquote>
<p>Bạn có thể thiết lập <code>auto-aof-rewrite-percentage</code> và <code>auto-aof-rewrite-min-size</code> để Redis tự động thực hiện <code>BGREWRITEAOF</code> khi đạt điều kiện nhất định.</p>
<p>Ví dụ cấu hình như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>auto-aof-rewrite-percentage 100</span></span>
<span class="line"><span>auto-aof-rewrite-min-size 64mb</span></span></code></pre>
</div><p>Điều này chỉ ra rằng khi AOF lớn hơn <code>64MB</code>, và kích thước AOF lớn hơn ít nhất <code>100%</code> so với lần tái viết trước đó, Redis sẽ thực hiện lệnh <code>BGREWRITEAOF</code>.</p>
<h3>Cấu hình AOF</h3>
<p>Cấu hình mặc định của AOF trong Redis:</p>
<div class="language-plaintext" data-ext="plaintext" data-title="plaintext"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>appendonly no</span></span>
<span class="line"><span>appendfsync everysec</span></span>
<span class="line"><span>no-appendfsync-on-rewrite no</span></span>
<span class="line"><span>auto-aof-rewrite-percentage 100</span></span>
<span class="line"><span>auto-aof-rewrite-min-size 64mb</span></span></code></pre>
</div><p>Các cài đặt mặc định này có thể được điều chỉnh trong tệp cấu hình Redis (<code>redis.conf</code>). Dưới đây là các tùy chọn cấu hình AOF và ý nghĩa của chúng:</p>
<ul>
<li>
<p><strong><code>appendonly</code></strong> - Mở tính năng AOF (append-only file). Khi được thiết lập thành <code>yes</code>, Redis sẽ bắt đầu ghi lại các câu lệnh vào tệp AOF để bảo vệ dữ liệu khi Redis khởi động lại.</p>
</li>
<li>
<p><strong><code>appendfsync</code></strong> - Xác định tần suất đồng bộ hóa AOF với đĩa. Các giá trị có thể là:</p>
<ul>
<li><strong><code>always</code></strong> - Mỗi lệnh ghi vào Redis sẽ được đồng bộ hóa ngay lập tức với đĩa. Tuy nhiên, điều này có thể làm giảm hiệu suất của Redis do tần suất ghi đĩa cao.</li>
<li><strong><code>everysec</code></strong> - Redis sẽ đồng bộ hóa AOF với đĩa mỗi giây một lần. Đây là tùy chọn được khuyến khích vì nó cân bằng giữa hiệu suất và an toàn dữ liệu. Khi sử dụng tùy chọn này, Redis sẽ ghi vào AOF một lần mỗi giây, giúp bảo vệ dữ liệu mà không ảnh hưởng quá nhiều đến hiệu suất.</li>
<li><strong><code>no</code></strong> - Hệ điều hành quyết định khi nào cần đồng bộ hóa với đĩa. Đây là tùy chọn ít an toàn vì dữ liệu có thể bị mất nếu hệ thống gặp sự cố.</li>
</ul>
</li>
<li>
<p><strong><code>no-appendfsync-on-rewrite</code></strong> - Khi thực hiện quá trình tái viết AOF, Redis sẽ không đồng bộ hóa AOF với đĩa để tránh làm gián đoạn hoạt động ghi mới. Tùy chọn này giúp duy trì hiệu suất cao trong khi tái viết AOF.</p>
</li>
<li>
<p><strong><code>auto-aof-rewrite-percentage</code></strong> - Độ lớn tệp AOF hiện tại so với tệp AOF gần nhất sau khi thực hiện tái viết. Nếu tệp AOF hiện tại lớn hơn mức này, Redis sẽ tự động thực hiện tái viết AOF để nén tệp AOF. Giá trị mặc định là 100%, nghĩa là khi tệp AOF hiện tại lớn hơn hoặc bằng tệp tái viết gần đây nhất, Redis sẽ tái viết AOF.</p>
</li>
<li>
<p><strong><code>auto-aof-rewrite-min-size</code></strong> - Kích thước tối thiểu mà tệp AOF phải đạt được để Redis tự động thực hiện tái viết. Giá trị mặc định là <code>64mb</code>, nghĩa là Redis sẽ tự động tái viết AOF nếu kích thước tệp AOF hiện tại lớn hơn hoặc bằng <code>64MB</code>.</p>
</li>
<li>
<p><strong><code>dir</code></strong> - Đường dẫn nơi lưu trữ tệp RDB và AOF.</p>
</li>
</ul>
<h2>3. RDB vs AOF</h2>
<blockquote>
<p>Khi Redis khởi động, nếu cả RDB và AOF đều được kích hoạt, chương trình sẽ ưu tiên sử dụng tập tin AOF để khôi phục tập dữ liệu, vì tập tin AOF thường chứa dữ liệu hoàn chỉnh nhất.</p>
</blockquote>
<h3>Lựa chọn cơ chế lưu trữ</h3>
<ul>
<li>Nếu không quan tâm đến mất dữ liệu, bạn có thể không cần lưu trữ.</li>
<li>Nếu chấp nhận mất dữ liệu trong vài phút, chỉ cần sử dụng RDB.</li>
<li>Nếu không thể chấp nhận mất dữ liệu trong vài phút, hãy sử dụng cả RDB và AOF.</li>
</ul>
<p>Nhiều người dùng chỉ sử dụng AOF cho lưu trữ, nhưng điều này không được khuyến khích vì việc tạo snapshot RDB định kỳ rất thuận tiện cho sao lưu cơ sở dữ liệu và khôi phục nhanh chóng hơn so với AOF. Ngoài ra, việc sử dụng snapshot cũng giúp tránh được những lỗi chương trình của AOF.</p>
<h3>Chuyển từ RDB sang AOF</h3>
<p>Trong Redis phiên bản 2.2 trở lên, bạn có thể chuyển từ RDB sang AOF mà không cần khởi động lại Redis:</p>
<ul>
<li>Sao lưu tệp dump.rdb mới nhất.</li>
<li>Đặt sao lưu vào một vị trí an toàn.</li>
<li>Thực hiện hai lệnh sau:
<ul>
<li>redis-cli config set appendonly yes</li>
<li>redis-cli config set save</li>
</ul>
</li>
<li>Đảm bảo rằng các lệnh ghi sẽ được ghi đúng vào cuối tệp AOF.</li>
<li>Lệnh đầu tiên được thực hiện để bật chức năng AOF: Redis sẽ chặn cho đến khi tệp AOF ban đầu được tạo xong, sau đó Redis sẽ tiếp tục xử lý các yêu cầu lệnh và bắt đầu ghi các lệnh ghi vào cuối tệp AOF.</li>
</ul>
<p>Lệnh thứ hai được sử dụng để tắt chức năng snapshot. Bước này là tùy chọn, nếu bạn muốn, bạn cũng có thể sử dụng cả snapshot và AOF cùng một lúc.</p>
<blockquote>
<p>🔔 Quan trọng: Đừng quên mở chức năng AOF trong <code>redis.conf</code>! Nếu không, sau khi khởi động lại máy chủ, các cấu hình được thiết lập trước đó thông qua CONFIG SET sẽ bị mất và chương trình sẽ khởi động máy chủ theo cấu hình ban đầu.</p>
</blockquote>
<h3>Tương tác giữa AOF và RDB</h3>
<p>Lệnh&nbsp;<code>BGSAVE</code>&nbsp;và&nbsp;<code>BGREWRITEAOF</code>&nbsp;không thể được thực thi cùng lúc. Điều này nhằm tránh hai tiến trình Redis nền cùng thực hiện nhiều hoạt động I/O trên đĩa cùng một lúc.</p>
<p>Nếu lệnh&nbsp;<code>BGSAVE</code>&nbsp;đang được thực thi và người dùng gọi lệnh&nbsp;<code>BGREWRITEAOF</code>&nbsp;một cách rõ ràng, máy chủ sẽ trả lời người dùng với trạng thái OK và thông báo rằng&nbsp;<code>BGREWRITEAOF</code>&nbsp;đã được đặt lịch để thực thi. Sau khi&nbsp;<code>BGSAVE</code>&nbsp;hoàn thành,&nbsp;<code>BGREWRITEAOF</code>&nbsp;sẽ bắt đầu chính thức.</p>
<h3>Lưu trữ kết hợp</h3>
<p>Redis 4.0 đưa ra <strong>lưu trữ kết hợp AOF và snapshot trong bộ nhớ</strong>, hay còn gọi là lưu trữ kết hợp, để cân bằng tốc độ khởi động lại Redis và giảm rủi ro mất dữ liệu.</p>
<p>Trong lưu trữ kết hợp, trong quá trình tái viết AOF, tiến trình con tái viết sẽ đầu tiên ghi dữ liệu bộ nhớ chia sẻ với tiến trình chính dưới dạng snapshot RDB vào tệp AOF. Sau đó, các lệnh hoạt động được ghi trong bộ đệm tái viết sẽ được ghi vào tệp AOF dưới dạng tăng dần AOF. Khi việc ghi kết thúc, tiến trình chính sẽ thay thế tệp AOF cũ bằng tệp AOF mới có định dạng RDB và AOF.</p>
<p>Nói cách khác, khi sử dụng lưu trữ kết hợp, <strong>phần đầu của tệp AOF là dữ liệu đầy đủ định dạng RDB và phần cuối cùng là dữ liệu tăng dần định dạng AOF</strong>.</p>
<h2>4. Sao lưu Redis</h2>
<p>Đảm bảo rằng dữ liệu Redis được sao lưu đầy đủ là rất quan trọng.</p>
<h3>Lời khuyên về sao lưu</h3>
<p>Đề xuất sử dụng RDB để sao lưu dữ liệu Redis.</p>
<h3>Quy trình sao lưu</h3>
<ol>
<li>
<p><strong>Thiết lập công việc định kỳ (cron job)</strong>: Tạo một công việc định kỳ, sao lưu một tập tin RDB vào một thư mục mỗi giờ và sao lưu một tập tin RDB vào một thư mục khác mỗi ngày.</p>
</li>
<li>
<p><strong>Giữ lại sao lưu và thêm dấu thời gian</strong>: Đảm bảo rằng các tập tin sao lưu chứa thông tin về ngày và giờ tương ứng. Khi thực hiện công việc định kỳ, sử dụng lệnh <code>find</code> để xóa các bản sao lưu cũ. Ví dụ, có thể giữ lại các bản sao lưu mỗi giờ trong vòng 48 giờ qua và giữ lại các bản sao lưu mỗi ngày trong vòng một đến hai tháng qua.</p>
</li>
<li>
<p><strong>Sao lưu ngoại tuyến</strong>: Ít nhất mỗi ngày một lần, sao lưu RDB ra khỏi trung tâm dữ liệu hoặc ít nhất là sao lưu ra khỏi máy chủ vật lý đang chạy Redis.</p>
</li>
</ol>
<h3>Sao lưu phòng chống thảm họa</h3>
<p>Sao lưu phòng chống thảm họa Redis chủ yếu là sao lưu dữ liệu và truyền sao lưu đó đến nhiều trung tâm dữ liệu bên ngoài khác nhau.</p>
<p>Sao lưu phòng chống thảm họa cho phép dữ liệu vẫn an toàn khi trung tâm dữ liệu chính sản xuất vấn đề nghiêm trọng.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/redis-rdb-structure.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Pipeline</title>
      <link>https://vanhung4499.github.io/database/redis/pipeline.html</link>
      <guid>https://vanhung4499.github.io/database/redis/pipeline.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Pipeline</source>
      <description>Redis Pipeline Giới thiệu về Pipeline trong Redis Redis là một dịch vụ TCP dựa trên mô hình Client/Server và giao thức yêu cầu/đáp ứng. Thông thường, quá trình yêu cầu và đáp ứn...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giới thiệu về Pipeline trong Redis</h2>
<p>Redis là một dịch vụ TCP dựa trên mô hình Client/Server và giao thức yêu cầu/đáp ứng. Thông thường, quá trình yêu cầu và đáp ứng của mỗi lệnh Redis diễn ra như sau:</p>
<ul>
<li>Khách hàng gửi yêu cầu truy vấn đến máy chủ và lắng nghe Socket để nhận phản hồi từ máy chủ (thường là ở chế độ chặn, chờ máy chủ phản hồi).</li>
<li>Máy chủ xử lý lệnh và gửi kết quả trả về cho khách hàng.</li>
</ul>
<p>Rõ ràng, nếu mỗi lệnh Redis phải gửi yêu cầu và nhận phản hồi một lần thì sẽ rất không hiệu quả. Do đó, Redis cung cấp một kỹ thuật xử lý hàng loạt, gọi là <strong>Pipeline (Đường ống)</strong>. Nguyên lý hoạt động của Pipeline là:</p>
<p><strong>Gửi đồng thời nhiều lệnh Redis đến máy chủ, máy chủ xử lý và trả về tất cả kết quả một lần cho khách hàng.</strong> Nhờ vào việc giảm số lần giao tiếp mạng, Pipeline giúp cải thiện đáng kể hiệu suất xử lý.</p>
<figure><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7268887661/p514690.jpg" alt="Redis Pipeline" tabindex="0" loading="lazy"><figcaption>Redis Pipeline</figcaption></figure>
<h2>Giới hạn của Pipeline trong Redis</h2>
<p>Khi sử dụng công nghệ Pipeline trong Redis, cần lưu ý những giới hạn sau để tránh gặp phải các vấn đề không mong muốn:</p>
<ul>
<li>
<p><strong>Pipeline không đảm bảo tính nguyên tử</strong> - Pipeline chỉ là cách thức cho phép khách hàng gửi nhiều lệnh cùng lúc đến máy chủ, nhưng máy chủ nhận được các lệnh từ Pipeline sẽ phân tích thành từng lệnh riêng lẻ và thực thi chúng theo thứ tự tuần tự. Trong quá trình thực thi, máy chủ có thể thực hiện các lệnh của các khách hàng khác, do đó không thể đảm bảo tính nguyên tử. Để đảm bảo tính nguyên tử, bạn nên sử dụng giao dịch (transaction) hoặc kịch bản Lua.</p>
</li>
<li>
<p><strong>Pipeline không hỗ trợ việc lăn ngược (rollback)</strong> - Pipeline không có tính năng giao dịch, vì vậy nếu các lệnh trong Pipeline có sự phụ thuộc vào nhau, bạn không nên sử dụng Pipeline.</p>
</li>
<li>
<p><strong>Không nên gửi quá nhiều lệnh trong một lần bằng Pipeline</strong> - Khi sử dụng Pipeline để gửi lệnh, Redis Server sẽ đặt một phần yêu cầu vào hàng đợi bộ nhớ đệm và gửi kết quả một lần sau khi thực thi xong. Nếu gửi quá nhiều lệnh, sẽ tốn nhiều bộ nhớ, do đó nên chia thành các lô lệnh hợp lý để xử lý.</p>
</li>
<li>
<p><strong>Pipeline không hỗ trợ truy cập qua nhiều slot</strong> - Do Pipeline không hỗ trợ truy cập qua nhiều slot, nên khi sử dụng Redis Cluster và Pipeline, bạn cần đảm bảo rằng các khóa truy cập đều thuộc cùng một slot.</p>
</li>
</ul>
<h2>Ví dụ pipeline</h2>
<p>Các Redis Client chính thống thường hỗ trợ công nghệ pipeline.</p>
<p>Đây là một ví dụ về việc sử dụng pipeline trong Jedis để tương tác với Redis:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Demo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "localhost"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75"> jedis</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Jedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(host, port);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> key</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "pipeline:test"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        jedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(key);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        //</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7268887661/p514690.jpg" type="image/jpeg"/>
    </item>
    <item>
      <title>Redis Publish and Subcribe</title>
      <link>https://vanhung4499.github.io/database/redis/pub-sub.html</link>
      <guid>https://vanhung4499.github.io/database/redis/pub-sub.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Publish and Subcribe</source>
      <description>Redis Pub/Sub Redis Pub/Sub (Phát hành/Đăng ký) là một mô hình truyền thông tin: người gửi (pub) gửi thông báo, người nhận (sub) nhận thông báo. Khách hàng Redis có thể đăng ký ...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Redis Pub/Sub (Phát hành/Đăng ký) là một mô hình truyền thông tin: người gửi (pub) gửi thông báo, người nhận (sub) nhận thông báo. Khách hàng Redis có thể đăng ký bất kỳ số lượng kênh nào.</p>
<p>Redis có hai chế độ phát hành/đăng ký:</p>
<ul>
<li>Phát hành/đăng ký dựa trên kênh (Channel-based)</li>
<li>Phát hành/đăng ký dựa trên mẫu (Pattern-based)</li>
</ul>
</blockquote>
<h2>Mô hình quan sát viên</h2>
<p>Redis Pub/Sub áp dụng mô hình thiết kế kinh điển "mô hình quan sát viên" trong thiết kế phần mềm.</p>
<p><strong>Mô hình quan sát viên</strong> (Observer) là một mô hình thiết kế hành vi, cho phép bạn định nghĩa một cơ chế đăng ký để thông báo cho nhiều đối tượng khác khi có sự kiện xảy ra với đối tượng được quan sát.</p>
<ul>
<li>Mô hình này được sử dụng khi thay đổi trạng thái của một đối tượng cần thay đổi các đối tượng khác, hoặc các đối tượng thực tế chưa biết trước hoặc thay đổi động.</li>
<li>Mô hình này có thể được sử dụng khi một số đối tượng trong ứng dụng phải quan sát các đối tượng khác, nhưng chỉ trong một thời gian giới hạn hoặc trong những tình huống cụ thể.</li>
</ul>
<figure><img src="https://d1.awsstatic.com/product-marketing/Messaging/sns_img_topic.e024462ec88e79ed63d690a2eed6e050e33fb36f.png" alt="Mô hình quan sát viên" tabindex="0" loading="lazy"><figcaption>Mô hình quan sát viên</figcaption></figure>
<h2>Chế độ đăng ký của Redis</h2>
<p>Redis có hai chế độ phát hành/đăng ký:</p>
<ol>
<li><strong>Phát hành/Đăng ký dựa trên kênh (Channel-based Pub/Sub)</strong></li>
</ol>
<p>Trạng thái máy chủ trong Redis lưu giữ mối quan hệ đăng ký của tất cả các kênh trong từ điển <code>pubsub_channels</code>: Lệnh <code>SUBSCRIBE</code> chịu trách nhiệm liên kết khách hàng với kênh đã đăng ký trong từ điển này, và lệnh <code>UNSUBSCRIBE</code> thì chịu trách nhiệm hủy liên kết giữa khách hàng và kênh đã hủy đăng ký.</p>
<h3>Ví dụ: Đăng ký kênh cụ thể</h3>
<p>Mở khách hàng thứ nhất và thực hiện các lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; SUBSCRIBE first second</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Reading</span><span style="color:#98C379;--shiki-dark:#98C379"> messages...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (press </span><span style="color:#98C379;--shiki-dark:#98C379">Ctrl-C</span><span style="color:#98C379;--shiki-dark:#98C379"> to</span><span style="color:#98C379;--shiki-dark:#98C379"> quit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"subscribe"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"first"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) 1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"subscribe"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"second"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) 2</span></span></code></pre>
</div><p>Mở khách hàng thứ hai và thực hiện lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; PUBLISH second Hello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span></span></code></pre>
</div><p>Lúc này, khách hàng thứ nhất sẽ nhận được thông báo sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"message"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"second"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"Hello"</span></span></code></pre>
</div><ol start="2">
<li><strong>Phát hành/Đăng ký dựa trên mẫu (Pattern-based Pub/Sub)</strong></li>
</ol>
<p>Trạng thái máy chủ trong Redis lưu giữ mối quan hệ đăng ký của tất cả các mẫu trong danh sách <code>pubsub_patterns</code>: Lệnh <code>PSUBSCRIBE</code> chịu trách nhiệm ghi lại khách hàng và mẫu đã đăng ký trong danh sách này, và lệnh <code>PUNSUBSCRIBE</code> thì chịu trách nhiệm loại bỏ ghi chép của khách hàng và mẫu đã hủy đăng ký khỏi danh sách.</p>
<h3>Ví dụ: Đăng ký các kênh phù hợp với mẫu cụ thể</h3>
<p>Mở khách hàng thứ nhất và thực hiện các lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; PSUBSCRIBE news.*</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Reading</span><span style="color:#98C379;--shiki-dark:#98C379"> messages...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (press </span><span style="color:#98C379;--shiki-dark:#98C379">Ctrl-C</span><span style="color:#98C379;--shiki-dark:#98C379"> to</span><span style="color:#98C379;--shiki-dark:#98C379"> quit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"psubscribe"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"news.*"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) 1</span></span></code></pre>
</div><p>Mở khách hàng thứ hai và thực hiện lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; PUBLISH news.A Hello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span></span></code></pre>
</div><p>Mở khách hàng thứ ba và thực hiện lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; PUBLISH news.B World</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span></span></code></pre>
</div><p>Lúc này, khách hàng thứ nhất sẽ nhận được các thông báo sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"pmessage"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"news.*"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"news.A"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"Hello"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"pmessage"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"news.*"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"news.B"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"World"</span></span></code></pre>
</div><h2>Các lệnh Phát hành/Đăng ký</h2>
<p>Redis cung cấp các lệnh sau liên quan đến phát hành/đăng ký:</p>
<p>| Lệnh                                                     | Mô tả                       |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://d1.awsstatic.com/product-marketing/Messaging/sns_img_topic.e024462ec88e79ed63d690a2eed6e050e33fb36f.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Replication</title>
      <link>https://vanhung4499.github.io/database/redis/replication.html</link>
      <guid>https://vanhung4499.github.io/database/redis/replication.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Replication</source>
      <description>Redis Replication Trong Redis, có thể sử dụng lệnh SLAVEOF hoặc cài đặt tùy chọn slaveof để sao chép (replicate) một máy chủ từ một máy chủ khác, trong đó máy chủ sau được gọi l...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Trong Redis,&nbsp;<strong>có thể sử dụng lệnh&nbsp;<code>SLAVEOF</code>&nbsp;hoặc cài đặt tùy chọn&nbsp;<code>slaveof</code>&nbsp;để sao chép (replicate) một máy chủ từ một máy chủ khác</strong>, trong đó máy chủ sau được gọi là máy chủ chính (master) và máy chủ trước được gọi là máy chủ phụ (slave).</p>
<p>Sao chép Redis trước phiên bản 2.8 không xử lý hiệu quả việc sao chép lại sau khi mất kết nối, và một số cập nhật sau đó của Redis đã giải quyết vấn đề này.</p>
</blockquote>
<h2>1. Giới thiệu về sao chép</h2>
<p>Redis sử dụng lệnh&nbsp;<code>slaveof host port</code>&nbsp;để biến một máy chủ thành máy chủ phụ (slave) của một máy chủ khác (master).</p>
<p><strong>Một máy chủ chính (master) có thể có nhiều máy chủ phụ (slave)</strong>. Không chỉ máy chủ chính có thể có máy chủ phụ, mà máy chủ phụ cũng có thể có máy chủ phụ riêng của mình, và nhiều máy chủ phụ có thể tạo thành một chuỗi chính-phụ.</p>
<p><strong>Một máy chủ chỉ có thể có một máy chủ chính và không hỗ trợ sao chép giữa các máy chủ chính.</strong>.</p>
<p>Có thể sử dụng chức năng sao chép để giúp máy chủ chính không cần thực hiện hoạt động bền vững: Chỉ cần tắt chức năng bền vững trên máy chủ chính, sau đó cho phép máy chủ phụ thực hiện hoạt động bền vững.</p>
<p>Trong cài đặt sử dụng chức năng sao chép của Redis, rất khuyến nghị bật tính bền vững trên cả master và slave. Khi không bật tính năng này, ví dụ như gặp vấn đề trễ do hiệu suất ổ cứng rất chậm, <strong>bạn nên cấu hình các phiên bản để tránh tự động khởi động lại sau khi thiết lập lại</strong>.</p>
<p>Kể từ phiên bản Redis 2.6, máy chủ phụ hỗ trợ chế độ chỉ đọc và chế độ này là chế độ mặc định của máy chủ phụ.</p>
<ul>
<li>Chế độ chỉ đọc được điều khiển bằng tùy chọn&nbsp;<code>slave-read-only</code>&nbsp;trong tệp&nbsp;<code>redis.conf</code>, và cũng có thể được bật hoặc tắt chế độ này bằng lệnh&nbsp;<a href="http://redisdoc.com/configure/config_set.html#config-set" target="_blank" rel="noopener noreferrer">CONFIG SET parameter value</a>.</li>
<li>Máy chủ phụ chỉ đọc sẽ từ chối thực hiện bất kỳ lệnh ghi nào, do đó không có trường hợp dữ liệu được ghi vào máy chủ phụ vì lỗi thao tác.</li>
</ul>
<h2>2. Sao chép phiên bản cũ</h2>
<blockquote>
<p>Cách triển khai sao chép trước phiên bản Redis 2.8: Lệnh&nbsp;<code>SYNC</code></p>
</blockquote>
<p>Chức năng sao chép Redis được chia thành hai hoạt động: đồng bộ hóa (sync) và truyền lệnh (command propagate):</p>
<ul>
<li><strong><code>Đồng bộ hóa (sync)</code></strong>&nbsp;- Được sử dụng để cập nhật trạng thái cơ sở dữ liệu của máy chủ phụ với trạng thái cơ sở dữ liệu hiện tại của máy chủ chính.</li>
<li><strong><code>Truyền lệnh (command propagate)</code></strong>&nbsp;- Khi trạng thái cơ sở dữ liệu của máy chủ chính được sửa đổi, dẫn đến trạng thái không nhất quán giữa cơ sở dữ liệu chính và phụ, cho phép cơ sở dữ liệu chính và phụ trở lại trạng thái nhất quán.</li>
</ul>
<h3>Đồng bộ hóa</h3>
<p>Các bước thực hiện lệnh&nbsp;<code>SYNC</code>:</p>
<ol>
<li>Máy chủ phụ gửi lệnh&nbsp;<code>SYNC</code>&nbsp;đến máy chủ chính.</li>
<li>Máy chủ chính nhận lệnh&nbsp;<code>SYNC</code>&nbsp;và thực hiện lệnh&nbsp;<code>BGSAVE</code>&nbsp;để tạo tệp RDB trong nền và sử dụng một bộ đệm để ghi lại tất cả các lệnh ghi được thực hiện từ thời điểm này trở đi.</li>
<li>Sau khi máy chủ chính hoàn thành lệnh&nbsp;<code>BGSAVE</code>, máy chủ chính sẽ gửi tệp RDB đã tạo cho máy chủ phụ. Máy chủ phụ nhận và tải tệp RDB, cập nhật trạng thái cơ sở dữ liệu của mình.</li>
<li>Máy chủ chính gửi tất cả các lệnh ghi được ghi lại trong bộ đệm cho máy chủ phụ. Máy chủ phụ thực hiện các lệnh ghi này, cập nhật trạng thái cơ sở dữ liệu của mình.</li>
</ol>
<h3>Truyền lệnh</h3>
<p>Sau khi hoàn thành hoạt động đồng bộ hóa, trạng thái cơ sở dữ liệu của máy chủ chính và phụ sẽ trở nên nhất quán. Mỗi khi máy chủ chính thực hiện một lệnh ghi được gửi từ khách hàng, trạng thái cơ sở dữ liệu của máy chủ chính và phụ không còn nhất quán. Cần gửi các lệnh ghi cho máy chủ phụ để thực hiện, đảm bảo trạng thái cơ sở dữ liệu của cả hai trở lại nhất quán.</p>
<h3>Nhược điểm của sao chép phiên bản cũ</h3>
<p>Có hai trường hợp khi sao chép từ máy chủ chính sang máy chủ phụ:</p>
<ul>
<li><strong>Sao chép lần đầu</strong>&nbsp;- Máy chủ phụ chưa từng sao chép máy chủ chính trước đó.</li>
<li><strong>Sao chép sau khi mất kết nối</strong>&nbsp;- Máy chủ phụ và máy chủ chính trong quá trình truyền lệnh bị mất kết nối do vấn đề mạng, sau khi máy chủ phụ kết nối lại với máy chủ chính, tiếp tục sao chép từ máy chủ chính.</li>
</ul>
<p>Đối với sao chép lần đầu, chức năng sao chép phiên bản cũ hoạt động tốt; tuy nhiên,&nbsp;<strong>đối với sao chép sau khi mất kết nối, hiệu suất rất thấp do việc tạo và truyền RDB mỗi lần</strong>.</p>
<blockquote>
<p>🔔 Lưu ý:&nbsp;<strong>Lệnh SYNC là một hoạt động tốn nhiều tài nguyên</strong>.</p>
<ul>
<li>Máy chủ chính thực hiện lệnh&nbsp;<code>BGSAVE</code>&nbsp;để tạo tệp RDB, hoạt động này tốn nhiều tài nguyên CPU, bộ nhớ và I/O đĩa của máy chủ chính.</li>
<li>Máy chủ chính truyền tệp RDB cho máy chủ phụ, hoạt động này tốn nhiều tài nguyên mạng của cả máy chủ chính và phụ và ảnh hưởng đến thời gian phản hồi của máy chủ chính.</li>
<li>Trong quá trình máy chủ phụ tải tệp RDB, các lệnh yêu cầu khác bị chặn.</li>
</ul>
</blockquote>
<h2>3. Sao chép phiên bản mới</h2>
<blockquote>
<p>Cách triển khai mới sau phiên bản Redis 2.8: Sử dụng lệnh&nbsp;<code>PSYNC</code>&nbsp;thay thế lệnh&nbsp;<code>SYNC</code>.</p>
</blockquote>
<p>Lệnh&nbsp;<code>PSYNC</code>&nbsp;có hai chế độ: đồng bộ hoàn toàn (full resynchronization) và đồng bộ một phần (partial resynchronization):</p>
<ul>
<li><strong><code>Đồng bộ hoàn toàn (full resynchronization)</code></strong>&nbsp;- Được sử dụng cho sao chép lần đầu. Các bước thực hiện tương tự như lệnh&nbsp;<code>SYNC</code>.</li>
<li><strong><code>Đồng bộ một phần (partial resynchronization)</code></strong>&nbsp;- Được sử dụng cho sao chép sau khi mất kết nối.&nbsp;<strong>Nếu điều kiện cho phép, máy chủ chính có thể gửi các lệnh ghi được thực hiện trong quá trình ngắt kết nối cho máy chủ phụ</strong>, máy chủ phụ chỉ cần nhận và thực hiện các lệnh ghi này để duy trì trạng thái cơ sở dữ liệu của máy chủ chính và phụ nhất quán.</li>
</ul>
<h3>Đồng bộ một phần</h3>
<p>Chức năng đồng bộ một phần bao gồm ba phần:</p>
<ul>
<li><strong>Offset sao chép</strong>&nbsp;của máy chủ chính và máy chủ phụ.</li>
<li><strong>Bộ đệm chờ sao chép</strong>&nbsp;của máy chủ chính.</li>
<li><strong>ID chạy của máy chủ</strong>.</li>
</ul>
<h4>Offset sao chép</h4>
<p>Máy chủ chính và máy chủ phụ sẽ duy trì một offset sao chép riêng biệt.</p>
<ul>
<li>Nếu offset sao chép của máy chủ chính và máy chủ phụ giống nhau, điều đó có nghĩa là trạng thái cơ sở dữ liệu của hai máy chủ là nhất quán;</li>
<li>Ngược lại, nếu offset sao chép không giống nhau, điều đó có nghĩa là trạng thái cơ sở dữ liệu của hai máy chủ không nhất quán.</li>
</ul>
<h4>Bộ đệm chờ sao chép</h4>
<p><strong>Bộ đệm chờ sao chép là một hàng đợi FIFO có độ dài cố định được duy trì bởi máy chủ chính</strong>, kích thước mặc định là&nbsp;<code>1MB</code>.</p>
<p>Bộ đệm chờ sao chép sẽ lưu trữ một phần lệnh ghi gần đây đã truyền và bộ đệm chờ sao chép sẽ ghi lại offset sao chép tương ứng cho mỗi byte trong hàng đợi.</p>
<p>Khi máy chủ phụ kết nối lại với máy chủ chính sau khi mất kết nối, máy chủ phụ sẽ gửi lệnh&nbsp;<code>PSYNC</code>&nbsp;với offset sao chép của chính nó cho máy chủ chính, máy chủ chính sẽ dựa trên offset này để quyết định thực hiện hoạt động đồng bộ nào với máy chủ phụ.</p>
<ul>
<li>Nếu dữ liệu sau offset vẫn còn trong bộ đệm chờ sao chép, máy chủ chính sẽ thực hiện đồng bộ một phần với máy chủ phụ.</li>
<li>Ngược lại, máy chủ chính sẽ thực hiện đồng bộ hoàn toàn với máy chủ phụ.</li>
</ul>
<blockquote>
<p>🔔 Lưu ý:&nbsp;<strong>Điều chỉnh kích thước bộ đệm chờ sao chép một cách hợp lý</strong></p>
<ul>
<li>
<p>Kích thước mặc định của bộ đệm chờ sao chép Redis là&nbsp;<code>1MB</code>.</p>
</li>
<li>
<p>Kích thước tối thiểu của bộ đệm chờ sao chép có thể được ước tính bằng công thức&nbsp;<code>second * write_size_per_second</code>.</p>
</li>
</ul>
</blockquote>
<h4>ID chạy của máy chủ</h4>
<ul>
<li>Mỗi máy chủ Redis có một ID chạy để xác định duy nhất.</li>
<li>ID chạy được tạo tự động khi máy chủ khởi động, bao gồm 40 ký tự thập lục phân ngẫu nhiên. Ví dụ: 132e358005e29741f8d7b0a42d666aace286edda</li>
</ul>
<p>Khi máy chủ phụ sao chép lần đầu từ máy chủ chính, máy chủ chính sẽ gửi ID chạy của chính nó cho máy chủ phụ và máy chủ phụ sẽ lưu trữ ID chạy này.</p>
<p>Khi máy chủ phụ kết nối lại với máy chủ chính, máy chủ phụ sẽ gửi ID chạy đã lưu trữ trước đó:</p>
<ul>
<li>Nếu ID chạy đã lưu trữ và ID chạy hiện tại của máy chủ chính giống nhau, điều đó có nghĩa là máy chủ phụ đã kết nối với máy chủ chính trước đó, máy chủ chính sẽ tiếp tục thử nghiệm đồng bộ một phần;</li>
<li>Ngược lại, nếu ID chạy không khớp, điều đó có nghĩa là máy chủ phụ không kết nối với máy chủ chính trước đó, máy chủ chính sẽ thực hiện đồng bộ hoàn toàn với máy chủ phụ.</li>
</ul>
<h3>Lệnh PSYNC</h3>
<p>Sau khi hiểu cách triển khai đồng bộ một phần, việc hiểu cách thực hiện lệnh PSYNC sẽ dễ dàng hơn, nguyên tắc hoạt động cơ bản của nó như sau:</p>
<p>Khi máy chủ phụ nhận được lệnh&nbsp;<code>SLAVEOF</code>, trước tiên kiểm tra xem máy chủ phụ đã sao chép từ máy chủ trước đó hay chưa.</p>
<ul>
<li>Nếu máy chủ phụ chưa sao chép từ bất kỳ máy chủ chính nào trước đó, nó sẽ gửi lệnh&nbsp;<code>PSYNC ? -1</code>&nbsp;đến máy chủ chính, yêu cầu đồng bộ hoàn toàn.</li>
<li>Ngược lại, nó sẽ gửi lệnh&nbsp;<code>PSYNC &lt;runid&gt; &lt;offset&gt;</code>&nbsp;đến máy chủ chính.
<ul>
<li><code>runid</code>&nbsp;là ID chạy của máy chủ chính trong lần sao chép trước đó.</li>
<li><code>offset</code>&nbsp;là offset sao chép.</li>
</ul>
</li>
</ul>
<p>Máy chủ chính nhận được lệnh&nbsp;<code>PSYNC &lt;runid&gt; &lt;offset&gt;</code>&nbsp;sẽ thực hiện phân tích:</p>
<ul>
<li>Nếu <strong>ID chạy của máy chủ chính và máy chủ phụ giống nhau và offset được chỉ định vẫn còn hiệu lực trong bộ đệm chờ sao chép</strong>, điều đó có nghĩa là máy chủ chính sẽ tiếp tục thực hiện đồng bộ một phần với máy chủ phụ.</li>
<li>Nếu không thỏa mãn một trong hai điều kiện trên, máy chủ chính sẽ thực hiện đồng bộ toàn bộ với máy chủ phụ.</li>
</ul>
<h2>4. Kiểm tra nhịp tim</h2>
<p>Trong giai đoạn <strong>truyền lệnh</strong>, máy chủ từ xa mặc định sẽ gửi lệnh đến máy chủ chính một lần mỗi giây:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>REPLCONF ACK &lt;replication_offset&gt;</span></span></code></pre>
</div><p>Trong đó, <code>replication_offset</code> là vị trí sao chép hiện tại của máy chủ từ xa.</p>
<p>Gửi lệnh <code>REPLCONF ACK</code> có ba tác dụng đối với máy chủ chính và máy chủ phụ:</p>
<ul>
<li>Kiểm tra trạng thái kết nối mạng giữa máy chủ chính và máy chủ phụ.</li>
<li>Hỗ trợ thực hiện tùy chọn min-slaves.</li>
<li>Kiểm tra việc mất lệnh.</li>
</ul>
<h3>Kiểm tra trạng thái kết nối giữa máy chủ chính và máy chủ phụ</h3>
<p><strong>Có thể kiểm tra xem kết nối mạng giữa máy chủ chính và máy chủ phụ có bình thường hay không</strong> bằng cách gửi và nhận lệnh <code>REPLCONF ACK</code>: Nếu máy chủ chính không nhận được lệnh <code>REPLCONF ACK</code> từ máy chủ phụ trong hơn một giây, máy chủ chính sẽ biết rằng có vấn đề về kết nối giữa máy chủ chính và máy chủ phụ.</p>
<p>Có thể sử dụng lệnh <code>INFO replication</code> để gửi đến máy chủ chính và xem trong cột lag của danh sách máy chủ phụ, thời gian đã trôi qua kể từ khi máy chủ phụ gửi lệnh <code>REPLCONF ACK</code> đến máy chủ chính.</p>
<h3>Hỗ trợ thực hiện tùy chọn min-slaves</h3>
<p>Tùy chọn <code>min-slaves-to-write</code> và <code>min-slaves-max-lag</code> trong Redis giúp ngăn máy chủ chính thực hiện lệnh ghi trong trường hợp không an toàn.</p>
<p>【Ví dụ】Cấu hình min-slaves</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>min-slaves-to-write 3</span></span>
<span class="line"><span>min-slaves-max-lag 10</span></span></code></pre>
</div><p>Cấu hình trên đại diện cho: Nếu số lượng máy chủ phụ nhỏ hơn 3 hoặc độ trễ của ba máy chủ phụ lớn hơn hoặc bằng 10 giây, máy chủ chính sẽ từ chối thực hiện lệnh ghi.</p>
<h3>Kiểm tra việc mất lệnh</h3>
<p>Nếu do sự cố mạng, các lệnh ghi mà máy chủ chính truyền cho máy chủ phụ bị mất, khi máy chủ phụ gửi lệnh <code>REPLCONF ACK</code> định kỳ đến máy chủ chính, máy chủ chính sẽ nhận ra rằng vị trí sao chép của máy chủ phụ ít hơn của chính nó. Sau đó, máy chủ chính sẽ tìm các dữ liệu mà máy chủ phụ thiếu trong bộ đệm sao chép và gửi lại cho máy chủ phụ dựa trên vị trí sao chép mà máy chủ phụ đã gửi.</p>
<h2>5. Quy trình sao chép</h2>
<p>Bằng cách gửi lệnh SLAVEOF như sau đến máy chủ phụ, bạn có thể sao chép máy chủ chính.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>SLAVEOF &lt;master_ip&gt; &lt;master_port&gt;</span></span></code></pre>
</div><h3>Bước 1. Cấu hình máy chủ chính và máy chủ phụ</h3>
<p>Cấu hình máy chủ phụ rất đơn giản, chỉ cần thêm dòng sau vào tệp cấu hình:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>slaveof 127.0.0.1 6379</span></span></code></pre>
</div><p>Tất nhiên, bạn cần thay thế <code>127.0.0.1</code> và <code>6379</code> trong mã bằng IP và cổng của máy chủ chính của bạn.</p>
<p>Một cách khác là sử dụng lệnh <a href="https://redis.io/commands/slaveof/" target="_blank" rel="noopener noreferrer">SLAVEOF host port</a>, nhập IP và cổng của máy chủ chính, sau đó đồng bộ hóa sẽ bắt đầu:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>127.0.0.1:6379&gt; SLAVEOF 127.0.0.1 10086</span></span>
<span class="line"><span>OK</span></span></code></pre>
</div><h3>Bước 2. Thiết lập kết nối TCP giữa máy chủ chính và máy chủ phụ.</h3>
<h3>Bước 3. Gửi PING để kiểm tra trạng thái giao tiếp.</h3>
<h3>Bước 4. Xác thực.</h3>
<p>Nếu máy chủ chính không thiết lập <code>requirepass</code>, máy chủ phụ không thiết lập <code>masterauth</code>, thì không cần xác thực; ngược lại, cần xác thực. Nếu xác thực không thành công, quá trình sao chép sẽ bị hủy bỏ.</p>
<p>Nếu máy chủ chính đã đặt mật khẩu thông qua tùy chọn <code>requirepass</code>, để đảm bảo quá trình đồng bộ hóa máy chủ phụ diễn ra suôn sẻ, chúng ta cũng phải thiết lập xác thực tương ứng cho máy chủ phụ.</p>
<p>Đối với một máy chủ đang chạy, bạn có thể sử dụng lệnh sau đây trên khách hàng:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>config set masterauth &lt;password&gt;</span></span></code></pre>
</div><p>Để thiết lập mật khẩu này vĩnh viễn, bạn có thể thêm nó vào tệp cấu hình:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>masterauth &lt;password&gt;</span></span></code></pre>
</div><p>Ngoài ra, còn một số tùy chọn khác liên quan đến bộ đệm luồng sao chép được sử dụng khi máy chủ chính thực hiện đồng bộ hóa một phần, chi tiết có thể tham khảo tệp <code>redis.conf</code> đi kèm với mã nguồn Redis.</p>
<h3>Bước 5. Gửi thông tin cổng.</h3>
<p>máy chủ phụ thực hiện <code>REPLCONF listening-port &lt;port-number&gt;</code>, gửi số cổng lắng nghe của máy chủ phụ đến máy chủ chính.</p>
<h3>Bước 6. Đồng bộ hóa.</h3>
<p>Đã được giới thiệu trước đó, không lặp lại ở đây.</p>
<h3>Bước 7. Truyền lệnh.</h3>
<p>Trong giai đoạn truyền lệnh, máy chủ phụ mặc định sẽ gửi lệnh đến máy chủ chính mỗi giây một lần:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>REPLCONF ACK &lt;replication_coffset&gt;</span></span></code></pre>
</div><p>Các lệnh có tác dụng:</p>
<ul>
<li>Kiểm tra trạng thái kết nối mạng giữa máy chủ chính và máy chủ phụ.</li>
<li>Hỗ trợ thực hiện tùy chọn min-slave.</li>
<li>Kiểm tra việc mất lệnh.</li>
</ul>
<h2>6. Các tùy chọn cấu hình sao chép</h2>
<p>Từ Redis 2.8 trở đi, để đảm bảo tính an toàn của dữ liệu, bạn có thể cấu hình để máy chủ chính chỉ thực hiện lệnh ghi khi có ít nhất N máy chủ con đang kết nối.</p>
<p>Tuy nhiên, vì Redis sử dụng sao chép bất đồng bộ, nên dữ liệu ghi mà máy chủ chính gửi không nhất thiết sẽ được máy chủ con nhận được, do đó, khả năng mất dữ liệu vẫn tồn tại.</p>
<p>Dưới đây là cách hoạt động của tính năng này:</p>
<ul>
<li>Máy chủ con gửi lệnh PING đến máy chủ chính mỗi giây một lần và báo cáo tình trạng xử lý luồng sao chép.</li>
<li>Máy chủ chính ghi lại thời gian máy chủ con cuối cùng gửi lệnh PING đến nó.</li>
<li>Người dùng có thể cấu hình giá trị tối đa của độ trễ mạng <code>min-slaves-max-lag</code> và số lượng tối thiểu máy chủ con cần để thực hiện lệnh ghi <code>min-slaves-to-write</code>.</li>
</ul>
<p>Nếu có ít nhất <code>min-slaves-to-write</code> máy chủ con và tất cả các máy chủ con này có độ trễ nhỏ hơn <code>min-slaves-max-lag</code> giây, máy chủ chính sẽ thực hiện lệnh ghi được yêu cầu từ khách hàng.</p>
<p>Bạn có thể coi tính năng này như một phiên bản nới lỏng điều kiện C trong lý thuyết CAP: Mặc dù không đảm bảo tính bền vững của lệnh ghi, nhưng ít nhất cửa sổ mất dữ liệu sẽ được giới hạn chặt chẽ trong số giây được chỉ định.</p>
<p>Mặt khác, nếu không đáp ứng được các điều kiện được chỉ định bởi <code>min-slaves-to-write</code> và <code>min-slaves-max-lag</code>, lệnh ghi sẽ không được thực hiện và máy chủ chính sẽ trả về một lỗi cho khách hàng yêu cầu thực hiện lệnh ghi.</p>
<p>Dưới đây là hai tùy chọn của tính năng này và các tham số cần thiết cho chúng:</p>
<ul>
<li><code>min-slaves-to-write &lt;số lượng máy chủ con&gt;</code></li>
<li><code>min-slaves-max-lag &lt;số giây&gt;</code></li>
</ul>
<p>Thông tin chi tiết có thể được tham khảo trong tệp <code>redis.conf</code> đi kèm với mã nguồn Redis.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Redis Sentinel</title>
      <link>https://vanhung4499.github.io/database/redis/sentinel.html</link>
      <guid>https://vanhung4499.github.io/database/redis/sentinel.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Sentinel</source>
      <description>Redis Sentinel Redis Sentinel là giải pháp khả dụng cao (High Availability) cho Redis. Redis Sentinel là việc triển khai cụ thể của thuật toán Raft. 1. Giới thiệu về Sentinel Re...</description>
      <category>redis</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Redis Sentinel là giải pháp&nbsp;<strong>khả dụng cao</strong>&nbsp;(High Availability) cho Redis.</p>
<p>Redis Sentinel là việc triển khai cụ thể của thuật toán Raft.</p>
</blockquote>
<h2>1. Giới thiệu về Sentinel</h2>
<p>Redis Sentinel là giải pháp&nbsp;<strong>cao khả dụng</strong>&nbsp;(High Availability) cho Redis: Hệ thống Sentinel được tạo thành từ một hoặc nhiều phiên bản Sentinel có thể giám sát nhiều máy chủ chính và tất cả các máy chủ con của chúng. Khi một máy chủ chính được giám sát bị chuyển sang trạng thái offline, Sentinel sẽ tự động nâng cấp một máy chủ con thành máy chủ chính mới và máy chủ chính mới này sẽ tiếp tục xử lý các yêu cầu lệnh thay thế cho máy chủ chính đã offline.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200131135847.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Các chức năng chính của Sentinel bao gồm:</p>
<ul>
<li><strong>Giám sát (Monitoring)</strong>&nbsp;- Sentinel liên tục kiểm tra xem các máy chủ chính và máy chủ con có hoạt động bình thường hay không.</li>
<li><strong>Thông báo (Notification)</strong>&nbsp;- Sentinel có thể thông báo cho quản trị viên hệ thống hoặc ứng dụng khác rằng các phiên bản Redis đang được giám sát gặp vấn đề.</li>
<li><strong>Tự động chuyển giao khi lỗi (Automatic Failover)</strong>&nbsp;- Nếu một máy chủ chính bị offline, Sentinel sẽ bắt đầu quá trình chuyển giao tự động: nâng cấp một máy chủ con thành máy chủ chính và cấu hình lại các máy chủ con khác để sử dụng máy chủ chính mới. Ứng dụng sử dụng dịch vụ Redis cũng sẽ được thông báo về địa chỉ mới.</li>
<li><strong>Cung cấp cấu hình (Configuration Provider)</strong>&nbsp;- Sentinel cung cấp nguồn cấu hình cho việc khám phá dịch vụ của khách hàng: Đối với một dịch vụ cụ thể, khách hàng kết nối đến các Sentinel để tìm địa chỉ máy chủ chính hiện tại. Khi quá trình chuyển giao xảy ra, Sentinel sẽ báo cáo địa chỉ mới.</li>
</ul>
<h2>2. Khởi động Sentinel</h2>
<p>Có thể khởi động một Sentinel bằng bất kỳ lệnh nào dưới đây, hai lệnh này có hiệu quả hoàn toàn giống nhau.</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis-sentinel</span><span style="color:#98C379;--shiki-dark:#98C379"> /path/to/sentinel.conf</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis-server</span><span style="color:#98C379;--shiki-dark:#98C379"> /path/to/sentinel.conf</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --sentinel</span></span></code></pre>
</div><p>Khi một Sentinel được khởi động, nó sẽ thực hiện các bước sau:</p>
<ol>
<li>Khởi tạo máy chủ.</li>
<li>Sử dụng mã đặc biệt của Sentinel.</li>
<li>Khởi tạo trạng thái của Sentinel.</li>
<li>Khởi tạo danh sách máy chủ chính của Sentinel.</li>
<li>Tạo kết nối mạng đến máy chủ chính được giám sát.</li>
</ol>
<p><strong>Sentinel thực chất là một máy chủ Redis hoạt động trong chế độ đặc biệt</strong>.</p>
<p>Trong chế độ Sentinel, máy chủ Redis chỉ hỗ trợ bảy lệnh:&nbsp;<code>PING</code>,&nbsp;<code>SENTINEL</code>,&nbsp;<code>INFO</code>,&nbsp;<code>SUBSCRIBE</code>,&nbsp;<code>UNSUBSCRIBE</code>,&nbsp;<code>PSUBSCRIBE</code>,&nbsp;<code>PUNSUBSCRIBE</code>.</p>
<p>Khi tạo kết nối mạng đến máy chủ chính được giám sát, Sentinel sẽ trở thành một khách hàng của máy chủ chính, nó có thể gửi lệnh đến máy chủ chính và nhận thông tin liên quan từ phản hồi lệnh. Đối với mỗi máy chủ chính được giám sát bởi Sentinel, Sentinel sẽ tạo hai kết nối mạng bất đồng bộ đến máy chủ chính:</p>
<ul>
<li>Kết nối lệnh: Được sử dụng đặc biệt để gửi lệnh đến máy chủ chính và nhận phản hồi lệnh.</li>
<li>Kết nối đăng ký: Được sử dụng đặc biệt để đăng ký kênh&nbsp;<code>__sentinel__:hello</code>&nbsp;của máy chủ chính.</li>
</ul>
<h2>3. Giám sát</h2>
<h3>Kiểm tra trạng thái máy chủ</h3>
<blockquote>
<p><strong>Sentinel gửi lệnh <code>PING</code> tới máy chủ Redis để kiểm tra trạng thái của nó</strong>.</p>
</blockquote>
<p>Mặc định, <strong>mỗi</strong> nút <code>Sentinel</code> sẽ gửi lệnh <code>PING</code> tới các nút <code>Redis</code> và các nút <code>Sentinel</code> <strong>khác</strong> với tần suất là mỗi giây và dựa vào phản hồi từ các nút để xác định xem nút đó có trực tuyến hay không.</p>
<ul>
<li><strong>Offline chủ quan</strong>: Offline chủ quan áp dụng cho cả nút chính và nút phụ. Nếu trong khoảng thời gian <code>down-after-milliseconds</code>, <code>Sentinel</code> không nhận được phản hồi hợp lệ từ nút mục tiêu, nó sẽ xem nút đó là offline chủ quan.</li>
<li><strong>Offline khách quan</strong>: Offline khách quan chỉ áp dụng cho nút chính. Sau khi <code>Sentinel</code> xác định một máy chủ chính là offline chủ quan, để xác nhận rằng máy chủ chính thực sự đã offline, nó sẽ hỏi các <code>Sentinel</code> khác đang theo dõi máy chủ chính đó xem họ có đồng ý rằng máy chủ chính đã offline hay không. Khi đủ số lượng <code>Sentinel</code> đồng ý rằng máy chủ chính đã offline, nó sẽ được xem là offline khách quan và thực hiện hoạt động chuyển giao lỗi.
<ul>
<li>Nút <code>Sentinel</code> sử dụng lệnh <code>sentinel is-master-down-by-addr</code> để hỏi các nút <code>Sentinel</code> khác về <strong>đánh giá trạng thái</strong> của nút đó.</li>
</ul>
</li>
</ul>
<h3>Lấy thông tin máy chủ</h3>
<blockquote>
<p><strong>Sentinel gửi lệnh <code>INFO</code> tới máy chủ chính để lấy thông tin về máy chủ chính và các máy chủ phụ của nó</strong>.</p>
</blockquote>
<ul>
<li><strong>Lấy thông tin máy chủ chính</strong> - Sentinel mặc định sẽ gửi lệnh <code>INFO</code> tới máy chủ chính mà nó đang giám sát với tần suất là mỗi 10 giây và dựa vào phản hồi từ lệnh <code>INFO</code> để lấy thông tin hiện tại của máy chủ chính.
<ul>
<li>Thông tin về máy chủ chính: bao gồm ID chạy của máy chủ được ghi lại trong trường run_id và vai trò của máy chủ được ghi lại trong trường role.</li>
<li>Thông tin về máy chủ phụ của máy chủ chính: bao gồm địa chỉ IP và cổng.</li>
</ul>
</li>
<li><strong>Lấy thông tin máy chủ phụ</strong> - Khi Sentinel phát hiện một máy chủ chính có máy chủ phụ mới xuất hiện, ngoài việc tạo cấu trúc thực thể tương ứng cho máy chủ phụ mới, Sentinel cũng sẽ tạo kết nối lệnh và kết nối đăng ký tới máy chủ phụ.</li>
</ul>
<h2>4. Thông báo</h2>
<p>Đối với mỗi máy chủ kết nối với Sentinel, Sentinel sẽ gửi tin nhắn đến kênh&nbsp;<code>__sentinel__:hello</code>&nbsp;của máy chủ và cũng đăng ký nhận tin nhắn từ kênh&nbsp;<code>__sentinel__:hello</code>&nbsp;của máy chủ.</p>
<h3>Gửi tin nhắn đến máy chủ</h3>
<p>Mặc định, Sentinel sẽ gửi lệnh theo định dạng sau đến tất cả các máy chủ chính và máy chủ phụ được giám sát một lần mỗi hai giây.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUBLISH __sentinel__:hello "&lt;s_ip&gt;,&lt;s_port&gt;,&lt;s_runid&gt;,&lt;s_epoch&gt;,&lt;m_name&gt;,&lt;m_ip&gt;,&lt;m_port&gt;,&lt;m_epoch&gt;"</span></span></code></pre>
</div><p>Lệnh này gửi một tin nhắn đến kênh&nbsp;<code>__sentinel__:hello</code>&nbsp;của máy chủ.</p>
<h3>Nhận tin nhắn từ máy chủ</h3>
<p>Khi Sentinel thiết lập kết nối đăng ký với một máy chủ chính hoặc máy chủ phụ, Sentinel sẽ gửi lệnh&nbsp;<code>SUBSCRIBE __sentinel__:hello</code>&nbsp;thông qua kết nối đăng ký.</p>
<p>Sentinel sẽ tiếp tục đăng ký kênh&nbsp;<code>__sentinel__:hello</code>&nbsp;cho đến khi Sentinel ngắt kết nối với máy chủ.</p>
<h2>5. Lựa chọn Leader</h2>
<blockquote>
<p>Thuật toán lựa chọn Leader trong hệ thống Redis Sentinel được thực hiện bằng cách triển khai&nbsp;<a href="https://ramcloud.atlassian.net/wiki/download/attachments/6586375/raft.pdf" target="_blank" rel="noopener noreferrer">Raft</a>.</p>
<p>Raft là một thuật toán đồng thuận, để hiểu nguyên lý hoạt động của nó, bạn có thể tham khảo&nbsp;<a href="">Phân tích sâu về thuật toán đồng thuận Raft</a>.</p>
</blockquote>
<p><strong>Khi một máy chủ chính được xác định là offline khách quan, các Sentinel theo dõi máy chủ chính này sẽ thực hiện thỏa thuận và lựa chọn một Sentinel đầu tiên, sau đó Sentinel đầu tiên này sẽ thực hiện hoạt động chuyển giao lỗi cho máy chủ chính offline</strong>.</p>
<p>Tất cả các Sentinel đang hoạt động đều có khả năng được chọn làm Leader.</p>
<p>Mỗi nút&nbsp;<code>Sentinel</code>&nbsp;cần thực hiện định kỳ các nhiệm vụ sau đây:</p>
<p>(1) Mỗi&nbsp;<code>Sentinel</code>&nbsp;gửi một lệnh&nbsp;<code>PING</code>&nbsp;tới các máy chủ chính, máy chủ phụ và các phiên bản&nbsp;<code>Sentinel</code>&nbsp;khác mà nó biết với tần suất là mỗi giây.</p>
<p>(2) Nếu một phiên bản (instance) không nhận được phản hồi hợp lệ từ lệnh&nbsp;<code>PING</code>&nbsp;trong khoảng thời gian quy định bởi&nbsp;<code>down-after-milliseconds</code>, phiên bản này sẽ được đánh dấu là offline chủ quan bởi&nbsp;<code>Sentinel</code>.</p>
<p>(3) Nếu một máy chủ chính được đánh dấu là offline chủ quan, tất cả các nút&nbsp;<code>Sentinel</code>&nbsp;đang theo dõi máy chủ chính này sẽ xác nhận rằng máy chủ chính đã chính thức vào trạng thái offline chủ quan với tần suất là mỗi giây.</p>
<p>(4) Nếu một máy chủ chính được đánh dấu là offline chủ quan và có đủ số lượng&nbsp;<code>Sentinel</code>&nbsp;(ít nhất là số lượng được chỉ định trong tệp cấu hình) đồng ý với quyết định này trong khoảng thời gian quy định, máy chủ chính này sẽ được đánh dấu là offline khách quan.</p>
<p>(5) Trong trường hợp bình thường, mỗi&nbsp;<code>Sentinel</code>&nbsp;sẽ gửi lệnh&nbsp;<code>INFO</code>&nbsp;tới tất cả các máy chủ chính và phụ mà nó biết với tần suất là mỗi 10 giây. Khi một máy chủ chính được đánh dấu là offline khách quan bởi&nbsp;<code>Sentinel</code>, tần suất gửi lệnh&nbsp;<code>INFO</code>&nbsp;từ&nbsp;<code>Sentinel</code>&nbsp;tới tất cả các máy chủ phụ của máy chủ chính offline sẽ tăng từ 10 giây mỗi lần thành mỗi giây.</p>
<p>(6)&nbsp;<code>Sentinel</code>&nbsp;và các&nbsp;<code>Sentinel</code>&nbsp;khác thương lượng về trạng thái của nút chính, nếu nút chính ở trạng thái&nbsp;<code>SDOWN</code>, một nút chính mới sẽ được tự động bầu chọn. Các nút phụ còn lại sẽ được chỉ định đến nút chính mới để sao chép dữ liệu.</p>
<p>(7) Khi không có đủ số lượng&nbsp;<code>Sentinel</code>&nbsp;đồng ý với việc đánh dấu máy chủ chính là offline, trạng thái offline khách quan của máy chủ chính sẽ bị xóa bỏ. Khi máy chủ chính trả lời lệnh&nbsp;<code>PING</code>&nbsp;của&nbsp;<code>Sentinel</code>&nbsp;với phản hồi hợp lệ, trạng thái offline chủ quan của máy chủ chính sẽ bị xóa bỏ.</p>
<blockquote>
<p>Lưu ý: Phản hồi hợp lệ của lệnh&nbsp;<code>PING</code>&nbsp;có thể là:&nbsp;<code>+PONG</code>,&nbsp;<code>-LOADING</code>&nbsp;hoặc&nbsp;<code>-MASTERDOWN</code>. Nếu máy chủ trả về phản hồi khác ngoài ba phản hồi trên hoặc không trả lời lệnh&nbsp;<code>PING</code>&nbsp;trong khoảng thời gian quy định,&nbsp;<code>Sentinel</code>&nbsp;sẽ coi phản hồi từ máy chủ là không hợp lệ (non-valid).</p>
</blockquote>
<h2>6. Chuyển giao lỗi</h2>
<p>Sau khi Sentinel Leader được bầu chọn, Sentinel Leader sẽ thực hiện hoạt động chuyển giao lỗi cho máy chủ chính đã offline. Hoạt động này bao gồm ba bước sau:</p>
<p>(1)&nbsp;<strong>Chọn ra máy chủ chính mới</strong></p>
<p>Bước đầu tiên của hoạt động chuyển giao lỗi là Sentinel Leader chọn ra một máy chủ phụ trong tất cả các máy chủ phụ thuộc vào máy chủ chính đã offline, mà trạng thái là tốt và dữ liệu là hoàn chỉnh. Sau đó, Sentinel Leader gửi lệnh&nbsp;<code>SLAVEOF no one</code>&nbsp;tới máy chủ phụ này để chuyển đổi nó thành máy chủ chính.</p>
<p>Cách Sentinel Leader chọn ra máy chủ chính mới:</p>
<ul>
<li>Xóa tất cả các máy chủ phụ đang offline hoặc bị ngắt kết nối khỏi danh sách.</li>
<li>Xóa tất cả các máy chủ phụ mà trong vòng 5 giây gần đây không phản hồi lệnh INFO từ Sentinel Leader.</li>
<li>Xóa tất cả các máy chủ phụ mà kết nối với máy chủ chính đã offline bị ngắt quá thời gian&nbsp;<code>down-after-milliseconds</code>&nbsp;* 10 mili giây (thời gian cần để xác định máy chủ chính đã offline).</li>
</ul>
<p>Sau đó, Sentinel Leader chọn ra máy chủ phụ có độ ưu tiên cao nhất. Nếu các máy chủ phụ có cùng độ ưu tiên, Sentinel Leader chọn máy chủ phụ có bộ nhớ đệm sao chép lớn nhất. Nếu vẫn còn nhiều kết quả, Sentinel Leader chọn máy chủ phụ có ID chạy nhỏ nhất.</p>
<p>(2)&nbsp;<strong>Thay đổi mục tiêu sao chép cho các máy chủ phụ</strong></p>
<p>Sau khi chọn ra máy chủ chính mới, Sentinel Leader gửi lệnh&nbsp;<code>SLAVEOF</code>&nbsp;tới tất cả các máy chủ phụ để yêu cầu chúng sao chép từ máy chủ chính mới.</p>
<p>(3)&nbsp;<strong>Biến máy chủ chính cũ thành máy chủ phụ</strong></p>
<p>Sentinel Leader đánh dấu máy chủ chính cũ là máy chủ phụ. Khi máy chủ chính cũ trở lại hoạt động, Sentinel sẽ gửi lệnh SLAVEOF tới nó để biến nó thành máy chủ phụ.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200131135847.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Transaction</title>
      <link>https://vanhung4499.github.io/database/redis/transaction.html</link>
      <guid>https://vanhung4499.github.io/database/redis/transaction.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Transaction</source>
      <description>Redis Transaction Redis chỉ hỗ trợ giao dịch &amp;quot;không nghiêm ngặt&amp;quot;. Gọi là &amp;quot;không nghiêm ngặt&amp;quot; vì: Giao dịch Redis đảm bảo &amp;quot;tất cả các lệnh sẽ được thực thi&amp;quot;; nhưng, giao dịch Red...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><strong>Redis chỉ hỗ trợ giao dịch "không nghiêm ngặt"</strong>. Gọi là "không nghiêm ngặt" vì: Giao dịch Redis đảm bảo "tất cả các lệnh sẽ được thực thi"; nhưng, giao dịch Redis "không hỗ trợ việc quay lui".</p>
</blockquote>
<h1>Redis Giao dịch</h1>
<blockquote>
<p><strong>Redis chỉ hỗ trợ giao dịch "không nghiêm ngặt"</strong>. Gọi là "không nghiêm ngặt" vì: Giao dịch Redis đảm bảo "tất cả các lệnh sẽ được thực thi"; nhưng, giao dịch Redis "không hỗ trợ việc quay lui".</p>
<p>Từ khóa: <code>giao dịch</code>, <code>ACID</code>, <code>MULTI</code>, <code>EXEC</code>, <code>DISCARD</code>, <code>WATCH</code></p>
</blockquote>
<h2>Giới thiệu về Giao dịch Redis</h2>
<h3>ACID là gì?</h3>
<p>ACID là bốn yếu tố cơ bản để đảm bảo việc thực thi đúng các giao dịch trong cơ sở dữ liệu.</p>
<ul>
<li><strong>Tính nguyên tử (Atomicity)</strong>
<ul>
<li>Giao dịch được xem là đơn vị nhỏ nhất không thể chia cắt, các thao tác trong giao dịch <strong>hoặc tất cả đều được cam kết thành công, hoặc tất cả đều thất bại và quay lui</strong>.</li>
<li>Việc quay lui có thể được thực hiện thông qua nhật ký, nhật ký ghi lại các thao tác sửa đổi mà giao dịch đã thực hiện, trong quá trình quay lui sẽ thực hiện ngược các thao tác sửa đổi này.</li>
</ul>
</li>
<li><strong>Tính nhất quán (Consistency)</strong>
<ul>
<li>Cơ sở dữ liệu giữ trạng thái nhất quán trước và sau khi giao dịch thực hiện.</li>
<li>Trong trạng thái nhất quán, kết quả đọc dữ liệu của tất cả các giao dịch đối với một dữ liệu là giống nhau.</li>
</ul>
</li>
<li><strong>Tính cô lập (Isolation)</strong>
<ul>
<li>Các sửa đổi do một giao dịch thực hiện trước khi được cam kết cuối cùng là không nhìn thấy đối với các giao dịch khác.</li>
</ul>
</li>
<li><strong>Tính bền vững (Durability)</strong>
<ul>
<li>Một khi giao dịch đã được cam kết, các sửa đổi sẽ được lưu giữ mãi mãi trong cơ sở dữ liệu. Ngay cả khi hệ thống gặp sự cố, kết quả thực hiện của giao dịch cũng không bị mất.</li>
<li>Có thể thực hiện thông qua việc sao lưu và khôi phục cơ sở dữ liệu, trong trường hợp hệ thống gặp sự cố, sử dụng cơ sở dữ liệu sao lưu để khôi phục dữ liệu.</li>
</ul>
</li>
</ul>
<p><strong>Một hệ thống cơ sở dữ liệu hỗ trợ giao dịch phải có bốn đặc tính này, nếu không trong quá trình xử lý giao dịch không thể đảm bảo tính đúng đắn của dữ liệu, quá trình giao dịch có thể không đạt được mục tiêu.</strong></p>
<ul>
<li>Chỉ khi đáp ứng tính nhất quán, kết quả thực hiện của giao dịch mới là đúng.</li>
<li>Trong trường hợp không có đồng thời, giao dịch thực hiện tuần tự, tính cô lập chắc chắn sẽ được đảm bảo. Lúc này chỉ cần đảm bảo tính nguyên tử, nhất định sẽ đảm bảo tính nhất quán.</li>
<li>Trong trường hợp đồng thời, nhiều giao dịch thực hiện song song, giao dịch không chỉ phải đảm bảo tính nguyên tử, mà còn phải đảm bảo tính cô lập để đảm bảo tính nhất quán.</li>
<li>Đảm bảo tính bền vững của giao dịch để đối phó với các tình huống hệ thống gặp sự cố.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/acid.png" alt="ACID" tabindex="0" loading="lazy"><figcaption>ACID</figcaption></figure>
<h3>Đặc tính của Giao dịch Redis</h3>
<p>Giao dịch Redis luôn hỗ trợ tính nguyên tử, tính nhất quán và tính cô lập của ACID. Khi máy chủ chạy ở chế độ lưu trữ bền vững AOF và giá trị của tùy chọn <code>appendfsync</code> là <code>always</code>, giao dịch cũng có tính bền vững.</p>
<p>Tuy nhiên, cần lưu ý rằng: <strong>Redis chỉ hỗ trợ giao dịch "không nghiêm ngặt"</strong>. "Không nghiêm ngặt" ở đây thực chất là chỉ giao dịch Redis chỉ có thể đảm bảo một phần tính nguyên tử của ACID.</p>
<ul>
<li><strong>Giao dịch Redis đảm bảo tất cả các lệnh được thực thi</strong> - Nhiều lệnh trong giao dịch Redis sẽ được đóng gói vào hàng đợi giao dịch, sau đó thực hiện theo thứ tự vào trước ra trước (FIFO). Giao dịch sẽ không bị gián đoạn trong quá trình thực hiện, khi tất cả các lệnh trong hàng đợi giao dịch đã được thực hiện xong, giao dịch mới kết thúc.</li>
<li><strong>Giao dịch Redis không hỗ trợ quay lui</strong> - Nếu lệnh thực hiện thất bại sẽ không quay lui mà sẽ tiếp tục thực hiện.</li>
</ul>
<p>Theo tài liệu chính thức của Redis về đặc tính giao dịch (transaction features documentation), lý do không hỗ trợ quay lui là:</p>
<ul>
<li>Lệnh Redis chỉ thất bại do lỗi cú pháp, hoặc lệnh được sử dụng trên loại khóa không đúng.</li>
<li>Vì không cần hỗ trợ quay lui, nội bộ của Redis có thể giữ đơn giản và nhanh chóng.</li>
</ul>
<h2>Ứng dụng Transaction trong Redis</h2>
<p>Các lệnh <a href="https://redis.io/commands/multi" target="_blank" rel="noopener noreferrer"><code>MULTI</code></a>, <a href="https://redis.io/commands/exec" target="_blank" rel="noopener noreferrer"><code>EXEC</code></a>, <a href="https://redis.io/commands/discard" target="_blank" rel="noopener noreferrer"><code>DISCARD</code></a>, và <a href="https://redis.io/commands/watch" target="_blank" rel="noopener noreferrer"><code>WATCH</code></a> liên quan đến giao dịch trong Redis.</p>
<p>Giao dịch cho phép thực thi nhiều lệnh cùng một lúc và có hai cam kết quan trọng sau đây:</p>
<ul>
<li>
<p><strong>Giao dịch là một hoạt động đơn lẻ độc lập:</strong> Tất cả các lệnh trong giao dịch sẽ được thực thi tuần tự theo thứ tự. Trong quá trình thực thi giao dịch, không có lệnh từ các khách hàng khác có thể làm gián đoạn.</p>
</li>
<li>
<p><strong>Giao dịch là một hoạt động nguyên tử:</strong> Tất cả các lệnh trong giao dịch sẽ được thực thi hoàn toàn hoặc không thực thi gì cả.</p>
</li>
</ul>
<h3>MULTI</h3>
<p><strong>Lệnh <a href="https://redis.io/commands/multi" target="_blank" rel="noopener noreferrer"><code>MULTI</code></a> được sử dụng để bắt đầu một giao dịch và luôn luôn trả về OK.</strong></p>
<p>Sau khi gọi lệnh <code>MULTI</code>, khách hàng có thể tiếp tục gửi bất kỳ số lượng lệnh nào đến máy chủ, các lệnh này sẽ không được thực thi ngay lập tức mà sẽ được đưa vào một hàng đợi. Khi lệnh <code>EXEC</code> được gọi, tất cả các lệnh trong hàng đợi sẽ được thực thi.</p>
<p>Dưới đây là một ví dụ về giao dịch, trong đó tăng giá trị của hai khóa <code>foo</code> và <code>bar</code>:</p>
<div class="language-redis" data-ext="redis" data-title="redis"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>&gt; MULTI</span></span>
<span class="line"><span>OK</span></span>
<span class="line"><span>&gt; INCR foo</span></span>
<span class="line"><span>QUEUED</span></span>
<span class="line"><span>&gt; INCR bar</span></span>
<span class="line"><span>QUEUED</span></span>
<span class="line"><span>&gt; EXEC</span></span>
<span class="line"><span>1) (integer) 1</span></span>
<span class="line"><span>2) (integer) 1</span></span></code></pre>
</div><h3>EXEC</h3>
<p><strong>Lệnh <a href="https://redis.io/commands/exec" target="_blank" rel="noopener noreferrer"><code>EXEC</code></a> được sử dụng để kích hoạt và thực thi tất cả các lệnh trong giao dịch.</strong></p>
<ul>
<li>Nếu khách hàng đã sử dụng lệnh <code>MULTI</code> để bắt đầu một giao dịch nhưng bị ngắt kết nối trước khi gọi <code>EXEC</code>, thì tất cả các lệnh trong giao dịch sẽ không được thực thi.</li>
<li>Ngược lại, nếu khách hàng thành công trong việc thực thi lệnh <code>EXEC</code> sau khi bắt đầu giao dịch bằng <code>MULTI</code>, thì tất cả các lệnh trong giao dịch sẽ được thực thi.</li>
</ul>
<p>Các hoạt động trong <code>MULTI</code> và <code>EXEC</code> sẽ được gửi đến máy chủ một lần duy nhất thay vì từng lần gửi lệnh riêng lẻ, điều này được gọi là "đường ống lệnh" (pipeline), giúp giảm thiểu số lần giao tiếp mạng giữa khách hàng và máy chủ, từ đó cải thiện hiệu suất.</p>
<h3>DISCARD</h3>
<p><strong>Khi thực thi lệnh <a href="https://redis.io/commands/discard" target="_blank" rel="noopener noreferrer"><code>DISCARD</code></a>, giao dịch sẽ bị hủy bỏ, hàng đợi giao dịch sẽ được xóa và khách hàng sẽ thoát khỏi trạng thái giao dịch.</strong></p>
<p>Ví dụ:</p>
<div class="language-redis" data-ext="redis" data-title="redis"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>&gt; SET foo 1</span></span>
<span class="line"><span>OK</span></span>
<span class="line"><span>&gt; MULTI</span></span>
<span class="line"><span>OK</span></span>
<span class="line"><span>&gt; INCR foo</span></span>
<span class="line"><span>QUEUED</span></span>
<span class="line"><span>&gt; DISCARD</span></span>
<span class="line"><span>OK</span></span>
<span class="line"><span>&gt; GET foo</span></span>
<span class="line"><span>"1"</span></span></code></pre>
</div><h3>WATCH</h3>
<p><strong>Lệnh <a href="https://redis.io/commands/watch" target="_blank" rel="noopener noreferrer"><code>WATCH</code></a> trong Redis cung cấp hành vi "check-and-set" (CAS) cho giao dịch.</strong></p>
<p>Khi một hoặc nhiều khóa được <code>WATCH</code>, Redis sẽ theo dõi những khóa này và phát hiện xem chúng có bị thay đổi không. Nếu ít nhất một khóa đã được theo dõi bị thay đổi trước khi <code>EXEC</code> được thực thi, toàn bộ giao dịch sẽ bị hủy bỏ và <code>EXEC</code> sẽ trả về <code>nil-reply</code> để báo hiệu rằng giao dịch đã thất bại.</p>
<div class="language-redis" data-ext="redis" data-title="redis"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>WATCH mykey</span></span>
<span class="line"><span>val = GET mykey</span></span>
<span class="line"><span>val = val + 1</span></span>
<span class="line"><span>MULTI</span></span>
<span class="line"><span>SET mykey $val</span></span>
<span class="line"><span>EXEC</span></span></code></pre>
</div><p>Trong đoạn mã trên, nếu sau khi thực hiện <code>WATCH</code> và trước khi thực thi <code>EXEC</code>, có một khách hàng khác thay đổi giá trị của <code>mykey</code>, thì giao dịch của khách hàng hiện tại sẽ thất bại. Trong trường hợp này, chương trình có thể cần thử lại hoạt động này, cho đến khi không có xung đột nào xảy ra.</p>
<p>Cơ chế khóa này được gọi là khóa lạc quan (optimistic locking), là một cơ chế khóa mạnh mẽ vì hầu hết các trường hợp, các khách hàng khác nhau sẽ truy cập vào các khóa khác nhau, do đó ít xảy ra xung đột.</p>
<p><strong>Chú ý:</strong></p>
<ul>
<li><code>WATCH</code> làm cho <code>EXEC</code> chỉ thực thi nếu tất cả các khóa đã theo dõi không bị thay đổi.</li>
<li><code>WATCH</code> có thể được gọi nhiều lần. Việc theo dõi các khóa bắt đầu từ khi <code>WATCH</code> được thực thi cho đến khi <code>EXEC</code> được gọi.</li>
<li>Khi <code>EXEC</code> được gọi, việc theo dõi các khóa sẽ bị hủy bỏ, dù giao dịch có thành công hay không. Ngoài ra, khi một khách hàng bị ngắt kết nối, việc theo dõi các khóa cũng sẽ bị hủy bỏ.</li>
</ul>
<p><strong>Hủy WATCH:</strong></p>
<ul>
<li>Sử dụng lệnh <code>UNWATCH</code> không có tham số để hủy bỏ theo dõi tất cả các khóa. Điều này có thể hữu ích khi một giao dịch cần hủy bỏ ngay lập tức và chờ giao dịch thử lại sau.</li>
</ul>
<p><strong>Sử dụng WATCH để tạo hành động nguyên tử:</strong></p>
<ul>
<li><code>WATCH</code> có thể được sử dụng để tạo các hành động nguyên tử mà Redis không hỗ trợ sẵn.</li>
<li>Ví dụ, đoạn mã sau triển khai lệnh <code>ZPOP</code> tùy chỉnh để loại bỏ phần tử có giá trị (score) nhỏ nhất trong một tập hợp có thứ tự:</li>
</ul>
<div class="language-redis" data-ext="redis" data-title="redis"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>WATCH zset</span></span>
<span class="line"><span>element = ZRANGE zset 0 0</span></span>
<span class="line"><span>MULTI</span></span>
<span class="line"><span>ZREM zset element</span></span>
<span class="line"><span>EXEC</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/acid.png" type="image/png"/>
    </item>
    <item>
      <title>SQL</title>
      <link>https://vanhung4499.github.io/database/sql/</link>
      <guid>https://vanhung4499.github.io/database/sql/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">SQL</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>SQL Cheat Sheet</title>
      <link>https://vanhung4499.github.io/database/sql/cheat-sheet.html</link>
      <guid>https://vanhung4499.github.io/database/sql/cheat-sheet.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">SQL Cheat Sheet</source>
      <description>SQL Cheat Sheet Câu truy vấn để tìm kiếm dữ liệu SELECT: Được sử dụng để lựa chọn dữ liệu từ cơ sở dữ liệu SELECT * FROM table_name; DISTINCT: Được sử dụng để lọc bỏ các giá trị...</description>
      <category>sql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Câu truy vấn để tìm kiếm dữ liệu</h2>
<h3><strong>SELECT</strong>: Được sử dụng để lựa chọn dữ liệu từ cơ sở dữ liệu</h3>
<ul>
<li><code>SELECT</code> * <code>FROM</code> table_name;</li>
</ul>
<h3><strong>DISTINCT</strong>: Được sử dụng để lọc bỏ các giá trị trùng lặp và trả về các hàng của các cột đã chỉ định</h3>
<ul>
<li><code>SELECT DISTINCT</code> column_name;</li>
</ul>
<h3><strong>WHERE</strong>: Được sử dụng để lọc các bản ghi/hàng</h3>
<ul>
<li><code>SELECT</code> column1, column2 <code>FROM</code> table_name <code>WHERE</code> condition;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> condition1 <code>AND</code> condition2;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> condition1 <code>OR</code> condition2;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE NOT</code> condition;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> condition1 <code>AND</code> (condition2 <code>OR</code> condition3);</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE EXISTS</code> (<code>SELECT</code> column_name <code>FROM</code> table_name <code>WHERE</code> condition);</li>
</ul>
<h3><strong>ORDER BY</strong>: Được sử dụng để sắp xếp kết quả trả về, theo thứ tự tăng dần (ASC) hoặc giảm dần (DESC)</h3>
<ul>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>ORDER BY</code> column;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>ORDER BY</code> column <code>DESC</code>;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>ORDER BY</code> column1 <code>ASC</code>, column2 <code>DESC</code>;</li>
</ul>
<h3><strong>SELECT TOP</strong>: Được sử dụng để chỉ định số lượng bản ghi trả về từ đầu bảng</h3>
<ul>
<li><code>SELECT TOP</code> number columns_names <code>FROM</code> table_name <code>WHERE</code> condition;</li>
<li><code>SELECT TOP</code> percent columns_names <code>FROM</code> table_name <code>WHERE</code> condition;</li>
<li>Không phải tất cả các hệ thống cơ sở dữ liệu đều hỗ trợ <code>SELECT TOP</code>. Trong MySQL, thay vào đó sử dụng <code>LIMIT</code> trong câu truy vấn.</li>
<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>LIMIT</code> offset, count;</li>
</ul>
<h3><strong>LIKE</strong>: Được sử dụng để tìm kiếm các mẫu cụ thể trong một cột, được sử dụng trong mệnh đề WHERE</h3>
<ul>
<li>% (dấu phần trăm) là ký tự đại diện cho không, một hoặc nhiều ký tự</li>
<li>_ (gạch dưới) là ký tự đại diện cho một ký tự duy nhất</li>
<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>WHERE</code> column_name <code>LIKE</code> pattern;</li>
<li><code>LIKE</code> ‘a%’ (tìm kiếm bất kỳ giá trị nào bắt đầu bằng "a")</li>
<li><code>LIKE</code> ‘%a’ (tìm kiếm bất kỳ giá trị nào kết thúc bằng "a")</li>
<li><code>LIKE</code> ‘%or%’ (tìm kiếm bất kỳ giá trị nào chứa "or")</li>
<li><code>LIKE</code> ‘_r%’ (tìm kiếm bất kỳ giá trị nào có ký tự thứ hai là "r")</li>
<li><code>LIKE</code> ‘a*%*%’ (tìm kiếm bất kỳ giá trị nào bắt đầu bằng "a" và có độ dài ít nhất là 3)</li>
<li><code>LIKE</code> ‘[a-c]%’ (tìm kiếm bất kỳ giá trị nào bắt đầu bằng "a" hoặc "b" hoặc "c")</li>
</ul>
<h3><strong>IN</strong>: Được sử dụng để chỉ định nhiều giá trị trong mệnh đề WHERE</h3>
<ul>
<li>Thực chất, toán tử IN là viết tắt của nhiều điều kiện OR</li>
<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>WHERE</code> column_name <code>IN</code> (value1, value2, …);</li>
<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>WHERE</code> column_name <code>IN</code> (<code>SELECT STATEMENT</code>);</li>
</ul>
<h3><strong>BETWEEN</strong>: Được sử dụng để lọc các giá trị trong một phạm vi đã cho</h3>
<ul>
<li><code>SELECT</code> column_names <code>FROM</code> table_name <code>WHERE</code> column_name <code>BETWEEN</code> value1 <code>AND</code> value2;</li>
<li><code>SELECT</code> * <code>FROM</code> Products <code>WHERE</code> (column_name <code>BETWEEN</code> value1 <code>AND</code> value2) <code>AND NOT</code> column_name2 <code>IN</code> (value3, value4);</li>
<li><code>SELECT</code> * <code>FROM</code> Products <code>WHERE</code> column_name <code>BETWEEN</code> #01/07/1999# AND #03/12/1999#;</li>
</ul>
<h3><strong>NULL</strong>: Đại diện cho một trường không có giá trị</h3>
<ul>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> column_name <code>IS NULL</code>;</li>
<li><code>SELECT</code> * <code>FROM</code> table_name <code>WHERE</code> column_name <code>IS NOT NULL</code>;</li>
</ul>
<h3><strong>AS</strong>: Được sử dụng để đặt tên bí danh cho bảng hoặc cột</h3>
<ul>
<li><code>SELECT</code> column_name <code>AS</code> alias_name <code>FROM</code> table_name;</li>
<li><code>SELECT</code> column_name <code>FROM</code> table_name <code>AS</code> alias_name;</li>
<li><code>SELECT</code> column_name <code>AS</code> alias_name1, column_name2 <code>AS</code> alias_name2;</li>
<li><code>SELECT</code> column_name1, column_name2 + ‘, ‘ + column_name3 <code>AS</code> alias_name;</li>
</ul>
<h3><strong>UNION</strong>: Được sử dụng để kết hợp kết quả của hai hoặc nhiều câu truy vấn SELECT</h3>
<ul>
<li>Mỗi câu truy vấn SELECT phải có cùng số cột</li>
<li>Các cột phải có cùng kiểu dữ liệu tương tự</li>
<li>Các cột trong mỗi câu truy vấn SELECT cũng phải có cùng thứ tự</li>
<li><code>SELECT</code> columns_names <code>FROM</code> table1 <code>UNION SELECT</code> column_name <code>FROM</code> table2;</li>
<li><code>UNION</code> chỉ cho phép lựa chọn các giá trị khác nhau, <code>UNION ALL</code> cho phép lựa chọn trùng lặp</li>
</ul>
<h3><strong>ANY|ALL</strong>: Được sử dụng để kiểm tra các điều kiện của mệnh đề con trong mệnh đề WHERE hoặc HAVING</h3>
<ul>
<li><code>ANY</code> trả về true nếu bất kỳ giá trị con của câu truy vấn thỏa mãn điều kiện.</li>
<li><code>ALL</code> trả về true nếu tất cả các giá trị con của câu truy vấn đều thỏa mãn điều kiện.</li>
<li><code>SELECT</code> columns_names <code>FROM</code> table1 <code>WHERE</code> column_name operator (<code>ANY</code>|<code>ALL</code>) (<code>SELECT</code> column_name <code>FROM</code> table_name <code>WHERE</code> condition);</li>
</ul>
<h3><strong>GROUP BY</strong>: Thường được sử dụng cùng với các hàm tổng hợp (COUNT, MAX, MIN, SUM, AVG), được sử dụng để nhóm kết quả thành một hoặc nhiều cột</h3>
<ul>
<li><code>SELECT</code> column_name1, COUNT(column_name2) <code>FROM</code> table_name <code>WHERE</code> condition <code>GROUP BY</code> column_name1 <code>ORDER BY</code> COUNT(column_name2) DESC;</li>
</ul>
<h3><strong>HAVING</strong>: Mệnh đề HAVING chỉ định rằng câu truy vấn SELECT chỉ nên trả về các giá trị tổng hợp thỏa mãn điều kiện đã chỉ định. Nó được thêm vào SQL vì từ khóa WHERE không thể được sử dụng với các hàm tổng hợp.</h3>
<ul>
<li><code>SELECT</code> <code>COUNT</code>(column_name1), column_name2 <code>FROM</code> table <code>GROUP BY</code> column_name2 <code>HAVING</code> <code>COUNT(</code>column_name1<code>)</code> &gt; 5;</li>
</ul>
<h2>Câu truy vấn để thay đổi dữ liệu</h2>
<h3><strong>INSERT INTO</strong>: Được sử dụng để chèn bản ghi/hàng mới vào bảng</h3>
<ul>
<li><code>INSERT INTO</code> table_name (column1, column2) <code>VALUES</code> (value1, value2);</li>
<li><code>INSERT INTO</code> table_name <code>VALUES</code> (value1, value2 …);</li>
</ul>
<h3><strong>UPDATE</strong>: Được sử dụng để sửa đổi các bản ghi/hàng hiện có trong bảng</h3>
<ul>
<li><code>UPDATE</code> table_name <code>SET</code> column1 = value1, column2 = value2 <code>WHERE</code> condition;</li>
<li><code>UPDATE</code> table_name <code>SET</code> column_name = value;</li>
</ul>
<h3><strong>DELETE</strong>: Được sử dụng để xóa các bản ghi/hàng hiện có trong bảng</h3>
<ul>
<li><code>DELETE FROM</code> table_name <code>WHERE</code> condition;</li>
<li><code>DELETE</code> * <code>FROM</code> table_name;</li>
</ul>
<h2>Câu truy vấn tổng hợp</h2>
<h3><strong>COUNT</strong>: Trả về số lần xuất hiện</h3>
<ul>
<li><code>SELECT COUNT (DISTINCT</code> column_name<code>)</code>;</li>
</ul>
<h3><strong>MIN() và MAX()</strong>: Trả về giá trị nhỏ nhất/lớn nhất của cột đã chọn</h3>
<ul>
<li><code>SELECT MIN (</code>column_names<code>) FROM</code> table_name <code>WHERE</code> condition;</li>
<li><code>SELECT MAX (</code>column_names<code>) FROM</code> table_name <code>WHERE</code> condition;</li>
</ul>
<h3><strong>AVG()</strong>: Trả về giá trị trung bình của cột số</h3>
<ul>
<li><code>SELECT AVG (</code>column_name<code>) FROM</code> table_name <code>WHERE</code> condition;</li>
</ul>
<h3><strong>SUM()</strong>: Trả về tổng các giá trị của cột số</h3>
<ul>
<li><code>SELECT SUM (</code>column_name<code>) FROM</code> table_name <code>WHERE</code> condition;</li>
</ul>
<h2>Câu truy vấn kết nối</h2>
<h3><strong>INNER JOIN</strong>: Kết nối trong, trả về các bản ghi có giá trị khớp trong hai bảng</h3>
<ul>
<li><code>SELECT</code> column_names <code>FROM</code> table1 <code>INNER JOIN</code> table2 <code>ON</code> table1.column_name=table2.column_name;</li>
<li><code>SELECT</code> table1.column_name1, table2.column_name2, table3.column_name3 <code>FROM</code> ((table1 <code>INNER JOIN</code> table2 <code>ON</code> relationship) <code>INNER JOIN</code> table3 <code>ON</code> relationship);</li>
</ul>
<h3><strong>LEFT (OUTER) JOIN</strong>: Kết nối ngoài trái, trả về tất cả các bản ghi trong bảng trái (table1) và các bản ghi khớp trong bảng phải (table2)</h3>
<ul>
<li><code>SELECT</code> column_names <code>FROM</code> table1 <code>LEFT JOIN</code> table2 <code>ON</code> table1.column_name=table2.column_name;</li>
</ul>
<h3><strong>RIGHT (OUTER) JOIN</strong>: Kết nối ngoài phải, trả về tất cả các bản ghi trong bảng phải (table2) và các bản ghi khớp trong bảng trái (table1)</h3>
<ul>
<li><code>SELECT</code> column_names <code>FROM</code> table1 <code>RIGHT JOIN</code> table2 <code>ON</code> table1.column_name=table2.column_name;</li>
</ul>
<h3><strong>FULL (OUTER) JOIN</strong>: Kết nối ngoài đầy đủ, kết hợp của kết nối ngoài trái và kết nối ngoài phải. Bảng kết nối bao gồm tất cả các bản ghi từ bảng được kết nối, nếu thiếu bản ghi khớp, sẽ được điền bằng NULL.</h3>
<ul>
<li><code>SELECT</code> column_names <code>FROM</code> table1 <code>FULL OUTER JOIN</code> table2 <code>ON</code> table1.column_name=table2.column_name;</li>
</ul>
<h3><strong>Self JOIN</strong>: Kết nối tự thân, kết nối bảng với chính nó</h3>
<ul>
<li><code>SELECT</code> column_names <code>FROM</code> table1 T1, table1 T2 <code>WHERE</code> condition;</li>
</ul>
<h2>Câu truy vấn xem</h2>
<h3><strong>CREATE</strong>: Tạo xem</h3>
<ul>
<li><code>CREATE VIEW</code> view_name <code>AS SELECT</code> column1, column2 <code>FROM</code> table_name <code>WHERE</code> condition;</li>
</ul>
<h3><strong>SELECT</strong>: Truy xuất xem</h3>
<ul>
<li><code>SELECT</code> * <code>FROM</code> view_name;</li>
</ul>
<h3><strong>DROP</strong>: Xóa xem</h3>
<ul>
<li><code>DROP VIEW</code> view_name;</li>
</ul>
<h2>Câu truy vấn để sửa đổi bảng</h2>
<h3><strong>ADD</strong>: Thêm cột</h3>
<ul>
<li><code>ALTER TABLE</code> table_name <code>ADD</code> column_name column_definition;</li>
</ul>
<h3><strong>MODIFY</strong>: Sửa đổi kiểu dữ liệu cột</h3>
<ul>
<li><code>ALTER TABLE</code> table_name <code>MODIFY</code> column_name column_type;</li>
</ul>
<h3><strong>DROP</strong>: Xóa cột</h3>
<ul>
<li><code>ALTER TABLE</code> table_name <code>DROP COLUMN</code> column_name;</li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>SQL DB Design Process</title>
      <link>https://vanhung4499.github.io/database/sql/db-design-process.html</link>
      <guid>https://vanhung4499.github.io/database/sql/db-design-process.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">SQL DB Design Process</source>
      <description>Todo</description>
      <category>db</category>
      <category>sql</category>
      <category>design</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
]]></content:encoded>
    </item>
    <item>
      <title>Extend SQL</title>
      <link>https://vanhung4499.github.io/database/sql/extend-sql.html</link>
      <guid>https://vanhung4499.github.io/database/sql/extend-sql.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Extend SQL</source>
      <description>Mở rộng SQL Cơ sở dữ liệu Bảng Xem thông tin cơ bản của bảng Xem thông tin cột của bảng Làm thế nào để xóa một lượng lớn dữ liệu Nếu bạn muốn xóa một lượng lớn dữ liệu dựa trên ...</description>
      <category>db</category>
      <category>sql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Cơ sở dữ liệu</h2>
<h2>Bảng</h2>
<h3>Xem thông tin cơ bản của bảng</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66"> information_schema</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">tables</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> table_schema </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> 'test'</span><span style="color:#C678DD;--shiki-dark:#C678DD"> AND</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> table_name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> 'user'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Xem thông tin cột của bảng</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66"> information_schema</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">columns</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> table_schema </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> 'test'</span><span style="color:#C678DD;--shiki-dark:#C678DD"> AND</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> table_name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> 'user'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Làm thế nào để xóa một lượng lớn dữ liệu</h3>
<p>Nếu bạn muốn xóa một lượng lớn dữ liệu dựa trên một khoảng thời gian, câu lệnh đơn giản như sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">DELETE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> orders</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> timestamp</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> SUBDATE(CURDATE(), INTERVAL </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#C678DD;--shiki-dark:#C678DD"> month</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Câu lệnh trên có khả năng gây lỗi khi thực thi, báo lỗi xóa không thành công, vì lượng dữ liệu cần xóa quá lớn, vì vậy cần xóa theo từng phần.</p>
<p>Bạn có thể trước tiên tìm ra ID đơn hàng cũ nhất trong các đơn hàng lịch sử thỏa mãn điều kiện, sau đó chuyển điều kiện xóa thành xóa theo khóa chính.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> MAX</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(id) </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> orders</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> timestamp</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> SUBDATE(CURDATE(), INTERVAL </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#C678DD;--shiki-dark:#C678DD"> month</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xóa theo từng phần, ? điền vào giá trị ID lớn nhất tìm được từ câu lệnh trên</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">DELETE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> orders</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> id </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ?</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">ORDER BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> id </span><span style="color:#C678DD;--shiki-dark:#C678DD">LIMIT</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Thay đổi định dạng mã hóa của bảng</h3>
<p>Mã hóa utf8mb4 là một phiên bản mở rộng của utf8, tương thích với utf8 và có thể lưu trữ các ký tự biểu tượng cảm xúc 4 byte. Nếu mã hóa của bảng được chỉ định là utf8, sẽ xảy ra lỗi khi lưu trữ trường emoji.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">ALTER</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">tableName</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> CONVERT </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#C678DD;--shiki-dark:#C678DD"> CHARACTER</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> utf8mb4 </span><span style="color:#C678DD;--shiki-dark:#C678DD">COLLATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> utf8mb4_general_ci;</span></span></code></pre>
</div><h2>Khác</h2>
<h3>Hiển thị các tiến trình đang chạy</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> show processlist;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">+</span></span></code></pre>
</div>]]></content:encoded>
    </item>
    <item>
      <title>How SQL DB works?</title>
      <link>https://vanhung4499.github.io/database/sql/how-sql-db-works.html</link>
      <guid>https://vanhung4499.github.io/database/sql/how-sql-db-works.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">How SQL DB works?</source>
      <description>Bắt đầu với Data Structure &amp; Algorithm Độ phức tạp thời gian Đối với cơ sở dữ liệu, điều quan trọng không phải là khối lượng dữ liệu, mà là làm thế nào các hoạt động tăng lên kh...</description>
      <category>sql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[<h2>Bắt đầu với Data Structure &amp; Algorithm</h2>
<h3>Độ phức tạp thời gian</h3>
<blockquote>
<p>Đối với cơ sở dữ liệu, điều quan trọng không phải là khối lượng dữ liệu, mà là làm thế nào các hoạt động tăng lên khi khối lượng dữ liệu tăng lên.</p>
</blockquote>
<p>Độ phức tạp thuật toán kéo theo độ phức tạp thời gian (time complexity) và độ phức tạp không gian (space complexity). Vui lòng đọc [[Complexity Analysis]]</p>
<h3>[[Merge Sort]]</h3>
<blockquote>
<p>Đối với cơ sở dữ liệu, bạn cần phải hiểu cách thức hoạt động của hàm sort() này.</p>
</blockquote>
<p>[[Merge Sort]] chia bài toán lớn thành các bài toán nhỏ, giải quyết bài toán ban đầu bằng cách giải quyết các bài toán nhỏ. Thuật toán này theo tư tưởng chia để trị (deidve and conquer)</p>
<p><strong>Tại sao lại là Merge Sort?</strong></p>
<ul>
<li>Bạn có thể thay đổi thuật toán để tiết kiệm không gian bộ nhớ bằng cách không tạo chuỗi mới mà thay đổi trực tiếp chuỗi đầu vào. Lưu ý: Thuật toán này được gọi là <strong>in-place algorithm</strong></li>
<li>Bạn có thể thay đổi thuật toán để bạn có thể tránh Disk I/O khổng lồ bằng cách sử dụng cả dung lượng đĩa và một lượng nhỏ bộ nhớ. Phương pháp là chỉ tải các phần hiện đang được xử lý vào bộ nhớ. Đây là một kỹ thuật quan trọng khi sắp xếp một vài GB bảng trong bộ đệm bộ nhớ chỉ 100MB. Lưu ý: Thuật toán này được gọi là <strong>external sorting</strong>.</li>
<li>Bạn có thể thay đổi thuật toán để dễ dàng chạy trên đa nhân / đa luồng / đa máy chủ. Ví dụ, sắp xếp hợp nhất phân tán là một trong những thành phần quan trọng của <strong>Hadoop</strong>, một big data framework nổi tiếng.</li>
</ul>
<h3>[[Binary Search Tree]]</h3>
<blockquote>
<p>Độ phức tạp thời gian của truy vấn trong cơ sở dữ liệu là không thể sử dụng ma trận, thay vào đó sử dụng Binary Search Tree (BST), vui lòng xem [[Binary Search Tree]]</p>
</blockquote>
<ul>
<li>[[Binary Search Tree]] chỉ yêu cầu truy cấn O(log(n)), trong khi nếu bạn sử dụng mảng trực tiếp, bạn sẽ cần truy vấn O(n)</li>
</ul>
<h3>[[B Tree]]</h3>
<blockquote>
<p>Tree làm việc tốt với việc tìm một giá trị cụ thể, nhưng khi bạn cần phải <strong>tìm nhiều yếu tố giữa hai giá trị</strong>, bạn có thể gặp rắc rối lớn. Chi phí của bạn sẽ là O(N) vì bạn phải tìm mỗi nút của cây để xác định xem nó có nằm giữa 2 giá trị đó hay không (ví dụ: sử dụng inorder traversal trên cây). Và thao tác này không phải là thuận lợi cho Disk I/O, bởi vì bạn phải đọc toàn bộ cây. Chúng ta cần phải tìm một phương pháp truy vấn phạm vi hiệu quả.</p>
</blockquote>
<p><strong>Nếu bạn thêm hoặc xóa một hàng trong cơ sở dữ liệu</strong>&nbsp;(do đó trong chỉ mục cây B + có liên quan):</p>
<ul>
<li>Bạn phải duy trì thứ tự giữa các nút trong B+ Tree, nếu không các nút sẽ trở nên lộn xộn và bạn không thể tìm thấy nút bạn muốn.</li>
<li>Bạn phải giảm thiểu số lớp của B+ Tree, nếu không độ phức tạp của O (log(N) sẽ trở thành O (N</li>
</ul>
<p>Nói cách khác, [[B Tree]] cần phải tự sắp xếp và tự cân bằng. Rất may, chúng có xóa và chèn thông minh. Nhưng điều này cũng mang lại chi phí: trong B+ Tree, chèn và xóa là độ phức tạp O(log(N). Vì vậy, một số người đã nghe nói rằng sử dụng quá nhiều Index không phải là một ý tưởng tốt như vậy. Đúng vậy, bạn đã làm chậm hoạt động của một hàng trong bảng chèn/cập nhật/xóa nhanh chóng vì cơ sở dữ liệu cần phải cập nhật chỉ mục của bảng với chi phí cao cho mỗi hoạt động O(log(N). Hơn nữa, tăng chỉ mục có nghĩa là mang lại nhiều khối lượng công việc hơn cho Transaction Manager (sẽ được đề cập phía dưới).</p>
<h3>Hash Table</h3>
<blockquote>
<p>[[Hash Table]] rất hữu ích khi bạn muốn tìm các giá trị một cách nhanh chóng. Hơn nữa, sự hiểu biết về Hash Table sẽ giúp chúng ta hiểu các hoạt động kết nối phổ biến tiếp theo của một cơ sở dữ liệu được gọi là "hash connection". <strong>Cấu trúc dữ liệu này cũng được sử dụng bởi cơ sở dữ liệu để lưu một cái gì đó bên trong</strong> (chẳng hạn như <strong>bảng khóa</strong> hoặc <strong>vùng đệm</strong>, mà sẽ nghiên cứu dưới đây)</p>
</blockquote>
<p><strong>Tại sao không sử dụng mảng</strong>?</p>
<ul>
<li>Nếu có một hash function tốt, độ phức tạp thời gian tìm kiếm trong [[Hash Table]] là O(1).</li>
<li><strong>Một [[Hash Table]] có thể được nạp chỉ một nửa vào bộ nhớ, và hash bucket còn lại có thể được giữ lại trên đĩa cứng</strong>.</li>
<li>Với mảng, bạn cần một không gian bộ nhớ liên tục. Nếu bạn tải một bảng lớn, thật khó để phân bổ đủ không gian bộ nhớ liên tục.</li>
</ul>
<h2>Tổng quan SQL DB</h2>
<p>Cơ sở dữ liệu (database) thường có thể được hiểu bằng cách sử dụng đồ họa sau:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604124944.png" alt="Pasted image 20230604124944" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604124944</figcaption></figure>
<h3>Các thành phần cốt lõi (Core Components)</h3>
<ul>
<li>
<p><strong>Trình quản lý quy trình (process manager):</strong> Nhiều cơ sở dữ liệu có process/thread pool cần được quản lý đúng cách. Hơn nữa, để đạt được hoạt động trong nanosecond, một số cơ sở dữ liệu hiện đại sử dụng thread riêng của họ thay vì OS thread.</p>
</li>
<li>
<p><strong>Network manager</strong>: Internet I/O là một vấn đề lớn, đặc biệt là đối với cơ sở dữ liệu phân tán. Vì vậy, một số cơ sở dữ liệu có trình quản lý mạng riêng.</p>
</li>
<li>
<p>**Trình quản lý hệ thống tệp (File system manager)😗*Disk I/O là nút thắt cổ chai chính của cơ sở dữ liệu. Nó là rất quan trọng để có một trình quản lý hệ thống tập tin để xử lý hoàn hảo hệ thống tập tin OS hoặc thậm chí thay thế hệ thống tập tin OS.</p>
</li>
<li>
<p><strong>Memory manager</strong>: Để tránh giảm hiệu suất do disk I/O gây ra, cần rất nhiều bộ nhớ. Nhưng nếu bạn muốn xử lý bộ nhớ dung lượng lớn, bạn cần trình quản lý bộ nhớ hiệu quả, đặc biệt là khi bạn có rất nhiều truy vấn để sử dụng bộ nhớ cùng một lúc.</p>
</li>
<li>
<p><strong>Security Manager</strong>: Được sử dụng để xác thực và phân quyền người dùng.</p>
</li>
<li>
<p><strong>Trình quản lý khách hàng (Client manager):</strong> Được sử dụng để quản lý kết nối khách hàng.</p>
</li>
<li>
<p>……</p>
</li>
</ul>
<h3>Công cụ (Tools)</h3>
<ul>
<li>
<p><strong>Trình quản lý sao lưu (Backup manager):</strong> Được sử dụng để lưu và khôi phục dữ liệu.</p>
</li>
<li>
<p><strong>Trình quản lý phục hồi (Recovery manager</strong>): Được sử dụng để khởi động lại cơ sở dữ liệu đến trạng thái nhất quán sau khi sự cố.</p>
</li>
<li>
<p><strong>Monitor manager</strong>: Công cụ để ghi lại hoạt động cơ sở dữ liệu và cung cấp cơ sở dữ liệu giám sát.</p>
</li>
<li>
<p><strong>Administration manager</strong>: Được sử dụng để lưu siêu dữ liệu như tên và cấu trúc của bảng, cung cấp các công cụ để quản lý cơ sở dữ liệu, mẫu, không gian bảng.</p>
</li>
<li>
<p>……</p>
</li>
</ul>
<h3>Trình quản lý truy vấn (Query Manager)</h3>
<ul>
<li>
<p><strong>Trình phân tích cú pháp truy vấn (Query parser):</strong> Được sử dụng để kiểm tra xem truy vấn có hợp pháp hay không</p>
</li>
<li>
<p><strong>Trình viết lại truy vấn (Query Rewriter):</strong> Để tối ưu hóa trước truy vấn</p>
</li>
<li>
<p><strong>Trình tối ưu hóa truy vấn (Query Optimizer):</strong> Để tối ưu hóa truy vấn</p>
</li>
<li>
<p><strong>Trình thực thi truy vấn (Query Executor):</strong> Được sử dụng để biên dịch và thực thi truy vấn</p>
</li>
</ul>
<h3>Trình quản lý dữ liệu (Data Manager)</h3>
<ul>
<li>
<p><strong>Trình quản lý giao dịch (Transaction Manager):</strong> Được sử dụng để xử lý các giao dịch</p>
</li>
<li>
<p><strong>Trình quản lý bộ nhớ cache (Cache Manager)</strong>: Dữ liệu được đặt trong bộ nhớ trước khi nó được sử dụng, hoặc trước khi dữ liệu được ghi vào đĩa</p>
</li>
<li>
<p><strong>Trình quản lý truy cập dữ liệu (Data Access Manager):</strong> Truy cập dữ liệu trong đĩa</p>
</li>
</ul>
<h2>Quá trình truy vấn dữ liệu</h2>
<p>Chương này tập trung vào cách cơ sở dữ liệu có thể quản lý truy vấn SQL thông qua các quy trình sau:</p>
<ul>
<li>Trình quản lý khách hàng</li>
<li>Trình quản lý truy vấn</li>
<li>Trình quản lý dữ liệu (bao gồm trình quản lý phục hồi)</li>
<li>Trình quản lý khách hàng</li>
</ul>
<h2>Trình quản lý khách hàng (Client Manager)</h2>
<blockquote>
<p>Trình quản lý khách hàng xử lý giao tiếp khách hàng. Khách hàng có thể là một máy chủ (trang web) hoặc một người dùng cuối hoặc ứng dụng cuối cùng. Trình quản lý khách hàng thông qua một loạt các API nổi tiếng (JDBC, ODBC, OLE-DB … ) cung cấp những cách khác nhau để truy cập vào cơ sở dữ liệu. Trình quản lý khách hàng cũng cung cấp API truy cập cơ sở dữ liệu độc quyền.</p>
</blockquote>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604125929.png" alt="Pasted image 20230604125929" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604125929</figcaption></figure>
<p><strong>Khi bạn kết nối với cơ sở dữ liệu</strong>:</p>
<ul>
<li>Trình quản lý bắt đầu bằng cách kiểm tra thông tin xác minh (tên người dùng và mật khẩu) của bạn và sau đó kiểm tra xem bạn có quyền truy cập vào cơ sở dữ liệu hay không. Các quyền này được gán bởi DBA.</li>
<li>Trình quản lý sau đó kiểm tra xem có một tiến trình nhàn rỗi (hoặc luồng) để xử lý truy vấn của bạn không?</li>
<li>Trình quản lý cũng kiểm tra xem cơ sở dữ liệu có tải nặng hay không?</li>
<li>Trình quản lý có thể chờ một lúc để có được tài nguyên cần thiết. Nếu thời gian chờ đạt đến thời gian chờ, nó sẽ đóng kết nối và đưa ra thông báo lỗi có thể đọc được.</li>
<li>Trình quản lý sau đó sẽ gửi truy vấn của bạn cho trình quản lý truy vấn để xử lý.</li>
<li>Bởi vì quá trình xử lý truy vấn không phải là 'không đầy đủ thì không có', một khi nó nhận được dữ liệu từ trình quản lý truy vấn, nó sẽ lưu một phần kết quả vào bộ đệm và bắt đầu gửi cho bạn.</li>
<li>Nếu bạn gặp sự cố, Trình quản lý đóng kết nối, gửi cho bạn thông tin giải thích có thể đọc được và sau đó giải phóng tài nguyên.</li>
</ul>
<h2>Trình quản lý truy vấn</h2>
<blockquote>
<p>Phần này là sức mạnh của cơ sở dữ liệu, trong đó một truy vấn được viết xấu có thể được chuyển đổi thành mã thực thi nhanh chóng, và kết quả thực thi mã được gửi đến trình quản lý khách hàng.</p>
</blockquote>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604130525.png" alt="Pasted image 20230604130525" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604130525</figcaption></figure>
<p>Quá trình hoạt động nhiều bước này như sau:</p>
<ul>
<li>
<p>Truy vấn đầu tiên được <strong>phân tích cú pháp (parser)</strong> và xác định xem nó có hợp pháp hay không</p>
</li>
<li>
<p>Sau đó được <strong>viết lại (rewrite)</strong>, loại bỏ các hoạt động vô dụng và tham gia phần <strong>tối ưu hóa trước (pre-optimized)</strong></p>
</li>
<li>
<p>Sau đó được <strong>tối ưu hóa (optimized)</strong> để cải thiện hiệu suất và được <strong>chuyển đổi thành mã thực thi (translated into executable code)</strong> và <strong>kế hoạch truy cập dữ liệu (data access plans)</strong>.</p>
</li>
<li>
<p>Kế hoạch sau đó được <strong>biên dịch (compiled)</strong></p>
</li>
<li>
<p>Cuối cùng, được <strong>thực thi (excuted)</strong></p>
</li>
</ul>
<p>Tôi sẽ không khám phá quá nhiều hai bước cuối cùng ở đây, bởi vì họ không quá quan trọng.</p>
<h3>Trình phân tích cú pháp truy vấn (Query Parser)</h3>
<blockquote>
<p>Mỗi câu lệnh SQL được gửi đến trình phân tích cú pháp để kiểm tra cú pháp và nếu truy vấn của bạn sai, trình phân tích cú pháp sẽ từ chối truy vấn đó. Ví dụ, nếu bạn viết "SLECT …" Thay vì "SELECT…", thì không có gì dưới đây.</p>
</blockquote>
<p>Nhưng điều này không hoàn tất, trình phân tích cú pháp cũng sẽ kiểm tra xem từ khóa có sử dụng đúng thứ tự hay không, chẳng hạn như WHERE sẽ bị từ chối trước khi SELECT.</p>
<p>Trình phân tích cú pháp sau đó muốn phân tích các bảng và trường trong truy vấn, sử dụng siêu dữ liệu cơ sở dữ liệu để kiểm tra:</p>
<ul>
<li>Bảng có tồn tại hay không</li>
<li>Trường của bảng có tồn tại hay không</li>
<li>Tính toán cho một loại trường có thể không (ví dụ: bạn không thể so sánh số nguyên với chuỗi, bạn không thể sử dụng hàm substring() cho một số nguyên)</li>
</ul>
<p>Tiếp theo, trình phân tích cú pháp kiểm tra xem bạn có quyền đọc (hoặc viết) bảng trong truy vấn hay không. Nhấn mạnh một lần nữa: các quyền này được cấp phát bởi DBA.</p>
<p>Trong quá trình phân tích cú pháp, truy vấn SQL được chuyển đổi thành đại diện nội bộ (internal representation) (thường là một cây).</p>
<p>Nếu mọi thứ đều ổn, đại diện nội bộ được gửi đến trình viết lại truy vấn.</p>
<h3>Trình viết lại truy vấn bộ (Query Rewriter)</h3>
<p>Ở bước này, tôi đã có một đại diện nội bộ của truy vấn, mục tiêu của trình viết lại là:</p>
<ul>
<li>Truy vấn được tối ưu hóa trước</li>
<li>Tránh các tính toán không cần thiết</li>
<li>Giúp trình tối ưu hóa tìm ra giải pháp tốt nhất hợp lý</li>
</ul>
<p>Trình viết lại thực hiện kiểm tra truy vấn theo một tập hợp các quy tắc đã biết. Nếu truy vấn phù hợp với một quy tắc của một mẫu, truy vấn sẽ được viết lại theo quy tắc này. Dưới đây là danh sách không đầy đủ các quy tắc (tùy chọn):</p>
<ul>
<li><strong>Hợp nhất view</strong>: Nếu bạn sử dụng view trong truy vấn của mình, view sẽ được chuyển đổi thành mã SQL của nó.</li>
<li><strong>Làm phẳng truy vấn con</strong>: Truy vấn con rất khó tối ưu hóa, vì vậy trình viết lại sẽ cố gắng loại bỏ truy vấn con
<ul>
<li>Ví dụ:</li>
</ul>
</li>
</ul>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> PERSON.*</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> PERSON</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#D19A66;--shiki-dark:#D19A66"> PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">person_key</span><span style="color:#C678DD;--shiki-dark:#C678DD"> IN</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#D19A66;--shiki-dark:#D19A66"> MAILS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">person_key</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> MAILS</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#D19A66;--shiki-dark:#D19A66"> MAILS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">mail</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LIKE</span><span style="color:#98C379;--shiki-dark:#98C379"> 'christophe%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>sẽ được chuyển đổi thành:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> PERSON.*</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> PERSON, MAILS</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#D19A66;--shiki-dark:#D19A66"> PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">person_key</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> MAILS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">person_key</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">and</span><span style="color:#D19A66;--shiki-dark:#D19A66"> MAILS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">mail</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LIKE</span><span style="color:#98C379;--shiki-dark:#98C379"> 'christophe%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><ul>
<li><strong>Loại bỏ các toán tử không cần thiết</strong>: Ví dụ: nếu bạn sử dụng DISTINCT và bạn thực sự có các ràng buộc UNIQUE (điều này ngăn chặn sự trùng lặp dữ liệu), từ khóa DISTINCT sẽ bị xóa.</li>
<li><strong>Loại trừ các JOIN dư thừa</strong>: Nếu cùng một điều kiện JOIN xảy ra hai lần, chẳng hạn như điều kiện JOIN ẩn trong view hoặc JOIN vô dụng phát sinh từ khả năng truyền, chúng sẽ bị loại bỏ.</li>
<li><strong>Hằng số tính toán gán</strong>: Nếu truy vấn của bạn cần tính toán, tính toán được thực hiện một lần trong quá trình viết lại. Ví dụ: WHERE AGE &gt; 10+2 được chuyển đổi sang WHERE AGE &gt; 12 và TODATE ("date string") được chuyển đổi sang giá trị ngày ở định dạng datetime.</li>
<li><strong>(Nâng cao) Cắt phân vùng (Partition Pruning):</strong> Nếu bạn sử dụng bảng phân vùng, trình viết lại có thể tìm thấy phân vùng bạn cần sử dụng.</li>
<li><strong>(Nâng cao) view vật lý (Materialized view rewrite):</strong> Nếu bạn có view vật lý phù hợp với một tập hợp con của vị ngữ truy vấn, trình viết lại sẽ kiểm tra xem view có được cập nhật và sửa đổi truy vấn hay không, cho phép truy vấn sử dụng view vật lý thay vì bảng gốc.</li>
<li><strong>(Nâng cao) Quy tắc tùy chỉnh:</strong> Nếu bạn có các quy tắc tùy chỉnh để sửa đổi truy vấn (giống như Oracle policy), trình viết lại sẽ thực hiện các quy tắc này.</li>
<li><strong>(Nâng cao) Chuyển đổi OLAP:</strong> chức năng phân tích / cửa sổ, star join, chức năng ROLLUP … Chuyển đổi xảy ra (nhưng tôi không chắc chắn điều này được thực hiện bởi trình viết lại hoặc trình tối ưu hóa, vì cả hai quá trình được liên kết chặt chẽ và phải xem cơ sở dữ liệu là gì).</li>
</ul>
<p>Truy vấn sau khi viết lại tiếp tục được gửi đến trình tối ưu hóa, tại thời điểm này niềm vui bắt đầu.</p>
<h3>Thống kê</h3>
<blockquote>
<p>Trước khi nghiên cứu cách cơ sở dữ liệu tối ưu hóa truy vấn. chúng ta cần nói về thống kê, vì <strong>cơ sở dữ liệu không có số liệu thống kê là ngu ngốc</strong>. Cơ sở dữ liệu không phân tích dữ liệu của riêng bạn trừ khi bạn nói ra rõ ràng. Không có phân tích nào có thể khiến cơ sở dữ liệu đưa ra các giả định (rất) kém.</p>
</blockquote>
<p>Tuy nhiên, cơ sở dữ liệu cần loại thông tin nào?</p>
<p>Tôi phải nói (ngắn gọn) về cách cơ sở dữ liệu và hệ điều hành lưu dữ liệu. Đơn vị nhỏ nhất được sử dụng cho cả hai được gọi là trang hoặc khối (mặc định 4 hoặc 8 KB). Điều này có nghĩa là nếu bạn chỉ cần 1KB, bạn cũng sẽ chiếm một trang. Nếu kích thước của trang là 8KB, bạn lãng phí 7KB.</p>
<p>Quay lại và tiếp tục nói về thống kê! Khi bạn yêu cầu cơ sở dữ liệu thu thập số liệu thống kê, cơ sở dữ liệu tính toán các giá trị sau:</p>
<ul>
<li>Số lượng hàng và trang trong bảng</li>
<li>Trong mỗi cột trong bảng:
<ul>
<li>Giá trị duy nhất</li>
<li>Độ dài dữ liệu (tối thiểu, tối đa, trung bình)</li>
<li>Phạm vi dữ liệu (tối thiểu, tối đa, trung bình)</li>
</ul>
</li>
<li>Thông tin chỉ mục của bảng</li>
</ul>
<p><strong>Các số liệu thống kê này giúp trình tối ưu hóa ước tính Disk I/O, CPU và sử dụng bộ nhớ cần thiết cho truy vấn</strong></p>
<p>Thống kê cho mỗi cột là rất quan trọng. Ví dụ: nếu một bảng PERSON cần phải được JOIN với 2 cột: LAST_NAME, FIRST_NAME. Theo thống kê, cơ sở dữ liệu biết rằng FIRST_NAME chỉ có 1.000 giá trị khác nhau và LAST_NAME có 1.000.000 giá trị khác nhau. Vì vậy, cơ sở dữ liệu được JOIN theo LAST_NAME, FIRST_NAME. Bởi vì LAST_NAME không có khả năng lặp lại, so sánh 2, 3 ký tự đầu tiên của LAST_NAME là đủ trong hầu hết các trường hợp, điều này sẽ làm giảm đáng kể số lần so sánh.</p>
<p>Tuy nhiên, đây chỉ là những số liệu thống kê cơ bản. Bạn có thể yêu cầu cơ sở dữ liệu làm một số liệu thống kê nâng cao được gọi là histogram. Histogram là số liệu thống kê về phân phối giá trị cột. Ví dụ:</p>
<ul>
<li>Các giá trị xuất hiện thường xuyên nhất</li>
<li>Phân vị (quantiles)</li>
<li>…</li>
</ul>
<p>Các số liệu thống kê bổ sung này giúp cơ sở dữ liệu tìm thấy kế hoạch truy vấn tốt hơn, đặc biệt là đối với các vị ngữ phương trình (ví dụ: WHERE AGE = 18) hoặc vị ngữ phạm vi (ví dụ: WHERE AGE &gt; 10 và AGE &lt; 40) vì cơ sở dữ liệu có thể hiểu rõ hơn về các dòng dữ liệu loại số liên quan đến các vị ngữ này (Lưu ý: Tên kỹ thuật của khái niệm này được gọi là tỷ lệ chọn).</p>
<p>Số liệu thống kê được lưu trữ trong siêu dữ liệu cơ sở dữ liệu, chẳng hạn như vị trí thống kê của bảng (không phân vùng):</p>
<ul>
<li>Oracle: USER / ALL / DBA_TABLES và USER / ALL / DBA_TAB_COLUMNS</li>
<li>DB2： SYSCAT. TABLES và SYSCAT. COLUMNS</li>
</ul>
<p><strong>Số liệu thống kê phải được cập nhật kịp thời</strong>. Nếu một bảng có 1.000.000 hàng và cơ sở dữ liệu nghĩ rằng nó chỉ có 500 hàng, không có gì tồi tệ hơn thế. Nhược điểm duy nhất của thống kê là cần có thời gian để tính toán, đó là lý do tại sao hầu hết các cơ sở dữ liệu không tự động tính toán số liệu thống kê theo mặc định. Khi dữ liệu đạt đến một triệu cấp độ thống kê trở nên khó khăn, tại thời điểm này, bạn có thể chọn chỉ làm số liệu thống kê cơ bản hoặc thực hiện thống kê trên một mẫu cơ sở dữ liệu.</p>
<p>Ví dụ, một dự án mà cần phải xử lý hàng trăm triệu dữ liệu trên mỗi bảng và tôi đã chọn chỉ thống kê 10%, dẫn đến tiêu thụ thời gian rất lớn. Ví dụ này chứng minh rằng đây là một quyết định tồi vì đôi khi 10% oracle 10G được chọn từ một cột cụ thể của một bảng cụ thể rất khác so với tất cả 100% (điều này hiếm khi xảy ra đối với các bảng có 100 triệu hàng dữ liệu). Số liệu thống kê sai này đã dẫn đến một truy vấn được cho là 30 giây để hoàn thành cuối cùng được thực hiện trong tám giờ, quá trình tìm kiếm nguyên nhân gốc rễ của hiện tượng này là một cơn ác mộng. Ví dụ này cho thấy tầm quan trọng của thống kê.</p>
<blockquote>
<p>Lưu ý: Tất nhiên, mỗi cơ sở dữ liệu có số liệu thống kê cụ thể và cao hơn. Nếu bạn muốn biết thêm thông tin, hãy đọc tài liệu về cơ sở dữ liệu. Mặc dù vậy, tôi đã cố gắng hết sức để hiểu làm thế nào số liệu thống kê được sử dụng, và tài liệu chính thức tốt nhất tôi tìm thấy đến từ PostgreSQL.</p>
</blockquote>
<h3>Trình tối ưu hóa truy vấn (Query optimizer)</h3>
<blockquote>
<p>Tất cả các cơ sở dữ liệu hiện đại đang <strong>tối ưu hóa truy vấn với tối ưu hóa dựa trên chi phí</strong>, tức là <strong>cost-based optimization - CBO</strong>. Sự thật là thiết lập một chi phí cho mỗi tính toán, bằng cách áp dụng một loạt các tính toán chi phí thấp nhất, để tìm cách tốt nhất để giảm chi phí truy vấn.</p>
</blockquote>
<p>Để hiểu các nguyên tắc của trình tối ưu hóa chi phí, tôi nghĩ rằng nó là tốt hơn để sử dụng một ví dụ để "cảm nhận" sự phức tạp đằng sau nhiệm vụ này. Ở đây tôi sẽ đưa ra 3 cách để kết nối 2 bảng và chúng ta sẽ sớm thấy rằng ngay cả một truy vấn nối đơn giản là một cơn ác mộng đối với trình tối ưu hóa. Sau đó, chúng ta sẽ tìm hiểu cách trình tối ưu hóa thực sự hoạt động.</p>
<p><strong>Đối với các hoạt động JOIN, tôi sẽ tập trung vào độ phức tạp thời gian của chúng, tuy nhiên, trình tối ưu hóa cơ sở dữ liệu tính toán chi phí CPU, chi phí Disk I/O và yêu cầu bộ nhớ của chúng</strong>. Sự khác biệt giữa độ phức tạp thời gian và chi phí CPU là chi phí thời gian là một xấp xỉ (được chuẩn bị cho một kẻ lười biếng như tôi). Và chi phí CPU, tôi bao gồm tất cả các tính toán ở đây, chẳng hạn như: cộng, phán đoán điều kiện, nhân, lặp lại … Ngoài ra, những gì khác:</p>
<p>Mỗi hoạt động high-level code yêu cầu một số lượng cụ thể của các hoạt động CPU low-level.</p>
<p>Đối với Intel Core i7, Intel Pentium 4, AMD Opteron… Vv, (xét chu kỳ CPU), chi phí hoạt động của CPU là khác nhau, có nghĩa là nó phụ thuộc vào kiến trúc của CPU.</p>
<p>Sử dụng độ phức tạp thời gian dễ dàng hơn nhiều (ít nhất là đối với tôi), và sử dụng nó tôi cũng có thể tìm hiểu về khái niệm CBO. Vì Disk I/O là một khái niệm quan trọng, thỉnh thoảng tôi cũng đề cập đến nó. Hãy nhớ rằng <strong>hầu hết thời gian thắt cổ chai là Disk I/O thay vì sử dụng CPU</strong>.</p>
<h4>Chỉ mục (Index)</h4>
<blockquote>
<p>Khi nghiên cứu [[B Tree]], tôi đã nói về Index, hãy nhớ rằng các chỉ số đã được sắp xếp.</p>
</blockquote>
<p>Chỉ để tham khảo: Ngoài ra còn có các loại chỉ mục khác, chẳng hạn như bitmap index, không giống như chi phí của chỉ mục B+ Tree về CPU, Disk I/O và bộ nhớ.</p>
<p>Ngoài ra, nhiều cơ sở dữ liệu hiện đại để cải thiện chi phí thực thi truy vấn, chỉ có thể tự động tạo chỉ mục tạm thời cho các truy vấn hiện tại.</p>
<h4>Đường dẫn truy cập (access path)</h4>
<p>Trước khi áp dụng toán tử liên kết (join), trước tiên bạn cần lấy dữ liệu. Dưới đây là cách để có được dữ liệu.</p>
<p>Lưu ý: Vì vấn đề thực sự với tất cả các đường dẫn truy cập là Disk I/O, tôi sẽ không nói quá nhiều về độ phức tạp thời gian.</p>
<ul>
<li>Quét đầy đủ (full scan)</li>
</ul>
<p>Nếu bạn đã đọc kế hoạch thực thi, bạn chắc chắn đã thấy từ "quét đầy đủ" (hoặc chỉ quét'). Nói một cách đơn giản, quét đầy đủ là cơ sở dữ liệu đọc đầy đủ một bảng hoặc chỉ mục. Đối với Disk I/O, rõ ràng là quét bảng đầy đủ có chi phí cao hơn so với quét đầy đủ chỉ mục.</p>
<ul>
<li>Quét phạm vi</li>
</ul>
<p>Các loại quét khác được quét theo chỉ mục, chẳng hạn như khi bạn sử dụng vị ngữ <code>WHERE AGE &gt; 20 AND AGE &lt; 40</code></p>
<p>Tất nhiên, bạn cần phải có chỉ mục trên trường <code>AGE</code> để quét phạm vi chỉ mục.</p>
<p>Trong phần đầu tiên, chúng ta đã biết rằng chi phí thời gian của truy vấn phạm vi là khoảng <code>log(N) + M</code>, ở đây N là khối lượng dữ liệu được chỉ mục và M là số dòng được ước tính trong phạm vi. Nhờ thống kê, chúng ta mới có thể biết giá trị của N và M (Lưu ý: M là vị ngữ <code>AGE &gt; 20 AND AGE &lt; 40</code>). Ngoài ra, bạn không cần phải đọc toàn bộ chỉ mục khi quét phạm vi, vì vậy nó không tốn kém như quét đầy đủ trên Disk I/O.</p>
<ul>
<li>Quét duy nhất</li>
</ul>
<p>Nếu bạn chỉ cần lấy một giá trị từ chỉ mục, bạn có thể quét duy nhất.</p>
<ul>
<li>Truy cập theo ROW ID</li>
</ul>
<p>Trong hầu hết các trường hợp, nếu cơ sở dữ liệu sử dụng chỉ mục, nó phải tìm các hàng liên quan đến chỉ mục, điều này sẽ được sử dụng theo cách truy cập dựa trên ROW ID.</p>
<p>Ví dụ: nếu bạn chạy:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> LASTNAME, FIRSTNAME </span><span style="color:#C678DD;--shiki-dark:#C678DD">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> PERSON </span><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> AGE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 28</span></span></code></pre>
</div><p>Nếu cột <code>age</code> của bảng <code>person</code> có chỉ mục, trình tối ưu hóa sẽ sử dụng chỉ mục để tìm mọi người ở tất cả các lứa tuổi 28, sau đó nó sẽ đi vào bảng để đọc các hàng có liên quan, đó là bởi vì chỉ có thông tin age trong chỉ mục và bạn muốn họ và tên.</p>
<p>Tuy nhiên, nếu bạn thực hiện một cách tiếp cận khác:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#D19A66;--shiki-dark:#D19A66"> TYPE_PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">CATEGORY</span><span style="color:#C678DD;--shiki-dark:#C678DD"> from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> PERSON, TYPE_PERSON</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#D19A66;--shiki-dark:#D19A66"> PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">AGE</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> TYPE_PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">AGE</span></span></code></pre>
</div><p>Chỉ mục của bảng <code>PERSON</code> được sử dụng để kết nối bảng <code>TYPE_PERSON</code>, nhưng bảng <code>PERSON</code> không được truy cập dựa trên ROW ID vì bạn không yêu cầu thông tin trong bảng đó.</p>
<p>Mặc dù phương pháp này hoạt động tốt ở một lượng nhỏ truy cập, vấn đề thực sự với hoạt động này thực sự là Disk I/O. Nếu cần rất nhiều truy cập dựa trên ROW ID, cơ sở dữ liệu có thể chọn quét đầy đủ.</p>
<ul>
<li>Đường dẫn khác</li>
</ul>
<p>Tôi không liệt kê tất cả các đường dẫn truy cập và bạn có thể đọc tài liệu Oracle nếu bạn quan tâm. Các cơ sở dữ liệu khác có thể được gọi khác nhau nhưng các khái niệm đằng sau nó là như nhau.</p>
<h4>Phép kết nối (join)</h4>
<blockquote>
<p>Bây giờ chúng ta đã biết làm thế nào để có được dữ liệu, sau đó kết nối chúng ngay !</p>
</blockquote>
<p>Những gì tôi muốn trình bày là ba phép kết nối phổ biến: Merge Join, Hash Join và Nested Loop Join. Nhưng trước đó, tôi cần phải giới thiệu một từ mới: quan hệ bên trong và bên ngoài (inner relation and outer relation) có thể là:</p>
<ul>
<li>Một bảng</li>
<li>Một chỉ mục</li>
<li>Kết quả trung gian của phép tính trước đó (ví dụ: kết quả của các phép kết nối trước đó)</li>
</ul>
<p>Khi bạn kết nối hai quan hệ, thuật toán kết nối xử lý hai quan hệ là khác nhau. Trong phần còn lại của bài viết này, tôi sẽ giả định:</p>
<ul>
<li>Quan hệ bên ngoài là tập dữ liệu bên trái</li>
<li>Quan hệ bên trong là tập dữ liệu bên phải</li>
</ul>
<p>Ví dụ: A JOIN B là kết nối giữa A và B, Ở đây A là quan hệ bên ngoài và B là quan hệ bên trong.</p>
<p>Trong hầu hết các trường hợp, <strong>chi phí của A JOIN B khác với chi phí của B JOIN A</strong>.</p>
<p>Trong phần này, tôi cũng sẽ giả định rằng quan hệ bên ngoài có một yếu tố N và quan hệ bên trong có yếu tố M. Hãy nhớ rằng trình tối ưu hóa thực sự biết giá trị của N và M thông qua thống kê.</p>
<p>Lưu ý: N và M là lực lượng của quan hệ.</p>
<h5>Nested Loop Join</h5>
<blockquote>
<p>Nested Loop Join là đơn giản nhất.</p>
</blockquote>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604200445.png" alt="Pasted image 20230604200445" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604200445</figcaption></figure>
<p>Dưới đây là một số lý do:</p>
<ul>
<li>Đối với mỗi dòng của quan hệ bên ngoài, xem tất cả các hàng trong quan hệ bên trong để tìm các hàng phù hợp</li>
</ul>
<p>Dưới đây là mã giả:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">nested_loop_join</span><span style="color:#E06C75;--shiki-dark:#E06C75">(array outer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> array inner)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> each row a in outer</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> each row b in inner</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">      if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">match_join_condition</span><span style="color:#E06C75;--shiki-dark:#E06C75">(a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75">b))</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        write_result_in_output</span><span style="color:#E06C75;--shiki-dark:#E06C75">(a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75">b)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      end </span><span style="color:#C678DD;--shiki-dark:#C678DD">if</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    end </span><span style="color:#C678DD;--shiki-dark:#C678DD">for</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">   end </span><span style="color:#C678DD;--shiki-dark:#C678DD">for</span></span></code></pre>
</div><p>Vì đây là một lần lặp kép, <strong>độ phức tạp thời gian là <code>O(N*M)</code></strong>.</p>
<p>Về phía Disk I/O, vòng lặp bên trong yêu cầu đọc M hàng từ quan hệ bên trong với mỗi hàng trong N hàng của quan hệ bên ngoài. Thuật toán này yêu cầu đọc <code>N + N * M</code> hàng từ disk. Tuy nhiên, nếu quan hệ bên trong đủ nhỏ để bạn có thể đọc nó vào bộ nhớ, chỉ có <code>M + N</code> lần đọc. Sau khi sửa đổi như vậy, quan hệ bên trong phải là tối thiểu vì nó có nhiều cơ hội hơn để nạp vào bộ nhớ.</p>
<p>Không có sự khác biệt về chi phí CPU, nhưng về Disk I/O thì tốt nhất là mỗi quan hệ chỉ đọc một lần.</p>
<p>Tất nhiên, quan hệ bên trong có thể được thay thế bằng chỉ mục và thuận lợi hơn cho Disk I/O.</p>
<p>Vì thuật toán này rất đơn giản, phiên bản sau đây có lợi hơn cho Disk I/O khi quan hệ bên trong quá lớn để nạp vào bộ nhớ. Dưới đây là một số lý do:</p>
<ul>
<li>Để tránh đọc hai quan hệ từng dòng</li>
<li>Bạn có thể đọc chúng, lưu hai dòng dữ liệu (được đọc trong hai quan hệ) vào bộ nhớ,</li>
<li>So sánh hai cụm dữ liệu, giữ lại các cặp thoả mãn</li>
<li>Sau đó tải các cụm dữ liệu mới từ đĩa để tiếp tục so sánh</li>
<li>Cho đến khi tất cả dữ liệu được nạp.</li>
</ul>
<p>Thuật toán có thể như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// improved version to reduce the disk I/O.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">nested_loop_join_v2</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file outer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file inner)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> each bunch ba in outer</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // ba is now in memory</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> each bunch bb in inner</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // bb is now in memory</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> each row a in ba</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">          for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> each row b in bb</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">match_join_condition</span><span style="color:#E06C75;--shiki-dark:#E06C75">(a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75">b))</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              write_result_in_output</span><span style="color:#E06C75;--shiki-dark:#E06C75">(a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75">b)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">            end </span><span style="color:#C678DD;--shiki-dark:#C678DD">if</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          end </span><span style="color:#C678DD;--shiki-dark:#C678DD">for</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">       end </span><span style="color:#C678DD;--shiki-dark:#C678DD">for</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    end </span><span style="color:#C678DD;--shiki-dark:#C678DD">for</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">   end </span><span style="color:#C678DD;--shiki-dark:#C678DD">for</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Với phiên bản này, độ phức tạp thời gian không thay đổi, nhưng truy cập disk giảm</strong>:</p>
<ul>
<li>Với phiên bản trước, thuật toán yêu cầu truy cập <code>N + N * M</code> lần (một dòng cho mỗi truy cập).</li>
<li>Với phiên bản mới, truy cập đĩa trở thành số lượng cụm dữ liệu quan hệ bên ngoài + số lượng cụm dữ liệu quan hệ bên ngoài * Số lượng cụm dữ liệu cho quan hệ bên trong.</li>
<li>Tăng kích thước của các cụm dữ liệu có thể làm giảm truy cập disk.</li>
</ul>
<h5>Hash Join</h5>
<p>Hash Join phức tạp hơn, nhưng trong nhiều trường hợp, chi phí thấp hơn so với Nested Loop Join.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604203453.png" alt="Pasted image 20230604203453" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604203453</figcaption></figure>
<p>Nguyên tắc của Hash Join là:</p>
<ul>
<li>Đọc tất cả các hàng của quan hệ bên trong</li>
<li>Xây dựng một bảng băm (hash table) trong bộ nhớ</li>
<li>Đọc từng hàng của quan hệ bên ngoài + (sử dụng hàm băm (hash function) của bảng băm (hash table)) để tính toán giá trị băm (hash value) của mỗi hàng để tìm bên trong thùng băm (hash bucket) có liên quan trong quan hệ bên trong</li>
<li>Xác định có khớp với các hàng của quan hệ bên ngoài hay không?</li>
</ul>
<p>Về độ phức tạp của thời gian, tôi cần phải đưa ra một số giả định để đơn giản hóa vấn đề:</p>
<ul>
<li>quan hệ bên trong được chia thành X thùng băm</li>
<li>Hàm băm phân phối gần như đồng đều giá trị băm của dữ liệu trong mỗi quan hệ, có nghĩa là kích thước thùng băm là như nhau.</li>
<li>Các yếu tố của quan hệ bên ngoài phù hợp với tất cả các yếu tố trong thùng băm, với chi phí là số lượng các hàng trong thùng băm.</li>
</ul>
<p>Độ phức tạp thời gian là <code>(M/X) * N + chi phí tạo bảng băm (M) + chi phí hàm băm * N</code>. Nếu hàm băm tạo ra thùng băm đủ nhỏ, độ phức tạp là <code>O(M+N)</code>.</p>
<p>Ngoài ra còn có một phiên bản Hash Join, có lợi cho bộ nhớ nhưng không đủ tốt cho disk I/O. Lần này nó trông như thế này:</p>
<ul>
<li>Tính toán bảng băm của cả hai quan hệ bên trong và bên ngoài</li>
<li>Lưu bảng băm vào disk</li>
<li>Sau đó so sánh từng thùng băm (một trong số đó được đọc vào bộ nhớ và đọc từng dòng khác).</li>
</ul>
<h5>Merge Join</h5>
<blockquote>
<p>Merge Join là thuật toán liên kết duy nhất tạo ra sắp xếp.</p>
</blockquote>
<p>Lưu ý: Merge Join đơn giản này không phân biệt giữa bảng bên trong hoặc bề ngoài. Hai bảng đóng cùng một vai trò. Nhưng thực sự thực hiện theo những cách khác nhau, chẳng hạn như khi xử lý các giá trị trùng lặp.</p>
<ul>
<li>
<ol>
<li>(Tùy chọn) Hoạt động sắp xếp các kết hợp (join): cả hai nguồn đầu vào được sắp xếp theo từ khóa được liên kết.</li>
</ol>
</li>
<li>
<ol start="2">
<li>Hoạt động hợp nhất các kết hợp : các nguồn đầu vào đã được sắp xếp được hợp nhất với nhau.</li>
</ol>
</li>
<li>
<p><strong>Sort</strong></p>
</li>
</ul>
<p>Tôi đã nói về [[Merge Sort]], là một thuật toán sắp xếp tốt (nhưng không phải là tốt nhất, hoặc hash Join tốt hơn nếu bộ nhớ là đủ).</p>
<p>Tuy nhiên, đôi khi tập dữ liệu đã được sắp xếp, chẳng hạn như:</p>
<ul>
<li>
<p>Nếu bên trong bảng có thứ tự, chẳng hạn như một bảng có chỉ mục trong điều kiện nối (index-organized table)</p>
</li>
<li>
<p>Nếu quan hệ là một chỉ mục trong điều kiện kết nối</p>
</li>
<li>
<p>Nếu phép kết nối áp dụng với kết quả trung gian mà đã được sắp xếp trong một truy vấn</p>
</li>
<li>
<p><strong>Merge Join</strong></p>
</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604205032.png" alt="Pasted image 20230604205032" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604205032</figcaption></figure>
<p>Phần này rất giống với các hoạt động hợp nhất trong merge sort. Nhưng lần này, tôi không chọn tất cả các yếu tố từ hai quan hệ, nhưng chỉ chọn cùng một yếu tố. Sự thật là như sau:</p>
<ol>
<li>Trong hai quan hệ, so sánh các yếu tố hiện tại (hiện tại = lần đầu tiên xuất hiện)</li>
<li>Nếu giống nhau, đưa cả hai yếu tố vào kết quả và so sánh yếu tố tiếp theo trong cả hai quan hệ</li>
<li>Nếu khác nhau, hãy tìm yếu tố tiếp theo trong quan hệ với các yếu tố nhỏ nhất (vì yếu tố tiếp theo có thể phù hợp)</li>
<li>Lặp lại các bước 1, 2, 3 cho đến khi yếu tố cuối cùng của một trong các quan hệ.</li>
</ol>
<p>Bởi vì cả hai quan hệ đã được sắp xếp, bạn không cần phải "nhìn lại", vì vậy phương pháp này có hiệu quả.</p>
<p>Đây đơn giản là kĩ thuật two pointer, duyệt trên hai mảng đã sắp xếp.</p>
<p>Thuật toán là một phiên bản đơn giản vì nó không xử lý các tình huống xảy dữ liệu trùng (tức là nhiều kết hợp) trên cùng mảng trong cả hai mảng. Phiên bản thực tế phức tạp hơn, vì vậy tôi đã chọn phiên bản đơn giản hóa.</p>
<p>Nếu cả hai quan hệ đã được sắp xếp, độ phức tạp của thời gian là <code>O(N+M)</code></p>
<p>Nếu hai quan hệ cần được sắp xếp, độ phức tạp thời gian là chi phí sắp xếp hai quan hệ: <code>O(N*Log(N) + M*Log(M))</code></p>
<h5>Thuật toán nào là tốt nhất?</h5>
<p>Nếu có tốt nhất, không cần phải làm cho nhiều loại như vậy. Câu hỏi này là khó, bởi vì nhiều yếu tố cần xem xét, chẳng hạn như:</p>
<ul>
<li><strong>Bộ nhớ nhàn rỗi</strong>: Nếu bạn không có đủ bộ nhớ, hãy chọn Hash Join (ít nhất là hoàn toàn trong bộ nhớ).</li>
<li><strong>Kích thước của cả hai tập dữ liệu</strong>. Ví dụ, nếu một bảng lớn nối một bảng nhỏ, thì Nested Loop Join nhanh hơn so với Hash Join, vì sau này có chi phí cao để tạo ra bảng băm; Nếu cả hai bảng đều rất lớn, Nested Loop Join có chi phí cpu rất cao.</li>
<li><strong>Nếu có chỉ mục</strong>: Nếu có hai chỉ mục B+ Tree, lựa chọn thông minh dường như là Merge Join.</li>
<li><strong>Kết quả có cần phải được sắp xếp hay không?</strong>: Ngay cả khi bạn đang sử dụng một tập dữ liệu chưa được sắp xếp, mặc dù có chi phí cao hơn (vì phải sắp xếp) nhưng bạn có thể vẫn muốn sử dụng Merge Join nếu sau khi có được kết quả được sắp xếp, bạn có thể liên kết nó với một Merge Join khác (hoặc có thể vì truy vấn yêu cầu kết quả sắp xếp ngầm hoặc rõ ràng với các thao tác như ORDER BY/GROUP BY/DISTINCT).</li>
<li><strong>Quan hệ đã được sắp xếp:</strong> Tại thời điểm này, Merge Join là lựa chọn tốt nhất.</li>
<li><strong>Loại kết nối</strong>: Là kết nối tương đương (ví dụ: tableA.col1 = tableB.col2)? Hoặc Inner Join? Outer Join? Cartesian Join? Hoặc Self Join? Một số kết nối không hoạt động trong một môi trường cụ thể.</li>
<li><strong>Phân phối dữ liệu</strong>: Nếu dữ liệu về điều kiện kết nối là lệch (ví dụ: để kết nối người với họ (lastname), nhưng nhiều người có cùng họ), Hash Join sẽ là một thảm họa vì hàm băm sẽ tạo ra thùng băm phân bố rất không đồng đều.</li>
<li>Nếu bạn muốn các hoạt động kết nối sử dụng <strong>đa luồng hoặc đa tiến trình</strong>.</li>
</ul>
<p>Để biết thêm thông tin, bạn có thể đọc tài liệu cho DB2, ORACLE hoặc SQL Server.</p>
<h4>Ví dụ đơn giản</h4>
<p>Chúng tôi đã nghiên cứu 3 loại phép kết nối. Bây giờ, ví dụ, chúng ta sẽ kết nối 5 bảng để có được tất cả thông tin của một người. Một người có thể có:</p>
<ul>
<li>Nhiều số điện thoại di động (MOBILES)</li>
<li>Nhiều hộp thư (MAILS)</li>
<li>Nhiều địa chỉ (ADRESSES)</li>
<li>Nhiều tài khoản ngân hàng (BANK_ACCOUNTS)</li>
</ul>
<p>Nói cách khác, chúng ta cần phải nhanh chóng nhận được câu trả lời với truy vấn sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> PERSON, MOBILES, MAILS, ADRESSES, BANK_ACCOUNTS</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">PERSON_ID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> MOBILES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">PERSON_ID</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">AND</span><span style="color:#D19A66;--shiki-dark:#D19A66"> PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">PERSON_ID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> MAILS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">PERSON_ID</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">AND</span><span style="color:#D19A66;--shiki-dark:#D19A66"> PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">PERSON_ID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> ADRESSES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">PERSON_ID</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">AND</span><span style="color:#D19A66;--shiki-dark:#D19A66"> PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">PERSON_ID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> BANK_ACCOUNTS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">PERSON_ID</span></span></code></pre>
</div><p>Là một trình tối ưu hóa truy vấn, tôi phải tìm cách tốt nhất để xử lý dữ liệu. Nhưng có 2 câu hỏi:</p>
<ul>
<li>Loại nào được sử dụng cho mỗi kết nối?
<ul>
<li>Tôi có 3 lựa chọn (hash, merge, nested loop) và có thể sử dụng 0, 1 hoặc 2 chỉ mục cùng lúc (không cần phải nói rằng có nhiều loại chỉ mục).</li>
</ul>
</li>
<li>Kết nối được thực hiện theo thứ tự nào?</li>
</ul>
<p>Ví dụ: hình ảnh sau đây cho thấy kế hoạch thực thi có thể được sử dụng cho 4 bảng chỉ 3 lần join:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604214715.png" alt="Pasted image 20230604214715" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604214715</figcaption></figure>
<p>Các truy vấn trong thực tế cũng có các toán tử quan hệ khác, chẳng hạn như OUTER JOIN, CROSS JOIN, GROUP BY, ORDER BY, PROJECTION, UNION, INTERSECT, DISTINCT … Điều này có nghĩa là nhiều khả năng hơn.</p>
<p><strong>Vì vậy, làm thế nào để cơ sở dữ liệu xử lý</strong>?</p>
<p><code>Dynamic Programing</code>, <code>Greedy</code> <code>Heuristic</code></p>
<h4>Dynamic Programming, Greedy, and Heuristic Algorithm</h4>
<p>Cơ sở dữ liệu quan hệ sẽ thử một số phương pháp mà tôi vừa đề cập, <strong>và công việc thực sự của trình tối ưu hóa là tìm một giải pháp tốt trong một khoảng thời gian giới hạn</strong>.</p>
<p>Hầu hết thời gian, trình tối ưu hóa không tìm thấy giải pháp tốt nhất, nhưng giải pháp có thể xem là "tốt" (đương nhiên là cũng có những lúc tốt trong ngoặc kép thật)</p>
<ul>
<li><strong>Quy hoạch động (Dynamic Programming)</strong></li>
</ul>
<blockquote>
<p>Đối với các truy vấn quy mô nhỏ, có thể áp dụng một cách tiếp cận trâu (brute-force). Nhưng để các truy vấn quy mô trung bình cũng có thể được thực hiện một cách tiếp cận trâu, chúng tôi có một cách để tránh các tính toán không cần thiết, đó là quy hoạch động.</p>
</blockquote>
<p>Ý tưởng đằng sau những từ này là nhiều kế hoạch thực hiện rất giống nhau. Hãy xem các kế hoạch dưới đây:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604215931.png" alt="Pasted image 20230604215931" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604215931</figcaption></figure>
<p>Tất cả chúng đều có cùng một cây con (A JOIN B), vì vậy bạn không cần phải tính toán chi phí của cây con này trong mỗi kế hoạch, tính toán một lần, lưu kết quả và tái sử dụng khi gặp lại cây con này. Theo cách nói chính thức hơn, chúng ta đang phải đối mặt với một vấn đề chồng chéo. Để tránh tính toán trùng lặp một số kết quả, chúng tôi sử dụng phương pháp ghi nhớ.</p>
<p>Áp dụng kĩ thuật này, chúng tôi không còn độ phức tạp <code>(2*N)!/(N+1)!</code>, nhưng "chỉ" <code>3^N</code>. Trong ví dụ 4 JOIN trên, điều này có nghĩa là giảm số lần sắp xếp từ 336 xuống còn 81 lần. Nếu đó là một truy vấn lớn hơn, chẳng hạn như 8 JOIN (thực sự không phải là rất lớn), giảm 57.657.600 xuống còn 6.551.</p>
<p>Đối với các truy vấn quy mô lớn, bạn cũng có thể sử dụng các phương pháp quy hoạch động, nhưng kèm với các quy tắc bổ sung(hoặc thuật toán heuristics) để giảm khả năng.</p>
<ul>
<li>Nếu chúng ta chỉ phân tích một loại kế hoạch cụ thể (ví dụ: cây sâu bên trái left-deep tree), chúng ta sẽ nhận được <code>n*2^n</code> thay vì <code>3^n</code>.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604220538.png" alt="Pasted image 20230604220538" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604220538</figcaption></figure>
<ul>
<li>
<p>Nếu chúng ta thêm các quy tắc hợp lý để tránh kế hoạch cho một số mô hình (ví dụ: 'nếu một bảng có chỉ mục cho các vị ngữ được chỉ định, không cố gắng merge join với bảng, nhưng với chỉ mục), chúng ta sẽ giảm số lượng khả năng mà không gây ra thiệt hại quá mức cho kịch bản tốt nhất.</p>
</li>
<li>
<p>Nếu chúng ta thêm các quy tắc vào quá trình (chẳng hạn như các hoạt động kết nối trước tất cả các tính toán quan hệ khác), chúng ta cũng có thể giảm đáng kể khả năng.</p>
</li>
<li>
<p>……</p>
</li>
<li>
<p><strong>Thuật toán tham lam (Greed Alogrithm)</strong></p>
</li>
</ul>
<blockquote>
<p>Tuy nhiên, trình tối ưu hóa phải đối mặt với một truy vấn rất lớn, hoặc để tìm câu trả lời càng sớm càng tốt (tuy nhiên tốc độ truy vấn không nhanh), một thuật toán khác, được gọi là thuật toán tham lam.</p>
</blockquote>
<p>Nguyên tắc là lập kế hoạch truy vấn theo một quy tắc (hoặc heuristic) một cách dần dần. Theo quy tắc này, các thuật toán tham lam dần dần tìm kiếm các thuật toán tốt nhất, xử lý một JOIN đầu tiên, sau đó thêm một JOIN mới theo cùng một quy tắc cho mỗi bước.</p>
<p>Hãy xem xét một ví dụ đơn giản. Ví dụ, một truy vấn JOIN cho 5 bảng (A, B, C, D, E) 4 lần, để đơn giản hóa việc chúng tôi sử dụng JOIN lồng nhau như một phương pháp kết nối có thể, chúng tôi làm theo quy tắc "sử dụng kết nối chi phí thấp nhất".</p>
<ul>
<li>Chọn một bắt đầu trực tiếp từ 5 bảng (ví dụ: A)</li>
<li>Tính toán mỗi kết nối với A (A là một quan hệ bên trong hoặc bên ngoài)</li>
<li>Khám phá "A JOIN B" có chi phí thấp nhất</li>
<li>Tính toán chi phí của mỗi kết quả được kết nối với <code>A JOIN B</code> (<code>A JOIN B</code> là quan hệ bên trong hoặc bên ngoài)</li>
<li>Khám phá <code>(A JOIN B) JOIN C</code> có chi phí thấp nhất</li>
<li>Tính toán chi phí của mỗi kết quả được kết hợp với <code>(A JOIN B) JOIN C</code>.</li>
<li>……</li>
<li>Hoàn thiện kế hoạch thực hiện <code>((A JOIN B) JOIN C) JOIN D ) JOIN E)</code></li>
</ul>
<p>Bởi vì chúng tôi bắt đầu một cách tùy tiện với bảng A, chúng ta có thể sử dụng cùng một thuật toán trong B, sau đó C, sau đó D, sau đó E. Cuối cùng giữ lại kế hoạch thực hiện với chi phí thấp nhất.</p>
<p>Nhân tiện, thuật toán này có một cái tên, được gọi là "Nearest Neighbor Algorithm".</p>
<p>Bỏ qua các chi tiết, chỉ cần một mô hình tốt và sắp xếp độ phức tạp <code>Nlog(N)</code>, vấn đề có thể dễ dàng được giải quyết. Độ phức tạp của thuật toán này là <code>O(Nlog(N)</code>, so sánh với <code>O(3^N)</code> của dynamic programming. Nếu bạn có một truy vấn lớn 20 JOIN, điều này có nghĩa là 26 vs 3,486,784,401, một sự khác biệt lớn!</p>
<p>Vấn đề với thuật toán này là giả định chúng tôi thực hiện là tìm cách tốt nhất để kết nối 2 bảng, giữ lại kết quả kết nối này và kết nối bảng tiếp theo để có được chi phí thấp nhất. Tuy nhiên:</p>
<ul>
<li>Ngay cả giữa A, B, C, <code>A JOIN B</code> có giá thấp nhất</li>
<li><code>(A JOIN C) JOIN B</code> có thể tốt hơn so với <code>(A JOIN B) JOIN C</code>.</li>
</ul>
<p>Để cải thiện tình trạng này, bạn có thể sử dụng các thuật toán tham lam dựa trên các quy tắc khác nhau nhiều lần và giữ lại kế hoạch thực hiện tốt nhất.</p>
<h4>Bộ nhớ cache kế hoạch truy vấn (Query Plan Cache)</h4>
<p>Vì việc tạo kế hoạch truy vấn tốn thời gian, hầu hết các cơ sở dữ liệu lưu kế hoạch trong bộ nhớ <code>query plan cache</code> để tránh tính toán trùng lặp. Chủ đề này là lớn hơn bởi vì cơ sở dữ liệu cần phải biết khi nào để cập nhật các kế hoạch lỗi thời. Cách tiếp cận là đặt giới hạn trên và nếu một bảng thay đổi thống kê vượt quá giới hạn trên, kế hoạch truy vấn về bảng sẽ bị xóa khỏi bộ nhớ cache.</p>
<h3>Trình thực thi truy vấn (Query Excuter)</h3>
<p>Ở giai đoạn này, chúng tôi có một kế hoạch thực hiện được tối ưu hóa và biên dịch thành mã thực thi. Sau đó, nếu có đủ tài nguyên (bộ nhớ, CPU), trình thực thi truy vấn sẽ thực thi nó. Các toán tử (JOIN, SORT BY …) trong kế hoạch có thể được thực hiện theo thứ tự hoặc song song, tùy thuộc vào trình thực thi. Để lấy và ghi dữ liệu, trình thực thi truy vấn tương tác với trình quản lý dữ liệu, phần tiếp theo của bài viết này thảo luận về trình quản lý dữ liệu.</p>
<h2>Trình quản lý dữ liệu</h2>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604232022.png" alt="Pasted image 20230604232022" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604232022</figcaption></figure>
<p>Ở bước này, trình quản lý truy vấn thực hiện truy vấn và yêu cầu dữ liệu từ bảng và chỉ mục. Nhưng có 2 câu hỏi:</p>
<ul>
<li>Cơ sở dữ liệu quan hệ sử dụng mô hình giao dịch, vì vậy bạn không thể có được phần dữ liệu này khi người khác sử dụng hoặc sửa đổi dữ liệu cùng một lúc.</li>
<li>Trích xuất dữ liệu là hoạt động chậm nhất trong cơ sở dữ liệu, vì vậy trình quản lý dữ liệu cần phải đủ thông minh để có được dữ liệu và lưu nó trong bộ đệm bộ nhớ.</li>
</ul>
<p>Trong phần này, chúng ta hãy xem làm thế nào cơ sở dữ liệu quan hệ xử lý cả hai vấn đề.</p>
<h3>Trình quản lý bộ nhớ cache (Cache Manager)</h3>
<blockquote>
<p>Như đã đề cập trước đó, nút thắt chai chính của cơ sở dữ liệu là Disk I/O. Để cải thiện hiệu suất, cơ sở dữ liệu hiện đại sử dụng trình quản lý bộ nhớ cache.</p>
</blockquote>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604232659.png" alt="Pasted image 20230604232659" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604232659</figcaption></figure>
<p>Trình thực thi truy vấn không lấy dữ liệu trực tiếp từ hệ thống tệp, nhưng từ trình quản lý bộ nhớ cache. Trình quản lý bộ nhớ cache có một khu vực bộ nhớ cache được gọi là vùng đệm (buffer pool), đọc dữ liệu từ bộ nhớ có thể cải thiện đáng kể hiệu suất cơ sở dữ liệu. Thật khó để đưa ra một mức độ định lượng cho điều này, bởi vì nó phụ thuộc vào những gì bạn cần:</p>
<ul>
<li>Truy cập tuần tự (ví dụ: quét đầy đủ) vs truy cập ngẫu nhiên (ví dụ: truy cập theo row id)</li>
<li>Đọc hay ghi</li>
</ul>
<p>Và loại disk được sử dụng bởi cơ sở dữ liệu:</p>
<ul>
<li>7.2k/10k/15k rpm hard drive</li>
<li>SSD</li>
<li>RAID 1/5/…</li>
</ul>
<p>Để tôi nói, bộ nhớ nhanh hơn 100 đến 100.000 lần so với disk. Tuy nhiên, điều này dẫn đến một vấn đề khác (cơ sở dữ liệu luôn luôn như vậy …), trình quản lý bộ nhớ cache cần phải có được dữ liệu trước khi Trình thực thi truy vấn sử dụng dữ liệu, nếu không trình quản lý truy vấn sẽ phải chờ đợi vì đọc dữ liệu từ disk chậm.</p>
<h4>Đọc trước (Pre-Reading)</h4>
<p>Vấn đề này được gọi <strong>đọc trước (pre-reading)</strong>. Trình thực thi truy vấn biết dữ liệu nào nó sẽ cần vì nó hiểu toàn bộ luồng truy vấn và dữ liệu trên disk thông qua thống kê. Quá trình này trông như thế này:</p>
<ul>
<li>Khi Trình thực thi truy vấn xử lý lô dữ liệu đầu tiên của nó, trình quản lý bộ nhớ cache được yêu cầu tải trước lô dữ liệu thứ hai</li>
<li>Khi bạn bắt đầu xử lý lô dữ liệu thứ hai, hãy nói với trình quản lý bộ nhớ cache để tải trước lô dữ liệu thứ ba và nói với trình quản lý bộ nhớ cache rằng lô đầu tiên có thể được xóa khỏi bộ nhớ cache.</li>
<li>……</li>
</ul>
<p>Trình quản lý bộ nhớ cache lưu tất cả dữ liệu này trong vùng đệm. Để xác định xem một dữ liệu có hữu ích hay không, trình quản lý bộ nhớ cache đã thêm thông tin bổ sung (được gọi là chốt (latch)) vào dữ liệu được lưu trong bộ nhớ cache.</p>
<p>Đôi khi Trình thực thi truy vấn không biết những gì về dữ liệu nó cần và một số cơ sở dữ liệu không cung cấp chức năng này. Thay vào đó, họ sử dụng một phương pháp đọc trước suy đoán (ví dụ: nếu Trình thực thi truy vấn muốn dữ liệu 1, 3, 5, nó có thể sẽ đọc trước 7, 9, 11) hoặc đọc trước tuần tự (tại thời điểm này trình quản lý bộ nhớ cache chỉ đơn giản là tải dữ liệu liên tục tiếp theo từ đĩa sau khi đọc một loạt dữ liệu).</p>
<p>Để theo dõi tình trạng hoạt động đọc trước, cơ sở dữ liệu hiện đại giới thiệu một thước đo được gọi là <strong>(bộ đệm / bộ nhớ cache)</strong> hay <strong>(buffer / cache)</strong> để hiển thị tần suất dữ liệu được yêu cầu được tìm thấy trong bộ nhớ cache thay vì đọc từ disk.</p>
<p>Lưu ý: Tỷ lệ trúng bộ nhớ cache (cache hit ratio) kém không phải lúc nào cũng có nghĩa là bộ nhớ cache hoạt động kém.</p>
<p>Bộ đệm chỉ là dung lượng hạn chế của bộ nhớ, vì vậy để tải dữ liệu mới khi đã đầy, nó cần phải loại bỏ một số dữ liệu. Tải và xóa bộ nhớ cache đòi hỏi một số chi phí disk và network I/O. Nếu bạn có một truy vấn được thực hiện thường xuyên, sau đó tải kết quả truy vấn mỗi lần và xóa nó, hiệu quả là quá thấp. Cơ sở dữ liệu hiện đại giải quyết vấn đề này với chính sách thay thế bộ đệm.</p>
<h4>Chính sách thay thế bộ đệm</h4>
<blockquote>
<p>Hầu hết các cơ sở dữ liệu hiện đại (ít nhất là SQL Server, MySQL, Oracle và DB2) sử dụng thuật toán LRU.</p>
</blockquote>
<h5>LRU</h5>
<p>LRU (Least Recently Used) : bỏ đi phần tử ít được sử dụng gần đây nhất. Nguyên tắc đằng sau nó: dữ liệu được giữ lại trong bộ nhớ cache được sử dụng gần đây nhất, có nhiều khả năng sẽ được tái sử dụng.</p>
<p>Hình minh họa:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604234649.png" alt="Pasted image 20230604234649" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604234649</figcaption></figure>
<p>Để hiểu rõ hơn, tôi giả định rằng dữ liệu trong bộ đệm không bị khóa bởi chốt (có nghĩa là nó có nghĩa là nó có thể được gỡ bỏ). Trong ví dụ đơn giản này, bộ đệm có thể lưu 3 thành viên:</p>
<ul>
<li>1: Trình quản lý bộ nhớ cache (CM) sử dụng dữ liệu 1 và đặt nó vào bộ đệm trống</li>
<li>2: CM sử dụng dữ liệu 4 và đặt nó vào bộ đệm</li>
<li>3: CM sử dụng dữ liệu 3 và đặt nó vào bộ đệm</li>
<li>4: CM sử dụng dữ liệu 9, bộ đệm đã đầy, vì vậy dữ liệu 1 đã bị xóa vì là lần cuối cùng nó được sử dụng gần đây là xa nhất và dữ liệu 9 được thêm vào bộ đệm</li>
<li>5: CM sử dụng dữ liệu 4, dữ liệu 4 đã ở trong bộ đệm, vì vậy nó một lần nữa trở thành phần tử được sử dụng gần đây.</li>
<li>6: CM sử dụng dữ liệu 1, bộ đệm đầy đủ, vì vậy dữ liệu 9 đã bị xóa vì là lần gần đây nhất nó được sử dụng là xa nhất và dữ liệu 1 được thêm vào bộ đệm</li>
<li>……</li>
</ul>
<p>Thuật toán này hoạt động tốt, nhưng có một số hạn chế. <strong>Điều gì sẽ xảy ra nếu bạn thực hiện quét toàn bộ trên một bảng lớn</strong>? Nói cách khác, điều gì sẽ xảy ra khi kích thước của bảng/chỉ mục vượt quá bộ đệm? Sử dụng thuật toán này sẽ xóa tất cả dữ liệu trong bộ nhớ cache trước đó và dữ liệu được quét đầy đủ có khả năng chỉ được sử dụng một lần.</p>
<h5>Cải thiện</h5>
<p>Để ngăn chặn hiện tượng này, một số cơ sở dữ liệu đã thêm các quy tắc đặc biệt, chẳng hạn như mô tả trong tài liệu Oracle:</p>
<blockquote>
<p>『 Đối với các bảng rất lớn, cơ sở dữ liệu thường sử dụng đường dẫn trực tiếp để đọc, tức là tải trực tiếp các khối […] để tránh lấp đầy bộ đệm. Đối với các bảng có kích thước trung bình, cơ sở dữ liệu có thể được đọc trực tiếp hoặc cache dữ liệu đã đọc. Nếu bạn chọn đọc bộ nhớ cache, cơ sở dữ liệu đặt khối ở đuôi LRU để ngăn chặn bộ đệm hiện tại bị xóa.』</p>
</blockquote>
<p>Ngoài ra còn có một số khả năng, chẳng hạn như sử dụng phiên bản cao cấp của LRU, được gọi là LRU-K. Ví dụ, SQL Server sử dụng LRU-2。</p>
<p>Nguyên tắc của thuật toán này là xem xét nhiều lịch sử hơn. LRU đơn giản (tức là LRU-1) chỉ xem xét dữ liệu được sử dụng lần cuối. Còn LRU-K:</p>
<ul>
<li>Hãy xem xét dữ liệu được sử dụng K lần cuối cùng</li>
<li>Số lần dữ liệu được sử dụng được thêm vào trọng lượng</li>
<li>Một loạt dữ liệu mới được tải vào bộ nhớ cache và dữ liệu cũ nhưng thường được sử dụng sẽ không bị xóa (vì trọng lượng cao hơn)</li>
<li>Tuy nhiên, thuật toán này không giữ lại dữ liệu không còn được sử dụng trong bộ nhớ cache</li>
<li>Vì vậy, nếu dữ liệu không còn được sử dụng, giá trị trọng lượng giảm theo thời gian</li>
</ul>
<p>Tính toán trọng lượng là tốn kém, vì vậy SQL Server chỉ sử dụng K = 2, hiệu suất giá trị tốt và chi phí bổ sung được chấp nhận.</p>
<h5>Các thuật toán khác</h5>
<p>Tất nhiên có các thuật toán khác để quản lý bộ nhớ cache, chẳng hạn như:</p>
<ul>
<li>2Q (giống thuật toán LRU-K)</li>
<li>CLOCK (giống thuật toán LRU-K)</li>
<li>MRU (thuật toán mới nhất được sử dụng, cùng một logic nhưng các quy tắc khác nhau với LRU)</li>
<li>LRFU(Least Recently and Frequently Used)</li>
<li>……</li>
</ul>
<h4>Bộ đệm ghi (Write Buffer)</h4>
<p>Tôi chỉ tìm hiểu bộ nhớ cache đọc - tải trước dữ liệu trước khi sử dụng. Bộ đệm ghi được sử dụng để lưu dữ liệu, ghi hàng loạt vào disk, thay vì ghi dữ liệu từng cái một, dẫn đến nhiều truy cập disk duy nhất.</p>
<p>Hãy nhớ rằng <strong>bộ đệm lưu các trang (đơn vị dữ liệu nhỏ nhất) chứ không phải là hàng (row) (đơn vị logic mà người nhìn vào dữ liệu).</strong> Nếu các trang trong vùng đệm được sửa đổi nhưng chưa được ghi vào disk, đó là một trang bẩn. Có rất nhiều thuật toán để quyết định thời điểm tốt nhất để ghi các trang bẩn, nhưng vấn đề này có liên quan cao đến khái niệm giao dịch (transaction), và bây giờ chúng ta sẽ nói về các giao dịch (transaction).</p>
<h3>Trình quản lý giao dịch (Transaction Manager)</h3>
<blockquote>
<p>Cuối cùng nhưng không kém phần quan trọng, là trình quản lý giao dịch, và chúng ta sẽ thấy quá trình này đảm bảo rằng mỗi truy vấn được thực hiện trong giao dịch của riêng nó. Nhưng trước khi chúng ta bắt đầu, chúng ta cần phải hiểu khái niệm về các giao dịch ACID.</p>
</blockquote>
<p>“I’m on acid”</p>
<p>Một giao dịch ACID là một đơn vị làm việc đảm bảo bốn tính chất:</p>
<ul>
<li>Nguyên tử (Atomicity): Giao dịch được thực hiện đầy đủ hoặc hủy bỏ hoàn toàn, ngay cả khi nó chạy liên tục trong 10 giờ. Nếu giao dịch sụp đổ, trạng thái trở lại trước khi giao dịch (transaction rollback).</li>
<li>Tính nhất quán (Consistency): Chỉ dữ liệu hợp pháp (tùy thuộc vào các ràng buộc quan hệ và chức năng) mới có thể được ghi vào cơ sở dữ liệu và tính nhất quán có liên quan đến nguyên tử và cách ly.</li>
<li>Độc lập (Isolation): Nếu 2 giao dịch A và B chạy cùng một lúc, kết quả cuối cùng của giao dịch A và B là như nhau, cho dù A kết thúc trước/sau/trong khi B chạy.</li>
<li>Bền vững (Durability): Một khi giao dịch được cam kết (có nghĩa là thực hiện thành công), bất cứ điều gì xảy ra (sự cố hoặc lỗi), dữ liệu được lưu trữ trong cơ sở dữ liệu.</li>
</ul>
<p>Trong cùng một giao dịch, bạn có thể chạy nhiều truy vấn SQL để đọc, tạo, cập nhật và xóa dữ liệu. Khi hai giao dịch sử dụng cùng một dữ liệu, rắc rối đến. Ví dụ điển hình là chuyển tiền từ tài khoản A đến tài khoản B. Giả sử có 2 giao dịch:</p>
<ul>
<li>Giao dịch 1 (T1) rút $100 từ tài khoản A vào tài khoản B</li>
<li>Giao dịch 2 (T2) rút $ 50 từ tài khoản A cho tài khoản B</li>
</ul>
<p>Hãy trở lại để xem các thuộc tính ACID:</p>
<ul>
<li>Atomicity đảm bảo rằng bất cứ điều gì xảy ra trong T1 (sự cố máy chủ, gián đoạn mạng … ), không thể xuất hiện hiện tượng tài khoản A đã bị rút 100$ nhưng không gửi cho tài khoản B (đây là trạng thái không nhất quán của dữ liệu).</li>
<li>Isolation đảm bảo rằng nếu T1 và T2 xảy ra cùng một lúc, cuối cùng A sẽ giảm $ 150 và B sẽ nhận được $150 thay vì các kết quả khác, chẳng hạn như vì phần T2 xóa hành vi của T1, A giảm $150 và B chỉ nhận được $50 (đây cũng là trạng thái không nhất quán).</li>
<li>Durability đảm bảo rằng nếu T1 vừa được cam kết, cơ sở dữ liệu sụp đổ và T1 sẽ không biến mất mà không có dấu vết.</li>
<li>Consistency đảm bảo rằng tiền không được tạo ra hoặc mất mát trong hệ thống.</li>
</ul>
<h3>Kiểm soát đồng thời (Concurrency Control)</h3>
<p>Vấn đề thực sự với việc đảm bảo isolation, consistency, and atomicity là <strong>write operation (add, update, delete) đối với cùng một dữ liệu</strong>:</p>
<ul>
<li>Nếu tất cả các giao dịch chỉ đọc dữ liệu, chúng có thể hoạt động cùng một lúc và không thay đổi hành vi của một giao dịch khác.</li>
<li>Nếu (ít nhất) có một giao dịch sửa đổi dữ liệu được đọc bởi các giao dịch khác, cơ sở dữ liệu cần phải tìm một cách để ẩn những thay đổi như vậy cho các giao dịch khác. Ngoài ra, nó cũng cần phải đảm bảo rằng sửa đổi này sẽ không bị xóa bởi một giao dịch khác mà bạn không thấy dữ liệu này sửa đổi.</li>
</ul>
<p>Vấn đề này được gọi là <strong>kiểm soát đồng thời (concurency control)</strong>.</p>
<p>Giải pháp đơn giản nhất là thực hiện lần lượt từng giao dịch (tức là thực hiện theo thứ tự), nhưng điều này hoàn toàn không có khả năng mở rộng, chỉ có một nhân hoạt động trên một máy chủ đa nhân / đa luồng và không hiệu quả.</p>
<ul>
<li>Lý tưởng nhất là mỗi khi một giao dịch được tạo hoặc hủy bỏ:</li>
<li>Giám sát tất cả các hoạt động của tất cả các giao dịch</li>
<li>Kiểm tra xem các phần của 2 (hoặc nhiều) giao dịch xung đột do đọc/sửa cùng một dữ liệu hay không?</li>
<li>Sắp xếp lại các hoạt động trong các giao dịch xung đột để giảm các phần xung đột</li>
<li>Thực hiện các phần xung đột theo một thứ tự nhất định (trong khi các giao dịch không xung đột vẫn đang chạy đồng thời)</li>
<li>Xem xét rằng giao dịch có thể bị hủy bỏ</li>
</ul>
<p>Theo cách nói chính thức hơn, đây là một vấn đề lập lịch cho xung đột. Cụ thể hơn, đây là một vấn đề tối ưu hóa rất khó khăn và chi phí CPU rất lớn. Cơ sở dữ liệu cấp doanh nghiệp không thể chịu đựng được việc chờ đợi hàng giờ để tìm lịch trình tốt nhất cho mỗi hoạt động giao dịch mới, vì vậy hãy sử dụng một cách ít lý tưởng hơn để tránh lãng phí nhiều thời gian hơn để giải quyết xung đột.</p>
<h3>Trình quản lý khóa (Lock Manager)</h3>
<blockquote>
<p>Để giải quyết vấn đề này, hầu hết các cơ sở dữ liệu sử dụng <strong>khóa</strong> và / hoặc <strong>kiểm soát phiên bản dữ liệu</strong>. Đây là một chủ đề lớn, tôi sẽ tập trung vào khóa, và một chút kiểm soát phiên bản dữ liệu.</p>
</blockquote>
<h4>Khóa bi quan (pessimistic lock)</h4>
<p>Nguyên tắc là:</p>
<ul>
<li>Nếu một giao dịch yêu cầu một dữ liệu, nó khóa dữ liệu</li>
<li>Nếu một giao dịch khác cũng cần dữ liệu này, nó phải chờ giao dịch đầu tiên từ bỏ dữ liệu đó</li>
</ul>
<p>Ổ khóa này gọi là <strong>khóa độc quyền</strong>.</p>
<p>Nhưng việc sử dụng khóa độc quyền cho một giao dịch chỉ đọc dữ liệu là tốn kém, bởi vì nó sẽ buộc các giao dịch khác chỉ cần đọc cùng một dữ liệu chờ đợi. Vì vậy, có một loại khóa khác, <strong>khóa chia sẻ (shared lock)</strong>.</p>
<p><strong>Khóa chia sẻ trông như thế này</strong>:</p>
<ul>
<li>Nếu một giao dịch chỉ cần đọc dữ liệu A, nó sẽ thêm "khóa chia sẻ" vào dữ liệu A và đọc</li>
<li>Nếu giao dịch thứ hai cũng cần chỉ đọc dữ liệu A, nó sẽ thêm "khóa chia sẻ" dữ liệu A và đọc</li>
<li>Nếu giao dịch thứ ba cần phải sửa đổi dữ liệu A, nó sẽ thêm "khóa độc quyền" vào dữ liệu A, nhưng phải chờ đợi cho hai giao dịch khác từ bỏ khóa chia sẻ của họ.</li>
</ul>
<p>Tương tự như vậy, nếu khóa độc quyền được thêm một khối dữ liệu, một giao dịch mà chỉ cần đọc dữ liệu đó thì phải chờ khóa độc quyền từ bỏ trước khi thêm khóa chia sẻ cho dữ liệu đó.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230605010909.png" alt="Pasted image 20230605010909" tabindex="0" loading="lazy"><figcaption>Pasted image 20230605010909</figcaption></figure>
<p>Trình quản lý khóa là quá trình thêm và giải phóng khóa, lưu thông tin khóa trong nội bộ với một bảng băm (với key là dữ liệu bị khóa) và hiểu rằng mỗi khối dữ liệu là:</p>
<ul>
<li>Bị khóa bởi giao dịch nào</li>
<li>Giao dịch nào đang chờ dữ liệu được mở khóa</li>
</ul>
<h4>Bế tắc (Deadlock)</h4>
<p>Nhưng sử dụng khóa có thể dẫn đến một tình huống mà 2 giao dịch luôn chờ đợi một mảnh dữ liệu:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230605011404.png" alt="Pasted image 20230605011404" tabindex="0" loading="lazy"><figcaption>Pasted image 20230605011404</figcaption></figure>
<p>Trong hình này:</p>
<ul>
<li>Giao dịch A thêm khóa độc quyền vào dữ liệu 1 và chờ đợi để có được dữ liệu 2</li>
<li>Giao dịch B thêm khóa độc quyền cho dữ liệu 2 và chờ đợi để có được dữ liệu 1</li>
</ul>
<p>Nó được gọi là <strong>bế tắc (deadlock)</strong>.</p>
<p>Khi bế tắc xảy ra, trình quản lý khóa sẽ chọn hủy bỏ (rollback) một giao dịch để loại bỏ bế tắc. Đây là một quyết định khó khăn:</p>
<ul>
<li>Huỷ các giao dịch có ít sửa đổi dữ liệu nhất (điều này làm giảm chi phí rollback)?</li>
<li>Huỷ các giao dịch có thời gian ngắn nhất vì người dùng của các giao dịch khác chờ đợi lâu hơn?</li>
<li>Huỷ các giao dịch tốn ít thời gian để kết thúc hơn(tránh đói tài nguyên)?</li>
<li>Một khi rollback xảy ra, có bao nhiêu giao dịch sẽ bị ảnh hưởng bởi rollback?</li>
</ul>
<p>Trước khi thực hiện lựa chọn, trình quản lý khóa cần kiểm tra xem có bế tắc hay không.</p>
<p>Bảng băm có thể được coi là một đồ thị (xem đồ thị ở trên), trong đó nếu chu trình xuất hiện cho thấy bế tắc. Vì vòng lặp kiểm tra là tốn kém (đồ thị bao gồm tất cả các ổ khóa là rất lớn), nó thường được giải quyết theo những cách đơn giản: <strong>sử dụng thời gian chờ (timeout)</strong>. Nếu một khóa không được thêm vào trong thời gian chờ, sau đó giao dịch sẽ đi vào trạng thái bế tắc.</p>
<p>Trình quản lý khóa cũng có thể kiểm tra xem khóa có trở thành bế tắc hay không trước khi thêm khóa đó, nhưng nó vẫn tốn kém để làm điều đó một cách hoàn hảo. Do đó, các tiền kiểm thử (preflight) này thường thiết lập một số quy tắc cơ bản.</p>
<h4>Two-Phase Locking Protocol</h4>
<blockquote>
<p>Cách dễ nhất để đạt được sự độc lập thuần túy là để có được một khóa khi bắt đầu giao dịch và giải phóng nó khi kết thúc. Điều đó có nghĩa là, trước khi giao dịch bắt đầu, bạn phải chờ đợi để đảm bảo rằng bạn có thể thêm tất cả các khóa và giải phóng khóa mà bạn giữ khi giao dịch kết thúc. Điều này là ok, nhưng rất nhiều thời gian đã bị lãng phí để chờ đợi cho tất cả các ổ khóa.</p>
</blockquote>
<p>Cách nhanh hơn là <strong>giao thức khóa hai giai đoạn</strong> (Two-Phase Locking Protocol, được sử dụng bởi DB2 và SQL Server), nơi các giao dịch được chia thành hai giai đoạn:</p>
<ul>
<li><strong>Giai đoạn tăng trưởng</strong>: Giao dịch có thể nhận được khóa, nhưng không thể giải phóng khóa.</li>
<li><strong>Giai đoạn thu hẹp</strong>: Giao dịch có thể giải phóng khóa (đối với dữ liệu đã được xử lý và không được xử lý lại), nhưng không thể có được khóa mới.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230605013007.png" alt="Pasted image 20230605013007" tabindex="0" loading="lazy"><figcaption>Pasted image 20230605013007</figcaption></figure>
<p>Quá trình đằng sau hai quy tắc đơn giản này là:</p>
<ul>
<li>Giải phóng khóa không còn được sử dụng để giảm thời gian chờ đợi cho các giao dịch khác</li>
<li>Ngăn chặn tình huống sau xảy ra: dữ liệu thu được ban đầu từ giao dịch, được sửa đổi sau khi giao dịch bắt đầu, và sự không nhất quán xảy ra khi giao dịch đọc lại dữ liệu.</li>
</ul>
<p>Quy tắc này hoạt động tốt, với một ngoại lệ: nếu một mảnh dữ liệu bị sửa đổi, các khóa liên quan bị giải phóng, giao dịch bị hủy bỏ (rollback), trong khi giao dịch khác đọc giá trị đã bị sửa đổi, nhưng giá trị cuối cùng này đã được rollback. Để tránh vấn đề này, <strong>tất cả các khóa độc quyền phải được giải phóng vào cuối giao dịch</strong>.</p>
<h4>Nhiều hơn nữa</h4>
<blockquote>
<p>Tất nhiên, cơ sở dữ liệu thực tế sử dụng các hệ thống phức tạp hơn liên quan đến nhiều loại khóa hơn (ví dụ: khóa ý định, intention lock) và nhiều chi tiết hơn (krow-level lock, page-level lock, partition lock, table lock, table space lock), nhưng ý tưởng là như nhau.</p>
</blockquote>
<p>Tôi chỉ tìm hiểu các phương pháp hoàn toàn dựa trên khóa và <strong>kiểm soát phiên bản dữ liệu là một cách khác để giải quyết vấn đề này</strong>.</p>
<p>Kiểm soát phiên bản (version control) trông như thế này:</p>
<ul>
<li>Mỗi giao dịch có thể sửa đổi cùng một dữ liệu tại cùng một thời điểm</li>
<li>Mỗi giao dịch có bản sao riêng (hoặc phiên bản) của dữ liệu</li>
<li>Nếu 2 giao dịch sửa đổi cùng một dữ liệu, chỉ chấp nhận một sửa đổi, còn lại sẽ bị từ chối và các giao dịch liên quan rollback (hoặc chạy lại)</li>
</ul>
<p>Điều này sẽ cải thiện hiệu suất vì:</p>
<ul>
<li>Giao dịch đọc không chặn giao dịch viết</li>
<li>Giao dịch viết không chặn đọc</li>
<li>Không có chi phí bổ sung cho trình quản lý khóa "cồng kềnh và chậm"</li>
</ul>
<p>Ngoại trừ khi hai giao dịch viết cùng một dữ liệu, kiểm soát phiên bản dữ liệu hoạt động tốt hơn so với khóa trong tất cả các khía cạnh. Chỉ có điều, bạn sẽ sớm phát hiện ra rằng sự tiêu thụ không gian disk là rất lớn.</p>
<p><strong>Kiểm soát phiên bản dữ liệu và cơ chế khóa là hai hiểu biết khác nhau</strong>: khóa lạc quan và khóa bi quan. Cả hai đều có ưu và nhược điểm, hoàn toàn phụ thuộc vào việc kịch bản sử dụng (đọc nhiều hơn hoặc viết nhiều hơn).</p>
<blockquote>
<p>Một số cơ sở dữ liệu, chẳng hạn như DB2 (cho đến phiên bản 9.7) và SQL Server (không có isolation snapshot), chỉ sử dụng cơ chế khóa. Những cơ sở dữ liệu khác như PostgreSQL, MySQL và Oracle sử dụng cơ chế kết hợp khóa và phiên bản chuột.</p>
</blockquote>
<h3>Trình quản lý nhật ký (Log Manager)</h3>
<p>Như chúng ta đã biết, để cải thiện hiệu suất, cơ sở dữ liệu lưu dữ liệu trong bộ đệm bộ nhớ. Nhưng nếu máy chủ sụp đổ khi giao dịch được cam kết, dữ liệu vẫn còn trong bộ nhớ bị mất, làm suy yếu tính bền vững (durability) của giao dịch. Bạn có thể ghi tất cả dữ liệu trên disk, nhưng nếu máy chủ sụp đổ, dữ liệu cuối cùng có thể chỉ được ghi một phần vào disk, làm hỏng tính nguyên tử (atomicity) của giao dịch.</p>
<p><strong>Bất kỳ sửa đổi nào được thực hiện bởi giao dịch phải bị hủy bỏ hoặc hoàn thành</strong>.</p>
<p>Có 2 cách để giải quyết vấn đề này:</p>
<ul>
<li>
<p><strong>Bản sao/Trang bóng (Shadow copies/pages)</strong>: &nbsp;Mỗi giao dịch tạo ra một bản sao của cơ sở dữ liệu của riêng nó (hoặc một phần của cơ sở dữ liệu), và làm việc trên bản sao này. Khi xảy ra lỗi, bản sao này sẽ được loại bỏ; khi thành công, cơ sở dữ liệu ngay lập tức sử dụng một thủ thuật từ hệ thống tệp tin để thay thế bản sao vào trong dữ liệu, sau đó xóa đi các "dữ liệu cũ".</p>
</li>
<li>
<p><strong>Nhật ký giao dịch (Transaction log)</strong>: Nhật ký giao dịch là một không gian lưu trữ, trước khi ghi vào đĩa mỗi lần, cơ sở dữ liệu sẽ viết thông tin vào nhật ký giao dịch. Điều này giúp cơ sở dữ liệu biết cách loại bỏ hoặc hoàn thành các giao dịch chưa hoàn thành khi xảy ra sự cố hoặc rollback của giao dịch.</p>
</li>
</ul>
<h4>WAL (Write-Ahead Logging)</h4>
<blockquote>
<p>Shadow copies/pages tạo ra rất nhiều chi phí disk khi chạy một cơ sở dữ liệu lớn với nhiều giao dịch hơn, vì vậy cơ sở dữ liệu hiện đại sử dụng <strong>transaction log</strong>. Nhật ký giao dịch phải được <strong>lưu trữ ổn định</strong> và tôi sẽ không đào sâu vào công nghệ lưu trữ, nhưng ít nhất Disk RAID là bắt buộc trong trường hợp disk lỗi.</p>
</blockquote>
<p>Hầu hết các cơ sở dữ liệu (ít nhất là Oracle, SQL Server, DB2, PostgreSQL, MySQL và SQLite) xử lý nhật ký giao dịch bằng cách sử dụng giao thức nhật ký ghi trước (Write-Ahead Logging protocol, WAL). Giao thức WAL có 3 quy tắc:</p>
<ul>
<li>Mỗi sửa đổi cơ sở dữ liệu tạo ra một bản ghi nhật ký, và trước khi dữ liệu được ghi vào disk, bản ghi nhật ký phải được ghi vào nhật ký giao dịch.</li>
<li>Ghi nhật ký phải được viết theo thứ tự; Bản ghi A xảy ra trước khi bản ghi B thì A phải được viết trước B.</li>
<li>Khi một giao dịch được cam kết, trình tự cam kết phải được ghi vào nhật ký giao dịch trước khi giao dịch thành công.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230605020105.png" alt="Pasted image 20230605020105" tabindex="0" loading="lazy"><figcaption>Pasted image 20230605020105</figcaption></figure>
<p>Công việc này được thực hiện bởi trình quản lý nhật ký. Sự hiểu biết đơn giản là trình quản lý nhật ký nằm giữa trình quản lý bộ nhớ cache (cache manager) và trình quản lý truy cập dữ liệu (data access manager, chịu trách nhiệm ghi dữ liệu vào disk), mỗi thao tác update / delete / create / commit / rollback ghi vào nhật ký giao dịch trước khi ghi vào disk. Quá trình này là đơn giản, lý do là <strong>làm thế nào để tìm một cách để viết nhật ký trong khi vẫn duy trì hiệu suất tốt</strong>, nếu nhật ký giao dịch được viết quá chậm, toàn bộ sẽ chậm lại.</p>
<h4>ARIES</h4>
<blockquote>
<p>Năm 1992, các nhà nghiên cứu IBM đã phát minh ra một phiên bản nâng cao của WAL, được gọi là ARIES. ARIES ít nhiều được sử dụng trong cơ sở dữ liệu hiện đại, logic không nhất thiết phải giống nhau, nhưng các khái niệm đằng sau AIRES có ở khắp mọi nơi. ARIES viết tắt của Algorithms for Recovery and Isolation Exploiting Semantics.</p>
</blockquote>
<p>Công nghệ này để đạt được một mục tiêu kép:</p>
<ul>
<li>Ghi nhật ký trong khi vẫn duy trì hiệu suất tốt</li>
<li>Phục hồi dữ liệu nhanh chóng và đáng tin cậy</li>
</ul>
<p>Có một số lý do khiến cơ sở dữ liệu phải rollback giao dịch:</p>
<ul>
<li>Bởi vì người dùng hủy bỏ</li>
<li>Bởi vì máy chủ hoặc mạng thất bại</li>
<li>Bởi vì các giao dịch phá hủy tính toàn vẹn của cơ sở dữ liệu (chẳng hạn như một cột với các ràng buộc duy nhất và các giao dịch thêm các giá trị trùng lặp)</li>
<li>Bởi vì bế tắc</li>
</ul>
<h4>Nhật ký (Log)</h4>
<blockquote>
<p>Đôi khi (chẳng hạn như lỗi mạng), cơ sở dữ liệu có thể khôi phục giao dịch. Làm thế nào điều này có thể được? Để trả lời câu hỏi này, chúng ta cần phải hiểu thông tin được lưu trong nhật ký.</p>
</blockquote>
<p><strong>Mỗi hành động (add/delete/modify) của giao dịch tạo ra một log</strong> bao gồm:</p>
<ul>
<li>LSN: Một số sê-ri nhật ký duy nhất (Log Sequence Number). LSN được phân bổ theo thứ tự thời gian, có nghĩa là nếu A hoạt động trước B, LSN của log A nhỏ hơn LSN của log B.</li>
<li>TransID: ID giao dịch tạo ra hành động.</li>
<li>PageID: Vị trí của dữ liệu sửa đổi trên disk. Đơn vị nhỏ nhất của dữ liệu disk là một trang, vì vậy vị trí của dữ liệu là nơi nó đang ở.</li>
<li>PrevLSN: Liên kết cuối cùng được ghi lại nhật ký được tạo ra bởi cùng một giao dịch.</li>
<li>UNDO: Phương pháp hủy bỏ thao tác này. Ví dụ: nếu hành động là cập nhật, UNDO sẽ hoặc lưu các giá trị/trạng thái phần tử trước khi cập nhật (physical UNDO), hoặc trở lại hoạt động đảo ngược của trạng thái ban đầu (logical UNDO, chỉ sử dụng UNDO logic vì xử lý physical UNDO quá lộn xộn).</li>
<li>REDO: Phương pháp lặp lại hoạt động này. Tương tự như vậy, có 2 cách: hoặc lưu giá trị phần tử / trạng thái sau khi hoạt động hoặc lưu chính hành động để lặp lại.</li>
<li>… 😦 để bạn tham khảo, một nhật ký ARIES cũng có 2 trường: UndoNxtLSN và Type).</li>
</ul>
<p>Mỗi trang trên đĩa (lưu dữ liệu, không phải nhật ký được lưu) ghi lại LSN cuối cùng sửa đổi hoạt động dữ liệu đó.</p>
<blockquote>
<p>Lưu ý: Theo như tôi biết, chỉ PostgreSQL không sử dụng UNDO mà thay vào đó sử dụng dịch vụ thu gom rác để xóa các phiên bản cũ hơn của dữ liệu. Điều này có liên quan đến việc thực hiện kiểm soát phiên bản dữ liệu của PostgreSQL.</p>
</blockquote>
<p>Để minh họa tốt hơn điều này, điều này có một bản trình bày ghi nhật ký đơn giản được thực hiện bởi truy vấn "<code>UPDATE FROM PERSON SET AGE = 18;</code>" Kết quả:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230605200014.png" alt="Pasted image 20230605200014" tabindex="0" loading="lazy"><figcaption>Pasted image 20230605200014</figcaption></figure>
<p>Mỗi nhật ký có một LSN duy nhất, và các bản ghi được liên kết với nhau thuộc về cùng một giao dịch. Nhật ký được liên kết theo thứ tự thời gian (nhật ký cuối cùng của danh sách liên kết được tạo ra bởi hành động cuối cùng).</p>
<h4>Bộ đệm nhật ký (log buffer)</h4>
<blockquote>
<p>Để ngăn chặn ghi nhật ký trở thành nút thắt cổ chai chính, cơ sở dữ liệu sử dụng bộ đệm nhật ký.</p>
</blockquote>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230605200118.png" alt="Pasted image 20230605200118" tabindex="0" loading="lazy"><figcaption>Pasted image 20230605200118</figcaption></figure>
<p>Khi trình thực thi truy vấn yêu cầu sửa đổi một lần:</p>
<ol>
<li>Trình quản lý bộ nhớ cache sẽ sửa đổi để lưu trữ bộ đệm của riêng mình</li>
<li>Trình quản lý nhật ký lưu trữ các bản ghi có liên quan vào bộ đệm của riêng họ</li>
<li>Đến bước này, trình thực thi truy vấn tin rằng thao tác đã hoàn tất (vì vậy bạn có thể yêu cầu sửa đổi khác);</li>
<li>Sau đó (ngay sau đó) trình quản lý nhật ký ghi nhật ký vào nhật ký giao dịch, thời điểm ghinhật ký được xác định bởi một thuật toán.</li>
<li>Sau đó (ngay sau đó) trình quản lý bộ nhớ cache ghi các sửa đổi vào disk và thời điểm ghi vào disk được được xác định bởi một thuật toán.</li>
</ol>
<p><strong>Khi giao dịch được cam kết, điều đó có nghĩa là 5 bước của mỗi hoạt động của giao dịch đã được hoàn thành</strong>. Viết nhật ký giao dịch rất nhanh vì nó chỉ đơn giản là "thêm một bản ghi ở đâu đó trong nhật ký giao dịch"; Và ghi dữ liệu vào disk phức tạp hơn, bởi vì nó cần phải "ghi dữ liệu bằng một cách để có thể đọc nhanh chóng".</p>
<h4>STEAL and FORCE strategies</h4>
<blockquote>
<p>Vì lý do hiệu suất, <strong>Bước 5 có thể được hoàn thành sau khi cam kết</strong>, bởi vì trong trường hợp xảy ra sự cố, cũng có thể khôi phục giao dịch với nhật ký REDO. Điều này được gọi là <strong>chính sách NO-FORCE</strong>.</p>
</blockquote>
<p>Cơ sở dữ liệu có thể chọn chính sách FORCE, chẳng hạn như bước 5 phải được hoàn thành trước khi cam kết, để giảm tải khi phục hồi.</p>
<p>Một câu hỏi khác là <strong>để chọn xem dữ liệu là ghi từng bước (chính sách STEAL) hoặc người quản lý bộ đệm cần phải chờ đợi cho các lệnh cam kết để ghi tất cả cùng một lúc (chính sách NO-STEAL</strong>). Chọn STEAL hay NO-STEAL phụ thuộc vào những gì bạn muốn: viết nhanh nhưng phục hồi chậm từ nhật ký UNDO hoặc khôi phục nhanh chóng.</p>
<p>Dưới đây là tác động của các chính sách này đối với phục hồi:</p>
<ul>
<li><strong>STEAL/NO-FORCE yêu cầu UNDO và REDO: hiệu suất cao</strong>, nhưng các quy trình nhật ký và phục hồi phức tạp hơn (ví dụ: ARIES). Hầu hết các cơ sở dữ liệu chọn chính sách này. Lưu ý: Đây là những gì tôi thấy từ nhiều bài báo học thuật và hướng dẫn, nhưng tôi không thấy điều này rõ ràng trong tài liệu chính thức.</li>
<li>STEAL/ FORCE chỉ cần UNDO.</li>
<li>NO-STEAL/NO-FORCE chỉ cần REDO.</li>
<li>NO-STEAL/FORCE không cần bất cứ điều gì: hiệu suất tồi tệ nhất và yêu cầu bộ nhớ rất lớn.</li>
</ul>
<h4>Về phục hồi (recovery)</h4>
<blockquote>
<p>Ok, với nhật ký tốt, chúng ta hãy sử dụng chúng!</p>
</blockquote>
<p>Giả sử thực tập sinh mới làm cho cơ sở dữ liệu sụp đổ, bạn khởi động lại cơ sở dữ liệu và quá trình phục hồi bắt đầu.</p>
<p>ARIES phục hồi từ sự cố có ba giai đoạn:</p>
<ul>
<li>
<ol>
<li><strong>Giai đoạn phân tích</strong>: Quá trình phục hồi đọc tất cả các bản ghi giao dịch để xây dựng lại dòng thời gian của những gì đã xảy ra trong quá trình sụp đổ, quyết định giao dịch nào sẽ rollback (tất cả các giao dịch chưa được gửi phải rollback), dữ liệu nào cần phải được viết khi tai nạn.</li>
</ol>
</li>
<li>
<ol start="2">
<li><strong>Giai đoạn Redo</strong>: Cấp độ này bắt đầu với một bản ghi nhật ký được chọn trong phân tích, sử dụng REDO để khôi phục cơ sở dữ liệu về trạng thái trước khi sụp đổ.</li>
</ol>
<ul>
<li>Trong giai đoạn REDO, nhật ký REDO được xử lý theo thứ tự thời gian (sử dụng LSN).</li>
<li>Đối với mỗi nhật ký, quá trình phục hồi đòi hỏi phải đọc LSN trang đĩa có chứa dữ liệu.</li>
<li>Nếu LSN (trang đĩa) &gt; = LSN (ghi nhật ký), dữ liệu đã được ghi vào đĩa trước khi sụp đổ (nhưng giá trị đã được ghi đè bởi một hành động sau nhật ký và trước khi sụp đổ), vì vậy không cần phải làm gì.</li>
<li>Nếu LSN (trang đĩa) &lt; LSN (ghi nhật ký), các trang trên đĩa sẽ được cập nhật.</li>
<li>Ngay cả khi các giao dịch được rollback, REDO sẽ làm điều đó vì nó đơn giản hóa quá trình phục hồi (nhưng tôi tin rằng cơ sở dữ liệu hiện đại sẽ không làm điều đó).</li>
</ul>
</li>
<li>
<ol start="3">
<li><strong>Giai đoạn Undo</strong>: Giai đoạn này rollback tất cả các giao dịch chưa hoàn thành khi tai nạn. rollback bắt đầu với nhật ký cuối cùng của mỗi giao dịch và xử lý nhật ký UNSO theo thứ tự đảo ngược thời gian (prevLSN được ghi lại bằng nhật ký).</li>
</ol>
</li>
</ul>
<p>Trong quá trình phục hồi, nhật ký giao dịch phải chú ý đến các hoạt động của quá trình phục hồi để dữ liệu ghi vào đĩa phù hợp với nhật ký giao dịch. Một giải pháp là loại bỏ các bản ghi nhật ký được tạo ra bởi các giao dịch bị hủy bỏ, nhưng điều này là quá khó khăn. Thay vào đó, ARIES ghi lại nhật ký bù trong nhật ký giao dịch để loại bỏ hợp lý các bản ghi nhật ký cho các giao dịch bị hủy bỏ.</p>
<p>Khi giao dịch bị hủy bỏ bằng tay hoặc bị hủy bỏ bởi người quản lý khóa (để loại bỏ bế tắc), hoặc chỉ vì lỗi mạng, giai đoạn phân tích không cần thiết. Đối với những gì cần REDO cần thông tin UNDO trong 2 bảng bộ nhớ:</p>
<ul>
<li>Bảng giao dịch (lưu trạng thái của tất cả các giao dịch hiện tại)</li>
<li>Bảng trang bẩn (dữ liệu nào cần được ghi vào đĩa)</li>
</ul>
<p>Khi một giao dịch mới được tạo ra, cả hai bảng được cập nhật bởi trình quản lý bộ nhớ cache và trình quản lý giao dịch. Bởi vì nó nằm trong bộ nhớ, chúng cũng bị phá hủy khi cơ sở dữ liệu sụp đổ.</p>
<p>Nhiệm vụ của giai đoạn phân tích là xây dựng lại hai bảng trên với thông tin trong nhật ký giao dịch sau khi sụp đổ. Để đẩy nhanh giai đoạn phân tích, ARIES đưa ra một khái niệm: <strong>check point</strong>, thỉnh thoảng ghi nội dung của bảng giao dịch và bảng trang bẩn và LSN cuối cùng vào đĩa. Vì vậy, trong giai đoạn phân tích, chỉ cần phân tích nhật ký sau LSN này.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604124944.png" type="image/png"/>
    </item>
    <item>
      <title>SQL DB Interview</title>
      <link>https://vanhung4499.github.io/database/sql/interview.html</link>
      <guid>https://vanhung4499.github.io/database/sql/interview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">SQL DB Interview</source>
      <description>Phỏng vấn về Cơ sở dữ liệu quan hệ Chỉ mục và Ràng buộc Chỉ mục là gì? Chỉ mục (Index) là một cấu trúc được sắp xếp của một hoặc nhiều cột trong bảng cơ sở dữ liệu, được sử dụng...</description>
      <category>db</category>
      <category>sql</category>
      <category>interview</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Chỉ mục và Ràng buộc</h2>
<h3>Chỉ mục là gì?</h3>
<p>Chỉ mục (Index) là một cấu trúc được sắp xếp của một hoặc nhiều cột trong bảng cơ sở dữ liệu, được sử dụng để tìm kiếm dữ liệu một cách hiệu quả.</p>
<h3>Ưu điểm và nhược điểm của chỉ mục</h3>
<p>✔ Ưu điểm của chỉ mục:</p>
<ul>
<li>Chỉ mục giúp giảm lượng dữ liệu mà máy chủ cần quét, từ đó tăng tốc độ truy vấn dữ liệu.</li>
<li>Trong các cơ sở dữ liệu hỗ trợ khóa hàng (như InnoDB), khi truy cập vào hàng, khóa hàng sẽ được áp dụng. Sử dụng chỉ mục có thể giảm số lượng hàng truy cập, từ đó giảm sự cạnh tranh khóa và tăng khả năng đồng thời.</li>
<li>Chỉ mục có thể giúp máy chủ tránh sắp xếp và bảng tạm thời.</li>
<li>Chỉ mục có thể biến I/O ngẫu nhiên thành I/O tuần tự.</li>
<li>Chỉ mục duy nhất đảm bảo tính duy nhất của mỗi hàng dữ liệu. Bằng cách sử dụng chỉ mục, bạn có thể sử dụng trình tối ưu hóa truy vấn để tăng hiệu suất hệ thống.</li>
</ul>
<p>❌ Nhược điểm của chỉ mục:</p>
<ul>
<li>Tạo và duy trì chỉ mục mất thời gian, và thời gian này tăng lên khi dữ liệu tăng.</li>
<li>Chỉ mục chiếm không gian lưu trữ bổ sung, ngoài không gian dữ liệu của bảng. Nếu tạo chỉ mục kết hợp, không gian cần thiết sẽ lớn hơn.</li>
<li>Các hoạt động ghi (<code>INSERT</code>/<code>UPDATE</code>/<code>DELETE</code>) có thể cần cập nhật chỉ mục, làm giảm hiệu suất ghi của cơ sở dữ liệu.</li>
</ul>
<h3>Khi nào sử dụng chỉ mục</h3>
<p>Chỉ mục có thể cải thiện hiệu suất truy vấn một cách đáng kể.</p>
<p>✔ Khi nào thì nên sử dụng chỉ mục:</p>
<ul>
<li>Bảng thường xuyên thực hiện các truy vấn <code>SELECT</code>.</li>
<li>Dữ liệu trong bảng lớn.</li>
<li>Các cột thường xuyên xuất hiện trong điều kiện <code>WHERE</code> hoặc điều kiện kết nối (<code>JOIN</code>).</li>
</ul>
<p>❌ Khi nào không nên sử dụng chỉ mục:</p>
<ul>
<li>Hoạt động ghi thường xuyên (<code>INSERT</code>/<code>UPDATE</code>/<code>DELETE</code>) - cần cập nhật không gian chỉ mục.</li>
<li>Bảng rất nhỏ - trong hầu hết các trường hợp, quét toàn bộ bảng đơn giản hơn.</li>
<li>Cột không xuất hiện thường xuyên trong điều kiện <code>WHERE</code> hoặc điều kiện kết nối (<code>JOIN</code>) - chỉ mục sẽ không được sử dụng và tạo thêm chi phí không gian.</li>
</ul>
<h3>Các loại chỉ mục</h3>
<p>Các hệ thống cơ sở dữ liệu phổ biến thường hỗ trợ các loại chỉ mục sau:</p>
<p>Dựa trên loại logic (thường được đặt khi tạo bảng):</p>
<ul>
<li>Chỉ mục duy nhất (<code>UNIQUE</code>) - giá trị của cột chỉ mục phải là duy nhất, nhưng có thể chứa giá trị NULL. Nếu là chỉ mục kết hợp, sự kết hợp của các giá trị cột phải là duy nhất.</li>
<li>Chỉ mục chính (<code>PRIMARY</code>) - một loại đặc biệt của chỉ mục duy nhất, một bảng chỉ có thể có một chỉ mục chính và không cho phép giá trị NULL. Thường được tạo cùng với việc tạo bảng.</li>
<li>Chỉ mục thông thường (<code>INDEX</code>) - chỉ mục cơ bản nhất, không có ràng buộc đặc biệt.</li>
<li>Chỉ mục kết hợp - chỉ mục được tạo trên nhiều cột, chỉ khi điều kiện truy vấn sử dụng cột đầu tiên trong chỉ mục, chỉ mục mới được sử dụng. Sử dụng nguyên tắc tập con trái nhất.</li>
</ul>
<p>Dựa trên cấu trúc lưu trữ:</p>
<ul>
<li>Chỉ mục gom cụm (<code>Clustered</code>) - các hàng dữ liệu và các giá trị khóa được lưu trữ theo cùng một thứ tự vật lý, mỗi bảng chỉ có thể có một chỉ mục gom cụm.</li>
<li>Chỉ mục không gom cụm (<code>Non-clustered</code>) - chỉ mục chỉ định thứ tự logic của các giá trị khóa, dữ liệu được lưu trữ ở một vị trí và chỉ mục được lưu trữ ở một vị trí khác, chỉ mục chứa con trỏ đến vị trí lưu trữ dữ liệu. Có thể có nhiều chỉ mục không gom cụm, nhưng số lượng có giới hạn (thường nhỏ hơn 249).</li>
</ul>
<h3>Cấu trúc dữ liệu của chỉ mục</h3>
<p>Các cơ sở dữ liệu phổ biến thường sử dụng cấu trúc dữ liệu B-Tree hoặc B+Tree cho chỉ mục.</p>
<h4>B-Tree</h4>
<p>B-Tree bậc M là cây có các thuộc tính sau:</p>
<ul>
<li>Mỗi nút có tối đa M con.</li>
<li>Ngoại trừ nút gốc và nút lá, mỗi nút có ít nhất M/2 con.</li>
<li>Nút gốc có ít nhất hai con (trừ khi cây chỉ chứa một nút).</li>
<li>Tất cả các nút lá nằm ở cùng một mức, không chứa bất kỳ thông tin khóa nào.</li>
<li>Nút không phải lá chứa ít nhất M/2-1 và tối đa M-1 khóa.</li>
<li>Các khóa bên trong mỗi nút được sắp xếp theo thứ tự tăng dần.</li>
<li>Đối với mỗi nút, có một mảng khóa <code>Key[]</code> và một mảng con trỏ (trỏ đến các con) <code>Son[]</code>.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721113211.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Trong cây B-Tree, quá trình tìm kiếm diễn ra như sau:</p>
<ol>
<li>Tìm kiếm trong mảng khóa <code>Key[]</code> bằng phương pháp tìm kiếm tuần tự (khi độ dài mảng nhỏ) hoặc tìm kiếm nhị phân (khi độ dài mảng lớn), nếu tìm thấy khóa K, trả về địa chỉ của nút và vị trí của K trong <code>Key[]</code>.</li>
<li>Nếu không tìm thấy, có thể xác định K nằm giữa Key[i] và Key[i+1] của một nút, tiếp tục tìm kiếm từ con trỏ Son[i] trỏ đến con trỏ con, cho đến khi tìm thấy nút chứa thành công.</li>
<li>Hoặc tìm kiếm không thành công khi tìm thấy một nút lá và tìm kiếm trong nút lá không thành công.</li>
</ol>
<h4>B+Tree</h4>
<p>B+Tree là biến thể của cây B-Tree:</p>
<ul>
<li>Số lượng con của mỗi nút giới hạn là 2d thay vì 2d+1 (d là bậc ra của nút).</li>
<li>Nút không phải lá không chứa dữ liệu, chỉ chứa khóa.</li>
<li>Nút lá không chứa con trỏ.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721113624.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Trong B+Tree, nút lá và nút không phải lá có kích thước khác nhau. Điều này khác với cây B-Tree, trong đó các nút khác nhau chứa cùng số lượng khóa và con trỏ.</p>
<p><strong>Cây B+Tree với con trỏ truy cập tuần tự</strong></p>
<p>Nói chung, cấu trúc B+Tree được sử dụng trong hệ thống cơ sở dữ liệu hoặc hệ thống tệp đã được tối ưu hóa trên cơ sở B+Tree cổ điển bằng việc thêm các con trỏ truy cập tuần tự.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721113644.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Trong B+Tree với con trỏ truy cập tuần tự, mỗi nút lá được thêm một con trỏ trỏ đến nút lá kế tiếp, tạo thành một chuỗi con trỏ.</p>
<p>Tối ưu hóa này nhằm mục đích cải thiện hiệu suất truy vấn phạm vi, ví dụ: nếu muốn truy vấn tất cả các bản ghi có giá trị khóa từ 18 đến 49, sau khi tìm thấy 18, chỉ cần duyệt theo thứ tự nút và con trỏ để truy cập tất cả các bản ghi, tăng đáng kể hiệu suất truy vấn phạm vi.</p>
<h4>B-Tree vs B+Tree</h4>
<ul>
<li>B+Tree phù hợp hơn cho lưu trữ bên ngoài (thường là lưu trữ đĩa), vì các nút không phải lá không chứa dữ liệu, vì vậy mỗi nút có thể chứa nhiều nút hơn, mỗi nút có thể chứa nhiều giá trị hơn. Điều này có nghĩa là mỗi lần I/O đĩa, lượng thông tin được truy cập bằng chỉ mục B+Tree lớn hơn, tăng hiệu suất I/O.</li>
<li>MySQL là hệ thống cơ sở dữ liệu quan hệ (RDBMS), thường sẽ truy vấn theo phạm vi trên cột chỉ mục, B+Tree có các nút lá được sắp xếp theo thứ tự, giúp tối ưu hóa truy vấn phạm vi trên cột chỉ mục. Còn B-Tree không thể thực hiện truy vấn phạm vi trên cột chỉ mục.</li>
</ul>
<h4>Hash</h4>
<blockquote>
<p>Hash chỉ có hiệu lực đối với các truy vấn khớp chính xác tất cả các cột trong chỉ mục.</p>
</blockquote>
<p>Đối với mỗi hàng dữ liệu, tính toán một <code>hashcode</code> cho tất cả các cột chỉ mục. Chỉ mục hash lưu trữ tất cả các <code>hashcode</code> trong chỉ mục và sử dụng bảng băm để lưu trữ con trỏ đến hàng dữ liệu.</p>
<p>Lợi ích của chỉ mục băm:</p>
<ul>
<li>Vì cấu trúc dữ liệu chỉ mục rất gọn nhẹ, nên tốc độ truy vấn rất nhanh.</li>
<li>Một số hệ thống cơ sở dữ liệu (như MyISAM) chỉ lưu trữ chỉ mục trong bộ nhớ, trong khi dữ liệu phụ thuộc vào hệ điều hành để lưu trữ. Do đó, chỉ truy cập chỉ mục không sử dụng cuộc gọi hệ thống (thường tốn thời gian).</li>
</ul>
<p>Nhược điểm của chỉ mục băm:</p>
<ul>
<li>Dữ liệu không được lưu trữ theo thứ tự chỉ mục, do đó không thể sử dụng để sắp xếp.</li>
<li>Chỉ mục băm không hỗ trợ truy vấn phạm vi. Chỉ có thể sử dụng cho truy vấn khớp chính xác.</li>
<li>Chỉ mục băm không hỗ trợ truy vấn phần của chỉ mục. Ví dụ: nếu chỉ mục băm được tạo trên cột (A, B), và truy vấn chỉ có cột A, thì không thể sử dụng chỉ mục này.</li>
<li>Chỉ mục băm chỉ hỗ trợ truy vấn so sánh bằng, không hỗ trợ truy vấn phạm vi. Ví dụ: <code>WHERE price &gt; 100</code> không thể sử dụng chỉ mục băm.</li>
<li>Chỉ mục băm có thể gặp xung đột băm, khi đó phải duyệt qua tất cả các con trỏ hàng trong danh sách liên kết, so sánh từng hàng để tìm hàng phù hợp.</li>
</ul>
<h3>Chiến lược lập chỉ mục</h3>
<h4>Nguyên tắc cơ bản của chỉ mục</h4>
<ul>
<li>Không phải càng nhiều chỉ mục càng tốt, không nên tạo chỉ mục cho tất cả các cột.</li>
<li>Tránh sự trùng lặp và chỉ mục không cần thiết.</li>
<li>Xóa các chỉ mục không được sử dụng.</li>
<li>Mở rộng các chỉ mục hiện có thay vì tạo mới.</li>
<li>Cân nhắc thêm chỉ mục cho các cột được sử dụng thường xuyên trong điều kiện lọc <code>WHERE</code>.</li>
</ul>
<h4>Cột độc lập</h4>
<p><strong>Nếu cột trong câu truy vấn không phải là cột độc lập, cơ sở dữ liệu sẽ không sử dụng chỉ mục</strong>.</p>
<p>"Cột độc lập" có nghĩa là cột chỉ mục không được tạo thành từ một phần của biểu thức hoặc là đối số của một hàm.</p>
<p>Ví dụ sai:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> actor_id </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> actor </span><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> actor_id + </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ... </span><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> TO_DAYS(current_date) - TO_DAYS(date_col) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h4>Chỉ mục tiền tố và tính chọn lọc của chỉ mục</h4>
<p>Đôi khi cần tạo chỉ mục cho các cột có độ dài lớn, điều này làm cho chỉ mục trở nên lớn và chậm.</p>
<p>Giải pháp là: chỉ cần tạo chỉ mục cho một phần đầu của chuỗi, điều này giúp tiết kiệm không gian chỉ mục và tăng hiệu suất chỉ mục. Tuy nhiên, điều này cũng làm giảm tính chọn lọc của chỉ mục.</p>
<p>Tính chọn lọc của chỉ mục là tỷ lệ giữa số giá trị chỉ mục không trùng lặp và tổng số bản ghi trong bảng. Giá trị tối đa là 1, khi mỗi bản ghi có một chỉ mục duy nhất. Tính chọn lọc càng cao, hiệu suất truy vấn càng cao.</p>
<p>Đối với các cột kiểu BLOB/TEXT/VARCHAR, phải sử dụng chỉ mục tiền tố vì cơ sở dữ liệu thường không cho phép chỉ mục đầy đủ cho các cột này.</p>
<p>Cần chọn tiền tố đủ dài để đảm bảo tính chọn lọc cao, đồng thời không quá dài (tiết kiệm không gian).</p>
<p>Ví dụ không hiệu quả:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(*) </span><span style="color:#C678DD;--shiki-dark:#C678DD">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> cnt, city </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66"> sakila</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">city_demo</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GROUP BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> city </span><span style="color:#C678DD;--shiki-dark:#C678DD">ORDER BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> cnt </span><span style="color:#C678DD;--shiki-dark:#C678DD">DESC</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LIMIT</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Ví dụ hiệu quả:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(*) </span><span style="color:#C678DD;--shiki-dark:#C678DD">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> cnt, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">LEFT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(city, </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> pref </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66"> sakila</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">city_demo</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GROUP BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> city </span><span style="color:#C678DD;--shiki-dark:#C678DD">ORDER BY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> cnt </span><span style="color:#C678DD;--shiki-dark:#C678DD">DESC</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LIMIT</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h4>Chỉ mục đa cột</h4>
<p><strong>Không nên tạo chỉ mục riêng cho từng cột</strong>.</p>
<p><strong>Ưu tiên đặt các cột có tính chọn lọc cao hoặc số lượng giá trị duy nhất lớn ở đầu chỉ mục đa cột</strong>. Tuy nhiên, đôi khi cũng cần xem xét các yếu tố khác như sắp xếp, nhóm và điều kiện phạm vi trong mệnh đề WHERE, vì những yếu tố này cũng ảnh hưởng đáng kể đến hiệu suất truy vấn.</p>
<p>Ví dụ:</p>
<p>Giả sử có bảng user với các cột name, sex, age. Nếu tạo chỉ mục đa cột cho ba cột này, thì thứ tự tốt nhất là: <code>name &gt; age &gt; sex</code>.</p>
<h4>Chỉ mục gom nhóm</h4>
<p>Chỉ mục gom nhóm không phải là một loại chỉ mục độc lập, mà là một cách lưu trữ dữ liệu. Chi tiết cụ thể phụ thuộc vào cách triển khai. Ví dụ, chỉ mục gom nhóm của InnoDB thực tế là lưu trữ cùng một cấu trúc B-tree của chỉ mục và dòng dữ liệu.</p>
<p><strong>Chỉ mục gom nhóm đại diện cho việc lưu trữ dòng dữ liệu và các giá trị khóa liền kề, do đó truy cập nhanh</strong>. Vì không thể lưu trữ dòng dữ liệu trong hai vị trí khác nhau cùng một lúc, nên <strong>một bảng chỉ có thể có một chỉ mục gom nhóm</strong>.</p>
<p>Nếu không xác định khóa chính, InnoDB sẽ tự động xác định một khóa chính để sử dụng làm chỉ mục gom nhóm.</p>
<h4>Chỉ mục che phủ</h4>
<p>Chỉ mục chứa tất cả các giá trị cần truy vấn.</p>
<p>Có các lợi ích sau:</p>
<ul>
<li>Vì các mục chỉ mục thường nhỏ hơn nhiều so với kích thước dòng dữ liệu, nên chỉ đọc chỉ mục có thể giảm lượng truy cập dữ liệu.</li>
<li>Một số cơ sở dữ liệu (ví dụ: MyISAM) chỉ lưu trữ chỉ mục trong bộ nhớ, trong khi dữ liệu phụ thuộc vào hệ điều hành để lưu trữ. Do đó, chỉ đọc chỉ mục có thể tránh sử dụng cuộc gọi hệ thống (thường tốn thời gian).</li>
<li>Đối với cơ sở dữ liệu InnoDB, nếu chỉ mục phụ có thể che phủ truy vấn, không cần truy cập chỉ mục chính.</li>
</ul>
<h4>Sử dụng quét chỉ mục để sắp xếp</h4>
<p>MySQL có hai cách để tạo kết quả sắp xếp: thông qua hoạt động sắp xếp; hoặc quét chỉ mục theo thứ tự.</p>
<p><strong>Chỉ mục tốt là chỉ mục có thể được sử dụng để sắp xếp kết quả</strong>. Điều này cho phép sử dụng chỉ mục để sắp xếp thay vì sắp xếp trực tiếp.</p>
<h4>Nguyên tắc phù hợp nhất bên trái</h4>
<p>MySQL sẽ tiếp tục khớp về bên phải cho đến khi gặp các truy vấn phạm vi <code>(&gt;, &lt;, BETWEEN, LIKE)</code>.</p>
<ul>
<li>Chỉ mục có thể đơn giản như một cột (a), hoặc phức tạp như nhiều cột (a, b, c, d), được gọi là chỉ mục kết hợp.</li>
<li>Nếu là chỉ mục kết hợp, thì khóa cũng bao gồm nhiều cột. Đồng thời, chỉ có thể sử dụng chỉ mục để kiểm tra xem khóa có tồn tại hay không (tương đương với bằng nhau), và không thể khớp với các truy vấn phạm vi (&gt;, &lt;, between, like).</li>
<li>Do đó, <strong>thứ tự cột quyết định số lượng cột chỉ mục có thể khớp</strong>.</li>
</ul>
<p>Ví dụ:</p>
<ul>
<li>Nếu có chỉ mục (a, b, c, d) và điều kiện truy vấn là a = 1 và b = 2 và c &gt; 3 và d = 4, thì chỉ có thể khớp với a, b, c và không thể khớp với d. (Đơn giản: chỉ có thể khớp với các trường hợp <strong>bằng nhau</strong>, không thể khớp với phạm vi)</li>
</ul>
<h3>Ràng buộc</h3>
<p>Có những ràng buộc nào trong cơ sở dữ liệu:</p>
<ul>
<li><code>NOT NULL</code> - Được sử dụng để đảm bảo rằng nội dung của trường không thể là giá trị rỗng (NULL).</li>
<li><code>UNIQUE</code> - Nội dung của trường không được lặp lại, một bảng có thể có nhiều ràng buộc <code>UNIQUE</code>.</li>
<li><code>PRIMARY KEY</code> - Kết hợp các cột hoặc thuộc tính trong bảng dữ liệu để định danh duy nhất và hoàn chỉnh cho các đối tượng dữ liệu. Một bảng chỉ được phép có một khóa chính. Giá trị của khóa chính không thể là giá trị rỗng (NULL).</li>
<li><code>FOREIGN KEY</code> - Khóa ngoại trong một bảng là khóa chính của một bảng khác. Nó được sử dụng để ngăn chặn các hành động phá vỡ kết nối giữa các bảng và ngăn chặn việc chèn dữ liệu không hợp lệ vào cột khóa ngoại, vì nó phải là một trong các giá trị trong bảng được chỉ định.</li>
<li><code>CHECK</code> - Sử dụng để kiểm soát phạm vi giá trị của trường.</li>
</ul>
<h2>Kiểm soát đồng thời</h2>
<h3>Khóa lạc quan và khóa bi quan</h3>
<blockquote>
<ul>
<li>Khóa lạc quan và khóa bi quan trong cơ sở dữ liệu là gì?</li>
<li>Làm thế nào để thực hiện khóa lạc quan và khóa bi quan trong cơ sở dữ liệu?</li>
</ul>
</blockquote>
<p>Để đảm bảo không xảy ra xung đột khi nhiều giao dịch truy cập cùng một dữ liệu trong cơ sở dữ liệu và đảm bảo tính nhất quán của giao dịch, <strong>khóa lạc quan và khóa bi quan là các kỹ thuật chính được sử dụng trong kiểm soát đồng thời</strong>.</p>
<ul>
<li><strong>Khóa bi quan</strong> - Giả định rằng xung đột sẽ xảy ra và ngăn chặn mọi hoạt động có thể vi phạm tính toàn vẹn dữ liệu.
<ul>
<li><strong>Khóa ghi trước khi truy vấn dữ liệu và giữ khóa cho đến khi giao dịch được ghi (COMMIT)</strong>.</li>
<li>Cách thực hiện: Sử dụng cơ chế khóa trong cơ sở dữ liệu.</li>
</ul>
</li>
<li><strong>Khóa lạc quan</strong> - Giả định rằng không có xung đột và chỉ kiểm tra tính toàn vẹn dữ liệu khi thực hiện thao tác ghi.
<ul>
<li><strong>Khóa khi thay đổi dữ liệu và kiểm tra xem có vi phạm tính toàn vẹn dữ liệu khi ghi (COMMIT)</strong>.</li>
<li>Cách thực hiện: Sử dụng phiên bản hoặc dấu thời gian.</li>
</ul>
</li>
</ul>
<h3>Khóa hàng và khóa bảng</h3>
<blockquote>
<ul>
<li>Khóa hàng và khóa bảng là gì?</li>
<li>Khi nào sử dụng khóa hàng? Khi nào sử dụng khóa bảng?</li>
</ul>
</blockquote>
<p>Từ quan điểm về mức độ chi tiết của khóa, MySQL cung cấp hai cấp độ khóa: khóa hàng và khóa bảng.</p>
<ul>
<li><strong>Khóa bảng (table lock)</strong> - Khóa toàn bộ bảng. Trước khi người dùng thực hiện thao tác ghi trên bảng, họ phải lấy khóa ghi trước, điều này sẽ chặn tất cả các hoạt động đọc và ghi của người dùng khác trên bảng đó. Chỉ khi không có khóa ghi, người dùng khác mới có thể lấy khóa đọc, các khóa đọc không tương tác lẫn nhau.</li>
<li><strong>Khóa hàng (row lock)</strong> - Chỉ khóa các bản ghi hàng cụ thể, điều này cho phép các quá trình khác vẫn có thể thao tác trên các bản ghi khác trong cùng một bảng.</li>
</ul>
<p>Hai yếu tố cần cân nhắc:</p>
<ul>
<li><strong>Lượng dữ liệu bị khóa càng nhỏ, tần suất cạnh tranh khóa càng ít và mức độ đồng thời của hệ thống càng cao</strong>.</li>
<li><strong>Độ chi tiết của khóa càng nhỏ thì chi phí hoạt động của hệ thống càng lớn</strong>&nbsp;.</li>
</ul>
<p>Trong <code>InnoDB</code>, khóa hàng được thực hiện bằng cách khóa các mục chỉ mục trên chỉ mục. <strong>Nếu không có chỉ mục, <code>InnoDB</code> sẽ khóa bản ghi thông qua chỉ mục gom nhóm ẩn.</strong></p>
<h3>Khóa đọc và khóa ghi</h3>
<blockquote>
<ul>
<li>Khóa đọc và khóa ghi là gì?</li>
</ul>
</blockquote>
<ul>
<li>Khóa ghi (Exclusive Lock), viết tắt là X Lock, còn được gọi là khóa viết. Cách sử dụng: <code>SELECT … FOR UPDATE;</code></li>
<li>Khóa đọc (Shared Lock), viết tắt là S Lock, còn được gọi là khóa đọc. Cách sử dụng: <code>SELECT … LOCK IN SHARE MODE;</code></li>
</ul>
<p>Mối quan hệ giữa khóa ghi và khóa đọc, nói một cách đơn giản: <strong>Khi có khóa ghi, các giao dịch khác không thể thực hiện bất kỳ hoạt động nào</strong>.</p>
<p><strong>Trong <code>InnoDB</code>, khóa hàng, khóa khoảng trống và khóa next-key đều thuộc loại khóa ghi</strong>.</p>
<h3>Khóa ý chí</h3>
<blockquote>
<ul>
<li>Khóa ý chí là gì?</li>
<li>Khóa ý chí được sử dụng để làm gì?</li>
</ul>
</blockquote>
<p>Khóa ý chí (Intention Lock) được sử dụng để hỗ trợ việc khóa hàng và khóa bảng đồng thời khi cần thiết. Sử dụng khóa ý chí (Intention Lock) giúp dễ dàng hơn trong việc hỗ trợ nhiều cấp độ khóa.</p>
<p><strong>Khóa ý chí được <code>InnoDB</code> tự động thêm vào, không cần sự can thiệp của người dùng</strong>.</p>
<h3>MVCC</h3>
<blockquote>
<p>MVCC là gì?</p>
<p>MVCC được sử dụng để làm gì? Giải quyết vấn đề gì?</p>
<p>Nguyên tắc của MVCC là gì?</p>
</blockquote>
<p>Kiểm soát đồng thời nhiều phiên bản (Multi-Version Concurrency Control, MVCC) là một cách cụ thể mà <code>InnoDB</code> sử dụng để thực hiện các cấp độ cô lập, bao gồm đọc đã xác nhận và đọc lặp lại. Đồng thời, nó giải quyết vấn đề đọc bẩn và đọc không lặp lại.</p>
<p>Nguyên tắc của MVCC là:</p>
<ul>
<li>Lưu trữ bản chụp của dữ liệu tại một thời điểm nhất định. <strong>Các hoạt động ghi (DELETE, INSERT, UPDATE) cập nhật bản chụp phiên bản mới nhất, trong khi các hoạt động đọc lấy bản chụp phiên bản cũ, không có sự tương tác</strong>. Điều này tương tự như cơ chế CopyOnWrite.</li>
<li>Đọc bẩn và đọc không lặp lại là do giao dịch đọc dữ liệu chưa được xác nhận từ các giao dịch khác. Để giải quyết vấn đề này, <strong>MVCC quy định chỉ có thể đọc các bản chụp đã xác nhận</strong>. Một giao dịch có thể đọc bản chụp chưa xác nhận của chính nó, điều này không được coi là đọc bẩn.</li>
</ul>
<h3>Khóa Next-key</h3>
<p>Khóa Next-key (Next-Key Lock) là một cách thức khóa được sử dụng bởi <code>InnoDB</code> trong việc triển khai khóa.</p>
<p>MVCC không thể giải quyết vấn đề đọc không đồng nhất, <strong>khóa Next-key được sử dụng để giải quyết vấn đề đọc không đồng nhất</strong>. Trong cấp độ cô lập đọc lặp lại (REPEATABLE READ), sử dụng <code>MVCC + Next-Key Lock</code> có thể giải quyết vấn đề đọc không đồng nhất.</p>
<p>Ngoài ra, dựa trên điều kiện truy vấn SQL khác nhau, cũng có ba trường hợp khóa cần chú ý.</p>
<ul>
<li>Khóa bản ghi (<code>Record Lock</code>) - <strong>Khóa các mục chỉ mục trên bản ghi, nếu không có chỉ mục, sử dụng khóa bảng</strong>.</li>
<li>Khóa khoảng trống (<code>Gap Lock</code>) - Khóa khoảng trống giữa các mục chỉ mục. Khóa các khoảng trống giữa các mục chỉ mục, nhưng không bao gồm mục chỉ mục chính nó. Ví dụ, khi một giao dịch thực hiện câu lệnh sau, các giao dịch khác không thể chèn giá trị 15 vào cột c trong bảng t. <code>SELECT c FROM t WHERE c BETWEEN 10 and 20 FOR UPDATE;</code></li>
<li>Khóa Next-key (<code>Next-Key Lock</code>) - Kết hợp giữa <code>Record Lock</code> và <code>Gap Lock</code>, khóa kết hợp giữa khóa bản ghi trên một khoảng trống. Nó khóa một khoảng trống mở phía trước và đóng phía sau.</li>
</ul>
<p>Chỉ mục được chia thành hai loại: chỉ mục khóa chính (primary key index) và chỉ mục không phải khóa chính (non-primary key index). Nếu một câu lệnh SQL thao tác trên chỉ mục khóa chính, MySQL sẽ khóa chỉ mục khóa chính đó. Nếu một câu lệnh thao tác trên chỉ mục không phải khóa chính, MySQL sẽ khóa chỉ mục không phải khóa chính đó trước, sau đó khóa chỉ mục khóa chính liên quan. Trong các hoạt động <code>UPDATE</code> và <code>DELETE</code>, MySQL không chỉ khóa tất cả các bản ghi chỉ mục được quét bởi điều kiện <code>WHERE</code>, mà còn khóa các giá trị khóa liền kề, còn được gọi là khóa kế tiếp (next-key lock).</p>
<p>Khi hai giao dịch được thực hiện cùng một lúc, một giao dịch khóa chỉ mục khóa chính và đợi các chỉ mục liên quan. Giao dịch khác khóa chỉ mục không phải khóa chính và đợi chỉ mục khóa chính. Điều này dẫn đến tình trạng xảy ra deadlock. Sau khi xảy ra deadlock, <code>InnoDB</code> thường có thể phát hiện và giải phóng khóa của một giao dịch để quay trở lại trạng thái ban đầu, cho phép giao dịch khác lấy khóa và hoàn thành giao dịch.</p>
<h2>Giao dịch</h2>
<blockquote>
<p>Giao dịch đơn giản là tất cả các hoạt động được thực hiện trong một phiên làm việc (session) phải cùng thành công hoặc cùng thất bại. Cụ thể, giao dịch là một tập hợp các hoạt động thỏa mãn các đặc điểm ACID, có thể được gửi đi bằng cách sử dụng&nbsp;<code>Commit</code>&nbsp;để xác nhận giao dịch hoặc sử dụng&nbsp;<code>Rollback</code>&nbsp;để hoàn tác.</p>
</blockquote>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/185b9c49-4c13-4241-a848-fbff85c03a64.png" alt="185b9c49-4c13-4241-a848-fbff85c03a64.png" tabindex="0" loading="lazy"><figcaption>185b9c49-4c13-4241-a848-fbff85c03a64.png</figcaption></figure>
<h3>ACID</h3>
<p>ACID - Bốn yếu tố cơ bản để thực hiện giao dịch cơ sở dữ liệu một cách chính xác:</p>
<ul>
<li><strong>Tính nguyên tử (Atomicity)</strong></li>
<li><strong>Tính nhất quán (Consistency)</strong></li>
<li><strong>Tính cô lập (Isolation)</strong></li>
<li><strong>Tính bền vững (Durability)</strong></li>
</ul>
<p><strong>Hệ thống cơ sở dữ liệu hỗ trợ giao dịch phải có bốn tính chất này, nếu không, không thể đảm bảo tính chính xác của dữ liệu trong quá trình giao dịch.</strong></p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/acid.png" alt="acid.png" tabindex="0" loading="lazy"><figcaption>acid.png</figcaption></figure>
<h3>Vấn đề nhất quán trong môi trường đồng thời</h3>
<p>Trong môi trường đồng thời, rất khó để đảm bảo tính cô lập của giao dịch, do đó có nhiều vấn đề về nhất quán trong môi trường đồng thời.</p>
<ul>
<li><strong>Mất mát thay đổi</strong></li>
</ul>
<p>Hai giao dịch T1&nbsp;và T2&nbsp;cùng sửa đổi một dữ liệu, T1&nbsp;sửa đổi trước, T2&nbsp;sửa đổi sau, sửa đổi của T2&nbsp;ghi đè lên sửa đổi của T1.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002023.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<ul>
<li><strong>Đọc dữ liệu bẩn (dirty read)</strong></li>
</ul>
<p>T1&nbsp;sửa đổi một dữ liệu, T2&nbsp;đọc dữ liệu này sau đó. Nếu T1&nbsp;hủy bỏ sửa đổi này, dữ liệu mà T2&nbsp;đọc là dữ liệu bẩn.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202307210021321.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<ul>
<li><strong>Đọc không nhất quán (un-repeatable read)</strong></li>
</ul>
<p>T2&nbsp;đọc một dữ liệu, T1&nbsp;sửa đổi dữ liệu này. Nếu T2&nbsp;đọc lại dữ liệu này, kết quả đọc sẽ khác với lần đọc trước.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002326.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<ul>
<li><strong>Đọc dữ liệu ảo (phantom read)</strong></li>
</ul>
<p>T1&nbsp;đọc một phạm vi dữ liệu, T2&nbsp;chèn dữ liệu mới vào phạm vi này, T1&nbsp;đọc lại phạm vi dữ liệu này, kết quả đọc sẽ khác với lần đọc trước.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002333.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Giải pháp cho vấn đề nhất quán trong môi trường đồng thời:</p>
<p>Vấn đề nhất quán trong môi trường đồng thời chủ yếu xuất phát từ việc vi phạm tính cô lập của giao dịch. Giải pháp là sử dụng kiểm soát đồng thời để đảm bảo tính cô lập.</p>
<p>Kiểm soát đồng thời có thể được thực hiện bằng cách sử dụng khóa, nhưng thao tác khóa phức tạp và phụ thuộc vào người dùng tự điều khiển. Hệ quản trị cơ sở dữ liệu cung cấp các cấp độ cô lập giao dịch để người dùng xử lý vấn đề nhất quán trong môi trường đồng thời một cách dễ dàng hơn.</p>
<h3>Mức độ cộ lâp (Isolation Level)</h3>
<p>Cấp độ cô lập cơ sở dữ liệu:</p>
<ul>
<li><strong><code>Đọc chưa cam kết</code>&nbsp;(READ UNCOMMITTED)</strong>&nbsp;- Các sửa đổi trong giao dịch, ngay cả khi chưa được xác nhận, cũng có thể nhìn thấy bởi các giao dịch khác.</li>
<li><strong><code>Đọc đã cam kết</code>&nbsp;(READ COMMITTED)</strong>&nbsp;- Một giao dịch chỉ có thể đọc các sửa đổi đã được xác nhận của các giao dịch khác. Nghĩa là các sửa đổi của một giao dịch trong quá trình thực hiện chưa được nhìn thấy bởi các giao dịch khác.</li>
<li><strong><code>Đọc lặp lại</code>&nbsp;(REPEATABLE READ)</strong>&nbsp;- Đảm bảo kết quả đọc của cùng một dữ liệu trong một giao dịch là như nhau.</li>
<li><strong><code>Tuần tự hoá</code>&nbsp;(SERIALIZABLE)</strong>&nbsp;- Buộc các giao dịch thực hiện tuần tự.</li>
</ul>
<p>Cấp độ cô lập giải quyết các vấn đề nhất quán:</p>
<table>
<thead>
<tr>
<th style="text-align:center">Cấp độ cô lập</th>
<th style="text-align:center">Đọc bẩn</th>
<th style="text-align:center">Đọc không nhất quán</th>
<th style="text-align:center">Đọc dữ liệu ảo</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">Đọc chưa cam kết</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td style="text-align:center">Đã đã cam kết</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td style="text-align:center">Đọc lặp lại</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td style="text-align:center">Tuần tự hoá</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
</tr>
</tbody>
</table>
<h3>Giao dịch phân tán</h3>
<p>Trong một nút dữ liệu duy nhất, giao dịch chỉ giới hạn trong việc kiểm soát truy cập vào tài nguyên cơ sở dữ liệu duy nhất, được gọi là&nbsp;<strong>giao dịch cục bộ</strong>. Hầu hết các hệ quản trị cơ sở dữ liệu quan hệ đã được phát triển cung cấp hỗ trợ gốc cho giao dịch cục bộ.</p>
<p><strong>Giao dịch phân tán</strong>&nbsp;là khi các bên tham gia giao dịch, máy chủ hỗ trợ giao dịch, máy chủ tài nguyên và trình quản lý giao dịch nằm trên các nút khác nhau của hệ thống phân tán.</p>
<h4>Cam kết hai giai đoạn</h4>
<p>Cam kết hai giai đoạn (XA) có ích cho các giao dịch phân tán. Lợi thế lớn nhất của nó là không ảnh hưởng đến người dùng, người dùng có thể sử dụng giao dịch phân tán dựa trên giao thức XA như sử dụng giao dịch cục bộ. Giao thức XA đảm bảo tính&nbsp;<code>ACID</code>&nbsp;của giao dịch.</p>
<p>Đảm bảo tính&nbsp;<code>ACID</code>&nbsp;của giao dịch là một con dao hai lưỡi. Trong quá trình thực hiện giao dịch, tất cả các tài nguyên cần được khóa, điều này phù hợp với giao dịch ngắn thời gian xác định. Đối với giao dịch dài, việc chiếm giữ tài nguyên trong suốt quá trình giao dịch sẽ làm giảm hiệu suất đáng kể đối với hệ thống kinh doanh phụ thuộc vào dữ liệu tập trung. Do đó, trong các tình huống nơi hiệu suất đồng thời là quan trọng nhất, giao dịch phân tán dựa trên giao thức XA không phải là lựa chọn tốt nhất.</p>
<h4>Giao dịch mềm</h4>
<p>Nếu giao dịch thỏa mãn các yếu tố&nbsp;<code>ACID</code>, nó được gọi là giao dịch cứng. Nếu giao dịch dựa trên yếu tố&nbsp;<code>BASE</code>, nó được gọi là giao dịch mềm.&nbsp;<code>BASE</code>&nbsp;là viết tắt của <strong>Basic Availability</strong>, <strong>Soft state</strong> và <strong>Eventual consistency</strong>.</p>
<ul>
<li>Basic Availability đảm bảo các bên tham gia giao dịch không cần phải cùng online.</li>
<li>Soft state cho phép cập nhật trạng thái của hệ thống có một độ trễ nhất định, độ trễ này có thể không thể nhận thấy được bởi khách hàng.</li>
<li>Eventual consistency thường được đảm bảo bằng cách truyền tin nhắn để đảm bảo tính nhất quán của hệ thống.</li>
</ul>
<p>Giao dịch mềm dựa trên yếu tố&nbsp;<code>BASE</code>&nbsp;không phải là giải pháp tối ưu cho tất cả các tình huống. Chỉ khi nó phù hợp nhất với tình huống cụ thể, giao dịch cứng dựa trên yếu tố&nbsp;<code>ACID</code>&nbsp;và giao dịch mềm dựa trên yếu tố&nbsp;<code>BASE</code>&nbsp;mới có thể phát huy tối đa ưu điểm của chúng. Bảng dưới đây so sánh chi tiết giữa các giải pháp giao dịch.</p>
<h4>So sánh các giải pháp giao dịch</h4>
<p>||Giao dịch cục bộ|Hai giai đoạn giao dịch|Giao dịch mềm|<br>
|:</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721113211.png" type="image/png"/>
    </item>
    <item>
      <title>SQL Overview</title>
      <link>https://vanhung4499.github.io/database/sql/overview.html</link>
      <guid>https://vanhung4499.github.io/database/sql/overview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">SQL Overview</source>
      <description>SQL Overview Basic How SQL DB works SQL DB Theory SQL DB Concept SQL DB Design Process SQL Language SQL Syntax Foudation Features Extend SQL SQL Cheat Sheet Interview SQL DB Int...</description>
      <category>db</category>
      <category>sql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Basic</h2>
<ul>
<li><a href="how-sql-db-works">How SQL DB works</a></li>
<li><a href="theory">SQL DB Theory</a></li>
<li><a href="concept">SQL DB Concept</a></li>
<li><a href="db-design-process">SQL DB Design Process</a></li>
</ul>
<h2>SQL Language</h2>
<ul>
<li><a href="syntax-features">SQL Syntax Foudation Features</a></li>
<li><a href="extend-sql">Extend SQL</a></li>
<li><a href="cheat-sheet">SQL Cheat Sheet</a></li>
</ul>
<h2>Interview</h2>
<ul>
<li><a href="interview">SQL DB Interview</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>SQL Syntax Foudation Features</title>
      <link>https://vanhung4499.github.io/database/sql/syntax-features.html</link>
      <guid>https://vanhung4499.github.io/database/sql/syntax-features.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">SQL Syntax Foudation Features</source>
      <description>Các tính năng cơ bản của cú pháp SQL Bài viết này tập trung vào cú pháp cơ bản của ngôn ngữ truy vấn SQL cho cơ sở dữ liệu quan hệ. Vì giới hạn bài viết, chúng tôi tập trung vào...</description>
      <category>db</category>
      <category>sql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Bài viết này tập trung vào cú pháp cơ bản của ngôn ngữ truy vấn SQL cho cơ sở dữ liệu quan hệ. Vì giới hạn bài viết, chúng tôi tập trung vào cách sử dụng, không đi sâu vào các tính năng và nguyên lý.</p>
</blockquote>
<h2>Giới thiệu về SQL</h2>
<h3>Thuật ngữ cơ sở dữ liệu</h3>
<ul>
<li><code>Cơ sở dữ liệu (database)</code> - Là một nơi lưu trữ dữ liệu có tổ chức (thường là một tập tin hoặc một nhóm tập tin).</li>
<li><code>Bảng dữ liệu (table)</code> - Là một danh sách có cấu trúc của một loại dữ liệu cụ thể.</li>
<li><code>Mô hình (schema)</code> - Là thông tin về cách dữ liệu được tổ chức trong cơ sở dữ liệu và bảng. Mô hình xác định cách dữ liệu được lưu trữ trong bảng, bao gồm việc lưu trữ loại dữ liệu nào, cách dữ liệu được phân tách, cách đặt tên thông tin và nhiều thông tin khác. Cả cơ sở dữ liệu và bảng đều có mô hình.</li>
<li><code>Cột (column)</code> - Là một trường trong bảng. Tất cả các bảng đều được tạo thành từ một hoặc nhiều cột.</li>
<li><code>Hàng (row)</code> - Là một bản ghi trong bảng.</li>
<li><code>Khóa chính (primary key)</code> - Là một cột (hoặc một nhóm cột) có giá trị duy nhất để xác định mỗi hàng trong bảng.</li>
</ul>
<h3>Cú pháp SQL</h3>
<blockquote>
<p>SQL (Structured Query Language) là một ngôn ngữ truy vấn có tiêu chuẩn do Ủy ban Tiêu chuẩn ANSI quản lý, do đó được gọi là ANSI SQL. Mỗi hệ quản trị cơ sở dữ liệu (DBMS) có cài đặt riêng của nó, chẳng hạn như PL/SQL, Transact-SQL, v.v.</p>
</blockquote>
<h4>Cấu trúc cú pháp SQL</h4>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/sql-syntax.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Cấu trúc cú pháp SQL bao gồm:</p>
<ul>
<li><strong><code>Mệnh đề (clause)</code></strong> - Là thành phần cấu thành của câu lệnh và truy vấn. (Trong một số trường hợp, chúng là tùy chọn.)</li>
<li><strong><code>Biểu thức (expression)</code></strong> - Có thể tạo ra một giá trị cố định hoặc một bảng dữ liệu từ các cột và hàng trong cơ sở dữ liệu.</li>
<li><strong><code>Tiên đề (predicate)</code></strong> - Xác định điều kiện logic ba giá trị (true/false/unknown) hoặc giá trị boolean để giới hạn hiệu quả của câu lệnh và truy vấn, hoặc thay đổi luồng chương trình.</li>
<li><strong><code>Truy vấn (query)</code></strong> - Truy xuất dữ liệu dựa trên điều kiện cụ thể. Đây là một phần quan trọng của SQL.</li>
<li><strong><code>Câu lệnh (statement)</code></strong> - Có thể ảnh hưởng lâu dài đến cấu trúc và dữ liệu, hoặc điều khiển giao dịch cơ sở dữ liệu, luồng chương trình, kết nối, phiên hoặc chẩn đoán.</li>
</ul>
<h4>Điểm chính của cú pháp SQL</h4>
<ul>
<li><strong>Câu lệnh SQL không phân biệt chữ hoa chữ thường</strong>, nhưng tên bảng, tên cột và giá trị có thể phân biệt tùy thuộc vào DBMS cụ thể và cấu hình.</li>
</ul>
<p>Ví dụ: <code>SELECT</code> và <code>select</code>, <code>Select</code> là như nhau.</p>
<ul>
<li><strong>Nhiều câu lệnh SQL phải được phân tách bằng dấu chấm phẩy (<code>;</code>)</strong>.</li>
<li>Khi xử lý câu lệnh SQL, <strong>tất cả các khoảng trắng đều bị bỏ qua</strong>. Câu lệnh SQL có thể được viết trên một dòng hoặc được chia thành nhiều dòng.</li>
</ul>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Câu lệnh SQL trên một dòng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> user </span><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'robot'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">password</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'robot'</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> username </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Câu lệnh SQL trên nhiều dòng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> user</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'robot'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">password</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'robot'</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> username </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><ul>
<li>SQL hỗ trợ ba cách chú thích</li>
</ul>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">## Chú thích </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Chú thích 2</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">/* Chú thích 3 */</span></span></code></pre>
</div><h4>Phân loại SQL</h4>
<h4>Ngôn ngữ định nghĩa dữ liệu (DDL)</h4>
<p>Ngôn ngữ định nghĩa dữ liệu (Data Definition Language, DDL) là một tập hợp các ngôn ngữ SQL chịu trách nhiệm định nghĩa cấu trúc dữ liệu và đối tượng cơ sở dữ liệu.</p>
<p>DDL có chức năng chính là <strong>định nghĩa đối tượng cơ sở dữ liệu</strong>.</p>
<p>Các chỉ thị cốt lõi của DDL là <code>CREATE</code>, <code>ALTER</code>, <code>DROP</code>.</p>
<h4>Ngôn ngữ điều khiển dữ liệu (DML)</h4>
<p>Ngôn ngữ điều khiển dữ liệu (Data Manipulation Language, DML) được sử dụng để thao tác dữ liệu trong cơ sở dữ liệu, truy cập các đối tượng và dữ liệu trong cơ sở dữ liệu.</p>
<p>DML có chức năng chính là <strong>truy cập dữ liệu</strong>, do đó cú pháp của nó tập trung vào việc <strong>đọc và ghi cơ sở dữ liệu</strong>.</p>
<p>Các chỉ thị cốt lõi của DML là <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>SELECT</code>. Bốn chỉ thị này được gọi chung là CRUD (Create, Read, Update, Delete), tức là tạo, đọc, cập nhật, xóa.</p>
<h4>Ngôn ngữ điều khiển giao dịch (TCL)</h4>
<p>Ngôn ngữ điều khiển giao dịch (Transaction Control Language, TCL) được sử dụng để <strong>quản lý các giao dịch trong cơ sở dữ liệu</strong>. Nó được sử dụng để quản lý các thay đổi được thực hiện bởi các câu lệnh DML. Nó cũng cho phép nhóm các câu lệnh thành các giao dịch logic.</p>
<p>Các chỉ thị cốt lõi của TCL là <code>COMMIT</code>, <code>ROLLBACK</code>.</p>
<h4>Ngôn ngữ điều khiển dữ liệu (DCL)</h4>
<p>Ngôn ngữ điều khiển dữ liệu (Data Control Language, DCL) là một ngôn ngữ truy vấn cho phép <strong>kiểm soát quyền truy cập của người dùng vào các đối tượng cơ sở dữ liệu</strong> như bảng, xem, thủ tục lưu trữ, hàm người dùng và nhiều đối tượng cơ sở dữ liệu khác.</p>
<p>DCL có chức năng chính là <strong>kiểm soát quyền truy cập của người dùng</strong>, do đó cú pháp của nó không phức tạp, quyền kiểm soát có thể được sử dụng bao gồm: <code>CONNECT</code>, <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>, <code>EXECUTE</code>, <code>USAGE</code>, <code>REFERENCES</code>.</p>
<p>Tùy thuộc vào DBMS cụ thể và thực thể bảo mật khác nhau, các quyền kiểm soát được hỗ trợ cũng khác nhau.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/sql-syntax.png" type="image/png"/>
    </item>
    <item>
      <title>SQL DB Theory</title>
      <link>https://vanhung4499.github.io/database/sql/theory.html</link>
      <guid>https://vanhung4499.github.io/database/sql/theory.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">SQL DB Theory</source>
      <description>Những điểm cốt lõi về hệ thống cơ sở dữ liệu Giao dịch (Transaction) Khái niệm Giao dịch là một tập hợp các hoạt động thỏa mãn các đặc tính ACID, có thể được thực hiện bằng cách...</description>
      <category>db</category>
      <category>sql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giao dịch (Transaction)</h2>
<h3>Khái niệm</h3>
<p>Giao dịch là một tập hợp các hoạt động thỏa mãn các đặc tính ACID, có thể được thực hiện bằng cách Commit để xác nhận một giao dịch hoặc sử dụng Rollback để hoàn tác.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/185b9c49-4c13-4241-a848-fbff85c03a64.png" alt="185b9c49-4c13-4241-a848-fbff85c03a64.png" tabindex="0" loading="lazy"><figcaption>185b9c49-4c13-4241-a848-fbff85c03a64.png</figcaption></figure>
<h3>ACID</h3>
<h4>1. Tính nguyên tử (Atomicity)</h4>
<p>Giao dịch được coi là một đơn vị không thể chia tách, tất cả các hoạt động trong giao dịch phải được hoặc hoàn tất thành công hoặc hoàn tác hoàn toàn.</p>
<p>Hoàn tác có thể được thực hiện bằng cách sử dụng nhật ký, ghi lại các hoạt động sửa đổi được thực hiện trong giao dịch và thực hiện ngược lại các hoạt động này khi hoàn tác.</p>
<h4>2. Tính nhất quán (Consistency)</h4>
<p>Cơ sở dữ liệu duy trì trạng thái nhất quán trước và sau khi giao dịch được thực hiện. Trong trạng thái nhất quán, kết quả đọc dữ liệu từ mọi giao dịch đối với một dữ liệu cụ thể là như nhau.</p>
<h4>3. Tính cô lập (Isolation)</h4>
<p>Các sửa đổi được thực hiện bởi một giao dịch không được nhìn thấy bởi các giao dịch khác cho đến khi giao dịch đó được xác nhận.</p>
<h4>4. Tính bền vững (Durability)</h4>
<p>Một khi giao dịch được xác nhận, các sửa đổi được thực hiện trong giao dịch sẽ được lưu trữ vĩnh viễn trong cơ sở dữ liệu. Ngay cả khi hệ thống gặp sự cố, kết quả của giao dịch vẫn không bị mất.</p>
<p>Có thể thực hiện sao lưu và khôi phục cơ sở dữ liệu để đạt được tính bền vững. Khi hệ thống gặp sự cố, có thể sử dụng cơ sở dữ liệu đã sao lưu để khôi phục dữ liệu.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/185b9c49-4c13-4241-a848-fbff85c03a64.png" type="image/png"/>
    </item>
    <item>
      <title>Design Pattern</title>
      <link>https://vanhung4499.github.io/design/design-pattern/</link>
      <guid>https://vanhung4499.github.io/design/design-pattern/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Design Pattern</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Overview</title>
      <link>https://vanhung4499.github.io/design/design-pattern/overview.html</link>
      <guid>https://vanhung4499.github.io/design/design-pattern/overview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Overview</source>
      <description>Tổng quan về mẫu thiết kế Mẫu thiết kế (Design Pattern) đại diện cho các phương pháp tốt nhất thường được sử dụng bởi các nhà phát triển phần mềm có kinh nghiệm. Mẫu thiết kế là...</description>
      <category>design-pattern</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Mẫu thiết kế (Design Pattern) đại diện cho các phương pháp tốt nhất thường được sử dụng bởi các nhà phát triển phần mềm có kinh nghiệm. Mẫu thiết kế là các giải pháp cho các vấn đề chung mà các nhà phát triển phần mềm gặp phải trong quá trình phát triển phần mềm. Những giải pháp này được rút ra từ thời gian dài thử nghiệm và lỗi của nhiều nhà phát triển phần mềm.</p>
</blockquote>
<h2>📖 Nội dung</h2>
<p>Trong tài liệu này, gồm có 2 phần chính:</p>
<ul>
<li>Patterns: Tổng hợp về Design Pattern, lý thuyết và cách triển khai.</li>
<li>Practical: Áp dụng Design Pattern vào thực tế, một số ví dụ cụ thể cho từng mẫu thiết kế. Sử dụng Java để triển khai các mẫu thiết kế.</li>
</ul>
<p>Bạn có thể xem chi tiết từng mẫu thiết kế ở phần Patterns.</p>
<h2>📖 Patterns</h2>
<h3>Creational Patterns</h3>
<blockquote>
<p>Mẫu thiết kế tạo đối tượng cung cấp cơ chế tạo đối tượng, giúp tăng tính linh hoạt và khả năng tái sử dụng của mã hiện có.</p>
</blockquote>
<ul>
<li><a href="patterns/creational/simple-factory">Simple Factory Pattern</a></li>
<li><a href="patterns/creational/factory-method">Factory Method Pattern</a></li>
<li><a href="patterns/creational/abstract-factory">Abstract Factory Pattern</a></li>
<li><a href="patterns/creational/builder">Builder Pattern</a></li>
<li><a href="patterns/creational/prototype">Prototype Pattern</a></li>
<li><a href="patterns/creational/singleton">Singleton Pattern</a></li>
</ul>
<h3>Structural Patterns</h3>
<blockquote>
<p>Mẫu thiết kế cấu trúc giúp tổ chức các đối tượng và lớp thành các cấu trúc lớn hơn, đồng thời duy trì tính linh hoạt và hiệu suất của cấu trúc đó.</p>
</blockquote>
<ul>
<li><a href="patterns/structural/adapter">Adapter Pattern</a></li>
<li><a href="patterns/structural/bridge">Bridge Pattern</a></li>
<li><a href="patterns/structural/composite">Composite Pattern</a></li>
<li><a href="patterns/structural/decorator">Decorator Pattern</a></li>
<li><a href="patterns/structural/facade">Facade Pattern</a></li>
<li><a href="patterns/structural/flyweight">Flyweight Pattern</a></li>
<li><a href="patterns/structural/proxy">Proxy Pattern</a></li>
</ul>
<h3>Behavioral patterns</h3>
<blockquote>
<p>Mẫu thiết kế hành vi đảm nhận trách nhiệm giao tiếp hiệu quả giữa các đối tượng và phân phối trách nhiệm.</p>
</blockquote>
<ul>
<li><a href="patterns/behavioral/template-method">Template Method Pattern</a></li>
<li><a href="patterns/behavioral/command">Command Pattern</a></li>
<li><a href="patterns/behavioral/iterator">Iterator Pattern</a></li>
<li><a href="patterns/behavioral/observer">Observer Pattern</a></li>
<li><a href="patterns/interpreter">Interpreter Pattern</a> Updating!</li>
<li><a href="patterns/behavioral/mediator">Mediator Pattern</a></li>
<li><a href="patterns/behavioral/chain-of-responsibility">Chain Of Responsibility Pattern</a></li>
<li><a href="patterns/behavioral/memento">Memento Pattern</a></li>
<li><a href="patterns/behavioral/strategy">Strategy Pattern</a></li>
<li><a href="patterns/behavioral/visitor">Visitor Pattern</a></li>
<li><a href="patterns/behavioral/state">State Pattern</a></li>
</ul>
<h2>🚚 Thực chiến</h2>
<h3>Creational Patterns</h3>
<blockquote>
<p>Mẫu thiết kế tạo đối tượng cung cấp cơ chế tạo đối tượng, giúp tăng tính linh hoạt và khả năng tái sử dụng của mã hiện có.</p>
</blockquote>
<ul>
<li><a href="practical/creational/simple-factory">Simple Factory Pattern</a></li>
<li><a href="practical/creational/factory-method">Factory Method Pattern</a></li>
<li><a href="practical/creational/abstract-factory">Abstract Factory Pattern</a></li>
<li><a href="practical/creational/builder">Builder Pattern</a></li>
<li><a href="practical/creational/prototype">Prototype Pattern</a></li>
<li><a href="practical/creational/singleton">Singleton Pattern</a></li>
</ul>
<h3>Structural Patters</h3>
<blockquote>
<p>Mẫu thiết kế cấu trúc giúp tổ chức các đối tượng và lớp thành các cấu trúc lớn hơn, đồng thời duy trì tính linh hoạt và hiệu suất của cấu trúc đó.</p>
</blockquote>
<ul>
<li><a href="practical/structural/adapter">Adapter Pattern</a></li>
<li><a href="practical/structural/bridge">Bridge Pattern</a></li>
<li><a href="practical/structural/composite">Composite Pattern</a></li>
<li><a href="practical/structural/decorator">Decorator Pattern</a></li>
<li><a href="practical/structural/facade">Facade Pattern</a></li>
<li><a href="practical/structural/flyweight">Flyweight Pattern</a></li>
<li><a href="practical/structural/proxy">Proxy Pattern</a></li>
</ul>
<h3>Behavioral patterns</h3>
<blockquote>
<p>Mẫu thiết kế hành vi đảm nhận trách nhiệm giao tiếp hiệu quả giữa các đối tượng và phân phối trách nhiệm.</p>
</blockquote>
<ul>
<li><a href="practical/behavioral/template-method">Template Method Pattern</a></li>
<li><a href="practical/behavioral/command">Command Pattern</a></li>
<li><a href="practical/behavioral/iterator">Iterator Pattern</a></li>
<li><a href="practical/behavioral/observer">Observer Pattern</a></li>
<li><a href="practical/interpreter">Interpreter Pattern</a> Updating!</li>
<li><a href="practical/behavioral/mediator">Mediator Pattern</a></li>
<li><a href="practical/behavioral/chain-of-responsibility">Chain Of Responsibility Pattern</a></li>
<li><a href="practical/behavioral/memento">Memento Pattern</a></li>
<li><a href="practical/behavioral/strategy">Strategy Pattern</a></li>
<li><a href="practical/behavioral/visitor">Visitor Pattern</a></li>
<li><a href="practical/behavioral/state">State Pattern</a></li>
</ul>
<h2>📚 Tài liệu</h2>
<ul>
<li><a href="https://www.amazon.com/Head-First-Design-Patterns-Brain-Friendly/dp/0596007124" target="_blank" rel="noopener noreferrer">Head First Design Patterns</a></li>
<li><a href="https://refactoring.guru/design-patterns" target="_blank" rel="noopener noreferrer">Design Patterns</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Docker</title>
      <link>https://vanhung4499.github.io/devops/docker/</link>
      <guid>https://vanhung4499.github.io/devops/docker/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Docker</source>
      <category>Docker</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Git</title>
      <link>https://vanhung4499.github.io/devops/git/</link>
      <guid>https://vanhung4499.github.io/devops/git/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Git</source>
      <category>git</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Kubernetes</title>
      <link>https://vanhung4499.github.io/devops/k8s/</link>
      <guid>https://vanhung4499.github.io/devops/k8s/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Kubernetes</source>
      <category>kubernetes</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Linux</title>
      <link>https://vanhung4499.github.io/devops/linux/</link>
      <guid>https://vanhung4499.github.io/devops/linux/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Linux</source>
      <category>linux</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Algorithm</title>
      <link>https://vanhung4499.github.io/dsa/algo/</link>
      <guid>https://vanhung4499.github.io/dsa/algo/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Algorithm</source>
      <description>Algorithm Info Tổng hợp các thuật toán, chiến lược, suy luận, giải thích và áp dụng giải quyết các ví dụ cụ thể trên LeeCode! Các chủ đề được chia rõ, bạn có thể tìm đến chủ đề ...</description>
      <category>dsa</category>
      <category>algorithm</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<div class="hint-container info">
<p class="hint-container-title">Info</p>
<ul>
<li>Tổng hợp các thuật toán, chiến lược, suy luận, giải thích và áp dụng giải quyết các ví dụ cụ thể trên LeeCode!</li>
<li>Các chủ đề được chia rõ, bạn có thể tìm đến chủ đề bạn quan tâm, không cần phải đọc từ trên xuống dưới!</li>
</ul>
</div>
]]></content:encoded>
    </item>
    <item>
      <title>Data Structure</title>
      <link>https://vanhung4499.github.io/dsa/ds/</link>
      <guid>https://vanhung4499.github.io/dsa/ds/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Data Structure</source>
      <description>Data Structures Info Tổng hợp kiến thức và thực hành với các cấu trúc dữ liệu cơ bản và nâng cao. Hiểu và áp dụng các cấu trúc dữ liệu vào các thuật toán để giải quyết các bài t...</description>
      <category>data-structure</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<div class="hint-container info">
<p class="hint-container-title">Info</p>
<ul>
<li>Tổng hợp kiến thức và thực hành với các cấu trúc dữ liệu cơ bản và nâng cao.</li>
<li>Hiểu và áp dụng các cấu trúc dữ liệu vào các thuật toán để giải quyết các bài toán.</li>
</ul>
</div>
]]></content:encoded>
    </item>
  </channel>
</rss>