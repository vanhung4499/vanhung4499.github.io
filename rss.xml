<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="https://vanhung4499.github.io/rss.xsl"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:dc="http://purl.org/dc/elements/1.1/">
  <channel>
    <atom:link href="https://vanhung4499.github.io/rss.xml" rel="self" type="application/rss+xml"/>
    <title>VanHung4499</title>
    <link>https://vanhung4499.github.io/</link>
    <description>My personal wiki and blog</description>
    <language>en-US</language>
    <pubDate>Thu, 04 Jul 2024 10:42:02 GMT</pubDate>
    <lastBuildDate>Thu, 04 Jul 2024 10:42:02 GMT</lastBuildDate>
    <generator>@vuepress/plugin-feed</generator>
    <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
    <category>java</category>
    <category>any</category>
    <category>about</category>
    <category>blog</category>
    <category>database</category>
    <category>devops</category>
    <category>framework</category>
    <category>programming</category>
    <category>project</category>
    <category>elastic</category>
    <category>elasticssearch</category>
    <category>mongodb</category>
    <category>nosql</category>
    <category>db</category>
    <category>mysql</category>
    <category>redis</category>
    <category>interview</category>
    <item>
      <title>Optional</title>
      <link>https://vanhung4499.github.io/programming/java/java8/optional.html</link>
      <guid>https://vanhung4499.github.io/programming/java/java8/optional.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Optional</source>
      <description>Tối ưu Optional Học hỏi không bao giờ là muộn, đặc biệt là đối với những điều tốt trong Java 8, Optional chính là một trong số đó. Lớp này cung cấp một giải pháp cấp lớp cho việ...</description>
      <category>java</category>
      <pubDate>Thu, 04 Jul 2024 10:38:26 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Học hỏi không bao giờ là muộn, đặc biệt là đối với những điều tốt trong Java 8, Optional chính là một trong số đó. Lớp này cung cấp một giải pháp cấp lớp cho việc biểu diễn giá trị có thể có hoặc không thay vì tham chiếu null. Là một lập trình viên Java, tôi thực sự đã quá chán ngấy với NullPointerException (NPE). Dù tôi quen thuộc với nó như một người bạn cũ, nhưng việc gặp phải nó thật không may — khi chương trình đang sử dụng một đối tượng nhưng lại thấy giá trị của đối tượng đó là null, Java Virtual Machine sẽ nổi giận và ném nó ra như một tội phạm.</p>
<p>Tất nhiên, chúng ta là những người lập trình có trách nhiệm, không thể ngồi im mà không làm gì cả, vì vậy đã có rất nhiều kiểm tra giá trị null. Mặc dù đôi khi các kiểm tra này hoàn toàn không cần thiết, nhưng chúng ta đã quen với nó như một thói quen. Cuối cùng, Java 8 đã không thể chịu đựng được nữa, nên đã giới thiệu Optional, để mã của chúng ta không còn khắc nghiệt và cứng nhắc như vậy nữa.</p>
<h3>01. Vấn đề khi không sử dụng Optional</h3>
<p>Chúng ta hãy mô phỏng một tình huống thực tế. Ngày đầu tiên làm việc, leader giao cho dev nhiệm vụ là từ cơ sở dữ liệu lấy tên của một thành viên dựa trên ID và in tên đó lên console. Mặc dù là mới, nhưng nhiệm vụ này không làm khó được dev, vì vậy anh ta dành 10 phút viết đoạn mã sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> WithoutOptionalDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Member</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> setName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Member</span><span style="color:#E06C75;--shiki-dark:#E06C75"> mem</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getMemberByIdFromDB</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (mem </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">mem</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Member</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getMemberByIdFromDB</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Thành viên có ID hiện tại không tồn tại</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Do thành viên có ID hiện tại không tồn tại, phương thức <code>getMemberByIdFromDB()</code> trả về null để biểu thị rằng không lấy được thành viên này. Điều này đồng nghĩa rằng khi in tên thành viên lên console, bạn phải kiểm tra mem có null không trước, nếu không sẽ có lỗi NPE, không tin? Hãy xóa <code>if (mem != null)</code> và thử lại, console ngay lập tức in ra một đống lỗi để bạn chiêm ngưỡng:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Exception in thread "main" java.lang.NullPointerException</span></span>
<span class="line"><span>	at com.cmower.dzone.optional.WithoutOptionalDemo.main(WithoutOptionalDemo.java:24)</span></span></code></pre>
</div><h3>02. Optional làm thế nào để giải quyết vấn đề này</h3>
<p>Sau khi đã nộp mã, anh ta vui vẻ đi tìm leader để nhận nhiệm vụ mới. Với tinh thần học hỏi khiêm tốn, dev yêu cầu leader xem lại mã của mình. leader sau đó cho biết dev nên thử dùng Optional để tránh các kiểm tra giá trị null không cần thiết. Bây giờ, hãy xem dev đã làm thế nào để giải quyết vấn đề trên bằng Optional.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> OptionalDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Member</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">optional</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getMemberByIdFromDB</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ifPresent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(mem </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Họ và tên thành viên: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> mem</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        });</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Member</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getMemberByIdFromDB</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> hasName</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (hasName) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">of</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Member</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chim Mồi"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">empty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Member</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Member</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // getter / setter</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Phương thức <code>getMemberByIdFromDB()</code> trả về <code>Optional&lt;Member&gt;</code> như một kết quả, cho biết rằng Member có thể tồn tại hoặc không tồn tại, điều này cho phép sử dụng biểu thức Lambda trong phương thức <code>ifPresent()</code> của Optional để in kết quả trực tiếp.</p>
<p>Optional có thể giải quyết vấn đề NPE bởi vì nó rõ ràng cho chúng ta biết không cần phải kiểm tra null. Nó giống như một biển báo ở ngã ba đường, rõ ràng cho bạn biết nên đi hướng nào.</p>
<h3>03. Tạo đối tượng Optional</h3>
<ol>
<li>Có thể sử dụng phương thức tĩnh <code>empty()</code> để tạo một đối tượng Optional rỗng</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> empty </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">empty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(empty);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Output: Optional.empty</span></span></code></pre>
</div><ol start="2">
<li>Có thể sử dụng phương thức tĩnh <code>of()</code> để tạo một đối tượng Optional không rỗng</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> opt </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">of</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chim Mồi"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(opt);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Output: Optional[Chim Mồi]</span></span></code></pre>
</div><p>Tất nhiên, đối số được chuyển cho phương thức <code>of()</code> phải là không rỗng, tức là không được là null, nếu không sẽ vẫn ném ra NullPointerException.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> optnull </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">of</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(name);</span></span></code></pre>
</div><ol start="3">
<li>Có thể sử dụng phương thức tĩnh <code>ofNullable()</code> để tạo một đối tượng Optional có thể rỗng hoặc không rỗng</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> optOrNull </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ofNullable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(name);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(optOrNull);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Output: Optional.empty</span></span></code></pre>
</div><p>Phương thức <code>ofNullable()</code> có một biểu thức ba ngôi bên trong, nếu đối số là null, nó sẽ trả về hằng số EMPTY; nếu không, nó sẽ tạo một đối tượng Optional mới bằng từ khoá new — không bao giờ ném ra NPE nữa.</p>
<h3>04. Kiểm tra giá trị có tồn tại không</h3>
<p>Có thể sử dụng phương thức <code>isPresent()</code> để kiểm tra xem một đối tượng Optional có tồn tại không. Nếu tồn tại, phương thức này trả về true, ngược lại trả về false — thay thế cho việc kiểm tra <code>obj != null</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> opt </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">of</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chim Mồi"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">opt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isPresent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Output: true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> optOrNull </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ofNullable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">optOrNull</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isPresent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Output: false</span></span></code></pre>
</div><p>Từ Java 11 trở đi, bạn có thể sử dụng phương thức <code>isEmpty()</code> để đảo ngược kết quả so với <code>isPresent()</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> opt </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">of</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chim Mồi"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">opt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Output: false</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> optOrNull </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ofNullable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">optOrNull</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Output: true</span></span></code></pre>
</div><h3>05. Biểu thức không rỗng</h3>
<p>Optional có một phương thức hiện đại rất hữu ích là <code>ifPresent()</code>, cho phép chúng ta thực hiện mã nguồn theo cách lập trình hàm, do đó, tôi gọi nó là biểu thức không rỗng. Nếu không có phương thức này, chúng ta thường phải kiểm tra đối tượng Optional trước bằng phương thức <code>isPresent()</code> trước khi thực hiện mã nguồn tương ứng:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> optOrNull </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ofNullable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">optOrNull</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isPresent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">optOrNull</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Khi sử dụng <code>ifPresent()</code>, mọi thứ trở nên khác biệt hoàn toàn, bạn có thể truyền biểu thức Lambda trực tiếp vào phương thức này, mã nguồn trở nên ngắn gọn hơn và rõ ràng hơn.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> opt </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">of</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chim Mồi"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">opt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ifPresent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">str</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()));</span></span></code></pre>
</div><p>Từ Java 9 trở đi, bạn có thể sử dụng phương thức <code>ifPresentOrElse(action, emptyAction)</code> để thực hiện hai loại hành động khác nhau: thực hiện <code>action</code> khi không rỗng và <code>emptyAction</code> khi rỗng.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> opt </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">of</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chim Mồi"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">opt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ifPresentOrElse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">str</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()), () </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đối tượng rỗng"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span></code></pre>
</div><h3>06. Thiết lập (lấy) giá trị mặc định</h3>
<p>Đôi khi khi tạo (lấy) đối tượng Optional, chúng ta cần một giá trị mặc định. Đó là lúc phương thức <code>orElse()</code> và <code>orElseGet()</code> trở nên hữu ích.</p>
<p>Phương thức <code>orElse()</code> được sử dụng để trả về giá trị bao bọc trong đối tượng Optional. Nếu giá trị đó không phải là null, nó trả về giá trị đó; nếu không, nó trả về giá trị mặc định. Kiểu dữ liệu của tham số phải trùng với kiểu dữ liệu của giá trị.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> nullName </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ofNullable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(nullName).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">orElse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chim Mồi"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(name);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Output: Chim Mồi</span></span></code></pre>
</div><p>Phương thức <code>orElseGet()</code> tương tự như <code>orElse()</code>, nhưng tham số là một hàm. Nếu giá trị trong đối tượng Optional là null, hàm này sẽ được thực thi để sinh ra giá trị mặc định.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> nullName </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ofNullable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(nullName).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">orElseGet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(()</span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#98C379;--shiki-dark:#98C379">"Chim Mồi"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(name);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Output: Chim Mồi</span></span></code></pre>
</div><p>So với nhau, các phương thức này rất giống nhau, điều này khiến chúng ta nghi ngờ liệu các nhà thiết kế thư viện Java có cần thiết phải làm như vậy không?</p>
<p>Giả sử có một phương thức nhận giá trị mặc định theo cách truyền thống.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getDefaultValue</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"getDefaultValue"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#98C379;--shiki-dark:#98C379"> "Chim Mồi"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Sau đó, sử dụng <code>orElse()</code> và <code>orElseGet()</code> để lấy giá trị mặc định từ <code>getDefaultValue()</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] args) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"orElse"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ofNullable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(name).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">orElse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getDefaultValue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"orElseGet"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name3 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ofNullable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(name).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">orElseGet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(OrElseOptionalDemo</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">getDefaultValue);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Chú ý: <code>Tên lớp :: Tên phương thức</code> là cú pháp được giới thiệu từ Java 8, không có dấu <code>()</code> sau tên phương thức để chỉ ra rằng phương thức này không nhất định phải được gọi.</p>
<p>Kết quả xuất ra như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">orElse</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">getDefaultValue</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">orElseGet</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">getDefaultValue</span></span></code></pre>
</div><p>Kết quả xuất ra khá giống nhau, không có sự khác biệt đáng kể, bạn đã hiểu được tại sao chưa?</p>
<h3>07. Lấy giá trị</h3>
<p>Về mặt ngữ nghĩa, phương thức <code>get()</code> là phương pháp chính thức nhất để lấy giá trị của đối tượng Optional, nhưng tiếc là phương thức này có một số hạn chế, vì nếu giá trị của Optional là null, phương thức này sẽ ném ra ngoại lệ NoSuchElementException. Điều này hoàn toàn trái ngược với mục đích sử dụng Optional.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> GetOptionalDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">optOrNull</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ofNullable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(name);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">optOrNull</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Đoạn mã này sẽ ném ra ngoại lệ khi thực thi:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Exception in thread "main" java.util.NoSuchElementException: No value present</span></span>
<span class="line"><span>	at java.base/java.util.Optional.get(Optional.java:141)</span></span>
<span class="line"><span>	at com.cmower.dzone.optional.GetOptionalDemo.main(GetOptionalDemo.java:9)</span></span></code></pre>
</div><p>Mặc dù ngoại lệ được ném ra là NoSuchElementException thay vì NullPointerException, nhưng vẫn là một kết quả không mong muốn khi sử dụng Optional. Đề nghị sử dụng phương thức <code>orElseGet()</code> để lấy giá trị của đối tượng Optional.</p>
<h3>08. Lọc giá trị</h3>
<p>Sau khi nâng cấp mã của mình bằng lớp Optional, Xiaowang lại hăng hái chạy tới xin nhiệm vụ với Lão Mã. Lão Mã cảm thấy chàng trai này không tồi, đầu óc minh mẫn và làm việc tích cực, xứng đáng để đào tạo thêm, vì vậy lại giao cho Xiaowang một nhiệm vụ mới: kiểm tra độ dài của mật khẩu khi người dùng đăng ký.</p>
<p>Xiaowang khi nhận nhiệm vụ, rất vui vẻ bởi anh ta mới học được phương thức <code>filter()</code> của lớp Optional, và giờ đây nó sẽ có ích.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FilterOptionalDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> password</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "12345"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">opt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ofNullable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(password);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">opt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">filter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(pwd </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> pwd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isPresent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Tham số của phương thức <code>filter()</code> là một Predicate (một giao diện hàm mà Java 8 giới thiệu), có nghĩa là bạn có thể chuyển một biểu thức Lambda vào phương thức này làm điều kiện. Nếu kết quả của biểu thức là false, phương thức sẽ trả về một Optional rỗng (EMPTY); nếu không, nó trả về Optional đã được lọc.</p>
<p>Trong ví dụ trên, vì độ dài của password là 5, kết quả xuất ra là false. Giả sử yêu cầu độ dài mật khẩu từ 6 đến 10 ký tự, bạn có thể thêm một điều kiện nữa. Hãy xem Xiaowang thêm điều kiện phức tạp hơn vào mã của mình.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Predicate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len6 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pwd </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> pwd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Predicate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len10 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pwd </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> pwd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">password </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "1234567"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">opt </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ofNullable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(password);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> opt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">filter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">len6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">and</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(len10)).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isPresent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(result);</span></span></code></pre>
</div><p>Lần này, kết quả xuất ra là true, vì mật khẩu có 7 ký tự, nằm trong khoảng từ 6 đến 10 ký tự. Hãy tưởng tượng nếu Xiaowang dùng if-else để làm nhiệm vụ này, mã sẽ dài ra sao.</p>
<h3>09. Chuyển đổi giá trị</h3>
<p>Sau khi kiểm tra độ dài mật khẩu, Xiaowang vẫn cảm thấy chưa thỏa mãn, anh ta muốn kiểm tra sức mạnh của mật khẩu, ví dụ như mật khẩu không được là "password", vì mật khẩu như vậy quá yếu. Vì vậy, anh ta lại bắt đầu nghiên cứu về phương thức <code>map()</code>, phương thức này cho phép chuyển đổi đối tượng Optional gốc thành một đối tượng Optional mới theo một quy tắc nhất định, đồng thời đối tượng Optional gốc không thay đổi.</p>
<p>Hãy xem một ví dụ đơn giản mà Xiaowang viết:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> OptionalMapDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "Chim Mồi"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">nameOptional</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">of</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(name);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">intOpt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> nameOptional</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                .</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(String</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">length);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">( </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">intOpt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">orElse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Trong ví dụ trên, tham số của <code>map()</code> là <code>String::length</code>, có nghĩa là chúng ta sẽ tạo một Optional mới từ đối tượng Optional kiểu String ban đầu bằng cách tính độ dài của chuỗi và chuyển đổi nó thành một Optional kiểu Integer.</p>
<p>Sau khi hiểu được cách sử dụng cơ bản của phương thức <code>map()</code>, Xiaowang quyết định kết hợp <code>map()</code> với <code>filter()</code> để sử dụng. Phần đầu dùng để chuyển mật khẩu thành chữ thường, phần sau dùng để kiểm tra độ dài và xem liệu mật khẩu có phải là "password".</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> OptionalMapFilterDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> password</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "password"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;  </span><span style="color:#E06C75;--shiki-dark:#E06C75">opt</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ofNullable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(password);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Predicate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">len6</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> pwd </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> pwd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Predicate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">len10</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> pwd </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> pwd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Predicate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">eq</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> pwd </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> pwd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">equals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"password"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> result</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> opt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(String</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">toLowerCase).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">filter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">len6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">and</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(len10 ).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">and</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(eq)).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isPresent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(result);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Được rồi, các bạn đọc giả thân mến, đây là toàn bộ nội dung của bài viết này!</p>
]]></content:encoded>
    </item>
    <item>
      <title>Stream</title>
      <link>https://vanhung4499.github.io/programming/java/java8/stream.html</link>
      <guid>https://vanhung4499.github.io/programming/java/java8/stream.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Stream</source>
      <description>Java Stream Chỉ từ từ &amp;quot;Stream&amp;quot; này, nghe có vẻ liên quan đến InputStream và OutputStream trong gói java.io phải không? Nhưng thực tế thì không liên quan gì cả. Stream mới của Ja...</description>
      <category>java</category>
      <pubDate>Thu, 04 Jul 2024 10:38:26 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Chỉ từ từ "Stream" này, nghe có vẻ liên quan đến InputStream và OutputStream trong gói <a href="http://java.io" target="_blank" rel="noopener noreferrer">java.io</a> phải không? Nhưng thực tế thì không liên quan gì cả. Stream mới của Java 8 được thiết kế để giải phóng năng suất của lập trình viên khi làm việc với các Collection, và phần lớn thành công đó đến từ Lambda Expression cùng ra đời.</p>
<p>Stream là gì?</p>
<blockquote>
<p>Stream giống như một bộ lặp cao cấp, nhưng chỉ có thể lặp qua một lần, giống như dòng sông xuôi về phía đông; trong quá trình lặp qua, thực hiện các thao tác trên các phần tử của dòng, ví dụ như "lọc bỏ các chuỗi có độ dài lớn hơn 10", "lấy ký tự đầu tiên của mỗi chuỗi" và như thế.</p>
</blockquote>
<p>Để làm việc với Stream, đầu tiên cần có một nguồn dữ liệu, có thể là mảng hoặc bộ sưu tập. Mỗi lần thực hiện thao tác sẽ trả về một stream mới, thuận tiện cho việc thực hiện chuỗi thao tác, nhưng đối tượng stream gốc vẫn được giữ nguyên.</p>
<p>Các hoạt động trên Stream có thể chia thành hai loại:</p>
<ol>
<li>
<p>Thao tác trung gian, có thể có nhiều thao tác, mỗi lần trả về một stream mới để thực hiện chuỗi.</p>
</li>
<li>
<p>Thao tác kết thúc, chỉ có thể có một, mỗi lần thực hiện xong, stream này sẽ bị "dùng sạch", không thể tiếp tục thực hiện thao tác tiếp theo, vì vậy chỉ nên đặt ở cuối cùng.</p>
</li>
</ol>
<p>Hãy xem một ví dụ.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"two"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"three"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"three"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> count </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">distinct</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(count);</span></span></code></pre>
</div><p>Phương thức <code>distinct()</code> là một thao tác trung gian (loại bỏ các phần tử trùng lặp), nó sẽ trả về một stream mới (không có phần tử chung).</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Stream</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">T</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> distinct</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Phương thức <code>count()</code> là một thao tác kết thúc, trả về số lượng phần tử trong stream.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> count</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Các thao tác trung gian không thực hiện ngay lập tức, chỉ khi có thao tác kết thúc, stream mới bắt đầu lặp, được sử dụng cho ánh xạ, lọc, v.v. Nói một cách dễ hiểu hơn là thực hiện nhiều thao tác trong một lần lặp, hiệu suất được cải thiện đáng kể.</p>
<p>Lý thuyết đã nói đủ, bây giờ chúng ta sẽ đi vào phần thực hành ngay.</p>
<h3>01. Tạo stream trong Java</h3>
<p>Nếu là mảng, bạn có thể sử dụng <code>Arrays.stream()</code> hoặc <code>Stream.of()</code> để tạo stream; nếu là một collection, bạn có thể sử dụng phương thức <code>stream()</code> trực tiếp, vì phương thức này đã được thêm vào giao diện Collection.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CreateStreamDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75">arr</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[]{</span><span style="color:#98C379;--shiki-dark:#98C379">"one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"two"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"three"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">};</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">stream</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(arr);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        stream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">of</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"two"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"three"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">list</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"two"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"three"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        stream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Nếu bạn xem mã nguồn của Stream, bạn sẽ thấy phương thức <code>of()</code> thực tế gọi phương thức <code>Arrays.stream()</code> bên trong.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">T</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Stream</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">T</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> of</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">T</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">...</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> values</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(values);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Ngoài ra, bạn có thể sử dụng phương thức <code>parallelStream()</code> của bộ sưu tập để tạo stream song song, mặc định sử dụng <code>ForkJoinPool.commonPool()</code> làm bộ xử lý stream.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Long</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> aList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Long</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> parallelStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> aList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">parallelStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><h3>02. Hoạt động trên Stream</h3>
<p>Lớp Stream cung cấp nhiều phương thức hữu ích để thực hiện các hoạt động trên luồng. Dưới đây là một số phương thức thường được sử dụng.</p>
<h4>1) Lọc (Filter)</h4>
<p>Bạn có thể sử dụng phương thức <code>filter()</code> để lọc ra các phần tử mà bạn muốn từ luồng.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FilterStreamDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">list</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"eat"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"sleep"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"code"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"play"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">stream</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">filter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(element </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> element</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">contains</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"ee"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">forEach</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">println);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Phương thức <code>filter()</code> nhận một đối số kiểu Predicate (một giao diện hàm mới được thêm vào từ Java 8, nhận đầu vào và trả về kết quả boolean), cho phép bạn truyền một biểu thức Lambda như <code>element -&gt; element.contains("ee")</code> để lọc các chuỗi có chứa từ "ee".</p>
<p>Phương thức <code>forEach()</code> nhận một đối số kiểu Consumer (một giao diện hàm mới nhận đầu vào và không có giá trị trả về), và <code>System.out::println</code> là cú pháp mới được giới thiệu từ Java 8, tương đương với vòng lặp <code>for</code> in ra từng phần tử.</p>
<p>Kết quả của chương trình là:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>sleep</span></span></code></pre>
</div><h4>2) Ánh xạ (Map)</h4>
<p>Nếu bạn muốn chuyển đổi các phần tử trong một luồng sang các phần tử khác bằng một phương pháp nào đó, bạn có thể sử dụng phương thức <code>map()</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> MapStreamDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">list</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"eat"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"sleep"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"code"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"play"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">stream</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(String</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">length);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">forEach</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">println);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Phương thức <code>map()</code> nhận một đối số kiểu Function (một giao diện hàm mới nhận đầu vào T và trả về kết quả R), ở đây là <code>String::length</code> để chuyển đổi từ <code>Stream&lt;String&gt;</code> thành <code>Stream&lt;Integer&gt;</code> với độ dài của mỗi chuỗi.</p>
<p>Kết quả của chương trình là:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>3</span></span>
<span class="line"><span>5</span></span>
<span class="line"><span>4</span></span>
<span class="line"><span>4</span></span></code></pre>
</div><h4>3) Kiểm tra (Match)</h4>
<p>Lớp Stream cung cấp ba phương thức để kiểm tra các phần tử:</p>
<ul>
<li><code>anyMatch()</code>: Trả về true nếu có ít nhất một phần tử thỏa mãn điều kiện.</li>
<li><code>allMatch()</code>: Trả về true nếu tất cả các phần tử đều thỏa mãn điều kiện.</li>
<li><code>noneMatch()</code>: Trả về true nếu không có phần tử nào thỏa mãn điều kiện.</li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> MatchStreamDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">list</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"eat"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"sleep"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"code"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"play"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> anyMatchFlag</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">anyMatch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(element </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> element</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">contains</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"ee"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> allMatchFlag</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">allMatch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(element </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> element</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> noneMatchFlag</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">noneMatch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(element </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> element</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">endsWith</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(anyMatchFlag);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(allMatchFlag);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(noneMatchFlag);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vì chuỗi "sleep" bắt có "ee", nên anyMatchFlag sẽ là true; vì độ dài của các chuỗi "eat", "sleep", "code", "play" đều lớn hơn 1, nên allMatchFlag là true; vì không có chuỗi nào kết thúc bằng "abc", nên noneMatchFlag là true.</p>
<p>Kết quả của chương trình là:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>true</span></span>
<span class="line"><span>true</span></span>
<span class="line"><span>true</span></span></code></pre>
</div><h4>4) Tổng hợp (Reduce)</h4>
<p>Phương thức <code>reduce()</code> chủ yếu để kết hợp các phần tử trong Stream lại với nhau. Có hai cách sử dụng:</p>
<ul>
<li><code>Optional&lt;T&gt; reduce(BinaryOperator&lt;T&gt; accumulator)</code>: Không có giá trị khởi đầu, chỉ có một tham số là quy tắc tính toán, trả về Optional.</li>
<li><code>T reduce(T identity, BinaryOperator&lt;T&gt; accumulator)</code>: Có giá trị khởi đầu và quy tắc tính toán, hai tham số, trả về cùng loại với giá trị khởi đầu.</li>
</ul>
<p>Xem ví dụ sau đây.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ReduceStreamDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75">ints</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">};</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">list</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">asList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(ints);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">optional</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">reduce</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((a, b) </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> a </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> b);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">optional1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">reduce</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(Integer</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">sum);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">orElse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">optional1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">orElse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> reduce</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">reduce</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, (a, b) </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> a </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> b);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(reduce);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> reduce1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">reduce</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, Integer</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">sum);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(reduce1);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Quy tắc tính toán có thể là biểu thức Lambda (như <code>(a, b) -&gt; a + b</code>), hoặc <code>Tên lớp::Tên phương thức</code> (như <code>Integer::sum</code>).</p>
<p>Kết quả của chương trình là:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">6</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">6</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">12</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">12</span></span></code></pre>
</div><p>Khi không có giá trị khởi đầu, kết quả của việc cộng các phần tử trong list là 6; khi có giá trị khởi đầu là 6, kết quả là 12.</p>
<h3>03. Chuyển đổi Stream</h3>
<p>Nếu bạn có thể chuyển đổi các mảng hoặc collection thành Stream, thì cũng cần có các phương thức tương ứng để chuyển đổi Stream trở lại — phương thức <code>collect()</code> làm đáp ứng nhu cầu này.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CollectStreamDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">list</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"eat"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"sleep"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"code"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"play"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75">strArray</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[]</span><span style="color:#C678DD;--shiki-dark:#C678DD">::new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(strArray));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">list1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(String</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">length).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">collect</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">list2</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">collect</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toCollection</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(ArrayList</span><span style="color:#C678DD;--shiki-dark:#C678DD">::new</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list1);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list2);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">collect</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">joining</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">", "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Phương thức <code>toArray()</code> có thể chuyển đổi Stream thành mảng, bạn có thể thắc mắc về <code>String[]::new</code>, nó là gì? Hãy xem mã nguồn của <code>toArray()</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">A</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> A</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toArray</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IntFunction</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">A</span><span style="color:#E06C75;--shiki-dark:#E06C75">[]</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> generator)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Điều này có nghĩa là <code>String[]::new</code> là một IntFunction, một hàm có thể tạo ra một mảng mới cần thiết, bạn có thể giải mã mã byte để xem nó thực sự là gì:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] strArray </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[])</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((x$0) </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[x$0];</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">});</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(strArray));</span></span></code></pre>
</div><p>Điều này tương đương với việc trả về một mảng chuỗi có độ dài đã chỉ định.</p>
<p>Khi bạn cần chuyển đổi một bộ sưu tập thành một bộ sưu tập khác theo một quy tắc nào đó, bạn có thể sử dụng <code>map()</code> và <code>collect()</code> cùng nhau.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(String</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">length).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">collect</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span></code></pre>
</div><p>Sau khi tạo luồng từ phương thức <code>stream()</code>, bạn có thể ánh xạ nó thành một luồng mới của độ dài chuỗi bằng <code>map(String:length)</code>, và sau đó chuyển đổi nó thành một bộ sưu tập mới bằng phương thức <code>collect()</code>.</p>
<p>Collectors là một lớp tiện ích cho việc thu thập, nó bao gồm các triển khai thu thập như <code>toList()</code> để thu thập thành một <code>java.util.List</code> mới, <code>toCollection()</code> để thu thập vào một <code>java.util.ArrayList</code> mới, và <code>joining()</code> để thu thập vào một chuỗi được phân tách bằng dấu phẩy.</p>
<p>Dưới đây là kết quả của chương trình:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">[eat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> code</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> play]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">[eat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> code</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> play]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">eat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> code</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> play</span></span></code></pre>
</div>]]></content:encoded>
    </item>
    <item>
      <title>Common Tools</title>
      <link>https://vanhung4499.github.io/programming/java/common-tool/</link>
      <guid>https://vanhung4499.github.io/programming/java/common-tool/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Common Tools</source>
      <pubDate>Thu, 04 Jul 2024 09:37:15 GMT</pubDate>
    </item>
    <item>
      <title>Arrays</title>
      <link>https://vanhung4499.github.io/programming/java/common-tool/arrays.html</link>
      <guid>https://vanhung4499.github.io/programming/java/common-tool/arrays.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Arrays</source>
      <description>Arrays Lớp công cụ chuyên dùng cho mảng mà chúng ta đang nói đến là lớp java.util.Arrays. Hầu hết các thao tác phổ biến trên mảng đều được cung cấp dưới dạng các phương thức tĩn...</description>
      <category>java</category>
      <pubDate>Thu, 04 Jul 2024 09:37:15 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Lớp công cụ chuyên dùng cho mảng mà chúng ta đang nói đến là lớp <code>java.util.Arrays</code>. Hầu hết các thao tác phổ biến trên mảng đều được cung cấp dưới dạng các phương thức tĩnh của lớp này. Vì bản thân mảng để hoàn thành các thao tác này vẫn khá phức tạp, nên có lớp này để bọc lại thì tiện lợi hơn nhiều.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">package</span><span style="color:#C678DD;--shiki-dark:#C678DD"> java.util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">/**</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> * @auther Josh Bloch</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> * @auther Neal Gafter</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> * @auther John Rose</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic">@since</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  1.2</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {}</span></span></code></pre>
</div><p>Cụ thể, các thao tác trên mảng có thể chia thành 9 loại sau.</p>
<ul>
<li>Tạo mảng</li>
<li>So sánh mảng</li>
<li>Sắp xếp mảng</li>
<li>Tìm kiếm trong mảng</li>
<li>Chuyển mảng thành stream</li>
<li>In mảng</li>
<li>Chuyển mảng thành List</li>
<li>setAll (chưa nghĩ ra tên tiếng Việt)</li>
<li>parallelPrefix (chưa nghĩ ra tên tiếng Việt)</li>
</ul>
<h3>01. Tạo Mảng</h3>
<p>Sử dụng lớp <code>Arrays</code> để tạo mảng có thể thông qua ba phương thức sau:</p>
<ul>
<li><code>copyOf</code>: Sao chép mảng được chỉ định, cắt bớt hoặc điền bằng <code>null</code>.</li>
<li><code>copyOfRange</code>: Sao chép mảng trong phạm vi được chỉ định vào một mảng mới.</li>
<li><code>fill</code>: Điền vào mảng.</li>
</ul>
<h4>1) <code>copyOf</code></h4>
<p>Hãy xem ví dụ sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] intro </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] { </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "d"</span><span style="color:#E06C75;--shiki-dark:#E06C75"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] revised </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(intro, </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] expanded </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(intro, </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(revised));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(expanded));</span></span></code></pre>
</div><p><code>revised</code> và <code>expanded</code> là các mảng mới được sao chép, có độ dài lần lượt là 3 và 5, trong khi mảng gốc có độ dài là 4. Xem kết quả đầu ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[a, b, c]</span></span>
<span class="line"><span>[a, b, c, d, null]</span></span></code></pre>
</div><p>Thấy không? <code>revised</code> đã cắt bỏ phần tử cuối cùng vì độ dài là 3, còn <code>expanded</code> được điền thêm một giá trị <code>null</code> vì độ dài là 5.</p>
<p>Phương thức <code>grow()</code> trong mã nguồn của <code>ArrayList</code> (cấu trúc dữ liệu nội bộ sử dụng mảng) cũng gọi phương thức <code>copyOf()</code>. Khi kích thước ban đầu của <code>ArrayList</code> không đáp ứng được sự tăng trưởng của phần tử, nó sẽ mở rộng:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Object</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">grow</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> minCapacity) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#E06C75;--shiki-dark:#E06C75"> elementData </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(elementData, </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newCapacity</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(minCapacity));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><h4>2) <code>copyOfRange</code></h4>
<p>Hãy xem ví dụ sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] intro </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] { </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "d"</span><span style="color:#E06C75;--shiki-dark:#E06C75"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] abridgement </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyOfRange</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(intro, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(abridgement));</span></span></code></pre>
</div><p>Phương thức <code>copyOfRange()</code> cần ba tham số, tham số đầu tiên là mảng được chỉ định, tham số thứ hai là vị trí bắt đầu (bao gồm), tham số thứ ba là vị trí kết thúc (không bao gồm). Xem kết quả đầu ra:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">[a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> c]</span></span></code></pre>
</div><p>Vị trí 0 là "a", vị trí 3 là "d", tức là đã cắt từ vị trí 0 (bao gồm) đến vị trí 3 (không bao gồm) của các phần tử mảng. Vậy nếu chỉ số vượt quá độ dài của mảng thì sao?</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] abridgementExpanded </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyOfRange</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(intro, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(abridgementExpanded));</span></span></code></pre>
</div><p>Vị trí kết thúc là 6, vượt quá độ dài của mảng gốc là 4. Xem kết quả đầu ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[a, b, c, d, null, null]</span></span></code></pre>
</div><p>Vẫn sử dụng <code>null</code> để điền vào.</p>
<p>Tại sao phải làm như vậy?</p>
<p>Tôi nghĩ là nhà thiết kế của <code>Arrays</code> đã tính đến vấn đề vượt quá chỉ số của mảng, nếu không mỗi lần gọi lớp <code>Arrays</code> đều phải kiểm tra độ dài rất nhiều lần, rất phiền phức.</p>
<h4>3) <code>fill</code></h4>
<p>Hãy xem ví dụ sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] stutter </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">fill</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(stutter, </span><span style="color:#98C379;--shiki-dark:#98C379">"abcd"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(stutter));</span></span></code></pre>
</div><p>Sử dụng từ khóa <code>new</code> để tạo một mảng có độ dài là 4, sau đó sử dụng phương thức <code>fill()</code> để điền tất cả 4 vị trí bằng "abcd". Xem kết quả đầu ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[abcd, abcd, abcd, abcd]</span></span></code></pre>
</div><p>Nếu muốn một mảng có các phần tử giống hệt nhau, phương thức <code>fill()</code> sẽ rất hữu ích.</p>
<h3>02. So Sánh Mảng</h3>
<p>Phương thức <code>equals()</code> của lớp <code>Arrays</code> dùng để xác định xem hai mảng có bằng nhau hay không. Hãy xem ví dụ dưới đây:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] intro </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] { </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "d"</span><span style="color:#E06C75;--shiki-dark:#E06C75"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">equals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] { </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"d"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, intro);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(result);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> result1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">equals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] { </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"e"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, intro);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(result1);</span></span></code></pre>
</div><p>Kết quả đầu ra như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>true</span></span>
<span class="line"><span>false</span></span></code></pre>
</div><p>Mảng được chỉ định là "abcd", mảng so sánh là "abcd" và "abce", do đó <code>result</code> là <code>true</code>, còn <code>result1</code> là <code>false</code>.</p>
<p>Hãy xem qua mã nguồn của phương thức <code>equals()</code>:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> equals</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Object</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Object</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] a2) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (a </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#E06C75;--shiki-dark:#E06C75"> a2)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (a </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> ||</span><span style="color:#E06C75;--shiki-dark:#E06C75"> a2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#D19A66;--shiki-dark:#D19A66"> false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> length </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">a2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> !=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> length)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#D19A66;--shiki-dark:#D19A66"> false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">++</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">equals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(a[i], a2[i])</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            return</span><span style="color:#D19A66;--shiki-dark:#D19A66"> false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vì mảng là một đối tượng, nên trước tiên sử dụng toán tử <code>==</code> để kiểm tra. Nếu không bằng nhau, tiếp tục kiểm tra xem có null hay không, nếu một trong hai mảng là null, trả về false. Sau đó kiểm tra độ dài, nếu không bằng nhau, trả về false. Nếu bằng nhau, lần lượt gọi <code>Objects.equals()</code> để so sánh các phần tử ở vị trí tương ứng.</p>
<p>Đoạn mã này rất nghiêm ngặt, đúng không? Đây chính là ý nghĩa của việc học mã nguồn, vừa có thể ngưỡng mộ vừa có thể học hỏi tư duy mã hóa rõ ràng của tác giả mã nguồn.</p>
<p>Ngoài phương thức <code>equals()</code>, còn có một mẹo khác để xác định hai mảng có bằng nhau hay không, mặc dù có thể không chính xác hoàn toàn. Đó là phương thức <code>Arrays.hashCode()</code>. Hãy xem qua mã nguồn của phương thức này:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> hashCode</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Object</span><span style="color:#E06C75;--shiki-dark:#E06C75"> a[]) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (a </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Object</span><span style="color:#E06C75;--shiki-dark:#E06C75"> element </span><span style="color:#C678DD;--shiki-dark:#C678DD">:</span><span style="color:#E06C75;--shiki-dark:#E06C75"> a)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 31</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> *</span><span style="color:#E06C75;--shiki-dark:#E06C75"> result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (element </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ?</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#C678DD;--shiki-dark:#C678DD"> :</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> element</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hashCode</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#E06C75;--shiki-dark:#E06C75"> result</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Thuật toán băm vốn dĩ rất nghiêm ngặt, vì vậy nếu hai mảng có giá trị băm bằng nhau, thì gần như có thể xác định hai mảng đó bằng nhau.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] intro </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] { </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "d"</span><span style="color:#E06C75;--shiki-dark:#E06C75"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hashCode</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(intro));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hashCode</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] { </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"d"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }));</span></span></code></pre>
</div><p>Kết quả đầu ra như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>3910595</span></span>
<span class="line"><span>3910595</span></span></code></pre>
</div><p>Hai mảng có giá trị băm bằng nhau, vì các phần tử giống nhau. Tuy nhiên, cách này không hoàn toàn chính xác, nên ưu tiên sử dụng phương thức <code>Objects.equals()</code>. Khi chúng ta muốn nhanh chóng xác định hai mảng có bằng nhau hay không, có thể so sánh hashCode để xác nhận - một cách làm có lợi và rủi ro cao!</p>
<h3>03. Sắp Xếp Mảng</h3>
<p>Phương thức <code>sort()</code> của lớp <code>Arrays</code> dùng để sắp xếp mảng. Hãy xem ví dụ dưới đây:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] intro1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] { </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "d"</span><span style="color:#E06C75;--shiki-dark:#E06C75"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] sorted </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(intro1, </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">sort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(sorted);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(sorted));</span></span></code></pre>
</div><p>Do việc sắp xếp sẽ thay đổi mảng gốc, nên chúng ta sử dụng phương thức <code>copyOf()</code> để sao chép một bản mới. Kết quả đầu ra như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[a, b, c, d]</span></span></code></pre>
</div><p>Có thể thấy, việc sắp xếp dựa trên thứ tự tăng dần của ký tự đầu tiên. Các kiểu dữ liệu cơ bản được sắp xếp theo thuật toán QuickSort hai trục, còn các kiểu dữ liệu tham chiếu được sắp xếp theo thuật toán TimSort, sử dụng kỹ thuật trong "Sắp xếp lạc quan và độ phức tạp lý thuyết thông tin" của Peter McIlroy.</p>
<h3>04. Tìm Kiếm Trong Mảng</h3>
<p>Sau khi sắp xếp mảng, có thể sử dụng phương thức <code>binarySearch()</code> của lớp <code>Arrays</code> để tìm kiếm nhị phân. Nếu không sắp xếp, chỉ có thể tìm kiếm tuyến tính, hiệu suất sẽ thấp hơn nhiều.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] intro1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] { </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "d"</span><span style="color:#E06C75;--shiki-dark:#E06C75"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] sorted </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(intro1, </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">sort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(sorted);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> exact </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">binarySearch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(sorted, </span><span style="color:#98C379;--shiki-dark:#98C379">"c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(exact);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> caseInsensitive </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">binarySearch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(sorted, </span><span style="color:#98C379;--shiki-dark:#98C379">"C"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, String</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">compareToIgnoreCase);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(caseInsensitive);</span></span></code></pre>
</div><p>Phương thức <code>binarySearch()</code> có thể thực hiện tìm kiếm chính xác hoặc tìm kiếm không phân biệt chữ hoa chữ thường. Kết quả đầu ra như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>3</span></span>
<span class="line"><span>3</span></span></code></pre>
</div><p>Kết quả sắp xếp là <code>[a, b, c, d]</code>, nên chỉ số tìm kiếm được là 3.</p>
<p>"Tam Muội, nhớ là sau này nếu muốn tìm kiếm phần tử trong mảng hoặc tập hợp, nên sắp xếp trước rồi sử dụng tìm kiếm nhị phân để tăng hiệu quả."</p>
<p>Tam Muội gật đầu tỏ vẻ hiểu.</p>
<h3>05. Chuyển Mảng Thành Stream</h3>
<p>Stream là gì vậy?</p>
<p>Stream trong tiếng Anh có nghĩa là dòng chảy. Nó có thể giúp tăng năng suất của lập trình viên Java rất nhiều, cho phép viết mã hiệu quả, sạch sẽ và ngắn gọn. Phong cách này coi tập hợp cần xử lý như một dòng chảy qua các ống dẫn, chúng ta có thể xử lý dòng chảy này trong ống dẫn, ví dụ như lọc, sắp xếp, v.v. <a href="/programming/java/java8/stream">Cách sử dụng Stream cụ thể</a>, chúng ta sẽ để lại sau để nói chi tiết, bây giờ bạn chỉ cần có một ấn tượng chung là được.</p>
<p>Phương thức <code>stream()</code> của lớp <code>Arrays</code> có thể chuyển đổi mảng thành stream:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] intro </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] { </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "d"</span><span style="color:#E06C75;--shiki-dark:#E06C75"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(intro).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span></code></pre>
</div><p>Cũng có thể chỉ định chỉ số bắt đầu và kết thúc cho phương thức <code>stream()</code>:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">stream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(intro, </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span></code></pre>
</div><p>Nếu phạm vi chỉ số sai, ví dụ từ 2 đến 1, chương trình sẽ ném ngoại lệ ArrayIndexOutOfBoundsException:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Exception in thread "main" java.lang.ArrayIndexOutOfBoundsException: origin(2) &gt; fence(1)</span></span>
<span class="line"><span>	at java.base/java.util.Spliterators.checkFromToBounds(Spliterators.java:387)</span></span></code></pre>
</div><h3>06. In Mảng</h3>
<p>Vì mảng là một đối tượng, nếu bạn sử dụng trực tiếp <code>System.out.println</code>, kết quả sẽ như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[Ljava.lang.String;@3d075dc0</span></span></code></pre>
</div><p><a href="/programming/java/array/print.html" target="_blank">Cách in mảng tốt nhất</a> là sử dụng <code>Arrays.toString()</code>, thực ra đã được đề cập trước đây. Hãy xem qua mã nguồn của phương thức này:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> toString</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Object</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] a) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (a </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#98C379;--shiki-dark:#98C379"> "null"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> iMax </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (iMax </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#98C379;--shiki-dark:#98C379"> "[]"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    StringBuilder</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> StringBuilder</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">append</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'['</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">++</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">append</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">valueOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(a[i]));</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#E06C75;--shiki-dark:#E06C75"> iMax)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">append</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">']'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">append</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">", "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>Đầu tiên, kiểm tra null, nếu đúng, trả về chuỗi <code>null</code>;</li>
<li>Lấy độ dài của mảng, nếu độ dài của mảng là 0 (tương đương với length - 1 bằng -1), trả về dấu ngoặc vuông <code>[]</code>, biểu thị mảng rỗng;</li>
<li>Nếu mảng không phải là null và độ dài không phải là 0, khai báo đối tượng StringBuilder, sau đó thêm dấu bắt đầu của mảng <code>[</code>, tiếp theo duyệt qua mảng và thêm từng phần tử vào; một mẹo nhỏ là, khi gặp phần tử cuối cùng (i == iMax), không thêm dấu phẩy và khoảng trắng “, ” mà thêm dấu kết thúc của mảng <code>]</code>.</li>
</ul>
<p>Vì sao khi kiểm tra độ dài của mảng là 0 lại so sánh với -1 sau khi trừ 1? Tại sao không so sánh trực tiếp với 0?</p>
<p>Thực ra là có liên quan đến việc kiểm tra <code>i == iMax</code> khi duyệt mảng, nếu không, phải dùng <code>i == iMax -1</code> để kiểm tra liệu đã đến phần tử cuối cùng của mảng hay chưa.</p>
<h3>07. Chuyển Mảng Thành List</h3>
<p>Dù mảng rất mạnh mẽ, nhưng các phương thức tiện ích mà nó có thể thực hiện lại rất ít, chẳng hạn như kiểm tra xem mảng có chứa một giá trị nào đó hay không. Nếu có thể chuyển đổi thành List, mọi thứ sẽ đơn giản hơn nhiều, vì trong <a href="/programming/java/collection/overview">List</a> của Java có rất nhiều phương thức tiện dụng.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] intro </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] { </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "d"</span><span style="color:#E06C75;--shiki-dark:#E06C75"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> rets </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">asList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(intro);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">rets</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">contains</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"d"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span></code></pre>
</div><p>Tuy nhiên, cần lưu ý rằng, <code>Arrays.asList()</code> trả về <code>java.util.Arrays.ArrayList</code>, không phải là <a href="/programming/java/collection/arraylist"><code>java.util.ArrayList</code></a>, độ dài của nó cố định, không thể xóa hoặc thêm phần tử.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">rets</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"e"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">rets</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"d"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Điều này cần chú ý khi viết mã, nếu không sẽ ném ra ngoại lệ khi thực hiện hai phương thức này:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Exception in thread "main" java.lang.UnsupportedOperationException</span></span>
<span class="line"><span>	at java.base/java.util.AbstractList.add(AbstractList.java:153)</span></span>
<span class="line"><span>	at java.base/java.util.AbstractList.add(AbstractList.java:111)</span></span></code></pre>
</div><p>Nếu muốn thao tác các phần tử, cần chuyển đổi thêm một bước nữa, chuyển thành <code>java.util.ArrayList</code> thực sự:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> rets1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">asList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(intro)</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">rets1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"e"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">rets1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"d"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>08. setAll</h3>
<p>Java 8 đã bổ sung phương thức <code>setAll()</code>, nó cung cấp một điểm vào <a href="/programming/java/java8/lambda">lập trình hàm</a>, có thể dùng để điền giá trị cho các phần tử của mảng:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] array </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setAll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(array, i </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">*</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(array));</span></span></code></pre>
</div><p>i tương đương với chỉ số của mảng, giá trị bắt đầu từ 0 và kết thúc ở 9, do đó <code>i * 10</code> có nghĩa là giá trị bắt đầu từ 0 * 10 đến 9 * 10. Hãy xem kết quả đầu ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[0, 10, 20, 30, 40, 50, 60, 70, 80, 90]</span></span></code></pre>
</div><p>Phương thức này có thể dùng để điền các phần tử mới dựa trên mảng gốc.</p>
<h3>09. <code>parallelPrefix</code></h3>
<p>Phương thức <code>parallelPrefix()</code> giống với phương thức <code>setAll()</code>, đều được cung cấp sau Java 8, và cung cấp một điểm vào cho lập trình hàm. Nó duyệt qua các phần tử trong mảng, thực hiện thao tác giữa phần tử ở vị trí chỉ mục hiện tại với các phần tử trước đó, rồi ghi đè kết quả của thao tác vào vị trí chỉ mục hiện tại.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] arr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] { </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4</span><span style="color:#E06C75;--shiki-dark:#E06C75"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">parallelPrefix</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(arr, (left, right) </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> left </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> right);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(arr));</span></span></code></pre>
</div><p>Đoạn mã trên có một biểu thức Lambda (<code>(left, right) -&gt; left + right</code>), có nghĩa là gì? Đoạn mã này tương đương với:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] arr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] { </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4</span><span style="color:#E06C75;--shiki-dark:#E06C75"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">parallelPrefix</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(arr, (left, right) </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(left </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> "，"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> right);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> left </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> right;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">});</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(arr));</span></span></code></pre>
</div><p>Hãy xem kết quả đầu ra để hiểu rõ hơn:</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>1，2</span></span>
<span class="line"><span>3，3</span></span>
<span class="line"><span>6，4</span></span>
<span class="line"><span>[1, 3, 6, 10]</span></span></code></pre>
</div><p>Có nghĩa là, biểu thức Lambda đã được thực thi ba lần:</p>
<ul>
<li>Lần đầu tiên, cộng 1 và 2, kết quả là 3, thay thế vị trí chỉ mục 1.</li>
<li>Lần thứ hai, cộng 3 và 3, kết quả là 6, nghĩa là kết quả lần đầu tiên cộng với phần tử ở chỉ mục 2.</li>
<li>Lần thứ ba, cộng 6 và 4, kết quả là 10, nghĩa là kết quả lần thứ hai cộng với phần tử ở chỉ mục 3.</li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Collections</title>
      <link>https://vanhung4499.github.io/programming/java/common-tool/collections.html</link>
      <guid>https://vanhung4499.github.io/programming/java/common-tool/collections.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Collections</source>
      <description>Collections Collections là một lớp công cụ do JDK cung cấp, nằm trong gói java.util. Nó cung cấp một loạt các phương thức tĩnh để giúp chúng ta thực hiện các thao tác trên các c...</description>
      <category>any</category>
      <pubDate>Thu, 04 Jul 2024 09:37:15 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Collections là một lớp công cụ do JDK cung cấp, nằm trong gói java.util. Nó cung cấp một loạt các phương thức tĩnh để giúp chúng ta thực hiện các thao tác trên các collection một cách dễ dàng, được coi như là quản gia của framework collection.</p>
<p>Cách sử dụng Collections rất đơn giản. Trong Intellij IDEA, khi bạn gõ <code>Collections.</code> thì sẽ thấy tất cả các phương thức mà nó cung cấp. Chỉ cần nhìn qua tên phương thức và các tham số là bạn có thể biết phương thức đó dùng để làm gì.</p>
<figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/collections-01.png" alt="Collections Methods" tabindex="0" loading="lazy"><figcaption>Collections Methods</figcaption></figure>
<p>Để tiết kiệm thời gian học tập của bạn, tôi đã phân loại các phương thức này và đưa ra một số ví dụ đơn giản.</p>
<h3>01. Các Thao Tác Sắp Xếp</h3>
<ul>
<li><code>reverse(List list)</code>: Đảo ngược thứ tự</li>
<li><code>shuffle(List list)</code>: Trộn ngẫu nhiên thứ tự</li>
<li><code>sort(List list)</code>: Sắp xếp theo thứ tự tăng dần tự nhiên</li>
<li><code>sort(List list, Comparator c)</code>: Sắp xếp theo Comparator tùy chỉnh</li>
<li><code>swap(List list, int i, int j)</code>: Hoán đổi vị trí của hai phần tử tại vị trí i và j</li>
</ul>
<p>Ví dụ:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"two"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"three"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"four"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"five"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Thứ tự ban đầu: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> list);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đảo ngược</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">reverse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Sau khi đảo ngược: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> list);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Trộn ngẫu nhiên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">shuffle</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Sau khi trộn: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> list);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sắp xếp theo thứ tự tự nhiên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">sort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Sau khi sắp xếp tăng dần: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> list);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Hoán đổi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">swap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Sau khi hoán đổi: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> list);</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kết quả đầu ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Thứ tự ban đầu: [one, two, three, four, five]</span></span>
<span class="line"><span>Sau khi đảo ngược: [five, four, three, two, one]</span></span>
<span class="line"><span>Sau khi trộn: [four, one, five, two, three]</span></span>
<span class="line"><span>Sau khi sắp xếp tăng dần: [one, two, three, four, five]</span></span>
<span class="line"><span>Sau khi hoán đổi: [one, two, five, four, three]</span></span></code></pre>
</div><h3>02. Các Thao Tác Tìm Kiếm</h3>
<ul>
<li><code>binarySearch(List list, Object key)</code>: Tìm kiếm nhị phân, yêu cầu List đã được sắp xếp</li>
<li><code>max(Collection coll)</code>: Trả về phần tử lớn nhất</li>
<li><code>max(Collection coll, Comparator comp)</code>: Trả về phần tử lớn nhất dựa trên Comparator tùy chỉnh</li>
<li><code>min(Collection coll)</code>: Trả về phần tử nhỏ nhất</li>
<li><code>min(Collection coll, Comparator comp)</code>: Trả về phần tử nhỏ nhất dựa trên Comparator tùy chỉnh</li>
<li><code>fill(List list, Object obj)</code>: Điền một đối tượng vào tất cả các phần tử trong danh sách</li>
<li><code>frequency(Collection c, Object o)</code>: Đếm số lần xuất hiện của đối tượng trong collection</li>
</ul>
<p>Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Phần tử lớn nhất: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">max</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Phần tử nhỏ nhất: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">min</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Số lần xuất hiện: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">frequency</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list, </span><span style="color:#98C379;--shiki-dark:#98C379">"one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chưa sắp xếp mà gọi binarySearch, kết quả không xác định</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Kết quả tìm kiếm nhị phân trước khi sắp xếp: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">binarySearch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list, </span><span style="color:#98C379;--shiki-dark:#98C379">"one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">sort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sau khi sắp xếp, kết quả tìm kiếm nhị phân chính xác</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Kết quả tìm kiếm nhị phân sau khi sắp xếp: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">binarySearch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list, </span><span style="color:#98C379;--shiki-dark:#98C379">"one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">fill</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list, </span><span style="color:#98C379;--shiki-dark:#98C379">"tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Kết quả sau khi điền: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> list);</span></span></code></pre>
</div><p>Kết quả đầu ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Thứ tự ban đầu: [one, two, three, four, five]</span></span>
<span class="line"><span>Phần tử lớn nhất: five</span></span>
<span class="line"><span>Phần tử nhỏ nhất: one</span></span>
<span class="line"><span>Số lần xuất hiện: 1</span></span>
<span class="line"><span>Kết quả tìm kiếm nhị phân trước khi sắp xếp: -1</span></span>
<span class="line"><span>Kết quả tìm kiếm nhị phân sau khi sắp xếp: 0</span></span>
<span class="line"><span>Kết quả sau khi điền: [tom, tom, tom, tom, tom]</span></span></code></pre>
</div><h3>03. Đồng Bộ Hóa</h3>
<p><a href="/programming/java/collection/hashmap">HashMap không an toàn khi dùng trong đa luồng</a>, chúng ta đã nói về điều này trước đây. Thực ra, ArrayList cũng không an toàn khi dùng trong đa luồng và không thể sử dụng trong môi trường đa luồng. Tuy nhiên, lớp công cụ Collections cung cấp một số phương thức synchronizedXxx để trả về một đối tượng được đồng bộ hóa, từ đó giải quyết vấn đề an toàn khi truy cập collection trong đa luồng.</p>
<figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/collections-02.png" alt="Synchronized Methods" tabindex="0" loading="lazy"><figcaption>Synchronized Methods</figcaption></figure>
<p>Sử dụng cũng rất đơn giản:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> synchronizedList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">synchronizedList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list);</span></span></code></pre>
</div><p>Nhìn vào mã nguồn của SynchronizedList sẽ hiểu ngay, nó chỉ thêm một lớp khóa bằng từ khóa <a href="/programming/java/thread/synchronized-1">synchronized</a> vào các phương thức mà thôi.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> SynchronizedList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">E</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    extends</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> SynchronizedCollection</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">E</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">E</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> serialVersionUID </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">7754090372962971524L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">E</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    SynchronizedList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">E</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        super</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Gọi hàm khởi tạo của lớp cha SynchronizedCollection, truyền vào list</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> list; </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khởi tạo biến thành viên list</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Lấy phần tử tại chỉ mục chỉ định</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> E</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> index</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        synchronized</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (mutex) {</span><span style="color:#C678DD;--shiki-dark:#C678DD">return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(index);} </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Thêm khóa, gọi phương thức get của list để lấy phần tử</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Thêm phần tử tại chỉ mục chỉ định</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> index</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">E</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> element</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        synchronized</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (mutex) {</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(index, element);} </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Thêm khóa, gọi phương thức add của list để thêm phần tử</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Xóa phần tử tại chỉ mục chỉ định</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> E</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> index</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        synchronized</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (mutex) {</span><span style="color:#C678DD;--shiki-dark:#C678DD">return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(index);} </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Thêm khóa, gọi phương thức remove của list để xóa phần tử</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Như vậy, hiệu suất sẽ tương tự như việc sử dụng trực tiếp từ khóa synchronized trên các phương thức của <a href="/programming/java/collection/overview">Vector, Hashtable</a> (đã có từ JDK 1.0), nhưng các lớp collection này hầu như đã bị loại bỏ và ít được sử dụng.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Vector</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">E</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    extends</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> AbstractList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">E</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">E</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> RandomAccess</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Cloneable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> java.io.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Serializable</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Lấy phần tử tại chỉ mục chỉ định</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> synchronized</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> E</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> index</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (index </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> elementCount) </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu chỉ mục vượt quá kích thước của danh sách, ném ra ngoại lệ ArrayIndexOutOfBoundsException</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ArrayIndexOutOfBoundsException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(index);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> elementData</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(index); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Trả về phần tử tại chỉ mục chỉ định</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Xóa phần tử tại chỉ mục chỉ định</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> synchronized</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> E</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> index</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        modCount++; </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đếm số lần sửa đổi, đánh dấu danh sách đã bị thay đổi</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (index </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> elementCount) </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu chỉ mục vượt quá kích thước của danh sách, ném ra ngoại lệ ArrayIndexOutOfBoundsException</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ArrayIndexOutOfBoundsException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(index);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        E</span><span style="color:#E06C75;--shiki-dark:#E06C75"> oldValue</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> elementData</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(index); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy phần tử tại chỉ mục chỉ định</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> numMoved</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> elementCount </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> index </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">; </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tính số phần tử cần di chuyển</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (numMoved </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu cần di chuyển phần tử</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">arraycopy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(elementData, index</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, elementData, index,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                             numMoved); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Di chuyển các phần tử trong mảng về bên trái một vị trí</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        elementData[--elementCount] </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">; </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đặt phần tử cuối cùng thành null để chờ thu hồi bộ nhớ</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> oldValue; </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Trả về phần tử bị xóa</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Cách đúng đắn là sử dụng các lớp trong gói đồng bộ hóa như <a href="/programming/java/thread/CopyOnWriteArrayList">CopyOnWriteArrayList</a> và <a href="/programming/java/thread/ConcurrentHashMap">ConcurrentHashMap</a>. Chúng ta sẽ bàn về những vấn đề này khi nói về lập trình đồng bộ hóa.</p>
<h3>04. Tập Hợp Không Thay Đổi</h3>
<ul>
<li><code>emptyXxx()</code>：Tạo một tập hợp không thay đổi rỗng.</li>
<li><code>singletonXxx()</code>：Tạo một tập hợp không thay đổi chỉ chứa một phần tử.</li>
<li><code>unmodifiableXxx()</code>：Tạo một tập hợp không thay đổi từ tập hợp đã cho.</li>
</ul>
<p>Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> emptyList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">emptyList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">emptyList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Không Rỗng"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Dòng mã này sẽ gây ra lỗi khi thực thi.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(emptyList);</span></span></code></pre>
</div><p>Khi thực thi đoạn mã này, sẽ có một ngoại lệ được ném ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Exception in thread "main" java.lang.UnsupportedOperationException</span></span>
<span class="line"><span>	at java.util.AbstractList.add(AbstractList.java:148)</span></span>
<span class="line"><span>	at java.util.AbstractList.add(AbstractList.java:108)</span></span>
<span class="line"><span>	at com.itwanger.s64.Demo.main(Demo.java:61)</span></span></code></pre>
</div><p>Lý do là <code>Collections.emptyList()</code> trả về một lớp trong nội bộ của Collections là EmptyList, và EmptyList không override phương thức <code>add(int index, E element)</code> của lớp cha AbstractList. Do đó, khi thực thi, nó sẽ ném ra ngoại lệ UnsupportedOperationException vì không hỗ trợ thao tác này.</p>
<p>Điều này được suy ra từ việc phân tích mã nguồn của phương thức add. Ngoài ra, phương thức emptyList là final và EMPTY_LIST được trả về cũng là final, cho thấy rõ rằng emptyList trả về một đối tượng không thay đổi và không thể thực hiện các thao tác thêm, xóa, sửa.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">T</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> List</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">T</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> emptyList</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">T</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">) EMPTY_LIST</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> List</span><span style="color:#E06C75;--shiki-dark:#E06C75"> EMPTY_LIST </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> EmptyList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>05. Khác</h3>
<p>Còn hai phương thức khác thường được sử dụng:</p>
<ul>
<li><code>addAll(Collection&lt;? super T&gt; c, T... elements)</code>: Thêm các phần tử vào tập hợp.</li>
<li><code>disjoint(Collection&lt;?&gt; c1, Collection&lt;?&gt; c2)</code>: Kiểm tra xem hai tập hợp có phần tử chung hay không.</li>
</ul>
<p>Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> allList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">addAll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(allList, </span><span style="color:#98C379;--shiki-dark:#98C379">"nine"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">"ten"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">"one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Sau khi thêm vào allList: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> allList);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Hai tập hợp không có phần tử chung: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">disjoint</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list, allList) </span><span style="color:#C678DD;--shiki-dark:#C678DD">?</span><span style="color:#98C379;--shiki-dark:#98C379"> "Có"</span><span style="color:#C678DD;--shiki-dark:#C678DD"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Không"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span></code></pre>
</div><p>Sau khi thực thi:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Danh sách ban đầu: [one, two, three, four, five]</span></span>
<span class="line"><span>Sau khi thêm vào allList: [nine, ten, one]</span></span>
<span class="line"><span>Hai tập hợp không có phần tử chung: Không</span></span></code></pre>
</div><h3>06. CollectionUtils: Các lớp tiện ích cho tập hợp từ Spring và Apache</h3>
<p>Ngoài các công cụ từ JDK như <code>Collections</code>, <code>CollectionUtils</code> từ Spring và Apache cũng rất phổ biến.</p>
<p>Hiện tại, phổ biến nhất là <code>CollectionUtils</code> trong gói <code>org.springframework.util</code> của Spring.</p>
<figure><img src="https://cdn.tobebetterjavaer.com/stutymore/utils-20230330101919.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Và <code>CollectionUtils</code> trong gói <code>org.apache.commons.collections</code> của Apache.</p>
<figure><img src="https://cdn.tobebetterjavaer.com/stutymore/utils-20230330103825.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Các Maven coordinates như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;commons-collections4&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;version&gt;4.4&lt;/version&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre>
</div><p>Các phương thức từ Apache nhiều hơn so với Spring, chúng ta sẽ lấy ví dụ với Apache để giới thiệu một số phương thức thông dụng.</p>
<h4>Kiểm tra tập hợp có rỗng hay không</h4>
<p>Sử dụng phương thức <code>isEmpty</code> của <code>CollectionUtils</code> để dễ dàng kiểm tra tập hợp có rỗng không, và <code>isNotEmpty</code> để kiểm tra tập hợp không rỗng.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">CollectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tập hợp rỗng"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">CollectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNotEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tập hợp không rỗng"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><h4>Thao tác với hai tập hợp</h4>
<p>Đôi khi chúng ta cần thực hiện các thao tác như lấy hợp, giao, hay bù của hai tập hợp đã có.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy hợp của hai tập hợp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collection</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> unionList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CollectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">union</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list1, list2);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(unionList);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy giao của hai tập hợp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collection</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> intersectionList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CollectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">intersection</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list1, list2);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(intersectionList);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy bù của giao của hai tập hợp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collection</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> disjunctionList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CollectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">disjunction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list1, list2);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(disjunctionList);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy hiệu của hai tập hợp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collection</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> subtractList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CollectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">subtract</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list1, list2);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(subtractList);</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kết quả thực thi:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span></span></code></pre>
</div><p>Thật sự, trong thực tế làm việc, thao tác với hai tập hợp như vậy rất phổ biến, đặc biệt là trong các kịch bản xử lý hàng loạt. Trước đây chúng ta cần phải viết rất nhiều mã, nhưng giờ có thể sử dụng các thư viện có sẵn.</p>
<h3>07. Tổng Kết</h3>
<p>Tổng quan, lớp tiện ích <code>Collections</code> là người quản lý lớn của khuôn khổ tập hợp, cung cấp các phương thức rất tiện lợi để chúng ta gọi và dễ dàng để hiểu, không có gì khó khăn, chỉ cần xem chú thích của phương thức là có thể hiểu được nó làm gì.</p>
<p>Tuy nhiên, công cụ đâu đó, cách sử dụng nó lại là vấn đề khác. Khả năng nâng cao kỹ năng lập trình của bạn, phụ thuộc lớn vào việc bạn có khai thác mã nguồn của chúng, xem cách các bậc thầy thiết kế JDK viết mã, học một vài kỹ thuật, trong công việc thực tế, bạn có thể nổi bật nhanh chóng.</p>
<p>Có lẽ những người thiết kế JDK mới là giáo viên tốt nhất trên thế giới này, tài liệu viết rất chi tiết, mã viết rất sáng sủa, hầu như đã đạt đến điểm tối ưu về hiệu suất.</p>
<p>Có thể có người nói rằng, lớp tiện ích không có gì giá trị, chỉ là gọi phương thức thôi, nhưng đó là sai lầm lớn: nếu bạn được yêu cầu viết, liệu bạn có viết được một lớp tiện ích như Collections không?</p>
<p>Đó là câu hỏi mà những người giỏi cần suy nghĩ.</p>
]]></content:encoded>
      <enclosure url="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/collections-01.png" type="image/png"/>
    </item>
    <item>
      <title>Guava</title>
      <link>https://vanhung4499.github.io/programming/java/common-tool/guava.html</link>
      <guid>https://vanhung4499.github.io/programming/java/common-tool/guava.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Guava</source>
      <description>Guava Quá khứ và hiện tại Guava được Google công bố mã nguồn mở và hiện đã có 49k người hâm mộ trên GitHub, chứng tỏ sự phổ biến của guava. Guava chủ yếu bao gồm các mô-đun phổ ...</description>
      <category>java</category>
      <pubDate>Thu, 04 Jul 2024 09:37:15 GMT</pubDate>
      <content:encoded><![CDATA[
<h3>Quá khứ và hiện tại</h3>
<p><a href="https://github.com/google/guava" target="_blank" rel="noopener noreferrer">Guava</a> được Google công bố mã nguồn mở và hiện đã có 49k người hâm mộ trên GitHub, chứng tỏ sự phổ biến của guava.</p>
<p>Guava chủ yếu bao gồm các mô-đun phổ biến sau: collection [collections], bộ đệm [caching], hỗ trợ kiểu nguyên thủy [primitives support], thư viện đồng bộ [concurrency libraries], annotations thông thường [common annotations], xử lý chuỗi [string processing], I/O, vv. Phiên bản JDK mới đã trực tiếp tích hợp guave, cho thấy sự xuất sắc của guava!</p>
<p>Nếu biết cách sử dụng guava một cách hiệu quả, bạn sẽ viết mã nhanh hơn và đẹp hơn trong lập trình!</p>
<h3>02. Đưa Guava vào dự án</h3>
<p>Nếu bạn đang sử dụng dự án Maven, bạn cần thêm dependency của guava vào file pom.xml.</p>
<div class="language-xml" data-ext="xml" data-title="xml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">dependency</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">groupId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;com.google.guava&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75">groupId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">artifactId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;guava&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75">artifactId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">version</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;30.1-jre&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75">version</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75">dependency</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span></code></pre>
</div><p>Yêu cầu JDK phiên bản 8 trở lên.</p>
<h3>03. Công cụ cơ bản</h3>
<p>Doug Lea, tác giả của gói java.util.concurrent, từng nói: null thật sự tồi tệ". Tony Hoare, nhà đoạt giải Turing và tác giả của thuật toán sắp xếp nhanh, cũng là người sáng lập ra null, cũng từng có câu nói tương tự: "Việc sử dụng null khiến guava mất đi một tỷ USD". Vì vậy, guava sử dụng Optional để biểu thị đối tượng có thể là null.</p>
<p>Đoạn mã ví dụ như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> possible </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Optional</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">of</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">possible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isPresent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // trả về true</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">possible</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // trả về 5</span></span></code></pre>
</div><p>Optional của guava là abstract, có nghĩa là có thể có các lớp con; Optional của JDK là final, không thể có lớp con.<br>
Optional của guava thực hiện Serializable interface để có thể serialize; Optional của JDK không hỗ trợ điều này.<br>
Một số phương thức của guava và JDK cũng khác nhau.</p>
<p>Việc sử dụng Optional không chỉ cấp cho null một ý nghĩa mà còn tăng tính đọc của mã. Điểm mạnh nhất của Optional là nó là một lớp bảo vệ đơn giản. Optional bắt buộc bạn suy nghĩ một cách tích cực về trường hợp tham chiếu không có mặt, vì bạn phải rõ ràng lấy tham chiếu từ Optional.</p>
<p>Ngoài Optional, guava còn cung cấp:</p>
<ul>
<li>Kiểm tra tham số</li>
<li>Các phương thức thông thường của đối tượng, ví dụ như Objects.equals, Objects.hashCode, lớp Objects được JDK 7 giới thiệu cũng cung cấp các phương thức tương tự, dường như cũng là từ guava mà ra.</li>
<li>Bộ so sánh mạnh mẽ hơn</li>
</ul>
<h3>04. Collection</h3>
<p>Đầu tiên, tôi sẽ giải thích tại sao cần có các collection không thay đổi.</p>
<ul>
<li>Đảm bảo an toàn luồng. Trong các chương trình đồng thời, việc sử dụng collection không thay đổi không chỉ đảm bảo tính an toàn của luồng mà còn tăng đáng kể hiệu suất khi chạy đồng thời (so với việc sử dụng khóa đồng thời).</li>
<li>Nếu một đối tượng không cần hỗ trợ các thao tác sửa đổi, các collection không thay đổi sẽ tiết kiệm được không gian và thời gian.</li>
<li>Có thể coi chúng như các hằng số và các đối tượng trong collection sẽ không bao giờ bị thay đổi sau này.</li>
</ul>
<p>So với các collection không thay đổi được cung cấp trong JDK, collection Immutable mà guava cung cấp mới là thực sự không thay đổi. Tại sao lại như vậy? Hãy xem ví dụ dưới đây.</p>
<p>Mã dưới đây sử dụng <code>Collections.unmodifiableList(list)</code> của JDK để nhận một danh sách không thể sửa đổi từ <code>list</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ArrayList</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Lê Cân"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Quyển Châu"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#E06C75;--shiki-dark:#E06C75"> unmodifiableList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">unmodifiableList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">unmodifiableList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Mã Vân"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Khi chạy mã, sẽ nhận được exception sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Exception in thread "main" java.lang.UnsupportedOperationException</span></span>
<span class="line"><span>	at java.base/java.util.Collections$UnmodifiableCollection.add(Collections.java:1060)</span></span>
<span class="line"><span>	at com.itwanger.guava.NullTest.main(NullTest.java:29)</span></span></code></pre>
</div><p>Tốt lắm, việc gọi <code>unmodifiableList.add()</code> đã gây ra exception UnsupportedOperationException, cho thấy <code>Collections.unmodifiableList()</code> đã trả về một danh sách không thể sửa đổi. Nhưng liệu thực sự là như vậy không?</p>
<p>Bạn có thể thay thế <code>unmodifiableList.add()</code> bằng <code>list.add()</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ArrayList</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Lê Cân"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Quyển Châu"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#E06C75;--shiki-dark:#E06C75"> unmodifiableList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">unmodifiableList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Mã Vân"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Khi chạy lại, chương trình không báo lỗi và bạn sẽ thấy rằng <code>unmodifiableList</code> thực sự đã thêm một phần tử mới. Điều này có ý nghĩa gì?</p>
<p>Phương thức <code>Collections.unmodifiableList(...)</code> thực sự không tạo ra một collection không thay đổi hoàn chỉnh; khi danh sách gốc bị thay đổi, các phần tử trong danh sách không thay đổi cũng sẽ thay đổi theo.</p>
<p>guava sẽ không mắc lỗi này, hãy xem đoạn mã dưới đây.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> stringArrayList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Lê Cân"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Quyển Châu"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ImmutableList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> immutableList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ImmutableList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(stringArrayList);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">immutableList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Mã Vân"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Khi cố gắng gọi <code>immutableList.add()</code>, nó sẽ ném ra <code>UnsupportedOperationException</code>. guava đã đánh dấu phương thức <code>add()</code> trong mã nguồn là lỗi cũ.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">/**</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  * Đảm bảo ném ra exception và không làm thay đổi collection.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  *</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic">@throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;font-style:italic;--shiki-dark-font-style:italic"> UnsupportedOperationException</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> luôn luôn ném ra exception này.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic">@deprecated</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> Thao tác không được hỗ trợ.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  */</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">CanIgnoreReturnValue</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Deprecated</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> add</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">E</span><span style="color:#E06C75;--shiki-dark:#E06C75"> e) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> UnsupportedOperationException</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Khi cố gắng thay đổi <code>stringArrayList.add()</code>, collection không thay đổi <code>immutableList</code> sẽ không bị ảnh hưởng bởi điều này.</p>
<p>Ngoài các collection không thay đổi, guava cũng cung cấp các loại collection mới như:</p>
<ul>
<li>Multiset, có thể thêm nhiều phần tử giống nhau. Khi xem Multiset như một Collection thông thường, nó hoạt động giống như ArrayList không có thứ tự; khi xem Multiset như <code>Map&lt;E, Integer&gt;</code>, nó cung cấp các thao tác truy vấn phù hợp với hiệu suất mong đợi.</li>
<li>Multimap, dễ dàng ánh xạ một khóa sang nhiều giá trị.</li>
<li>BiMap, một loại Map đặc biệt, có thể dùng <code>inverse()</code> để đảo ngược ánh xạ khóa giá trị trong <code>BiMap&lt;K, V&gt;</code>; đảm bảo giá trị là duy nhất, do đó <code>values()</code> trả về Set thay vì Collection thông thường.</li>
</ul>
<h3>05. Xử lý chuỗi</h3>
<p>Chuỗi là một dãy không thể thay đổi các ký tự sau khi đã được tạo ra. Trong công việc hàng ngày của chúng ta, việc sử dụng chuỗi rất phổ biến, và việc thao tác thành thạo trên chúng có thể cực kỳ gia tăng hiệu suất làm việc của chúng ta.</p>
<p>guava cung cấp một công cụ nối chuỗi gọi là Joiner, có thể nối các chuỗi lại với nhau bằng một ký tự phân tách. Đoạn mã dưới đây sẽ trả về "Lê Cân; Quyển Châu", bạn có thể sử dụng phương thức <code>useForNull(String)</code> để thay thế null bằng một chuỗi nào đó, thay vì bỏ qua null như phương thức <code>skipNulls()</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Joiner</span><span style="color:#E06C75;--shiki-dark:#E06C75"> joiner </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Joiner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">on</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"; "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">skipNulls</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> joiner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Lê Cân"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Quyển Châu"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>guava cũng cung cấp một công cụ tách chuỗi gọi là Splitter, có thể tách một chuỗi thành các phần với một ký tự phân tách cụ thể.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Splitter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">on</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">','</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        .</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">trimResults</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        .</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">omitEmptyStrings</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        .</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">split</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Lê Cân, Quyển Châu,,   Mã Vân"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>06. Bộ nhớ cache</h3>
<p>Bộ nhớ cache có ích trong nhiều tình huống khác nhau. Bạn nên biết rằng chi phí để truy xuất một giá trị có thể rất cao, đặc biệt là khi cần truy xuất giá trị nhiều lần, lúc đó nên cân nhắc sử dụng bộ nhớ cache.</p>
<p>Guava cung cấp Cache và nó khá giống với ConcurrentMap, nhưng không hoàn toàn giống. Sự khác biệt cơ bản nhất là ConcurrentMap sẽ giữ tất cả các phần tử đã thêm cho đến khi chúng được loại bỏ một cách rõ ràng. Ngược lại, Cache mà guava cung cấp sẽ tự động loại bỏ các phần tử để giới hạn sử dụng bộ nhớ.</p>
<p>Nếu bạn sẵn lòng tiêu tốn một số không gian bộ nhớ để cải thiện tốc độ, và bạn có thể dự đoán rằng một số key sẽ được truy vấn nhiều hơn một lần, và tổng số dữ liệu trong cache không vượt quá dung lượng bộ nhớ, thì bạn có thể sử dụng Cache.</p>
<p>Hãy xem một ví dụ để cảm nhận.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Test</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> testCache</span><span style="color:#E06C75;--shiki-dark:#E06C75">() throws ExecutionException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> InterruptedException {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    CacheLoader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> cacheLoader </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CacheLoader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Animal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Nếu không tìm thấy phần tử, phương thức này sẽ được gọi</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Animal</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> load</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> s</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            return</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    LoadingCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Animal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> loadingCache </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CacheBuilder</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newBuilder</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        .</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">maximumSize</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Dung lượng</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        .</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">expireAfterWrite</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">TimeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">SECONDS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Thời gian hết hạn</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        .</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">removalListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> MyRemovalListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">())</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Lắng nghe khi loại bỏ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        .</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">build</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(cacheLoader);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> //</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    loadingCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chó"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Animal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Vượng Cái"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    loadingCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Mèo"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Animal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tảo Mễ"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    loadingCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Sói"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Animal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Huy Tai Lô"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    loadingCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">invalidate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Mèo"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tự động loại bỏ</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Animal</span><span style="color:#E06C75;--shiki-dark:#E06C75"> animal </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> loadingCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Sói"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(animal);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> *</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Sói đã hết hạn, lấy giá trị null sẽ báo lỗi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">loadingCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Sói"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">/**</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> * Lớp lắng nghe khi loại bỏ cache</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> MyRemovalListener</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> RemovalListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Animal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> onRemoval</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">RemovalNotification</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Animal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">notification</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> reason</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key=%s,value=%s,reason=%s"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">notification</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getKey</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(), </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">notification</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getValue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(), </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">notification</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getCause</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(reason);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Animal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Integer</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Animal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">age</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>CacheLoader đã được viết lại phương thức load, phương thức này sẽ được gọi khi cache không trúng key, ở đây guava chỉ đơn giản trả về null, thực tế sẽ có thông tin ngoại lệ trả về CacheLoader returned null for key.</p>
<p>MyRemovalListener là lớp lắng nghe sự kiện khi các phần tử cache bị loại bỏ, phương thức này là đồng bộ, nếu nó mất nhiều thời gian, nó sẽ chặn đến khi hoàn tất xử lý.</p>
<p>LoadingCache là đối tượng chính để thao tác với cache, phương thức phổ biến là put và get.</p>
<h3>07. Công cụ cho các tập hợp</h3>
<p>Các công cụ tập hợp trong gói <code>com.google.common.collect</code>, ví dụ như <code>Lists</code>, cũng rất mạnh mẽ.</p>
<h4>Tạo tập hợp rỗng</h4>
<p>Đôi khi, chúng ta muốn tạo một tập hợp rỗng. Bạn có thể sử dụng phương thức <code>newArrayList</code> của Lists, ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><h4>Khởi tạo nhanh tập hợp</h4>
<p>Đôi khi, chúng ta muốn khởi tạo một tập hợp với một số phần tử. Đây là cách sử dụng phương thức <code>newArrayList</code> của Lists:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Kết quả thực thi:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span></span></code></pre>
</div><h4>Tích Descartes</h4>
<p>Nếu bạn muốn tính toán <code>tích Descartes</code> của hai tập hợp, phương thức <code>cartesianProduct</code> của Lists có thể giúp bạn:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> productList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">cartesianProduct</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list1,list2);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(productList);</span></span></code></pre>
</div><p>Kết quả thực thi:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">[[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> [</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> [</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> [</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> [</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> [</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span><span style="color:#E06C75;--shiki-dark:#E06C75">]]</span></span></code></pre>
</div><h4>Phân trang</h4>
<p>Nếu bạn muốn chia một <code>tập hợp lớn</code> thành các <code>tập hợp con nhỏ</code>, bạn có thể sử dụng phương thức <code>partition</code> của Lists:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> partitionList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">partition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(partitionList);</span></span></code></pre>
</div><p>Kết quả thực thi:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">[[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> [</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> [</span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#E06C75;--shiki-dark:#E06C75">]]</span></span></code></pre>
</div><p>Trong ví dụ này, list có 5 phần tử, guava đã chia list thành 3 phần, mỗi phần có kích thước là 2.</p>
<p>Đây là một trong những phương thức tôi thích nhất, thường xuyên sử dụng trong các dự án.</p>
<p>Ví dụ, nếu bạn có yêu cầu: hiện có 5000 id, cần gọi API truy vấn người dùng theo lô để lấy dữ liệu người dùng. Nhưng nếu bạn trực tiếp truy vấn 5000 người dùng, thời gian phản hồi của API một lần có thể rất chậm. Nếu chuyển sang xử lý phân trang, mỗi lần chỉ truy vấn 500 người dùng, gọi API bất đồng bộ 10 lần, sẽ không có vấn đề về thời gian phản hồi của API một lần.</p>
<h4>Xử lý luồng</h4>
<p>Nếu chúng ta muốn chuyển đổi một tập hợp này sang một interface khác, có thể sử dụng phương thức <code>transform</code> của Lists. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">"b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">"c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> transformList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">transform</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list, x </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> x</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toUpperCase</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(transformList);</span></span></code></pre>
</div><p>Chuyển đổi các ký tự thường thành ký tự in hoa.</p>
<h4>Đảo ngược thứ tự</h4>
<p>Lists có phương thức <code>reverse</code> để đảo ngược thứ tự. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> reverseList </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">reverse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(reverseList);</span></span></code></pre>
</div><p>Kết quả thực thi:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span></span></code></pre>
</div><p>Thứ tự ban đầu của list là 312, sau khi sử dụng phương thức <code>reverse</code>, nó trở thành 213.</p>
<p>Lists còn có các công cụ hữu ích khác, tôi chỉ đưa ra một số ví dụ, bạn có thể tự nghiên cứu thêm.</p>
<figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/guava-4b962b06-a626-4707-9fe9-f5729536d9c5.jpg" alt="Guava" tabindex="0" loading="lazy"><figcaption>Guava</figcaption></figure>
<h3>08. Tổng kết</h3>
<p>Trên đây là những tính năng tôi cho là phổ biến nhất, là một thư viện lõi phát triển Java được Google phát hành, tôi nghĩ rằng tính hữu dụng của nó rất cao (nếu không thì thôi?). Sau khi tích hợp vào dự án của bạn, không chỉ có thể nhanh chóng triển khai các tính năng phổ biến trong phát triển mà còn làm cho mã nguồn trở nên thanh thoát và đơn giản hơn.</p>
<p>Tôi nghĩ rằng nó phù hợp với mọi dự án Java, còn những tính năng khác như băm, bus sự kiện, toán học, phản chiếu, thì chờ bạn khám phá nhé.</p>
]]></content:encoded>
      <enclosure url="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/guava-4b962b06-a626-4707-9fe9-f5729536d9c5.jpg" type="image/jpeg"/>
    </item>
    <item>
      <title>Hutool</title>
      <link>https://vanhung4499.github.io/programming/java/common-tool/hutool.html</link>
      <guid>https://vanhung4499.github.io/programming/java/common-tool/hutool.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Hutool</source>
      <description>Hutool Một thành viên trong nhóm đọc giả của tôi đã thốt lên rằng, &amp;quot;Thư viện mã nguồn mở Hutool thật sự tuyệt vời, nó có đầy đủ các công cụ mà chúng ta cần.&amp;quot; Thực sự, tôi cũng t...</description>
      <category>java</category>
      <pubDate>Thu, 04 Jul 2024 09:37:15 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Một thành viên trong nhóm đọc giả của tôi đã thốt lên rằng, "Thư viện mã nguồn mở Hutool thật sự tuyệt vời, nó có đầy đủ các công cụ mà chúng ta cần." Thực sự, tôi cũng thường xuyên sử dụng Hutool trong công việc hàng ngày. Nó giúp chúng ta đơn giản hóa từng dòng mã, mang lại sự thanh lịch như ngôn ngữ hàm cho Java, làm cho Java trở nên đẹp hơn.</p>
<h3>01. Thêm Hutool vào dự án</h3>
<p>Dự án Maven chỉ cần thêm dependency sau vào file pom.xml.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;cn.hutool&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;hutool-all&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;version&gt;5.4.3&lt;/version&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre>
</div><p>Triết lý thiết kế của Hutool là giảm thiểu các định nghĩa lặp lại, giúp cho gói util trong dự án càng ít càng tốt. Một thư viện tốt có thể giúp tránh được việc "sao chép và dán", từ đó tiết kiệm thời gian của chúng ta trong việc đóng gói các thư viện và phương thức công cụ dùng chung. Đồng thời, một thư viện mã nguồn mở hoàn chỉnh cũng giúp giảm thiểu tối đa các lỗi phát sinh từ việc đóng gói không hoàn thiện.</p>
<p>Như tác giả đã nói trên trang web:</p>
<ul>
<li>Trước đây, chúng ta mở công cụ tìm kiếm -&gt; Tìm kiếm "Java MD5 encryption" -&gt; Mở một bài blog -&gt; Sao chép và dán -&gt; Chỉnh sửa một chút để dùng được</li>
<li>Bây giờ, với Hutool, chỉ cần thêm Hutool -&gt; Gọi trực tiếp <code>SecureUtil.md5()</code></li>
</ul>
<p>Hutool không chỉ đóng gói các lớp cơ bản của JDK như file, stream, mã hóa và giải mã, mã hóa ký tự, regex, luồng, XML, mà còn cung cấp các thành phần sau:</p>
<figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-02.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Rất nhiều và rất đầy đủ, vì vậy tôi chỉ chọn một số thành phần mà tôi thích để giới thiệu.</p>
<h3>02. Chuyển đổi loại dữ liệu</h3>
<p>Chuyển đổi loại dữ liệu rất phổ biến trong phát triển Java, đặc biệt là khi lấy tham số từ HttpRequest. Phía trước truyền số nguyên, nhưng phía sau chỉ có thể lấy được chuỗi, sau đó phải gọi phương thức <code>parseXXX()</code> để chuyển đổi và phải kiểm tra null, rất phiền phức.</p>
<p>Lớp Convert của Hutool có thể đơn giản hóa việc này, nó có thể chuyển đổi bất kỳ loại dữ liệu nào thành loại chỉ định, tham số thứ hai defaultValue có thể dùng để trả về giá trị mặc định khi chuyển đổi thất bại.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> param </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "10"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> paramInt </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Convert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(param);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> paramIntDefault </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Convert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(param, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Chuyển chuỗi thành ngày tháng:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> dateStr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "2020-09-29"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Date</span><span style="color:#E06C75;--shiki-dark:#E06C75"> date </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Convert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toDate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(dateStr);</span></span></code></pre>
</div><p>Chuyển chuỗi thành Unicode:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> unicodeStr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Hùng"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> unicode </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Convert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">strToUnicode</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(unicodeStr);</span></span></code></pre>
</div><h3>03. Ngày và Thời gian</h3>
<p>JDK cung cấp các lớp Date và Calendar nhưng không thực sự tiện lợi. Hutool đã đóng gói lớp DateUtil, giúp việc sử dụng dễ dàng hơn nhiều!</p>
<p>Lấy ngày hiện tại:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Date</span><span style="color:#E06C75;--shiki-dark:#E06C75"> date </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> DateUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p><code>DateUtil.date()</code> thực chất trả về một đối tượng DateTime, kế thừa từ lớp Date và ghi đè phương thức <code>toString()</code>, trả về chuỗi định dạng <code>yyyy-MM-dd HH:mm:ss</code>.</p>
<p>Một số bạn có thể muốn biết thời gian tôi viết bài này, đây là kết quả khi in ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>System.out.println(date); // 2024-06-29 04:28:02</span></span></code></pre>
</div><p>Chuyển chuỗi thành ngày:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> dateStr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "2020-09-29"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Date</span><span style="color:#E06C75;--shiki-dark:#E06C75"> date </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> DateUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">parse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(dateStr);</span></span></code></pre>
</div><p><code>DateUtil.parse()</code> sẽ tự động nhận diện một số định dạng phổ biến, ví dụ:</p>
<ul>
<li>yyyy-MM-dd HH:mm:ss</li>
<li>yyyy-MM-dd</li>
<li>HH:mm:ss</li>
<li>yyyy-MM-dd HH:mm</li>
<li>yyyy-MM-dd HH:mm:ss.SSS</li>
</ul>
<p>Định dạng chênh lệch thời gian:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> dateStr1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "2020-09-29 22:33:23"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Date</span><span style="color:#E06C75;--shiki-dark:#E06C75"> date1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> DateUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">parse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(dateStr1);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> dateStr2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "2020-10-01 23:34:27"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Date</span><span style="color:#E06C75;--shiki-dark:#E06C75"> date2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> DateUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">parse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(dateStr2);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> betweenDay </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> DateUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">between</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(date1, date2, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">DateUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">MS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Output: 2 days, 1 hour, 1 minute and 4 seconds</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> formatBetween </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> DateUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">formatBetween</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(betweenDay, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">BetweenFormater</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Level</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">SECOND</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Cung hoàng đạo và con giáp:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sagittarius</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> zodiac </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> DateUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getZodiac</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Month</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">DECEMBER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getValue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(), </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Rabbit</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> chineseZodiac </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> DateUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getChineseZodiac</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1999</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>04. IO liên quan</h3>
<p><a href="/programming/java/io/shangtou.html" target="_blank">IO bao gồm đọc và ghi</a>, ứng dụng chính trong các hoạt động mạng và thao tác file. Thư viện Java nguyên gốc phân biệt giữa <a href="/programming/java/io/character">character stream</a> và <a href="/programming/java/io/stream.html" target="_blank">byte stream</a>, có rất nhiều loại InputStream và OutputStream, việc sử dụng có thể làm người ta đau đầu.</p>
<p>Hutool đóng gói các công cụ thao tác luồng như IoUtil, công cụ đọc và ghi file FileUtil, công cụ xác định loại file FileTypeUtil, v.v.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> in </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hutool/origin.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> out </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hutool/to.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> copySize </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IoUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(in, out, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IoUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">DEFAULT_BUFFER_SIZE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Trong các thao tác IO, việc xử lý file tương đối phức tạp nhưng cũng rất thường gặp, hầu hết các dự án đều có một lớp công cụ gọi là FileUtil hoặc FileUtils. Lớp FileUtil của Hutool bao gồm các thao tác sau:</p>
<ul>
<li>Thao tác file: bao gồm tạo mới, xóa, sao chép, di chuyển, đổi tên file và thư mục</li>
<li>Kiểm tra file: kiểm tra xem file hoặc thư mục có rỗng không, có phải là thư mục hoặc file không</li>
<li>Đường dẫn tuyệt đối: chuyển đổi file trong ClassPath thành đường dẫn tuyệt đối</li>
<li>Tên file: lấy tên file chính và phần mở rộng</li>
<li>Đọc file: bao gồm các thao tác getReader, readXXX</li>
<li>Ghi file: bao gồm các thao tác getWriter, writeXXX</li>
</ul>
<p>Nói thêm về classpath.</p>
<p>Trong thực tế lập trình, chúng ta thường cần đọc dữ liệu từ một số file như file cấu hình, file văn bản, hình ảnh, v.v. Những file này thường được đặt ở đâu?</p>
<figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-03.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Đặt trong thư mục resources của cấu trúc dự án, khi dự án được biên dịch, chúng sẽ xuất hiện trong thư mục classes. Trên đĩa, nó sẽ trông như thế này:</p>
<figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-04.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Khi đọc file, tôi không khuyến nghị sử dụng đường dẫn tuyệt đối vì các hệ điều hành khác nhau sẽ có các dấu phân cách đường dẫn khác nhau. Tốt nhất là sử dụng đường dẫn tương đối.</p>
<p>Giả sử có một file tên là origin.txt nằm trong thư mục <code>src/resources</code>, đường dẫn sẽ như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"origin.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Nếu file nằm trong thư mục <code>src/resources/hutool</code>, thì đường dẫn sẽ là:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hutool/origin.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>05. Công cụ chuỗi</h3>
<p>Lớp công cụ chuỗi của Hutool là StrUtil, tương tự với lớp StringUtils trong Apache Commons Lang. Tác giả cho rằng ưu điểm của Str là ngắn hơn String, mặc dù tôi không thấy vậy. Tuy nhiên, tôi rất thích một trong những phương thức của nó:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> template </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "{}, {}"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> StrUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(template, </span><span style="color:#98C379;--shiki-dark:#98C379">"Hung"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Dev"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>06. Công cụ reflect</h3>
<p>Cơ chế reflect có thể làm cho Java linh hoạt hơn, do đó trong một số trường hợp, reflect có thể đạt được hiệu quả cao. Hutool đóng gói công cụ reflect ReflectUtil bao gồm:</p>
<ul>
<li>Lấy phương thức khởi tạo</li>
<li>Lấy trường</li>
<li>Lấy giá trị trường</li>
<li>Lấy phương thức</li>
<li>Thực hiện phương thức (phương thức đối tượng và phương thức tĩnh)</li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">package</span><span style="color:#C678DD;--shiki-dark:#C678DD"> com.ittom.hutool.reflect</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> cn.hutool.core.util.ReflectUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.lang.reflect.Constructor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.lang.reflect.Field</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.lang.reflect.Method</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ReflectDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ReflectDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Phương thức khởi tạo"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tôi là Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IllegalAccessException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Tạo đối tượng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        ReflectDemo</span><span style="color:#E06C75;--shiki-dark:#E06C75"> reflectDemo</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ReflectUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newInstance</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ReflectDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Lấy phương thức khởi tạo</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Constructor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75">constructors</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ReflectUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getConstructors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ReflectDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Constructor</span><span style="color:#E06C75;--shiki-dark:#E06C75"> constructor</span><span style="color:#C678DD;--shiki-dark:#C678DD"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> constructors) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">constructor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Lấy trường</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Field</span><span style="color:#E06C75;--shiki-dark:#E06C75"> field</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ReflectUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ReflectDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        field</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(reflectDemo, </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Lấy giá trị trường</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ReflectUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getFieldValue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(reflectDemo, field));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Lấy tất cả phương thức</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Method</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75">methods</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ReflectUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getMethods</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ReflectDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Method</span><span style="color:#E06C75;--shiki-dark:#E06C75"> m</span><span style="color:#C678DD;--shiki-dark:#C678DD"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> methods) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">m</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Lấy phương thức cụ thể</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Method</span><span style="color:#E06C75;--shiki-dark:#E06C75"> method</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ReflectUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ReflectDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"print"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">method</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Thực hiện phương thức</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        ReflectUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">invoke</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(reflectDemo, </span><span style="color:#98C379;--shiki-dark:#98C379">"print"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>07. Công cụ nén</h3>
<p>Trong Java, việc nén và giải nén các tệp và thư mục là một việc khá phức tạp. Hutool đóng gói công cụ ZipUtil, tối ưu hóa gói java.util.zip, có thể sử dụng một phương thức để thực hiện việc nén và giải nén, tự động xử lý các vấn đề liên quan đến tệp và thư mục, giúp đơn giản hóa đáng kể độ phức tạp của việc nén và giải nén.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ZipUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hutool"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"hutool.zip"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> unzip </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ZipUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">unzip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hutool.zip"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"hutoolzip"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>08. Công cụ xác thực thẻ căn cước</h3>
<p>Hutool đóng gói công cụ IdcardUtil có thể dùng để xác thực thẻ căn cước, hỗ trợ thẻ căn cước 15 số và 18 số của Trung Quốc đại lục, thẻ căn cước 10 số của Hong Kong, Macao và Đài Loan.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ID_18 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "321083197812162119"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ID_15 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "150102880730303"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> valid </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IdcardUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isValidCard</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(ID_18);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> valid15 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IdcardUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isValidCard</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(ID_15);</span></span></code></pre>
</div><h3>09. Mở rộng HashMap</h3>
<p>HashMap trong Java là kiểu dữ liệu mạnh, nhưng Hutool đóng gói Dict không yêu cầu khắt khe về kiểu dữ liệu của key.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Dict</span><span style="color:#E06C75;--shiki-dark:#E06C75"> dict </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Dict</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">create</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        .</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"age"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">18</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        .</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        .</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"birthday"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">DateTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">now</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dict</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"age"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dict</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getStr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>10. In ra console</h3>
<p>Trong quá trình mã hóa cục bộ, thường cần sử dụng <code>System.out</code> để in kết quả, nhưng thường một số đối tượng phức tạp không hỗ trợ in trực tiếp, chẳng hạn như mảng, cần gọi <code>Arrays.toString</code>. Lớp Console của Hutool lấy cảm hứng từ <code>console.log()</code> trong JavaScript, làm cho việc in trở nên rất thuận tiện.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ConsoleDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // In chuỗi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Console</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom，Dev"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // In mẫu chuỗi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Console</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom is {}"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">13</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [] </span><span style="color:#E06C75;--shiki-dark:#E06C75">ints</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">};</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // In mảng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Console</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(ints);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>11. Bộ kiểm tra trường</h3>
<p>Khi phát triển Web, phía server thường cần kiểm tra dữ liệu từ form gửi đến. Hutool đóng gói Validator có thể thực hiện nhiều điều kiện kiểm tra hiệu quả:</p>
<ul>
<li>Có phải email không</li>
<li>Có phải IP V4, V6 không</li>
<li>Có phải số điện thoại không</li>
<li>Và nhiều điều kiện khác</li>
</ul>
<figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-05.png" alt="Validator" tabindex="0" loading="lazy"><figcaption>Validator</figcaption></figure>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Validator</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isEmail</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Validator</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isMobile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"botay.com"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>12. Map tìm kiếm hai chiều</h3>
<p><a href="/programming/java/common-tool/guava">Guava</a> cung cấp một cấu trúc Map đặc biệt, gọi là BiMap, thực hiện chức năng tìm kiếm hai chiều, có thể tìm giá trị bằng key và tìm key bằng giá trị. Hutool cũng cung cấp cấu trúc Map này.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BiMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> biMap </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> BiMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> HashMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">())</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">biMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">biMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"cat"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Cat"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy giá trị bằng key</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">biMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">biMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"cat"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy key bằng giá trị</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">biMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getKey</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">biMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getKey</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Cat"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Trong công việc phát triển thực tế, tôi thường thích sử dụng BiMap của Guava hơn là của Hutool. Tôi đề cập đến điều này vì tôi phát hiện ra một lỗi trong tài liệu trực tuyến của Hutool và đã báo cáo vấn đề.</p>
<h3>13. Công cụ hình ảnh</h3>
<p>ImgUtil của Hutool có thể thực hiện các thao tác như thu nhỏ, cắt, chuyển thành đen trắng và thêm watermark cho hình ảnh.</p>
<p>Thu nhỏ hình ảnh:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ImgUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">scale</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hutool/cat.jpg"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hutool/cat_small.jpg"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">        0.5f</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Cắt hình ảnh:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ImgUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">cut</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hutool/cat.jpg"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hutool/cat_cut.jpg"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Rectangle</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">200</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">200</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Thêm watermark:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ImgUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">pressText</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">//</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hutool/cat.jpg"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hutool/cat_logo.jpg"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Color</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">WHITE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Font</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Fira Code"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Font</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">BOLD</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">        0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">        0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">        0.8f</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>14. Tập tin cấu hình</h3>
<blockquote>
<p>Như mọi người đã biết, tập tin cấu hình Properties được sử dụng rộng rãi trong Java có một nhược điểm lớn: không hỗ trợ tiếng Trung. Mỗi khi sử dụng, nếu muốn lưu trữ ký tự tiếng Trung, bạn phải sử dụng plugin liên quan đến IDE để chuyển sang ký hiệu Unicode, và loại ký hiệu phản nhân tính này hoàn toàn không thể đọc được trên dòng lệnh.</p>
</blockquote>
<p>Do đó, Setting của Hutool ra đời. Ngoài việc tương thích với định dạng tập tin Properties, Setting còn cung cấp một số tính năng đặc biệt bao gồm:</p>
<ul>
<li>Hỗ trợ nhiều cách mã hóa</li>
<li>Hỗ trợ biến</li>
<li>Hỗ trợ phân nhóm</li>
</ul>
<p>Đầu tiên, tạo một tập tin cấu hình example.setting với nội dung như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>name=Tom</span></span>
<span class="line"><span>age=18</span></span></code></pre>
</div><p>Sau đó, đọc và cập nhật tập tin cấu hình:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> SettingDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> SETTING </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "hutool/example.setting"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Khởi tạo Setting</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Setting</span><span style="color:#E06C75;--shiki-dark:#E06C75"> setting</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Setting</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(SETTING);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Đọc</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        setting</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getStr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Tự động tải khi tập tin cấu hình thay đổi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        setting</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">autoLoad</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Thêm cặp key-value bằng mã lệnh</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        setting</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"birthday"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"2020/02/02"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        setting</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">store</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(SETTING);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>15. LogFactory</h3>
<p>LogFactory của Hutool tương thích với các framework nhật ký lớn và rất dễ sử dụng.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> LogDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Log</span><span style="color:#E06C75;--shiki-dark:#E06C75"> log </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> LogFactory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">debug</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abcd"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Trước tiên, sử dụng <code>LogFactory.get()</code> để tự động nhận diện framework nhật ký đã được tích hợp và tạo đối tượng Log tương ứng, sau đó gọi các phương thức như <code>debug()</code> và <code>info()</code> để xuất nhật ký.</p>
<p>Nếu không muốn tạo đối tượng Log, bạn có thể sử dụng StaticLog, một lớp nhật ký cung cấp các phương thức tĩnh.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">StaticLog</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Web Server {}."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"TomCat"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>16. Công cụ Cache</h3>
<p>CacheUtil là một công cụ tiện ích của Hutool để tạo các đối tượng cache khác nhau:</p>
<ul>
<li><strong>FIFOCache</strong>: Đầu vào đầu ra, các phần tử được thêm vào cache cho đến khi cache đầy, khi đó các đối tượng cache đã hết hạn sẽ được xóa đi, nếu vẫn còn đầy, các phần tử nhập trước sẽ bị xóa đi.</li>
</ul>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Cache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fifoCache </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CacheUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newFIFOCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fifoCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fifoCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key2"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"two"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fifoCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key3"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"three"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fifoCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key4"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"four"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Với kích thước là 3, khi key3 được thêm vào, key1 sẽ bị xóa</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> value1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fifoCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><ul>
<li><strong>LFUCache</strong>: Ít sử dụng nhất, dựa trên số lần sử dụng để xác định liệu đối tượng có nên được giữ trong cache hay không. Khi cache đầy, các đối tượng ít được truy cập nhất sẽ bị xóa đi để nhường chỗ cho các đối tượng mới.</li>
</ul>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Cache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> lfuCache </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CacheUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newLFUCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">lfuCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">lfuCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tăng số lần sử dụng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">lfuCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key2"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"two"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">lfuCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key3"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"three"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">lfuCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key4"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"four"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Với dung lượng cache là 3, khi thêm phần tử thứ 4 vào, phần tử ít được sử dụng nhất (key2, key3) sẽ bị xóa</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> value2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> lfuCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key2"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> value3 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> lfuCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key3"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><ul>
<li><strong>LRUCache</strong>: Sử dụng gần đây nhất, dựa trên thời gian sử dụng để xác định liệu đối tượng có nên được giữ trong cache hay không. Khi cache đầy, các đối tượng không được sử dụng lâu nhất sẽ bị xóa đi.</li>
</ul>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Cache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> lruCache </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CacheUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newLRUCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">lruCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">lruCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key2"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"two"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">lruCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key3"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"three"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">lruCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Gần đây được sử dụng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">lruCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key4"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"four"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Với dung lượng cache là 3, khi thêm phần tử thứ 4 vào, phần tử được sử dụng lâu nhất (key2) sẽ bị xóa</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> value2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> lruCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"key2"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(value2);</span></span></code></pre>
</div><h3>17. Mã hóa và Giải mã</h3>
<p>Mã hóa được chia thành ba loại:</p>
<ul>
<li><strong>Mã hóa đối xứng (Symmetric)</strong>: Ví dụ: AES, DES, vv.</li>
<li><strong>Mã hóa không đối xứng (Asymmetric)</strong>: Ví dụ: RSA, DSA, vv.</li>
<li><strong>Mã hóa băm (Digest)</strong>: Ví dụ: MD5, SHA-1, SHA-256, HMAC, vv.</li>
</ul>
<p>Hutool đã đóng gói các công cụ cho ba trường hợp này:</p>
<ul>
<li>Mã hóa đối xứng SymmetricCrypto</li>
<li>Mã hóa không đối xứng AsymmetricCrypto</li>
<li>Mã hóa băm Digester</li>
</ul>
<p>Công cụ nhanh chóng SecureUtil có các phương thức sau:</p>
<ol>
<li>Mã hóa đối xứng</li>
</ol>
<ul>
<li>SecureUtil.aes</li>
<li>SecureUtil.des</li>
</ul>
<ol start="2">
<li>Mã hóa không đối xứng</li>
</ol>
<ul>
<li>SecureUtil.rsa</li>
<li>SecureUtil.dsa</li>
</ul>
<ol start="3">
<li>Mã hóa băm</li>
</ol>
<ul>
<li>SecureUtil.md5</li>
<li>SecureUtil.sha1</li>
<li>SecureUtil.hmac</li>
<li>SecureUtil.hmacMd5</li>
<li>SecureUtil.hmacSha1</li>
</ul>
<p>Hãy xem một ví dụ đơn giản để tham khảo:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> SecureUtilDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> AES</span><span style="color:#E06C75;--shiki-dark:#E06C75"> aes </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> SecureUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">aes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> encry</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> aes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">encryptHex</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"two"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(encry);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> oo</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> aes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">decryptStr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(encry);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(oo);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>18. Thư viện khác</h3>
<p>Hutool có nhiều thư viện khác nhau, đặc biệt là các thư viện đóng gói lại từ các thư viện của bên thứ ba, chẳng hạn như công cụ email MailUtil, công cụ mã QR QrCodeUtil, công cụ Emoji EmojiUtil, các bạn có thể tham khảo tài liệu chính thức của Hutool: <a href="https://www.hutool.cn/" target="_blank" rel="noopener noreferrer">https://www.hutool.cn/</a></p>
<p>Địa chỉ mã nguồn dự án: <a href="https://github.com/looly/hutool" target="_blank" rel="noopener noreferrer">https://github.com/looly/hutool</a></p>
]]></content:encoded>
      <enclosure url="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/hutool-02.png" type="image/png"/>
    </item>
    <item>
      <title>Objects</title>
      <link>https://vanhung4499.github.io/programming/java/common-tool/objects.html</link>
      <guid>https://vanhung4499.github.io/programming/java/common-tool/objects.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Objects</source>
      <description>Objects Lớp Objects trong Java là một lớp tiện ích chứa một loạt các phương thức tĩnh dùng để xử lý đối tượng. Nó nằm trong gói java.util và được giới thiệu từ Java 7. Mục đích ...</description>
      <category>java</category>
      <pubDate>Thu, 04 Jul 2024 09:37:15 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Lớp <code>Objects</code> trong Java là một lớp tiện ích chứa một loạt các phương thức tĩnh dùng để xử lý đối tượng. Nó nằm trong gói <code>java.util</code> và được giới thiệu từ Java 7. Mục đích chính của lớp <code>Objects</code> là giảm thiểu rủi ro exception NullPointerException trong mã nguồn, đồng thời cung cấp một số phương thức rất hữu ích cho chúng ta sử dụng.</p>
<h3>Kiểm Tra Đối Tượng Null</h3>
<p>Trong Java, mọi thứ đều là đối tượng, vì vậy việc kiểm tra đối tượng có null hay không rất phổ biến. Phương thức <code>isNull</code> của <code>Objects</code> được dùng để kiểm tra xem đối tượng có null hay không, trong khi phương thức <code>nonNull</code> được dùng để kiểm tra đối tượng không null. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#E06C75;--shiki-dark:#E06C75"> integer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Integer</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNull</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(integer)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đối tượng là null"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nonNull</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(integer)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đối tượng không phải là null"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><h3>Ném exception Khi Đối Tượng Null</h3>
<p>Nếu chúng ta muốn ném exception con trỏ null khi đối tượng là null, có thể sử dụng phương thức <code>requireNonNull</code> của <code>Objects</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#E06C75;--shiki-dark:#E06C75"> integer1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Integer</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">128</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">requireNonNull</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(integer1);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">requireNonNull</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(integer1, </span><span style="color:#98C379;--shiki-dark:#98C379">"Tham số không được null"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">requireNonNull</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(integer1, () </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#98C379;--shiki-dark:#98C379"> "Tham số không được null"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Trong ví dụ trên:</p>
<ul>
<li><code>Objects.requireNonNull(integer1)</code> kiểm tra xem <code>integer1</code> có null không và ném exception nếu null.</li>
<li><code>Objects.requireNonNull(integer1, "Tham số không được null")</code> kiểm tra và ném exception với thông báo tùy chỉnh nếu <code>integer1</code> là null.</li>
<li><code>Objects.requireNonNull(integer1, () -&gt; "Tham số không được null")</code> kiểm tra và ném exception với thông báo được tạo từ lambda nếu <code>integer1</code> là null.</li>
</ul>
<h3>Kiểm Tra Hai Đối Tượng Có Bằng Nhau Không</h3>
<p>Chúng ta thường cần kiểm tra hai đối tượng có bằng nhau không, <code>Objects</code> cung cấp phương thức <code>equals</code> giúp chúng ta thực hiện điều này một cách rất thuận tiện:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#E06C75;--shiki-dark:#E06C75"> integer1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Integer</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#E06C75;--shiki-dark:#E06C75"> integer2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Integer</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">equals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(integer1, integer2));</span></span></code></pre>
</div><p>Kết quả thực thi:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span></code></pre>
</div><p>Tuy nhiên, sử dụng phương thức này có thể gặp phải một số rắc rối, ví dụ như trong trường hợp sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#E06C75;--shiki-dark:#E06C75"> integer1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Integer</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> integer2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Long</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">equals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(integer1, integer2));</span></span></code></pre>
</div><p>Kết quả thực thi:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span></code></pre>
</div><p>Dù <code>Objects.equals()</code> được thiết kế để tránh lỗi bằng cách xử lý việc so sánh với giá trị null mà không ném ra ngoại lệ con trỏ null, điều này không có nghĩa là nó không gặp vấn đề tiềm ẩn. Thực tế, một vấn đề tiềm ẩn của <code>Objects.equals()</code> là nó phụ thuộc vào việc triển khai phương thức <code>equals()</code> của các đối tượng được so sánh.</p>
<p>Khi lớp của hai đối tượng không triển khai đúng phương thức <code>equals()</code>, phương thức <code>Objects.equals()</code> có thể cho kết quả không như mong đợi. Ví dụ:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ObjectsDemo1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Person</span><span style="color:#E06C75;--shiki-dark:#E06C75"> person1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Person</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abcd"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">18</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Person</span><span style="color:#E06C75;--shiki-dark:#E06C75"> person2</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Person</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abcd"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">18</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">equals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(person1, person2)); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// false</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Person</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    Person</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">age</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ví dụ trên, chúng ta tạo một lớp tên là <code>Person</code> nhưng không ghi đè phương thức <code>equals()</code>. Sau đó, chúng ta tạo hai đối tượng <code>Person</code> có cùng thuộc tính và sử dụng phương thức <code>Objects.equals()</code> để so sánh chúng. Mặc dù hai đối tượng này có cùng thuộc tính, nhưng kết quả lại là <code>false</code>. Điều này là do <code>Objects.equals()</code> phụ thuộc vào phương thức <code>equals()</code> của đối tượng, và trong ví dụ này, lớp <code>Person</code> không triển khai đúng phương thức <code>equals()</code>, nên phương thức mặc định <code>equals()</code> của lớp <code>Object</code> được sử dụng, chỉ so sánh địa chỉ tham chiếu của đối tượng.</p>
<p>Để giải quyết vấn đề này, chúng ta cần ghi đè phương thức <code>equals()</code> trong lớp <code>Person</code>:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> equals</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Object</span><span style="color:#E06C75;--shiki-dark:#E06C75"> obj) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">this</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> ==</span><span style="color:#E06C75;--shiki-dark:#E06C75"> obj) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (obj </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> ||</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getClass</span><span style="color:#E06C75;--shiki-dark:#E06C75">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> obj</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#D19A66;--shiki-dark:#D19A66"> false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Person</span><span style="color:#E06C75;--shiki-dark:#E06C75"> person </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (Person) obj</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> person</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">age</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &amp;&amp;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">equals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(name, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">person</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Bây giờ, khi chúng ta sử dụng phương thức <code>Objects.equals()</code> để so sánh hai đối tượng <code>Person</code> có cùng thuộc tính, kết quả sẽ là <code>true</code>, đúng như mong đợi.</p>
<h3>Lấy hashCode của Đối Tượng</h3>
<p>Nếu bạn muốn lấy giá trị <code>hashCode</code> của một đối tượng nào đó, bạn có thể sử dụng phương thức <code>hashCode</code> của <code>Objects</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abcd"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hashCode</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str));</span></span></code></pre>
</div><p>Kết quả thực thi:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">867758096</span></span></code></pre>
</div><h3>So Sánh Hai Đối Tượng</h3>
<p>Phương thức <code>compare()</code> được sử dụng để so sánh hai đối tượng, thường được dùng trong việc sắp xếp tùy chỉnh. Nó yêu cầu một Comparator làm tham số. Nếu Comparator là null, thứ tự tự nhiên sẽ được sử dụng. Dưới đây là một ví dụ về phương thức <code>compare()</code>:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ObjectsCompareDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        PersonCompare</span><span style="color:#E06C75;--shiki-dark:#E06C75"> person1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> PersonCompare</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">30</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        PersonCompare</span><span style="color:#E06C75;--shiki-dark:#E06C75"> person2</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> PersonCompare</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"jerry"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Comparator</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">PersonCompare</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">ageComparator</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Comparator</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">comparingInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(p </span><span style="color:#C678DD;--shiki-dark:#C678DD">-&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> p</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ageComparisonResult</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">compare</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(person1, person2, ageComparator);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"So sánh tuổi: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ageComparisonResult); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kết quả：1（表示 age của person1 sau person2）</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> PersonCompare</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    PersonCompare</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">age</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>So Sánh Hai Mảng</h3>
<p>Phương thức <code>deepEquals()</code> được sử dụng để so sánh hai đối tượng loại <a href="https://javabetter.cn/array/array.html" target="_blank" rel="noopener noreferrer">mảng</a>. Khi đối tượng không phải là mảng, hành vi sẽ giống với phương thức <code>equals()</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] array1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#E06C75;--shiki-dark:#E06C75">}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] array2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#E06C75;--shiki-dark:#E06C75">}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] array3 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4</span><span style="color:#E06C75;--shiki-dark:#E06C75">}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">deepEquals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(array1, array2));</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Kết quả：true（vì nội dung của array1 và array2 giống nhau）</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">deepEquals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(array1, array3));</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Kết quả：false（vì nội dung của array1 và array3 khác nhau）</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đối với các đối tượng không phải là mảng, deepEquals() hoạt động giống như equals()</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> string1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "hello"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> string2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "hello"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> string3 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "world"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">deepEquals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(string1, string2));</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Kết quả：true（vì string1 và string2 giống nhau）</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">deepEquals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(string1, string3));</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Kết quả：false（vì string1 và string3 khác nhau）</span></span></code></pre>
</div><p>Dưới đây là ví dụ về <a href="/programming/java/array/double-array">mảng hai chiều</a>:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[][] nestedArray1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {{"A", "B"}, {"C", "D"}}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[][] nestedArray2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {{"A", "B"}, {"C", "D"}}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[][] nestedArray3 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {{"A", "B"}, {"C", "E"}}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">deepEquals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(nestedArray1, nestedArray2));</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Kết quả：true (vì các phần tử của mảng lồng giống nhau)</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Objects</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">deepEquals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(nestedArray1, nestedArray3));</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Kết quả：false (vì các phần tử của mảng lồng khác nhau)</span></span></code></pre>
</div><h3>Tóm Tắt</h3>
<p>Ngoài các phương thức đã đề cập ở trên, Objects còn cung cấp một số phương thức khác như <code>toString</code>, bạn có thể thử nếu có hứng thú.</p>
<figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/Objects-83489814-9784-4274-841a-27ee75c046ac.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Tóm lại, các phương thức mà lớp Objects cung cấp rất hữu ích trong nhiều trường hợp, giúp đơn giản hóa mã nguồn và giảm thiểu khả năng xảy ra lỗi.</p>
]]></content:encoded>
      <enclosure url="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/Objects-83489814-9784-4274-841a-27ee75c046ac.jpg" type="image/jpeg"/>
    </item>
    <item>
      <title>Scanner</title>
      <link>https://vanhung4499.github.io/programming/java/common-tool/scanner.html</link>
      <guid>https://vanhung4499.github.io/programming/java/common-tool/scanner.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Scanner</source>
      <description>Scanner Lớp Scanner của Java là một công cụ tiện ích để quét đầu vào từ bàn phím, mặc dù nó cũng có thể quét nội dung của tệp, nhưng chúng ta thường thích nó trong vai trò quét ...</description>
      <category>java</category>
      <pubDate>Thu, 04 Jul 2024 09:37:15 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Lớp Scanner của Java là một công cụ tiện ích để quét đầu vào từ bàn phím, mặc dù nó cũng có thể quét nội dung của tệp, nhưng chúng ta thường thích nó trong vai trò quét đầu vào từ bàn phím hơn, vì quét tệp có thể được thực hiện thông qua <a href="/programming/java/io/file">File Stream</a>.</p>
<p>Tiếp theo, chúng ta sẽ thảo luận về lớp Scanner thông qua một vài ví dụ đơn giản.</p>
<h3>01. Quét Đầu Vào Từ Bàn Phím</h3>
<p>Thông thường, chúng ta sẽ sử dụng lớp Scanner để quét đầu vào từ bàn phím, đặc biệt đối với những người mới học Java, điều này sẽ rất thú vị vì cuối cùng chúng ta cũng có thể nhận được dữ liệu mà chúng ta muốn nhập vào.</p>
<p>Hãy xem ví dụ dưới đây:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75"> scanner </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">in</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tạo đối tượng Scanner, đọc dữ liệu từ đầu vào tiêu chuẩn</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Vui lòng nhập một số nguyên: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> num </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Lấy số nguyên người dùng nhập vào</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Số nguyên bạn đã nhập là: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> num);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đọc ký tự xuống dòng để tránh ảnh hưởng đến lần đọc tiếp theo</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Vui lòng nhập một chuỗi: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Lấy chuỗi người dùng nhập vào</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chuỗi bạn đã nhập là: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> str);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đóng đối tượng Scanner</span></span></code></pre>
</div><p>Chạy chương trình, bạn có thể tương tác với bảng điều khiển, đối với người mới học, điều này sẽ khá thú vị.</p>
<p>Trong đó, <a href="http://System.in" target="_blank" rel="noopener noreferrer">System.in</a> trả về một <a href="/programming/java/io/stream.html" target="_blank">Input Byte Stream</a> InputStream, tương ứng với System.out.</p>
<h4>1. <code>nextLine</code></h4>
<p>Phương thức <code>nextLine()</code> sẽ quét các ký tự trong luồng đầu vào cho đến khi gặp ký tự xuống dòng <code>\n</code>, sau đó trả về nội dung của dòng đó dưới dạng một chuỗi. Đồng thời, <code>nextLine()</code> sẽ di chuyển vị trí của đối tượng Scanner đến đầu dòng tiếp theo để chuẩn bị cho lần đọc tiếp theo.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75"> scanner </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">in</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tạo đối tượng Scanner, đọc dữ liệu từ đầu vào tiêu chuẩn</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Vui lòng nhập nhiều dòng văn bản, kết thúc bằng một dòng trống:"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringBuilder</span><span style="color:#E06C75;--shiki-dark:#E06C75"> sb </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> StringBuilder</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tạo đối tượng StringBuilder để lưu trữ văn bản được đọc</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> line </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đọc dòng đầu tiên từ luồng đầu vào</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu dòng đọc được không rỗng, tiếp tục đọc dòng tiếp theo</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    sb</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">append</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(line).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">append</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Thêm nội dung của dòng hiện tại vào đối tượng StringBuilder và xuống dòng</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    line </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đọc dòng tiếp theo</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Văn bản bạn đã nhập là:</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> sb</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // In ra văn bản đã đọc</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đóng đối tượng Scanner</span></span></code></pre>
</div><h4>2. <code>nextInt</code></h4>
<p><code>nextInt()</code> dùng để đọc số nguyên tiếp theo từ luồng đầu vào và trả về giá trị đó. Nếu trong luồng đầu vào không có số nguyên, hoặc không phải là số nguyên, sẽ ném ra ngoại lệ InputMismatchException.</p>
<h4>3. Các Phương Thức Khác</h4>
<p>Ngoài hai phương thức thường dùng ở trên, lớp Scanner còn có một số phương thức khác:</p>
<ul>
<li><code>boolean hasNext()</code>: Kiểm tra xem luồng đầu vào có phần tử tiếp theo không.</li>
<li><code>boolean hasNextLine()</code>: Kiểm tra xem luồng đầu vào có dòng tiếp theo không.</li>
<li><code>String next()</code>: Đọc phần tử tiếp theo trong luồng đầu vào (sử dụng dấu phân cách mặc định, thường là dấu cách hoặc ký tự xuống dòng).</li>
<li><code>double nextDouble()</code>: Đọc số thực tiếp theo trong luồng đầu vào.</li>
</ul>
<p>Dưới đây là một ví dụ demo.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75"> scanner </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">in</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tạo đối tượng Scanner, đọc dữ liệu từ đầu vào tiêu chuẩn</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Vui lòng nhập một số nguyên: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hasNextInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem luồng đầu vào có số nguyên tiếp theo không</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> num </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đọc số nguyên tiếp theo từ luồng đầu vào</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Số nguyên bạn đã nhập là: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> num);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Không phải là số nguyên!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đọc ký tự xuống dòng từ luồng đầu vào</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Vui lòng nhập nhiều từ, cách nhau bằng dấu cách: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hasNext</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem luồng đầu vào có phần tử tiếp theo không</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> word </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">next</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đọc từ tiếp theo từ luồng đầu vào</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Từ bạn đã nhập là: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> word);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đọc ký tự xuống dòng từ luồng đầu vào</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Vui lòng nhập một số thực: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hasNextDouble</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem luồng đầu vào có số thực tiếp theo không</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    double</span><span style="color:#E06C75;--shiki-dark:#E06C75"> num </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextDouble</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đọc số thực tiếp theo từ luồng đầu vào</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Số thực bạn đã nhập là: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> num);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Không phải là số thực!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đọc ký tự xuống dòng từ luồng đầu vào</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Vui lòng nhập một chuỗi: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hasNextLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem luồng đầu vào có dòng tiếp theo không</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> line </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đọc dòng tiếp theo từ luồng đầu vào</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chuỗi bạn đã nhập là: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> line);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Không phải là chuỗi!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đóng đối tượng Scanner</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>02. Quét Tập Tin</h3>
<p>Tất nhiên, Scanner cũng có thể được sử dụng để quét tập tin, và cách thực hiện cũng rất đơn giản. Dưới đây là ví dụ mã:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Tạo đối tượng File, đại diện cho tập tin cần quét</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"docs/abcd.md"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75"> scanner </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tạo đối tượng Scanner, đọc dữ liệu từ tập tin</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hasNextLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra tập tin có dòng tiếp theo hay không</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> line </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đọc dòng tiếp theo từ tập tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(line);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // In ra dòng đã đọc</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đóng đối tượng Scanner</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tập tin không tồn tại!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Trong ví dụ trên, đầu tiên chúng ta tạo một đối tượng File, đại diện cho tập tin cần quét. Sau đó, chúng ta sử dụng phương thức khởi tạo của lớp Scanner để tạo đối tượng Scanner, truyền tập tin vào làm tham số cho phương thức khởi tạo. Trong vòng lặp while, chúng ta sử dụng phương thức <code>hasNextLine()</code> để kiểm tra xem tập tin có dòng tiếp theo không, nếu có, sử dụng phương thức <code>nextLine()</code> để đọc chuỗi của dòng đó và sử dụng phương thức <code>println()</code> để in ra. Cuối cùng, trước khi kết thúc chương trình, chúng ta sử dụng phương thức <code>close()</code> để đóng đối tượng Scanner.</p>
<p>Ngoài việc sử dụng vòng lặp + nextLine, chúng ta còn có thể sử dụng phương thức <code>useDelimiter</code> để đặt dấu kết thúc tập tin là <code>\Z</code> để đọc toàn bộ tập tin.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng File, đại diện cho tập tin cần quét</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75"> scanner </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"docs/abcd.md"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tạo đối tượng Scanner, đọc dữ liệu từ tập tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">useDelimiter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\\</span><span style="color:#98C379;--shiki-dark:#98C379">Z"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đặt dấu phân cách là kết thúc tập tin</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hasNext</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra tập tin có dòng tiếp theo hay không</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> content </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">next</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đọc dòng tiếp theo từ tập tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(content);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // In ra dòng đã đọc</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đóng đối tượng Scanner</span></span></code></pre>
</div><p>Trong biểu thức chính quy, <code>\Z</code> biểu thị kết thúc của đầu vào, tức là dấu kết thúc tập tin. Trong lớp Scanner, chúng ta có thể sử dụng <code>\Z</code> làm dấu phân cách để đọc toàn bộ nội dung của tập tin.</p>
<h3>03. Tìm Kiếm Mục Khớp</h3>
<p>Ngoài việc quét đầu vào từ bàn phím và tập tin như đã đề cập ở trên, Scanner còn cung cấp bốn phương thức khác bắt đầu với find để tìm kiếm mục khớp:</p>
<figure><img src="https://cdn.tobebetterjavaer.com/stutymore/scanner-20230329162213.png" alt="Scanner Methods" tabindex="0" loading="lazy"><figcaption>Scanner Methods</figcaption></figure>
<p>Hãy xem ví dụ dưới đây:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> input </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "good good study, day day up."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75"> scanner </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75">(input)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> result</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng phương thức findInLine() để tìm kiếm từ trong chuỗi</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">findInLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"study"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"findInLine(): "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> result);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // In ra "study"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng phương thức findWithinHorizon() để tìm kiếm từ trong chuỗi</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">scanner </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75">(input)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">findWithinHorizon</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"study"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"findWithinHorizon(): "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> result);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // In ra "study"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Đóng đối tượng Scanner</span></span></code></pre>
</div><p>Trong ví dụ trên, đầu tiên chúng ta tạo một chuỗi input, đại diện cho văn bản cần tìm kiếm. Sau đó, chúng ta sử dụng phương thức khởi tạo của lớp Scanner để tạo đối tượng Scanner và truyền input vào làm luồng đầu vào. Tiếp theo, chúng ta sử dụng phương thức <code>findInLine()</code> và <code>findWithinHorizon()</code> để tìm kiếm từ "study" trong chuỗi. Trong đó, phương thức <code>findInLine()</code> tìm kiếm mục khớp trong dòng hiện tại, còn phương thức <code>findWithinHorizon()</code> tìm kiếm mục khớp trong phạm vi giới hạn được chỉ định. Trong ví dụ này, chúng ta giới hạn phạm vi tìm kiếm là 20 ký tự đầu tiên.</p>
<p>Cần lưu ý rằng, phương thức <code>findInLine()</code> và <code>findWithinHorizon()</code> đều trả về mục khớp tìm được. Nếu không tìm thấy mục khớp, sẽ trả về null. Ngoài ra, phương thức <code>findInLine()</code> và <code>findWithinHorizon()</code> đều bỏ qua dấu phân cách mặc định, vì vậy cần sử dụng biểu thức chính quy để chỉ định mẫu tìm kiếm. Trong ví dụ này, chúng ta sử dụng chuỗi "study" làm mẫu tìm kiếm.</p>
<p>Tất nhiên, chúng ta cũng có thể sử dụng biểu thức chính quy, ví dụ như chúng ta cần tìm từ khóa openjdk trong tập tin dưới đây.</p>
<div class="language-md" data-ext="md" data-title="md"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">## jdk install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">### ubuntu</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">`</span><span style="color:#98C379;--shiki-dark:#98C379">apt install openjdk-8-jdk</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">`</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">### centos</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">`</span><span style="color:#98C379;--shiki-dark:#98C379">yum install openjdk-8-jdk</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">`</span></span></code></pre>
</div><p>Mã có thể viết như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng File, đại diện cho tập tin cần quét</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75"> scanner </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"docs/abcd.md"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tạo đối tượng Scanner, đọc dữ liệu từ tập tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Pattern</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pattern </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Pattern</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">compile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"op..jdk"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> result</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">findWithinHorizon</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(pattern, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"findWithinHorizon(): "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> result);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Chúng ta sử dụng biểu thức chính quy pattern để biểu diễn từ khóa <code>openjdk</code>, trong đó <code>op..jdk</code> có <code>.</code> biểu thị bất kỳ ký tự nào. Bạn có thể tìm hiểu thêm về biểu thức chính quy để biết thêm chi tiết.</p>
<p>Sau đó, chúng ta sử dụng vòng lặp while để tìm tất cả các mục <code>openjdk</code> trong tập tin, trong đó tham số thứ hai của phương thức findWithinHorizon nếu là 0 sẽ biểu thị bỏ qua giới hạn. Nếu không tìm thấy, sẽ trả về null.</p>
<p>Vì trong tập tin có hai từ khóa openjdk, nên kết quả đầu ra sẽ như sau:</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>findWithinHorizon(): openjdk</span></span>
<span class="line"><span>findWithinHorizon(): openjdk</span></span></code></pre>
</div><h3>04. Tóm Tắt</h3>
<p>Tóm lại, lớp Scanner là một công cụ mạnh mẽ để xử lý đầu vào, không chỉ có thể quét đầu vào từ bàn phím mà còn có thể quét tập tin và cung cấp nhiều phương thức để đọc các loại dữ liệu khác nhau như <code>next()</code>, <code>nextInt()</code>, <code>nextLine()</code>, <code>nextDouble()</code>.</p>
<p>Ngoài ra, còn có thể sử dụng phương thức <code>useDelimiter()</code> để đặt dấu phân cách, sử dụng <code>findInLine()</code>, <code>findWithinHorizon()</code> để tìm kiếm mục khớp, v.v.</p>
]]></content:encoded>
      <enclosure url="https://cdn.tobebetterjavaer.com/stutymore/scanner-20230329162213.png" type="image/png"/>
    </item>
    <item>
      <title>StringUtils</title>
      <link>https://vanhung4499.github.io/programming/java/common-tool/string-utils.html</link>
      <guid>https://vanhung4499.github.io/programming/java/common-tool/string-utils.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">StringUtils</source>
      <description>Apache StringUtils Chuỗi (String) trong công việc hàng ngày của chúng ta được sử dụng rất, rất nhiều. Trong mã nguồn của chúng ta, thường xuyên cần phải kiểm tra chuỗi rỗng, cắt...</description>
      <category>java</category>
      <pubDate>Thu, 04 Jul 2024 09:37:15 GMT</pubDate>
      <content:encoded><![CDATA[
<p><code>Chuỗi</code> (<a href="/programming/java/string/immutable">String</a>) trong công việc hàng ngày của chúng ta được sử dụng rất, rất nhiều.</p>
<p>Trong mã nguồn của chúng ta, thường xuyên cần phải kiểm tra chuỗi rỗng, cắt chuỗi, chuyển đổi chữ hoa, chữ thường, <a href="/programming/java/string/split">phân tách chuỗi</a>, <a href="/programming/java/string/equals">so sánh chuỗi</a>, loại bỏ khoảng trắng thừa, <a href="/programming/java/string/join">nối chuỗi</a>, sử dụng biểu thức chính quy, v.v.</p>
<p>Nếu chỉ sử dụng các phương thức được cung cấp bởi lớp String, chúng ta sẽ cần viết thêm rất nhiều mã phụ, nếu không dễ gây ra các ngoại lệ khác nhau.</p>
<p>Bây giờ có một tin tốt là: lớp tiện ích <code>StringUtils</code> trong gói <code>org.apache.commons.lang3</code> cung cấp cho chúng ta rất nhiều lựa chọn phong phú.</p>
<p>Cấu hình Maven:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;commons-lang3&lt;/artifactId&gt;</span></span>
<span class="line"><span>    &lt;version&gt;3.12.0&lt;/version&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre>
</div><p>StringUtils cung cấp rất nhiều phương thức hữu ích, có khoảng bốn đến năm trang như hình dưới đây, tôi chỉ chụp hai trang, thực sự là quá nhiều.</p>
<figure><img src="https://cdn.tobebetterjavaer.com/stutymore/StringUtils-20230330111122.png" alt="StringUtils Methods" tabindex="0" loading="lazy"><figcaption>StringUtils Methods</figcaption></figure>
<p>Tiếp theo, chúng ta sẽ lấy một số phương thức thường dùng để minh họa.</p>
<h3>Kiểm Tra Chuỗi Rỗng</h3>
<p>Thực tế, chuỗi rỗng không chỉ là null, mà còn có "", " ", "null", v.v., nhiều trường hợp khác nhau.</p>
<p>StringUtils cung cấp cho chúng ta nhiều phương thức tĩnh để kiểm tra chuỗi rỗng, ví dụ:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> ""</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str3 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> " "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str4 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "abc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str1));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str2));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str3));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str4));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"====="</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNotEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str1));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNotEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str2));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNotEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str3));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNotEmpty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str4));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"====="</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isBlank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str1));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isBlank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str2));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isBlank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str3));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isBlank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str4));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"====="</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNotBlank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str1));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNotBlank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str2));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNotBlank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str3));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNotBlank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str4));</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kết quả thực thi:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">=====</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">=====</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">=====</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ví dụ: <code>isEmpty</code>, <code>isNotEmpty</code>, <code>isBlank</code> và <code>isNotBlank</code>, bạn có thể sử dụng 4 phương thức kiểm tra chuỗi rỗng này tùy theo tình huống thực tế.</p>
<p>Ưu tiên sử dụng các phương thức <code>isBlank</code> và <code>isNotBlank</code> vì chúng cũng sẽ xem xét chuỗi <code>" "</code>.</p>
<h3>Phân Tách Chuỗi</h3>
<p>Phân tách chuỗi là một nhu cầu phổ biến. Nếu sử dụng trực tiếp phương thức split của lớp String, có thể gặp phải ngoại lệ con trỏ null.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">split</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str1, </span><span style="color:#98C379;--shiki-dark:#98C379">","</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">str1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">split</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">","</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span></code></pre>
</div><p>Kết quả thực thi:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">null</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75"> in thread </span><span style="color:#98C379;--shiki-dark:#98C379">"main"</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NullPointerException</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">\tat </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">com</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">sue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">jump</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">service</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">test1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UtilTest</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UtilTest</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">java</span><span style="color:#C678DD;--shiki-dark:#C678DD">:</span><span style="color:#D19A66;--shiki-dark:#D19A66">21</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><p>Sử dụng phương thức split của StringUtils sẽ trả về null, trong khi sử dụng phương thức split của String sẽ báo lỗi ngoại lệ con trỏ null.</p>
<h3>Kiểm Tra Chuỗi Có Phải Là Số Thuần</h3>
<p>Cho một chuỗi, để kiểm tra nó có phải là số thuần hay không, có thể sử dụng phương thức <code>isNumeric</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "123"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "123q"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str3 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "0.33"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNumeric</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str1));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNumeric</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str2));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isNumeric</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str3));</span></span></code></pre>
</div><p>Kết quả thực thi:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span></code></pre>
</div><h3>Nối Các Phần Tử Của Một Tập Hợp Thành Chuỗi</h3>
<p>Đôi khi, chúng ta cần nối nội dung của một tập hợp thành một chuỗi rồi xuất ra, lúc này có thể sử dụng phương thức <code>join</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"b"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"c"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Lists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list, </span><span style="color:#98C379;--shiki-dark:#98C379">","</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(list2, </span><span style="color:#98C379;--shiki-dark:#98C379">" "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span></code></pre>
</div><p>Kết quả thực thi:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75">b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75">c</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span></span></code></pre>
</div><h3>Các Phương Thức Khác</h3>
<p>Dưới đây là một số phương thức khác, bạn có thể tự nghiên cứu thêm.</p>
<ul>
<li><code>trim(String str)</code>：Loại bỏ khoảng trắng ở đầu và cuối chuỗi.</li>
<li><code>trimToEmpty(String str)</code>：Loại bỏ khoảng trắng ở đầu và cuối chuỗi, nếu chuỗi là null, trả về chuỗi rỗng.</li>
<li><code>trimToNull(String str)</code>：Loại bỏ khoảng trắng ở đầu và cuối chuỗi, nếu kết quả là chuỗi rỗng, trả về null.</li>
<li><code>equals(String str1, String str2)</code>：So sánh hai chuỗi có bằng nhau hay không.</li>
<li><code>equalsIgnoreCase(String str1, String str2)</code>：So sánh hai chuỗi có bằng nhau hay không, không phân biệt chữ hoa và chữ thường.</li>
<li><code>startsWith(String str, String prefix)</code>：Kiểm tra chuỗi có bắt đầu bằng tiền tố được chỉ định hay không.</li>
<li><code>endsWith(String str, String suffix)</code>：Kiểm tra chuỗi có kết thúc bằng hậu tố được chỉ định hay không.</li>
<li><code>contains(String str, CharSequence seq)</code>：Kiểm tra chuỗi có chứa chuỗi con được chỉ định hay không.</li>
<li><code>indexOf(String str, CharSequence seq)</code>：Trả về chỉ mục của chuỗi con được chỉ định xuất hiện đầu tiên trong chuỗi, nếu không tìm thấy, trả về -1.</li>
<li><code>lastIndexOf(String str, CharSequence seq)</code>：Trả về chỉ mục của chuỗi con được chỉ định xuất hiện lần cuối cùng trong chuỗi, nếu không tìm thấy, trả về -1.</li>
<li><code>substring(String str, int start, int end)</code>：Cắt chuỗi con từ vị trí bắt đầu đến vị trí kết thúc chỉ định.</li>
<li><code>replace(String str, String searchString, String replacement)</code>：Thay thế tất cả các xuất hiện của chuỗi tìm kiếm trong chuỗi bằng chuỗi thay thế được chỉ định.</li>
<li><code>replaceAll(String str, String regex, String replacement)</code>：Sử dụng biểu thức chính quy để thay thế tất cả các phần khớp trong chuỗi.</li>
<li><code>join(Iterable&lt;?&gt; iterable, String separator)</code>：Sử dụng dấu phân cách được chỉ định để nối các phần tử trong đối tượng có thể lặp lại thành một chuỗi.</li>
<li><code>split(String str, String separator)</code>：Sử dụng dấu phân cách được chỉ định để phân tách chuỗi thành một mảng chuỗi.</li>
<li><code>capitalize(String str)</code>：Chuyển ký tự đầu tiên của chuỗi thành chữ hoa.</li>
<li><code>uncapitalize(String str)</code>：Chuyển ký tự đầu tiên của chuỗi thành chữ thường.</li>
</ul>
]]></content:encoded>
      <enclosure url="https://cdn.tobebetterjavaer.com/stutymore/StringUtils-20230330111122.png" type="image/png"/>
    </item>
    <item>
      <title>Other Utils</title>
      <link>https://vanhung4499.github.io/programming/java/common-tool/utils.html</link>
      <guid>https://vanhung4499.github.io/programming/java/common-tool/utils.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Other Utils</source>
      <description>Other Utils Ngoài các lớp tiện ích của Java như Arrays, Objects, Collections, Scanner đã được đề cập trước đó, còn có một số lớp tiện ích của bên thứ ba như Hutool, Guava, và nh...</description>
      <category>java</category>
      <pubDate>Thu, 04 Jul 2024 09:37:15 GMT</pubDate>
      <content:encoded><![CDATA[<h3>Other Utils</h3>
<p>Ngoài các lớp tiện ích của Java như <a href="/programming/java/common-tool/arrays">Arrays</a>, <a href="/programming/java/common-tool/objects">Objects</a>, <a href="/programming/java/common-tool/collections">Collections</a>, <a href="/programming/java/common-tool/scanner">Scanner</a> đã được đề cập trước đó, còn có một số lớp tiện ích của bên thứ ba như <a href="/programming/java/common-tool/hutool">Hutool</a>, <a href="/programming/java/common-tool/guava">Guava</a>, và những cái khác như IpUtil, CollectionUtils, StringUtils, MDC, ClassUtils, BeanUtils, ReflectionUtils vv., có thể giúp cải thiện đáng kể hiệu suất sản xuất của chúng ta.</p>
<p>Tất nhiên, nếu bạn có thể xem xét mã nguồn của chúng, nâng cao kỹ năng kỹ thuật sẽ rất hữu ích.</p>
<h3>IpUtil: Lấy địa chỉ IP của máy local</h3>
<p>Việc lấy địa chỉ IP của máy local là một yêu cầu khá phổ biến, ví dụ như trong cảnh báo doanh nghiệp, có thể kèm theo địa chỉ IP của máy gặp vấn đề để dễ dàng nhìn vào nhật ký và định vị vấn đề. Vậy làm thế nào để lấy địa chỉ IP của máy tính?</p>
<h4>1. Phương pháp cơ bản</h4>
<p>Để lấy địa chỉ IP của máy tính, nếu bạn đã hiểu về lớp <code>InetAddress</code>, việc viết một công cụ đơn giản như sau dễ dàng:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getLocalIP</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> InetAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getLocalHost</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getHostAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UnknownHostException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> RuntimeException</span><span style="color:#E06C75;--shiki-dark:#E06C75">(e)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Việc triển khai trên không có vấn đề gì.</p>
<h4>2. Phiên bản nâng cao</h4>
<p>Để lấy địa chỉ IPv4, bạn có thể thực hiện một số thay đổi nhỏ trong mã nguồn:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getLocalIpByNetcard</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Lặp qua tất cả các interface mạng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Enumeration</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NetworkInterface</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> e </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> NetworkInterface</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getNetworkInterfaces</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hasMoreElements</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Lấy interface mạng hiện tại</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            NetworkInterface</span><span style="color:#E06C75;--shiki-dark:#E06C75"> item </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextElement</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Lặp qua tất cả các địa chỉ của interface mạng hiện tại</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">InterfaceAddress</span><span style="color:#E06C75;--shiki-dark:#E06C75"> address </span><span style="color:#C678DD;--shiki-dark:#C678DD">:</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getInterfaceAddresses</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">                // Bỏ qua địa chỉ vòng lặp và các interface mạng chưa kích hoạt</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isLoopback</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> ||</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> !</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isUp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                    continue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">                // Nếu địa chỉ hiện tại là địa chỉ IPv4, trả về địa chỉ dưới dạng chuỗi</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">address</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#C678DD;--shiki-dark:#C678DD"> instanceof</span><span style="color:#E06C75;--shiki-dark:#E06C75"> Inet4Address) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                    Inet4Address</span><span style="color:#E06C75;--shiki-dark:#E06C75"> inet4Address </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (Inet4Address) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">address</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                    return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> inet4Address</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getHostAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">                }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">            }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Nếu không tìm thấy địa chỉ IPv4 nào thích hợp, trả về địa chỉ localhost</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> InetAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getLocalHost</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getHostAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">SocketException</span><span style="color:#E06C75;--shiki-dark:#E06C75"> | </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UnknownHostException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Ném ra ngoại lệ chạy khi xảy ra lỗi</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> RuntimeException</span><span style="color:#E06C75;--shiki-dark:#E06C75">(e)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lưu ý rằng đoạn mã này chỉ trả về địa chỉ IPv4 của máy local và chỉ trả về địa chỉ đầu tiên phù hợp. Nếu máy local có nhiều interface mạng hoặc mỗi interface có nhiều địa chỉ, có thể không trả về địa chỉ mong muốn. Ngoài ra, nếu không tìm thấy bất kỳ địa chỉ IPv4 nào, nó sẽ trả về địa chỉ localhost.</p>
<h4>3. Lớp tiện ích hoàn chỉnh</h4>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.net.*</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.util.Enumeration</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IPUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> DEFAULT_IP </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "127.0.0.1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    /**</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     * Trả về địa chỉ IPv4 của máy local dựa trên địa chỉ mạng đầu tiên</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     *</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic">@return</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> Địa chỉ IPv4 nội bộ đầu tiên phù hợp</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getLocalIpByNetcard</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Lặp qua tất cả các interface mạng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Enumeration</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NetworkInterface</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75">e</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> NetworkInterface</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getNetworkInterfaces</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(); </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hasMoreElements</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(); ) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">                // Lấy interface mạng hiện tại</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                NetworkInterface</span><span style="color:#E06C75;--shiki-dark:#E06C75"> item</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextElement</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">                // Lặp qua tất cả các địa chỉ của interface mạng hiện tại</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">InterfaceAddress</span><span style="color:#E06C75;--shiki-dark:#E06C75"> address</span><span style="color:#C678DD;--shiki-dark:#C678DD"> :</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getInterfaceAddresses</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">                    // Bỏ qua địa chỉ vòng lặp và các interface mạng chưa kích hoạt</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isLoopback</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">||</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> !</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isUp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                        continue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                    }</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">                    // Nếu địa chỉ hiện tại là địa chỉ IPv4, trả về địa chỉ dưới dạng chuỗi</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">address</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">() </span><span style="color:#C678DD;--shiki-dark:#C678DD">instanceof</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> Inet4Address) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                        Inet4Address</span><span style="color:#E06C75;--shiki-dark:#E06C75"> inet4Address</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (Inet4Address) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">address</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> inet4Address</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getHostAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Nếu không tìm thấy địa chỉ IPv4 phù hợp, trả về địa chỉ localhost</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> InetAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getLocalHost</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getHostAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">SocketException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> | </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UnknownHostException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> RuntimeException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(e);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    /**</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     * Lấy địa chỉ IP của máy local</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     *</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic">@return</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> Địa chỉ IP của máy local</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getLocalIP</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> InetAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getLocalHost</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getHostAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UnknownHostException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> RuntimeException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(e);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lớp IPUtil có định nghĩa hai phương thức: <code>getLocalIpByNetcard()</code> và <code>getLocalIP()</code>. Phương thức đầu tiên là để lấy địa chỉ IPv4 nội bộ của máy local, tránh việc trả về 127.0.0.1. Phương thức thứ hai là để lấy địa chỉ IP của máy local, nếu máy local có nhiều địa chỉ IP, có thể trả về bất kỳ địa chỉ nào trong số đó.</p>
<h3>MDC: Một công cụ lưu truyền tham số an toàn cho luồng</h3>
<p><code>MDC</code> là một lớp trong gói [<code>org.slf4j</code>], viết tắt của Mapped Diagnostic Context, có thể coi là một bộ chứa an toàn cho các nhật ký chẩn đoán được lưu trữ trong luồng.</p>
<p>MDC sử dụng <a href="/programming/java/thread/ThreadLocal.html" target="_blank"><code>ThreadLocal</code></a> để lưu trữ dữ liệu ở cấp độ luồng.</p>
<p>Chúng ta có thể sử dụng nó để truyền tham số. Ví dụ, trong một kịch bản như sau: khi sử dụng <code>RestTemplate</code> để gọi một API từ xa, đôi khi cần truyền một số thông tin trong <code>header</code>, ví dụ như traceId, source và còn nữa, để có thể liên kết toàn bộ chuỗi yêu cầu một cách hoàn chỉnh khi xem nhật ký và nhanh chóng định vị vấn đề.</p>
<p>Kịch bản kinh doanh này có thể được thực hiện thông qua giao diện <code>ClientHttpRequestInterceptor</code>, cụ thể như sau:</p>
<p>Bước đầu tiên, định nghĩa một bộ lọc <code>LogFilter</code> để chặn tất cả các yêu cầu gọi API và thiết lập traceId trong MDC:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> LogFilter</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Filter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> doFilter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ServletRequest</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> request</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ServletResponse</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> response</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FilterChain</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> chain</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ServletException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        MdcUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UUID</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">randomUUID</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Ghi nhật ký yêu cầu"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        chain</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">doFilter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(request, response);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Ghi nhật ký phản hồi"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Các phương thức khác của Filter không được hiển thị để ngắn gọn</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Bước thứ hai, triển khai <code>ClientHttpRequestInterceptor</code> để lấy traceId hiện tại từ MDC và thiết lập nó vào header của yêu cầu:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> RestTemplateInterceptor</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ClientHttpRequestInterceptor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ClientHttpResponse</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> intercept</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">HttpRequest</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> request</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">body</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClientHttpRequestExecution</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> execution</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        request</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getHeaders</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"traceId"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">MdcUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> execution</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">execute</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(request, body);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Bước thứ ba, định nghĩa một lớp cấu hình để cấu hình <code>RestTemplateInterceptor</code> đã định nghĩa:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Configuration</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> RestTemplateConfiguration</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Bean</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> RestTemplate</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> restTemplate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        RestTemplate</span><span style="color:#E06C75;--shiki-dark:#E06C75"> restTemplate</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> RestTemplate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        restTemplate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setInterceptors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">singletonList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">restTemplateInterceptor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()));</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> restTemplate;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Bean</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> RestTemplateInterceptor</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> restTemplateInterceptor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> RestTemplateInterceptor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Trong đó, <code>MdcUtil</code> thực chất là một lớp sử dụng công cụ MDC để lưu trữ và truy xuất traceId trong <code>ThreadLocal</code>:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> MdcUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> TRACE_ID </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "TRACE_ID"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> MDC</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(TRACE_ID);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        MDC</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(TRACE_ID, value);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Trong ví dụ này, chúng ta không thể thấy cụ thể nơi <code>add</code> phương thức của lớp MdcUtil được gọi, thường thì chúng ta sẽ tạo traceId trước khi thực hiện phương thức của giao diện, thêm nó vào MDC bằng cách gọi <code>add</code> phương thức của lớp MdcUtil, sau đó ở các nơi khác của cùng một yêu cầu, chúng ta có thể lấy được traceId này thông qua <code>get</code> phương thức của lớp MdcUtil.</p>
<p>Việc sử dụng MDC để lưu trữ các tham số như traceId trong suốt quá trình của yêu cầu là vì, khi yêu cầu của người dùng đến máy chủ ứng dụng, Tomcat sẽ cấp phát một luồng từ bể luồng để xử lý yêu cầu này.</p>
<p>Do đó, các tham số được lưu trữ trong MDC, trong ThreadLocal, cũng chỉ thuộc về luồng đó, vì vậy không có vấn đề về an toàn luồng.</p>
<h3>ClassUtils</h3>
<p><code>ClassUtils</code> là một lớp trong gói <code>org.springframework.util</code> của Spring, nó cung cấp nhiều chức năng hữu ích liên quan đến lớp và đối tượng.</p>
<h4>Lấy tất cả các interface của đối tượng</h4>
<p>Nếu bạn muốn lấy tất cả các interface của một đối tượng, bạn có thể sử dụng phương thức <code>getAllInterfaces</code> của <code>ClassUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD">?</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] allInterfaces </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ClassUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAllInterfaces</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span></code></pre>
</div><h4>Lấy tên gói của một lớp</h4>
<p>Nếu bạn muốn lấy tên gói của một lớp, bạn có thể sử dụng phương thức <code>getPackageName</code> của <code>ClassUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> packageName </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ClassUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPackageName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(packageName);</span></span></code></pre>
</div><h4>Kiểm tra xem một lớp có phải là lớp nội bộ không</h4>
<p>Nếu bạn muốn kiểm tra xem một lớp có phải là lớp nội bộ không, bạn có thể sử dụng phương thức <code>isInnerClass</code> của <code>ClassUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClassUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isInnerClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span></code></pre>
</div><h4>Kiểm tra xem một đối tượng có phải là đối tượng proxy không</h4>
<p>Nếu bạn muốn kiểm tra xem một đối tượng có phải là đối tượng proxy không, bạn có thể sử dụng phương thức <code>isCglibProxy</code> của <code>ClassUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClassUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isCglibProxy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()));</span></span></code></pre>
</div><p><code>ClassUtils</code> còn rất nhiều phương thức hữu ích khác đang chờ bạn khám phá. Nếu bạn quan tâm, bạn có thể tìm hiểu thêm về chúng.</p>
<figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/utils-c58920ac-cf04-4d95-ad29-90339a086569.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h3>BeanUtils</h3>
<p>Spring cung cấp cho chúng ta một công cụ tiện ích cho các JavaBean, nằm trong gói <code>org.springframework.beans</code>, được gọi là <code>BeanUtils</code>.</p>
<p>Hãy cùng nhau khám phá những điều bất ngờ mà công cụ này có thể mang lại.</p>
<h4>Sao chép các thuộc tính của đối tượng</h4>
<p>Đôi khi bạn có nhu cầu sao chép tất cả các thuộc tính của một đối tượng sang một đối tượng khác. Khi đó bạn có thể sử dụng phương thức <code>copyProperties</code> của <code>BeanUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">User</span><span style="color:#E06C75;--shiki-dark:#E06C75"> user1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> User</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">user1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">user1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">user1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"NY"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">User</span><span style="color:#E06C75;--shiki-dark:#E06C75"> user2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> User</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BeanUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyProperties</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(user1, user2);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(user2);</span></span></code></pre>
</div><h4>Instantiate một lớp cụ thể</h4>
<p>Nếu bạn muốn khởi tạo một đối tượng của một lớp bằng phản chiếu, bạn có thể sử dụng phương thức <code>instantiateClass</code> của <code>BeanUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">User</span><span style="color:#E06C75;--shiki-dark:#E06C75"> user </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> BeanUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">instantiateClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(user);</span></span></code></pre>
</div><h4>Lấy phương thức cụ thể của một lớp</h4>
<p>Nếu bạn muốn lấy một phương thức cụ thể của một lớp, bạn có thể sử dụng phương thức <code>findDeclaredMethod</code> của <code>BeanUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Method</span><span style="color:#E06C75;--shiki-dark:#E06C75"> declaredMethod </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> BeanUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">findDeclaredMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"getId"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">declaredMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span></code></pre>
</div><h4>Lấy tham số của một phương thức cụ thể</h4>
<p>Nếu bạn muốn lấy các tham số của một phương thức, bạn có thể sử dụng phương thức <code>findPropertyForMethod</code> của <code>BeanUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Method</span><span style="color:#E06C75;--shiki-dark:#E06C75"> declaredMethod </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> BeanUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">findDeclaredMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"getId"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">PropertyDescriptor</span><span style="color:#E06C75;--shiki-dark:#E06C75"> propertyForMethod </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> BeanUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">findPropertyForMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(declaredMethod);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">propertyForMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span></code></pre>
</div><p>Nếu bạn quan tâm đến <code>BeanUtils</code>, bạn có thể tìm hiểu thêm về nó trong những nội dung dưới đây:</p>
<figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/utils-629ecd75-259b-46aa-b1dd-82606cfc92ee.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h3>ReflectionUtils</h3>
<p>Đôi khi, chúng ta cần sử dụng tính năng <code>phản xạ</code> trong dự án. Nếu sử dụng các phương pháp cơ bản để phát triển, mã sẽ rất dài và phức tạp, yêu cầu xử lý nhiều ngoại lệ và vấn đề quyền truy cập.</p>
<p>Tin vui là Spring cung cấp cho chúng ta một công cụ tiện ích <code>ReflectionUtils</code>, nằm trong gói <code>org.springframework.util</code>.</p>
<h4>Lấy phương thức</h4>
<p>Nếu bạn muốn lấy một phương thức cụ thể của một lớp, bạn có thể sử dụng phương thức <code>findMethod</code> của lớp <code>ReflectionUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Method</span><span style="color:#E06C75;--shiki-dark:#E06C75"> method </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ReflectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">findMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"getId"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h4>Lấy trường</h4>
<p>Nếu bạn muốn lấy một trường cụ thể của một lớp, bạn có thể sử dụng phương thức <code>findField</code> của lớp <code>ReflectionUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Field</span><span style="color:#E06C75;--shiki-dark:#E06C75"> field </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ReflectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">findField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h4>Thực thi phương thức</h4>
<p>Nếu bạn muốn gọi một phương thức thông qua phản xạ và truyền tham số, bạn có thể sử dụng phương thức <code>invokeMethod</code> của lớp <code>ReflectionUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ReflectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">invokeMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(method, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">springContextsUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBean</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(beanName), param);</span></span></code></pre>
</div><h4>Kiểm tra xem trường có phải là hằng số</h4>
<p>Nếu bạn muốn kiểm tra xem một trường có phải là hằng số không, bạn có thể sử dụng phương thức <code>isPublicStaticFinal</code> của lớp <code>ReflectionUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Field</span><span style="color:#E06C75;--shiki-dark:#E06C75"> field </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ReflectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">findField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ReflectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isPublicStaticFinal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(field));</span></span></code></pre>
</div><h4>Kiểm tra xem phương thức có phải là phương thức equals</h4>
<p>Nếu bạn muốn kiểm tra xem một phương thức có phải là phương thức equals không, bạn có thể sử dụng phương thức <code>isEqualsMethod</code> của lớp <code>ReflectionUtils</code>. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Method</span><span style="color:#E06C75;--shiki-dark:#E06C75"> method </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ReflectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">findMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"getId"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ReflectionUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isEqualsMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(method));</span></span></code></pre>
</div><p>Lớp này còn có nhiều phương thức thú vị khác. Nếu bạn quan tâm, có thể tìm hiểu thêm trong các nội dung dưới đây:</p>
<figure><img src="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/utils-0a4ecb9c-b9d2-4090-a7b7-c626a0672b94.jpg" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
]]></content:encoded>
      <enclosure url="https://cdn.tobebetterjavaer.com/tobebetterjavaer/images/common-tool/utils-c58920ac-cf04-4d95-ad29-90339a086569.jpg" type="image/jpeg"/>
    </item>
    <item>
      <title>Exception Handling Best Practices</title>
      <link>https://vanhung4499.github.io/programming/java/exception/best-practices.html</link>
      <guid>https://vanhung4499.github.io/programming/java/exception/best-practices.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Exception Handling Best Practices</source>
      <description>Exception Handling Best Practices 20 Best Practices Về Xử Lý Exception 01. Tránh bắt RuntimeException nếu có thể Java Development Manual của Alibaba quy định như sau: Tránh bắt ...</description>
      <category>java</category>
      <pubDate>Wed, 03 Jul 2024 16:21:43 GMT</pubDate>
      <content:encoded><![CDATA[
<p>20 Best Practices Về Xử Lý Exception</p>
<h3>01. Tránh bắt RuntimeException nếu có thể</h3>
<p>Java Development Manual của Alibaba quy định như sau:</p>
<blockquote>
<p>Tránh bắt RuntimeException nếu có thể, chẳng hạn như NullPointerException, IndexOutOfBoundsException, v.v. Nên sử dụng phương pháp kiểm tra trước để ngăn ngừa.</p>
</blockquote>
<p>Ví dụ đúng:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (obj </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  //...</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Ví dụ sai:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> { </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">  obj</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">method</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#E06C75;--shiki-dark:#E06C75"> </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NullPointerException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  //...</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Vậy nếu có những exception mà không thể kiểm tra trước thì sao?</p>
<p>Thực tế sẽ có những trường hợp như vậy, chẳng hạn như NumberFormatException, mặc dù cũng thuộc RuntimeException nhưng không thể kiểm tra trước, vì vậy vẫn nên sử dụng catch để bắt và xử lý.</p>
<h3>02. Cố gắng sử dụng try-with-resource để đóng tài nguyên</h3>
<p>Khi cần đóng tài nguyên, tránh sử dụng try-catch-finally, và không đóng tài nguyên trực tiếp trong khối try.</p>
<p>Ví dụ sai:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> doNotCloseResourceInTry</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> inputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"./tmp.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        inputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        inputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(e);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(e);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Tại sao lại như vậy?</p>
<p>Lý do rất đơn giản, vì nếu xảy ra exception trước khi <code>close()</code>, tài nguyên sẽ không được đóng. Sử dụng <a href="https://javabetter.cn/exception/try-with-resources.html" target="_blank" rel="noopener noreferrer">try-with-resource</a> để xử lý là cách tốt nhất.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> automaticallyCloseResource</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"./tmp.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> inputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(e);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(e);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Trừ khi tài nguyên không triển khai interface AutoCloseable. Hãy đóng tài nguyên trong khối finally.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> closeResourceInFinally</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> inputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"./tmp.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        inputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(e);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (inputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                inputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">            } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(e);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">            }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>03. Không bắt Throwable</h3>
<p>Throwable là cha của exception và error, nếu bắt Throwable trong khối catch, có thể bắt luôn cả những lỗi vượt quá khả năng xử lý của chương trình.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> doNotCatchThrowable</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Throwable</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> t</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Đừng làm thế này</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Tại sao lại như vậy?</p>
<p>Vì có những lỗi không cần chương trình xử lý và chương trình cũng không thể xử lý được, như OutOfMemoryError hoặc StackOverflowError. OutOfMemoryError xảy ra khi Java VM không thể yêu cầu đủ không gian bộ nhớ, còn StackOverflowError xảy ra khi độ sâu của stack mà một thread yêu cầu vượt quá độ sâu tối đa cho phép. Nếu bắt chúng, sẽ che giấu những lỗi nghiêm trọng mà chương trình cần phát hiện.</p>
<p>Ví dụ như một con ngựa chỉ có thể kéo một toa hàng, nếu kéo hai toa có thể sẽ gục ngã, nhưng nếu bắt lỗi, sẽ không phát hiện ra vấn đề.</p>
<h3>04. Không bỏ qua việc ghi lại thông tin exception</h3>
<p>Nhiều khi, do bất cẩn, chúng ta dễ dàng bắt exception mà không ghi lại thông tin exception, dẫn đến việc khi chương trình gặp sự cố thật sự, không có thông tin ghi lại để kiểm tra.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> doNotIgnoreExceptions</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NumberFormatException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Không ghi lại exception</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Nên ghi lại thông tin lỗi.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> logAnException</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NumberFormatException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Ôi, lỗi đã xảy ra: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> e);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><h3>05. Không ghi lại exception rồi lại ném ra exception</h3>
<p>Điều này hoàn toàn thừa thãi và dễ gây ra sự nhầm lẫn về thông tin lỗi.</p>
<p>Ví dụ sai:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NumberFormatException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(e);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    throw</span><span style="color:#E06C75;--shiki-dark:#E06C75"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Nếu ném ra exception thì hãy ném ra, không cần ghi lại. Ghi lại rồi ném ra cũng giống như thừa thãi.</p>
<p>Ví dụ sai:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> wrapException</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> input) throws MyBusinessException {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NumberFormatException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> MyBusinessException</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Thông tin lỗi: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> e)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Điều này cũng tương tự, đã bắt exception thì không cần ném ra trong chữ ký phương thức.</p>
<h3>06. Không sử dụng return trong khối finally</h3>
<p>Java Development Manual của Alibaba quy định như sau:</p>
<blockquote>
<p>Khi câu lệnh return trong khối try thực thi thành công, sẽ không trả về ngay lập tức, mà sẽ tiếp tục thực thi các câu lệnh trong khối finally. Nếu trong khối finally cũng có câu lệnh return, thì câu lệnh return trong khối try sẽ bị ghi đè.</p>
</blockquote>
<p>Ví dụ sai:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> x </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> checkReturn</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ++</span><span style="color:#E06C75;--shiki-dark:#E06C75">x</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ++</span><span style="color:#E06C75;--shiki-dark:#E06C75">x</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Giá trị của x trả về từ khối try là 1, nhưng đến khối finally lại trả về 2.</p>
<h3>07. Ném ra các exception kiểm tra cụ thể thay vì Exception</h3>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> foo</span><span style="color:#E06C75;--shiki-dark:#E06C75">() throws Exception { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Cách sai</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Nhất định phải tránh xuất hiện đoạn mã như trên, nó phá vỡ mục đích của exception kiểm tra (checked exception). Phương thức được khai báo nên ném ra các exception kiểm tra cụ thể.</p>
<p>Ví dụ, nếu một phương thức có thể ném ra exception SQLException, nên khai báo rõ ràng ném ra SQLException thay vì exception kiểu Exception. Như vậy, các nhà phát triển khác có thể hiểu rõ hơn ý định và cách xử lý exception của mã, và có thể xác định cách xử lý và chiến lược dựa trên định nghĩa và tài liệu của SQLException.</p>
<h3>08. Bắt các lớp con cụ thể thay vì bắt lớp Exception</h3>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">   someMethod</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Cách sai</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">   LOGGER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"method has failed"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, e);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Nếu trong khối catch bắt exception kiểu Exception, sẽ bắt tất cả các loại exception, dẫn đến các vấn đề không cần thiết cho chương trình. Cụ thể, nếu bắt exception kiểu Exception, có thể dẫn đến các vấn đề sau:</p>
<ul>
<li>Khó nhận diện và định vị exception: Nếu bắt exception kiểu Exception, có thể sẽ bắt những exception không nên được xử lý, dẫn đến việc chương trình khó nhận diện và định vị exception.</li>
<li>Khó gỡ lỗi và sửa lỗi: Nếu bắt exception kiểu Exception, có thể làm cho việc gỡ lỗi và sửa lỗi trở nên khó khăn hơn, vì không thể xác định loại exception cụ thể và nguyên nhân xảy ra exception.</li>
</ul>
<p>Dưới đây là một ví dụ để minh họa tại sao nên bắt các lớp con cụ thể thay vì exception kiểu Exception.</p>
<p>Giả sử chúng ta có một phương thức <code>readFromFile(String filePath)</code>, dùng để đọc dữ liệu từ một tệp chỉ định. Trong quá trình thực hiện phương thức, có thể xuất hiện hai loại exception: FileNotFoundException và IOException.</p>
<p>Nếu trong phương thức sử dụng khối catch sau để bắt exception:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Mã đọc dữ liệu</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Mã xử lý exception</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Cách làm này sẽ bắt tất cả các loại exception, bao gồm cả Checked Exception và Unchecked Exception. Điều này có thể dẫn đến các vấn đề sau:</p>
<ul>
<li>Khi xảy ra exception kiểu RuntimeException, cũng sẽ bị bắt, dẫn đến việc che giấu thông tin exception thực sự.</li>
<li>Khi gỡ lỗi và sửa lỗi, không thể xác định loại exception cụ thể và nguyên nhân xảy ra exception, tăng độ khó khăn trong việc gỡ lỗi và sửa lỗi.</li>
<li>Khi chương trình chạy, có thể bắt một số exception không cần thiết phải xử lý (như NullPointerException, IllegalArgumentException, v.v.), dẫn đến giảm hiệu suất và ổn định của chương trình.</li>
</ul>
<p>Do đó, để định vị và xử lý exception tốt hơn, nên bắt các lớp con cụ thể, ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Mã đọc dữ liệu</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Mã xử lý exception tệp không tìm thấy</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Mã xử lý exception đầu vào/đầu ra</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Cách làm này giúp bắt exception chính xác hơn, từ đó cải thiện độ bền vững và ổn định của chương trình.</p>
<h3>09. Khi tự định nghĩa exception, đừng bỏ qua theo dõi ngăn xếp</h3>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NoSuchMethodException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">   throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> MyServiceException</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Some information: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getMessage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Cách sai</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Điều này phá vỡ theo dõi ngăn xếp của exception gốc, cách đúng là:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NoSuchMethodException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">   throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> MyServiceException</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Some information: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> e)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Cách đúng</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Ví dụ, dưới đây là một lớp exception tự định nghĩa, nó ghi đè phương thức <code>printStackTrace()</code> để in thông tin theo dõi ngăn xếp:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> MyException</span><span style="color:#C678DD;--shiki-dark:#C678DD"> extends</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> MyException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Throwable</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> cause</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        super</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(message, cause);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"MyException:"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        super</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Cách làm này giúp giữ lại thông tin theo dõi ngăn xếp, đồng thời cung cấp thông tin exception tự định nghĩa. Khi ném ra exception MyException, bạn có thể nhận được thông tin theo dõi ngăn xếp đầy đủ, giúp định vị và giải quyết exception tốt hơn.</p>
<h3>10. Đừng ném ra bất kỳ exception nào trong khối finally</h3>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  someMethod</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Ném ra exceptionOne</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  cleanUp</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Nếu finally cũng ném ra exception, thì exceptionOne sẽ bị mất</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Khối finally được sử dụng để định nghĩa một đoạn mã, dù khối try có xuất hiện exception hay không, thì đoạn mã này vẫn sẽ được thực thi. Khối finally thường được dùng để giải phóng tài nguyên, đóng tệp và các thao tác cần thiết khác.</p>
<p>Nếu trong khối finally ném ra exception, có thể dẫn đến việc exception gốc bị che giấu. Ví dụ, trong đoạn mã trên, nếu cleanup ném ra exception, thì exception trong someMethod sẽ bị ghi đè.</p>
<h3>11. Đừng sử dụng <code>printStackTrace()</code> trong môi trường sản xuất</h3>
<p>Trong Java, phương thức <code>printStackTrace()</code> được sử dụng để xuất thông tin theo dõi ngăn xếp của exception ra luồng lỗi chuẩn. Phương thức này rất hữu ích cho việc gỡ lỗi và sửa lỗi. Tuy nhiên, trong môi trường sản xuất, không nên sử dụng phương thức <code>printStackTrace()</code>, vì nó có thể gây ra các vấn đề sau:</p>
<ul>
<li>Phương thức <code>printStackTrace()</code> sẽ xuất thông tin theo dõi ngăn xếp của exception ra luồng lỗi chuẩn, có thể làm lộ thông tin nhạy cảm như đường dẫn tệp, tên người dùng, mật khẩu, v.v.</li>
<li>Phương thức <code>printStackTrace()</code> sẽ xuất thông tin theo dõi ngăn xếp ra luồng lỗi chuẩn, có thể ảnh hưởng đến hiệu suất và độ ổn định của chương trình. Trong môi trường sản xuất có độ tải cao, lượng lớn thông tin theo dõi ngăn xếp của exception có thể dẫn đến hệ thống bị treo hoặc xuất hiện hành vi không mong muốn.</li>
<li>Vì môi trường sản xuất thường là hệ thống phức tạp đa luồng, phân tán, thông tin theo dõi ngăn xếp được xuất ra bởi phương thức <code>printStackTrace()</code> có thể không đầy đủ hoặc không chính xác.</li>
</ul>
<p>Trong môi trường sản xuất, nên sử dụng hệ thống nhật ký để ghi lại thông tin exception, ví dụ như <a href="/tools/log4j.html" target="_blank">log4j</a>, <a href="/tools/slf4j.html" target="_blank">slf4j</a>, <a href="/tools/logback.html" target="_blank">logback</a>, v.v. Hệ thống nhật ký có thể ghi lại thông tin exception vào tệp hoặc cơ sở dữ liệu, mà không làm lộ thông tin nhạy cảm và không ảnh hưởng đến hiệu suất và độ ổn định của chương trình. Đồng thời, hệ thống nhật ký cũng cung cấp nhiều chức năng hơn như kiểm soát cấp độ, nhật ký cuộn, thông báo qua email, v.v.</p>
<p>Ví dụ, có thể sử dụng logback để ghi lại thông tin exception như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // some code</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"An error occurred: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, e);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><h3>12. Đối với các exception không định xử lý, chỉ sử dụng try-finally mà không dùng catch</h3>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  method1</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Sẽ gọi Method 2</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  cleanUp</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Thực hiện dọn dẹp ở đây</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Nếu method1 đang gọi Method 2, và Method 2 ném ra một exception mà bạn không muốn xử lý trong Method 1, nhưng vẫn muốn thực hiện một số việc dọn dẹp khi xảy ra exception, bạn có thể thực hiện việc dọn dẹp trực tiếp trong khối finally mà không cần sử dụng khối catch.</p>
<h3>13. Ghi nhớ nguyên tắc "ném sớm, bắt muộn"</h3>
<p>"ném sớm, bắt muộn" là một nguyên tắc xử lý exception trong Java. Nguyên tắc này có nghĩa là ném exception càng sớm càng tốt trong mã nguồn để có thể xử lý kịp thời khi xảy ra exception. Đồng thời, cố gắng bắt exception muộn nhất có thể trong khối catch để có được nhiều thông tin ngữ cảnh hơn, từ đó xử lý exception tốt hơn.</p>
<p>Hãy xem một ví dụ về "ném sớm", nếu một phương thức cần truyền tham số và tham số đó phải đáp ứng một số điều kiện nhất định, nếu tham số không thỏa mãn điều kiện, thì nên ném exception ngay lập tức thay vì thực hiện các thao tác khác trong phương thức. Điều này đảm bảo exception được xử lý kịp thời khi xảy ra, tránh các vấn đề nghiêm trọng hơn.</p>
<p>Tiếp theo là một ví dụ về "bắt muộn", nếu một phương thức gọi các phương thức khác và có thể ném ra exception, nếu bắt exception ngay trong phương thức, điều này có thể dẫn đến việc xử lý exception không đầy đủ.</p>
<p>Xem đoạn mã sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ExceptionDemo1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Scanner</span><span style="color:#E06C75;--shiki-dark:#E06C75"> sc</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Scanner</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> sc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">nextLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> num</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> parseInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Kết quả chuyển đổi: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> num);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NumberFormatException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chuyển đổi thất bại: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getMessage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> parseInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> str</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> ||</span><span style="color:#98C379;--shiki-dark:#98C379"> ""</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">equals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str)) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> NullPointerException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chuỗi trống"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">str</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">matches</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\\</span><span style="color:#98C379;--shiki-dark:#98C379">d+"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> NumberFormatException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chuỗi không phải là số"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">parseInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ví dụ này, phương thức <code>parseInt()</code> được định nghĩa để chuyển đổi chuỗi thành số nguyên. Trong phương thức này, đầu tiên kiểm tra xem chuỗi có trống không, nếu trống thì ném exception NullPointerException ngay lập tức. Sau đó, kiểm tra chuỗi có phải là số không, nếu không phải số thì ném exception NumberFormatException. Cuối cùng, sử dụng phương thức <code>Integer.parseInt()</code> để chuyển đổi chuỗi thành số nguyên và trả về.</p>
<p>Trong phương thức <code>main()</code> của ví dụ, gọi phương thức <code>parseInt()</code> và sử dụng khối try-catch để bắt exception NumberFormatException có thể bị ném ra. Nếu chuyển đổi thành công, in ra kết quả chuyển đổi, nếu không thì in ra thông tin chuyển đổi thất bại.</p>
<p>Ví dụ này áp dụng nguyên tắc "ném sớm, bắt muộn", trong phương thức <code>parseInt()</code> ném exception càng sớm càng tốt, trong phương thức <code>main()</code> bắt exception càng muộn càng tốt để có được nhiều thông tin ngữ cảnh hơn, từ đó xử lý exception tốt hơn.</p>
<p>Chạy ví dụ này, nếu nhập vào một chuỗi số, có thể thấy kết quả chuyển đổi được in ra. Nếu nhập vào một chuỗi không phải là số, thì thông tin chuyển đổi thất bại sẽ được in ra.</p>
<h3>14. Chỉ ném ra các exception liên quan đến phương thức</h3>
<p>Mối liên quan là rất quan trọng để giữ mã code gọn gàng. Một phương thức cố gắng đọc tệp, nếu ném ra NullPointerException, thì nó sẽ không cung cấp thông tin hữu ích cho người dùng. Thay vào đó, việc bọc exception này trong một exception tùy chỉnh sẽ tốt hơn. Ví dụ, sử dụng NoSuchFileFoundException sẽ hữu ích hơn đối với người dùng của phương thức này.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Demo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> result</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> divide</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Kết quả là: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> result);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ArithmeticException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Lỗi: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getMessage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> divide</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArithmeticException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ArithmeticException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chia cho số không"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> a </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">/</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> b;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ví dụ này, chỉ có exception ArithmeticException liên quan đến phương thức được ném ra, điều này làm cho mã code trở nên rõ ràng và dễ bảo trì hơn.</p>
<h3>15. Không được sử dụng exception để điều khiển luồng trong mã code</h3>
<p>Sử dụng exception để điều khiển luồng trong mã code sẽ dẫn đến vấn đề về độ đọc được, dễ bảo trì và hiệu suất của mã code.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Demo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> input</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "1,2,3,a,5"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75">values</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">split</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">","</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> value</span><span style="color:#C678DD;--shiki-dark:#C678DD"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> values) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> num</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">parseInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(value);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(num);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NumberFormatException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(value </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> " không phải là số hợp lệ"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Mặc dù ví dụ này có thể xử lý các ký tự không phải số trong chuỗi nhập vào một cách chính xác, nhưng việc sử dụng exception để điều khiển luồng làm cho mã code trở nên lộn xộn và khó hiểu. Nên sử dụng các cấu trúc điều khiển khác phù hợp như if, switch, vòng lặp để quản lý luồng của chương trình.</p>
<h3>16. Xác minh ngay lập tức đầu vào người dùng để bắt lỗi sớm trong xử lý yêu cầu</h3>
<p>Ví dụ: Trong kịch bản kinh doanh đăng ký người dùng, nếu thực hiện như sau:</p>
<ol>
<li>Xác minh người dùng</li>
<li>Chèn dữ liệu người dùng</li>
<li>Xác minh địa chỉ</li>
<li>Chèn dữ liệu địa chỉ</li>
<li>Nếu có vấn đề, quay lại trạng thái ban đầu</li>
</ol>
<p>Đây là cách làm không đúng, nó có thể khiến cơ sở dữ liệu ở trạng thái không nhất quán trong nhiều tình huống. Thay vào đó, bạn nên xác minh tất cả nội dung trước khi cập nhật cơ sở dữ liệu. Cách làm đúng là:</p>
<ol>
<li>Xác minh người dùng</li>
<li>Xác minh địa chỉ</li>
<li>Chèn dữ liệu người dùng</li>
<li>Chèn dữ liệu địa chỉ</li>
<li>Nếu có vấn đề, quay lại trạng thái ban đầu</li>
</ol>
<p>Ví dụ, nếu chúng ta sử dụng JDBC để chèn dữ liệu vào cơ sở dữ liệu, thì tốt nhất là validate trước, sau đó insert, thay vì validateUserInput, insertUserData, validateAddressInput, insertAddressData.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Connection</span><span style="color:#E06C75;--shiki-dark:#E06C75"> conn </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Kết nối đến cơ sở dữ liệu</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    conn </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> DriverManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getConnection</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"jdbc:mysql://localhost:3306/mydatabase"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"username"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"password"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Bắt đầu giao dịch</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setAutoCommit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Xác minh đầu vào người dùng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    validateUserInput</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Chèn dữ liệu người dùng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    insertUserData</span><span style="color:#E06C75;--shiki-dark:#E06C75">(conn)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Xác minh đầu vào địa chỉ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    validateAddressInput</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Chèn dữ liệu địa chỉ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    insertAddressData</span><span style="color:#E06C75;--shiki-dark:#E06C75">(conn)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Commit giao dịch nếu mọi thứ thành công</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">commit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">SQLException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Quay lại giao dịch nếu có lỗi</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (conn </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">rollback</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">SQLException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> ex</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Lỗi: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ex</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getMessage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Lỗi: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getMessage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đóng kết nối cơ sở dữ liệu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (conn </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">SQLException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Lỗi: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getMessage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đây là một ví dụ minh họa về cách xử lý giao dịch trong JDBC, trong đó đầu tiên là xác minh đầu vào trước khi thực hiện các thao tác cơ sở dữ liệu, và quay lại trạng thái ban đầu nếu có lỗi xảy ra.</p>
<h3>17. Mỗi exception chỉ nên được bao gồm trong một bản ghi nhật ký</h3>
<p>Không nên làm như thế này:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">debug</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Using cache sector A"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">debug</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Using retry sector B"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Trong môi trường đơn luồng, điều này có vẻ không có vấn đề gì, nhưng trong môi trường đa luồng, hai dòng mã này có thể in ra rất nhiều nội dung khác nhau ở giữa chúng, làm cho việc điều tra vấn đề trở nên rất khó khăn. Thay vào đó, bạn nên làm như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">LOGGER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">debug</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Using cache sector A, using retry sector B"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>18. Truyền tất cả thông tin liên quan tối đa có thể cho exception</h3>
<p>Thông tin exception và đám mây của nó là rất quan trọng. Nếu nhật ký của bạn không thể xác định vị trí của exception, thì nó cũng vô dụng.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi thông báo exception và đám mây</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">LOGGER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">debug</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Lỗi khi đọc tập tin"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, e);</span></span></code></pre>
</div><p>Hãy cố gắng truyền cả <code>String message, Throwable cause</code> để ghi ra thông tin exception và đám mây.</p>
<h3>19. Dừng luồng bị gián đoạn</h3>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">100000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">InterruptedException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {} </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đừng làm như vậy</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  doSomethingCool</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>InterruptedException cho biết rằng bạn nên dừng việc mà chương trình của bạn đang làm, ví dụ như thời gian chờ hoặc đóng một bể luồng.</p>
<p>Nên cố gắng hoàn thành việc đang làm và kết thúc luồng hiện tại đang thực thi thay vì bỏ qua InterruptedException. Chương trình được sửa đổi như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">100000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">InterruptedException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    break</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">doSomethingCool</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>20. Sử dụng phương thức mẫu cho các khối try-catch lặp lại</h3>
<p>Các khối catch tương tự không có ích và chỉ làm tăng sự lặp lại của mã. Đối với các vấn đề như vậy, bạn có thể sử dụng phương thức mẫu.</p>
<p>Ví dụ, trong xử lý exception khi đóng kết nối cơ sở dữ liệu.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> DBUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> closeConnection</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Connection</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> ex</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Ghi nhật ký exception - Không thể đóng kết nối</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Phương thức này sẽ được sử dụng ở nhiều nơi trong ứng dụng của bạn. Thay vì đặt mã này khắp nơi, bạn nên định nghĩa phương thức như trên, sau đó sử dụng nó như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> dataAccessCode</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Connection</span><span style="color:#E06C75;--shiki-dark:#E06C75"> conn </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        conn </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getConnection</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // ... Các thao tác truy cập dữ liệu</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        DBUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">closeConnection</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(conn);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Về phần thực hành xử lý exception thì đây là 20 điều mình đã nói trên. Trong thực tế, khi làm việc, có thể bạn sẽ gặp phải một số vấn đề khác, nhưng sẽ dễ nhớ hơn nếu bạn tự mình vấp phải chúng.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Try With Resources</title>
      <link>https://vanhung4499.github.io/programming/java/exception/try-with-resources.html</link>
      <guid>https://vanhung4499.github.io/programming/java/exception/try-with-resources.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Try With Resources</source>
      <description>try-with-resources Trước khi bắt đầu, chúng ta hãy cùng ôn lại một chút về try–catch-finally để làm nền tảng nhé. Trong khối try, chúng ta đọc nội dung từ tệp và in từng dòng ra...</description>
      <category>java</category>
      <pubDate>Wed, 03 Jul 2024 16:21:43 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Trước khi bắt đầu, chúng ta hãy cùng ôn lại một chút về try–catch-finally để làm nền tảng nhé.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> TrycatchfinallyDecoder</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> br</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> path</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> TrycatchfinallyDecoder</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getResource</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/abc.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> decodePath</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> URLDecoder</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">decode</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(path,</span><span style="color:#98C379;--shiki-dark:#98C379">"utf-8"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            br </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedReader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(decodePath));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ((str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (br </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                    br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong khối try, chúng ta đọc nội dung từ tệp và in từng dòng ra màn hình điều khiển. Nếu không tìm thấy tệp hoặc xảy ra lỗi đọc/ghi IO, thì lỗi sẽ được bắt trong khối catch và in ra thông tin ngăn xếp lỗi. Cuối cùng, trong khối finally, chúng ta đóng đối tượng BufferedReader, đảm bảo rằng tài nguyên được đóng đúng cách để tránh hậu quả nghiêm trọng về hiệu suất khi tài nguyên không được đóng.</p>
<p>Trước Java 7, try–catch-finally là cách tốt nhất để đảm bảo tài nguyên sẽ được đóng kịp thời, dù chương trình có ném ra exception hay không.</p>
<p>Tuy nhiên, đoạn mã này vẫn có chút cồng kềnh, đặc biệt là phần mã trong khối finally. Hơn nữa, try–catch-finally luôn tiềm ẩn một nguy cơ nghiêm trọng: phương thức <code>br.readLine()</code> trong khối try có thể ném ra <code>IOException</code>, và phương thức <code>br.close()</code> trong khối finally cũng có thể ném ra <code>IOException</code>. Nếu không may cả hai nơi đều ném ra IOException, thì việc gỡ lỗi chương trình sẽ trở nên phức tạp hơn, và việc xác định lỗi xảy ra ở đâu sẽ tốn nhiều công sức hơn, điều này là điều mà chúng ta không mong muốn.</p>
<p>Minh họa bằng một ví dụ nhé!</p>
<p>Đầu tiên, chúng ta định nghĩa một lớp như MyfinallyReadLineThrow, nó có hai phương thức, <code>readLine()</code> và <code>close()</code>, cả hai phương thức đều ném ra exception một cách chủ động.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> MyfinallyReadLineThrow</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"close"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> readLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"readLine"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Sau đó, trong phương thức <code>main()</code> chúng ta sử dụng cách try-catch-finally để gọi các phương thức <code>readLine()</code> và <code>close()</code> của MyfinallyReadLineThrow.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> TryfinallyCustomReadLineThrow</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        MyfinallyReadLineThrow</span><span style="color:#E06C75;--shiki-dark:#E06C75"> myThrow</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            myThrow </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> MyfinallyReadLineThrow</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            myThrow</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            myThrow</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Khi chạy đoạn mã trên, ngăn xếp lỗi sẽ hiển thị như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Exception in thread "main" java.lang.Exception: close</span></span>
<span class="line"><span>	at com.hnv99.dzone.trycatchfinally.MyfinallyOutThrow.close(TryfinallyCustomOutThrow.java:17)</span></span>
<span class="line"><span>	at com.hnv99.dzone.trycatchfinally.TryfinallyCustomOutThrow.main(TryfinallyCustomOutThrow.java:10)</span></span></code></pre>
</div><p>Bạn có thấy vấn đề gì không?</p>
<p>Thông tin exception của phương thức <code>readLine()</code> bị thông tin ngăn xếp của phương thức <code>close()</code> che mất rồi!</p>
<p>Điều này sẽ khiến chúng ta nhầm tưởng vấn đề cần điều tra là phương thức <code>close()</code> thay vì <code>readLine()</code> - mặc dù nó cũng là đối tượng cần nghi ngờ.</p>
<p>Nhưng khi có try-with-resources, những vấn đề này được giải quyết triệt để. Điều kiện duy nhất là tài nguyên cần được giải phóng (như BufferedReader) phải triển khai interface AutoCloseable.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> br </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(decodePath))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Khối finally đã biến mất, thay vào đó là việc viết tài nguyên cần giải phóng trong <code>()</code> ngay sau try. Nếu có nhiều tài nguyên (như BufferedReader và PrintWriter) cần giải phóng, chúng ta có thể thêm trực tiếp vào trong <code>()</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> br </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(decodePath))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     PrintWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> writer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> PrintWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(writePath))) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        writer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Nếu muốn giải phóng tài nguyên tự định nghĩa, chỉ cần cho nó triển khai interface AutoCloseable và cung cấp phương thức <code>close()</code> là được.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> TrywithresourcesCustom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">MyResource</span><span style="color:#E06C75;--shiki-dark:#E06C75"> resource</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> MyResource</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();) {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> MyResource</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> AutoCloseable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đóng tài nguyên tự định nghĩa"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Hãy xem kết quả đầu ra sau khi chạy đoạn mã:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Đóng tài nguyên tự định nghĩa</span></span></code></pre>
</div><p>Trong <code>try ()</code> chỉ new một đối tượng của MyResource, không làm gì khác mà phương thức <code>close()</code> đã được gọi rồi!</p>
<p>Bạn biết tại sao không?</p>
<p>Cùng xem bytecode sau khi được dịch ngược:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> MyResource</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> AutoCloseable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    MyResource</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đóng tài nguyên tự định nghĩa"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> TrywithresourcesCustom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> TrywithresourcesCustom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            MyResource</span><span style="color:#E06C75;--shiki-dark:#E06C75"> resource</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> MyResource</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            resource</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> var2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            var2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trình biên dịch tự động thêm mã gọi phương thức <code>close()</code> vào trong khối <code>try-with-resources</code>.</p>
<p>Tiếp theo, chúng ta sẽ thêm một phương thức <code>out()</code> vào trong lớp <code>MyResourceOut</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> MyResourceOut</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> AutoCloseable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đóng tài nguyên tự định nghĩa"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Trầm Mặc Vương Nhị, một lập trình viên thú vị"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Lần này, chúng ta sẽ gọi phương thức <code>out()</code> trong khối try.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> TrywithresourcesCustomOut</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">MyResourceOut</span><span style="color:#E06C75;--shiki-dark:#E06C75"> resource</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> MyResourceOut</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            resource</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Hãy xem mã bytecode sau khi được dịch ngược lại lần này.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> TrywithresourcesCustomOut</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> TrywithresourcesCustomOut</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            MyResourceOut</span><span style="color:#E06C75;--shiki-dark:#E06C75"> resource</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> MyResourceOut</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                resource</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Throwable</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> var5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                    resource</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Throwable</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> var4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                    var5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">addSuppressed</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(var4);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                throw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> var5;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            resource</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> var6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            var6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lần này, khối <code>catch</code> tự động gọi <code>resource.close()</code>, và có một đoạn mã rất quan trọng <code>var5.addSuppressed(var4)</code>.</p>
<p>Vì sao lại cần làm vậy?</p>
<p>Khi một exception được ném ra, có thể có những exception khác bị ức chế bởi exception đó, không thể ném ra bình thường. Khi đó, chúng ta có thể sử dụng phương thức <code>addSuppressed()</code> để ghi lại những exception bị ức chế này, sau đó những exception bị ức chế sẽ xuất hiện trong thông tin ngăn xếp của exception được ném ra. Chúng ta có thể sử dụng phương thức <code>getSuppressed()</code> để lấy những exception này. Điều này giúp chúng ta không bỏ lỡ bất kỳ exception nào, thuận tiện cho việc gỡ lỗi.</p>
<p>Bạn nhớ ví dụ trước đó không - trong try-catch-finally, thông tin exception của phương thức <code>readLine()</code> bị thông tin ngăn xếp của phương thức <code>close()</code> che mất. Giờ đây, với try-with-resources, hãy xem liệu phương thức <code>out()</code> tương tự có bị <code>close()</code> che mất không nhé.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> MyResourceOutThrow</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> AutoCloseable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"close()"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"out()"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Gọi hai phương thức này.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> TrywithresourcesCustomOutThrow</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">MyResourceOutThrow</span><span style="color:#E06C75;--shiki-dark:#E06C75"> resource</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> MyResourceOutThrow</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            resource</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Kết quả đầu ra của chương trình như sau.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>java.lang.Exception: out()</span></span>
<span class="line"><span>	at com.hnv99.dzone.trycatchfinally.MyResourceOutThrow.out(TrywithresourcesCustomOutThrow.java:20)</span></span>
<span class="line"><span>	at com.hnv99.dzone.trycatchfinally.TrywithresourcesCustomOutThrow.main(TrywithresourcesCustomOutThrow.java:6)</span></span>
<span class="line"><span>	Suppressed: java.lang.Exception: close()</span></span>
<span class="line"><span>		at com.hnv99.dzone.trycatchfinally.MyResourceOutThrow.close(TrywithresourcesCustomOutThrow.java:16)</span></span>
<span class="line"><span>		at com.hnv99.dzone.trycatchfinally.TrywithresourcesCustomOutThrow.main(TrywithresourcesCustomOutThrow.java:5)</span></span></code></pre>
</div><p>Xem này, lần này không còn nữa, thông tin ngăn xếp của <code>out()</code> đã được in ra, và thông tin ngăn xếp của phương thức <code>close()</code> đã có thêm từ khóa <code>Suppressed</code>, rõ ràng dễ thấy.</p>
<p>Bạn có phải cảm thấy try-with-resources hữu dụng hơn không!</p>
<p>Tổng kết lại nhé, khi xử lý các tài nguyên cần phải đóng, luôn ưu tiên sử dụng try-with-resources thay vì try-catch-finally. Cách đầu tiên giúp mã nguồn trở nên ngắn gọn, rõ ràng hơn, và thông tin exception cũng chính xác hơn.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Exception Analysis</title>
      <link>https://vanhung4499.github.io/programming/java/exception/analysis.html</link>
      <guid>https://vanhung4499.github.io/programming/java/exception/analysis.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Exception Analysis</source>
      <description>Exception Handling analysis 01. Exception Là Gì Chỉ khi xử lý đúng các exception, chúng ta mới có thể đảm bảo được độ tin cậy của chương trình, vì vậy việc học về exception là r...</description>
      <category>java</category>
      <pubDate>Wed, 03 Jul 2024 13:21:21 GMT</pubDate>
      <content:encoded><![CDATA[
<h3>01. Exception Là Gì</h3>
<p>Chỉ khi xử lý đúng các exception, chúng ta mới có thể đảm bảo được độ tin cậy của chương trình, vì vậy việc học về exception là rất cần thiết.</p>
<p>Vậy exception là gì?</p>
<p>Exception (exception) là một sự kiện không xác định làm gián đoạn quá trình thực thi bình thường của chương trình. Khi exception xảy ra, luồng thực thi bình thường của chương trình sẽ bị gián đoạn. Thông thường, chương trình sẽ có nhiều câu lệnh, nếu không có cơ chế xử lý exception, khi một câu lệnh trước gặp exception, các câu lệnh sau sẽ không thể tiếp tục thực thi.</p>
<p>Với cơ chế xử lý exception, chương trình sẽ không bị gián đoạn khi xảy ra exception, chúng ta có thể bắt exception và thay đổi luồng thực thi của chương trình.</p>
<p>Hơn nữa, cơ chế xử lý exception giúp chúng ta cung cấp thông tin cảnh báo thân thiện đến người dùng, thay vì các thông tin exception gốc của chương trình mà người dùng không thể hiểu được.</p>
<p>Tuy nhiên, từ góc nhìn của nhà phát triển, chúng ta muốn thấy thông tin exception gốc, vì điều này giúp chúng ta nhanh chóng tìm ra nguồn gốc của lỗi, còn thông tin exception bị đóng gói quá mức sẽ làm nhiễu tầm nhìn của chúng ta.</p>
<p>Ngôn ngữ Java từ đầu đã cung cấp cơ chế xử lý exception tương đối hoàn thiện, cơ chế này giúp giảm đáng kể ngưỡng viết chương trình đáng tin cậy, đây cũng là một trong những lý do Java trở nên phổ biến.</p>
<p>Vậy những nguyên nhân nào dẫn đến chương trình ném ra exception?</p>
<p>Ví dụ như:</p>
<ul>
<li>Chương trình cố gắng mở một tệp không tồn tại;</li>
<li>Chương trình gặp vấn đề kết nối mạng;</li>
<li>Người dùng nhập dữ liệu không hợp lệ;</li>
<li>Chương trình không xử lý trường hợp chia cho 0 khi giải quyết vấn đề toán học;</li>
</ul>
<p>v.v...</p>
<p>Hãy lấy một nguyên nhân đơn giản nhất.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Demo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> /</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Đoạn mã này khi chạy sẽ ném ra thông tin exception như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Exception in thread "main" java.lang.ArithmeticException: / by zero</span></span>
<span class="line"><span>    at com.hnv99.ex.Demo.main(Demo.java:8)</span></span></code></pre>
</div><p>Bạn thấy không, thông tin exception gốc này rất khó hiểu đối với người dùng, nhưng đối với nhà phát triển như chúng ta, thì quá rõ ràng — rất dễ xác định nguồn gốc của exception.</p>
<h3>02. Sự Khác Biệt Giữa Exception và Error</h3>
<p>Exception và Error, sự khác biệt giữa chúng là gì?</p>
<p>Từ nghĩa của từ, error có nghĩa là lỗi, còn exception có nghĩa là ngoại lệ, mức độ nghiêm trọng của error rõ ràng cao hơn exception.</p>
<p>Từ góc độ chương trình, cũng đúng như vậy.</p>
<p>Error xuất hiện có nghĩa là chương trình gặp phải vấn đề nghiêm trọng, và những vấn đề này không nên được xử lý bởi cơ chế xử lý exception của Java, chương trình nên bị sập ngay lập tức, ví dụ như OutOfMemoryError, lỗi tràn bộ nhớ, điều này có nghĩa là bộ nhớ mà chương trình yêu cầu khi chạy vượt quá bộ nhớ mà hệ thống có thể cung cấp, dẫn đến lỗi, loại lỗi này đối với chương trình là chí mạng.</p>
<p>Exception xuất hiện có nghĩa là chương trình gặp một số vấn đề trong phạm vi có thể kiểm soát, chúng ta nên thực hiện các biện pháp để cứu vãn.</p>
<p>Ví dụ như ArithmeticException đã đề cập trước đó, rõ ràng là do chia cho 0, chúng ta có thể chọn bắt exception và thông báo cho người dùng rằng không nên thực hiện phép chia cho 0, tất nhiên, cách tốt hơn là kiểm tra số chia, nếu là 0 thì không thực hiện phép chia mà thông báo cho người dùng chọn một số khác không để thực hiện phép chia.</p>
<h3>03. Checked và Unchecked Exception</h3>
<p>Exception có thể được chia thành checked và unchecked exception, chúng có gì khác nhau?</p>
<p>Checked exception trong mã nguồn phải được bắt hoặc ném rõ ràng, nếu không trình biên dịch sẽ nhắc bạn thực hiện thao tác tương ứng. Còn unchecked exception là runtime exception, thường có thể được tránh bằng mã hóa, không cần phải bắt hoặc ném rõ ràng.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240703210645.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Đầu tiên, cả Exception và Error đều kế thừa từ lớp Throwable. Nói cách khác, chỉ có các đối tượng của lớp Throwable (hoặc lớp con của nó) mới có thể được ném ra bằng từ khóa throw hoặc được sử dụng làm tham số của catch.</p>
<p>Một câu hỏi phổ biến trong phỏng vấn là, NoClassDefFoundError và ClassNotFoundException có gì khác nhau?</p>
<p>Cả hai đều do hệ thống không tìm thấy lớp cần tải trong thời gian chạy, nhưng nguyên nhân kích hoạt lại khác nhau.</p>
<ul>
<li>NoClassDefFoundError: Lỗi này xảy ra khi chương trình có thể tìm thấy lớp phụ thuộc trong thời gian biên dịch nhưng không thể tìm thấy tệp lớp trong thời gian chạy; nguyên nhân có thể là do thiếu tệp jar hoặc gọi một lớp đã khởi tạo không thành công.</li>
<li>ClassNotFoundException: exception này được ném ra khi không tìm thấy lớp tương ứng trong quá trình tải động đối tượng Class; nguyên nhân có thể là lớp cần tải không tồn tại hoặc tên lớp bị viết sai.</li>
</ul>
<p>Tiếp theo, như IOException, ClassNotFoundException, SQLException đều thuộc loại checked exception; còn như RuntimeException và các lớp con như ArithmeticException, ClassCastException, ArrayIndexOutOfBoundsException, NullPointerException, đều thuộc loại unchecked exception.</p>
<p>unchecked exception có thể không cần xử lý rõ ràng trong chương trình, như ArithmeticException đã đề cập trước đó; nhưng checked exception phải được xử lý rõ ràng.</p>
<p>Ví dụ, mã sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Class</span><span style="color:#E06C75;--shiki-dark:#E06C75"> clz </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">forName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"com.hnv99.ex.Demo1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Nếu không xử lý, ví dụ như trong môi trường Intellij IDEA, nó sẽ nhắc bạn rằng dòng mã này có thể ném ra <code>java.lang.ClassNotFoundException</code>.</p>
<p>Bạn có thể sử dụng try-catch để bắt exception:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Class</span><span style="color:#E06C75;--shiki-dark:#E06C75"> clz </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">forName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"com.hnv99.ex.Demo1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClassNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Lưu ý phương thức <code>printStackTrace()</code> in ra thông tin ngăn xếp của exception, phương thức này sẽ in thông tin ngăn xếp của exception ra màn hình điều khiển chuẩn, nếu là môi trường kiểm thử thì cách viết này tạm chấp nhận được, nhưng nếu là môi trường sản xuất thì không nên, phải sử dụng khung log để ghi thông tin ngăn xếp của exception vào hệ thống log, nếu không sẽ khó mà theo dõi.</p>
<p>Hoặc sử dụng từ khóa throws trong chữ ký của phương thức để ném exception:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Demo1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ClassNotFoundException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Class</span><span style="color:#E06C75;--shiki-dark:#E06C75"> clz</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">forName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"com.hnv99.ex.Demo1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Cách làm này có lợi là không cần phải bắt exception, chỉ cần giao cho Java Virtual Machine xử lý; nhưng nhược điểm là không thể xử lý tình huống cụ thể.</p>
<p>Về checked exception, tôi có thấy một bài viết nói rằng checked exception trong Java là không cần thiết, exception này trong giai đoạn biên dịch phải dùng try-catch hoặc throws, nhưng không nhất thiết sẽ xảy ra exception, bạn nghĩ thiết kế như vậy có ý nghĩa không?</p>
<p>Thực ra, checked exception gây tranh cãi trong ngành, nó giả định rằng chúng ta sẽ bắt exception và xử lý tình huống này, nhưng đôi khi, không thể xử lý được. Ví dụ như exception ClassNotFoundException đã đề cập trước đó, giả sử chúng ta đã try-catch nó, nhưng khi exception ClassNotFoundException thực sự xảy ra, chúng ta cũng không thể làm gì nhiều, lại <code>Class.forName()</code> một lần nữa?</p>
<p>Ngoài ra, checked exception cũng không tương thích với lập trình hàm, sau này khi em viết code Lambda/Stream, bạn sẽ cảm nhận được sự khó khăn này.</p>
<p>Tuy nhiên, checked exception không phải là hoàn toàn vô dụng, đặc biệt là khi gặp phải các IO hoặc network exception, chẳng hạn như khi thực hiện kết nối Socket, hãy xem đoạn mã sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Demo2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> mHost</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> mPort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Socket</span><span style="color:#E06C75;--shiki-dark:#E06C75"> mSocket</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Object</span><span style="color:#E06C75;--shiki-dark:#E06C75"> mLock </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Object</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> initSocket</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                Socket</span><span style="color:#E06C75;--shiki-dark:#E06C75"> socket</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Socket</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(mHost, mPort);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                synchronized</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (mLock) {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                    mSocket </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> socket;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                break</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Khi xảy ra IOException, socket sẽ thử kết nối lại, nếu không sẽ break ra khỏi vòng lặp. Điều này có nghĩa là nếu IOException không phải là checked exception, cách viết này sẽ không rõ ràng, vì IOException không thể được tránh như ArithmeticException bằng cách sử dụng một câu lệnh if để kiểm tra xem số chia có phải là 0 không.</p>
<p>Hoặc nói cách khác, checked exception bắt buộc có thể khiến chúng ta suy nghĩ khi lập trình, làm thế nào để xử lý exception này một cách tốt hơn. Rõ ràng, trong lập trình Socket, chắc chắn sẽ gặp phải IOException, giả sử IOException là unchecked exception, điều này có nghĩa là nhà phát triển có thể không cần quan tâm, bỏ qua, giao cho Java Virtual Machine xử lý, nhưng tôi nghĩ cách làm này không phù hợp.</p>
<h3>04. Về từ khóa <code>throw</code> và <code>throws</code></h3>
<p>Sự khác biệt giữa từ khóa <code>throw</code> và <code>throws</code> là gì?</p>
<p>Từ khóa <code>throw</code> được dùng để chủ động ném ra một exception. Thông thường, khi số chia là 0, chương trình sẽ tự động ném ra exception ArithmeticException. Nhưng nếu chúng ta muốn ném ra exception ArithmeticException khi số chia là 1, chúng ta có thể sử dụng từ khóa <code>throw</code> để chủ động ném exception.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> exception_class</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"error message"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Cú pháp rất đơn giản, từ khóa <code>throw</code> đi kèm với từ khóa <code>new</code>, kiểu exception và các tham số.</p>
<p>Ví dụ.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ThrowDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> checkEligibilty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> stuage</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">){</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(stuage</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66">18</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ArithmeticException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Chưa đủ 18 tuổi, không được xem phim"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Hãy thưởng thức bộ phim!!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[]){</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        checkEligibilty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Cuối tuần vui vẻ.."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Đoạn mã này khi chạy sẽ ném ra lỗi sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Exception in thread "main" java.lang.ArithmeticException: Chưa đủ 18 tuổi, không được xem phim</span></span>
<span class="line"><span>    at com.hnv99.ex.ThrowDemo.checkEligibilty(ThrowDemo.java:9)</span></span>
<span class="line"><span>    at com.hnv99.ex.ThrowDemo.main(ThrowDemo.java:16)</span></span></code></pre>
</div><p>Từ khóa <code>throws</code> có tác dụng hoàn toàn khác với <code>throw</code>. Ở phần trước, chúng ta đã nói về checked exception và unchecked exception, đối với checked exception, nếu bạn không xử lý, trình biên dịch sẽ nhắc bạn.</p>
<p>Phương thức <code>Class.forName()</code> khi thực thi có thể gặp exception <code>java.lang.ClassNotFoundException</code>, một checked exception, nếu không xử lý, IDE sẽ nhắc bạn, hoặc khai báo trong method signature (<code>com.hnv99.ex.Demo1</code>), hoặc đặt trong try-catch.</p>
<p>Vậy khi nào sử dụng <code>throws</code> thay vì <code>try-catch</code>?</p>
<p>Giả sử có một phương thức <code>myMethod()</code> có thể xuất hiện exception ArithmeticException và NullPointerException. Trong trường hợp này, bạn có thể sử dụng <code>try-catch</code> để xử lý.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> myMethod</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Có thể ném ra exception</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ArithmeticException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // exception toán học</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NullPointerException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // exception con trỏ null</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Nhưng nếu có nhiều phương thức giống như <code>myMethod()</code>, việc thêm <code>try-catch</code> cho từng phương thức sẽ rất cồng kềnh. Mã sẽ trở nên dài dòng và khó đọc.</p>
<p>Một giải pháp là sử dụng từ khóa <code>throws</code> để khai báo exception có thể ném ra trong method signature, sau đó xử lý tại nơi gọi phương thức bằng <code>try-catch</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> args[]){</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        myMethod1</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ArithmeticException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // exception toán học</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">NullPointerException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // exception con trỏ null</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> myMethod1</span><span style="color:#E06C75;--shiki-dark:#E06C75">() throws ArithmeticException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> NullPointerException{</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Khai báo exception trong method signature</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Tổng kết lại sự khác biệt giữa <code>throw</code> và <code>throws</code>:</p>
<ol>
<li>
<p>Từ khóa <code>throws</code> được dùng để khai báo exception, nó có tác dụng tương tự như <code>try-catch</code>; còn từ khóa <code>throw</code> được dùng để ném ra exception rõ ràng.</p>
</li>
<li>
<p>Sau từ khóa <code>throws</code> là tên của exception; còn sau từ khóa <code>throw</code> là đối tượng của exception.</p>
</li>
</ol>
<p>Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">throws ArithmeticException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ArithmeticException</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Arithmetic Exception"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><ol start="3">
<li>
<p>Từ khóa <code>throws</code> xuất hiện trong method signature, còn từ khóa <code>throw</code> xuất hiện trong thân phương thức.</p>
</li>
<li>
<p>Từ khóa <code>throws</code> khi khai báo exception có thể kèm nhiều exception, được ngăn cách bằng dấu phẩy; còn từ khóa <code>throw</code> mỗi lần chỉ có thể ném ra một exception.</p>
</li>
</ol>
<h3>05. Về <code>try-catch-finally</code></h3>
<p>Từ khóa <code>try</code> sẽ đi kèm với một cặp ngoặc nhọn <code>{}</code>, chúng ta đặt một số đoạn mã có thể xảy ra exception vào trong ngoặc nhọn này; khối <code>try</code> thường sẽ đi kèm với khối <code>catch</code>, để xử lý tình huống xảy ra exception; dĩ nhiên, exception không phải lúc nào cũng xảy ra, để đảm bảo rằng dù có xảy ra exception hay không, một số đoạn mã vẫn sẽ được thực thi, chúng ta sẽ kèm theo một khối <code>finally</code>.</p>
<p>Cú pháp của khối <code>try</code> rất đơn giản:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75">{</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Mã có thể xảy ra exception</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Chú ý nhé,  nếu một số đoạn mã chắc chắn sẽ không ném ra exception, thì đừng bao bọc chúng trong khối <code>try</code>, vì mã có xử lý exception sẽ tốn thời gian hơn mã không có xử lý exception.</p>
<p>Cú pháp của khối <code>catch</code> cũng rất đơn giản:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75">{</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Mã có thể xảy ra exception</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">exception</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">type</span><span style="color:#E06C75;--shiki-dark:#E06C75">) e(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">object</span><span style="color:#E06C75;--shiki-dark:#E06C75">)){</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Mã xử lý exception</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Một khối <code>try</code> có thể kèm theo nhiều khối <code>catch</code>, để bắt các loại exception khác nhau và xử lý tương ứng. Khi một dòng mã trong khối <code>try</code> xảy ra exception, các dòng mã sau đó sẽ không được thực thi, mà sẽ chuyển đến khối <code>catch</code> tương ứng để thực thi.</p>
<p>Nếu một khối <code>try</code> kèm theo nhiều khối <code>catch</code> liên quan, thì nên đặt các exception cụ thể ở phía trước, các exception chung chung ở phía sau, nếu không trình biên dịch sẽ báo lỗi. Ví dụ:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> test</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> num1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> num2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        num1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        num2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 62</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> /</span><span style="color:#E06C75;--shiki-dark:#E06C75"> num1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(num2);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Câu cuối cùng trong khối try"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ArithmeticException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Chuyển đến đây khi xảy ra lỗi toán học</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Số chia không thể là 0"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // exception chung có thể bắt tất cả các loại exception, nó nên đặt ở cuối cùng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đã xảy ra exception"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Mã ngoài try-catch."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Tại sao không đặt <code>Exception</code> trước <code>ArithmeticException</code>?</p>
<p>Vì <code>ArithmeticException</code> là một lớp con của <code>Exception</code>, nó cụ thể hơn, khi thấy exception này chúng ta biết ngay đó là lỗi toán học, còn <code>Exception</code> thì chung chung hơn, nó che giấu thông tin cụ thể về exception, khiến việc xác định loại exception gặp khó khăn. Hơn nữa, nếu đặt exception chung chung ở phía trước, có nghĩa là các khối <code>catch</code> khác sẽ không bao giờ được thực thi, vì vậy trình biên dịch sẽ báo lỗi.</p>
<p>Thêm một ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> test1</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75">{</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> arr[] </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        arr[</span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#E06C75;--shiki-dark:#E06C75">] </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 30</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> /</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Câu cuối cùng trong khối try"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ArithmeticException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">){</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Số chia phải là 0"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ArrayIndexOutOfBoundsException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">){</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Truy cập ngoài giới hạn mảng"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">){</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Một số exception khác"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Mã ngoài try-catch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Đoạn mã này khi thực thi, khối <code>catch</code> đầu tiên sẽ được thực thi vì số chia là 0; tôi sẽ thay đổi đoạn mã một chút.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> test1</span><span style="color:#E06C75;--shiki-dark:#E06C75"> () {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75">{</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> arr[]</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        arr[</span><span style="color:#D19A66;--shiki-dark:#D19A66">9</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">30</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">/</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Câu cuối cùng trong khối try"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ArithmeticException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">){</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Số chia phải là 0"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ArrayIndexOutOfBoundsException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">){</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Truy cập ngoài giới hạn mảng"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">){</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Một số exception khác"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Mã ngoài try-catch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Khối <code>catch</code> thứ hai sẽ thực thi vì không xảy ra arithmetic exception, nhưng mảng đã bị truy cập ngoài giới hạn</p>
<p>Sửa lại mã một chút:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> test1</span><span style="color:#E06C75;--shiki-dark:#E06C75"> () {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75">{</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> arr[]</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        arr[</span><span style="color:#D19A66;--shiki-dark:#D19A66">9</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">30</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">/</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Câu cuối cùng trong khối try"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ArithmeticException</span><span style="color:#E06C75;--shiki-dark:#E06C75"> | </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ArrayIndexOutOfBoundsException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">){</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Số chia phải là 0"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Mã ngoài try-catch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Khi có nhiều khối <code>catch</code>, cũng có thể gộp chúng lại với nhau, sử dụng dấu gạch đứng <code>|</code> để ngăn cách.  Như vậy tốt hơn, nhìn gọn gàng hơn.</p>
<p>Cú pháp của khối <code>finally</code> cũng không phức tạp.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Mã có thể xảy ra exception</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">   // Xử lý exception</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">   // Mã phải được thực thi</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Trước khi có <a href="try-with-resources"><code>try-with-resources</code></a>, khối <code>finally</code> thường được dùng để đóng các tài nguyên như socket, kết nối cơ sở dữ liệu, luồng IO, v.v.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">OutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> osf </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"filename"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">OutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> osb </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(osf)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutput</span><span style="color:#E06C75;--shiki-dark:#E06C75"> op </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(osb)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    output</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(writableObject);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    op</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Chú ý, khi sử dụng khối <code>finally</code>, cần tuân thủ các quy tắc sau:</p>
<ul>
<li>Khối <code>finally</code> phải đi kèm với khối <code>try</code>, không được sử dụng <code>finally</code> một mình. Trình biên dịch cũng không cho phép làm như vậy.</li>
<li>Khối <code>finally</code> không phải là bắt buộc, có khối <code>try</code> thì không nhất thiết phải có khối <code>finally</code>.</li>
<li>Nếu mã trong khối <code>finally</code> có thể xảy ra exception, cũng nên bao bọc bằng khối <code>try-catch</code>.</li>
<li>Ngay cả khi trong khối <code>try</code> có các câu lệnh <code>return</code>, <code>break</code>, <code>continue</code>, khối <code>finally</code> vẫn sẽ được thực thi.</li>
</ul>
<p>Hãy thử xem thì biết ngay:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> test2</span><span style="color:#E06C75;--shiki-dark:#E06C75"> () {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 112</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Ngay cả khi khối try có return, khối finally vẫn sẽ thực thi"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Xem kết quả xuất ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Ngay cả khi khối try có return, khối finally vẫn sẽ thực thi</span></span></code></pre>
</div><p>Có trường hợp nào mà khối <code>finally</code> không được thực thi không?</p>
<p>Có chứ:</p>
<ul>
<li>Gặp phải vòng lặp vô tận.</li>
<li>Thực thi lệnh <code>System.exit()</code>.</li>
</ul>
<p>Câu lệnh <code>System.exit()</code> và câu lệnh <code>return</code> khác nhau, cái trước dùng để thoát chương trình, cái sau chỉ quay lại phương thức gọi trước đó.</p>
<p>Xem khai báo của phương thức để hiểu rõ hơn:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> exit</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> status)</span></span></code></pre>
</div><p>Về giá trị của tham số <code>status</code> cũng rất dễ hiểu, nếu là thoát do exception, đặt giá trị khác 0, thường dùng 1 để biểu thị; nếu muốn thoát chương trình bình thường, dùng 0 để biểu thị.</p>
<h3>06. Tóm tắt</h3>
<p>Xử lý exception trong Java là một cơ chế quan trọng, giúp chúng ta xử lý các lỗi hoặc exception xảy ra trong quá trình thực thi chương trình.</p>
<p>Exception được chia thành hai loại: Checked Exception và Unchecked Exception, trong đó Checked Exception cần phải được xử lý hoặc khai báo rõ ràng trong mã, còn Unchecked Exception không cần phải được xử lý hoặc khai báo rõ ràng. Xử lý exception thường sử dụng các khối try-catch-finally hoặc sử dụng từ khóa throws để ném exception cho người gọi xử lý.</p>
<p>Dưới đây là một số tóm tắt về xử lý exception trong Java:</p>
<ul>
<li>Sử dụng khối try-catch để bắt và xử lý exception, giúp tránh việc chương trình bị sập do exception.</li>
<li>Có thể sử dụng nhiều khối catch để bắt các loại exception khác nhau và xử lý chúng một cách khác nhau.</li>
<li>Có thể sử dụng khối finally để thực hiện một số công việc dọn dẹp cần thiết, dù có hay không xảy ra exception.</li>
<li>Có thể sử dụng từ khóa throw để tự động ném exception, nhằm chỉ rõ một số tình huống exception trong chương trình.</li>
<li>Có thể sử dụng từ khóa throws để ném exception cho người gọi xử lý, được khai báo trong chữ ký phương thức.</li>
<li>Checked Exception thường là do các yếu tố bên ngoài gây ra, cần phải được xử lý hoặc khai báo rõ ràng trong mã.</li>
<li>Unchecked Exception thường là do logic hoặc dữ liệu bất thường bên trong chương trình gây ra, có thể không cần xử lý hoặc xử lý khi cần thiết.</li>
<li>Khi xử lý exception, nên xử lý theo loại exception cụ thể, chẳng hạn như có thể thử mở lại tệp, thiết lập lại kết nối mạng, v.v.</li>
<li>Xử lý exception nên dựa vào nhu cầu kinh doanh cụ thể và các nguyên tắc thiết kế, tránh việc bắt và xử lý exception quá mức, từ đó giảm hiệu suất và khả năng bảo trì của chương trình.</li>
</ul>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240703210645.png" type="image/png"/>
    </item>
    <item>
      <title>Print Stream</title>
      <link>https://vanhung4499.github.io/programming/java/IO/print.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/print.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Print Stream</source>
      <description>Print Stream Trong sự nghiệp của tôi, tần suất sử dụng System.out.println() có lẽ không kém gì tần suất sử dụng phương thức main. System.out trả về một PrintStream. Ngoài ra, cò...</description>
      <category>java</category>
      <pubDate>Wed, 03 Jul 2024 05:00:24 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Trong sự nghiệp của tôi, tần suất sử dụng <code>System.out.println()</code> có lẽ không kém gì tần suất sử dụng phương thức main. <code>System.out</code> trả về một <code>PrintStream</code>.</p>
<p>Ngoài ra, còn có một anh em sinh đôi khác là PrintWriter. PrintStream là một lớp con của OutputStream, còn PrintWriter là một lớp con của Writer, tức là một <a href="/programming/java/IO/programming/java/io/stream.html" target="_blank">byte stream</a> và một <a href="character">character stream</a>.</p>
<p>print stream có các đặc điểm sau:</p>
<ul>
<li>Có thể tự động chuyển đổi loại dữ liệu: print stream có thể chuyển đổi các loại dữ liệu khác nhau thành chuỗi và xuất ra dòng đầu ra được chỉ định.</li>
<li>Có thể tự động thực hiện thao tác xuống dòng: print stream có thể tự động thêm ký tự xuống dòng ở cuối chuỗi xuất ra, tiện lợi cho việc kiểm soát định dạng khi xuất nhiều chuỗi.</li>
<li>Có thể xuất ra màn hình hoặc tệp tin: print stream có thể xuất dữ liệu ra màn hình hoặc tệp tin, thuận tiện cho việc gỡ lỗi và ghi log (mặc dù trong môi trường sản xuất thì nên sử dụng Logback, ELK, v.v.).</li>
</ul>
<p>Các phương thức phổ biến của lớp PrintStream bao gồm:</p>
<ul>
<li><code>print()</code>: Xuất biểu diễn chuỗi của một đối tượng.</li>
<li><code>println()</code>: Xuất biểu diễn chuỗi của một đối tượng và thêm một ký tự xuống dòng ở cuối.</li>
<li><code>printf()</code>: Sử dụng chuỗi định dạng và tham số chỉ định để xuất chuỗi được định dạng.</li>
</ul>
<p>Hãy xem một ví dụ để trải nghiệm.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">PrintStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ps </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ps</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Hung"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ps</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"H "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ps</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"u "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ps</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"n "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ps</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"g "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ps</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ps</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Name：%s，Age：%d，Score：%f"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Hung"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">18</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">99.9</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Trong ví dụ này, chúng ta tạo một đối tượng PrintStream ps, nó xuất ra màn hình. Chúng ta sử dụng các phương thức print và println của ps để xuất một số chuỗi.</p>
<p>Sử dụng phương thức printf để xuất một chuỗi định dạng, trong đó %s, %d và %.2f lần lượt đại diện cho định dạng chuỗi, số nguyên và số thập phân. Chúng ta sử dụng danh sách tham số phân cách bằng dấu phẩy để chỉ định các giá trị cần xuất.</p>
<p>Hãy nói chi tiết về phương thức printf.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> PrintStream</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> printf</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Object</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">...</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> args</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Trong đó, tham số format là chuỗi định dạng và tham số args là danh sách các tham số cần xuất. Chuỗi định dạng chứa các ký tự thông thường và các chỉ định chuyển đổi. Các ký tự thông thường là các ký tự không phải chỉ định chuyển đổi, chúng được xuất trực tiếp khi xuất ra. Chỉ định chuyển đổi bao gồm dấu phần trăm (%) và một hoặc nhiều ký tự, được sử dụng để chỉ định định dạng và loại dữ liệu cần xuất.</p>
<p>Dưới đây là các chỉ định chuyển đổi thường dùng trong Java và định dạng đầu ra tương ứng:</p>
<ul>
<li><code>%s</code>: Xuất một chuỗi.</li>
<li><code>%d</code> hoặc <code>%i</code>: Xuất một số nguyên hệ thập phân.</li>
<li><code>%x</code> hoặc <code>%X</code>: Xuất một số nguyên hệ thập lục phân, <code>%x</code> xuất chữ cái thường, <code>%X</code> xuất chữ cái hoa.</li>
<li><code>%f</code> hoặc <code>%F</code>: Xuất một số thập phân.</li>
<li><code>%e</code> hoặc <code>%E</code>: Xuất một số thập phân dạng khoa học, <code>%e</code> xuất chữ cái thường e, <code>%E</code> xuất chữ cái hoa E.</li>
<li><code>%g</code> hoặc <code>%G</code>: Xuất một số thập phân, tự động chọn định dạng <code>%f</code> hoặc <code>%e/%E</code> để xuất.</li>
<li><code>%c</code>: Xuất một ký tự.</li>
<li><code>%b</code>: Xuất một giá trị boolean.</li>
<li><code>%h</code>: Xuất một mã băm (hệ thập lục phân).</li>
<li><code>%n</code>: Ký tự xuống dòng.</li>
</ul>
<p>Ngoài các chỉ định chuyển đổi, phương thức printf của Java còn hỗ trợ một số chỉ định sửa đổi, dùng để chỉ định độ rộng, độ chính xác, cách căn chỉnh, v.v. của đầu ra.</p>
<ul>
<li>Chỉ định độ rộng: Dùng số để chỉ định độ rộng tối thiểu của đầu ra, nếu dữ liệu đầu ra không đủ độ rộng chỉ định thì sẽ thêm khoảng trắng hoặc số không ở bên trái hoặc bên phải.</li>
<li>Chỉ định độ chính xác: Dùng dấu chấm (.) và số để chỉ định độ chính xác của số thập phân hoặc chuỗi, đối với số thập phân, chỉ định số chữ số sau dấu thập phân, đối với chuỗi, chỉ định số ký tự cần xuất.</li>
<li>Chỉ định căn chỉnh: Dùng dấu trừ (-) hoặc số không (0) để chỉ định cách căn chỉnh đầu ra, dấu trừ biểu thị căn chỉnh trái, số không biểu thị căn chỉnh phải và thêm số không.</li>
</ul>
<p>Dưới đây là một số ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> num </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 123</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"%5d</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, num);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Xuất "  123"</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"%-5d</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, num);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Xuất "123  "</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"%05d</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, num);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Xuất "00123"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">double</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pi </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Math</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">PI</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"%10.2f</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, pi);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Xuất "      3.14"</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"%-10.4f</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, pi);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Xuất "3.1416    "</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Hung"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"%10s</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, name);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Xuất "     Hung"</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"%-10s</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, name);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Xuất "Hung     "</span></span></code></pre>
</div><p>Cụ thể,</p>
<ul>
<li>Chúng ta sử dụng <code>%5d</code> để chỉ định số nguyên đầu ra chiếm 5 ký tự độ rộng, phần thiếu sẽ được thêm khoảng trắng ở bên trái.</li>
<li>Sử dụng <code>%-5d</code> để chỉ định số nguyên đầu ra chiếm 5 ký tự độ rộng, phần thiếu sẽ được thêm khoảng trắng ở bên phải.</li>
<li>Sử dụng <code>%05d</code> để chỉ định số nguyên đầu ra chiếm 5 ký tự độ rộng, phần thiếu sẽ được thêm số không ở bên trái.</li>
<li>Sử dụng <code>%10.2f</code> để chỉ định số thập phân đầu ra chiếm 10 ký tự độ rộng, giữ lại 2 chữ số thập phân, phần thiếu sẽ được thêm khoảng trắng ở bên trái.</li>
<li>Sử dụng <code>%-10.4f</code> để chỉ định số thập phân đầu ra chiếm 10 ký tự độ rộng, giữ lại 4 chữ số thập phân, phần thiếu sẽ được thêm khoảng trắng ở bên phải.</li>
<li>Sử dụng <code>%10s</code> để chỉ định chuỗi đầu ra chiếm 10 ký tự độ rộng, phần thiếu sẽ được thêm khoảng trắng ở bên trái.</li>
<li>Sử dụng <code>%-10s</code> để chỉ định chuỗi đầu ra chiếm 10 ký tự độ rộng, phần thiếu sẽ được thêm khoảng trắng ở bên phải.</li>
</ul>
<p>Tiếp theo, chúng ta hãy xem một ví dụ về PrintWriter:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">PrintWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> writer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> PrintWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">writer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Hung"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">writer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Age: %d.</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">18</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">writer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Trước tiên, chúng ta tạo một đối tượng PrintWriter, hàm dựng của nó nhận một đối tượng Writer làm tham số. Ở đây, chúng ta sử dụng FileWriter để tạo một dòng đầu ra tệp và truyền nó vào hàm dựng của PrintWriter. Sau đó, chúng ta sử dụng các phương thức println và printf của PrintWriter để xuất hai dòng nội dung, trong đó phương thức printf có thể nhận chuỗi định dạng. Cuối cùng, chúng ta gọi phương thức close của PrintWriter để đóng dòng đầu ra.</p>
<p>Chúng ta cũng có thể không tạo đối tượng FileWriter, mà chỉ định tên tệp trực tiếp.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">PrintWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> PrintWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">pw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Hung"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">pw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Age: %d.</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">18</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">pw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Được rồi, về print stream chúng ta nói đến đây thôi, khá đơn giản. Đối với một số quy tắc của printf, khi cần sử dụng thì có thể tra cứu hướng dẫn sử dụng hoặc xem tài liệu API, không cần nhớ hết.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Transient</title>
      <link>https://vanhung4499.github.io/programming/java/IO/transient.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/transient.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Transient</source>
      <description>Transient Bạn rất rành về Java, nhưng nhiều kiến thức cơ bản của Java lại không biết, ví dụ như từ khóa transient trước đây chưa từng sử dụng qua nên không biết nó có tác dụng g...</description>
      <category>java</category>
      <pubDate>Wed, 03 Jul 2024 05:00:24 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Bạn rất rành về Java, nhưng nhiều kiến thức cơ bản của Java lại không biết, ví dụ như từ khóa <code>transient</code> trước đây chưa từng sử dụng qua nên không biết nó có tác dụng gì. Hôm nay khi đi phỏng vấn ở ngân hàng, nhà tuyển dụng đã hỏi về từ khóa này: "Hãy nói về từ khóa <code>transient</code> trong Java đi." Kết quả là bạn hoàn toàn bị bối rối.</p>
<p>Dưới đây là tổng kết của anh ấy sau khi phỏng vấn không thành công, chia sẻ để mọi người cùng học hỏi. Được rồi, không nói nhiều nữa, bắt đầu nào:</p>
<h3>01. Tác dụng và cách sử dụng của từ khóa transient</h3>
<p>Chúng ta biết rằng, một đối tượng chỉ cần triển khai interface <a href="Serializbale">Serializable</a>, thì nó có thể được <a href="serialize">serialize</a>.</p>
<p>Trong quá trình phát triển thực tế, chúng ta thường gặp phải vấn đề như vậy: một số trường của lớp cần serialize, trong khi một số trường khác không cần, ví dụ như một số thông tin nhạy cảm của người dùng (như mật khẩu, số thẻ ngân hàng, v.v.). Vì lý do an toàn, không muốn truyền hoặc lưu trữ trên tệp đĩa trong các hoạt động mạng, những trường này có thể được thêm từ khóa <code>transient</code>.</p>
<p>Cần lưu ý rằng, các biến thành viên được sửa đổi bởi từ khóa <code>transient</code> sẽ được tự động khởi tạo lại giá trị mặc định khi deserialize, ví dụ như các kiểu dữ liệu cơ bản sẽ là 0, các kiểu tham chiếu sẽ là null.</p>
<p>Hãy xem ví dụ:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> TransientTest</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        User</span><span style="color:#E06C75;--shiki-dark:#E06C75"> user</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setUsername</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setPasswd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"123456"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"read before Serializable: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"username: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getUsername</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"password: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPasswd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> os</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                    new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"user.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            os</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(user); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi đối tượng User vào tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            os</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            os</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> is</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">                    "user.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            user </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (User) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">is</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc dữ liệu User từ luồng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            is</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">read after Serializable: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"username: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getUsername</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"password: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPasswd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClassNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> User</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> serialVersionUID </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 8294180014912103005L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> username</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> transient</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> passwd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getUsername</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> username;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> setUsername</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> username</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> username;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getPasswd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> passwd;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> setPasswd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> passwd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">passwd</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> passwd;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kết quả đầu ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>read before Serializable:</span></span>
<span class="line"><span>username: Tom</span></span>
<span class="line"><span>password: 123456 </span></span>
<span class="line"><span>read after Serializable:</span></span>
<span class="line"><span>username: Tom</span></span>
<span class="line"><span>password: null</span></span></code></pre>
</div><p>Trường mật khẩu là null, điều này cho thấy rằng khi deserialize, thông tin này không được lấy từ tệp.</p>
<h3>02. Tổng kết về cách sử dụng transient</h3>
<ol>
<li>
<p>Một khi trường được sửa đổi bởi <code>transient</code>, biến thành viên sẽ không còn là một phần của đối tượng được lưu trữ, giá trị của biến này không thể truy cập được sau khi serialize.</p>
</li>
<li>
<p>Từ khóa <code>transient</code> chỉ có thể sửa đổi trường, không thể sửa đổi phương thức và lớp.</p>
</li>
<li>
<p>Các trường được sửa đổi bởi từ khóa <code>transient</code> không thể được serialize, và một biến tĩnh (được sửa đổi bởi từ khóa <a href="/programming/java/oo/static">static</a>) dù có được sửa đổi bởi <code>transient</code> hay không, đều không thể được serialize như đã nói trước đó <a href="serializbale">ở đây</a>.</p>
</li>
</ol>
<p>Hãy xem ví dụ:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> TransientTest</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        User</span><span style="color:#E06C75;--shiki-dark:#E06C75"> user</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setUsername</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setPasswd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"123456"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"read before Serializable: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"username: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getUsername</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"password: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPasswd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> os</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                    new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"user.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            os</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(user); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi đối tượng User vào tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            os</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            os</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Thay đổi giá trị của username trước khi deserialize</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            User</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "Jerry"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> is</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">                    "user.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            user </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (User) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">is</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc dữ liệu User từ luồng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            is</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">read after Serializable: "</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"username: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getUsername</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">err</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"password: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPasswd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClassNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> User</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> serialVersionUID </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 8294180014912103005L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> username</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> transient</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> passwd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getUsername</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> username;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> setUsername</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> username</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> username;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getPasswd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> passwd;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> setPasswd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> passwd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">passwd</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> passwd;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kết quả đầu ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>read before Serializable:</span></span>
<span class="line"><span>username: Tom</span></span>
<span class="line"><span>password: 123456 </span></span>
<span class="line"><span>read after Serializable:</span></span>
<span class="line"><span>username: Jerry</span></span>
<span class="line"><span>password: null</span></span></code></pre>
</div><p>Trước khi serialize, trường <code>username</code> được sửa đổi bởi <code>static</code> có giá trị là Tom, sau đó chúng ta thay đổi giá trị của nó thành Jerry trước khi deserialize. Nếu như trường được sửa đổi bởi <code>static</code> có thể giữ được trạng thái, thì sau khi deserialize, nó nên có giá trị là Tom, đúng không?</p>
<p>Nhưng kết quả lại là Jerry, điều này chứng minh cho kết luận trước đó của chúng ta: <strong>Trường được sửa đổi bởi <code>static</code> không thể được serialize</strong>.</p>
<h3>03. Các trường được sửa đổi bởi transient thực sự không thể được serialize?</h3>
<p>Hãy suy nghĩ về ví dụ dưới đây:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ExternalizableTest</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Externalizable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> transient</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> content </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Đúng vậy, tôi sẽ được serialize, dù tôi có được sửa đổi bởi từ khóa transient hay không"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> writeExternal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutput</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(content);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> readExternal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectInput</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            ClassNotFoundException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        content </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (String) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        ExternalizableTest</span><span style="color:#E06C75;--shiki-dark:#E06C75"> et</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ExternalizableTest</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        ObjectOutput</span><span style="color:#E06C75;--shiki-dark:#E06C75"> out</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">                new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"test"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(et);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        ObjectInput</span><span style="color:#E06C75;--shiki-dark:#E06C75"> in</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">                "test"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)));</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        et </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (ExternalizableTest) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">et</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Hãy xem kết quả đầu ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Đúng vậy, tôi sẽ được serialize, dù tôi có được sửa đổi bởi từ khóa transient hay không</span></span></code></pre>
</div><p>Tại sao lại như vậy? Không phải nói rằng các trường được sửa đổi bởi từ khóa transient không thể serialize sao?</p>
<p>Để tôi giải thích. Đó là vì chúng ta đã sử dụng interface Externalizable thay vì interface Serializable. Chúng ta đã đề cập đến kiến thức này trước đây <a href="serializbale">ở đây</a>.</p>
<p>Trong Java, việc serialize đối tượng có thể được triển khai bằng cách triển khai hai interface. Nếu triển khai interface Serializable, tất cả quá trình serialize sẽ tự động diễn ra. Nếu triển khai interface Externalizable, thì cần phải chỉ định các trường cần serialize trong phương thức writeExternal, và việc này không liên quan đến từ khóa transient.</p>
<p>Vì vậy, kết quả đầu ra của ví dụ là nội dung của biến <code>content</code>, chứ không phải là <code>null</code>.</p>
<h3>04. Tóm tắt</h3>
<p>Từ khóa transient được sử dụng để sửa đổi các biến thành viên của lớp. Khi serialize đối tượng, các biến thành viên được sửa đổi bởi transient sẽ không được serialize và lưu trữ vào tệp. Mục đích của nó là thông báo cho JVM rằng không cần lưu giá trị của biến này khi serialize đối tượng, giúp tránh các vấn đề về bảo mật hoặc hiệu suất. Tuy nhiên, các biến thành viên được sửa đổi bởi transient sẽ được khởi tạo lại với giá trị mặc định khi deserialize (ví dụ: kiểu int sẽ được khởi tạo lại là 0, kiểu tham chiếu sẽ được khởi tạo lại là null), vì vậy cần xử lý thích hợp trong chương trình.</p>
<p>Từ khóa transient và static đều có thể được sử dụng để sửa đổi các biến thành viên của lớp. Trong đó, từ khóa transient chỉ ra rằng biến thành viên này không tham gia vào quá trình serialize và deserialize, còn từ khóa static chỉ ra rằng biến thành viên này thuộc về lớp, không thuộc về đối tượng, vì vậy không cần serialize và deserialize.</p>
<p>Trong interface Serializable và Externalizable, từ khóa transient cũng có hành vi khác nhau. Trong Serializable, nó chỉ ra rằng biến thành viên này không tham gia vào quá trình serialize và deserialize. Trong Externalizable, nó không có tác dụng vì interface Externalizable yêu cầu triển khai các phương thức readExternal và writeExternal, cần triển khai serialize và deserialize bằng tay.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Serializable</title>
      <link>https://vanhung4499.github.io/programming/java/IO/serializable.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/serializable.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Serializable</source>
      <description>Serializable Interface Đối với việc serialize trong Java, trước đây tôi luôn có hiểu biết rất cơ bản - chỉ cần triển khai interface Serializable cho lớp cần được serialize là xo...</description>
      <category>java</category>
      <pubDate>Tue, 02 Jul 2024 15:44:39 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Đối với việc serialize trong Java, trước đây tôi luôn có hiểu biết rất cơ bản - chỉ cần triển khai interface <code>Serializable</code> cho lớp cần được <a href="serialize">serialize</a> là xong.</p>
<p>Tôi dường như không muốn nghiên cứu sâu hơn vì chỉ cần biết cách sử dụng là đủ rồi mà.</p>
<p>Nhưng theo thời gian, tôi gặp <code>Serializable</code> ngày càng nhiều, và tôi bắt đầu quan tâm đến nó. Đã đến lúc dành chút thời gian để nghiên cứu về nó.</p>
<h3>01. Bắt đầu với lý thuyết</h3>
<p>Serialize trong Java là một tập hợp các tính năng tiên phong được giới thiệu từ JDK 1.1, dùng để chuyển đổi các đối tượng Java thành mảng byte, tiện lợi cho việc lưu trữ hoặc truyền tải. Sau đó, có thể chuyển đổi mảng byte trở lại trạng thái ban đầu của đối tượng Java.</p>
<p>Ý tưởng của serialize là "đóng băng" trạng thái của đối tượng, sau đó ghi vào đĩa hoặc truyền qua mạng; ý tưởng của <a href="https://javabetter.cn/io/serialize.html" target="_blank" rel="noopener noreferrer">deserialize</a> là "rã đông" trạng thái của đối tượng, khôi phục lại đối tượng Java có thể sử dụng.</p>
<p>Có một quy tắc trong serialize, đó là đối tượng cần serialize phải triển khai interface <code>Serializable</code>, nếu không sẽ ném ra ngoại lệ <code>NotSerializableException</code>.</p>
<p>Tốt, hãy xem định nghĩa của interface <code>Serializable</code>:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> interface</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Không còn gì khác nữa!</p>
<p>Chỉ có một interface trống thôi mà, vậy mà lại có thể đảm bảo rằng lớp triển khai nó có thể được serialize và deserialize?</p>
<h3>02. Tiếp theo là thực hành</h3>
<p>Trước khi trả lời câu hỏi trên, chúng ta hãy tạo một lớp (chỉ có hai trường và các phương thức <code>getter/setter</code> tương ứng) để thực hiện serialize và deserialize.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Wanger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> setName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getAge</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> setAge</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">age</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Tiếp theo, chúng ta tạo một lớp thử nghiệm, sử dụng <code>ObjectOutputStream</code> để ghi "Wanger 18 tuổi" vào tệp, thực chất là quá trình serialize; sau đó sử dụng <code>ObjectInputStream</code> để đọc "Wanger 18 tuổi" từ tệp ra, thực chất là quá trình deserialize. (Chúng ta đã học về <a href="https://javabetter.cn/io/serialize.html" target="_blank" rel="noopener noreferrer">dòng tuần tự</a> trước đây)</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khởi tạo</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Wanger</span><span style="color:#E06C75;--shiki-dark:#E06C75"> wanger </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Wanger</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">wanger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"王二"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">wanger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setAge</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">18</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(wanger);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi đối tượng vào tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> oos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"chenmo"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))){</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    oos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(wanger);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc đối tượng từ tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ois </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"chenmo"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)))){</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Wanger</span><span style="color:#E06C75;--shiki-dark:#E06C75"> wanger1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (Wanger) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ois</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(wanger1);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75"> | </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClassNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Tuy nhiên, vì lớp <code>Wanger</code> không triển khai interface <code>Serializable</code>, nên khi chạy lớp thử nghiệm, sẽ xảy ra ngoại lệ và thông tin ngăn xếp như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>java.io.NotSerializableException: com.cmower.java_demo.xuliehua.Wanger</span></span>
<span class="line"><span>    at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1184)</span></span>
<span class="line"><span>    at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:348)</span></span>
<span class="line"><span>    at com.cmower.java_demo.xuliehua.Test.main(Test.java:21)</span></span></code></pre>
</div><p>Dựa vào thông tin từ ngăn xếp, chúng ta xem xét phương thức <code>writeObject0()</code> của <code>ObjectOutputStream</code>. Một phần mã nguồn như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem đối tượng có phải là kiểu chuỗi không, nếu có thì gọi phương thức writeString để serialize</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (obj </span><span style="color:#C678DD;--shiki-dark:#C678DD">instanceof</span><span style="color:#E06C75;--shiki-dark:#E06C75"> String) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    writeString</span><span style="color:#E06C75;--shiki-dark:#E06C75">((String) obj</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> unshared)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem đối tượng có phải là kiểu mảng không, nếu có thì gọi phương thức writeArray để serialize</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#C678DD;--shiki-dark:#C678DD"> if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">cl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    writeArray</span><span style="color:#E06C75;--shiki-dark:#E06C75">(obj</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> unshared)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem đối tượng có phải là kiểu enum không, nếu có thì gọi phương thức writeEnum để serialize</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#C678DD;--shiki-dark:#C678DD"> if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (obj </span><span style="color:#C678DD;--shiki-dark:#C678DD">instanceof</span><span style="color:#E06C75;--shiki-dark:#E06C75"> Enum) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    writeEnum</span><span style="color:#E06C75;--shiki-dark:#E06C75">((</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Enum</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD">?</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">) obj</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> unshared)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem đối tượng có phải là kiểu có thể serialize không, nếu có thì gọi phương thức writeOrdinaryObject để serialize</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#C678DD;--shiki-dark:#C678DD"> if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (obj </span><span style="color:#C678DD;--shiki-dark:#C678DD">instanceof</span><span style="color:#E06C75;--shiki-dark:#E06C75"> Serializable) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    writeOrdinaryObject</span><span style="color:#E06C75;--shiki-dark:#E06C75">(obj</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> unshared)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu đối tượng không thể serialize, thì ném ngoại lệ NotSerializableException</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (extendedDebugInfo) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> NotSerializableException</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        cl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#98C379;--shiki-dark:#98C379"> "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> debugInfoStack</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> NotSerializableException</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">cl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Nói cách khác, khi <code>ObjectOutputStream</code> serialize, nó sẽ kiểm tra loại của đối tượng được serialize là loại nào: chuỗi, mảng, enum hay <code>Serializable</code>. Nếu không phải loại nào trong số đó, nó sẽ ném ra ngoại lệ <code>NotSerializableException</code>.</p>
<p>Nếu <code>Wanger</code> thực hiện interface <code>Serializable</code>, nó có thể được serialize và deserialize.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Wanger</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> serialVersionUID </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">2095916884810199532L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Cụ thể, quá trình serialize diễn ra như thế nào?</p>
<p>Đối với <code>ObjectOutputStream</code>, khi serialize, nó sẽ lần lượt gọi các phương thức <code>writeObject()</code>→<code>writeObject0()</code>→<code>writeOrdinaryObject()</code>→<code>writeSerialData()</code>→<code>invokeWriteObject()</code>→<code>defaultWriteFields()</code>.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> defaultWriteFields</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Object</span><span style="color:#E06C75;--shiki-dark:#E06C75"> obj</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ObjectStreamClass</span><span style="color:#E06C75;--shiki-dark:#E06C75"> desc) throws IOException {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Lấy lớp của đối tượng và kiểm tra xem nó có thể serialize theo mặc định không</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD">?</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> cl </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">forClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">checkDefaultSerialize</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Lấy số lượng và giá trị các trường kiểu nguyên thủy của đối tượng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> primDataSize </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPrimDataSize</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPrimFieldValues</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(obj, primVals);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Ghi giá trị của các trường kiểu nguyên thủy vào luồng đầu ra</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    bout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(primVals, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, primDataSize, </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Lấy giá trị các trường không phải kiểu nguyên thủy của đối tượng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    ObjectStreamField</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] fields </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getFields</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Object</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] objVals </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Object</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getNumObjFields</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> numPrimFields </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fields</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> objVals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getObjFieldValues</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(obj, objVals);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Vòng lặp để ghi giá trị các trường không phải kiểu nguyên thủy của đối tượng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> objVals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">++</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Gọi phương thức writeObject0 để serialize và ghi các trường không phải kiểu nguyên thủy vào luồng đầu ra</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            writeObject0</span><span style="color:#E06C75;--shiki-dark:#E06C75">(objVals[i]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fields[numPrimFields </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isUnshared</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Nếu xảy ra ngoại lệ trong quá trình ghi, thì bao ngoại lệ thành IOException và ném ra</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> ex</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (abortIOException </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">                abortIOException </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ex</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">            }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vậy deserialize diễn ra như thế nào?</p>
<p>Đối với <code>ObjectInputStream</code>, khi deserialize, nó sẽ lần lượt gọi các phương thức <code>readObject()</code>→<code>readObject0()</code>→<code>readOrdinaryObject()</code>→<code>readSerialData()</code>→<code>defaultReadFields()</code>.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> defaultReadFields</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Object</span><span style="color:#E06C75;--shiki-dark:#E06C75"> obj</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ObjectStreamClass</span><span style="color:#E06C75;--shiki-dark:#E06C75"> desc) throws IOException {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Lấy lớp của đối tượng và kiểm tra xem đối tượng có thuộc lớp đó không</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD">?</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> cl </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">forClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (cl </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &amp;&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> obj </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &amp;&amp;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> !</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">cl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isInstance</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(obj)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        throw</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ClassCastException</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Lấy số lượng và giá trị các trường kiểu nguyên thủy của đối tượng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> primDataSize </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPrimDataSize</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (primVals </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> ||</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> primVals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> primDataSize) {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        primVals </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[primDataSize]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đọc giá trị của các trường kiểu nguyên thủy từ luồng đầu vào và lưu trữ trong mảng primVals</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    bin</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readFully</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(primVals, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, primDataSize, </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (obj </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Đặt giá trị của các trường kiểu nguyên thủy từ mảng primVals vào các trường tương ứng của đối tượng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setPrimFieldValues</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(obj, primVals);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Lấy số lượng và giá trị các trường không phải kiểu nguyên thủy của đối tượng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> objHandle </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> passHandle</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    ObjectStreamField</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] fields </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getFields</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Object</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] objVals </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Object</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getNumObjFields</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> numPrimFields </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fields</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> objVals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Vòng lặp để đọc giá trị các trường không phải kiểu nguyên thủy của đối tượng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> objVals</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">++</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Gọi phương thức readObject0 để đọc giá trị các trường không phải kiểu nguyên thủy của đối tượng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        ObjectStreamField</span><span style="color:#E06C75;--shiki-dark:#E06C75"> f </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fields[numPrimFields </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        objVals[i] </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> readObject0</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Object</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isUnshared</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Nếu trường đó là một trường tham chiếu, thì đánh dấu nó phụ thuộc vào đối tượng này</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">f</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> !=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            handles</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">markDependency</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(objHandle, passHandle);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (obj </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Đặt giá trị của các trường không phải kiểu nguyên thủy từ mảng objVals vào các trường tương ứng của đối tượng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setObjFieldValues</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(obj, objVals);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    passHandle </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> objHandle</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đến đây, có lẽ bạn đã hiểu ra tại sao interface <code>Serializable</code> lại được định nghĩa là trống. Nó chỉ đóng vai trò như một dấu hiệu, báo cho chương trình biết rằng các đối tượng thực hiện nó có thể được serialize, nhưng việc serialize và deserialize thực sự không cần nó để hoàn thành.</p>
<h3>03. Một số điểm cần lưu ý</h3>
<p>Nói thẳng vào vấn đề, các trường được sửa đổi bởi <a href="/programming/java/oo/static"><code>static</code></a> và <a href="transient"><code>transient</code></a> sẽ không được serialize.</p>
<p>Tại sao lại như vậy? Chúng ta hãy chứng minh trước rồi giải thích sau.</p>
<p>Đầu tiên, thêm hai trường vào lớp <code>Wanger</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Wanger</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> serialVersionUID </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">2095916884810199532L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pre </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "沉默"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    transient</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> meizi </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "王三"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#98C379;--shiki-dark:#98C379"> "Wanger{"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#98C379;--shiki-dark:#98C379"> "name="</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> ",age="</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> ",pre="</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> pre </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> ",meizi="</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> meizi </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> "}"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Tiếp theo, trong lớp kiểm thử, in ra đối tượng trước và sau khi serialize, đồng thời thay đổi giá trị của trường <code>static</code> sau khi serialize và trước khi deserialize. Mã cụ thể như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khởi tạo</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Wanger</span><span style="color:#E06C75;--shiki-dark:#E06C75"> wanger </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Wanger</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">wanger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"王二"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">wanger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setAge</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">18</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(wanger);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi đối tượng vào tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> oos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"chenmo"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))){</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    oos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(wanger);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Thay đổi giá trị của trường static</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Wanger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">pre</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "不沉默"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc đối tượng từ tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ois </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"chenmo"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)))){</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Wanger</span><span style="color:#E06C75;--shiki-dark:#E06C75"> wanger1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (Wanger) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ois</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(wanger1);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75"> | </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClassNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kết quả đầu ra:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Wanger{name=王二,age=18,pre=沉默,meizi=王三}</span></span>
<span class="line"><span>Wanger{name=王二,age=18,pre=不沉默,meizi=null}</span></span></code></pre>
</div><p>Từ kết quả so sánh, chúng ta có thể thấy:</p>
<ol>
<li>Trước khi serialize, giá trị của <code>pre</code> là "沉默", sau khi serialize, giá trị của <code>pre</code> đã được thay đổi thành "不沉默", và sau khi deserialize, giá trị của <code>pre</code> là "不沉默", chứ không phải trạng thái trước khi serialize là "沉默".</li>
</ol>
<p>Tại sao lại như vậy? Bởi vì serialize lưu trữ trạng thái của đối tượng, trong khi các trường được sửa đổi bởi <code>static</code> thuộc về trạng thái của lớp, do đó có thể chứng minh serialize không lưu trữ các trường được sửa đổi bởi <code>static</code>.</p>
<ol start="2">
<li>Trước khi serialize, giá trị của <code>meizi</code> là "王三", sau khi deserialize, giá trị của <code>meizi</code> là <code>null</code>, chứ không phải trạng thái trước khi serialize là "王三".</li>
</ol>
<p>Tại sao lại như vậy? <code>transient</code> có nghĩa là "tạm thời", nó có thể ngăn cản trường được serialize vào tệp. Sau khi deserialize, giá trị của trường <code>transient</code> được đặt về giá trị ban đầu, chẳng hạn như giá trị ban đầu của kiểu <code>int</code> là 0, giá trị ban đầu của đối tượng là <code>null</code>.</p>
<p>Nếu muốn nghiên cứu sâu mã nguồn, bạn có thể thấy đoạn mã sau trong <code>ObjectStreamClass</code>:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ObjectStreamField</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getDefaultSerialFields</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Class</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD">?</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> cl) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Lấy tất cả các trường được khai báo trong lớp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Field</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] clFields </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> cl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getDeclaredFields</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectStreamField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> list </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> mask </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Modifier</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">STATIC</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> |</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Modifier</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">TRANSIENT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Duyệt qua tất cả các trường, thêm các trường không phải static và transient vào danh sách</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> clFields</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">++</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Field</span><span style="color:#E06C75;--shiki-dark:#E06C75"> field </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> clFields[i]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> mods </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> field</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getModifiers</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((mods </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> mask) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Tạo một đối tượng ObjectStreamField dựa trên tên trường, kiểu trường và khả năng serialize của trường</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            ObjectStreamField</span><span style="color:#E06C75;--shiki-dark:#E06C75"> osf </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectStreamField</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">field</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(),</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> field</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(),</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> !</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isAssignableFrom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(cl)</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(osf);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> size </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Nếu danh sách rỗng, trả về một mảng ObjectStreamField rỗng, nếu không, chuyển đổi danh sách thành mảng ObjectStreamField và trả về</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (size </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">?</span><span style="color:#E06C75;--shiki-dark:#E06C75"> NO_FIELDS </span><span style="color:#C678DD;--shiki-dark:#C678DD">:</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ObjectStreamField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[size]);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Bạn thấy <code>Modifier.STATIC | Modifier.TRANSIENT</code> chứ? Các trường được đánh dấu bởi hai sửa đổi này không được đưa vào các trường được serialize, bạn đã hiểu chưa?</p>
<h3>04. Một chút thông tin hữu ích</h3>
<p>Ngoài <code>Serializable</code>, Java còn cung cấp một interface serialize khác là <code>Externalizable</code> (đọc hơi khó).</p>
<p>Hai interface này có gì khác nhau không? Thử là biết ngay.</p>
<p>Đầu tiên, thay thế interface <code>Serializable</code> của lớp <code>Wanger</code> bằng <code>Externalizable</code>.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Wanger</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Externalizable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Wanger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#98C379;--shiki-dark:#98C379"> "Wanger{"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#98C379;--shiki-dark:#98C379"> "name="</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> ",age="</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> "}"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> writeExternal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutput</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> readExternal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectInput</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ClassNotFoundException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lớp <code>Wanger</code> thực hiện interface <code>Externalizable</code> có một số điểm khác biệt so với lớp thực hiện interface <code>Serializable</code>:</p>
<ol>
<li>Thêm một phương thức khởi tạo không tham số.</li>
</ol>
<p>Khi sử dụng <code>Externalizable</code> để deserialize, nó sẽ gọi phương thức khởi tạo không tham số của lớp được serialize để tạo một đối tượng mới, sau đó sao chép giá trị của các trường của đối tượng được lưu trữ vào. Nếu không, sẽ ném ra ngoại lệ sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>java.io.InvalidClassException: com.cmower.java_demo.xuliehua1.Wanger; no valid constructor</span></span>
<span class="line"><span>    at java.io.ObjectStreamClass$ExceptionInfo.newInvalidClassException(ObjectStreamClass.java:150)</span></span>
<span class="line"><span>    at java.io.ObjectStreamClass.checkDeserialize(ObjectStreamClass.java:790)</span></span>
<span class="line"><span>    at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1782)</span></span>
<span class="line"><span>    at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1353)</span></span>
<span class="line"><span>    at java.io.ObjectInputStream.readObject(ObjectInputStream.java:373)</span></span>
<span class="line"><span>    at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)</span></span></code></pre>
</div><ol start="2">
<li>Thêm hai phương thức <code>writeExternal()</code> và <code>readExternal()</code>, cần thiết để thực hiện interface <code>Externalizable</code>.</li>
</ol>
<p>Sau đó, in ra đối tượng trước và sau khi serialize trong lớp kiểm thử.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khởi tạo</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Wanger</span><span style="color:#E06C75;--shiki-dark:#E06C75"> wanger </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Wanger</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">wanger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"王二"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">wanger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setAge</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">18</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(wanger);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi đối tượng vào tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> oos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"chenmo"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    oos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(wanger);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc đối tượng từ tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ois </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"chenmo"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Wanger</span><span style="color:#E06C75;--shiki-dark:#E06C75"> wanger1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (Wanger) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ois</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(wanger1);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75"> | </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClassNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Wanger{name=王二,age=18}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Wanger{name=null,age=0}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Từ kết quả đầu ra, ta có thể thấy các trường của đối tượng sau khi deserialize đều trở về giá trị mặc định, nghĩa là trạng thái của đối tượng trước khi serialize không được "đóng băng" lại.</p>
<p>Tại sao vậy? Vì chúng ta chưa ghi đè cụ thể các phương thức <code>writeExternal()</code> và <code>readExternal()</code> cho lớp <code>Wanger</code>. Vậy làm sao để ghi đè chúng?</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> writeExternal</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutput</span><span style="color:#E06C75;--shiki-dark:#E06C75"> out) throws IOException {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(name);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(age);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> readExternal</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectInput</span><span style="color:#E06C75;--shiki-dark:#E06C75"> in) throws IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ClassNotFoundException {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (String) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    age </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><ol>
<li>
<p>Gọi phương thức <code>writeObject()</code> của <code>ObjectOutput</code> để ghi trường <code>name</code> kiểu chuỗi vào luồng đầu ra;</p>
</li>
<li>
<p>Gọi phương thức <code>writeInt()</code> của <code>ObjectOutput</code> để ghi trường <code>age</code> kiểu số nguyên vào luồng đầu ra;</p>
</li>
<li>
<p>Gọi phương thức <code>readObject()</code> của <code>ObjectInput</code> để đọc trường <code>name</code> kiểu chuỗi từ luồng đầu vào;</p>
</li>
<li>
<p>Gọi phương thức <code>readInt()</code> của <code>ObjectInput</code> để đọc trường <code>age</code> kiểu số nguyên từ luồng đầu vào.</p>
</li>
</ol>
<p>Chạy lại lớp kiểm thử, bạn sẽ thấy đối tượng có thể serialize và deserialize bình thường.</p>
<blockquote name="王二,age=18">
<p>serialize trước: Wanger{name=王二,age=18}<br>
serialize sau: Wanger</p>
</blockquote>
<p>Tóm lại:</p>
<p>Externalizable và Serializable đều được sử dụng để serialize và deserialize các đối tượng Java, nhưng chúng có sự khác biệt sau:</p>
<ol>
<li>Serializable là interface do thư viện chuẩn của Java cung cấp, còn Externalizable là interface con của Serializable;</li>
</ol>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240702223842.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<ol start="2">
<li>
<p>interface Serializable không cần thực hiện bất kỳ phương thức nào, chỉ cần đánh dấu lớp cần serialize là Serializable, trong khi interface Externalizable cần thực hiện hai phương thức writeExternal và readExternal;</p>
</li>
<li>
<p>interface Externalizable cung cấp khả năng kiểm soát serialize cao hơn, cho phép thực hiện các xử lý tùy chỉnh trong quá trình serialize và deserialize, chẳng hạn như mã hóa và giải mã một số thông tin nhạy cảm.</p>
</li>
</ol>
<h3>05. Một chút thông tin bổ sung</h3>
<p>Hãy để tôi hỏi bạn trước, bạn có biết đoạn mã <code>private static final long serialVersionUID = -2095916884810199532L;</code> có tác dụng gì không?</p>
<p>Ừm...</p>
<p><code>serialVersionUID</code> được gọi là ID serialize, nó là yếu tố quan trọng quyết định liệu đối tượng Java có thể deserialize thành công hay không. Khi deserialize, máy ảo Java sẽ so sánh <code>serialVersionUID</code> trong byte stream với <code>serialVersionUID</code> trong lớp được serialize, nếu giống nhau thì có thể thực hiện deserialize, nếu không sẽ ném ra ngoại lệ phiên bản serialize không khớp.</p>
<p>Khi một lớp thực hiện interface <code>Serializable</code>, IDE sẽ nhắc bạn rằng lớp đó nên có một ID serialize, như thế này:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240702223905.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<ol>
<li>Thêm một ID serialize phiên bản mặc định:</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> serialVersionUID </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><ol start="2">
<li>Thêm một ID serialize ngẫu nhiên không trùng lặp.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> serialVersionUID </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">2095916884810199532L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><ol start="3">
<li>Thêm chú thích <code>@SuppressWarnings</code>.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">SuppressWarnings</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"serial"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span></span></code></pre>
</div><p>Lựa chọn như thế nào?</p>
<p>Trước hết, chúng ta sử dụng cách thứ hai, thêm một ID serialize ngẫu nhiên vào lớp được serialize.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Wanger</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> serialVersionUID </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">2095916884810199532L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Các mã khác bỏ qua</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Sau đó, serialize một đối tượng <code>Wanger</code> vào tệp.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khởi tạo</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Wanger</span><span style="color:#E06C75;--shiki-dark:#E06C75"> wanger </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Wanger</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">wanger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"王二"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">wanger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">setAge</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">18</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(wanger);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi đối tượng vào tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> oos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"chenmo"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    oos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(wanger);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Lúc này, chúng ta thay đổi ID serialize của lớp <code>Wanger</code> một cách bí mật.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// private static final long serialVersionUID = -2095916884810199532L;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> serialVersionUID </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">2095916884810199533L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Được rồi, chuẩn bị deserialize nào.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ois </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"chenmo"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    Wanger</span><span style="color:#E06C75;--shiki-dark:#E06C75"> wanger </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (Wanger) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ois</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(wanger);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75"> | </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClassNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Ồ, đã xảy ra lỗi.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>java.io.InvalidClassException:  local class incompatible: stream classdesc </span></span>
<span class="line"><span>serialVersionUID = -2095916884810199532,</span></span>
<span class="line"><span>local class serialVersionUID = -2095916884810199533</span></span>
<span class="line"><span>    at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1521)</span></span>
<span class="line"><span>    at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)</span></span></code></pre>
</div><p>Thông tin ngoại lệ trong ngăn xếp cho biết rằng ID serialize đọc từ tệp không khớp với ID serialize cục bộ, không thể deserialize.</p>
<p>Vậy nếu chúng ta sử dụng phương pháp thứ ba, thêm chú thích <code>@SuppressWarnings("serial")</code> cho lớp <code>Wanger</code> thì sao?</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">SuppressWarnings</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"serial"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Wanger</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Các mã khác bỏ qua</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Được rồi, thử deserialize lại. Nhưng tiếc là vẫn báo lỗi.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>java.io.InvalidClassException:  local class incompatible: stream classdesc </span></span>
<span class="line"><span>serialVersionUID = -2095916884810199532, </span></span>
<span class="line"><span>local class serialVersionUID = -3818877437117647968</span></span>
<span class="line"><span>    at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1521)</span></span>
<span class="line"><span>    at com.cmower.java_demo.xuliehua1.Test.main(Test.java:27)</span></span></code></pre>
</div><p>Thông tin ngoại lệ trong ngăn xếp cho biết rằng ID serialize cục bộ là -3818877437117647968, và không khớp với ID serialize đọc từ tệp, không thể deserialize. Điều này cho thấy gì? Khi sử dụng chú thích <code>@SuppressWarnings("serial")</code>, chú thích này sẽ tự động tạo một ID serialize ngẫu nhiên cho lớp được serialize.</p>
<p>Do đó có thể chứng minh rằng, <strong>Java Virtual Machine có cho phép deserialize hay không không chỉ phụ thuộc vào đường dẫn lớp và mã chức năng có nhất quán hay không, mà còn phụ thuộc rất nhiều vào việc ID serialize có nhất quán hay không</strong>.</p>
<p>Nói cách khác, nếu không có yêu cầu đặc biệt, sử dụng ID serialize mặc định (1L) là được, điều này đảm bảo rằng mã nhất quán thì deserialize sẽ thành công.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Wanger</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> serialVersionUID </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Các mã khác bỏ qua</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240702223842.png" type="image/png"/>
    </item>
    <item>
      <title>Conversion Stream</title>
      <link>https://vanhung4499.github.io/programming/java/IO/char-byte.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/char-byte.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Conversion Stream</source>
      <description>Conversion Stream Conversion stream có thể đóng gói một byte stream thành một character stream, hoặc đóng gói một character stream thành byte stream. Chuyển đổi này thường được ...</description>
      <category>java</category>
      <pubDate>Mon, 01 Jul 2024 16:00:06 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Conversion stream có thể đóng gói một byte stream thành một character stream, hoặc đóng gói một character stream thành byte stream. Chuyển đổi này thường được sử dụng để xử lý dữ liệu văn bản, như đọc tệp văn bản hoặc truyền dữ liệu từ mạng đến ứng dụng.</p>
<p>conversion stream chủ yếu có hai loại: InputStreamReader và OutputStreamWriter.</p>
<p>InputStreamReader chuyển đổi một luồng đầu vào byte thành một luồng đầu vào ký tự, trong khi OutputStreamWriter chuyển đổi một luồng đầu ra byte thành một luồng đầu ra ký tự. Chúng sử dụng bộ ký tự được chỉ định để chuyển đổi giữa byte stream và character stream. Các bộ ký tự thông dụng bao gồm UTF-8, GBK, ISO-8859-1, v.v.</p>
<h3>01. Mã hóa và Giải mã</h3>
<p>Trong máy tính, dữ liệu thường được lưu trữ và truyền dưới dạng nhị phân.</p>
<ul>
<li>Mã hóa là việc chuyển đổi dữ liệu gốc (ví dụ như văn bản, hình ảnh, video, âm thanh, v.v.) thành dạng nhị phân.</li>
<li>Giải mã là việc chuyển đổi dữ liệu nhị phân thành dữ liệu gốc, là một quá trình ngược lại.</li>
</ul>
<p>Có nhiều phương thức mã hóa và giải mã phổ biến, dưới đây là một số ví dụ:</p>
<ul>
<li>Mã hóa và giải mã ASCII: Trong máy tính, thường sử dụng mã ASCII để biểu diễn các ký tự, như các chữ cái, số và ký hiệu trên bàn phím. Ví dụ, chữ A tương ứng với mã ASCII 65, ký tự + tương ứng với mã ASCII 43.</li>
<li>Mã hóa và giải mã Unicode: Unicode là một bộ ký tự hỗ trợ nhiều ngôn ngữ và bộ ký tự. Trong máy tính, Unicode có thể sử dụng các phương thức mã hóa như UTF-8, UTF-16 để chuyển đổi ký tự thành dữ liệu nhị phân để lưu trữ và truyền tải.</li>
<li>Mã hóa và giải mã Base64: Base64 là một phương thức mã hóa chuyển đổi dữ liệu nhị phân thành mã ASCII. Nó chuyển đổi 3 byte dữ liệu nhị phân thành 4 ký tự ASCII để sử dụng trong truyền tải mạng. Ví dụ, khi mã hóa chuỗi "Hello, world!" bằng Base64, kết quả sẽ là "SGVsbG8sIHdvcmxkIQ==".</li>
<li>Mã hóa và giải mã hình ảnh: Trong xử lý hình ảnh, thường sử dụng các phương thức mã hóa như JPEG, PNG, GIF để chuyển đổi hình ảnh thành dữ liệu nhị phân để lưu trữ và truyền tải. Khi giải mã, dữ liệu nhị phân có thể được chuyển đổi thành hình ảnh để hiển thị hoặc xử lý.</li>
<li>Mã hóa và giải mã video: Trong xử lý video, thường sử dụng các phương thức mã hóa như H.264, AVC, MPEG-4 để chuyển đổi video thành dữ liệu nhị phân để lưu trữ và truyền tải. Khi giải mã, dữ liệu nhị phân có thể được chuyển đổi thành video để phát hoặc xử lý.</li>
</ul>
<p>Nói một cách đơn giản:</p>
<ul>
<li>Mã hóa: ký tự (có thể đọc được) --&gt; byte (không thể đọc được)</li>
<li>Giải mã: byte (không thể đọc được) --&gt; ký tự (có thể đọc được)</li>
</ul>
<p>Tôi sẽ dùng mã nguồn để minh họa:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "沉默王二"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> charsetName </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "UTF-8"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Mã hóa</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] bytes </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> str</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Charset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">forName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(charsetName));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Mã hóa: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> bytes);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Giải mã</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> decodedStr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">(bytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Charset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">forName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(charsetName)</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Giải mã: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> decodedStr);</span></span></code></pre>
</div><p>Trong ví dụ này, đầu tiên định nghĩa một biến chuỗi str và một tên bộ ký tự charsetName. Sau đó, sử dụng phương thức <code>Charset.forName()</code> để lấy đối tượng Charset của bộ ký tự chỉ định. Tiếp theo, sử dụng phương thức getBytes() của chuỗi để mã hóa chuỗi thành mảng byte của bộ ký tự chỉ định. Cuối cùng, sử dụng phương thức <code>new String()</code> để giải mã mảng byte thành chuỗi.</p>
<p>Cần lưu ý rằng trong quá trình mã hóa và giải mã, cần đảm bảo sử dụng cùng một bộ ký tự để chuyển đổi dữ liệu chính xác.</p>
<h3>02. Bộ ký tự</h3>
<p>Charset: Bộ ký tự, là một tập hợp các ký tự, mỗi ký tự có một giá trị mã duy nhất, còn được gọi là điểm mã.</p>
<p>Các bộ ký tự thông dụng bao gồm ASCII và Unicode, trong đó bộ ký tự Unicode bao gồm nhiều phương thức mã hóa như UTF-8, UTF-16.</p>
<h4><strong>Bộ ký tự ASCII</strong></h4>
<p>Bộ ký tự ASCII (American Standard Code for Information Interchange, Mã tiêu chuẩn Mỹ cho trao đổi thông tin) là một trong những bộ ký tự đầu tiên, bao gồm 128 ký tự, trong đó có các ký tự điều khiển, số, chữ cái tiếng Anh và một số ký hiệu. Mỗi ký tự trong bộ ký tự ASCII có một mã nhị phân 7 bit duy nhất (gồm 0 và 1), có thể được biểu diễn dưới dạng số thập phân hoặc số thập lục phân.</p>
<p>Phương thức mã hóa ASCII là một phương thức mã hóa có độ dài cố định, mỗi ký tự sử dụng mã nhị phân 7 bit để biểu diễn. Mã hóa ASCII chỉ có thể biểu diễn chữ cái tiếng Anh, số và một số ít ký hiệu, không thể biểu diễn các ký tự và ký hiệu của ngôn ngữ khác, do đó ứng dụng toàn cầu bị hạn chế rất nhiều.</p>
<h4>Bộ ký tự Unicode</h4>
<p>Unicode bao gồm hầu hết tất cả các ký tự trên thế giới, được sử dụng để biểu diễn các ngôn ngữ, ký hiệu và biểu tượng của con người. Mỗi ký tự trong bộ ký tự Unicode có một điểm mã duy nhất (code point), được sử dụng để biểu diễn vị trí của ký tự trong bộ ký tự, có thể được biểu diễn dưới dạng số thập lục phân.</p>
<p>Để lưu trữ và truyền tải các ký tự trong bộ ký tự Unicode trên máy tính, cần sử dụng một phương thức mã hóa. UTF-8, UTF-16 và UTF-32 đều là các phương thức mã hóa của bộ ký tự Unicode, được sử dụng để chuyển đổi các ký tự trong bộ ký tự Unicode thành chuỗi byte, để lưu trữ và truyền tải. Sự khác biệt giữa chúng nằm ở độ dài byte sử dụng.</p>
<ul>
<li>UTF-8 là một phương thức mã hóa có độ dài biến đổi, đối với các ký tự ASCII (phạm vi mã <code>0x00~0x7F</code>), sử dụng một byte để biểu diễn, đối với các ký tự Unicode khác, sử dụng hai, ba hoặc bốn byte để biểu diễn. Phương thức mã hóa UTF-8 được sử dụng rộng rãi trong lĩnh vực Internet và máy tính vì nó có thể nén dữ liệu hiệu quả, phù hợp cho truyền tải và lưu trữ mạng.</li>
<li>UTF-16 là một phương thức mã hóa có độ dài cố định, đối với các ký tự trong mặt phẳng đa ngôn ngữ cơ bản (Basic Multilingual Plane, một phạm vi mã của bộ ký tự Unicode, bao gồm hầu hết các ký tự thông dụng trên thế giới, tổng cộng hơn 65,000 mã), sử dụng hai byte để biểu diễn, đối với các ký tự Unicode khác, sử dụng bốn byte để biểu diễn.</li>
<li>UTF-32 là một phương thức mã hóa có độ dài cố định, đối với tất cả các ký tự Unicode, sử dụng bốn byte để biểu diễn.</li>
</ul>
<h3>03. Lỗi mã hóa</h3>
<p>Khi sử dụng các phương thức mã hóa khác nhau để đọc hoặc ghi tệp, sẽ xuất hiện vấn đề lỗi mã hóa, hãy xem ví dụ.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> s </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "沉默王二！"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Lưu chuỗi dưới dạng mã hóa GBK vào tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    OutputStreamWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> out </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> OutputStreamWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"logs/test_utf8.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "GBK"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(s);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileReader </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"logs/test_utf8.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((read </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fileReader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)read);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fileReader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong mã ví dụ trên, đầu tiên định nghĩa một chuỗi chứa các ký tự Trung Quốc, sau đó lưu chuỗi này dưới dạng mã hóa GBK vào tệp, tiếp theo đọc tệp bằng phương thức mã hóa mặc định (UTF-8) và hiển thị nội dung. Lúc này sẽ xuất hiện vấn đề lỗi mã hóa, hiển thị là “��Ĭ������”.</p>
<p>Đó là vì các ký tự mã hóa GBK trong tệp không thể được giải mã đúng cách bằng phương thức mã hóa UTF-8, dẫn đến xuất hiện lỗi mã hóa.</p>
<p>Vậy làm thế nào để giải quyết vấn đề lỗi mã hóa?</p>
<p>Điều này dẫn chúng ta đến chủ đề chính của hôm nay - conversion stream.</p>
<h3>04. InputStreamReader</h3>
<p><code>java.io.InputStreamReader</code> là một lớp con của lớp Reader. Chức năng của nó là chuyển đổi byte stream (InputStream) thành character stream (Reader), đồng thời hỗ trợ phương thức mã hóa bộ ký tự được chỉ định, từ đó thực hiện chuyển đổi giữa character stream và byte stream.</p>
<h4>1）Phương thức khởi tạo</h4>
<ul>
<li><code>InputStreamReader(InputStream in)</code>: Tạo một character stream sử dụng bộ ký tự mặc định.</li>
<li><code>InputStreamReader(InputStream in, String charsetName)</code>: Tạo một character stream sử dụng bộ ký tự được chỉ định.</li>
</ul>
<p>Ví dụ mã:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">InputStreamReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> isr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> InputStreamReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"in.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">InputStreamReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> isr2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> InputStreamReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"in.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "GBK"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h4>2）Giải quyết vấn đề mã hóa</h4>
<p>Dưới đây là một ví dụ mã sử dụng InputStreamReader để giải quyết vấn đề lỗi mã hóa:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> s </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "沉默王二！"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Lưu chuỗi dưới dạng mã hóa GBK vào tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    OutputStreamWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> outUtf8 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> OutputStreamWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"logs/test_utf8.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "GBK"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    outUtf8</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(s);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    outUtf8</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Chuyển đổi byte stream thành character stream, sử dụng mã hóa GBK</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    InputStreamReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> isr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> InputStreamReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"logs/test_utf8.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "GBK"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đọc character stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> c</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((c </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> isr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) c);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    isr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Vì sử dụng InputStreamReader để chuyển đổi mã hóa byte stream, nên khi đọc character stream, có thể giải mã chính xác các ký tự Trung Quốc, tránh được vấn đề lỗi mã hóa.</p>
<h3>05. OutputStreamWriter</h3>
<p><code>java.io.OutputStreamWriter</code> là một lớp con của Writer, tên gọi dễ gây nhầm lẫn rằng nó chuyển đổi thành character stream, nhưng thực ra là chuyển đổi character stream thành byte stream, là cầu nối giữa character stream và byte stream.</p>
<ul>
<li><code>OutputStreamWriter(OutputStream in)</code>: Tạo một character stream sử dụng bộ ký tự mặc định.</li>
<li><code>OutputStreamWriter(OutputStream in, String charsetName)</code>: Tạo một character stream sử dụng bộ ký tự được chỉ định.</li>
</ul>
<p>Ví dụ mã:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">OutputStreamWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> osw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> OutputStreamWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">OutputStreamWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> osw2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> OutputStreamWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "GBK"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Thông thường để nâng cao hiệu suất đọc ghi, chúng ta sẽ thêm một lớp buffered stream trên conversion stream, hãy xem ví dụ mã dưới đây:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đọc byte stream từ tệp, sử dụng mã hóa UTF-8</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Chuyển đổi byte stream thành character stream, sử dụng mã hóa UTF-8</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    InputStreamReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> isr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> InputStreamReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "UTF-8"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Sử dụng buffered stream để bọc character stream, nâng cao hiệu suất đọc</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> br </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(isr)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Tạo output stream, sử dụng mã hóa UTF-8</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Chuyển đổi output stream thành character stream, sử dụng mã hóa UTF-8</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    OutputStreamWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> osw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> OutputStreamWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "UTF-8"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Sử dụng buffered stream để bọc conversion stream, nâng cao hiệu suất ghi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    BufferedWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(osw)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đọc từng dòng của tệp đầu vào, ghi vào tệp đầu ra</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((line </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        bw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(line);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        bw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">newLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Viết ký tự xuống dòng sau mỗi dòng</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đóng các stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    bw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong đoạn mã ví dụ trên, đầu tiên sử dụng FileInputStream để đọc byte stream từ tệp, sử dụng mã hóa UTF-8 để đọc. Sau đó, sử dụng InputStreamReader để chuyển đổi byte stream thành character stream, sử dụng mã hóa UTF-8 để chuyển đổi. Tiếp theo, sử dụng BufferedReader để bọc character stream, nâng cao hiệu suất đọc. Tiếp theo, tạo FileOutputStream để xuất ra tệp, sử dụng mã hóa UTF-8 để tạo. Sau đó, sử dụng OutputStreamWriter để chuyển đổi output stream thành character stream, sử dụng mã hóa UTF-8 để chuyển đổi. Cuối cùng, sử dụng BufferedWriter để bọc conversion stream, nâng cao hiệu suất ghi.</p>
<h3>06. Tổng kết</h3>
<p>InputStreamReader và OutputStreamWriter là các lớp chuyển đổi dòng byte thành dòng ký tự hoặc dòng ký tự thành dòng byte. Chúng thường được sử dụng để giải quyết vấn đề chuyển đổi giữa dòng byte và dòng ký tự, cho phép chuyển đổi dòng byte sang dòng ký tự theo một bộ ký tự được chỉ định, hoặc chuyển đổi dòng ký tự sang dòng byte theo một bộ ký tự được chỉ định.</p>
<p>Các phương thức thường dùng của lớp InputStreamReader bao gồm:</p>
<ul>
<li><code>read()</code>: Đọc một ký tự từ dòng đầu vào.</li>
<li><code>read(char[] cbuf, int off, int len)</code>: Đọc len ký tự từ dòng đầu vào và lưu vào mảng ký tự cbuf bắt đầu từ vị trí off.</li>
<li><code>ready()</code>: Kiểm tra xem dòng này đã sẵn sàng để đọc chưa.</li>
<li><code>close()</code>: Đóng dòng đầu vào.</li>
</ul>
<p>Các phương thức thường dùng của lớp OutputStreamWriter bao gồm:</p>
<ul>
<li><code>write(int c)</code>: Ghi một ký tự vào dòng đầu ra.</li>
<li><code>write(char[] cbuf, int off, int len)</code>: Ghi len ký tự từ mảng ký tự cbuf vào dòng đầu ra bắt đầu từ vị trí off.</li>
<li><code>flush()</code>: Đẩy dữ liệu từ bộ đệm ra dòng đầu ra.</li>
<li><code>close()</code>: Đóng dòng đầu ra.</li>
</ul>
<p>Khi sử dụng các dòng chuyển đổi, cần chỉ định đúng bộ ký tự mã hóa, nếu không có thể dẫn đến việc đọc hoặc ghi dữ liệu bị lỗi hiển thị.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Serialize/Deserialize Stream</title>
      <link>https://vanhung4499.github.io/programming/java/IO/serialize.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/serialize.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Serialize/Deserialize Stream</source>
      <description>Serialize/Deserialize Stream Serialize/Deserialize Stream trong Java (ObjectInputStream và ObjectOutputStream) là một loại stream có thể serialize và deserialize các đối tượng J...</description>
      <category>java</category>
      <pubDate>Mon, 01 Jul 2024 16:00:06 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Serialize/Deserialize Stream trong Java (ObjectInputStream và ObjectOutputStream) là một loại stream có thể serialize và deserialize các đối tượng Java.</p>
<p>serialize là quá trình chuyển đổi một đối tượng thành một chuỗi byte (bao gồm <code>dữ liệu của đối tượng</code>, <code>loại đối tượng</code> và <code>các thuộc tính lưu trữ trong đối tượng</code>, v.v.) để truyền qua mạng hoặc lưu vào tệp, hoặc truyền giữa các chương trình. Trong Java, serialize được thực hiện bằng cách triển khai interface java.io.Serializable, chỉ có các đối tượng triển khai <a href="serializbale">interface Serializable</a> mới có thể được serialize.</p>
<p>Deserialize là quá trình chuyển đổi một chuỗi byte thành một đối tượng để sử dụng trong chương trình.</p>
<h3>01. ObjectOutputStream</h3>
<p><code>java.io.ObjectOutputStream</code> kế thừa từ lớp OutputStream, do đó có thể ghi chuỗi byte đã serialize vào các output stream như tệp, mạng, v.v.</p>
<p>Xem phương thức khởi tạo của ObjectOutputStream:<br>
<code>ObjectOutputStream(OutputStream out)</code></p>
<p>Phương thức khởi tạo này nhận một đối tượng OutputStream làm tham số, dùng để ghi chuỗi byte đã serialize vào output stream được chỉ định. Ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"file.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> oos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(fos)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Một đối tượng muốn serialize phải đáp ứng hai điều kiện:</p>
<ul>
<li>Lớp đó phải triển khai <a href="https://javabetter.cn/io/Serializbale.html" target="_blank" rel="noopener noreferrer">interface <code>java.io.Serializable</code></a>, nếu không sẽ ném ra ngoại lệ <code>NotSerializableException</code>.</li>
<li>Tất cả các trường của lớp đó phải có khả năng serialize. Nếu một trường không cần serialize, thì cần sử dụng từ khóa <a href="https://javabetter.cn/io/transient.html" target="_blank" rel="noopener noreferrer"><code>transient</code></a> để đánh dấu.</li>
</ul>
<p>Ví dụ sử dụng như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Employee</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> address</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> transient</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Từ khóa transient đánh dấu thành viên này không bị serialize</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Tiếp theo, chúng ta sẽ nói về phương thức <code>writeObject (Object obj)</code>, phương thức này trong lớp ObjectOutputStream được sử dụng để serialize một đối tượng thành chuỗi byte và ghi vào output stream. Nó có thể xử lý các mối quan hệ tham chiếu giữa các đối tượng, quan hệ kế thừa, các trường tĩnh và các trường transient.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> ObjectOutputStreamDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Person</span><span style="color:#E06C75;--shiki-dark:#E06C75"> person</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Person</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"logs/person.dat"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> oos</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(fos);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            oos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(person);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            oos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Person</span><span style="color:#C678DD;--shiki-dark:#C678DD"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Person</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">age</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getAge</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong đoạn mã trên, đầu tiên chúng ta tạo một đối tượng Person, sau đó sử dụng FileOutputStream và ObjectOutputStream để serialize đối tượng Person và ghi vào tệp person.dat. Trong lớp Person, chúng ta đã triển khai interface Serializable, cho phép lớp này có thể serialize đối tượng.</p>
<h3>02. ObjectInputStream</h3>
<p>ObjectInputStream có thể đọc byte stream do ObjectOutputStream ghi lại và deserialize nó thành các đối tượng tương ứng (bao gồm <code>dữ liệu của đối tượng</code>, <code>loại đối tượng</code> và <code>các thuộc tính lưu trữ trong đối tượng</code>, v.v.).</p>
<p>Nói đơn giản, trước khi serialize đối tượng như thế nào thì sau khi deserialize đối tượng sẽ như thế.</p>
<p>Hãy xem phương thức khởi tạo: <code>ObjectInputStream(InputStream in)</code>: Tạo một ObjectInputStream từ InputStream được chỉ định.</p>
<p>Phương thức readObject của ObjectInputStream dùng để đọc đối tượng từ tệp được chỉ định, ví dụ như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> filename </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "logs/person.dat"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tên tệp cần deserialize</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileIn </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(filename)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> in </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(fileIn)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     // Đọc đối tượng từ input stream được chỉ định và deserialize</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     Object</span><span style="color:#E06C75;--shiki-dark:#E06C75"> obj </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     // Ép kiểu đối tượng sau khi deserialize về kiểu chỉ định</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     Person</span><span style="color:#E06C75;--shiki-dark:#E06C75"> p </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (Person) obj</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     // In thông tin đối tượng sau khi deserialize</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Deserialized Object: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> p);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75"> | </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClassNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Chúng ta đầu tiên chỉ định tên tệp cần deserialize (đã được serialize bằng ObjectOutputStream trước đó), sau đó tạo một đối tượng FileInputStream và một đối tượng ObjectInputStream. Tiếp theo, chúng ta gọi phương thức readObject của ObjectInputStream để đọc đối tượng từ tệp được chỉ định và ép kiểu đối tượng đó về kiểu Person. Cuối cùng, chúng ta in thông tin đối tượng sau khi deserialize.</p>
<h3>03. Kryo</h3>
<p>Trong thực tế phát triển, rất hiếm khi sử dụng cơ chế serialize và deserialize tích hợp sẵn của JDK, bởi vì:</p>
<ul>
<li>Khả năng di chuyển kém: Chỉ dành riêng cho Java, không thể serialize và deserialize giữa các ngôn ngữ khác nhau.</li>
<li>Hiệu suất kém: Kích thước byte sau serialize lớn, tăng chi phí truyền tải/lưu trữ.</li>
<li>Vấn đề an ninh: Kẻ tấn công có thể tạo ra dữ liệu độc hại để thực thi mã từ xa, gây ra mối đe dọa nghiêm trọng cho hệ thống. Đọc thêm: <a href="https://cryin.github.io/blog/secure-development-java-deserialization-vulnerability/" target="_blank" rel="noopener noreferrer">Lỗ hổng Java deserialize</a>.</li>
</ul>
<p>Kryo là một thư viện serialize và deserialize Java tuyệt vời, có hiệu suất cao, hiệu quả và dễ sử dụng cũng như mở rộng, giải quyết hiệu quả những hạn chế của cơ chế serialize tích hợp sẵn của JDK.</p>
<blockquote>
<p>Địa chỉ GitHub: <a href="https://github.com/EsotericSoftware/kryo" target="_blank" rel="noopener noreferrer">https://github.com/EsotericSoftware/kryo</a></p>
</blockquote>
<p>Ví dụ sử dụng:</p>
<p>Bước đầu tiên, thêm phụ thuộc vào tệp pom.xml.</p>
<div class="language-xml" data-ext="xml" data-title="xml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">&lt;!-- Thêm công cụ serialize Kryo --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">dependency</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">     &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">groupId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;com.esotericsoftware&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75">groupId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">     &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">artifactId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;kryo&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75">artifactId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">     &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">version</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;5.4.0&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75">version</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;/</span><span style="color:#E06C75;--shiki-dark:#E06C75">dependency</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span></code></pre>
</div><p>Bước thứ hai, tạo một đối tượng Kryo, và sử dụng phương thức <code>register()</code> để đăng ký đối tượng. Sau đó, sử dụng phương thức <code>writeObject()</code> để serialize đối tượng Java thành binary stream, và sử dụng phương thức <code>readObject()</code> để deserialize binary stream thành đối tượng Java. Cuối cùng, xuất đối tượng Java sau khi deserialize.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> KryoDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FileNotFoundException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Kryo</span><span style="color:#E06C75;--shiki-dark:#E06C75"> kryo</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Kryo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        kryo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">register</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">KryoParam</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        KryoParam</span><span style="color:#E06C75;--shiki-dark:#E06C75"> object</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> KryoParam</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">123</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Output</span><span style="color:#E06C75;--shiki-dark:#E06C75"> output</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Output</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"logs/kryo.bin"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        kryo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(output, object);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        output</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Input</span><span style="color:#E06C75;--shiki-dark:#E06C75"> input</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"logs/kryo.bin"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        KryoParam</span><span style="color:#E06C75;--shiki-dark:#E06C75"> object2</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> kryo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(input, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">KryoParam</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(object2);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> KryoParam</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> KryoParam</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> KryoParam</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">age</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> setName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">name</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getAge</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> setAge</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">age</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#98C379;--shiki-dark:#98C379"> "KryoParam{"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">                "name='"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> '</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\'</span><span style="color:#98C379;--shiki-dark:#98C379">'</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">                ", age="</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> age </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">                '}'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>04. Tổng kết</h3>
<p>Trong phần này, chúng ta đã giới thiệu cơ chế serialize của Java và đề xuất một thư viện Java hiệu suất cao Kryo để thay thế cơ chế serialize tích hợp sẵn của JDK, hiện đã được sử dụng rộng rãi trong Twitter, Groupon, Yahoo và nhiều dự án mã nguồn mở nổi tiếng khác (như Hive, Storm).</p>
<p>Hy vọng rằng những thông tin trên sẽ hữu ích cho các bạn.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Buffered Stream</title>
      <link>https://vanhung4499.github.io/programming/java/IO/buffer.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/buffer.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Buffered Stream</source>
      <description>Buffered Stream Các buffered stream của Java là một loại bao bọc cho các byte stream và character stream, bằng cách mở một bộ đệm trong bộ nhớ để tăng hiệu suất của các thao tác...</description>
      <category>java</category>
      <pubDate>Sun, 30 Jun 2024 16:14:55 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Các buffered stream của Java là một loại bao bọc cho các byte stream và character stream, bằng cách mở một bộ đệm trong bộ nhớ để tăng hiệu suất của các thao tác I/O. Java sử dụng <code>BufferedInputStream</code> và <code>BufferedOutputStream</code> để thực hiện đệm byte stream, và <code>BufferedReader</code> và <code>BufferedWriter</code> để thực hiện đệm character stream.</p>
<p>Nguyên lý hoạt động của buffered stream là ghi dữ liệu vào bộ đệm trước, khi bộ đệm đầy thì ghi dữ liệu vào tệp hoặc output stream một lần, hoặc khi bộ đệm trống thì đọc một lượng dữ liệu nhất định từ tệp hoặc input stream một lần. Điều này giúp giảm số lần thao tác I/O của hệ thống, tăng hiệu suất I/O của hệ thống, từ đó tăng hiệu suất chạy của chương trình.</p>
<h3>01. Buffered byte stream</h3>
<p><code>BufferedInputStream</code> và <code>BufferedOutputStream</code> thuộc loại buffered stream byte, củng cố các byte stream <code>InputStream</code> và <code>OutputStream</code>. Về các byte stream, chúng ta đã thảo luận chi tiết trước đó, bạn có thể <a href="https://javabetter.cn/io/stream.html" target="_blank" rel="noopener noreferrer">nhấp vào liên kết này</a> để ôn lại.</p>
<h4>1. Phương thức khởi tạo</h4>
<ul>
<li><code>BufferedInputStream(InputStream in)</code> : Tạo một buffered stream đầu vào mới, chú ý rằng tham số là loại <strong>InputStream</strong>.</li>
<li><code>BufferedOutputStream(OutputStream out)</code> : Tạo một buffered stream đầu ra mới, chú ý rằng tham số là loại <strong>OutputStream</strong>.</li>
</ul>
<p>Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo buffered stream đầu vào byte, đầu tiên khai báo byte stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(fis)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo buffered stream đầu vào byte (một bước)</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo buffered stream đầu ra byte (một bước)</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h4>2. Hiệu quả của buffered stream</h4>
<p>Chúng ta sẽ kiểm tra hiệu quả của buffered stream bằng cách sao chép một tệp lớn hơn 370MB. Để so sánh, trước tiên chúng ta sẽ thực hiện bằng cách sử dụng stream cơ bản, mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi lại thời gian bắt đầu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> start </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"py.mp4"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tệp exe đủ lớn</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"copyPy.mp4"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đọc và ghi dữ liệu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi lại thời gian kết thúc</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Thời gian sao chép bằng stream cơ bản: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> start) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> " mili giây"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Xin lỗi, máy của tôi khá yếu, sau 10 phút vẫn đang sao chép. Hãy chuyển sang thử buffered stream, mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi lại thời gian bắt đầu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> start </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"py.mp4"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"copyPy.mp4"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đọc và ghi dữ liệu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> bis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi lại thời gian kết thúc</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Thời gian sao chép bằng buffered stream: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> start) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> " mili giây"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Chỉ cần 8016 mili giây. Làm thế nào để nhanh hơn nữa?</p>
<p>Chúng ta có thể sử dụng cách đọc và ghi bằng mảng, như đã thảo luận trước đó, mã như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi lại thời gian bắt đầu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> start </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"py.mp4"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"copyPy.mp4"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đọc và ghi dữ liệu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] bytes </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">8</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> *</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> bis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(bytes)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(bytes, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi lại thời gian kết thúc</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Thời gian sao chép bằng buffered stream sử dụng mảng: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> start) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> " mili giây"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Bây giờ thì nhanh hơn nhiều, chỉ cần 521 mili giây.</p>
<h4>3. Tại sao buffered stream lại nhanh như vậy?</h4>
<p>Java IO truyền thống là chế độ chặn, hoạt động của nó là "đọc/ghi, chờ, đọc/ghi, chờ...". buffered stream giải quyết vấn đề này bằng cách <strong>đọc và ghi nhiều hơn trong một lần, giảm tần suất đọc và ghi, sử dụng không gian để đổi lấy thời gian</strong>.</p>
<ul>
<li><strong>Giảm số lần gọi hệ thống</strong>: Khi sử dụng buffered stream, dữ liệu không được ghi trực tiếp vào đĩa hoặc output stream, mà trước tiên được ghi vào bộ đệm. Khi bộ đệm đầy, dữ liệu mới được ghi một lần vào đĩa hoặc output stream. Điều này giúp giảm số lần gọi hệ thống, do đó nâng cao hiệu quả hoạt động I/O.</li>
<li><strong>Giảm số lần đọc và ghi đĩa</strong>: Khi cần đọc dữ liệu, buffered stream sẽ đọc từ bộ đệm trước. Nếu bộ đệm không đủ dữ liệu, buffered stream sẽ đọc một lượng lớn dữ liệu từ đĩa hoặc input stream một lần. Tương tự, khi cần ghi dữ liệu, buffered stream sẽ ghi vào bộ đệm trước. Nếu bộ đệm đầy, dữ liệu trong bộ đệm sẽ được ghi vào đĩa hoặc output stream một lần. Điều này giúp giảm số lần đọc và ghi đĩa, do đó nâng cao hiệu quả hoạt động I/O.</li>
<li><strong>Nâng cao hiệu quả truyền dữ liệu</strong>: Khi sử dụng buffered stream, dữ liệu được truyền theo khối, giảm số lần truyền dữ liệu, do đó nâng cao hiệu quả truyền dữ liệu.</li>
</ul>
<p>Hãy xem phương thức <code>read</code> của <code>BufferedInputStream</code>:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> synchronized</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> read</span><span style="color:#E06C75;--shiki-dark:#E06C75">() throws IOException {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (pos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> count) {     </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu vị trí hiện tại đã đến cuối bộ đệm</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        fill</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">             // Điền đầy bộ đệm</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (pos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> count)   </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu sau khi điền đầy vẫn đến cuối bộ đệm, nghĩa là đã đọc xong</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            return</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">      // Trả về -1 để biểu thị đã đọc xong</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> getBufIfOpen</span><span style="color:#E06C75;--shiki-dark:#E06C75">()[pos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">++</span><span style="color:#E06C75;--shiki-dark:#E06C75">] </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&amp;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0xff</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Trả về byte tại vị trí hiện tại và tăng vị trí lên 1</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Đoạn mã này có hai phần chính:</p>
<ul>
<li><code>fill()</code>: Phương thức này sẽ điền đầy bộ đệm <code>buf</code>.</li>
<li><code>getBufIfOpen()[pos++] &amp; 0xff</code>: Trả về byte tại vị trí đọc hiện tại <code>pos</code> (phương thức <code>getBufIfOpen()</code> trả về mảng <code>buffer</code>, là kiểu <code>byte</code>), và thực hiện phép toán <code>AND</code> với <code>0xff</code>. Mục đích là để xử lý byte <code>b</code> như một byte không dấu, vì kiểu <code>byte</code> trong Java có dấu. Phép toán <code>AND</code> với <code>0xff</code> sẽ chuyển đổi byte này thành byte không dấu, với phạm vi từ 0 đến 255.</li>
</ul>
<blockquote>
<p>Xử lý <code>byte &amp; 0xFF</code> sẽ được giải thích chi tiết sau.</p>
</blockquote>
<p>Tiếp theo, hãy xem phương thức <code>read</code> của <code>FileInputStream</code>:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630225343.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Trong đoạn mã này, phương thức <code>read0()</code> là một native-method, được thực hiện bởi hệ điều hành và không phải bằng Java. Trên các hệ điều hành khác nhau, phương thức <code>read0()</code> có thể được thực hiện khác nhau, nhưng chức năng của chúng là giống nhau, dùng để <strong>đọc một byte</strong>.</p>
<p>Tiếp theo, hãy xem phương thức <code>write(byte b[], int off, int len)</code> của <code>BufferedOutputStream</code>:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> synchronized</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> write</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b[]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len) throws IOException {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> buf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {    </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu số byte ghi lớn hơn hoặc bằng độ dài bộ đệm</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        /* Nếu độ dài yêu cầu vượt quá kích thước của bộ đệm đầu ra,</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">           trước tiên sẽ làm trống bộ đệm, sau đó trực tiếp ghi dữ liệu.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">           Điều này có thể tránh vấn đề xâu chuỗi bộ đệm. */</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        flushBuffer</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">          // Trước tiên làm trống bộ đệm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b, off, len);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Trực tiếp ghi dữ liệu vào output stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> buf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#E06C75;--shiki-dark:#E06C75"> count) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu số byte ghi lớn hơn không gian trống</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        flushBuffer</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">              // Trước tiên làm trống bộ đệm</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">arraycopy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b, off, buf, count, len);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Sao chép dữ liệu vào bộ đệm</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    count </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">                             // Cập nhật bộ đếm</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trước tiên, phương thức này sẽ kiểm tra nếu số byte ghi lớn hơn hoặc bằng độ dài bộ đệm. Nếu đúng, trước tiên nó sẽ làm trống bộ đệm, sau đó trực tiếp ghi dữ liệu vào output stream. Điều này nhằm tránh vấn đề xâu chuỗi bộ đệm, nghĩa là khi kích thước bộ đệm không đủ để chứa dữ liệu cần ghi, có thể gây ra làm trống bộ đệm liên tiếp, dẫn đến giảm hiệu suất.</p>
<blockquote>
<p>Vấn đề xâu chuỗi (Cascade Problem) là hiện tượng khi một tập hợp các buffered stream có kích thước bộ đệm không đủ để chứa dữ liệu cần ghi, dẫn đến dữ liệu bị phân chia thành nhiều phần và ghi vào các bộ đệm khác nhau, cuối cùng cần phải làm trống từng bộ đệm một, từ đó gây giảm hiệu suất.</p>
</blockquote>
<p>Tiếp theo, nếu số byte ghi nhỏ hơn độ dài bộ đệm, nó sẽ kiểm tra không gian còn lại của bộ đệm có đủ để chứa dữ liệu cần ghi hay không. Nếu không đủ, nó sẽ làm trống bộ đệm. Sau đó, nó sẽ sử dụng phương thức <code>System.arraycopy()</code> để sao chép dữ liệu vào bộ đệm và cập nhật bộ đếm <code>count</code>.</p>
<p>Cuối cùng, nếu số byte ghi nhỏ hơn độ dài bộ đệm và bộ đệm vẫn còn không gian trống, nó sẽ trực tiếp sao chép dữ liệu vào bộ đệm và cập nhật bộ đếm <code>count</code>.</p>
<p>Điều này có nghĩa là chỉ khi <code>buf</code> đầy, nó mới làm trống bộ đệm (flush) và ghi dữ liệu vào đĩa, mặc định mỗi lần ghi 8192 byte.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">OutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> out) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    this</span><span style="color:#E06C75;--shiki-dark:#E06C75">(out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 8192</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Nếu <code>buf</code> chưa đầy, nó sẽ tiếp tục ghi vào <code>buf</code>.</p>
<p>So sánh với phương thức <code>write</code> của <code>FileOutputStream</code>, cũng là phương thức gốc và mỗi lần chỉ có thể ghi một byte.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630225438.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Khi sử dụng <code>BufferedOutputStream</code> và <code>BufferedInputStream</code> cùng nhau, số lần đọc và ghi sẽ giảm đáng kể, đặc biệt khi sử dụng <code>byte[] bytes = new byte[8*1024]</code>, tương đương với việc bộ đệm có dung lượng 8 x 1024 byte, thì hiệu quả đọc và ghi sẽ tăng lên rất nhiều.</p>
<h4>4. <code>byte &amp; 0xFF</code></h4>
<p>Kiểu byte thường được sử dụng để lưu trữ dữ liệu nhị phân, ví dụ như đọc và ghi vào tệp, truyền dữ liệu qua mạng, v.v. Trong những tình huống này, biến kiểu byte có thể được sử dụng để lưu trữ từng byte trong stream dữ liệu để thực hiện các thao tác đọc và ghi.</p>
<p>Kiểu byte là có dấu, có nghĩa là giá trị của nó nằm trong phạm vi từ -128 đến 127. Nếu chúng ta muốn có được một giá trị byte không dấu, chúng ta cần sử dụng <code>byte &amp; 0xFF</code> để chuyển đổi.</p>
<p>Điều này là bởi vì 0xFF là một số nguyên không dấu, biểu diễn nhị phân của nó là 11111111. Khi một giá trị kiểu byte được thực hiện phép AND với 0xFF, nó sẽ chuyển đổi giá trị kiểu byte đó thành một số nguyên không dấu, nằm trong phạm vi từ 0 đến 255.</p>
<p>0xFF là một số thập lục phân, tương đương với nhị phân 11111111. Toán tử &amp; có ý nghĩa là: nếu hai bit tương ứng là 1, thì bit kết quả là 1, ngược lại là 0; vì vậy khi thực hiện phép AND với 0xFF, byte sẽ được giữ nguyên và chuyển đổi thành một số nguyên trong khoảng từ 0 đến 255.</p>
<p>Ví dụ, nếu chúng ta có một biến kiểu byte là b, với giá trị là -1, thì kết quả của b &amp; 0xFF là 255. Điều này cho phép chuyển đổi một giá trị kiểu byte có dấu thành một số nguyên không dấu.</p>
<p>Phép toán AND là một phương pháp tính toán dữ liệu nhị phân, trong đó nếu cả hai bit tương ứng đều là 1 thì kết quả là 1, ngược lại là 0. Trong quá trình tính toán <code>getBufIfOpen()[pos++] &amp; 0xff</code>, byte có 8 bit, 0xFF là 255 trong hệ thập lục phân, biểu diễn là số nguyên, có 32 bit.</p>
<p>Nếu <code>getBufIfOpen()[pos++]</code> là -118, thì biểu diễn gốc của nó là</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>00000000 00000000 00000000 10001010</span></span></code></pre>
</div><p>Biểu diễn đảo của nó là</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>11111111 11111111 11111111 11110101</span></span></code></pre>
</div><p>Biểu diễn bù của nó là</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>11111111 11111111 11111111 11110110</span></span></code></pre>
</div><p>0XFF là 255 biểu diễn trong hệ thập lục phân là 255, biểu diễn gốc, đảo, bù là như nhau, dữ liệu hai, byte 255 chính byte cùng.</p>
<p>① Dạng gốc</p>
<p>Dạng gốc là việc thêm dấu chữ số vào giá trị tuyệt đối, tức là sử dụng dấu đầu tiên để biểu thị dấu, các bit còn lại biểu thị giá trị. Ví dụ nếu là số nhị phân 8 bit:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[+1] gốc = 0000 0001</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[-1] gốc = 1000 0001</span></span></code></pre>
</div><p>Dấu đầu tiên là dấu chữ số. Vì dấu đầu tiên là dấu chữ số, nên phạm vi giá trị của số nhị phân 8 bit là:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[1111 1111 , 0111 1111]</span></span></code></pre>
</div><p>tức là</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[-127 , 127]</span></span></code></pre>
</div><p>② Dạng đảo</p>
<p>Phương pháp biểu thị của dạng đảo là:</p>
<ul>
<li>Dạng đảo của số dương là chính nó</li>
<li>Dạng đảo của số âm là dựa trên dạng gốc của nó, giữ nguyên dấu chữ số, các bit còn lại đảo ngược.</li>
</ul>
<p>Ví dụ:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[+1] = [00000001] gốc = [00000001] đảo</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[-1] = [10000001] gốc = [11111110] đảo</span></span></code></pre>
</div><p>Có thể thấy nếu một dạng đảo biểu thị là số âm, thì não không thể trực quan nhận ra giá trị của nó. Thông thường cần chuyển đổi sang dạng gốc trước khi tính toán.</p>
<p>③ Dạng bù</p>
<p>Phương pháp biểu thị của dạng bù là:</p>
<ul>
<li>Dạng bù của số dương là chính nó</li>
<li>Dạng bù của số âm là dựa trên dạng gốc của nó, giữ nguyên dấu chữ số, các bit còn lại đảo ngược, sau đó +1. (tức là cộng thêm một)</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[+1] = [00000001] gốc = [00000001] đảo = [00000001] bù</span></span>
<span class="line"><span></span></span>
<span class="line"><span>[-1] = [10000001] gốc = [11111110] đảo = [11111111] bù</span></span></code></pre>
</div><p>Đối với số âm, phương pháp biểu thị bù cũng là một cách mà não không thể trực quan nhận ra giá trị của nó. Thông thường cũng cần chuyển đổi sang dạng gốc trước khi tính toán.</p>
<p>Từ những điều trên có thể thấy:</p>
<ul>
<li>Đối với số dương: dạng gốc, đảo, bù đều giống nhau</li>
<li>Đối với số âm: dạng gốc, đảo, bù đều khác nhau</li>
</ul>
<h3>02. Buffered character stream</h3>
<p>Lớp BufferedReader kế thừa từ lớp Reader và cung cấp một số phương thức tiện ích, ví dụ như phương thức <code>readLine()</code> có thể đọc một dòng dữ liệu một lần, thay vì đọc từng ký tự một.</p>
<p>Lớp BufferedWriter kế thừa từ lớp Writer và cung cấp một số phương thức tiện ích, ví dụ như phương thức <code>newLine()</code> có thể ghi một dấu phân tách dòng cụ thể cho hệ thống.</p>
<h4>1. Phương thức khởi tạo</h4>
<ul>
<li><code>BufferedReader(Reader in)</code> ：Tạo một buffered input stream mới, lưu ý loại tham số là <strong>Reader</strong>.</li>
<li><code>BufferedWriter(Writer out)</code>： Tạo một buffered output stream mới, lưu ý loại tham số là <strong>Writer</strong>.</li>
</ul>
<p>Mã ví dụ như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo input stream ký tự đệm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> br </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo output stream ký tự đệm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h4>2. Phương thức đặc thù của buffered character stream</h4>
<p>Các phương thức cơ bản của buffered character stream và cách gọi tương tự như <a href="character">character stream</a>, ở đây không nhắc lại. Chúng ta sẽ xem xét các phương thức <strong>đặc thù</strong> của buffered character stream.</p>
<ul>
<li>BufferedReader：<code>String readLine()</code>: <strong>Đọc một dòng dữ liệu</strong>, đọc đến cuối cùng sẽ trả về null.</li>
<li>BufferedWriter：<code>newLine()</code>: <strong>Xuống dòng</strong>, hệ thống xác định ký tự xuống dòng.</li>
</ul>
<p>Ví dụ về phương thức <code>readLine()</code>:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> br </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Định nghĩa chuỗi để lưu trữ dòng văn bản đã đọc</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> line  </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc lặp, đọc đến cuối cùng sẽ trả về null</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((line </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(line);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630225343.png" type="image/png"/>
    </item>
    <item>
      <title>Character Stream</title>
      <link>https://vanhung4499.github.io/programming/java/IO/character.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/character.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Character Stream</source>
      <description>Character Stream 7.4 Character Stream Câu chuyện về Character Stream Reader và Writer bắt đầu từ biểu đồ quan hệ lớp của chúng, hãy cùng xem biểu đồ. image.pngimage.png Characte...</description>
      <category>java</category>
      <pubDate>Sun, 30 Jun 2024 16:14:55 GMT</pubDate>
      <content:encoded><![CDATA[
<h1>7.4 Character Stream</h1>
<p>Câu chuyện về Character Stream Reader và Writer bắt đầu từ biểu đồ quan hệ lớp của chúng, hãy cùng xem biểu đồ.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630220036.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Character Stream là một loại IO Stream dùng để đọc và ghi dữ liệu ký tự. Khác với Byte Stream, Character Stream đọc và ghi dữ liệu theo đơn vị ký tự chứ không phải theo đơn vị byte. Thường được sử dụng để xử lý thông tin văn bản.</p>
<p>Nếu sử dụng Byte Stream để đọc trực tiếp tiếng Việt, có thể gặp phải vấn đề hiển thị ký tự bị lỗi, xem ví dụ dưới đây:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// FileInputStream là character input stream hoạt động trên file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> inputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// // Nội dung là "Xin chào các bạn"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> inputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) len);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Xem kết quả chạy:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Xin chÃ&nbsp;o cÃ¡c báº¡n</span></span></code></pre>
</div><p>Lý do xuất hiện lỗi hiển thị là vì trong Byte Stream, một ký tự thường được tạo thành từ nhiều byte và các mã ký tự khác nhau sử dụng số byte khác nhau. Nếu chúng ta sử dụng mã ký tự không đúng hoặc không xử lý chính xác việc chuyển đổi mã ký tự khi đọc và ghi dữ liệu, sẽ dẫn đến ký tự tiếng Việt bị lỗi hiển thị.</p>
<p>Ví dụ, khi sử dụng mã ký tự mặc định (xem ví dụ trên) để đọc một file văn bản chứa ký tự tiếng Việt, sẽ xuất hiện lỗi hiển thị. Bởi vì mã ký tự mặc định thường là mã ASCII, chỉ có thể biểu diễn ký tự tiếng Anh và không thể giải mã đúng ký tự tiếng Việt.</p>
<p>Vậy làm thế nào để sử dụng Byte Stream để đọc đúng tiếng Việt? Xem ví dụ dưới đây.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> inputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] bytes </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> inputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(bytes)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(bytes, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Tại sao cách này lại hiệu quả?</p>
<p>Bởi vì chúng ta sử dụng lớp String để giải mã. Khi kiểm tra mã nguồn của <code>new String(byte bytes[], int offset, int length)</code>, chúng ta có thể thấy phương thức này có chức năng giải mã:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bytes[]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> offset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> length) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    checkBounds</span><span style="color:#E06C75;--shiki-dark:#E06C75">(bytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> offset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> length)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> StringCoding</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">decode</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(bytes, offset, length);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Khi tiếp tục theo dõi phương thức <code>StringCoding.decode()</code>, sẽ thấy nó gọi đến phương thức <code>defaultCharset()</code>, và sẽ thấy mã mặc định là <code>UTF-8</code>, như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Charset</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> defaultCharset</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (defaultCharset </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        synchronized</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Charset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">class</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (cs </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">                defaultCharset </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> cs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            else</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">                defaultCharset </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> forName</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"UTF-8"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    return</span><span style="color:#E06C75;--shiki-dark:#E06C75"> defaultCharset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">decode</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] ba</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> csn </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Charset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">defaultCharset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // use charset name decode() variant which provides caching.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> decode</span><span style="color:#E06C75;--shiki-dark:#E06C75">(csn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ba</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UnsupportedEncodingException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> x</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        warnUnsupportedCharset</span><span style="color:#E06C75;--shiki-dark:#E06C75">(csn)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong Java, các mã ký tự thông dụng bao gồm ASCII, ISO-8859-1, UTF-8, UTF-16, v.v. Trong đó, ASCII và ISO-8859-1 chỉ có thể biểu diễn một phần ký tự, trong khi UTF-8 và UTF-16 có thể biểu diễn tất cả các ký tự Unicode, bao gồm ký tự tiếng Việt.</p>
<p>Khi chúng ta sử dụng <code>new String(byte bytes[], int offset, int length)</code> để chuyển đổi Byte Stream thành chuỗi ký tự, Java sẽ dựa vào quy tắc UTF-8 để giải mã mỗi 3 byte thành một ký tự tiếng Việt, từ đó giải mã chính xác ký tự tiếng Việt.</p>
<p>Mặc dù Byte Stream cũng có thể giải quyết vấn đề lỗi hiển thị ký tự, nhưng không trực tiếp. Do đó, chúng ta có Character Stream, <code>chuyên dùng để xử lý file văn bản</code> (âm thanh, hình ảnh, video, v.v. là các file không phải văn bản).</p>
<p>Từ góc độ khác: <strong>Character Stream = Byte Stream + Bảng mã hóa</strong>.</p>
<h3>01. Character Input Stream (Reader)</h3>
<p><code>java.io.Reader</code> là <strong>lớp cha</strong> của <strong>character input stream</strong>, nó định nghĩa một số phương thức chung của character input stream:</p>
<ul>
<li><code>close()</code>：Đóng stream này và giải phóng các tài nguyên hệ thống liên quan.</li>
<li><code>read()</code>：Đọc một ký tự từ input stream.</li>
<li><code>read(char[] cbuf)</code>：Đọc một số ký tự từ input stream và lưu chúng vào mảng ký tự <code>cbuf</code>.</li>
</ul>
<p>FileReader là lớp con của Reader, được sử dụng để đọc dữ liệu ký tự từ tệp. Các đặc điểm chính của nó như sau:</p>
<ul>
<li>Có thể chỉ định đường dẫn tệp cần đọc thông qua hàm tạo.</li>
<li>Mỗi lần có thể đọc một hoặc nhiều ký tự.</li>
<li>Có thể đọc các ký tự trong tập ký tự Unicode và thực hiện chuyển đổi tập ký tự thông qua mã hóa ký tự được chỉ định.</li>
</ul>
<h4>1. Hàm tạo của FileReader</h4>
<ul>
<li><code>FileReader(File file)</code>：Tạo một FileReader mới, tham số là <strong>đối tượng File</strong>.</li>
<li><code>FileReader(String fileName)</code>：Tạo một FileReader mới, tham số là tên tệp.</li>
</ul>
<p>Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream bằng cách sử dụng đối tượng File</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream bằng cách sử dụng tên tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h4>2. Đọc dữ liệu ký tự với FileReader</h4>
<p>① <strong>Đọc ký tự</strong>：Phương thức <code>read</code>, mỗi lần có thể đọc một ký tự, trả về ký tự đã đọc (được chuyển thành kiểu int), khi đọc đến cuối tệp sẽ trả về <code>-1</code>. Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo đối tượng stream bằng cách sử dụng tên tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abc.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Định nghĩa biến để lưu dữ liệu</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc tuần tự</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) b);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>② <strong>Đọc ký tự với độ dài chỉ định</strong>：Phương thức <code>read(char[] cbuf, int off, int len)</code> đọc một số ký tự từ input stream và lưu chúng vào mảng ký tự. Trong đó, cbuf biểu thị mảng ký tự để lưu kết quả đọc, off biểu thị vị trí bắt đầu lưu kết quả, len biểu thị số ký tự cần đọc. Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> textFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"docs/约定.md"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Một ví dụ về FileReader</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// try-with-resources FileReader</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> reader </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(textFile)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // read(char[] cbuf)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> reader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">buffer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Trong ví dụ này, FileReader được sử dụng để đọc dữ liệu ký tự từ tệp và lưu chúng vào một mảng ký tự có kích thước 1024. Mỗi lần đọc len ký tự, sau đó sử dụng phương thức tạo của String để chuyển đổi chúng thành chuỗi và xuất ra.</p>
<p>FileReader đã triển khai interface AutoCloseable, do đó có thể sử dụng câu lệnh try-with-resources để tự động đóng tài nguyên, tránh các thao tác đóng tài nguyên thủ công phức tạp.</p>
<h3>02. Character Output Stream (Writer)</h3>
<p><code>java.io.Writer</code> là <strong>lớp cha</strong> của <strong>character output stream</strong>, nó cho phép ghi thông tin ký tự đã chỉ định vào đích, hãy xem một số phương thức chung mà nó định nghĩa:</p>
<ul>
<li><code>write(int c)</code>：Ghi một ký tự.</li>
<li><code>write(char[] cbuf)</code>：Ghi một mảng ký tự.</li>
<li><code>write(char[] cbuf, int off, int len)</code>：Ghi một phần của mảng ký tự, off là chỉ số bắt đầu, len là số lượng ký tự.</li>
<li><code>write(String str)</code>：Ghi một chuỗi.</li>
<li><code>write(String str, int off, int len)</code>：Ghi một phần của chuỗi, off chỉ vị trí bắt đầu của chuỗi con trong str, len chỉ độ dài của chuỗi con cần ghi.</li>
<li><code>flush()</code>：Làm mới bộ đệm của stream.</li>
<li><code>close()</code>：Đóng stream này, nhưng phải làm mới nó trước.</li>
</ul>
<p>Lớp <code>java.io.FileWriter</code> là lớp con của Writer, được sử dụng để ghi các ký tự vào tệp.</p>
<h4>1. Hàm tạo của FileWriter</h4>
<ul>
<li><code>FileWriter(File file)</code>：Tạo một FileWriter mới, tham số là đối tượng File cần ghi.</li>
<li><code>FileWriter(String fileName)</code>：Tạo một FileWriter mới, tham số là tên của tệp cần ghi.</li>
</ul>
<p>Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Cách thứ nhất: Tạo đối tượng stream bằng cách sử dụng đối tượng File</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"a.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Cách thứ hai: Tạo đối tượng stream bằng cách sử dụng tên tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h4>2. Ghi dữ liệu bằng FileWriter</h4>
<p>① <strong>Ghi ký tự</strong>: Phương thức <code>write(int b)</code> cho phép ghi ra một ký tự mỗi lần. Ví dụ mã như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">72</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi mã ASCII của ký tự 'H'</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">101</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi mã ASCII của ký tự 'e'</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">108</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi mã ASCII của ký tự 'l'</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">108</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi mã ASCII của ký tự 'l'</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">111</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi mã ASCII của ký tự 'o'</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ví dụ mã này, trước tiên tạo một đối tượng FileWriter <code>fw</code> và chỉ định đường dẫn tệp "output.txt" để ghi vào. Sau đó, sử dụng phương thức <code>fw.write()</code> để ghi các byte vào tệp, ở đây lần lượt ghi mã ASCII của các ký tự 'H', 'e', 'l', 'l', 'o'. Cuối cùng, trong khối <code>finally</code>, đóng đối tượng FileWriter để giải phóng tài nguyên.</p>
<p>Lưu ý rằng khi sử dụng phương thức <code>write(int b)</code>, chúng ta đang ghi một byte, không phải một ký tự. Nếu cần ghi ký tự, có thể sử dụng các phương thức <code>write(char cbuf[])</code> hoặc <code>write(String str)</code>.</p>
<p>② <strong>Ghi mảng ký tự</strong>: Phương thức <code>write(char[] cbuf)</code> cho phép ghi mảng ký tự chỉ định vào output stream. Ví dụ mã như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] chars </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span><span style="color:#98C379;--shiki-dark:#98C379">'H'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'e'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'l'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'l'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'o'</span><span style="color:#E06C75;--shiki-dark:#E06C75">}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(chars);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi mảng ký tự vào tệp</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>③ <strong>Ghi một phần mảng ký tự</strong>: Phương thức <code>write(char[] cbuf, int off, int len)</code> cho phép ghi một phần mảng ký tự chỉ định vào output stream. Ví dụ mã như sau (phần lặp lại không viết lại, tham khảo phần trên):</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] chars </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span><span style="color:#98C379;--shiki-dark:#98C379">'H'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'e'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'l'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'l'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'o'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> ','</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> ' '</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'W'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'o'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'r'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'l'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> 'd'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> '!'</span><span style="color:#E06C75;--shiki-dark:#E06C75">}</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(chars, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi 5 ký tự đầu tiên của mảng ký tự vào tệp</span></span></code></pre>
</div><p>Sử dụng phương thức <code>fw.write()</code> để ghi 5 ký tự đầu tiên của mảng ký tự vào tệp.</p>
<p>④ <strong>Ghi chuỗi</strong>: Phương thức <code>write(String str)</code> cho phép ghi chuỗi chỉ định vào output stream. Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Hello, World!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi chuỗi vào tệp</span></span></code></pre>
</div><p>⑤ <strong>Ghi một phần chuỗi</strong>: Phương thức <code>write(String str, int off, int len)</code> cho phép ghi một phần chuỗi chỉ định vào output stream. Ví dụ mã như sau (dạng try-with-resources):</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Hello, World!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(str, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi 5 ký tự đầu tiên của chuỗi vào tệp</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><blockquote>
<p>【Lưu ý】Nếu không đóng tài nguyên, dữ liệu chỉ được lưu vào bộ đệm và chưa được lưu vào tệp.</p>
</blockquote>
<h4>3. Đóng và làm mới (close và flush)</h4>
<p>Vì FileWriter có bộ đệm bên trong (ByteBuffer), nếu không đóng output stream, sẽ không thể ghi ký tự vào tệp.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630221049.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Tuy nhiên, nếu đóng stream, sẽ không thể tiếp tục ghi dữ liệu. Nếu muốn ghi dữ liệu mà vẫn có thể tiếp tục sử dụng stream, ta cần phương thức <code>flush</code>.</p>
<ul>
<li><code>flush</code>: Làm mới bộ đệm, cho phép tiếp tục sử dụng stream.</li>
<li><code>close</code>: Làm mới bộ đệm trước, sau đó thông báo hệ thống giải phóng tài nguyên. Sau khi gọi, không thể sử dụng lại stream.</li>
</ul>
<p>Phương thức <code>flush</code> khá thú vị, hãy xem đoạn mã sau để hiểu thêm:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nguồn, là stream nhập (stream đọc) đọc từ tệp a.txt</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abc.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Tệp a.txt phải tồn tại, nếu không sẽ ném ra ngoại lệ FileNotFoundException</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đích, là output stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"b.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Hệ thống sẽ tự động tạo tệp b.txt vì đây là output stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(len);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chú ý ở đây không đóng stream bằng phương thức close, trong phát triển không nên làm như vậy, nhưng để hiểu rõ hơn về tác dụng của flush</span></span></code></pre>
</div><p>Kết quả chạy chương trình sẽ như thế nào? Đáp án là tệp b.txt vẫn trống, không có gì.</p>
<p>Nguyên nhân đã được đề cập trước đó. <strong>Lập trình là như vậy, không thực hành thì sẽ không bao giờ học được</strong>! Vì vậy, hãy thực hành nhiều hơn.</p>
<p>Thêm ba dòng mã sau vào đoạn mã trên, tệp <code>b.txt</code> sẽ được sao chép dữ liệu từ tệp nguồn:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Phương thức <code>flush()</code> có nghĩa là làm sạch bộ đệm, được sử dụng để làm sạch stream dữ liệu trong bộ đệm. Khi thực hiện các thao tác stream, dữ liệu được đọc vào bộ nhớ trước, sau đó mới ghi vào tệp.</p>
<p>Bạn có thể thử với ví dụ mã sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng tên tệp để tạo đối tượng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fw.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu, sau đó flush</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'a'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi ký tự đầu tiên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'b'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tiếp tục ghi ký tự thứ hai, ghi thành công</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu, sau đó close</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'c'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Ghi ký tự đầu tiên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'d'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Tiếp tục ghi ký tự thứ hai, lỗi java.io.IOException: Stream closed</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Lưu ý, dù phương thức <code>flush</code> đã ghi dữ liệu ra, cuối cùng vẫn cần gọi phương thức <code>close</code> để giải phóng tài nguyên hệ thống. Tất nhiên, bạn cũng có thể sử dụng cách try-with-resources.</p>
<h4>4. FileWriter viết tiếp và xuống dòng</h4>
<p><strong>Viết tiếp và xuống dòng</strong>: Thao tác tương tự như <a href="/programming/java/IO/programming/java/io/stream.html" target="_blank">FileOutputStream</a>, hãy xem đoạn mã dưới đây:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng tên tệp để tạo đối tượng stream, có thể viết tiếp dữ liệu</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fw.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">     </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi chuỗi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"xin chào"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi xuống dòng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\r\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi chuỗi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"các bạn"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Kết quả đầu ra như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>xin chào</span></span>
<span class="line"><span>các bạn</span></span></code></pre>
</div><h4>5. Sao chép tệp văn bản</h4>
<p>Đoạn mã dưới đây thực hiện việc sao chép tệp văn bản:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.io.FileReader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.io.FileWriter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.io.IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> CopyFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Tạo đối tượng stream đầu vào</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fr</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"aa.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu tệp không tồn tại sẽ ném ra ngoại lệ java.io.FileNotFoundException</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Tạo đối tượng stream đầu ra</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"copyaa.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        /* Các công việc của stream đầu ra:</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">         * 1. Gọi tài nguyên hệ thống để tạo một tệp</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">         * 2. Tạo đối tượng stream đầu ra</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">         * 3. Chỉ định đối tượng stream đầu ra đến tệp        </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">         */</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Sao chép tệp văn bản, mỗi lần đọc một ký tự</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        copyMethod1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(fr, fw);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Sao chép tệp văn bản, mỗi lần đọc một mảng ký tự</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        copyMethod2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(fr, fw);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> copyMethod1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ((ch </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc dữ liệu</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(ch); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> copyMethod2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75">chs</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">];</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(chs)) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) { </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc dữ liệu</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(chs, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len); </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630220036.png" type="image/png"/>
    </item>
    <item>
      <title>Java IO Classification</title>
      <link>https://vanhung4499.github.io/programming/java/IO/classification.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/classification.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Java IO Classification</source>
      <description>Phân loại IO Nhìn này, tôi chỉ phân loại IO theo cách truyền dẫn đơn giản mà đã ra đủ thứ đây! image.pngimage.png Học IO trong Java lúc đầu cũng thấy đầu đau, đầy là các lớp, có...</description>
      <category>java</category>
      <pubDate>Sun, 30 Jun 2024 16:14:55 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Nhìn này, tôi chỉ phân loại IO theo cách truyền dẫn đơn giản mà đã ra đủ thứ đây!</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630135523.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Học IO trong Java lúc đầu cũng thấy đầu đau, đầy là các lớp, có lẽ là nhiều lớp nhất trong tất cả các gói Java, một lúc là Input, một lúc là Output, một lúc là Reader, một lúc là Writer, thực sự không biết các nhà thiết kế Java nghĩ gì.</p>
<p>Chủ yếu là do các nhà thiết kế Java đã xem xét rất nhiều, vì vậy IO mang đến cho người ta cảm giác lộn xộn, tôi sẽ sắp xếp lại cho bạn.</p>
<h3>00. Giới thiệu sơ lược về Java IO</h3>
<p>IO, tức là Input (nhập) và Output (xuất), đề cập đến việc truyền dữ liệu giữa ứng dụng và các thiết bị ngoại vi, các thiết bị ngoại vi phổ biến bao gồm tệp, đường ống và kết nối mạng.</p>
<p>Trong Java, IO được xử lý thông qua stream. Vậy stream là gì?</p>
<p>Stream là một khái niệm trừu tượng, là một chuỗi dữ liệu (kí tự hoặc byte) được truyền thông tin theo cách vào trước ra trước (FIFO - First In First Out).</p>
<p>Khi chương trình cần đọc dữ liệu, nó sẽ mở một stream đến nguồn dữ liệu. Nguồn dữ liệu này có thể là tệp, bộ nhớ hoặc kết nối mạng. Tương tự, khi chương trình cần ghi dữ liệu, nó sẽ mở một stream đến đích. Bạn có thể tưởng tượng dữ liệu giống như "dòng chảy" trong stream đó.</p>
<p>Thông thường, các đặc điểm của stream bao gồm:</p>
<ul>
<li><strong>Vào trước ra trước (FIFO)</strong>: Dữ liệu được ghi vào stream đầu tiên sẽ được đọc ra từ stream đầu tiên.</li>
<li><strong>Truy cập tuần tự</strong>: Có thể ghi một chuỗi byte vào stream, khi đọc ra cũng sẽ đọc theo thứ tự đã ghi, không thể truy cập ngẫu nhiên vào dữ liệu ở giữa. (Ngoại trừ RandomAccessFile)</li>
<li><strong>Chỉ đọc hoặc chỉ ghi</strong>: Mỗi stream chỉ có thể là stream đầu vào hoặc đầu ra, không thể có cả hai chức năng cùng một lúc. stream đầu vào chỉ có thể thực hiện thao tác đọc, còn stream đầu ra chỉ có thể thực hiện thao tác ghi. Trong một kênh truyền dữ liệu, nếu cần cả ghi và đọc dữ liệu, thì cần phải cung cấp hai stream riêng biệt.</li>
</ul>
<h3>01. Phân loại theo phương thức truyền tải</h3>
<p>Hãy bắt đầu từ sơ đồ ở đầu bài.</p>
<p>Có hai phương thức truyền tải: byte và ký tự. Đầu tiên, cần hiểu rõ sự khác biệt giữa byte và ký tự, đúng không?</p>
<p>Byte là đơn vị đo lường dung lượng lưu trữ trong máy tính, thường thì một byte có 8 bit.</p>
<p>Ký tự có thể là chữ cái, số hoặc ký hiệu mà máy tính sử dụng, ví dụ như A, 1, $.</p>
<p>Thông thường, một chữ cái hoặc một ký tự chiếm một byte, một ký tự Việt chiếm hai byte.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630165013.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Cụ thể, còn phụ thuộc vào mã hóa ký tự, ví dụ như trong mã hóa UTF-8, một chữ cái tiếng Anh (không phân biệt chữ hoa và chữ thường) chiếm một byte, một ký tự Việt chiếm hai byte. Trong mã hóa Unicode, một chữ cái tiếng Anh chiếm một byte, một ký tự Trung Quốc chiếm hai byte.</p>
<p>Hiểu sự khác biệt giữa byte và ký tự, sau đó xem xét Byte Stream và character stream sẽ dễ dàng hơn nhiều.</p>
<p>Byte Stream dùng để xử lý các tệp nhị phân, chẳng hạn như hình ảnh, MP3, video.</p>
<p>character stream dùng để xử lý các tệp văn bản. Tệp văn bản có thể được coi là một loại tệp nhị phân đặc biệt, nhưng đã được mã hóa để dễ đọc hơn.</p>
<p>Nói cách khác, Byte Stream có thể xử lý mọi tệp, trong khi character stream chỉ có thể xử lý văn bản.</p>
<p>Mặc dù có rất nhiều lớp IO, nhưng cốt lõi là 4 lớp trừu tượng: <code>InputStream</code>, <code>OutputStream</code>, <code>Reader</code>, <code>Writer</code>.</p>
<p><strong>(Một điểm tuyệt vời của trừu tượng hóa)</strong></p>
<p>Mặc dù có rất nhiều phương thức IO, nhưng cốt lõi chỉ có 2: <code>read</code> và <code>write</code>.</p>
<p><strong>Lớp <code>InputStream</code></strong></p>
<ul>
<li><code>int read()</code>: Đọc dữ liệu</li>
<li><code>int read(byte b[], int off, int len)</code>: Đọc từ vị trí <code>off</code>, đọc <code>len</code> byte và đặt vào mảng <code>b</code></li>
<li><code>long skip(long n)</code>: Bỏ qua số byte chỉ định</li>
<li><code>int available()</code>: Trả về số byte có thể đọc</li>
<li><code>void close()</code>: Đóng stream, giải phóng tài nguyên</li>
</ul>
<p><strong>Lớp <code>OutputStream</code></strong></p>
<ul>
<li><code>void write(int b)</code>: Ghi một byte, mặc dù tham số là loại <code>int</code>, chỉ có 8 bit thấp sẽ được ghi, 24 bit cao sẽ bị bỏ qua (điều này sẽ được giải thích sau)</li>
<li><code>void write(byte b[], int off, int len)</code>: Ghi các byte từ mảng <code>b</code> từ vị trí <code>off</code>, dài <code>len</code></li>
<li><code>void flush()</code>: Bắt buộc làm trống, ghi dữ liệu từ bộ đệm ra</li>
<li><code>void close()</code>: Đóng stream</li>
</ul>
<p><strong>Lớp <code>Reader</code></strong></p>
<ul>
<li><code>int read()</code>: Đọc một ký tự</li>
<li><code>int read(char cbuf[], int off, int len)</code>: Đọc từ vị trí <code>off</code>, đọc <code>len</code> ký tự và đặt vào mảng <code>b</code></li>
<li><code>long skip(long n)</code>: Bỏ qua số ký tự chỉ định</li>
<li><code>int ready()</code>: Kiểm tra xem có thể đọc không</li>
<li><code>void close()</code>: Đóng stream</li>
</ul>
<p><strong>Lớp <code>Writer</code></strong></p>
<ul>
<li><code>void write(int c)</code>: Ghi một ký tự</li>
<li><code>void write(char cbuf[], int off, int len)</code>: Ghi các ký tự từ mảng <code>cbuf</code> từ vị trí <code>off</code>, dài <code>len</code></li>
<li><code>void flush()</code>: Bắt buộc làm trống, ghi dữ liệu từ bộ đệm ra</li>
<li><code>void close()</code>: Đóng stream</li>
</ul>
<p>Hiểu các phương thức trên, bạn đã nắm được linh hồn của IO.</p>
<p>Sự khác biệt giữa Byte Stream và character stream:</p>
<ul>
<li>Byte Stream thường dùng để xử lý các tệp hình ảnh, video, âm thanh, PPT, Word. character stream thường dùng để xử lý các tệp văn bản thuần túy, như tệp TXT, nhưng không thể xử lý các tệp hình ảnh, video. Nói một câu đơn giản: Byte Stream có thể xử lý mọi tệp, còn character stream chỉ có thể xử lý văn bản thuần túy.</li>
<li>Byte Stream bản thân không có bộ đệm, Buffered Byte Stream có bộ đệm cải thiện hiệu suất rất nhiều. Trong khi đó, character stream bản thân đã có bộ đệm, nên Bufferd character stream cải thiện hiệu suất không đáng kể.</li>
</ul>
<p>Ví dụ viết tệp, chúng ta sẽ xem xét mã nguồn của character stream, phát hiện thấy có sử dụng bộ đệm:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khai báo một mảng kiểu char, để ghi vào stream xuất</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] writeBuffer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Định nghĩa kích thước của mảng writeBuffer, phải &gt;= 1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> WRITE_BUFFER_SIZE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1024</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một phần của chuỗi đã cho vào stream xuất</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> write</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> str</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len) throws IOException {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Sử dụng từ khóa synchronized để đồng bộ hóa đoạn mã, đảm bảo an toàn stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    synchronized</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (lock) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        char</span><span style="color:#E06C75;--shiki-dark:#E06C75"> cbuf[]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Nếu len &lt;= WRITE_BUFFER_SIZE, thì sử dụng mảng writeBuffer để ghi</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> WRITE_BUFFER_SIZE) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Nếu writeBuffer là null, thì tạo một mảng char mới có kích thước WRITE_BUFFER_SIZE</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (writeBuffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">==</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">                writeBuffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[WRITE_BUFFER_SIZE]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">            }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">            cbuf </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> writeBuffer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {    </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Nếu len &gt; WRITE_BUFFER_SIZE, thì không phân bổ bộ đệm lớn vĩnh viễn</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Tạo một mảng char mới có kích thước len</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">            cbuf </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[len]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Sao chép một phần của str (từ off, dài len) vào mảng cbuf</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        str</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getChars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(off, (off </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> len), cbuf, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        // Ghi dữ liệu từ mảng cbuf vào stream xuất</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        write</span><span style="color:#E06C75;--shiki-dark:#E06C75">(cbuf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đoạn mã này là phương thức <code>write</code> của lớp <code>OutputStreamWriter</code> trong thư viện IO của Java, có thể thấy kích thước của bộ đệm là 1024 ký tự.</p>
<p>Chúng ta hãy so sánh mã của character stream và Byte Stream khi viết tệp, sự khác biệt rất nhỏ.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Byte Stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"input.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// character stream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"input.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">     FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"output.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        fw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>02. Phân loại theo đối tượng thao tác</h3>
<p>Hãy suy nghĩ kỹ, IO không phải là viết tắt của Input (Nhập) và Output (Xuất) sao:</p>
<ul>
<li>Input: Đọc dữ liệu từ bên ngoài vào bộ nhớ, ví dụ như đọc tệp từ ổ cứng vào bộ nhớ, đọc dữ liệu từ mạng vào bộ nhớ, v.v.</li>
<li>Output: Ghi dữ liệu từ bộ nhớ ra bên ngoài, ví dụ như ghi dữ liệu từ bộ nhớ vào tệp, xuất dữ liệu từ bộ nhớ ra mạng, v.v.</li>
</ul>
<p>Tất cả các chương trình, khi thực thi, đều hoạt động trên bộ nhớ. Một khi tắt máy, dữ liệu trong bộ nhớ sẽ mất đi. Nếu muốn lưu trữ lâu dài, cần phải xuất dữ liệu từ bộ nhớ ra bên ngoài, ví dụ như tệp.</p>
<p>Thao tác tệp là thao tác điển hình nhất và cũng là thao tác thường xuyên nhất trong IO. Bạn có thể suy nghĩ theo một góc độ khác, ví dụ như phân loại IO theo đối tượng thao tác, IO có thể được phân loại thành: file, array, pipe, basic data types, buffered, print, bject serialization/deserialization, và conversion, v.v.</p>
<figure><img src="https://ucc.alicdn.com/pic/developer-ecology/7afb2f6df4234d30bfb92517047e1c31.png" alt="Phân loại theo đối tượng thao tác" tabindex="0" loading="lazy"><figcaption>Phân loại theo đối tượng thao tác</figcaption></figure>
<h4><strong>1) File</strong></h4>
<p>File Stream là stream thao tác trực tiếp trên tệp, có thể chia thành Byte Stream (FileInputStream và FileOutputStream) và character stream (FileReader và FileWriter).</p>
<p>Ví dụ về FileInputStream:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khai báo một biến kiểu int b, dùng để lưu trữ byte được đọc vào</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileInputStream, dùng để đọc dữ liệu từ tệp fis.txt</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fis.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc tuần tự dữ liệu từ tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Chuyển byte đọc được thành ký tự ASCII tương ứng và in ra màn hình</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)b);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng đối tượng FileInputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fis1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Ví dụ về FileOutputStream:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileOutputStream, dùng để ghi dữ liệu vào tệp fos.txt</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fos.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu vào tệp, ở đây ghi mảng byte tương ứng với chuỗi "Tom"</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng đối tượng FileOutputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Ví dụ về FileReader:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khai báo một biến kiểu int b, dùng để lưu trữ ký tự được đọc vào</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileReader, dùng để đọc dữ liệu từ tệp read.txt</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileReader </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"read.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc tuần tự dữ liệu từ tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fileReader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Chuyển ký tự đọc được thành kiểu char và in ra màn hình</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)b);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng đối tượng FileReader, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileReader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Ví dụ về FileWriter:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileWriter, dùng để ghi dữ liệu vào tệp fw.txt</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileWriter </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fw.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chuyển chuỗi "Tom" thành mảng ký tự</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] chars </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toCharArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu vào tệp, ở đây ghi tất cả các ký tự trong mảng chars</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileWriter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(chars, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">chars</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng đối tượng FileWriter, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileWriter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>File Stream cũng có thể được sử dụng để tạo, xóa, đổi tên tệp, v.v. Tham số thứ hai của hàm tạo FileOutputStream và FileWriter có thể chỉ định việc thêm dữ liệu vào cuối tệp.</p>
<p>Ví dụ mã:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">createNewFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tạo tệp thành công"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tệp đã tồn tại"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Xóa tệp</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">delete</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Xóa tệp thành công"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Xóa tệp thất bại"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đổi tên tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> oldFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"old.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> newFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"new.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">oldFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">renameTo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(newFile)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đổi tên tệp thành công"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đổi tên tệp thất bại"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Khi bạn đã nắm vững việc nhập và xuất tệp, các thao tác khác cũng sẽ trở nên dễ dàng hơn, vì chúng không có sự khác biệt quá lớn.</p>
<h4><strong>2) Array (Bộ nhớ)</strong></h4>
<p>Thông thường, đối với các thao tác đọc và ghi tệp, việc sử dụng file stream kết hợp với buffered stream là đủ. Tuy nhiên, để nâng cao hiệu quả, việc đọc và ghi tệp thường xuyên không phải là ý tưởng tốt. Vì vậy, array stream (còn gọi là stream bộ nhớ) ra đời.</p>
<p>Ví dụ về ByteArrayInputStream:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng ByteArrayInputStream, dùng để đọc dữ liệu từ mảng byte</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">InputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> is </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ByteArrayInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">                "Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StandardCharsets</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UTF_8</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Định nghĩa một mảng byte để lưu trữ dữ liệu được đọc vào</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] flush </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Định nghĩa một biến để lưu trữ số byte được đọc vào mỗi lần</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc tuần tự dữ liệu từ mảng byte và in ra màn hình</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> !=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> is</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(flush)</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Chuyển đổi byte đọc được thành chuỗi tương ứng và in ra màn hình</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(flush, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng stream đầu vào, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">is</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ví dụ về ByteArrayOutputStream:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng ByteArrayOutputStream, dùng để ghi dữ liệu vào bộ nhớ đệm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ByteArrayOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ByteArrayOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Định nghĩa một mảng byte để lưu trữ dữ liệu cần ghi vào bộ nhớ đệm</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] info </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu vào bộ nhớ đệm, ở đây ghi tất cả byte trong mảng info</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(info, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chuyển đổi dữ liệu trong bộ nhớ đệm thành mảng byte</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] dest </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toByteArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng đối tượng ByteArrayOutputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Array stream có thể được sử dụng để đọc và ghi dữ liệu trong bộ nhớ, ví dụ như lưu trữ dữ liệu trong mảng byte để nén, mã hóa, hoặc tuần tự hóa. Ưu điểm của nó là không cần tạo tệp tạm thời, có thể nâng cao hiệu suất của chương trình. Tuy nhiên, array stream cũng có nhược điểm là chỉ có thể lưu trữ một lượng dữ liệu giới hạn, nếu dữ liệu quá lớn sẽ dẫn đến tràn bộ nhớ.</p>
<h4><strong>3) Pipe</strong></h4>
<p>Piped trong Java khác với pipe trong Unix/Linux. Trong Unix/Linux, các tiến trình khác nhau có thể giao tiếp với nhau qua pipe, nhưng trong Java, các bên giao tiếp phải nằm trong cùng một tiến trình, tức là trong cùng một JVM. Pipe cung cấp khả năng giao tiếp giữa các luồng trong cùng một tiến trình.</p>
<p>Một luồng có thể ghi dữ liệu vào <code>PipedOutputStream</code> và luồng khác có thể đọc dữ liệu từ <code>PipedInputStream</code> liên kết với nó.</p>
<p>Ví dụ về <code>PipedOutputStream</code> và <code>PipedInputStream</code>:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng PipedOutputStream và một đối tượng PipedInputStream</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> PipedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pipedOutputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> PipedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> PipedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pipedInputStream </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> PipedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(pipedOutputStream)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một luồng, ghi dữ liệu vào PipedOutputStream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75"> thread1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Runnable</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Chuyển đổi chuỗi "Tom" thành mảng byte và ghi vào PipedOutputStream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            pipedOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">StandardCharsets</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">UTF_8</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">));</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Đóng PipedOutputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            pipedOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">})</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một luồng, đọc dữ liệu từ PipedInputStream và in ra màn hình</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75"> thread2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Runnable</span><span style="color:#E06C75;--shiki-dark:#E06C75">() {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Định nghĩa một mảng byte để lưu trữ dữ liệu được đọc vào</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            byte</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75">flush</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">];</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Định nghĩa một biến để lưu trữ số byte được đọc vào mỗi lần</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Đọc tuần tự dữ liệu từ mảng byte và in ra màn hình</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">            while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> !=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> pipedInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(flush))) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">                // Chuyển đổi byte đọc được thành chuỗi tương ứng và in ra màn hình</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">                System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(flush, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len));</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Đóng PipedInputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            pipedInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">})</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khởi động thread1 và thread2</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">thread1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">thread2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sử dụng pipe có thể thực hiện việc truyền dữ liệu giữa các luồng khác nhau, có thể được sử dụng để giao tiếp giữa các luồng, truyền dữ liệu, v.v. Tuy nhiên, pipe cũng có một số hạn chế, chẳng hạn như chỉ có thể sử dụng giữa các luồng trong cùng một JVM và không thể vượt qua các tiến trình JVM khác nhau.</p>
<h4><strong>4) Kiểu dữ liệu cơ bản</strong></h4>
<p>Stream nhập xuất kiểu dữ liệu cơ bản là một byte stream, stream này không chỉ có thể đọc và ghi byte và ký tự, mà còn có thể đọc và ghi các kiểu dữ liệu cơ bản.</p>
<p><code>DataInputStream</code> cung cấp một loạt các phương thức để đọc các kiểu dữ liệu cơ bản:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng DataInputStream, dùng để đọc dữ liệu từ tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">DataInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> dis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> DataInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"das.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc một byte và chuyển đổi nó thành kiểu byte</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readByte</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc hai byte và chuyển đổi chúng thành kiểu short</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">short</span><span style="color:#E06C75;--shiki-dark:#E06C75"> s </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readShort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc bốn byte và chuyển đổi chúng thành kiểu int</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc tám byte và chuyển đổi chúng thành kiểu long</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> l </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLong</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc bốn byte và chuyển đổi chúng thành kiểu float</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">float</span><span style="color:#E06C75;--shiki-dark:#E06C75"> f </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readFloat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc tám byte và chuyển đổi chúng thành kiểu double</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">double</span><span style="color:#E06C75;--shiki-dark:#E06C75"> d </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readDouble</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc một byte và chuyển đổi nó thành kiểu boolean</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bb </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readBoolean</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc hai byte và chuyển đổi chúng thành kiểu char</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ch </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readChar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng DataInputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">dis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>DataOutputStream</code> cung cấp một loạt các phương thức để ghi các kiểu dữ liệu cơ bản:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng DataOutputStream, dùng để ghi dữ liệu vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">DataOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> das </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> DataOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"das.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu byte vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeByte</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu short vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeShort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu int vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu long vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeLong</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">10000L</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu float vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeFloat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">12.34F</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu double vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeDouble</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">12.56</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu boolean vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeBoolean</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi một dữ liệu kiểu char vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeChar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng DataOutputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">das</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Ngoài <code>DataInputStream</code> và <code>DataOutputStream</code>, Java IO còn cung cấp một số lớp luồng khác để đọc và ghi các kiểu dữ liệu cơ bản và chuỗi, bao gồm <code>ObjectInputStream</code> và <code>ObjectOutputStream</code> (dùng để đọc và ghi đối tượng).</p>
<p>Ví dụ mã:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] args) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> oos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"person.dat"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Person</span><span style="color:#E06C75;--shiki-dark:#E06C75"> p </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Person</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 20</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        oos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(p);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ois </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"person.dat"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Person</span><span style="color:#E06C75;--shiki-dark:#E06C75"> p </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (Person) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ois</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(p);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75"> | </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ClassNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Mã trên tạo ra một đối tượng <code>Person</code>, ghi nó vào tệp tin, sau đó đọc đối tượng từ tệp tin và in ra màn hình console.</p>
<h4><strong>5) Buffer</strong></h4>
<p>CPU rất nhanh, nó nhanh hơn bộ nhớ 100 lần, nhanh hơn đĩa cứng hàng triệu lần. Điều đó có nghĩa là, tương tác giữa chương trình và bộ nhớ sẽ rất nhanh, trong khi tương tác với đĩa cứng sẽ tương đối chậm, điều này sẽ dẫn đến vấn đề về hiệu suất.</p>
<p>Để giảm tương tác giữa chương trình và đĩa cứng, nâng cao hiệu suất chương trình, buffered stream đã được giới thiệu, bao gồm các lớp có tiền tố "Buffer" như BufferedInputStream, BufferedOutputStream, BufferedReader, BufferedWriter.</p>
<p>Buffered stream thiết lập một vùng đệm trong bộ nhớ, chỉ khi vùng đệm lưu trữ đủ dữ liệu cần thao tác thì mới tương tác với bộ nhớ hoặc đĩa cứng. Nói đơn giản, đọc/ghi nhiều hơn một chút mỗi lần, giảm số lần đọc/ghi, nhờ đó nâng cao hiệu suất chương trình.<br>
Dưới đây là một ví dụ sử dụng <code>BufferedInputStream</code> để đọc tệp tin:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng BufferedInputStream, dùng để đọc dữ liệu từ tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"data.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một mảng byte làm vùng đệm</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc dữ liệu từ tệp tin và lưu trữ vào vùng đệm</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bytesRead</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((bytesRead </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> bis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Xử lý dữ liệu trong vùng đệm</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Ở đây chỉ đơn giản là chuyển đổi mảng byte đã đọc thành chuỗi và in ra</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, bytesRead));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng BufferedInputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong đoạn mã trên, trước tiên tạo một đối tượng <code>BufferedInputStream</code> để đọc dữ liệu từ tệp tin. Sau đó tạo một mảng byte làm vùng đệm, mỗi lần đọc dữ liệu sẽ lưu trữ dữ liệu vào vùng đệm. Quá trình đọc dữ liệu được thực hiện thông qua vòng lặp <code>while</code>, mỗi lần đọc dữ liệu xong sẽ xử lý dữ liệu trong vùng đệm. Cuối cùng đóng <code>BufferedInputStream</code>, giải phóng tài nguyên.</p>
<p>Dưới đây là một ví dụ sử dụng <code>BufferedOutputStream</code> để ghi vào tệp tin:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng BufferedOutputStream, dùng để ghi dữ liệu vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"data.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một mảng byte làm vùng đệm</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "hello world!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Làm mới vùng đệm, ghi dữ liệu từ vùng đệm vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng BufferedOutputStream, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong đoạn mã trên, đầu tiên tạo một đối tượng <code>BufferedOutputStream</code> để ghi dữ liệu vào tệp tin. Sau đó tạo một mảng byte làm vùng đệm và ghi dữ liệu vào vùng đệm. Quá trình ghi dữ liệu được thực hiện thông qua phương thức <code>write()</code>, truyền mảng byte làm tham số cho phương thức <code>write()</code>. Cuối cùng, thông qua phương thức <code>flush()</code> ghi dữ liệu từ vùng đệm vào tệp tin, và thông qua phương thức <code>close()</code> đóng <code>BufferedOutputStream</code>, giải phóng tài nguyên.</p>
<p>Dưới đây là một ví dụ sử dụng <code>BufferedReader</code> để đọc tệp tin:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng BufferedReader, dùng để đọc dữ liệu từ tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> br </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"data.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc dữ liệu từ tệp tin và lưu trữ vào chuỗi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((line </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Xử lý dữ liệu đã đọc</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Ở đây chỉ đơn giản là in ra từng dòng chuỗi đã đọc</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(line);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng BufferedReader, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">br</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Trong đoạn mã trên, trước tiên tạo một đối tượng <code>BufferedReader</code> để đọc dữ liệu từ tệp tin. Sau đó sử dụng phương thức <code>readLine()</code> để đọc dữ liệu từ tệp tin, mỗi lần đọc một dòng dữ liệu và lưu trữ vào một chuỗi. Quá trình đọc dữ liệu được thực hiện thông qua vòng lặp <code>while</code>.</p>
<p>Dưới đây là một ví dụ sử dụng <code>BufferedWriter</code> để ghi vào tệp tin:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng BufferedWriter, dùng để ghi dữ liệu vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">BufferedWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> bw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> BufferedWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"data.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "abcdef"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(data);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Làm mới vùng đệm, ghi dữ liệu từ vùng đệm vào tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">flush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng BufferedWriter, giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">bw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Trong đoạn mã trên, trước tiên tạo một đối tượng <code>BufferedWriter</code> để ghi dữ liệu vào tệp tin. Sau đó sử dụng phương thức <code>write()</code> để ghi dữ liệu vào vùng đệm. Quá trình ghi dữ liệu tương tự như sử dụng lớp <code>FileWriter</code>. Lưu ý rằng khi sử dụng <code>BufferedWriter</code> để ghi dữ liệu, dữ liệu sẽ được ghi vào vùng đệm trước, chỉ khi vùng đệm đầy hoặc gọi phương thức <code>flush()</code> thì dữ liệu trong vùng đệm mới được ghi vào tệp tin.</p>
<p>Cuối cùng, thông qua phương thức <code>flush()</code> ghi dữ liệu từ vùng đệm vào tệp tin, và thông qua phương thức <code>close()</code> đóng <code>BufferedWriter</code>, giải phóng tài nguyên.</p>
<p>Sử dụng buffered stream có thể nâng cao hiệu suất đọc ghi, giảm số lần đọc ghi đĩa hoặc mạng một cách thường xuyên, từ đó nâng cao hiệu suất chương trình. Tuy nhiên, khi sử dụng buffered stream cần chú ý kích thước của vùng đệm và thời điểm làm mới vùng đệm để tránh mất dữ liệu hoặc dữ liệu không đầy đủ.</p>
<h4><strong>6) Print</strong></h4>
<p>Print stream của Java là một tập hợp các lớp dùng để in dữ liệu ra ngoài, bao gồm hai lớp <code>PrintStream</code> và <code>PrintWriter</code>.</p>
<p>Có lẽ print stream là thứ mà lập trình viên Java sử dụng nhiều nhất trong suốt sự nghiệp của họ: <code>System.out</code> thực ra trả về một đối tượng <code>PrintStream</code>, có thể dùng để in ra các loại đối tượng khác nhau.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hello world！"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p><code>PrintStream</code> cuối cùng sẽ xuất ra dữ liệu dạng byte, trong khi <code>PrintWriter</code> thì mở rộng từ interface <code>Writer</code>, vì vậy các phương thức <code>print()/println()</code> của nó cuối cùng sẽ xuất ra dữ liệu dạng ký tự. Việc sử dụng <code>PrintWriter</code> gần như tương tự với <code>PrintStream</code>.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">StringWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> StringWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">PrintWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pw </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> PrintWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(buffer)) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    pw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abcd"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">buffer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span></code></pre>
</div><p>Trong ví dụ trên, đầu tiên tạo một <code>StringWriter</code> để lưu trữ dữ liệu dạng chuỗi. Sau đó, sử dụng <code>PrintWriter</code> để viết dữ liệu vào <code>StringWriter</code>. Cuối cùng, dữ liệu được in ra màn hình bằng cách chuyển đổi <code>StringWriter</code> thành chuỗi và in ra bằng <code>System.out.println()</code>.</p>
<h4><strong>7) Object Serialize/Deserialize</strong></h4>
<p>Tuần tự hóa bản chất là chuyển một đối tượng Java thành mảng byte, sau đó có thể lưu trữ nó vào file hoặc truyền qua mạng đến máy từ xa.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng ByteArrayOutputStream buffer, dùng để lưu trữ dữ liệu</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">ByteArrayOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ByteArrayOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng câu lệnh try-with-resources để tạo một đối tượng ObjectOutputStream output, và liên kết nó với buffer</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> output </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(buffer)) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Sử dụng phương thức writeUTF() để ghi chuỗi "abcdef" vào bộ đệm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    output</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeUTF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"abcdef"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng phương thức toByteArray() để chuyển đổi dữ liệu trong bộ đệm thành mảng byte và xuất ra màn hình điều khiển</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Arrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">buffer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toByteArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()));</span></span></code></pre>
</div><p>Đối ứng với tuần tự hóa, có phản tuần tự hóa, tức là quá trình chuyển đổi mảng byte thành đối tượng Java.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> input </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> ObjectInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Person.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)))) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> s </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> input</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readUTF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
</div><p>Đoạn mã này chủ yếu sử dụng các lớp <code>ByteArrayOutputStream</code> và <code>ObjectOutputStream</code> của Java để ghi chuỗi "abcdef" vào một bộ đệm mảng byte và chuyển đổi dữ liệu trong bộ đệm thành mảng byte và xuất ra màn hình điều khiển.</p>
<p>Quá trình thực thi cụ thể như sau:</p>
<ul>
<li>Tạo một đối tượng <code>ByteArrayOutputStream</code> buffer để lưu trữ dữ liệu.</li>
<li>Sử dụng câu lệnh try-with-resources để tạo một đối tượng <code>ObjectOutputStream</code> output và liên kết nó với buffer.</li>
<li>Sử dụng phương thức <code>writeUTF()</code> để ghi chuỗi "abcdef" vào bộ đệm.</li>
<li>Khi câu lệnh try-with-resources hoàn thành, nó sẽ tự động gọi phương thức <code>close()</code> của output để đóng luồng xuất và giải phóng tài nguyên.</li>
<li>Sử dụng phương thức <code>toByteArray()</code> để chuyển đổi dữ liệu trong bộ đệm thành mảng byte.</li>
<li>Sử dụng phương thức <code>Arrays.toString()</code> để chuyển đổi mảng byte thành chuỗi và xuất ra màn hình điều khiển.</li>
</ul>
<h4><strong>8) Conversion</strong></h4>
<p>InputStreamReader là một cầu nối từ byte stream sang character stream, nó sử dụng bộ mã ký tự chỉ định để đọc các byte và giải mã chúng thành các ký tự.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng InputStreamReader isr, sử dụng đối tượng FileInputStream để đọc nội dung của tệp demo.txt và chuyển đổi nó thành character stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">InputStreamReader</span><span style="color:#E06C75;--shiki-dark:#E06C75"> isr </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> InputStreamReader</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"demo.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một mảng ký tự cha để lưu trữ dữ liệu ký tự được đọc, với độ dài của mảng là 1024</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] cha </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> char</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng phương thức read() để đọc dữ liệu từ isr và lưu trữ dữ liệu ký tự đã đọc vào mảng cha, trả về giá trị len là số lượng ký tự đã đọc được</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> isr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(cha);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chuyển đổi mảng cha từ vị trí 0 đến len thành chuỗi và xuất ra màn hình console</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(cha, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, len));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng InputStreamReader isr để giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">isr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Đoạn mã này sử dụng lớp InputStreamReader và FileInputStream của Java để đọc dữ liệu từ tệp demo.txt và chuyển đổi chúng thành character stream. Sau đó, nó lưu trữ dữ liệu ký tự đã đọc vào một mảng và xuất chuỗi kết quả ra màn hình console.</p>
<p>OutputStreamWriter chuyển đổi một đối tượng xuất character stream thành một đối tượng xuất byte stream, là cầu nối từ character stream đến byte stream.</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng File f, đại diện cho tệp test.txt</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> f </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng OutputStreamWriter out, sử dụng đối tượng FileOutputStream để ghi dữ liệu vào tệp f và chuyển đổi byte stream thành character stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Writer</span><span style="color:#E06C75;--shiki-dark:#E06C75"> out </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> OutputStreamWriter</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(f))</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sử dụng phương thức write() để ghi chuỗi "hello world!!" vào tệp f</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"hello world!!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng đối tượng Writer out để giải phóng tài nguyên</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Việc sử dụng conversion stream giúp dễ dàng chuyển đổi giữa byte stream và character stream. Trong việc đọc và ghi tệp văn bản, thường sử dụng character stream, trong khi khi truyền dữ liệu qua mạng hoặc giao tiếp với thiết bị, thường sử dụng byte stream.</p>
<p>Ngoài ra, khi sử dụng conversion stream, cần chú ý đến vấn đề mã hóa ký tự. Nếu không chỉ định mã hóa ký tự, sẽ sử dụng mã hóa mặc định, có thể gây ra vấn đề về ký tự lạ. Do đó, khuyến khích luôn chỉ định mã hóa ký tự chính xác khi sử dụng conversion stream, để tránh các vấn đề liên quan đến ký tự lạ.</p>
<p>Bạn hãy xem, sau khi tôi tổng hợp, cảm giác như không còn nhiều vấn đề về IO nữa đúng không! Đối với các tình huống và nghiệp vụ khác nhau, chọn IO Stream tương ứng, cách sử dụng chỉ là đọc và ghi.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630135523.png" type="image/png"/>
    </item>
    <item>
      <title>File Stream</title>
      <link>https://vanhung4499.github.io/programming/java/IO/file.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/file.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">File Stream</source>
      <description>File Stream Trong các hoạt động IO, việc làm việc với tệp là phần phức tạp nhưng cũng là phần được sử dụng nhiều nhất, hầu hết các dự án của chúng ta đều có một lớp tiện ích gọi...</description>
      <category>java</category>
      <pubDate>Sun, 30 Jun 2024 16:14:55 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Trong các hoạt động IO, việc làm việc với tệp là phần phức tạp nhưng cũng là phần được sử dụng nhiều nhất, hầu hết các dự án của chúng ta đều có một lớp tiện ích gọi là FileUtil hoặc FileUtils.</p>
<p>Lớp <code>java.io.File</code> là lớp đặc biệt để thao tác với tệp, chú ý rằng chỉ có thể thao tác với chính tệp, không thể thao tác với nội dung của tệp, để làm việc với nội dung, cần sử dụng luồng vào ra.</p>
<p>Lớp <code>File</code> là một biểu diễn trừu tượng của tệp và thư mục, chủ yếu được sử dụng cho các hoạt động như tạo, tìm kiếm và xóa tệp và thư mục.</p>
<p>Làm sao để hiểu hai câu trên? Thực ra rất đơn giản!</p>
<p>Câu đầu tiên nói rằng <code>File</code> không liên quan đến stream, lớp <code>File</code> không thể đọc và ghi tệp, nghĩa là không thể nhập và xuất dữ liệu!</p>
<p>Câu thứ hai nói rằng <code>File</code> có thể đại diện cho <code>D:\\folder1</code> và <code>D:\\folder1\\file.txt</code>, phần trước là thư mục (Directory) và phần sau là tệp (file), lớp <code>File</code> được sử dụng để thao tác với cả hai.</p>
<h3>Các phương thức khởi tạo của lớp File</h3>
<p>Trong Java, mọi thứ đều là đối tượng và lớp File cũng không ngoại lệ. Bất kể là đối tượng nào cũng nên bắt đầu từ phương thức khởi tạo của đối tượng đó, vậy nên chúng ta hãy cùng phân tích các phương thức khởi tạo của lớp <code>File</code>.</p>
<p>Có ba phương thức khởi tạo thường được sử dụng:</p>
<ol>
<li>
<p><code>File(String pathname)</code>: Tạo một đối tượng File mới từ đường dẫn được chỉ định.</p>
</li>
<li>
<p><code>File(String parent, String child)</code>: Tạo một đối tượng File mới từ đường dẫn của thư mục cha (dưới dạng chuỗi) và tên tệp con.</p>
</li>
<li>
<p><code>File(File parent, String child)</code>: Tạo một đối tượng File mới từ thư mục cha (dưới dạng đối tượng File) và tên tệp con.</p>
</li>
</ol>
<p>Để hiểu rõ hơn, hãy xem ví dụ sau đây:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đường dẫn tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> path </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "/Users/username/123.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(path)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đường dẫn tệp tin khác</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> path2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "/Users/username/1/2.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(path2)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo từ thư mục cha và tên tệp con</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> parent </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "/Users/username/aaa"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> child </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "bbb.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file3 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> child)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo từ đối tượng thư mục cha và tên tệp con</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> parentDir </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/aaa"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> child2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "bbb.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file4 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(parentDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> child2)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lưu ý rằng trên macOS, dấu gạch chéo xuôi (<code>/</code>) được sử dụng làm ký tự phân cách trong đường dẫn, trong khi trên Windows, dấu gạch chéo ngược (<code>\</code>) được sử dụng. Vì vậy, khi xử lý đường dẫn, không nên sử dụng trực tiếp <code>/</code> hoặc <code>\</code>.</p>
<p>Trong Java, bạn có thể sử dụng <code>File.separator</code> để lấy ký tự phân cách đường dẫn, điều này sẽ tự động trả về ký tự phân cách đúng dựa trên hệ điều hành đang sử dụng.</p>
<p>Những điểm cần chú ý về lớp File:</p>
<ol>
<li>Một đối tượng File đại diện cho một tệp hoặc thư mục thực tế trên đĩa cứng.</li>
<li>Phương thức khởi tạo của lớp File không kiểm tra xem tệp hoặc thư mục có tồn tại thực sự hay không, vì vậy việc có hay không một tệp hoặc thư mục trong đường dẫn không ảnh hưởng đến việc tạo đối tượng File.</li>
</ol>
<h3>Các phương thức thông dụng của lớp File</h3>
<p>Các phương thức thông dụng của lớp File chủ yếu bao gồm các phương thức để lấy thông tin, lấy đường dẫn tuyệt đối và tương đối, kiểm tra và tạo/xóa tệp tin.</p>
<h4><strong>1) Các phương thức để lấy thông tin</strong></h4>
<ol>
<li>
<p><code>getAbsolutePath()</code>: Trả về đường dẫn tuyệt đối của đối tượng File.</p>
</li>
<li>
<p><code>getPath()</code>: Trả về đường dẫn của đối tượng File. Kết quả giống như <code>getAbsolutePath()</code>.</p>
</li>
<li>
<p><code>getName()</code>: Trả về tên của tệp tin hoặc thư mục.</p>
</li>
<li>
<p><code>length()</code>: Trả về độ dài của tệp tin, tính bằng byte.</p>
</li>
</ol>
<p>Đoạn mã kiểm tra sau đây dùng để thử nghiệm (chú ý thay đổi các đường dẫn theo máy tính của bạn):</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> f </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/aaa/bbb.java"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đường dẫn tuyệt đối của tệp tin: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đường dẫn được tạo: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tên của tệp tin: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Độ dài của tệp tin: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#98C379;--shiki-dark:#98C379"> " byte"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> f2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/aaa"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đường dẫn tuyệt đối của thư mục: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đường dẫn được tạo: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tên của thư mục: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> f2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Khi đối tượng File đại diện cho một thư mục, phương thức length() không có ý nghĩa</span></span></code></pre>
</div><h4><strong>2) Đường dẫn tuyệt đối và tương đối</strong></h4>
<p>Đường dẫn tuyệt đối là đường dẫn đầy đủ bắt đầu từ gốc của hệ thống tệp tin, mô tả vị trí chính xác của một tệp tin hoặc thư mục trong hệ thống tệp tin. Trên Windows, đường dẫn tuyệt đối thường bắt đầu với ổ đĩa (ví dụ: "<code>C:\Program Files\Java\jdk1.8.0_291\bin\java.exe</code>"). Trên macOS và Linux, đường dẫn tuyệt đối thường bắt đầu với dấu gạch chéo (<code>/</code>), ví dụ: "<code>/usr/local/bin/python3</code>".</p>
<p>Đường dẫn tương đối là đường dẫn dựa trên thư mục làm việc hiện tại, mô tả mối quan hệ giữa một tệp tin hoặc thư mục và thư mục làm việc hiện tại. Trong Java, đường dẫn tương đối thường được tính từ thư mục chứa chương trình Java hiện tại. Ví dụ: "<code>config/config.properties</code>" nếu thư mục làm việc hiện tại là "<code>/Users/username/project</code>", thì đường dẫn tương đối sẽ là "<code>/Users/username/project/config/config.properties</code>".</p>
<p>Lưu ý:</p>
<ul>
<li>Trên hệ điều hành Windows, hệ thống tệp tin mặc định không phân biệt chữ hoa chữ thường, nghĩa là tên tệp và đường dẫn có thể sử dụng cả chữ hoa và chữ thường. Ví dụ: "<code>C:\Users\username\Documents\example.txt</code>" và "<code>C:\Users\Username\Documents\Example.txt</code>" đều chỉ cùng một tệp. Tuy nhiên, Windows cung cấp một tùy chọn phân biệt chữ hoa chữ thường có thể được kích hoạt khi định dạng ổ đĩa.</li>
<li>Trên hệ điều hành macOS và Linux (Unix), hệ thống tệp mặc định là phân biệt chữ hoa chữ thường. Ví dụ: Trong macOS, "<code>/Users/username/Documents/example.txt</code>" và "<code>/Users/username/Documents/Example.txt</code>" là hai tệp khác nhau.</li>
</ul>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ví dụ về đường dẫn tuyệt đối</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> absoluteFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/example/test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đường dẫn tuyệt đối: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> absoluteFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ví dụ về đường dẫn tương đối</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> relativeFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"example/test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đường dẫn tương đối: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> relativeFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getPath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span></code></pre>
</div><p>Thông qua những ví dụ này, bạn có thể hiểu rõ hơn về cách sử dụng các phương thức của lớp <code>File</code> trong Java để làm việc với tệp tin và thư mục.</p>
<h4><strong>3）Các phương thức để kiểm tra</strong></h4>
<ol>
<li>
<p><code>exists()</code> ：Kiểm tra xem tệp tin hoặc thư mục có tồn tại không.</p>
</li>
<li>
<p><code>isDirectory()</code> ：Kiểm tra xem đối tượng có phải là thư mục không.</p>
</li>
<li>
<p><code>isFile()</code> ：Kiểm tra xem đối tượng có phải là tệp tin không.</p>
</li>
</ol>
<p>Đoạn mã minh họa như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/example"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem tệp tin hoặc thư mục có tồn tại không</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tệp tin hoặc thư mục tồn tại"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tệp tin hoặc thư mục không tồn tại"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem đối tượng có phải là thư mục không</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isDirectory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đây là một thư mục"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đây không phải là một thư mục"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Kiểm tra xem đối tượng có phải là tệp tin không</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đây là một tệp tin"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Đây không phải là một tệp tin"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4><strong>4）Các phương thức để tạo và xóa</strong></h4>
<ul>
<li><code>createNewFile()</code> ：Nếu tệp tin chưa tồn tại, tạo một tệp tin mới trống và trả về <code>true</code>; nếu tệp tin đã tồn tại, không tạo mới và trả về <code>false</code>.</li>
<li><code>delete()</code> ：Xóa tệp tin hoặc thư mục. Nếu là thư mục, chỉ có thể xóa nếu thư mục đó trống.</li>
<li><code>mkdir()</code> ：Chỉ có thể tạo một thư mục cấp độ một. Nếu thư mục cha không tồn tại, thao tác tạo thất bại. Trả về <code>true</code> nếu tạo thành công, trả về <code>false</code> nếu thất bại.</li>
<li><code>mkdirs()</code> ：Có thể tạo nhiều cấp thư mục. Nếu thư mục cha không tồn tại, sẽ được tạo kèm theo. Trả về <code>true</code> nếu tạo thành công hoặc thư mục đã tồn tại, trả về <code>false</code> nếu thất bại.</li>
</ul>
<p><strong>Trong phát triển thường sử dụng</strong> <code>mkdirs()</code>.</p>
<p>Đoạn mã thử nghiệm như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo tệp tin mới</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/example/test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">createNewFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tạo tệp tin thành công: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tạo tệp tin thất bại: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Xóa tệp tin</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">delete</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Xóa tệp tin thành công: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Xóa tệp tin thất bại: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo nhiều cấp thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> directory </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/username/example/subdir1/subdir2"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">directory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">mkdirs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tạo thư mục thành công: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> directory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tạo thư mục thất bại: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> directory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getAbsolutePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>5）Duyệt thư mục</h4>
<ul>
<li><code>String[] list()</code> ：Trả về một mảng String, biểu diễn tất cả các tệp con hoặc thư mục trong thư mục File này.</li>
<li><code>File[] listFiles()</code> ：Trả về một mảng File, biểu diễn tất cả các tệp con hoặc thư mục trong thư mục File này.</li>
</ul>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> directory </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/itwanger/Documents/Github/paicoding"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Liệt kê tên các tệp trong thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] files </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> directory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tên các tệp trong thư mục:"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#C678DD;--shiki-dark:#C678DD">:</span><span style="color:#E06C75;--shiki-dark:#E06C75"> files) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Liệt kê các tệp và thư mục con trong thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] filesAndDirs </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> directory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">listFiles</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Các tệp và thư mục con trong thư mục:"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileOrDir </span><span style="color:#C678DD;--shiki-dark:#C678DD">:</span><span style="color:#E06C75;--shiki-dark:#E06C75"> filesAndDirs) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tệp tin: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#C678DD;--shiki-dark:#C678DD"> if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isDirectory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Thư mục: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Lưu ý:</strong> Để sử dụng <code>listFiles()</code> để lấy danh sách các tệp hoặc thư mục con của một thư mục cụ thể, hai điều kiện sau phải được đảm bảo:</p>
<ol>
<li>Thư mục đã chỉ định phải tồn tại.</li>
<li>Thư mục đã chỉ định phải là một thư mục. Nếu không, có thể dẫn đến ngoại lệ NullPointerException.</li>
</ol>
<h4>6）Duyệt đệ quy</h4>
<p>Không cần nói nhiều, hãy xem ngay đoạn mã sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] args) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> directory </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"/Users/hnv99/Documents/Github"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Duyệt đệ quy các tệp và thư mục con trong thư mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    traverseDirectory</span><span style="color:#E06C75;--shiki-dark:#E06C75">(directory)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> traverseDirectory</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> directory) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Liệt kê tất cả các tệp và thư mục con trong thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    File</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] filesAndDirs </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> directory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">listFiles</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Duyệt qua từng tệp và thư mục con</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    for</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileOrDir </span><span style="color:#C678DD;--shiki-dark:#C678DD">:</span><span style="color:#E06C75;--shiki-dark:#E06C75"> filesAndDirs) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Nếu là tệp tin, xuất ra tên tệp tin</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tệp tin: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">else</span><span style="color:#C678DD;--shiki-dark:#C678DD"> if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">isDirectory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Nếu là thư mục, duyệt đệ quy vào thư mục con</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Thư mục: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fileOrDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            traverseDirectory</span><span style="color:#E06C75;--shiki-dark:#E06C75">(fileOrDir)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>RandomAccessFile</h3>
<p>RandomAccessFile là một lớp rất đặc biệt trong Java, nó không chỉ được sử dụng để đọc file mà còn để ghi file. Khác với các lớp IO khác như FileInputStream và FileOutputStream, RandomAccessFile cho phép bạn nhảy đến bất kỳ vị trí nào trong file và bắt đầu đọc hoặc ghi từ đó. Điều này làm cho nó rất phù hợp cho các tình huống cần truy cập dữ liệu ngẫu nhiên trong file, chẳng hạn như hệ thống cơ sở dữ liệu.</p>
<p>Dưới đây là một ví dụ về việc sử dụng RandomAccessFile để ghi và đọc file:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.io.IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> java.io.RandomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> RandomAccessFileDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> filePath</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "logs/java/abc.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Sử dụng RandomAccessFile để ghi file</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            writeToFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(filePath, </span><span style="color:#98C379;--shiki-dark:#98C379">"Hello, world!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Sử dụng RandomAccessFile để đọc file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> content</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> readFromFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(filePath);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Nội dung file: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> content);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> writeToFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> filePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">RandomAccessFile</span><span style="color:#E06C75;--shiki-dark:#E06C75"> randomAccessFile</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> RandomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(filePath, </span><span style="color:#98C379;--shiki-dark:#98C379">"rw"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Di chuyển con trỏ file tới cuối file (để nối thêm nội dung)</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            randomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">seek</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">randomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Ghi nội dung</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            randomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeUTF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(content);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> readFromFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> filePath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#C678DD;--shiki-dark:#C678DD"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> IOException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        StringBuilder</span><span style="color:#E06C75;--shiki-dark:#E06C75"> content</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> StringBuilder</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">RandomAccessFile</span><span style="color:#E06C75;--shiki-dark:#E06C75"> randomAccessFile</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> RandomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(filePath, </span><span style="color:#98C379;--shiki-dark:#98C379">"r"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">            // Di chuyển con trỏ file tới đầu file (để đọc từ đầu)</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            randomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">seek</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">append</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">randomAccessFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readUTF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Để tránh vấn đề lỗi font chữ tiếng Trung, chúng ta sử dụng các phương thức writeUTF và readUTF của RandomAccessFile, các phương thức này xử lý chuỗi sử dụng mã hóa UTF-8. Bạn có thể tự chạy đoạn mã này để trải nghiệm.</p>
<p>Tiếp theo, chúng ta sẽ đi vào chi tiết về các phương thức khởi tạo và các phương thức phổ biến của RandomAccessFile.</p>
<h4>Các phương thức khởi tạo</h4>
<p>RandomAccessFile chủ yếu có hai phương thức khởi tạo:</p>
<ul>
<li><code>RandomAccessFile(File file, String mode)</code>：Tạo một instance mới của RandomAccessFile sử dụng file object và mode truy cập cho trước.</li>
<li><code>RandomAccessFile(String name, String mode)</code>：Tạo một instance mới của RandomAccessFile sử dụng tên file và mode truy cập cho trước.</li>
</ul>
<p>Giá trị của mode có thể là:</p>
<ul>
<li>"r"：Mở file chỉ để đọc. Bất kỳ phương thức ghi nào cũng sẽ dẫn đến IOException.</li>
<li>"rw"：Mở file để đọc và ghi. Nếu file không tồn tại, nó sẽ được tạo ra.</li>
<li>"rws"：Mở file để đọc và ghi, yêu cầu mọi cập nhật nội dung hoặc siêu dữ liệu được ghi ngay lập tức xuống thiết bị lưu trữ dưới. Mode này đồng bộ và đảm bảo không mất dữ liệu trong trường hợp hệ thống sập.</li>
<li>"rwd"：Tương tự như "rws", mở file để đọc và ghi, nhưng yêu cầu chỉ ghi nội dung của file ngay lập tức. Siêu dữ liệu có thể được ghi trễ.</li>
</ul>
<h4>Các phương thức chính</h4>
<ul>
<li><code>long getFilePointer()</code>：Trả về vị trí hiện tại của con trỏ file.</li>
<li><code>long length()</code>：Trả về độ dài của file.</li>
<li><code>int read()</code>：Đọc một byte từ file.</li>
<li><code>int read(byte[] b)</code>：Đọc dữ liệu byte từ file và lưu vào mảng byte chỉ định.</li>
<li><code>int read(byte[] b, int off, int len)</code>：Đọc dữ liệu byte từ file và lưu vào mảng byte chỉ định, bắt đầu từ vị trí off và tối đa len byte.</li>
<li><code>String readLine()</code>：Đọc một dòng văn bản từ file.</li>
<li><code>readUTF()</code>：Đọc một chuỗi mã hóa UTF-8 từ file. Phương thức này trước tiên đọc hai byte cho thông tin độ dài, sau đó đọc dữ liệu byte UTF-8 dựa trên độ dài này và chuyển đổi chúng thành chuỗi Java. Điều này có nghĩa là khi sử dụng readUTF để đọc chuỗi, bạn cần đảm bảo rằng chuỗi trong file đã được ghi bằng writeUTF, để thông tin về độ dài và mã hóa được giữ nguyên.</li>
<li><code>void seek(long pos)</code>：Di chuyển con trỏ file đến vị trí pos trong file.</li>
<li><code>void write(byte[] b)</code>：Ghi tất cả byte của mảng byte chỉ định vào file.</li>
<li><code>void write(byte[] b, int off, int len)</code>：Ghi len byte từ mảng byte chỉ định vào file, bắt đầu từ vị trí off.</li>
<li><code>void write(int b)</code>：Ghi byte chỉ định vào file.</li>
<li><code>writeUTF(String str)</code>：Ghi một chuỗi mã hóa UTF-8 vào file. Phương thức này trước tiên ghi hai byte cho độ dài chuỗi UTF-8, sau đó ghi dữ liệu byte UTF-8 của chuỗi. Do đó, khi sử dụng writeUTF để ghi chuỗi, số byte thực tế được ghi sẽ nhiều hơn độ dài byte UTF-8 của chuỗi. Hai byte này được sử dụng để xác định độ dài chuỗi chính xác khi đọc.</li>
</ul>
<p>Hãy xem thêm ví dụ sau, kết hợp với những gì đã được trình bày, bạn sẽ hoàn toàn nắm vững về RandomAccessFile.</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"logs/java/abc.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">RandomAccessFile</span><span style="color:#E06C75;--shiki-dark:#E06C75"> raf </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> RandomAccessFile</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379"> "rw"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Ghi vào file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    raf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">writeUTF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Hello, world!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Di chuyển con trỏ file về đầu file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    raf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">seek</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Đọc nội dung từ file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> content </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> raf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readUTF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Nội dung: "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> content);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ví dụ này, chúng ta đầu tiên tạo một đối tượng file có tên là itwanger.txt. Sau đó, chúng ta sử dụng RandomAccessFile để mở file này ở chế độ đọc ghi.</p>
<p>Tiếp theo, chúng ta sử dụng phương thức writeUTF để ghi chuỗi "Hello, world!" vào file. Sau đó, chúng ta sử dụng seek để di chuyển con trỏ file về đầu file và sử dụng readUTF để đọc nội dung của file. Kết quả đầu ra sẽ là "Hello, world!".</p>
<p>Cuối cùng, chúng ta sử dụng câu lệnh try-with-resources để đảm bảo rằng RandomAccessFile sẽ được đóng đúng cách sau khi hoàn thành các thao tác.</p>
<h3>Apache FileUtils Class</h3>
<p>Lớp FileUtils là một lớp trong thư viện Apache Commons IO, cung cấp một số phương thức tiện ích để thao tác với các tệp và thư mục.</p>
<h4><strong>1）Sao chép tệp hoặc thư mục:</strong></h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> srcFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"đường/dẫn/đến/tệp/nguồn"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> destFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"đường/dẫn/đến/tệp/đích"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sao chép tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(srcFile, destFile);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Sao chép thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyDirectory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(srcFile, destFile);</span></span></code></pre>
</div><h4><strong>2）Xóa tệp hoặc thư mục:</strong></h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"đường/dẫn/đến/tệp/hoặc/thư/mục"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Xóa tệp hoặc thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">delete</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file);</span></span></code></pre>
</div><p>Cần lưu ý rằng, để xóa một thư mục không trống, bạn cần xóa tất cả các tệp và thư mục con trước.</p>
<h4><strong>3）Di chuyển tệp hoặc thư mục:</strong></h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> srcFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"đường/dẫn/đến/tệp/nguồn"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> destFile </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"đường/dẫn/đến/tệp/đích"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Di chuyển tệp hoặc thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">moveFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(srcFile, destFile);</span></span></code></pre>
</div><h4><strong>4）Truy vấn thông tin về tệp hoặc thư mục:</strong></h4>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"đường/dẫn/đến/tệp/hoặc/thư/mục"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy thời gian sửa đổi của tệp hoặc thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Date</span><span style="color:#E06C75;--shiki-dark:#E06C75"> modifyTime </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">lastModified</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy kích thước của tệp hoặc thư mục</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">long</span><span style="color:#E06C75;--shiki-dark:#E06C75"> size </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">sizeOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Lấy phần mở rộng của tên tệp hoặc thư mục</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> extension </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FileUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getExtension</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span></code></pre>
</div><p>Đó là một số phương thức quan trọng trong lớp FileUtils mà bạn có thể sử dụng để thực hiện các thao tác thường gặp khi làm việc với tệp và thư mục trong Java.</p>
<h3>Lớp FileUtil trong Hutool</h3>
<p>Lớp FileUtil là một công cụ thao tác tệp trong gói công cụ <a href="https://hutool.cn" target="_blank" rel="noopener noreferrer">Hutool</a>, cung cấp một loạt các phương thức đơn giản và dễ sử dụng để thực hiện các nhiệm vụ liên quan đến tệp trong Java.</p>
<p>Lớp FileUtil bao gồm các loại công cụ thao tác sau:</p>
<ul>
<li>Thao tác với tệp: bao gồm tạo mới, xóa, sao chép, di chuyển, đổi tên thư mục và tệp.</li>
<li>Kiểm tra tệp: kiểm tra xem tệp hoặc thư mục có trống không, có phải là thư mục, là tệp hay không.</li>
<li>Đường dẫn tuyệt đối: chuyển đổi tệp từ ClassPath thành tệp đường dẫn tuyệt đối.</li>
<li>Tên tệp: lấy tên chính của tệp, phần mở rộng của tệp.</li>
<li>Thao tác đọc: bao gồm đọc đối tượng Reader, đọc các phương thức đa dạng.</li>
<li>Thao tác ghi: bao gồm lấy Writer, các phương thức ghi đa dạng.</li>
</ul>
<p>Dưới đây là một số phương thức phổ biến trong lớp FileUtil:</p>
<ol>
<li><strong>copyFile</strong>: Sao chép tệp. Phương thức này sao chép tệp nguồn đã chỉ định vào tệp đích đã chỉ định.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> dest </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"FileUtilDemo2.java"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">copyFile</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file, dest);</span></span></code></pre>
</div><ol start="2">
<li><strong>move</strong>: Di chuyển tệp hoặc thư mục. Phương thức này di chuyển tệp hoặc thư mục nguồn đã chỉ định đến tệp hoặc thư mục đích đã chỉ định.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">move</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file, dest, </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><ol start="3">
<li><strong>del</strong>: Xóa tệp hoặc thư mục. Phương thức này xóa tệp hoặc thư mục đã chỉ định, nếu không tồn tại thì ném ra ngoại lệ.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file);</span></span></code></pre>
</div><ol start="4">
<li><strong>rename</strong>: Đổi tên tệp hoặc thư mục. Phương thức này đổi tên tệp hoặc thư mục đã chỉ định thành tên mới đã chỉ định.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">rename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file, </span><span style="color:#98C379;--shiki-dark:#98C379">"FileUtilDemo3.java"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><ol start="5">
<li><strong>readLines</strong>: Đọc từng dòng dữ liệu từ tệp.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileUtil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">readLines</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(file, </span><span style="color:#98C379;--shiki-dark:#98C379">"UTF-8"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">forEach</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#C678DD;--shiki-dark:#C678DD">::</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">println);</span></span></code></pre>
</div><p>Hãy khám phá thêm nhiều phương thức hữu ích khác trong mã nguồn của Hutool, đây là những công cụ sẽ giúp nâng cao khả năng lập trình của bạn.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Byte Stream</title>
      <link>https://vanhung4499.github.io/programming/java/IO/stream.html</link>
      <guid>https://vanhung4499.github.io/programming/java/IO/stream.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Byte Stream</source>
      <description>Byte Stream Chúng ta cần phải nhấn mạnh rằng dữ liệu của mọi tệp (văn bản, video, hình ảnh) đều được lưu trữ dưới dạng nhị phân và được truyền tải dưới dạng nhị phân. Do đó, byt...</description>
      <category>java</category>
      <pubDate>Sun, 30 Jun 2024 16:14:55 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Chúng ta cần phải nhấn mạnh rằng dữ liệu của mọi tệp (văn bản, video, hình ảnh) đều được lưu trữ dưới dạng nhị phân và được truyền tải dưới dạng nhị phân. Do đó, byte stream có thể truyền tải dữ liệu của bất kỳ loại tệp nào.</p>
<h3>Byte Output Stream (OutputStream)</h3>
<p><code>java.io.OutputStream</code> là lớp cha của <strong>byte output stream</strong>, chúng ta hãy xem một số phương thức chung mà nó định nghĩa:</p>
<ol>
<li>
<p><code>close()</code> : Đóng output stream này và giải phóng tài nguyên hệ thống liên quan đến stream này.</p>
</li>
<li>
<p><code>flush()</code> : Xả output stream này và buộc các byte trong bộ đệm được ghi vào đích.</p>
</li>
<li>
<p><code>write(byte[] b)</code> : Ghi b.length byte từ mảng byte đã cho vào output stream này.</p>
</li>
<li>
<p><code>write(byte[] b, int off, int len)</code> : Ghi len byte từ mảng byte đã cho vào output stream này, bắt đầu từ vị trí offset off.</p>
</li>
</ol>
<h3>Lớp FileOutputStream</h3>
<p><code>OutputStream</code> có nhiều lớp con, và chúng ta sẽ bắt đầu với một trong những lớp con đơn giản nhất là <code>FileOutputStream</code>. Như tên gọi, đây là một output stream tệp được sử dụng để ghi dữ liệu vào tệp.</p>
<h4><strong>1) Các phương thức khởi tạo của FileOutputStream</strong></h4>
<ol>
<li>Sử dụng tên tệp để tạo đối tượng FileOutputStream.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileName </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "example.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(fileName)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Đoạn mã trên tạo một đối tượng FileOutputStream với tên tệp là "example.txt". <strong>Nếu tệp không tồn tại, nó sẽ tạo một tệp mới; nếu tệp đã tồn tại, nó sẽ ghi đè lên tệp hiện có</strong>.</p>
<ol start="2">
<li>Sử dụng đối tượng File để tạo đối tượng FileOutputStream.</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"example.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Ví dụ về việc sử dụng FileOutputStream:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"example.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">  fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">  e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">      fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">      e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đoạn mã trên tạo một đối tượng FileOutputStream, ghi chuỗi "Tom" vào tệp "example.txt", và cuối cùng đóng output stream.</p>
<h4><strong>2) Ghi dữ liệu byte với FileOutputStream</strong></h4>
<p>Để ghi dữ liệu byte với FileOutputStream, chúng ta sử dụng chủ yếu các phương thức sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> b)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] b)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] b</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> off</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> len)  </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi từ vị trí `off`, `len` byte</span></span></code></pre>
</div><p>① <strong>Ghi một byte</strong>: Phương thức <code>write(int b)</code> ghi từng byte một, ví dụ như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo stream với tên file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fos.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">     </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">97</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Byte thứ nhất</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">98</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Byte thứ hai</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Byte thứ ba</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Ký tự 'a' có <a href="https://javabetter.cn/basic-extra-meal/java-unicode.html" target="_blank" rel="noopener noreferrer">giá trị ASCII</a> là 97, 'b' là 98, 'c' là 99. Do đó, đoạn mã trên có thể được viết lại như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo stream với tên file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fos.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">     </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'a'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Byte thứ nhất</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'b'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Byte thứ hai</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'c'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> // Byte thứ ba</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Phương thức <code>write(int b)</code> ghi từng byte một, với tham số <code>b</code> là giá trị nguyên của byte cần ghi. Mỗi byte chỉ có 8 bit, do đó giá trị của <code>b</code> phải nằm trong khoảng từ 0 đến 255. Giá trị ngoài khoảng này sẽ bị cắt bỏ. Ví dụ, nếu <code>b</code> là -1, nó sẽ bị cắt thành 255; nếu <code>b</code> là 256, nó sẽ bị cắt thành 0.</p>
<p>Khi ghi <code>b</code> vào output stream, phương thức <code>write(int b)</code> chỉ ghi 8 bit thấp của <code>b</code>, bỏ qua 24 bit cao. Điều này là do trong Java, các kiểu số nguyên (bao gồm byte, short, int, long) được biểu diễn dưới dạng bù hai nhị phân trong bộ nhớ. Khi chuyển một giá trị số nguyên cho phương thức <code>write(int b)</code>, phương thức này chỉ giữ lại 8 bit thấp của biểu diễn bù hai nhị phân, bỏ qua 24 bit cao.</p>
<p>Ví dụ, nếu giá trị cần ghi là 0x12345678, biểu diễn bù hai nhị phân là 0001 0010 0011 0100 0101 0110 0111 1000. Khi sử dụng phương thức <code>write(int b)</code> để ghi giá trị này, chỉ có 8 bit thấp 0111 1000 được ghi ra, bỏ qua 24 bit cao 0001 0010 0011 0100 0101 0110. Điều này là lý do tại sao 24 bit cao của tham số <code>b</code> bị bỏ qua.</p>
<p>0111 1000 là số nhị phân 8 bit, tương đương với số thập phân là 120, tương ứng với ký tự ASCII là "x". Trong bảng mã ASCII, giá trị ASCII thập phân của ký tự "x" là 120. Do đó, nếu sử dụng phương thức <code>write(int b)</code> để ghi một giá trị byte là 0x78 (tức là 120 thập phân), kết quả sẽ là ký tự "x".</p>
<p>Hãy xem ví dụ sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"example.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">120</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'x'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">0x12345678</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        try</span><span style="color:#E06C75;--shiki-dark:#E06C75"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Hãy xem kết quả:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630181913.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Thật là có 3 ký tự 'x'.</p>
<p>② <strong>Ghi một mảng byte</strong>: Phương thức <code>write(byte[] b)</code> cho phép ghi toàn bộ mảng byte, ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo stream với tên file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fos.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">     </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chuyển đổi chuỗi thành mảng byte</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Tom"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu từ mảng byte</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>③ <strong>Ghi một phần mảng byte chỉ định</strong>: Phương thức <code>write(byte[] b, int off, int len)</code> cho phép ghi một phần mảng byte từ vị trí chỉ định, ví dụ:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo stream với tên file</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fos.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">     </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chuyển đổi chuỗi thành mảng byte</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "abcde"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi 2 byte bắt đầu từ chỉ số 2 (tức là "cd")</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><h4><strong>3) FileOutputStream thực hiện thêm dữ liệu, xuống dòng</strong></h4>
<p>Trong các ví dụ mã trên, mỗi lần chạy chương trình sẽ tạo một đối tượng stream mới, dẫn đến dữ liệu trong tệp cũng bị xóa đi. Nếu muốn giữ lại dữ liệu hiện có trong tệp và tiếp tục <strong>thêm dữ liệu mới</strong>, chúng ta phải làm thế nào? Và làm thế nào để thực hiện <strong>xuống dòng</strong>?</p>
<p>Thực tế, điều này rất đơn giản.</p>
<p>Chúng ta học hai phương thức khác của <code>FileOutputStream</code>, như sau:</p>
<ol>
<li>Sử dụng tên tệp và cờ thêm để tạo đối tượng FileOutputStream</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fileName </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "example.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> append </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(fileName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> append)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Đoạn mã trên sử dụng tên tệp "example.txt" và cờ thêm để tạo đối tượng FileOutputStream, thêm dữ liệu vào cuối tệp. Nếu tệp không tồn tại, nó sẽ tạo một tệp mới; nếu tệp đã tồn tại, nó sẽ thêm dữ liệu vào cuối tệp.</p>
<ol start="2">
<li>Sử dụng đối tượng tệp và cờ thêm để tạo đối tượng FileOutputStream</li>
</ol>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">File</span><span style="color:#E06C75;--shiki-dark:#E06C75"> file </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"example.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75"> append </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75"> append)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Đoạn mã trên sử dụng đối tượng tệp và cờ thêm để tạo đối tượng FileOutputStream, thêm dữ liệu vào cuối tệp.</p>
<p>Cả hai phương thức khởi tạo này đều yêu cầu một giá trị boolean trong tham số thứ hai, <code>true</code> có nghĩa là thêm dữ liệu, <code>false</code> có nghĩa là không thêm (tức là xóa dữ liệu hiện có).</p>
<p>Để thực hiện thêm dữ liệu, bạn có thể sử dụng mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo stream với tên tệp</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"fos.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#E06C75;--shiki-dark:#E06C75">     </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Chuyển đổi chuỗi thành mảng byte</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] b </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "abcde"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Ghi dữ liệu từ mảng byte, sẽ thêm vào cuối tệp vì đã sử dụng cờ thêm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(b);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Chạy mã nhiều lần, bạn sẽ thấy dữ liệu được thêm vào liên tục.</p>
<p>Trong hệ điều hành Windows, ký tự xuống dòng là <code>\r\n</code>, mã trong mã là:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> filename </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "example.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(filename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Chế độ thêm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> content </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Tom</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\r\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Sử dụng kết hợp dấu xuống dòng và thêm dấu xuống dòng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Trong macOS, ký tự xuống dòng là <code>\n</code>, mã trong mã là:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> filename </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "example.txt"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(filename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Chế độ thêm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> content </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "Tom</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\n</span><span style="color:#98C379;--shiki-dark:#98C379">"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  // Chỉ sử dụng dấu xuống dòng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">getBytes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>Nói thêm về ký tự xuống dòng và dấu xuống dòng.</p>
<p>Ký tự xuống dòng (<code>\r</code>) và dấu xuống dòng (<code>\n</code>) là các ký tự điều khiển phổ biến trên máy tính, dùng để chỉ định kết thúc dòng hoặc thực hiện việc xuống dòng. Cách sử dụng chúng có thể khác nhau trong các hệ điều hành và ngôn ngữ lập trình khác nhau.</p>
<p>Trên hệ điều hành Windows, thường sử dụng kết hợp dấu xuống dòng và dấu xuống dòng (<code>\r\n</code>) để kết thúc mỗi dòng. Trong tệp văn bản, mỗi dòng sẽ kết thúc bằng một kết hợp này. Điều này là do các máy in và thiết bị đầu cuối từng sử dụng kết hợp này để kết thúc dòng và thực hiện xuống dòng. Trên Windows, các công cụ chỉnh sửa văn bản và terminal cũng hỗ trợ sử dụng kết hợp dấu xuống dòng và dấu xuống dòng để kết thúc mỗi dòng.</p>
<p>Trong macOS và Linux, thường chỉ sử dụng dấu xuống dòng (<code>\n</code>) để kết thúc mỗi dòng. Trong tệp văn bản, mỗi dòng sẽ chỉ kết thúc bằng một dấu xuống dòng. Điều này là do các thiết bị đầu cuối Unix ban đầu chỉ cần dùng dấu xuống dòng để kết thúc dòng và thực hiện xuống dòng. Trên macOS và Linux, các công cụ chỉnh sửa văn bản và terminal cũng hỗ trợ việc sử dụng dấu xuống dòng để kết thúc mỗi dòng.</p>
<p>Trong các ngôn ngữ lập trình, thường cũng sử dụng dấu xuống dòng và dấu xuống dòng để thực hiện các hoạt động trên chuỗi. Ví dụ, trong Java, dấu xuống dòng có thể được biểu thị bằng "<code>\r</code>", và dấu xuống dòng có thể được biểu thị bằng "<code>\n</code>". Khi sử dụng input stream và xuất để đọc và ghi tệp, cũng cần chú ý đến cách sử dụng dấu xuống dòng và dấu xuống dòng và sự khác biệt giữa các hệ điều hành.</p>
<h3>Byte Input Stream (InputStream)</h3>
<p><code>java.io.InputStream</code> là lớp <strong>cha</strong> của <strong>byte input stream</strong>, chúng ta hãy xem qua một số phương thức chung của nó:</p>
<ol>
<li>
<p><code>close()</code> : Đóng input stream này và giải phóng tài nguyên hệ thống liên quan đến stream này.</p>
</li>
<li>
<p><code>int read()</code> : Đọc byte tiếp theo từ input stream.</p>
</li>
<li>
<p><code>read(byte[] b)</code> : Phương thức này trả về giá trị int biểu thị số byte đã đọc được, trả về số byte đã đọc nếu có, nếu không đọc được gì thì trả về -1.</p>
</li>
</ol>
<h3>Lớp FileInputStream</h3>
<p>InputStream có nhiều lớp con, chúng ta sẽ bắt đầu với lớp con đơn giản nhất là FileInputStream. Tên gợi ý rằng đây là input stream từ file, dùng để đọc dữ liệu từ file.</p>
<h4>1) Các phương thức khởi tạo của FileInputStream</h4>
<ol>
<li>
<p><code>FileInputStream(String name)</code>: Tạo một đối tượng FileInputStream và mở file có tên được chỉ định để đọc. Tên file được chỉ định bởi tham số <code>name</code>. Nếu file không tồn tại, sẽ ném ra ngoại lệ FileNotFoundException.</p>
</li>
<li>
<p><code>FileInputStream(File file)</code>: Tạo một đối tượng FileInputStream và mở file được biểu diễn bởi đối tượng File chỉ định để đọc.</p>
</li>
</ol>
<p>Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileInputStream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc nội dung của file</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) data);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng input stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><h4>2) Đọc dữ liệu byte bằng FileInputStream</h4>
<p>① Đọc byte: Phương thức <code>read()</code> sẽ đọc một byte và trả về giá trị nguyên của byte đó. Nếu đã đọc đến cuối file, sẽ trả về -1. Nếu xảy ra lỗi trong quá trình đọc, sẽ ném ra ngoại lệ IOException.</p>
<p>Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileInputStream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc nội dung của file</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">((</span><span style="color:#C678DD;--shiki-dark:#C678DD">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) data);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng input stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><p>② Đọc bằng mảng byte: Phương thức <code>read(byte[] b)</code> sẽ đọc tối đa <code>b.length</code> byte từ stream và lưu chúng vào mảng đệm <code>b</code>.</p>
<p>Ví dụ mã như sau:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileInputStream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"test.txt"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc nội dung của file vào mảng đệm</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((count </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, count));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng input stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><h4>3) Sao chép ảnh bằng byte stream FileInputStream</h4>
<p>Nguyên lý rất đơn giản, là đọc thông tin ảnh vào byte stream nhập, sau đó dùng byte stream xuất để ghi vào file mới.</p>
<p>Ví dụ mã như sau:</p>
<div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileInputStream để đọc file ảnh gốc</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fis </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileInputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"original.jpg"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một đối tượng FileOutputStream để ghi file ảnh sao chép</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75"> fos </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> FileOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75">(</span><span style="color:#98C379;--shiki-dark:#98C379">"copy.jpg"</span><span style="color:#E06C75;--shiki-dark:#E06C75">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tạo một mảng đệm để lưu trữ dữ liệu được đọc</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[] buffer </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD"> byte</span><span style="color:#E06C75;--shiki-dark:#E06C75">[</span><span style="color:#D19A66;--shiki-dark:#D19A66">1024</span><span style="color:#E06C75;--shiki-dark:#E06C75">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đọc file ảnh gốc và ghi dữ liệu vào file ảnh sao chép</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">while</span><span style="color:#E06C75;--shiki-dark:#E06C75"> ((count </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer)</span><span style="color:#E06C75;--shiki-dark:#E06C75">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, count);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Đóng input stream và output stream</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">fos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Mã trên tạo một FileInputStream để đọc file ảnh gốc và FileOutputStream để ghi dữ liệu vào file ảnh sao chép. Sau đó, sử dụng vòng lặp while để từng bước đọc byte từ file gốc và ghi vào file sao chép. Cuối cùng, đóng cả FileInputStream và FileOutputStream để giải phóng tài nguyên.</p>
<h3>Tóm tắt</h3>
<p>InputStream là lớp trừu tượng của byte input stream, định nghĩa các phương thức để đọc dữ liệu byte như <code>read()</code>, <code>read(byte[] b)</code>, <code>read(byte[] b, int off, int len)</code> và nhiều phương thức khác. OutputStream là lớp trừu tượng của byte output stream, định nghĩa các phương thức để ghi dữ liệu byte như <code>write(int b)</code>, <code>write(byte[] b)</code>, <code>write(byte[] b, int off, int len)</code> và các phương thức khác. Cả hai lớp trừu tượng này là cơ sở của byte stream.</p>
<p>FileInputStream là lớp để đọc dữ liệu byte từ file, kế thừa từ InputStream. FileOutputStream là lớp để ghi dữ liệu byte vào file, kế thừa từ OutputStream. Cả hai lớp này là hai trong những lớp thực hiện phổ biến nhất của byte stream.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240630181913.png" type="image/png"/>
    </item>
    <item>
      <title>About Me</title>
      <link>https://vanhung4499.github.io/about-me.html</link>
      <guid>https://vanhung4499.github.io/about-me.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">About Me</source>
      <description>About Me Profile Exploration &amp; geek enthusiast, software engineer, hackintosher | Currently focusing on backend development with main directions in Spring | Discovering a bigger...</description>
      <category>about</category>
      <pubDate>Sun, 12 Mar 2023 00:00:00 GMT</pubDate>
      <content:encoded><![CDATA[

<h2>Profile</h2>
<p><em>Exploration &amp; geek enthusiast, software engineer, hackintosher | Currently focusing on backend development with main directions in Spring | Discovering a bigger world together with you.</em></p>
<h2>Skills</h2>
<h3>Languages</h3>
<img src="https://skillicons.dev/icons?i=java,golang,javascript,ts,python,html,css,regex,md,bash&amp;theme=dark&amp;&amp;perline=10" alt="Skills">
<h3>Frameworks</h3>
<img src="https://skillicons.dev/icons?i=spring,nodejs,nestjs,react,nextjs,vue,redux&amp;theme=dark&amp;&amp;perline=10" alt="Skills">
<h3>Databases</h3>
<img src="https://skillicons.dev/icons?i=mysql,redis,mongodb,elasticsearch&amp;theme=dark&amp;&amp;perline=10" alt="Skills">
<h3>Others</h3>
<img src="https://skillicons.dev/icons?i=vim,idea,vscode,aws,figma,gradle,maven,npm,gcp,docker,kubernetes,git,github,gitlab,rabbitmq,kafka,jenkins,linux,postman,linkedin,stackoverflow,svg&amp;theme=dark&amp;&amp;perline=10" alt="Skills">
<h2>Github Summary</h2>
<img src="https://github-trophies.vercel.app/?username=vanhung4499&amp;theme=radical&amp;margin-w=25" alt="Github Summary">
<img src="https://github-readme-stats.vercel.app/api/top-langs/?username=vanhung4499&amp;theme=radical&amp;layout=compact&amp;bg_color=30,ef475d,904e95&amp;title_color=fff&amp;text_color=fff">
<img src="https://github-readme-stats.vercel.app/api?username=vanhung4499&amp;count_private=true&amp;show_icons=true&amp;theme=radical&amp;bg_color=30,ef475d,904e95&amp;title_color=fff&amp;text_color=fff">
<h2>Preview</h2>
<figure><img src="https://count.getloli.com/get/@:vanhung4499?theme=gelbooru-h" alt=":Augenestern-creator" tabindex="0" loading="lazy"><figcaption>:Augenestern-creator</figcaption></figure>
<h2>Activity Graph</h2>
<figure><a href="https://github.com/OrageKK/github-readme-activity-graph" target="_blank" rel="noopener noreferrer"><img src="https://github-readme-activity-graph-sandy.vercel.app/graph?username=vanhung4499&amp;theme=dracula" alt="Ashutosh's github activity graph" tabindex="0" loading="lazy"></a><figcaption>Ashutosh's github activity graph</figcaption></figure>
<h2>About This Site</h2>
<p><a href="/about">About</a></p>
]]></content:encoded>
      <enclosure url="https://count.getloli.com/get/@:vanhung4499?theme=gelbooru-h" type="image/"/>
    </item>
    <item>
      <title>About this site</title>
      <link>https://vanhung4499.github.io/about.html</link>
      <guid>https://vanhung4499.github.io/about.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">About this site</source>
      <description>About this site ✨📒 Record the process of building this site, and share some thoughts and experiences. Introduction My previous wiki was built with Quartz, which is a publish to...</description>
      <category>blog</category>
      <pubDate>Tue, 14 Mar 2023 21:45:45 GMT</pubDate>
      <content:encoded><![CDATA[
<div class="hint-container info">
<p class="hint-container-title">✨📒</p>
<p>Record the process of building this site, and share some thoughts and experiences.</p>
</div>
<h2>Introduction</h2>
<p>My previous wiki was built with <a href="https://quartz.jzhao.xyz/" target="_blank" rel="noopener noreferrer">Quartz</a>, which is a publish tool for obsidian nots. I have been using it for a long time, but I found that it is not very convenient to share and search because of the navigation and the structure of the page. So I need to find a better alternative.</p>
<p>After some searching on github, I found some good-looking wiki/blog sites. I tried some of them then the last choice of me is <a href="https://v2.vuepress.vuejs.org/zh/" target="_blank" rel="noopener noreferrer">VuePress</a>, which is a static site generator based on Vue.js. It is very easy to use and has a lot of plugins and themes. I chose the <a href="https://theme-hope.vuejs.press/zh/" target="_blank" rel="noopener noreferrer">vuepress-theme-hope</a> theme, which is very beautiful and has a lot of features.</p>
<p>And I found a customized of hope theme, which is <a href="https://github.com/OrageKK/oragekk.github.io" target="_blank" rel="noopener noreferrer">https://github.com/OrageKK/oragekk.github.io</a>, It is very beautiful and has a lot of features. So I forked it and made some changes to fit my needs. Thanks to the author for the great work.</p>
<h2>Markdown Enhancement</h2>
<p>The Markdown effect of the hope theme is surprisingly good, and it supports many features that ordinary Markdown does not, such as custom containers, code blocks with tabs, and the most convenient feature of being able to write flowcharts directly. It also allows for optional highlight themes (the code highlighting on this site is based on shikiPlugin, which, although not as lightweight and efficient as the default prismjs, provides more accurate syntax highlighting). For specific effects, see here ☞ <a href="https://theme-hope.vuejs.press/guide/markdown/intro.html" target="_blank" rel="noopener noreferrer">Markdown Enhance</a>.</p>
<h2>Project Structure</h2>
<div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> .github</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> ISSUE_TEMPLATE</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Issue templates</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> bug-report.yml</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> workflows</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">       └──</span><span style="color:#98C379;--shiki-dark:#98C379"> deploy-docs.yml</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Deployment script</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> CNAME</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> LICENSE</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> README.md</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> api</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> proxy.js</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Cross-origin proxy</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> env.d.ts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> package.json</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> pnpm-lock.yaml</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> script</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> requirements.txt</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> submit.py</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # GitHub Actions script for submitting URLs</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> src</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> .vuepress</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> client.ts</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Client configuration file</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> components</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> MyCoverLink.vue</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Friend link component</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> Mylink.vue</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Card component</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> config.ts</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # VuePress configuration file</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> data</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Data</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> navbar</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> plugins</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> vuepress-plugin-canvas</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> vuepress-plugin-gradient-cover</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> vuepress-plugin-hitokoto</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> vuepress-plugin-live2DAssist</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> vuepress-plugin-popper</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> public</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> assets</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Resources</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> sidebar</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> styles</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> theme</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> api</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> bing.ts</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Bing daily wallpaper</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> components</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Custom components</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> index.ts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> layouts</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Custom layouts</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> utils</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">       ├──</span><span style="color:#98C379;--shiki-dark:#98C379"> busuanzi.pure.js</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Busuanzi statistics</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">       └──</span><span style="color:#98C379;--shiki-dark:#98C379"> time.ts</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Runtime</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   │</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> theme.ts</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Theme configuration file</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">│</span><span style="color:#98C379;--shiki-dark:#98C379">   └──</span><span style="color:#98C379;--shiki-dark:#98C379"> README.md</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">├──</span><span style="color:#98C379;--shiki-dark:#98C379"> tsconfig.json</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">└──</span><span style="color:#98C379;--shiki-dark:#98C379"> vercel.json</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Vercel configuration file</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Framework Support</h2>
<p><a href="https://v2.vuepress.vuejs.org/" target="_blank" rel="noopener noreferrer">vuepress2.x</a></p>
<h2>Theme Support</h2>
<p><a href="https://theme-hope.vuejs.press/" target="_blank" rel="noopener noreferrer">vuepress-theme-hope</a></p>
<h2>Markdown Editor</h2>
<p>I use <a href="https://obsidian.md/" target="_blank" rel="noopener noreferrer">Obsidian</a> to write markdown files, which is a very powerful markdown editor. It supports many features such as graph view, backlinks, and plugins. I highly recommend it.</p>
<p>To work along with VuePress, you only need create a new vault in <code>src</code> folder, and then you can write markdown files in it.</p>
<div class="hint-container tip">
<p class="hint-container-title">Tips</p>
<p>When you create a new vault, an <code>.obsidian</code> will be created in the <code>src</code> directory, this is Obsidian configs and plugins folder. You can ignore it in the <code>.gitignore</code> file to avoid uploading it to the repository.</p>
</div>
<h2>Customization</h2>
<p>I have customized the original theme as follows. The main customizations are divided into:</p>
<ol>
<li>
<p><strong>Custom Layouts</strong></p>
<ul>
<li><code>NotFound.vue</code></li>
<li><code>Layout.vue</code> (added a donation component)</li>
<li><code>News.vue</code> (layout for news list)</li>
</ul>
</li>
<li>
<p><strong>Custom Components</strong></p>
<ul>
<li><code>BlogHero.vue</code></li>
<li><code>PageFooter.vue</code></li>
<li><code>Sponsor.vue</code> (donation component) // Not used in my site</li>
<li><code>NewsList.vue</code> (news list)</li>
<li><code>NewsItem.vue</code> (news item)</li>
</ul>
</li>
<li>
<p><strong>Local Plugin Development</strong></p>
<ul>
<li><code>vuepress-plugin-canvas</code> (supports two types of dynamic backgrounds: rainbow background and geometric shapes)</li>
<li><code>vuepress-plugin-gradient-cover</code> (background overlay)</li>
<li><code>vuepress-plugin-hitokoto</code> (Hitokoto plugin) // Not used in my site</li>
<li><code>vuepress-plugin-live2DAssist</code> (assistant for Live2D; hides on pages with sidebars to avoid obstruction)</li>
<li><code>vuepress-plugin-popper</code> (mouse effect, based on <a href="https://github.com/moefyit/moefy-canvas" target="_blank" rel="noopener noreferrer">@moefy-canvas/theme-popper</a>)</li>
</ul>
</li>
<li>
<p><strong>External Content References</strong></p>
<ul>
<li><a href="https://github.com/oh-my-live2d/vuepress-plugin-oh-my-live2d" target="_blank" rel="noopener noreferrer">vuepress-plugin-oh-my-live2d</a> (Live2D plugin)</li>
<li>Busuanzi statistics</li>
<li><a href="https://github.com/moefyit/moefy-canvas" target="_blank" rel="noopener noreferrer">@moefy-canvas/theme-popper</a> (original plugin only supported VuePress 1.x, developed a localized plugin to support VuePress 2.x)</li>
<li><a href="https://v2.vuepress.vuejs.org/zh/reference/plugin/google-analytics.html" target="_blank" rel="noopener noreferrer">@vuepress/plugin-google-analytics</a> (supports Google Analytics 4, which replaces the old UA)</li>
</ul>
</li>
<li>
<p><strong>Configuration Content</strong></p>
<ul>
<li>Navbar</li>
<li>Sidebar</li>
<li>Comments using <a href="https://waline.js.org/" target="_blank" rel="noopener noreferrer">Waline</a></li>
<li>Search using <a href="https://plugin-search-pro.vuejs.press/" target="_blank" rel="noopener noreferrer">vuepress-plugin-search-pro</a></li>
<li>Enabled copyright plugin</li>
<li>Feed RSS plugin</li>
<li>Added article type - "News"; added image preview selector for news markdown images</li>
</ul>
</li>
<li>
<p><strong>Miscellaneous</strong></p>
<ul>
<li>Runtime statistics</li>
<li>CSS beautification</li>
<li>Introduced fonts: PinYu Handwriting, XiaXingKai</li>
<li>Added custom emojis for Waline and modified the display style</li>
<li>Personalized log</li>
<li>Automatically push new article URLs to search engines (Baidu, Bing, Google) 👉 <a href="/platform/github/github-action">Detailed Configuration</a></li>
</ul>
</li>
</ol>
<h2>Conclusion</h2>
<blockquote>
<p>This is an ongoing project, with continuous optimization.</p>
<p>Local plugins are available for anyone interested. The source code is open; click the GitHub icon in the top right corner to access it. And don't forget to leave a star! 🌟</p>
</blockquote>
]]></content:encoded>
    </item>
    <item>
      <title>Database</title>
      <link>https://vanhung4499.github.io/database/</link>
      <guid>https://vanhung4499.github.io/database/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Database</source>
      <category>database</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>DevOps</title>
      <link>https://vanhung4499.github.io/devops/</link>
      <guid>https://vanhung4499.github.io/devops/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">DevOps</source>
      <category>devops</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>DSA</title>
      <link>https://vanhung4499.github.io/dsa/</link>
      <guid>https://vanhung4499.github.io/dsa/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">DSA</source>
      <description>Data Structures and Algorithms Info Phần này hướng dẫn làm quen và thực hành với cấu trúc dữ liệu và giải thuật phục vụ cho vòng coding interview. Giải quyết các vấn đề trên Lee...</description>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<div class="hint-container info">
<p class="hint-container-title">Info</p>
<ul>
<li>Phần này hướng dẫn làm quen và thực hành với cấu trúc dữ liệu và giải thuật phục vụ cho vòng coding interview.</li>
<li>Giải quyết các vấn đề trên Leetcode!</li>
<li>Thật sự rất khó để tách biệt Data Structure và Algorithm, nên tôi sẽ viết lồng ghép giữa chúng vào các chủ đề lớn. Vì chúng thật sự là có mối liên hệ chặt chẽ với nhau!</li>
</ul>
</div>
<div class="hint-container info">
<p class="hint-container-title">Info</p>
<p>Python là ngôn ngữ chính mà tôi sử dụng trong phần này vì nó dễ đọc, dễ viết và dễ hiểu.</p>
</div>
<h2>Introduction</h2>
<blockquote>
<p>Giới thiệu về cấu trúc dữ liệu và giải thuật.</p>
</blockquote>
<ul>
<li><a href="./intro/introduction">Introduction to Data Structures and Algorithms</a></li>
<li><a href="/intro/complexity">Algorithm Complexity</a></li>
</ul>
<h2>Data Structures</h2>
<blockquote>
<p>Cấu trúc dữ liệu là cách tổ chức, lưu trữ và quản lý dữ liệu một cách hiệu quả.</p>
</blockquote>
<ul>
<li><a href="/ds/" target="_blank">Data Structures</a></li>
</ul>
<h2>Algorithms</h2>
<blockquote>
<p>Giải thuật là một tập hợp các hướng dẫn để giải quyết một vấn đề.</p>
</blockquote>
<ul>
<li><a href="/algo/" target="_blank">Alogrithms</a></li>
</ul>
<h2>LeetCode</h2>
<blockquote>
<p>Luyện tập giải các bài toán trên LeetCode.</p>
</blockquote>
<ul>
<li><a href="/leetcode/" target="_blank">LeetCode</a></li>
<li><a href="">LeetCode By Categories</a> Todo!</li>
<li><a href="">LeetCode Top 100</a> Todo!</li>
<li><a href="">LeetCode Top 200</a> Todo!</li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Framework</title>
      <link>https://vanhung4499.github.io/framework/</link>
      <guid>https://vanhung4499.github.io/framework/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Framework</source>
      <category>framework</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Interview</title>
      <link>https://vanhung4499.github.io/interview/</link>
      <guid>https://vanhung4499.github.io/interview/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Interview</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Programming</title>
      <link>https://vanhung4499.github.io/programming/</link>
      <guid>https://vanhung4499.github.io/programming/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Programming</source>
      <description>Programming Languages This section contains articles about programming languages.</description>
      <category>programming</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>This section contains articles about programming languages.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Projects</title>
      <link>https://vanhung4499.github.io/project/</link>
      <guid>https://vanhung4499.github.io/project/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Projects</source>
      <description>Projects My projects documentation.</description>
      <category>project</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>My projects documentation.</p>
]]></content:encoded>
    </item>
    <item>
      <title>dir template</title>
      <link>https://vanhung4499.github.io/templates/dir.html</link>
      <guid>https://vanhung4499.github.io/templates/dir.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">dir template</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Post</title>
      <link>https://vanhung4499.github.io/templates/post.html</link>
      <guid>https://vanhung4499.github.io/templates/post.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Post</source>
      <category>any</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Elastic Stack</title>
      <link>https://vanhung4499.github.io/database/elastic/</link>
      <guid>https://vanhung4499.github.io/database/elastic/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elastic Stack</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Filebeat Operation</title>
      <link>https://vanhung4499.github.io/database/elastic/filebeat-operation.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/filebeat-operation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Filebeat Operation</source>
      <description>Vận hành Filebeat Nền tảng Beats kết hợp nhiều trình thu thập dữ liệu đơn nhiệm. Chúng gửi dữ liệu từ hàng trăm, hàng nghìn hoặc hàng triệu máy và hệ thống đến Logstash hoặc Ela...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Nền tảng Beats kết hợp nhiều trình thu thập dữ liệu đơn nhiệm. Chúng gửi dữ liệu từ hàng trăm, hàng nghìn hoặc hàng triệu máy và hệ thống đến Logstash hoặc Elasticsearch.</p>
<p>Vì tôi chỉ tiếp xúc với Filebeat, nên bài viết này chỉ giới thiệu về vận hành của Filebeat.</p>
</blockquote>
<h2>1. Cài đặt Filebeat</h2>
<h3>1.1. Yêu cầu môi trường</h3>
<blockquote>
<p>Phiên bản: Elastic Stack 7.4</p>
</blockquote>
<h3>1.2. Các bước cài đặt</h3>
<p>Đối với hệ thống Unix / Linux, khuyến nghị sử dụng cách cài đặt sau đây vì nó khá phổ biến.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>wget https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz</span></span>
<span class="line"><span>tar -zxf filebeat-6.1.1-linux-x86_64.tar.gz</span></span></code></pre>
</div><blockquote>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation.html" target="_blank" rel="noopener noreferrer">filebeat-installation</a></p>
</blockquote>
<h2>2. Cấu hình Filebeat</h2>
<blockquote>
<p>Đầu tiên, điều cần biết là: <code>filebeat.yml</code> là tệp cấu hình của Filebeat. Đường dẫn của nó có thể thay đổi tùy theo cách bạn cài đặt.</p>
<p>Tất cả các tệp cấu hình của sản phẩm Beat đều dựa trên định dạng <a href="http://www.yaml.org/" target="_blank" rel="noopener noreferrer">YAML</a>, và FileBeat cũng không ngoại lệ.</p>
<p>Để biết thêm về cấu hình Filebeat, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuring-howto-filebeat.html" target="_blank" rel="noopener noreferrer">Cấu hình Filebeat</a></p>
<p>Để biết thêm về định dạng tệp filebeat.yml, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/libbeat/6.1/config-file-format.html" target="_blank" rel="noopener noreferrer">Định dạng tệp filebeat.yml</a></p>
</blockquote>
<p>Ví dụ về một phần cấu hình filebeat.yml:</p>
<div class="language-yml" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">filebeat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        - </span><span style="color:#98C379;--shiki-dark:#98C379">/var/log/*.log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      multiline</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        pattern</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'^['</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">after</span></span></code></pre>
</div><h3>2.1. Các mục cấu hình quan trọng</h3>
<blockquote>
<p>Dưới đây, tôi sẽ liệt kê các mục cấu hình quan trọng của Filebeat.</p>
<p>Nếu bạn muốn tìm hiểu thêm về thông tin cấu hình, bạn có thể tham khảo:</p>
<p>Để biết thêm về cấu hình Filebeat, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuring-howto-filebeat.html" target="_blank" rel="noopener noreferrer">Cấu hình Filebeat</a></p>
<p>Để biết thêm về định dạng tệp filebeat.yml, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/libbeat/6.1/config-file-format.html" target="_blank" rel="noopener noreferrer">Định dạng tệp filebeat.yml</a></p>
</blockquote>
<h4>2.1.1. filebeat.prospectors</h4>
<p>(Trình theo dõi tệp) được sử dụng để chỉ định các tệp cần quan tâm.</p>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">filebeat.prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    enabled</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      - </span><span style="color:#98C379;--shiki-dark:#98C379">/var/log/*.log</span></span></code></pre>
</div><h4>2.1.2. output.elasticsearch</h4>
<p>Nếu bạn muốn Filebeat trực tiếp xuất dữ liệu đến Elasticsearch, bạn cần cấu hình output.elasticsearch.</p>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">output.elasticsearch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.1.42:9200'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span></code></pre>
</div><h4>2.1.3. output.logstash</h4>
<p>Nếu bạn muốn Filebeat xuất dữ liệu đến Logstash, sau đó Logstash sẽ xuất dữ liệu đến Elasticsearch, bạn cần cấu hình output.logstash.</p>
<blockquote>
<p><strong>Lưu ý</strong></p>
<p>So với việc xuất dữ liệu đến Elasticsearch, tôi khuyên bạn nên xuất dữ liệu đến Logstash.</p>
<p>Bởi vì khi Logstash và Filebeat làm việc cùng nhau, nếu Logstash bận xử lý dữ liệu, nó sẽ thông báo cho FileBeat làm chậm tốc độ đọc. Một khi tình trạng tắc nghẽn được giải quyết, FileBeat sẽ trở lại tốc độ ban đầu và tiếp tục truyền dữ liệu. Như vậy, có thể giảm thiểu tình trạng quá tải của đường truyền.</p>
</blockquote>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">output.logstash</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'127.0.0.1:5044'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span></code></pre>
</div><p>Ngoài ra, bạn cũng cần chỉ định plugin beats input trong tệp cấu hình của Logstash (như logstash.conf):</p>
<div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379">input {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  beats {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    port =&gt; 5044</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Cổng này cần phải giống với cổng trong filebeat.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Phần filter của tệp này được bình luận để chỉ ra rằng nó</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># là tùy chọn.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># filter {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">output {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  elasticsearch {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    hosts =&gt; "localhost:9200"</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    manage_template =&gt; false</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    index =&gt; "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    document_type =&gt; "%{[@metadata][type]}"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>2.1.4. setup.kibana</h4>
<p>Nếu bạn định sử dụng bảng điều khiển Kibana do Filebeat cung cấp, bạn cần cấu hình setup.kibana.</p>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">setup.kibana</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'localhost:5601'</span></span></code></pre>
</div><h4>2.1.5. setup.template.settings</h4>
<p>Trong Elasticsearch, <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/indices-templates.html" target="_blank" rel="noopener noreferrer">mẫu chỉ mục</a> được sử dụng để xác định cài đặt và ánh xạ, để xác định cách phân tích các trường.</p>
<p>Trong Filebeat, setup.template.settings được sử dụng để cấu hình mẫu chỉ mục.</p>
<p>Mẫu chỉ mục được Filebeat khuyên dùng được cài đặt bởi gói phần mềm Filebeat. Nếu bạn chấp nhận cấu hình mặc định trong tệp filebeat.yml, Filebeat sẽ tự động tải mẫu sau khi kết nối thành công với Elasticsearch.</p>
<p>Bạn có thể tắt tải mẫu tự động hoặc tải mẫu của riêng bạn bằng cách cấu hình các tùy chọn tải mẫu trong tệp cấu hình Filebeat. Bạn cũng có thể đặt các tùy chọn để thay đổi tên chỉ mục và mẫu chỉ mục.</p>
<blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-template.html" target="_blank" rel="noopener noreferrer">filebeat-template</a></p>
<p><strong>Ghi chú</strong></p>
<p>Nếu không cần thiết, hãy sử dụng mẫu chỉ mục mặc định trong tệp cấu hình Filebeat.</p>
</blockquote>
<h4>2.1.6. setup.dashboards</h4>
<p>Filebeat đi kèm với các bảng điều khiển Kibana mẫu. Trước khi sử dụng các bảng điều khiển, bạn cần tạo mẫu chỉ mục <code>filebeat-*</code> và tải các bảng điều khiển vào Kibana. Để làm điều này, bạn có thể chạy lệnh <code>setup</code> hoặc cấu hình tải bảng điều khiển trong tệp <code>filebeat.yml</code>.</p>
<p>Để tải các bảng điều khiển Filebeat vào Kibana, bạn cần kích hoạt công tắc trong cấu hình <code>filebeat.yml</code>:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>setup.dashboards.enabled: true</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-dashboards.html" target="_blank" rel="noopener noreferrer">configuration-dashboards</a></p>
</blockquote>
<h2>3. Lệnh Filebeat</h2>
<p>Filebeat cung cấp một loạt các lệnh để hoàn thành nhiều chức năng khác nhau.</p>
<p>Cách thực hiện lệnh:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./filebeat</span><span style="color:#98C379;--shiki-dark:#98C379"> COMMAND</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/command-line-options.html" target="_blank" rel="noopener noreferrer">command-line-options</a></p>
<p><strong>Ghi chú</strong></p>
<p>Theo quan điểm cá nhân, không cần phải nắm vững tất cả các lệnh dòng lệnh, vì hầu hết các chức năng đều có thể hoàn thành thông qua cấu hình. Và việc chỉ định chức năng thông qua dòng lệnh yêu cầu nhập cùng một tham số mỗi lần, không thuận lợi cho việc khởi động cố định.</p>
<p>Đương nhiên, lệnh khởi động quan trọng nhất là run.</p>
<p><strong>Ví dụ</strong> Khởi động bằng cách chỉ định tệp cấu hình</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./filebeat</span><span style="color:#98C379;--shiki-dark:#98C379"> run</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -e</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -c</span><span style="color:#98C379;--shiki-dark:#98C379"> filebeat.yml</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -d</span><span style="color:#98C379;--shiki-dark:#98C379"> "publish"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./filebeat</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -e</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -c</span><span style="color:#98C379;--shiki-dark:#98C379"> filebeat.yml</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -d</span><span style="color:#98C379;--shiki-dark:#98C379"> "publish"</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # run có thể bỏ qua</span></span></code></pre>
</div></blockquote>
<h2>4. Module Filebeat</h2>
<blockquote>
<p><a href="https://www.elastic.co/cn/products/beats/filebeat" target="_blank" rel="noopener noreferrer">Filebeat</a> và <a href="https://www.elastic.co/cn/products/beats/metricbeat" target="_blank" rel="noopener noreferrer">Metricbeat</a> tích hợp một loạt các module để đơn giản hóa quá trình thu thập, phân tích và hiển thị các định dạng nhật ký thông thường (như NGINX, Apache hoặc các chỉ số hệ thống như Redis hoặc Docker).</p>
</blockquote>
<ul>
<li>Cấu hình elasticsearch và kibana</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>output.elasticsearch:</span></span>
<span class="line"><span>  hosts: ["myEShost:9200"]</span></span>
<span class="line"><span>  username: "elastic"</span></span>
<span class="line"><span>  password: "elastic"</span></span>
<span class="line"><span>setup.kibana:</span></span>
<span class="line"><span>  host: "mykibanahost:5601"</span></span>
<span class="line"><span>  username: "elastic"</span></span>
<span class="line"><span>  password: "elastic</span></span></code></pre>
</div><blockquote>
<p>username và password là tùy chọn, nếu không cần xác thực thì không cần điền.</p>
</blockquote>
<ul>
<li>Khởi tạo môi trường</li>
</ul>
<p>Chạy lệnh dưới đây, filebeat sẽ tải mẫu chỉ mục được khuyến nghị.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>./filebeat setup -e</span></span></code></pre>
</div><ul>
<li>Chỉ định module</li>
</ul>
<p>Chạy lệnh dưới đây để chỉ định các module bạn muốn tải.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>./filebeat -e --modules system,nginx,mysql</span></span></code></pre>
</div><blockquote>
<p>Để biết thêm thông tin, bạn có thể tham khảo:</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-modules.html" target="_blank" rel="noopener noreferrer">Cấu hình module filebeat</a></li>
<li><a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules.html" target="_blank" rel="noopener noreferrer">Module hỗ trợ filebeat</a></li>
</ul>
</blockquote>
<h2>5. Tài liệu tham khảo</h2>
<ul>
<li><a href="https://www.elastic.co/cn/products/beats" target="_blank" rel="noopener noreferrer">Trang chủ Beats</a></li>
<li><a href="https://github.com/elastic/beats" target="_blank" rel="noopener noreferrer">Beats Github</a></li>
<li><a href="https://www.elastic.co/guide/en/beats/libbeat/current/index.html" target="_blank" rel="noopener noreferrer">Tài liệu chính thức Beats</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Filebeat</title>
      <link>https://vanhung4499.github.io/database/elastic/filebeat.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/filebeat.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Filebeat</source>
      <description>Elastic Stack và Filebeat Giới thiệu Beats là các đại lý truyền dữ liệu được cài đặt trên máy chủ. Beats có thể truyền dữ liệu trực tiếp đến Elasticsearch hoặc đến Logstash. img...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giới thiệu</h2>
<p>Beats là các đại lý truyền dữ liệu được cài đặt trên máy chủ.</p>
<p>Beats có thể truyền dữ liệu trực tiếp đến Elasticsearch hoặc đến Logstash.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/beats-platform.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Beats có nhiều loại, bạn có thể chọn loại phù hợp với nhu cầu thực tế của bạn.</p>
<p>Các loại phổ biến bao gồm:</p>
<ul>
<li><strong>Packetbeat:</strong>&nbsp;Trình phân tích gói dữ liệu mạng, cung cấp thông tin về các giao dịch được trao đổi giữa các máy chủ ứng dụng của bạn.</li>
<li><strong>Filebeat:</strong>&nbsp;Gửi các tệp nhật ký từ máy chủ của bạn.</li>
<li><strong>Metricbeat:</strong>&nbsp;Là một đại lý giám sát máy chủ, thu thập định kỳ các chỉ số từ hệ điều hành và dịch vụ đang chạy trên máy chủ.</li>
<li><strong>Winlogbeat:</strong>&nbsp;Cung cấp nhật ký sự kiện Windows.</li>
</ul>
<blockquote>
<p><strong>Tham khảo</strong></p>
<p>Các loại Beats khác có thể tham khảo tại:&nbsp;<a href="https://www.elastic.co/guide/en/beats/libbeat/current/community-beats.html" target="_blank" rel="noopener noreferrer">community-beats</a></p>
<p><strong>Chú ý</strong></p>
<p>Vì tôi chỉ sử dụng FileBeat trong công việc, nên nội dung sau chỉ giới thiệu về FileBeat.</p>
</blockquote>
<h3>FileBeat có tác dụng gì?</h3>
<p>So với Logstash, FileBeat nhẹ nhàng hơn.</p>
<p>Trong bất kỳ môi trường nào, ứng dụng đều có khả năng bị tắt. Filebeat đọc và chuyển tiếp các dòng nhật ký, nếu bị gián đoạn, nó sẽ nhớ tất cả các sự kiện ở vị trí khi trạng thái trực tuyến được khôi phục.</p>
<p>Filebeat có các mô-đun nội bộ (auditd, Apache, Nginx, System và MySQL) để đơn giản hóa việc thu thập, phân tích và trực quan hóa định dạng nhật ký phổ biến.</p>
<p>FileBeat không làm quá tải ống dẫn của bạn. Nếu FileBeat truyền dữ liệu đến Logstash, khi Logstash bận xử lý dữ liệu, nó sẽ thông báo cho FileBeat làm chậm tốc độ đọc. Khi tình trạng tắc nghẽn được giải quyết, FileBeat sẽ trở lại tốc độ ban đầu và tiếp tục truyền dữ liệu.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/filebeat.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h2>Cài đặt</h2>
<p>Đối với hệ thống Unix / Linux, bạn nên cài đặt theo cách sau vì nó khá phổ biến.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">wget</span><span style="color:#98C379;--shiki-dark:#98C379"> https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">tar</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -zxf</span><span style="color:#98C379;--shiki-dark:#98C379"> filebeat-6.1.1-linux-x86_64.tar.gz</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo:&nbsp;<a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation.html" target="_blank" rel="noopener noreferrer">filebeat-installation</a></p>
</blockquote>
<h2>Cấu hình</h2>
<h3>Tệp cấu hình</h3>
<p>Đầu tiên, điều cần biết là: <code>filebeat.yml</code> là tệp cấu hình của Filebeat. Đường dẫn của tệp cấu hình có thể thay đổi tùy thuộc vào cách bạn cài đặt.</p>
<p>Tất cả các sản phẩm trong loạt Beat đều dựa trên định dạng cấu hình <a href="http://www.yaml.org/" target="_blank" rel="noopener noreferrer">YAML</a>, và FileBeat cũng không phải là ngoại lệ.</p>
<p>Ví dụ về một phần cấu hình filebeat.yml:</p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">filebeat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        - </span><span style="color:#98C379;--shiki-dark:#98C379">/var/log/*.log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      multiline</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        pattern</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'^['</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">after</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm về cấu hình Filebeat, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuring-howto-filebeat.html" target="_blank" rel="noopener noreferrer">Cấu hình Filebeat</a></p>
<p>Để biết thêm về định dạng tệp filebeat.yml, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/libbeat/6.1/config-file-format.html" target="_blank" rel="noopener noreferrer">Định dạng tệp filebeat.yml</a></p>
</blockquote>
<h3>Các mục cấu hình quan trọng</h3>
<h4>filebeat.prospectors</h4>
<p>(Trình theo dõi tệp) được sử dụng để chỉ định các tệp cần quan tâm.</p>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">filebeat.prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    enabled</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      - </span><span style="color:#98C379;--shiki-dark:#98C379">/var/log/*.log</span></span></code></pre>
</div><h4>output.elasticsearch</h4>
<p>Nếu bạn muốn Filebeat trực tiếp xuất dữ liệu đến Elasticsearch, bạn cần cấu hình output.elasticsearch.</p>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">output.elasticsearch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.1.42:9200'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span></code></pre>
</div><h4>output.logstash</h4>
<p>Nếu bạn muốn Filebeat xuất dữ liệu đến Logstash, sau đó Logstash sẽ xuất dữ liệu đến Elasticsearch, bạn cần cấu hình output.logstash.</p>
<blockquote>
<p><strong>Lưu ý</strong></p>
<p>So với xuất dữ liệu đến Elasticsearch, tôi khuyên bạn nên xuất dữ liệu đến Logstash.</p>
<p>Bởi vì khi Logstash và Filebeat làm việc cùng nhau, nếu Logstash bận xử lý dữ liệu, nó sẽ thông báo cho FileBeat làm chậm tốc độ đọc. Một khi tình trạng tắc nghẽn được giải quyết, FileBeat sẽ trở lại tốc độ ban đầu và tiếp tục truyền dữ liệu. Như vậy, có thể giảm bớt tình trạng quá tải ống dẫn.</p>
</blockquote>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">output.logstash</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'127.0.0.1:5044'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span></code></pre>
</div><p>Ngoài ra, bạn cũng cần chỉ định plugin đầu vào beats trong tệp cấu hình Logstash (như logstash.conf):</p>
<div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379">input {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  beats {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    port =&gt; 5044</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Cổng này cần phải giống với cổng trong filebeat.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Phần filter của tệp này được bình luận để chỉ ra rằng nó là</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># tùy chọn.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># filter {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">output {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  elasticsearch {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    hosts =&gt; "localhost:9200"</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    manage_template =&gt; false</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    index =&gt; "%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}"</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    document_type =&gt; "%{[@metadata][type]}"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>setup.kibana</h4>
<p>Nếu bạn dự định sử dụng bảng điều khiển Kibana do Filebeat cung cấp, bạn cần cấu hình setup.kibana.</p>
<p><strong>Ví dụ</strong></p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">setup.kibana</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'localhost:5601'</span></span></code></pre>
</div><h4>setup.template.settings</h4>
<p>Trong Elasticsearch, <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/indices-templates.html" target="_blank" rel="noopener noreferrer">mẫu chỉ mục</a> được sử dụng để định nghĩa cài đặt và ánh xạ, để xác định cách phân tích các trường.</p>
<p>Trong Filebeat, setup.template.settings được sử dụng để cấu hình mẫu chỉ mục.</p>
<p>Filebeat gợi ý mẫu chỉ mục được cài đặt bởi gói phần mềm Filebeat. Nếu bạn chấp nhận cấu hình mặc định trong tệp cấu hình filebeat.yml, Filebeat tự động tải mẫu sau khi kết nối thành công với Elasticsearch.</p>
<p>Bạn có thể vô hiệu hóa tải mẫu tự động hoặc tải mẫu của riêng bạn bằng cách cấu hình các tùy chọn tải mẫu trong tệp cấu hình Filebeat. Bạn cũng có thể đặt tùy chọn để thay đổi tên chỉ mục và mẫu chỉ mục.</p>
<blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-template.html" target="_blank" rel="noopener noreferrer">filebeat-template</a></p>
<p><strong>Chú ý</strong></p>
<p>Nếu không cần thiết, hãy sử dụng mẫu chỉ mục mặc định trong tệp cấu hình Filebeat.</p>
</blockquote>
<h4>setup.dashboards</h4>
<p>Filebeat đi kèm với các bảng điều khiển Kibana mẫu. Trước khi sử dụng bảng điều khiển, bạn cần tạo mẫu chỉ mục <code>filebeat-*</code> và tải bảng điều khiển vào Kibana. Để làm điều này, bạn có thể chạy lệnh <code>setup</code> hoặc cấu hình tải bảng điều khiển trong tệp <code>filebeat.yml</code>.</p>
<p>Để tải bảng điều khiển Filebeat vào Kibana, bạn cần bật chức năng trong cấu hình <code>filebeat.yml</code>:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>setup.dashboards.enabled: true</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-dashboards.html" target="_blank" rel="noopener noreferrer">configuration-dashboards</a></p>
</blockquote>
<h2>Lệnh</h2>
<p>Filebeat cung cấp một loạt các lệnh để hoàn thành nhiều chức năng.</p>
<p>Cách thực hiện lệnh:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./filebeat</span><span style="color:#98C379;--shiki-dark:#98C379"> COMMAND</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/command-line-options.html" target="_blank" rel="noopener noreferrer">command-line-options</a></p>
<p><strong>Chú ý</strong></p>
<p>Theo quan điểm cá nhân, không cần phải nắm bắt tất cả các lệnh, bởi vì hầu hết các chức năng đều có thể được hoàn thành thông qua cấu hình. Hơn nữa, việc chỉ định chức năng thông qua dòng lệnh đòi hỏi phải nhập cùng một tham số mỗi lần, điều này không thuận lợi cho việc khởi động cố định.</p>
<p>Quan trọng nhất, tất nhiên, là lệnh khởi động run.</p>
<p><strong>Ví dụ</strong> Khởi động bằng cách chỉ định tệp cấu hình</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./filebeat</span><span style="color:#98C379;--shiki-dark:#98C379"> run</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -e</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -c</span><span style="color:#98C379;--shiki-dark:#98C379"> filebeat.yml</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -d</span><span style="color:#98C379;--shiki-dark:#98C379"> "publish"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./filebeat</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -e</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -c</span><span style="color:#98C379;--shiki-dark:#98C379"> filebeat.yml</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -d</span><span style="color:#98C379;--shiki-dark:#98C379"> "publish"</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # run có thể bỏ qua</span></span></code></pre>
</div></blockquote>
<h2>Module</h2>
<p>Filebeat cung cấp một bộ module được xây dựng sẵn, cho phép bạn triển khai giải pháp giám sát log nhanh chóng và đi kèm với các bảng điều khiển mẫu và trực quan hóa dữ liệu. Những module này hỗ trợ các định dạng log phổ biến như Nginx, Apache2 và MySQL, v.v.</p>
<h3>Các bước để chạy module</h3>
<ul>
<li>Cấu hình elasticsearch và kibana</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>output.elasticsearch:</span></span>
<span class="line"><span>  hosts: ["myEShost:9200"]</span></span>
<span class="line"><span>  username: "elastic"</span></span>
<span class="line"><span>  password: "elastic"</span></span>
<span class="line"><span>setup.kibana:</span></span>
<span class="line"><span>  host: "mykibanahost:5601"</span></span>
<span class="line"><span>  username: "elastic"</span></span>
<span class="line"><span>  password: "elastic</span></span></code></pre>
</div><blockquote>
<p>username và password là tùy chọn, nếu không cần xác thực thì không cần điền.</p>
</blockquote>
<ul>
<li>Khởi tạo môi trường</li>
</ul>
<p>Chạy lệnh dưới đây, Filebeat sẽ tải mẫu chỉ mục được gợi ý.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>./filebeat setup -e</span></span></code></pre>
</div><ul>
<li>Chỉ định module</li>
</ul>
<p>Chạy lệnh dưới đây, chỉ định module bạn muốn tải.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>./filebeat -e --modules system,nginx,mysql</span></span></code></pre>
</div><blockquote>
<p><strong>Tham khảo</strong></p>
<p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-modules.html" target="_blank" rel="noopener noreferrer">Cấu hình module Filebeat</a> | <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules.html" target="_blank" rel="noopener noreferrer">Module được hỗ trợ bởi Filebeat</a></p>
</blockquote>
<h2>Nguyên lý</h2>
<p>Filebeat có hai thành phần chính:</p>
<p>harvester: chịu trách nhiệm đọc nội dung của một tệp. Nó sẽ đọc từng dòng nội dung của tệp và gửi nội dung đến đích xuất.</p>
<p>prospector: chịu trách nhiệm quản lý harvester và tìm tất cả các nguồn tệp cần đọc. Ví dụ, nếu kiểu là log, prospector sẽ duyệt qua tất cả các tệp phù hợp với yêu cầu trong đường dẫn đã chỉ định.</p>
<div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">filebeat.prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      - </span><span style="color:#98C379;--shiki-dark:#98C379">/var/log/*.log</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      - </span><span style="color:#98C379;--shiki-dark:#98C379">/var/path2/*.log</span></span></code></pre>
</div><p>Filebeat giữ trạng thái của mỗi tệp và thường xuyên làm mới trạng thái đĩa trong tệp đăng ký. Trạng thái được sử dụng để nhớ vị trí cuối cùng mà harvester đang đọc và đảm bảo tất cả các dòng log được gửi đi.</p>
<p>Filebeat lưu trạng thái gửi của mỗi sự kiện trong tệp đăng ký. Vì vậy, nó có thể đảm bảo rằng sự kiện được gửi ít nhất một lần đến đầu ra được cấu hình, không có dữ liệu bị mất.</p>
<h2>Tài liệu</h2>
<p><a href="https://www.elastic.co/guide/en/beats/libbeat/current/index.html" target="_blank" rel="noopener noreferrer">Tài liệu chính thức của Beats</a></p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/beats-platform.png" type="image/png"/>
    </item>
    <item>
      <title>Elastic Stack Kabina</title>
      <link>https://vanhung4499.github.io/database/elastic/kabina.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/kabina.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elastic Stack Kabina</source>
      <description>Elastic Stack: Kibana Discover Bằng cách nhấp vào Discover trong thanh điều hướng bên, bạn có thể xem chức năng truy vấn dữ liệu của Kibana. imgimg Trong thanh tìm kiếm, bạn có ...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Discover</h2>
<p>Bằng cách nhấp vào&nbsp;<code>Discover</code>&nbsp;trong thanh điều hướng bên, bạn có thể xem chức năng truy vấn dữ liệu của&nbsp;<code>Kibana</code>.</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/current/images/tutorial-discover.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Trong thanh tìm kiếm, bạn có thể nhập điều kiện truy vấn Elasticsearch để tìm kiếm dữ liệu của mình. Bạn có thể duyệt kết quả trên trang&nbsp;<code>Discover</code>&nbsp;và tạo các biểu đồ trực quan từ các tìm kiếm đã lưu trên trang&nbsp;<code>Visualize</code>.</p>
<p>Mô hình chỉ mục hiện tại được hiển thị dưới thanh truy vấn. Mô hình chỉ mục xác định chỉ mục nào được tìm kiếm khi gửi truy vấn. Để tìm kiếm một tập hợp chỉ mục khác nhau, chọn một mô hình khác từ menu thả xuống. Để thêm mô hình chỉ mục (index pattern), hãy chuyển đến&nbsp;<code>Management/Kibana/Index Patterns</code>&nbsp;và nhấp vào&nbsp;<code>Add New</code>.</p>
<p>Bạn có thể xây dựng tìm kiếm bằng cách sử dụng tên trường và giá trị bạn quan tâm. Đối với các trường số, bạn có thể sử dụng các toán tử so sánh như lớn hơn (&gt;), nhỏ hơn (&lt;) hoặc bằng (=). Bạn có thể liên kết các phần tử với các toán tử logic&nbsp;<code>AND</code>,&nbsp;<code>OR</code>&nbsp;và&nbsp;<code>NOT</code>, tất cả đều viết hoa.</p>
<p>Mặc định, mỗi tài liệu khớp sẽ hiển thị tất cả các trường. Để chọn các trường tài liệu để hiển thị, di chuyển chuột qua danh sách "Available fields", sau đó nhấp vào nút thêm bên cạnh mỗi trường bạn muốn bao gồm. Ví dụ, nếu chỉ thêm account_number, hiển thị sẽ thay đổi thành danh sách đơn giản bao gồm năm số tài khoản:</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-discover-3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h3>Ngữ pháp truy vấn</h3>
<p>Thanh tìm kiếm của Kibana tuân thủ ngữ pháp truy vấn được mô tả trong tài liệu&nbsp;<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html#query-string-syntax" target="_blank" rel="noopener noreferrer">query-string-syntax</a>.</p>
<p>Dưới đây là một số ngữ pháp truy vấn cơ bản.</p>
<p>Chuỗi truy vấn sẽ được phân tích thành một loạt các thuật ngữ và toán tử. Một thuật ngữ có thể là một từ (như: quick, brown) hoặc một cụm từ được bao quanh bởi dấu ngoặc kép (như "quick brown").</p>
<p>Các hoạt động truy vấn cho phép bạn tùy chỉnh tìm kiếm - dưới đây là các tùy chọn có sẵn.</p>
<h4>Tên trường</h4>
<p>Như đã nói trong truy vấn chuỗi, sẽ tìm kiếm <code>default_field</code> trong điều kiện tìm kiếm, nhưng bạn cũng có thể chỉ định các trường khác trong cú pháp truy vấn:</p>
<p>Ví dụ:</p>
<ul>
<li>Tìm kiếm từ khóa <code>active</code> trong trường <code>status</code></li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>status:active</span></span></code></pre>
</div><ul>
<li>Trường <code>title</code> chứa từ khóa <code>quick</code> hoặc <code>brown</code>. Nếu bạn bỏ qua toán tử <code>OR</code>, toán tử mặc định sẽ được sử dụng</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>title:(quick OR brown)</span></span>
<span class="line"><span>title:(quick brown)</span></span></code></pre>
</div><ul>
<li>Trường tác giả tìm cụm từ chính xác "John Smith", tức là tìm kiếm chính xác.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>author:"John Smith"</span></span></code></pre>
</div><ul>
<li>Bất kỳ trường nào <code>book.title</code>, <code>book.content</code> hoặc <code>book.date</code> đều chứa <code>quick</code> hoặc <code>brown</code> (lưu ý làm thế nào chúng tôi sử dụng <code>\*</code> để biểu thị ký tự đại diện)</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>book.\*:(quick brown)</span></span></code></pre>
</div><ul>
<li>Trường tiêu đề chứa bất kỳ giá trị không null nào</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>_exists_:title</span></span></code></pre>
</div><h4>Ký tự đại diện</h4>
<p>ELK cung cấp hai ký tự đại diện là ? và *.</p>
<ul>
<li><code>?</code> biểu thị bất kỳ ký tự đơn nào;</li>
<li><code>*</code> biểu thị bất kỳ không hoặc nhiều ký tự.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>qu?ck bro*</span></span></code></pre>
</div><blockquote>
<p><strong>Chú ý: Truy vấn ký tự đại diện sẽ sử dụng rất nhiều bộ nhớ và hiệu suất thực thi không tốt, vì vậy hãy sử dụng cẩn thận.</strong> &gt; <strong>Gợi ý</strong>: Ký tự đại diện tinh khiết <code>*</code> được viết vào truy vấn <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="noopener noreferrer">exists</a>, điều này đã cải thiện hiệu suất truy vấn. Do đó, ký tự đại diện <code>field：*</code> sẽ khớp với tài liệu chứa giá trị trống, như: <code>{“field”：“”}</code>, nhưng nếu trường bị mất hoặc giá trị được đặt thành null thì sẽ không khớp, như: <code>“field”：null}</code> &gt; <strong>Gợi ý</strong>: Sử dụng ký tự đại diện ở đầu một từ (ví dụ: <code>*ing</code>) tạo ra một lượng truy vấn rất lớn, vì tất cả các thuật ngữ trong chỉ mục đều cần được kiểm tra, chỉ trong trường hợp nó khớp. Bạn có thể vô hiệu hóa điều này bằng cách đặt <code>allow_leading_wildcard</code> thành <code>false</code>.</p>
</blockquote>
<h4>Biểu thức chính quy</h4>
<p>Bạn có thể sử dụng biểu thức chính quy trong chuỗi truy vấn bằng cách đặt chúng vào <code>/</code>.</p>
<p>Ví dụ:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>name:/joh?n(ath[oa]n)/</span></span></code></pre>
</div><p>Cú pháp biểu thức chính quy được hỗ trợ có thể được tham khảo tại: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html#regexp-syntax" target="_blank" rel="noopener noreferrer">Regular expression syntax</a></p>
<h4>Truy vấn mờ</h4>
<p>Chúng ta có thể sử dụng toán tử <code>~</code> để thực hiện truy vấn mờ.</p>
<p>Ví dụ:</p>
<p>Giả sử chúng ta thực sự muốn truy vấn</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quick brown forks</span></span></code></pre>
</div><p>Nhưng, do lỗi đánh máy, từ khóa truy vấn của chúng ta trở thành như sau, chúng ta vẫn có thể tìm thấy kết quả mong muốn.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quikc\~ brwn\~ foks\~</span></span></code></pre>
</div><p>Truy vấn mờ này sử dụng khoảng cách Damerau-Levenshtein để tìm tất cả các mục khớp với tối đa hai thay đổi. Các thay đổi được đề cập ở đây là việc chèn, xóa hoặc thay thế một ký tự duy nhất, hoặc hoán đổi hai ký tự liền kề.</p>
<p>Khoảng cách chỉnh sửa mặc định là <code>2</code>, nhưng khoảng cách chỉnh sửa <code>1</code> nên đủ để bắt được 80% lỗi đánh máy của con người. Nó có thể được chỉ định như:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quikc\~1</span></span></code></pre>
</div><h4>Tìm kiếm xấp xỉ</h4>
<p>Mặc dù truy vấn cụm từ (ví dụ, <code>john smith</code>) mong đợi tất cả các từ đều theo đúng thứ tự, nhưng tìm kiếm xấp xỉ cho phép các từ được chỉ định ở xa hơn hoặc được sắp xếp theo thứ tự khác nhau. Giống như truy vấn mờ có thể chỉ định khoảng cách chỉnh sửa tối đa cho các ký tự trong một từ, tìm kiếm xấp xỉ cũng cho phép chúng ta chỉ định khoảng cách chỉnh sửa tối đa cho các từ trong một cụm từ:</p>
<p>Ví dụ</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>"fox quick"\~5</span></span></code></pre>
</div><p>Văn bản trong trường càng gần với thứ tự gốc được chỉ định trong chuỗi truy vấn, tài liệu đó càng được coi là liên quan. Khi so sánh với truy vấn mẫu ở trên, cụm từ <code>"quick fox"</code> sẽ được coi là gần với điều kiện truy vấn hơn so với <code>"quick brown fox"</code>.</p>
<h4>Phạm vi</h4>
<p>Bạn có thể chỉ định phạm vi cho các trường ngày, số hoặc chuỗi. Phạm vi khoảng đóng được chỉ định bằng dấu ngoặc vuông <code>[min TO max]</code> và phạm vi khoảng mở được chỉ định bằng dấu ngoặc nhọn <code>{min TO max}</code>.</p>
<p>Hãy xem một số ví dụ.</p>
<ul>
<li>Tất cả các ngày trong năm 2012</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>date:[2012-01-01 TO 2012-12-31]</span></span></code></pre>
</div><ul>
<li>Số từ 1 đến 5</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>count:[1 TO 5]</span></span></code></pre>
</div><ul>
<li>Nhãn giữa <code>alpha</code> và <code>omega</code>, không bao gồm <code>alpha</code> và <code>omega</code></li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>tag:{alpha TO omega}</span></span></code></pre>
</div><ul>
<li>Số lớn hơn 10</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>count:[10 TO *]</span></span></code></pre>
</div><ul>
<li>Tất cả các ngày trước năm 2012</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>date:{* TO 2012-01-01}</span></span></code></pre>
</div><p>Ngoài ra, bạn cũng có thể kết hợp khoảng mở và khoảng đóng</p>
<ul>
<li>Số từ 1 đến 5, nhưng không bao gồm 5</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>count:[1 TO 5}</span></span></code></pre>
</div><p>Phạm vi không giới hạn ở một bên cũng có thể sử dụng cú pháp sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>age:&gt;10</span></span>
<span class="line"><span>age:&gt;=10</span></span>
<span class="line"><span>age:&lt;10</span></span>
<span class="line"><span>age:&lt;=10</span></span></code></pre>
</div><p>Tất nhiên, bạn cũng có thể sử dụng toán tử AND để nhận được giao của hai kết quả truy vấn</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>age:(&gt;=10 AND &lt;20)</span></span>
<span class="line"><span>age:(+&gt;=10 +&lt;20)</span></span></code></pre>
</div><h4>Boosting</h4>
<p>Sử dụng toán tử <code>^</code> để làm cho một thuật ngữ trở nên quan trọng hơn một thuật ngữ khác. Ví dụ, nếu chúng ta muốn tìm tất cả các tài liệu liên quan đến cáo, nhưng chúng ta đặc biệt quan tâm đến từ "nhanh":</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quick^2 fox</span></span></code></pre>
</div><p>Giá trị tăng cường mặc định là 1, nhưng có thể là bất kỳ số dương nào. Tăng cường giữa 0 và 1 giảm độ liên quan.</p>
<p>Tăng cường cũng có thể được áp dụng cho cụm từ hoặc nhóm:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>"john smith"^2   (foo bar)^4</span></span></code></pre>
</div><h4>Thao tác Boolean</h4>
<p>Theo mặc định, tất cả các từ đều tùy chọn miễn là có một từ phù hợp. Tìm kiếm <code>foo bar baz</code> sẽ tìm kiếm bất kỳ tài liệu nào chứa một hoặc nhiều từ <code>foo</code> hoặc <code>bar</code> hoặc <code>baz</code>. Chúng tôi đã thảo luận về <code>default_operator</code> ở trên, cho phép bạn yêu cầu tất cả các mục, nhưng cũng có các toán tử Boolean có thể được sử dụng trong chuỗi truy vấn để cung cấp nhiều kiểm soát hơn.</p>
<p>Toán tử ưa thích là <code>+</code> (thuật ngữ này phải tồn tại) và <code>-</code> (thuật ngữ này không được tồn tại). Tất cả các thuật ngữ khác là tùy chọn. Ví dụ, truy vấn này:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quick brown +fox -news</span></span></code></pre>
</div><p>Truy vấn này có nghĩa là:</p>
<ul>
<li>fox phải tồn tại</li>
<li>news không được tồn tại</li>
<li>quick và brown là tùy chọn</li>
</ul>
<p>Các toán tử quen thuộc <code>AND</code>, <code>OR</code> và <code>NOT</code> (cũng được viết là <code>&amp;&amp;</code>, <code>||</code> và <code>!</code>) cũng được hỗ trợ. Tuy nhiên, các toán tử này có mức độ ưu tiên: <code>NOT</code> ưu tiên hơn <code>AND</code>, <code>AND</code> ưu tiên hơn <code>OR</code>. Mặc dù <code>+</code> và <code>-</code> chỉ ảnh hưởng đến thuật ngữ ở bên phải của toán tử, nhưng <code>AND</code> và <code>OR</code> sẽ ảnh hưởng đến thuật ngữ ở cả hai bên.</p>
<h4>Nhóm</h4>
<p>Nhiều thuật ngữ hoặc mệnh đề có thể được kết hợp bằng cặp dấu ngoặc để tạo ra một truy vấn con</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>(quick OR brown) AND fox</span></span></code></pre>
</div><p>Bạn có thể sử dụng nhóm để định vị các trường cụ thể, hoặc để tăng cường kết quả của truy vấn con:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>status:(active OR pending) title:(full text search)^2</span></span></code></pre>
</div><h4>Từ dự trữ</h4>
<p>Nếu bạn cần sử dụng bất kỳ ký tự nào trong truy vấn của mình như một toán tử (thay vì là một toán tử), thì bạn nên sử dụng một dấu gạch chéo ngược để thoát khỏi chúng. Ví dụ, để tìm kiếm (1 + 1) = 2, bạn cần viết truy vấn là <code>\(1\+1\)\=2</code></p>
<p>Các ký tự dự trữ là: <code>+ - = &amp;&amp; || &gt; &lt; ! ( ) { } [ ] ^ " ~ * ? : \ /</code></p>
<p>Không thể thoát đúng các ký tự đặc biệt này có thể dẫn đến lỗi cú pháp, ngăn chặn truy vấn của bạn.</p>
<h4>Truy vấn rỗng</h4>
<p>Nếu chuỗi truy vấn trống hoặc chỉ chứa khoảng trắng, truy vấn sẽ tạo ra một tập kết quả trống.</p>
<h2>Visualize</h2>
<p>Để hiển thị dữ liệu của bạn dưới dạng trực quan, hãy nhấp vào <code>Visualize</code> trong thanh điều hướng bên.</p>
<p>Công cụ Visualize cho phép bạn xem dữ liệu theo nhiều cách khác nhau như biểu đồ tròn, biểu đồ cột, đồ thị đường, biểu đồ phân phối, v.v. Để bắt đầu, hãy nhấp vào <code>Create a visualization</code> màu xanh hoặc nút <code>+</code>.</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png" alt="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png" tabindex="0" loading="lazy"><figcaption><a href="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png</a></figcaption></figure>
<p>Có nhiều loại trực quan hóa để lựa chọn.</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png" alt="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png" tabindex="0" loading="lazy"><figcaption><a href="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png</a></figcaption></figure>
<p>Dưới đây là một số ví dụ về việc tạo biểu đồ:</p>
<h3>Pie</h3>
<p>Bạn có thể xây dựng biểu đồ trực quan từ tìm kiếm đã lưu hoặc nhập điều kiện tìm kiếm mới. Để nhập điều kiện tìm kiếm mới, trước tiên cần chọn một mô hình chỉ mục để xác định chỉ mục cần tìm kiếm.</p>
<p>Mặc định, tìm kiếm khớp với tất cả các tài liệu. Ban đầu, một "phần" chứa toàn bộ biểu đồ tròn:</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png" alt="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png" tabindex="0" loading="lazy"><figcaption><a href="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png</a></figcaption></figure>
<p>Để chỉ định dữ liệu nào được hiển thị trong biểu đồ, hãy sử dụng việc tổ chức chứa của Elasticsearch. Tổ chức chứa chỉ đơn giản là phân loại các tài liệu khớp với điều kiện tìm kiếm của bạn và được gọi là nhóm.</p>
<p>Xác định một tổ chức chứa cho mỗi phạm vi:</p>
<ol>
<li>Nhấp vào <code>Split Slices</code>.</li>
<li>Chọn <code>Terms</code> trong danh sách <code>Aggregation</code>. Lưu ý: Ở đây, "Terms" là trường hoặc nhãn đã được định nghĩa khi thu thập dữ liệu Elk.</li>
<li>Chọn <code>level.keyword</code> trong danh sách <code>Field</code>.</li>
<li>Nhấp vào nút <img src="https://www.elastic.co/guide/en/kibana/6.1/images/apply-changes-button.png" alt="images/apply-changes-button.png" loading="lazy"> để cập nhật biểu đồ.</li>
</ol>
<figure><img src="https://upload-images.jianshu.io/upload_images/3101171-7fb2042dc6d59520.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Sau khi hoàn thành, nếu bạn muốn lưu biểu đồ này, bạn có thể nhấp vào nút <code>Save</code> ở phía trên trang.</p>
<h3>Vertical Bar</h3>
<p>Chúng ta hãy xem cách tạo biểu đồ cột dọc.</p>
<ol>
<li>Nhấp vào <code>Create a visualization</code> màu xanh hoặc nút <code>+</code>. Chọn <code>Vertical Bar</code>.</li>
<li>Chọn mô hình chỉ mục. Vì bạn chưa xác định bất kỳ bucket nào, bạn sẽ thấy một thanh lớn hiển thị tổng số tài liệu khớp với truy vấn ký tự đại diện mặc định.</li>
<li>Xác định trường đại diện cho trục Y.</li>
<li>Xác định trường đại diện cho trục X.</li>
<li>Nhấp vào nút <img src="https://www.elastic.co/guide/en/kibana/6.1/images/apply-changes-button.png" alt="images/apply-changes-button.png" loading="lazy"> để cập nhật biểu đồ.</li>
</ol>
<figure><img src="https://upload-images.jianshu.io/upload_images/3101171-5aa7627284c19a56.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Sau khi hoàn thành, nếu bạn muốn lưu biểu đồ này, bạn có thể nhấp vào nút <code>Save</code> ở phía trên trang.</p>
<h2>Dashboard</h2>
<p><code>Dashboard</code> cho phép tổng hợp và chia sẻ tập hợp <code>Visualize</code>.</p>
<ol>
<li>Nhấp vào <code>Dashboard</code> trong thanh điều hướng bên.</li>
<li>Nhấp vào <code>Add</code> để hiển thị danh sách trực quan hóa đã lưu.</li>
<li>Nhấp vào <code>Visualize</code> đã lưu trước đó và sau đó nhấp vào mũi tên nhỏ ở cuối danh sách để đóng danh sách trực quan hóa.</li>
<li>Di chuột qua đối tượng trực quan sẽ hiển thị các điều khiển khung cho phép bạn chỉnh sửa, di chuyển, xóa và điều chỉnh kích thước đối tượng trực quan.</li>
</ol>
]]></content:encoded>
      <enclosure url="https://www.elastic.co/guide/en/kibana/current/images/tutorial-discover.png" type="image/png"/>
    </item>
    <item>
      <title>Kibana Operation</title>
      <link>https://vanhung4499.github.io/database/elastic/kibana-operation.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/kibana-operation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Kibana Operation</source>
      <description>Vận hành Kibana Thông qua Kibana, bạn có thể trực quan hóa Elasticsearch của mình và điều hướng trong Elastic Stack, cho phép bạn thực hiện các hoạt động khác nhau, từ theo dõi ...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Thông qua Kibana, bạn có thể trực quan hóa Elasticsearch của mình và điều hướng trong Elastic Stack, cho phép bạn thực hiện các hoạt động khác nhau, từ theo dõi tải truy vấn đến hiểu cách các yêu cầu chảy qua toàn bộ ứng dụng của bạn.</p>
<h2>1. Cài đặt</h2>
<h3>1.1. Yêu cầu hệ thống</h3>
<p>Phiên bản: Elastic Stack 7.4</p>
<h3>1.2. Các bước cài đặt</h3>
<p>Các bước cài đặt như sau:</p>
<ol>
<li>Tải gói phiên bản yêu cầu từ <a href="https://www.elastic.co/downloads/kibana" target="_blank" rel="noopener noreferrer">trang tải xuống chính thức của Kibana</a> và giải nén nó trên máy cục bộ của bạn.</li>
<li>Sửa tệp cấu hình <code>config/kibana.yml</code> và đặt <code>elasticsearch.url</code> để trỏ đến Elasticsearch của bạn.</li>
<li>Chạy <code>bin/kibana</code> (hoặc <code>bin\kibana.bat</code> trên Windows).</li>
<li>Truy cập Kibana trong trình duyệt của bạn tại địa chỉ <a href="http://localhost:5601" target="_blank" rel="noopener noreferrer">http://localhost:5601</a>.</li>
</ol>
<h2>2. Sử dụng</h2>
<h3>2.1. Khám phá (Discover)</h3>
<p>Nhấp vào <code>Discover</code> trong thanh điều hướng bên để truy cập chức năng truy vấn dữ liệu của Kibana.</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/current/images/tutorial-discover.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Trong thanh tìm kiếm, bạn có thể nhập các điều kiện truy vấn Elasticsearch để tìm kiếm dữ liệu của bạn. Bạn có thể duyệt qua kết quả trên trang <code>Discover</code> và tạo các trực quan hóa với các điều kiện tìm kiếm đã lưu trên trang <code>Visualize</code>.</p>
<p>Mẫu chỉ mục hiện tại được hiển thị dưới thanh tìm kiếm. Mẫu chỉ mục xác định các chỉ mục nào được tìm kiếm khi truy vấn được gửi. Để tìm kiếm một tập hợp chỉ mục khác, hãy chọn một mẫu khác từ menu thả xuống. Để thêm một mẫu chỉ mục, điều hướng đến <code>Management/Kibana/Index Patterns</code> và nhấp vào <code>Add New</code>.</p>
<p>Bạn có thể xây dựng các truy vấn bằng cách sử dụng tên trường và các giá trị quan tâm. Đối với các trường số, bạn có thể sử dụng các toán tử so sánh như lớn hơn (&gt;), nhỏ hơn (&lt;) hoặc bằng (=). Bạn có thể kết hợp các yếu tố với các toán tử logic <code>AND</code>, <code>OR</code> và <code>NOT</code>, tất cả viết hoa.</p>
<p>Mặc định, mỗi tài liệu khớp hiển thị tất cả các trường. Để chọn các trường tài liệu muốn hiển thị, di chuột qua danh sách "Các trường có sẵn" và nhấp vào nút thêm bên cạnh mỗi trường bạn muốn bao gồm. Ví dụ, nếu chỉ thêm account_number, hiển thị sẽ thay đổi thành một danh sách đơn giản chứa năm tài khoản:</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-discover-3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Thanh tìm kiếm trong Kibana tuân theo cú pháp chuỗi truy vấn được mô tả trong tài liệu <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html#query-string-syntax" target="_blank" rel="noopener noreferrer">query-string-syntax</a>.</p>
<p>Dưới đây là một số cú pháp truy vấn cơ bản nhất.</p>
<h4>2.1.1. Tên trường</h4>
<p>Như đã mô tả trong truy vấn chuỗi truy vấn, mặc định sẽ tìm kiếm trường default_field trong điều kiện tìm kiếm, nhưng bạn có thể chỉ định các trường khác trong cú pháp truy vấn:</p>
<p>Ví dụ:</p>
<ul>
<li>Tìm kiếm từ khóa "active" trong trường <code>status</code></li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>status:active</span></span></code></pre>
</div><ul>
<li>Tìm kiếm từ khóa "quick" hoặc "brown" trong trường <code>title</code>. Nếu bạn bỏ qua toán tử <code>OR</code>, toán tử mặc định sẽ được sử dụng.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>title:(quick OR brown)</span></span>
<span class="line"><span>title:(quick brown)</span></span></code></pre>
</div><ul>
<li>Tìm kiếm cụm từ chính xác "John Smith" trong trường <code>author</code>.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>author:"John Smith"</span></span></code></pre>
</div><ul>
<li>Tìm kiếm từ khóa "quick" hoặc "brown" trong bất kỳ trường nào (<code>book.title</code>, <code>book.content</code>, hoặc <code>book.date</code>). Lưu ý cách sử dụng <code>\*</code> để đại diện cho ký tự đại diện.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>book.\*:(quick brown)</span></span></code></pre>
</div><ul>
<li>Tìm kiếm các tài liệu có trường <code>title</code> chứa bất kỳ giá trị khác null nào.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>_exists_:title</span></span></code></pre>
</div><h4>2.1.2. Ký tự đại diện</h4>
<p>ELK cung cấp hai ký tự đại diện là <code>?</code> và <code>*</code>.</p>
<ul>
<li><code>?</code> đại diện cho bất kỳ ký tự duy nhất nào;</li>
<li><code>*</code> đại diện cho bất kỳ số ký tự nào, bao gồm cả không có ký tự.</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>qu?ck bro*</span></span></code></pre>
</div><blockquote>
<p><strong>Lưu ý: Truy vấn ký tự đại diện sẽ sử dụng nhiều bộ nhớ và có hiệu suất thực hiện kém, vì vậy hãy sử dụng cẩn thận.</strong> &gt; <strong>Gợi ý</strong>: Truy vấn ký tự đại diện thuần túy <code>*</code> được viết dưới dạng truy vấn <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="noopener noreferrer">exists</a> để cải thiện hiệu suất truy vấn. Do đó, truy vấn <code>field:*</code> sẽ khớp với các tài liệu chứa giá trị rỗng như <code>{ "field": "" }</code>, nhưng không khớp nếu trường bị mất hoặc giá trị được đặt thành null như <code>{ "field": null }</code>. &gt; <strong>Gợi ý</strong>: Truy vấn bằng ký tự đại diện ở đầu từ (ví dụ: <code>*ing</code>) có lượng truy vấn đặc biệt lớn, vì tất cả các thuật ngữ trong chỉ mục phải được kiểm tra trong trường hợp có khớp. Bằng cách đặt <code>allow_leading_wildcard</code> thành <code>false</code>, bạn có thể tắt tính năng này.</p>
</blockquote>
<h4>2.1.3. Biểu thức chính quy</h4>
<p>Bạn có thể sử dụng biểu thức chính quy bằng cách bao bọc nó trong dấu <code>/</code> trong chuỗi truy vấn.</p>
<p>Ví dụ:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>name:/joh?n(ath[oa]n)/</span></span></code></pre>
</div><p>Cú pháp biểu thức chính quy được hỗ trợ có thể được tham khảo tại: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html#regexp-syntax" target="_blank" rel="noopener noreferrer">Regular expression syntax</a></p>
<h4>2.1.4. Truy vấn mờ</h4>
<p>Chúng ta có thể sử dụng toán tử <code>~</code> để thực hiện truy vấn mờ.</p>
<p>Ví dụ:</p>
<p>Giả sử chúng ta thực sự muốn tìm kiếm</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quick brown forks</span></span></code></pre>
</div><p>Nhưng do lỗi chính tả, từ khóa truy vấn của chúng ta trở thành như sau, nhưng vẫn có thể tìm thấy kết quả mong muốn.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quikc~ brwn~ foks~</span></span></code></pre>
</div><p>Truy vấn mờ này sử dụng khoảng cách Damerau-Levenshtein để tìm tất cả các mục khớp có tối đa hai thay đổi. Thay đổi có thể là việc chèn, xóa hoặc thay thế một ký tự đơn, hoặc hoán đổi vị trí của hai ký tự liền kề.</p>
<p>Khoảng cách chỉnh sửa mặc định là <code>2</code>, nhưng khoảng cách chỉnh sửa là <code>1</code> thường đủ để bắt được 80% lỗi chính tả của con người. Nó có thể được chỉ định như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quikc~1</span></span></code></pre>
</div><h4>2.1.5. Tìm kiếm gần đúng</h4>
<p>Mặc dù truy vấn cụm từ (ví dụ: <code>john smith</code>) mong đợi tất cả các thuật ngữ trong cụm từ đó có cùng thứ tự hoàn toàn, nhưng tìm kiếm gần đúng cho phép chỉ định các từ cụ thể được tách ra hoặc sắp xếp theo thứ tự khác nhau. Giống như truy vấn mờ có thể chỉ định khoảng cách chỉnh sửa tối đa cho các ký tự trong từ, tìm kiếm gần đúng cũng cho phép chúng ta chỉ định khoảng cách chỉnh sửa tối đa cho các từ trong cụm từ:</p>
<p>Ví dụ:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>"fox quick"~5</span></span></code></pre>
</div><p>Càng gần văn bản trong trường với thứ tự ban đầu được chỉ định trong chuỗi truy vấn, tài liệu đó càng được coi là liên quan. So với truy vấn ví dụ trên, cụm từ <code>"quick fox"</code> sẽ được coi là gần giống điều kiện truy vấn hơn <code>"quick brown fox"</code>.</p>
<h4>2.1.6. Phạm vi</h4>
<p>Chúng ta có thể chỉ định phạm vi cho các trường ngày tháng, số hoặc chuỗi. Phạm vi đóng cửa được chỉ định bằng cặp dấu ngoặc vuông <code>[min TO max]</code> và phạm vi mở được chỉ định bằng cặp dấu ngoặc nhọn <code>{min TO max}</code>.</p>
<p>Hãy xem một số ví dụ.</p>
<ul>
<li>Tất cả các ngày trong năm 2012</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>date:[2012-01-01 TO 2012-12-31]</span></span></code></pre>
</div><ul>
<li>Số từ 1 đến 5</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>count:[1 TO 5]</span></span></code></pre>
</div><ul>
<li>Các nhãn nằm giữa <code>alpha</code> và <code>omega</code>, không bao gồm <code>alpha</code> và <code>omega</code></li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>tag:{alpha TO omega}</span></span></code></pre>
</div><ul>
<li>Số lớn hơn hoặc bằng 10</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>count:[10 TO *]</span></span></code></pre>
</div><ul>
<li>Tất cả các ngày trước năm 2012</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>date:{* TO 2012-01-01}</span></span></code></pre>
</div><p>Ngoài ra, phạm vi mở và đóng cũng có thể được kết hợp sử dụng</p>
<ul>
<li>Mảng từ 1 đến 5, nhưng không bao gồm số 5</li>
</ul>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>count:[1 TO 5}</span></span></code></pre>
</div><p>Phạm vi không bị ràng buộc ở một bên cũng có thể được sử dụng với cú pháp sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>age:&gt;10</span></span>
<span class="line"><span>age:&gt;=10</span></span>
<span class="line"><span>age:&lt;10</span></span>
<span class="line"><span>age:&lt;=10</span></span></code></pre>
</div><p>Tất nhiên, bạn cũng có thể sử dụng toán tử AND để lấy giao của hai kết quả truy vấn:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>age:(&gt;=10 AND &lt;20)</span></span>
<span class="line"><span>age:(+&gt;=10 +&lt;20)</span></span></code></pre>
</div><h4>2.1.7. Boosting</h4>
<p>Sử dụng toán tử <code>^</code> để làm cho một thuật ngữ quan trọng hơn một thuật ngữ khác. Ví dụ, nếu chúng ta muốn tìm kiếm tất cả các tài liệu liên quan đến con cáo, nhưng chúng ta đặc biệt quan tâm đến con cáo:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quick^2 fox</span></span></code></pre>
</div><p>Giá trị tăng cường mặc định là 1, nhưng nó có thể là bất kỳ số thực dương nào. Giá trị tăng cường từ 0 đến 1 giảm tính liên quan.</p>
<p>Tăng cường cũng có thể được áp dụng cho cụm từ hoặc nhóm:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>"john smith"^2   (foo bar)^4</span></span></code></pre>
</div><h4>2.1.8. Phép toán Boolean</h4>
<p>Mặc định, chỉ cần một từ khớp, tất cả các từ đều là tùy chọn. Tìm kiếm <code>foo bar baz</code> sẽ tìm kiếm bất kỳ tài liệu nào chứa một hoặc nhiều từ trong <code>foo</code>, <code>bar</code> hoặc <code>baz</code>. Chúng ta đã thảo luận về <code>default_operator</code> ở trên, cho phép bạn yêu cầu tất cả các mục, nhưng cũng có các toán tử Boolean có thể sử dụng trong chuỗi truy vấn để cung cấp sự kiểm soát nhiều hơn.</p>
<p>Các toán tử được ưu tiên sử dụng là <code>+</code> (thuật ngữ này phải tồn tại) và <code>-</code> (thuật ngữ này không được tồn tại). Tất cả các thuật ngữ khác là tùy chọn. Ví dụ, truy vấn này:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>quick brown +fox -news</span></span></code></pre>
</div><p>Truy vấn này có nghĩa là:</p>
<ul>
<li><code>fox</code> phải tồn tại</li>
<li><code>news</code> không được tồn tại</li>
<li><code>quick</code> và <code>brown</code> là tùy chọn</li>
</ul>
<p>Các toán tử quen thuộc <code>AND</code>, <code>OR</code> và <code>NOT</code> (cũng có thể được viết là <code>&amp;&amp;</code>, <code>||</code> và <code>!</code>) cũng được hỗ trợ. Tuy nhiên, các toán tử này có mức độ ưu tiên nhất định: <code>NOT</code> ưu tiên hơn <code>AND</code>, <code>AND</code> ưu tiên hơn <code>OR</code>. Mặc dù <code>+</code> và <code>-</code> chỉ ảnh hưởng đến thuật ngữ bên phải của toán tử, nhưng <code>AND</code> và <code>OR</code> ảnh hưởng đến cả thuật ngữ bên trái và bên phải.</p>
<h4>2.1.9. Nhóm</h4>
<p>Nhiều thuật ngữ hoặc mệnh đề có thể được kết hợp trong cặp dấu ngoặc tròn để tạo thành một truy vấn con:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>(quick OR brown) AND fox</span></span></code></pre>
</div><p>Có thể sử dụng nhóm để xác định trường cụ thể hoặc cải thiện kết quả của truy vấn con:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>status:(active OR pending) title:(full text search)^2</span></span></code></pre>
</div><h4>2.1.10. Từ khóa đặc biệt</h4>
<p>Nếu bạn cần sử dụng bất kỳ ký tự nào trong truy vấn của mình là một toán tử (thay vì một toán tử), bạn nên sử dụng dấu gạch chéo ngược để tránh chúng. Ví dụ, để tìm kiếm (1 + 1) = 2, bạn cần viết truy vấn là <code>\(1\+1\)\=2</code></p>
<p>Các ký tự đặc biệt là: <code>+ - = &amp;&amp; || &gt; &lt; ! ( ) { } [ ] ^ " ~ * ? : \ /</code></p>
<p>Không thể thoát các ký tự đặc biệt này một cách chính xác có thể dẫn đến lỗi cú pháp và ngăn truy vấn của bạn hoạt động.</p>
<h4>2.1.11. Truy vấn trống</h4>
<p>Nếu chuỗi truy vấn là trống hoặc chỉ chứa khoảng trắng, truy vấn sẽ tạo ra một tập kết quả trống.</p>
<h3>2.2. Trực quan hóa</h3>
<p>Để hiển thị dữ liệu của bạn dưới dạng trực quan, hãy nhấp vào <code>Visualize</code> trong thanh điều hướng bên.</p>
<p>Công cụ Visualize cho phép bạn xem dữ liệu theo nhiều cách khác nhau, chẳng hạn như biểu đồ tròn, biểu đồ cột, biểu đồ đường, biểu đồ phân phối, v.v. Để bắt đầu, hãy nhấp vào <code>Create a visualization</code> hoặc nút <code>+</code> màu xanh lá cây.</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png" alt="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png" tabindex="0" loading="lazy"><figcaption><a href="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-landing.png</a></figcaption></figure>
<p>Có nhiều loại trực quan hóa để lựa chọn.</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png" alt="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png" tabindex="0" loading="lazy"><figcaption><a href="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-wizard-step-1.png</a></figcaption></figure>
<p>Dưới đây, chúng ta sẽ tạo một số ví dụ biểu đồ:</p>
<h4>2.2.1. Pie</h4>
<p>Bạn có thể xây dựng một trực quan hóa từ tìm kiếm đã lưu hoặc nhập điều kiện tìm kiếm mới. Để nhập điều kiện tìm kiếm mới, trước tiên bạn cần chọn một mẫu chỉ mục để xác định chỉ mục bạn muốn tìm kiếm.</p>
<p>Mặc định, tìm kiếm khớp với tất cả các tài liệu. Ban đầu, một "miếng" chứa toàn bộ biểu đồ tròn:</p>
<figure><img src="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png" alt="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png" tabindex="0" loading="lazy"><figcaption><a href="https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/kibana/6.1/images/tutorial-visualize-pie-1.png</a></figcaption></figure>
<p>Để chỉ định dữ liệu nào hiển thị trong biểu đồ, hãy sử dụng bucket aggregation của Elasticsearch. Grouping aggregation chỉ là việc phân loại tài liệu khớp với điều kiện tìm kiếm của bạn thành các danh mục khác nhau, còn được gọi là bucket.</p>
<p>Định nghĩa một bucket cho mỗi phạm vi:</p>
<ol>
<li>Nhấp vào <code>Split Slices</code>.</li>
<li>Chọn <code>Terms</code> trong danh sách <code>Aggregation</code>. <em>Lưu ý: Các thuật ngữ ở đây là các trường hoặc nhãn đã được xác định khi thu thập dữ liệu Elk</em>.</li>
<li>Chọn <code>level.keyword</code> trong danh sách <code>Field</code>.</li>
<li>Nhấp vào <img src="https://www.elastic.co/guide/en/kibana/6.1/images/apply-changes-button.png" alt="images/apply-changes-button.png" loading="lazy"> để cập nhật biểu đồ.</li>
</ol>
<figure><img src="https://upload-images.jianshu.io/upload_images/3101171-7fb2042dc6d59520.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Sau khi hoàn thành, nếu bạn muốn lưu biểu đồ này, bạn có thể nhấp vào nút <code>Save</code> ở phía trên trang.</p>
<h4>2.2.2. Vertical Bar</h4>
<p>Chúng ta sẽ xem cách tạo biểu đồ cột dọc.</p>
<ol>
<li>Nhấp vào <code>Create a visualization</code> hoặc nút <code>+</code> màu xanh lá cây. Chọn <code>Vertical Bar</code>.</li>
<li>Chọn mẫu chỉ mục. Vì bạn chưa xác định bất kỳ bucket nào, bạn sẽ thấy một thanh lớn hiển thị tổng số tài liệu khớp với truy vấn mặc định.</li>
<li>Chỉ định trường đại diện cho trục Y.</li>
<li>Chỉ định trường đại diện cho trục X.</li>
<li>Nhấp vào <img src="https://www.elastic.co/guide/en/kibana/6.1/images/apply-changes-button.png" alt="images/apply-changes-button.png" loading="lazy"> để cập nhật biểu đồ.</li>
</ol>
<figure><img src="https://upload-images.jianshu.io/upload_images/3101171-5aa7627284c19a56.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Sau khi hoàn thành, nếu bạn muốn lưu biểu đồ này, bạn có thể nhấp vào nút <code>Save</code> ở phía trên trang.</p>
<h3>2.3. Báo cáo</h3>
<p><code>Báo cáo (Dashboard)</code> cho phép tổng hợp và chia sẻ tập hợp <code>Visualize</code>.</p>
<ol>
<li>Nhấp vào <code>Dashboard</code> trong thanh điều hướng bên.</li>
<li>Nhấp vào <code>Thêm hiển thị từ danh sách Visualize đã lưu</code>.</li>
<li>Nhấp vào <code>Visualize</code> đã lưu trước đó, sau đó nhấp vào mũi tên nhỏ ở cuối danh sách để đóng danh sách Visualize.</li>
<li>Khi di chuột qua đối tượng Visualize, các điều khiển container sẽ hiển thị cho phép bạn chỉnh sửa, di chuyển, xóa và điều chỉnh kích thước đối tượng Visualize.</li>
</ol>
<h2>3. FAQ</h2>
<h3>3.1. Cảnh báo Kibana No Default Index Pattern</h3>
<p><strong>Câu hỏi:</strong> Sau khi cài đặt ELK, khi truy cập trang Kibana, tôi nhận được cảnh báo lỗi sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Warning No default index pattern. You must select or create one to continue.</span></span>
<span class="line"><span>...</span></span>
<span class="line"><span>Unable to fetch mapping. Do you have indices matching the pattern?</span></span></code></pre>
</div><p>Điều này cho thấy logstash không ghi nhật ký vào elasticsearch.</p>
<p><strong>Giải pháp:</strong></p>
<p>Kiểm tra xem có vấn đề gì về giao tiếp giữa logstash và elasticsearch, thường là vấn đề nằm ở đây.</p>
<h2>4. Tài liệu tham khảo</h2>
<ul>
<li><a href="https://www.elastic.co/cn/products/kibana" target="_blank" rel="noopener noreferrer">Trang web chính thức của Kibana</a></li>
<li><a href="https://github.com/elastic/kibana" target="_blank" rel="noopener noreferrer">Kibana Github</a></li>
<li><a href="https://www.elastic.co/guide/en/kibana/current/index.html" target="_blank" rel="noopener noreferrer">Tài liệu chính thức của Kibana</a></li>
</ul>
]]></content:encoded>
      <enclosure url="https://www.elastic.co/guide/en/kibana/current/images/tutorial-discover.png" type="image/png"/>
    </item>
    <item>
      <title>Logstash Operation</title>
      <link>https://vanhung4499.github.io/database/elastic/logstash-operation.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/logstash-operation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Logstash Operation</source>
      <description>Dưới đây là bản dịch sang tiếng Việt của đoạn văn bạn yêu cầu: Vận hành Logstash Logstash là một pipeline xử lý dữ liệu phía máy chủ mã nguồn mở, có khả năng thu thập dữ liệu từ...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[<p>Dưới đây là bản dịch sang tiếng Việt của đoạn văn bạn yêu cầu:</p>
<h1>Vận hành Logstash</h1>
<blockquote>
<p><a href="https://github.com/elastic/logstash" target="_blank" rel="noopener noreferrer">Logstash</a> là một pipeline xử lý dữ liệu phía máy chủ mã nguồn mở, có khả năng thu thập dữ liệu từ nhiều nguồn, chuyển đổi dữ liệu và sau đó gửi dữ liệu đến "kho lưu trữ" yêu thích của bạn.</p>
</blockquote>
<h2>1. Cài đặt</h2>
<h3>1.1. Các bước cài đặt</h3>
<p>Các bước cài đặt như sau:</p>
<p>(1) Tải xuống gói phiên bản mong muốn từ <a href="https://www.elastic.co/downloads/logstash" target="_blank" rel="noopener noreferrer">địa chỉ tải xuống chính thức của logstash</a> và giải nén nó vào máy cục bộ.</p>
<p>(2) Thêm tệp <code>logstash.conf</code>, chỉ định các plugin bạn muốn sử dụng và cấu hình cho mỗi plugin. Dưới đây là một ví dụ đơn giản:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>input { stdin { } }</span></span>
<span class="line"><span>output {</span></span>
<span class="line"><span>  elasticsearch { hosts =&gt; ["localhost:9200"] }</span></span>
<span class="line"><span>  stdout { codec =&gt; rubydebug }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>(3) Chạy lệnh <code>bin/logstash -f logstash.conf</code> (trên Windows, chạy <code>bin/logstash.bat -f logstash.conf</code>)</p>
<h2>2. Cấu hình</h2>
<h3>2.1. Tệp cấu hình</h3>
<ul>
<li><strong><code>logstash.yml</code></strong>: Tệp cấu hình khởi động mặc định của logstash.</li>
<li><strong><code>jvm.options</code></strong>: Tệp cấu hình JVM của logstash.</li>
<li><strong><code>startup.options</code></strong> (Linux): Chứa các tùy chọn được sử dụng bởi tập lệnh cài đặt hệ thống trong <code>/usr/share/logstash/bin</code> để xây dựng các tập lệnh khởi động phù hợp cho hệ thống của bạn. Khi cài đặt gói logstash, tập lệnh cài đặt hệ thống sẽ được thực thi khi quá trình cài đặt kết thúc và sử dụng các cài đặt được chỉ định trong <code>startup.options</code> để đặt người dùng, nhóm, tên dịch vụ và mô tả dịch vụ.</li>
</ul>
<h3>2.2. Các mục cấu hình trong logstash.yml</h3>
<p>Dưới đây là một số mục cấu hình được trích dẫn, vui lòng xem thêm tại: <a href="https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html</a></p>
<p>| Tham số                    | Mô tả                                                                                                                                                                                                                                                                                                                                                            | Giá trị mặc định                                                                                                                         |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/3101171-cd876d79a14955b0.png" type="image/png"/>
    </item>
    <item>
      <title>Logstash</title>
      <link>https://vanhung4499.github.io/database/elastic/logstash.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/logstash.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Logstash</source>
      <description>Elastic Stack: Logstash Bài viết này tập trung vào Logstash, một thành phần của Elastic Technology Stack (ELK). Nếu bạn không quen với cách cài đặt, cấu hình và triển khai Elast...</description>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Bài viết này tập trung vào Logstash, một thành phần của Elastic Technology Stack (ELK).</p>
<p>Nếu bạn không quen với cách cài đặt, cấu hình và triển khai Elastic, bạn có thể tham khảo hướng dẫn: [[Elastic Quick Start|Bắt đầu nhanh với Elastic Technology Stack]])</p>
</blockquote>
<h2>Giới thiệu</h2>
<p>Logstash được sử dụng để vận chuyển và xử lý các logs, giao dịch hoặc dữ liệu khác của bạn.</p>
<h3>Tính năng</h3>
<p>Logstash là ống dẫn dữ liệu tốt nhất cho Elasticsearch.</p>
<p>Logstash tuân theo kiến trúc dựa trên plugin, cho phép tùy chỉnh thông qua các plugin ở các giai đoạn input, filter, output và codec. Cộng đồng Logstash cung cấp hơn 200 plugin có sẵn.</p>
<h3>Cách hoạt động</h3>
<p>Logstash bao gồm ba yếu tố cơ bản: <code>input</code>, <code>filter</code> và <code>output</code>. Có một yếu tố tùy chọn là <code>codec</code>.</p>
<p>Ba yếu tố này đại diện cho ba giai đoạn xử lý sự kiện của Logstash: input &gt; filter &gt; output.</p>
<figure><img src="https://www.elastic.co/guide/en/logstash/current/static/images/basic_logstash_pipeline.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<ul>
<li><code>input</code> có trách nhiệm thu thập dữ liệu từ nguồn dữ liệu.</li>
<li><code>filter</code> sửa đổi dữ liệu thành định dạng hoặc nội dung được chỉ định.</li>
<li><code>output</code> chuyển dữ liệu đến đích của nó.</li>
</ul>
<p>Trong các kịch bản thực tế, thường có nhiều input, output và filter. Logstash cho phép người dùng chọn và kết hợp các plugin cho mỗi giai đoạn dựa trên nhu cầu ứng dụng của họ.</p>
<p>Chi tiết về các plugin sẽ được thảo luận sau.</p>
<h2>Cấu hình</h2>
<h3>Tệp cấu hình</h3>
<ul>
<li><strong><code>logstash.yml</code></strong>: Tệp cấu hình khởi động mặc định cho Logstash.</li>
<li><strong><code>jvm.options</code></strong>: Tệp cấu hình JVM cho Logstash.</li>
<li><strong><code>startup.options</code></strong> (Linux): Chứa các tùy chọn được sử dụng bởi tập lệnh cài đặt hệ thống trong <code>/usr/share/logstash/bin</code> để xây dựng các tập lệnh khởi động phù hợp cho hệ thống của bạn. Tập lệnh cài đặt hệ thống được thực thi trong quá trình cài đặt và đặt các tùy chọn như người dùng, nhóm, tên dịch vụ và mô tả dịch vụ dựa trên các thiết lập được chỉ định trong <code>startup.options</code>.</li>
</ul>
<h3>Cài đặt logstash.yml</h3>
<p>Dưới đây là một số cài đặt được chọn lọc. Để biết thêm tùy chọn, vui lòng tham khảo: <a href="https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html" target="_blank" rel="noopener noreferrer">https://www.elastic.co/guide/en/logstash/current/logstash-settings-file.html</a></p>
<p>| Tham số                    | Mô tả                                                                                                                                                                                                                                                                                                                                                         | Giá trị mặc định                                                                                                                            |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://www.elastic.co/guide/en/logstash/current/static/images/basic_logstash_pipeline.png" type="image/png"/>
    </item>
    <item>
      <title>Elastic Overview</title>
      <link>https://vanhung4499.github.io/database/elastic/overview.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/overview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elastic Overview</source>
      <description>Elastic Stack Overview Elastic Stack thường được sử dụng làm giải pháp cho việc thu thập, truy xuất và trực quan hóa nhật ký (log). ELK là viết tắt của ba sản phẩm thuộc công ty...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><strong>Elastic Stack thường được sử dụng làm giải pháp cho việc thu thập, truy xuất và trực quan hóa nhật ký (log).</strong></p>
<p>ELK là viết tắt của ba sản phẩm thuộc công ty Elastic:&nbsp;<a href="https://www.elastic.co/products/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>,&nbsp;<a href="https://www.elastic.co/products/logstash" target="_blank" rel="noopener noreferrer">Logstash</a>&nbsp;và&nbsp;<a href="https://www.elastic.co/products/kibana" target="_blank" rel="noopener noreferrer">Kibana</a>.</p>
<p><a href="https://www.elastic.co/products/logstash" target="_blank" rel="noopener noreferrer">Logstash</a>&nbsp;được sử dụng để truyền và xử lý nhật ký, giao dịch hoặc dữ liệu khác.</p>
<p><a href="https://www.elastic.co/products/kibana" target="_blank" rel="noopener noreferrer">Kibana</a>&nbsp;được sử dụng để phân tích dữ liệu từ Elasticsearch và hiển thị chúng dưới dạng báo cáo trực quan.</p>
<p>Elastic Stack đã mở rộng thêm một số sản phẩm mới trên cơ sở của ELK, chẳng hạn như:&nbsp;<a href="https://www.elastic.co/products/beats" target="_blank" rel="noopener noreferrer">Beats</a>&nbsp;và&nbsp;<a href="https://www.elastic.co/products/x-pack" target="_blank" rel="noopener noreferrer">X-Pack</a>.</p>
</blockquote>
<h2>📖 Contents</h2>
]]></content:encoded>
    </item>
    <item>
      <title>Elastic Quick Start</title>
      <link>https://vanhung4499.github.io/database/elastic/quick-start.html</link>
      <guid>https://vanhung4499.github.io/database/elastic/quick-start.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elastic Quick Start</source>
      <description>1. Hướng dẫn nhanh về Elastic Giấy phép mã nguồn mở: Apache 2.0 1. Giới thiệu 1.1. Elastic Stack là gì Elastic Stack còn được gọi là ELK Stack. ELK là viết tắt của ba sản phẩm c...</description>
      <category>elastic</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[<h2>1. Hướng dẫn nhanh về Elastic</h2>
<blockquote>
<p>Giấy phép mã nguồn mở: <a href="https://github.com/elastic/elasticsearch/tree/7.4/licenses/APACHE-LICENSE-2.0.txt" target="_blank" rel="noopener noreferrer">Apache 2.0</a></p>
</blockquote>
<h2>1. Giới thiệu</h2>
<h3>1.1. Elastic Stack là gì</h3>
<p><strong>Elastic Stack</strong> còn được gọi là <strong>ELK Stack</strong>.</p>
<p>ELK là viết tắt của ba sản phẩm của công ty Elastic: <a href="https://www.elastic.co/cn/products/elasticsearch" target="_blank" rel="noopener noreferrer">ElasticSearch</a>, <a href="https://www.elastic.co/cn/products/logstash" target="_blank" rel="noopener noreferrer">Logstash</a>, và <a href="https://www.elastic.co/cn/products/kibana" target="_blank" rel="noopener noreferrer">Kibana</a>.</p>
<ul>
<li>Elasticsearch là một công cụ tìm kiếm và phân tích.</li>
<li>Logstash là một pipeline xử lý dữ liệu phía máy chủ, có khả năng thu thập dữ liệu từ nhiều nguồn cùng một lúc, chuyển đổi dữ liệu, sau đó gửi dữ liệu đến các "kho lưu trữ" như Elasticsearch.</li>
<li>Kibana cho phép người dùng trực quan hóa dữ liệu trong Elasticsearch bằng các biểu đồ và biểu đồ.</li>
</ul>
<p>Elastic Stack là phiên bản cập nhật của ELK Stack, sản phẩm mới nhất đã giới thiệu các bộ thu thập dữ liệu chức năng đơn lẻ nhẹ và đặt tên cho chúng là <a href="https://www.elastic.co/beats" target="_blank" rel="noopener noreferrer">Beats</a>.</p>
<h3>1.2. Tại sao sử dụng Elastic Stack</h3>
<p>Đối với các công ty có quy mô nhất định, thường sẽ có nhiều ứng dụng và được triển khai trên một số lượng lớn máy chủ. Nhân viên vận hành và phát triển thường cần xem nhật ký để xác định vấn đề. Nếu ứng dụng được triển khai theo cụm, hãy tưởng tượng nếu bạn đăng nhập vào từng máy chủ để xem nhật ký, điều này sẽ tốn nhiều thời gian và công sức.</p>
<p>Với giải pháp ELK, bạn có thể thu thập, tìm kiếm và phân tích nhật ký cùng một lúc.</p>
<h3>1.3. Kiến trúc Elastic Stack</h3>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/deploy3.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<blockquote>
<p><strong>Giải thích</strong></p>
<p>Đây là một sơ đồ kiến trúc của Elastic Stack. Từ hình trên, bạn có thể rõ ràng thấy hướng dòng dữ liệu.</p>
<ul>
<li><a href="https://www.elastic.co/products/beats" target="_blank" rel="noopener noreferrer">Beats</a> là một nền tảng truyền dữ liệu đơn chức năng, nó có thể gửi dữ liệu từ nhiều máy chủ đến Logstash hoặc ElasticSearch. Tuy nhiên, Beats không phải là một phần không thể thiếu, vì vậy bài viết này sẽ không giới thiệu.</li>
<li><a href="https://www.elastic.co/products/logstash" target="_blank" rel="noopener noreferrer">Logstash</a> là một pipeline thu thập dữ liệu động. Hỗ trợ thu thập dữ liệu theo nhiều cách như TCP/UDP/HTTP (cũng có thể nhận dữ liệu được Beats truyền đến), và xử lý dữ liệu để làm giàu hoặc trích xuất trường.</li>
<li><a href="https://www.elastic.co/products/elasticsearch" target="_blank" rel="noopener noreferrer">ElasticSearch</a> là một công cụ tìm kiếm và phân tích phân tán dựa trên JSON. Là trung tâm của ELK, nó lưu trữ dữ liệu tập trung.</li>
<li><a href="https://www.elastic.co/products/kibana" target="_blank" rel="noopener noreferrer">Kibana</a> là giao diện người dùng của ELK. Nó trực quan hóa dữ liệu đã thu thập (các báo cáo, dữ liệu hình học) và cung cấp giao diện để cấu hình, quản lý ELK.</li>
</ul>
</blockquote>
<h2>2. ElasticSearch</h2>
<blockquote>
<p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>&nbsp;là một công cụ tìm kiếm và phân tích dữ liệu phong cách RESTful, phân tán, có thể giải quyết nhiều trường hợp sử dụng xuất hiện liên tục. Là trung tâm của Elastic Stack, nó lưu trữ dữ liệu của bạn, giúp bạn khám phá các tình huống dự kiến và không dự kiến.</p>
</blockquote>
<h3>2.1. Giới thiệu về ElasticSearch</h3>
<p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>&nbsp;được phát triển dựa trên thư viện tìm kiếm&nbsp;<a href="https://github.com/apache/lucene-solr" target="_blank" rel="noopener noreferrer">Lucene</a>. Elasticsearch giấu đi sự phức tạp của Lucene, cung cấp giao diện API REST / Java dễ sử dụng (cũng như các giao diện API bằng ngôn ngữ khác).</p>
<p>Elasticsearch có thể được xem như một kho lưu trữ tài liệu, nơi nó&nbsp;<strong>chuyển đổi các cấu trúc dữ liệu phức tạp thành JSON để lưu trữ</strong>.</p>
<p><strong>ElasticSearch là một công cụ tìm kiếm toàn văn gần như thời gian thực</strong>, điều này có nghĩa là:</p>
<ul>
<li>Từ khi ghi dữ liệu đến khi dữ liệu có thể được tìm kiếm, có một độ trễ nhỏ (khoảng 1s)</li>
<li>Các hoạt động tìm kiếm và phân tích dựa trên ES có thể đạt được mức độ giây</li>
</ul>
<h4>2.1.1. Khái niệm cốt lõi</h4>
<ul>
<li><strong><code>Index</code></strong>&nbsp;có thể được coi là một tập hợp tối ưu của các tài liệu (document).</li>
<li>Mỗi&nbsp;<strong><code>document</code></strong>&nbsp;là một tập hợp các trường (field).</li>
<li><strong><code>Field</code></strong>&nbsp;là một cặp giá trị key-value chứa dữ liệu.</li>
<li>Theo mặc định, Elasticsearch xây dựng chỉ mục cho tất cả dữ liệu trong mỗi trường và mỗi trường chỉ mục đều có cấu trúc dữ liệu tối ưu hóa riêng.</li>
<li>Mỗi chỉ mục có thể có một hoặc nhiều loại (type).&nbsp;<code>Type</code>&nbsp;là một phân loại logic của chỉ mục,</li>
<li>Khi một máy không đủ để lưu trữ dữ liệu lớn, Elasticsearch có thể chia dữ liệu trong một chỉ mục thành nhiều&nbsp;<strong><code>shard</code></strong>.&nbsp;<strong><code>Shard</code></strong>&nbsp;được lưu trữ trên nhiều máy chủ. Với shard, bạn có thể mở rộng theo chiều ngang, lưu trữ nhiều dữ liệu hơn, cho phép các hoạt động tìm kiếm và phân tích được phân phối trên nhiều máy chủ, tăng cường throughput và hiệu suất. Mỗi shard đều là một chỉ mục lucene.</li>
<li>Bất kỳ máy chủ nào cũng có thể gặp sự cố hoặc bị tắt bất cứ lúc nào, lúc này shard có thể bị mất, do đó, bạn có thể tạo nhiều&nbsp;<strong><code>replica</code></strong>&nbsp;cho mỗi shard. Replica có thể cung cấp dịch vụ dự phòng khi shard gặp sự cố, đảm bảo dữ liệu không bị mất, nhiều replica cũng có thể tăng cường throughput và hiệu suất của hoạt động tìm kiếm. Primary shard (được thiết lập khi tạo chỉ mục, không thể sửa đổi, mặc định là 5), replica shard (có thể thay đổi số lượng bất cứ lúc nào, mặc định là 1), mặc định mỗi chỉ mục có 10 shard, 5 primary shard, 5 replica shard, cấu hình có sẵn tối thiểu, là 2 máy chủ.</li>
</ul>
<h3>2.2. Nguyên lý ElasticSearch</h3>
<h4>2.2.1. Quá trình ghi dữ liệu ES</h4>
<ul>
<li>Máy khách chọn một node và gửi yêu cầu đến, node này được gọi là&nbsp;<code>coordinating node</code>&nbsp;(nút điều phối).</li>
<li><code>Coordinating node</code>&nbsp;thực hiện&nbsp;<strong>định tuyến</strong>&nbsp;cho document và chuyển tiếp yêu cầu đến node tương ứng (có primary shard).</li>
<li><code>Primary shard</code>&nbsp;trên node thực tế xử lý yêu cầu, sau đó đồng bộ hóa dữ liệu với&nbsp;<code>replica node</code>.</li>
<li>Nếu&nbsp;<code>coordinating node</code>&nbsp;phát hiện&nbsp;<code>primary node</code>&nbsp;và tất cả&nbsp;<code>replica node</code>&nbsp;đều đã hoàn thành, nó sẽ trả lại kết quả phản hồi cho máy khách.</li>
</ul>
<h4>2.2.2. Quá trình đọc dữ liệu es</h4>
<p>Bạn có thể tìm kiếm theo&nbsp;<code>doc id</code>, sẽ dựa trên&nbsp;<code>doc id</code>&nbsp;để thực hiện hash, xác định xem lúc đó&nbsp;<code>doc id</code>&nbsp;đã được phân bổ vào shard nào, từ shard đó để tìm kiếm.</p>
<ul>
<li>Máy khách gửi yêu cầu đến&nbsp;<strong>bất kỳ</strong>&nbsp;một node, trở thành&nbsp;<code>coordinate node</code>.</li>
<li><code>Coordinate node</code>&nbsp;định tuyến&nbsp;<code>doc id</code>&nbsp;theo hash, chuyển yêu cầu đến node tương ứng, lúc này sẽ sử dụng thuật toán&nbsp;<strong>round-robin ngẫu nhiên</strong>, chọn ngẫu nhiên một trong số&nbsp;<code>primary shard</code>&nbsp;và tất cả các replica của nó, để cân bằng tải yêu cầu đọc.</li>
<li>Node nhận yêu cầu trả về document cho&nbsp;<code>coordinate node</code>.</li>
<li><code>Coordinate node</code>&nbsp;trả về document cho máy khách.</li>
</ul>
<h4>2.2.3. Nguyên lý cơ bản của việc ghi dữ liệu</h4>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223111949.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Đầu tiên, dữ liệu sẽ được ghi vào bộ đệm trong bộ nhớ (buffer), trong quá trình này dữ liệu không thể được tìm kiếm; đồng thời dữ liệu cũng được ghi vào tệp nhật ký translog.</p>
<p>Nếu bộ đệm gần như đầy, hoặc sau một khoảng thời gian nhất định, dữ liệu trong bộ đệm sẽ được&nbsp;<code>refresh</code>&nbsp;vào một&nbsp;<code>segment file</code>&nbsp;mới, nhưng lúc này dữ liệu không được ghi trực tiếp vào tệp&nbsp;<code>segment file</code> trên đĩa, mà phải đi vào&nbsp;<code>os cache</code>&nbsp;trước. Quá trình này được gọi là&nbsp;<code>refresh</code>.</p>
<p>Mỗi giây, ES sẽ ghi dữ liệu trong bộ đệm vào một&nbsp;<code>segment file</code>&nbsp;<strong>mới</strong>, mỗi giây sẽ tạo ra một tệp đĩa <code>segment file</code>&nbsp;<strong>mới</strong>, tệp&nbsp;<code>segment file</code> này sẽ lưu trữ dữ liệu được ghi vào bộ đệm trong 1 giây gần đây.</p>
<p>Tuy nhiên, nếu không có dữ liệu trong bộ đệm, thì tất nhiên không có quá trình refresh nào được thực hiện, nếu có dữ liệu trong bộ đệm, mặc định sẽ thực hiện một lần refresh mỗi giây, đẩy dữ liệu vào một&nbsp;<code>segment file</code>&nbsp;mới.</p>
<p>Trên hệ điều hành, tệp đĩa thực tế đều có một thứ gọi là&nbsp;<code>os cache</code>, tức là trước khi dữ liệu được ghi vào tệp đĩa, nó sẽ được đưa vào&nbsp;<code>os cache</code> trước, đầu tiên vào bộ nhớ cache cấp hệ điều hành. Chỉ cần dữ liệu trong bộ đệm được chuyển vào&nbsp;<code>os cache</code>&nbsp;thông qua hoạt động refresh, dữ liệu này có thể được tìm kiếm.</p>
<p>Tại sao nói rằng ES là&nbsp;<strong>gần như thời gian thực</strong>?&nbsp;<code>NRT</code>, tên đầy đủ là&nbsp;<code>near real-time</code>. Mặc định là refresh mỗi giây một lần, vì vậy ES là gần như thời gian thực, vì dữ liệu được ghi vào sau 1 giây mới có thể được tìm thấy. Bạn có thể sử dụng&nbsp;<code>restful api</code>&nbsp;của es hoặc&nbsp;<code>java api</code>&nbsp;để thực hiện một hoạt động refresh&nbsp;<strong>thủ công</strong>, tức là thủ công đưa dữ liệu trong bộ đệm vào&nbsp;<code>os cache</code>, để dữ liệu có thể được tìm kiếm ngay lập tức. Miễn là dữ liệu được đưa vào&nbsp;<code>os cache</code>, bộ đệm sẽ được làm sạch, vì không cần giữ bộ đệm nữa, dữ liệu đã được lưu trữ trong tệp nhật ký translog một lần.</p>
<p>Lặp lại các bước trên, dữ liệu mới liên tục vào bộ đệm và translog, liên tục ghi dữ liệu&nbsp;<code>buffer</code>&nbsp;vào một&nbsp;<code>segment file</code>&nbsp;mới sau mỗi lần&nbsp;<code>refresh</code>, sau mỗi lần&nbsp;<code>refresh</code>&nbsp;bộ đệm sẽ được làm sạch, translog sẽ được giữ lại. Khi quá trình này tiếp diễn, translog sẽ ngày càng lớn. Khi translog đạt đến một độ dài nhất định, nó sẽ kích hoạt hoạt động&nbsp;<code>commit</code>.</p>
<p>Bước đầu tiên của hoạt động commit là ghi dữ liệu hiện có trong bộ đệm vào&nbsp;<code>os cache</code>, sau đó làm sạch bộ đệm. Sau đó, ghi một&nbsp;<code>commit point</code>&nbsp;vào tệp đĩa, trong đó đánh dấu tất cả các&nbsp;<code>segment file</code>&nbsp;tương ứng với&nbsp;<code>commit point</code>&nbsp;này, đồng thời buộc&nbsp;<code>os cache</code>&nbsp;chứa tất cả dữ liệu hiện tại để được&nbsp;<code>fsync</code>&nbsp;vào tệp đĩa. Cuối cùng,&nbsp;<strong>xóa</strong>&nbsp;tệp nhật ký translog hiện tại, khởi động lại một translog, lúc này hoạt động commit đã hoàn thành.</p>
<p>Hoạt động commit này được gọi là&nbsp;<code>flush</code>. Mặc định là mỗi 30 phút tự động thực hiện một lần&nbsp;<code>flush</code>, nhưng nếu translog quá lớn, cũng sẽ kích hoạt&nbsp;<code>flush</code>. Hoạt động flush tương ứng với toàn bộ quá trình commit, chúng ta có thể thông qua api của es, thực hiện thủ công hoạt động flush, thủ công&nbsp;<code>fsync</code>&nbsp;dữ liệu trong&nbsp;<code>os cache</code>&nbsp;vào đĩa.</p>
<p>Tệp nhật ký translog có vai trò gì? Trước khi bạn thực hiện hoạt động commit, dữ liệu có thể đang nằm trong bộ đệm hoặc nằm trong&nbsp;<code>os cache</code>. Dù là bộ đệm hay&nbsp;<code>os cache</code>&nbsp;đều là bộ nhớ, nếu máy này bị hỏng, dữ liệu trong bộ nhớ sẽ mất hết. Vì vậy, cần ghi các hoạt động tương ứng của dữ liệu vào một tệp nhật ký đặc biệt là&nbsp;<code>translog</code>, nếu máy bị hỏng lúc này, khi khởi động lại, es sẽ tự động đọc dữ liệu từ tệp nhật ký translog và phục hồi vào bộ nhớ&nbsp;<code>buffer</code>&nbsp;và&nbsp;<code>os cache</code>.</p>
<p>Thực tế, translog cũng được ghi vào&nbsp;<code>os cache</code>&nbsp;trước, mặc định là mỗi 5 giây sẽ đẩy vào đĩa một lần, vì vậy mặc định, có thể có 5 giây dữ liệu chỉ nằm trong bộ đệm hoặc <code>os cache</code> hoặc tệp translog, không nằm trên đĩa, nếu máy này bị hỏng lúc này, sẽ&nbsp;<strong>mất</strong>&nbsp;5 giây dữ liệu. Nhưng hiệu suất như vậy tốt hơn, mất tối đa 5 giây dữ liệu. Bạn cũng có thể đặt translog để mỗi lần ghi phải&nbsp;<code>fsync</code>&nbsp;trực tiếp vào đĩa, nhưng hiệu suất sẽ kém hơn nhiều.</p>
<p>Thực tế, nếu bạn ở đây, nếu người phỏng vấn không hỏi bạn về vấn đề mất dữ liệu của es, bạn có thể tự hào với người phỏng vấn ở đây, bạn nói, thực tế es trước tiên là gần như thời gian thực, dữ liệu được ghi vào sau 1 giây mới có thể được tìm thấy; có thể mất dữ liệu. Có 5 giây dữ liệu, nằm trong bộ đệm,&nbsp;<code>os cache</code>&nbsp;của translog,&nbsp;<code>os cache</code>&nbsp;của&nbsp;<code>segment file</code>, không nằm trên đĩa, nếu máy này bị hỏng lúc này, sẽ dẫn đến&nbsp;<strong>mất</strong>&nbsp;5 giây dữ liệu.</p>
<p><strong>Tóm lại</strong>, dữ liệu được ghi vào bộ đệm trước, sau đó mỗi giây, dữ liệu sẽ được refresh vào&nbsp;<code>os cache</code>, khi dữ liệu đến&nbsp;<code>os cache</code>, dữ liệu có thể được tìm kiếm (đó là lý do tại sao chúng ta nói rằng từ khi dữ liệu được ghi vào cho đến khi có thể tìm kiếm, có độ trễ 1s). Mỗi 5 giây, dữ liệu sẽ được ghi vào tệp translog (do đó, nếu máy bị hỏng, tất cả dữ liệu trong bộ nhớ sẽ mất, tối đa sẽ mất 5s dữ liệu), khi translog lớn đến một mức độ nhất định, hoặc mặc định mỗi 30 phút, một hoạt động commit sẽ được kích hoạt, đẩy tất cả dữ liệu trong bộ đệm vào tệp&nbsp;<code>segment file</code>trên đĩa.</p>
<blockquote>
<p>Sau khi dữ liệu được ghi vào&nbsp;<code>segment file</code>, chỉ mục đảo ngược cũng sẽ được tạo ngay lập tức.</p>
</blockquote>
<h4>2.2.4. Nguyên lý cơ bản khi xóa/cập nhật dữ liệu</h4>
<p>Nếu là hoạt động xóa, khi commit sẽ tạo ra một tệp&nbsp;<code>.del</code>, trong đó đánh dấu một doc nhất định là trạng thái&nbsp;<code>deleted</code>, vì vậy khi tìm kiếm, dựa vào tệp&nbsp;<code>.del</code>, bạn sẽ biết liệu doc có bị xóa hay không.</p>
<p>Nếu là hoạt động cập nhật, nó sẽ đánh dấu doc gốc là trạng thái&nbsp;<code>deleted</code>&nbsp;và sau đó ghi một dữ liệu mới.</p>
<p>Mỗi khi bộ đệm được refresh, một&nbsp;<code>segment file</code>&nbsp;sẽ được tạo ra, vì vậy mặc định là một&nbsp;<code>segment file</code>&nbsp;mỗi giây, vì vậy&nbsp;<code>segment file</code>&nbsp;sẽ ngày càng nhiều, lúc này sẽ thường xuyên thực hiện merge. Mỗi lần merge, nhiều&nbsp;<code>segment file</code>&nbsp;sẽ được hợp nhất thành một, đồng thời ở đây, doc được đánh dấu là&nbsp;<code>deleted</code>&nbsp;sẽ được&nbsp;<strong>xóa vật lý</strong>, sau đó ghi&nbsp;<code>segment file</code>&nbsp;mới vào đĩa, ở đây sẽ ghi một&nbsp;<code>commit point</code>, đánh dấu tất cả&nbsp;<code>segment file</code>&nbsp;mới, sau đó mở&nbsp;<code>segment file</code>&nbsp;để tìm kiếm, và sau đó xóa&nbsp;<code>segment file</code>&nbsp;cũ.</p>
<h4>2.2.5. Lớp cơ bản Lucene</h4>
<p>Đơn giản, Lucene chỉ là một thư viện jar, bên trong nó chứa các mã thuật toán đã được đóng gói để tạo chỉ mục đảo ngược. Khi chúng ta phát triển bằng Java, chúng ta chỉ cần import thư viện jar Lucene, sau đó phát triển dựa trên API của Lucene.</p>
<p>Thông qua Lucene, chúng ta có thể tạo chỉ mục cho dữ liệu hiện có, Lucene sẽ tổ chức cấu trúc dữ liệu chỉ mục trên ổ đĩa cục bộ cho chúng ta.</p>
<h4>2.2.5. Chỉ mục đảo ngược</h4>
<p>Trong công cụ tìm kiếm, mỗi tài liệu đều có một ID tài liệu tương ứng, nội dung tài liệu được biểu diễn dưới dạng một tập hợp các từ khóa. Ví dụ, sau khi phân loại, tài liệu 1 đã trích xuất 20 từ khóa, mỗi từ khóa đều ghi lại số lần xuất hiện và vị trí xuất hiện của nó trong tài liệu.</p>
<p>Vậy, chỉ mục đảo ngược là ánh xạ từ&nbsp;<strong>từ khóa đến ID tài liệu</strong>, mỗi từ khóa đều tương ứng với một loạt tài liệu, trong đó tất cả các tài liệu đều xuất hiện từ khóa.</p>
<p>Ví dụ.</p>
<p>Có các tài liệu sau:</p>
<p>| DocId | Doc                                                                           |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/deploy3.png" type="image/png"/>
    </item>
    <item>
      <title>Elasticsearch</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Elasticsearch Aggregation</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/aggregation.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/aggregation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Aggregation</source>
      <description>Elasticsearch Aggregations Elasticsearch là một công cụ tìm kiếm toàn văn bản phân tán, lập chỉ mục và tìm kiếm là các chức năng cơ bản của Elasticsearch. Thực tế, chức năng Agg...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Elasticsearch là một công cụ tìm kiếm toàn văn bản phân tán, lập chỉ mục và tìm kiếm là các chức năng cơ bản của Elasticsearch. Thực tế, chức năng Aggregations của Elasticsearch cũng rất mạnh mẽ, cho phép thực hiện phân tích thống kê phức tạp trên dữ liệu. Elasticsearch cung cấp bốn loại chức năng phân tích tổng hợp chính, bao gồm <strong>aggregations chỉ số (metrics aggregations)</strong>, <strong>aggregations thùng (bucket aggregations)</strong>, <strong>aggregations ống (pipeline aggregations)</strong> và <strong>aggregations ma trận (matrix aggregations)</strong>. Aggregations ống và aggregations ma trận đang trong giai đoạn thử nghiệm theo thông báo chính thức, và sẽ được thay đổi hoàn toàn hoặc loại bỏ sau này, vì vậy chúng tôi sẽ không giải thích về aggregations ống và aggregations ma trận ở đây.</p>
<h2>Cấu trúc cụ thể của Aggregations</h2>
<p>Tất cả các aggregations, bất kể loại nào, đều tuân theo các quy tắc sau.</p>
<ul>
<li>Chúng được định nghĩa trong cùng một yêu cầu JSON như truy vấn, và bạn đánh dấu chúng bằng cách sử dụng khóa aggregations hoặc aggs. Bạn cần đặt tên cho mỗi aggregation, chỉ định loại của nó và các tùy chọn liên quan đến loại đó.</li>
<li>Chúng chạy trên kết quả của truy vấn. Các tài liệu không khớp với truy vấn sẽ không được tính, trừ khi bạn sử dụng aggregation global để bao gồm các tài liệu không khớp.</li>
<li>Chúng có thể lọc thêm kết quả của truy vấn mà không ảnh hưởng đến aggregation.</li>
</ul>
<p>Dưới đây là cấu trúc cơ bản của aggregation:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379">"aggregations"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">&lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Khóa</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggregation</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> ở</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> cấp</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> độ</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> cao</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> nhất,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> cũng</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> có</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> thể</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> viết</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> tắt</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> là</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggs</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "&lt;aggregation_name&gt;"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">&lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Tên</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> tùy</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> chỉnh</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> của</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggregation</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "&lt;aggregation_type&gt;"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">&lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Loại</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggregation,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> liên</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> quan</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> đến</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> chỉ</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> số</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> như</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> max,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> min,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> avg,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> sum,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> liên</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> quan</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> đến</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> thùng</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> như</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> terms,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> filter,</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> v.v.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">            &lt;aggregation_body&gt;</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> &lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Thân</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggregation</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">trường</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> nào</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> sẽ</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> được</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> tổng</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> hợp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">có</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> thể</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> lấy</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> giá</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> trị</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> của</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> trường</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> hoặc</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> kết</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> quả</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> của</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> script</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        [,</span><span style="color:#98C379;--shiki-dark:#98C379">"meta"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {  </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">[&lt;meta_data_body&gt;]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } ]</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">?</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> &lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Meta</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        [,</span><span style="color:#98C379;--shiki-dark:#98C379">"aggregations"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">[&lt;sub_aggregation&gt;]+</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } ]</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">?</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> &lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Định</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> nghĩa</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> sub-aggregation</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> trong</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggregation</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    [,</span><span style="color:#98C379;--shiki-dark:#98C379">"&lt;aggregation_name_2&gt;"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } ]</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">*</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> &lt;!--</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> Tên</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> tùy</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> chỉnh</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> của</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> aggregation</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> --&gt;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><ul>
<li><strong>Ở cấp độ cao nhất có một khóa aggregations, có thể viết tắt là aggs</strong>.</li>
<li>Ở cấp độ tiếp theo, bạn cần chỉ định tên cho aggregation. Bạn sẽ thấy tên này trong kết quả trả về của yêu cầu. Điều này rất hữu ích khi sử dụng nhiều aggregation trong cùng một yêu cầu, nó giúp bạn dễ dàng hiểu ý nghĩa của mỗi nhóm kết quả.</li>
<li>Cuối cùng, bạn phải chỉ định loại aggregation.</li>
</ul>
<blockquote>
<p>Giá trị phân tích tổng hợp có thể <strong>lấy từ giá trị của trường</strong> hoặc là <strong>kết quả của script</strong>.</p>
<p>Tuy nhiên, khi sử dụng kết quả của script, bạn cần chú ý đến hiệu suất và an toàn của script; mặc dù hầu hết các loại aggregation đều cho phép sử dụng script, nhưng script làm chậm aggregation vì script phải chạy trên mỗi tài liệu. Để tránh chạy script, bạn có thể tính toán trong giai đoạn lập chỉ mục.</p>
<p>Ngoài ra, script cũng có thể bị sử dụng để tấn công mã độc, hãy cố gắng sử dụng ngôn ngữ script trong sandbox.</p>
</blockquote>
<p>Ví dụ: Truy vấn tuổi trung bình của tất cả các cầu thủ là bao nhiêu, và cộng 188 vào mức lương trung bình của cầu thủ (cũng có thể hiểu là mức lương trung bình sau khi cộng thêm 188 cho mỗi cầu thủ).</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /player/_search?size=</span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "aggs"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "avg_age"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "avg"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "field"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "age"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "avg_salary_188"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "avg"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "script"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "source"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "doc.salary.value + 188"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Aggregations chỉ số</h2>
<p>Aggregations chỉ số (còn được gọi là aggregations đo lường) chủ yếu rút ra dữ liệu thống kê từ các nhóm tài liệu khác nhau, hoặc từ các thùng tài liệu từ các aggregations khác.</p>
<p>Những dữ liệu thống kê này thường đến từ các trường số, như giá trị nhỏ nhất hoặc trung bình. Người dùng có thể lấy từng dữ liệu thống kê riêng lẻ, hoặc cũng có thể sử dụng aggregations stats để lấy chúng cùng một lúc. Dữ liệu thống kê nâng cao hơn, như tổng bình phương hoặc độ lệch chuẩn, có thể được lấy thông qua aggregations extended stats.</p>
<h3>Max Aggregation</h3>
<p>Max Aggregation được sử dụng để thống kê giá trị lớn nhất. Ví dụ, để thống kê cuốn sách có giá cao nhất trong chỉ mục sales, và tính giá trị gấp đôi của giá đó, câu truy vấn như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /sales/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "max_price" : {</span></span>
<span class="line"><span>      "max" : {</span></span>
<span class="line"><span>        "field" : "price"</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    "max_price_2" : {</span></span>
<span class="line"><span>      "max" : {</span></span>
<span class="line"><span>        "field" : "price",</span></span>
<span class="line"><span>        "script": {</span></span>
<span class="line"><span>          "source": "_value * 2.0"</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Trường được chỉ định, trong script có thể lấy giá trị của trường bằng _value</strong>.</p>
<p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "max_price": {</span></span>
<span class="line"><span>      "value": 188.0</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    "max_price_2": {</span></span>
<span class="line"><span>      "value": 376.0</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Min Aggregation</h3>
<p>Min Aggregation được sử dụng để thống kê giá trị nhỏ nhất. Ví dụ, để thống kê cuốn sách có giá thấp nhất trong chỉ mục sales, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /sales/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "min_price" : {</span></span>
<span class="line"><span>      "min" : {</span></span>
<span class="line"><span>        "field" : "price"</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "min_price": {</span></span>
<span class="line"><span>      "value": 18.0</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Avg Aggregation</h3>
<p>Avg Aggregation được sử dụng để tính giá trị trung bình. Ví dụ, để thống kê điểm trung bình của kỳ thi trong chỉ mục exams, nếu không có điểm số, mặc định là 60 điểm, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /exams/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "avg_grade" : {</span></span>
<span class="line"><span>      "avg" : {</span></span>
<span class="line"><span>        "field" : "grade",</span></span>
<span class="line"><span>        "missing": 60</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p><strong>Nếu trường chỉ định không có giá trị, bạn có thể chỉ định giá trị mặc định bằng missing; nếu không chỉ định giá trị mặc định, tài liệu thiếu giá trị trường này sẽ bị bỏ qua (tính toán)</strong>.</p>
<p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "avg_grade": {</span></span>
<span class="line"><span>      "value": 78.0</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Ngoài tính toán aggregation trung bình thông thường, elasticsearch cũng cung cấp tính toán aggregation trung bình có trọng số, chi tiết xem tại <a href="https://www.knowledgedict.com/tutorial/elasticsearch-aggregations-metrics-weighted-avg-aggregation.html" target="_blank" rel="noopener noreferrer">Elasticsearch Aggregations chỉ số - Weighted Avg Aggregation</a>.</p>
<h3>Sum Aggregation</h3>
<p>Sum Aggregation được sử dụng để tính tổng. Ví dụ, để thống kê tổng giá của các mặt hàng có loại là "hat" trong chỉ mục sales, câu truy vấn như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /sales/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query" : {</span></span>
<span class="line"><span>    "constant_score" : {</span></span>
<span class="line"><span>      "filter" : {</span></span>
<span class="line"><span>        "match" : { "type" : "hat" }</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "hat_prices" : {</span></span>
<span class="line"><span>      "sum" : { "field" : "price" }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "hat_prices": {</span></span>
<span class="line"><span>      "value": 567.0</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Value Count Aggregation</h3>
<p>Value Count Aggregation có thể được sử dụng để đếm số lượng tài liệu theo trường. Ví dụ, để đếm số lượng tài liệu có trường author trong chỉ mục books, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /books/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "doc_count" : {</span></span>
<span class="line"><span>      "value_count" : { "field" : "author" }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "doc_count": {</span></span>
<span class="line"><span>      "value": 5</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Cardinality Aggregation</h3>
<p>Cardinality Aggregation được sử dụng cho thống kê cơ sở, nhiệm vụ của nó là thực hiện các hoạt động tương tự như distinct trong SQL, loại bỏ các mục trùng lặp trong tập hợp, sau đó đếm độ dài của tập hợp sau khi loại bỏ trùng lặp. Ví dụ, thực hiện hoạt động cardinality trên trường language trong chỉ mục books có thể đếm số lượng ngôn ngữ lập trình, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /books/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "all_lan" : {</span></span>
<span class="line"><span>      "cardinality" : { "field" : "language" }</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    "title_cnt" : {</span></span>
<span class="line"><span>      "cardinality" : { "field" : "title.keyword" }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p><strong>Giả sử trường title là kiểu văn bản (text), khi loại bỏ trùng lặp, bạn cần chỉ định keyword, có nghĩa là xem title như một thể thống nhất, tức là không phân tách từ để đếm</strong>.</p>
<p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "all_lan": {</span></span>
<span class="line"><span>      "value": 8</span></span>
<span class="line"><span>    },</span></span>
<span class="line"><span>    "title_cnt": {</span></span>
<span class="line"><span>      "value": 18</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Stats Aggregation</h3>
<p>Stats Aggregation được sử dụng để thống kê cơ bản, sẽ trả về 5 chỉ số count, max, min, avg và sum cùng một lúc. Ví dụ, để thống kê cơ bản liên quan đến điểm số trên trường grade trong chỉ mục exams, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /exams/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "grades_stats" : {</span></span>
<span class="line"><span>      "stats" : { "field" : "grade" }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Kết quả aggregation như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "grades_stats": {</span></span>
<span class="line"><span>      "count": 2,</span></span>
<span class="line"><span>      "min": 50.0,</span></span>
<span class="line"><span>      "max": 100.0,</span></span>
<span class="line"><span>      "avg": 75.0,</span></span>
<span class="line"><span>      "sum": 150.0</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Extended Stats Aggregation</h3>
<p>Extended Stats Aggregation được sử dụng cho thống kê nâng cao, tương tự như thống kê cơ bản, nhưng sẽ có thêm một số kết quả thống kê sau, sum_of_squares (tổng bình phương), variance (phương sai), std_deviation (độ lệch chuẩn), std_deviation_bounds (khoảng giữa giá trị trung bình cộng/trừ hai độ lệch chuẩn). Để thống kê nâng cao liên quan đến điểm số trên trường grade trong chỉ mục exams, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /exams/_search?size=0</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "grades_stats" : {</span></span>
<span class="line"><span>      "extended_stats" : { "field" : "grade" }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Kết quả aggregation như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "grades_stats": {</span></span>
<span class="line"><span>      "count": 2,</span></span>
<span class="line"><span>      "min": 50.0,</span></span>
<span class="line"><span>      "max": 100.0,</span></span>
<span class="line"><span>      "avg": 75.0,</span></span>
<span class="line"><span>      "sum": 150.0,</span></span>
<span class="line"><span>      "sum_of_squares": 12500.0,</span></span>
<span class="line"><span>      "variance": 625.0,</span></span>
<span class="line"><span>      "std_deviation": 25.0,</span></span>
<span class="line"><span>      "std_deviation_bounds": {</span></span>
<span class="line"><span>        "upper": 125.0,</span></span>
<span class="line"><span>        "lower": 25.0</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Percentiles Aggregation</h3>
<p>Percentiles Aggregation được sử dụng cho thống kê phân vị. Phân vị là một thuật ngữ thống kê, nếu ta sắp xếp một tập dữ liệu từ lớn đến nhỏ và tính toán phần trăm lũy kế tương ứng, giá trị của dữ liệu tương ứng với phân vị đó được gọi là phân vị của phân vị đó. Theo mặc định, các phân vị lũy kế là [ 1, 5, 25, 50, 75, 95, 99 ]. Ví dụ sau đây cho thấy cách thống kê phân vị thời gian tải trên trường load_time trong chỉ mục latency, câu truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET latency/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "size": 0,</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "load_time_outlier" : {</span></span>
<span class="line"><span>      "percentiles" : {</span></span>
<span class="line"><span>        "field" : "load_time"</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p><strong>Cần lưu ý rằng, trường <code>load_time</code> như trên phải là loại số</strong>.</p>
<p>Kết quả tổng hợp như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "load_time_outlier": {</span></span>
<span class="line"><span>      "values" : {</span></span>
<span class="line"><span>        "1.0": 5.0,</span></span>
<span class="line"><span>        "5.0": 25.0,</span></span>
<span class="line"><span>        "25.0": 165.0,</span></span>
<span class="line"><span>        "50.0": 445.0,</span></span>
<span class="line"><span>        "75.0": 725.0,</span></span>
<span class="line"><span>        "95.0": 945.0,</span></span>
<span class="line"><span>        "99.0": 985.0</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Thống kê phân vị cũng có thể chỉ định tham số percents để chỉ định phân vị, như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET latency/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "size": 0,</span></span>
<span class="line"><span>  "aggs" : {</span></span>
<span class="line"><span>    "load_time_outlier" : {</span></span>
<span class="line"><span>      "percentiles" : {</span></span>
<span class="line"><span>        "field" : "load_time",</span></span>
<span class="line"><span>        "percents": [60, 80, 95]</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Percentiles Ranks Aggregation</h3>
<p>Percentiles Ranks Aggregation có ý nghĩa ngược lại với Percentiles Aggregation, đó là muốn xem giá trị hiện tại nằm trong phạm vi nào (phân vị). Giả sử bạn kiểm tra xem giá trị hiện tại 500 và 600 nằm ở phân vị nào, phát hiện ra là 90.01 và 100, điều đó có nghĩa là 90.01% của các giá trị đều nằm trong phạm vi 500, và 100% của các giá trị nằm trong phạm vi 600.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET latency/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "size": 0,</span></span>
<span class="line"><span>    "aggs" : {</span></span>
<span class="line"><span>      "load_time_ranks" : {</span></span>
<span class="line"><span>        "percentile_ranks" : {</span></span>
<span class="line"><span>          "field" : "load_time",</span></span>
<span class="line"><span>          "values" : [500, 600]</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p><strong>Trường <code>load_time</code> cũng phải là loại số</strong>.</p>
<p>Kết quả trả về sẽ tương tự như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "load_time_ranks": {</span></span>
<span class="line"><span>      "values" : {</span></span>
<span class="line"><span>        "500.0": 90.01,</span></span>
<span class="line"><span>        "600.0": 100.0</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Bạn có thể đặt tham số <code>keyed</code> là <code>true</code> để trả về các giá trị tương ứng như là key của các bucket, mặc định là <code>false</code>.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET latency/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "size": 0,</span></span>
<span class="line"><span>  "aggs": {</span></span>
<span class="line"><span>    "load_time_ranks": {</span></span>
<span class="line"><span>      "percentile_ranks": {</span></span>
<span class="line"><span>        "field": "load_time",</span></span>
<span class="line"><span>        "values": [500, 600],</span></span>
<span class="line"><span>        "keyed": true</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Kết quả trả về như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  ...</span></span>
<span class="line"><span>  "aggregations": {</span></span>
<span class="line"><span>    "load_time_ranks": {</span></span>
<span class="line"><span>      "values": [</span></span>
<span class="line"><span>        {</span></span>
<span class="line"><span>          "key": 500.0,</span></span>
<span class="line"><span>          "value": 90.01</span></span>
<span class="line"><span>        },</span></span>
<span class="line"><span>        {</span></span>
<span class="line"><span>          "key": 600.0,</span></span>
<span class="line"><span>          "value": 100.0</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      ]</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Bucket Aggregation</h2>
<p>Bucket có thể được hiểu như một cái thùng, nó sẽ duyệt qua nội dung của tài liệu, những gì phù hợp với một yêu cầu nhất định sẽ được đặt vào một thùng, phân thùng tương đương với group by trong SQL. Từ một góc độ khác, bạn có thể xem metric aggregation như là bucket aggregation đơn, tức là đặt tất cả tài liệu vào một thùng, trong khi bucket aggregation là multi-bucket aggregation, nó phân nhóm theo các điều kiện tương ứng.</p>
<p>| Loại                          | Mô tả/Trường hợp sử dụng                                                                                                                                                                                |<br>
| :</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Analyzer</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/analyzer.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/analyzer.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Analyzer</source>
      <description>Elasticsearch Analyzer Phân tích văn bản là quá trình chuyển đổi toàn bộ văn bản thành một chuỗi các từ (term/token), còn được gọi là phân từ. Trong Elasticsearch, phân từ được ...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Phân tích văn bản là quá trình chuyển đổi toàn bộ văn bản thành một chuỗi các từ (term/token), còn được gọi là phân từ. Trong Elasticsearch, phân từ được thực hiện thông qua analyzer (bộ phân tích), dù là chỉ mục hay tìm kiếm, đều cần sử dụng analyzer (bộ phân tích). Bộ phân tích, chia thành&nbsp;<strong>bộ phân tích được xây dựng sẵn</strong>&nbsp;và&nbsp;<strong>bộ phân tích tùy chỉnh</strong>.</p>
<p>Bộ phân tích có thể được phân loại thành ba phần là&nbsp;<strong>bộ lọc ký tự</strong>(<strong>Character Filters</strong>),&nbsp;<strong>bộ phân từ</strong>&nbsp;(<strong>Tokenizer</strong>) và&nbsp;<strong>bộ lọc từ</strong>&nbsp;(<strong>Token Filters</strong>). Thứ tự thực thi của nó như sau:</p>
<p><strong><em>character filters</em></strong>&nbsp;-&gt;&nbsp;<strong><em>tokenizer</em></strong>&nbsp;-&gt;&nbsp;<strong><em>token filters</em></strong></p>
<h2>Bộ lọc ký tự (Character Filters)</h2>
<p>Bộ lọc ký tự nhận đầu vào là văn bản gốc, nếu cấu hình nhiều hơn, nó sẽ thực hiện theo thứ tự cấu hình. Hiện tại ES có 3 loại bộ lọc ký tự chính:</p>
<ol>
<li><strong>html strip character filter</strong>: Loại bỏ các phần tử HTML khỏi văn bản và thay thế các thực thể HTML bằng giá trị giải mã của chúng (ví dụ, thay thế <strong><em><code>＆amp;</code></em></strong> bằng <strong><em><code>＆</code></em></strong>).</li>
<li><strong>mapping character filter</strong>: Tự định nghĩa một bản đồ ánh xạ, có thể thực hiện một số thay thế tùy chỉnh, như thường được sử dụng để thay đổi chữ hoa thành chữ thường cũng có thể được thiết lập tại đây.</li>
<li><strong>pattern replace character filter</strong>: Sử dụng biểu thức chính quy java để khớp các ký tự cần thay thế bằng chuỗi thay thế được chỉ định, ngoài ra, chuỗi thay thế có thể tham chiếu đến nhóm bắt trong biểu thức chính quy.</li>
</ol>
<h3>HTML strip character filter</h3>
<p>Ví dụ về HTML strip:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_analyze</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "tokenizer"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "keyword",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "char_filter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "html_strip"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "text"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "&lt;p&gt;I&amp;apos;m so &lt;b&gt;happy&lt;/b&gt;!&lt;/p&gt;"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Sau khi xử lý bằng bộ lọc ký tự <strong><em><code>html_strip</code></em></strong>, đầu ra như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>[ \nI'm so happy!\n ]</span></span></code></pre>
</div><h3>Mapping character filter</h3>
<p>Mapping character filter nhận một bản đồ ánh xạ giữa khóa và giá trị (key =&gt; value) như tham số cấu hình, mỗi khi gặp một chuỗi trong văn bản gốc giống với khóa trong bản đồ ánh xạ, nó sẽ thay thế chuỗi đó bằng giá trị tương ứng của khóa.</p>
<p>Việc khớp chuỗi trong văn bản gốc với khóa trong bản đồ ánh xạ là tham lam, nếu có sự chồng chéo giữa các khóa trong bản đồ ánh xạ, nó sẽ ưu tiên <strong>khớp khóa dài nhất</strong>. Cũng có thể thay thế bằng chuỗi rỗng.</p>
<p>mapping char_filter không giống như html_strip có thể sử dụng ngay lập tức, nó cần được cấu hình trước khi sử dụng, nó có hai thuộc tính có thể cấu hình:</p>
<p>| Tên tham số              | Mô tả tham số                                                                                       |<br>
| :</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Cluster and Shard</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/cluster-shard.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/cluster-shard.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Cluster and Shard</source>
      <description>Elasticsearch Clusters và Shards Clusters Cluster trống Nếu chúng ta khởi động một nút đơn lẻ không chứa bất kỳ dữ liệu hay chỉ mục nào, cluster của chúng ta sẽ trông như một cl...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Clusters</h2>
<h3>Cluster trống</h3>
<p>Nếu chúng ta khởi động một nút đơn lẻ không chứa bất kỳ dữ liệu hay chỉ mục nào, cluster của chúng ta sẽ trông như một cluster với một nút nội dung trống.</p>
<p><strong>Hình 1. Cluster với nút nội dung trống</strong></p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/elas_0201.png" alt="Cluster với nút nội dung trống" tabindex="0" loading="lazy"><figcaption>Cluster với nút nội dung trống</figcaption></figure>
<p>Hình 1: Cluster chỉ có một nút trống</p>
<p>Một thực thể Elasticsearch đang chạy được gọi là một <strong>nút</strong>, và một <strong>cluster</strong> bao gồm một hoặc nhiều nút với cấu hình <code>cluster.name</code> giống nhau. Chúng cùng nhau chịu áp lực của dữ liệu và tải. Khi các nút được thêm vào hoặc loại bỏ khỏi cluster, cluster sẽ phân phối lại tất cả dữ liệu một cách đều.</p>
<p>Khi một nút được bầu làm <strong>nút chính</strong>, nó chịu trách nhiệm quản lý <strong>tất cả các thay đổi</strong> trong phạm vi cluster, chẳng hạn như thêm hoặc xóa chỉ mục, hoặc thêm hoặc xóa các nút, v.v. Nút chính không cần tham gia vào các thay đổi cấp độ tài liệu và tìm kiếm, vì vậy ngay cả khi lưu lượng tăng lên, nó sẽ không trở thành một nút cổ chai khi cluster chỉ có một nút chính. Bất kỳ nút nào cũng có thể trở thành nút chính. Cluster mẫu của chúng ta chỉ có một nút, vì vậy nó cũng trở thành nút chính.</p>
<p>Là người dùng, chúng ta có thể gửi yêu cầu đến bất kỳ nút nào trong cluster, bao gồm cả nút chính. Mỗi nút đều biết vị trí của bất kỳ tài liệu nào và có thể chuyển tiếp yêu cầu của chúng ta trực tiếp đến nút lưu trữ tài liệu mà chúng ta cần. Không quan trọng chúng ta gửi yêu cầu đến nút nào, nút đó có thể chịu trách nhiệm thu thập dữ liệu từ tất cả các nút chứa tài liệu mà chúng ta cần và trả kết quả cuối cùng cho máy khách. Elasticsearch quản lý tất cả mọi thứ này một cách trong suốt.</p>
<h3>Cluster Health</h3>
<p>Thông tin giám sát cluster của Elasticsearch chứa nhiều dữ liệu thống kê, trong đó quan trọng nhất là <em>sức khỏe của cluster</em>, được hiển thị là <code>green</code>, <code>yellow</code>, hoặc <code>red</code> trong trường <code>status</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cluster/health</span></span></code></pre>
</div><p>Trong một cluster trống không chứa bất kỳ chỉ mục nào, nó sẽ có nội dung trả về tương tự như sau:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "cluster_name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"elasticsearch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "status"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"green"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "timed_out"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_nodes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_data_nodes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_primary_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "relocating_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "initializing_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "unassigned_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Trường <code>status</code> chỉ ra liệu cluster hiện tại có hoạt động bình thường tổng thể hay không. Ba màu của nó có ý nghĩa như sau:</p>
<ul>
<li><strong><code>green</code></strong>: Tất cả các shard chính và shard phụ đều hoạt động bình thường.</li>
<li><strong><code>yellow</code></strong>: Tất cả các shard chính đều hoạt động bình thường, nhưng không phải tất cả các shard phụ đều hoạt động bình thường.</li>
<li><strong><code>red</code></strong>: Có shard chính không hoạt động bình thường.</li>
</ul>
<h3>Thêm chỉ mục</h3>
<p>Khi chúng ta thêm dữ liệu vào Elasticsearch, chúng ta cần sử dụng <em>chỉ mục</em> - nơi lưu trữ dữ liệu liên quan. Chỉ mục thực ra là không gian tên logic trỏ đến một hoặc nhiều shard vật lý.</p>
<p>Một <em>shard</em> là một <em>đơn vị công việc</em> cơ bản, nó chỉ lưu trữ một phần của tất cả dữ liệu. Bây giờ chúng ta chỉ cần biết một shard là một thể hiện của Lucene, và nó chính là một công cụ tìm kiếm hoàn chỉnh. Tài liệu của chúng ta được lưu trữ và chỉ mục trong shard, nhưng ứng dụng thực hiện tương tác trực tiếp với chỉ mục chứ không phải với shard.</p>
<p>Elasticsearch sử dụng shard để phân phối dữ liệu đến các nơi khác nhau trong cluster. shard là bộ chứa dữ liệu, tài liệu được lưu trữ trong shard, và shard được phân bổ đến các nút khác nhau trong cluster. Khi kích thước của cluster của bạn mở rộng hoặc thu hẹp, Elasticsearch sẽ tự động di chuyển shard giữa các nút, để dữ liệu vẫn được phân phối đều trong cluster.</p>
<p>Một shard có thể là shard <em>chính</em> hoặc shard <em>sao lưu</em>. Bất kỳ tài liệu nào trong chỉ mục đều thuộc về một shard chính, vì vậy số lượng shard chính quyết định lượng dữ liệu tối đa mà chỉ mục có thể lưu trữ.</p>
<blockquote>
<p>Kỹ thuật, một shard chính có thể lưu trữ tối đa <code>Integer.MAX_VALUE - 128</code> tài liệu, nhưng giá trị tối đa thực tế còn phụ thuộc vào tình huống sử dụng của bạn: bao gồm phần cứng bạn sử dụng, kích thước và độ phức tạp của tài liệu, cách chỉ mục và truy vấn tài liệu cũng như thời gian phản hồi mong đợi của bạn.</p>
</blockquote>
<p>Một shard sao lưu chỉ là một bản sao của shard chính. shard sao lưu đóng vai trò là bản sao dự phòng dư thừa để bảo vệ dữ liệu không bị mất khi xảy ra lỗi phần cứng, và cung cấp dịch vụ cho các hoạt động đọc như tìm kiếm và trả về tài liệu.</p>
<p>Số shard chính đã được xác định khi tạo chỉ mục, nhưng số shard sao lưu có thể được thay đổi bất cứ lúc nào.</p>
<p>Hãy tạo một chỉ mục có tên <code>blogs</code> trong một cluster với một nút trống. Theo mặc định, chỉ mục sẽ được phân bổ 5 shard chính, nhưng vì mục đích minh họa, chúng tôi sẽ phân bổ 3 shard chính và một bản sao (mỗi shard chính có một shard sao lưu):</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">PUT /blogs</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">   "settings"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "number_of_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "number_of_replicas"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">   }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Cluster của chúng ta hiện tại là <em>một cluster đơn nút có một chỉ mục</em>. Tất cả 3 shard chính đều được phân bổ tại <code>Node 1</code>.</p>
<p><strong>Hình 2. Cluster đơn nút có một chỉ mục</strong></p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/elas_0202.png" alt="Cluster đơn nút có một chỉ mục" tabindex="0" loading="lazy"><figcaption>Cluster đơn nút có một chỉ mục</figcaption></figure>
<p>Nếu chúng ta kiểm tra sức khỏe của cluster ngay bây giờ, chúng ta sẽ thấy nội dung sau:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "cluster_name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"elasticsearch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "status"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"yellow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "timed_out"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_nodes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_data_nodes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_primary_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "relocating_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "initializing_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "unassigned_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "delayed_unassigned_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_pending_tasks"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_in_flight_fetch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "task_max_waiting_in_queue_millis"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_shards_percent_as_number"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">50</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>Giá trị status của cluster là yellow</li>
<li>Số lượng shard sao lưu không được phân bổ cho bất kỳ nút nào</li>
</ul>
<p>Sức khỏe của cluster ở trạng thái <code>yellow</code> có nghĩa là tất cả các shard <em>chính</em> đều hoạt động bình thường (cluster có thể phục vụ tất cả các yêu cầu), nhưng không phải tất cả các shard <em>sao lưu</em> đều ở trạng thái bình thường. Thực tế, tất cả 3 shard sao lưu đều là <code>unassigned</code> - chúng không được phân bổ cho bất kỳ nút nào. Việc lưu trữ dữ liệu gốc và bản sao trên cùng một nút không có ý nghĩa, bởi vì một khi chúng ta mất nút đó, chúng ta cũng sẽ mất tất cả dữ liệu bản sao trên nút đó.</p>
<p>Hiện tại, cluster của chúng ta đang hoạt động bình thường, nhưng có nguy cơ mất dữ liệu khi xảy ra lỗi phần cứng.</p>
<h3>Thêm khả năng chuyển đổi khi gặp sự cố</h3>
<p>Khi chỉ có một nút đang hoạt động trong cluster, điều này có nghĩa là sẽ có một vấn đề về điểm lỗi đơn - không có sự dự phòng. May mắn thay, chúng ta chỉ cần khởi động thêm một nút nữa để ngăn chặn mất dữ liệu.</p>
<blockquote>
<p>Để kiểm tra tình hình sau khi khởi động nút thứ hai, bạn có thể khởi động một nút mới trong cùng một thư mục, hoàn toàn tuân theo cách khởi động nút đầu tiên (xem Cài đặt và chạy Elasticsearch). Nhiều nút có thể chia sẻ cùng một thư mục.</p>
<p>Khi bạn khởi động nút thứ hai trên cùng một máy, miễn là nó có cấu hình <code>cluster.name</code> giống với nút đầu tiên, nó sẽ tự động phát hiện cluster và tham gia vào đó. Tuy nhiên, khi khởi động nút trên các máy khác nhau, để tham gia vào cùng một cluster, bạn cần cấu hình danh sách host unicast có thể kết nối.</p>
</blockquote>
<p>Nếu chúng ta khởi động một nút thứ hai, cluster của chúng ta sẽ trở thành một cluster với hai nút - tất cả các shard chính và shard sao lưu đều đã được phân bổ.</p>
<p><strong>Hình 3. Cluster với hai nút - tất cả các shard chính và shard sao lưu đều đã được phân bổ</strong></p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/elas_0203.png" alt="Cluster với hai nút" tabindex="0" loading="lazy"><figcaption>Cluster với hai nút</figcaption></figure>
<p>Khi nút thứ hai tham gia vào cluster, 3 shard <em>sao lưu</em> sẽ được phân bổ cho nút này - mỗi shard chính có một shard sao lưu tương ứng. Điều này có nghĩa là khi bất kỳ nút nào trong cluster gặp sự cố, dữ liệu của chúng ta vẫn còn nguyên vẹn.</p>
<p>Tất cả các tài liệu mới được chỉ mục sẽ được lưu trữ trong shard chính, sau đó được sao chép song song đến shard sao lưu tương ứng. Điều này đảm bảo rằng chúng ta có thể lấy tài liệu từ shard chính cũng như từ shard sao lưu.</p>
<p><code>cluster-health</code> hiện tại hiển thị trạng thái là <code>green</code>, điều này cho thấy tất cả 6 shard (bao gồm 3 shard chính và 3 shard sao lưu) đều đang hoạt động bình thường.</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "cluster_name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"elasticsearch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "status"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"green"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "timed_out"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_nodes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_data_nodes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_primary_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "relocating_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "initializing_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "unassigned_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "delayed_unassigned_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_pending_tasks"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "number_of_in_flight_fetch"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "task_max_waiting_in_queue_millis"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "active_shards_percent_as_number"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>Trạng thái <code>status</code> của cluster là <code>green</code></li>
</ul>
<p>Cluster của chúng ta hiện tại không chỉ đang hoạt động bình thường, mà còn ở trạng thái <em>luôn sẵn sàng</em>.</p>
<h3>Mở rộng ngang</h3>
<p>Làm thế nào để chúng ta mở rộng theo nhu cầu cho ứng dụng đang phát triển của chúng ta? Khi khởi động một nút thứ ba, cluster của chúng ta sẽ trở thành một cluster với ba nút - phân phối lại các shard để phân tán tải.</p>
<p><strong>Hình 4. Cluster với ba nút - phân phối lại các shard để phân tán tải</strong></p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/elas_0204.png" alt="Cluster với ba nút" tabindex="0" loading="lazy"><figcaption>Cluster với ba nút</figcaption></figure>
<p>Một shard từ <code>Node 1</code> và <code>Node 2</code> đã được di chuyển đến nút mới <code>Node 3</code>, bây giờ mỗi nút đều có 2 shard, thay vì 3 như trước. Điều này có nghĩa là tài nguyên phần cứng (CPU, RAM, I/O) của mỗi nút sẽ được chia sẻ cho ít shard hơn, hiệu suất của mỗi shard sẽ được cải thiện.</p>
<p>Một shard là một công cụ tìm kiếm hoàn chỉnh, nó có khả năng sử dụng tất cả các tài nguyên trên một nút. Chỉ mục của chúng ta có 6 shard (3 shard chính và 3 shard sao lưu) có thể mở rộng tối đa lên đến 6 nút, mỗi nút có một shard, và mỗi shard có toàn bộ tài nguyên của nút nơi nó đặt.</p>
<h2>Shard</h2>
<blockquote>
<ul>
<li>Tại sao tìm kiếm là <em>gần</em> thời gian thực?</li>
<li>Tại sao các hoạt động CRUD (Tạo - Đọc - Cập nhật - Xóa) trên tài liệu là <em>thời gian thực</em>?</li>
<li>Elasticsearch làm thế nào để đảm bảo các cập nhật được lưu trữ một cách bền vững mà không mất dữ liệu khi mất điện?</li>
<li>Tại sao việc xóa tài liệu không giải phóng không gian ngay lập tức?</li>
<li>API <code>refresh</code>, <code>flush</code>, và <code>optimize</code> làm gì và khi nào bạn nên sử dụng chúng?</li>
</ul>
</blockquote>
<h3>Làm cho văn bản có thể tìm kiếm</h3>
<p>Thách thức đầu tiên cần giải quyết là làm thế nào để làm cho văn bản có thể tìm kiếm. Các cơ sở dữ liệu truyền thống lưu trữ một giá trị duy nhất cho mỗi trường, nhưng điều này không đủ cho tìm kiếm toàn văn. Mỗi từ trong trường văn bản cần được tìm kiếm, điều này đối với cơ sở dữ liệu có nghĩa là cần có khả năng lập chỉ mục nhiều giá trị (ở đây là từ) cho một trường duy nhất.</p>
<p>Cấu trúc dữ liệu phù hợp nhất để hỗ trợ yêu cầu <em>nhiều giá trị cho một trường</em> là <em>chỉ mục đảo ngược</em> mà chúng ta đã giới thiệu trong chương <a href="https://www.elastic.co/guide/cn/elasticsearch/guide/current/inverted-index.html" target="_blank" rel="noopener noreferrer">Chỉ mục đảo ngược</a>. Chỉ mục đảo ngược bao gồm một danh sách đã sắp xếp, chứa tất cả các cá thể không trùng lặp xuất hiện trong tài liệu, hoặc được gọi là <em>cụm từ</em>, và cho mỗi cụm từ, chứa danh sách tất cả các tài liệu mà nó đã xuất hiện.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Term  | Doc 1 | Doc 2 | Doc 3 | ...</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/elas_0201.png" type="image/png"/>
    </item>
    <item>
      <title>Elasticsearch Index</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/es-index.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/es-index.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Index</source>
      <description>Elasticsearch Index Thao tác quản lý chỉ mục Quản lý chỉ mục Elasticsearch chủ yếu bao gồm cách tạo chỉ mục, xóa chỉ mục, cập nhật bản sao, quyền đọc ghi chỉ mục, cấu hình bí da...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Thao tác quản lý chỉ mục</h2>
<p>Quản lý chỉ mục Elasticsearch chủ yếu bao gồm cách tạo chỉ mục, xóa chỉ mục, cập nhật bản sao, quyền đọc ghi chỉ mục, cấu hình bí danh chỉ mục, và nhiều nội dung khác.</p>
<h3>Xóa chỉ mục</h3>
<p>Để xóa chỉ mục ES, bạn chỉ cần gửi một yêu cầu http delete đến giao diện http của cụm ES với chỉ mục được chỉ định, bạn có thể thực hiện điều này bằng lệnh curl, cụ thể như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">curl</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -X</span><span style="color:#98C379;--shiki-dark:#98C379"> DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> http://{es_host}:{es_http_port}/{index}</span></span></code></pre>
</div><p>Nếu xóa thành công, nó sẽ trả về thông tin như sau, ví dụ cụ thể như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">curl</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -X</span><span style="color:#98C379;--shiki-dark:#98C379"> DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> http://10.10.10.66:9200/my_index?pretty</span></span></code></pre>
</div><p>Để làm cho thông tin trả về dễ đọc hơn, chúng tôi đã thêm tham số pretty:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "acknowledged"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>Bí danh chỉ mục</h3>
<p>Bí danh chỉ mục ES là tên khác mà bạn đặt cho một hoặc nhiều chỉ mục, một ứng dụng điển hình là để thực hiện chuyển đổi mượt mà cho việc sử dụng chỉ mục.</p>
<p>Đầu tiên, tạo chỉ mục my_index, sau đó đặt bí danh my_alias để chỉ đến nó, ví dụ như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /my_index</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /my_index/_alias/my_alias</span></span></code></pre>
</div><p>Bạn cũng có thể thực hiện như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /_aliases</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "actions"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"add"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "index":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_index",</span><span style="color:#98C379;--shiki-dark:#98C379"> "alias":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_alias"</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Bạn cũng có thể thêm và xóa bí danh trong một yêu cầu:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /_aliases</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "actions"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"remove"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "index":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_index",</span><span style="color:#98C379;--shiki-dark:#98C379"> "alias":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_alias"</span><span style="color:#98C379;--shiki-dark:#98C379"> }},</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"add"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "index":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_index_v2",</span><span style="color:#98C379;--shiki-dark:#98C379"> "alias":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_alias"</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><blockquote>
<p>Cần lưu ý rằng, nếu bí danh và chỉ mục là một-một, bạn có thể sử dụng bí danh để lập chỉ mục hoặc truy vấn tài liệu. Tuy nhiên, nếu bí danh và chỉ mục là một-nhiều, việc sử dụng bí danh sẽ gây ra lỗi, vì ES không biết phải ghi tài liệu vào chỉ mục nào hoặc đọc tài liệu từ chỉ mục nào.</p>
</blockquote>
<p>Một ứng dụng điển hình của bí danh chỉ mục ES là chuyển đổi mượt mà, bạn có thể xem thêm chi tiết tại <a href="https://www.knowledgedict.com/tutorial/elasticsearch-index-smooth-shift.html" target="_blank" rel="noopener noreferrer">Phương pháp chuyển đổi mượt mà chỉ mục Elasticsearch (ES) không cần tắt máy (không cần khởi động lại)</a>.</p>
<h2>Giải thích Settings</h2>
<p>Cấu hình chỉ mục Elasticsearch chủ yếu được chia thành <strong>thuộc tính cấu hình tĩnh</strong> và <strong>thuộc tính cấu hình động</strong>. Thuộc tính cấu hình tĩnh không thể thay đổi sau khi tạo chỉ mục, trong khi thuộc tính cấu hình động có thể thay đổi bất cứ lúc nào.</p>
<p>API để thiết lập chỉ mục ES là <strong><em><code>_settings</code></em></strong>, ví dụ đầy đủ như sau:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /my_index</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "number_of_shards"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "number_of_replicas"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "refresh_interval"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "60s",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "analysis"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "filter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "tsconvert"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "stconvert",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "convert_type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "t2s",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "delimiter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> ","</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "synonym"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "synonym",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "synonyms_path"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "analysis/synonyms.txt"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "analyzer"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "ik_max_word_synonym"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "filter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "synonym"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "tsconvert"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "standard"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "lowercase"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "stop"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "tokenizer"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "ik_max_word"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "ik_smart_synonym"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "filter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "synonym"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "standard"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "lowercase"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "stop"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "tokenizer"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "ik_smart"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"mapping"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"coerce"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "false",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"ignore_malformed"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "false"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"indexing"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"slowlog"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"threshold"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">					"index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">						"warn"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "2s",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">						"info"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "1s"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">					}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">				}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"provided_name"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "hospital_202101070533",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"default_field"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "timestamp",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"parse"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"allow_unmapped_fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "false"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"requests"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"cache"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"enable"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"search"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"slowlog"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"threshold"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">					"fetch"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">						"warn"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "1s",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">						"info"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "200ms"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">					},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">					"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">						"warn"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "1s",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">						"info"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "500ms"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">					}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">				}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Thuộc tính cố định</h3>
<ul>
<li><strong><em><code>index.creation_date</code></em></strong>: Đúng như tên gọi, đây là dấu thời gian tạo chỉ mục.</li>
<li><strong><em><code>index.uuid</code></em></strong>: Thông tin uuid của chỉ mục.</li>
<li><strong><em><code>index.version.created</code></em></strong>: Phiên bản của chỉ mục.</li>
</ul>
<h3>Cấu hình tĩnh chỉ mục</h3>
<ul>
<li><strong><em><code>index.number_of_shards</code></em></strong>: Số lượng mảnh chính của chỉ mục, giá trị mặc định là <strong><em><code>5</code></em></strong>. Cấu hình này không thể thay đổi sau khi tạo chỉ mục; ở cấp độ es, bạn có thể thiết lập số lượng mảnh tối đa cho chỉ mục thông qua thuộc tính <strong><em><code>es.index.max_number_of_shards</code></em></strong>, mặc định là <strong><em><code>1024</code></em></strong>.</li>
<li><strong><em><code>index.codec</code></em></strong>: Thuật toán nén để lưu trữ dữ liệu, giá trị mặc định là <strong><em><code>LZ4</code></em></strong>. Các giá trị tùy chọn khác bao gồm <strong><em><code>best_compression</code></em></strong>, nó có tỷ lệ nén tốt hơn so với LZ4 (tức là chiếm ít không gian đĩa hơn, nhưng hiệu suất lưu trữ thấp hơn LZ4).</li>
<li><strong><em><code>index.routing_partition_size</code></em></strong>: Số lượng phân vùng định tuyến, nếu thiết lập tham số này, thuật toán định tuyến sẽ là: <code>( hash(_routing) + hash(_id) % index.routing_parttion_size ) % number_of_shards</code>. Nếu giá trị này không được thiết lập, thuật toán định tuyến sẽ là <code>hash(_routing) % number_of_shardings</code>, <code>_routing</code> mặc định là <code>_id</code>.</li>
</ul>
<p>Trong cấu hình tĩnh, một phần quan trọng là cấu hình phân tích (config analyzers).</p>
<ul>
<li>
<p><strong><code>index.analysis</code></strong></p>
<p>: Cấu hình ngoài cùng của phân tích, bên trong chủ yếu được chia thành char_filter, tokenizer, filter và analyzer.</p>
<ul>
<li><strong><em><code>char_filter</code></em></strong>: Định nghĩa bộ lọc ký tự mới.</li>
<li><strong><em><code>tokenizer</code></em></strong>: Định nghĩa tokenizer mới.</li>
<li><strong><em><code>filter</code></em></strong>: Định nghĩa bộ lọc token mới, như bộ lọc đồng nghĩa.</li>
<li><strong><em><code>analyzer</code></em></strong>: Cấu hình phân tích mới, thường là sự kết hợp của char_filter, tokenizer và một số bộ lọc token.</li>
</ul>
</li>
</ul>
<h3>Cấu hình động chỉ mục</h3>
<ul>
<li><strong><em><code>index.number_of_replicas</code></em></strong>: Số lượng bản sao của mảnh chính của chỉ mục, giá trị mặc định là <strong><em><code>1</code></em></strong>, giá trị này phải lớn hơn hoặc bằng 0, cấu hình này có thể thay đổi bất cứ lúc nào.</li>
<li><strong><em><code>index.refresh_interval</code></em></strong>: Tần suất thực hiện thao tác làm mới dữ liệu chỉ mục mới, thao tác này làm cho những thay đổi gần nhất đối với chỉ mục có thể nhìn thấy khi tìm kiếm, mặc định là <strong><em><code>1s</code></em></strong>. Bạn cũng có thể đặt là <strong><em><code>-1</code></em></strong> để vô hiệu hóa việc làm mới. Thông tin chi tiết hơn xem tại <a href="https://www.knowledgedict.com/tutorial/elasticsearch-refresh_interval-settings.html" target="_blank" rel="noopener noreferrer">Elasticsearch chỉnh sửa động refresh_interval cài đặt khoảng thời gian làm mới</a>.</li>
</ul>
<h2>Giải thích Mapping</h2>
<p>Trong Elasticsearch, <strong><code>Mapping</code></strong> (ánh xạ) được sử dụng để định rõ cách một tài liệu và các trường mà nó chứa được lưu trữ và lập chỉ mục. Bạn có thể định trước loại dữ liệu của các trường, trọng số của các trường, bộ phân tích, và các thuộc tính khác trong ánh xạ, giống như việc thiết lập loại dữ liệu cho các trường khi tạo bảng trong cơ sở dữ liệu quan hệ.</p>
<p>Mapping sẽ ánh xạ tài liệu json thành định dạng phẳng mà Lucene cần.</p>
<p>Một Mapping thuộc về một Type của chỉ mục</p>
<ul>
<li>Mỗi tài liệu đều thuộc về một Type</li>
<li>Một Type có một định nghĩa Mapping</li>
<li>Từ phiên bản 7.0 trở đi, không cần phải chỉ định thông tin type trong định nghĩa Mapping</li>
</ul>
<h3>Phân loại ánh xạ</h3>
<p>Trong Elasticsearch, ánh xạ có thể được chia thành ánh xạ tĩnh và ánh xạ động. Trong cơ sở dữ liệu quan hệ, trước khi ghi dữ liệu, bạn cần tạo bảng trước, trong câu lệnh tạo bảng, bạn sẽ khai báo thuộc tính của các trường. Tuy nhiên, trong Elasticsearch, bạn không cần phải làm như vậy. Một trong những tính năng quan trọng nhất của Elasticsearch là cho phép bạn khám phá dữ liệu càng nhanh càng tốt. Khi tài liệu được ghi vào Elasticsearch, nó sẽ tự động nhận biết loại của các trường. Cơ chế này được gọi là <strong>ánh xạ động</strong>, trong khi <strong>ánh xạ tĩnh</strong> là việc thiết lập thuộc tính của các trường trước khi ghi dữ liệu.</p>
<h4>Ánh xạ tĩnh</h4>
<p><strong>Ánh xạ tĩnh</strong> là việc chỉ định ánh xạ chỉ mục theo cách thủ công khi tạo chỉ mục. Ánh xạ tĩnh tương tự như việc chỉ định thuộc tính trường trong câu lệnh tạo bảng trong SQL. So với ánh xạ động, thông qua ánh xạ tĩnh, bạn có thể thêm các thông tin cấu hình chi tiết và chính xác hơn.</p>
<p>Cách định nghĩa một Mapping</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /books</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "type_one"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> any</span><span style="color:#98C379;--shiki-dark:#98C379"> mappings</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "type_two"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> any</span><span style="color:#98C379;--shiki-dark:#98C379"> mappings</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">        ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Ánh xạ động</h4>
<p><strong>Ánh xạ động</strong> là một cách thoải mái, cho phép bạn tạo chỉ mục và ghi tài liệu mà không cần thiết lập loại trường khi tạo chỉ mục. Loại của các trường trong tài liệu sẽ được Elasticsearch <strong>tự động nhận biết</strong>. Trong dự án thực tế, nếu bạn không chắc chắn về các trường sẽ có trong dữ liệu trước khi nhập, hoặc bạn không rõ về loại dữ liệu của các trường, việc sử dụng ánh xạ động sẽ rất phù hợp. Khi Elasticsearch gặp một trường mà nó chưa từng thấy trước đó trong tài liệu, nó sẽ sử dụng ánh xạ động để xác định loại của trường đó và tự động thêm trường đó vào ánh xạ, dựa vào giá trị của trường để tự động dự đoán loại trường theo bảng sau:</p>
<p>| Dữ liệu định dạng JSON | Loại trường được dự đoán tự động                                                       |<br>
| :</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Highlight Search and Display</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/highlight-search-display.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/highlight-search-display.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Highlight Search and Display</source>
      <description>Tìm kiếm và hiển thị nổi bật trong Elasticsearch Chức năng tìm kiếm nổi bật (highlight) của Elasticsearch cho phép bạn lấy đoạn tóm tắt nổi bật từ một hoặc nhiều trường trong kế...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Chức năng tìm kiếm nổi bật (highlight) của Elasticsearch cho phép bạn lấy đoạn tóm tắt nổi bật từ một hoặc nhiều trường trong kết quả tìm kiếm, để hiển thị vị trí phù hợp với truy vấn của người dùng. Khi bạn yêu cầu tìm kiếm nổi bật, trường highlight trong kết quả trả về sẽ bao gồm các trường nổi bật và các đoạn nổi bật. Elasticsearch mặc định sẽ đánh dấu từ khóa bằng thẻ <code>&lt;em&gt;&lt;/em&gt;</code>.</p>
<h2>Tham số tìm kiếm nổi bật</h2>
<p>ES cung cấp các tham số tìm kiếm nổi bật sau đây:</p>
<p>| Tham số                   | Mô tả                                                                                                                                                                                                                                                                                                                                                                                                             |<br>
| :</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Interview</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/interview.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/interview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Interview</source>
      <description>Tóm tắt phỏng vấn Elasticsearch Triển khai cụm Cấu hình triển khai ES: 5 nút (cấu hình: 8 nhân 64 G 1T), tổng cộng 320 G, 5 T. Khoảng 10+ chỉ mục, 5 phân đoạn, lượng dữ liệu mới...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Triển khai cụm</h2>
<p>Cấu hình triển khai ES:</p>
<p>5 nút (cấu hình: 8 nhân 64 G 1T), tổng cộng 320 G, 5 T.</p>
<p>Khoảng 10+ chỉ mục, 5 phân đoạn, lượng dữ liệu mới hàng ngày là khoảng 2G, 40 triệu bản ghi. Bản ghi được lưu trữ trong 30 ngày.</p>
<h2>Tối ưu hóa hiệu suất</h2>
<h3>filesystem cache</h3>
<p>Dữ liệu bạn ghi vào es, thực tế đã được ghi vào tệp trên đĩa,&nbsp;<strong>khi truy vấn</strong>, hệ điều hành sẽ tự động lưu trữ dữ liệu từ tệp trên đĩa vào&nbsp;<code>filesystem cache</code>.</p>
<p><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223081955.png" alt="image.png" loading="lazy"><br>
Cơ chế tìm kiếm của es phụ thuộc nặng nề vào&nbsp;<code>filesystem cache</code>&nbsp;cơ sở. Nếu bạn cung cấp thêm bộ nhớ cho&nbsp;<code>filesystem cache</code>, cố gắng để bộ nhớ có thể chứa tất cả các tệp dữ liệu chỉ mục&nbsp;<code>idx segment file</code>, thì khi bạn tìm kiếm, hầu như tất cả các hoạt động đều đi qua bộ nhớ, hiệu suất sẽ rất cao.</p>
<p>Hiệu suất có thể chênh lệch đến mức độ nào? Trong nhiều thử nghiệm và kiểm tra áp lực của chúng tôi trước đây, nếu đi qua đĩa, thì thời gian tìm kiếm chắc chắn là ở mức giây, từ 1 giây, 5 giây đến 10 giây. Nhưng nếu đi qua&nbsp;<code>filesystem cache</code>, nghĩa là đi qua bộ nhớ thuần túy, thì hiệu suất thường cao hơn một bậc so với việc đi qua đĩa, cơ bản là ở mức mili giây, từ vài mili giây đến vài trăm mili giây.</p>
<p>Ở đây có một ví dụ thực tế. Một công ty có 3 máy chủ es, mỗi máy chủ có vẻ như có nhiều bộ nhớ, 64G, tổng bộ nhớ là&nbsp;<code>64 * 3 = 192G</code>. Mỗi máy chủ cung cấp cho es jvm heap là&nbsp;<code>32G</code>, vì vậy phần còn lại cho&nbsp;<code>filesystem cache</code>&nbsp;chỉ là&nbsp;<code>32G</code>&nbsp;mỗi máy, tổng cộng trong cụm, cho&nbsp;<code>filesystem cache</code>&nbsp;chỉ là&nbsp;<code>32 * 3 = 96G</code>&nbsp;bộ nhớ. Tuy nhiên, vào thời điểm đó, tất cả các tệp dữ liệu chỉ mục trên đĩa, trên 3 máy, tổng cộng chiếm&nbsp;<code>1T</code>&nbsp;dung lượng đĩa, lượng dữ liệu es là&nbsp;<code>1T</code>, vì vậy lượng dữ liệu mỗi máy là&nbsp;<code>300G</code>. Hiệu suất tốt không? Bộ nhớ&nbsp;<code>filesystem cache</code>&nbsp;chỉ có 100G, chỉ một phần mười dữ liệu có thể được đặt trong bộ nhớ, phần còn lại đều ở trên đĩa, sau đó bạn thực hiện hoạt động tìm kiếm, hầu hết các hoạt động đều đi qua đĩa, hiệu suất chắc chắn sẽ kém.</p>
<p>Về cơ bản, nếu bạn muốn es hoạt động tốt, trường hợp tốt nhất là bộ nhớ máy của bạn có thể chứa ít nhất một nửa tổng lượng dữ liệu của bạn.</p>
<p>Dựa trên kinh nghiệm thực tế trong môi trường product của chúng tôi, trường hợp tốt nhất là chỉ lưu trữ một lượng dữ liệu nhỏ trong es, chỉ là những chỉ mục mà bạn cần&nbsp;<strong>tìm kiếm</strong>, nếu bộ nhớ dành cho&nbsp;<code>filesystem cache</code>&nbsp;là 100G, thì bạn nên kiểm soát lượng dữ liệu chỉ mục dưới&nbsp;<code>100G</code>. Trong trường hợp này, hầu hết dữ liệu của bạn đều đi qua bộ nhớ để tìm kiếm, hiệu suất rất cao, thường có thể trong vòng 1 giây.</p>
<p>Ví dụ, bạn hiện có một hàng dữ liệu.&nbsp;<code>id, name, age ….</code>&nbsp;30 trường. Nhưng bây giờ, bạn chỉ cần tìm kiếm dựa trên ba trường&nbsp;<code>id, name, age</code>. Nếu bạn ngây thơ ghi tất cả các trường của một hàng dữ liệu vào es, điều này sẽ dẫn đến việc&nbsp;<code>90%</code>&nbsp;dữ liệu không được sử dụng để tìm kiếm, nhưng vẫn chiếm không gian&nbsp;<code>filesystem cache</code>&nbsp;trên máy chủ es, dữ liệu mỗi hàng càng lớn,&nbsp;<code>filesystem cache</code>&nbsp;có thể lưu trữ càng ít dữ liệu. Thực tế, chỉ cần ghi vào es&nbsp;<strong>một số trường ít</strong>&nbsp;cần tìm kiếm, ví dụ, chỉ cần ghi vào es&nbsp;<code>id, name, age</code>&nbsp;ba trường, sau đó bạn có thể lưu trữ dữ liệu trường khác trong mysql/hbase, chúng tôi thường khuyến nghị sử dụng cấu trúc&nbsp;<code>es + hbase</code>.</p>
<p>Đặc điểm của hbase là&nbsp;<strong>phù hợp cho việc lưu trữ dữ liệu trực tuyến lớn</strong>, tức là hbase có thể ghi vào dữ liệu lớn, nhưng không nên thực hiện tìm kiếm phức tạp, chỉ cần thực hiện một số hoạt động đơn giản dựa trên id hoặc phạm vi. Tìm kiếm từ es dựa trên tên và tuổi, kết quả có thể chỉ là 20&nbsp;<code>doc id</code>, sau đó tìm kiếm&nbsp;<strong>dữ liệu đầy đủ</strong>&nbsp;tương ứng với mỗi&nbsp;<code>doc id</code>&nbsp;từ hbase, đưa ra, sau đó trả về cho phía trước.</p>
<p>Dữ liệu ghi vào es nên nhỏ hơn hoặc bằng, hoặc hơi lớn hơn dung lượng bộ nhớ của filesystem cache của es. Sau đó, bạn có thể mất 20ms để tìm kiếm từ es, sau đó tìm kiếm từ hbase dựa trên id được trả về từ es, tìm kiếm 20 bản ghi, có thể mất thêm 30ms, có thể bạn đã chơi như vậy trước đây, 1T dữ liệu đều đặt trong es, mỗi truy vấn đều mất 5~10s, bây giờ có thể hiệu suất sẽ cao hơn, mỗi truy vấn chỉ mất 50ms.</p>
<h3>Dữ liệu khởi động</h3>
<p>Giả sử, ngay cả khi bạn làm theo phương án đã nêu ở trên, lượng dữ liệu được ghi vào mỗi máy trong cụm es vẫn vượt quá gấp đôi&nbsp;<code>filesystem cache</code>, ví dụ, bạn ghi 60G dữ liệu vào một máy, nhưng&nbsp;<code>filesystem cache</code>&nbsp;chỉ có 30G, vẫn còn 30G dữ liệu ở trên đĩa.</p>
<p>Thực tế, bạn có thể thực hiện&nbsp;<strong>khởi động dữ liệu</strong>.</p>
<p>Ví dụ, nếu bạn nói về Weibo, bạn có thể lấy một số dữ liệu từ các người dùng VIP, những người thường xuyên được xem nhiều, bạn tự tạo một hệ thống phía sau, sau mỗi một thời gian, hệ thống phía sau của bạn sẽ tìm kiếm dữ liệu nóng, và đẩy vào&nbsp;<code>filesystem cache</code>, sau đó, khi người dùng thực sự đến xem dữ liệu nóng này, họ sẽ trực tiếp tìm kiếm từ bộ nhớ, rất nhanh.</p>
<p>Hoặc là thương mại điện tử, bạn có thể lấy một số sản phẩm được xem nhiều nhất thường xuyên, chẳng hạn như iPhone 15, dữ liệu nóng được tạo trước bằng một chương trình phía sau, sau mỗi phút, bạn tự động truy cập một lần, và đẩy vào&nbsp;<code>filesystem cache</code>.</p>
<p>Đối với những dữ liệu mà bạn cho là nóng, và thường xuyên có người truy cập, nên&nbsp;<strong>tạo một hệ thống khởi động bộ đệm chuyên dụng</strong>, tức là, sau mỗi một khoảng thời gian, truy cập trước vào dữ liệu nóng, để dữ liệu vào&nbsp;<code>filesystem cache</code>. Như vậy, khi người khác truy cập lần sau, hiệu suất chắc chắn sẽ tốt hơn nhiều.</p>
<h3>Phân tách nóng và lạnh</h3>
<p>es có thể thực hiện việc phân tách ngang tương tự như mysql, tức là, đặt một lượng lớn dữ liệu ít được truy cập, tần suất thấp vào một chỉ mục riêng biệt, sau đó đặt dữ liệu nóng được truy cập thường xuyên vào một chỉ mục riêng biệt. Tốt nhất là đặt&nbsp;<strong>dữ liệu lạnh vào một chỉ mục, sau đó đặt dữ liệu nóng vào một chỉ mục khác</strong>, điều này có thể đảm bảo rằng sau khi dữ liệu nóng được khởi động, hãy để chúng ở trong&nbsp;<code>filesystem os cache</code>&nbsp;càng nhiều càng tốt,&nbsp;<strong>đừng để dữ liệu lạnh xóa bỏ chúng</strong>.</p>
<p>Bạn xem, giả sử bạn có 6 máy, 2 chỉ mục, một cho dữ liệu lạnh, một cho dữ liệu nóng, mỗi chỉ mục có 3 shard. 3 máy đặt chỉ mục dữ liệu nóng, 3 máy khác đặt chỉ mục dữ liệu lạnh. Sau đó, bạn sẽ dành nhiều thời gian truy cập vào chỉ mục dữ liệu nóng, dữ liệu nóng có thể chiếm 10% tổng lượng dữ liệu, lúc này lượng dữ liệu rất nhỏ, gần như tất cả đều được giữ trong&nbsp;<code>filesystem cache</code>, điều này có thể đảm bảo rằng hiệu suất truy cập dữ liệu nóng rất cao. Nhưng đối với dữ liệu lạnh, nó nằm trong một chỉ mục khác, không ở cùng máy với chỉ mục dữ liệu nóng, không có liên hệ gì với nhau. Nếu có người truy cập dữ liệu lạnh, có thể nhiều dữ liệu đang ở trên đĩa, lúc này hiệu suất sẽ kém một chút, chỉ có 10% người truy cập dữ liệu lạnh, 90% người đang truy cập dữ liệu nóng, không sao cả.</p>
<h3>Thiết kế mô hình document</h3>
<p>Đối với MySQL, chúng ta thường xuyên có một số truy vấn liên kết phức tạp. Trong es, chúng ta nên xử lý như thế nào, truy vấn liên kết phức tạp trong es nên tránh sử dụng càng nhiều càng tốt, một khi sử dụng, hiệu suất thường không tốt.</p>
<p>Tốt nhất là hoàn thành liên kết trước trong hệ thống Java, và ghi dữ liệu đã liên kết trực tiếp vào es. Khi tìm kiếm, không cần sử dụng cú pháp tìm kiếm của es để hoàn thành truy vấn liên kết như join.</p>
<p>Thiết kế mô hình document rất quan trọng, nhiều hoạt động, không nên chờ đến khi tìm kiếm mới thực hiện các hoạt động phức tạp khác nhau. es hỗ trợ rất nhiều hoạt động, không nên cố gắng sử dụng es để thực hiện một số thao tác mà nó không làm tốt. Nếu thực sự có thao tác như vậy, hãy cố gắng hoàn thành nó khi thiết kế mô hình document, khi ghi dữ liệu. Ngoài ra, đối với một số hoạt động quá phức tạp, như join/nested/parent-child tìm kiếm nên tránh càng nhiều càng tốt, hiệu suất đều rất kém.</p>
<h3>Tối ưu hóa hiệu suất phân trang</h3>
<p>Phân trang của es khá khó khăn, tại sao? Ví dụ, giả sử bạn có 10 bản ghi trên mỗi trang, và bạn muốn truy vấn trang thứ 100, thực tế, nó sẽ lấy 1000 bản ghi đầu tiên được lưu trữ trên mỗi shard và đưa chúng vào một nút điều phối, nếu bạn có 5 shard, thì sẽ có 5000 bản ghi, sau đó nút điều phối sẽ xử lý và hợp nhất 5000 bản ghi này, sau đó lấy 10 bản ghi cuối cùng trên trang thứ 100.</p>
<p>Phân tán, bạn muốn xem 10 bản ghi trên trang thứ 100, không thể nói rằng từ 5 shard, mỗi shard chỉ xem 2 bản ghi, cuối cùng hợp nhất thành 10 bản ghi tại nút điều phối, phải không? Bạn&nbsp;<strong>phải</strong>&nbsp;lấy 1000 bản ghi từ mỗi shard, sau đó sắp xếp, lọc, v.v., dựa trên yêu cầu của bạn, sau đó phân trang một lần nữa, lấy dữ liệu trên trang thứ 100. Khi bạn lật trang, càng sâu, mỗi shard trả về càng nhiều dữ liệu, và thời gian xử lý của nút điều phối càng lâu, rất khó chịu. Vì vậy, khi sử dụng es để phân trang, bạn sẽ thấy rằng càng lật đến sau, càng chậm.</p>
<p>Chúng tôi cũng đã gặp vấn đề này trước đây, sử dụng es để phân trang, một số trang đầu tiên chỉ mất vài chục mili giây, khi lật đến trang thứ 10 hoặc vài chục trang, cơ bản mất 5~10 giây mới có thể lấy một trang dữ liệu.</p>
<p>Có giải pháp nào không?</p>
<h4>Không cho phép phân trang sâu (mặc định hiệu suất phân trang sâu rất kém)</h4>
<p>Nói với quản lý sản phẩm rằng, hệ thống của bạn không cho phép lật trang quá sâu, mặc định là càng lật sâu, hiệu suất càng kém.</p>
<h4>Tương tự như việc kéo xuống để hiển thị thêm sản phẩm được đề xuất trong ứng dụng</h4>
<p>Tương tự như trong Weibo, kéo xuống để làm mới Weibo, hiển thị từng trang, bạn có thể sử dụng <code>scroll api</code>. Đối với cách sử dụng, hãy tự tìm kiếm trên internet.</p>
<p>Scroll sẽ tạo ra một <strong>bản chụp toàn bộ dữ liệu</strong> cho bạn một lần, sau đó mỗi lần kéo xuống để lật trang tiếp theo sẽ thông qua việc di chuyển <strong>con trỏ</strong> <code>scroll_id</code>, nhận trang tiếp theo như vậy, hiệu suất sẽ cao hơn rất nhiều so với hiệu suất phân trang đã nói ở trên, cơ bản là ở mức mili giây.</p>
<p>Tuy nhiên, điểm duy nhất là, điều này phù hợp với việc lật trang khi kéo xuống giống như Weibo, <strong>không thể tùy ý nhảy đến bất kỳ trang nào</strong>. Nghĩa là, bạn không thể truy cập trang thứ 10 trước, sau đó đi đến trang thứ 120, sau đó lại quay lại trang thứ 58, không thể nhảy trang tùy ý. Vì vậy, nhiều sản phẩm hiện nay không cho phép bạn tùy ý lật trang, ứng dụng, cũng như một số trang web, chỉ cho phép bạn kéo xuống, lật từng trang một.</p>
<p>Khi khởi tạo, bạn phải chỉ định tham số <code>scroll</code>, thông báo cho es cần lưu trữ ngữ cảnh tìm kiếm này trong bao lâu. Bạn cần đảm bảo rằng người dùng sẽ không tiếp tục lật trang trong vài giờ, nếu không có thể sẽ thất bại do quá thời gian.</p>
<p>Ngoài việc sử dụng <code>scroll api</code>, bạn cũng có thể sử dụng <code>search_after</code>. Ý tưởng của <code>search_after</code> là sử dụng kết quả của trang trước để giúp tìm kiếm dữ liệu trên trang tiếp theo, rõ ràng, cách này cũng không cho phép bạn tùy ý lật trang, bạn chỉ có thể lật từng trang một. Khi khởi tạo, bạn cần sử dụng một trường giá trị duy nhất làm trường sắp xếp.</p>
<p><strong>1.1. Tối ưu hóa giai đoạn thiết kế</strong></p>
<p>(1) Dựa trên yêu cầu tăng trưởng kinh doanh, tạo chỉ mục dựa trên mẫu ngày, cuộn chỉ mục qua API roll over;</p>
<p>(2) Sử dụng bí danh để quản lý chỉ mục;</p>
<p>(3) Mỗi ngày vào lúc nửa đêm, thực hiện thao tác force_merge trên chỉ mục để giải phóng không gian;</p>
<p>(4) Sử dụng cơ chế phân tách nóng và lạnh, lưu trữ dữ liệu nóng vào SSD để cải thiện hiệu suất tìm kiếm; dữ liệu lạnh được thu nhỏ định kỳ để giảm bớt lưu trữ;</p>
<p>(5) Sử dụng curator để quản lý vòng đời chỉ mục;</p>
<p>(6) Chỉ đặt tokenizer một cách hợp lý cho các trường cần phân mảnh;</p>
<p>(7) Giai đoạn Mapping kết hợp đầy đủ các thuộc tính của từng trường, liệu có cần tìm kiếm, liệu có cần lưu trữ, v.v…….</p>
<p><strong>1.2. Tối ưu hóa viết</strong></p>
<p>(1) Thiết lập số lượng bản sao là 0 trước khi ghi;</p>
<p>(2) Tắt refresh_interval trước khi ghi, đặt là -1, vô hiệu hóa cơ chế làm mới;</p>
<p>(3) Trong quá trình ghi: sử dụng bulk để ghi hàng loạt;</p>
<p>(4) Phục hồi số lượng bản sao và khoảng thời gian làm mới sau khi ghi;</p>
<p>(5) Cố gắng sử dụng id tự động sinh.</p>
<p>1.3. Tối ưu hóa truy vấn</p>
<p>(1) Vô hiệu hóa wildcard;</p>
<p>(2) Vô hiệu hóa terms hàng loạt (trường hợp hàng trăm hàng nghìn);</p>
<p>(3) Tận dụng tối đa cơ chế chỉ mục đảo ngược, nếu có thể dùng loại keyword thì hãy dùng keyword;</p>
<p>(4) Khi lượng dữ liệu lớn, bạn có thể định chỉ mục dựa trên thời gian trước khi tìm kiếm;</p>
<p>(5) Thiết lập cơ chế định tuyến hợp lý.</p>
<p>1.4. Tối ưu hóa khác</p>
<p>Tối ưu hóa triển khai, tối ưu hóa kinh doanh, v.v.</p>
<p>Phần nêu trên chỉ đề cập đến một phần, người phỏng vấn sẽ cơ bản đánh giá kinh nghiệm thực hành hoặc vận hành trước đây của bạn.</p>
<h2>Nguyên lý hoạt động</h2>
<h3>Quá trình ghi dữ liệu es</h3>
<ul>
<li>Máy khách chọn một node để gửi yêu cầu đi, node này là <code>coordinating node</code> (nút điều phối).</li>
<li><code>Coordinating node</code> thực hiện <strong>định tuyến</strong> cho document, chuyển yêu cầu đến node tương ứng (có primary shard).</li>
<li><code>Primary shard</code> trên node thực tế xử lý yêu cầu, sau đó đồng bộ hóa dữ liệu với <code>replica node</code>.</li>
<li><code>Coordinating node</code> nếu phát hiện <code>primary node</code> và tất cả <code>replica node</code> đều đã hoàn thành, thì trả kết quả phản hồi cho máy khách.</li>
</ul>
<h3>Quá trình đọc dữ liệu es</h3>
<p>Có thể truy vấn thông qua <code>doc id</code>, sẽ dựa vào <code>doc id</code> để thực hiện hash, xác định lúc đó đã phân <code>doc id</code> vào shard nào, từ shard đó truy vấn.</p>
<ul>
<li>Máy khách gửi yêu cầu đến <strong>bất kỳ</strong> một node, trở thành <code>coordinate node</code>.</li>
<li><code>Coordinate node</code> thực hiện định tuyến hash cho <code>doc id</code>, chuyển yêu cầu đến node tương ứng, lúc này sẽ sử dụng thuật toán <strong>round-robin ngẫu nhiên</strong>, chọn ngẫu nhiên một trong số <code>primary shard</code> và tất cả các bản sao của nó, để cân bằng tải yêu cầu đọc.</li>
<li>Node nhận yêu cầu trả document cho <code>coordinate node</code>.</li>
<li><code>Coordinate node</code> trả document cho máy khách.</li>
</ul>
<h3>Quá trình tìm kiếm dữ liệu trong ES</h3>
<p>Điểm mạnh nhất của ES là thực hiện tìm kiếm toàn văn, ví dụ, bạn có ba dữ liệu:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>Java is interesting</span></span>
<span class="line"><span>Java is so difficult to learn</span></span>
<span class="line"><span>J2EE is great</span></span></code></pre>
</div><p>Bạn tìm kiếm theo từ khóa&nbsp;<code>java</code>, nó sẽ tìm kiếm các&nbsp;<code>document</code>&nbsp;chứa&nbsp;<code>java</code>. ES sẽ trả về cho bạn: Java is interesting, Java is so difficult to learn</p>
<ul>
<li>Máy khách gửi yêu cầu đến một&nbsp;<code>coordinating node</code>.</li>
<li>Nút điều phối chuyển yêu cầu tìm kiếm đến&nbsp;<strong>tất cả</strong>&nbsp;<code>primary shard</code> hoặc&nbsp;<code>replica shard</code>&nbsp;tương ứng.</li>
<li>Giai đoạn truy vấn (query phase): mỗi shard sẽ trả lại kết quả tìm kiếm của mình (thực tế chỉ là một số&nbsp;<code>doc id</code>) cho nút điều phối, nút điều phối thực hiện các hoạt động như hợp nhất dữ liệu, sắp xếp, phân trang, etc., để tạo ra kết quả cuối cùng.</li>
<li>Giai đoạn lấy (fetch phase): sau đó, nút điều phối sẽ&nbsp;<strong>lấy</strong>&nbsp;dữ liệu&nbsp;<code>document</code>&nbsp;thực tế từ các node dựa trên&nbsp;<code>doc id</code>, và cuối cùng trả lại cho máy khách.</li>
</ul>
<blockquote>
<p>Yêu cầu ghi được ghi vào primary shard, sau đó đồng bộ hóa với tất cả các replica shard; yêu cầu đọc có thể được đọc từ primary shard hoặc replica shard, sử dụng thuật toán round-robin.</p>
</blockquote>
<h3>Nguyên lý cơ bản khi ghi dữ liệu</h3>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223111949.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Đầu tiên, dữ liệu sẽ được ghi vào bộ đệm trong bộ nhớ (buffer), trong quá trình này dữ liệu không thể được tìm kiếm; đồng thời dữ liệu cũng được ghi vào tệp nhật ký translog.</p>
<p>Nếu bộ đệm gần như đầy, hoặc sau một khoảng thời gian nhất định, dữ liệu trong bộ đệm sẽ được&nbsp;<code>refresh</code>&nbsp;vào một&nbsp;<code>segment file</code>&nbsp;mới, nhưng lúc này dữ liệu không được ghi trực tiếp vào tệp&nbsp;<code>segment file</code> trên đĩa, mà phải đi vào&nbsp;<code>os cache</code>&nbsp;trước. Quá trình này được gọi là&nbsp;<code>refresh</code>.</p>
<p>Mỗi giây, ES sẽ ghi dữ liệu trong bộ đệm vào một&nbsp;<code>segment file</code>&nbsp;<strong>mới</strong>, mỗi giây sẽ tạo ra một tệp đĩa <code>segment file</code>&nbsp;<strong>mới</strong>, tệp&nbsp;<code>segment file</code> này sẽ lưu trữ dữ liệu được ghi vào bộ đệm trong 1 giây gần đây.</p>
<p>Tuy nhiên, nếu không có dữ liệu trong bộ đệm, thì tất nhiên không có quá trình refresh nào được thực hiện, nếu có dữ liệu trong bộ đệm, mặc định sẽ thực hiện một lần refresh mỗi giây, đẩy dữ liệu vào một&nbsp;<code>segment file</code>&nbsp;mới.</p>
<p>Trên hệ điều hành, tệp đĩa thực tế đều có một thứ gọi là&nbsp;<code>os cache</code>, tức là trước khi dữ liệu được ghi vào tệp đĩa, nó sẽ được đưa vào&nbsp;<code>os cache</code> trước, đầu tiên vào bộ nhớ cache cấp hệ điều hành. Chỉ cần dữ liệu trong bộ đệm được chuyển vào&nbsp;<code>os cache</code>&nbsp;thông qua hoạt động refresh, dữ liệu này có thể được tìm kiếm.</p>
<p>Tại sao nói rằng ES là&nbsp;<strong>gần như thời gian thực</strong>?&nbsp;<code>NRT</code>, tên đầy đủ là&nbsp;<code>near real-time</code>. Mặc định là refresh mỗi giây một lần, vì vậy ES là gần như thời gian thực, vì dữ liệu được ghi vào sau 1 giây mới có thể được tìm thấy. Bạn có thể sử dụng&nbsp;<code>restful api</code>&nbsp;của es hoặc&nbsp;<code>java api</code>&nbsp;để thực hiện một hoạt động refresh&nbsp;<strong>thủ công</strong>, tức là thủ công đưa dữ liệu trong bộ đệm vào&nbsp;<code>os cache</code>, để dữ liệu có thể được tìm kiếm ngay lập tức. Miễn là dữ liệu được đưa vào&nbsp;<code>os cache</code>, bộ đệm sẽ được làm sạch, vì không cần giữ bộ đệm nữa, dữ liệu đã được lưu trữ trong tệp nhật ký translog một lần.</p>
<p>Lặp lại các bước trên, dữ liệu mới liên tục vào bộ đệm và translog, liên tục ghi dữ liệu&nbsp;<code>buffer</code>&nbsp;vào một&nbsp;<code>segment file</code>&nbsp;mới sau mỗi lần&nbsp;<code>refresh</code>, sau mỗi lần&nbsp;<code>refresh</code>&nbsp;bộ đệm sẽ được làm sạch, translog sẽ được giữ lại. Khi quá trình này tiếp diễn, translog sẽ ngày càng lớn. Khi translog đạt đến một độ dài nhất định, nó sẽ kích hoạt hoạt động&nbsp;<code>commit</code>.</p>
<p>Bước đầu tiên của hoạt động commit là ghi dữ liệu hiện có trong bộ đệm vào&nbsp;<code>os cache</code>, sau đó làm sạch bộ đệm. Sau đó, ghi một&nbsp;<code>commit point</code>&nbsp;vào tệp đĩa, trong đó đánh dấu tất cả các&nbsp;<code>segment file</code>&nbsp;tương ứng với&nbsp;<code>commit point</code>&nbsp;này, đồng thời buộc&nbsp;<code>os cache</code>&nbsp;chứa tất cả dữ liệu hiện tại để được&nbsp;<code>fsync</code>&nbsp;vào tệp đĩa. Cuối cùng,&nbsp;<strong>xóa</strong>&nbsp;tệp nhật ký translog hiện tại, khởi động lại một translog, lúc này hoạt động commit đã hoàn thành.</p>
<p>Hoạt động commit này được gọi là&nbsp;<code>flush</code>. Mặc định là mỗi 30 phút tự động thực hiện một lần&nbsp;<code>flush</code>, nhưng nếu translog quá lớn, cũng sẽ kích hoạt&nbsp;<code>flush</code>. Hoạt động flush tương ứng với toàn bộ quá trình commit, chúng ta có thể thông qua api của es, thực hiện thủ công hoạt động flush, thủ công&nbsp;<code>fsync</code>&nbsp;dữ liệu trong&nbsp;<code>os cache</code>&nbsp;vào đĩa.</p>
<p>Tệp nhật ký translog có vai trò gì? Trước khi bạn thực hiện hoạt động commit, dữ liệu có thể đang nằm trong bộ đệm hoặc nằm trong&nbsp;<code>os cache</code>. Dù là bộ đệm hay&nbsp;<code>os cache</code>&nbsp;đều là bộ nhớ, nếu máy này bị hỏng, dữ liệu trong bộ nhớ sẽ mất hết. Vì vậy, cần ghi các hoạt động tương ứng của dữ liệu vào một tệp nhật ký đặc biệt là&nbsp;<code>translog</code>, nếu máy bị hỏng lúc này, khi khởi động lại, es sẽ tự động đọc dữ liệu từ tệp nhật ký translog và phục hồi vào bộ nhớ&nbsp;<code>buffer</code>&nbsp;và&nbsp;<code>os cache</code>.</p>
<p>Thực tế, translog cũng được ghi vào&nbsp;<code>os cache</code>&nbsp;trước, mặc định là mỗi 5 giây sẽ đẩy vào đĩa một lần, vì vậy mặc định, có thể có 5 giây dữ liệu chỉ nằm trong bộ đệm hoặc <code>os cache</code> hoặc tệp translog, không nằm trên đĩa, nếu máy này bị hỏng lúc này, sẽ&nbsp;<strong>mất</strong>&nbsp;5 giây dữ liệu. Nhưng hiệu suất như vậy tốt hơn, mất tối đa 5 giây dữ liệu. Bạn cũng có thể đặt translog để mỗi lần ghi phải&nbsp;<code>fsync</code>&nbsp;trực tiếp vào đĩa, nhưng hiệu suất sẽ kém hơn nhiều.</p>
<p>Thực tế, nếu bạn ở đây, nếu người phỏng vấn không hỏi bạn về vấn đề mất dữ liệu của es, bạn có thể tự hào với người phỏng vấn ở đây, bạn nói, thực tế es trước tiên là gần như thời gian thực, dữ liệu được ghi vào sau 1 giây mới có thể được tìm thấy; có thể mất dữ liệu. Có 5 giây dữ liệu, nằm trong bộ đệm,&nbsp;<code>os cache</code>&nbsp;của translog,&nbsp;<code>os cache</code>&nbsp;của&nbsp;<code>segment file</code>, không nằm trên đĩa, nếu máy này bị hỏng lúc này, sẽ dẫn đến&nbsp;<strong>mất</strong>&nbsp;5 giây dữ liệu.</p>
<p><strong>Tóm lại</strong>, dữ liệu được ghi vào bộ đệm trước, sau đó mỗi giây, dữ liệu sẽ được refresh vào&nbsp;<code>os cache</code>, khi dữ liệu đến&nbsp;<code>os cache</code>, dữ liệu có thể được tìm kiếm (đó là lý do tại sao chúng ta nói rằng từ khi dữ liệu được ghi vào cho đến khi có thể tìm kiếm, có độ trễ 1s). Mỗi 5 giây, dữ liệu sẽ được ghi vào tệp translog (do đó, nếu máy bị hỏng, tất cả dữ liệu trong bộ nhớ sẽ mất, tối đa sẽ mất 5s dữ liệu), khi translog lớn đến một mức độ nhất định, hoặc mặc định mỗi 30 phút, một hoạt động commit sẽ được kích hoạt, đẩy tất cả dữ liệu trong bộ đệm vào tệp&nbsp;<code>segment file</code>trên đĩa.</p>
<blockquote>
<p>Sau khi dữ liệu được ghi vào&nbsp;<code>segment file</code>, chỉ mục đảo ngược cũng sẽ được tạo ngay lập tức.</p>
</blockquote>
<h3>Nguyên lý cơ bản khi xóa/cập nhật dữ liệu</h3>
<p>Nếu là hoạt động xóa, khi commit sẽ tạo ra một tệp&nbsp;<code>.del</code>, trong đó đánh dấu một doc nhất định là trạng thái&nbsp;<code>deleted</code>, vì vậy khi tìm kiếm, dựa vào tệp&nbsp;<code>.del</code>, bạn sẽ biết liệu doc có bị xóa hay không.</p>
<p>Nếu là hoạt động cập nhật, nó sẽ đánh dấu doc gốc là trạng thái&nbsp;<code>deleted</code>&nbsp;và sau đó ghi một dữ liệu mới.</p>
<p>Mỗi khi bộ đệm được refresh, một&nbsp;<code>segment file</code>&nbsp;sẽ được tạo ra, vì vậy mặc định là một&nbsp;<code>segment file</code>&nbsp;mỗi giây, vì vậy&nbsp;<code>segment file</code>&nbsp;sẽ ngày càng nhiều, lúc này sẽ thường xuyên thực hiện merge. Mỗi lần merge, nhiều&nbsp;<code>segment file</code>&nbsp;sẽ được hợp nhất thành một, đồng thời ở đây, doc được đánh dấu là&nbsp;<code>deleted</code>&nbsp;sẽ được&nbsp;<strong>xóa vật lý</strong>, sau đó ghi&nbsp;<code>segment file</code>&nbsp;mới vào đĩa, ở đây sẽ ghi một&nbsp;<code>commit point</code>, đánh dấu tất cả&nbsp;<code>segment file</code>&nbsp;mới, sau đó mở&nbsp;<code>segment file</code>&nbsp;để tìm kiếm, và sau đó xóa&nbsp;<code>segment file</code>&nbsp;cũ.</p>
<h3>Lớp cơ bản Lucene</h3>
<p>Đơn giản, Lucene chỉ là một thư viện jar, bên trong nó chứa các mã thuật toán đã được đóng gói để tạo chỉ mục đảo ngược. Khi chúng ta phát triển bằng Java, chúng ta chỉ cần import thư viện jar Lucene, sau đó phát triển dựa trên API của Lucene.</p>
<p>Thông qua Lucene, chúng ta có thể tạo chỉ mục cho dữ liệu hiện có, Lucene sẽ tổ chức cấu trúc dữ liệu chỉ mục trên ổ đĩa cục bộ cho chúng ta.</p>
<h3>Chỉ mục đảo ngược</h3>
<p>Trong công cụ tìm kiếm, mỗi tài liệu đều có một ID tài liệu tương ứng, nội dung tài liệu được biểu diễn dưới dạng một tập hợp các từ khóa. Ví dụ, sau khi phân loại, tài liệu 1 đã trích xuất 20 từ khóa, mỗi từ khóa đều ghi lại số lần xuất hiện và vị trí xuất hiện của nó trong tài liệu.</p>
<p>Vậy, chỉ mục đảo ngược là ánh xạ từ&nbsp;<strong>từ khóa đến ID tài liệu</strong>, mỗi từ khóa đều tương ứng với một loạt tài liệu, trong đó tất cả các tài liệu đều xuất hiện từ khóa.</p>
<p>Ví dụ.</p>
<p>Có các tài liệu sau:</p>
<p>| DocId | Doc                                                                           |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223081955.png" type="image/png"/>
    </item>
    <item>
      <title>Elasticsearch Intro</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/intro.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/intro.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Intro</source>
      <description>Giới thiệu về Elasticsearch Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu dựa trên Lucene, cung cấp một dịch vụ phân tán. Elasticsearch là một sản phẩm mã nguồn mở ...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu dựa trên Lucene, cung cấp một dịch vụ phân tán. Elasticsearch là một sản phẩm mã nguồn mở tuân thủ các điều khoản mã nguồn mở của Apache và hiện là công cụ tìm kiếm cấp doanh nghiệp phổ biến hiện nay.</p>
<p>Nó được sử dụng cho tìm kiếm toàn văn bản, tìm kiếm có cấu trúc, phân tích, và kết hợp ba yếu tố này:</p>
<ul>
<li>Wikipedia sử dụng Elasticsearch để cung cấp tìm kiếm toàn văn bản với đánh dấu từ khóa, cũng như các tính năng đề xuất tìm kiếm như&nbsp;<strong>tìm kiếm thời gian thực (search-as-you-type)</strong>&nbsp;và&nbsp;<strong>sửa lỗi tìm kiếm (did-you-mean)</strong>.</li>
<li>The Guardian sử dụng Elasticsearch để cung cấp phản hồi thời gian thực cho biên tập viên của họ bằng cách kết hợp dữ liệu nhật ký người dùng và dữ liệu mạng xã hội, giúp họ hiểu rõ phản ứng của công chúng đối với các bài viết mới xuất bản.</li>
<li>StackOverflow kết hợp tìm kiếm toàn văn bản với truy vấn vị trí địa lý và tính năng&nbsp;<strong>more-like-this</strong>&nbsp;để tìm các câu hỏi và câu trả lời liên quan.</li>
<li>Github sử dụng Elasticsearch để tìm kiếm 130 tỷ dòng code. (số liệu có thể thay đổi hàng giờ nên có thể sai lệch tại thời điểm viết)</li>
</ul>
<h2>Đặc điểm của Elasticsearch</h2>
<ul>
<li>Lưu trữ tệp thời gian thực phân tán, với mỗi trường được lập chỉ mục và có thể tìm kiếm.</li>
<li>Công cụ tìm kiếm phân tích thời gian thực phân tán.</li>
<li>Có thể mở rộng linh hoạt lên đến hàng trăm máy chủ, xử lý dữ liệu có cấu trúc hoặc không có cấu trúc ở cấp petabyte.</li>
<li>Sẵn sàng sử dụng ngay sau khi cài đặt, nó cung cấp nhiều giá trị mặc định hợp lý và ẩn đi lý thuyết công cụ tìm kiếm phức tạp đối với người mới học. Nó có thể được sử dụng trong môi trường product với yêu cầu học tập tối thiểu.</li>
</ul>
<h2>Lịch sử phát triển của Elasticsearch</h2>
<ul>
<li>Ngày 8 tháng 2 năm 2010, phiên bản công khai đầu tiên của Elasticsearch đã được phát hành.</li>
<li>Ngày 14 tháng 5 năm 2010, phiên bản ban đầu mang tính bước ngoặt <strong>0.7.0</strong> được phát hành, với các tính năng:
<ul>
<li>Mô-đun Zen Discovery tự động phát hiện;
<ul>
<li>Hỗ trợ cho Groovy Client;</li>
</ul>
</li>
<li>Cơ chế quản lý plugin đơn giản;
<ul>
<li>Hỗ trợ tốt hơn cho bộ tách từ icu;</li>
</ul>
</li>
<li>Nhiều API quản lý hơn.</li>
</ul>
</li>
<li>Đầu năm 2013, GitHub từ bỏ Solr và chọn Elasticsearch để thực hiện tìm kiếm cấp PB của mình.</li>
<li>Ngày 14 tháng 2 năm 2014, phiên bản <strong>1.0.0</strong> được phát hành, thêm các tính năng quan trọng sau:
<ul>
<li>Hỗ trợ cho Snapshot/Restore API backup recovery API;
<ul>
<li>Hỗ trợ cho Aggregations;</li>
</ul>
</li>
<li>Hỗ trợ cho cat API;
<ul>
<li>Hỗ trợ cho circuit breakers;</li>
</ul>
</li>
<li>Giới thiệu Doc values.</li>
</ul>
</li>
<li>Ngày 28 tháng 10 năm 2015, phiên bản <strong>2.0.0</strong> được phát hành, với các tính năng quan trọng sau:
<ul>
<li>Thêm Pipleline Aggregations;
<ul>
<li>Query/filter query merging, tất cả được hợp nhất vào query, thực hiện các truy vấn khác nhau theo các ngữ cảnh khác nhau;</li>
</ul>
</li>
<li>Cấu hình lưu trữ nén;
<ul>
<li>Mô-đun Rivers đã bị loại bỏ;</li>
</ul>
</li>
<li>Tính năng Multicast đã bị loại bỏ, trở thành một plugin, và một địa chỉ unicast phải được cấu hình trong môi trường sản xuất.</li>
</ul>
</li>
<li>Ngày 26 tháng 10 năm 2016, phiên bản <strong>5.0.0</strong> được phát hành, với các thay đổi tính năng lớn sau:
<ul>
<li>Hỗ trợ cho Lucene 6.x, giảm một nửa không gian đĩa; giảm một nửa thời gian lập chỉ mục; tăng 25% hiệu suất truy vấn; hỗ trợ cho IPV6;</li>
<li>Khóa đua được sử dụng để tránh cập nhật đồng thời của cùng một tài liệu đã được loại bỏ ở cấp Internal Engine, dẫn đến cải thiện hiệu suất 15%-20%;</li>
<li>Shrink API, có thể thu nhỏ số lượng shard thành các yếu tố của nó, ví dụ như nếu trước đây bạn có 15 shard, bạn có thể thu nhỏ thành 5 hoặc 3 hoặc 1, vì vậy chúng ta có thể tưởng tượng một tình huống như thế này, trong giai đoạn thu thập mà áp lực ghi là rất lớn, đặt đủ chỉ mục, tận dụng tối đa khả năng ghi song song của shard, sau khi chỉ mục được viết, thu nhỏ thành ít shard hơn, cải thiện hiệu suất truy vấn;
<ul>
<li>Cung cấp SDK client REST gốc Java đầu tiên;</li>
</ul>
</li>
<li>IngestNode, trước đây nếu bạn cần xử lý dữ liệu, nó được xử lý trước khi lập chỉ mục, ví dụ như logstash có thể cấu trúc và chuyển đổi nhật ký, bây giờ nó có thể được xử lý trực tiếp trong es;
<ul>
<li>Cung cấp script Painless, thay thế cho script Groovy;</li>
<li>Loại bỏ site plugins, có nghĩa là head, bigdesk không thể được cài đặt trực tiếp trong es nữa, nhưng có thể triển khai các trang độc lập (dù sao đó cũng là các tệp tĩnh) hoặc phát triển plugin kibana;</li>
<li>Thêm loại Sliced Scroll, bây giờ giao diện Scroll có thể được sử dụng để duyệt dữ liệu đồng thời. Mỗi yêu cầu Scroll có thể được chia thành nhiều yêu cầu Slice, có thể được hiểu là các lát, mỗi Slice là độc lập và song song, sử dụng Scroll để xây dựng lại hoặc duyệt sẽ nhanh hơn nhiều lần;</li>
<li>Thêm Profile API;</li>
<li>Thêm Rollover API;</li>
<li>Thêm Reindex;</li>
<li>Giới thiệu các loại trường mới Text/Keyword để thay thế String;</li>
<li>Giới hạn kích thước yêu cầu chỉ mục để tránh một số lượng lớn yêu cầu đồng thời làm quá tải ES;</li>
<li>Giới hạn số lượng shard trong một yêu cầu duy nhất, mặc định 1000.</li>
</ul>
</li>
</ul>
</li>
<li>Ngày 31 tháng 8 năm 2017, phiên bản <strong>6.0.0</strong> được phát hành, với các tính năng quan trọng sau:
<ul>
<li>Hỗ trợ cho Doc Values thưa thớt;
<ul>
<li>Index Sorting, tức là sắp xếp ở giai đoạn lập chỉ mục;</li>
</ul>
</li>
<li>Hỗ trợ cho số thứ tự, mỗi hoạt động es có một số thứ tự (tương tự như thiết kế tăng dần);
<ul>
<li>Nâng cấp cuộn mượt mà;</li>
</ul>
</li>
<li>Bắt đầu từ 6.0, không hỗ trợ nhiều loại trong một index;
<ul>
<li>Index-template inheritance, kế thừa phiên bản index, hiện tại các mẫu index đều được khớp và hợp nhất, điều này có thể gây ra một số vấn đề xung đột mẫu index, 6.0 sẽ chỉ khớp một, và index sẽ được xác minh khi tạo;</li>
<li>Load aware shard routing, định tuyến yêu cầu dựa trên tải, các yêu cầu tìm kiếm hiện tại là toàn nút polling, vì vậy nút hoạt động chậm nhất thường gây ra tăng độ trễ tổng thể, cách thực hiện mới sẽ tự động điều chỉnh độ dài hàng đợi dựa trên thời gian tiêu thụ của hàng đợi, độ dài hàng đợi của nút tải cao sẽ giảm, cho phép các nút khác chia sẻ áp lực nhiều hơn, tìm kiếm và chỉ mục sẽ dựa trên cơ chế này;</li>
<li>Các chỉ mục đã đóng cũng sẽ hỗ trợ xử lý tự động của bản sao để đảm bảo độ tin cậy của dữ liệu.</li>
</ul>
</li>
</ul>
</li>
<li>Ngày 10 tháng 4 năm 2019, phiên bản <strong>7.0.0</strong> được phát hành, với các tính năng quan trọng sau:
<ul>
<li>Thay đổi kết nối cụm: TransportClient đã bị loại bỏ, mã java của es7 chỉ có thể sử dụng restclient; đối với lập trình java, nên sử dụng High-level-rest-client để vận hành cụm ES;
<ul>
<li>Gói chương trình ES mặc định đóng gói jdk: phiên bản gói chương trình 7.x trở thành 300MB+, so với 6.x, gói lớn hơn 200MB+, đây chính là kích thước của JDK;</li>
<li>Sử dụng Lucene 9.0;
<ul>
<li>Chính thức loại bỏ hỗ trợ cho nhiều Type dưới một chỉ mục duy nhất, thời gian es6, chính thức đã nói rằng es7 sẽ xóa type, và thời gian es6, đã quy định rằng mỗi chỉ mục chỉ có thể có một loại. Trong es7, sử dụng _doc mặc định như là loại, chính thức nói trong phiên bản 8.x sẽ hoàn toàn loại bỏ loại. Phương thức yêu cầu API cũng gửi thay đổi, chẳng hạn như lấy một tài liệu của một ID cụ thể của một chỉ mục: GET index/_doc/id nơi chỉ mục và id là các giá trị cụ thể;</li>
</ul>
</li>
</ul>
</li>
<li>Giới thiệu một bộ cắt mạch bộ nhớ thực sự, có thể phát hiện chính xác hơn các yêu cầu không thể xử lý và ngăn chúng làm cho một nút duy nhất không ổn định;
<ul>
<li>Zen2 là lớp điều phối cụm hoàn toàn mới của Elasticsearch, cải thiện độ tin cậy, hiệu suất, và trải nghiệm người dùng, trở nên nhanh hơn, an toàn hơn, và dễ sử dụng hơn.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2>Các khái niệm về Elasticsearch</h2>
<p>Dưới đây là một số khái niệm cốt lõi của Elasticsearch. Hiểu rõ những khái niệm này từ đầu sẽ giúp bạn đơn giản hóa quá trình học Elasticsearch.</p>
<h3>Gần thời gian thực (NRT)</h3>
<p>Elasticsearch là một nền tảng tìm kiếm gần thời gian thực. Điều này có nghĩa là <strong>có một khoảng trễ nhỏ (thường là một giây) từ lúc lập chỉ mục cho một tài liệu cho đến khi tài liệu đó có thể được tìm kiếm</strong>.</p>
<h3>Chỉ mục (Index)</h3>
<p>Trong các ngữ cảnh khác nhau, "chỉ mục" có những ý nghĩa khác nhau:</p>
<ul>
<li>Chỉ mục (danh từ): Một&nbsp;<strong>chỉ mục</strong>&nbsp;tương tự như một&nbsp;<strong>cơ sở dữ liệu</strong>trong cơ sở dữ liệu quan hệ truyền thống, là một nơi chứa các tài liệu dạng quan hệ. Chỉ mục thực chất là một&nbsp;<strong>không gian tên logic</strong>&nbsp;trỏ đến một hoặc nhiều&nbsp;<strong>phân đoạn vật lý</strong>.</li>
<li>Chỉ mục (động từ): Chỉ mục một tài liệu có nghĩa là lưu trữ một tài liệu vào một&nbsp;<em>chỉ mục</em>&nbsp;(danh từ) để có thể được tìm kiếm và truy vấn. Điều này rất giống với từ khóa&nbsp;<code>INSERT</code>&nbsp;trong SQL, ngoại trừ khi tài liệu đã tồn tại, tài liệu mới sẽ thay thế tài liệu cũ.</li>
<li>Chỉ mục đảo ngược : Cơ sở dữ liệu quan hệ tăng tốc độ truy vấn dữ liệu bằng cách thêm một chỉ mục, chẳng hạn như một chỉ mục cây B, vào các cột được chỉ định. Elasticsearch và Lucene sử dụng một cấu trúc gọi là&nbsp;<strong>chỉ mục đảo ngược</strong>&nbsp;để đạt được mục đích tương tự.</li>
</ul>
<p>Chỉ mục của Mapping và Setting</p>
<ul>
<li><strong><code>Mapping</code></strong>&nbsp;xác định kiểu của các trường tài liệu</li>
<li><strong><code>Setting</code></strong>&nbsp;xác định phân phối dữ liệu khác nhau</li>
</ul>
<p>Ví dụ:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "settings"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">...</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> any</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> settings</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> ...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "mappings"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "type_one"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">...</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> any</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> mappings</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> ...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "type_two"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">...</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> any</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> mappings</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF"> ...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">        ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Chỉ mục đảo ngược</h4>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223160504.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h4>index template</h4>
<p><strong><code>index template</code></strong> (mẫu chỉ mục) giúp người dùng đặt Mapping và Setting, và tự động khớp chúng với chỉ mục mới được tạo theo một quy tắc nhất định.</p>
<ul>
<li>Mẫu chỉ có hiệu lực khi một chỉ mục được tạo. Việc sửa đổi mẫu sẽ không ảnh hưởng đến các chỉ mục đã tạo.</li>
<li>Bạn có thể đặt nhiều mẫu chỉ mục, các thiết lập này sẽ được kết hợp lại với nhau.</li>
<li>Bạn có thể chỉ định giá trị order để kiểm soát quá trình kết hợp.</li>
</ul>
<p>Khi tạo mới một chỉ mục:</p>
<ul>
<li>Áp dụng Mapping và Setting mặc định của ES</li>
<li>Áp dụng các thiết lập trong mẫu chỉ mục có giá trị order thấp</li>
<li>Áp dụng các thiết lập trong mẫu chỉ mục có giá trị order cao, các thiết lập trước đó sẽ bị ghi đè</li>
<li>Áp dụng Mapping và Setting được chỉ định bởi người dùng khi tạo chỉ mục, và ghi đè các thiết lập trong mẫu trước đó.</li>
</ul>
<p>Ví dụ: Tạo mẫu chỉ mục mặc định</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> _template/template_default</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "index_patterns"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"*"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "order"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "version"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "number_of_shards"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "number_of_replicas"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /_template/template_test</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "index_patterns"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"test*"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "order"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "number_of_shards"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "number_of_replicas"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "date_detection"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> false</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "numeric_detection"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Kiểm tra mẫu chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_template/template_default</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_template/temp</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Ghi dữ liệu mới, chỉ mục bắt đầu bằng test</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> testtemplate/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "someNumber"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "someDate"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "2019/01/01"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> testtemplate/_mapping</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> testtemplate/_settings</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> testmy</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"number_of_replicas"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">:5</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> testmy/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "key"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "value"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> testmy/_settings</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> testmy</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> /_template/template_default</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> /_template/template_test</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>dynamic template</h4>
<ul>
<li>Dựa vào kiểu dữ liệu được ES nhận biết, kết hợp với tên trường, để đặt động kiểu trường:
<ul>
<li>Tất cả các kiểu chuỗi đều được đặt thành Keyword, hoặc tắt trường keyword.</li>
<li>Các trường bắt đầu bằng "is" đều được đặt thành boolean.</li>
<li>Các trường bắt đầu bằng "long_" đều được đặt thành kiểu long.</li>
</ul>
</li>
<li>Mẫu động được định nghĩa trong Mapping của một chỉ mục.</li>
<li>Mẫu có một tên.</li>
<li>Quy tắc khớp là một mảng.</li>
<li>Đặt Mapping cho các trường khớp.</li>
</ul>
<p>Ví dụ:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Dynaminc Mapping dựa trên kiểu và tên trường</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "firstName"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Ruan",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "isVIP"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index/_mapping</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "dynamic_templates"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "strings_as_boolean"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "match_mapping_type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "string",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "is*",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "mapping"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "boolean"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "strings_as_keywords"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "match_mapping_type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "string",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "mapping"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "keyword"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index/_mapping</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Kết hợp với đường dẫn</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "dynamic_templates"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "full_name"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "path_match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "name.*",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "path_unmatch"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "*.middle",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "mapping"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "text",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "copy_to"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "full_name"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index/_mapping</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "name"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "first"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "John",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "middle"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Winston",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "last"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Lennon"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index/_search?q=full_name:John</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my_index</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3><s>Kiểu (Type)</s></h3>
<p><s>Kiểu là một phân loại hay phân vùng theo ý nghĩa logic, cho phép tạo nhiều loại trong cùng một chỉ mục. Bản chất, nó tương đương với một điều kiện lọc, các phiên bản cao hơn sẽ loại bỏ khái niệm loại.</s></p>
<blockquote>
<p><s><strong>Từ phiên bản 6.0.0 trở đi, loại đã bị loại bỏ</strong></s></p>
</blockquote>
<h3>Tài liệu (Document)</h3>
<p>Elasticsearch là hướng tới tài liệu, <strong>tài liệu là đơn vị nhỏ nhất của tất cả dữ liệu có thể tìm kiếm</strong>.</p>
<p>Elasticsearch sử dụng <a href="http://en.wikipedia.org/wiki/Json" target="_blank" rel="noopener noreferrer"><em>JSON</em></a> làm định dạng tuần tự hóa cho tài liệu.</p>
<p>Trong chỉ mục/loại, bạn có thể lưu trữ bất kỳ số lượng tài liệu nào theo nhu cầu.</p>
<p>Mỗi tài liệu đều có một <strong>ID duy nhất</strong></p>
<ul>
<li>Người dùng có thể tự chỉ định</li>
<li>Hoặc được Elasticsearch tự động tạo</li>
</ul>
<h4>Metadata của tài liệu</h4>
<p>Một tài liệu không chỉ chứa dữ liệu của nó, mà còn chứa <strong>metadata</strong> - thông tin về tài liệu.</p>
<ul>
<li><code>_index</code>: Tài liệu được lưu trữ ở đâu</li>
<li><code>_type</code>: Loại đối tượng mà tài liệu đại diện</li>
<li><code>_id</code>: Định danh duy nhất của tài liệu</li>
<li><code>_source</code>: Dữ liệu Json gốc của tài liệu</li>
<li><code>_all</code>: Tích hợp tất cả nội dung của các trường vào trường này, đã bị loại bỏ</li>
<li><code>_version</code>: Thông tin phiên bản của tài liệu</li>
<li><code>_score</code>: Điểm liên quan</li>
</ul>
<p>Ví dụ:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"megacorp"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"employee"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_version"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "found"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_source"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "first_name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"John"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "last_name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Smith"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "age"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "about"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"I love to go rock climbing"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "interests"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"sports"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"music"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>Nút (Node)</h3>
<h4>Giới thiệu về nút</h4>
<p>Một thực thể Elasticsearch đang chạy được gọi là một <strong>nút</strong>.</p>
<p>Thực thể Elasticsearch về cơ bản là một tiến trình Java. Một máy có thể chạy nhiều tiến trình Elasticsearch, nhưng môi trường product nên chạy một tiến trình Elasticsearch trên một máy.</p>
<p>Mỗi nút đều có tên, được cấu hình thông qua tệp cấu hình, hoặc chỉ định khi khởi động thông qua <code>-E node.name=node1</code>.</p>
<p>Sau khi mỗi nút khởi động, nó sẽ được gán một UID, được lưu trong thư mục <code>data</code>.</p>
<h4>Loại nút</h4>
<ul>
<li><strong>Nút chính (master node)</strong>: Mỗi nút đều lưu trữ trạng thái của cụm, chỉ có nút chính mới có thể sửa đổi thông tin trạng thái của cụm (đảm bảo tính nhất quán của dữ liệu). <strong>Trạng thái cụm</strong> duy trì thông tin sau:
<ul>
<li>Thông tin về tất cả các nút</li>
<li>Tất cả các chỉ mục và thông tin liên quan đến mapping và setting</li>
<li>Thông tin định tuyến phân đoạn</li>
</ul>
</li>
<li><strong>Nút ứng cử (master eligible node)</strong>: Nút ứng cử có thể tham gia vào quá trình bầu chọn chính. Nút khởi động đầu tiên sẽ tự bầu làm nút chính.
<ul>
<li>Sau khi mỗi nút khởi động, mặc định là nút ứng cử, có thể bị cấm thông qua cấu hình <code>node.master: false</code></li>
</ul>
</li>
<li><strong>Nút dữ liệu (data node)</strong>: Chịu trách nhiệm lưu trữ dữ liệu phân đoạn.</li>
<li><strong>Nút điều phối (coordinating node)</strong>: Chịu trách nhiệm nhận yêu cầu từ khách hàng, phân phối yêu cầu đến nút thích hợp, cuối cùng tổng hợp kết quả lại với nhau. Mỗi nút Elasticsearch mặc định đều là nút điều phối (coordinating node).</li>
<li><strong>Nút lạnh/nóng (warm/hot node)</strong>: Dành cho các nút dữ liệu (data node) với cấu hình phần cứng khác nhau, để thực hiện kiến trúc Hot &amp; Warm, giảm chi phí triển khai cụm.</li>
<li><strong>Nút học máy (machine learning node)</strong>: Chịu trách nhiệm thực hiện công việc học máy, được sử dụng để phát hiện bất thường.</li>
</ul>
<h4>Cấu hình nút</h4>
<p>| Tham số cấu hình | Giá trị mặc định | Giải thích                               |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223160504.png" type="image/png"/>
    </item>
    <item>
      <title>Elasticsearch Mapping</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/mapping.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/mapping.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Mapping</source>
      <description>Elasticsearch Mapping Trong Elasticsearch, Mapping (ánh xạ) được sử dụng để xác định cách một tài liệu cùng với các trường bên trong nó được lưu trữ và lập chỉ mục. Mapping cho ...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Trong Elasticsearch, <strong><code>Mapping</code></strong> (ánh xạ) được sử dụng để xác định cách một tài liệu cùng với các trường bên trong nó được lưu trữ và lập chỉ mục. Mapping cho phép bạn xác định trước các thuộc tính như kiểu dữ liệu của các trường, trọng số của các trường, bộ phân tích từ và các thuộc tính khác, giống như việc thiết lập các trường khi tạo bảng trong cơ sở dữ liệu quan hệ.</p>
<p>Mapping sẽ ánh xạ tài liệu JSON thành định dạng phẳng mà Lucene cần.</p>
<p>Mỗi Mapping thuộc về một Type của chỉ mục.</p>
<ul>
<li>Mỗi tài liệu đều thuộc về một Type.</li>
<li>Một Type có một định nghĩa Mapping.</li>
<li>Từ phiên bản 7.0 trở đi, không cần phải chỉ định thông tin type trong định nghĩa Mapping.</li>
</ul>
<p>Mỗi <code>document</code> là một tập hợp của <code>field</code>, mỗi <code>field</code> đều có kiểu dữ liệu của riêng nó. Khi ánh xạ dữ liệu, bạn có thể tạo một <code>mapping</code> chứa danh sách <code>field</code> liên quan đến <code>document</code>. Định nghĩa ánh xạ cũng bao gồm các <code>field</code> metadata, như <code>_source</code>, nó tùy chỉnh cách xử lý metadata liên quan đến <code>document</code>.</p>
<h2>Cách ánh xạ</h2>
<p>Trong Elasticsearch, ánh xạ có thể được chia thành ánh xạ tĩnh và ánh xạ động. Trong cơ sở dữ liệu quan hệ, trước khi ghi dữ liệu, bạn cần tạo bảng và khai báo thuộc tính của các trường trong câu lệnh tạo bảng. Tuy nhiên, trong Elasticsearch, điều này không cần thiết. Một trong những tính năng quan trọng nhất của Elasticsearch là cho phép bạn bắt đầu khám phá dữ liệu càng nhanh càng tốt. Khi tài liệu được ghi vào Elasticsearch, nó sẽ tự động nhận biết kiểu dữ liệu của các trường. Cơ chế này được gọi là <strong>ánh xạ động</strong>. Trong khi đó, <strong>ánh xạ tĩnh</strong> là việc thiết lập thuộc tính của các trường trước khi ghi dữ liệu.</p>
<h3>Ánh xạ tĩnh</h3>
<p>ES gọi ánh xạ tĩnh là <strong>ánh xạ rõ ràng (<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/explicit-mapping.html" target="_blank" rel="noopener noreferrer">Explicit mapping</a>)</strong>. <strong>Ánh xạ tĩnh</strong> là việc chỉ định rõ ràng ánh xạ chỉ mục khi tạo chỉ mục. Ánh xạ tĩnh tương tự như việc chỉ định thuộc tính trường trong câu lệnh tạo bảng trong SQL. So với ánh xạ động, thông qua ánh xạ tĩnh, bạn có thể thêm các thông tin cấu hình chi tiết và chính xác hơn. Ví dụ:</p>
<ul>
<li>Những trường chuỗi nào nên được coi là trường toàn văn bản.</li>
<li>Những trường nào chứa số, ngày hoặc vị trí địa lý.</li>
<li>Định dạng của giá trị ngày.</li>
<li>Các quy tắc tùy chỉnh để kiểm soát việc thêm trường động.</li>
</ul>
<p>【Ví dụ】Khi tạo chỉ mục, chỉ định rõ ràng mapping</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">PUT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> /</span><span style="color:#E06C75;--shiki-dark:#E06C75">my</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#E06C75;--shiki-dark:#E06C75">index</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">000001</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "mappings"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "properties"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">      "age"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:    { </span><span style="color:#98C379;--shiki-dark:#98C379">"type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"integer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">      "email"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:  { </span><span style="color:#98C379;--shiki-dark:#98C379">"type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"keyword"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">      "name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:   { </span><span style="color:#98C379;--shiki-dark:#98C379">"type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>【Ví dụ】Trong chỉ mục đã tồn tại, chỉ định thuộc tính của một trường</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">PUT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> /</span><span style="color:#E06C75;--shiki-dark:#E06C75">my</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#E06C75;--shiki-dark:#E06C75">index</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">000001</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">/</span><span style="color:#E06C75;--shiki-dark:#E06C75">_mapping</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "properties"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "employee-id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">      "type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"keyword"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">      "index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>【Ví dụ】Xem mapping</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /my-index-000001/_mapping</span></span></code></pre>
</div><p>【Ví dụ】Xem mapping của một trường cụ thể</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /my-index-000001/_mapping/field/employee-id</span></span></code></pre>
</div><h3>Ánh xạ động</h3>
<p>Cơ chế ánh xạ động cho phép người dùng không cần định nghĩa thủ công ánh xạ, Elasticsearch sẽ tự động nhận biết kiểu dữ liệu của các trường. Trong các dự án thực tế, nếu đối tác không biết trước các trường nào sẽ xuất hiện trong dữ liệu được nhập vào, hoặc không rõ kiểu dữ liệu của các trường, việc sử dụng ánh xạ động sẽ rất phù hợp. Khi Elasticsearch gặp một trường chưa từng thấy trước đó trong một tài liệu, nó sẽ sử dụng ánh xạ động để xác định kiểu của trường và tự động thêm trường đó vào ánh xạ.</p>
<p>Ví dụ: Tạo một chỉ mục tên là <code>data</code>, với kiểu <code>mapping</code> là <code>_doc</code>, và có một trường kiểu <code>long</code> tên <code>count</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> data/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"count"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span></code></pre>
</div><h4>Ánh xạ động trường</h4>
<p>Ánh xạ động trường (<a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic-field-mapping.html" target="_blank" rel="noopener noreferrer">Dynamic field mappings</a>) là quy tắc để quản lý việc phát hiện trường động. Khi Elasticsearch phát hiện một trường mới trong một tài liệu, theo mặc định, nó sẽ tự động thêm trường đó vào ánh xạ kiểu.</p>
<p>Trong ánh xạ, bạn có thể mở ánh xạ động bằng cách đặt tham số <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic.html" target="_blank" rel="noopener noreferrer"><code>dynamic</code></a> thành <code>true</code> hoặc <code>runtime</code>.</p>
<p>Các tùy chọn khác nhau của tham số <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/dynamic.html" target="_blank" rel="noopener noreferrer"><code>dynamic</code></a> có các chức năng như sau:</p>
<p>| Giá trị lựa chọn | Mô tả |<br>
|</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Operation</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/operation.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/operation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Operation</source>
      <description>Elasticsearch Operation Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu phân tán, hỗ trợ RESTful, có khả năng giải quyết một số lượng ngày càng tăng các trường hợp sử...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a> là một công cụ tìm kiếm và phân tích dữ liệu phân tán, hỗ trợ RESTful, có khả năng giải quyết một số lượng ngày càng tăng các trường hợp sử dụng. Là trung tâm của Elastic Stack, nó lưu trữ dữ liệu của bạn tập trung để tìm kiếm nhanh chóng, tinh chỉnh độ liên quan, và phân tích mạnh mẽ có thể mở rộng dễ dàng.</p>
</blockquote>
<h2>Cài đặt Elasticsearch</h2>
<blockquote>
<p><a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener noreferrer">Hướng dẫn tải và cài đặt chính thức của Elasticsearch</a></p>
</blockquote>
<p>(1) Tải và giải nén</p>
<p>Truy cập <a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener noreferrer">địa chỉ tải chính thức</a>, chọn phiên bản cần thiết, tải và giải nén về máy của bạn.</p>
<p>(2) Chạy</p>
<p>Chạy <code>bin/elasticsearch</code> (Trên hệ thống Windows, chạy <code>bin\elasticsearch.bat</code>)</p>
<p>(3) Truy cập</p>
<p>Thực hiện <code>curl http://localhost:9200/</code> để kiểm tra xem dịch vụ đã khởi động chưa</p>
<h2>Lập kế hoạch cho Cluster Elasticsearch</h2>
<p>Cluster Elasticsearch cần được lập kế hoạch một cách hợp lý dựa trên tình hình thực tế của doanh nghiệp.</p>
<p>Các điểm cần xem xét:</p>
<ul>
<li>Cần triển khai bao nhiêu node trong cluster?</li>
<li>Có bao nhiêu index?</li>
<li>Mỗi index có bao nhiêu dữ liệu?</li>
<li>Mỗi index có bao nhiêu shard?</li>
</ul>
<p>Một kế hoạch tham khảo:</p>
<ul>
<li>3 máy, mỗi máy là 6-core 64G.</li>
<li>Tăng hàng ngày của cluster ES của chúng tôi là khoảng 20 triệu bản ghi, dữ liệu tăng hàng ngày là khoảng 500MB, dữ liệu tăng hàng tháng là khoảng 600 triệu, 15G. Hệ thống đã hoạt động trong vài tháng, và bây giờ tổng lượng dữ liệu trong cluster ES là khoảng 100G.</li>
<li>Hiện tại có 5 index trực tuyến (điều này được kết hợp với doanh nghiệp của bạn, xem dữ liệu nào của bạn có thể đặt trong ES), mỗi index có khối lượng dữ liệu là khoảng 20G, vì vậy trong khối lượng dữ liệu này, chúng tôi phân bổ 8 shard cho mỗi index, đó là 3 shard nhiều hơn mặc định là 5 shard.</li>
</ul>
<h2>Cấu hình Elasticsearch</h2>
<p>Tệp cấu hình mặc định của ES là <code>config/elasticsearch.yml</code></p>
<p>Dưới đây là một số thông tin cơ bản về cấu hình:</p>
<div class="language-yml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">cluster.name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">elasticsearch</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Cấu hình tên cụm của es, mặc định là elasticsearch, es sẽ tự động phát hiện es trong cùng một shard mạng, nếu có nhiều cụm trong cùng một shard mạng, thuộc tính này có thể được sử dụng để phân biệt các cụm khác nhau.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">node.name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Franz Kafka'</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Tên node, mặc định được chỉ định một cách ngẫu nhiên từ danh sách tên, danh sách này nằm trong tệp name.txt trong thư mục cấu hình trong gói jar es, trong đó có nhiều tên thú vị được thêm bởi các tác giả.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">node.master</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xác định node này có đủ điều kiện để được bầu làm node hay không, mặc định là true, es mặc định là máy đầu tiên trong cụm là master, nếu máy này bị treo thì sẽ bầu lại master.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">node.data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xác định node này có lưu trữ dữ liệu index hay không, mặc định là true.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.number_of_shards</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt số lượng mảnh shard mặc định cho index, mặc định là 5 mảnh.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.number_of_replicas</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt số lượng bản sao mặc định cho index, mặc định là 1 bản sao.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">path.conf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">/path/to/conf</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt đường dẫn lưu trữ tệp cấu hình, mặc định là thư mục config trong thư mục gốc es.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">path.data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">/path/to/data</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt đường dẫn lưu trữ dữ liệu index, mặc định là thư mục data trong thư mục gốc es, có thể đặt nhiều đường dẫn lưu trữ, phân cách bằng dấu phẩy, ví dụ:</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#path.data: /path/to/data1,/path/to/data2</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">path.work</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">/path/to/work</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt đường dẫn lưu trữ tệp tạm thời, mặc định là thư mục work trong thư mục gốc es.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">path.logs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">/path/to/logs</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt đường dẫn lưu trữ tệp nhật ký, mặc định là thư mục logs trong thư mục gốc es</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">path.plugins</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">/path/to/plugins</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt đường dẫn lưu trữ plugin, mặc định là thư mục plugins trong thư mục gốc es</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">bootstrap.mlockall</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt true để khóa bộ nhớ. Bởi vì khi jvm bắt đầu swapping thì hiệu suất của es sẽ giảm, vì vậy để đảm bảo nó không swap, bạn có thể đặt hai biến môi trường ES_MIN_MEM và ES_MAX_MEM thành cùng một giá trị, và đảm bảo máy có đủ bộ nhớ để phân bổ cho es. Đồng thời, bạn cũng phải cho phép tiến trình elasticsearch có thể khóa bộ nhớ, trên linux bạn có thể sử dụng lệnh `ulimit -l unlimited`.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">network.bind_host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">192.168.0.1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt địa chỉ ip được liên kết, có thể là ipv4 hoặc ipv6, mặc định là 0.0.0.0.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">network.publish_host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">192.168.0.1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt địa chỉ ip mà các node khác và node này tương tác, nếu không đặt nó sẽ tự động xác định, giá trị phải là một địa chỉ ip thực sự.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">network.host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">192.168.0.1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Tham số này được sử dụng để đồng thời đặt bind_host và publish_host ở trên.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">transport.tcp.port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">9300</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt cổng tcp để tương tác giữa các node, mặc định là 9300.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">transport.tcp.compress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt liệu có nén dữ liệu khi truyền tải tcp hay không, mặc định là false, không nén.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">http.port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">9200</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt cổng http phục vụ bên ngoài, mặc định là 9200.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">http.max_content_length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">100mb</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt dung lượng tối đa của nội dung, mặc định là 100mb</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">http.enabled</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Có sử dụng giao thức http để cung cấp dịch vụ bên ngoài hay không, mặc định là true, được mở.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">gateway.type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">local</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Loại gateway, mặc định là local tức là hệ thống tệp cục bộ, có thể đặt là hệ thống tệp cục bộ, hệ thống tệp phân tán, HDFS của hadoop, và máy chủ s3 của amazon, cách đặt hệ thống tệp khác sẽ được nói chi tiết vào lần sau.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">gateway.recover_after_nodes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt số lượng node trong cụm khi khởi động để khôi phục dữ liệu, mặc định là 1.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">gateway.recover_after_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">5m</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt thời gian chờ tối đa để khởi tạo quá trình khôi phục dữ liệu, mặc định là 5 phút.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">gateway.expected_nodes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt số lượng node trong cụm này, mặc định là 2, một khi N node này được khởi động, quá trình khôi phục dữ liệu sẽ được bắt đầu ngay lập tức.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">cluster.routing.allocation.node_initial_primaries_recoveries</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Khi khôi phục dữ liệu ban đầu, số lượng luồng khôi phục đồng thời, mặc định là 4.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">cluster.routing.allocation.node_concurrent_recoveries</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Khi thêm hoặc xóa node hoặc cân bằng tải, số lượng luồng khôi phục đồng thời, mặc định là 2.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">indices.recovery.max_size_per_sec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt băng thông giới hạn khi khôi phục dữ liệu, ví dụ 100mb, mặc định là 0, tức không giới hạn.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">indices.recovery.concurrent_streams</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt tham số này để giới hạn số lượng luồng đồng thời mở tối đa khi khôi phục dữ liệu từ các mảnh khác, mặc định là 5.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">discovery.zen.minimum_master_nodes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt tham số này để đảm bảo rằng các node trong cụm có thể biết được số lượng tối thiểu N node khác có đủ điều kiện làm master. Mặc định là 1, đối với cụm lớn, có thể đặt giá trị lớn hơn một chút (2-4)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">discovery.zen.ping.timeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">3s</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt thời gian chờ kết nối ping khi tự động phát hiện các node khác trong cụm, mặc định là 3 giây, đối với môi trường mạng kém, có thể đặt giá trị cao hơn để ngăn chặn lỗi khi phát hiện tự động.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">discovery.zen.ping.multicast.enabled</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt liệu có mở phát hiện node đa phát hay không, mặc định là true.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">discovery.zen.ping.unicast.hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'host1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'host2:port'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'host3[portX-portY]'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đặt danh sách ban đầu của các node master trong cụm, các node mới tham gia cụm có thể được phát hiện tự động thông qua các node này.</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Elasticsearch FAQ</h2>
<h3>Elasticsearch không cho phép chạy với quyền root</h3>
<p><strong>Vấn đề:</strong> Trong môi trường Linux, Elasticsearch không cho phép chạy với quyền root.</p>
<p>Nếu bạn chạy Elasticsearch dưới quyền root, bạn sẽ nhận được lỗi sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>can not run elasticsearch as root</span></span></code></pre>
</div><p><strong>Cách giải quyết:</strong> Chạy Elasticsearch dưới tài khoản không có quyền root</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Tạo nhóm người dùng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">groupadd</span><span style="color:#98C379;--shiki-dark:#98C379"> elk</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Tạo người dùng mới, -g elk đặt nhóm người dùng của nó thành elk, -p elk đặt mật khẩu của nó thành elk</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">useradd</span><span style="color:#98C379;--shiki-dark:#98C379"> elk</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -g</span><span style="color:#98C379;--shiki-dark:#98C379"> elk</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span><span style="color:#98C379;--shiki-dark:#98C379"> elk</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Thay đổi chủ sở hữu của thư mục /opt và các tệp bên trong thành elk:elk</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">chown</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -R</span><span style="color:#98C379;--shiki-dark:#98C379"> elk:elk</span><span style="color:#98C379;--shiki-dark:#98C379"> /opt</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"> # Giả sử bạn đã cài đặt elasticsearch trong thư mục opt</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Chuyển đổi tài khoản</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">su</span><span style="color:#98C379;--shiki-dark:#98C379"> elk</span></span></code></pre>
</div><h3>vm.max_map_count không thấp hơn 262144</h3>
<p><strong>Vấn đề:</strong> <code>vm.max_map_count</code> biểu thị kích thước bộ nhớ ảo, đây là một tham số kernel. Elasticsearch yêu cầu <code>vm.max_map_count</code> không thấp hơn 262144.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</span></span></code></pre>
</div><p><strong>Cách giải quyết:</strong></p>
<p>Bạn có thể thực hiện lệnh sau để đặt <code>vm.max_map_count</code>, nhưng sau khi khởi động lại, nó sẽ trở lại giá trị ban đầu.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>sysctl -w vm.max_map_count=262144</span></span></code></pre>
</div><p>Cách làm lâu dài là sửa đổi tham số <code>vm.max_map_count</code> trong tệp <code>/etc/sysctl.conf</code>:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>echo "vm.max_map_count=262144" &gt; /etc/sysctl.conf</span></span>
<span class="line"><span>sysctl -p</span></span></code></pre>
</div><blockquote>
<p><strong>Lưu ý</strong></p>
<p>Nếu môi trường chạy là docker container, có thể sẽ hạn chế việc thực hiện sysctl để sửa đổi tham số kernel.</p>
<p>Trong trường hợp này, bạn chỉ có thể chọn sửa đổi tham số trên máy chủ chủ.</p>
</blockquote>
<h3>nofile không thấp hơn 65536</h3>
<p><strong>Vấn đề:</strong> <code>nofile</code> biểu thị số lượng tệp tối đa mà một quá trình có thể mở. Quá trình Elasticsearch yêu cầu số lượng tệp tối đa có thể mở không thấp hơn 65536.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]</span></span></code></pre>
</div><p><strong>Cách giải quyết:</strong></p>
<p>Sửa đổi tham số <code>nofile</code> trong tệp <code>/etc/security/limits.conf</code>:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>echo "* soft nofile 65536" &gt; /etc/security/limits.conf</span></span>
<span class="line"><span>echo "* hard nofile 131072" &gt; /etc/security/limits.conf</span></span></code></pre>
</div><h3>nproc không thấp hơn 2048</h3>
<p><strong>Vấn đề:</strong> <code>nproc</code> biểu thị số lượng tối đa của các thread. Elasticsearch yêu cầu số lượng tối đa thread không thấp hơn 2048.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>max number of threads [1024] for user [user] is too low, increase to at least [2048]</span></span></code></pre>
</div><p><strong>Cách giải quyết:</strong></p>
<p>Sửa đổi tham số <code>nproc</code> trong tệp <code>/etc/security/limits.conf</code>:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>echo "* soft nproc 2048" &gt; /etc/security/limits.conf</span></span>
<span class="line"><span>echo "* hard nproc 4096" &gt; /etc/security/limits.conf</span></span></code></pre>
</div><h2>Tài liệu tham khảo</h2>
<ul>
<li><a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener noreferrer">Hướng dẫn tải và cài đặt Elasticsearch chính thức</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html#rpm" target="_blank" rel="noopener noreferrer">Cài đặt Elasticsearch với RPM</a></li>
<li><a href="http://siye1982.github.io/2015/09/17/es-optimize/" target="_blank" rel="noopener noreferrer">Tích lũy sử dụng Elasticsearch</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch performance optimization</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/optimization.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/optimization.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch performance optimization</source>
      <description>Tối ưu hóa hiệu suất Elasticsearch Elasticsearch là công cụ tìm kiếm cấp doanh nghiệp phổ biến hiện nay, được thiết kế để hoạt động trong môi trường đám mây, có khả năng tìm kiế...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Elasticsearch là công cụ tìm kiếm cấp doanh nghiệp phổ biến hiện nay, được thiết kế để hoạt động trong môi trường đám mây, có khả năng tìm kiếm thời gian thực, ổn định, đáng tin cậy, nhanh chóng và dễ dàng cài đặt. Dù là một sản phẩm sẵn sàng sử dụng ngay sau khi mở hộp, sau khi đưa vào môi trường sản xuất, chúng ta không thể đảm bảo được hiệu suất và ổn định của nó. Việc tăng cường hiệu suất dịch vụ dựa trên tình hình thực tế có rất nhiều kỹ thuật. Trong chương này, chúng tôi sẽ chia sẻ những kinh nghiệm tối ưu hóa hiệu suất Elasticsearch từ thực tiễn, chủ yếu từ các khía cạnh như tối ưu hóa cấu hình phần cứng, cài đặt tối ưu hóa chỉ mục, tối ưu hóa truy vấn, tối ưu hóa cấu trúc dữ liệu, tối ưu hóa kiến trúc cụm.</p>
<h2>Tối ưu hóa cấu hình phần cứng</h2>
<p>Nâng cấp cấu hình phần cứng luôn là phương pháp tăng cường khả năng phục vụ nhanh chóng và hiệu quả nhất, ba yếu tố có thể ảnh hưởng đến hiệu suất ứng dụng ở cấp độ hệ thống bao gồm: CPU, bộ nhớ và IO, có thể tối ưu hóa hiệu suất ES từ ba khía cạnh này.</p>
<h3>Cấu hình CPU</h3>
<p>Nói chung, có một số lý do khiến CPU bận rộn:</p>
<ol>
<li>Có vòng lặp vô hạn, không chặn, khớp mẫu thông thường hoặc chỉ tính toán trong luồng;</li>
<li>Xảy ra GC thường xuyên;</li>
<li>Chuyển đổi ngữ cảnh của nhiều luồng;</li>
</ol>
<p>Hầu hết các triển khai Elasticsearch thường không đặt yêu cầu cao đối với CPU. Do đó, so với các tài nguyên khác, việc cấu hình bao nhiêu (CPU) không quan trọng lắm. Bạn nên chọn bộ xử lý hiện đại có nhiều nhân, máy chủ trong cụm thường sử dụng từ 2 đến 8 nhân. <strong>Nếu bạn phải chọn giữa CPUs nhanh hơn và số lượng nhân nhiều hơn, việc chọn số lượng nhân nhiều hơn sẽ tốt hơn</strong>. Số lượng nhân bổ sung cung cấp đồng thời nhiều hơn rất nhiều so với tốc độ xung nhịp nhanh hơn một chút.</p>
<h3>Cấu hình bộ nhớ</h3>
<p>Nếu có một loại tài nguyên nào đó sẽ được tiêu thụ trước tiên, đó có thể là bộ nhớ. Sắp xếp và tổng hợp đều tiêu thụ nhiều bộ nhớ, vì vậy việc có đủ không gian heap để xử lý chúng là rất quan trọng. Ngay cả khi không gian heap khá nhỏ, nó cũng có thể cung cấp thêm bộ nhớ cho bộ đệm tệp hệ điều hành. Bởi vì nhiều cấu trúc dữ liệu mà Lucene sử dụng dựa trên định dạng dựa trên đĩa, Elasticsearch tận dụng bộ đệm hệ điều hành có thể tạo ra hiệu quả lớn.</p>
<p><strong>Máy có bộ nhớ 64 GB là rất lý tưởng</strong>, nhưng máy 32 GB và 16 GB cũng rất phổ biến. Dưới 8 GB sẽ phản tác dụng (bạn cuối cùng sẽ cần rất nhiều máy nhỏ), máy có bộ nhớ lớn hơn 64 GB cũng sẽ gặp vấn đề.</p>
<p>Do ES được xây dựng dựa trên lucene, và sức mạnh của thiết kế lucene nằm ở chỗ lucene có thể tận dụng tốt bộ nhớ hệ điều hành để lưu trữ dữ liệu chỉ mục, để cung cấp hiệu suất truy vấn nhanh. Các tệp phân đoạn chỉ mục của lucene được lưu trữ trong một tệp duy nhất và không thay đổi, đối với hệ điều hành, có thể giữ tệp chỉ mục trong bộ đệm một cách thân thiện, để truy cập nhanh; do đó, chúng ta cần để một nửa bộ nhớ vật lý cho lucene; nửa còn lại của bộ nhớ vật lý để cho ES (JVM heap).</p>
<h4>Phân bổ bộ nhớ</h4>
<p>Khi bộ nhớ máy nhỏ hơn 64G, tuân theo nguyên tắc chung, 50% cho ES, 50% cho lucene.</p>
<p>Khi bộ nhớ máy lớn hơn 64G, tuân theo nguyên tắc sau:</p>
<ul>
<li>Nếu cảnh sử dụng chính là tìm kiếm toàn văn bản, thì nên cấp 4~32G bộ nhớ cho ES Heap; bộ nhớ khác để cho hệ điều hành, cho lucene sử dụng (segments cache), để cung cấp hiệu suất truy vấn nhanh hơn.</li>
<li>Nếu cảnh sử dụng chính là tổng hợp hoặc sắp xếp, và hầu hết là numerics, dates, geo_points và các loại ký tự not_analyzed, nên cấp 4~32G bộ nhớ cho ES Heap; bộ nhớ khác để cho hệ điều hành, cho lucene sử dụng, cung cấp hiệu suất tổng hợp, sắp xếp nhanh hơn dựa trên tài liệu.</li>
<li>Nếu cảnh sử dụng là tổng hợp hoặc sắp xếp, và tất cả đều dựa trên dữ liệu ký tự analyzed, thì cần nhiều heap size hơn, nên chạy nhiều thực thể ES trên máy, mỗi thực thể giữ không vượt quá 50% cài đặt heap ES (nhưng không vượt quá 32 G, khi heap memory được cài đặt dưới 32 G, JVM sử dụng kỹ thuật nén chỉ số đối tượng để tiết kiệm không gian), hơn 50% để cho lucene.</li>
</ul>
<h4>Vô hiệu hóa swap</h4>
<p>Vô hiệu hóa swap, một khi cho phép trao đổi bộ nhớ với đĩa, sẽ gây ra vấn đề về hiệu suất nghiêm trọng. Có thể thông qua <code>bootstrap.memory_lock: true</code> trong elasticsearch.yml, để giữ JVM khóa bộ nhớ, đảm bảo hiệu suất của ES.</p>
<h4>Cài đặt GC</h4>
<p>Giữ cài đặt GC hiện tại, cài đặt mặc định là: Concurrent-Mark and Sweep (CMS), không chuyển sang G1 GC, vì hiện tại G1 vẫn có rất nhiều BUG.</p>
<p>Giữ cài đặt hiện tại của thread pool, hiện tại cài đặt thread pool của ES đã có nhiều cài đặt tối ưu hóa so với 1.X, giữ nguyên là được; kích thước thread pool mặc định bằng số lượng lõi CPU. Nếu cần thay đổi, cài đặt theo công thức ((số lượng lõi CPU * 3) / 2) + 1; không được vượt quá gấp đôi số lượng lõi CPU; nhưng không nên thay đổi cấu hình mặc định, nếu không sẽ gây tổn thương cho CPU.</p>
<h3>Đĩa</h3>
<p>Đĩa quan trọng đối với tất cả các cụm, đặc biệt quan trọng đối với các cụm có lượng ghi lớn (ví dụ như những cụm lưu trữ dữ liệu nhật ký). Đĩa là hệ thống con chậm nhất trên máy chủ, điều này có nghĩa là những cụm có lượng ghi lớn dễ dàng làm cho đĩa bão hòa, khiến nó trở thành nút thắt cổ chai của cụm.</p>
<p><strong>Trong phạm vi chịu đựng được áp lực kinh tế, hãy sử dụng ổ đĩa thể rắn (SSD) càng nhiều càng tốt</strong>. So với bất kỳ phương tiện quay nào (ổ đĩa cứng cơ học, băng từ, v.v.), ổ đĩa thể rắn sẽ tăng cường IO đáng kể, dù là ghi ngẫu nhiên hay ghi tuần tự.</p>
<blockquote>
<p>Nếu bạn đang sử dụng SSD, hãy đảm bảo rằng trình lập lịch I/O của hệ thống bạn được cấu hình đúng. Khi bạn ghi dữ liệu vào đĩa, trình lập lịch I/O quyết định khi nào thực sự gửi dữ liệu đến đĩa. Hầu hết các phiên bản *nix mặc định có trình lập lịch là cfq (Completely Fair Queuing).</p>
<p>Trình lập lịch phân bổ thời gian cho mỗi quy trình. Và tối ưu hóa việc chuyển các hàng đợi lớn đến đĩa. Nhưng nó được tối ưu hóa cho phương tiện quay: đặc tính cố hữu của ổ đĩa cơ học có nghĩa là việc ghi dữ liệu vào đĩa dựa trên bố cục vật lý sẽ hiệu quả hơn.</p>
<p>Điều này không hiệu quả đối với SSD, mặc dù không liên quan đến ổ đĩa cơ học. Tuy nhiên, deadline hoặc noop nên được sử dụng. Trình lập lịch deadline tối ưu hóa dựa trên thời gian chờ ghi, trong khi noop chỉ là một hàng đợi FIFO đơn giản.</p>
<p>Thay đổi đơn giản này có thể tạo ra sự khác biệt đáng kể. Chỉ cần sử dụng trình lập lịch đúng, chúng tôi đã thấy khả năng ghi tăng lên 500 lần.</p>
</blockquote>
<p><strong>Nếu bạn sử dụng phương tiện quay (như ổ đĩa cơ học), hãy cố gắng có được ổ đĩa nhanh nhất có thể (ổ đĩa máy chủ hiệu suất cao, ổ đĩa 15k RPM)</strong>.</p>
<p><strong>Sử dụng RAID0 là cách hiệu quả để tăng tốc độ đĩa, đối với cả ổ đĩa cơ học và SSD</strong>. Không cần phải sử dụng gương hoặc các biến thể RAID khác, bởi vì Elasticsearch đã cung cấp chức năng sao lưu ở cấp độ tự thân thông qua các bản sao, vì vậy không cần sử dụng chức năng sao lưu của đĩa, đồng thời nếu sử dụng chức năng sao lưu của đĩa, sẽ ảnh hưởng lớn đến tốc độ ghi.</p>
<p><strong>Cuối cùng, hãy tránh sử dụng lưu trữ kết nối mạng (NAS)</strong>. Mọi người thường tuyên bố rằng giải pháp NAS của họ nhanh hơn và đáng tin cậy hơn so với ổ đĩa cục bộ. Bỏ qua những tuyên bố này, chúng tôi chưa bao giờ thấy NAS đáng giá cho sự quảng cáo lớn của nó. NAS thường rất chậm, hiển thị độ trễ lớn hơn và phương sai độ trễ trung bình rộng hơn, và nó là điểm lỗi đơn.</p>
<h2>Cài đặt tối ưu hóa chỉ mục</h2>
<p>Tối ưu hóa chỉ mục chủ yếu tập trung vào việc tối ưu hóa ở mức độ chèn của Elasticsearch, tốc độ chỉ mục của Elasticsearch thực sự khá nhanh, dữ liệu cụ thể, chúng ta có thể tham khảo dữ liệu benchmark chính thức. Chúng ta có thể tối ưu hóa chỉ mục dựa trên các yêu cầu khác nhau.</p>
<h3>Gửi hàng loạt</h3>
<p>Khi có rất nhiều dữ liệu cần gửi, nên sử dụng gửi hàng loạt (hoạt động Bulk); ngoài ra, khi sử dụng yêu cầu bulk, mỗi yêu cầu không nên vượt quá vài chục MB, vì nếu quá lớn sẽ dẫn đến việc sử dụng quá nhiều bộ nhớ.</p>
<p>Ví dụ, trong quá trình thực thi ELK, Logstash indexer gửi dữ liệu vào Elasticsearch, kích thước batch có thể hoạt động như một điểm tối ưu hóa. Tuy nhiên, kích thước tối ưu cần phải xác định dựa trên kích thước tài liệu và hiệu suất máy chủ.</p>
<p>Ví dụ, trong Logstash, nếu kích thước tài liệu gửi vượt quá 20MB, Logstash sẽ chia một yêu cầu hàng loạt thành nhiều yêu cầu hàng loạt.</p>
<p>Nếu trong quá trình gửi, bạn gặp phải ngoại lệ EsRejectedExecutionException, thì điều này cho thấy hiệu suất chỉ mục của cụm đã đạt đến giới hạn. Trong trường hợp này, bạn cần tăng nguồn lực của cụm máy chủ hoặc giảm tốc độ thu thập dữ liệu dựa trên quy tắc kinh doanh, ví dụ chỉ thu thập nhật ký cấp Warn, Error trở lên.</p>
<h3>Tăng khoảng thời gian Refresh</h3>
<p>Để tăng hiệu suất chỉ mục, Elasticsearch sử dụng chiến lược ghi trễ khi ghi dữ liệu, tức là dữ liệu được ghi vào bộ nhớ trước, khi vượt quá 1 giây mặc định (index.refresh_interval) sẽ thực hiện một hoạt động ghi, tức là làm mới dữ liệu segment trong bộ nhớ vào đĩa, lúc này chúng ta mới có thể tìm kiếm dữ liệu. Đây là lý do tại sao Elasticsearch cung cấp chức năng tìm kiếm gần thời gian thực, chứ không phải là tìm kiếm thời gian thực.</p>
<p>Nếu hệ thống của chúng ta không đặt yêu cầu cao về độ trễ dữ liệu, chúng ta <strong>có thể tăng khoảng thời gian làm mới để giảm áp lực hợp nhất segment và tăng tốc độ chỉ mục</strong>. Ví dụ, trong quá trình theo dõi toàn bộ chuỗi, chúng tôi đã đặt <code>index.refresh_interval</code> thành 30 giây, giảm số lần làm mới. Một ví dụ khác, khi tiến hành chỉ mục toàn bộ, bạn có thể tạm thời tắt số lần làm mới, tức là đặt <code>index.refresh_interval</code> thành -1, sau khi dữ liệu được nhập thành công, hãy mở lại chế độ bình thường, ví dụ 30 giây.</p>
<blockquote>
<p>Khi tải dữ liệu lớn, bạn có thể tạm thời không sử dụng refresh và repliccas, đặt index.refresh_interval thành -1, đặt index.number_of_replicas thành 0.</p>
</blockquote>
<h3>Chỉnh sửa cài đặt index_buffer_size</h3>
<p>Cài đặt bộ đệm chỉ mục có thể kiểm soát bao nhiêu bộ nhớ được phân bổ cho quá trình chỉ mục. Đây là một cấu hình toàn cầu, sẽ được áp dụng cho tất cả các phân đoạn khác nhau trên một nút.</p>
<div class="language-yml" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">indices.memory.index_buffer_size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">10%</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">indices.memory.min_index_buffer_size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">48mb</span></span></code></pre>
</div><p><code>indices.memory.index_buffer_size</code> chấp nhận một phần trăm hoặc một giá trị biểu thị kích thước byte. Mặc định là 10%, có nghĩa là 10% tổng bộ nhớ được phân bổ cho nút được sử dụng để làm kích thước bộ đệm chỉ mục. Giá trị này được chia cho các phân đoạn (shards) khác nhau. Nếu bạn đặt phần trăm, bạn cũng có thể đặt <code>min_index_buffer_size</code> (mặc định là 48mb) và <code>max_index_buffer_size</code> (mặc định không có giới hạn trên).</p>
<h3>Chỉnh sửa cài đặt liên quan đến translog</h3>
<p>Một là kiểm soát tần suất hoạt động từ bộ nhớ đến ổ cứng, để giảm IO ổ cứng. Bạn có thể đặt thời gian sync_interval lớn hơn. Mặc định là 5 giây.</p>
<div class="language-yml" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.translog.sync_interval</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">5s</span></span></code></pre>
</div><p>Bạn cũng có thể kiểm soát kích thước khối dữ liệu tranlog, khi đạt đến kích thước threshold, dữ liệu mới sẽ được flush vào tệp chỉ mục lucene. Mặc định là 512mb.</p>
<div class="language-yml" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.translog.flush_threshold_size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">512mb</span></span></code></pre>
</div><h3>Chú ý sử dụng trường _id</h3>
<p>Trong việc sử dụng trường _id, bạn nên tránh tùy chỉnh _id để tránh quản lý phiên bản dựa trên ID; nên sử dụng chiến lược tạo ID mặc định của ES hoặc sử dụng ID kiểu số làm khóa chính.</p>
<h3>Chú ý sử dụng trường _all và trường _source</h3>
<p>Bạn nên chú ý đến việc sử dụng trường _all và trường _source, tùy thuộc vào tình huống và nhu cầu, trường _all bao gồm tất cả các trường chỉ mục, thuận tiện cho việc tìm kiếm toàn văn, nếu không có nhu cầu này, có thể tắt; _source lưu trữ nội dung tài liệu gốc, nếu không có nhu cầu lấy dữ liệu tài liệu gốc, có thể định nghĩa các trường được đưa vào _source bằng cách đặt thuộc tính includes, excludes.</p>
<h3>Sử dụng thuộc tính index một cách hợp lý</h3>
<p>Hãy sử dụng thuộc tính index một cách hợp lý, analyzed và not_analyzed, kiểm soát trường có phải là từ vựng hay không dựa trên yêu cầu kinh doanh. Chỉ cần các trường yêu cầu groupby, khi cấu hình, đặt thành not_analyzed để tăng hiệu suất truy vấn hoặc phân loại.</p>
<h3>Giảm số lượng bản sao</h3>
<p>Elasticsearch mặc định số lượng bản sao là 3, mặc dù điều này sẽ cải thiện khả năng sẵn có của cụm, tăng số lượng truy vấn đồng thời, nhưng cũng sẽ ảnh hưởng đến hiệu suất ghi chỉ mục.</p>
<p>Trong quá trình chỉ mục, cần gửi tài liệu được cập nhật đến các nút bản sao, chờ nút bản sao hoạt động sau đó trả về kết thúc. Khi sử dụng Elasticsearch để tìm kiếm kinh doanh, nên đặt số lượng bản sao là 3, nhưng trong hệ thống nhật ký ELK nội bộ, hệ thống theo dõi phân tán, hoàn toàn có thể đặt số lượng bản sao là 1.</p>
<h2>Tối ưu hóa về truy vấn</h2>
<p>Khi Elasticsearch được sử dụng như một truy vấn gần thời gian thực cho tìm kiếm kinh doanh, việc tối ưu hóa hiệu suất truy vấn trở nên rất quan trọng.</p>
<h3>Tối ưu hóa định tuyến</h3>
<p>Khi chúng tôi truy vấn một tài liệu, Elasticsearch làm thế nào để biết một tài liệu nên được lưu trữ trong phân đoạn nào? Thực tế, nó được tính toán thông qua công thức sau đây.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>shard = hash(routing) % number_of_primary_shards</span></span></code></pre>
</div><p>Giá trị mặc định của routing là id của tài liệu, nhưng cũng có thể sử dụng giá trị tùy chỉnh, chẳng hạn như ID người dùng.</p>
<h4>Truy vấn không có routing</h4>
<p>Khi truy vấn, vì không biết dữ liệu cần truy vấn cụ thể nằm trên phân đoạn nào, nên toàn bộ quá trình được chia thành 2 bước:</p>
<ol>
<li>Phân phối: Khi yêu cầu đến nút điều phối, nút điều phối sẽ phân phối yêu cầu truy vấn đến mỗi phân đoạn.</li>
<li>Tổng hợp: Nút điều phối thu thập kết quả truy vấn từ mỗi phân đoạn, sau đó sắp xếp kết quả truy vấn, sau đó trả về kết quả cho người dùng.</li>
</ol>
<h4>Truy vấn có routing</h4>
<p>Khi truy vấn, có thể trực tiếp xác định một phân đoạn truy vấn dựa trên thông tin routing, không cần truy vấn tất cả các phân đoạn, sau đó sắp xếp thông qua nút điều phối.</p>
<p>Như truy vấn người dùng tùy chỉnh ở trên, nếu routing được đặt là userid, thì có thể trực tiếp truy vấn ra dữ liệu, hiệu quả tăng rất nhiều.</p>
<h3>Filter VS Query</h3>
<p>Nếu có thể, hãy sử dụng ngữ cảnh bộ lọc (Filter) thay vì ngữ cảnh truy vấn (Query)</p>
<ul>
<li>Query: Tài liệu này khớp với câu truy vấn con này ở mức độ nào?</li>
<li>Filter: Tài liệu này có khớp với câu truy vấn con không?</li>
</ul>
<p>Elasticsearch chỉ cần trả lời "có" hoặc "không" cho các truy vấn Filter, không cần tính điểm liên quan như truy vấn Query, đồng thời kết quả Filter có thể được lưu vào bộ nhớ cache.</p>
<h3>Phân trang sâu</h3>
<p>Trong quá trình sử dụng Elasticsearch, nên tránh việc phân trang lớn xảy ra.</p>
<p>Truy vấn phân trang thông thường đều bắt đầu từ from và lấy size bản ghi, điều này yêu cầu truy vấn và xếp hạng from+size bản ghi đầu tiên trong mỗi phân đoạn. Nút điều phối thu thập from+size bản ghi đầu tiên từ mỗi phân đoạn. Nút điều phối sẽ nhận được N*(from+size) bản ghi, sau đó sắp xếp chúng, sau đó trả về from đến from+size bản ghi. Nếu from hoặc size rất lớn, số lượng bản ghi tham gia sắp xếp sẽ tăng lên nhiều, cuối cùng sẽ làm tăng tiêu hao tài nguyên CPU.</p>
<p>Có thể giải quyết vấn đề này bằng cách sử dụng scroll và scroll-scan hiệu quả của Elasticsearch.</p>
<p>Cũng có thể kết hợp với đặc điểm kinh doanh thực tế, nếu kích thước id tài liệu và thời gian tạo tài liệu là đồng nhất và có thứ tự, có thể sử dụng id tài liệu làm offset phân trang, và đặt nó làm một điều kiện truy vấn phân trang.</p>
<h3>Sử dụng script một cách hợp lý</h3>
<p>Chúng ta biết rằng việc sử dụng script chủ yếu có 3 hình thức, cách biên dịch động nội tuyến, lưu trữ trong thư viện chỉ mục _script và lưu trữ dưới dạng script tệp; cảnh báo thông thường là sắp xếp thô, nên sử dụng cách thứ hai để lưu trữ script trong thư viện chỉ mục _script trước, để biên dịch trước, sau đó sử dụng thông qua id script và kết hợp với params, có thể đạt được mô hình (logic) và dữ liệu đã được phân tách, đồng thời dễ dàng mở rộng và bảo dưỡng mô-đun script. Vui lòng tham khảo chi tiết về nội dung script ES tại <a href="https://www.knowledgedict.com/tutorial/elasticsearch-script.html" target="_blank" rel="noopener noreferrer">Giải thích chi tiết về mô-đun script Elasticsearch</a>.</p>
<h2>Tối ưu hóa cấu trúc dữ liệu</h2>
<p>Dựa trên các tình huống sử dụng của Elasticsearch, cấu trúc dữ liệu tài liệu nên được kết hợp với tình huống sử dụng, loại bỏ dữ liệu không cần thiết và không hợp lý.</p>
<h3>Giảm thiểu các trường không cần thiết</h3>
<p>Nếu Elasticsearch được sử dụng cho dịch vụ tìm kiếm kinh doanh, một số trường không cần thiết để tìm kiếm nên không được lưu trong ES. Điều này không chỉ tiết kiệm không gian, mà còn cải thiện hiệu suất tìm kiếm với cùng một lượng dữ liệu.</p>
<p>Tránh sử dụng giá trị động làm trường, việc tăng mapping động có thể dẫn đến sự cố ở cụm; tương tự, cần kiểm soát số lượng trường, không lập chỉ mục cho các trường không được sử dụng trong kinh doanh. Kiểm soát số lượng trường chỉ mục, độ sâu của mapping, loại trường chỉ mục, là quan trọng nhất trong việc tối ưu hóa hiệu suất ES.</p>
<p>Dưới đây là một số cài đặt mặc định của ES về số lượng trường, độ sâu mapping:</p>
<div class="language-yml" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.mapping.nested_objects.limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10000</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.mapping.total_fields.limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1000</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.mapping.depth.limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">20</span></span></code></pre>
</div><h3>Nested Object vs Parent/Child</h3>
<p>Hạn chế sử dụng các trường nested hoặc parent/child, không sử dụng nếu không cần thiết; nested query chậm, parent/child query còn chậm hơn, chậm hơn nested query hàng trăm lần; vì vậy, nếu có thể giải quyết ở giai đoạn thiết kế mapping (thiết kế bảng rộng lớn hoặc sử dụng cấu trúc dữ liệu thông minh), thì không nên sử dụng mapping quan hệ cha-con.</p>
<p>Nếu bạn cần sử dụng nested fields, hãy đảm bảo không có quá nhiều trường nested, hiện tại giới hạn mặc định của ES là 50. Bởi vì đối với 1 tài liệu, mỗi trường nested sẽ tạo ra một tài liệu độc lập, điều này sẽ làm tăng số lượng tài liệu một cách đáng kể, ảnh hưởng đến hiệu suất truy vấn, đặc biệt là hiệu suất JOIN.</p>
<div class="language-yml" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">index.mapping.nested_fields.limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">50</span></span></code></pre>
</div><p>| So sánh | Nested Object                        | Parent/Child                                       |<br>
| :</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Overview</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/overview.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/overview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Overview</source>
      <description>Elasticsearch MOC Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu dựa trên Lucene, cung cấp một dịch vụ phân tán. Elasticsearch là một sản phẩm mã nguồn mở tuân theo ...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu dựa trên Lucene, cung cấp một dịch vụ phân tán. Elasticsearch là một sản phẩm mã nguồn mở tuân theo các điều khoản mã nguồn mở của Apache và hiện đang là công cụ tìm kiếm doanh nghiệp phổ biến.</p>
</blockquote>
<h2>📖 Contents</h2>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Query</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/query.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/query.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Query</source>
      <description>Elasticsearch Query Câu truy vấn Elasticsearch sử dụng interface dựa trên phong cách RESTful được đóng gói thành đối tượng JSON, được gọi là Query DSL. Elasticsearch chia các tr...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Câu truy vấn Elasticsearch sử dụng interface dựa trên phong cách RESTful được đóng gói thành đối tượng JSON, được gọi là Query DSL. Elasticsearch chia các truy vấn thành các loại chính sau: <strong>truy vấn toàn văn</strong>, <strong>truy vấn từ khoá</strong>, <strong>truy vấn kết hợp</strong>, <strong>truy vấn lồng nhau</strong>, <strong>truy vấn vị trí</strong>, <strong>truy vấn đặc biệt</strong>. Một cách phân loại khác của Elasticsearch truy vấn dựa vào cơ chế, một là dựa vào từ khoá truy vấn được người dùng nhập vào, thông qua mô hình xếp hạng để tính toán <strong>mức độ liên quan</strong> giữa tài liệu và từ khoá truy vấn, và trả về dựa trên thứ tự điểm số; cách khác là <strong>cơ chế lọc</strong>, chỉ lọc tài liệu dựa trên điều kiện lọc, không tính toán điểm số, tốc độ tương đối nhanh hơn.</p>
<h2>Truy vấn toàn văn</h2>
<p>Truy vấn toàn văn ES chủ yếu được sử dụng trên các trường toàn văn, chủ yếu xem xét mức độ liên quan (Relevance) giữa từ khoá truy vấn và tài liệu.</p>
<h3>intervals query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-intervals-query.html" target="_blank" rel="noopener noreferrer"><strong><code>intervals query</code></strong></a> trả về tài liệu dựa trên thứ tự và độ tương quan của từ khoá khớp.</p>
<p>intervals query sử dụng <strong>quy tắc khớp</strong>, các quy tắc này được áp dụng cho các term trong trường đã chỉ định.</p>
<p>Ví dụ: Ví dụ dưới đây tìm kiếm trường <code>query</code>, giá trị tìm kiếm là <code>my favorite food</code>, không có bất kỳ khoảng trắng nào; sau đó là trường <code>my_text</code> tìm kiếm term khớp <code>hot water</code>, <code>cold porridge</code>.</p>
<p>Khi giá trị của my_text là <code>my favorite food is cold porridge</code>, nó sẽ khớp thành công, nhưng <code>when it's cold my favorite food is porridge</code> thì không khớp.</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> _search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "intervals"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "my_text"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "all_of"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "ordered"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "intervals"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "match"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "my favorite food",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "max_gaps"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "ordered"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">              }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">              "any_of"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "intervals"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"match"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "hot water"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"match"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "cold porridge"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">              }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">          ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>match query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html" target="_blank" rel="noopener noreferrer"><strong><code>match query</code></strong></a> <strong>được sử dụng để tìm kiếm một trường đơn</strong>, đầu tiên sẽ phân tích câu truy vấn (qua analyzer), chủ yếu là để tách câu truy vấn thành các từ, sau khi tách từ, bất kỳ từ nào trong câu truy vấn khớp, tài liệu sẽ được tìm thấy, theo mặc định, nó tương đương với việc thực hiện hoạt động khớp or sau khi tách từ.</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query.html" target="_blank" rel="noopener noreferrer"><strong><code>match query</code></strong></a> là truy vấn tiêu chuẩn để thực hiện tìm kiếm toàn văn, bao gồm các tùy chọn khớp mờ.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "customer_full_name"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "George Hubbard"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Tương đương với hoạt động khớp <code>or</code>, như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "customer_full_name"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "George Hubbard",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "or"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>match query viết tắt</h4>
<p>Bạn có thể đơn giản hóa cú pháp truy vấn khớp bằng cách kết hợp tham số <code>&lt;field&gt;</code> và <code>query</code>.</p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "message"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "this is a test"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>match query hoạt động như thế nào</h4>
<p>Truy vấn khớp là kiểu boolean. Điều này có nghĩa là nó sẽ phân tích văn bản được cung cấp, quá trình phân tích sẽ xây dựng một truy vấn boolean từ văn bản được cung cấp. Tham số <code>operator</code> có thể được đặt thành <code>or</code> hoặc <code>and</code> để kiểm soát các mệnh đề con boolean (mặc định là <code>or</code>). Bạn có thể sử dụng tham số <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-minimum-should-match.html" target="_blank" rel="noopener noreferrer"><code>minimum_should_match</code></a> để đặt số lượng tối thiểu các mệnh đề <code>should</code> tùy chọn cần phải khớp.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "customer_full_name"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "George Hubbard",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "and"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Bạn có thể đặt <code>analyzer</code> để kiểm soát analyzer nào sẽ thực hiện quá trình phân tích văn bản. Nó mặc định là analyzer đã được định rõ trong định nghĩa mapping trường hoặc analyzer tìm kiếm mặc định.</p>
<p>Tham số <code>lenient</code> có thể được đặt thành <code>true</code> để bỏ qua các ngoại lệ do không khớp kiểu dữ liệu, chẳng hạn như cố gắng truy vấn chuỗi số trên trường số. Mặc định là <code>false</code>.</p>
<h4>match query khớp mờ</h4>
<p><code>fuzziness</code> cho phép khớp mờ dựa trên loại trường đang được truy vấn. Xem cấu hình <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/common-options.html#fuzziness" target="_blank" rel="noopener noreferrer">Fuzziness</a>.</p>
<p>Trong trường hợp này, bạn có thể đặt <code>prefix_length</code> và <code>max_expansions</code> để kiểm soát khớp mờ. Nếu đã đặt các tùy chọn mờ, truy vấn sẽ sử dụng <code>top_terms_blended_freqs_${max_expansions}</code> làm phương pháp viết lại của nó, tham số <code>fuzzy_rewrite</code> cho phép kiểm soát cách truy vấn sẽ được viết lại.</p>
<p>Theo mặc định, cho phép đảo ngược mờ (<code>ab</code> → <code>ba</code>), nhưng có thể bị vô hiệu hóa bằng cách đặt <code>fuzzy_transpositions</code> thành <code>false</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "message"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "this is a testt",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "fuzziness"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "AUTO"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>zero terms query</h4>
<p>Nếu analyzer được sử dụng loại bỏ tất cả các token trong truy vấn, thì hành vi mặc định là không khớp với bất kỳ tài liệu nào. Bạn có thể sử dụng tùy chọn <code>zero_terms_query</code> để thay đổi hành vi mặc định, nó chấp nhận <code>none</code> (mặc định) và <code>all</code> (tương đương với truy vấn <code>match_all</code>).</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "message"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "to be or not to be",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "and",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "zero_terms_query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "all"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>match_bool_prefix query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-bool-prefix-query.html" target="_blank" rel="noopener noreferrer"><strong><code>match_bool_prefix query</code></strong></a> phân tích đầu vào của nó và xây dựng một truy vấn boolean dựa trên các từ này. Mỗi từ, ngoại trừ từ cuối cùng, được sử dụng trong một truy vấn từ. Từ cuối cùng được sử dụng trong một <code>prefix query</code>.</p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_bool_prefix"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "message"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "quick brown f"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Tương đương với</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "bool"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "should"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "message":</span><span style="color:#98C379;--shiki-dark:#98C379"> "quick"</span><span style="color:#98C379;--shiki-dark:#98C379"> }},</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "message":</span><span style="color:#98C379;--shiki-dark:#98C379"> "brown"</span><span style="color:#98C379;--shiki-dark:#98C379"> }},</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"prefix"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "message":</span><span style="color:#98C379;--shiki-dark:#98C379"> "f"}}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Một sự khác biệt quan trọng giữa <code>match_bool_prefix query</code> và <code>match_phrase_prefix query</code> là: <code>match_phrase_prefix query</code> sẽ khớp các term của nó như một cụm từ, nhưng <code>match_bool_prefix query</code> có thể khớp các term của nó ở bất kỳ vị trí nào.</p>
<p>Ví dụ truy vấn <code>match_bool_prefix query</code> ở trên có thể khớp với các trường chứa <code>quick brown fox</code>, nhưng nó cũng có thể khớp nhanh với <code>brown fox</code>. Nó cũng có thể khớp với các trường chứa <code>quick</code>, <code>brown</code> và bắt đầu bằng <code>f</code>, xuất hiện ở bất kỳ vị trí nào.</p>
<h3>match_phrase query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html" target="_blank" rel="noopener noreferrer"><strong><code>match_phrase query</code></strong></a> tức là khớp cụm từ, đầu tiên nó sẽ tách nội dung query thành các từ, bộ tách từ có thể được tùy chỉnh, đồng thời tài liệu cũng phải đáp ứng hai điều kiện sau đây mới được tìm kiếm:</p>
<ol>
<li><strong>Tất cả các từ sau khi tách phải xuất hiện trong trường này (tương đương với hoạt động and)</strong>.</li>
<li><strong>Thứ tự của các từ trong trường phải phù hợp</strong>.</li>
</ol>
<p>Ví dụ, có 3 tài liệu sau, sử dụng <strong><code>match_phrase</code></strong> để truy vấn "How are you", chỉ có hai tài liệu đầu tiên được khớp:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> demo/_create/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "How are you"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> demo/_create/2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "How are you, Jack?"}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> demo/_create/3</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "are you"}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> demo/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_phrase"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "How are you"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>Ghi chú:</p>
<p>Một tài liệu được xác định là khớp với cụm từ "How are you" phải đáp ứng các yêu cầu sau đây:</p>
<ul>
<li>How, are và you cần phải xuất hiện trong trường.</li>
<li>Vị trí của are phải lớn hơn vị trí của How là 1.</li>
<li>Vị trí của you phải lớn hơn vị trí của How là 2.</li>
</ul>
</blockquote>
<h3>match_phrase_prefix query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html" target="_blank" rel="noopener noreferrer"><strong><code>match_phrase_prefix query</code></strong></a> tương tự như <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase.html" target="_blank" rel="noopener noreferrer"><strong><code>match_phrase query</code></strong></a>, chỉ khác là <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-match-query-phrase-prefix.html" target="_blank" rel="noopener noreferrer"><strong><code>match_phrase_prefix query</code></strong></a> sẽ xem term cuối cùng như một prefix match.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> demo/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_phrase_prefix"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "are yo"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Trong ví dụ này, Elasticsearch sẽ tìm kiếm các tài liệu có trường "desc" chứa cụm từ bắt đầu bằng "are yo". Cụm từ này có thể hoàn thành với bất kỳ từ nào bắt đầu bằng "yo", chẳng hạn như "you" hoặc "yoga". Điều này có thể hữu ích khi bạn muốn tìm kiếm một cụm từ nhưng chỉ biết một phần của nó.</p>
<h3>multi_match query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-multi-match-query.html" target="_blank" rel="noopener noreferrer"><strong><code>multi_match query</code></strong></a> là một phiên bản nâng cấp của <strong><code>match query</code></strong>, <strong>được sử dụng để tìm kiếm trên nhiều trường</strong>.</p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "multi_match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 34.98,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "taxful_total_price"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "taxless_total_price"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Trường tìm kiếm của <strong><code>multi_match query</code></strong> có thể được chỉ định bằng cách sử dụng ký tự đại diện, ví dụ như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "multi_match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 34.98,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "taxful_*"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "taxless_total_price"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Đồng thời, bạn cũng có thể <strong>chỉ định trọng số của trường tìm kiếm bằng cách sử dụng ký hiệu mũ</strong>.</p>
<p>Ví dụ: chỉ định trọng số của trường taxful_total_price là gấp ba lần trường taxless_total_price, lệnh như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "multi_match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 34.98,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "taxful_total_price^3"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "taxless_total_price"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Điều này có nghĩa là kết quả tìm kiếm từ trường "taxful_total_price" sẽ có trọng số cao hơn ba lần so với kết quả từ trường "taxless_total_price".</p>
<h3>combined_fields query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-combined-fields-query.html" target="_blank" rel="noopener noreferrer"><strong><code>combined_fields query</code></strong></a> hỗ trợ tìm kiếm nhiều trường văn bản, giống như nội dung của chúng đã được lập chỉ mục vào một trường kết hợp. Truy vấn này tạo ra một góc nhìn dựa trên term của chuỗi đầu vào: đầu tiên nó phân tích chuỗi truy vấn thành các term độc lập, sau đó tìm kiếm mỗi term trong tất cả các trường. Khi kết quả phù hợp có thể trải qua nhiều trường văn bản, truy vấn này đặc biệt hữu ích, ví dụ như tiêu đề, tóm tắt và nội dung của một bài viết:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "combined_fields"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">      "database systems",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">     [ </span><span style="color:#98C379;--shiki-dark:#98C379">"title",</span><span style="color:#98C379;--shiki-dark:#98C379"> "abstract",</span><span style="color:#98C379;--shiki-dark:#98C379"> "body"],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">   "and"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Trọng số tiền tố trường</h4>
<p>Trọng số tiền tố trường được tính toán dựa trên mô hình trường kết hợp. Ví dụ, nếu trọng số của trường tiêu đề là 2, thì khi tính điểm độ phù hợp, mỗi term tạo ra từ trường tiêu đề sẽ được tính điểm như thể nó xuất hiện hai lần.</p>
<h3>common_terms query</h3>
<blockquote>
<p>Đã bị loại bỏ từ phiên bản 7.3.0</p>
</blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-common-terms-query.html" target="_blank" rel="noopener noreferrer"><strong><code>common_terms query</code></strong></a> là một giải pháp để cải thiện độ chính xác và độ bao phủ của tìm kiếm mà không làm giảm hiệu suất, thay thế cho việc sử dụng từ dừng (stop words).</p>
<p>Mỗi từ trong truy vấn đều có một chi phí nhất định. Ví dụ, khi tìm kiếm "The brown fox", truy vấn sẽ được phân tích thành ba từ: "the", "brown", và "fox", mỗi từ sẽ thực hiện một truy vấn trong chỉ mục. Rõ ràng, số lượng tài liệu chứa "the" rất nhiều, so với các từ khác, tầm quan trọng của "the" thấp hơn nhiều. Cách giải quyết truyền thống là coi "the" là một từ dừng, loại bỏ từ dừng có thể giảm kích thước chỉ mục và giảm việc thu hẹp từ dừng khi tìm kiếm.</p>
<p>Tuy nhiên, mặc dù từ dừng không ảnh hưởng nhiều đến việc đánh giá tài liệu, nhưng khi từ dừng vẫn có ý nghĩa quan trọng, việc loại bỏ từ dừng không phải là giải pháp hoàn hảo. Nếu loại bỏ từ dừng, bạn không thể phân biệt "happy" và "not happy", "The" trong "To be or not to be" sẽ không tồn tại trong chỉ mục, làm giảm độ chính xác và độ bao phủ của tìm kiếm.</p>
<p><code>common_terms query</code> cung cấp một giải pháp, nó chia những từ sau khi phân tách truy vấn thành từ quan trọng (từ có tần suất thấp) và từ không quan trọng (từ có tần suất cao, cũng chính là từ dừng trước đây). Khi tìm kiếm, đầu tiên tìm kiếm tài liệu phù hợp với từ quan trọng, những tài liệu này là những tài liệu mà từ xuất hiện ít và ảnh hưởng lớn đến việc đánh giá. Sau đó, thực hiện truy vấn thứ hai, tìm kiếm từ có tần suất cao ảnh hưởng ít đến việc đánh giá, nhưng không tính điểm cho tất cả tài liệu, chỉ tính điểm cho tài liệu đã phù hợp trong truy vấn đầu tiên. Nếu một truy vấn chỉ chứa từ có tần suất cao, thì sẽ thực hiện một truy vấn độc lập thông qua toán tử "and", nói cách khác, sẽ tìm kiếm tất cả các từ.</p>
<p>Từ là từ có tần suất cao hay tần suất thấp được thiết lập thông qua giá trị ngưỡng cutoff frequency, có thể là tần suất tuyệt đối (tần suất lớn hơn 1) hoặc tần suất tương đối (0 ~ 1). Điểm thú vị nhất của <code>common_terms query</code> là nó có thể tự điều chỉnh từ dừng cho lĩnh vực cụ thể, ví dụ, trên trang web lưu trữ video, các từ có tần suất cao như "clip" hoặc "video" sẽ tự động được coi là từ dừng, không cần duy trì danh sách thủ công.</p>
<p>Ví dụ, từ có tần suất xuất hiện trong tài liệu lớn hơn 0.1% sẽ được coi là từ có tần suất cao, từ có tần suất có thể được kết nối bằng các tham số low_freq_operator và high_freq_operator. Thiết lập toán tử từ có tần suất thấp là "and" để tất cả các từ có tần suất thấp đều phải tìm kiếm, ví dụ mã như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> books/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"common"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"body"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "nelly the elephant as a cartoon",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"cutoff_frequency"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 0.001,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"low_freq_operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "and"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Hoạt động trên tương đương với:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> books/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"bool"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"must"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "body":</span><span style="color:#98C379;--shiki-dark:#98C379"> "nelly"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "body":</span><span style="color:#98C379;--shiki-dark:#98C379"> "elephant"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "body":</span><span style="color:#98C379;--shiki-dark:#98C379"> "cartoon"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"should"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "body":</span><span style="color:#98C379;--shiki-dark:#98C379"> "the"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "body":</span><span style="color:#98C379;--shiki-dark:#98C379"> "as"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			  { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "body":</span><span style="color:#98C379;--shiki-dark:#98C379"> "a"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>query_string query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html" target="_blank" rel="noopener noreferrer"><strong><code>query_string query</code></strong></a> là một loại truy vấn gắn kết chặt chẽ với cú pháp truy vấn của Lucene, cho phép sử dụng nhiều từ khóa điều kiện đặc biệt (như: AND | OR | NOT) trong một câu truy vấn để tìm kiếm trên nhiều trường, khuyến nghị cho người dùng đã quen với cú pháp truy vấn của Lucene.</p>
<p>Người dùng có thể sử dụng <code>query_string query</code> để tạo các truy vấn phức tạp bao gồm ký tự đại diện, tìm kiếm trên nhiều trường, v.v. Mặc dù là phổ biến, nhưng truy vấn là nghiêm ngặt, nếu chuỗi truy vấn chứa bất kỳ cú pháp không hợp lệ nào, sẽ trả về lỗi.</p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "query_string"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "(new york city) OR (big apple)",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "default_field"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "content"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>simple_query_string query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html" target="_blank" rel="noopener noreferrer"><strong><code>simple_query_string query</code></strong></a> là một loại truy vấn phù hợp để trực tiếp tiếp xúc với người dùng và có cú pháp truy vấn rất hoàn chỉnh, chấp nhận cú pháp truy vấn của Lucene, không ném ra ngoại lệ nếu có lỗi trong quá trình phân tích cú pháp.</p>
<p>Mặc dù cú pháp nghiêm ngặt hơn <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-query-string-query.html" target="_blank" rel="noopener noreferrer"><strong><code>query_string query</code></strong></a>, nhưng <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-simple-query-string-query.html" target="_blank" rel="noopener noreferrer"><strong><code>simple_query_string query</code></strong></a> không trả về lỗi cú pháp không hợp lệ. Ngược lại, nó sẽ bỏ qua bất kỳ phần không hợp lệ nào của chuỗi truy vấn.</p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "simple_query_string"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\"</span><span style="color:#98C379;--shiki-dark:#98C379">fried eggs</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\"</span><span style="color:#98C379;--shiki-dark:#98C379"> +(eggplant | potato) -frittata",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"title^5"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"body"],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "default_operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "and"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Ý nghĩa của simple_query_string</h4>
<ul>
<li><code>+</code>: tương đương với toán tử AND</li>
<li><code>|</code>: tương đương với toán tử OR</li>
<li><code>-</code>: tương đương với toán tử NOT</li>
<li><code>"</code>: bao quanh một số token để chỉ ra cụm từ dùng để tìm kiếm</li>
<li><code>*</code>: sau một từ để chỉ ra truy vấn tiền tố</li>
<li><code>(</code> và <code>)</code>: chỉ ra mức độ ưu tiên</li>
<li><code>~N</code>: sau một từ để chỉ ra khoảng cách chỉnh sửa (mờ)</li>
<li><code>~N</code>: sau một cụm từ để chỉ ra lượng tràn</li>
</ul>
<p>Lưu ý: Để sử dụng các ký tự trên, hãy sử dụng dấu gạch chéo ngược <code>/</code> để thoát.</p>
<h3>Ví dụ hoàn chỉnh về truy vấn toàn văn</h3>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Đặt position_increment_gap</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> groups</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> groups</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "properties"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "names"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "text",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "position_increment_gap"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> groups/_mapping</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> groups/_doc</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "names"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [ </span><span style="color:#98C379;--shiki-dark:#98C379">"John Water",</span><span style="color:#98C379;--shiki-dark:#98C379"> "Water Smith"]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> groups/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_phrase"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "names"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Water Water",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "slop"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 100</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> groups/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_phrase"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "names"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Water Smith"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> groups</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ví dụ này, chúng tôi thiết lập <code>position_increment_gap</code> cho trường "names" trong chỉ mục "groups". <code>position_increment_gap</code> được sử dụng để kiểm soát cách Elasticsearch xử lý các mảng của chuỗi văn bản khi thực hiện truy vấn cụm từ. Trong trường hợp này, nó được cài đặt là 0, có nghĩa là không có khoảng cách giữa các phần tử trong mảng.</p>
<p>Sau đó, chúng tôi thêm một tài liệu vào chỉ mục, với trường "names" bao gồm hai chuỗi: "John Water" và "Water Smith".</p>
<p>Tiếp theo, chúng tôi thực hiện hai truy vấn <code>match_phrase</code> khác nhau. Truy vấn đầu tiên tìm kiếm cụm từ "Water Water" với một "slop" (cho phép sự không khớp) là 100. Truy vấn thứ hai tìm kiếm cụm từ "Water Smith".</p>
<p>Cuối cùng, chúng tôi xóa chỉ mục "groups".</p>
<h2>Truy vấn từ khóa</h2>
<p><strong><code>Term</code> (từ khóa) là đơn vị nhỏ nhất để diễn đạt ý nghĩa</strong>. Cả việc tìm kiếm và xử lý ngôn ngữ tự nhiên bằng mô hình ngôn ngữ thống kê đều cần xử lý Term.</p>
<p>Truy vấn toàn văn sẽ phân tích chuỗi truy vấn trước khi thực hiện truy vấn.</p>
<p>Khác với truy vấn toàn văn, truy vấn từ khóa không phân tách từ, mà coi đầu vào là một thể thống nhất, tìm kiếm các từ khóa chính xác trong chỉ mục đảo ngược và sử dụng công thức tính toán độ liên quan cho mỗi tài liệu chứa từ khóa đó. Nói cách khác: <strong>truy vấn từ khóa là việc khớp chính xác từ khóa</strong>. Truy vấn từ khóa thường được sử dụng cho dữ liệu có cấu trúc, như số, ngày và kiểu liệt kê.</p>
<p>Các loại truy vấn từ khóa bao gồm:</p>
<ul>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="noopener noreferrer"><code>exists</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html" target="_blank" rel="noopener noreferrer"><code>fuzzy</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html" target="_blank" rel="noopener noreferrer"><code>ids</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-prefix-query.html" target="_blank" rel="noopener noreferrer"><code>prefix</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html" target="_blank" rel="noopener noreferrer"><code>range</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html" target="_blank" rel="noopener noreferrer"><code>regexp</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" target="_blank" rel="noopener noreferrer"><code>term</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-query.html" target="_blank" rel="noopener noreferrer"><code>terms</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-type-query.html" target="_blank" rel="noopener noreferrer"><code>type</code> query</a></strong></li>
<li><strong><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html" target="_blank" rel="noopener noreferrer"><code>wildcard</code> query</a></strong></li>
</ul>
<h3>exists query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-exists-query.html" target="_blank" rel="noopener noreferrer"><strong><code>exists query</code></strong></a> sẽ trả về các tài liệu có ít nhất một giá trị không trống trong trường.</p>
<p>Vì nhiều lý do, trường của tài liệu có thể không tồn tại giá trị chỉ mục:</p>
<ul>
<li>Trường trong JSON là <code>null</code> hoặc <code>[]</code></li>
<li>Trường này được cấu hình <code>"index" : false</code> trong mapping</li>
<li>Độ dài giá trị trường vượt quá cài đặt <code>ignore_above</code> trong mapping</li>
<li>Định dạng giá trị trường không đúng và <code>ignore_malformed</code> đã được định nghĩa trong mapping</li>
</ul>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "exists"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "field"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "email"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Các tài liệu sau sẽ khớp với truy vấn trên:</p>
<ul>
<li><code>{ "user" : "jane" }</code> có trường user và không trống.</li>
<li><code>{ "user" : "" }</code> có trường user, giá trị là chuỗi trống.</li>
<li><code>{ "user" : "-" }</code> có trường user, giá trị không trống.</li>
<li><code>{ "user" : [ "jane" ] }</code> có trường user, giá trị không trống.</li>
<li><code>{ "user" : [ "jane", null ] }</code> có trường user, chỉ cần có ít nhất một giá trị không trống.</li>
</ul>
<p>Các tài liệu sau sẽ không khớp:</p>
<ul>
<li><code>{ "user" : null }</code> có trường user nhưng giá trị trống.</li>
<li><code>{ "user" : [] }</code> có trường user nhưng giá trị trống.</li>
<li><code>{ "user" : [null] }</code> có trường user nhưng giá trị trống.</li>
<li><code>{ "foo" : "bar" }</code> không có trường user.</li>
</ul>
<h3>fuzzy query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-fuzzy-query.html" target="_blank" rel="noopener noreferrer"><strong><code>fuzzy query</code></strong> (truy vấn mờ)</a> trả về các tài liệu chứa các từ tương tự với từ tìm kiếm. ES sử dụng <a href="https://en.wikipedia.org/wiki/Levenshtein_distance" target="_blank" rel="noopener noreferrer">Khoảng cách chỉnh sửa Levenshtein</a> để đo độ tương tự hoặc mờ.</p>
<p>Khoảng cách chỉnh sửa là số lượng thay đổi ký tự đơn lẻ cần thiết để chuyển đổi một thuật ngữ thành thuật ngữ khác. Những thay đổi này có thể bao gồm:</p>
<ul>
<li>Thay đổi một ký tự: (<strong>b</strong>ox -&gt; <strong>f</strong>ox)</li>
<li>Xóa một ký tự: (<strong>b</strong>lack -&gt; lack)</li>
<li>Thêm một ký tự: (sic -&gt; sic<strong>k</strong>)</li>
<li>Đảo ngược hai ký tự liền kề: (<strong>ac</strong>t → <strong>ca</strong>t)</li>
</ul>
<p>Để tìm các từ khóa tương tự, truy vấn mờ sẽ tạo ra tất cả các biến thể hoặc tập mở rộng có thể của từ khóa tìm kiếm trong khoảng cách chỉnh sửa được chỉ định. Sau đó, nó trả về các tài liệu khớp hoàn toàn với bất kỳ tập mở rộng nào.</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> books/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "fuzzy"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "user.id"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "ki",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "fuzziness"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "AUTO",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "max_expansions"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 50,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "prefix_length"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "transpositions"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "rewrite"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "constant_score"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lưu ý: Nếu <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html#query-dsl-allow-expensive-queries" target="_blank" rel="noopener noreferrer"><code>search.allow_expensive_queries</code></a> đã được cấu hình, thì truy vấn mờ không thể được thực thi.</p>
<h3>ids query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-ids-query.html" target="_blank" rel="noopener noreferrer"><strong><code>ids query</code></strong></a> trả về các tài liệu dựa trên ID. Truy vấn này sử dụng ID tài liệu được lưu trữ trong trường <code>_id</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "ids"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "values"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"4",</span><span style="color:#98C379;--shiki-dark:#98C379"> "100"]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>prefix query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-prefix-query.html#prefix-query-ex-request" target="_blank" rel="noopener noreferrer"><strong><code>prefix query</code></strong></a> được sử dụng để truy vấn các tài liệu có chứa tiền tố chỉ định trong một trường nào đó.</p>
<p>Ví dụ, để truy vấn các tài liệu có <code>user.id</code> chứa các từ khóa bắt đầu bằng <code>ki</code>, tất cả các tài liệu chứa các từ khóa như <code>kind</code>, <code>kid</code> và bất kỳ từ khóa nào khác bắt đầu bằng <code>ki</code> sẽ được khớp.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "prefix"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "user.id"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "ki"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>range query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-range-query.html" target="_blank" rel="noopener noreferrer"><strong><code>range query</code></strong></a> hay truy vấn phạm vi, được sử dụng để khớp các tài liệu có trường số, ngày hoặc chuỗi trong một phạm vi nhất định. Ví dụ, tìm kiếm những quyển sách có giá từ 50 đến 100, hoặc những quyển sách được xuất bản từ năm 2015 đến năm 2019. <strong>Truy vấn phạm vi chỉ có thể truy vấn một trường, không thể áp dụng trên nhiều trường</strong>.</p>
<p>Truy vấn phạm vi hỗ trợ các tham số sau:</p>
<ul>
<li><strong><code>gt</code></strong>: lớn hơn</li>
<li><strong><code>gte</code></strong>: lớn hơn hoặc bằng</li>
<li><strong><code>lt</code></strong>: nhỏ hơn</li>
<li><strong><code>lte</code></strong>: nhỏ hơn hoặc bằng</li>
<li><strong><code>format</code></strong>: nếu trường là loại Date, bạn có thể đặt định dạng ngày</li>
<li><strong><code>time_zone</code></strong>: múi giờ</li>
<li><strong><code>relation</code></strong>: chỉ ra cách truy vấn phạm vi khớp với các giá trị trường phạm vi.
<ul>
<li><strong><code>INTERSECTS</code> (Mặc định)</strong>: Khớp với các tài liệu có giá trị trường phạm vi giao nhau với truy vấn.</li>
<li><strong><code>CONTAINS</code></strong>: Khớp với các tài liệu hoàn toàn chứa giá trị trường của truy vấn.</li>
<li><strong><code>WITHIN</code></strong>: Khớp với các tài liệu có giá trị trường phạm vi hoàn toàn trong phạm vi truy vấn.</li>
</ul>
</li>
</ul>
<p>Ví dụ: Truy vấn phạm vi số</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "range"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "taxful_total_price"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "gt"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 10,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "lte"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 50</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Ví dụ: Truy vấn phạm vi ngày</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "range"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "order_date"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "time_zone"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "+00:00",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "gte"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "2018-01-01T00:00:00",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "lte"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "now"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>regexp query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html" target="_blank" rel="noopener noreferrer"><strong><code>regexp query</code></strong></a> trả về các tài liệu thuộc về các term khớp với biểu thức chính quy.</p>
<p><a href="https://vi.wikipedia.org/wiki/Bi%E1%BB%83u_th%E1%BB%A9c_ch%C3%ADnh_quy" target="_blank" rel="noopener noreferrer">Biểu thức chính quy</a> là một phương pháp sử dụng các ký tự đại diện để khớp với các mô hình dữ liệu, được gọi là toán tử.</p>
<p>Ví dụ: Tìm kiếm dưới đây trả về các tài liệu có trường <code>user.id</code> chứa bất kỳ từ nào bắt đầu bằng <code>k</code> và kết thúc bằng <code>y</code>. Toán tử <code>.*</code> khớp với bất kỳ ký tự nào với bất kỳ độ dài nào, bao gồm cả không có ký tự. Các từ khớp có thể bao gồm <code>ky</code>, <code>kay</code> và <code>kimchy</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "regexp"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "user.id"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "k.*y",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "flags"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "ALL",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "case_insensitive"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "max_determinized_states"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 10000,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "rewrite"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "constant_score"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Nếu <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html#query-dsl-allow-expensive-queries" target="_blank" rel="noopener noreferrer"><code>search.allow_expensive_queries</code></a> được cấu hình, thì <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-regexp-query.html" target="_blank" rel="noopener noreferrer"><strong><code>regexp query</code></strong></a> sẽ bị vô hiệu hóa.</p>
</blockquote>
<h3>term query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" target="_blank" rel="noopener noreferrer"><strong><code>term query</code></strong></a> được sử dụng để tìm các tài liệu có chứa từ cụ thể trong một trường cụ thể. Truy vấn term không được phân tích, chỉ khi từ truy vấn và từ trong tài liệu khớp chính xác thì mới được tìm kiếm. Các tình huống áp dụng bao gồm tìm kiếm tên người, tên địa điểm và các yêu cầu khớp chính xác khác.</p>
<p>Ví dụ:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 1. Tạo một chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "properties"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "full_text"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "type":</span><span style="color:#98C379;--shiki-dark:#98C379"> "text"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 2. Sử dụng từ khóa "Quick Brown Foxes!" để tìm kiếm trường "full_text"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "full_text"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quick Brown Foxes!"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 3. Sử dụng term query</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001/_search?pretty</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "full_text"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quick Brown Foxes!"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Vì trường full_text không còn chứa Term chính xác - "Quick Brown Foxes!", nên term query không tìm thấy kết quả nào</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 4. Sử dụng match query</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001/_search?pretty</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "full_text"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quick Brown Foxes!"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote>
<p>⚠️ Lưu ý: Nên tránh sử dụng term query để truy vấn các trường text.</p>
<p>Theo mặc định, Elasticsearch phân tích các giá trị của trường text, điều này khiến việc tìm kiếm khớp chính xác với giá trị của trường text trở nên khó khăn.</p>
<p>Để tìm kiếm giá trị của trường text, bạn nên sử dụng match query.</p>
</blockquote>
<h3>terms query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-terms-query.html" target="_blank" rel="noopener noreferrer"><strong><code>terms query</code></strong></a> giống với <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-term-query.html" target="_blank" rel="noopener noreferrer"><strong><code>term query</code></strong></a>, nhưng có thể tìm kiếm nhiều giá trị.</p>
<p>Các tham số truy vấn terms query:</p>
<ul>
<li><strong><code>index</code></strong>: Tên chỉ mục</li>
<li><strong><code>id</code></strong>: ID tài liệu</li>
<li><strong><code>path</code></strong>: Tên của trường mà từ đó lấy giá trị trường, tức từ khóa tìm kiếm</li>
<li><strong><code>routing</code></strong> (tùy chọn): Giá trị định tuyến tùy chỉnh của tài liệu từ đó lấy giá trị term. Nếu giá trị định tuyến tùy chỉnh đã được cung cấp khi lập chỉ mục tài liệu, thì tham số này là bắt buộc.</li>
</ul>
<p>Ví dụ:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 1. Tạo một chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "properties"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "color"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "type":</span><span style="color:#98C379;--shiki-dark:#98C379"> "keyword"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 2. Ghi một tài liệu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "color"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "blue"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "green"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 3. Ghi một tài liệu khác</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001/_doc/2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "color"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "blue"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># 3. Sử dụng terms query</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001/_search?pretty</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "terms"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "color"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "my-index-000001",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "id"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "2",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "path"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "color"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> my-index-000001</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>type query</h3>
<blockquote>
<p>Đã bị loại bỏ sau phiên bản 7.0.0</p>
</blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-type-query.html" target="_blank" rel="noopener noreferrer"><strong><code>type query</code></strong></a> được sử dụng để truy vấn các tài liệu có loại cụ thể.</p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "type"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "_doc"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Tuy nhiên, từ phiên bản 7.0.0 trở đi, Elasticsearch đã loại bỏ hỗ trợ cho nhiều loại tài liệu trong một chỉ mục. Do đó, <code>type query</code> không còn được sử dụng nữa. Thay vào đó, bạn có thể sử dụng các cấu trúc dữ liệu khác nhau trong cùng một tài liệu hoặc sử dụng nhiều chỉ mục.</p>
<h3>wildcard query</h3>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html" target="_blank" rel="noopener noreferrer"><strong><code>wildcard query</code></strong></a> là truy vấn sử dụng ký tự đại diện, trả về các tài liệu khớp với mô hình ký tự đại diện.</p>
<p><code>?</code> được sử dụng để khớp với một ký tự bất kỳ, <code>*</code> được sử dụng để khớp với không hoặc nhiều ký tự.</p>
<p>Ví dụ: Truy vấn dưới đây trả về các tài liệu mà trường <code>user.id</code> chứa các thuật ngữ bắt đầu bằng <code>ki</code> và kết thúc bằng <code>y</code>. Các khớp này có thể bao gồm <code>kiy</code>, <code>kity</code> hoặc <code>kimchy</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "wildcard"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "user.id"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "ki*y",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "boost"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1.0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "rewrite"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "constant_score"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Nếu <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl.html#query-dsl-allow-expensive-queries" target="_blank" rel="noopener noreferrer"><code>search.allow_expensive_queries</code></a> được cấu hình, thì <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/query-dsl-wildcard-query.html" target="_blank" rel="noopener noreferrer"><strong><code>wildcard query</code></strong></a> sẽ bị vô hiệu hóa.</p>
</blockquote>
<h3>Ví dụ hoàn chỉnh về truy vấn từ khoá</h3>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> products</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> products</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "number_of_shards"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /products/_bulk</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id":</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"productID"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "XHDK-A-1293-#fJ3","desc":"iPhone"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id":</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"productID"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "KDKE-B-9947-#kL5","desc":"iPad"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id":</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"productID"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "JODL-X-1937-#pV7","desc":"MBP"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /products</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /products/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        //</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "iPhone"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"iphone"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /products/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "desc.keyword"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        //</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "iPhone"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        //</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"iphone"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /products/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "productID"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "XHDK-A-1293-#fJ3"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /products/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  //</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"explain"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "productID.keyword"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "value"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "XHDK-A-1293-#fJ3"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /products/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "explain"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "constant_score"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "filter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "productID.keyword"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "XHDK-A-1293-#fJ3"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ví dụ trên, chúng ta đã tạo một chỉ mục <code>products</code> với một số tài liệu. Mỗi tài liệu có hai trường là <code>productID</code> và <code>desc</code>.</p>
<p>Sau đó, chúng ta thực hiện một số truy vấn từ ngữ (<code>term query</code>) khác nhau. Truy vấn từ ngữ được sử dụng để tìm các tài liệu mà một trường cụ thể chứa một giá trị cụ thể.</p>
<p>Trong các truy vấn, chúng ta có thể thấy rằng Elasticsearch phân biệt chữ hoa và chữ thường. Ví dụ, truy vấn từ ngữ với giá trị "iphone" sẽ không trả về tài liệu mà trường <code>desc</code> có giá trị "iPhone".</p>
<p>Ngoài ra, chúng ta cũng thấy rằng chúng ta có thể sử dụng trường <code>keyword</code> để thực hiện truy vấn không phân biệt chữ hoa và chữ thường.</p>
<p>Cuối cùng, chúng ta cũng thấy rằng chúng ta có thể sử dụng <code>constant_score</code> để áp dụng điểm số cố định cho tất cả các tài liệu khớp.</p>
<h2>Truy vấn kết hợp</h2>
<p>Truy vấn kết hợp là việc kết hợp một số truy vấn đơn giản lại với nhau để đáp ứng các yêu cầu truy vấn phức tạp hơn. Ngoài ra, truy vấn kết hợp cũng có thể điều khiển hành vi của các truy vấn khác.</p>
<h3>bool query</h3>
<p>Truy vấn bool có thể kết hợp bất kỳ số lượng truy vấn đơn giản nào, sử dụng các tùy chọn must, should, must_not, filter để biểu thị logic giữa các truy vấn đơn giản. Mỗi tùy chọn có thể xuất hiện từ 0 đến nhiều lần, ý nghĩa của chúng như sau:</p>
<ul>
<li>must: tài liệu phải khớp với các điều kiện truy vấn trong tùy chọn must, tương đương với AND trong logic, và tham gia vào việc đánh giá mức độ liên quan của tài liệu.</li>
<li>should: tài liệu có thể khớp hoặc không khớp với các điều kiện truy vấn trong tùy chọn should, tương đương với OR trong logic, và tham gia vào việc đánh giá mức độ liên quan của tài liệu.</li>
<li>must_not: ngược lại với must, các tài liệu khớp với các điều kiện truy vấn trong tùy chọn must_not sẽ không được trả về; điều cần lưu ý là <strong>câu lệnh must_not không ảnh hưởng đến việc đánh giá điểm, nó chỉ loại bỏ các tài liệu không liên quan</strong>.</li>
<li>filter: giống như must, chỉ các tài liệu khớp với các điều kiện truy vấn trong tùy chọn filter mới được trả về, <strong>nhưng filter không đánh giá điểm, chỉ có chức năng lọc, ngược lại với must_not</strong>.</li>
</ul>
<p>Giả sử bạn muốn tìm kiếm các cuốn sách có tiêu đề chứa từ khóa java, giá không cao hơn 70, mô tả có thể chứa hoặc không chứa máy ảo, bạn có thể tạo truy vấn bool như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query": {</span></span>
<span class="line"><span>    "bool": {</span></span>
<span class="line"><span>      "filter": {</span></span>
<span class="line"><span>        "term": {</span></span>
<span class="line"><span>          "status": 1</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      "must_not": {</span></span>
<span class="line"><span>        "range": {</span></span>
<span class="line"><span>          "price": {</span></span>
<span class="line"><span>            "gte": 70</span></span>
<span class="line"><span>          }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      "must": {</span></span>
<span class="line"><span>        "match": {</span></span>
<span class="line"><span>          "title": "java"</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      "should": [</span></span>
<span class="line"><span>        {</span></span>
<span class="line"><span>          "match": {</span></span>
<span class="line"><span>            "description": "máy ảo"</span></span>
<span class="line"><span>          }</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      ],</span></span>
<span class="line"><span>      "minimum_should_match": 1</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Để biết thêm thông tin chi tiết về truy vấn bool, hãy tham khảo <a href="https://www.knowledgedict.com/tutorial/elasticsearch-query-bool.html" target="_blank" rel="noopener noreferrer">bool query（truy vấn kết hợp）chi tiết</a>.</p>
<h3>Truy vấn boosting</h3>
<p>Truy vấn boosting được sử dụng trong các tình huống cần điều chỉnh điểm số của hai truy vấn. Truy vấn boosting sẽ đóng gói hai truy vấn lại với nhau và giảm điểm số của một trong hai truy vấn.</p>
<p>Truy vấn boosting bao gồm ba phần: positive, negative và negative_boost. Điểm số của truy vấn trong phần positive được giữ nguyên, truy vấn trong phần negative sẽ giảm điểm số của tài liệu, và negative_boost chỉ định giá trị giảm trong phần negative. Nếu chúng ta muốn giảm điểm số của các cuốn sách xuất bản trước năm 2015, chúng ta có thể tạo một truy vấn boosting, truy vấn như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"boosting": {</span></span>
<span class="line"><span>			"positive": {</span></span>
<span class="line"><span>				"match": {</span></span>
<span class="line"><span>					"title": "python"</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"negative": {</span></span>
<span class="line"><span>				"range": {</span></span>
<span class="line"><span>					"publish_time": {</span></span>
<span class="line"><span>						"lte": "2015-01-01"</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"negative_boost": 0.2</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong truy vấn boosting, chúng ta đã chỉ định yếu tố ức chế là 0.2, điểm số của các tài liệu có giá trị publish_time sau ngày 01-01-2015 không thay đổi, điểm số của các tài liệu có giá trị publish_time trước ngày 01-01-2015 sẽ là 0.2 lần điểm số gốc.</p>
<h3>Truy vấn constant_score</h3>
<p>Truy vấn constant_score đóng gói một truy vấn filter và trả về các tài liệu phù hợp với điều kiện truy vấn của bộ lọc, với điểm số liên quan của tất cả chúng đều bằng giá trị của tham số _boost_ (có thể hiểu là điểm số liên quan ban đầu dựa trên tf-idf hoặc bm25 được cố định là 1.0, vì vậy điểm số cuối cùng là <em>1.0 * boost</em>, tức là bằng giá trị của tham số <em>boost</em>). Truy vấn dưới đây sẽ trả về các tài liệu có trường title chứa từ khóa <em>elasticsearch</em>, với điểm số của tất cả các tài liệu đều là 1.8:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query": {</span></span>
<span class="line"><span>    "constant_score": {</span></span>
<span class="line"><span>      "filter": {</span></span>
<span class="line"><span>        "term": {</span></span>
<span class="line"><span>          "title": "elasticsearch"</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      "boost": 1.8</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Truy vấn dis_max</h3>
<p>Truy vấn dis_max có một số liên hệ nhưng cũng có sự khác biệt với truy vấn bool. Truy vấn dis_max hỗ trợ nhiều truy vấn song song, có thể trả về bất kỳ loại tài liệu nào phù hợp với bất kỳ điều kiện truy vấn con nào. Khác với cách truy vấn bool có thể kết hợp điểm số của tất cả các truy vấn phù hợp, truy vấn dis_max chỉ sử dụng điểm số của điều kiện truy vấn phù hợp nhất. Hãy xem ví dụ dưới đây:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"dis_max": {</span></span>
<span class="line"><span>			"tie_breaker": 0.7,</span></span>
<span class="line"><span>			"boost": 1.2,</span></span>
<span class="line"><span>			"queries": [{</span></span>
<span class="line"><span>					"term": {</span></span>
<span class="line"><span>						"age": 34</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				},</span></span>
<span class="line"><span>				{</span></span>
<span class="line"><span>					"term": {</span></span>
<span class="line"><span>						"age": 35</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			]</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Truy vấn function_score</h3>
<p>Truy vấn function_score có thể chỉnh sửa điểm số của các tài liệu được truy vấn, loại truy vấn này rất hữu ích trong một số trường hợp, chẳng hạn như khi chi phí tính toán điểm số của tài liệu bằng hàm điểm số là quá cao, người dùng có thể thay thế cách tính điểm số truyền thống bằng cách sử dụng bộ lọc kết hợp với hàm điểm số tùy chỉnh.</p>
<p>Khi sử dụng truy vấn function_score, người dùng cần định nghĩa một truy vấn và một hoặc nhiều hàm điểm số, hàm điểm số sẽ tính toán điểm số cho mỗi tài liệu được truy vấn.</p>
<p>Truy vấn dưới đây sẽ trả về tất cả các tài liệu trong chỉ mục books, với điểm số tối đa của tài liệu là 5, điểm số của mỗi tài liệu được tạo ngẫu nhiên, chế độ tính trọng số là chế độ nhân.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query": {</span></span>
<span class="line"><span>    "function_score": {</span></span>
<span class="line"><span>      "query": {</span></span>
<span class="line"><span>        "match_all": {}</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      "boost": "5",</span></span>
<span class="line"><span>      "random_score": {},</span></span>
<span class="line"><span>      "boost_mode": "multiply"</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Sử dụng script để tùy chỉnh công thức điểm số, ở đây chúng tôi lấy căn bậc hai của một phần mười giá trị price làm điểm số cho mỗi tài liệu, truy vấn như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query": {</span></span>
<span class="line"><span>    "function_score": {</span></span>
<span class="line"><span>      "query": {</span></span>
<span class="line"><span>        "match": {</span></span>
<span class="line"><span>          "title": "java"</span></span>
<span class="line"><span>        }</span></span>
<span class="line"><span>      },</span></span>
<span class="line"><span>      "script_score": {</span></span>
<span class="line"><span>        "inline": "Math.sqrt(doc['price'].value/10)"</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Để biết thêm chi tiết về function_score, vui lòng xem <a href="https://www.knowledgedict.com/tutorial/elasticsearch-function_score.html" target="_blank" rel="noopener noreferrer">Elasticsearch function_score truy vấn giải thích mạnh nhất</a>.</p>
<h3>Truy vấn indices</h3>
<p>Truy vấn indices phù hợp với các tình huống cần truy vấn giữa nhiều chỉ mục, nó cho phép chỉ định danh sách tên chỉ mục và truy vấn nội bộ. Trong truy vấn indices, có hai phần là query và no_match_query. Phần query được sử dụng để tìm kiếm tài liệu trong danh sách chỉ mục được chỉ định, trong khi điều kiện truy vấn trong no_match_query được sử dụng để tìm kiếm tài liệu ngoài danh sách chỉ mục được chỉ định. Truy vấn sau đây tìm kiếm các tài liệu trong chỉ mục books và books2 có trường title chứa từ khóa "javascript", và các tài liệu trong các chỉ mục khác có trường title chứa "basketball". Truy vấn như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"indices": {</span></span>
<span class="line"><span>			"indices": ["books", "books2"],</span></span>
<span class="line"><span>			"query": {</span></span>
<span class="line"><span>				"match": {</span></span>
<span class="line"><span>					"title": "javascript"</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"no_match_query": {</span></span>
<span class="line"><span>				"term": {</span></span>
<span class="line"><span>					"title": "basketball"</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Truy vấn lồng</h2>
<p>Trong hệ thống phân tán như Elasticsearch, việc thực hiện truy vấn kết nối theo phong cách SQL toàn diện có chi phí cao và không khả thi. Thay vào đó, để thực hiện mở rộng theo quy mô chiều ngang, Elasticsearch cung cấp hai hình thức join sau:</p>
<ul>
<li>
<p>Truy vấn lồng (nested query)</p>
<p>Các tài liệu có thể chứa các trường kiểu lồng, các trường này được sử dụng để chỉ mục một số đối tượng mảng, mỗi đối tượng có thể được truy vấn như một tài liệu độc lập.</p>
</li>
<li>
<p>Truy vấn has_child (có truy vấn con) và truy vấn has_parent (có truy vấn cha)</p>
<p>Mối quan hệ cha-con có thể tồn tại giữa hai loại tài liệu trong một chỉ mục duy nhất. Truy vấn has_child sẽ trả về các tài liệu cha mà tài liệu con của chúng đáp ứng truy vấn cụ thể, trong khi has_parent sẽ trả về các tài liệu con mà tài liệu cha của chúng đáp ứng truy vấn cụ thể.</p>
</li>
</ul>
<h3>Truy vấn lồng</h3>
<p>Các tài liệu có thể chứa các trường kiểu lồng, các trường này được sử dụng để chỉ mục một số đối tượng mảng, mỗi đối tượng có thể được truy vấn như một tài liệu độc lập (sử dụng truy vấn lồng).</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUT /my_index</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"mappings": {</span></span>
<span class="line"><span>		"type1": {</span></span>
<span class="line"><span>			"properties": {</span></span>
<span class="line"><span>				"obj1": {</span></span>
<span class="line"><span>					"type": "nested"</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Truy vấn has_child</h3>
<p>Mối quan hệ cha-con giữa các tài liệu được khai báo trong lúc tạo chỉ mục, trong ví dụ này, chúng ta sẽ sử dụng nhân viên (employee) và chi nhánh (branch) làm ví dụ, chúng thuộc về các loại khác nhau, tương đương với hai bảng trong cơ sở dữ liệu. Nếu chúng ta muốn liên kết nhân viên với thành phố mà họ làm việc, chúng ta cần thông báo cho Elasticsearch về mối quan hệ cha-con giữa các tài liệu, trong đó employee là loại con, và branch là loại cha. Chúng ta khai báo mối quan hệ này trong lúc tạo chỉ mục, thực hiện lệnh sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUT /company</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"mappings": {</span></span>
<span class="line"><span>		"branch": {},</span></span>
<span class="line"><span>		"employee": {</span></span>
<span class="line"><span>			"parent": { "type": "branch" }</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Sử dụng bulk api để chỉ mục tài liệu dưới loại branch, lệnh như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>POST company/branch/_bulk</span></span>
<span class="line"><span>{ "index": { "_id": "london" }}</span></span>
<span class="line"><span>{ "name": "London Westminster","city": "London","country": "UK" }</span></span>
<span class="line"><span>{ "index": { "_id": "liverpool" }}</span></span>
<span class="line"><span>{ "name": "Liverpool Central","city": "Liverpool","country": "UK" }</span></span>
<span class="line"><span>{ "index": { "_id": "paris" }}</span></span>
<span class="line"><span>{ "name": "Champs Elysees","city": "Paris","country": "France" }</span></span></code></pre>
</div><p>Thêm dữ liệu nhân viên:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>POST company/employee/_bulk</span></span>
<span class="line"><span>{ "index": { "_id": 1,"parent":"london" }}</span></span>
<span class="line"><span>{ "name": "Alice Smith","dob": "1970-10-24","hobby": "hiking" }</span></span>
<span class="line"><span>{ "index": { "_id": 2,"parent":"london" }}</span></span>
<span class="line"><span>{ "name": "Mark Tomas","dob": "1982-05-16","hobby": "diving" }</span></span>
<span class="line"><span>{ "index": { "_id": 3,"parent":"liverpool" }}</span></span>
<span class="line"><span>{ "name": "Barry Smith","dob": "1979-04-01","hobby": "hiking" }</span></span>
<span class="line"><span>{ "index": { "_id": 4,"parent":"paris" }}</span></span>
<span class="line"><span>{ "name": "Adrien Grand","dob": "1987-05-11","hobby": "horses" }</span></span></code></pre>
</div><p>Để truy vấn tài liệu cha thông qua tài liệu con, chúng ta sử dụng truy vấn has_child. Ví dụ, để tìm kiếm các chi nhánh có nhân viên sinh sau năm 1980, nhân viên sinh sau năm 1980 bao gồm Mark Thomas và Adrien Grand, họ làm việc tại London và Paris tương ứng. Chúng ta thực hiện lệnh truy vấn sau để xác minh:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET company/branch/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"has_child": {</span></span>
<span class="line"><span>			"type": "employee",</span></span>
<span class="line"><span>			"query": {</span></span>
<span class="line"><span>				"range": { "dob": { "gte": "1980-01-01" } }</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Tìm kiếm những chi nhánh có nhân viên tên là "Alice Smith", vì chúng ta sử dụng truy vấn match, nó sẽ được phân tích thành "Alice" và "Smith", vì vậy chi nhánh mà Alice Smith và Barry Smith làm việc sẽ được khớp. Chúng ta thực hiện lệnh truy vấn sau để xác minh:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET company/branch/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"has_child": {</span></span>
<span class="line"><span>			"type": "employee",</span></span>
<span class="line"><span>			"score_mode": "max",</span></span>
<span class="line"><span>			"query": {</span></span>
<span class="line"><span>				"match": { "name": "Alice Smith" }</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Chúng ta có thể sử dụng min_children để chỉ định số lượng tối thiểu của tài liệu con. Ví dụ, để tìm kiếm những chi nhánh có ít nhất hai nhân viên, chúng ta thực hiện lệnh truy vấn sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET company/branch/_search?pretty</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"has_child": {</span></span>
<span class="line"><span>			"type": "employee",</span></span>
<span class="line"><span>			"min_children": 2,</span></span>
<span class="line"><span>			"query": {</span></span>
<span class="line"><span>				"match_all": {}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Truy vấn has_parent</h3>
<p>Để truy vấn tài liệu con thông qua tài liệu cha, chúng ta sử dụng truy vấn has_parent. Ví dụ, để tìm kiếm những nhân viên làm việc ở UK, chúng ta thực hiện lệnh truy vấn sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET company/employee/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"has_parent": {</span></span>
<span class="line"><span>			"parent_type": "branch",</span></span>
<span class="line"><span>			"query": {</span></span>
<span class="line"><span>				"match": { "country": "UK" }</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h2>Truy vấn vị trí</h2>
<p>Elasticsearch có thể tìm kiếm dữ liệu của loại điểm địa lý (geo_point) và hình dạng địa lý (geo_shape). Để thuận tiện cho việc học, chúng ta sẽ chuẩn bị một số tọa độ địa lý của các thành phố để làm dữ liệu thử nghiệm, mỗi tài liệu đều bao gồm hai trường là tên thành phố và tọa độ địa lý. Tọa độ này được lấy từ một vị trí ở trung tâm của mỗi thành phố. Đầu tiên, hãy lưu nội dung sau vào tệp geo.json:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>{"index":{ "_index":"geo","_type":"city","_id":"1" }}</span></span>
<span class="line"><span>{"name":"Bắc Kinh","location":"39.9088145109,116.3973999023"}</span></span>
<span class="line"><span>{"index":{ "_index":"geo","_type":"city","_id": "2" }}</span></span>
<span class="line"><span>{"name":"Urumqi","location":"43.8266300000,87.6168800000"}</span></span>
<span class="line"><span>{"index":{ "_index":"geo","_type":"city","_id":"3" }}</span></span>
<span class="line"><span>{"name":"Tây An","location":"34.3412700000,108.9398400000"}</span></span>
<span class="line"><span>{"index":{ "_index":"geo","_type":"city","_id":"4" }}</span></span>
<span class="line"><span>{"name":"Zhengzhou","location":"34.7447157466,113.6587142944"}</span></span>
<span class="line"><span>{"index":{ "_index":"geo","_type":"city","_id":"5" }}</span></span>
<span class="line"><span>{"name":"Hàng Châu","location":"30.2294080260,120.1492309570"}</span></span>
<span class="line"><span>{"index":{ "_index":"geo","_type":"city","_id":"6" }}</span></span>
<span class="line"><span>{"name":"Jinan","location":"36.6518400000,117.1200900000"}</span></span></code></pre>
</div><p>Tạo một chỉ mục và thiết lập ánh xạ:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUT geo</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"mappings": {</span></span>
<span class="line"><span>		"city": {</span></span>
<span class="line"><span>			"properties": {</span></span>
<span class="line"><span>				"name": {</span></span>
<span class="line"><span>					"type": "keyword"</span></span>
<span class="line"><span>				},</span></span>
<span class="line"><span>				"location": {</span></span>
<span class="line"><span>					"type": "geo_point"</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sau đó thực hiện lệnh nhập hàng loạt:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>curl -XPOST "http://localhost:9200/_bulk?pretty" --data-binary @geo.json</span></span></code></pre>
</div><h3>Truy vấn geo_distance</h3>
<p>Truy vấn geo_distance có thể tìm kiếm các tài liệu điểm địa lý nằm trong phạm vi xác định từ một điểm trung tâm. Ví dụ, để tìm kiếm các thành phố nằm trong bán kính 200km từ Thanh Đô, kết quả tìm kiếm sẽ trả về Bắc Kinh, lệnh như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET geo/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"bool": {</span></span>
<span class="line"><span>			"must": {</span></span>
<span class="line"><span>				"match_all": {}</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"filter": {</span></span>
<span class="line"><span>				"geo_distance": {</span></span>
<span class="line"><span>					"distance": "200km",</span></span>
<span class="line"><span>					"location": {</span></span>
<span class="line"><span>						"lat": 39.0851000000,</span></span>
<span class="line"><span>						"lon": 117.1993700000</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Sắp xếp các thành phố theo khoảng cách đến Bắc Kinh:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET geo/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query": {</span></span>
<span class="line"><span>    "match_all": {}</span></span>
<span class="line"><span>  },</span></span>
<span class="line"><span>  "sort": [{</span></span>
<span class="line"><span>    "_geo_distance": {</span></span>
<span class="line"><span>      "location": "39.9088145109,116.3973999023",</span></span>
<span class="line"><span>      "unit": "km",</span></span>
<span class="line"><span>      "order": "asc",</span></span>
<span class="line"><span>      "distance_type": "plane"</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }]</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Trong đó, trường location tương ứng với trường kinh độ và vĩ độ; unit là <code>km</code>, nghĩa là khoảng cách sẽ được ghi vào khóa sort của mỗi kết quả trả về theo đơn vị <code>km</code>; distance_type là <code>plane</code>, nghĩa là sử dụng phương pháp tính toán <code>plane</code> nhanh nhưng độ chính xác hơi kém.</p>
<h3>Truy vấn geo_bounding_box</h3>
<p>Truy vấn geo_bounding_box được sử dụng để tìm kiếm các tọa độ địa lý nằm trong một hình chữ nhật xác định. Truy vấn xác định một hình chữ nhật bằng hai điểm, sau đó tìm kiếm các tài liệu phù hợp trong khu vực hình chữ nhật.</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET geo/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"bool": {</span></span>
<span class="line"><span>			"must": {</span></span>
<span class="line"><span>				"match_all": {}</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"filter": {</span></span>
<span class="line"><span>				"geo_bounding_box": {</span></span>
<span class="line"><span>					"location": {</span></span>
<span class="line"><span>						"top_left": {</span></span>
<span class="line"><span>							"lat": 38.4864400000,</span></span>
<span class="line"><span>							"lon": 106.2324800000</span></span>
<span class="line"><span>						},</span></span>
<span class="line"><span>						"bottom_right": {</span></span>
<span class="line"><span>							"lat": 28.6820200000,</span></span>
<span class="line"><span>							"lon": 115.8579400000</span></span>
<span class="line"><span>						}</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Truy vấn geo_polygon</h3>
<p>Truy vấn geo_polygon được sử dụng để tìm kiếm các điểm địa lý nằm trong một đa giác xác định. Ví dụ, Hohhot, Chongqing và Thượng Hải tạo thành một tam giác, truy vấn các thành phố nằm trong khu vực tam giác này, lệnh như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET geo/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"bool": {</span></span>
<span class="line"><span>			"must": {</span></span>
<span class="line"><span>				"match_all": {}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		},</span></span>
<span class="line"><span>		"filter": {</span></span>
<span class="line"><span>			"geo_polygon": {</span></span>
<span class="line"><span>				"location": {</span></span>
<span class="line"><span>					"points": [{</span></span>
<span class="line"><span>						"lat": 40.8414900000,</span></span>
<span class="line"><span>						"lon": 111.7519900000</span></span>
<span class="line"><span>					}, {</span></span>
<span class="line"><span>						"lat": 29.5647100000,</span></span>
<span class="line"><span>						"lon": 106.5507300000</span></span>
<span class="line"><span>					}, {</span></span>
<span class="line"><span>						"lat": 31.2303700000,</span></span>
<span class="line"><span>						"lon": 121.4737000000</span></span>
<span class="line"><span>					}]</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Truy vấn geo_shape</h3>
<p>Truy vấn geo_shape được sử dụng để tìm kiếm dữ liệu địa lý kiểu geo_shape, có ba mối quan hệ giữa các hình dạng địa lý là giao nhau, chứa và không giao nhau. Tạo một chỉ mục mới để thử nghiệm, trong đó loại trường location được đặt là geo_shape.</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUT geoshape</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"mappings": {</span></span>
<span class="line"><span>		"city": {</span></span>
<span class="line"><span>			"properties": {</span></span>
<span class="line"><span>				"name": {</span></span>
<span class="line"><span>					"type": "keyword"</span></span>
<span class="line"><span>				},</span></span>
<span class="line"><span>				"location": {</span></span>
<span class="line"><span>					"type": "geo_shape"</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Về thứ tự kinh độ và vĩ độ, chúng ta cần lưu ý rằng, đối với trường kiểu geo_point, vĩ độ đứng trước kinh độ, nhưng đối với điểm trong kiểu geo_shape, kinh độ đứng trước vĩ độ.</p>
<p>Chúng ta có thể viết dòng kết nối Tây An và Zhengzhou vào chỉ mục:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>POST geoshape/city/1</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"name": "Tây An-Zhengzhou",</span></span>
<span class="line"><span>	"location": {</span></span>
<span class="line"><span>		"type": "linestring",</span></span>
<span class="line"><span>		"coordinates": [</span></span>
<span class="line"><span>			[108.9398400000, 34.3412700000],</span></span>
<span class="line"><span>			[113.6587142944, 34.7447157466]</span></span>
<span class="line"><span>		]</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Truy vấn hình dạng địa lý nằm trong hình chữ nhật được tạo bởi Yinchuan và Nanchang làm các điểm trên đường chéo, vì đường thẳng từ Tây An đến Zhengzhou nằm trong khu vực hình chữ nhật này, vì vậy nó có thể được truy vấn. Lệnh như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET geoshape/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"bool": {</span></span>
<span class="line"><span>			"must": {</span></span>
<span class="line"><span>				"match_all": {}</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"filter": {</span></span>
<span class="line"><span>				"geo_shape": {</span></span>
<span class="line"><span>					"location": {</span></span>
<span class="line"><span>						"shape": {</span></span>
<span class="line"><span>							"type": "envelope",</span></span>
<span class="line"><span>							"coordinates": [</span></span>
<span class="line"><span>								[106.23248, 38.48644],</span></span>
<span class="line"><span>								[115.85794, 28.68202]</span></span>
<span class="line"><span>							]</span></span>
<span class="line"><span>						},</span></span>
<span class="line"><span>						"relation": "within"</span></span>
<span class="line"><span>					}</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Truy vấn more_like_this</h3>
<p>Truy vấn more_like_this có thể tìm kiếm các tài liệu tương tự với văn bản cung cấp, thường được sử dụng trong các tình huống như đề xuất văn bản tương tự. Lệnh truy vấn như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"more_like_this": {</span></span>
<span class="line"><span>			"fields": ["title", "description"],</span></span>
<span class="line"><span>			"like": "java virtual machine",</span></span>
<span class="line"><span>			"min_term_freq": 1,</span></span>
<span class="line"><span>			"max_query_terms": 12</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Các tham số tùy chọn và mô tả giá trị của chúng như sau:</p>
<ul>
<li>fields: các trường cần phù hợp, mặc định là trường _all.</li>
<li>like: văn bản cần phù hợp.</li>
<li>min_term_freq: tần suất tối thiểu của các thuật ngữ trong tài liệu, mặc định là 2, các tài liệu có tần suất thấp hơn sẽ bị bỏ qua.</li>
<li>max_query_terms: số lượng thuật ngữ tối đa có thể có trong truy vấn, mặc định là 25.</li>
<li>min_doc_freq: tần suất tài liệu tối thiểu, mặc định là 5.</li>
<li>max_doc_freq: tần suất tài liệu tối đa.</li>
<li>min_word_length: độ dài tối thiểu của từ.</li>
<li>max_word_length: độ dài tối đa của từ.</li>
<li>stop_words: danh sách các từ dừng.</li>
<li>analyzer: bộ phân tích.</li>
<li>minimum_should_match: số lượng thuật ngữ tối thiểu mà tài liệu cần phù hợp, mặc định là 30% số thuật ngữ sau khi phân tích truy vấn.</li>
<li>boost_terms: trọng số của các thuật ngữ.</li>
<li>include: liệu có nên trả về tài liệu đầu vào như một kết quả hay không.</li>
<li>boost: trọng số của toàn bộ truy vấn, mặc định là 1.0.</li>
</ul>
<h3>Truy vấn script</h3>
<p>Elasticsearch hỗ trợ việc sử dụng script để truy vấn. Ví dụ, để tìm kiếm các tài liệu có giá lớn hơn 180, lệnh như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET books/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>  "query": {</span></span>
<span class="line"><span>    "script": {</span></span>
<span class="line"><span>      "script": {</span></span>
<span class="line"><span>        "inline": "doc['price'].value &gt; 180",</span></span>
<span class="line"><span>        "lang": "painless"</span></span>
<span class="line"><span>      }</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>  }</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><h3>Truy vấn percolate</h3>
<p>Trong hầu hết các trường hợp, chúng ta thường viết tài liệu vào Elasticsearch trước, sau đó sử dụng câu lệnh truy vấn để tìm kiếm tài liệu. Truy vấn percolate làm điều ngược lại, nó đăng ký các điều kiện truy vấn trước, sau đó dựa vào tài liệu để truy vấn query. Ví dụ, trong chỉ mục my-index có một loại laptop, tài liệu có hai trường là price và name, trong mapping, chúng ta định nghĩa một trường percolator là query, lệnh như sau:</p>
<div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUT my-index</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"mappings": {</span></span>
<span class="line"><span>		"laptop": {</span></span>
<span class="line"><span>			"properties": {</span></span>
<span class="line"><span>				"price": { "type": "long" },</span></span>
<span class="line"><span>				"name": { "type": "text" }</span></span>
<span class="line"><span>			},</span></span>
<span class="line"><span>			"queries": {</span></span>
<span class="line"><span>				"properties": {</span></span>
<span class="line"><span>					"query": { "type": "percolator" }</span></span>
<span class="line"><span>				}</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đăng ký một bool query, trong đó bool query bao gồm một range query, yêu cầu trường price có giá trị nhỏ hơn hoặc bằng 10000, và trường name chứa từ khóa macbook:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>PUT /my-index/queries/1?refresh</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"bool": {</span></span>
<span class="line"><span>			"must": [{</span></span>
<span class="line"><span>				"range": { "price": { "lte": 10000 } }</span></span>
<span class="line"><span>			}, {</span></span>
<span class="line"><span>				"match": { "name": "macbook" }</span></span>
<span class="line"><span>			}]</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Truy vấn query dựa vào tài liệu:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /my-index/_search</span></span>
<span class="line"><span>{</span></span>
<span class="line"><span>	"query": {</span></span>
<span class="line"><span>		"percolate": {</span></span>
<span class="line"><span>			"field": "query",</span></span>
<span class="line"><span>			"document_type": "laptop",</span></span>
<span class="line"><span>			"document": {</span></span>
<span class="line"><span>				"price": 9999,</span></span>
<span class="line"><span>				"name": "macbook pro on sale"</span></span>
<span class="line"><span>			}</span></span>
<span class="line"><span>		}</span></span>
<span class="line"><span>	}</span></span>
<span class="line"><span>}</span></span></code></pre>
</div><p>Tài liệu phù hợp với điều kiện trong query, kết quả trả về có thể tìm thấy bool query đã đăng ký ở trên. Truy vấn percolate có tính năng này phù hợp với các tình huống như phân loại dữ liệu, định tuyến dữ liệu, giám sát sự kiện và cảnh báo.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Elasticsearch Quick Start</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/quick-start.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/quick-start.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Quick Start</source>
      <description>Elasticsearch: Quick Start Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu phân tán, theo phong cách RESTful, có khả năng giải quyết nhiều tình huống khác nhau đang l...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><strong><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>&nbsp;là một công cụ tìm kiếm và phân tích dữ liệu phân tán, theo phong cách RESTful</strong>, có khả năng giải quyết nhiều tình huống khác nhau đang liên tục xuất hiện. Là trung tâm của Elastic Stack, nó lưu trữ dữ liệu của bạn một cách tập trung, giúp bạn khám phá những điều dự kiến và không dự kiến.</p>
<p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>&nbsp;được phát triển dựa trên thư viện tìm kiếm&nbsp;<a href="https://github.com/apache/lucene-solr" target="_blank" rel="noopener noreferrer">Lucene</a>. Elasticsearch ẩn đi sự phức tạp của Lucene và cung cấp interface API REST / Java dễ sử dụng (cũng như các interface API bằng ngôn ngữ khác).</p>
<p><em>Dưới đây sẽ gọi tắt là ES</em>.</p>
</blockquote>
<h2>Giới thiệu Elasticsearch</h2>
<p><strong><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>&nbsp;là một công cụ tìm kiếm và phân tích dữ liệu phân tán, theo phong cách RESTful</strong>, có khả năng giải quyết nhiều tình huống khác nhau đang liên tục xuất hiện. Là trung tâm của Elastic Stack, nó lưu trữ dữ liệu của bạn một cách tập trung, giúp bạn khám phá những điều dự kiến và không dự kiến.</p>
<p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a>&nbsp;<strong>được phát triển dựa trên thư viện tìm kiếm&nbsp;<a href="https://github.com/apache/lucene-solr" target="_blank" rel="noopener noreferrer">Lucene</a></strong>. Elasticsearch ẩn đi sự phức tạp của Lucene và cung cấp interface API REST / Java dễ sử dụng (cũng như các interface API bằng ngôn ngữ khác).</p>
<p>Elasticsearch có thể coi là một kho lưu trữ tài liệu, nó&nbsp;<strong>chuẩn hóa cấu trúc dữ liệu phức tạp thành JSON để lưu trữ</strong>.</p>
<p><strong>Elasticsearch là một công cụ tìm kiếm toàn văn gần như thời gian thực</strong>, điều này có nghĩa là:</p>
<ul>
<li>Từ khi ghi dữ liệu cho đến khi dữ liệu có thể được tìm kiếm, có một độ trễ nhỏ (khoảng 1 giây)</li>
<li>Thực hiện tìm kiếm và phân tích dựa trên ES có thể đạt đến mức giây.</li>
</ul>
<h3>Khái niệm cốt lõi</h3>
<p><code>index -&gt; type -&gt; mapping -&gt; document -&gt; field</code></p>
<h4>Cluster</h4>
<p>Một cluster bao gồm nhiều node, mỗi node thuộc về cluster nào được quyết định thông qua một cấu hình. Đối với các ứng dụng vừa và nhỏ, ban đầu một cluster chỉ có một node là bình thường.</p>
<h4>Node</h4>
<p>Node là một node trong cluster, mỗi node cũng có một tên, mặc định là được phân bổ ngẫu nhiên. Mặc định, node sẽ tham gia vào một cluster có tên là&nbsp;<code>elasticsearch</code>. Nếu bạn khởi động một loạt node trực tiếp, chúng sẽ tự động hình thành một cluster elasticsearch, tất nhiên một node cũng có thể hình thành một cluster elasticsearch.</p>
<h4>Index</h4>
<p><strong>Có thể coi là tập hợp tối ưu của các tài liệu (document).</strong></p>
<p>ES sẽ xây dựng chỉ mục cho tất cả các trường, sau khi xử lý, nó sẽ được ghi vào một chỉ mục đảo ngược (Inverted Index). Khi tìm kiếm dữ liệu, chỉ cần tìm kiếm chỉ mục này.</p>
<p>Vì vậy, đơn vị quản lý dữ liệu hàng đầu của ES được gọi là Index (chỉ mục). Nó tương đương với một cơ sở dữ liệu đơn lẻ. Mỗi Index (hay cơ sở dữ liệu) phải có tên viết thường.</p>
<h4>Type</h4>
<p>Mỗi chỉ mục có thể chứa một hoặc nhiều loại (type).&nbsp;<code>Type</code>&nbsp;là một phân loại logic của index.</p>
<p>Các Type khác nhau nên có cấu trúc (schema) tương tự, ví dụ, trường&nbsp;<code>id</code>&nbsp;không thể là chuỗi trong một nhóm này, trong khi là giá trị số trong một nhóm khác. Đây là một&nbsp;<a href="https://www.elastic.co/guide/en/elasticsearch/guide/current/mapping.html" target="_blank" rel="noopener noreferrer">khác biệt</a>&nbsp;so với bảng của cơ sở dữ liệu quan hệ. Dữ liệu có tính chất hoàn toàn khác nhau (như&nbsp;<code>products</code>và&nbsp;<code>logs</code>) nên được lưu trữ dưới dạng hai Index, chứ không phải là hai Type trong một Index (mặc dù có thể làm được).</p>
<blockquote>
<p>Chú ý: Theo&nbsp;<a href="https://www.elastic.co/blog/index-type-parent-child-join-now-future-in-elasticsearch" target="_blank" rel="noopener noreferrer">kế hoạch</a>, phiên bản Elastic 6.x chỉ cho phép mỗi Index chứa một Type, phiên bản 7.x sẽ hoàn toàn loại bỏ Type.</p>
</blockquote>
<h4>Document</h4>
<p>Trong mỗi Index, mỗi bản ghi được gọi là Document. Nhiều Document tạo nên một Index.</p>
<p>Mỗi&nbsp;<strong><code>tài liệu (document)</code></strong>&nbsp;là một tập hợp các trường (field).</p>
<p>Document sử dụng định dạng JSON, dưới đây là một ví dụ.</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">	"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Hung Nguyen"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">	"title"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Engineer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">	"desc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Database management"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Các Document trong cùng một Index không yêu cầu có cấu trúc (scheme) giống nhau, nhưng tốt nhất nên giữ giống nhau, điều này có lợi cho việc cải thiện hiệu suất tìm kiếm.</p>
<h4>Field</h4>
<p><strong><code>Trường (field)</code></strong>&nbsp;là cặp khóa-giá trị chứa dữ liệu.</p>
<p>Theo mặc định, Elasticsearch xây dựng chỉ mục cho tất cả dữ liệu trong mỗi trường, và mỗi trường chỉ mục có cấu trúc dữ liệu tối ưu riêng.</p>
<h4>Shard</h4>
<p>Khi một máy duy nhất không đủ để lưu trữ lượng dữ liệu lớn, Elasticsearch có thể chia dữ liệu trong một chỉ mục thành nhiều&nbsp;<strong><code>shard</code></strong>.&nbsp;<strong><code>Shard</code></strong>&nbsp;được lưu trữ trên nhiều máy chủ. Với shard, bạn có thể mở rộng theo chiều ngang, lưu trữ nhiều dữ liệu hơn, cho phép các hoạt động tìm kiếm và phân tích được phân phối trên nhiều máy chủ, cải thiện throughput và hiệu suất. Mỗi shard đều là một chỉ mục lucene.</p>
<h4>Replica</h4>
<p>Bất kỳ máy chủ nào cũng có thể gặp sự cố hoặc ngừng hoạt động bất cứ lúc nào, lúc này shard có thể bị mất, do đó, bạn có thể tạo nhiều&nbsp;<strong><code>bản sao (replica)</code></strong>&nbsp;cho mỗi shard. Bản sao có thể cung cấp dịch vụ dự phòng khi shard gặp sự cố, đảm bảo dữ liệu không bị mất, nhiều bản sao còn có thể cải thiện throughput và hiệu suất của hoạt động tìm kiếm. Shard chính (được thiết lập một lần khi tạo chỉ mục, không thể sửa đổi, mặc định là 5), shard bản sao (số lượng có thể được sửa đổi bất cứ lúc nào, mặc định là 1), mặc định mỗi chỉ mục có 10 shard, 5 shard chính, 5 shard bản sao, cấu hình cao có sẵn tối thiểu, là 2 máy chủ.</p>
<h4>ES - Khái niệm cốt lõi vs. DB - Khái niệm cốt lõi</h4>
<p>| ES       | DB               |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240223094001.png" type="image/png"/>
    </item>
    <item>
      <title>Elasticsearch REST API</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/rest-api.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/rest-api.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch REST API</source>
      <description>Elasticsearch Rest API Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu phân tán, theo phong cách RESTful, có khả năng giải quyết nhiều tình huống sử dụng mới xuất hiệ...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><strong><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a> là một công cụ tìm kiếm và phân tích dữ liệu phân tán, theo phong cách RESTful</strong>, có khả năng giải quyết nhiều tình huống sử dụng mới xuất hiện. Là trung tâm của Elastic Stack, nó lưu trữ dữ liệu tập trung của bạn, giúp bạn phát hiện những sự kiện dự kiến và không dự kiến.</p>
<p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a> được phát triển dựa trên thư viện tìm kiếm <a href="https://github.com/apache/lucene-solr" target="_blank" rel="noopener noreferrer">Lucene</a>. Elasticsearch ẩn đi sự phức tạp của Lucene, cung cấp giao diện API REST / Java dễ sử dụng (ngoài ra còn có các giao diện API bằng ngôn ngữ khác).</p>
<p><em>Dưới đây gọi tắt là ES</em>.</p>
<p>Tài liệu chi tiết nhất về REST API nên tham khảo: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/rest-apis.html" target="_blank" rel="noopener noreferrer">ES Official REST API</a></p>
</blockquote>
<h2>Cú pháp ElasticSearch Rest API</h2>
<p>Các phần thành phần của yêu cầu gửi đến Elasticsearch giống như các yêu cầu HTTP thông thường khác:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">curl</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -X</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66">VERB</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#98C379;--shiki-dark:#98C379"> '&lt;PROTOCOL&gt;://&lt;HOST&gt;:&lt;PORT&gt;/&lt;PATH&gt;?&lt;QUERY_STRING&gt;'</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -d</span><span style="color:#98C379;--shiki-dark:#98C379"> '&lt;BODY&gt;'</span></span></code></pre>
</div><ul>
<li><code>VERB</code>：Phương thức HTTP, hỗ trợ: <code>GET</code>, <code>POST</code>, <code>PUT</code>, <code>HEAD</code>, <code>DELETE</code></li>
<li><code>PROTOCOL</code>：giao thức http hoặc https (chỉ có thể sử dụng khi có proxy https phía trước Elasticsearch)</li>
<li><code>HOST</code>：tên máy chủ của bất kỳ nút nào trong cụm Elasticsearch, nếu là nút trên máy cục bộ, thì gọi là localhost</li>
<li><code>PORT</code>：cổng dịch vụ HTTP của Elasticsearch, mặc định là 9200</li>
<li><code>PATH</code>：đường dẫn API (ví dụ: <code>_count</code> sẽ trả về số lượng tài liệu trong cụm),</li>
<li><code>PATH</code>：có thể chứa nhiều thành phần, ví dụ <code>_cluster/stats</code> hoặc <code>_nodes/stats/jvm</code></li>
<li><code>QUERY_STRING</code>：một số tham số truy vấn tùy chọn, ví dụ tham số ?pretty sẽ làm cho yêu cầu trả về dữ liệu JSON dễ đọc hơn</li>
<li><code>BODY</code>：một cơ thể yêu cầu ở định dạng JSON (nếu yêu cầu cần)</li>
</ul>
<p>ElasticSearch Rest API được chia thành hai loại:</p>
<ul>
<li><strong>URI Search</strong>：sử dụng tham số truy vấn trong URL</li>
<li><strong>Request Body Search</strong>：dựa trên DSL định dạng JSON, hoàn chỉnh hơn</li>
</ul>
<p>Ví dụ về URI Search:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220530072511.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Ví dụ về Request Body Search:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220530072654.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h2>Index API</h2>
<blockquote>
<p>Tài liệu tham khảo: <a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-indices.html" target="_blank" rel="noopener noreferrer">Elasticsearch Official cat Index API</a></p>
</blockquote>
<h3>Tạo chỉ mục</h3>
<p>Để tạo mới Index, bạn có thể gửi trực tiếp yêu cầu <code>PUT</code> đến máy chủ ES.</p>
<p>Cú pháp:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /my_index</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> any</span><span style="color:#98C379;--shiki-dark:#98C379"> settings</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "mappings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "type_one"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> any</span><span style="color:#98C379;--shiki-dark:#98C379"> mappings</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "type_two"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> any</span><span style="color:#98C379;--shiki-dark:#98C379"> mappings</span><span style="color:#98C379;--shiki-dark:#98C379"> ...</span><span style="color:#98C379;--shiki-dark:#98C379"> },</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">        ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /user</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "settings"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "index"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "number_of_shards"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 3,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "number_of_replicas"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Máy chủ trả về một đối tượng JSON, trong đó trường <code>acknowledged</code> biểu thị hoạt động thành công.</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#98C379;--shiki-dark:#98C379">"acknowledged"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">"shards_acknowledged"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">"index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span><span style="color:#98C379;--shiki-dark:#98C379">"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Nếu bạn muốn vô hiệu hóa việc tạo tự động chỉ mục, bạn có thể thêm cấu hình sau vào <code>config/elasticsearch.yml</code> trong mỗi nút:</p>
<div class="language-js" data-ext="js" data-title="js"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">action</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E06C75;--shiki-dark:#E06C75">auto_create_index</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span></code></pre>
</div><h3>Xóa chỉ mục</h3>
<p>Tiếp theo, chúng ta có thể gửi yêu cầu <code>DELETE</code> để xóa chỉ mục này.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> /user</span></span></code></pre>
</div><p>Xóa nhiều chỉ mục</p>
<div class="language-js" data-ext="js" data-title="js"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">DELETE</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> /</span><span style="color:#E06C75;--shiki-dark:#E06C75">index_one</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#E06C75;--shiki-dark:#E06C75">index_two</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">DELETE</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> /</span><span style="color:#E06C75;--shiki-dark:#E06C75">index_</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">*</span></span></code></pre>
</div><h3>Xem chỉ mục</h3>
<p>Bạn có thể sử dụng yêu cầu GET để xem thông tin về chỉ mục</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem thông tin liên quan đến chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem tổng số tài liệu trong chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_count</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem 10 tài liệu đầu tiên để hiểu định dạng tài liệu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_search</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># _cat indices API</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem các chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/indices/kibana</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span><span style="color:#98C379;--shiki-dark:#98C379">?v</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">s</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">index</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem chỉ mục có trạng thái là xanh</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/indices?v</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">health</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">green</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Sắp xếp theo số lượng tài liệu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/indices?v</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">s</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">docs.count:desc</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem các trường cụ thể</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/indices/kibana</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span><span style="color:#98C379;--shiki-dark:#98C379">?pri</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">v</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">health,index,pri,rep,docs.count,mt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem bộ nhớ mà chỉ mục sử dụng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/indices?v</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">i,tm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">s</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">tm:desc</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Bí danh chỉ mục</h3>
<p>Bí danh chỉ mục trong ES chính là tên khác mà bạn đặt cho một hoặc nhiều chỉ mục. Một ứng dụng điển hình là việc chuyển mượt mà giữa các chỉ mục.</p>
<p>Đầu tiên, tạo chỉ mục my_index, sau đó đặt bí danh my_alias cho nó, ví dụ như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /my_index</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /my_index/_alias/my_alias</span></span></code></pre>
</div><p>Bạn cũng có thể thực hiện như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /_aliases</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "actions"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"add"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "index":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_index",</span><span style="color:#98C379;--shiki-dark:#98C379"> "alias":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_alias"</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Bạn cũng có thể trong một yêu cầu thêm và xóa bí danh:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /_aliases</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "actions"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"remove"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "index":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_index",</span><span style="color:#98C379;--shiki-dark:#98C379"> "alias":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_alias"</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"add"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "index":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_index_v2",</span><span style="color:#98C379;--shiki-dark:#98C379"> "alias":</span><span style="color:#98C379;--shiki-dark:#98C379"> "my_alias"</span><span style="color:#98C379;--shiki-dark:#98C379"> }}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><blockquote>
<p>Điều cần lưu ý là nếu bí danh và chỉ mục là một-đối-một, bạn có thể sử dụng bí danh để lập chỉ mục hoặc truy vấn tài liệu. Tuy nhiên, nếu bí danh và chỉ mục là một-đối-nhiều, việc sử dụng bí danh sẽ gây ra lỗi, vì ES không biết nên viết tài liệu vào chỉ mục nào hoặc đọc tài liệu từ chỉ mục nào.</p>
</blockquote>
<p>Một ứng dụng điển hình của bí danh chỉ mục ES là việc chuyển mượt mà giữa các chỉ mục. Để biết thêm chi tiết, bạn có thể xem <a href="https://www.knowledgedict.com/tutorial/elasticsearch-index-smooth-shift.html" target="_blank" rel="noopener noreferrer">Phương pháp chuyển mượt mà giữa các chỉ mục Elasticsearch (ES) mà không cần tắt máy (không cần khởi động lại)</a>.</p>
<h3>Mở/Đóng chỉ mục</h3>
<p>Bằng cách thêm <code>_close</code> hoặc <code>_open</code> vào <code>POST</code>, bạn có thể mở hoặc đóng chỉ mục.</p>
<p>Mở chỉ mục</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Mở chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_open</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Đóng chỉ mục</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_close</span></span></code></pre>
</div><h2>Tài liệu</h2>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">############Create Document############</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#create document. _id is automatically generated</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_doc</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Mike",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "post_date"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2019-04-15T14:12:12",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "message"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "trying out Kibana"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#create document. Specify Id. If id already exists, an error is returned</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_doc/1?op_type=create</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Jack",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "post_date"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2019-05-15T14:12:12",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "message"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "trying out Elasticsearch"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#create document. Specify ID. If it already exists, an error is returned</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_create/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">     "user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Jack",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "post_date"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2019-05-15T14:12:12",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "message"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "trying out Elasticsearch"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">### Get Document by ID</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Get the document by ID</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_doc/1</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">###  Index &amp; Update</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Update specified ID  (delete first, then write)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_doc/1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Mike"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#GET users/_doc/1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Add fields to the original document</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_update/1/</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "doc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "post_date"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2019-05-15T14:12:12",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "message"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "trying out Elasticsearch"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">### Delete by Id</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Delete document</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> users/_doc/1</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">### Bulk Operations</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Execute twice, check the result each time</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Execute the first time</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> _bulk</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"field1"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value1"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"delete"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"create"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test2",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "3"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"field1"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value3"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"update"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test"}</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"doc"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"field2"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value2"}</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Execute the second time</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> _bulk</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"field1"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value1"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"delete"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"create"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test2",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "3"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"field1"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value3"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"update"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test"}</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"doc"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"field2"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value2"}</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">### mget Operations</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_mget</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "docs"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Specify index in URI</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /test/_mget</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "docs"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_mget</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "docs"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> false</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"field3"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"field4"]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "3",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "include"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "exclude"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"user.location"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">### msearch Operations</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_msearch</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"match_all"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {}},"size":1}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "kibana_sample_data_flights"}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"match_all"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {}},"size":2}</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">### Clear Test Data</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#Clear data</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> users</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> test</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> test2</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Tạo tài liệu</h3>
<h4>Xác định ID</h4>
<p>Định dạng cú pháp:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /_index/_type/_create/_id</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /user/_doc/_create/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "user"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Trương Tam",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "title"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Kỹ sư",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quản lý cơ sở dữ liệu"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Xác định Id, nếu id đã tồn tại, sẽ báo lỗi</p>
</blockquote>
<h4>Tự động tạo ID</h4>
<p>Khi thêm bản ghi mới, bạn cũng có thể không xác định Id, lúc này bạn cần thay đổi yêu cầu thành POST.</p>
<p>Định dạng cú pháp:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /_index/_type</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /user/_doc</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "user"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Trương Tam",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "title"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Kỹ sư",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quản trị viên siêu cấp"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>Xóa tài liệu</h3>
<p>Định dạng cú pháp:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> /_index/_doc/_id</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">DELETE</span><span style="color:#98C379;--shiki-dark:#98C379"> /user/_doc/1</span></span></code></pre>
</div><h3>Cập nhật tài liệu</h3>
<h4>Xóa trước, sau đó viết vào</h4>
<p>Định dạng cú pháp:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /_index/_type/_id</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PUT</span><span style="color:#98C379;--shiki-dark:#98C379"> /user/_doc/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "user"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Lý Tứ",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "title"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Kỹ sư",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "desc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quản trị viên siêu cấp"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Thêm trường vào tài liệu gốc</h4>
<p>Định dạng cú pháp:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /_index/_update/_id</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> /user/_update/1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "doc"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "age"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "30"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>Truy vấn tài liệu</h3>
<h4>Truy vấn theo ID cụ thể</h4>
<p>Định dạng cú pháp:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>GET /_index/_type/_id</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /user/_doc/1</span></span></code></pre>
</div><p>Kết quả:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"_doc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_version"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_seq_no"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">536248</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_primary_term"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "found"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_source"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Trương Tam"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "title"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kỹ sư"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "desc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Quản lý cơ sở dữ liệu"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Trong dữ liệu trả về, trường <code>found</code> biểu thị truy vấn thành công, trường <code>_source</code> trả về bản gốc của bản ghi.</p>
<p>Nếu id không chính xác, dữ liệu sẽ không được tìm thấy, và trường <code>found</code> sẽ là <code>false</code></p>
<h4>Truy vấn tất cả các bản ghi</h4>
<p>Sử dụng phương thức <code>GET</code>, yêu cầu trực tiếp đến <code>/index/type/_search</code>, tất cả các bản ghi sẽ được trả về.</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> curl</span><span style="color:#98C379;--shiki-dark:#98C379"> 'localhost:9200/user/admin/_search?pretty'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "took"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "timed_out"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> false</span><span style="color:#98C379;--shiki-dark:#98C379">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "_shards"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "total"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 3,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "successful"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 3,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "skipped"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "failed"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "hits"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "total"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 2,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "max_score"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 1.0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "hits"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "user",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_type"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "admin",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "WWuoDG8BHwECs7SiYn93",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_score"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 1.0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Lý Tứ",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "title"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Kỹ sư",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "desc"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quản lý hệ thống"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "user",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_type"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "admin",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_score"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> 1.0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Trương Tam",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "title"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Kỹ sư",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">          "desc"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "Quản trị viên siêu cấp"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong kết quả trả về ở trên, trường <code>took</code> biểu thị thời gian tiêu tốn cho thao tác này (đơn vị là mili giây), trường <code>timed_out</code> biểu thị liệu có quá thời gian hay không, trường <code>hits</code> biểu thị các bản ghi đã truy vấn được, trong đó các trường con có ý nghĩa như sau.</p>
<ul>
<li><code>total</code>: số lượng bản ghi trả về, trong trường hợp này là 2.</li>
<li><code>max_score</code>: mức độ khớp cao nhất, trong trường hợp này là <code>1.0</code>.</li>
<li><code>hits</code>: mảng các bản ghi trả về.</li>
</ul>
<p>Trong các bản ghi trả về, mỗi bản ghi đều có một trường <code>_score</code>, biểu thị mức độ khớp, mặc định là được sắp xếp theo trường này theo thứ tự giảm dần.</p>
<h3>Tìm kiếm toàn văn</h3>
<p>ES sử dụng <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl.html" target="_blank" rel="noopener noreferrer">cú pháp truy vấn</a> độc đáo của chính nó, yêu cầu các yêu cầu GET đi kèm với dữ liệu.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> curl</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -H</span><span style="color:#98C379;--shiki-dark:#98C379"> 'Content-Type: application/json'</span><span style="color:#98C379;--shiki-dark:#98C379"> 'localhost:9200/user/admin/_search?pretty'</span><span style="color:#D19A66;--shiki-dark:#D19A66">  -d</span><span style="color:#98C379;--shiki-dark:#98C379"> '</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">"query" : { "match" : { "desc" : "quản lý" }}</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">}'</span></span></code></pre>
</div><p>Đoạn mã trên sử dụng <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl-match-query.html" target="_blank" rel="noopener noreferrer">Match Query</a>, với điều kiện khớp được chỉ định là trường <code>desc</code> chứa từ "quản lý". Kết quả trả về như sau.</p>
<div class="language-javascript line-numbers-mode" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "took"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "timed_out"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "total"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "successful"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "skipped"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "failed"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "hits"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "total"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "max_score"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">0.38200712</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "hits"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"admin"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"WWuoDG8BHwECs7SiYn93"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_score"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">0.38200712</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_source"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"Lý Tứ"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "title"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"Kỹ sư"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "desc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"Quản lý hệ thống"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"admin"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_score"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">0.3487891</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">        "_source"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"Trương Tam"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "title"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"Kỹ sư"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "desc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"Quản trị viên siêu cấp"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Elastic mặc định trả về 10 kết quả mỗi lần, bạn có thể thay đổi cài đặt này thông qua trường <code>size</code>, và cũng có thể chỉ định vị trí thông qua trường <code>from</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> curl</span><span style="color:#98C379;--shiki-dark:#98C379"> 'localhost:9200/user/admin/_search'</span><span style="color:#D19A66;--shiki-dark:#D19A66">  -d</span><span style="color:#98C379;--shiki-dark:#98C379"> '</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "query" : { "match" : { "desc" : "quản lý" }},</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "from": 1,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "size": 1</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">}'</span></span></code></pre>
</div><p>Đoạn mã trên chỉ định, bắt đầu từ vị trí 1 (mặc định là bắt đầu từ vị trí 0), chỉ trả về một kết quả.</p>
<h3>Phép toán logic</h3>
<p>Nếu có nhiều từ khóa tìm kiếm, Elastic coi chúng là mối quan hệ <code>or</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> curl</span><span style="color:#98C379;--shiki-dark:#98C379"> 'localhost:9200/user/admin/_search'</span><span style="color:#D19A66;--shiki-dark:#D19A66">  -d</span><span style="color:#98C379;--shiki-dark:#98C379"> '</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">"query" : { "match" : { "desc" : "phần mềm hệ thống" }}</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">}'</span></span></code></pre>
</div><p>Đoạn mã trên tìm kiếm <code>phần mềm or hệ thống</code>.</p>
<p>Nếu bạn muốn thực hiện tìm kiếm <code>and</code> với nhiều từ khóa, bạn phải sử dụng <a href="https://www.elastic.co/guide/en/elasticsearch/reference/5.5/query-dsl-bool-query.html" target="_blank" rel="noopener noreferrer">Bool Query</a>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> curl</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -H</span><span style="color:#98C379;--shiki-dark:#98C379"> 'Content-Type: application/json'</span><span style="color:#98C379;--shiki-dark:#98C379"> 'localhost:9200/user/admin/_search?pretty'</span><span style="color:#D19A66;--shiki-dark:#D19A66">  -d</span><span style="color:#98C379;--shiki-dark:#98C379"> '</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379"> "query": {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  "bool": {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">   "must": [</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    { "match": { "desc": "quản lý" } },</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    { "match": { "desc": "siêu cấp" } }</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">   ]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  }</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">}'</span></span></code></pre>
</div><h3>Thực hiện hàng loạt</h3>
<p>Hỗ trợ thực hiện các hoạt động trên các chỉ mục khác nhau trong một lần gọi API</p>
<p>Hỗ trợ bốn loại hoạt động</p>
<ul>
<li>index</li>
<li>create</li>
<li>update</li>
<li>delete</li>
</ul>
<p>Nếu một hoạt động đơn lẻ thất bại, điều này sẽ không ảnh hưởng đến các hoạt động khác.</p>
<p>Kết quả trả về bao gồm kết quả của từng hoạt động được thực hiện.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> _bulk</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"field1"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value1"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"delete"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"create"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test2",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "3"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"field1"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value3"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"update"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span><span style="color:#98C379;--shiki-dark:#98C379"> "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test"}</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"doc"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"field2"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "value2"}</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Nếu ví dụ trên được thực hiện nhiều lần, kết quả sẽ không giống nhau.</p>
</blockquote>
<h3>Đọc hàng loạt</h3>
<p>Đọc nhiều chỉ mục</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_mget</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "docs"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Đọc một chỉ mục</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /test/_mget</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "docs"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_mget</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "docs"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "1",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66"> false</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "2",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"field3"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"field4"]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "test",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_id"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "3",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">            "_source"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "include"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"user"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                "exclude"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span><span style="color:#98C379;--shiki-dark:#98C379">"user.location"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Truy vấn hàng loạt</h3>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> kibana_sample_data_ecommerce/_msearch</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"match_all"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {}},"size":1}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"index"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "kibana_sample_data_flights"}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"query"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {"match_all"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> {}},"size":2}</span></span></code></pre>
</div><h3>Tìm kiếm URI</h3>
<p>Tìm kiếm URI Elasticsearch tuân theo ngữ cảnh QueryString, dạng như sau:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=</span><span style="color:#D19A66;--shiki-dark:#D19A66">2012</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">df</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">sort</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">year:desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">from</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">size</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">timeout</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">1s</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><ul>
<li><strong><code>q</code></strong> chỉ định câu truy vấn, sử dụng ngữ cảnh QueryString</li>
<li><strong><code>df</code></strong> là trường mặc định, nếu không chỉ định</li>
<li><strong><code>sort</code></strong> sắp xếp: <code>from</code> và <code>size</code> được sử dụng cho phân trang</li>
<li><strong><code>profile</code></strong> có thể xem cách thực hiện truy vấn</li>
</ul>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:2012</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">sort</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">year:desc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">from</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">size</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">timeout</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">1s</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Term và Phrase</h4>
<p>Beautiful Mind tương đương với Beautiful OR Mind</p>
<p>"Beautiful Mind" tương đương với Beautiful AND Mind</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn Term</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:Beautiful</span><span style="color:#98C379;--shiki-dark:#98C379"> Mind</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Sử dụng dấu ngoặc kép, Truy vấn Phrase</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:"Beautiful Mind"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Nhóm và dấu ngoặc kép</h4>
<p>title:(Beautiful AND Mind)</p>
<p>title="Beautiful Mind"</p>
<h4>AND, OR, NOT hoặc &amp;&amp;, ||, !</h4>
<blockquote>
<p>Chú ý: AND, OR, NOT phải viết HOA</p>
</blockquote>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Toán tử boolean</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">Beautiful</span><span style="color:#98C379;--shiki-dark:#98C379"> AND</span><span style="color:#98C379;--shiki-dark:#98C379"> Mind</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">Beautiful</span><span style="color:#98C379;--shiki-dark:#98C379"> NOT</span><span style="color:#98C379;--shiki-dark:#98C379"> Mind</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Truy vấn phạm vi</h4>
<ul>
<li><code>[]</code> biểu thị khoảng đóng</li>
<li><code>{}</code> biểu thị khoảng mở</li>
</ul>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn phạm vi, cú pháp khoảng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:beautiful</span><span style="color:#98C379;--shiki-dark:#98C379"> AND</span><span style="color:#98C379;--shiki-dark:#98C379"> year:{</span><span style="color:#D19A66;--shiki-dark:#D19A66">2010</span><span style="color:#98C379;--shiki-dark:#98C379"> TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 2018%7D</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:beautiful</span><span style="color:#98C379;--shiki-dark:#98C379"> AND</span><span style="color:#98C379;--shiki-dark:#98C379"> year:[</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span><span style="color:#98C379;--shiki-dark:#98C379"> TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 2018]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Ký hiệu toán học</h4>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Hồ sơ sau năm 2010</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=year</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:&gt;</span><span style="color:#98C379;--shiki-dark:#98C379">2010</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Hồ sơ từ năm 2010 đến năm 2018</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=year:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(&gt;2010 &amp;&amp; &lt;</span><span style="color:#98C379;--shiki-dark:#98C379">=2018</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Hồ sơ từ năm 2010 đến năm 2018</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=year:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">+</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span><span style="color:#98C379;--shiki-dark:#98C379">2010</span><span style="color:#98C379;--shiki-dark:#98C379"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#98C379;--shiki-dark:#98C379">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">2018</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>Truy vấn dùng ký tự đại diện</h4>
<ul>
<li><code>?</code> đại diện cho 1 ký tự</li>
<li><code>*</code> đại diện cho 0 hoặc nhiều ký tự</li>
</ul>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:mi?d</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:b</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Biểu thức chính quy</h4>
<p>title:[bt]oy</p>
<h4>Kết hợp mờ và truy vấn gần đúng</h4>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Độ tương tự trong khoảng 1 ký tự</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:beautifl~1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Độ tương tự trong khoảng 2 ký tự</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /movies/_search?q=title:"Lord Rings"~2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>Request Body &amp; DSL</h3>
<p>Ngoài phương pháp tìm kiếm URI, Elasticsearch còn hỗ trợ việc gửi câu truy vấn thông qua Http Request Body.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /kibana_sample_data_ecommerce/_search?ignore_unavailable=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"true"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	  "match_all"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Phân trang</h4>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /kibana_sample_data_ecommerce/_search?ignore_unavailable=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "true",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "from"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 0,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "size"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 10,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_all"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Sắp xếp</h4>
<p>Tốt nhất là sắp xếp trên trường dạng số hoặc ngày</p>
<p>Bởi vì khi sắp xếp trên trường có nhiều giá trị hoặc đã được phân tích, hệ thống sẽ chọn một giá trị, không thể biết giá trị đó là gì</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /kibana_sample_data_ecommerce/_search?ignore_unavailable=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "true",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "sort"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "order_date"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "desc"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "from"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "size"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 10,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_all"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Lọc _source</h4>
<p>Nếu <code>_source</code> không được lưu trữ, thì chỉ trả về metadata của các tài liệu khớp</p>
<p><code>_source</code> hỗ trợ sử dụng ký tự đại diện, ví dụ: <code>_source["name*", "desc*"]</code></p>
<p>Ví dụ:</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /kibana_sample_data_ecommerce/_search?ignore_unavailable=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "true",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "_source"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "order_date"</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "category.keyword"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ],</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "from"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "size"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 10,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_all"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Trường script</h4>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /kibana_sample_data_ecommerce/_search?ignore_unavailable=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "profile"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "true",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "script_fields"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "new_field"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "script"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "lang"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "painless",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "source"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">"doc['order_date'].value+' hello'"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "from"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 1,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "size"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> 10,</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_all"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>Sử dụng biểu thức truy vấn - Match</h4>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> movies/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "title"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "last christmas"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> movies/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "title"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "last christmas",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "operator"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "and"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>Tìm kiếm cụm từ - Match Phrase</h4>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">POST</span><span style="color:#98C379;--shiki-dark:#98C379"> movies/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "match_phrase"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "title"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "last christmas"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h2>Cluster API</h2>
<blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster.html" target="_blank" rel="noopener noreferrer">Elasticsearch Official Cluster API</a></p>
</blockquote>
<p>Một số API cấp cluster có thể được thực thi trên một tập con của các node, những node này có thể được chỉ định bằng bộ lọc node. Ví dụ, các API quản lý task, thống kê node và thông tin node đều có thể báo cáo kết quả từ một nhóm các node đã lọc thay vì tất cả các node.</p>
<p>Bộ lọc node được viết dưới dạng danh sách bộ lọc đơn lẻ được phân tách bằng dấu phẩy, mỗi bộ lọc thêm hoặc loại bỏ các node từ tập con đã chọn. Mỗi bộ lọc có thể là một trong những điều sau:</p>
<ul>
<li><code>_all</code>: thêm tất cả các node vào tập con</li>
<li><code>_local</code>: thêm node cục bộ vào tập con</li>
<li><code>_master</code>: thêm node master hiện tại vào tập con</li>
<li>Thêm các node khớp theo ID node hoặc tên node vào tập con</li>
<li>Thêm các node khớp theo địa chỉ IP hoặc tên máy chủ vào tập con</li>
<li>Sử dụng ký tự đại diện, thêm các node có tên, tên địa chỉ hoặc tên máy chủ khớp vào tập con</li>
<li><code>master:true</code>, <code>data:true</code>, <code>ingest:true</code>, <code>voting_only:true</code>, <code>ml:true</code> hoặc <code>coordinating_only:true</code>, tương ứng có nghĩa là thêm tất cả các node master, tất cả các node dữ liệu, tất cả các node ingest, tất cả các node chỉ bỏ phiếu, tất cả các node machine learning và tất cả các node điều phối vào tập con.</li>
<li><code>master:false</code>, <code>data:false</code>, <code>ingest:false</code>, <code>voting_only:true</code>, <code>ml:false</code> hoặc <code>coordinating_only:false</code>, tương ứng có nghĩa là loại trừ tất cả các node master, tất cả các node dữ liệu, tất cả các node ingest, tất cả các node chỉ bỏ phiếu, tất cả các node machine learning và tất cả các node điều phối ra khỏi tập con.</li>
<li>Mô hình ghép cặp, sử dụng ký tự đại diện <code>*</code>, theo dạng <code>attrname:attrvalue</code>, thêm tất cả các node có thuộc tính node tùy chỉnh vào tập con, tên và giá trị của nó khớp với mô hình tương ứng. Thuộc tính node tùy chỉnh được thiết lập trong tệp cấu hình theo dạng <code>node.attr.attrname: attrvalue</code>.</li>
</ul>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Nếu không có bộ lọc, mặc định là truy vấn tất cả các node</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn tất cả các node</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/_all</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn node cục bộ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/_local</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn node master</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/_master</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn node theo tên (hỗ trợ ký tự đại diện)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/node_name_goes_here</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/node_name_goes_</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn node theo địa chỉ (hỗ trợ ký tự đại diện)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/10.0.0.3,10.0.0.4</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/10.0.0.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn node theo quy tắc</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/_all,master:</span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/data:</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#98C379;--shiki-dark:#98C379">,ingest:</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/coordinating_only:</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/master:</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#98C379;--shiki-dark:#98C379">,voting_only:</span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn node theo thuộc tính tùy chỉnh (ví dụ: truy vấn các node có thuộc tính node.attr.rack:2 trong tệp cấu hình)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/rack:2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/ra</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span><span style="color:#98C379;--shiki-dark:#98C379">:2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_nodes/ra</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span><span style="color:#98C379;--shiki-dark:#98C379">:2</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Cluster Health API</h3>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cluster/health</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cluster/health?level=shards</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cluster/health/kibana_sample_data_ecommerce,kibana_sample_data_flights</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cluster/health/kibana_sample_data_flights?level=shards</span></span></code></pre>
</div><h3>Cluster State API</h3>
<p>Cluster State API trả về metadata biểu thị trạng thái toàn bộ cluster.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cluster/state</span></span></code></pre>
</div><h2>Nodes API</h2>
<blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-nodes.html" target="_blank" rel="noopener noreferrer">Elasticsearch Official cat Nodes API</a> - Trả về thông tin về các node trong cluster.</p>
</blockquote>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem các trường mặc định</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/nodes?v=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem các trường chỉ định</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/nodes?v=</span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">id,ip,port,v,m</span></span></code></pre>
</div><h2>Shards API</h2>
<blockquote>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cat-shards.html" target="_blank" rel="noopener noreferrer">Elasticsearch Official cat Shards API</a> - Lệnh shards cung cấp một cái nhìn chi tiết về shard nào thuộc về node nào. Nó sẽ cho bạn biết nó là primary hay replica, số lượng tài liệu, số byte mà nó chiếm trên đĩa và node mà nó đang nằm trên.</p>
</blockquote>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem các trường mặc định</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/shards</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Truy vấn shard theo tên (hỗ trợ ký tự đại diện)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/shards/my-index-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">*</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xem các trường chỉ định</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat/shards?h=index,shard,prirep,state,unassigned.reason</span></span></code></pre>
</div><h2>Monitoring API</h2>
<p>Trong Elasticsearch, các thông tin liên quan đến sức khỏe, thống kê, v.v. của cluster đều xoay quanh <code>cat</code> API.</p>
<p>Bằng cách gửi yêu cầu GET đến cat, dưới đây là tất cả các API có sẵn:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> /_cat</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">=^</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">.</span><span style="color:#98C379;--shiki-dark:#98C379">^=</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/allocation</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/shards</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/shards/</span><span style="color:#98C379;--shiki-dark:#98C379">{index}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/master</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/nodes</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/tasks</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/indices</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/indices/</span><span style="color:#98C379;--shiki-dark:#98C379">{index}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/segments</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/segments/</span><span style="color:#98C379;--shiki-dark:#98C379">{index}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/count</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/count/</span><span style="color:#98C379;--shiki-dark:#98C379">{index}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/recovery</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/recovery/</span><span style="color:#98C379;--shiki-dark:#98C379">{index}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/health</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/pending_tasks</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/aliases</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/aliases/</span><span style="color:#98C379;--shiki-dark:#98C379">{</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">alias</span><span style="color:#98C379;--shiki-dark:#98C379">}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/thread_pool</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/thread_pool/</span><span style="color:#98C379;--shiki-dark:#98C379">{thread_pools}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/plugins</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/fielddata</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/fielddata/</span><span style="color:#98C379;--shiki-dark:#98C379">{fields}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/nodeattrs</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/repositories</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/snapshots/</span><span style="color:#98C379;--shiki-dark:#98C379">{repository}</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">/_cat/templates</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Tài liệu tham khảo</h2>
<ul>
<li><strong>Chính thức</strong>
<ul>
<li><a href="https://www.elastic.co/products/elasticsearch" target="_blank" rel="noopener noreferrer">Trang chủ Elasticsearch</a></li>
<li><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch Github</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/index.html" target="_blank" rel="noopener noreferrer">Tài liệu chính thức Elasticsearch</a></li>
</ul>
</li>
</ul>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220530072511.png" type="image/png"/>
    </item>
    <item>
      <title>Elasticsearch Sorting</title>
      <link>https://vanhung4499.github.io/database/elasticsearch/sorting.html</link>
      <guid>https://vanhung4499.github.io/database/elasticsearch/sorting.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Elasticsearch Sorting</source>
      <description>Elasticsearch Sorting Sắp xếp Elasticsearch Trong Elasticsearch, mặc định được sắp xếp theo đánh giá liên quan (_score) theo thứ tự giảm dần, hoặc có thể sắp xếp theo giá trị củ...</description>
      <category>elasticssearch</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[<p>Elasticsearch Sorting</p>
<h1>Sắp xếp Elasticsearch</h1>
<p>Trong Elasticsearch, mặc định được sắp xếp theo <strong>đánh giá liên quan (_score)</strong> theo thứ tự giảm dần, hoặc có thể sắp xếp theo <strong>giá trị của trường</strong>, <strong>sắp xếp nhiều cấp</strong>, <strong>sắp xếp trường nhiều giá trị</strong>, <strong>sắp xếp dựa trên vị trí địa lý (geo)</strong> và <strong>sắp xếp tùy chỉnh bằng script</strong>. Ngoài ra, đánh giá liên quan cũng có thể được sử dụng để đánh giá lại với rescore hai, ba lần, nó có thể giới hạn kích thước cửa sổ (window size) cho việc đánh giá lại và chỉnh sửa điểm số của các tài liệu trong phạm vi tác động, từ đó đạt được mục tiêu kiểm soát kết quả liên quan một cách tinh vi.</p>
<h2>Sắp xếp liên quan mặc định</h2>
<p>Trong Elasticsearch, mặc định, các tài liệu được sắp xếp theo thứ tự giảm dần của điểm liên quan, trường tương ứng với điểm liên quan được biểu thị bằng <code>_score</code>, đây là kiểu số thực, điểm <code>_score</code> càng cao, liên quan càng cao. Mô hình đánh giá có thể được chỉ định thông qua tham số <code>similarity</code> trong ánh xạ.</p>
<p>Thuật toán tương tự có thể được chỉ định theo trường, chỉ cần chọn trong ánh xạ cho các trường khác nhau, nếu bạn muốn chỉnh sửa thuật toán tương tự của trường hiện có, bạn chỉ có thể đạt được mục tiêu này bằng cách xây dựng lại chỉ mục cho dữ liệu. Đối với thuật toán tương tự es hơn, bạn có thể tham khảo <a href="https://www.knowledgedict.com/tutorial/elasticsearch-similarity.html" target="_blank" rel="noopener noreferrer">Sự hiểu biết sâu sắc về thuật toán tương tự es (tính điểm liên quan)</a>.</p>
<h3>Mô hình TF-IDF</h3>
<p>Trước phiên bản 5.4 của Elasticsearch, các trường kiểu text mặc định sử dụng mô hình không gian vector dựa trên tf-idf.</p>
<p>Khi bắt đầu tính điểm, Elasticsearch sử dụng tần suất của từ khóa được tìm kiếm và mức độ phổ biến của nó để ảnh hưởng đến điểm. Một giải thích ngắn gọn là, <strong>càng nhiều lần một từ khóa xuất hiện trong một tài liệu, nó càng liên quan; tuy nhiên, nếu từ khóa xuất hiện trong nhiều tài liệu khác nhau, nó càng không liên quan</strong>. Điều này được gọi là TF-IDF, TF là <strong>tần suất từ</strong> (term frequency), IDF là <strong>tần suất tài liệu nghịch đảo</strong> (inverse document frequency).</p>
<p>Cách tiếp cận chính để đánh giá một tài liệu là đếm số lần một từ khóa xuất hiện trong văn bản. Ví dụ, nếu người dùng tìm kiếm một buổi họp về Elasticsearch trong khu vực của họ, họ muốn nhóm thảo luận về Elasticsearch được hiển thị đầu tiên.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>"We will discuss Elasticsearch at the next Big Data group."</span></span>
<span class="line"><span>"Tuesday the Elasticsearch team will gather to answer questions about Elasticsearch."</span></span></code></pre>
</div><p>Câu đầu tiên đề cập đến Elasticsearch một lần, trong khi câu thứ hai đề cập đến Elasticsearch hai lần, vì vậy tài liệu chứa câu thứ hai nên có điểm số cao hơn so với tài liệu chứa câu đầu tiên. Nếu chúng ta đề cập đến số lượng, tần suất từ (TF) của câu đầu tiên là 1, trong khi tần suất từ của câu thứ hai sẽ là 2.</p>
<p>Tần suất tài liệu nghịch đảo phức tạp hơn một chút so với tần suất từ. Mô tả tuyệt vời này có nghĩa là, nếu một từ (thông thường là một từ, nhưng không nhất thiết phải là một từ) xuất hiện nhiều lần trong các tài liệu khác nhau của chỉ mục, thì nó sẽ không quan trọng. Ví dụ sau sẽ giải thích điều này một cách dễ dàng hơn.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>"We use Elasticsearch to power the search for our website."</span></span>
<span class="line"><span>"The developers like Elasticsearch so far."</span></span>
<span class="line"><span>"The scoring of documents is calculated by the scoring formula."</span></span></code></pre>
</div><p>Trong ví dụ trên, cần hiểu những điểm sau:</p>
<ul>
<li>Tần suất tài liệu của từ khóa "Elasticsearch" là 2 (vì nó xuất hiện trong hai tài liệu). Tần suất tài liệu nghịch đảo xuất phát từ việc nhân điểm với 1/DF, nơi DF là tần suất tài liệu của từ khóa. Điều này có nghĩa là, do từ khóa có tần suất tài liệu cao hơn, trọng số của nó sẽ giảm.</li>
<li>Tần suất tài liệu của từ khóa "the" là 3, vì nó xuất hiện trong tất cả ba tài liệu. Lưu ý rằng, mặc dù "the" xuất hiện hai lần trong tài liệu cuối cùng, tần suất tài liệu của nó vẫn là 3. Điều này là bởi vì tần suất tài liệu nghịch đảo chỉ kiểm tra xem một từ khóa có xuất hiện trong một tài liệu nào đó hay không, chứ không kiểm tra xem nó xuất hiện bao nhiêu lần. Điều đó nên là mối quan tâm của tần suất từ.</li>
</ul>
<p>Tần suất tài liệu nghịch đảo là một yếu tố quan trọng, được sử dụng để cân nhắc tần suất từ. Ví dụ, xem xét một người dùng tìm kiếm từ khóa "the score", từ "the" xuất hiện gần như trong mọi văn bản tiếng Anh thông thường, nếu nó không được cân nhắc, tần suất từ của từ "the" sẽ hoàn toàn che mờ tần suất từ của từ "score". Tần suất tài liệu nghịch đảo IDF cân nhắc ảnh hưởng liên quan của từ thông dụng như "the", vì vậy điểm liên quan thực tế sẽ mô tả chính xác hơn từ khóa của truy vấn.</p>
<p>Một khi tần suất từ TF và tần suất tài liệu nghịch đảo IDF đã được tính toán, bạn có thể sử dụng công thức TF-IDF để tính điểm của tài liệu.</p>
<h3>Mô hình BM25</h3>
<p>Sau phiên bản 5.4 của Elasticsearch, đối với trường kiểu text, mặc định sử dụng mô hình đánh giá BM25, không phải mô hình không gian vector dựa trên tf-idf, mô hình đánh giá có thể được chỉ định thông qua tham số <code>similarity</code> trong ánh xạ.</p>
<h2>Sắp xếp theo giá trị của trường</h2>
<p>Trong Elasticsearch, để sắp xếp theo giá trị của một trường, bạn có thể sử dụng tham số <code>sort</code>.</p>
<div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> books/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  "sort"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    "price"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">      "order"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "desc"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Kết quả trả về như sau:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "took"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">132</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "timed_out"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_shards"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "total"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "successful"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "skipped"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "failed"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "hits"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "total"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">749244</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "max_score"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "hits"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "_index"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "_type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"book"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"8456479"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "_score"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "_source"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          "id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">8456479</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          "price"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1580.00</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">          ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "sort"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">          1580.00</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      },</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">      ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Từ kết quả trả về trên, có thể thấy, <code>max_score</code> và <code>_score</code> đều trả về <code>null</code>, và trường <code>sort</code> được thêm vào, chứa giá trị của trường được sắp xếp. Việc tính toán <code>_score</code> tốn kém, nếu không sắp xếp theo mức độ liên quan, việc ghi lại <code>_score</code> không có ý nghĩa. Nếu bạn vẫn muốn tính toán <code>_score</code> dù sao, bạn có thể đặt tham số <code>track_scores</code> thành <code>true</code>.</p>
<h2>Sắp xếp nhiều trường</h2>
<p>Nếu chúng ta muốn kết hợp price, date và _score để truy vấn, và kết quả phù hợp đầu tiên được sắp xếp theo giá, sau đó được sắp xếp theo ngày, và cuối cùng được sắp xếp theo mức độ liên quan, ví dụ cụ thể như sau:</p>
<div class="language-bash line-numbers-mode" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">GET</span><span style="color:#98C379;--shiki-dark:#98C379"> books/_search</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"query"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">		"bool"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"must"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"match"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "content":</span><span style="color:#98C379;--shiki-dark:#98C379"> "java"</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"filter"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"term"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span><span style="color:#98C379;--shiki-dark:#98C379"> "user_id":</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 4868438</span><span style="color:#98C379;--shiki-dark:#98C379"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	},</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">	"sort"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [{</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"price"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"order"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "desc"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}, {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"date"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"order"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "desc"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}, {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">			"_score"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">				"order"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">:</span><span style="color:#98C379;--shiki-dark:#98C379"> "desc"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">			}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">		}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">	]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Thứ tự của các điều kiện sắp xếp rất quan trọng. Kết quả đầu tiên được sắp xếp theo điều kiện đầu tiên, chỉ khi giá trị <code>sort</code> đầu tiên của tập kết quả hoàn toàn giống nhau, kết quả mới được sắp xếp theo điều kiện thứ hai, và cứ tiếp tục như vậy.</p>
<p>Sắp xếp nhiều cấp không nhất thiết phải bao gồm <code>_score</code>. Bạn có thể sắp xếp theo một số trường khác nhau, như khoảng cách địa lý hoặc giá trị được tính toán bằng script.</p>
<h2>Sắp xếp trường có nhiều giá trị</h2>
<p>Một trường hợp là sắp xếp khi trường có nhiều giá trị, cần nhớ rằng các giá trị này không có thứ tự cố định; một trường có nhiều giá trị chỉ đơn giản là một bộ giá trị nhiều, vậy nên chọn giá trị nào để sắp xếp?</p>
<p>Đối với số hoặc ngày, bạn có thể giảm trường nhiều giá trị thành một giá trị duy nhất, điều này có thể được thực hiện bằng cách sử dụng chế độ sắp xếp <code>min</code>, <code>max</code>, <code>avg</code> hoặc <code>sum</code>. Ví dụ, bạn có thể sắp xếp theo ngày sớm nhất trong mỗi trường date, thông qua cách sau:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379">"sort"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "dates"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "order"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"asc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "mode"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:  </span><span style="color:#98C379;--shiki-dark:#98C379">"min"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h2>Sắp xếp theo khoảng cách địa lý</h2>
<p>Elasticsearch sử dụng <code>_geo_distance</code> để sắp xếp theo khoảng cách địa lý, như ví dụ sau:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "sort"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "_geo_distance"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "es_location_field"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : [</span><span style="color:#D19A66;--shiki-dark:#D19A66">116.407526</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">39.904030</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "order"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"asc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "unit"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"km"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "mode"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"min"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        "distance_type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#98C379;--shiki-dark:#98C379">"plane"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "query"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    ......</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Các tùy chọn của <code>_geo_distance</code> cụ thể như sau:</p>
<ul>
<li>Trường <code>es_location_field</code> trong ví dụ trên là tên của trường lưu trữ dữ liệu kinh độ và vĩ độ trong Elasticsearch.</li>
<li><code>order</code>: chỉ định sắp xếp theo khoảng cách tăng dần hoặc giảm dần, tương ứng với <code>asc</code> và <code>desc</code>.</li>
<li><code>unit</code>: đơn vị tính khoảng cách, mặc định là <code>m</code>, biểu thị mét (meters), các tùy chọn khác bao gồm <code>mi</code>, <code>cm</code>, <code>mm</code>, <code>NM</code>, <code>km</code>, <code>ft</code>, <code>yd</code> và <code>in</code>.</li>
<li><code>mode</code>: khi xử lý dữ liệu mảng (nhiều giá trị), chỉ định chế độ lấy giá trị, các tùy chọn bao gồm <code>min</code>, <code>max</code>, <code>sum</code>, <code>avg</code> và <code>median</code>. Khi sắp xếp theo thứ tự tăng dần, mặc định là <code>min</code>; khi sắp xếp theo thứ tự giảm dần, mặc định là <code>max</code>.</li>
<li><code>distance_type</code>: đặt cách tính toán khoảng cách, các tùy chọn bao gồm <code>sloppy_arc</code>, <code>arc</code> và <code>plane</code>. Mặc định là <code>sloppy_arc</code>. <code>arc</code> có độ chính xác tương đối cao hơn nhưng tốc độ sẽ giảm đáng kể, <code>plane</code> thì tốc độ tính toán nhanh nhưng không chính xác với khoảng cách dài.</li>
<li><code>ignore_unmapped</code>: khi gặp trường chưa được ánh xạ, có nên bỏ qua không, các tùy chọn bao gồm <code>true</code> và <code>false</code>. Mặc định là <code>false</code>, tức là nếu gặp trường chưa được ánh xạ, truy vấn sẽ gây ra ngoại lệ; nếu đặt là <code>true</code>, nó sẽ bỏ qua các trường chưa được ánh xạ và không khớp với bất kỳ tài liệu nào trong truy vấn này.</li>
<li><code>validation_method</code>: chỉ định cách kiểm tra dữ liệu kinh độ và vĩ độ, các tùy chọn bao gồm <code>IGNORE_MALFORMED</code>, <code>COERCE</code> và <code>STRICT</code>. <code>IGNORE_MALFORMED</code> cho phép chấp nhận điểm địa lý có vĩ độ hoặc kinh độ không hợp lệ, tức là bỏ qua dữ liệu; <code>COERCE</code> cố gắng đoán và chuyển đổi thành tọa độ địa lý chính xác; <code>STRICT</code> là giá trị mặc định, tức là sẽ ném ra ngoại lệ khi gặp tọa độ địa lý không chính xác.</li>
</ul>
<h2>Tài liệu tham khảo</h2>
<ul>
<li><a href="https://www.knowledgedict.com/tutorial/elasticsearch-intro.html" target="_blank" rel="noopener noreferrer">Hướng dẫn Elasticsearch</a></li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>MongoDB</title>
      <link>https://vanhung4499.github.io/database/mongodb/</link>
      <guid>https://vanhung4499.github.io/database/mongodb/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>MongoDB Aggreation</title>
      <link>https://vanhung4499.github.io/database/mongodb/aggreation.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/aggreation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Aggreation</source>
      <description>Các hoạt động tổng hợp trong MongoDB Các hoạt động tổng hợp trong MongoDB xử lý các bản ghi dữ liệu và trả về kết quả tính toán. Các hoạt động tổng hợp nhóm các giá trị từ nhiều...</description>
      <category>mongodb</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Các hoạt động tổng hợp trong MongoDB xử lý các bản ghi dữ liệu và trả về kết quả tính toán. Các hoạt động tổng hợp nhóm các giá trị từ nhiều tài liệu và có thể thực hiện các thao tác khác nhau trên dữ liệu nhóm để trả về một kết quả duy nhất. MongoDB cung cấp ba cách thực hiện hoạt động tổng hợp: Pipeline, Map-Reduce và các phương pháp tổng hợp đơn lẻ.</p>
<h2>Pipeline</h2>
<h3>Giới thiệu về Pipeline</h3>
<p>Khung tổng hợp của MongoDB được xây dựng dựa trên khái niệm của Pipeline xử lý dữ liệu.</p>
<p><strong>MongoDB hỗ trợ hoạt động tổng hợp thông qua phương thức <a href="https://docs.mongodb.com/manual/reference/method/db.collection.aggregate/#db.collection.aggregate" target="_blank" rel="noopener noreferrer"><code>db.collection.aggregate()</code></a></strong>. Ngoài ra, MongoDB cung cấp lệnh <a href="https://docs.mongodb.com/manual/reference/command/aggregate/#dbcmd.aggregate" target="_blank" rel="noopener noreferrer"><code>aggregate</code></a> để thực hiện pipeline.</p>
<p>Pipeline của MongoDB bao gồm nhiều giai đoạn (<a href="https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/#aggregation-pipeline-operator-reference" target="_blank" rel="noopener noreferrer">stages</a>). Mỗi giai đoạn sẽ chuyển đổi các tài liệu khi chúng đi qua pipeline. Một giai đoạn không cần tạo ra một tài liệu đầu ra cho mỗi tài liệu đầu vào. Ví dụ, một số giai đoạn có thể tạo ra các tài liệu mới hoặc lọc các tài liệu.</p>
<p>Cùng một giai đoạn có thể xuất hiện nhiều lần trong pipeline, trừ các giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/out/#pipe._S_out" target="_blank" rel="noopener noreferrer"><code>$out</code></a>, <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/merge/#pipe._S_merge" target="_blank" rel="noopener noreferrer"><code>$merge</code></a>, và <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/geoNear/#pipe._S_geoNear" target="_blank" rel="noopener noreferrer"><code>$geoNear</code></a>. Tất cả các giai đoạn pipeline có sẵn có thể được tham khảo tại: <a href="https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/#aggregation-pipeline-operator-reference" target="_blank" rel="noopener noreferrer">Aggregation Pipeline Stages</a>.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200921092725.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<ul>
<li>Giai đoạn đầu tiên: Giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer"><code>$match</code></a> lọc các tài liệu theo trường trạng thái và chuyển các tài liệu có trạng thái là "A" sang giai đoạn tiếp theo.</li>
<li>Giai đoạn thứ hai: Giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group" target="_blank" rel="noopener noreferrer"><code>$group</code></a> nhóm các tài liệu theo trường cust_id để tính tổng số tiền cho mỗi cust_id duy nhất.</li>
</ul>
<p>Các giai đoạn pipeline cơ bản cung cấp bộ lọc, tương tự như truy vấn, và chuyển đổi tài liệu đầu ra (thay đổi hình thức tài liệu đầu ra).</p>
<p>Các hoạt động pipeline khác cung cấp các công cụ để nhóm và sắp xếp các tài liệu theo trường cụ thể, cũng như tổng hợp nội dung của mảng (bao gồm cả mảng tài liệu). Ngoài ra, các giai đoạn pipeline có thể sử dụng các toán tử để thực hiện các nhiệm vụ như tính trung bình hoặc kết hợp chuỗi.</p>
<p>Pipeline tổng hợp cũng có thể hoạt động trên tập hợp phân đoạn.</p>
<h3>Tối ưu hóa Pipeline</h3>
<h4>Tối ưu hóa Projection</h4>
<p>Pipeline có thể xác định xem chỉ cần các trường bắt buộc trong tài liệu để có được kết quả.</p>
<h4>Tối ưu hóa tuần tự Pipeline</h4>
<p>Tối ưu hóa tuần tự (<code>$project</code>, <code>$unset</code>, <code>$addFields</code>, <code>$set</code>) + <code>$match</code></p>
<p>Đối với Pipeline có chứa các giai đoạn chiếu (<a href="https://docs.mongodb.com/manual/reference/operator/aggregation/unset/#pipe._S_unset" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 81: …gation/project/#̲pipe._S_project…" style="color:#cc0000">project](https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project) hoặc [</span>unset</a> hoặc <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/set/#pipe._S_set" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 85: …tion/addFields/#̲pipe._S_addFiel…" style="color:#cc0000">addFields](https://docs.mongodb.com/manual/reference/operator/aggregation/addFields/#pipe._S_addFields) hoặc [</span>set</a>) và theo sau là giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 77: …regation/match/#̲pipe._S_match),…" style="color:#cc0000">match](https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match), MongoDB sẽ di chuyển bộ lọc của tất cả các giai đoạn [</span>match</a> không cần thiết tính toán các giá trị trong giai đoạn chiếu, thành một giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer">$match</a> mới trước giai đoạn chiếu.</p>
<p>Nếu Pipeline chứa nhiều giai đoạn chiếu và/hoặc giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 77: …regation/match/#̲pipe._S_match),…" style="color:#cc0000">match](https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match), MongoDB sẽ thực hiện tối ưu hóa này cho mỗi giai đoạn [</span>match</a>, di chuyển bộ lọc <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer">$match</a> vào trước tất cả các giai đoạn chiếu không phụ thuộc vào nó.</p>
<p>【Ví dụ】Ví dụ tối ưu hóa tuần tự Pipeline</p>
<p>Trước tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$addFields</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    maxTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$max</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"$times"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    minTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$min</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"$times"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">} },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$project</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">times</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">maxTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">minTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    avgTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$avg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"$maxTime"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"$minTime"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">] }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">} },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Joe Schmoe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    maxTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$lt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    minTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$gt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    avgTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$gt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">} }</span></span></code></pre>
</div><p>Sau tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Joe Schmoe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$addFields</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    maxTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$max</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"$times"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    minTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$min</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"$times"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">} },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">maxTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$lt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, </span><span style="color:#E06C75;--shiki-dark:#E06C75">minTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$gt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$project</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">times</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">maxTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">minTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    avgTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$avg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"$maxTime"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"$minTime"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">] }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">} },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">avgTime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$gt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } } }</span></span></code></pre>
</div><p>Giải thích:</p>
<p><code>{ name: "Joe Schmoe" }</code> không cần tính toán bất kỳ giá trị nào trong giai đoạn chiếu, vì vậy nó có thể đặt ở đầu tiên.</p>
<p><code>{ avgTime: { $gt: 7 } }</code> phụ thuộc vào trường <code>avgTime</code> của giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project" target="_blank" rel="noopener noreferrer">$project</a>, nên không thể di chuyển.</p>
<p>Trường <code>maxTime</code> và <code>minTime</code> được phụ thuộc vào giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 85: …tion/addFields/#̲pipe._S_addFiel…" style="color:#cc0000">undefined</span>match</a> mới được tạo ra và đặt trước giai đoạn <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/project/#pipe._S_project" target="_blank" rel="noopener noreferrer">$project</a>.</p>
<h4>Tối ưu hóa song song Pipeline</h4>
<p>Nếu có thể, giai đoạn tối ưu hóa sẽ kết hợp các giai đoạn Pipeline vào giai đoạn trước đó. Thông thường, việc kết hợp xảy ra sau tối ưu hóa lại thứ tự của bất kỳ chuỗi nào.</p>
<h5><code>$sort</code> + <code>$limit</code></h5>
<p>Khi <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 75: …gregation/sort/#̲pipe._S_sort) đ…" style="color:#cc0000">sort](https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort) đứng trước [</span>limit</a> và không có giai đoạn trung gian nào thay đổi số lượng tài liệu (ví dụ: <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/group/#pipe._S_group" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 79: …egation/unwind/#̲pipe._S_unwind)…" style="color:#cc0000">unwind](https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind), [</span>group</a>), trình tối ưu hóa có thể kết hợp <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 77: …regation/limit/#̲pipe._S_limit) …" style="color:#cc0000">limit](https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit) vào [</span>sort</a>. Nếu có giai đoạn trung gian thay đổi số lượng tài liệu giữa <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 75: …gregation/sort/#̲pipe._S_sort) v…" style="color:#cc0000">sort](https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort) và [</span>limit</a>, MongoDB sẽ không kết hợp <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/sort/#pipe._S_sort" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 77: …regation/limit/#̲pipe._S_limit) …" style="color:#cc0000">limit](https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit) vào [</span>sort</a>.</p>
<p>【Ví dụ】<code>$sort</code> + <code>$limit</code></p>
<p>Trước tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$sort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : { </span><span style="color:#E06C75;--shiki-dark:#E06C75">age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$project</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : { </span><span style="color:#E06C75;--shiki-dark:#E06C75">age</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span></code></pre>
</div><p>Sau tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    "$sort"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">       "sortKey"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">          "age"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">       },</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">       "limit"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">NumberLong</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">},</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#98C379;--shiki-dark:#98C379">"$project"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">         "age"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">         "status"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">         "name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> : </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h5><code>$limit</code> + <code>$limit</code></h5>
<p>Nếu một <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 77: …regation/limit/#̲pipe._S_limit) …" style="color:#cc0000">limit](https://docs.mongodb.com/manual/reference/operator/aggregation/limit/#pipe._S_limit) ngay sau một [</span>limit</a> khác, chúng có thể được kết hợp thành một.</p>
<p>Trước tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span></code></pre>
</div><p>Sau tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  $limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h5><code>$skip</code> + <code>$skip</code></h5>
<p>Nếu một <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/skip/#pipe._S_skip" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 75: …gregation/skip/#̲pipe._S_skip) n…" style="color:#cc0000">skip](https://docs.mongodb.com/manual/reference/operator/aggregation/skip/#pipe._S_skip) ngay sau một [</span>skip</a> khác, chúng có thể được kết hợp thành một.</p>
<p>Trước tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$skip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$skip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span></code></pre>
</div><p>Sau tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  $skip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h5><code>$match</code> + <code>$match</code></h5>
<p>Nếu một <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 77: …regation/match/#̲pipe._S_match) …" style="color:#cc0000">match](https://docs.mongodb.com/manual/reference/operator/aggregation/match/#pipe._S_match) ngay sau một [</span>match</a> khác, chúng có thể được kết hợp thành một bằng <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/and/#exp._S_and" target="_blank" rel="noopener noreferrer">$and</a>.</p>
<p>Trước tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">year</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2014</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"A"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } }</span></span></code></pre>
</div><p>Sau tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  $match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    $and</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">year</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2014</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, { </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h5><code>$lookup</code> + <code>$unwind</code></h5>
<p>Nếu một <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 79: …egation/unwind/#̲pipe._S_unwind)…" style="color:#cc0000">unwind](https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind) ngay sau một [</span>lookup</a> và <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 79: …egation/unwind/#̲pipe._S_unwind)…" style="color:#cc0000">unwind](https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind) được thực hiện trên trường as của [</span>lookup</a>, trình tối ưu hóa có thể kết hợp <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/lookup/#pipe._S_lookup" target="_blank" rel="noopener noreferrer"><span v-pre="" class="katex-error" title="ParseError: KaTeX parse error: Expected 'EOF', got '#' at position 79: …egation/unwind/#̲pipe._S_unwind)…" style="color:#cc0000">unwind](https://docs.mongodb.com/manual/reference/operator/aggregation/unwind/#pipe._S_unwind) vào [</span>lookup</a> để tránh tạo ra các tài liệu trung gian lớn hơn.</p>
<p>Trước tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  $lookup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"otherCollection"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"resultingArray"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    localField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"x"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    foreignField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"y"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">},</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">$unwind</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"$resultingArray"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Sau tối ưu hóa:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  $lookup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"otherCollection"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"resultingArray"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    localField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"x"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    foreignField</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"y"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    unwinding</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">preserveNullAndEmptyArrays</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h3>Giới hạn của Pipeline</h3>
<p>Mỗi tài liệu trong tập kết quả bị giới hạn bởi kích thước tài liệu BSON (hiện tại là 16 MB).</p>
<p>Giới hạn bộ nhớ của Pipeline là 100 MB.</p>
<h2>Map-Reduce</h2>
<blockquote>
<p>Pipeline tổng hợp cung cấp hiệu suất tốt hơn và giao diện nhất quán hơn so với map-reduce.</p>
</blockquote>
<p>Map-reduce là một mô hình xử lý dữ liệu được sử dụng để tổng hợp một lượng lớn dữ liệu thành kết quả tổng hợp hữu ích. Để thực hiện thao tác map-reduce, MongoDB cung cấp lệnh cơ sở dữ liệu <a href="https://docs.mongodb.com/manual/reference/command/mapReduce/#dbcmd.mapReduce" target="_blank" rel="noopener noreferrer"><code>mapReduce</code></a>.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724012524.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Trong quá trình trên, MongoDB áp dụng giai đoạn map cho mỗi tài liệu đầu vào (tức là tài liệu trong bộ sưu tập khớp với điều kiện truy vấn). Hàm map phân phối nhiều cặp khóa-giá trị. Đối với các khóa có nhiều giá trị, MongoDB áp dụng giai đoạn reduce, giai đoạn này thu thập và tổng hợp dữ liệu tổng hợp. Sau đó, MongoDB lưu kết quả vào bộ sưu tập. Tùy chọn, đầu ra của hàm reduce có thể được tổng hợp thêm bằng hàm finalize.</p>
<p>Tất cả các hàm map-reduce trong MongoDB đều là JavaScript và chạy trong quá trình mongod. Thao tác map-reduce nhận đầu vào là tài liệu của một bộ sưu tập và có thể thực hiện bất kỳ sắp xếp và giới hạn nào trước giai đoạn map. mapReduce có thể trả về kết quả của thao tác map-reduce dưới dạng tài liệu hoặc ghi kết quả vào bộ sưu tập.</p>
<h2>Phương pháp tổng hợp đơn mục đích</h2>
<p>MongoDB hỗ trợ các phương pháp tổng hợp đơn mục đích sau đây:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.estimatedDocumentCount/#db.collection.estimatedDocumentCount" target="_blank" rel="noopener noreferrer"><code>db.collection.estimatedDocumentCount()</code></a>: Đếm ước lượng số lượng tài liệu trong một bộ sưu tập.</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.count/#db.collection.count" target="_blank" rel="noopener noreferrer"><code>db.collection.count()</code></a>: Đếm số lượng tài liệu trong một bộ sưu tập.</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.distinct/#db.collection.distinct" target="_blank" rel="noopener noreferrer"><code>db.collection.distinct()</code></a>: Lấy các giá trị duy nhất từ một trường trong một bộ sưu tập.</li>
</ul>
<p>Tất cả các thao tác này tổng hợp các tài liệu trong một bộ sưu tập duy nhất. Mặc dù các thao tác này cung cấp cách tiếp cận đơn giản cho các quy trình tổng hợp thông thường, nhưng chúng thiếu tính linh hoạt và tính năng phong phú so với pipeline tổng hợp và map-reduce.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724012551.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h2>So sánh Aggregation trong SQL và MongoDB</h2>
<p>Pipeline trong MongoDB cung cấp nhiều phép toán tương đương với các câu lệnh hoặc hàm tổng hợp phổ biến trong SQL.</p>
<p>Bảng dưới đây tóm tắt sự tương ứng giữa các câu lệnh hoặc khái niệm tổng hợp SQL phổ biến và các phép toán tổng hợp MongoDB:</p>
<p>| SQL Terms, Functions, and Concepts | MongoDB Aggregation Operators                                                                                                                                                                             |<br>
| :</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200921092725.png" type="image/png"/>
    </item>
    <item>
      <title>MongoDB CRUD Operations</title>
      <link>https://vanhung4499.github.io/database/mongodb/crud.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/crud.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB CRUD Operations</source>
      <description>Các thao tác CRUD trong MongoDB I. Các thao tác CRUD cơ bản Các thao tác CRUD trong MongoDB là các thao tác đọc và ghi dữ liệu vào tài liệu (document). Thao tác Create (Tạo) Mon...</description>
      <category>mongodb</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>I. Các thao tác CRUD cơ bản</h2>
<p>Các thao tác CRUD trong MongoDB là các thao tác đọc và ghi dữ liệu vào tài liệu (document).</p>
<h3>Thao tác Create (Tạo)</h3>
<p>MongoDB cung cấp các thao tác sau để chèn tài liệu vào một bộ sưu tập (collection):</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.insertOne/#db.collection.insertOne" target="_blank" rel="noopener noreferrer"><code>db.collection.insertOne()</code></a>: Chèn một tài liệu vào bộ sưu tập.</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.insertMany/#db.collection.insertMany" target="_blank" rel="noopener noreferrer"><code>db.collection.insertMany()</code></a>: Chèn nhiều tài liệu vào bộ sưu tập.</li>
</ul>
<blockquote>
<p>Lưu ý: Các thao tác trên đều là thao tác nguyên tử.</p>
</blockquote>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200924112342.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Đặc điểm của thao tác chèn:</p>
<ul>
<li>Tất cả các thao tác ghi trong MongoDB đều là thao tác nguyên tử cấp tài liệu duy nhất.</li>
<li>Nếu bộ sưu tập mà bạn muốn chèn không tồn tại, thì thao tác chèn sẽ tự động tạo bộ sưu tập đó.</li>
<li>Trong MongoDB, mỗi tài liệu được lưu trữ trong một bộ sưu tập cần có một trường <a href="https://docs.mongodb.com/manual/reference/glossary/#term-id" target="_blank" rel="noopener noreferrer"><code>_id</code></a> duy nhất làm khóa chính. Nếu tài liệu chèn thiếu trường <code>_id</code>, thì trình điều khiển MongoDB sẽ tự động tạo ra trường <code>_id</code> dưới dạng ObjectId.</li>
<li>Bạn có thể điều chỉnh cấp độ xác nhận của thao tác ghi trong MongoDB.</li>
</ul>
<p>【Ví dụ】Ví dụ chèn một tài liệu:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insertOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">({</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'canvas'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  tags</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'cotton'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">28</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">35.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">})</span></span></code></pre>
</div><p>【Ví dụ】Ví dụ chèn nhiều tài liệu:</p>
<div class="language-javascript line-numbers-mode" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insertMany</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'journal'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    tags</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'blank'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'red'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">14</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">21</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'mat'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    tags</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'gray'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">27.9</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">35.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'mousepad'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    tags</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">'gel'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'blue'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">19</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">22.85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Thao tác Read (Đọc)</h3>
<p>MongoDB cung cấp phương thức <a href="https://docs.mongodb.com/manual/reference/method/db.collection.find/#db.collection.find" target="_blank" rel="noopener noreferrer"><code>db.collection.find()</code></a> để truy vấn tài liệu.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200924113832.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h3>Thao tác Update (Cập nhật)</h3>
<p>MongoDB cung cấp các thao tác sau để cập nhật tài liệu trong một bộ sưu tập:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.updateOne/#db.collection.updateOne" target="_blank" rel="noopener noreferrer"><code>db.collection.updateOne()</code></a>: Cập nhật một tài liệu.</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.updateMany/#db.collection.updateMany" target="_blank" rel="noopener noreferrer"><code>db.collection.updateMany()</code></a>: Cập nhật nhiều tài liệu.</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.replaceOne/#db.collection.replaceOne" target="_blank" rel="noopener noreferrer"><code>db.collection.replaceOne()</code></a>: Thay thế một tài liệu.</li>
</ul>
<p>Cú pháp:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.updateOne/#db.collection.updateOne" target="_blank" rel="noopener noreferrer"><code>db.collection.updateOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.updateMany/#db.collection.updateMany" target="_blank" rel="noopener noreferrer"><code>db.collection.updateMany(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.replaceOne/#db.collection.replaceOne" target="_blank" rel="noopener noreferrer"><code>db.collection.replaceOne(&lt;filter&gt;, &lt;update&gt;, &lt;options&gt;)</code></a></li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200924114043.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>【Ví dụ】Chèn dữ liệu thử nghiệm:</p>
<div class="language-javascript line-numbers-mode" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insertMany</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'canvas'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">28</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">35.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'journal'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">14</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">21</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'mat'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">27.9</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">35.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'mousepad'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">19</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">22.85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'P'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'notebook'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">50</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">8.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'in'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'P'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'paper'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">8.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'in'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'D'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'planner'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">75</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">22.85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">30</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'D'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'postcard'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">45</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">15.25</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'sketchbook'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">80</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">14</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">21</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'sketch pad'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">95</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">h</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">22.85</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">30.5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">uom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【Ví dụ】Cập nhật một tài liệu:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">updateOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'paper'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    $set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#98C379;--shiki-dark:#98C379">'size.uom'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'cm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'P'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    $currentDate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">lastModified</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><p>【Ví dụ】Cập nhật nhiều tài liệu:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">updateMany</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$lt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">50</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    $set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#98C379;--shiki-dark:#98C379">'size.uom'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'in'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'P'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    $currentDate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">lastModified</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><p>【Ví dụ】Thay thế một tài liệu:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">replaceOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'paper'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'paper'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    instock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      { </span><span style="color:#E06C75;--shiki-dark:#E06C75">warehouse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'A'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">60</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      { </span><span style="color:#E06C75;--shiki-dark:#E06C75">warehouse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'B'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">qty</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">40</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><p>Đặc điểm của thao tác cập nhật:</p>
<ul>
<li>Tất cả các thao tác ghi trong MongoDB đều là thao tác nguyên tử cấp tài liệu duy nhất.</li>
<li>Một khi đã được thiết lập, không thể cập nhật hoặc thay thế trường <a href="https://docs.mongodb.com/manual/reference/glossary/#term-id" target="_blank" rel="noopener noreferrer"><code>_id</code></a>.</li>
<li>MongoDB sẽ giữ nguyên thứ tự các trường trong tài liệu sau khi thực hiện thao tác ghi, trừ khi:
<ul>
<li>Trường <code>_id</code> luôn là trường đầu tiên trong tài liệu.</li>
<li>Các thao tác cập nhật bao gồm việc đổi tên trường có thể dẫn đến sắp xếp lại các trường trong tài liệu.</li>
</ul>
</li>
<li>Nếu thao tác cập nhật chứa <code>upsert: true</code> và không có tài liệu nào khớp với bộ lọc, MongoDB sẽ chèn một tài liệu mới; nếu có tài liệu khớp, MongoDB sẽ cập nhật hoặc thay thế các tài liệu đó.</li>
</ul>
<h3>Thao tác Delete (Xóa)</h3>
<p>MongoDB cung cấp các thao tác sau để xóa tài liệu trong một bộ sưu tập:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.deleteOne/#db.collection.deleteOne" target="_blank" rel="noopener noreferrer"><code>db.collection.deleteOne()</code></a>: Xóa một tài liệu.</li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.deleteMany/#db.collection.deleteMany" target="_blank" rel="noopener noreferrer"><code>db.collection.deleteMany()</code></a>: Xóa nhiều tài liệu.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200924120007.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Đặc điểm của thao tác xóa:</p>
<ul>
<li>Tất cả các thao tác ghi trong MongoDB đều là thao tác nguyên tử cấp tài liệu duy nhất.</li>
</ul>
<h2>II. Thao tác ghi hàng loạt</h2>
<p>MongoDB hỗ trợ thao tác ghi hàng loạt (bao gồm chèn hàng loạt, cập nhật hàng loạt, xóa hàng loạt) thông qua phương thức <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite" target="_blank" rel="noopener noreferrer"><code>db.collection.bulkWrite()</code></a>.</p>
<p>Ngoài ra, phương thức <a href="https://docs.mongodb.com/manual/reference/method/db.collection.insertMany/#db.collection.insertMany" target="_blank" rel="noopener noreferrer"><code>db.collection.insertMany()</code></a> cũng hỗ trợ thao tác chèn hàng loạt.</p>
<h3>Thao tác có thứ tự và không có thứ tự</h3>
<p>Thao tác ghi hàng loạt có thể được thực hiện theo thứ tự hoặc không có thứ tự.</p>
<ul>
<li>Đối với danh sách có thứ tự, MongoDB thực hiện các thao tác theo thứ tự. Nếu có lỗi xảy ra trong quá trình xử lý thao tác ghi, MongoDB sẽ không xử lý các thao tác ghi còn lại trong danh sách.</li>
<li>Đối với danh sách không có thứ tự, MongoDB có thể thực hiện các thao tác song song, nhưng không đảm bảo hành vi này. Nếu có lỗi xảy ra trong quá trình xử lý thao tác ghi, MongoDB sẽ tiếp tục xử lý các thao tác ghi còn lại trong danh sách.</li>
</ul>
<p>Thực hiện các thao tác có thứ tự trên một tập hợp phân đoạn thường chậm hơn thực hiện các thao tác không có thứ tự, vì đối với các thao tác có thứ tự, mỗi thao tác phải chờ đợi thao tác trước hoàn thành.</p>
<p>Mặc định, <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite" target="_blank" rel="noopener noreferrer"><code>bulkWrite()</code></a> thực hiện các thao tác có thứ tự. Để chỉ định các thao tác ghi không có thứ tự, hãy đặt <code>ordered: false</code> trong tài liệu tùy chọn.</p>
<h3>Phương thức bulkWrite()</h3>
<p><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite" target="_blank" rel="noopener noreferrer"><code>bulkWrite()</code></a> hỗ trợ các thao tác ghi sau đây:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-insertone" target="_blank" rel="noopener noreferrer">insertOne</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-updateonemany" target="_blank" rel="noopener noreferrer">updateOne</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-updateonemany" target="_blank" rel="noopener noreferrer">updateMany</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-replaceone" target="_blank" rel="noopener noreferrer">replaceOne</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-deleteonemany" target="_blank" rel="noopener noreferrer">deleteOne</a></li>
<li><a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#bulkwrite-write-operations-deleteonemany" target="_blank" rel="noopener noreferrer">deleteMany</a></li>
</ul>
<p>【Ví dụ】Ví dụ về thao tác ghi hàng loạt:</p>
<div class="language-javascript line-numbers-mode" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">  db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">characters</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">bulkWrite</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      insertOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        document</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Dithras'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'barbarian'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          lvl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      insertOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        document</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Taeln'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'fighter'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">          lvl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      updateOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        filter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Eldon'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Critical Injury'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    { </span><span style="color:#E06C75;--shiki-dark:#E06C75">deleteOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">filter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Brisbane'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } } },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      replaceOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        filter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Meldane'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">        replacement</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">char</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Tanys'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'oracle'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">lvl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">      }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ])</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">} </span><span style="color:#C678DD;--shiki-dark:#C678DD">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#E06C75;--shiki-dark:#E06C75">e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">  print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E06C75;--shiki-dark:#E06C75">e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Chiến lược thao tác ghi hàng loạt</h3>
<p>Các thao tác chèn hàng loạt lớn (bao gồm chèn dữ liệu ban đầu hoặc nhập dữ liệu thường xuyên) có thể ảnh hưởng đến hiệu suất của cụm phân đoạn. Đối với thao tác chèn hàng loạt, hãy xem xét các chiến lược sau:</p>
<h4>Trước khi tách collection</h4>
<p>Nếu tập hợp phân đoạn rỗng, tập hợp đó chỉ có một phân đoạn ban đầu nằm trên một phân đoạn duy nhất. Sau đó, MongoDB phải mất một khoảng thời gian để nhận dữ liệu, tạo các phân đoạn và phân phối các phân đoạn đã tách đến các phân đoạn khả dụng. Để tránh chi phí hiệu suất này, bạn có thể tiền tách collection theo hướng dẫn về tách phân đoạn trong cụm phân đoạn.</p>
<h4>Thao tác ghi không có thứ tự</h4>
<p>Để cải thiện hiệu suất ghi vào cụm phân đoạn, hãy sử dụng <a href="https://docs.mongodb.com/manual/reference/method/db.collection.bulkWrite/#db.collection.bulkWrite" target="_blank" rel="noopener noreferrer"><code>bulkWrite()</code></a> và đặt tham số tùy chọn <code>ordered</code> thành false. <a href="https://docs.mongodb.com/manual/reference/program/mongos/#bin.mongos" target="_blank" rel="noopener noreferrer"><code>mongos</code></a> có thể cố gắng gửi các thao tác ghi đến nhiều phân đoạn cùng một lúc. Đối với tập hợp trống, hãy tiền tách collection theo hướng dẫn tách phân đoạn trong cụm phân đoạn.</p>
<h4>Tránh luồng dữ liệu đơn điệu</h4>
<p>Nếu trong một thao tác chèn, khóa phân đoạn tăng dần, tất cả dữ liệu chèn sẽ được lưu trữ trong phân đoạn cuối cùng của tập hợp, tức là chỉ lưu trữ trong một phân đoạn. Do đó, khả năng chèn của cụm sẽ không bao giờ vượt quá khả năng chèn của một phân đoạn duy nhất.</p>
<p>Nếu lượng dữ liệu chèn lớn hơn khả năng chèn của một phân đoạn duy nhất và không thể tránh được khóa phân đoạn tăng dần, hãy xem xét các sửa đổi sau đây cho ứng dụng:</p>
<ul>
<li>Đảo ngược các bit nhị phân của khóa phân đoạn. Điều này giữ nguyên thông tin và tránh liên kết thứ tự chèn với sự gia tăng giá trị.</li>
<li>Hoán đổi 16 bit đầu tiên và cuối cùng của khóa để chèn "ngẫu nhiên".</li>
</ul>
<h2>So sánh SQL và MongoDB</h2>
<h3>Thuật ngữ và Khái niệm</h3>
<p>| Thuật ngữ và Khái niệm SQL    | Thuật ngữ và Khái niệm MongoDB                                                                                                                                                                                                                         |<br>
|:</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200924112342.svg" type="image/svg+xml"/>
    </item>
    <item>
      <title>MongoDB Guide</title>
      <link>https://vanhung4499.github.io/database/mongodb/guide.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/guide.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Guide</source>
      <description>Hướng dẫn MongoDB Giới thiệu MongoDB là một cơ sở dữ liệu dựa trên hệ thống lưu trữ tệp phân tán. Được viết bằng ngôn ngữ C++. Mục tiêu là cung cấp một giải pháp lưu trữ dữ liệu...</description>
      <category>mongodb</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giới thiệu</h2>
<p>MongoDB là một cơ sở dữ liệu dựa trên hệ thống lưu trữ tệp phân tán. Được viết bằng ngôn ngữ C++. Mục tiêu là cung cấp một giải pháp lưu trữ dữ liệu có khả năng mở rộng và hiệu suất cao cho các ứng dụng web.</p>
<p>MongoDB lưu trữ dữ liệu dưới dạng tài liệu, cấu trúc dữ liệu bao gồm các cặp khóa-giá trị (key-value). Tài liệu trong MongoDB tương tự như đối tượng JSON. Giá trị của trường có thể chứa các tài liệu khác, mảng và mảng tài liệu.</p>
<h3>Phát triển của MongoDB</h3>
<ul>
<li>Phiên bản 1.x - Hỗ trợ sao chép và phân đoạn</li>
<li>Phiên bản 2.x - Các tính năng cơ sở dữ liệu phong phú hơn</li>
<li>Phiên bản 3.x - WiredTiger và hệ sinh thái xung quanh</li>
<li>Phiên bản 4.x - Hỗ trợ giao dịch phân tán</li>
</ul>
<h3>MongoDB và RDBMS</h3>
<p>| Tính năng   | MongoDB                                          | RDBMS    |<br>
|</p>
]]></content:encoded>
    </item>
    <item>
      <title>MongoDB Model Example</title>
      <link>https://vanhung4499.github.io/database/mongodb/model-example.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/model-example.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Model Example</source>
      <description>Ví dụ về mô hình hóa MongoDB Mô hình quan hệ Mô hình nhúng tài liệu một một Mô hình nhúng tài liệu một-một - Mô hình nhúng tài liệu Kết hợp thành: Mô hình nhúng tài liệu một-một...</description>
      <category>db</category>
      <category>mongodb</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Mô hình quan hệ</h2>
<h3>Mô hình nhúng tài liệu một một</h3>
<h4>Mô hình nhúng tài liệu một-một - Mô hình nhúng tài liệu</h4>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// patron document</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Joe Bookreader"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// address document</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   patron_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// reference to patron document</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   street</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"123 Fake Street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   city</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Faketon"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   state</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   zip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"12345"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Kết hợp thành:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Joe Bookreader"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "address"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"123 Fake Street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "city"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Faketon"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "state"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "zip"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"12345"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><h4>Mô hình nhúng tài liệu một-một - Mô hình con</h4>
<p>Giả sử, có một bộ sưu tập định nghĩa thông tin về phim:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "title"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"The Arrival of a Train"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "year"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1896</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "runtime"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "released"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"01-25-1896"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "poster"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"http://ia.media-imdb.com/images/M/MV5BMjEyNDk5MDYzOV5BMl5BanBnXkFtZTgwNjIxMTEwMzE@._V1_SX300.jpg"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "plot"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, ..."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "fullplot"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, the line dissolves. The doors of the railway-cars open, and people on the platform help passengers to get off."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "lastupdated"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2015-08-15T10:06:53"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"movie"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "directors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Auguste Lumière"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Louis Lumière"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "imdb"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "rating"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">7.3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "votes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5043</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">12</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "countries"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"France"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "genres"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Documentary"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Short"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "tomatoes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "viewer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "rating"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3.7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "numReviews"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">59</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "lastUpdated"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2020-01-09T00:02:53"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ứng dụng, có một số tình huống chỉ cần hiển thị thông tin tóm tắt về phim, không cần hiển thị thông tin chi tiết như fullplot, poster. Vì vậy, chúng ta có thể xem xét việc chia cấu trúc ban đầu thành hai phần và liên kết chúng thông qua trường id.</p>
<p>Bộ sưu tập movie dùng để hiển thị thông tin tóm tắt</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// movie collection</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "title"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"The Arrival of a Train"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "year"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1896</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "runtime"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "released"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"1896-01-25"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "type"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"movie"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "directors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Auguste Lumière"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Louis Lumière"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "countries"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"France"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "genres"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Documentary"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Short"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
</div><p>Bộ sưu tập movie_details dùng để hiển thị thông tin chi tiết</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// movie_details collection</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">156</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "movie_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// tham chiếu đến bộ sưu tập movie</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "poster"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"http://ia.media-imdb.com/images/M/MV5BMjEyNDk5MDYzOV5BMl5BanBnXkFtZTgwNjIxMTEwMzE@._V1_SX300.jpg"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "plot"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, ..."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "fullplot"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"A group of people are standing in a straight line along the platform of a railway station, waiting for a train, which is seen coming at some distance. When the train stops at the platform, the line dissolves. The doors of the railway-cars open, and people on the platform help passengers to get off."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "lastupdated"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2015-08-15T10:06:53"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "imdb"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "rating"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">7.3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "votes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5043</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">12</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "tomatoes"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "viewer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "rating"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3.7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "numReviews"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">59</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "lastUpdated"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2020-01-29T00:02:53"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Mô hình nhúng tài liệu một-nhiều</h3>
<h4>Mô hình nhúng tài liệu một-nhiều - Mô hình nhúng tài liệu</h4>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tài liệu patron</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Joe Bookreader"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Tài liệu địa chỉ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   patron_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// tham chiếu đến tài liệu patron</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   street</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"123 Fake Street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   city</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Faketon"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   state</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   zip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"12345"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   patron_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   street</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"1 Some Other Street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   city</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Boston"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   state</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   zip</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"12345"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kết hợp thành:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"joe"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Joe Bookreader"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "addresses"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"123 Fake Street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "city"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Faketon"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "state"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "zip"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"12345"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"1 Some Other Street"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "city"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Boston"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "state"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "zip"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"12345"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4>Mô hình nhúng tài liệu một-nhiều - Mô hình con</h4>
<p>Xem xét một bộ sưu tập đại diện cho thông tin sản phẩm trên một trang web thương mại điện tử:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Super Widget"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "description"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"This is the most useful item in your toolbox."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "price"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"value"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">NumberDecimal(</span><span style="color:#98C379;--shiki-dark:#98C379">"119.99"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"currency"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"USD"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "reviews"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">786</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"This is indeed an amazing widget."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2019-02-18"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">785</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Trina"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Nice product. Slow shipping."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2019-02-17"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    },</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    ...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Hans"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Meh, it's okay."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2017-12-06"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Các đánh giá được sắp xếp theo thứ tự thời gian giảm dần. Khi người dùng truy cập trang sản phẩm, ứng dụng sẽ tải lên mười đánh giá gần đây nhất. Thay vì lưu trữ tất cả các đánh giá cùng với thông tin sản phẩm, chúng ta có thể chia bộ sưu tập thành hai bộ sưu tập, một bộ sưu tập chứa thông tin sản phẩm và mười đánh giá gần đây nhất:</p>
<p>Bộ sưu tập sản phẩm lưu trữ thông tin về mỗi sản phẩm, bao gồm mười đánh giá gần đây nhất:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Super Widget"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "description"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"This is the most useful item in your toolbox."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "price"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"value"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">NumberDecimal(</span><span style="color:#98C379;--shiki-dark:#98C379">"119.99"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"currency"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"USD"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "reviews"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">786</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"This is indeed an amazing widget."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2019-02-18"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    ...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">776</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Pablo"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Amazing!"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">      "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2019-02-16"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Bộ sưu tập chi tiết đánh giá lưu trữ tất cả các đánh giá:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">786</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "product_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"This is indeed an amazing widget."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2019-02-18"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">785</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "product_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Trina"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Nice product. Slow shipping."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2019-02-17"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">...</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "product_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_author"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Hans"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "review_text"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Meh, it's okay."</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  "published_date"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2017-12-06"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Mô hình một-nhiều dựa trên tài liệu tham chiếu</h3>
<p>Xem xét ví dụ sau về mối quan hệ giữa nhà xuất bản và sách.</p>
<p>Ví dụ này cho thấy lợi ích của việc sử dụng tài liệu tham chiếu để tránh việc lặp lại thông tin về nhà xuất bản.</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB: The Definitive Guide"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   author</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [ </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina Chodorow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Mike Dirolf"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ],</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   published_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2010-09-24"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   pages</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">216</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   language</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"English"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   publisher</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">              name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"O'Reilly Media"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">              founded</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1980</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">              location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"CA"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"50 Tips and Tricks for MongoDB Developer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   author</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina Chodorow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   published_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2011-05-06"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   pages</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">68</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   language</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"English"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   publisher</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: {</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">              name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"O'Reilly Media"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">              founded</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1980</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">              location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"CA"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Để tránh việc lặp lại thông tin về nhà xuất bản, chúng ta có thể sử dụng tài liệu tham chiếu và lưu trữ thông tin về nhà xuất bản riêng biệt khỏi sách. Khi sử dụng tham chiếu, cách mà mối quan hệ tăng lên sẽ quyết định nơi lưu trữ tham chiếu. Nếu số lượng sách của mỗi nhà xuất bản ít và tăng trưởng có giới hạn, đôi khi việc lưu trữ tham chiếu sách trong tài liệu nhà xuất bản có thể hữu ích. Ngược lại, nếu số lượng sách của mỗi nhà xuất bản không bị giới hạn, mô hình dữ liệu này sẽ dẫn đến một mảng không đổi và không ngừng tăng, như ví dụ dưới đây:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"O'Reilly Media"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   founded</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1980</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"CA"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   books</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#D19A66;--shiki-dark:#D19A66">123456789</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">234567890</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">123456789</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB: The Definitive Guide"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    author</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [ </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina Chodorow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Mike Dirolf"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ],</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    published_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2010-09-24"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    pages</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">216</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">    language</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"English"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">234567890</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"50 Tips and Tricks for MongoDB Developer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   author</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina Chodorow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   published_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2011-05-06"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   pages</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">68</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   language</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"English"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Để tránh mảng không đổi và không ngừng tăng, hãy lưu trữ tham chiếu đến nhà xuất bản trong tài liệu sách:</p>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"oreilly"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"O'Reilly Media"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   founded</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1980</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   location</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"CA"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">123456789</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB: The Definitive Guide"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   author</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [ </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina Chodorow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Mike Dirolf"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ],</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   published_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2010-09-24"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   pages</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">216</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   language</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"English"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   publisher_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"oreilly"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   _id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">234567890</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"50 Tips and Tricks for MongoDB Developer"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   author</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Kristina Chodorow"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   published_date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">ISODate(</span><span style="color:#98C379;--shiki-dark:#98C379">"2011-05-06"</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   pages</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">68</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   language</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"English"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">   publisher_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"oreilly"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2>Mô hình cây có cấu trúc</h2>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200911194846.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h3>Mô hình cây có cấu trúc với nút cha</h3>
<p>Cấu trúc trên có thể được biểu diễn bằng cách sử dụng tham chiếu cha:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.insertMany([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"dbm"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Languages"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
</div><ul>
<li>
<p>Truy vấn nút cha của một nút:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.findOne( { _id: "MongoDB" } ).parent</span></span></code></pre>
</div></li>
<li>
<p>Có thể tạo chỉ mục trên trường cha để tìm kiếm nhanh nút cha:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.createIndex( { parent: 1 } )</span></span></code></pre>
</div></li>
<li>
<p>Có thể tìm thấy các nút con trực tiếp thông qua truy vấn trường cha:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.find( { parent: "Databases" } )</span></span></code></pre>
</div></li>
<li>
<p>Để truy vấn cây con, bạn có thể tham khảo: <a href="https://docs.mongodb.com/manual/reference/operator/aggregation/graphLookup/#pipe._S_graphLookup" target="_blank" rel="noopener noreferrer"><code>$graphLookup</code></a>.</p>
</li>
</ul>
<h3>Mô hình cây có cấu trúc với nút con</h3>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.insertMany([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"children"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [] },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"dbm"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"children"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [] },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"children"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"dbm"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">] },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Languages"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"children"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [] },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"children"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Languages"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">] },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"children"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">] }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
</div><ul>
<li>
<p>Truy vấn các nút con của một nút:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.findOne( { _id: "Databases" } ).children</span></span></code></pre>
</div></li>
<li>
<p>Có thể tạo chỉ mục trên trường children để tìm kiếm nhanh các nút con:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.createIndex( { children: 1 } )</span></span></code></pre>
</div></li>
<li>
<p>Có thể truy vấn các nút thông qua trường children để tìm kiếm nút cha và các nút anh em:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.find( { children: "MongoDB" } )</span></span></code></pre>
</div></li>
</ul>
<h3>Mô hình cây có cấu trúc với tổ tiên</h3>
<div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.insertMany([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"dbm"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Languages"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">],</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">    "parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [</span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">], </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: [], </span><span style="color:#E06C75;--shiki-dark:#E06C75">"parent"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul>
<li>
<p>Truy vấn tổ tiên của một nút hoặc đường dẫn là nhanh chóng và trực tiếp:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.findOne({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }).ancestors</span></span></code></pre>
</div></li>
<li>
<p>Có thể tạo chỉ mục trên trường ancestors để tìm kiếm nhanh các nút tổ tiên:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.createIndex({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">"ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> })</span></span></code></pre>
</div></li>
<li>
<p>Có thể truy vấn tất cả các con cháu của một nút thông qua trường ancestors:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.find({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">"ancestors"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> })</span></span></code></pre>
</div></li>
</ul>
<h3>Mô hình cây có đường dẫn cụ thể</h3>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">db.categories.insertMany([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Books"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"path"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Programming"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"path"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">",Books,"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Databases"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"path"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">",Books,Programming,"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"Languages"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"path"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">",Books,Programming,"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"MongoDB"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"path"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">",Books,Programming,Databases,"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"_id"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">"dbm"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">"path"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">",Books,Programming,Databases,"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
</div><ul>
<li>
<p>Có thể truy vấn để lấy toàn bộ cây và sắp xếp theo trường đường dẫn:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.find().sort( { path: 1 } )</span></span></code></pre>
</div></li>
<li>
<p>Có thể sử dụng biểu thức chính quy trên trường path để tìm kiếm các con cháu của Programming:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.find( { path: /,Programming,/ } )</span></span></code></pre>
</div></li>
<li>
<p>Có thể truy vấn các con cháu của Books, trong đó Books cũng nằm ở cấp cao nhất của cấu trúc:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.find( { path: /^,Books,/ } )</span></span></code></pre>
</div></li>
<li>
<p>Để tạo chỉ mục trên trường path, hãy sử dụng lệnh sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>db.categories.createIndex( { path: 1 } )</span></span></code></pre>
</div></li>
</ul>
<h3>Mô hình cây có tập hợp lồng nhau</h3>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200911204252.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">categories</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insertMany</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">([</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Books'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">12</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Programming'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Books'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Languages'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Programming'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Databases'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Programming'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'MongoDB'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Databases'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  { </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'dbm'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Databases'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">8</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">9</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">])</span></span></code></pre>
</div><p>Có thể truy vấn để lấy các con cháu của một nút:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">var</span><span style="color:#E06C75;--shiki-dark:#E06C75"> databaseCategory</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">categories</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">findOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">_id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'Databases'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> })</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">categories</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">find</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">({</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$gt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">databaseCategory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E06C75;--shiki-dark:#E06C75">left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> },</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">  right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">$lt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#E5C07B;--shiki-dark:#E5C07B">databaseCategory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E06C75;--shiki-dark:#E06C75">right</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">})</span></span></code></pre>
</div><h2>Mẫu thiết kế</h2>
<h3>Tài liệu lớn, nhiều cột, nhiều chỉ mục</h3>
<p>Giải pháp là: Chuyển đổi từ cột sang hàng</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200919225901.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h3>Quản lý các phiên bản tài liệu khác nhau</h3>
<p>Định dạng tài liệu MongoDB rất linh hoạt, điều này có thể gây khó khăn trong việc duy trì các phiên bản.</p>
<p>Giải pháp là: Có thể thêm một trường số phiên bản</p>
<ul>
<li>Nhanh chóng lọc bỏ các tài liệu không cần nâng cấp</li>
<li>Khi nâng cấp, xử lý khác nhau cho các tài liệu có phiên bản khác nhau</li>
</ul>
<h3>Thống kê lượt nhấp vào trang web</h3>
<p>Yêu cầu độ chính xác của dữ liệu thống kê không quá quan trọng.</p>
<p>Giải pháp: Sử dụng tính toán gần đúng</p>
<p>Ghi lại sau mỗi 10 lần nhấp:</p>
<div class="language-json" data-ext="json" data-title="json"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">{ </span><span style="color:#E06C75;--shiki-dark:#E06C75">"$inc"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">"views"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } }</span></span></code></pre>
</div><h3>Thống kê chính xác</h3>
<p>Giải pháp: Sử dụng tổng hợp trước</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200911194846.svg" type="image/svg+xml"/>
    </item>
    <item>
      <title>MongoDB Modeling</title>
      <link>https://vanhung4499.github.io/database/mongodb/modeling.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/modeling.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Modeling</source>
      <description>Mô hình hóa MongoDB Mô hình dữ liệu của MongoDB là một mô hình linh hoạt, trong khi cơ sở dữ liệu quan hệ yêu cầu bạn định nghĩa cấu trúc mô hình bảng trước khi chèn dữ liệu. Tu...</description>
      <category>mongodb</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Mô hình dữ liệu của MongoDB là một mô hình linh hoạt, trong khi cơ sở dữ liệu quan hệ yêu cầu bạn định nghĩa cấu trúc mô hình bảng trước khi chèn dữ liệu. Tuy nhiên, trong MongoDB, tài liệu không giới hạn cấu trúc. Điều này giúp dễ dàng ánh xạ giữa đối tượng và tài liệu cơ sở dữ liệu. Ngay cả khi có sự thay đổi lớn giữa các bản ghi dữ liệu, mỗi tài liệu vẫn có thể ánh xạ tốt vào các bản ghi khác nhau. Tuy nhiên, trong thực tế, các tài liệu trong cùng một bộ sưu tập thường có cấu trúc tương tự nhau.</p>
<p>Việc thiết kế mô hình dữ liệu là một quá trình đầy thách thức, đòi hỏi cân nhắc và cân nhắc giữa yêu cầu ứng dụng, hiệu suất của cơ sở dữ liệu và mô hình đọc/ghi dữ liệu. Khi thiết kế mô hình dữ liệu, hãy cân nhắc yêu cầu ứng dụng với mô hình sử dụng dữ liệu (như truy vấn, cập nhật và xử lý) cũng như cấu trúc tự nhiên của dữ liệu.</p>
<h2>Nhập môn mô hình hoá dữ liệu MongoDB</h2>
<blockquote>
<p>Tham khảo: <a href="https://docs.mongodb.com/guides/server/introduction/#what-you-ll-need" target="_blank" rel="noopener noreferrer">https://docs.mongodb.com/guides/server/introduction/#what-you-ll-need</a></p>
</blockquote>
<h3>(1) Xác định tập dữ liệu</h3>
<p>Khi cần tạo lưu trữ dữ liệu, trước hết cần đặt câu hỏi: Dữ liệu nào cần được lưu trữ? Các trường này liên quan như thế nào?</p>
<p>Đây là quá trình thiết kế dữ liệu. Mục tiêu là <strong>trừu tượng hóa yêu cầu kinh doanh thành mô hình logic</strong>.</p>
<p>Giả sử có một tình huống như sau: Chúng ta cần xây dựng cơ sở dữ liệu để theo dõi vật liệu và số lượng, kích thước, nhãn hiệu và xếp hạng của chúng.</p>
<p>Nếu lưu trữ trong RDBMS, có thể có bảng dữ liệu như sau:</p>
<p>| name     | quantity | size        | status | tags                     | rating |<br>
| :</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200910193231.png" type="image/png"/>
    </item>
    <item>
      <title>MongoDB Index</title>
      <link>https://vanhung4499.github.io/database/mongodb/mongo-index.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/mongo-index.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Index</source>
      <description>MongoDB Index Giới thiệu về Index trong MongoDB Tác dụng của Index MongoDB định nghĩa các chỉ mục trên cấp dữ liệu của collection. Chỉ mục thường có thể cải thiện đáng kể hiệu s...</description>
      <category>mongodb</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giới thiệu về Index trong MongoDB</h2>
<h3>Tác dụng của Index</h3>
<p><strong>MongoDB định nghĩa các chỉ mục trên cấp dữ liệu của collection</strong>.</p>
<p>Chỉ mục thường có thể cải thiện đáng kể hiệu suất của truy vấn. Nếu <strong>không có chỉ mục</strong>, MongoDB sẽ phải quét qua từng tài liệu trong collection và chọn ra những bản ghi phù hợp với điều kiện truy vấn.</p>
<p>Việc quét toàn bộ collection như vậy là không hiệu quả, đặc biệt khi xử lý lượng dữ liệu lớn. Truy vấn có thể mất vài chục giây hoặc thậm chí vài phút, điều này là không chấp nhận được về hiệu suất.</p>
<p>Chỉ mục là một cấu trúc dữ liệu đặc biệt, được lưu trữ trong một tập hợp dữ liệu dễ dàng duyệt và đọc. Chỉ mục sắp xếp các giá trị của một cột hoặc nhiều cột trong bảng cơ sở dữ liệu.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200921210621.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h3>Phương thức createIndex()</h3>
<p><strong>MongoDB sử dụng phương thức <code>createIndex()</code> để tạo chỉ mục</strong>.</p>
<p>Cú pháp của <code>createIndex()</code> như sau:</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">collection</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">createIndex</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">( &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">key</span><span style="color:#D19A66;--shiki-dark:#D19A66;font-style:italic;--shiki-dark-font-style:italic"> and</span><span style="color:#D19A66;--shiki-dark:#D19A66;font-style:italic;--shiki-dark-font-style:italic"> index</span><span style="color:#D19A66;--shiki-dark:#D19A66;font-style:italic;--shiki-dark-font-style:italic"> type</span><span style="color:#D19A66;--shiki-dark:#D19A66;font-style:italic;--shiki-dark-font-style:italic"> specification</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;, &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75">options</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; )</span></span></code></pre>
</div><p>Danh sách các tham số tùy chọn của <code>createIndex()</code> như sau:</p>
<p>| Tham số            | Kiểu dữ liệu | Mô tả                                                                                                                                           |<br>
| :</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200921210621.svg" type="image/svg+xml"/>
    </item>
    <item>
      <title>MongoDB Operation</title>
      <link>https://vanhung4499.github.io/database/mongodb/operation.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/operation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Operation</source>
      <description>Vận hành MongoDB Cài đặt MongoDB Windows (1) Tải xuống và giải nén Truy cập vào trang web chính thức để tải xuống MongoDB và chọn phiên bản phù hợp tại: Download MongoDB Communi...</description>
      <category>mongodb</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Cài đặt MongoDB</h2>
<h3>Windows</h3>
<p>(1) Tải xuống và giải nén</p>
<p>Truy cập vào trang web chính thức để tải xuống MongoDB và chọn phiên bản phù hợp tại: <a href="https://www.mongodb.com/try/download/community" target="_blank" rel="noopener noreferrer">Download MongoDB Community Server | MongoDB</a></p>
<p>(2) Tạo thư mục dữ liệu</p>
<p>MongoDB lưu trữ dữ liệu trong thư mục db. Tuy nhiên, thư mục này không được tự động tạo ra, chúng ta cần tạo nó sau khi cài đặt.</p>
<p>Ví dụ: <code>D:\Tools\Server\mongodb\mongodb-4.4.0\data\db</code></p>
<p>(3) Chạy dịch vụ MongoDB</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mongod</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --dbpath</span><span style="color:#98C379;--shiki-dark:#98C379"> D:</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\T</span><span style="color:#98C379;--shiki-dark:#98C379">ools</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\S</span><span style="color:#98C379;--shiki-dark:#98C379">erver</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\m</span><span style="color:#98C379;--shiki-dark:#98C379">ongodb</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\m</span><span style="color:#98C379;--shiki-dark:#98C379">ongodb-4.4.0</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\d</span><span style="color:#98C379;--shiki-dark:#98C379">ata</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">\d</span><span style="color:#98C379;--shiki-dark:#98C379">b</span></span></code></pre>
</div><p>(4) Kết nối với MongoDB từ máy khách</p>
<p>Bạn có thể kết nối với MongoDB bằng cách chạy lệnh <code>mongo.exe</code> trong cửa sổ dòng lệnh.</p>
<p>(5) Cấu hình dịch vụ MongoDB</p>
<h3>Linux</h3>
<p>(1) Cài đặt bằng gói cài đặt</p>
<p>Trước khi cài đặt, chúng ta cần cài đặt các gói phụ thuộc cho các nền tảng Linux.</p>
<p><strong>Red Hat/CentOS:</strong></p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>sudo yum install libcurl openssl</span></span></code></pre>
</div><p><strong>Ubuntu 18.04 LTS ("Bionic")/Debian 10 "Buster":</strong></p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>sudo apt-get install libcurl4 openssl</span></span></code></pre>
</div><p><strong>Ubuntu 16.04 LTS ("Xenial")/Debian 9 "Stretch":</strong></p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>sudo apt-get install libcurl3 openssl</span></span></code></pre>
</div><p>(2) Tạo thư mục dữ liệu</p>
<p>Mặc định, MongoDB sẽ khởi tạo hai thư mục sau khi khởi động:</p>
<ul>
<li>Thư mục lưu trữ dữ liệu: /var/lib/mongodb</li>
<li>Thư mục ghi nhật ký: /var/log/mongodb</li>
</ul>
<p>Trước khi khởi động, chúng ta có thể tạo hai thư mục này và đặt quyền đọc và ghi cho người dùng hiện tại:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sudo</span><span style="color:#98C379;--shiki-dark:#98C379"> mkdir</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span><span style="color:#98C379;--shiki-dark:#98C379"> /var/lib/mongo</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sudo</span><span style="color:#98C379;--shiki-dark:#98C379"> mkdir</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span><span style="color:#98C379;--shiki-dark:#98C379"> /var/log/mongodb</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sudo</span><span style="color:#98C379;--shiki-dark:#98C379"> chown</span><span style="color:#98C379;--shiki-dark:#98C379"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">whoami</span><span style="color:#98C379;--shiki-dark:#98C379">`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> /var/lib/mongo</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">     # Đặt quyền</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sudo</span><span style="color:#98C379;--shiki-dark:#98C379"> chown</span><span style="color:#98C379;--shiki-dark:#98C379"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">whoami</span><span style="color:#98C379;--shiki-dark:#98C379">`</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> /var/log/mongodb</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">   # Đặt quyền</span></span></code></pre>
</div><p>(3) Chạy dịch vụ MongoDB</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mongod</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --dbpath</span><span style="color:#98C379;--shiki-dark:#98C379"> /var/lib/mongo</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --logpath</span><span style="color:#98C379;--shiki-dark:#98C379"> /var/log/mongodb/mongod.log</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --fork</span></span></code></pre>
</div><p>Mở tệp /var/log/mongodb/mongod.log và kiểm tra thông tin sau, nếu xuất hiện, điều đó có nghĩa là khởi động thành công.</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># tail -10f /var/log/mongodb/mongod.log</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2020-07-09T12:20:17.391+0800</span><span style="color:#98C379;--shiki-dark:#98C379"> I</span><span style="color:#98C379;--shiki-dark:#98C379">  NETWORK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  [listener] Listening on /tmp/mongodb-27017.sock</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2020-07-09T12:20:17.392+0800</span><span style="color:#98C379;--shiki-dark:#98C379"> I</span><span style="color:#98C379;--shiki-dark:#98C379">  NETWORK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  [listener] Listening on 127.0.0.1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2020-07-09T12:20:17.392+0800</span><span style="color:#98C379;--shiki-dark:#98C379"> I</span><span style="color:#98C379;--shiki-dark:#98C379">  NETWORK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  [listener] waiting </span><span style="color:#C678DD;--shiki-dark:#C678DD">for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> connections on port </span><span style="color:#D19A66;--shiki-dark:#D19A66">27017</span></span></code></pre>
</div><p>(4) Kết nối với MongoDB từ máy khách</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">cd</span><span style="color:#98C379;--shiki-dark:#98C379"> /usr/local/mongodb4/bin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./mongo</span></span></code></pre>
</div><h3>Thiết lập tên người dùng và mật khẩu</h3>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; use admin</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">chuyển</span><span style="color:#98C379;--shiki-dark:#98C379"> sang</span><span style="color:#98C379;--shiki-dark:#98C379"> db</span><span style="color:#98C379;--shiki-dark:#98C379"> admin</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; db.createUser({"user":"root","pwd":"root","roles":[{"role":"userAdminAnyDatabase","db":"admin"}]})</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Thêm</span><span style="color:#98C379;--shiki-dark:#98C379"> người</span><span style="color:#98C379;--shiki-dark:#98C379"> dùng</span><span style="color:#98C379;--shiki-dark:#98C379"> thành</span><span style="color:#98C379;--shiki-dark:#98C379"> công:</span><span style="color:#98C379;--shiki-dark:#98C379"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "user"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "root",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        "roles"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                        "role"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "userAdminAnyDatabase",</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">                        "db"</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> "admin"</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        ]</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span></code></pre>
</div><h2>Sao lưu và khôi phục dữ liệu</h2>
<h3>Sao lưu dữ liệu</h3>
<p>Trong MongoDB, chúng ta sử dụng lệnh <code>mongodump</code> để sao lưu dữ liệu MongoDB. Lệnh này cho phép xuất tất cả dữ liệu vào một thư mục được chỉ định.</p>
<p>Cú pháp lệnh <code>mongodump</code> như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>mongodump -h dbhost -d dbname -o dbdirectory</span></span></code></pre>
</div><ul>
<li>-h: Địa chỉ máy chủ MongoDB, ví dụ: 127.0.0.1, cũng có thể chỉ định cổng: 127.0.0.1:27017.</li>
<li>-d: Tên cơ sở dữ liệu cần sao lưu, ví dụ: test.</li>
<li>-o: Đường dẫn lưu trữ dữ liệu sao lưu, ví dụ: c:\data\dump. Trước khi sao lưu, thư mục này cần được tạo trước. Sau khi sao lưu hoàn tất, MongoDB sẽ tự động tạo một thư mục test trong thư mục dump, chứa dữ liệu sao lưu của cơ sở dữ liệu đó.</li>
</ul>
<p>Các tham số tùy chọn cho lệnh <code>mongodump</code> như sau:</p>
<p>| Cú pháp                                              | Mô tả                           | Ví dụ                                             |<br>
| :</p>
]]></content:encoded>
    </item>
    <item>
      <title>MongoDB Overview</title>
      <link>https://vanhung4499.github.io/database/mongodb/overview.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/overview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Overview</source>
      <description>MongoDB MOC MongoDB là một cơ sở dữ liệu phân tán dựa trên tài liệu, được viết bằng ngôn ngữ C++. Nó nhằm mục đích cung cấp một giải pháp lưu trữ dữ liệu có hiệu suất cao và có ...</description>
      <category>mongodb</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>MongoDB là một cơ sở dữ liệu phân tán dựa trên tài liệu, được viết bằng ngôn ngữ C++. Nó nhằm mục đích cung cấp một giải pháp lưu trữ dữ liệu có hiệu suất cao và có khả năng mở rộng cho các ứng dụng web.</p>
<p>MongoDB là một sản phẩm nằm giữa cơ sở dữ liệu quan hệ và cơ sở dữ liệu phi quan hệ. Nó là cơ sở dữ liệu phi quan hệ có tính năng phong phú nhất và giống nhất với cơ sở dữ liệu quan hệ. Nó hỗ trợ cấu trúc dữ liệu rất linh hoạt, sử dụng định dạng bson tương tự như json, do đó có thể lưu trữ các loại dữ liệu phức tạp.</p>
<p>Điểm đặc biệt lớn nhất của MongoDB là ngôn ngữ truy vấn mạnh mẽ mà nó hỗ trợ. Cú pháp của nó tương tự như ngôn ngữ truy vấn hướng đối tượng, gần như có thể thực hiện hầu hết các chức năng truy vấn của cơ sở dữ liệu quan hệ trên một bảng duy nhất, và còn hỗ trợ tạo chỉ mục cho dữ liệu.</p>
</blockquote>
<h2>📖 Contents</h2>
]]></content:encoded>
    </item>
    <item>
      <title>MongoDB Replication</title>
      <link>https://vanhung4499.github.io/database/mongodb/replication.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/replication.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Replication</source>
      <description>Sao lưu trong MongoDB Sao lưu có thể cung cấp tính sẵn có dự phòng và tăng cường khả năng sẵn có của dữ liệu. Sử dụng nhiều bản sao dữ liệu trên các máy chủ cơ sở dữ liệu khác n...</description>
      <category>db</category>
      <category>mongodb</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Sao lưu có thể <strong>cung cấp tính sẵn có dự phòng và tăng cường khả năng sẵn có của dữ liệu</strong>. Sử dụng nhiều bản sao dữ liệu trên các máy chủ cơ sở dữ liệu khác nhau có thể cung cấp khả năng chống lỗi trong trường hợp một máy chủ cơ sở dữ liệu bị sự cố và dữ liệu bị mất.</p>
<p>Trong một số trường hợp, sao lưu cũng có thể <strong>cung cấp khả năng xử lý đọc lớn hơn</strong>. Vì khách hàng có thể gửi các hoạt động đọc đến các máy chủ khác nhau. Việc duy trì các bản sao dữ liệu trên các trung tâm dữ liệu khác nhau cũng có thể cải thiện tính cục bộ của dữ liệu và khả năng sẵn có của ứng dụng phân tán. Bạn cũng có thể duy trì các bản sao khác nhau cho mục đích đặc biệt như phục hồi sau thảm họa, báo cáo hoặc sao lưu.</p>
<h2>Bản sao dữ liệu MongoDB</h2>
<p>Bản sao dữ liệu trong MongoDB là một nhóm quy trình mongod duy trì cùng một tập hợp dữ liệu. Một bản sao dữ liệu bao gồm nhiều thành viên dữ liệu và một thành viên trọng tâm (tùy chọn). Trong các thành viên dữ liệu, chỉ có một thành viên được coi là chính và các thành viên khác được coi là phụ.</p>
<p><strong>Thành viên chính chịu trách nhiệm nhận tất cả các hoạt động ghi</strong>. Một bản sao dữ liệu chỉ có thể có một thành viên chính và có thể xác nhận rằng các hoạt động ghi trên các nút trong cụm bằng cách sử dụng <a href="https://docs.mongodb.com/manual/reference/write-concern/#writeconcern.%22majority%22" target="_blank" rel="noopener noreferrer"><code>{ w: "majority" }</code></a>.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920165054.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p><strong>Các thành viên phụ sao chép nhật ký hoạt động của thành viên chính và áp dụng các hoạt động này vào tập dữ liệu của mình</strong> để đồng bộ dữ liệu với thành viên chính. Nếu thành viên chính không khả dụng, một thành viên phụ đủ điều kiện sẽ được bầu làm thành viên chính mới.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920165055.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Trong một số trường hợp (ví dụ: chỉ có một thành viên chính và một thành viên phụ do hạn chế về chi phí), bạn có thể chọn thêm một quy trình mongod làm thành viên trọng tâm trong bản sao dữ liệu. Thành viên trọng tâm tham gia vào quá trình bầu cử nhưng không lưu trữ dữ liệu (không cung cấp dự phòng dữ liệu).</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920165053.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Thành viên trọng tâm luôn là thành viên trọng tâm. Trong quá trình bầu cử, thành viên chính có thể bị giáng cấp thành thành viên phụ và thành viên phụ có thể được thăng cấp thành thành viên chính.</p>
<h2>Sao lưu không đồng bộ</h2>
<h3>Hoạt động chậm</h3>
<p>Các thành viên phụ sao chép nhật ký hoạt động của thành viên chính và áp dụng các hoạt động này vào tập dữ liệu của mình. Bằng cách đồng bộ hóa dữ liệu từ thành viên chính, ngay cả khi một hoặc nhiều thành viên gặp sự cố, bản sao dữ liệu (cụm MongoDB) vẫn có thể tiếp tục hoạt động.</p>
<p>Từ phiên bản 4.2 trở đi, các thành viên phụ trong bản sao dữ liệu ghi lại các hoạt động chậm (thời gian hoạt động dài hơn ngưỡng được đặt). Những hoạt động chậm này được ghi lại trong <a href="https://docs.mongodb.com/manual/reference/program/mongod/#cmdoption-mongod-logpath" target="_blank" rel="noopener noreferrer">nhật ký chẩn đoán</a> của <a href="https://docs.mongodb.com/manual/reference/log-messages/#REPL" target="_blank" rel="noopener noreferrer">REPL</a> và được ghi nhận trong thông báo nhật ký văn bản với văn bản <code>op: &lt;oplog entry&gt;</code> đã mất <code>&lt;num&gt;ms</code>. Những mục nhật ký hoạt động chậm này chỉ phụ thuộc vào ngưỡng hoạt động chậm và không phụ thuộc vào cấp độ nhật ký (cấp độ hệ thống hoặc cấp độ thành phần), cấu hình hoặc tỷ lệ mẫu hoạt động chậm. Các bộ thu thập không ghi lại các mục nhật ký hoạt động chậm.</p>
<h3>Độ trễ và kiểm soát luồng</h3>
<p>Độ trễ sao lưu (Replication lag) là thời gian mất để sao chép các hoạt động ghi từ thành viên chính sang thành viên phụ. Thời gian trễ ngắn là chấp nhận được, nhưng với độ trễ sao lưu tăng lên, có thể gặp vấn đề nghiêm trọng, ví dụ như áp lực bộ nhớ đệm trên thành viên chính.</p>
<p>Từ MongoDB 4.2 trở đi, quản trị viên có thể giới hạn tốc độ ghi của thành viên chính để giữ cho hầu hết thời gian trễ dưới ngưỡng tối đa được cấu hình <a href="https://docs.mongodb.com/manual/reference/parameters/#param.flowControlTargetLagSeconds" target="_blank" rel="noopener noreferrer"><code>flowControlTargetLagSeconds</code></a>.</p>
<p>Mặc định, kiểm soát luồng được bật.</p>
<p>Khi kiểm soát luồng được kích hoạt, khi thời gian trễ tiến đến <a href="https://docs.mongodb.com/manual/reference/parameters/#param.flowControlTargetLagSeconds" target="_blank" rel="noopener noreferrer"><code>flowControlTargetLagSeconds</code></a>, các hoạt động ghi trên thành viên chính phải nhận được mã thông báo trước khi khóa và thực hiện hoạt động ghi. Bằng cách giới hạn số lượng mã thông báo được phát ra mỗi giây, cơ chế kiểm soát luồng cố gắng giữ cho thời gian trễ dưới mục tiêu.</p>
<h2>Chuyển đổi lỗi</h2>
<p>Khi thời gian giao tiếp giữa thành viên chính và các thành viên khác trong cụm vượt quá <a href="https://docs.mongodb.com/manual/reference/replica-configuration/#rsconf.settings.electionTimeoutMillis" target="_blank" rel="noopener noreferrer"><code>electionTimeoutMillis</code></a> được cấu hình (mặc định là 10 giây), các thành viên phù hợp sẽ yêu cầu một cuộc bầu cử và đề cử chính mình làm thành viên chính mới. Cụm cố gắng hoàn thành cuộc bầu cử và khôi phục hoạt động bình thường.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920175429.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Trước khi hoàn thành cuộc bầu cử, bản sao dữ liệu không thể xử lý các hoạt động ghi. Nếu bản sao dữ liệu được cấu hình để chạy khi thành viên chính không khả dụng, nó có thể tiếp tục cung cấp truy vấn đọc.</p>
<p>Nếu cấu hình bản sao dữ liệu mặc định là chạy khi thành viên chính không khả dụng, nó sẽ tiếp tục đáp ứng các truy vấn đọc trong khi chờ cuộc bầu cử và sau đó tiếp tục ghi lại hoạt động ghi từ thành viên chính mới.</p>
<p>Ứng dụng kết nối nên bao gồm xử lý lỗi tự động và tái thử lại cho việc chuyển đổi lỗi tự động và cuộc bầu cử tiếp theo. Từ MongoDB 3.6 trở đi, các trình điều khiển MongoDB có thể phát hiện sự mất kết nối với thành viên chính và có thể tự động thử lại một số hoạt động ghi.</p>
<p>Từ MongoDB 4.4 trở đi, MongoDB cung cấp đọc gương: nó sẽ nói trước dữ liệu gần đây của thành viên có thể bầu cử (thành viên ưu tiên lớn hơn 0). Việc nói trước bộ nhớ đệm của thành viên có thể bầu cử có thể giúp khôi phục nhanh hơn sau cuộc bầu cử.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920165054.svg" type="image/svg+xml"/>
    </item>
    <item>
      <title>MongoDB Sharding</title>
      <link>https://vanhung4499.github.io/database/mongodb/sharding.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/sharding.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Sharding</source>
      <description>MongoDB Phân đoạn Giới thiệu về cụm phân đoạn Khi MongoDB cần lưu trữ dữ liệu lớn, một nút đơn không đủ để lưu trữ toàn bộ dữ liệu và có thể không cung cấp được hiệu suất đáng h...</description>
      <category>db</category>
      <category>mongodb</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giới thiệu về cụm phân đoạn</h2>
<p>Khi MongoDB cần lưu trữ dữ liệu lớn, một nút đơn không đủ để lưu trữ toàn bộ dữ liệu và có thể không cung cấp được hiệu suất đáng hài lòng. Do đó, chúng ta có thể sử dụng cơ chế phân đoạn của MongoDB để hỗ trợ mở rộng theo chiều ngang.</p>
<h3>Đặc điểm của cụm phân đoạn</h3>
<p>Hoàn toàn trong suốt với ứng dụng</p>
<p>Cân bằng dữ liệu tự động</p>
<p>Mở rộng động</p>
<p>Cung cấp ba phương pháp phân đoạn khác nhau</p>
<h3>Các thành phần của cụm phân đoạn</h3>
<p>Cụm phân đoạn MongoDB bao gồm các thành phần sau:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/core/sharded-cluster-shards/" target="_blank" rel="noopener noreferrer">shard</a>: Mỗi phân đoạn chứa một phần con của dữ liệu phân đoạn. Mỗi phân đoạn có thể triển khai như một bộ nhân bản.</li>
<li><a href="https://docs.mongodb.com/manual/core/sharded-cluster-query-router/" target="_blank" rel="noopener noreferrer">mongos</a>: mongos hoạt động như một bộ định tuyến truy vấn, cung cấp giao diện giữa ứng dụng khách hàng và cụm phân đoạn. Từ phiên bản MongoDB 4.4 trở đi, mongos có thể hỗ trợ <a href="https://docs.mongodb.com/manual/core/sharded-cluster-query-router/#mongos-hedged-reads" target="_blank" rel="noopener noreferrer">hedged reads</a> để giảm thiểu độ trễ.</li>
<li><a href="https://docs.mongodb.com/manual/core/sharded-cluster-config-servers/" target="_blank" rel="noopener noreferrer">config servers</a>: Cung cấp lưu trữ dữ liệu siêu dữ liệu và ánh xạ phân phối dữ liệu.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724020005.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h3>Phân phối của cụm phân đoạn</h3>
<p><strong>Cụm sao chép MongoDB được phân phối theo bộ sưu tập</strong>, phân phối dữ liệu trên các phân đoạn trong cụm. Tối đa cho phép 1024 phân đoạn.</p>
<p>Dữ liệu giữa các phân đoạn trong cụm sao chép MongoDB không trùng lặp, chỉ khi tất cả các phân đoạn đều hoạt động bình thường, cụm mới hoạt động đầy đủ.</p>
<p>Cơ sở dữ liệu MongoDB có thể chứa cả bộ sưu tập đã phân đoạn và chưa phân đoạn. Các bộ sưu tập đã phân đoạn sẽ được phân phối trên các nút trong cụm. Trong khi đó, các bộ sưu tập chưa phân đoạn được lưu trữ trên nút chính. Mỗi cơ sở dữ liệu có nút chính riêng của nó.</p>
<p>Bộ sưu tập đã phân đoạn và chưa phân đoạn:</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920212159.svg" alt="20200920212159.svg" tabindex="0" loading="lazy"><figcaption>20200920212159.svg</figcaption></figure>
<h3>Nút định tuyến mongos</h3>
<p>Để kết nối với <a href="https://docs.mongodb.com/manual/reference/glossary/#term-sharded-cluster" target="_blank" rel="noopener noreferrer">cụm phân đoạn MongoDB</a>, bạn phải kết nối với bộ định tuyến <a href="https://docs.mongodb.com/manual/reference/glossary/#term-mongos" target="_blank" rel="noopener noreferrer"><code>mongos</code></a>. Điều này bao gồm cả các bộ sưu tập đã phân đoạn và chưa phân đoạn. Khách hàng không nên kết nối trực tiếp với các nút phân đoạn để thực hiện các hoạt động đọc và ghi.</p>
<p>Cách kết nối với <a href="https://docs.mongodb.com/manual/reference/program/mongos/#bin.mongos" target="_blank" rel="noopener noreferrer"><code>mongos</code></a> tương tự như kết nối với <a href="https://docs.mongodb.com/manual/reference/program/mongod/#bin.mongod" target="_blank" rel="noopener noreferrer"><code>mongod</code></a>, ví dụ như thông qua <a href="https://docs.mongodb.com/manual/reference/program/mongo/#bin.mongo" target="_blank" rel="noopener noreferrer"><code>mongo</code></a> shell hoặc <a href="https://docs.mongodb.com/drivers/?jump=docs" target="_blank" rel="noopener noreferrer">MongoDB driver</a>.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920212157.svg" alt="20200920212157.svg" tabindex="0" loading="lazy"><figcaption>20200920212157.svg</figcaption></figure>
<p>Vai trò của nút định tuyến:</p>
<ul>
<li>Cung cấp điểm vào duy nhất cho cụm</li>
<li>Chuyển tiếp yêu cầu từ ứng dụng</li>
<li>Chọn nút dữ liệu phù hợp để đọc và ghi</li>
<li>Kết hợp kết quả từ nhiều nút dữ liệu</li>
</ul>
<p>Thường thì, nên có ít nhất 2 nút định tuyến mongos.</p>
<h1>Khóa phân đoạn</h1>
<p>MongoDB sử dụng khóa phân đoạn để phân phối các tài liệu trong bộ sưu tập giữa các phân đoạn. Khóa phân đoạn được tạo thành từ một hoặc nhiều trường trong tài liệu.</p>
<ul>
<li>Từ phiên bản MongoDB 4.4 trở đi, các tài liệu trong bộ sưu tập phân đoạn có thể thiếu trường khóa phân đoạn. Khi phân phối tài liệu qua các phân đoạn, việc thiếu trường khóa phân đoạn sẽ được coi như có giá trị rỗng, nhưng không được sử dụng trong các truy vấn định tuyến.</li>
<li>Trong MongoDB 4.2 và các phiên bản cũ hơn, trường khóa phân đoạn phải tồn tại trong mỗi tài liệu trong bộ sưu tập phân đoạn.</li>
</ul>
<p>Lựa chọn khóa phân đoạn khi phân đoạn bộ sưu tập.</p>
<ul>
<li>Từ phiên bản MongoDB 4.4 trở đi, bạn có thể tối ưu hóa khóa phân đoạn của bộ sưu tập bằng cách thêm một hoặc nhiều trường hậu tố vào khóa hiện có.</li>
<li>Trong MongoDB 4.2 và các phiên bản cũ hơn, không thể thay đổi lựa chọn khóa phân đoạn sau khi đã phân đoạn.</li>
</ul>
<p>Giá trị khóa phân đoạn của tài liệu xác định phân phối của nó trên các phân đoạn</p>
<ul>
<li>Từ phiên bản MongoDB 4.2 trở đi, bạn có thể cập nhật giá trị khóa phân đoạn của tài liệu trừ khi trường khóa phân đoạn của bạn là trường không thể thay đổi như _id.</li>
<li>Trong MongoDB 4.0 và các phiên bản cũ hơn, giá trị trường khóa phân đoạn của tài liệu là không thể thay đổi.</li>
</ul>
<p>Chỉ mục khóa phân đoạn: Để phân đoạn một bộ sưu tập đã được điền, bộ sưu tập đó phải có một chỉ mục bắt đầu bằng khóa phân đoạn. Khi phân đoạn một bộ sưu tập trống, MongoDB sẽ tạo một chỉ mục hỗ trợ cho khóa phân đoạn đã chỉ định nếu bộ sưu tập đó chưa có chỉ mục phù hợp.</p>
<p>Chiến lược phân đoạn: Lựa chọn khóa phân đoạn ảnh hưởng đến hiệu suất, hiệu quả và khả năng mở rộng của cụm phân đoạn. Lựa chọn khóa phân đoạn và chỉ mục phụ trợ cũng ảnh hưởng đến chiến lược phân đoạn mà cụm có thể sử dụng.</p>
<p>MongoDB phân đoạn dữ liệu. Mỗi phân đoạn có giới hạn dựa trên khóa phân đoạn.</p>
<p>Để đảm bảo phân phối đồng đều của các phân đoạn trên toàn cụm, trình cân bằng chạy trong nền và di chuyển các phân đoạn trên các phân đoạn.</p>
<h2>Chiến lược phân đoạn</h2>
<p>MongoDB hỗ trợ hai chiến lược phân đoạn: Phân đoạn theo băm và phân đoạn theo phạm vi.</p>
<h3>Phân đoạn theo băm</h3>
<p>Chiến lược phân đoạn theo băm tính toán giá trị băm của trường khóa phân đoạn; sau đó, mỗi <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener noreferrer">chunk</a> được gán một phạm vi dựa trên giá trị khóa phân đoạn.</p>
<blockquote>
<p>Lưu ý: Khi giải quyết truy vấn sử dụng chỉ mục băm, MongoDB tự động tính toán giá trị băm, không cần ứng dụng tính toán giá trị băm.</p>
</blockquote>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920213343.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Mặc dù các phạm vi khóa phân đoạn có thể "gần nhau", nhưng giá trị băm của chúng không thể có khả năng nằm trên cùng một <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener noreferrer">chunk</a>. Phân phối dữ liệu dựa trên băm giúp phân phối dữ liệu đồng đều hơn, đặc biệt là trong các tập dữ liệu mà khóa phân đoạn thay đổi một cách đơn điệu.</p>
<p>Tuy nhiên, phân đoạn theo băm có nghĩa là các truy vấn phạm vi trên khóa phân đoạn không thể được hướng đến một phân đoạn duy nhất, dẫn đến nhiều hoạt động truyền phát trong phạm vi cụm.</p>
<h3>Phân đoạn theo phạm vi</h3>
<p>Phân đoạn theo phạm vi chia dữ liệu thành nhiều phạm vi dựa trên giá trị khóa phân đoạn. Sau đó, mỗi <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener noreferrer">chunk</a> được gán một phạm vi dựa trên giá trị khóa phân đoạn.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920213345.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Các giá trị khóa phân đoạn tương đối gần nhau có khả năng nằm trên cùng một <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener noreferrer">chunk</a>. Hiệu suất của phân đoạn theo phạm vi phụ thuộc vào lựa chọn khóa phân đoạn. Lựa chọn khóa phân đoạn không tốt có thể dẫn đến phân phối dữ liệu không đồng đều, gây suy giảm một số lợi ích của phân đoạn hoặc gây ra hạn chế hiệu suất.</p>
<h2>Vùng trong cụm phân đoạn</h2>
<p>Vùng có thể cải thiện tính cục bộ của dữ liệu trong cụm phân đoạn chạy trên nhiều trung tâm dữ liệu.</p>
<p>Trong cụm phân đoạn, có thể tạo ra các <a href="https://docs.mongodb.com/manual/reference/glossary/#term-zone" target="_blank" rel="noopener noreferrer">vùng</a> dữ liệu dựa trên khóa phân đoạn. Mỗi vùng có thể được liên kết với một hoặc nhiều phân đoạn trong cụm. Một phân đoạn có thể được liên kết với bất kỳ số lượng vùng nào. Trong cụm cân bằng, MongoDB chỉ di chuyển các <a href="https://docs.mongodb.com/manual/reference/glossary/#term-chunk" target="_blank" rel="noopener noreferrer">chunk</a> mà vùng bao phủ tới phân đoạn liên quan đến vùng đó.</p>
<p>Mỗi vùng bao phủ một hoặc nhiều phạm vi giá trị khóa phân đoạn. Mỗi phạm vi bao phủ luôn bao gồm cả giới hạn trên và giới hạn dưới của nó.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200920214854.svg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Khi xác định các phạm vi mới để bao phủ vùng, phải sử dụng các trường có trong khóa phân đoạn. Nếu sử dụng khóa phân đoạn kết hợp, phạm vi phải bao gồm tiền tố của khóa phân đoạn.</p>
<p>Khi lựa chọn khóa phân đoạn, nên xem xét các vùng có thể sử dụng trong tương lai.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724020005.png" type="image/png"/>
    </item>
    <item>
      <title>MongoDB Transaction</title>
      <link>https://vanhung4499.github.io/database/mongodb/transaction.html</link>
      <guid>https://vanhung4499.github.io/database/mongodb/transaction.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MongoDB Transaction</source>
      <description>Giao dịch trong MongoDB writeConcern có thể xác định số lượng node cần xác nhận để ghi thành công. Mặc định: Không có thiết lập nào cho replica set nhiều node, do đó có thể mất ...</description>
      <category>mongodb</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>writeConcern có thể xác định số lượng node cần xác nhận để ghi thành công.</p>
<ul>
<li>Mặc định: Không có thiết lập nào cho replica set nhiều node, do đó có thể mất dữ liệu.</li>
<li><code>w: "majority"</code>: Được coi là ghi thành công nếu hầu hết các node xác nhận.</li>
<li><code>w: "all"</code>: Chỉ được coi là ghi thành công nếu tất cả các node xác nhận.</li>
</ul>
<p>journal xác định cách xem ghi thành công. Có các giá trị sau:</p>
<ul>
<li><code>true</code>: Chỉ được coi là ghi thành công khi hoạt động ghi được lưu vào tập tin nhật ký (journal).</li>
<li><code>false</code>: Chỉ được coi là ghi thành công khi hoạt động ghi được lưu trong bộ nhớ.</li>
</ul>
<p>【Ví dụ】Sử dụng tham số writeConcern trong một cụm</p>
<div class="language-javascript" data-ext="javascript" data-title="javascript"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, { </span><span style="color:#E06C75;--shiki-dark:#E06C75">writeConcern</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'majoriy'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } })</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, { </span><span style="color:#E06C75;--shiki-dark:#E06C75">writeConcern</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'4'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } })</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">db</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">transaction</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">insert</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">({ </span><span style="color:#E06C75;--shiki-dark:#E06C75">count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> }, { </span><span style="color:#E06C75;--shiki-dark:#E06C75">writeConcern</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: { </span><span style="color:#E06C75;--shiki-dark:#E06C75">w</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">: </span><span style="color:#98C379;--shiki-dark:#98C379">'all'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> } })</span></span></code></pre>
</div><p>【Ví dụ】Cấu hình node trễ để mô phỏng độ trễ mạng</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>conf=rs.conf()</span></span>
<span class="line"><span>conf.memebers[2].slaveDelay=5</span></span>
<span class="line"><span>conf.memebers[2].priority=0</span></span>
<span class="line"><span>rs.reconfig(conf)</span></span></code></pre>
</div>]]></content:encoded>
    </item>
    <item>
      <title>MySQL</title>
      <link>https://vanhung4499.github.io/database/mysql/</link>
      <guid>https://vanhung4499.github.io/database/mysql/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>MySQL Architecture</title>
      <link>https://vanhung4499.github.io/database/mysql/architecture.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/architecture.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Architecture</source>
      <description>MySQL Architecture Kiến trúc cơ bản Nói chung, MySQL có thể được chia thành hai phần: lớp máy chủ và lớp lưu trữ. Lớp máy chủ bao gồm các thành phần như kết nối, bộ nhớ cache tr...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Kiến trúc cơ bản</h2>
<p>Nói chung, MySQL có thể được chia thành hai phần: lớp máy chủ và lớp lưu trữ.</p>
<p><strong>Lớp máy chủ</strong> bao gồm các thành phần như kết nối, bộ nhớ cache truy vấn, trình phân tích, trình tối ưu hóa, trình thực thi, vv. Nó bao gồm hầu hết các chức năng và dịch vụ cốt lõi của MySQL, cũng như tất cả các hàm tích hợp (như hàm ngày tháng, thời gian, toán học và mã hóa), tất cả các chức năng chung cho tất cả các lưu trữ (như thủ tục lưu trữ, trigger, view, vv).</p>
<p><strong>Lớp lưu trữ</strong> chịu trách nhiệm lưu trữ và truy xuất dữ liệu. Kiến trúc của nó là một kiến trúc cắm, hỗ trợ nhiều lưu trữ như InnoDB, MyISAM, Memory, vv. Hiện nay, lưu trữ phổ biến nhất là InnoDB, nó đã trở thành lưu trữ mặc định từ phiên bản MySQL 5.5.5 trở đi.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/mysql-workflow.drawio.png" alt="mysql-workflow" tabindex="0" loading="lazy"><figcaption>mysql-workflow</figcaption></figure>
<h2>Quá trình truy vấn</h2>
<p>Câu lệnh SQL được thực hiện như thế nào trong MySQL?</p>
<p>Quá trình thực hiện truy vấn MySQL tổng cộng có 6 bước, tương ứng với 6 thành phần:</p>
<ol>
<li>Kết nối: Kết nối giữa máy khách và máy chủ MySQL; Kết nối chịu trách nhiệm thiết lập kết nối với máy khách, xác định quyền truy cập và duy trì quản lý kết nối.</li>
<li>MySQL kiểm tra bộ nhớ cache truy vấn trước tiên. Nếu truy vấn được lưu trong bộ nhớ cache, kết quả sẽ được trả về ngay lập tức. Nếu không, chuyển sang bước tiếp theo.</li>
<li>Máy chủ MySQL thực hiện phân tích SQL: phân tích cú pháp, phân tích từ vựng.</li>
<li>Máy chủ MySQL sử dụng trình tối ưu hóa để tạo ra kế hoạch thực thi tương ứng.</li>
<li>Máy chủ MySQL gọi API lưu trữ để thực hiện truy vấn dựa trên kế hoạch thực hiện.</li>
<li>Máy chủ MySQL trả kết quả cho máy khách, đồng thời lưu kết quả truy vấn vào bộ nhớ cache.</li>
</ol>
<h3>(1) Kết nối</h3>
<p>Bước đầu tiên khi sử dụng MySQL là kết nối vào cơ sở dữ liệu. <strong>Kết nối chịu trách nhiệm thiết lập kết nối với máy chủ MySQL, xác định quyền truy cập và duy trì quản lý kết nối</strong>.</p>
<p>Giao tiếp giữa máy khách và máy chủ MySQL là một chế độ bán song công: vào bất kỳ thời điểm nào, máy chủ có thể gửi dữ liệu cho máy khách hoặc máy khách có thể gửi dữ liệu cho máy chủ. Máy khách gửi một gói dữ liệu duy nhất chứa yêu cầu truy vấn cho máy chủ, vì vậy nếu câu lệnh truy vấn dài, bạn cần thiết lập tham số <code>max_allowed_packet</code>. Tuy nhiên, nếu câu lệnh truy vấn quá lớn, máy chủ sẽ từ chối nhận thêm dữ liệu và ném ra một ngoại lệ.</p>
<p>Lệnh kết nối MySQL của khách hàng: <code>mysql -h&lt;host&gt; -P&lt;port&gt; -u&lt;username&gt; -p&lt;password&gt;</code>. Nếu không chỉ định mật khẩu, bạn sẽ được yêu cầu nhập mật khẩu trước khi truy cập.</p>
<p>Sau khi thiết lập kết nối, nếu không có hoạt động tiếp theo, kết nối sẽ ở trạng thái không hoạt động và bạn có thể thấy nó trong lệnh <code>show processlist</code>. Nếu khách hàng không hoạt động trong thời gian quá lâu, kết nối sẽ tự động bị đóng. Thời gian duy trì kết nối của khách hàng được điều chỉnh bằng tham số <code>wait_timeout</code>, giá trị mặc định là 8 giờ. Nếu kết nối bị đóng và khách hàng gửi yêu cầu truy vấn, bạn sẽ nhận được thông báo lỗi "Lost connection to MySQL server during query". Trong trường hợp này, bạn cần phải kết nối lại và thực hiện yêu cầu truy vấn.</p>
<p>Quá trình thiết lập kết nối thường là phức tạp, do đó, khuyến nghị giảm thiểu số lần thiết lập kết nối trong quá trình sử dụng và sử dụng kết nối dài hơn. Để tăng cường việc tái sử dụng kết nối cơ sở dữ liệu trong chương trình, thường sử dụng bể kết nối cơ sở dữ liệu để quản lý và duy trì.</p>
<p>Tuy nhiên, nếu chỉ sử dụng kết nối dài hơn, bạn có thể nhận thấy rằng MySQL sử dụng bộ nhớ nhanh hơn. Điều này là do MySQL sử dụng bộ nhớ tạm thời trong quá trình thực thi và giữ tài nguyên kết nối. Những tài nguyên này chỉ được giải phóng khi kết nối bị đóng. Do đó, nếu tích lũy kết nối dài hơn, có thể dẫn đến sự sử dụng bộ nhớ quá lớn và bị hệ thống giết (OOM). Khi xảy ra hiện tượng này, MySQL sẽ khởi động lại một cách bất thường.</p>
<p>Làm thế nào để giải quyết vấn đề này? Bạn có thể xem xét hai giải pháp sau đây.</p>
<ul>
<li><strong>Đóng kết nối dài hơn định kỳ</strong>: Sử dụng một khoảng thời gian hoặc kiểm tra trong chương trình, sau khi thực hiện một hoạt động chiếm nhiều bộ nhớ, đóng kết nối và sau đó thực hiện kết nối lại khi cần truy vấn.</li>
<li>Nếu bạn đang sử dụng phiên bản MySQL 5.7 trở lên, bạn có thể sử dụng <code>mysql_reset_connection</code> để khởi tạo lại tài nguyên kết nối sau mỗi hoạt động lớn. Quá trình này không cần phải kết nối lại và xác thực quyền, nhưng sẽ khôi phục kết nối về trạng thái ban đầu khi tạo ra.</li>
</ul>
<h3>(2) Bộ nhớ cache truy vấn</h3>
<blockquote>
<p><strong>Không khuyến nghị sử dụng bộ nhớ cache truy vấn, vì thường có nhiều hại hơn lợi ích</strong>.</p>
</blockquote>
<p>Trước khi phân tích một câu lệnh truy vấn, nếu bộ nhớ cache truy vấn được bật, MySQL sẽ kiểm tra xem câu lệnh truy vấn này có trúng kết quả trong bộ nhớ cache không. Nếu truy vấn hiện tại trùng khớp với dữ liệu trong bộ nhớ cache, sau khi kiểm tra quyền của người dùng, kết quả sẽ được trả về trực tiếp từ bộ nhớ cache. Trong trường hợp này, truy vấn không được phân tích, không tạo kế hoạch thực hiện, và không thực hiện.</p>
<p>MySQL lưu trữ bộ nhớ cache trong một bảng tham chiếu (đừng hiểu nhầm là <code>table</code>, có thể coi nó là một cấu trúc dữ liệu giống <code>HashMap</code>), được chỉ mục bằng một giá trị băm được tính toán từ các yếu tố có thể ảnh hưởng đến kết quả truy vấn, bao gồm truy vấn hiện tại, cơ sở dữ liệu hiện tại và số phiên bản giao thức khách hàng. Vì vậy, bất kỳ sự khác biệt nào trong các ký tự (ví dụ: khoảng trắng, chú thích) cũng sẽ khiến bộ nhớ cache không trùng khớp.</p>
<p><strong>Nếu truy vấn chứa bất kỳ hàm người dùng, hàm lưu trữ, biến người dùng, bảng tạm thời hoặc bảng hệ thống trong cơ sở dữ liệu mysql, kết quả truy vấn sẽ không được lưu vào bộ nhớ cache</strong>. Ví dụ, các hàm <code>NOW()</code> hoặc <code>CURRENT_DATE()</code> sẽ trả về kết quả khác nhau dựa trên thời gian truy vấn, và các truy vấn chứa <code>CURRENT_USER</code> hoặc <code>CONNECTION_ID()</code> sẽ trả về kết quả khác nhau dựa trên người dùng, việc lưu kết quả truy vấn như vậy không có ý nghĩa.</p>
<p><strong>Không khuyến nghị sử dụng bộ nhớ cache truy vấn, vì thường có nhiều hại hơn lợi ích</strong>. Tỷ lệ trúng kết quả của bộ nhớ cache truy vấn thường rất thấp, chỉ cần có bất kỳ cập nhật nào trên một bảng, tất cả các bộ nhớ cache truy vấn của bảng đó sẽ bị xóa. Do đó, khả năng trúng kết quả của bộ nhớ cache truy vấn trong cơ sở dữ liệu có áp lực cập nhật lớn sẽ rất thấp. Trừ khi bạn có một bảng tĩnh và chỉ cần cập nhật một lần trong thời gian dài. Ví dụ, một bảng cấu hình hệ thống, trong trường hợp này, truy vấn trên bảng này sẽ phù hợp với việc sử dụng bộ nhớ cache truy vấn.</p>
<p>May mắn thay, MySQL cũng cung cấp cách "sử dụng theo yêu cầu". Bạn có thể đặt tham số <code>query_cache_type</code> thành <code>DEMAND</code>, điều này sẽ không sử dụng bộ nhớ cache truy vấn cho các câu lệnh SQL mặc định. Đối với các câu lệnh SQL mà bạn muốn sử dụng bộ nhớ cache truy vấn, bạn có thể sử dụng <code>SQL_CACHE</code> để chỉ định, giống như câu lệnh dưới đây:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> SQL_CACHE * </span><span style="color:#C678DD;--shiki-dark:#C678DD">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> T </span><span style="color:#C678DD;--shiki-dark:#C678DD">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Phiên bản MySQL 8.0 đã loại bỏ hoàn toàn chức năng bộ nhớ cache truy vấn.</p>
</blockquote>
<h3>(3) Phân tích cú pháp</h3>
<p>Nếu không trúng kết quả bộ nhớ cache truy vấn, quá trình thực thi câu lệnh sẽ bắt đầu. Trước tiên, MySQL cần biết bạn muốn làm gì, vì vậy nó cần phân tích câu lệnh SQL. MySQL sử dụng từ khóa để phân tích câu lệnh SQL và tạo ra một cây phân tích cú pháp tương ứng. Trong quá trình này, trình phân tích sử dụng các quy tắc cú pháp để xác minh và phân tích cây phân tích cú pháp của bạn. Ví dụ, trình phân tích sẽ nhận ra từ khóa "select" bạn nhập và xác định đây là một câu lệnh truy vấn. Nó cũng sẽ nhận ra chuỗi "T" là "tên bảng T" và chuỗi "ID" là "cột ID".</p>
<ul>
<li>Trình phân tích đầu tiên thực hiện "phân tích từ vựng". Bạn nhập vào một câu lệnh SQL gồm nhiều chuỗi và dấu cách, MySQL cần xác định các chuỗi đó đại diện cho cái gì. MySQL nhận ra từ khóa "select" từ bạn nhập vào, đó là một câu lệnh truy vấn. Nó cũng nhận ra chuỗi "T" là "tên bảng T" và chuỗi "ID" là "cột ID".</li>
<li>Tiếp theo, thực hiện "phân tích cú pháp". Dựa trên kết quả phân tích từ vựng, trình phân tích cú pháp sẽ xác định xem câu lệnh SQL bạn nhập có đáp ứng cú pháp của MySQL không. Nếu câu lệnh của bạn không đúng, bạn sẽ nhận được thông báo lỗi "You have an error in your SQL syntax", ví dụ như câu lệnh select bị thiếu chữ cái "s".</li>
</ul>
<h3>(4) Tối ưu hóa truy vấn</h3>
<p>Sau khi hoàn thành phân tích và xác định câu lệnh SQL, MySQL sẽ tiến hành tối ưu hóa truy vấn.</p>
<p>Sau khi hoàn thành phân tích và xác định cây phân tích cú pháp, MySQL sẽ chuyển đổi nó thành kế hoạch thực hiện tương ứng. Trong hầu hết các trường hợp, một truy vấn có thể có nhiều cách thực hiện, nhưng kết quả cuối cùng vẫn là cùng một. Nhiệm vụ của trình tối ưu hóa là tìm ra kế hoạch thực hiện tốt nhất trong số đó.</p>
<p>MySQL sử dụng trình tối ưu hóa dựa trên chi phí, nó cố gắng dự đoán chi phí của một truy vấn khi sử dụng một kế hoạch thực hiện cụ thể và chọn kế hoạch có chi phí nhỏ nhất. Trong MySQL, bạn có thể sử dụng giá trị <code>last_query_cost</code> của phiên truy vấn hiện tại để tính toán chi phí truy vấn hiện tại.</p>
<div class="language-ruby" data-ext="ruby" data-title="ruby"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> select</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> *</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> from t_message limit </span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">...</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">Omit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> result set</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> show status like </span><span style="color:#98C379;--shiki-dark:#98C379">'last_query_cost'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/mysql-workflow.drawio.png" type="image/png"/>
    </item>
    <item>
      <title>MySQL Configuration</title>
      <link>https://vanhung4499.github.io/database/mysql/configuration.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/configuration.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Configuration</source>
      <description>Cấu hình MySQL Phiên bản: mysql Cấu hình cơ bản Giải thích các cấu hình</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Phiên bản: <img src="https://img.shields.io/badge/mysql-8.0-blue" alt="mysql" loading="lazy"></p>
</blockquote>
<h2>Cấu hình cơ bản</h2>
<div class="language-ini" data-ext="ini" data-title="ini"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">[mysqld]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># GENERAL</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">#</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://img.shields.io/badge/mysql-8.0-blue" type="image/"/>
    </item>
    <item>
      <title>MySQL Storage Engine</title>
      <link>https://vanhung4499.github.io/database/mysql/engine.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/engine.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Storage Engine</source>
      <description>MySQL Storage Engine Các storage engine trong MySQL Trong hệ thống tệp, MySQL lưu mỗi cơ sở dữ liệu (cũng có thể gọi là schema) dưới dạng một thư mục con trong thư mục dữ liệu. ...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Các storage engine trong MySQL</h2>
<p>Trong hệ thống tệp, MySQL lưu mỗi cơ sở dữ liệu (cũng có thể gọi là schema) dưới dạng một thư mục con trong thư mục dữ liệu. Khi tạo bảng, MySQL sẽ tạo một tệp <code>.frm</code> cùng tên với bảng trong thư mục cơ sở dữ liệu để lưu định nghĩa của bảng. Vì MySQL sử dụng các thư mục và tệp hệ thống tệp để lưu định nghĩa cơ sở dữ liệu và bảng, tính nhạy cảm chữ hoa chữ thường phụ thuộc vào nền tảng cụ thể. Trong Windows, tính nhạy cảm chữ hoa chữ thường không được áp dụng; trong các hệ thống tương tự Unix, tính nhạy cảm chữ hoa chữ thường được áp dụng. <strong>Các storage engine khác nhau lưu trữ dữ liệu và chỉ mục theo cách khác nhau, nhưng định nghĩa bảng thì được xử lý thống nhất ở tầng dịch vụ của MySQL.</strong></p>
<p>MySQL sử dụng các storage engine dưới dạng plugin, mỗi storage engine nhắm đến một môi trường ứng dụng cơ sở dữ liệu cụ thể. Đồng thời, MySQL mã nguồn mở còn cho phép các nhà phát triển thiết lập các storage engine riêng của họ. Dưới đây là một số storage engine phổ biến:</p>
<ul>
<li>storage engine InnoDB: Đây là storage engine mặc định từ phiên bản MySQL 5.5 trở đi, với đặc điểm lớn nhất là hỗ trợ giao dịch, khóa cấp hàng, và ràng buộc khóa ngoại.</li>
<li>storage engine MyISAM: Là storage engine mặc định trước phiên bản MySQL 5.5, không hỗ trợ giao dịch, cũng không hỗ trợ khóa ngoại, nhưng có đặc điểm lớn nhất là tốc độ nhanh và chiếm ít tài nguyên.</li>
<li>storage engine Memory: Sử dụng bộ nhớ hệ thống làm phương tiện lưu trữ để có được tốc độ phản hồi nhanh hơn. Tuy nhiên, nếu quá trình mysqld bị sập, tất cả dữ liệu sẽ bị mất, do đó chỉ nên sử dụng storage engine Memory khi dữ liệu là tạm thời.</li>
<li>storage engine NDB: Còn được gọi là storage engine NDB Cluster, chủ yếu được sử dụng cho môi trường cụm phân tán MySQL Cluster, tương tự như cụm RAC của Oracle.</li>
<li>storage engine Archive: Có cơ chế nén tốt, dùng để lưu trữ tệp. Khi yêu cầu ghi dữ liệu, sẽ thực hiện nén, do đó thường được dùng để làm kho lưu trữ.</li>
</ul>
<h2>Các thao tác liên quan đến storage engine</h2>
<h3>Lệnh show storage engine</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Xem các storage engine được hỗ trợ</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW ENGINES;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Xem storage engine mặc định</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW VARIABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD">LIKE</span><span style="color:#98C379;--shiki-dark:#98C379"> 'storage_engine'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Xem storage engine của một bảng cụ thể</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW </span><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#98C379;--shiki-dark:#98C379"> `table_name`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Xem storage engine của một bảng cụ thể trong một cơ sở dữ liệu</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW </span><span style="color:#C678DD;--shiki-dark:#C678DD">TABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> STATUS</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LIKE</span><span style="color:#98C379;--shiki-dark:#98C379"> 'table_name'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW </span><span style="color:#C678DD;--shiki-dark:#C678DD">TABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> STATUS</span><span style="color:#C678DD;--shiki-dark:#C678DD"> FROM</span><span style="color:#98C379;--shiki-dark:#98C379"> `database_name`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WHERE</span><span style="color:#98C379;--shiki-dark:#98C379"> `name`</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "table_name"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h2>Các lệnh thiết lập storage engine</h2>
<h3>Lệnh tạo và thay đổi storage engine</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Chỉ định storage engine khi tạo bảng, nếu không chỉ định rõ, mặc định là INNODB</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> t1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (i </span><span style="color:#C678DD;--shiki-dark:#C678DD">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) ENGINE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> INNODB;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> t2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (i </span><span style="color:#C678DD;--shiki-dark:#C678DD">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) ENGINE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> CSV;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> t3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (i </span><span style="color:#C678DD;--shiki-dark:#C678DD">INT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) ENGINE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> MEMORY;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Thay đổi storage engine</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">ALTER</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> t ENGINE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> InnoDB;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"># Thay đổi storage engine mặc định, cũng có thể thay đổi trong tệp cấu hình </span><span style="color:#D19A66;--shiki-dark:#D19A66">my</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">cnf</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> default_storage_engine</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">NDBCLUSTER;</span></span></code></pre>
</div><p>Mặc định, mỗi khi <code>CREATE TABLE</code> hoặc <code>ALTER TABLE</code> không thể sử dụng storage engine mặc định, sẽ tạo ra một cảnh báo. Để ngăn chặn hành vi gây nhầm lẫn khi storage engine yêu cầu không khả dụng, có thể kích hoạt chế độ <code>NO_ENGINE_SUBSTITUTION SQL</code>. Nếu bộ máy yêu cầu không khả dụng, thiết lập này sẽ tạo ra lỗi thay vì cảnh báo và sẽ không tạo hoặc thay đổi bảng.</p>
<h2>Giới thiệu về các storage engine MySQL</h2>
<h3>Các storage engine tích hợp trong MySQL</h3>
<ul>
<li><strong>InnoDB</strong> - InnoDB là storage engine mặc định từ phiên bản MySQL 5.5 trở đi. Nó cung cấp khóa cấp hàng và ràng buộc khóa ngoại. Hiệu suất tốt và hỗ trợ tự động phục hồi sau khi gặp sự cố.</li>
<li><strong>MyISAM</strong> - Trước phiên bản MySQL 5.5, MyISAM là storage engine mặc định. Nó có nhiều tính năng nhưng không hỗ trợ giao dịch, không hỗ trợ khóa cấp hàng và khóa ngoại, và không có khả năng phục hồi sau sự cố.</li>
<li><strong>CSV</strong> - Có thể xử lý tệp CSV như bảng MySQL, nhưng bảng này không hỗ trợ chỉ mục.</li>
<li><strong>Memory</strong> - Lưu trữ dữ liệu trong bộ nhớ để có tốc độ phản hồi nhanh hơn. Tuy nhiên, nếu quá trình mysqld gặp sự cố, tất cả dữ liệu sẽ bị mất.</li>
<li><strong>NDB</strong> - Còn gọi là storage engine NDB Cluster, chủ yếu dùng cho môi trường cụm phân tán MySQL Cluster, tương tự như cụm RAC của Oracle.</li>
<li><strong>Archive</strong> - storage engine Archive rất phù hợp để lưu trữ dữ liệu.
<ul>
<li>storage engine Archive chỉ hỗ trợ thao tác <code>INSERT</code> và <code>SELECT</code>.</li>
<li>storage engine Archive sử dụng thuật toán nén zlib, với tỷ lệ nén có thể đạt 1:10.</li>
</ul>
</li>
</ul>
<h3>Cách chọn storage engine phù hợp</h3>
<p>Phần lớn trường hợp, InnoDB là lựa chọn đúng đắn, trừ khi cần các tính năng mà InnoDB không có.</p>
<p>Nếu ứng dụng cần chọn storage engine khác InnoDB, có thể xem xét các yếu tố sau:</p>
<ul>
<li><strong>Giao dịch</strong>: Nếu kịch bản kinh doanh là OLTP, thì InnoDB là storage engine được ưu tiên. Nếu không cần hỗ trợ giao dịch và chủ yếu là các thao tác SELECT và INSERT, MyISAM là lựa chọn tốt. Vì vậy, nếu MySQL được triển khai theo mô hình chủ - phụ và tách biệt đọc/ghi, có thể làm như sau: nút chính chỉ hỗ trợ ghi, bộ máy mặc định là InnoDB; nút phụ chỉ hỗ trợ đọc, bộ máy mặc định là MyISAM.</li>
<li><strong>Đồng thời</strong>: MyISAM chỉ hỗ trợ khóa cấp bảng, trong khi InnoDB hỗ trợ khóa cấp hàng. Do đó, InnoDB có hiệu suất đồng thời cao hơn.</li>
<li><strong>Khóa ngoại</strong>: InnoDB hỗ trợ khóa ngoại.</li>
<li><strong>Sao lưu</strong>: InnoDB hỗ trợ sao lưu nóng trực tuyến.</li>
<li><strong>Phục hồi sau sự cố</strong>: Khả năng hư hỏng sau sự cố của MyISAM cao hơn nhiều so với InnoDB, và tốc độ phục hồi cũng chậm hơn.</li>
<li><strong>Tính năng khác</strong>: MyISAM hỗ trợ bảng nén và chỉ mục dữ liệu không gian.</li>
</ul>
<h2>Giới thiệu về InnoDB</h2>
<p>InnoDB là storage engine mặc định từ phiên bản MySQL 5.5 trở đi. Chỉ nên sử dụng storage engine khác khi cần các tính năng mà InnoDB không hỗ trợ.</p>
<p>InnoDB cũng sử dụng cây B+ (B+Tree) làm cấu trúc chỉ mục, nhưng cách thực hiện cụ thể rất khác so với MyISAM. Trong MyISAM, tệp chỉ mục và tệp dữ liệu là tách biệt, tệp chỉ mục chỉ lưu trữ địa chỉ của bản ghi dữ liệu. Trong <strong>InnoDB, tệp dữ liệu của bảng chính là một cấu trúc chỉ mục B+Tree</strong>. Các nút lá (leaf node) của cây này chứa toàn bộ bản ghi dữ liệu. <strong>Chỉ mục này sử dụng khóa chính của bảng làm khóa</strong>, do đó, <strong>tệp dữ liệu của bảng InnoDB chính là chỉ mục chính</strong>.</p>
<p>InnoDB sử dụng MVCC (Multi-Version Concurrency Control) để hỗ trợ khả năng xử lý đồng thời cao, và thực hiện bốn mức độ cô lập tiêu chuẩn. Mức độ mặc định là đọc lặp lại (REPEATABLE READ) và sử dụng khóa khoảng (next-key locking) để ngăn chặn hiện tượng đọc ảo.</p>
<p>InnoDB được xây dựng dựa trên chỉ mục nhóm (clustered index), khác biệt lớn so với các storage engine khác. Dữ liệu được lưu trong chỉ mục, giúp tránh việc đọc từ đĩa trực tiếp, do đó cải thiện hiệu suất truy vấn.</p>
<p>InnoDB đã thực hiện nhiều tối ưu nội bộ, bao gồm đọc dữ liệu từ đĩa theo dự đoán, chỉ mục băm thích ứng tự động tạo để tăng tốc độ đọc, và vùng đệm chèn giúp tăng tốc độ chèn dữ liệu.</p>
<p>InnoDB hỗ trợ sao lưu nóng trực tuyến thực sự. Các storage engine khác không hỗ trợ sao lưu nóng trực tuyến; để có được chế độ xem nhất quán, cần phải dừng tất cả các thao tác ghi vào bảng, và trong môi trường đọc ghi hỗn hợp, việc dừng ghi cũng có thể đồng nghĩa với việc dừng đọc.</p>
<h3>Cấu trúc tệp vật lý của InnoDB:</h3>
<ul>
<li><strong>Tệp <code>.frm</code></strong>: Chứa thông tin siêu dữ liệu liên quan đến bảng, bao gồm thông tin định nghĩa cấu trúc bảng.</li>
<li><strong>Tệp <code>.ibd</code> hoặc <code>.ibdata</code></strong>: Chứa dữ liệu của InnoDB. Có hai cách lưu trữ dữ liệu InnoDB có thể được cấu hình:
<ul>
<li><strong>Không gian bảng riêng lẻ (file-per-table)</strong>: Sử dụng tệp <code>.ibd</code>, mỗi bảng có một tệp <code>.ibd</code>.</li>
<li><strong>Không gian bảng chia sẻ (shared-tablespace)</strong>: Sử dụng tệp <code>.ibdata</code>, tất cả các bảng dùng chung một tệp <code>.ibdata</code> (hoặc nhiều tệp, có thể cấu hình).</li>
</ul>
</li>
</ul>
<h2>Kiến trúc lưu trữ InnoDB</h2>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202406241406713.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Kiến trúc lưu trữ của InnoDB được chia thành cấu trúc bộ nhớ và cấu trúc đĩa.</p>
<h3>Cấu trúc bộ nhớ của InnoDB:</h3>
<ul>
<li><strong>Buffer Pool</strong>: Vùng đệm chính lưu trữ dữ liệu và chỉ mục được đọc từ đĩa.</li>
<li><strong>Change Buffer</strong>: Vùng đệm thay đổi lưu trữ các thay đổi đối với chỉ mục không duy nhất.</li>
<li><strong>Adaptive Hash Index</strong>: Chỉ mục băm thích ứng tự động tạo để tăng tốc độ truy vấn.</li>
<li><strong>Log Buffer</strong>: Vùng đệm ghi lại các thay đổi trước khi được ghi vào tệp nhật ký.</li>
</ul>
<h3>Cấu trúc đĩa của InnoDB:</h3>
<ul>
<li><strong>Tablespace</strong>: Không gian lưu trữ các tệp dữ liệu và chỉ mục.</li>
<li><strong>Doublewrite Buffer</strong>: Vùng đệm ghi đôi để đảm bảo tính toàn vẹn dữ liệu.</li>
<li><strong>Redo log</strong>: Nhật ký ghi lại các thay đổi để phục hồi sau sự cố.</li>
<li><strong>Undo log</strong>: Nhật ký hoàn tác giúp hỗ trợ giao dịch và khôi phục trạng thái trước đó của dữ liệu.</li>
</ul>
<p>InnoDB mang lại nhiều lợi ích về hiệu suất và độ tin cậy nhờ các tính năng và cấu trúc lưu trữ tiên tiến.</p>
<h2>Không gian bảng InnoDB</h2>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202406241406812.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<h3>Dòng (Row)</h3>
<p>Các bản ghi trong bảng cơ sở dữ liệu được lưu trữ theo dòng (row), mỗi dòng bản ghi có cấu trúc lưu trữ khác nhau tùy thuộc vào định dạng dòng. Sau này chúng ta sẽ giới thiệu chi tiết về định dạng dòng của InnoDB, đây cũng là nội dung chính của bài viết này.</p>
<h3>Trang (Page)</h3>
<p>Bản ghi được lưu trữ theo dòng, nhưng việc đọc cơ sở dữ liệu không phải theo "dòng", vì nếu vậy mỗi lần đọc (một lần thao tác I/O) chỉ xử lý một dòng dữ liệu, hiệu quả sẽ rất thấp. Do đó, <strong>dữ liệu của InnoDB được đọc và ghi theo đơn vị "trang"</strong>. Điều này có nghĩa là khi cần đọc một bản ghi, không phải đọc chỉ một dòng từ đĩa, mà là đọc cả một trang vào bộ nhớ.</p>
<p><strong>Mặc định mỗi trang có kích thước 16KB</strong>, có nghĩa là đảm bảo không gian lưu trữ liên tục tối đa 16KB. Trang là đơn vị quản lý nhỏ nhất của đĩa trong storage engine InnoDB, nghĩa là mỗi lần cơ sở dữ liệu đọc ghi ít nhất là 16KB, đọc từ đĩa vào bộ nhớ ít nhất là 16K, và ghi từ bộ nhớ ra đĩa ít nhất là 16K.</p>
<p>Có nhiều loại trang, phổ biến nhất là trang dữ liệu, trang nhật ký undo, trang tràn, v.v. Các bản ghi trong bảng được quản lý bởi "trang dữ liệu", cấu trúc của trang dữ liệu không được đề cập chi tiết ở đây. Bạn có thể tham khảo bài viết này để biết thêm chi tiết: <a href="https://xiaolincoding.com/mysql/index/page.html" target="_blank" rel="noopener noreferrer">Thay đổi góc nhìn về cây B+</a>.</p>
<p>Nói chung, bạn chỉ cần biết các bản ghi trong bảng được lưu trữ trong "trang dữ liệu".</p>
<h3>Vùng (Extent)</h3>
<p>Chúng ta biết rằng storage engine InnoDB tổ chức dữ liệu bằng cây B+ (B+Tree). Trong cây B+, mỗi tầng được kết nối bằng danh sách liên kết hai chiều. Nếu phân bổ không gian lưu trữ theo đơn vị trang, vị trí vật lý của hai trang liền kề trong danh sách liên kết có thể không liên tiếp, có thể rất xa nhau, điều này dẫn đến nhiều thao tác I/O ngẫu nhiên, rất chậm.</p>
<p>Giải pháp rất đơn giản, làm cho vị trí vật lý của các trang liền kề trong danh sách liên kết cũng liền kề, như vậy có thể sử dụng I/O tuần tự. Điều này cải thiện hiệu suất khi thực hiện các truy vấn phạm vi (quét các nút lá).</p>
<p>Cách cụ thể để giải quyết vấn đề này là gì?</p>
<p><strong>Khi lượng dữ liệu trong bảng lớn, việc phân bổ không gian cho một chỉ mục không còn theo đơn vị trang, mà theo đơn vị vùng (extent). Mỗi vùng có kích thước 1MB, đối với trang 16KB, 64 trang liên tiếp sẽ tạo thành một vùng. Điều này làm cho vị trí vật lý của các trang liền kề trong danh sách liên kết cũng liền kề, và có thể sử dụng I/O tuần tự</strong>.</p>
<h3>Đoạn (Segment)</h3>
<p>Không gian bảng được tạo thành từ các đoạn (segment), mỗi đoạn gồm nhiều vùng (extent). Các đoạn thường được chia thành đoạn dữ liệu, đoạn chỉ mục và đoạn hoàn tác.</p>
<ul>
<li><strong>Đoạn chỉ mục</strong>: Chứa các vùng của các nút không phải lá của cây B+.</li>
<li><strong>Đoạn dữ liệu</strong>: Chứa các vùng của các nút lá của cây B+.</li>
<li><strong>Đoạn hoàn tác</strong>: Chứa các vùng của dữ liệu hoàn tác.</li>
</ul>
<p>Vậy là chúng ta đã hoàn thành việc mô tả cấu trúc của không gian bảng. Tiếp theo, chúng ta sẽ nói chi tiết về định dạng dòng của InnoDB.</p>
<p>Việc giới thiệu vòng quanh này nhằm giúp bạn hiểu dòng bản ghi được lưu trữ ở tệp nào và khu vực nào trong không gian bảng này, từ góc nhìn từ trên xuống. Điều này giúp bạn hiểu rõ hơn và không thấy mơ hồ.</p>
<h2>Cấu trúc bộ nhớ InnoDB</h2>
<h3>Bộ đệm (Buffer Pool)</h3>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202406241416178.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Bộ đệm dùng để tăng tốc độ truy cập và chỉnh sửa dữ liệu bằng cách lưu trữ dữ liệu nóng trong bộ nhớ, giảm thiểu tối đa I/O từ đĩa và tăng tốc độ đọc và ghi dữ liệu nóng.</p>
<p>Dữ liệu trong Buffer Pool được lưu trữ theo đơn vị trang và được quản lý bằng cấu trúc danh sách liên kết đơn theo đơn vị trang. Do giới hạn của bộ nhớ, Buffer Pool chỉ có thể chứa được dữ liệu nóng nhất. Buffer Pool sử dụng thuật toán LRU (Least Recently Used) để loại bỏ dữ liệu không nóng.</p>
<p>Dựa trên nguyên lý cục bộ thời gian và không gian, Buffer Pool lưu trữ các trang dữ liệu hoạt động hiện tại bằng cách sử dụng cơ chế đọc trước (Read-ahead) để lưu trữ các trang dữ liệu gần dữ liệu mục tiêu.</p>
<p>Cơ chế đọc trước dẫn đến vấn đề đọc trước thất bại. InnoDB sử dụng cơ chế phân chia thế hệ để giải quyết vấn đề này: chia Buffer Pool thành hai phần là New SubList và Old SubList, đặt các trang dữ liệu mới đọc vào đầu Old SubList, các trang dữ liệu trong Old SubList được truy cập lại sẽ được đặt vào đầu New SubList; các trang dữ liệu lạnh thất bại trong việc đọc trước sẽ nhanh chóng bị loại bỏ khỏi Old SubList mà không ảnh hưởng đến dữ liệu nóng trong New SubList.</p>
<p>InnoDB sử dụng cơ chế cửa sổ thời gian (Time Window) để giải quyết vấn đề ô nhiễm bộ đệm: đối với các trang dữ liệu trong Old SubList, chúng phải ở lại Old SubList trong một khoảng thời gian nhất định rồi mới được chuyển vào New SubList nếu được truy cập lại. Cửa sổ mặc định là 1 giây.</p>
<p>Đối với truy vấn dữ liệu trong Buffer Pool, InnoDB sẽ đọc và trả về trực tiếp; đối với sửa đổi dữ liệu trong Buffer Pool, InnoDB sẽ sửa trực tiếp trong Buffer Pool và ghi sửa đổi vào redo Log. Khi trang dữ liệu bị thuật toán LRU loại bỏ, nó sẽ được ghi vào đĩa, nếu hệ thống gặp sự cố trước khi được ghi vào đĩa, sẽ sử dụng redo Log để khôi phục khi khởi động lại.</p>
<h3>Bộ đệm thay đổi (Change Buffer)</h3>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202406241416527.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Change Buffer dùng để tăng tốc độ ghi vào chỉ mục thứ cấp của dữ liệu không nóng. Do tính không liên tục của dữ liệu chỉ mục thứ cấp, việc sửa đổi chỉ mục thứ cấp yêu cầu I/O đĩa thường xuyên, tiêu tốn nhiều hiệu năng. Change Buffer lưu trữ các thao tác sửa đổi chỉ mục thứ cấp và ghi vào redo log. Khi Change Buffer đạt đến một lượng nhất định hoặc hệ thống ít bận rộn, nó sẽ thực hiện thao tác <code>ibuf merge</code> để ghi sửa đổi vào đĩa. Change Buffer có vùng lưu trữ bền bỉ trong không gian bảng hệ thống.</p>
<p>Kích thước Change Buffer mặc định chiếm 25% Buffer Pool, được khởi tạo khi khởi động máy chủ. Cấu trúc vật lý của nó là một cây B-Tree gọi là <code>ibuf</code>. Điều kiện sử dụng Change Buffer là:</p>
<ul>
<li>InnoDB bật <code>innodb_change_buffering</code> và bảng hiện tại không có thao tác <code>flush</code>.</li>
<li>Chỉ sửa đổi các nút lá của cây chỉ mục thứ cấp và trang chỉ mục không nằm trong Buffer Pool.</li>
<li>Đối với chỉ mục thứ cấp duy nhất, chỉ có thao tác xóa có thể được lưu vào bộ đệm.</li>
</ul>
<p>Thời điểm thực hiện <code>ibuf merge</code>:</p>
<ul>
<li>Khi người dùng sử dụng chỉ mục thứ cấp để truy vấn.</li>
<li>Khi dự đoán rằng không gian trang sẽ không đủ khi lưu trữ thao tác chèn, có thể dẫn đến phân chia trang chỉ mục.</li>
<li>Khi thao tác lưu trữ lần này dẫn đến phân chia trang cây ibuf và kích thước Change Buffer vượt quá giới hạn sau khi phân loại.</li>
<li>Khi luồng master thực hiện lệnh <code>merge</code>.</li>
<li>Khi người dùng thực hiện thao tác <code>flush</code> trên bảng.</li>
</ul>
<h3>Chỉ mục băm thích nghi (Adaptive Hash Index)</h3>
<p>Chỉ mục băm thích nghi (Adaptive Hash Index, AHI) dùng để tăng tốc độ truy vấn cho các trang dữ liệu nóng. Khi sử dụng chỉ mục cụm (clustered index) để định vị trang dữ liệu, cần đi từ nút gốc đến nút lá của cây chỉ mục, thường mất 3-4 lần truy vấn. InnoDB phân tích việc sử dụng chỉ mục và các trường chỉ mục để tạo hoặc xóa chỉ mục băm một cách tự động.</p>
<p>AHI áp dụng cho các trang dữ liệu và chỉ mục được truy vấn thường xuyên. Vì trang dữ liệu là một phần của chỉ mục cụm, AHI được xây dựng trên chỉ mục. <strong>Đối với chỉ mục thứ cấp, nếu trúng AHI, sẽ lấy trực tiếp con trỏ bản ghi từ chỉ mục thứ cấp trong AHI và sau đó theo khóa chính tìm dữ liệu dọc theo chỉ mục cụm; nếu truy vấn chỉ mục cụm cũng trúng AHI, sẽ trả về trực tiếp con trỏ bản ghi của trang dữ liệu mục tiêu, từ đó có thể định vị trang dữ liệu trực tiếp theo con trỏ bản ghi</strong>.</p>
<p>Kích thước AHI là 1/64 của Buffer Pool. Từ MySQL 5.7 trở đi, AHI hỗ trợ phân vùng để giảm cạnh tranh trên khóa AHI toàn cục, mặc định là 8 phân vùng.</p>
<h3>Bộ đệm nhật ký (Log Buffer)</h3>
<p>Bộ đệm nhật ký (Log Buffer) được dùng để lưu trữ tạm thời các dữ liệu nhật ký cần ghi vào đĩa. Tất cả các thao tác sửa đổi của InnoDB sẽ được ghi vào các tệp nhật ký như redo log, undo log. Nếu mỗi lần sửa đổi đều được ghi trực tiếp vào đĩa, sẽ gây ra rất nhiều I/O. Log Buffer tối ưu vấn đề này bằng cách lưu trữ các thao tác sửa đổi trong vùng nhớ này trước, sau đó định kỳ ghi hàng loạt vào đĩa.</p>
<p>Kích thước của bộ đệm nhật ký có thể được điều chỉnh bằng cấu hình <code>innodb_log_buffer_size</code>, mặc định là 16MB.</p>
<h2>MyISAM</h2>
<p>MyISAM là hệ thống lưu trữ mặc định của MySQL trước phiên bản 5.5.</p>
<p>MyISAM được thiết kế đơn giản với dữ liệu được lưu trữ theo định dạng nén. MyISAM thích hợp cho dữ liệu chỉ đọc, hoặc bảng nhỏ có thể chấp nhận các thao tác sửa chữa.</p>
<p>MyISAM sử dụng cấu trúc B+Tree cho chỉ mục, trong đó <strong>nút lá của trường dữ liệu lưu trữ địa chỉ của các bản ghi dữ liệu</strong>.</p>
<p>MyISAM cung cấp nhiều tính năng như: chỉ mục toàn văn, bảng nén, và các hàm không gian. Tuy nhiên, MyISAM không hỗ trợ giao dịch và khóa cấp hàng. MyISAM cũng không hỗ trợ khôi phục an toàn sau khi hệ thống gặp sự cố.</p>
<p>Cấu trúc tệp vật lý của MyISAM:</p>
<ul>
<li>Tệp <code>.frm</code>: lưu trữ thông tin siêu dữ liệu liên quan đến bảng, bao gồm định nghĩa cấu trúc bảng.</li>
<li>Tệp <code>.MYD</code> (<code>MYData</code>): dành riêng cho MyISAM để lưu trữ dữ liệu của bảng MyISAM.</li>
<li>Tệp <code>.MYI</code> (<code>MYIndex</code>): dành riêng cho MyISAM để lưu trữ thông tin liên quan đến chỉ mục của bảng MyISAM.</li>
</ul>
<h2>So sánh InnoDB và MyISAM</h2>
<p>Bảng so sánh giữa InnoDB và MyISAM:</p>
<p>| Đối chiếu    | MyISAM                                        | InnoDB                           |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202406241406713.png" type="image/png"/>
    </item>
    <item>
      <title>MySQL Guide</title>
      <link>https://vanhung4499.github.io/database/mysql/guide.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/guide.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Guide</source>
      <description>MySQL Guide Kiến trúc MySQL Để hiểu MySQL, tốt nhất là hiểu cách MySQL hoạt động ở mức độ tổng quát. Tham khảo: MySQL Architecture Storage Engine MySQL hỗ trợ nhiều loại storage...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Kiến trúc MySQL</h2>
<p>Để hiểu MySQL, tốt nhất là hiểu cách MySQL hoạt động ở mức độ tổng quát.</p>
<p>Tham khảo:&nbsp;<a href="architecture">MySQL Architecture</a></p>
<h2>Storage Engine</h2>
<p>MySQL hỗ trợ nhiều loại storage engine, mỗi loại có ưu và nhược điểm riêng.</p>
<p>Tham khảo:&nbsp;<a href="storage-engine">MySQL Storage Engine</a></p>
<h2>Kiểu dữ liệu</h2>
<h3>Kiểu số nguyên</h3>
<p><code>TINYINT</code>,&nbsp;<code>SMALLINT</code>,&nbsp;<code>MEDIUMINT</code>,&nbsp;<code>INT</code>,&nbsp;<code>BIGINT</code>&nbsp;lần lượt sử dụng 8, 16, 24, 32, 64 bit không gian lưu trữ, trong hầu hết các trường hợp, càng nhỏ càng tốt.</p>
<p><strong><code>UNSIGNED</code>&nbsp;chỉ ra rằng không cho phép giá trị âm, có thể tăng giới hạn trên cùng của số dương</strong>.</p>
<p>Số trong&nbsp;<code>INT(11)</code>&nbsp;chỉ quy định số ký tự hiển thị cho cột trong công cụ tương tác, không có ý nghĩa với việc lưu trữ và tính toán.</p>
<h3>Kiểu số thực</h3>
<p><code>FLOAT</code>&nbsp;và&nbsp;<code>DOUBLE</code>&nbsp;là kiểu số thực.</p>
<p>Kiểu&nbsp;<code>DECIMAL</code>&nbsp;chủ yếu được sử dụng cho tính toán chính xác, tuy nhiên nó tốn kém và chỉ nên sử dụng&nbsp;<code>DECIMAL</code>&nbsp;khi tính toán số thập phân chính xác - ví dụ: lưu trữ dữ liệu tài chính. Khi có số lượng dữ liệu lớn, có thể sử dụng&nbsp;<code>BIGINT</code>&nbsp;thay thế&nbsp;<code>DECIMAL</code>.</p>
<p><code>FLOAT</code>,&nbsp;<code>DOUBLE</code>&nbsp;và&nbsp;<code>DECIMAL</code>&nbsp;có thể chỉ định chiều rộng cột, ví dụ&nbsp;<code>DECIMAL(18, 9)</code>&nbsp;chỉ ra tổng cộng 18 chữ số, 9 chữ số được sử dụng để lưu trữ phần thập phân.</p>
<h3>Kiểu chuỗi</h3>
<p>Chủ yếu có hai loại kiểu chuỗi là&nbsp;<code>CHAR</code>&nbsp;và&nbsp;<code>VARCHAR</code>, một loại là cố định, một loại là biến đổi.</p>
<p><strong>Kiểu biến đổi&nbsp;<code>VARCHAR</code>&nbsp;này có thể tiết kiệm không gian vì chỉ cần lưu trữ nội dung cần thiết. Tuy nhiên, khi thực hiện UPDATE, có thể làm cho hàng trở nên dài hơn so với ban đầu</strong>. Khi vượt quá kích thước mà một trang có thể chứa, sẽ có thêm hoạt động. MyISAM sẽ chia hàng thành các đoạn khác nhau để lưu trữ, trong khi InnoDB cần phải chia trang để đưa hàng vào trang.</p>
<p><code>VARCHAR</code>&nbsp;sẽ giữ các khoảng trắng ở cuối chuỗi, trong khi&nbsp;<code>CHAR</code>&nbsp;sẽ xóa chúng.</p>
<h3>Thời gian và ngày tháng</h3>
<p>MySQL cung cấp hai loại ngày tháng tương tự nhau:&nbsp;<code>DATATIME</code>&nbsp;và&nbsp;<code>TIMESTAMP</code>.</p>
<h4>DATATIME</h4>
<p>Có thể lưu trữ ngày tháng và thời gian từ năm 1001 đến năm 9999, với độ chính xác đến giây, sử dụng 8 byte không gian lưu trữ.</p>
<p>Nó không phụ thuộc vào múi giờ.</p>
<p>Mặc định, MySQL hiển thị giá trị DATATIME dưới dạng có thể sắp xếp, không gây hiểu lầm, ví dụ: "2008-01-16 22:37:08", đây là cách biểu diễn ngày tháng và thời gian được định nghĩa bởi tiêu chuẩn ANSI.</p>
<h4>TIMESTAMP</h4>
<p>Tương tự như dấu thời gian UNIX, lưu trữ số giây kể từ năm 1970, sử dụng 4 byte, chỉ có thể biểu diễn từ năm 1970 đến năm 2038.</p>
<p>Nó phụ thuộc vào múi giờ, có nghĩa là một dấu thời gian có thể đại diện cho thời gian cụ thể khác nhau trong các múi giờ khác nhau.</p>
<p>MySQL cung cấp hàm FROM_UNIXTIME() để chuyển đổi dấu thời gian UNIX thành ngày tháng và cung cấp hàm UNIX_TIMESTAMP() để chuyển đổi ngày tháng thành dấu thời gian UNIX.</p>
<p>Mặc định, nếu không chỉ định giá trị cột TIMESTAMP khi chèn, giá trị này sẽ được đặt thành thời gian hiện tại.</p>
<p>Nên sử dụng TIMESTAMP nếu có thể, vì nó có hiệu suất cao hơn so với DATETIME.</p>
<h3>BLOB và TEXT</h3>
<p><code>BLOB</code>&nbsp;và&nbsp;<code>TEXT</code>&nbsp;đều được thiết kế để lưu trữ dữ liệu lớn, cái trước là dữ liệu nhị phân, cái sau là dữ liệu chuỗi.</p>
<p>Không thể sắp xếp hoặc tạo chỉ mục cho toàn bộ nội dung của kiểu&nbsp;<code>BLOB</code>&nbsp;và&nbsp;<code>TEXT</code>.</p>
<h3>Kiểu enum</h3>
<p>Trong hầu hết các trường hợp, không cần sử dụng kiểu enum. Một trong những nhược điểm của kiểu enum là danh sách chuỗi enum là cố định, việc thêm và xóa chuỗi (lựa chọn enum) phải sử dụng&nbsp;<code>ALTER TABLE</code>&nbsp;(nếu chỉ thêm vào cuối danh sách, không cần xây dựng lại bảng).</p>
<h3>Lựa chọn kiểu dữ liệu</h3>
<ul>
<li>Kiểu số nguyên thường là lựa chọn tốt nhất cho cột định danh, vì chúng nhanh chóng và có thể sử dụng&nbsp;<code>AUTO_INCREMENT</code>.</li>
<li>Kiểu&nbsp;<code>ENUM</code>&nbsp;và&nbsp;<code>SET</code>&nbsp;thường là lựa chọn tồi, nên tránh sử dụng chúng.</li>
<li>Nên tránh sử dụng kiểu chuỗi làm cột định danh, vì chúng chiếm không gian và thường chậm hơn kiểu số. Đối với các chuỗi ngẫu nhiên như&nbsp;<code>MD5</code>,&nbsp;<code>SHA</code>,&nbsp;<code>UUID</code>, do tính ngẫu nhiên, nên lưu trữ dưới dạng số lượng lớn, có thể sử dụng&nbsp;<code>BIGINT</code>&nbsp;thay cho&nbsp;<code>DECIMAL</code>. Để lưu trữ UUID, nên xóa dấu&nbsp;<code>-</code>; cách tốt hơn là chuyển đổi giá trị UUID thành số 16 byte bằng cách sử dụng hàm&nbsp;<code>UNHEX()</code>&nbsp;và lưu trữ trong cột&nbsp;<code>BINARY(16)</code>, khi truy vấn, có thể định dạng lại thành định dạng hexa bằng cách sử dụng hàm&nbsp;<code>HEX()</code>.</li>
</ul>
<h2>Chỉ mục</h2>
<p>Chi tiết xem:&nbsp;<a href="mysql-index">MySQL Index</a></p>
<h2>Khóa</h2>
<p>Chi tiết xem:&nbsp;<a href="locks">MySQL Locks</a></p>
<h2>Giao dịch</h2>
<p>Chi tiết xem:&nbsp;<a href="transactions">MySQL Transactions</a></p>
<h2>Tối ưu hiệu suất</h2>
<p>Chi tiết xem:&nbsp;<a href="performance-optimization">MySQL Performance Optimization</a></p>
<h2>Replication</h2>
<h3>Sao chép Master-Slave</h3>
<p>MySQL hỗ trợ hai phương pháp sao chép: sao chép dựa trên hàng và sao chép dựa trên câu lệnh.</p>
<p>Cả hai phương pháp đều ghi lại nhật ký nhị phân trên máy chủ chính và sau đó chạy lại nhật ký trên máy chủ phụ để thực hiện sao chép dữ liệu không đồng bộ. Điều này có nghĩa là quá trình sao chép có độ trễ và trong khoảng thời gian này, dữ liệu trên máy chủ chính và máy chủ phụ có thể không nhất quán.</p>
<p>Chủ yếu liên quan đến ba luồng: luồng nhật ký nhị phân, luồng I/O và luồng SQL.</p>
<ul>
<li><strong>Luồng nhật ký nhị phân</strong>: Đảm nhiệm việc ghi dữ liệu thay đổi từ máy chủ chính vào tệp nhật ký nhị phân (binlog).</li>
<li><strong>Luồng I/O</strong>: Đảm nhiệm đọc tệp nhật ký nhị phân từ máy chủ chính và ghi vào nhật ký chuyển tiếp trên máy chủ phụ.</li>
<li><strong>Luồng SQL</strong>: Đảm nhiệm đọc nhật ký chuyển tiếp và thực thi các câu lệnh SQL.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721153816.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h3>Phân tách đọc ghi</h3>
<p>Máy chủ chính được sử dụng để xử lý các hoạt động ghi và các hoạt động đọc có yêu cầu thời gian thực cao, trong khi máy chủ phụ được sử dụng để xử lý các hoạt động đọc.</p>
<p>Phân tách đọc ghi thường được thực hiện thông qua proxy, trong đó máy chủ proxy nhận các yêu cầu đọc và ghi từ ứng dụng, sau đó quyết định chuyển tiếp yêu cầu đến máy chủ nào.</p>
<p>Phân tách đọc ghi trong MySQL có thể cải thiện hiệu suất vì:</p>
<ul>
<li>Máy chủ chính và máy chủ phụ chịu trách nhiệm cho các hoạt động đọc và ghi riêng biệt, giảm đáng kể sự cạnh tranh khóa;</li>
<li>Máy chủ phụ có thể được cấu hình để sử dụng hệ thống lưu trữ MyISAM, cải thiện hiệu suất truy vấn và tiết kiệm tài nguyên hệ thống;</li>
<li>Tăng tính dự phòng, cải thiện khả năng sẵn có.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/master-slave-proxy.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721153816.png" type="image/png"/>
    </item>
    <item>
      <title>Lock</title>
      <link>https://vanhung4499.github.io/database/mysql/lock.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/lock.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Lock</source>
      <description>MySQL Lock Khóa lạc quan và khóa bi quan Đảm bảo không làm hỏng tính cô lập, tính thống nhất và tính thống nhất của cơ sở dữ liệu khi nhiều giao dịch truy cập cùng một dữ liệu t...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Khóa lạc quan và khóa bi quan</h2>
<p>Đảm bảo không làm hỏng tính cô lập, tính thống nhất và tính thống nhất của cơ sở dữ liệu khi nhiều giao dịch truy cập cùng một dữ liệu trong cùng một thời điểm, <strong>khóa lạc quan và khóa bi quan là các phương pháp kỹ thuật được sử dụng chính cho kiểm soát đồng thời</strong>.</p>
<ul>
<li><strong><code>Khóa bi quan</code></strong> - Giả định xảy ra xung đột đồng thời và chặn mọi hoạt động có thể vi phạm tính toàn vẹn dữ liệu.
<ul>
<li>Khóa giao dịch ngay sau khi truy vấn dữ liệu, và chỉ mở khóa khi giao dịch được cam kết (<code>COMMIT</code>).</li>
<li>Cách thực hiện: <strong>Sử dụng cơ chế khóa trong cơ sở dữ liệu</strong>.</li>
</ul>
</li>
<li><strong><code>Khóa lạc quan</code></strong> - Giả định không xảy ra xung đột đồng thời và chỉ kiểm tra vi phạm tính toàn vẹn dữ liệu khi thực hiện thao tác gửi đi.
<ul>
<li>Khóa giao dịch khi thay đổi dữ liệu và sử dụng phiên bản để khóa.</li>
<li>Cách thực hiện: <strong>Sử dụng phiên bản hoặc dấu thời gian</strong>.</li>
</ul>
</li>
</ul>
<p>【Ví dụ】Ví dụ về khóa lạc quan</p>
<p>Bảng hàng hóa (goods) có một trường status, trong đó status = 1 cho biết hàng hóa chưa được đặt hàng, status = 2 cho biết hàng hóa đã được đặt hàng, vì vậy khi đặt hàng cho một mặt hàng cần đảm bảo status của mặt hàng đó là 1. Giả sử id của mặt hàng là 1.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD">version</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> t_goods </span><span style="color:#C678DD;--shiki-dark:#C678DD">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">#{id}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> t_goods</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">set</span><span style="color:#C678DD;--shiki-dark:#C678DD"> status</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#C678DD;--shiki-dark:#C678DD">version</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#C678DD;--shiki-dark:#C678DD">version</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">+</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">#{id} </span><span style="color:#C678DD;--shiki-dark:#C678DD">and</span><span style="color:#C678DD;--shiki-dark:#C678DD"> version</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">#{</span><span style="color:#C678DD;--shiki-dark:#C678DD">version</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">};</span></span></code></pre>
</div><h2>Khóa bảng và khóa hàng</h2>
<p>Dựa trên phạm vi khóa của cơ sở dữ liệu, MySQL cung cấp hai loại khóa: khóa hàng và khóa bảng.</p>
<ul>
<li><strong>Khóa bảng (table lock)</strong> - Khóa toàn bộ bảng. Trước khi người dùng thực hiện thao tác ghi trên bảng, cần có khóa ghi, điều này sẽ chặn tất cả các hoạt động đọc và ghi của người dùng khác trên bảng đó. Chỉ khi không có khóa ghi, người dùng khác mới có thể nhận được khóa đọc và các khóa đọc không chặn lẫn nhau.</li>
<li><strong>Khóa hàng (row lock)</strong> - Khóa các bản ghi hàng định. Điều này cho phép các tiến trình khác vẫn có thể thực hiện các hoạt động trên các bản ghi khác trong cùng một bảng.</li>
</ul>
<p>Nên chỉ khóa các dữ liệu cần thay đổi, không phải tất cả tài nguyên. <strong>Càng khóa ít dữ liệu, tần suất cạnh tranh khóa càng ít, độ đồng thời của hệ thống càng cao</strong>. Tuy nhiên, việc khóa cần tiêu tốn tài nguyên và các hoạt động liên quan đến khóa (bao gồm lấy khóa, giải phóng khóa và kiểm tra trạng thái khóa) đều làm tăng chi phí của hệ thống. Do đó, <strong>độ đồng thời của khóa càng nhỏ, chi phí của hệ thống càng lớn</strong>.</p>
<p>Khi chọn mức độ chi tiết của khóa, cần phải cân bằng giữa chi phí khóa và độ đồng thời của hệ thống.</p>
<p>Trong <code>InnoDB</code>, <strong>khóa hàng được thực hiện bằng cách khóa các mục nhập chỉ mục (index entry) trên chỉ mục (index)</strong>. <strong>Nếu không có chỉ mục, <code>InnoDB</code> sẽ khóa bản ghi thông qua chỉ mục cụm ẩn</strong>.</p>
<h2>Khóa đọc và khóa ghi</h2>
<ul>
<li>Khóa độc quyền (Exclusive), viết tắt là khóa X, còn được gọi là khóa ghi. Cách sử dụng: <code>SELECT … FOR UPDATE;</code></li>
<li>Khóa chia sẻ (Shared), viết tắt là khóa S, còn được gọi là khóa đọc. Cách sử dụng: <code>SELECT … LOCK IN SHARE MODE;</code></li>
</ul>
<p>Mối quan hệ giữa khóa ghi và khóa đọc, nói một cách đơn giản: <strong>Khi có khóa độc quyền tồn tại, các giao dịch khác không thể thực hiện bất kỳ hoạt động nào</strong>.</p>
<p><strong>Khóa hàng, khóa khoảng (gap lock) và khóa next-key trong <code>InnoDB</code> đều thuộc loại khóa độc quyền</strong>.</p>
<h2>Khóa ý định</h2>
<p><strong>Khi có khóa bảng và khóa hàng cùng tồn tại, trước tiên phải yêu cầu khóa ý định (khóa bảng, nhưng không phải khóa thực sự), sau đó mới nhận được khóa hàng</strong>. Sử dụng khóa ý định (Intention Lock) có thể dễ dàng hỗ trợ nhiều mức khóa.</p>
<p><strong>Khóa ý định được <code>InnoDB</code> tự động thêm vào, không cần can thiệp của người dùng</strong>.</p>
<p>Khi có khóa hàng và khóa bảng, giao dịch T muốn khóa bảng A bằng khóa X, chỉ cần kiểm tra xem có giao dịch khác đã khóa bảng A hoặc một hàng nào đó trong bảng A bằng khóa X/IX/S/IS chưa. Nếu đã khóa, có nghĩa là có giao dịch khác đang sử dụng bảng này hoặc khóa của một hàng trong bảng này, do đó giao dịch T không thể khóa thành công.</p>
<p>Các quy tắc khóa ý định:</p>
<ul>
<li>IX/IS là khóa bảng;</li>
<li>X/S là khóa hàng.</li>
<li>Trước khi một giao dịch nhận khóa S cho một hàng dữ liệu nào đó, trước tiên phải nhận khóa IS hoặc khóa mạnh hơn trên bảng;</li>
<li>Trước khi một giao dịch nhận khóa X cho một hàng dữ liệu nào đó, trước tiên phải nhận khóa IX hoặc khóa mạnh hơn trên bảng.</li>
</ul>
<p>Bằng cách giới thiệu khóa ý định, giao dịch T muốn khóa bảng A bằng khóa X chỉ cần kiểm tra xem có giao dịch khác đã khóa A bằng khóa X/IX/S/IS chưa, nếu đã khóa thì có nghĩa là có giao dịch khác đang sử dụng bảng này hoặc một hàng trong bảng này, do đó giao dịch T không thể khóa thành công.</p>
<p>Các quan hệ khóa khác nhau như sau:</p>
<table>
<thead>
<tr>
<th style="text-align:center">-</th>
<th style="text-align:center">X</th>
<th style="text-align:center">IX</th>
<th style="text-align:center">S</th>
<th style="text-align:center">IS</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">X</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
</tr>
<tr>
<td style="text-align:center">IX</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✔️</td>
</tr>
<tr>
<td style="text-align:center">S</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
</tr>
<tr>
<td style="text-align:center">IS</td>
<td style="text-align:center">❌</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
<td style="text-align:center">✔️</td>
</tr>
</tbody>
</table>
<p>Giải thích:</p>
<ul>
<li>Bất kỳ khóa IS/IX nào cũng tương thích với nhau, vì chúng chỉ đại diện cho việc muốn khóa bảng, không phải khóa thực sự;</li>
<li>Quan hệ tương thích áp dụng cho khóa cấp bảng, trong khi khóa IX cấp bảng và khóa X cấp hàng tương thích với nhau. Hai giao dịch có thể đặt khóa X trên hai hàng dữ liệu (Giao dịch T1 muốn đặt khóa X trên hàng R1, Giao dịch T2 muốn đặt khóa X trên hàng R2 của cùng một bảng. Cả hai giao dịch đều cần phải đặt khóa IX trên bảng này, nhưng các loại khóa này là tương thích và tương thích với khoá X cấp hàng nghĩa là cả hai giao dịch có thể khoá thành công và chỉnh sửa hai hàng dữ liệu trong cùng một bảng).</li>
</ul>
<h2>MVCC</h2>
<p><strong>Điều khiển đồng thời đa phiên bản (Multi-Version Concurrency Control, MVCC)</strong>&nbsp;có thể coi là một biến thể của khóa cấp hàng. Trong nhiều trường hợp, nó tránh được các hoạt động khóa, do đó có chi phí thấp hơn. Không chỉ có Mysql, các cơ sở dữ liệu khác như Oracle, PostgreSQL cũng đã triển khai MVCC của riêng họ, không có tiêu chuẩn thống nhất cho cơ chế triển khai.</p>
<p>MVCC là một cách cụ thể để triển khai cấp độ cô lập trong động cơ lưu trữ InnoDB, <strong>được sử dụng để triển khai cấp độ đọc đã cam kết và đọc lặp lại</strong>. Cấp độ đọc chưa cam kết luôn đọc dòng dữ liệu mới nhất, yêu cầu thấp, không cần sử dụng MVCC. Cấp độ tuần tự hóa yêu cầu khóa tất cả các dòng dữ liệu đọc, không thể triển khai chỉ bằng MVCC.</p>
<h3>Ý tưởng của MVCC</h3>
<p>Việc khóa có thể giải quyết vấn đề nhất quán đồng thời xảy ra khi nhiều giao dịch được thực hiện cùng một lúc. Trong các tình huống thực tế, thao tác đọc thường nhiều hơn thao tác ghi, do đó, khóa đọc và ghi được giới thiệu để tránh các hoạt động khóa không cần thiết, chẳng hạn như không có mối quan hệ cạnh tranh giữa đọc và đọc. Thao tác đọc và ghi trong khóa đọc và ghi vẫn tương đối cạnh tranh.</p>
<p>Ý tưởng của MVCC là:</p>
<ul>
<li><strong>Lưu trữ bản chụp (snapshot) của dữ liệu tại một thời điểm nào đó, các thao tác ghi (DELETE, INSERT, UPDATE) cập nhật bản chụp phiên bản mới nhất; trong khi các thao tác đọc truy cập bản chụp phiên bản cũ, không có mối quan hệ cạnh tranh</strong>. Điều này tương tự như&nbsp;<code>CopyOnWrite</code>.</li>
<li>Đọc bẩn và đọc lại không nhất quán là do&nbsp;<strong>giao dịch đọc các thay đổi chưa được giao dịch khác cam kết</strong>. Khi giao dịch thực hiện thao tác đọc, để giải quyết vấn đề đọc bẩn và đọc không nhất quán,&nbsp;<strong>MVCC quy định chỉ có thể đọc bản chụp đã cam kết</strong>. Tất nhiên, một giao dịch có thể đọc bản chụp chưa được cam kết của chính nó, điều này không được coi là đọc bẩn.</li>
</ul>
<h3>Số phiên bản</h3>
<p>Triển khai MVCC của InnoDB là: lưu trữ hai cột ẩn sau mỗi dòng ghi, một cột lưu trữ thời gian tạo dòng, cột còn lại lưu trữ thời gian hết hạn của dòng (thời gian ở đây có nghĩa là số phiên bản hệ thống). Mỗi khi bắt đầu một giao dịch mới, số phiên bản hệ thống sẽ tự động tăng lên, số phiên bản hệ thống tại thời điểm bắt đầu giao dịch sẽ được sử dụng làm số phiên bản của giao dịch, để so sánh với số phiên bản của mỗi dòng ghi được truy vấn.</p>
<ul>
<li>Số phiên bản hệ thống&nbsp;<code>SYS_ID</code>: là một số tăng dần, mỗi khi bắt đầu một giao dịch mới, số phiên bản hệ thống sẽ tự động tăng lên.</li>
<li>Số phiên bản giao dịch&nbsp;<code>TRX_ID</code>: số phiên bản hệ thống tại thời điểm bắt đầu giao dịch.</li>
</ul>
<h3>Undo log</h3>
<p>MVCC của nhiều phiên bản đề cập đến việc lưu trữ nhiều bản chụp, bản chụp được lưu trữ trong Undo log, log này kết nối tất cả các bản chụp của một dòng dữ liệu thông qua con trỏ rollback&nbsp;<code>ROLL_PTR</code>.</p>
<p>Ví dụ, trong MySQL, tạo một bảng t, bao gồm khóa chính id và một trường x. Chúng ta chèn một dòng dữ liệu trước, sau đó thực hiện hai lần cập nhật trên dòng đó.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> t(id, x) </span><span style="color:#C678DD;--shiki-dark:#C678DD">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">"a"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> t </span><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> x</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">"b"</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> t </span><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> x</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">"c"</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> id</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Vì không sử dụng&nbsp;<code>START TRANSACTION</code>&nbsp;để thực hiện các hoạt động trên như một giao dịch, theo cơ chế&nbsp;<code>AUTOCOMMIT</code>&nbsp;của MySQL, mỗi hoạt động sẽ được coi là một giao dịch, vì vậy tổng cộng có ba giao dịch.<br>
Trong bản chụp, ngoài việc ghi lại số phiên bản của giao dịch <code>TRX_ID</code> và các hoạt động, còn có một trường DEL kiểu bit để đánh dấu xem liệu nó đã bị xóa hay chưa.</p>
<p><code>INSERT</code>, <code>UPDATE</code>, và <code>DELETE</code> sẽ tạo ra một bản ghi nhật ký và ghi số phiên bản giao dịch <code>TRX_ID</code>. <code>DELETE</code> có thể coi là một loại đặc biệt của <code>UPDATE</code>, ngoài ra còn thiết lập trường DEL thành 1.</p>
<h3>ReadView</h3>
<p>MVCC duy trì một&nbsp;<code>consistent read view</code>, chứa danh sách các giao dịch chưa được cam kết trong hệ thống&nbsp;<code>TRX_IDs {TRX_ID_1, TRX_ID_2, …}</code>, cùng với giá trị nhỏ nhất và lớn nhất của danh sách đó&nbsp;<code>TRX_ID_MIN</code>&nbsp;và&nbsp;<code>TRX_ID_MAX</code>.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/mysql-mvcc-readview.png" alt="mysql-mvcc-readview.png" tabindex="0" loading="lazy"><figcaption>mysql-mvcc-readview.png</figcaption></figure>
<p>Như vậy, đối với thời điểm bắt đầu của giao dịch hiện tại, một phiên bản dữ liệu hàng <code>trx_id</code> có thể có các trường hợp sau:</p>
<ol>
<li>Nếu nằm trong phần màu xanh lá cây, đó chỉ là phiên bản của một giao dịch đã được cam kết hoặc được tạo bởi chính giao dịch hiện tại, dữ liệu này có thể nhìn thấy.</li>
<li>Nếu nằm trong phần màu đỏ, đó chỉ là phiên bản được tạo bởi một giao dịch sẽ được khởi động trong tương lai, nó chắc chắn không thể nhìn thấy.</li>
<li>Nếu nằm trong phần màu cam, có hai trường hợp:
<ul>
<li>Nếu hàng <code>trx_id</code> có trong mảng, đó chỉ là phiên bản được tạo bởi một giao dịch chưa được cam kết, không thể nhìn thấy.</li>
<li>Nếu hàng <code>trx_id</code> không có trong mảng, đó chỉ là phiên bản được tạo bởi một giao dịch đã được cam kết, có thể nhìn thấy.</li>
</ul>
</li>
</ol>
<p>Khi thực hiện thao tác&nbsp;<code>SELECT</code>, ta có thể xác định được khả năng sử dụng bản chụp hàng dữ liệu dựa trên mối quan hệ giữa <code>TRX_ID</code> của bản chụp và <code>TRX_ID_MIN</code> cũng như <code>TRX_ID_MAX</code>.</p>
<ul>
<li><code>TRX_ID</code>&nbsp;&lt;&nbsp;<code>TRX_ID_MIN</code>, đó là phiên bản dòng dữ liệu đã được thay đổi trước tất cả các giao dịch chưa được cam kết hiện tại, do đó có thể sử dụng.</li>
<li><code>TRX_ID</code>&nbsp;&gt;&nbsp;<code>TRX_ID_MAX</code>, đó là phiên bản dòng dữ liệu đã được thay đổi sau khi giao dịch bắt đầu, do đó không thể sử dụng.</li>
<li><code>TRX_ID_MIN</code>&nbsp;&lt;=&nbsp;<code>TRX_ID</code>&nbsp;&lt;=&nbsp;<code>TRX_ID_MAX</code>, cần xác định dựa trên cấp độ cô lập:
<ul>
<li>Đọc đã cam kết: Nếu&nbsp;<code>TRX_ID</code>&nbsp;có trong danh sách&nbsp;<code>TRX_IDs</code>, đó là phiên bản dòng dữ liệu tương ứng với giao dịch chưa được cam kết, do đó phiên bản này không thể sử dụng. Nếu không, đó là phiên bản đã được cam kết, có thể sử dụng.</li>
<li>Đọc lặp lại: không thể sử dụng cả hai. Vì nếu có thể sử dụng, thì các giao dịch khác cũng có thể đọc phiên bản dòng dữ liệu này và thực hiện thay đổi, khiến giá trị đọc của giao dịch hiện tại thay đổi, tức là xảy ra vấn đề đọc lặp lại không nhất quán.</li>
</ul>
</li>
</ul>
<p>Trong trường hợp không thể sử dụng bản chụp hàng dữ liệu, cần tìm đến chỉ số cuộn <code>ROLL_PTR</code> trong Undo Log để tìm bản chụp tiếp theo và tiến hành kiểm tra như đã nêu ở trên.</p>
<h3>Đọc bản chụp và đọc hiện tại</h3>
<p><strong>Đọc bản chụp</strong></p>
<p>Thao tác <code>SELECT</code> của MVCC là dữ liệu trong bản chụp, không cần thực hiện hoạt động khóa.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#C678DD;--shiki-dark:#C678DD"> table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ...;</span></span></code></pre>
</div><p><strong>Đọc hiện tại</strong></p>
<p>Các hoạt động khác của MVCC sẽ thay đổi cơ sở dữ liệu (<code>INSERT</code>, <code>UPDATE</code>, <code>DELETE</code>) cần thực hiện hoạt động khóa để đọc dữ liệu mới nhất. Có thể thấy MVCC không hoàn toàn không sử dụng khóa, mà chỉ tránh việc áp dụng khóa cho <code>SELECT</code>.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">INSERT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">UPDATE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">DELETE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Khi thực hiện thao tác <code>SELECT</code>, có thể bắt buộc chỉ định thực hiện khóa. Câu lệnh đầu tiên yêu cầu khóa S, câu lệnh thứ hai yêu cầu khóa X.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#C678DD;--shiki-dark:#C678DD"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ? lock </span><span style="color:#C678DD;--shiki-dark:#C678DD">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> share mode;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#C678DD;--shiki-dark:#C678DD"> table</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ? </span><span style="color:#C678DD;--shiki-dark:#C678DD">for</span><span style="color:#C678DD;--shiki-dark:#C678DD"> update</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h2>Khóa hàng</h2>
<p>Có ba thuật toán cụ thể để triển khai khóa hàng (row lock): khóa bản ghi (record lock), Khoá khoảng (gap lock) và khóa next-key.</p>
<ul>
<li><code>Khóa bản ghi (Record Lock)</code> - <strong>Khóa hàng bằng cách khóa các mục chỉ mục (index entry), nếu không có chỉ mục thì sử dụng khóa bảng</strong>.</li>
<li><code>Khoá khoảng (Gap Lock)</code> - <strong>Khoá khoảng giữa các mục chỉ mục (index entry)</strong>. Khoá khoảng giữa các mục chỉ mục, nhưng không bao gồm chính mục chỉ mục đó. Ví dụ, khi một giao dịch thực hiện câu lệnh sau, các giao dịch khác không thể chèn giá trị 15 vào cột c trong bảng t: <code>SELECT c FROM t WHERE c BETWEEN 10 and 20 FOR UPDATE;</code>. Trong MySQL, Khoá khoảng mặc định là được bật, tức là giá trị của tham số <code>innodb_locks_unsafe_for_binlog</code> là <code>disable</code>, và mặc định trong MySQL là cấp độ cô lập giao dịch RR.</li>
<li><code>Khóa next-key</code> - Đây là sự kết hợp của <code>Khóa bản ghi (record lock)</code> và <code>Khoá khoảng (gap lock)</code>. Nó không chỉ khóa một mục chỉ mục trên một bản ghi, mà còn khoá khoảng giữa các chỉ mục. Nó khóa một khoảng mở phía trước và đóng phía sau.</li>
</ul>
<p>Chỉ có cáchoạt động cụ thể trong cấp độ cô lập đọc có thể lặp lại hoặc cao hơn mới sẽ nhận được khóa khoảng (gap lock) hoặc khóa next-key. Trong các câu lệnh <code>SELECT</code>, <code>UPDATE</code> và <code>DELETE</code>, ngoại trừ các truy vấn dựa trên chỉ mục duy nhất, các truy vấn dựa trên chỉ mục khác đều lấy khoá khoảng hoặc khóa next-key, tức là khóa phạm vi quét của chúng. Chỉ mục khóa chính cũng được coi là chỉ mục duy nhất, vì vậy chỉ mục khóa chính không sử dụng khóa khoảng (gap lock) hoặc khóa next-key.</p>
<p>MVCC không thể giải quyết vấn đề đọc lại không nhất quán, <strong>khóa next-key được tạo ra để giải quyết vấn đề đọc lại không nhất quán</strong>. Trong cấp độ cô lập đọc có thể lặp lại (<code>REPEATABLE READ</code>), sử dụng <strong>MVCC + Khóa next-key</strong> có thể giải quyết vấn đề đọc lại không nhất quán.</p>
<p>Chỉ mục được chia thành chỉ mục khóa chính (primary index) và chỉ mục khoá phụ (không phải khóa chính - non-primary index). Nếu một câu lệnh SQL thao tác trên chỉ mục khóa chính, MySQL sẽ khóa chỉ mục khóa chính đó; nếu một câu lệnh thao tác trên chỉ mục khoá phụ, MySQL sẽ khóa chỉ mục khoá phụ đó trước, sau đó khóa chỉ mục khóa chính liên quan. Trong các câu lệnh <code>UPDATE</code> và <code>DELETE</code>, MySQL không chỉ khóa tất cả các bản ghi chỉ mục được quét bởi điều kiện <code>WHERE</code>, mà còn khóa các giá trị liền kề, còn được gọi là <code>khóa next-key</code>.</p>
<p>Khi hai giao dịch được thực hiện đồng thời, một giao dịch khóa chỉ mục khoá chính và đang chờ đợi các chỉ mục liên quan. Giao dịch khác khóa chỉ mục khoá phụ và đang chờ đợi chỉ mục khoá chính liên quan. Điều này dẫn đến tình trạng bế tắc. Sau khi xảy ra tình trạng bế tắc, <code>InnoDB</code> thường có thể phát hiện và làm cho một giao dịch giải phóng khóa và rollback, và giao dịch khác tiếp tục lấy khóa để hoàn thành giao dịch.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/mysql-mvcc-readview.png" type="image/png"/>
    </item>
    <item>
      <title>MySQL Index</title>
      <link>https://vanhung4499.github.io/database/mysql/mysql-index.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/mysql-index.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Index</source>
      <description>MySQL Index Chỉ mục là một phương pháp quan trọng để cải thiện hiệu suất truy vấn trong MySQL, nhưng quá nhiều chỉ mục có thể dẫn đến sử dụng đĩa cao và chiếm nhiều bộ nhớ, ảnh ...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Chỉ mục là một phương pháp quan trọng để cải thiện hiệu suất truy vấn trong MySQL, nhưng quá nhiều chỉ mục có thể dẫn đến sử dụng đĩa cao và chiếm nhiều bộ nhớ, ảnh hưởng đến hiệu suất tổng thể của ứng dụng. Nên tránh việc thêm chỉ mục sau khi đã triển khai, vì sau đó có thể cần giám sát nhiều truy vấn SQL để xác định vị trí của vấn đề, và thời gian thêm chỉ mục nhất định là lớn hơn thời gian ban đầu để thêm chỉ mục, điều này cho thấy việc thêm chỉ mục cũng rất có tính kỹ thuật.</p>
<p>Tiếp theo, tôi sẽ giới thiệu cho bạn một loạt các chiến lược tạo chỉ mục hiệu suất cao và nguyên tắc làm việc đằng sau mỗi chiến lược. Tuy nhiên, trước khi đi vào chi tiết, hãy tìm hiểu một số thuật toán và cấu trúc dữ liệu liên quan đến chỉ mục, điều này sẽ giúp bạn hiểu rõ hơn nội dung sau này.</p>
</blockquote>
<h2>Giới thiệu về chỉ mục</h2>
<p><strong>Chỉ mục là một cấu trúc dữ liệu trong cơ sở dữ liệu được sử dụng để cải thiện hiệu suất tìm kiếm</strong>.</p>
<p>Chỉ mục là yếu tố quan trọng cho hiệu suất tốt, khi dữ liệu nhỏ và tải không cao, tác động của chỉ mục không thể thấy rõ; nhưng khi dữ liệu tăng dần, hiệu suất sẽ giảm đáng kể. Do đó, tối ưu chỉ mục là biện pháp hiệu quả nhất để tối ưu hiệu suất truy vấn.</p>
<h3>Ưu và nhược điểm của chỉ mục</h3>
<p>B-Tree là cấu trúc dữ liệu chỉ mục phổ biến nhất, lưu trữ dữ liệu theo thứ tự, vì vậy MySQL có thể được sử dụng để thực hiện các hoạt động&nbsp;<code>ORDER BY</code>&nbsp;và&nbsp;<code>GROUP BY</code>. Vì dữ liệu được sắp xếp, B-Tree cũng sẽ lưu trữ các giá trị cột liên quan cùng nhau. Cuối cùng, vì chỉ mục lưu trữ các giá trị cột thực tế, nên một số truy vấn chỉ cần sử dụng chỉ mục để hoàn thành toàn bộ truy vấn.</p>
<p>✔ Ưu điểm của chỉ mục:</p>
<ul>
<li><strong>Chỉ mục giảm đáng kể lượng dữ liệu cần quét bởi máy chủ, từ đó tăng tốc độ truy vấn</strong>.</li>
<li><strong>Chỉ mục có thể giúp máy chủ tránh sắp xếp và bảng tạm thời</strong>.</li>
<li><strong>Chỉ mục có thể biến I/O ngẫu nhiên thành I/O tuần tự</strong>.</li>
<li>Các cơ sở dữ liệu hỗ trợ khóa hàng, chẳng hạn như InnoDB, sẽ khóa khi truy cập hàng.&nbsp;<strong>Sử dụng chỉ mục có thể giảm số lượng hàng truy cập, từ đó giảm sự cạnh tranh khóa và tăng cường đồng thời</strong>.</li>
<li>Chỉ mục duy nhất đảm bảo tính duy nhất của mỗi hàng dữ liệu, sử dụng chỉ mục có thể tận dụng được trình tối ưu hóa ẩn, cải thiện hiệu suất hệ thống.</li>
</ul>
<p>❌ Nhược điểm của chỉ mục:</p>
<ul>
<li><strong>Tạo và duy trì chỉ mục mất thời gian</strong>, điều này tăng theo lượng dữ liệu.</li>
<li><strong>Chỉ mục chiếm không gian vật lý bổ sung</strong>, ngoài không gian dữ liệu của bảng, mỗi chỉ mục cũng cần một không gian vật lý nhất định, nếu tạo chỉ mục kết hợp, không gian cần thiết sẽ lớn hơn.</li>
<li><strong>Có thể cần cập nhật chỉ mục khi thực hiện các hoạt động ghi (<code>INSERT</code>/<code>UPDATE</code>/<code>DELETE</code>)</strong>, dẫn đến giảm hiệu suất ghi của cơ sở dữ liệu.</li>
</ul>
<h3>Khi nào sử dụng chỉ mục</h3>
<blockquote>
<p>Chỉ mục có thể dễ dàng nâng cao hiệu suất truy vấn một vài cấp số nhân.</p>
</blockquote>
<p>✔ Trường hợp&nbsp;<strong>thích hợp</strong>&nbsp;sử dụng chỉ mục:</p>
<ul>
<li><strong>Thao tác đọc thường xuyên (<code>SELECT</code>)</strong>.</li>
<li><strong>Dữ liệu trong bảng lớn</strong>.</li>
<li><strong>Tên cột thường xuất hiện trong điều kiện&nbsp;<code>WHERE</code>&nbsp;hoặc điều kiện kết nối (<code>JOIN</code>)</strong>.</li>
</ul>
<p>❌ Trường hợp&nbsp;<strong>không thích hợp</strong>&nbsp;sử dụng chỉ mục:</p>
<ul>
<li><strong>Thao tác ghi thường xuyên (<code>INSERT</code>/<code>UPDATE</code>/<code>DELETE</code>)</strong>, điều này có nghĩa là cần cập nhật chỉ mục.</li>
<li><strong>Tên cột không thường xuất hiện trong điều kiện&nbsp;<code>WHERE</code>&nbsp;hoặc điều kiện kết nối (<code>JOIN</code>)</strong>, điều này có nghĩa là chỉ mục thường không được tìm thấy, không có ý nghĩa và tăng chi phí không gian.</li>
<li><strong>Bảng rất nhỏ</strong>, trong hầu hết các trường hợp, quét toàn bộ bảng đơn giản hơn và hiệu quả hơn cho bảng rất nhỏ.</li>
<li><strong>Bảng cỡ lớn đặc biệt</strong>, chi phí tạo và sử dụng chỉ mục sẽ tăng lên. Có thể xem xét sử dụng kỹ thuật phân vùng hoặc NoSQL.</li>
</ul>
<h2>Cấu trúc dữ liệu của chỉ mục</h2>
<p>Trong MySQL, chỉ mục được thực hiện ở bộ lưu trữ (storage engine), chứ không phải ở lớp máy chủ. Do đó, không có tiêu chuẩn chỉ mục chung; cấu trúc dữ liệu chỉ mục có thể khác nhau cho các storage engine khác nhau.</p>
<h3>Mảng (Array)</h3>
<p>Mảng là một cấu trúc dữ liệu lưu trữ dữ liệu trong một không gian bộ nhớ liên tục và hỗ trợ truy cập ngẫu nhiên.</p>
<p>Mảng được sắp xếp có thể sử dụng thuật toán tìm kiếm nhị phân, có độ phức tạp thời gian là <strong>O(log n)</strong>, cho cả truy vấn bằng giá trị và truy vấn theo phạm vi.</p>
<p>Tuy nhiên, mảng có hai hạn chế quan trọng:</p>
<ul>
<li>Kích thước không gian mảng cố định, nếu cần mở rộng chỉ có thể sử dụng cách sao chép mảng.</li>
<li>Thời gian phức tạp của việc chèn và xóa là O(n).</li>
</ul>
<p>Điều này có nghĩa là, nếu sử dụng mảng làm chỉ mục và muốn đảm bảo mảng được sắp xếp, thì việc cập nhật sẽ tốn kém.</p>
<h3>Chỉ mục băm (Hash Index)</h3>
<p>Bảng băm là một cấu trúc dữ liệu lưu trữ dữ liệu dưới dạng cặp khóa - giá trị (key-value), trong đó chúng ta chỉ cần nhập giá trị cần tìm kiếm là khóa (key), chúng ta sẽ tìm thấy giá trị tương ứng.</p>
<p><strong>Bảng băm</strong>&nbsp;sử dụng&nbsp;<strong>hàm băm</strong>&nbsp;để tổ chức dữ liệu, hỗ trợ việc chèn và tìm kiếm nhanh chóng. Cấu trúc dữ liệu bảng băm thực chất là một mảng, với ý tưởng là: sử dụng hàm băm để chuyển đổi khóa thành chỉ mục mảng, sử dụng tính chất truy cập ngẫu nhiên của mảng, cho phép chúng ta tìm kiếm trong thời gian O(1).</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220320201844.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure>
<p>Có hai loại bảng băm khác nhau:&nbsp;<strong>bảng băm tập hợp</strong>&nbsp;và&nbsp;<strong>bảng băm ánh xạ</strong>.</p>
<ul>
<li><strong>Bảng băm tập hợp</strong>&nbsp;là một cấu trúc dữ liệu để lưu trữ các giá trị không trùng lặp.</li>
<li><strong>Bảng băm ánh xạ</strong>&nbsp;là một cấu trúc dữ liệu để lưu trữ cặp khóa - giá trị, trong đó giá trị được liên kết với khóa.</li>
</ul>
<p>Chỉ mục băm dựa trên bảng băm để triển khai,&nbsp;<strong>chỉ hỗ trợ truy vấn so sánh bằng</strong>. Đối với mỗi hàng dữ liệu, chỉ mục băm sẽ tính toán một mã băm (hashcode) cho tất cả các cột chỉ mục và lưu trữ mã băm trong chỉ mục, đồng thời lưu trữ con trỏ đến mỗi hàng dữ liệu trong bảng băm.</p>
<p>Trong Mysql, chỉ có lưu trữ bộ nhớ (Memory) hiển thị hỗ trợ chỉ mục băm.</p>
<p>✔ Ưu điểm của chỉ mục băm:</p>
<ul>
<li>Vì cấu trúc dữ liệu chỉ mục gọn nhẹ, nên&nbsp;<strong>tốc độ truy vấn rất nhanh</strong>.</li>
</ul>
<p>❌ Nhược điểm của chỉ mục băm:</p>
<ul>
<li>Giá trị chỉ mục không bao gồm giá trị cột, do đó không thể sử dụng giá trị chỉ mục để tránh đọc hàng. Tuy nhiên, việc truy cập hàng trong bộ nhớ nhanh, vì vậy trong hầu hết các trường hợp, điều này không ảnh hưởng đến hiệu suất.</li>
<li>Dữ liệu chỉ mục băm không được sắp xếp theo giá trị chỉ mục, do đó&nbsp;<strong>không thể sử dụng để sắp xếp</strong>.</li>
<li>Chỉ mục băm&nbsp;<strong>không hỗ trợ truy vấn phạm vi</strong>, vì chỉ mục băm sử dụng toàn bộ nội dung cột chỉ mục để tính toán băm. Ví dụ, trên cột dữ liệu (A, B) xây dựng chỉ mục băm, nếu truy vấn chỉ có cột dữ liệu A, không thể sử dụng chỉ mục này.</li>
<li>Chỉ mục băm có thể gặp&nbsp;<strong>xung đột băm</strong>:
<ul>
<li>Khi xảy ra xung đột băm, phải duyệt qua tất cả các con trỏ hàng trong danh sách liên kết, so sánh từng hàng một cho đến khi tìm thấy hàng phù hợp.</li>
<li>Nếu xung đột băm nhiều, việc duy trì chỉ mục sẽ tốn kém.</li>
</ul>
</li>
</ul>
<blockquote>
<p>Vì các hạn chế trên, chỉ mục băm chỉ phù hợp cho các tình huống cụ thể. Tuy nhiên, một khi sử dụng chỉ mục băm, hiệu suất cải thiện sẽ rất đáng kể.</p>
</blockquote>
<h3>Chỉ mục B-Tree</h3>
<p>Thường khi nói về chỉ mục, chúng ta đề cập đến chỉ mục B-Tree, đây là loại chỉ mục phổ biến nhất trong cơ sở dữ liệu quan hệ, hầu hết các động cơ lưu trữ đều hỗ trợ loại chỉ mục này. Từ <code>B-Tree</code> được sử dụng trong MySQL trong các câu lệnh&nbsp;<code>CREATE TABLE</code>&nbsp;hoặc các câu lệnh khác, nhưng thực tế các storage engine khác nhau có thể sử dụng các cấu trúc dữ liệu khác nhau, ví dụ như InnoDB sử dụng <code>B+Tree</code>.</p>
<p>Trong B+Tree, chữ <code>B</code> đề cập đến từ <code>balance</code>, có nghĩa là cân bằng. Cần lưu ý rằng chỉ mục B+Tree không thể tìm ra hàng cụ thể cho một giá trị khóa đã cho, nó chỉ tìm ra trang chứa dòng dữ liệu được tìm kiếm và sau đó cơ sở dữ liệu sẽ đọc trang vào bộ nhớ và tiếp tục tìm kiếm trong bộ nhớ để cuối cùng thu được dữ liệu mong muốn.</p>
<h4>Cây tìm kiếm nhị phân</h4>
<p>Cây tìm kiếm nhị phân có đặc điểm là mỗi nút con trái nhỏ hơn nút cha và nút cha nhỏ hơn nút con phải. Độ phức tạp thời gian truy vấn của nó là $$O(log(N))$$.</p>
<p>Tuy nhiên, để duy trì độ phức tạp truy vấn $$O(log(N))$$, bạn cần đảm bảo rằng cây này là một cây tìm kiếm nhị phân cân bằng. Để đảm bảo điều này, độ phức tạp thời gian cập nhật cũng là $$O(log(N))$$.</p>
<p>Khi dữ liệu trong cơ sở dữ liệu tăng lên, kích thước chỉ mục cũng tăng lên và không thể lưu trữ toàn bộ chỉ mục trong bộ nhớ. Do đó, chỉ mục thường được lưu trữ dưới dạng tệp trên đĩa. Trong quá trình tìm kiếm chỉ mục, sẽ có sự tiêu tốn I/O đĩa, so với truy cập bộ nhớ, tiêu tốn I/O đĩa cao hơn một vài lần. Hãy tưởng tượng xem một cây nhị phân có hàng triệu nút sâu đến đâu? Nếu đặt cây nhị phân có độ sâu lớn như vậy lên đĩa, mỗi lần đọc một nút, sẽ cần một lần đọc I/O đĩa, rõ ràng thời gian tìm kiếm như vậy là không chấp nhận được. Vậy làm thế nào để giảm số lần truy cập I/O trong quá trình tìm kiếm?</p>
<p>Một phương pháp hiệu quả là giảm độ sâu của cây, biến cây nhị phân thành cây nhiều nhánh (multiway search tree), và&nbsp;<strong>B+ tree là một loại cây nhiều nhánh</strong>.</p>
<h4>B+Tree</h4>
<p>B+Tree là một cấu trúc dữ liệu dùng để tạo chỉ mục, phù hợp cho việc tìm kiếm toàn bộ khóa, tìm kiếm phạm vi khóa và tìm kiếm tiền tố khóa. Tuy nhiên, tìm kiếm tiền tố khóa chỉ áp dụng cho việc tìm kiếm tiền tố bên trái.</p>
<p>Để hiểu B+Tree, chỉ cần hiểu hai đặc điểm quan trọng nhất của nó:</p>
<ul>
<li>Thứ nhất, tất cả các khóa (có thể hiểu là dữ liệu) được lưu trữ trong các nút lá, các nút không phải lá không lưu trữ dữ liệu thực sự, tất cả các nút ghi nhận được sắp xếp theo thứ tự giá trị khóa và được lưu trữ trên cùng một tầng nút lá.</li>
<li>Thứ hai, tất cả các nút lá được kết nối bằng con trỏ. Hình ảnh dưới đây là một cây B+ được đơn giản hóa.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200304235424.jpg" alt="b-tree-index" tabindex="0" loading="lazy"><figcaption>b-tree-index</figcaption></figure>
<p>Dựa trên nội dung của các nút lá, loại chỉ mục được chia thành chỉ mục khóa chính và chỉ mục không phải khóa chính.</p>
<ul>
<li><strong>Chỉ mục khóa chính</strong>&nbsp;(clustered index), còn được gọi là chỉ mục chính, chỉ mục cụm, nút lá lưu trữ toàn bộ dữ liệu hàng. Vì không thể lưu trữ hàng dữ liệu ở hai vị trí khác nhau cùng một lúc, nên&nbsp;<strong>một bảng chỉ có thể có một chỉ mục khóa chính</strong>.&nbsp;<strong>Chỉ mục khóa chính của InnoDB thực tế là lưu trữ cả chỉ mục B-Tree và hàng dữ liệu trong cùng một cấu trúc</strong>.</li>
<li>Chỉ mục không phải khóa chính (non-clustered index) lưu trữ giá trị khóa chính tương ứng với khóa. Trong InnoDB, chỉ mục không phải khóa chính còn được gọi là chỉ mục phụ (secondary index). Dữ liệu được lưu trữ ở một vị trí, chỉ mục được lưu trữ ở một vị trí khác, chỉ mục chứa con trỏ đến vị trí dữ liệu. Có thể có nhiều chỉ mục phụ, tối đa 249.</li>
</ul>
<p><strong>Phân cụm (clustered) có nghĩa là các hàng dữ liệu và giá trị khóa liền kề được lưu trữ cùng nhau một cách nhỏ gọn. Do đó việc truy cập nhanh chóng</strong>. Vì không thể lưu trữ hàng dữ liệu trong hai vị trí khác nhau cùng một lúc, nên <strong>một bảng chỉ có thể có một chỉ số cụm</strong>.</p>
<p><strong>Sự khác biệt giữa truy vấn chỉ mục phân cụm và truy vấn chỉ mục không phân cụm</strong></p>
<ul>
<li>Nếu câu lệnh là&nbsp;<code>SELECT * FROM T WHERE ID = 500</code>, tức là truy vấn chỉ mục phân cụm, chỉ cần tìm kiếm B+Tree của ID;</li>
<li>Nếu câu lệnh là&nbsp;<code>SELECT * FROM T WHERE k = 5</code>, tức là truy vấn chỉ mục không phân cụm, cần tìm kiếm cây chỉ mục k trước, tìm giá trị ID là 500, sau đó tìm kiếm cây chỉ mục ID. Quá trình này được gọi là&nbsp;<strong>truy vấn lại</strong>.</li>
</ul>
<p>Nghĩa là,&nbsp;<strong>truy vấn dựa trên chỉ mục không phân cụm cần quét hai cây chỉ mục</strong>. Do đó, chúng ta nên ưu tiên sử dụng truy vấn khóa chính.</p>
<p><strong>Rõ ràng, độ dài khóa chính càng nhỏ thì nút lá chỉ mục không phải khóa chính càng nhỏ, chỉ mục không phân cụm chiếm ít không gian hơn.</strong></p>
<p>Khóa chính tự tăng là khóa chính được định nghĩa trên cột tự tăng, trong câu lệnh tạo bảng thường được định nghĩa như sau: <code>NOT NULL PRIMARY KEY AUTO_INCREMENT</code>. Về mặt hiệu suất và không gian lưu trữ, khóa chính tự tăng thường là lựa chọn hợp lý hơn. Có trường hợp nào phù hợp để sử dụng trường kinh doanh làm khóa chính không? Có. Ví dụ, một số yêu cầu kịch bản kinh doanh như sau:</p>
<ul>
<li>Chỉ có một chỉ mục;</li>
<li>Chỉ mục này phải là chỉ mục duy nhất.</li>
</ul>
<p>Vì không có chỉ mục khác, không cần xem xét vấn đề kích thước nút lá chỉ mục không phải khóa chính.</p>
<p>Lúc này, chúng ta nên ưu tiên áp dụng nguyên tắc "ưu tiên sử dụng truy vấn khóa chính", trực tiếp đặt chỉ mục này làm khóa chính, có thể tránh việc mỗi lần truy vấn đều cần tìm kiếm hai cây.</p>
<h3>Chỉ mục toàn văn bản (Full-Text Index)</h3>
<p>MyISAM hỗ trợ chỉ mục toàn văn bản, được sử dụng để tìm kiếm từ khóa trong văn bản thay vì so sánh trực tiếp. Điều kiện tìm kiếm được sử dụng là <code>MATCH AGAINST</code> thay vì <code>WHERE</code> thông thường.</p>
<p>Chỉ mục toàn văn bản thường sử dụng cấu trúc dữ liệu chỉ mục đảo ngược (inverted index), nó ghi lại ánh xạ từ khóa đến tài liệu chứa nó.</p>
<p>InnoDB Storage Engine hỗ trợ chỉ mục toàn văn bản từ phiên bản MySQL 5.6.4.</p>
<h3>Chỉ mục không gian</h3>
<p>Lưu trữ MyISAM hỗ trợ chỉ mục không gian (R-Tree), được sử dụng để lưu trữ dữ liệu địa lý. Chỉ mục không gian sẽ tổ chức dữ liệu từ tất cả các chiều để tìm kiếm hiệu quả bằng bất kỳ kết hợp nào của các chiều.</p>
<p>Cần sử dụng các hàm liên quan đến GIS để duy trì dữ liệu.</p>
<h2>Các loại chỉ mục</h2>
<p>Các hệ thống cơ sở dữ liệu quan hệ phổ biến thường hỗ trợ các loại chỉ mục sau:</p>
<h3>Chỉ mục khóa chính (<code>PRIMARY</code>)</h3>
<p>Chỉ mục khóa chính: Đây là một loại chỉ mục đặc biệt, không cho phép giá trị trống. Một bảng chỉ có thể có một chỉ mục khóa chính (thực tế là chỉ mục gom cụm trong InnoDB) và thường được tạo cùng với việc tạo bảng.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">` (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    `id`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ...</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    PRIMARY KEY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#98C379;--shiki-dark:#98C379">`id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><h3>Chỉ mục duy nhất (<code>UNIQUE</code>)</h3>
<p>Chỉ mục duy nhất: Các giá trị trong cột chỉ mục phải là duy nhất, nhưng cho phép giá trị trống. Nếu đó là chỉ mục kết hợp, thì sự kết hợp của các giá trị cột phải là duy nhất.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">` (</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ...</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    UNIQUE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> indexName (title(</span><span style="color:#C678DD;--shiki-dark:#C678DD">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">))</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><h3>Chỉ mục thông thường (<code>INDEX</code>)</h3>
<p>Chỉ mục thông thường: Đây là loại chỉ mục cơ bản, không có bất kỳ ràng buộc nào.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">` (</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ...</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    INDEX</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> index_name (title(</span><span style="color:#C678DD;--shiki-dark:#C678DD">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">))</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><h3>Chỉ mục toàn văn (<code>FULLTEXT</code>)</h3>
<p>Chỉ mục toàn văn: Chủ yếu được sử dụng để tìm kiếm từ khóa trong văn bản, thay vì so sánh trực tiếp với các giá trị trong chỉ mục.</p>
<p>Chỉ mục toàn văn khác biệt rất nhiều so với các loại chỉ mục khác, nó giống như một công cụ tìm kiếm hơn là một tham số so sánh trong câu lệnh WHERE. Chỉ mục toàn văn được sử dụng kết hợp với phép toán <code>match against</code>, thay vì sử dụng câu lệnh WHERE thông thường kèm theo LIKE. Chỉ mục toàn văn có thể được sử dụng trong <code>CREATE TABLE</code>, <code>ALTER TABLE</code>, <code>CREATE INDEX</code>, nhưng hiện tại chỉ có thể tạo chỉ mục toàn văn trên các cột kiểu <code>char</code>, <code>varchar</code> và <code>text</code>. Đáng lưu ý là, khi có số lượng dữ liệu lớn, việc đưa dữ liệu vào một bảng không có chỉ mục toàn cục trước, sau đó tạo chỉ mục toàn văn bằng cách sử dụng <code>CREATE INDEX</code> sẽ nhanh hơn việc tạo chỉ mục toàn văn trước khi đưa dữ liệu vào.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">` (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">    `content`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> text</span><span style="color:#C678DD;--shiki-dark:#C678DD"> CHARACTER</span><span style="color:#C678DD;--shiki-dark:#C678DD"> NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ...</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    FULLTEXT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (content)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><h3>Chỉ mục kết hợp</h3>
<p>Chỉ mục kết hợp: Đây là chỉ mục được tạo trên nhiều trường, chỉ khi trường đầu tiên trong điều kiện truy vấn sử dụng chỉ mục, chỉ mục mới được sử dụng. Khi sử dụng chỉ mục kết hợp, cần tuân theo tập hợp tiền tố tối đa bên trái.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">` (</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    ...</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    INDEX</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> index_name (title(</span><span style="color:#C678DD;--shiki-dark:#C678DD">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">), title(</span><span style="color:#C678DD;--shiki-dark:#C678DD">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">), ...)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span></code></pre>
</div><h2>Chiến lược lập chỉ mục</h2>
<p>Giả sử có bảng sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> `</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">t</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">` (</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  `id`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  `city`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  `name`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  `age`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">  `addr`</span><span style="color:#C678DD;--shiki-dark:#C678DD"> varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">128</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">DEFAULT</span><span style="color:#C678DD;--shiki-dark:#C678DD"> NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  PRIMARY KEY</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#98C379;--shiki-dark:#98C379">`id`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  KEY</span><span style="color:#98C379;--shiki-dark:#98C379"> `city`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#98C379;--shiki-dark:#98C379">`city`</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) ENGINE</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">InnoDB;</span></span></code></pre>
</div><h3>Nguyên tắc cơ bản của lập chỉ mục</h3>
<ul>
<li><strong>Không phải càng nhiều chỉ mục càng tốt, không nên tạo chỉ mục cho tất cả các cột</strong>. Cần xem xét chi phí duy trì chỉ mục, không gian chiếm dụng và chi phí của việc truy vấn lại dữ liệu. Chỉ tạo chỉ mục khi cần thiết và cần đảm bảo chỉ mục nhẹ nhàng. Khi tạo chỉ mục kết hợp nhiều cột, cần cố gắng sử dụng chỉ mục để thực hiện truy vấn dữ liệu và giảm thiểu chi phí truy vấn lại dữ liệu.</li>
<li><strong>Tránh tạo chỉ mục trùng lặp và không cần thiết</strong>.</li>
<li><strong>Xem xét xóa các chỉ mục không được sử dụng</strong>.</li>
<li><strong>Mở rộng chỉ mục hiện có thay vì tạo mới chỉ mục</strong>.</li>
<li><strong>Các cột được sử dụng thường xuyên làm điều kiện lọc nên xem xét việc tạo chỉ mục</strong>.</li>
</ul>
<h3>Cột độc lập</h3>
<p><strong>"Cột độc lập" có nghĩa là các cột được lập chỉ mục không thể là một phần của biểu thức, chúng cũng không thể là tham số của hàm</strong>&nbsp;.</p>
<p><strong>Việc thực hiện các phép toán trên trường chỉ mục có thể gây thiệt hại đến tính tuần tự của giá trị chỉ mục, do đó trình tối ưu quyết định từ chối sử dụng chức năng tìm kiếm cây.</strong></p>
<p>Nếu các cột trong truy vấn không phải là các cột độc lập, cơ sở dữ liệu sẽ không sử dụng chỉ mục.</p>
<p>❌ Ví dụ không đúng:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> actor_id </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> actor </span><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> actor_id + </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ... </span><span style="color:#C678DD;--shiki-dark:#C678DD">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> TO_DAYS(current_date) - TO_DAYS(date_col) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Chỉ mục che phủ</h3>
<p><strong>Chỉ mục che phủ là chỉ mục mà thông tin trên chỉ mục đủ để đáp ứng yêu cầu truy vấn, không cần truy vấn lại dữ liệu</strong>.</p>
<p>【Ví dụ】Truy vấn phạm vi</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">create</span><span style="color:#C678DD;--shiki-dark:#C678DD"> table</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> T</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">ID </span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#C678DD;--shiki-dark:#C678DD"> primary key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">k </span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#C678DD;--shiki-dark:#C678DD"> NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> DEFAULT</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">s </span><span style="color:#C678DD;--shiki-dark:#C678DD">varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">16</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> DEFAULT</span><span style="color:#98C379;--shiki-dark:#98C379"> ''</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">index</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> k(k))</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">engine</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">InnoDB;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">insert into</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> T </span><span style="color:#C678DD;--shiki-dark:#C678DD">values</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'aa'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),(</span><span style="color:#D19A66;--shiki-dark:#D19A66">200</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">'bb'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),(</span><span style="color:#D19A66;--shiki-dark:#D19A66">300</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">'cc'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),(</span><span style="color:#D19A66;--shiki-dark:#D19A66">500</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">'ee'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),(</span><span style="color:#D19A66;--shiki-dark:#D19A66">600</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">'ff'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">),(</span><span style="color:#D19A66;--shiki-dark:#D19A66">700</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span><span style="color:#98C379;--shiki-dark:#98C379">'gg'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> T </span><span style="color:#C678DD;--shiki-dark:#C678DD">where</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> k </span><span style="color:#C678DD;--shiki-dark:#C678DD">between</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3</span><span style="color:#C678DD;--shiki-dark:#C678DD"> and</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span></span></code></pre>
</div><p>Cần thực hiện bao nhiêu lần tìm kiếm cây, quét qua bao nhiêu hàng?</p>
<ol>
<li>Tìm kiếm bản ghi với k=3 trên cây chỉ mục k, lấy ID = 300;</li>
<li>Tìm kiếm bản ghi với ID = 300 trên cây chỉ mục ID, lấy R3;</li>
<li>Tìm kiếm bản ghi với k=5 trên cây chỉ mục k, lấy ID = 500;</li>
<li>Tìm kiếm bản ghi với ID = 500 trên cây chỉ mục ID, lấy R4;</li>
<li>Tìm kiếm bản ghi với k=6 trên cây chỉ mục k, không thỏa mãn điều kiện, kết thúc vòng lặp.</li>
</ol>
<p>Trong quá trình này, quá trình tìm kiếm lại trên cây chỉ mục chính được gọi là truy vấn lại. Có thể thấy, quá trình truy vấn này đọc 3 bản ghi trên cây chỉ mục k (bước 1, 3 và 5) và truy vấn lại hai lần (bước 2 và 4).</p>
<p>Nếu câu lệnh thực hiện là select ID from T where k between 3 and 5, chỉ cần lấy giá trị ID, và giá trị ID đã có trên cây chỉ mục k, do đó có thể trả kết quả truy vấn trực tiếp mà không cần truy vấn lại. Chỉ mục chứa tất cả các giá trị cần truy vấn, được gọi là chỉ mục che phủ.</p>
<p><strong>Do chỉ mục che phủ giảm số lần tìm kiếm cây, đáng kể cải thiện hiệu suất truy vấn, nên sử dụng chỉ mục che phủ là một biện pháp tối ưu hiệu suất phổ biến</strong>.</p>
<h3>Sử dụng chỉ mục để sắp xếp</h3>
<p>MySQL có hai cách để tạo kết quả sắp xếp: thông qua thao tác sắp xếp hoặc quét theo thứ tự chỉ mục.</p>
<p><strong>Chỉ mục tốt là chỉ mục có thể được sử dụng để sắp xếp và tìm kiếm hàng</strong>. Điều này cho phép kết quả được truy xuất trực tiếp từ chỉ mục mà không cần sắp xếp lại.</p>
<p>Khi sử dụng chỉ mục để sắp xếp, cần đảm bảo chỉ mục được chọn đủ để thực hiện truy vấn dữ liệu và giảm thiểu chi phí truy vấn lại dữ liệu.</p>
<p>Quá trình thực hiện truy vấn sẽ như sau:</p>
<ol>
<li>Tìm kiếm bản ghi đầu tiên trong chỉ mục (city, name, age) thỏa mãn điều kiện city='Hà Nội' và lấy giá trị city, name và age làm một phần của kết quả trực tiếp trả về;</li>
<li>Lấy bản ghi tiếp theo từ chỉ mục (city, name, age) và lấy giá trị city, name và age làm một phần của kết quả trực tiếp trả về;</li>
<li>Lặp lại bước 2 cho đến khi tìm thấy bản ghi thứ 1000 hoặc không thỏa mãn điều kiện city='Hà Nội' thì kết thúc vòng lặp.</li>
</ol>
<h3>Chỉ mục tiền tố</h3>
<p>Đôi khi cần tạo chỉ mục cho các cột có độ dài lớn, điều này sẽ làm cho chỉ mục trở nên lớn và chậm.</p>
<p>Trong trường hợp này, có thể sử dụng chỉ mục tiền tố, chỉ lưu trữ một phần đầu của chuỗi, điều này có thể <strong>tiết kiệm không gian chỉ mục đáng kể và cải thiện hiệu suất chỉ mục</strong>. Tuy nhiên, điều này cũng <strong>giảm tính chọn lọc của chỉ mục</strong>. Đối với các cột văn bản như <code>BLOB</code>/<code>TEXT</code>/<code>VARCHAR</code> không thể tạo chỉ mục đầy đủ, vì hầu hết các cơ sở dữ liệu không cho phép tạo chỉ mục đầy đủ cho các cột này.</p>
<p><strong>Tính chọn lọc của chỉ mục</strong> là tỷ lệ giữa các giá trị chỉ mục không trùng nhau và tổng số bản ghi trong bảng dữ liệu. Giá trị tối đa là 1, khi đó mỗi bản ghi có một chỉ mục duy nhất tương ứng. Độ chọn lọc càng cao, hiệu suất truy vấn cũng càng cao. Nếu có nhiều chỉ mục tiền tố khớp với điều kiện, ta phải quét từng cái cho đến khi tìm được bản ghi chính xác cuối cùng.</p>
<p><strong>Sử dụng chỉ mục tiền tố và xác định độ dài, bạn có thể tiết kiệm không gian mà không cần tăng thêm quá nhiều chi phí truy vấn.</strong></p>
<p>Lựa chọn độ dài chỉ mục tiền tố phù hợp làm thế nào?</p>
<p>Có thể sử dụng câu lệnh sau để tính toán số lượng giá trị khác nhau trên cột:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">select</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">distinct</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> email) </span><span style="color:#C678DD;--shiki-dark:#C678DD">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> L </span><span style="color:#C678DD;--shiki-dark:#C678DD">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> SUser;</span></span></code></pre>
</div><p>Sau đó, lần lượt chọn các độ dài tiền tố khác nhau để xem giá trị này, ví dụ: chúng ta muốn xem tiền tố từ 4 đến 7 ký tự, có thể sử dụng câu lệnh sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">select</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">  count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">distinct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(email,</span><span style="color:#D19A66;--shiki-dark:#D19A66">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)）</span><span style="color:#C678DD;--shiki-dark:#C678DD">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> L4,</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">  count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">distinct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(email,</span><span style="color:#D19A66;--shiki-dark:#D19A66">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)）</span><span style="color:#C678DD;--shiki-dark:#C678DD">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> L5,</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">  count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">distinct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(email,</span><span style="color:#D19A66;--shiki-dark:#D19A66">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)）</span><span style="color:#C678DD;--shiki-dark:#C678DD">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> L6,</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">  count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">distinct</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> left</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(email,</span><span style="color:#D19A66;--shiki-dark:#D19A66">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)）</span><span style="color:#C678DD;--shiki-dark:#C678DD">as</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> L7,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> SUser;</span></span></code></pre>
</div><p>Tất nhiên, <strong>sử dụng chỉ mục tiền tố có thể làm giảm độ phân biệt</strong>, vì vậy bạn cần thiết lập trước tỷ lệ chấp nhận được của sự giảm này, ví dụ như 5%. Sau đó, trong các kết quả trả về từ L4~L7, hãy tìm các giá trị không nhỏ hơn L * 95%, giả sử ở đây cả L6 và L7 đều thỏa mãn điều kiện này, bạn có thể chọn chiều dài tiền tố là 6.</p>
<p>Ngoài ra, <strong><code>ORDER BY</code> không thể sử dụng chỉ mục tiền tố, không thể sử dụng chỉ mục tiền tố làm chỉ mục che phủ</strong>.</p>
<h3>Nguyên tắc khớp trước tối đa</h3>
<p>Không chỉ là toàn bộ định nghĩa chỉ mục, chỉ cần đáp ứng khớp trước tối đa, chỉ mục có thể được sử dụng để tăng tốc tìm kiếm. Khớp trước tối đa có thể là N cột đầu tiên của chỉ mục kết hợp hoặc M ký tự đầu tiên của chỉ mục chuỗi.</p>
<p>MySQL sẽ tiếp tục khớp từ trái sang phải cho đến khi gặp các truy vấn phạm vi (<code>&gt;</code>,<code>&lt;</code>,<code>BETWEEN</code>,<code>LIKE</code>).</p>
<ul>
<li>Chỉ mục có thể đơn giản như một cột (a) hoặc phức tạp như nhiều cột (a, b, c, d), tức là chỉ mục kết hợp.</li>
<li>Nếu đó là chỉ mục kết hợp, thì khóa cũng bao gồm nhiều cột, đồng thời, chỉ mục chỉ có thể được sử dụng để tìm kiếm khóa có sẵn (bằng nhau), khi gặp truy vấn phạm vi (<code>&gt;</code>,<code>&lt;</code>,<code>BETWEEN</code>,<code>LIKE</code>), nó sẽ không thể khớp tiếp theo, sau đó rơi vào tìm kiếm tuyến tính.</li>
<li>Do đó, <strong>thứ tự cột quyết định số cột có thể khớp được</strong>.</li>
</ul>
<p><strong>Không nên tạo chỉ mục độc lập cho mỗi cột</strong>.</p>
<p><strong>Hãy đặt cột có khả năng chọn lọc cao hoặc cơ sở số lượng lớn ở đầu danh sách các cột kết hợp</strong>. Tuy nhiên, đôi khi cũng cần xem xét các yếu tố như sắp xếp, nhóm và điều kiện phạm vi trong mệnh đề <code>WHERE</code>, những yếu tố này cũng ảnh hưởng đáng kể đến hiệu suất truy vấn.</p>
<p>Ví dụ: <code>a = 1 and b = 2 and c &gt; 3 and d = 4</code>，nếu tạo chỉ mục theo thứ tự (a,b,c,d)，thì d sẽ không được sử dụng chỉ mục. Nếu tạo chỉ mục theo thứ tự (a,b,d,c)，thì cũng có thể sử dụng chỉ mục cho tất cả các cột. Thứ tự a,b,d có thể được sắp xếp theo bất kỳ cách nào.</p>
<p>Hãy đặt cột chỉ mục có tính chọn lọc cao nhất ở phía trước, tính chọn lọc của chỉ mục được hiểu là tỷ lệ giữa giá trị chỉ mục không trùng và tổng số bản ghi. Giá trị tối đa là 1, khi đó mỗi bản ghi sẽ có duy nhất một chỉ mục tương ứng. Độ chọn lọc càng cao thì hiệu suất truy vấn cũng càng cao.</p>
<p>Ví dụ như kết quả hiển thị dưới đây, tính chọn lọc của customer_id có mức độ ưu tiên cao hơn so với staff_id, do đó tốt nhất là để cột customer_id được đặt trước trong chỉ mục kết hợp.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">DISTINCT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> staff_id)/</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(*) </span><span style="color:#C678DD;--shiki-dark:#C678DD">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> staff_id_selectivity,</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#C678DD;--shiki-dark:#C678DD">DISTINCT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> customer_id)/</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(*) </span><span style="color:#C678DD;--shiki-dark:#C678DD">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> customer_id_selectivity,</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">COUNT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(*)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> payment;</span></span></code></pre>
</div><div class="language-batch" data-ext="batch" data-title="batch"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">   staff_id_selectivity: 0.0001</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">customer_id_selectivity: 0.0373</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">               COUNT(*): </span><span style="color:#D19A66;--shiki-dark:#D19A66">16049</span></span></code></pre>
</div><h3>Phép = và in có thể không tuân theo thứ tự</h3>
<p><strong>Không cần quan tâm đến thứ tự của <code>=</code> và <code>IN</code></strong>，MySQL sẽ tự động tối ưu thứ tự của các điều kiện này để khớp với số lượng cột chỉ mục càng nhiều càng tốt.</p>
<p>【Ví dụ】Nếu có chỉ mục (a, b, c, d), câu truy vấn có điều kiện <code>c &gt; 3 and b = 2 and a = 1 and d &lt; 4</code> và <code>a = 1 and c &gt; 3 and b = 2 and d &lt; 4</code> đều có thể. MySQL sẽ tự động tối ưu thành <code>a = 1 and b = 2 and c &gt; 3 and d &lt; 4</code>, và tìm kiếm theo thứ tự a, b, c, d.</p>
<h2>Thực hành tốt nhất cho chỉ mục</h2>
<p>Việc tạo chỉ mục không đảm bảo sẽ mang lại hiệu quả. Ví dụ, không tuân thủ chỉ mục tiền tố, nguyên tắc khớp trước tối đa, điều kiện truy vấn liên quan đến tính toán hàm, v.v. đều không thể sử dụng chỉ mục. Ngoài ra, ngay cả khi câu lệnh SQL thỏa mãn điều kiện sử dụng chỉ mục, MySQL cũng sẽ đánh giá chi phí của các phương pháp truy vấn khác nhau để quyết định xem có sử dụng chỉ mục hay không và sử dụng chỉ mục nào.</p>
<p>Do đó, khi cố gắng tối ưu hiệu suất SQL bằng cách sử dụng chỉ mục, hãy chắc chắn xác nhận xem chỉ mục có thể cải thiện hiệu suất thực tế hay không thông qua chiến lược thực thi (<code>EXPLAIN</code>) hoặc hiệu quả thực tế. Nếu có thắc mắc về kế hoạch thực thi được cung cấp bởi <code>EXPLAIN</code>, bạn cũng có thể sử dụng <code>optimizer_trace</code> để xem kế hoạch thực thi chi tiết để phân tích tiếp.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220320201844.png" type="image/png"/>
    </item>
    <item>
      <title>MySQL Opearation</title>
      <link>https://vanhung4499.github.io/database/mysql/opearation.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/opearation.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Opearation</source>
      <description>MySQL Operation Nếu công ty của bạn có DBA, thì tôi xin chúc mừng bạn, bạn có thể bỏ qua việc quản trị Mysql. Nếu công ty của bạn không có DBA, hãy học cách thực hiện các hoạt đ...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Nếu công ty của bạn có DBA, thì tôi xin chúc mừng bạn, bạn có thể bỏ qua việc quản trị Mysql. Nếu công ty của bạn không có DBA, hãy học cách thực hiện các hoạt động quản trị cơ bản của Mysql, đó là điều cần thiết để tự bảo vệ mình khi hoạt động trong lĩnh vực này.</p>
</blockquote>
<h2>Cài đặt và triển khai</h2>
<h3>Cài đặt trên Windows</h3>
<p>(1) Tải phiên bản Mysql 5.7 Portable (không cần cài đặt)</p>
<p>Link tải: <a href="https://dev.mysql.com/downloads/mysql/5.7.html#downloads" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/downloads/mysql/5.7.html#downloads</a></p>
<p>(2) Giải nén và tạo file my.ini trong thư mục gốc</p>
<p>Ví dụ file my.ini:</p>
<div class="language-ini line-numbers-mode" data-ext="ini" data-title="ini"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">[mysqld]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Thiết lập cổng 3306</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> 3306</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Thiết lập đường dẫn cài đặt mysql, thay đổi đường dẫn này cho phù hợp với thư mục bạn giải nén</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">basedir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">D:\\Tools\\DB\\mysql\\mysql-5.7.31</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Số kết nối tối đa</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">max_connections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">200</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Mysql sử dụng bộ ký tự mặc định là latin1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">character-set-server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">utf8</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Thiết lập engine lưu trữ mặc định cho bảng mới</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">default-storage-engine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">INNODB</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">[client]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Thiết lập bộ ký tự mặc định cho client mysql</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">default-character-set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">utf8</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) Thực hiện các lệnh cài đặt</p>
<p>Trên cửa sổ CMD, thực hiện lần lượt các lệnh cài đặt sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>cd D:\\Tools\\DB\\mysql\\mysql-5.7.31</span></span>
<span class="line"><span>mysqld --initialize</span></span>
<span class="line"><span>mysqld -install</span></span></code></pre>
</div><p>Giải thích:</p>
<ul>
<li><code>mysqld --initialize</code> sẽ tự động khởi tạo và tạo thư mục data.</li>
<li><code>mysqld -install</code> sẽ cài đặt dịch vụ mysql.</li>
</ul>
<p>(4) Khởi động dịch vụ</p>
<p>Trên cửa sổ CMD, thực hiện lệnh <code>net start mysql</code> để khởi động dịch vụ.</p>
<h3>Cài đặt trên CentOS</h3>
<blockquote>
<p>Bài viết này chỉ giới thiệu cách cài đặt thông qua gói rpm</p>
</blockquote>
<h4>Cài đặt nguồn yum của mysql</h4>
<p>Link tải chính thức: <a href="https://dev.mysql.com/downloads/repo/yum/" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/downloads/repo/yum/</a></p>
<p>(1) Tải gói yum</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">wget</span><span style="color:#98C379;--shiki-dark:#98C379"> https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm</span></span></code></pre>
</div><p>(2) Cài đặt tệp repo yum và cập nhật bộ nhớ cache yum</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">rpm</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -ivh</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql80-community-release-el7-1.noarch.rpm</span></span></code></pre>
</div><p>Kết quả thực hiện:</p>
<p>Sẽ tạo ra hai tệp repo trong thư mục /etc/yum.repos.d/</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> ls</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">grep</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community.repo</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-source.repo</span></span></code></pre>
</div><p>Cập nhật yum:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">yum</span><span style="color:#98C379;--shiki-dark:#98C379"> clean</span><span style="color:#98C379;--shiki-dark:#98C379"> all</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">yum</span><span style="color:#98C379;--shiki-dark:#98C379"> makecache</span></span></code></pre>
</div><p>(3) Kiểm tra trạng thái cài đặt rpm</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> yum</span><span style="color:#98C379;--shiki-dark:#98C379"> search</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">grep</span><span style="color:#98C379;--shiki-dark:#98C379"> server</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-common.i686</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> database</span><span style="color:#98C379;--shiki-dark:#98C379"> common</span><span style="color:#98C379;--shiki-dark:#98C379"> files</span><span style="color:#98C379;--shiki-dark:#98C379"> for</span><span style="color:#98C379;--shiki-dark:#98C379"> server</span><span style="color:#98C379;--shiki-dark:#98C379"> and</span><span style="color:#98C379;--shiki-dark:#98C379"> client</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-common.x86_64</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> database</span><span style="color:#98C379;--shiki-dark:#98C379"> common</span><span style="color:#98C379;--shiki-dark:#98C379"> files</span><span style="color:#98C379;--shiki-dark:#98C379"> for</span><span style="color:#98C379;--shiki-dark:#98C379"> server</span><span style="color:#98C379;--shiki-dark:#98C379"> and</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-test.x86_64</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> Test</span><span style="color:#98C379;--shiki-dark:#98C379"> suite</span><span style="color:#98C379;--shiki-dark:#98C379"> for</span><span style="color:#98C379;--shiki-dark:#98C379"> the</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> database</span><span style="color:#98C379;--shiki-dark:#98C379"> server</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">                       :</span><span style="color:#98C379;--shiki-dark:#98C379"> administering</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> servers</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-server.x86_64</span><span style="color:#98C379;--shiki-dark:#98C379"> :</span><span style="color:#98C379;--shiki-dark:#98C379"> A</span><span style="color:#98C379;--shiki-dark:#98C379"> very</span><span style="color:#98C379;--shiki-dark:#98C379"> fast</span><span style="color:#98C379;--shiki-dark:#98C379"> and</span><span style="color:#98C379;--shiki-dark:#98C379"> reliable</span><span style="color:#98C379;--shiki-dark:#98C379"> SQL</span><span style="color:#98C379;--shiki-dark:#98C379"> database</span><span style="color:#98C379;--shiki-dark:#98C379"> server</span></span></code></pre>
</div><p>Sau khi cài đặt mysql bằng yum, sẽ có một số thư mục quan trọng:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>## Tệp cấu hình</span></span>
<span class="line"><span>/etc/my.cnf</span></span>
<span class="line"><span>## Thư mục cơ sở dữ liệu</span></span>
<span class="line"><span>/var/lib/mysql/</span></span>
<span class="line"><span>## Tệp cấu hình</span></span>
<span class="line"><span>/usr/share/mysql (lệnh mysql.server và tệp cấu hình)</span></span>
<span class="line"><span>## Các lệnh liên quan</span></span>
<span class="line"><span>/usr/bin (mysqladmin, mysqldump và các lệnh khác)</span></span>
<span class="line"><span>## Tệp khởi động</span></span>
<span class="line"><span>/usr/lib/systemd/system/mysqld.service (đăng ký dịch vụ systemd)</span></span></code></pre>
</div><p>(4) Cài đặt máy chủ mysql</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">yum</span><span style="color:#98C379;--shiki-dark:#98C379"> install</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql-community-server</span></span></code></pre>
</div><h4>Quản lý dịch vụ mysql</h4>
<p>Sau khi cài đặt mysql bằng yum, sẽ có một dịch vụ systemd có tên <code>mysqld</code>.</p>
<p>Quản lý dịch vụ rất đơn giản:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">## Kiểm tra trạng thái</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> status</span><span style="color:#98C379;--shiki-dark:#98C379"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">## Kích hoạt dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> enable</span><span style="color:#98C379;--shiki-dark:#98C379"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">## Vô hiệu hóa dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> disable</span><span style="color:#98C379;--shiki-dark:#98C379"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">## Khởi động dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> start</span><span style="color:#98C379;--shiki-dark:#98C379"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">## Khởi động lại dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> restart</span><span style="color:#98C379;--shiki-dark:#98C379"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">## Dừng dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> stop</span><span style="color:#98C379;--shiki-dark:#98C379"> mysqld</span></span></code></pre>
</div><h3>Khởi tạo mật khẩu cho cơ sở dữ liệu</h3>
<p>Xem mật khẩu tạm thời:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> grep</span><span style="color:#98C379;--shiki-dark:#98C379"> "password"</span><span style="color:#98C379;--shiki-dark:#98C379"> /var/log/mysqld.log</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2018-09-30T03:13:41.727736Z</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [Note] [MY-010454] [Server] A temporary password is generated </span><span style="color:#C678DD;--shiki-dark:#C678DD">for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> root@localhost: %:lt+srWu4k1</span></span></code></pre>
</div><p>Thực hiện lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -uroot</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66">temporary_password</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span></code></pre>
</div><p>Nhập mật khẩu tạm thời để truy cập vào mysql. Nếu bạn muốn thay đổi mật khẩu, thực hiện lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">ALTER</span><span style="color:#98C379;--shiki-dark:#98C379"> USER</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'@'localhost'</span><span style="color:#98C379;--shiki-dark:#98C379"> IDENTIFIED</span><span style="color:#98C379;--shiki-dark:#98C379"> BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'your_password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Lưu ý: Mật khẩu mặc định có độ mạnh trung bình, bao gồm chữ hoa, chữ thường, chữ số và ký tự đặc biệt. Bạn chỉ có thể thay đổi cấu hình để sử dụng mật khẩu đơn giản hơn sau khi đã thay đổi thành công mật khẩu.</p>
<h3>Cấu hình truy cập từ xa</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">root</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'your_password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ALL </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">ALTER</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'your_password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">FLUSH PRIVILEGES;</span></span></code></pre>
</div><h3>Bỏ qua xác thực đăng nhập</h3>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">vim</span><span style="color:#98C379;--shiki-dark:#98C379"> /etc/my.cnf</span></span></code></pre>
</div><p>Thêm dòng <code>skip-grant-tables</code> dưới phần <code>[mysqld]</code>.</p>
<p>Chức năng này cho phép bỏ qua xác thực đăng nhập, nghĩa là bạn có thể đăng nhập vào root với bất kỳ mật khẩu nào.</p>
<p>Thực hiện <code>systemctl restart mysqld</code> để khởi động lại mysql.</p>
<h3>Kết nối từ máy khách</h3>
<p>Cú pháp: <code>mysql -h&lt;host&gt; -P&lt;port&gt; -u&lt;username&gt; -p&lt;password&gt;</code></p>
<p>Nếu không chỉ định mật khẩu một cách rõ ràng, bạn sẽ được yêu cầu nhập mật khẩu trước khi truy cập.</p>
<p>【Ví dụ】Kết nối đến Mysql cục bộ</p>
<div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -h</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 127.0.0.1</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -P</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 3306</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -u</span><span style="color:#98C379;--shiki-dark:#98C379"> root</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Enter</span><span style="color:#98C379;--shiki-dark:#98C379"> password:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Welcome</span><span style="color:#98C379;--shiki-dark:#98C379"> to</span><span style="color:#98C379;--shiki-dark:#98C379"> the</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> monitor.</span><span style="color:#98C379;--shiki-dark:#98C379">  Commands</span><span style="color:#98C379;--shiki-dark:#98C379"> end</span><span style="color:#98C379;--shiki-dark:#98C379"> with</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ; </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">or</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> \g</span><span style="color:#98C379;--shiki-dark:#98C379">.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Your</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> connection</span><span style="color:#98C379;--shiki-dark:#98C379"> id</span><span style="color:#98C379;--shiki-dark:#98C379"> is</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 13501</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Server</span><span style="color:#98C379;--shiki-dark:#98C379"> version:</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 8.0.19</span><span style="color:#98C379;--shiki-dark:#98C379"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379"> Community</span><span style="color:#98C379;--shiki-dark:#98C379"> Server</span><span style="color:#98C379;--shiki-dark:#98C379"> -</span><span style="color:#98C379;--shiki-dark:#98C379"> GPL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Copyright</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Oracle</span><span style="color:#98C379;--shiki-dark:#98C379"> is</span><span style="color:#98C379;--shiki-dark:#98C379"> a</span><span style="color:#98C379;--shiki-dark:#98C379"> registered</span><span style="color:#98C379;--shiki-dark:#98C379"> trademark</span><span style="color:#98C379;--shiki-dark:#98C379"> of</span><span style="color:#98C379;--shiki-dark:#98C379"> Oracle</span><span style="color:#98C379;--shiki-dark:#98C379"> Corporation</span><span style="color:#98C379;--shiki-dark:#98C379"> and/or</span><span style="color:#98C379;--shiki-dark:#98C379"> its</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">affiliates.</span><span style="color:#98C379;--shiki-dark:#98C379"> Other</span><span style="color:#98C379;--shiki-dark:#98C379"> names</span><span style="color:#98C379;--shiki-dark:#98C379"> may</span><span style="color:#98C379;--shiki-dark:#98C379"> be</span><span style="color:#98C379;--shiki-dark:#98C379"> trademarks</span><span style="color:#98C379;--shiki-dark:#98C379"> of</span><span style="color:#98C379;--shiki-dark:#98C379"> their</span><span style="color:#98C379;--shiki-dark:#98C379"> respective</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">owners.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Type</span><span style="color:#98C379;--shiki-dark:#98C379"> 'help;'</span><span style="color:#98C379;--shiki-dark:#98C379"> or</span><span style="color:#98C379;--shiki-dark:#98C379"> '\h'</span><span style="color:#98C379;--shiki-dark:#98C379"> for</span><span style="color:#98C379;--shiki-dark:#98C379"> help.</span><span style="color:#98C379;--shiki-dark:#98C379"> Type</span><span style="color:#98C379;--shiki-dark:#98C379"> '\c'</span><span style="color:#98C379;--shiki-dark:#98C379"> to</span><span style="color:#98C379;--shiki-dark:#98C379"> clear</span><span style="color:#98C379;--shiki-dark:#98C379"> the</span><span style="color:#98C379;--shiki-dark:#98C379"> current</span><span style="color:#98C379;--shiki-dark:#98C379"> input</span><span style="color:#98C379;--shiki-dark:#98C379"> statement.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3>Xem kết nối</h3>
<p>Sau khi kết nối thành công, nếu bạn không có hoạt động tiếp theo, kết nối sẽ ở trạng thái rảnh rỗi và bạn có thể thấy nó trong lệnh <code>show processlist</code>. Nếu máy khách không có hoạt động trong một khoảng thời gian dài, trình kết nối sẽ tự động đóng nó. Thời gian này được điều chỉnh bởi tham số <code>wait_timeout</code>, giá trị mặc định là 8 giờ.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200714115031.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<h3>Tạo người dùng</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">username</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'host'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Giải thích:</p>
<ul>
<li>username: Tên người dùng bạn muốn tạo</li>
<li>host: Xác định người dùng có thể đăng nhập từ máy chủ nào. Nếu là người dùng cục bộ, bạn có thể sử dụng localhost. Nếu bạn muốn người dùng có thể đăng nhập từ bất kỳ máy chủ từ xa nào, bạn có thể sử dụng ký tự đại diện <code>%</code>.</li>
<li>password: Mật khẩu đăng nhập của người dùng. Mật khẩu có thể để trống. Nếu để trống, người dùng có thể đăng nhập vào máy chủ mà không cần mật khẩu.</li>
</ul>
<p>Ví dụ:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">dog</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'localhost'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> '123456'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">pig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.1.101_'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENDIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> '123456'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">pig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> '123456'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">pig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> ''</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">pig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Trong Mysql 8, xác thực mặc định không còn là <code>password</code>. Vì vậy, khi tạo người dùng, <code>create user 'username'@'%' identified by 'password';</code> không thể kết nối từ máy khách.</p>
<p>Vì vậy, bạn cần thêm <code>IDENTIFIED WITH mysql_native_password</code>, ví dụ: <code>CREATE USER 'slave'@'%' IDENTIFIED WITH mysql_native_password BY '123456';</code></p>
</blockquote>
<h3>Xem người dùng</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xem tất cả người dùng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT DISTINCT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> CONCAT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'User: '''</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, user, </span><span style="color:#98C379;--shiki-dark:#98C379">'''@'''</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, host, </span><span style="color:#98C379;--shiki-dark:#98C379">''';'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> query</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66"> mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Cấp quyền</h3>
<p>Cú pháp:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> privileges </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#D19A66;--shiki-dark:#D19A66"> databasename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">tablename</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'username'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'host'</span></span></code></pre>
</div><p>Giải thích:</p>
<ul>
<li>privileges: Các quyền thực hiện của người dùng, như <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, vv. Nếu muốn cấp tất cả quyền, sử dụng <code>ALL</code>.</li>
<li>databasename: Tên cơ sở dữ liệu.</li>
<li>tablename: Tên bảng. Nếu muốn cấp quyền cho người dùng trên tất cả cơ sở dữ liệu và bảng, bạn có thể sử dụng <code>*.*</code>.</li>
</ul>
<p>Ví dụ:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#C678DD;--shiki-dark:#C678DD">INSERT</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ON</span><span style="color:#D19A66;--shiki-dark:#D19A66"> test</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">user</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'pig'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ALL </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'pig'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ALL </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> maindataplus.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'pig'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Lưu ý:</p>
<p>Người dùng được cấp quyền bằng các lệnh trên không thể cấp quyền cho người dùng khác. Nếu bạn muốn cho phép người dùng cấp quyền, sử dụng lệnh sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Cấu hình quyền cụ thể cho người dùng đã chỉ định</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> privileges </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#D19A66;--shiki-dark:#D19A66"> databasename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">tablename</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'username'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'host'</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WITH</span><span style="color:#C678DD;--shiki-dark:#C678DD"> GRANT</span><span style="color:#C678DD;--shiki-dark:#C678DD"> OPTION</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Gán tất cả quyền cho người dùng root</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> ALL </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#C678DD;--shiki-dark:#C678DD"> WITH</span><span style="color:#C678DD;--shiki-dark:#C678DD"> GRANT</span><span style="color:#C678DD;--shiki-dark:#C678DD"> OPTION</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Thu hồi quyền</h3>
<p>Cú pháp:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">REVOKE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> privilege </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#D19A66;--shiki-dark:#D19A66"> databasename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">tablename</span><span style="color:#C678DD;--shiki-dark:#C678DD"> FROM</span><span style="color:#98C379;--shiki-dark:#98C379"> 'username'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'host'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Giải thích:</p>
<p>privilege, databasename, tablename: Tương tự như phần cấp quyền.</p>
<p>Ví dụ:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">REVOKE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SELECT</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#98C379;--shiki-dark:#98C379"> 'pig'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>Lưu ý:</p>
<p>Nếu bạn đã cấp quyền cho người dùng <code>'pig'@'%'</code> như sau (hoặc tương tự): <code>GRANT SELECT ON test.user TO 'pig'@'%'</code>, thì việc sử dụng lệnh <code>REVOKE SELECT ON *.* FROM 'pig'@'%';</code> sẽ không thu hồi quyền <code>SELECT</code> của người dùng trên bảng <code>user</code> trong cơ sở dữ liệu <code>test</code>. Ngược lại, nếu quyền được cấp bằng <code>GRANT SELECT ON *.* TO 'pig'@'%';</code>, thì lệnh <code>REVOKE SELECT ON test.user FROM 'pig'@'%';</code> cũng không thu hồi quyền <code>SELECT</code> của người dùng trên bảng <code>user</code> trong cơ sở dữ liệu <code>test</code>.</p>
<p>Bạn có thể sử dụng lệnh <code>SHOW GRANTS FOR 'pig'@'%';</code> để xem thông tin chi tiết.</p>
<h3>Xem quyền</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xem quyền của người dùng</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW GRANTS </span><span style="color:#C678DD;--shiki-dark:#C678DD">FOR</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Thay đổi mật khẩu người dùng</h3>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> PASSWORD</span><span style="color:#C678DD;--shiki-dark:#C678DD"> FOR</span><span style="color:#98C379;--shiki-dark:#98C379"> 'username'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'host'</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> PASSWORD</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'newpassword'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Nếu đang đăng nhập với người dùng hiện tại, sử dụng:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> PASSWORD</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> PASSWORD</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"newpassword"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><p>Ví dụ:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> PASSWORD</span><span style="color:#C678DD;--shiki-dark:#C678DD"> FOR</span><span style="color:#98C379;--shiki-dark:#98C379"> 'pig'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> PASSWORD</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"123456"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span></code></pre>
</div><h3>Sao lưu và khôi phục</h3>
<p>Để sao lưu dữ liệu MySQL, chúng ta sử dụng lệnh mysqldump.</p>
<p>Mysqldump sẽ sao lưu dữ liệu trong cơ sở dữ liệu thành một tệp văn bản, cấu trúc bảng và dữ liệu của bảng sẽ được lưu trữ trong tệp văn bản được tạo ra.</p>
<p>Sao lưu:</p>
<h4>Sao lưu một cơ sở dữ liệu</h4>
<p>Cú pháp:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysqldump -h </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -P</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -u</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -p</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD">database</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75"> [&lt;table1&gt; &lt;table2&gt; ...]</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> backup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">sql</span></span></code></pre>
</div><ul>
<li><strong><code>host</code></strong> - Máy chủ Mysql</li>
<li><strong><code>port</code></strong> - Cổng của máy chủ Mysql</li>
<li><strong><code>username</code></strong> - Tên người dùng cơ sở dữ liệu</li>
<li><strong><code>dbname</code></strong> - Tên cơ sở dữ liệu</li>
<li>Tham số table1 và table2 đại diện cho tên các bảng cần sao lưu, nếu để trống thì sao lưu toàn bộ cơ sở dữ liệu;</li>
<li>Tham số BackupName.sql đại diện cho tên tệp sao lưu được tạo ra, bạn có thể thêm đường dẫn tuyệt đối trước tên tệp. Thông thường, cơ sở dữ liệu được sao lưu thành một tệp có phần mở rộng là sql.</li>
</ul>
<h4>Sao lưu nhiều cơ sở dữ liệu</h4>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysqldump -u </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -p </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">--databases &lt;database1&gt; &lt;database2&gt; ... &gt; backup.sql</span></span></code></pre>
</div><h4>Sao lưu tất cả cơ sở dữ liệu</h4>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysqldump -u </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -p </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">--all-databases &gt; backup.sql</span></span></code></pre>
</div><h4>Khôi phục một cơ sở dữ liệu</h4>
<p>Để khôi phục dữ liệu MySQL, chúng ta sử dụng lệnh mysql.</p>
<p>Cú pháp:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql -h </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -P</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -u</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -p</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD">database</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> &lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> backup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">sql</span></span></code></pre>
</div><h4>Khôi phục tất cả cơ sở dữ liệu</h4>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql -u</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> -p </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">--all-databases &lt; backup.sql</span></span></code></pre>
</div><h3>Gỡ cài đặt</h3>
<p>(1) Xem MySQL đã được cài đặt</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> rpm</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -qa</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">grep</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -i</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">perl-DBD-MySQL-4.023-6.el7.x86_64</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql80-community-release-el7-1.noarch</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-common-8.0.12-1.el7.x86_64</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-client-8.0.12-1.el7.x86_64</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-libs-compat-8.0.12-1.el7.x86_64</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">mysql-community-libs-8.0.12-1.el7.x86_64</span></span></code></pre>
</div><p>(2) Gỡ cài đặt MySQL</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">yum</span><span style="color:#98C379;--shiki-dark:#98C379"> remove</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql-community-server.x86_64</span></span></code></pre>
</div><h3>Triển khai Master-Slave</h3>
<p>Giả sử bạn cần cấu hình một môi trường máy chủ Master-Slave cho MySQL:</p>
<ul>
<li>Node Master: 192.168.8.10</li>
<li>Node Slave: 192.168.8.11</li>
</ul>
<h4>Các bước trên Node Master</h4>
<p>(1) Sửa đổi cấu hình và khởi động lại</p>
<p>Chạy lệnh <code>vi /etc/my.cnf</code> và thêm cấu hình sau:</p>
<div class="language-ini" data-ext="ini" data-title="ini"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">[mysqld]</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">server-id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">log_bin</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">/var/lib/mysql/binlog</span></span></code></pre>
</div><ul>
<li><code>server-id</code> - Số ID của máy chủ. Trong kiến trúc Master-Slave, mỗi máy phải có một ID duy nhất.</li>
<li><code>log_bin</code> - Đường dẫn và tên tệp nhật ký đồng bộ, hãy đảm bảo rằng thư mục này có quyền ghi cho MySQL;</li>
</ul>
<p>Sau khi chỉnh sửa, khởi động lại MySQL để áp dụng cấu hình mới:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">systemctl </span><span style="color:#C678DD;--shiki-dark:#C678DD">restart</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql</span></span></code></pre>
</div><p>(2) Tạo người dùng cho đồng bộ hoá</p>
<p>Truy cập vào bảng điều khiển MySQL:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>$ mysql -u root -p</span></span>
<span class="line"><span>Password:</span></span></code></pre>
</div><p>Thực hiện các câu lệnh SQL sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- a. Tạo người dùng slave</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Cấp quyền REPLICATION SLAVE cho slave</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'slave'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- b. Hoặc, tạo người dùng slave và cho phép người dùng đăng nhập từ bất kỳ máy chủ nào</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Nếu có nhiều slave và bạn muốn tất cả các slave sử dụng cùng một tên người dùng và mật khẩu, bạn có thể sử dụng cách này</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'slave'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Làm mới thông tin bảng phân quyền</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">FLUSH PRIVILEGES;</span></span></code></pre>
</div><blockquote>
<p>Lưu ý: Trong MySQL 8, phương thức xác thực mặc định không còn là <code>password</code>. Vì vậy, khi tạo người dùng, <code>create user 'username'@'%' identified by 'password';</code> không thể kết nối từ máy khách. Vì vậy, bạn cần thêm <code>IDENTIFIED WITH mysql_native_password BY 'password'</code> khi tạo người dùng.</p>
</blockquote>
<p>SQL quản lý người dùng bổ sung:</p>
<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xem tất cả người dùng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT DISTINCT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> CONCAT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">'User: '''</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, user, </span><span style="color:#98C379;--shiki-dark:#98C379">'''@'''</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, host, </span><span style="color:#98C379;--shiki-dark:#98C379">''';'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> query</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66"> mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#D19A66;--shiki-dark:#D19A66">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xem quyền của người dùng</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW GRANTS </span><span style="color:#C678DD;--shiki-dark:#C678DD">FOR</span><span style="color:#98C379;--shiki-dark:#98C379"> 'root'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Tạo người dùng</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- a. Tạo người dùng slave và chỉ cho phép người dùng đăng nhập từ máy chủ 192.168.8.11</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.8.11'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Cấp quyền REPLICATION SLAVE cho slave</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'slave'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.8.11'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xóa người dùng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#98C379;--shiki-dark:#98C379"> 'slave'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.8.11'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) Thêm khóa đọc</p>
<p>Để đảm bảo dữ liệu trên máy chủ chính và máy chủ phụ giữ nguyên, chúng ta sẽ thêm khóa đọc cho MySQL, biến nó thành chỉ có thể đọc.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> FLUSH TABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#C678DD;--shiki-dark:#C678DD"> READ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> LOCK;</span></span></code></pre>
</div><p>(4) Xem trạng thái của máy chủ chính</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> show </span><span style="color:#C678DD;--shiki-dark:#C678DD">master</span><span style="color:#C678DD;--shiki-dark:#C678DD"> status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">+</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200714115031.png" type="image/png"/>
    </item>
    <item>
      <title>MySQL Optimization</title>
      <link>https://vanhung4499.github.io/database/mysql/optimization.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/optimization.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Optimization</source>
      <description>MySQL Optimization Slow Query (Truy vấn chậm) Nhật ký truy vấn chậm có thể giúp chúng ta tìm ra các câu lệnh SQL thực thi chậm. Bạn có thể kiểm tra xem nhật ký truy vấn chậm có ...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Slow Query (Truy vấn chậm)</h2>
<p>Nhật ký truy vấn chậm có thể giúp chúng ta tìm ra các câu lệnh SQL thực thi chậm.</p>
<p>Bạn có thể kiểm tra xem nhật ký truy vấn chậm có được bật hay không bằng cách sử dụng lệnh sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> show variables </span><span style="color:#C678DD;--shiki-dark:#C678DD">like</span><span style="color:#98C379;--shiki-dark:#98C379"> '%slow_query_log%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">+</span></span></code></pre>
</div>]]></content:encoded>
    </item>
    <item>
      <title>MySQL Overview</title>
      <link>https://vanhung4499.github.io/database/mysql/overview.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/overview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Overview</source>
      <description>MySQL Overview Contents</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Contents</h2>
]]></content:encoded>
    </item>
    <item>
      <title>MySQL Replication</title>
      <link>https://vanhung4499.github.io/database/mysql/replication.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/replication.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Replication</source>
      <description>MySQL Replication Replication Replication là một phương pháp phổ biến để giải quyết vấn đề có sẵn cao của hệ thống. Ý tưởng cơ bản là: không nên để tất cả trứng vào một giỏ. Vấn...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Replication</h2>
<p>Replication là một phương pháp phổ biến để giải quyết vấn đề có sẵn cao của hệ thống. Ý tưởng cơ bản là: không nên để tất cả trứng vào một giỏ.</p>
<p>Vấn đề cơ bản mà replication giải quyết là đồng bộ hóa dữ liệu của một máy chủ với các máy chủ khác. Dữ liệu từ một máy chủ chính có thể được replication đến nhiều máy chủ dự phòng, và các máy chủ dự phòng có thể được cấu hình thành một máy chủ chính cho một máy chủ khác. Có nhiều cách khác nhau để kết hợp máy chủ chính và máy chủ dự phòng.</p>
<p>MySQL hỗ trợ hai phương pháp replication: replication dựa trên hàng và replication dựa trên câu lệnh. Cả hai phương pháp đều sử dụng cách ghi lại bin log trên máy chủ chính và chạy lại log trên máy chủ dự phòng để thực hiện replication dữ liệu bất đồng bộ. Điều này có nghĩa là quá trình replication có độ trễ và trong khoảng thời gian này, dữ liệu giữa máy chủ chính và máy chủ phụ có thể không đồng nhất.</p>
<h3>Cách thức hoạt động của replication</h3>
<p>Trong MySQL, quá trình replication được chia thành ba bước, mỗi bước do một luồng hoàn thành:</p>
<ul>
<li><strong>Luồng binlog dump</strong> - Trên máy chủ chính có một luồng đặc biệt gọi là luồng binlog dump, chịu trách nhiệm ghi các thay đổi dữ liệu từ máy chủ chính vào binlog.</li>
<li><strong>Luồng I/O</strong> - Trên máy chủ dự phòng có một luồng I/O, chịu trách nhiệm đọc binlog từ máy chủ chính và ghi vào log trung gian (relay log) của máy chủ dự phòng.</li>
<li><strong>Luồng SQL</strong> - Trên máy chủ dự phòng có một luồng SQL, chịu trách nhiệm đọc log trung gian (relay log) và thực hiện lại các câu lệnh SQL từ đó.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624154231.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<p>Kiến ​​trúc này giải quyết vấn đề giải phóng dữ liệu và đồng bộ hóa dữ liệu bất đồng bộ. Tuy nhiên, kiến ​​trúc này cũng giới hạn quá trình replication, điểm quan trọng nhất là các truy vấn đang chạy song song trên máy chủ chính phải được thực hiện tuần tự trên máy chủ dự phòng, vì chỉ có một luồng SQL để chạy lại các sự kiện trong relay log.</p>
<h3>Cấu hình replication Master-Slave</h3>
<p>Giả sử bạn cần cấu hình một cặp nút MySQL Master-Slave với môi trường sau đây:</p>
<ul>
<li>Nút Master: 192.168.8.10</li>
<li>Nút Slave: 192.168.8.11</li>
</ul>
<h4>Các bước trên nút Master</h4>
<ol>
<li>
<p><strong>Sửa đổi cấu hình và khởi động lại</strong></p>
<p>Sử dụng lệnh <code>vi /etc/my.cnf</code>, thêm các cấu hình sau:</p>
</li>
</ol>
<div class="language-ini" data-ext="ini" data-title="ini"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">[mysqld]</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">server-id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">log_bin</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">=</span><span style="color:#98C379;--shiki-dark:#98C379">/var/lib/mysql/binlog</span></span></code></pre>
</div><ul>
<li><code>server-id</code> - ID duy nhất của máy chủ trong kiến ​​trúc Master-Slave.</li>
<li><code>log_bin</code> - Đường dẫn và tên tập tin log để đồng bộ, đảm bảo thư mục này có quyền ghi của MySQL.</li>
</ul>
<p>Sau khi chỉnh sửa, khởi động lại MySQL để cập nhật cấu hình:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379"> restart</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql</span></span></code></pre>
</div><ol start="2">
<li><strong>Tạo người dùng đồng bộ</strong></li>
</ol>
<p>Truy cập vào MySQL console:</p>
<div class="language-sh" data-ext="sh" data-title="sh"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> mysql</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -u</span><span style="color:#98C379;--shiki-dark:#98C379"> root</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Password:</span></span></code></pre>
</div><p>Thực thi các lệnh SQL sau:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- a. Tạo người dùng 'slave' có thể đăng nhập từ bất kỳ địa chỉ IP nào</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">   CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">   GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'slave'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'%'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">   -- b. Hoặc, tạo người dùng 'slave' có thể đăng nhập từ một địa chỉ IP cụ thể</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">   CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> '</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">'@</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.8.11'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD">BY</span><span style="color:#98C379;--shiki-dark:#98C379"> 'password'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">   GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD">TO</span><span style="color:#98C379;--shiki-dark:#98C379"> 'slave'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">@</span><span style="color:#98C379;--shiki-dark:#98C379">'192.168.8.11'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">   -- Làm mới lại các quyền</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">   FLUSH PRIVILEGES;</span></span></code></pre>
</div><p>Để đảm bảo tương thích với MySQL 8 trở lên, sử dụng <code>mysql_native_password</code> cho phương thức xác thực.</p>
<ol start="3">
<li><strong>Khóa đọc</strong></li>
</ol>
<p>Để đồng bộ dữ liệu giữa Master và Slave, khóa đọc trên Master:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">   mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> FLUSH TABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD">WITH</span><span style="color:#C678DD;--shiki-dark:#C678DD"> READ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> LOCK;</span></span></code></pre>
</div><ol start="4">
<li><strong>Xem trạng thái của Master</strong></li>
</ol>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">   mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> SHOW </span><span style="color:#C678DD;--shiki-dark:#C678DD">MASTER</span><span style="color:#C678DD;--shiki-dark:#C678DD"> STATUS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">   +</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624154231.png" type="image/png"/>
    </item>
    <item>
      <title>MySQL Transaction</title>
      <link>https://vanhung4499.github.io/database/mysql/transaction.html</link>
      <guid>https://vanhung4499.github.io/database/mysql/transaction.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">MySQL Transaction</source>
      <description>MySQL Transaction Không phải tất cả các engine lưu trữ của MySQL đều hỗ trợ giao dịch. Các engine lưu trữ hỗ trợ giao dịch bao gồm: InnoDB và NDB Cluster. Các engine lưu trữ khô...</description>
      <category>mysql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Không phải tất cả các engine lưu trữ của MySQL đều hỗ trợ giao dịch. Các engine lưu trữ hỗ trợ giao dịch bao gồm:&nbsp;<code>InnoDB</code>&nbsp;và&nbsp;<code>NDB Cluster</code>. Các engine lưu trữ không hỗ trợ giao dịch bao gồm:&nbsp;<code>MyISAM</code>.</p>
<p>Người dùng có thể chọn engine lưu trữ phù hợp dựa trên việc có cần xử lý giao dịch hay không (xử lý giao dịch có thể đảm bảo an toàn dữ liệu nhưng sẽ tăng chi phí hệ thống).</p>
</blockquote>
<h2>Giới thiệu về giao dịch</h2>
<blockquote>
<p>Giao dịch đơn giản là:&nbsp;<strong>Tất cả các hoạt động trong một phiên làm việc phải thành công hoặc thất bại cùng nhau</strong>. Cụ thể hơn, giao dịch là một nhóm các hoạt động tuân thủ các đặc điểm ACID, có thể được gửi đi bằng cách sử dụng&nbsp;<code>Commit</code>&nbsp;để xác nhận giao dịch hoặc sử dụng&nbsp;<code>Rollback</code>&nbsp;để hoàn tác giao dịch.</p>
</blockquote>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/185b9c49-4c13-4241-a848-fbff85c03a64.png" alt="185b9c49-4c13-4241-a848-fbff85c03a64.png" tabindex="0" loading="lazy"><figcaption>185b9c49-4c13-4241-a848-fbff85c03a64.png</figcaption></figure>
<p><strong>Giao dịch là một nhóm các câu lệnh SQL nguyên tử</strong>. Cụ thể hơn, giao dịch là một nhóm các hoạt động tuân thủ các đặc điểm ACID.</p>
<p><strong>Các câu lệnh SQL trong giao dịch phải được thực thi hoàn toàn thành công hoặc thất bại hoàn toàn</strong>.</p>
<p><strong>Các cơ chế cách ly giao dịch khác nhau có thể được thực hiện bằng cách sử dụng khóa</strong>.</p>
<p>Hãy tưởng tượng nếu không có giao dịch, trong môi trường đồng thời, có thể xảy ra việc mất mát thay đổi.</p>
<p>Hai luồng T1&nbsp;và T2&nbsp;đều thay đổi dữ liệu, T1&nbsp;thay đổi trước, T2&nbsp;thay đổi sau, thay đổi của T2&nbsp;ghi đè lên thay đổi của T1.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002023.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h2>Cách sử dụng giao dịch</h2>
<h3>Các lệnh xử lý giao dịch</h3>
<p>Trong MySQL, sử dụng câu lệnh&nbsp;<code>START TRANSACTION</code>&nbsp;để bắt đầu một giao dịch; sử dụng câu lệnh&nbsp;<code>COMMIT</code>&nbsp;để xác nhận tất cả các thay đổi; sử dụng câu lệnh&nbsp;<code>ROLLBACK</code>&nbsp;để hoàn tác tất cả các thay đổi. Không thể hoàn tác câu lệnh&nbsp;<code>SELECT</code>, việc hoàn tác câu lệnh&nbsp;<code>SELECT</code>&nbsp;cũng không có ý nghĩa; cũng không thể hoàn tác câu lệnh&nbsp;<code>CREATE</code>&nbsp;và&nbsp;<code>DROP</code>.</p>
<ul>
<li><code>START TRANSACTION</code>&nbsp;- Câu lệnh dùng để đánh dấu điểm bắt đầu của giao dịch.</li>
<li><code>SAVEPOINT</code>&nbsp;- Câu lệnh dùng để tạo điểm lưu trữ.</li>
<li><code>ROLLBACK TO</code>&nbsp;- Câu lệnh dùng để hoàn tác đến điểm lưu trữ đã chỉ định; nếu không có điểm lưu trữ được đặt, nó sẽ hoàn tác đến câu lệnh&nbsp;<code>START TRANSACTION</code>.</li>
<li><code>COMMIT</code>&nbsp;- Xác nhận giao dịch.</li>
</ul>
<p>Ví dụ xử lý giao dịch:</p>
<p>(1) Tạo một bảng ví dụ</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xóa bảng user nếu tồn tại</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> IF</span><span style="color:#C678DD;--shiki-dark:#C678DD"> EXISTS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> user;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Tạo bảng user</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TABLE</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  id </span><span style="color:#C678DD;--shiki-dark:#C678DD">int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) unsigned </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379">'Id'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  username </span><span style="color:#C678DD;--shiki-dark:#C678DD">varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">64</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> DEFAULT</span><span style="color:#98C379;--shiki-dark:#98C379"> 'default'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379">'Tên đăng nhập'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">  password</span><span style="color:#C678DD;--shiki-dark:#C678DD"> varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">64</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> DEFAULT</span><span style="color:#98C379;--shiki-dark:#98C379"> 'default'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379">'Mật khẩu'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">  email </span><span style="color:#C678DD;--shiki-dark:#C678DD">varchar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#D19A66;--shiki-dark:#D19A66">64</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#C678DD;--shiki-dark:#C678DD">NOT NULL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> DEFAULT</span><span style="color:#98C379;--shiki-dark:#98C379"> 'default'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> COMMENT </span><span style="color:#98C379;--shiki-dark:#98C379">'Email'</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) COMMENT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'Bảng người dùng'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><p>(2) Thực hiện các hoạt động giao dịch</p>
<div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Bắt đầu giao dịch</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">START TRANSACTION</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Thực hiện hoạt động A</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#98C379;--shiki-dark:#98C379"> `user`</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'root1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'root1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'xxxx@163.com'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Tạo điểm lưu trữ updateA</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SAVEPOINT updateA;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Thực hiện hoạt động B</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">INSERT INTO</span><span style="color:#98C379;--shiki-dark:#98C379"> `user`</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">VALUES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'root2'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'root2'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#98C379;--shiki-dark:#98C379">'xxxx@163.com'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Hoàn tác đến điểm lưu trữ updateA</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">ROLLBACK</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TO</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> updateA;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xác nhận giao dịch, chỉ hoạt động A được áp dụng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">COMMIT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) Kết quả thực thi</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> user;</span></span></code></pre>
</div><p>Kết quả:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>1	root1	root1	xxxx@163.com</span></span></code></pre>
</div><h3>AUTOCOMMIT</h3>
<p><strong>Mặc định, MySQL sử dụng chế độ xác nhận ngầm (<code>autocommit</code>)</strong>. Mỗi câu lệnh được thực thi được coi là một giao dịch và được xác nhận. Khi gặp câu lệnh&nbsp;<code>START TRANSACTION</code>, chế độ xác nhận ngầm sẽ bị tắt; sau khi thực hiện câu lệnh&nbsp;<code>COMMIT</code>&nbsp;hoặc&nbsp;<code>ROLLBACK</code>, giao dịch sẽ tự động đóng và chế độ xác nhận ngầm sẽ được khôi phục.</p>
<p>Bằng cách sử dụng&nbsp;<code>set autocommit=0</code>, bạn có thể hủy bỏ xác nhận tự động cho đến khi&nbsp;<code>set autocommit=1</code>&nbsp;được thực hiện; cờ&nbsp;<code>autocommit</code>&nbsp;được áp dụng cho mỗi kết nối chứ không phải cho máy chủ.</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xem cờ AUTOCOMMIT</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW VARIABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD">LIKE</span><span style="color:#98C379;--shiki-dark:#98C379"> 'AUTOCOMMIT'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Tắt AUTOCOMMIT</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> autocommit </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Bật AUTOCOMMIT</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> autocommit </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h1>ACID</h1>
<p>ACID là bốn yếu tố cơ bản để đảm bảo thực hiện giao dịch đúng đắn trong cơ sở dữ liệu.</p>
<ul>
<li><strong>Tính nguyên tử (Atomicity)</strong>
<ul>
<li>Giao dịch được coi là đơn vị nhỏ nhất không thể chia tách, tất cả các hoạt động trong giao dịch phải được thực hiện hoàn toàn thành công hoặc hoàn toàn thất bại.</li>
<li>Rollback có thể được thực hiện bằng cách sử dụng nhật ký, nhật ký ghi lại các thay đổi được thực hiện trong giao dịch và thực hiện ngược lại các thay đổi này khi rollback.</li>
</ul>
</li>
<li><strong>Tính nhất quán (Consistency)</strong>
<ul>
<li>Cơ sở dữ liệu duy trì trạng thái nhất quán trước và sau khi thực hiện giao dịch.</li>
<li>Trong trạng thái nhất quán, kết quả đọc của tất cả các giao dịch đối với một dữ liệu là giống nhau.</li>
</ul>
</li>
<li><strong>Tính cô lập (Isolation)</strong>
<ul>
<li>Sự thay đổi mà một giao dịch thực hiện không được nhìn thấy bởi các giao dịch khác cho đến khi nó được cam kết.</li>
</ul>
</li>
<li><strong>Tính bền vững (Durability)</strong>
<ul>
<li>Khi một giao dịch được cam kết, các thay đổi mà nó thực hiện sẽ được lưu trữ vĩnh viễn trong cơ sở dữ liệu. Ngay cả khi hệ thống gặp sự cố, kết quả của giao dịch vẫn không bị mất.</li>
<li>Điều này có thể được đạt được bằng sao lưu và khôi phục cơ sở dữ liệu, trong trường hợp hệ thống gặp sự cố.</li>
</ul>
</li>
</ul>
<p><strong>Hệ thống cơ sở dữ liệu hỗ trợ giao dịch phải có bốn tính chất này, nếu không, không thể đảm bảo tính chính xác của dữ liệu trong quá trình giao dịch.</strong></p>
<ul>
<li>Chỉ khi tuân thủ tính nhất quán, kết quả thực hiện của giao dịch mới là chính xác.</li>
<li>Trong trường hợp không có sự cạnh tranh, khi giao dịch được thực hiện tuần tự, tính cô lập sẽ được đảm bảo. Khi đó, chỉ cần đảm bảo tính nguyên tử, tính nhất quán cũng sẽ được đảm bảo.</li>
<li>Trong trường hợp có sự cạnh tranh, khi nhiều giao dịch được thực hiện song song, giao dịch không chỉ cần đảm bảo tính nguyên tử mà còn cần đảm bảo tính cô lập để đảm bảo tính nhất quán.</li>
<li>Tính bền vững của giao dịch là để xử lý trường hợp hệ thống gặp sự cố.</li>
</ul>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/acid.png" alt="acid.png" tabindex="0" loading="lazy"><figcaption>acid.png</figcaption></figure>
<blockquote>
<p>Mysql mặc định sử dụng chế độ tự động cam kết (<code>AUTO COMMIT</code>). Điều này có nghĩa là nếu không sử dụng rõ ràng câu lệnh&nbsp;<code>START TRANSACTION</code>&nbsp;để bắt đầu một giao dịch, mỗi câu lệnh truy vấn sẽ được coi là một giao dịch và tự động cam kết.</p>
</blockquote>
<h2>Các cấp độ cô lập giao dịch</h2>
<h3>Giới thiệu về cấp độ cô lập giao dịch</h3>
<p>Trong môi trường đồng thời, rất khó đảm bảo tính cô lập của giao dịch, do đó sẽ xuất hiện nhiều vấn đề về tính nhất quán:</p>
<ul>
<li><strong>Mất mát thay đổi</strong></li>
<li><strong>Đọc bẩn (Dirty Read)</strong></li>
<li><strong>Đọc không nhất quán (Non-Repeatable Read)</strong></li>
<li><strong>Đọc ảo (Phantom Read)</strong></li>
</ul>
<p>Trong tiêu chuẩn SQL, xác định bốn cấp độ cô lập giao dịch (từ thấp đến cao):</p>
<ul>
<li><strong>Đọc chưa cam kết (Read Uncommitted)</strong></li>
<li><strong>Đọc đã cam kết (Read Committed)</strong></li>
<li><strong>Đọc lặp lại (Repeatable Read)</strong></li>
<li><strong>Serializable (Serializable)</strong></li>
</ul>
<p>Xem và thiết lập cấp độ cô lập giao dịch trong MySQL:</p>
<div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Xem cấp độ cô lập giao dịch</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">SHOW VARIABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD">LIKE</span><span style="color:#98C379;--shiki-dark:#98C379"> 'transaction_isolation'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Thiết lập cấp độ cô lập giao dịch là READ UNCOMMITTED</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SESSION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> READ</span><span style="color:#C678DD;--shiki-dark:#C678DD"> UNCOMMITTED</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Thiết lập cấp độ cô lập giao dịch là READ COMMITTED</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SESSION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> READ</span><span style="color:#C678DD;--shiki-dark:#C678DD"> COMMITTED</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Thiết lập cấp độ cô lập giao dịch là REPEATABLE READ</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SESSION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> REPEATABLE</span><span style="color:#C678DD;--shiki-dark:#C678DD"> READ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">-- Thiết lập cấp độ cô lập giao dịch là SERIALIZABLE</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SESSION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> TRANSACTION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> ISOLATION</span><span style="color:#C678DD;--shiki-dark:#C678DD"> LEVEL</span><span style="color:#C678DD;--shiki-dark:#C678DD"> SERIALIZABLE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span></code></pre>
</div><h3>Đọc chưa cam kết</h3>
<p><strong><code>Đọc chưa cam kết (Read Uncommitted)</code></strong>&nbsp;có nghĩa là: Các thay đổi trong giao dịch, ngay cả khi chưa được cam kết, cũng có thể nhìn thấy bởi các giao dịch khác.</p>
<p>Vấn đề của đọc chưa cam kết: Giao dịch có thể đọc dữ liệu chưa được cam kết, còn được gọi là&nbsp;<strong>đọc bẩn (Dirty Read)</strong>.</p>
<p>T1&nbsp;thay đổi một dữ liệu, T2&nbsp;sau đó đọc dữ liệu này. Nếu T1&nbsp;hủy bỏ thay đổi này, thì dữ liệu đọc bởi T2&nbsp;là dữ liệu bẩn.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/202307210021321.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h3>Đọc đã cam kết</h3>
<p><strong><code>Đọc đã cam kết (Read Committed)</code></strong>&nbsp;có nghĩa là: Các thay đổi trong giao dịch chỉ có thể nhìn thấy bởi các giao dịch khác sau khi đã được cam kết. Nó giải quyết vấn đề đọc dơ bẩn.</p>
<p>Đọc đã cam kết là cấp độ cô lập mặc định của hầu hết các cơ sở dữ liệu.</p>
<p>Vấn đề của đọc đã cam kết: Khi thực hiện hai lần truy vấn giống nhau, kết quả có thể không nhất quán.</p>
<p>T2&nbsp;đọc một dữ liệu, T1&nbsp;thay đổi dữ liệu này. Nếu T2&nbsp;đọc dữ liệu này lần nữa, kết quả đọc sẽ khác với kết quả đọc lần đầu.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002326.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h3>Đọc lặp lại</h3>
<p><strong><code>Đọc lặp lại (Repeatable Read)</code></strong>&nbsp;có nghĩa là: Đảm bảo kết quả của việc đọc nhiều lần cùng một dữ liệu trong cùng một giao dịch là giống nhau. Đọc lặp lại giải quyết vấn đề đọc không nhất quán.</p>
<p>Đọc lặp lại là cấp độ cô lập mặc định của MySQL.</p>
<p>Vấn đề của đọc lặp lại: Khi một giao dịch T1 đọc một phạm vi dữ liệu, giao dịch T2 chèn một bản ghi mới vào phạm vi đó, sau đó giao dịch T1 đọc lại phạm vi dữ liệu này, kết quả đọc sẽ khác với kết quả đọc lần đầu, được gọi là&nbsp;<strong>đọc ảo (Phantom Read)</strong>.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230721002333.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h3>Tuần tự hoá</h3>
<p><strong><code>Tuần tự hoá (Serializable)</code></strong>&nbsp;có nghĩa là: Buộc giao dịch thực hiện tuần tự, khóa đọc và ghi cho cùng một hàng dữ liệu. Nếu xảy ra xung đột khóa, giao dịch phía trước phải chờ giao dịch phía sau giải phóng khóa.</p>
<p>Thực hiện giao dịch tuần tự sẽ tránh tất cả các vấn đề đồng thời. Chiến lược tuần tự hóa sẽ khóa từng hàng dữ liệu được đọc, điều này có thể dẫn đến nhiều thời gian chờ và cạnh tranh khóa. Điều này gần như không thể chấp nhận được đối với các ứng dụng có độ tải cao, vì vậy thường không sử dụng cấp độ này.</p>
<h3>Tóm tắt về các cấp độ cô lập</h3>
<ul>
<li><strong><code>Đọc chưa cam kết (Read Uncommitted)</code></strong>&nbsp;- Các thay đổi trong giao dịch, ngay cả khi chưa được cam kết, cũng có thể nhìn thấy bởi các giao dịch khác.</li>
<li><strong><code>Đọc đã cam kết (Read Committed)</code></strong>&nbsp;- Các thay đổi trong giao dịch chỉ có thể nhìn thấy bởi các giao dịch khác sau khi đã được cam kết.</li>
<li><strong><code>Đọc lặp lại (Repeatable Read)</code></strong>&nbsp;- Đảm bảo kết quả của việc đọc nhiều lần cùng một dữ liệu trong cùng một giao dịch là giống nhau.</li>
<li><strong><code>Tuần tự hoá (Serializable)</code></strong>&nbsp;- Buộc giao dịch thực hiện tuần tự, khóa đọc và ghi cho cùng một hàng dữ liệu.</li>
</ul>
<p>Các vấn đề được giải quyết bởi các cấp độ cô lập giao dịch:</p>
<p>| Cấp độ cô lập | Mất mát thay đổi | Đọc bẩn | Đọc không nhất quán | Đọc ảo |<br>
| :</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/185b9c49-4c13-4241-a848-fbff85c03a64.png" type="image/png"/>
    </item>
    <item>
      <title>Redis</title>
      <link>https://vanhung4499.github.io/database/redis/</link>
      <guid>https://vanhung4499.github.io/database/redis/</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis</source>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
    </item>
    <item>
      <title>Redis In Action</title>
      <link>https://vanhung4499.github.io/database/redis/action.html</link>
      <guid>https://vanhung4499.github.io/database/redis/action.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis In Action</source>
      <description>Redis in action Redis có thể được áp dụng trong nhiều tình huống, dưới đây là một số tình huống sử dụng phổ biến. Bộ nhớ đệm Bộ nhớ đệm là kịch bản ứng dụng phổ biến nhất của Re...</description>
      <category>db</category>
      <category>redis</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Redis có thể được áp dụng trong nhiều tình huống, dưới đây là một số tình huống sử dụng phổ biến.</p>
</blockquote>
<h2>Bộ nhớ đệm</h2>
<p>Bộ nhớ đệm là kịch bản ứng dụng phổ biến nhất của Redis.</p>
<p>Redis có nhiều loại dữ liệu và lệnh hoạt động phong phú, đồng thời có các tính năng hiệu suất cao và tính sẵn sàng cao, khiến nó rất phù hợp cho bộ nhớ đệm phân tán.</p>
<blockquote>
<p>Nguyên tắc cơ bản của việc sử dụng cache, vui lòng tham khảo phần <a href=""><strong>Nguyên tắc cơ bản của cache</strong></a>.</p>
</blockquote>
<h2>BitMap và BloomFilter</h2>
<p>Redis không chỉ hỗ trợ 5 loại dữ liệu cơ bản mà còn có BitMap và BloomFilter (bộ lọc Bloom, có thể được hỗ trợ thông qua Redis Module).</p>
<p>BitMap và BloomFilter đều có thể giải quyết vấn đề xuyên thấu bộ nhớ đệm. Điểm quan trọng là: lọc ra các dữ liệu không thể tồn tại.</p>
<blockquote>
<p>Vấn đề cache penetration có thể được tìm hiểu tại: [<strong>Nguyên tắc cơ bản của cache</strong>]</p>
</blockquote>
<h3>BitMap</h3>
<ul>
<li>BitMap thích hợp cho các tập dữ liệu nhỏ.</li>
<li>Dùng để hiệu quả đánh dấu sự tồn tại của các dữ liệu, từ đó giúp loại bỏ các truy vấn không cần thiết.</li>
</ul>
<h3>BloomFilter</h3>
<ul>
<li>BloomFilter thích hợp cho các tập dữ liệu lớn.</li>
<li>Sử dụng để kiểm tra xem một phần tử có tồn tại trong tập dữ liệu hay không, mà không cần phải lấy toàn bộ dữ liệu từ bộ nhớ đệm.</li>
</ul>
<h2>Khóa phân tán (Distributed Lock)</h2>
<p>Sử dụng Redis như một khóa phân tán có những điểm cơ bản sau:</p>
<ul>
<li><strong>Sự độc quyền</strong>: Sử dụng <code>setnx</code> để chiếm giữ khóa.</li>
<li><strong>Tránh không giải phóng khóa mãi mãi</strong>: Sử dụng <code>expire</code> để đặt thời gian hết hạn, tránh tình trạng giữ khóa mãi mãi gây tắc nghẽn.</li>
<li><strong>Tính nguyên tử</strong>: <code>setnx</code> và <code>expire</code> phải được thực hiện như một lệnh nguyên tử, tránh tình trạng chiếm giữ khóa xong máy chủ bị sập mà không kịp đặt expire, dẫn đến không giải phóng khóa.</li>
</ul>
<blockquote>
<p>Để biết thêm về các cách triển khai khóa phân tán và chi tiết, vui lòng tham khảo: <a href=""><strong>Nguyên tắc cơ bản của khóa phân tán</strong></a></p>
</blockquote>
<h2>keys và scan</h2>
<p>Sử dụng lệnh <code>keys</code> để quét danh sách các key theo một mẫu nhất định.</p>
<p>Nếu Redis đó đang phục vụ dịch vụ trực tuyến, việc sử dụng lệnh <code>keys</code> sẽ gặp vấn đề:</p>
<p>Đầu tiên, Redis là hệ thống đơn luồng. Lệnh <code>keys</code> sẽ gây chặn luồng một khoảng thời gian, dẫn đến dừng dịch vụ trực tuyến cho đến khi lệnh được thực thi xong.</p>
<p>Trong trường hợp này, có thể sử dụng lệnh <code>scan</code>. Lệnh <code>scan</code> cho phép trích xuất danh sách các key theo mẫu mà không chặn luồng. Tuy nhiên, có thể xảy ra sự trùng lặp nhất định, và cần thực hiện loại bỏ trùng lặp ở phía máy khách, tuy nhiên tổng thời gian thực hiện có thể dài hơn so với việc sử dụng trực tiếp lệnh <code>keys</code>.</p>
<p>Tuy nhiên, các lệnh duyệt tăng dần cũng không phải là không có điểm yếu: ví dụ, lệnh <code>SMEMBERS</code> có thể trả về tất cả các phần tử hiện có trong tập hợp, nhưng đối với các lệnh duyệt tăng dần như <code>SCAN</code>, do quá trình duyệt tăng dần có thể sửa đổi các key, nên chỉ có thể đảm bảo giới hạn đối với các phần tử được trả về.</p>
<h2>Xử lý các Key lớn trong Redis</h2>
<h3>Key lớn Redis là gì?</h3>
<p>Key lớn trong Redis không chỉ đơn thuần là giá trị của key lớn mà là giá trị mà key đó đang lưu trữ.</p>
<p>Thường thì hai trường hợp sau được gọi là "Key lớn":</p>
<ul>
<li>Giá trị của kiểu String lớn hơn 10 KB;</li>
<li>Số lượng phần tử trong các kiểu Hash, List, Set, ZSet lớn hơn 5000 phần tử</li>
</ul>
<h3>Key lớn có thể gây ra vấn đề gì?</h3>
<p>Key lớn có thể gây ra các vấn đề sau đây:</p>
<ul>
<li><strong>Chặn thời gian chờ của khách hàng</strong>: Do Redis xử lý các lệnh theo luồng đơn, các thao tác với key lớn có thể tốn nhiều thời gian, làm cho Redis bị chặn và khách hàng không nhận được phản hồi trong một thời gian dài.</li>
<li><strong>Gây ra nghẽn mạng</strong>: Việc truy xuất key lớn tạo ra lưu lượng mạng lớn. Ví dụ, nếu một key có kích thước là 1 MB và có 1000 lần truy cập mỗi giây, điều này có thể tạo ra 1000 MB lưu lượng mạng mỗi giây, gây khó khăn cho máy chủ có card mạng gigabit.</li>
<li><strong>Chặn luồng làm việc</strong>: Xóa một key lớn có thể chặn luồng làm việc, không cho phép xử lý các lệnh tiếp theo.</li>
<li><strong>Phân phối bộ nhớ không đồng đều</strong>: Trong mô hình cụm, nếu một số node Redis chứa các key lớn, chúng có thể chiếm nhiều bộ nhớ hơn và tạo ra một số lượng truy vấn mỗi giây (QPS) lớn hơn.</li>
</ul>
<h3>Làm thế nào để tìm kiếm các Key lớn?</h3>
<p><strong><em>1. Sử dụng redis-cli --bigkeys để tìm kiếm các key lớn</em></strong></p>
<p>Bạn có thể sử dụng lệnh <code>redis-cli --bigkeys</code> để tìm kiếm các key lớn trong Redis:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis-cli</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -h</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 127.0.0.1</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -p</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 6379</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -a</span><span style="color:#98C379;--shiki-dark:#98C379"> "password"</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --</span><span style="color:#98C379;--shiki-dark:#98C379"> bigkeys</span></span></code></pre>
</div><p>Lưu ý khi sử dụng:</p>
<ul>
<li>Nên thực hiện lệnh này trên các node slave thay vì node master. Việc thực hiện trên node master có thể gây ra sự chậm trễ.</li>
<li>Nếu không có node slave, bạn nên chọn thời điểm thấp điểm của tải hoạt động của Redis để thực hiện quét, nhằm tránh ảnh hưởng đến hoạt động bình thường của hệ thống. Hoặc bạn có thể sử dụng tham số <code>-i</code> để điều chỉnh khoảng thời gian quét và tránh giảm hiệu suất trong thời gian dài.</li>
</ul>
<p><strong>Nhược điểm của phương pháp này:</strong></p>
<ul>
<li>Phương pháp này chỉ trả về key lớn nhất trong mỗi loại, không phải là danh sách các key lớn nhất.</li>
<li>Đối với các loại tập hợp, phương pháp này chỉ thống kê số lượng các phần tử trong tập hợp, không phải dung lượng thực tế chiếm giữ. Điều này có nghĩa là một tập hợp có nhiều phần tử không nhất thiết phải chiếm nhiều bộ nhớ nếu mỗi phần tử có dung lượng nhỏ.</li>
</ul>
<p><strong><em>2. Sử dụng lệnh SCAN để tìm kiếm các key lớn</em></strong></p>
<p>Bạn có thể sử dụng lệnh SCAN để quét toàn bộ cơ sở dữ liệu Redis và sau đó sử dụng lệnh TYPE để lấy loại của từng key được trả về.</p>
<p>Đối với các key là kiểu String, bạn có thể sử dụng lệnh STRLEN để lấy độ dài của chuỗi, tức là số byte chiếm giữ trong bộ nhớ.</p>
<p>Đối với các kiểu tập hợp, có hai cách để biết được kích thước bộ nhớ mà chúng chiếm giữ:</p>
<ul>
<li>
<p>Nếu bạn có thể biết trước kích thước trung bình của các phần tử trong tập hợp từ lớp kinh doanh, bạn có thể sử dụng các lệnh sau để lấy số lượng các phần tử trong tập hợp và sau đó nhân với kích thước trung bình của từng phần tử: Lệnh LLEN cho List, HLEN cho Hash, SCARD cho Set và ZCARD cho Sorted Set.</p>
</li>
<li>
<p>Nếu bạn không thể biết trước kích thước các phần tử trong tập hợp, bạn có thể sử dụng lệnh MEMORY USAGE (yêu cầu Redis phiên bản 4.0 trở lên) để truy vấn kích thước bộ nhớ mà một key đang chiếm giữ.</p>
</li>
</ul>
<p><strong><em>3. Sử dụng công cụ RdbTools để tìm kiếm các key lớn</em></strong></p>
<p>Bạn có thể sử dụng công cụ RdbTools, một công cụ mã nguồn mở của bên thứ ba, để phân tích các tập tin chụp Redis (RDB) và tìm kiếm các key lớn trong đó.</p>
<p>Ví dụ, bạn có thể sử dụng lệnh sau để xuất các key có kích thước lớn hơn 10 KB vào một tệp bảng:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">rdb</span><span style="color:#98C379;--shiki-dark:#98C379"> dump.rdb</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -c</span><span style="color:#98C379;--shiki-dark:#98C379"> memory</span><span style="color:#D19A66;--shiki-dark:#D19A66"> --bytes</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10240</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -f</span><span style="color:#98C379;--shiki-dark:#98C379"> redis.csv</span></span></code></pre>
</div><h3>Làm thế nào để xóa key lớn?</h3>
<p>Quá trình xóa key trong Redis thực chất là giải phóng không gian bộ nhớ mà key đó đang chiếm dụng. Tuy nhiên, việc giải phóng bộ nhớ chỉ là bước đầu tiên. Để quản lý không gian bộ nhớ một cách hiệu quả hơn, khi ứng dụng giải phóng bộ nhớ, hệ điều hành cần phải chèn các khối bộ nhớ được giải phóng vào một danh sách liên kết các khối bộ nhớ trống, để sau này có thể quản lý và phân bổ lại. Quá trình này mất một khoảng thời gian nhất định và có thể làm chặn ứng dụng hiện tại đang giải phóng bộ nhớ.</p>
<p>Do đó, nếu giải phóng một lượng lớn bộ nhớ cùng một lúc, thời gian thực hiện các thao tác trên danh sách khối bộ nhớ trống sẽ tăng lên. Điều này có thể dẫn đến chặn trong quá trình chính của Redis. Nếu quá trình chính bị chặn, các yêu cầu khác có thể gặp phải vấn đề vượt thời gian, dẫn đến tình trạng kết nối Redis bị tiêu tốn hết và gây ra các vấn đề khác.</p>
<p>Vì vậy, khi thực hiện hành động xóa key lớn trong Redis, chúng ta cần phải cẩn thận. Dưới đây là hai phương pháp để làm điều này:</p>
<ul>
<li>Xóa key theo từng đợt (phân lô xóa)</li>
<li>Xóa key bất đồng bộ (Redis phiên bản 4.0 trở lên)</li>
</ul>
<h4>Xoá theo đợt</h4>
<p><strong>1. Xóa Hash lớn:</strong></p>
<ul>
<li>Sử dụng lệnh <code>hscan</code> để lấy 100 trường (fields) mỗi lần.</li>
<li>Sau đó sử dụng lệnh <code>hdel</code> để xóa từng trường một.</li>
</ul>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> del_large_hash</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    r </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">StrictRedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'redis-host1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    large_hash_key </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> "xxx"</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  # Tên key hash lớn cần xóa</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    cursor </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> '0'</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> cursor </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        cursor, data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hscan</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_hash_key, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">cursor</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">cursor, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">count</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> field, value </span><span style="color:#C678DD;--shiki-dark:#C678DD">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> data.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">items</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hdel</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_hash_key, field)</span></span></code></pre>
</div><p><strong>2. Xóa List lớn:</strong></p>
<ul>
<li>Sử dụng lệnh <code>ltrim</code> để mỗi lần chỉ giữ lại một phần nhỏ của list.</li>
</ul>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> del_large_list</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    r </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">StrictRedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'redis-host1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    large_list_key </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> 'xxx'</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  # Tên key list lớn cần xóa</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">llen</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_list_key) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">ltrim</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_list_key, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">101</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)  </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Chỉ giữ lại 100 phần tử cuối cùng của list</span></span></code></pre>
</div><p><strong>3. Xóa Set lớn:</strong></p>
<ul>
<li>Sử dụng lệnh <code>sscan</code> để quét từng phần tử của set (100 phần tử mỗi lần).</li>
<li>Sử dụng lệnh <code>srem</code> để xóa từng phần tử một.</li>
</ul>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> del_large_set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    r </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">StrictRedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'redis-host1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    large_set_key </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> 'xxx'</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">   # Tên key set lớn cần xóa</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    cursor </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> '0'</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> cursor </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        cursor, data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">sscan</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_set_key, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">cursor</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">cursor, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">count</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> member </span><span style="color:#C678DD;--shiki-dark:#C678DD">in</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> data:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">            r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">srem</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_set_key, member)</span></span></code></pre>
</div><p><strong>4. Xóa Sorted Set lớn:</strong></p>
<ul>
<li>Sử dụng lệnh <code>zremrangebyrank</code> để xóa một lượng phần tử hàng đầu của Sorted Set.</li>
</ul>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">import</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> del_large_sortedset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    r </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redis.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">StrictRedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379">'redis-host1'</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66">6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    large_sortedset_key </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#98C379;--shiki-dark:#98C379"> 'xxx'</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">  # Tên key Sorted Set lớn cần xóa</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zcard</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_sortedset_key) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        r.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zremrangebyrank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(large_sortedset_key, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#D19A66;--shiki-dark:#D19A66">99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)  </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Xóa 100 phần tử đầu tiên của Sorted Set</span></span></code></pre>
</div><h4>Xoá bất đồng bộ</h4>
<p>Từ phiên bản Redis 4.0 trở đi, bạn có thể sử dụng <strong>xóa bất đồng bộ</strong> bằng cách sử dụng lệnh <strong>unlink</strong> thay vì <strong>del</strong> để xóa các key.</p>
<p>Khi đó, Redis sẽ đưa key này vào một luồng bất đồng bộ để thực hiện xóa, điều này giúp tránh chặn luồng chính.</p>
<p>Ngoài việc sử dụng lệnh unlink để thực hiện xóa bất đồng bộ, bạn cũng có thể cấu hình tham số để tự động thực hiện xóa bất đồng bộ trong một số trường hợp cụ thể.</p>
<p>Có tổng cộng 4 cài đặt mặc định như sau:</p>
<div class="language-text" data-ext="text" data-title="text"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>lazyfree-lazy-eviction no</span></span>
<span class="line"><span>lazyfree-lazy-expire no</span></span>
<span class="line"><span>lazyfree-lazy-server-del</span></span>
<span class="line"><span>noslave-lazy-flush no</span></span></code></pre>
</div><ul>
<li>
<p><strong>lazyfree-lazy-eviction</strong>: Được sử dụng để xác định liệu Redis có nên kích hoạt cơ chế xóa lười biếng khi bộ nhớ vượt quá giới hạn maxmemory hay không.</p>
</li>
<li>
<p><strong>lazyfree-lazy-expire</strong>: Xác định liệu Redis có nên kích hoạt cơ chế xóa lười biếng cho các key hết hạn không.</p>
</li>
<li>
<p><strong>lazyfree-lazy-server-del</strong>: Một số lệnh khi xử lý các key đã tồn tại, ví dụ như lệnh rename, nếu key đích đã tồn tại thì Redis sẽ trước tiên xóa key đích này. Nếu key này là một big key, việc xóa có thể gây ra vấn đề chặn. Cài đặt này xác định liệu Redis có nên kích hoạt cơ chế xóa lười biếng trong trường hợp này hay không.</p>
</li>
<li>
<p><strong>noslave-lazy-flush</strong>: Đối với slave (nút con), khi nó tải tệp RDB của master thì trước đó nó sẽ thực hiện lệnh flushall để xóa dữ liệu của nó. Cài đặt này xác định liệu Redis có nên kích hoạt cơ chế xóa lười biếng trong trường hợp này hay không.</p>
</li>
</ul>
<p>Đề xuất nên kích hoạt các cài đặt như lazyfree-lazy-eviction, lazyfree-lazy-expire, lazyfree-lazy-server-del để cải thiện hiệu suất thực thi của luồng chính trong Redis.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Redis Advanced Data Types</title>
      <link>https://vanhung4499.github.io/database/redis/advanced-data-types.html</link>
      <guid>https://vanhung4499.github.io/database/redis/advanced-data-types.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Advanced Data Types</source>
      <description>Redis Advanced Data Types Redis hỗ trợ các kiểu dữ liệu nâng cao như BitMap, HyperLogLog, GEO và Stream. Hiểu được đặc tính của các kiểu dữ liệu này và áp dụng linh hoạt và hiệu...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Redis hỗ trợ các kiểu dữ liệu nâng cao như BitMap, HyperLogLog, GEO và Stream. Hiểu được đặc tính của các kiểu dữ liệu này và áp dụng linh hoạt và hiệu quả vào từng kịch bản nghiệp vụ cụ thể là rất quan trọng khi sử dụng Redis để mô hình hóa dữ liệu.</p>
<h2>BitMap</h2>
<h3>Giới thiệu về BitMap</h3>
<p>BitMap, như tên gọi, là một chuỗi liên tục các số nhị phân (0 và 1) trong đó các phần tử được truy cập bằng các offset. Vì bit là đơn vị nhỏ nhất trong máy tính, việc sử dụng BitMap để lưu trữ có thể <strong>tiết kiệm rất nhiều không gian</strong>, đặc biệt phù hợp cho các kịch bản thống kê nhị phân với tập dữ liệu lớn. Ví dụ, trong một hệ thống nơi mà người dùng được biểu diễn bằng các ID người dùng tăng dần, BitMap có thể lưu trữ hiệu quả trạng thái đăng nhập của từng người dùng. Với BitMap, hệ thống có thể xử lý đến 4 tỷ người dùng (khoảng $$2^{32}$$), chỉ cần 512 MB bộ nhớ để lưu trữ trạng thái đăng nhập.</p>
<h3>Thực hiện BitMap</h3>
<p>Trong thực tế, <strong>BitMap không phải là một cấu trúc dữ liệu độc lập mà là một tập hợp các phép toán bit được thực hiện trên chuỗi String</strong>.</p>
<p>Với Redis, các chuỗi là an toàn cho dữ liệu nhị phân và có thể lưu trữ đến 512 MB độ dài. Do đó, BitMap cho phép thiết lập đến $$2^{32}$$ bit khác nhau, giúp quản lý dữ liệu nhị phân quy mô lớn một cách hiệu quả trong Redis, tận dụng khả năng lưu trữ và thao tác tối ưu của nó.</p>
<h3>Các Lệnh BitMap</h3>
<p>| Lệnh     | Hành động                                                |<br>
|</p>
]]></content:encoded>
    </item>
    <item>
      <title>Redis Basic Data Types</title>
      <link>https://vanhung4499.github.io/database/redis/basic-data-types.html</link>
      <guid>https://vanhung4499.github.io/database/redis/basic-data-types.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Basic Data Types</source>
      <description>Redis Basic Data Types Redis cung cấp nhiều loại dữ liệu, mỗi loại dữ liệu đều có các lệnh hỗ trợ phong phú. Khi sử dụng Redis, không chỉ cần hiểu các đặc điểm của các loại dữ l...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<p>Redis cung cấp nhiều loại dữ liệu, mỗi loại dữ liệu đều có các lệnh hỗ trợ phong phú.</p>
<p>Khi sử dụng Redis, không chỉ cần hiểu các đặc điểm của các loại dữ liệu, mà còn cần linh hoạt và hiệu quả trong việc sử dụng các loại dữ liệu này để xây dựng mô hình dữ liệu phù hợp với kịch bản nghiệp vụ.</p>
<p>Các loại dữ liệu cơ bản mà Redis hỗ trợ:</p>
<ul>
<li><strong>STRING</strong>: Chuỗi</li>
<li><strong>HASH</strong>: Bảng băm</li>
<li><strong>LIST</strong>: List</li>
<li><strong>SET</strong>: Tập hợp</li>
<li><strong>ZSET</strong>: Tập hợp có thứ tự</li>
</ul>
<p>Các loại dữ liệu nâng cao mà Redis hỗ trợ:</p>
<ul>
<li><strong>BitMap</strong>: Bản đồ bit</li>
<li><strong>HyperLogLog</strong>: Đếm dữ liệu khổng lồ</li>
<li><strong>GEO</strong>: Dữ liệu vị trí địa lý</li>
<li><strong>Stream</strong>: Dữ liệu luồng</li>
</ul>
<p>Sử dụng Redis, không chỉ cần hiểu các đặc tính của các loại dữ liệu mà còn cần linh hoạt và hiệu quả trong việc sử dụng các loại dữ liệu này để xây dựng mô hình theo từng tình huống cụ thể của nghiệp vụ.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624195542.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h2>Các kiểu dữ liệu cơ bản của Redis</h2>
<p>|Kiểu dữ liệu|Giá trị có thể lưu trữ|Các hoạt động|<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624195542.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Cluster</title>
      <link>https://vanhung4499.github.io/database/redis/cluster.html</link>
      <guid>https://vanhung4499.github.io/database/redis/cluster.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Cluster</source>
      <description>Redis Cluster Redis Cluster là một giải pháp cơ sở dữ liệu phân tán được cung cấp bởi Redis. Vì là một hệ thống phân tán, nó tự nhiên có các tính chất cơ bản của hệ thống phân t...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><strong>Redis Cluster</strong> là một giải pháp cơ sở dữ liệu phân tán được cung cấp bởi Redis.</p>
<p>Vì là một hệ thống phân tán, nó tự nhiên có các tính chất cơ bản của hệ thống phân tán: có thể mở rộng, có sẵn và nhất quán.</p>
<ul>
<li>Redis Cluster phân vùng dữ liệu bằng cách chia các khe băm (hash slot) để chia sẻ dữ liệu.</li>
<li>Redis Cluster sử dụng mô hình master-slave đồng bộ để cung cấp tính năng sao chép và chuyển giao lỗi, đảm bảo tính sẵn có cao cho Redis Cluster.</li>
<li>Theo lý thuyết CAP, không thể đạt được Consistency, Availability và Partition tolerance cùng một lúc, và Redis Cluster chọn lựa chọn AP. Các nút trong Redis Cluster giao tiếp bất đồng bộ, không đảm bảo tính nhất quán mạnh, nhưng cố gắng đạt được tính nhất quán cuối cùng.</li>
</ul>
</blockquote>
<h2>1. Phân vùng Redis Cluster</h2>
<h3>1.1. Các nút trong Cluster</h3>
<p>Redis Cluster bao gồm nhiều nút, khi một nút khởi động, các nút này ban đầu là độc lập với nhau. <strong>Các nút kết nối với nhau bằng cách gửi tin nhắn "CLUSTER MEET" để thêm các nút khác vào cụm của mình</strong>.</p>
<p>Bằng cách gửi lệnh "CLUSTER MEET" đến một nút, nút hiện tại sẽ kết nối với nút được chỉ định bởi IP và PORT, và khi kết nối thành công, nút hiện tại sẽ thêm nút được chỉ định vào cụm của mình.</p>
<p><strong>Các nút trong Redis Cluster lưu trữ cặp khóa-giá trị và thời gian hết hạn giống như trong Redis đơn</strong>.</p>
<p>Redis Cluster có các nút chính (master) và nút phụ (slave), trong đó nút chính được sử dụng để xử lý các khe băm (slot), và nút phụ được sử dụng để sao chép một nút chính cụ thể và thay thế nút chính khi nút chính bị lỗi.</p>
<h3>1.2. Phân chia Hash Slot</h3>
<p>Vấn đề chính cần giải quyết trong lưu trữ phân tán là phân chia&nbsp;<strong>toàn bộ tập dữ liệu</strong>&nbsp;theo&nbsp;<strong>quy tắc phân vùng</strong>&nbsp;thành&nbsp;<strong>nhiều phân vùng</strong>&nbsp;trên&nbsp;<strong>nhiều nút</strong>, mỗi nút chịu trách nhiệm cho một phần dữ liệu của toàn bộ.</p>
<p><strong>Redis Cluster sử dụng phân chia hash slot để phân vùng dữ liệu</strong>. Redis Cluster chia toàn bộ cơ sở dữ liệu thành 16384 hash slot (khe hash), mỗi khóa trong cơ sở dữ liệu thuộc một trong số 16384 khe hash này, và mỗi nút trong cụm có thể xử lý từ 0 đến tối đa 16384 khe hash.&nbsp;<strong>Nếu có bất kỳ khe hash nào không được xử lý, cụm Redis sẽ được đánh dấu là offline</strong>.</p>
<p>Bằng cách gửi lệnh&nbsp;<a href="https://redis.io/commands/cluster-addslots" target="_blank" rel="noopener noreferrer"><code>CLUSTER ADDSLOTS</code></a>&nbsp;đến một nút, bạn có thể gán một hoặc nhiều khe hash cho nút đó.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>&gt; CLUSTER ADDSLOTS 1 2 3</span></span>
<span class="line"><span>OK</span></span></code></pre>
</div><p>Mỗi nút trong cụm chịu trách nhiệm cho một phần khe hash. Ví dụ, trong một cụm có 3 nút:</p>
<ul>
<li>Nút A chịu trách nhiệm cho khe hash từ 0 đến 5500.</li>
<li>Nút B chịu trách nhiệm cho khe hash từ 5501 đến 11000.</li>
<li>Nút C chịu trách nhiệm cho khe hash từ 11001 đến 16384.</li>
</ul>
<h3>1.3. Địa chỉ</h3>
<p>Khi máy khách gửi một lệnh liên quan đến khóa cơ sở dữ liệu cho nút, nút nhận lệnh sẽ tính toán xem lệnh cần xử lý thuộc về khe nào của cơ sở dữ liệu và kiểm tra xem khe này có được giao cho nút hiện tại không:</p>
<ul>
<li>Nếu khe chứa khóa được giao cho nút hiện tại, nút hiện tại sẽ thực hiện lệnh.</li>
<li>Nếu khe chứa khóa không được giao cho nút hiện tại, nút sẽ trả về một lỗi MOVED cho máy khách, hướng dẫn máy khách chuyển hướng đến nút đúng.</li>
</ul>
<h4>1.3.1. Tính toán khe mà khóa thuộc về</h4>
<p>Giải thuật để quyết định một khóa nên được giao cho khe nào là: <strong>tính toán kết quả CRC16 của khóa và sau đó lấy phần dư của kết quả chia cho 16834</strong>.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>HASH_SLOT = CRC16(KEY) mod 16384</span></span></code></pre>
</div><p>Khi nút tính toán khe mà khóa thuộc về là i, nút sẽ kiểm tra các điều kiện sau để xác định xem khe có được giao cho nút hay không:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>clusterState.slots[i] == clusterState.myself</span></span></code></pre>
</div><h4>1.3.2. Lỗi MOVED</h4>
<p>Khi nút phát hiện rằng khe chứa khóa không được giao cho nút hiện tại, nút sẽ trả về một lỗi <code>MOVED</code>, hướng dẫn máy khách chuyển hướng đến nút đang chịu trách nhiệm khe đó.</p>
<p>Định dạng lỗi <code>MOVED</code> như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>MOVED &lt;khe&gt; &lt;ip&gt;:&lt;port&gt;</span></span></code></pre>
</div><blockquote>
<p>Hiểu theo cách cá nhân: Hành động MOVED này tương tự như chuyển hướng trong giao thức HTTP.</p>
</blockquote>
<h3>1.4. Tái phân vùng</h3>
<p><strong>Hoạt động tái phân vùng trong Redis Cluster cho phép chuyển một số lượng bất kỳ các khe băm đã được giao cho một nút (nút nguồn) sang một nút khác (nút đích), và các cặp khóa-giá trị liên quan đến các khe băm đó cũng sẽ được di chuyển từ nút nguồn sang nút đích</strong>.</p>
<p>Hoạt động tái phân vùng&nbsp;<strong>có thể được thực hiện trực tuyến</strong>, trong quá trình tái phân vùng, Redis Cluster không cần tắt máy và cả nút nguồn và nút đích đều có thể tiếp tục xử lý các yêu cầu lệnh.</p>
<p>Hoạt động tái phân vùng trong Redis Cluster được thực hiện bởi công cụ quản lý Redis Cluster&nbsp;<strong>redis-trib</strong>, nó gửi các lệnh đến nút nguồn và nút đích để thực hiện tái phân vùng.</p>
<h3>1.5. Lỗi ASK</h3>
<p>Lỗi&nbsp;<code>ASK</code>&nbsp;khác với lỗi&nbsp;<code>MOVED</code>&nbsp;ở chỗ:&nbsp;<strong>Lỗi&nbsp;<code>ASK</code>&nbsp;chỉ là một biện pháp tạm thời được sử dụng trong quá trình di chuyển khe băm</strong>, sau khi khách hàng nhận được lỗi&nbsp;<code>ASK</code>&nbsp;về khe băm X, khách hàng chỉ sẽ chuyển hướng yêu cầu lệnh liên quan đến khe băm X sang nút được chỉ định trong lần yêu cầu lệnh tiếp theo, nhưng việc chuyển hướng này sẽ không ảnh hưởng đến các yêu cầu lệnh liên quan đến khe băm X trong tương lai, khách hàng vẫn sẽ gửi yêu cầu lệnh liên quan đến khe băm X đến nút hiện tại đang chịu trách nhiệm xử lý khe băm X, trừ khi lỗi&nbsp;<code>ASK</code>&nbsp;xuất hiện một lần nữa.</p>
<h2>2. Redis Cluster - Quá trình chuyển giao khi xảy ra sự cố</h2>
<h3>2.1. Sao chép</h3>
<p>Cơ chế sao chép Redis có thể được tham khảo tại: [[Redis Replication]]</p>
<h3>2.2. Phát hiện sự cố</h3>
<p><strong>Mỗi nút trong cụm Redis sẽ định kỳ gửi tin nhắn PING đến các nút khác trong cụm để kiểm tra xem chúng có hoạt động không</strong>.</p>
<p>Trạng thái của mỗi nút có thể được chia thành:</p>
<ul>
<li>Trạng thái trực tuyến;</li>
<li>Trạng thái ngoại tuyến (FAIL);</li>
<li>Trạng thái nghi ngờ ngoại tuyến (PFAIL), tức là không có phản hồi PING trong khoảng thời gian quy định;</li>
</ul>
<h3>2.3. Chuyển giao khi xảy ra sự cố</h3>
<ol>
<li>Trong số tất cả các nút con của nút chính bị xảy ra sự cố, một nút con sẽ được chọn.</li>
<li>Nút con được chọn sẽ thực hiện lệnh <code>SLAVEOF no one</code>, trở thành nút chính mới.</li>
<li>Nút chính mới sẽ hủy bỏ việc gán khe cho nút chính đã bị xảy ra sự cố và gán tất cả các khe này cho chính nó.</li>
<li>Nút chính mới sẽ phát sóng một tin nhắn PONG đến cụm Redis, thông báo rằng nút con này đã trở thành nút chính mới.</li>
</ol>
<h3>2.4. Bầu chọn nút chính mới</h3>
<p>Quá trình bầu chọn nút chính mới trong Redis Cluster dựa trên thuật toán đồng thuận: Raft.</p>
<h2>3. Giao tiếp trong Redis Cluster</h2>
<p>Các nút trong cụm Redis giao tiếp thông qua việc gửi và nhận các tin nhắn.</p>
<p>Có năm loại tin nhắn chính mà các nút trong cụm Redis gửi đi:</p>
<ul>
<li><code>MEET</code> - Yêu cầu nút nhận tham gia vào cụm mà nút gửi đang tham gia.</li>
<li><code>PING</code> - Mỗi nút trong cụm Redis sẽ chọn ngẫu nhiên năm nút từ danh sách nút đã biết và gửi tin nhắn PING đến năm nút này, nhằm kiểm tra xem các nút đã chọn có hoạt động không.</li>
<li><code>PONG</code> - Khi nút nhận được tin nhắn MEET hoặc PING từ nút gửi, nó sẽ trả lời bằng một tin nhắn PONG.</li>
<li><code>FAIL</code> - Khi một nút chính A xác định rằng một nút chính B đã vào trạng thái FAIL, nút A sẽ phát sóng một tin nhắn FAIL về nút B cho toàn bộ cụm Redis, tất cả các nút nhận được tin nhắn này sẽ đánh dấu nút B là đã ngoại tuyến.</li>
<li><code>PUBLISH</code> - Khi một nút nhận được một lệnh PUBLISH, nó sẽ thực hiện lệnh này và phát sóng một tin nhắn PUBLISH đến cụm Redis, tất cả các nút nhận được tin nhắn này sẽ thực hiện cùng một lệnh PUBLISH.</li>
</ul>
<h2>4. Ứng dụng của Redis Cluster</h2>
<h3>4.1. Giới hạn chức năng của cụm</h3>
<p>Redis Cluster so với Redis đơn lẻ có một số giới hạn chức năng, các nhà phát triển cần hiểu trước và tránh khi sử dụng.</p>
<ul>
<li>Hỗ trợ hạn chế cho các hoạt động <strong>đa khóa</strong>: Các hoạt động như <code>mset</code>, <code>mget</code> chỉ hỗ trợ cho các khóa có cùng giá trị <code>slot</code>. Các khóa được ánh xạ vào các <code>slot</code> khác nhau không được hỗ trợ.</li>
<li>Hỗ trợ hạn chế cho các hoạt động <strong>giao dịch</strong>: Chỉ hỗ trợ giao dịch cho nhiều khóa trên cùng một nút. Khi nhiều khóa phân tán trên các nút khác nhau, không thể sử dụng chức năng giao dịch.</li>
<li>Không thể ánh xạ một đối tượng khóa lớn như <code>hash</code>, <code>list</code> vào các nút khác nhau. <code>Key</code> được coi là đơn vị phân vùng dữ liệu.</li>
<li>Không hỗ trợ <strong>nhiều không gian cơ sở dữ liệu</strong>: Redis đơn lẻ có thể hỗ trợ <code>16</code> không gian cơ sở dữ liệu (<code>db0 ~ db15</code>), trong khi chế độ cụm chỉ hỗ trợ sử dụng một không gian cơ sở dữ liệu duy nhất, tức là <code>db0</code>.</li>
<li><strong>Sao chép</strong> chỉ hỗ trợ một cấp: Các nút con chỉ có thể sao chép từ nút chính, không hỗ trợ cấu trúc sao chép cây lồng nhau.</li>
</ul>
<h3>4.2. Giới hạn quy mô cụm</h3>
<p>Redis Cluster dễ sử dụng. Các chức năng phân vùng, sao chép chính và mở rộng linh hoạt đều được tự động hóa, chỉ cần triển khai đơn giản là có thể có một cụm Redis lớn với khả năng chứa lượng dữ liệu lớn, đáng tin cậy và có sẵn cao, và đối với ứng dụng, nó gần như là trong suốt.</p>
<p>Vì vậy, Redis Cluster rất phù hợp để xây dựng các cụm Redis trung bình và nhỏ, trong đó có khoảng vài đến vài chục nút.</p>
<p>Tuy nhiên, Redis Cluster không phù hợp để xây dựng các cụm quy mô lớn, chủ yếu là do nó sử dụng một thiết kế phi tập trung.</p>
<p>Trên mỗi nút Redis, nó lưu trữ một bảng ánh xạ giữa tất cả các khe và nút, khách hàng có thể truy cập vào bất kỳ nút nào và sau đó thông qua lệnh chuyển hướng, tìm ra nút chứa dữ liệu. Vậy, bảng ánh xạ này được cập nhật như thế nào? Redis Cluster sử dụng giao thức lan truyền tin đồn (Gossip) để truyền bá các thay đổi cấu hình cụm.</p>
<p>Ưu điểm của Gossip là phi tập trung; nhược điểm là tốc độ truyền bá chậm và càng lớn quy mô cụm, tốc độ truyền bá càng chậm.</p>
<h3>4.3. Cấu hình cụm</h3>
<p>Trước khi triển khai một cụm Redis, chúng ta sẽ giới thiệu các tham số cấu hình trong tệp redis.conf của cụm.</p>
<ul>
<li><strong>cluster-enabled</strong> <code>&lt;yes/no&gt;</code> - Nếu được cấu hình là "yes", chức năng cụm sẽ được bật và Redis instance sẽ là một nút trong cụm, nếu không, nó sẽ là một instance Redis đơn lẻ.</li>
<li><strong>cluster-config-file</strong> <code>&lt;filename&gt;</code> - Lưu ý: Mặc dù tên cấu hình này được gọi là "tệp cấu hình cụm", nhưng tệp cấu hình này không thể chỉnh sửa thủ công, nó là một tệp cấu hình tự động được duy trì bởi các nút cụm, chủ yếu để ghi lại thông tin về các nút trong cụm, trạng thái của chúng và một số tham số bền vững, để khôi phục trạng thái này khi khởi động lại. Thông thường, tệp này sẽ được cập nhật sau khi nhận được yêu cầu.</li>
<li><strong>cluster-node-timeout</strong> <code>&lt;milliseconds&gt;</code> - Đây là thời gian tối đa mà một nút trong cụm có thể mất kết nối. Nếu vượt quá thời gian này, nút sẽ được coi là gặp sự cố. Nếu một nút chính vẫn không thể kết nối sau thời gian này, nút con của nó sẽ tiếp tục chuyển đổi thành nút chính. Lưu ý, nếu một nút không thể kết nối với hầu hết các nút chính trong thời gian này, nó sẽ ngừng nhận bất kỳ yêu cầu nào.</li>
<li><strong>cluster-slave-validity-factor</strong> <code>&lt;factor&gt;</code> - Nếu được đặt thành 0, bất kể mất kết nối giữa nút con và nút chính đã kéo dài bao lâu, nút con sẽ cố gắng trở thành nút chính. Nếu được đặt thành một số dương, thì thời gian mà cluster-node-timeout nhân với cluster-slave-validity-factor sẽ là thời gian hiệu quả của nút con sau khi mất kết nối với nút chính, vượt quá thời gian này, nút con sẽ không chuyển đổi thành nút chính. Giả sử cluster-node-timeout = 5, cluster-slave-validity-factor = 10, nếu nút con mất kết nối với nút chính quá 50 giây, nó sẽ không thể trở thành nút chính. Lưu ý, nếu tham số này được cấu hình thành một số dương, có thể xảy ra tình huống mà một nút chính không thể được thay thế bởi bất kỳ nút con nào, dẫn đến cụm không hoạt động, trong trường hợp này, chỉ khi nút chính ban đầu trở lại cụm, cụm mới hoạt động trở lại.</li>
<li><strong>cluster-migration-barrier</strong> <code>&lt;count&gt;</code> - Số lượng tối thiểu của nút con cần thiết cho một nút chính, chỉ khi đạt được số lượng này, khi nút chính gặp sự cố, nút con của nó mới được chuyển đổi. Chi tiết hơn về việc sao chép nút con sang một phần, hãy xem phần sau của hướng dẫn này.</li>
<li><strong>cluster-require-full-coverage</strong> <code>&lt;yes/no&gt;</code> - Khi một số nút không khả dụng trong một phần key, nếu tham số này được cấu hình thành "yes" (giá trị mặc định), cụm sẽ ngừng nhận các hoạt động; nếu tham số này được cấu hình thành "no", cụm vẫn cung cấp hoạt động đọc cho các key trên các nút có thể truy cập.</li>
</ul>
<h2>5. Các giải pháp cụm Redis khác</h2>
<p>Redis Cluster không phù hợp cho việc xây dựng các cụm Redis quy mô lớn, do đó, nếu bạn muốn xây dựng một cụm Redis quy mô lớn, bạn cần chọn các giải pháp thay thế. Thông thường có ba loại giải pháp:</p>
<ul>
<li>Giải pháp phân vùng khách hàng (Client-side sharding)</li>
<li>Giải pháp phân vùng trung gian (Proxy-based sharding)</li>
<li>Giải pháp định tuyến truy vấn (Query routing)</li>
</ul>
<h3>5.1. Giải pháp phân vùng khách hàng (Client-side sharding)</h3>
<p>Trong giải pháp này, <strong>khách hàng</strong> tự quyết định dữ liệu sẽ được <strong>lưu trữ</strong> trên nút Redis nào hoặc dữ liệu sẽ được <strong>đọc</strong> từ nút Redis nào. Ý tưởng chính là sử dụng thuật toán <strong>hashing</strong> để phân tán các khóa Redis, thông qua hàm <strong>hash</strong>, các khóa cụ thể sẽ được <strong>ánh xạ</strong> vào các nút Redis cụ thể.</p>
<p>Giải pháp phân vùng khách hàng phổ biến là Redis Sharding, đây là phương pháp <strong>cụm nhiều phiên bản</strong> Redis được sử dụng rộng rãi trước khi Redis Cluster ra đời. Thư viện điều khiển Redis cho Java <a href="https://github.com/redis/jedis" target="_blank" rel="noopener noreferrer"><strong>Jedis</strong></a> hỗ trợ chức năng Redis Sharding, bao gồm ShardedJedis và ShardedJedisPool kết hợp với <strong>bể cache</strong>.</p>
<ul>
<li><strong>Ưu điểm</strong>: Không sử dụng <strong>phần mềm trung gian</strong>, quy tắc phân vùng có thể được kiểm soát, cấu hình đơn giản, không có sự phụ thuộc giữa các nút, dễ dàng mở rộng tuyến tính, linh hoạt.</li>
<li><strong>Nhược điểm</strong>: <strong>Khách hàng</strong> không thể <strong>tự động thêm/xóa</strong> nút dịch vụ, khách hàng phải tự quản lý quy tắc <strong>phân phối</strong>, không có <strong>chia sẻ kết nối</strong> giữa các khách hàng, dẫn đến lãng phí kết nối.</li>
</ul>
<h3>5.2. Giải pháp phân vùng trung gian (Proxy-based sharding)</h3>
<p>Trong giải pháp này, <strong>khách hàng</strong> gửi yêu cầu đến một <strong>thành phần trung gian</strong>, <strong>thành phần trung gian</strong> phân tích dữ liệu của khách hàng và chuyển tiếp yêu cầu đến nút Redis chính xác, sau đó trả kết quả về cho khách hàng.</p>
<ul>
<li><strong>Ưu điểm</strong>: Giảm đơn giản hóa <strong>phân tán logic</strong> của khách hàng, khách hàng kết nối một cách <strong>trong suốt</strong>, chi phí chuyển tiếp và lưu trữ được <strong>tách biệt</strong>.</li>
<li><strong>Nhược điểm</strong>: Thêm một <strong>lớp trung gian</strong>, tăng độ phức tạp của kiến trúc và hiệu suất.</li>
</ul>
<p>Các giải pháp phân vùng trung gian phổ biến bao gồm <strong><a href="https://github.com/twitter/twemproxy" target="_blank" rel="noopener noreferrer">Twemproxy</a></strong> và <strong><a href="https://github.com/CodisLabs/codis" target="_blank" rel="noopener noreferrer">Codis</a></strong>.</p>
<h4>5.2.1. Twemproxy</h4>
<p><strong><a href="https://github.com/twitter/twemproxy" target="_blank" rel="noopener noreferrer">Twemproxy</a></strong>, còn được gọi là "nutcraker", là một chương trình trung gian Redis và Memcache mã nguồn mở của Twitter.</p>
<p><strong><a href="https://github.com/twitter/twemproxy" target="_blank" rel="noopener noreferrer">Twemproxy</a></strong> hoạt động như một trung gian, có thể chấp nhận truy cập từ nhiều chương trình và dựa trên quy tắc định tuyến, chuyển tiếp yêu cầu đến các máy chủ Redis phía sau và trả kết quả trở lại. <strong><a href="https://github.com/twitter/twemproxy" target="_blank" rel="noopener noreferrer">Twemproxy</a></strong> có vấn đề về <strong>điểm đơn</strong> và cần phải kết hợp với Lvs và Keepalived để có giải pháp <strong>cao nhất</strong>.</p>
<ul>
<li><strong>Ưu điểm</strong>: Phạm vi ứng dụng rộng, ổn định, <strong>cao nhất</strong> cho lớp trung gian.</li>
<li><strong>Nhược điểm</strong>: Không thể <strong>mở rộng/ thu hẹp</strong> một cách mượt mà, không có giao diện quản lý <strong>trực quan</strong>, không thể tự động chuyển tiếp khi xảy ra sự cố.</li>
</ul>
<h4>5.2.2. Codis</h4>
<p><a href="https://github.com/CodisLabs/codis" target="_blank" rel="noopener noreferrer"><strong>Codis</strong></a> là một giải pháp Redis <strong>phân tán</strong>. Đối với ứng dụng trên cùng, kết nối với Codis-Proxy và kết nối trực tiếp với Redis-Server gốc không có sự khác biệt. <a href="https://github.com/CodisLabs/codis" target="_blank" rel="noopener noreferrer"><strong>Codis</strong></a> xử lý việc chuyển tiếp yêu cầu và làm việc không ngừng để di chuyển dữ liệu mà không cần tắt máy. <a href="https://github.com/CodisLabs/codis" target="_blank" rel="noopener noreferrer"><strong>Codis</strong></a> sử dụng một lớp trung gian <strong>không có trạng thái</strong>, đối với <strong>khách hàng</strong>, mọi thứ đều trong suốt.</p>
<ul>
<li><strong>Ưu điểm</strong>: Cung cấp <strong>khả năng cao</strong> cho Proxy và Redis gốc, <strong>phân vùng dữ liệu</strong> và <strong>cân bằng tự động</strong>, cung cấp giao diện dòng lệnh và RESTful API, cung cấp giao diện <strong>giám sát</strong> và <strong>quản lý</strong>, cho phép <strong>thêm/xóa</strong> nút Redis động.</li>
<li><strong>Nhược điểm</strong>: <strong>Triển khai kiến trúc</strong> và <strong>cấu hình</strong> phức tạp, không hỗ trợ <strong>đa trụ sở</strong> và <strong>đa người dùng</strong>, không hỗ trợ <strong>quản lý xác thực</strong>.</li>
</ul>
<h3>5.3. Giải pháp định tuyến truy vấn (Query routing)</h3>
<p>Trong giải pháp này, <strong>khách hàng</strong> gửi yêu cầu đến một <strong>nút Redis</strong> bất kỳ, sau đó Redis sẽ <strong>chuyển tiếp</strong> yêu cầu đến <strong>nút Redis</strong> chính xác. Redis Cluster thực hiện một hình thức <strong>định tuyến truy vấn kết hợp</strong>, nhưng không phải là chuyển tiếp yêu cầu từ một nút Redis sang một nút Redis khác, mà là thông qua <strong>chuyển hướng</strong> trực tiếp từ <strong>khách hàng</strong> đến nút Redis chứa dữ liệu.</p>
<ul>
<li><strong>Ưu điểm</strong>: <strong>Phi tập trung</strong>, dữ liệu được lưu trữ và phân phối trên nhiều nút Redis, có thể mở rộng/thu hẹp nút một cách mượt mà, hỗ trợ <strong>cao nhất</strong> và <strong>chuyển tiếp tự động</strong> khi xảy ra sự cố, chi phí quản trị thấp.</li>
<li><strong>Nhược điểm</strong>: Phụ thuộc nặng vào công cụ Redis-trib, thiếu <strong>giám sát quản lý</strong>, phải dựa vào Smart Client (<strong>duy trì kết nối</strong>, <strong>bộ nhớ đệm bảng định tuyến</strong>, hỗ trợ <code>MultiOp</code> và <code>Pipeline</code>). Kiểm tra <strong>Failover</strong> của nút mất thời gian, không thể phân biệt dữ liệu <strong>lạnh/hot</strong> dựa trên thống kê.</li>
</ul>
]]></content:encoded>
    </item>
    <item>
      <title>Redis Data Structures</title>
      <link>https://vanhung4499.github.io/database/redis/data-structures.html</link>
      <guid>https://vanhung4499.github.io/database/redis/data-structures.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Data Structures</source>
      <description>Redis Data Structures SDS Giới thiệu về SDS SDS là viết tắt của Simple Dynamic String, tức là Chuỗi Động Đơn Giản. Redis đã tối ưu SDS để thay thế chuỗi C trong việc biểu diễn n...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>SDS</h2>
<h3>Giới thiệu về SDS</h3>
<p>SDS là viết tắt của Simple Dynamic String, tức là <strong>Chuỗi Động Đơn Giản</strong>. Redis đã tối ưu SDS để thay thế chuỗi C trong việc biểu diễn nội dung chuỗi. Ngoài ra, SDS còn được Redis sử dụng như là vùng đệm (buffer), chẳng hạn như vùng đệm AOF trong mô đun AOF và vùng đệm đầu vào trong trạng thái của khách hàng.</p>
<p>So với chuỗi C, SDS có những ưu điểm sau:</p>
<p>| Chuỗi C                                              | SDS                                                  |<br>
| :</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624213746.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Event</title>
      <link>https://vanhung4499.github.io/database/redis/event.html</link>
      <guid>https://vanhung4499.github.io/database/redis/event.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Event</source>
      <description>Redis Event Máy chủ Redis là một chương trình điều khiển sự kiện, máy chủ cần xử lý hai loại sự kiện: Sự kiện tệp (file event) - Máy chủ Redis giao tiếp với các khách hàng hoặc ...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Máy chủ Redis là một chương trình điều khiển sự kiện, máy chủ cần xử lý hai loại sự kiện:</p>
<ul>
<li><strong>Sự kiện tệp (file event)</strong> - Máy chủ Redis giao tiếp với các khách hàng hoặc các máy chủ khác thông qua các socket. Sự kiện tệp là một sự trừu tượng của các thao tác trên socket. Giao tiếp giữa máy chủ và khách hàng (hoặc các máy chủ khác) sẽ tạo ra các sự kiện tệp, và máy chủ sẽ hoàn thành một loạt các thao tác giao tiếp mạng bằng cách lắng nghe và xử lý các sự kiện này.</li>
<li><strong>Sự kiện thời gian (time event)</strong> - Máy chủ Redis có một số thao tác cần được thực hiện vào một thời điểm nhất định. Sự kiện thời gian là một sự trừu tượng của các thao tác định kỳ này.</li>
</ul>
</blockquote>
<h2>Sự kiện tệp</h2>
<p>Redis đã phát triển bộ xử lý sự kiện mạng của riêng mình dựa trên mô hình Reactor.</p>
<ul>
<li>Bộ xử lý sự kiện tệp của Redis sử dụng chương trình I/O đa luồng để lắng nghe đồng thời nhiều socket và liên kết các trình xử lý sự kiện khác nhau cho các socket dựa trên nhiệm vụ hiện tại của socket.</li>
<li>Khi socket đang được lắng nghe sẵn sàng thực hiện các thao tác kết nối phản hồi, đọc, ghi, hoặc đóng, các sự kiện tệp tương ứng với các thao tác này sẽ được tạo ra. Lúc này, bộ xử lý sự kiện tệp sẽ gọi các trình xử lý sự kiện đã liên kết trước đó với socket để xử lý các sự kiện này.</li>
</ul>
<p>Mặc dù bộ xử lý sự kiện tệp chạy theo cách đơn luồng, nhưng thông qua việc sử dụng chương trình I/O đa luồng để lắng nghe nhiều socket, bộ xử lý sự kiện tệp đã đạt được mô hình giao tiếp mạng hiệu suất cao.</p>
<p>Bộ xử lý sự kiện tệp bao gồm bốn thành phần: socket, chương trình I/O đa luồng, bộ phân phối sự kiện tệp, và trình xử lý sự kiện.</p>
<h2>Sự kiện thời gian</h2>
<p>Sự kiện thời gian được chia thành:</p>
<ul>
<li><strong>Sự kiện định thời</strong>: cho phép một đoạn chương trình được thực thi một lần vào thời điểm được chỉ định.</li>
<li><strong>Sự kiện chu kỳ</strong>: cho phép một đoạn chương trình được thực thi định kỳ sau khoảng thời gian được chỉ định.</li>
</ul>
<p>Redis lưu trữ tất cả các sự kiện thời gian trong một danh sách liên kết không có thứ tự. Mỗi khi bộ xử lý sự kiện thời gian chạy, nó sẽ duyệt qua toàn bộ danh sách để tìm các sự kiện thời gian đã đến hạn và gọi các trình xử lý sự kiện tương ứng.</p>
<h2>Lập lịch và thực thi sự kiện</h2>
<p>Máy chủ Redis cần liên tục lắng nghe các sự kiện tệp trên các socket để xử lý các sự kiện tệp đó. Tuy nhiên, không thể chỉ lắng nghe mãi mà không quan tâm đến các sự kiện thời gian, nếu không các sự kiện thời gian sẽ không được thực thi đúng lúc. Do đó, thời gian lắng nghe cần được xác định dựa trên sự kiện thời gian gần nhất so với thời điểm hiện tại.</p>
<p>Việc lập lịch và thực thi sự kiện được quản lý bởi hàm <code>aeProcessEvents</code>, với mã giả như sau:</p>
<div class="language-python line-numbers-mode" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> aeProcessEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Lấy sự kiện thời gian gần nhất so với thời gian hiện tại</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    time_event </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> aeSearchNearestTimer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Tính toán khoảng thời gian còn lại cho đến khi sự kiện gần nhất xảy ra</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> time_event.when </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> unix_ts_now</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Nếu sự kiện đã đến hạn, giá trị của remaind_ms có thể âm, đặt nó bằng 0</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Tạo timeval dựa trên giá trị remaind_ms</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    timeval </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> create_timeval_with_ms</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(remaind_ms)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Chặn và chờ đợi sự kiện tệp phát sinh, thời gian chặn tối đa được quyết định bởi timeval</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    aeApiPoll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(timeval)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Xử lý tất cả các sự kiện tệp đã phát sinh</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    procesFileEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Xử lý tất cả các sự kiện thời gian đã đến hạn</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    processTimeEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đặt hàm <code>aeProcessEvents</code> trong một vòng lặp, cùng với các hàm khởi tạo và dọn dẹp, sẽ tạo thành hàm chính của máy chủ Redis, mã giả như sau:</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Khởi tạo máy chủ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    init_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Liên tục xử lý sự kiện cho đến khi máy chủ tắt</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> server_is_not_shutdown</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        aeProcessEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Máy chủ tắt, thực hiện các thao tác dọn dẹp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    clean_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span></code></pre>
</div><h2>Lập lịch và thực thi sự kiện</h2>
<h3>Cách thức hoạt động</h3>
<p>Máy chủ cần liên tục lắng nghe các sự kiện tệp để xử lý chúng. Tuy nhiên, để đảm bảo các sự kiện thời gian cũng được thực thi đúng lúc, thời gian lắng nghe các sự kiện tệp được xác định dựa trên thời điểm xảy ra sự kiện thời gian gần nhất.</p>
<h3>Quá trình xử lý sự kiện</h3>
<ol>
<li>Lấy sự kiện thời gian gần nhất so với thời gian hiện tại.</li>
<li>Tính toán khoảng thời gian còn lại cho đến khi sự kiện xảy ra.</li>
<li>Nếu sự kiện đã đến hạn, đặt thời gian còn lại bằng 0.</li>
<li>Tạo giá trị timeval dựa trên thời gian còn lại.</li>
<li>Chặn và chờ đợi sự kiện tệp, thời gian chặn tối đa được quyết định bởi timeval.</li>
<li>Xử lý tất cả các sự kiện tệp đã phát sinh.</li>
<li>Xử lý tất cả các sự kiện thời gian đã đến hạn.</li>
</ol>
<h3>Vòng lặp chính của máy chủ</h3>
<p>Máy chủ Redis liên tục chạy vòng lặp để xử lý các sự kiện cho đến khi máy chủ tắt. Quy trình bao gồm khởi tạo máy chủ, xử lý sự kiện liên tục và thực hiện các thao tác dọn dẹp khi máy chủ tắt.</p>
]]></content:encoded>
    </item>
    <item>
      <title>Redis Expire Delete</title>
      <link>https://vanhung4499.github.io/database/redis/expire.html</link>
      <guid>https://vanhung4499.github.io/database/redis/expire.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Expire Delete</source>
      <description>Redis Expire Delete Xóa khi hết hạn trong Redis Redis cho phép thiết lập thời gian tồn tại (ttl) cho mỗi khóa và tự động xóa khóa khi nó hết hạn. Thiết lập thời gian sống hoặc t...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h3>Xóa khi hết hạn trong Redis</h3>
<p>Redis cho phép thiết lập thời gian tồn tại (ttl) cho mỗi khóa và tự động xóa khóa khi nó hết hạn.</p>
<h4>Thiết lập thời gian sống hoặc thời gian hết hạn của khóa</h4>
<p>Trong Redis, các lệnh liên quan đến thời gian sống của khóa như sau:</p>
<p>| Lệnh                                                | Mô tả                                    |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/dunwu/images/master/snap/202309171537744.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Guide</title>
      <link>https://vanhung4499.github.io/database/redis/guide.html</link>
      <guid>https://vanhung4499.github.io/database/redis/guide.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Guide</source>
      <description>Hướng dẫn Redis 1. Giới thiệu về Redis Redis là một cơ sở dữ liệu key-value nhanh chóng và không phụ thuộc vào quan hệ (NoSQL) được lưu trữ trong bộ nhớ, có thể ánh xạ giữa các ...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>1. Giới thiệu về Redis</h2>
<blockquote>
<p>Redis là một cơ sở dữ liệu key-value nhanh chóng và không phụ thuộc vào quan hệ (NoSQL) được lưu trữ trong bộ nhớ, có thể ánh xạ giữa các khóa và năm loại giá trị khác nhau.</p>
<p>Loại khóa chỉ có thể là chuỗi, các loại giá trị được hỗ trợ bao gồm: chuỗi, danh sách, tập hợp, tập hợp có thứ tự và bảng băm.</p>
</blockquote>
<h3>Các trường hợp sử dụng Redis</h3>
<ul>
<li><strong>Bộ nhớ đệm</strong> - Đặt dữ liệu hot vào bộ nhớ, đặt giới hạn sử dụng bộ nhớ tối đa và chiến lược loại bỏ hết hạn để đảm bảo tỷ lệ trúng đích của bộ nhớ đệm.</li>
<li><strong>Bộ đếm</strong> - Cơ sở dữ liệu bộ nhớ này hỗ trợ các hoạt động đọc và ghi bộ đếm thường xuyên.</li>
<li><strong>Giới hạn ứng dụng</strong> - Hạn chế lưu lượng truy cập vào một trang web.</li>
<li><strong>Hàng đợi tin nhắn</strong> - Sử dụng kiểu dữ liệu danh sách, đó là danh sách liên kết hai chiều.</li>
<li><strong>Bảng tìm kiếm</strong> - Sử dụng kiểu dữ liệu HASH.</li>
<li><strong>Phép giao của tập hợp</strong> - Sử dụng kiểu dữ liệu SET, ví dụ như tìm những người bạn chung của hai người dùng.</li>
<li><strong>Bảng xếp hạng</strong> - Sử dụng kiểu dữ liệu ZSET.</li>
<li><strong>Phiên phân tán</strong> - Lưu trữ phiên của nhiều máy chủ ứng dụng vào Redis để đảm bảo tính nhất quán của phiên.</li>
<li><strong>Khóa phân tán</strong> - Ngoài việc sử dụng SETNX để triển khai khóa phân tán, bạn cũng có thể sử dụng khóa phân tán RedLock do chính thức cung cấp.</li>
</ul>
<h3>Ưu điểm của Redis</h3>
<ul>
<li>Hiệu suất cao - Redis có thể đọc với tốc độ 110.000 lần / giây và ghi với tốc độ 81.000 lần / giây.</li>
<li>Loại dữ liệu phong phú - Hỗ trợ chuỗi, danh sách, tập hợp, tập hợp có thứ tự và bảng băm.</li>
<li>Tính nguyên tử - Tất cả các hoạt động của Redis đều có tính nguyên tử. Một hoạt động đơn lẻ là nguyên tử. Nhiều hoạt động cũng hỗ trợ giao dịch, tức là nguyên tử, bằng cách bao gồm các chỉ thị MULTI và EXEC.</li>
<li>Dữ liệu bền vững - Redis hỗ trợ việc lưu trữ dữ liệu. Có thể lưu trữ dữ liệu trong bộ nhớ và khôi phục lại khi khởi động lại.</li>
<li>Sao lưu - Redis hỗ trợ sao lưu dữ liệu, tức là sao lưu dữ liệu theo chế độ master-slave.</li>
<li>Tính năng phong phú - Redis cũng hỗ trợ xuất bản / đăng ký, thông báo, hết hạn khóa, v.v.</li>
</ul>
<h3>Redis và Memcached</h3>
<p>Redis và Memcached thường được so sánh vì cả hai đều có thể được sử dụng làm bộ nhớ đệm, nhưng chúng có một số khác biệt chính như sau:</p>
<p><strong>Loại dữ liệu</strong></p>
<ul>
<li>Memcached chỉ hỗ trợ kiểu dữ liệu chuỗi;</li>
<li>Trong khi đó, Redis hỗ trợ năm loại dữ liệu khác nhau, giúp nó giải quyết vấn đề một cách linh hoạt hơn.</li>
</ul>
<p><strong>Dữ liệu bền vững</strong></p>
<ul>
<li>Memcached không hỗ trợ tính năng bền vững;</li>
<li>Redis hỗ trợ hai chính sách bền vững: RDB Snapshot và AOF Log.</li>
</ul>
<p><strong>Phân tán</strong></p>
<ul>
<li>Memcached không hỗ trợ phân tán, chỉ có thể triển khai lưu trữ phân tán bằng cách sử dụng thuật toán phân tán như băm nhất quán trên máy khách, điều này yêu cầu tính toán vị trí dữ liệu trên máy khách khi lưu trữ và truy vấn.</li>
<li>Redis Cluster hỗ trợ phân tán.</li>
</ul>
<p><strong>Quản lý bộ nhớ</strong></p>
<ul>
<li>Memcached chia bộ nhớ thành các khối có độ dài cố định để lưu trữ dữ liệu, giải quyết hoàn toàn vấn đề mảnh vụn bộ nhớ, nhưng phương pháp này làm giảm hiệu suất sử dụng bộ nhớ, ví dụ: nếu kích thước khối là 128 byte và chỉ lưu trữ 100 byte dữ liệu, thì 28 byte còn lại sẽ bị lãng phí.</li>
<li>Trong Redis, không phải tất cả dữ liệu đều được lưu trữ trong bộ nhớ, một số giá trị không được sử dụng trong thời gian dài có thể được trao đổi sang đĩa. Dữ liệu của Memcached sẽ luôn nằm trong bộ nhớ.</li>
</ul>
<h3>Tại sao Redis nhanh</h3>
<p>Redis có thể đạt được QPS đơn lẻ lên đến 100.000.</p>
<p>Redis sử dụng mô hình đơn luồng (Redis 6.0 đã hỗ trợ mô hình đa luồng), tại sao nó vẫn có thể đạt được đồng thời cao như vậy?</p>
<ul>
<li>Redis hoàn toàn dựa trên hoạt động bộ nhớ.</li>
<li>Cấu trúc dữ liệu của Redis đơn giản.</li>
<li>Sử dụng mô hình đơn luồng để tránh việc chuyển đổi ngữ cảnh và cạnh tranh giữa các luồng.</li>
<li>Sử dụng mô hình I/O multiplexing (I/O không chặn).</li>
</ul>
<blockquote>
<p>I/O multiplexing</p>
<p>Mô hình I/O multiplexing là khả năng theo dõi cùng một lúc nhiều luồng I/O sự kiện của select, poll, epoll. Khi không hoạt động, nó sẽ chặn luồng hiện tại và khi một hoặc nhiều luồng có sự kiện I/O, nó sẽ được đánh thức từ trạng thái chặn và sau đó chương trình sẽ kiểm tra tất cả các luồng I/O (epoll chỉ kiểm tra các luồng thực sự gửi sự kiện), và chỉ xử lý từng luồng sẵn sàng, điều này tránh các hoạt động không hữu ích lớn.</p>
</blockquote>
<h2>2. Các kiểu dữ liệu trong Redis</h2>
<p>Redis có các kiểu dữ liệu cơ bản: STRING, HASH, LIST, SET, ZSET</p>
<p>Redis cũng có các kiểu dữ liệu nâng cao: BitMap, HyperLogLog, GEO</p>
<p>💡 Để biết thêm thông tin chi tiết về các tính năng và nguyên lý, vui lòng tham khảo: [[Redis Data Types and Applications]]</p>
<h2>3. Xóa dữ liệu không sử dụng trong Redis</h2>
<h3>Điểm chính về xóa dữ liệu trong bộ nhớ</h3>
<ul>
<li><strong>Bộ nhớ tối đa</strong> - Redis cho phép đặt giá trị tối đa của bộ nhớ thông qua tham số <code>maxmemory</code>.</li>
<li><strong>Thời gian hết hạn</strong> - Là cơ chế quan trọng để xóa dữ liệu vô hiệu, trong các lệnh Redis cung cấp, <code>EXPIRE</code>, <code>EXPIREAT</code>, <code>PEXPIRE</code>, <code>PEXPIREAT</code>, <code>SETEX</code> và <code>PSETEX</code> được sử dụng để đặt thời gian hết hạn cho một cặp khóa-giá trị. Khi một cặp khóa-giá trị được liên kết với thời gian hết hạn, nó sẽ tự động bị xóa sau khi hết hạn (hoặc nói cách khác, trở thành không thể truy cập).</li>
<li><strong>Chiến lược xóa</strong> - Khi lưu trữ dữ liệu vào Redis, khi không gian bộ nhớ còn lại không đủ để lưu trữ dữ liệu mới, Redis sẽ thực hiện chiến lược xóa dữ liệu để giải phóng một phần nội dung và đảm bảo dữ liệu mới có thể được lưu trữ trong bộ nhớ. Cơ chế xóa dữ liệu trong bộ nhớ nhằm tối ưu hóa việc sử dụng bộ nhớ, bằng cách đổi lấy một số lần không trúng đích để sử dụng bộ nhớ, đảm bảo rằng dữ liệu được lưu trữ trong bộ nhớ Redis là dữ liệu nóng.</li>
<li><strong>LRU không chính xác</strong> - Trên thực tế, Redis không triển khai LRU đáng tin cậy, có nghĩa là việc xóa khóa không nhất thiết là khóa không được sử dụng lâu nhất.</li>
</ul>
<h3>Thời gian hết hạn của khóa chính</h3>
<p>Redis có thể đặt thời gian hết hạn cho mỗi khóa, khi khóa hết hạn, nó sẽ tự động bị xóa.</p>
<p>Đối với các cấu trúc dữ liệu như bảng băm, chỉ có thể đặt thời gian hết hạn cho toàn bộ khóa (toàn bộ bảng băm), không thể đặt thời gian hết hạn cho từng phần tử trong khóa.</p>
<p>Có thể sử dụng <code>EXPIRE</code> hoặc <code>EXPIREAT</code> để đặt thời gian hết hạn cho khóa.</p>
<blockquote>
<p>🔔 Lưu ý: Nếu thời gian <code>EXPIRE</code> được đặt là số âm, thời gian dấu thời gian <code>EXPIREAT</code> là thời gian hết hạn, khóa sẽ bị xóa trực tiếp.</p>
</blockquote>
<p>Ví dụ:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">SET</span><span style="color:#98C379;--shiki-dark:#98C379"> mykey</span><span style="color:#98C379;--shiki-dark:#98C379"> "Hello"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">"OK"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">EXPIRE</span><span style="color:#98C379;--shiki-dark:#98C379"> mykey</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">TTL</span><span style="color:#98C379;--shiki-dark:#98C379"> mykey</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">10</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">SET</span><span style="color:#98C379;--shiki-dark:#98C379"> mykey</span><span style="color:#98C379;--shiki-dark:#98C379"> "Hello World"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">"OK"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">TTL</span><span style="color:#98C379;--shiki-dark:#98C379"> mykey</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">-1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt;</span></span></code></pre>
</div><h3>Chiến lược xóa dữ liệu</h3>
<p>Xóa dữ liệu trong bộ nhớ chỉ là một tính năng mà Redis cung cấp, để triển khai tốt hơn tính năng này, cần cung cấp các chiến lược khác nhau cho các tình huống ứng dụng khác nhau, vấn đề cần giải quyết bao gồm cách chọn không gian khóa để xóa? Làm thế nào để chọn khóa để xóa trong không gian khóa?</p>
<p>Redis cung cấp các chiến lược xóa dữ liệu sau để người dùng lựa chọn:</p>
<ul>
<li><strong><code>noeviction</code></strong> - Khi sử dụng bộ nhớ đạt đến ngưỡng, tất cả các lệnh yêu cầu cấp phát bộ nhớ sẽ báo lỗi. Đây là chiến lược mặc định của Redis.</li>
<li><strong><code>allkeys-lru</code></strong> - Trong không gian khóa chính, ưu tiên xóa khóa không được sử dụng gần đây nhất.</li>
<li><strong><code>allkeys-random</code></strong> - Trong không gian khóa chính, xóa ngẫu nhiên một khóa.</li>
<li><strong><code>volatile-lru</code></strong> - Trong không gian khóa có thời gian hết hạn, ưu tiên xóa khóa không được sử dụng gần đây nhất.</li>
<li><strong><code>volatile-random</code></strong> - Trong không gian khóa có thời gian hết hạn, xóa ngẫu nhiên một khóa.</li>
<li><strong><code>volatile-ttl</code></strong> - Trong không gian khóa có thời gian hết hạn, ưu tiên xóa khóa có thời gian hết hạn sớm hơn.</li>
</ul>
<h3>Lựa chọn chiến lược xóa dữ liệu</h3>
<ul>
<li>Nếu <strong>dữ liệu phân bố theo phân phối mũ (có dữ liệu nóng, một số dữ liệu truy cập thường xuyên, một số dữ liệu truy cập ít), hãy sử dụng <code>allkeys-lru</code></strong>.</li>
<li>Nếu <strong>dữ liệu phân bố đồng đều (tần suất truy cập dữ liệu tương đương), hãy sử dụng <code>allkeys-random</code></strong>.</li>
<li>Nếu muốn <strong>sử dụng các giá trị TTL khác nhau để gợi ý cho Redis những khóa nào nên bị xóa, hãy sử dụng <code>volatile-ttl</code></strong>.</li>
<li><strong><code>volatile-lru</code> và <code>volatile-random</code> phù hợp cho các tình huống vừa sử dụng bộ nhớ cache vừa sử dụng lưu trữ bền vững</strong>, tuy nhiên, chúng ta cũng có thể đạt được cùng hiệu quả bằng cách sử dụng hai phiên bản Redis.</li>
<li><strong>Đặt thời gian hết hạn cho khóa thực tế sẽ tiêu tốn nhiều bộ nhớ hơn, do đó, khuyến nghị sử dụng chiến lược <code>allkeys-lru</code> để sử dụng bộ nhớ hiệu quả hơn</strong>.</li>
</ul>
<h3>Triển khai nội bộ</h3>
<p>Có hai cách chính để Redis xóa khóa không hợp lệ:</p>
<ul>
<li>Phương pháp tiêu cực (passive way), khi khóa được truy cập và phát hiện rằng nó không hợp lệ, nó sẽ bị xóa.</li>
<li>Phương pháp tích cực (active way), định kỳ lựa chọn một số khóa không hợp lệ từ không gian khóa có thời gian hết hạn và xóa chúng.</li>
<li>Xóa tích cực: Khi bộ nhớ đã sử dụng vượt quá giới hạn <code>maxmemory</code>, kích hoạt chiến lược xóa tích cực, chiến lược này được cấu hình bằng tham số khởi động để xác định thời gian hết hạn chính xác của khóa được duy trì trong từ điển <code>expires</code>.</li>
</ul>
<h2>4. Lưu trữ dữ liệu trong Redis</h2>
<p>Redis là một cơ sở dữ liệu lưu trữ trong bộ nhớ, để đảm bảo dữ liệu không bị mất sau khi máy chủ gặp sự cố, cần lưu trữ dữ liệu từ bộ nhớ xuống đĩa cứng.</p>
<p>Redis hỗ trợ hai phương pháp lưu trữ dữ liệu: RDB và AOF.</p>
<ul>
<li><strong>RDB (Redis Database) là phương pháp chụp nhanh, nó lưu trữ tất cả dữ liệu Redis tại một thời điểm cụ thể vào một tập tin nhị phân được nén (tập tin RDB)</strong>.</li>
<li>AOF (Append Only File) là một tập tin nhật ký văn bản, nó ghi lại tất cả các lệnh ghi vào cuối tập tin AOF để ghi lại sự thay đổi dữ liệu. Khi máy chủ khởi động lại, nó sẽ tải và thực thi các lệnh này để khôi phục dữ liệu gốc. AOF thích hợp để sử dụng làm <strong>bản sao lưu nóng</strong>.</li>
</ul>
<p>💡 Để biết thêm thông tin chi tiết về các tính năng và nguyên lý, vui lòng tham khảo: [[Redis Persistence]]</p>
<h2>5. Sự kiện trong Redis</h2>
<p>Redis là một máy chủ sự kiện, nó xử lý hai loại sự kiện:</p>
<ul>
<li>
<p><strong>Sự kiện tập tin (file event)</strong>&nbsp;- Redis giao tiếp với khách hàng hoặc các máy chủ khác thông qua socket, sự kiện tập tin là một trừu tượng hóa của hoạt động trên socket. Giao tiếp giữa máy chủ và khách hàng (hoặc các máy chủ khác) tạo ra các sự kiện tập tin, và máy chủ xử lý và xử lý các sự kiện này bằng cách lắng nghe và xử lý chúng.</p>
</li>
<li>
<p><strong>Sự kiện thời gian (time event)</strong>&nbsp;- Redis cần thực hiện một số hoạt động vào một thời điểm nhất định, sự kiện thời gian là một trừu tượng của các hoạt động định thời này.</p>
</li>
</ul>
<h3>Sự kiện tập tin</h3>
<p>Redis đã phát triển trình xử lý sự kiện mạng của riêng mình dựa trên mô hình Reactor.</p>
<ul>
<li>Trình xử lý sự kiện tập tin của Redis sử dụng trình điều khiển I/O đa kênh để lắng nghe đồng thời nhiều socket và liên kết các trình xử lý sự kiện khác nhau với các socket tương ứng dựa trên nhiệm vụ hiện tại của socket.</li>
<li>Khi socket được lắng nghe đã sẵn sàng để thực hiện kết nối, đọc, ghi hoặc đóng, sự kiện tập tin tương ứng sẽ xảy ra và trình xử lý sự kiện tập tin sẽ gọi trình xử lý sự kiện đã được liên kết trước đó với socket để xử lý các sự kiện này.</li>
</ul>
<p>Mặc dù trình xử lý sự kiện tập tin chạy dưới dạng một luồng đơn, nhưng bằng cách sử dụng trình điều khiển I/O đa kênh để lắng nghe nhiều socket, trình xử lý sự kiện tập tin đã triển khai mô hình giao tiếp mạng hiệu suất cao.</p>
<p>Trình xử lý sự kiện tập tin bao gồm bốn thành phần: socket, trình điều khiển I/O đa kênh (I/O Multiplexing), bộ phân phối sự kiện tập tin và trình xử lý sự kiện.</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724111451.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure>
<h3>Sự kiện thời gian</h3>
<p>Sự kiện thời gian được chia thành hai loại:</p>
<ul>
<li><strong>Sự kiện định thời</strong>: là việc cho phép một đoạn chương trình được thực thi một lần trong khoảng thời gian đã chỉ định;</li>
<li><strong>Sự kiện định kỳ</strong>: là sự kiện cho phép một đoạn chương trình thực thi mỗi khoảng thời gian cụ thể.</li>
</ul>
<p>Redis lưu trữ tất cả các sự kiện thời gian trong một danh sách liên kết không tuần tự. Khi trình thực thi sự kiện thời gian chạy, nó sẽ duyệt qua toàn bộ danh sách liên kết để tìm các sự kiện thời gian đã đến và gọi trình xử lý sự kiện tương ứng.</p>
<h3>Lập lịch và thực thi sự kiện</h3>
<p>Để nhận được các sự kiện tập tin chờ xử lý, máy chủ cần lắng nghe liên tục các socket, nhưng không thể lắng nghe mãi mãi, nếu không sự kiện thời gian sẽ không thể được thực hiện trong thời gian quy định. Do đó, thời gian lắng nghe phải được xác định dựa trên sự kiện thời gian gần nhất.</p>
<p>Lập lịch và thực thi sự kiện được thực hiện bởi hàm aeProcessEvents, mã giả như sau:</p>
<div class="language-python line-numbers-mode" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> aeProcessEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Tìm sự kiện thời gian gần nhất đã đến</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    time_event </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> aeSearchNearestTimer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Tính toán thời gian còn lại đến sự kiện thời gian gần nhất</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> time_event.when </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> unix_ts_now</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Nếu sự kiện đã đến, giá trị remaind_ms có thể là số âm, đặt nó thành 0</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">        remaind_ms </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Tạo timeval dựa trên remaind_ms</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">    timeval </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> create_timeval_with_ms</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(remaind_ms)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Chờ và chặn để chờ sự kiện tập tin xảy ra, thời gian chặn tối đa được xác định bởi timeval được truyền vào</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    aeApiPoll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(timeval)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Xử lý tất cả các sự kiện tập tin đã xảy ra</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    processFileEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Xử lý tất cả các sự kiện thời gian đã đến</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    processTimeEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đặt hàm aeProcessEvents trong một vòng lặp, kèm theo các hàm khởi tạo và dọn dẹp, sẽ tạo thành hàm chính của máy chủ Redis, mã giả như sau:</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">def</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Khởi tạo máy chủ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    init_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Xử lý sự kiện liên tục cho đến khi máy chủ tắt</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    while</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> server_is_not_shutdown</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">():</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">        aeProcessEvents</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    ## Máy chủ tắt, thực hiện dọn dẹp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">    clean_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">()</span></span></code></pre>
</div><h2>6. Giao dịch trong Redis</h2>
<blockquote>
<p><strong>Redis không cung cấp giao dịch nghiêm ngặt, Redis chỉ đảm bảo thực hiện các lệnh theo thứ tự và đảm bảo thực hiện tất cả các lệnh, nhưng khi một lệnh thực hiện không thành công, nó sẽ tiếp tục thực hiện các lệnh tiếp theo mà không có quá trình rollback</strong>.</p>
</blockquote>
<p><code>MULTI</code>, <code>EXEC</code>, <code>DISCARD</code> và <code>WATCH</code> là các lệnh liên quan đến giao dịch trong Redis.</p>
<p>Giao dịch cho phép thực hiện nhiều lệnh cùng một lúc và có hai cam kết quan trọng sau:</p>
<ul>
<li>Giao dịch là một hoạt động cô lập độc lập: Tất cả các lệnh trong giao dịch sẽ được thực hiện theo thứ tự và tuần tự. Trong quá trình thực hiện giao dịch, nó sẽ không bị gián đoạn bởi các yêu cầu lệnh từ khách hàng khác.</li>
<li>Giao dịch là một hoạt động nguyên tử: Tất cả các lệnh trong giao dịch sẽ được thực hiện hoặc không được thực hiện.</li>
</ul>
<h3>MULTI</h3>
<p><strong>Lệnh <a href="https://redis.io/commands/multi" target="_blank" rel="noopener noreferrer"><code>MULTI</code></a> được sử dụng để bắt đầu một giao dịch, nó luôn trả về OK.</strong></p>
<p>Sau khi thực hiện <code>MULTI</code>, khách hàng có thể tiếp tục gửi bất kỳ số lượng lệnh nào đến máy chủ, các lệnh này sẽ không được thực hiện ngay lập tức mà sẽ được đặt vào một hàng đợi. Khi lệnh <code>EXEC</code> được gọi, tất cả các lệnh trong hàng đợi sẽ được thực hiện.</p>
<p>Dưới đây là một ví dụ về giao dịch, nó tăng giá trị của hai khóa <code>foo</code> và <code>bar</code> một cách nguyên tử:</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> MULTI</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">OK</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> INCR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> foo</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">QUEUED</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> INCR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> bar</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">QUEUED</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> EXEC</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) (integer) </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) (integer) </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span></code></pre>
</div><h3>EXEC</h3>
<p><strong>Lệnh <a href="https://redis.io/commands/exec" target="_blank" rel="noopener noreferrer"><code>EXEC</code></a> được sử dụng để kích hoạt và thực hiện tất cả các lệnh trong giao dịch.</strong></p>
<ul>
<li>Nếu khách hàng mở một giao dịch bằng cách sử dụng <code>MULTI</code> nhưng không thực hiện thành công <code>EXEC</code>, tất cả các lệnh trong giao dịch sẽ không được thực hiện.</li>
<li>Trên một khía cạnh khác, nếu khách hàng thực hiện thành công <code>EXEC</code> sau khi mở giao dịch, tất cả các lệnh trong giao dịch sẽ được thực hiện.</li>
</ul>
<h3>DISCARD</h3>
<p><strong>Khi thực hiện lệnh <a href="https://redis.io/commands/discard" target="_blank" rel="noopener noreferrer"><code>DISCARD</code></a>, giao dịch sẽ bị hủy bỏ, hàng đợi giao dịch sẽ được xóa và khách hàng sẽ thoát khỏi trạng thái giao dịch.</strong></p>
<p>Ví dụ:</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> foo </span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">OK</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> MULTI</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">OK</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> INCR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> foo</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">QUEUED</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> DISCARD</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">OK</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> GET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> foo</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379">"1"</span></span></code></pre>
</div><h3>WATCH</h3>
<p><strong>Lệnh <a href="https://redis.io/commands/watch" target="_blank" rel="noopener noreferrer"><code>WATCH</code></a> trong Redis cung cấp hành vi check-and-set (CAS) cho giao dịch.</strong></p>
<p>Các khóa được theo dõi bởi WATCH sẽ được giám sát và phát hiện xem chúng có bị thay đổi không. Nếu ít nhất một khóa được theo dõi đã được thay đổi trước khi EXEC được thực thi, toàn bộ giao dịch sẽ bị hủy bỏ và EXEC sẽ trả về nil-reply để chỉ ra giao dịch đã thất bại.</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">WATCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mykey</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">val </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> GET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mykey</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">val </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> val </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">+</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">MULTI</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">SET</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> mykey </span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF">$</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">val</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">EXEC</span></span></code></pre>
</div><p>Sử dụng mã trên, nếu giá trị của mykey được thay đổi bởi một khách hàng khác sau khi WATCH được thực thi và trước khi EXEC được thực thi, giao dịch của khách hàng hiện tại sẽ thất bại. Chương trình cần làm là lặp lại thao tác này cho đến khi không có xung đột xảy ra.</p>
<p>Hình thức khóa này được gọi là khóa lạc quan (optimistic lock), đây là một cơ chế khóa rất mạnh mẽ. Và vì hầu hết các khách hàng thường truy cập vào các khóa khác nhau, xung đột xảy ra rất ít, nên thường không cần phải thử lại.</p>
<p>WATCH yêu cầu EXEC chỉ được thực thi khi tất cả các khóa được giám sát không bị thay đổi. Nếu điều kiện này không được đáp ứng, giao dịch sẽ không được thực thi.</p>
<p>Lệnh WATCH có thể được gọi nhiều lần. Giám sát các khóa bắt đầu có hiệu lực sau khi WATCH được thực thi và kết thúc khi EXEC được gọi.</p>
<p>Người dùng cũng có thể giám sát nhiều khóa trong một lệnh WATCH, ví dụ:</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">redis</span><span style="color:#56B6C2;--shiki-dark:#56B6C2">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66"> WATCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> key1 key2 key3</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">OK</span></span></code></pre>
</div><h4>Các tình huống hủy WATCH</h4>
<p>Khi EXEC được gọi, giám sát cho tất cả các khóa sẽ bị hủy bỏ, bất kể giao dịch có được thực thi thành công hay không.</p>
<p>Ngoài ra, khi khách hàng ngắt kết nối, giám sát của khách hàng đối với các khóa cũng sẽ bị hủy bỏ.</p>
<p>Sử dụng lệnh UNWATCH không có tham số có thể hủy bỏ giám sát cho tất cả các khóa. Đối với một số giao dịch yêu cầu thay đổi nhiều khóa, đôi khi chương trình cần khóa đồng thời nhiều khóa và kiểm tra xem giá trị hiện tại của các khóa đó có đáp ứng yêu cầu của chương trình hay không. Khi giá trị không đáp ứng yêu cầu, có thể sử dụng lệnh UNWATCH để hủy bỏ giám sát hiện tại, từ bỏ giao dịch này và chờ đợi lần thử giao dịch tiếp theo.</p>
<h4>Sử dụng WATCH để tạo thao tác nguyên tử</h4>
<p>WATCH có thể được sử dụng để tạo ra các thao tác nguyên tử không được tích hợp sẵn trong Redis.</p>
<p>Ví dụ, đoạn mã sau triển khai lệnh ZPOP tự tạo, nó có thể lấy ra phần tử có điểm số nhỏ nhất trong tập hợp có thứ tự:</p>
<div class="language-python" data-ext="python" data-title="python"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">WATCH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> zset</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">element </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> ZRANGE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> zset </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 0</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">MULTI</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">ZREM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> zset element</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66">EXEC</span></span></code></pre>
</div><h3>Rollback</h3>
<p><strong>Redis không hỗ trợ rollback</strong>. Lý do Redis không hỗ trợ rollback:</p>
<ul>
<li>Lệnh Redis chỉ thất bại do cú pháp sai hoặc lệnh được sử dụng trên loại khóa sai.</li>
<li>Vì không cần hỗ trợ rollback, nên Redis có thể giữ cho nội bộ đơn giản và nhanh chóng.</li>
</ul>
<h2>7. Redis Pipeline</h2>
<p>Redis là một dịch vụ TCP dựa trên mô hình C/S và giao thức yêu cầu/phản hồi. Redis hỗ trợ công nghệ Pipeline. Công nghệ Pipeline cho phép gửi yêu cầu theo cách bất đồng bộ, tức là cho phép gửi yêu cầu mới trong khi đáp ứng của yêu cầu cũ vẫn chưa trả về. Phương pháp này có thể cải thiện đáng kể hiệu suất truyền tải.</p>
<p>Khi cần thực thi một loạt lệnh Redis, nếu thực thi từng lệnh một, rõ ràng là rất không hiệu quả. Để giảm số lần truyền thông và giảm độ trễ, có thể sử dụng chức năng Pipeline của Redis. Chức năng Pipeline của Redis không cung cấp hỗ trợ dòng lệnh, nhưng nó được triển khai trong các phiên bản khách hàng của nhiều ngôn ngữ.</p>
<p>Lấy ví dụ với Jedis:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">Pipeline</span><span style="color:#E06C75;--shiki-dark:#E06C75"> pipe </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">pipelined</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">multi</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">hset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"login:"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, token, user);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"recent:"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, timestamp, token);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">if</span><span style="color:#E06C75;--shiki-dark:#E06C75"> (item </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"viewed:"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> token, timestamp, item);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zremrangeByRank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"viewed:"</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> token, </span><span style="color:#D19A66;--shiki-dark:#D19A66">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">26</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">    pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">zincrby</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#98C379;--shiki-dark:#98C379">"viewed:"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2">-</span><span style="color:#D19A66;--shiki-dark:#D19A66">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">, item);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75">}</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">exec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">();</span></span></code></pre>
</div><blockquote>
<p>🔔 Lưu ý: Khi gửi các lệnh bằng Pipeline, Redis Server sẽ đặt một số yêu cầu vào hàng đợi bộ nhớ cache (chiếm bộ nhớ), và sau khi thực thi xong, gửi kết quả một lần duy nhất. Nếu cần gửi một số lượng lớn lệnh, sẽ chiếm nhiều bộ nhớ, do đó nên xử lý theo số lượng hợp lý và chia thành các lô để xử lý.</p>
</blockquote>
<h2>8. Redis Publish/Subscribe</h2>
<p>Redis cung cấp 5 lệnh Publish/Subscribe:</p>
<p>| Lệnh           | Mô tả                                                                |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724111451.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Interview</title>
      <link>https://vanhung4499.github.io/database/redis/interview.html</link>
      <guid>https://vanhung4499.github.io/database/redis/interview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Interview</source>
      <description>Redis Interview Giới thiệu về Redis Redis là gì 【Câu hỏi】 Redis là gì? Redis có những tính năng và đặc điểm gì? 【Trả lời】 Redis là gì: Redis là một cơ sở dữ liệu &amp;quot;in-memory&amp;quot; mã ...</description>
      <category>redis</category>
      <category>interview</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giới thiệu về Redis</h2>
<h3>Redis là gì</h3>
<p>【Câu hỏi】</p>
<ul>
<li>Redis là gì?</li>
<li>Redis có những tính năng và đặc điểm gì?</li>
</ul>
<p>【Trả lời】</p>
<p>Redis là gì:</p>
<p><strong>Redis là một cơ sở dữ liệu "in-memory" mã nguồn mở</strong>. Vì Redis triển khai các thao tác đọc ghi hoàn toàn trong bộ nhớ, do đó, <strong>tốc độ đọc ghi của nó rất nhanh</strong>.</p>
<ul>
<li><strong>Hiệu suất cao</strong> - Do các thao tác đọc ghi của Redis đều triển khai trong bộ nhớ, nên hiệu suất rất cao.</li>
<li><strong>Khả năng xử lý song song cao</strong> - Redis đơn lẻ có thể đạt QPS (số yêu cầu mỗi giây) lên đến 10.0000+, gần gấp 10 lần so với MySQL.</li>
</ul>
<p>Redis thường được sử dụng trong các trường hợp như <strong>bộ nhớ đệm, hàng đợi tin nhắn, khóa phân tán, v.v.</strong>.</p>
<p>Tính năng và đặc điểm của Redis:</p>
<ul>
<li><strong>Redis hỗ trợ nhiều kiểu dữ liệu</strong>. Như: String (chuỗi), Hash (băm), List (danh sách), Set (tập hợp), Zset (tập hợp có thứ tự), Bitmaps (bản đồ bit), HyperLogLog (thống kê cardinal), GEO (không gian địa lý), Stream (dòng).</li>
<li><strong>Redis sử dụng mô hình "đơn luồng" để đọc ghi</strong>, do đó, các thao tác của nó có tính <strong>nguyên tử</strong>.</li>
<li>Redis hỗ trợ hai chiến lược lưu trữ: RDB và AOF.</li>
<li>Redis có nhiều giải pháp khả dụng cao: chế độ <strong>sao chép Master-Slave</strong>, chế độ <strong>sentinel</strong>, chế độ <strong>cụm</strong>.</li>
<li>Redis hỗ trợ nhiều tính năng phong phú như: <strong>giao dịch</strong>, <strong>kịch bản Lua</strong>, <strong>xuất bản/đăng ký</strong>, <strong>xóa dữ liệu hết hạn</strong>, <strong>loại bỏ bộ nhớ</strong>, v.v.</li>
</ul>
<h3>Các trường hợp ứng dụng của Redis</h3>
<p>【Câu hỏi】</p>
<ul>
<li>Redis có những trường hợp ứng dụng nào?</li>
</ul>
<p>【Trả lời】</p>
<ul>
<li><strong>Bộ nhớ đệm</strong> - Đặt dữ liệu nóng vào bộ nhớ, thiết lập giới hạn sử dụng bộ nhớ tối đa và chiến lược loại bỏ hết hạn để đảm bảo tỷ lệ truy xuất bộ nhớ đệm.</li>
<li><strong>Bộ đếm</strong> - Redis là cơ sở dữ liệu trong bộ nhớ có thể hỗ trợ các thao tác đọc ghi thường xuyên của bộ đếm.</li>
<li><strong>Giới hạn truy cập ứng dụng</strong> - Giới hạn lưu lượng truy cập vào một trang web.</li>
<li><strong>Hàng đợi tin nhắn</strong> - Sử dụng kiểu dữ liệu List, là một danh sách liên kết hai chiều.</li>
<li><strong>Bảng tra cứu</strong> - Sử dụng kiểu dữ liệu HASH.</li>
<li><strong>Tính toán tập hợp</strong> - Sử dụng kiểu dữ liệu SET, ví dụ như để tìm bạn chung của hai người dùng.</li>
<li><strong>Bảng xếp hạng</strong> - Sử dụng kiểu dữ liệu ZSET.</li>
<li><strong>Session phân tán</strong> - Session của nhiều máy chủ ứng dụng đều được lưu trữ trong Redis để đảm bảo tính nhất quán của Session.</li>
<li><strong>Khóa phân tán</strong> - Ngoài việc sử dụng SETNX để triển khai khóa phân tán, bạn còn có thể sử dụng RedLock - khóa phân tán chính thức do Redis cung cấp.</li>
</ul>
<h3>Redis vs. Memcached</h3>
<p>【Câu hỏi】</p>
<ul>
<li>Redis và Memcached có những điểm giống nhau nào?</li>
<li>Redis và Memcached có những khác biệt nào?</li>
<li>Khi lựa chọn công nghệ bộ nhớ đệm phân tán, nên chọn Redis hay Memcached, tại sao?</li>
</ul>
<p>【Trả lời】</p>
<p><strong>Điểm giống nhau giữa Redis và Memcached</strong>:</p>
<ol>
<li>Cả hai đều là cơ sở dữ liệu trong bộ nhớ, do đó hiệu suất đều rất cao.</li>
<li>Cả hai đều có chiến lược hết hạn.</li>
</ol>
<p>Vì hai điểm trên, chúng thường được sử dụng làm bộ nhớ đệm.</p>
<p><strong>Điểm khác nhau giữa Redis và Memcached</strong>:</p>
<p>|                 | Redis                                                                             | Memcached                                                                                                                                                                                                                                                  |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://redis.io/docs/management/optimization/benchmarks/Connections_chart.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Operations</title>
      <link>https://vanhung4499.github.io/database/redis/operations.html</link>
      <guid>https://vanhung4499.github.io/database/redis/operations.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Operations</source>
      <description>Quản trị Redis Redis là một cơ sở dữ liệu key-value có hiệu suất cao. Thao tác SET có thể đạt tới 110.000 lần mỗi giây; thao tác GET có thể đạt tới 81.000 lần mỗi giây. 1. Cài đ...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p><strong>Redis</strong> là một cơ sở dữ liệu key-value có hiệu suất cao.</p>
<p>Thao tác SET có thể đạt tới 110.000 lần mỗi giây; thao tác GET có thể đạt tới 81.000 lần mỗi giây.</p>
</blockquote>
<h2>1. Cài đặt Redis</h2>
<h3>Cài đặt trên Windows</h3>
<p><strong>Đường dẫn tải về:</strong> <a href="https://github.com/MSOpenTech/redis/releases" target="_blank" rel="noopener noreferrer">https://github.com/MSOpenTech/redis/releases</a>.</p>
<p>Redis hỗ trợ cả phiên bản 32-bit và 64-bit. Bạn cần chọn phiên bản phù hợp với hệ điều hành của bạn. Tại đây, chúng ta tải xuống tệp nén <strong>Redis-x64-xxx.zip</strong> và giải nén vào ổ đĩa C, sau đó đổi tên thư mục thành <strong>redis</strong>.</p>
<p>Mở cửa sổ <strong>cmd</strong> và sử dụng lệnh cd để chuyển đến thư mục <strong>C:\redis</strong>, chạy lệnh <strong>redis-server.exe redis.windows.conf</strong>.</p>
<p>Nếu muốn tiện lợi hơn, bạn có thể thêm đường dẫn của Redis vào biến môi trường hệ thống, điều này sẽ giúp bạn không cần phải nhập đường dẫn mỗi lần sử dụng. Bạn có thể bỏ qua phần redis.windows.conf nếu muốn, nếu bỏ qua, Redis sẽ sử dụng cấu hình mặc định.</p>
<p>Bây giờ mở một cửa sổ cmd mới, không đóng cửa sổ cũ, vì nếu đóng thì bạn sẽ không thể truy cập vào máy chủ dịch vụ nữa.</p>
<p>Chuyển đến thư mục redis và chạy lệnh <strong>redis-cli.exe -h 127.0.0.1 -p 6379</strong>.</p>
<h3>Cài đặt trên Linux</h3>
<p><strong>Đường dẫn tải về:</strong> <a href="http://redis.io/download" target="_blank" rel="noopener noreferrer">http://redis.io/download</a>, tải phiên bản mới nhất.</p>
<p>Tải xuống, giải nén và biên dịch Redis:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">wget</span><span style="color:#98C379;--shiki-dark:#98C379"> http://download.redis.io/releases/redis-5.0.4.tar.gz</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">tar</span><span style="color:#98C379;--shiki-dark:#98C379"> xzf</span><span style="color:#98C379;--shiki-dark:#98C379"> redis-5.0.4.tar.gz</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">cd</span><span style="color:#98C379;--shiki-dark:#98C379"> redis-5.0.4</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">make</span></span></code></pre>
</div><p>Để biên dịch mã nguồn Redis, bạn cần cài đặt gcc-c++ và tcl. Nếu bạn đang sử dụng CentOS, bạn có thể cài đặt bằng lệnh <code>yum install -y gcc-c++ tcl</code>.</p>
<p>Sau khi giải nén, điều hướng đến thư mục <code>src</code> và khởi động Redis bằng lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">src/redis-server</span></span></code></pre>
</div><p>Bạn có thể sử dụng client tích hợp để tương tác với Redis:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">$</span><span style="color:#98C379;--shiki-dark:#98C379"> src/redis-cli</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">set</span><span style="color:#98C379;--shiki-dark:#98C379"> foo</span><span style="color:#98C379;--shiki-dark:#98C379"> bar</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">OK</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">get</span><span style="color:#98C379;--shiki-dark:#98C379"> foo</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">"bar"</span></span></code></pre>
</div><h3>Cài đặt trên Ubuntu</h3>
<p>Trên hệ điều hành Ubuntu, bạn có thể cài đặt Redis bằng các lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sudo</span><span style="color:#98C379;--shiki-dark:#98C379"> apt-get</span><span style="color:#98C379;--shiki-dark:#98C379"> update</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sudo</span><span style="color:#98C379;--shiki-dark:#98C379"> apt-get</span><span style="color:#98C379;--shiki-dark:#98C379"> install</span><span style="color:#98C379;--shiki-dark:#98C379"> redis-server</span></span></code></pre>
</div><h3>Tự động khởi động khi máy khởi động</h3>
<ul>
<li>Cấu hình tự động khởi động: <code>echo "/usr/local/bin/redis-server /etc/redis.conf" &gt;&gt; /etc/rc.local</code></li>
</ul>
<h3>Mở cổng trên tường lửa</h3>
<ul>
<li>Thêm quy tắc: <code>iptables -I INPUT -p tcp -m tcp --dport 6379 -j ACCEPT</code></li>
<li>Lưu quy tắc: <code>service iptables save</code></li>
<li>Khởi động lại iptables: <code>service iptables restart</code></li>
</ul>
<h3>Kịch bản cài đặt Redis</h3>
<blockquote>
<p>Kịch bản cài đặt cho môi trường CentOS 7</p>
</blockquote>
<p><strong>Hướng dẫn cài đặt</strong></p>
<ul>
<li>Cài đặt Redis bằng cách biên dịch và đăng ký nó như một dịch vụ systemd</li>
<li>Đường dẫn cài đặt là: <code>/usr/local/redis</code></li>
<li>Phiên bản mặc định là <code>5.0.4</code>, cổng mặc định là <code>6379</code>, mật khẩu truy cập là trống</li>
</ul>
<p><strong>Cách sử dụng</strong></p>
<ul>
<li>Cài đặt mặc định - Chạy bất kỳ lệnh nào sau đây:</li>
</ul>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">curl</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -o-</span><span style="color:#98C379;--shiki-dark:#98C379"> https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">bash</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">wget</span><span style="color:#D19A66;--shiki-dark:#D19A66"> -qO-</span><span style="color:#98C379;--shiki-dark:#98C379"> https://gitee.com/turnon/linux-tutorial/raw/master/codes/linux/soft/redis-install.sh</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF">bash</span></span></code></pre>
</div><ul>
<li>Cài đặt tùy chỉnh - Tải xuống kịch bản và chạy theo định dạng sau:</li>
</ul>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">sh</span><span style="color:#98C379;--shiki-dark:#98C379"> redis-install.sh</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> [version] [port] [password]</span></span></code></pre>
</div><p>Giải thích các tham số:</p>
<ul>
<li><code>version</code> - số phiên bản Redis</li>
<li><code>port</code> - số cổng dịch vụ Redis</li>
<li><code>password</code> - mật khẩu truy cập</li>
</ul>
<h2>2. Sử dụng và cấu hình Redis đơn</h2>
<h3>Khởi động Redis</h3>
<p><strong>Khởi động dịch vụ Redis</strong></p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">cd</span><span style="color:#98C379;--shiki-dark:#98C379"> /usr/local/redis/src</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./redis-server</span></span></code></pre>
</div><p><strong>Khởi động client Redis</strong></p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2">cd</span><span style="color:#98C379;--shiki-dark:#98C379"> /usr/local/redis/src</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">./redis-cli</span></span></code></pre>
</div><p><strong>Kiểm tra Redis đã khởi động chưa</strong></p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis-cli</span></span></code></pre>
</div><p>Lệnh trên sẽ mở một terminal như sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#98C379;--shiki-dark:#98C379"> 127.0.0.1:637</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">9&gt;</span></span></code></pre>
</div><p>127.0.0.1 là địa chỉ IP của máy local, 6379 là cổng của dịch vụ Redis. Bây giờ chúng ta gõ lệnh PING.</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">redis</span><span style="color:#98C379;--shiki-dark:#98C379"> 127.0.0.1:637</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">9&gt; </span><span style="color:#98C379;--shiki-dark:#98C379">ping</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">PONG</span></span></code></pre>
</div><p>Điều này chứng tỏ chúng ta đã khởi động Redis thành công.</p>
<h3>Cấu hình Redis thông thường</h3>
<blockquote>
<p>Tệp cấu hình mặc định của Redis là <code>redis.conf</code> trong thư mục gốc.</p>
<p>Nếu bạn muốn chỉ định một tệp cấu hình cụ thể, bạn cần sử dụng lệnh: <code>./redis-server -c xxx.conf</code></p>
<p>Sau mỗi lần thay đổi cấu hình, bạn cần khởi động lại Redis để áp dụng thay đổi.</p>
<p>Cấu hình mặc định của Redis:</p>
<ul>
<li>Tài liệu mô tả bản thân <a href="https://raw.githubusercontent.com/antirez/redis/2.8/redis.conf" target="_blank" rel="noopener noreferrer">redis.conf cho Redis 2.8</a></li>
<li>Tài liệu mô tả bản thân <a href="https://raw.githubusercontent.com/antirez/redis/2.6/redis.conf" target="_blank" rel="noopener noreferrer">redis.conf cho Redis 2.6</a>.</li>
<li>Tài liệu mô tả bản thân <a href="https://raw.githubusercontent.com/antirez/redis/2.4/redis.conf" target="_blank" rel="noopener noreferrer">redis.conf cho Redis 2.4</a>.</li>
</ul>
<p>Từ Redis 2.6 trở đi, bạn có thể truyền các tham số cấu hình Redis trực tiếp từ dòng lệnh. Phương pháp này có thể được sử dụng cho mục đích kiểm tra.</p>
</blockquote>
<h3>Đặt Redis làm tiến trình nền</h3>
<p>Redis mặc định không chạy như một tiến trình nền, nhưng thông thường chúng ta sẽ đặt Redis làm tiến trình nền. Cấu hình: <code>daemonize yes</code></p>
<h4>Truy cập từ xa</h4>
<p>Redis mặc định ràng buộc với địa chỉ 127.0.0.1, điều này chỉ cho phép truy cập từ máy cục bộ. Nếu bạn muốn cho phép truy cập từ xa vào Redis, bạn cần cấu hình: <code>bind 0.0.0.0</code></p>
<h4>Đặt mật khẩu</h4>
<p>Redis mặc định không yêu cầu mật khẩu khi truy cập. Nếu bạn muốn đặt mật khẩu, bạn cần cấu hình như sau:</p>
<ul>
<li><code>protected-mode yes</code></li>
<li><code>requirepass &lt;mật khẩu&gt;</code></li>
</ul>
<h4>Bảng tham số cấu hình</h4>
<p>| Cấu hình                                                                                                                                                                                                               | Mô tả                                                                                                                                                                                                                                                                                   |<br>
| :</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230725005340.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Overview</title>
      <link>https://vanhung4499.github.io/database/redis/overview.html</link>
      <guid>https://vanhung4499.github.io/database/redis/overview.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Overview</source>
      <description>Redis Overview Redis là một ứng dụng phổ biến nhất trong việc sử dụng như một bộ đệm phân tán. Để hiểu rõ về Redis, cần nắm vững nguyên lý của bộ đệm và vai trò của Redis như mộ...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Redis là một ứng dụng phổ biến nhất trong việc sử dụng như một bộ đệm phân tán.</p>
<p>Để hiểu rõ về Redis, cần nắm vững nguyên lý của bộ đệm và vai trò của Redis như một giải pháp bộ đệm trong hệ thống ứng dụng.</p>
</blockquote>
<h2>📖 Contents</h2>
]]></content:encoded>
    </item>
    <item>
      <title>Redis Persistence</title>
      <link>https://vanhung4499.github.io/database/redis/persistence.html</link>
      <guid>https://vanhung4499.github.io/database/redis/persistence.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Persistence</source>
      <description>Lưu trữ bền vững trong Redis Redis là cơ sở dữ liệu trong bộ nhớ (in-memory). Để đảm bảo dữ liệu không bị mất sau khi xảy ra sự cố, dữ liệu trong bộ nhớ cần phải được lưu vào đĩ...</description>
      <category>redis</category>
      <category>nosql</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Redis là cơ sở dữ liệu trong bộ nhớ (in-memory). Để đảm bảo dữ liệu không bị mất sau khi xảy ra sự cố, dữ liệu trong bộ nhớ cần phải được lưu vào đĩa cứng.</p>
<p>Redis hỗ trợ hai phương pháp kiên trì: RDB và AOF. Hai phương pháp kiên trì này có thể được sử dụng đồng thời hoặc riêng biệt.</p>
</blockquote>
<h2>RDB</h2>
<h3>Giới thiệu về RDB</h3>
<p><strong>RDB (Redis Database Backup)</strong> hay còn gọi là "bản snapshot", là quá trình lưu trữ tất cả các cặp khóa-giá trị của cơ sở dữ liệu Redis vào một tệp nhị phân nén gọi là "tệp RDB" vào một thời điểm cụ thể trong quá trình hoạt động.</p>
<p><strong>Lưu trữ RDB</strong> có thể được thực hiện "thủ công" hoặc "tự động" theo định kỳ.</p>
<p><strong>Tệp RDB</strong> được tải khi máy chủ Redis được "khởi động" làm việc "tự động".</p>
<p>Với từng loại cặp khóa-giá trị khác nhau, tệp RDB sẽ sử dụng cách lưu trữ khác nhau.</p>
<p>Sau khi tạo tệp RDB, người dùng có thể sao lưu RDB, sao chép RDB sang các máy chủ khác để tạo bản sao của máy chủ có cùng dữ liệu, hoặc sử dụng khi khởi động lại máy chủ. Tóm lại, <strong>RDB thích hợp cho việc "sao lưu lạnh"</strong>.</p>
<h3>Ưu điểm và Nhược điểm của RDB</h3>
<p><strong>Ưu điểm của RDB</strong></p>
<ul>
<li>
<p><strong>Kích thước nhỏ và phù hợp cho việc sao lưu “lạnh”</strong>: Tệp RDB rất gọn nhẹ và thích hợp để sử dụng làm sao lưu định kỳ. Bạn có thể lên lịch sao lưu theo nhu cầu, ví dụ mỗi giờ lưu trữ dữ liệu trong vòng 24 giờ qua, và mỗi ngày lưu trữ dữ liệu trong vòng 30 ngày qua. Như vậy, ngay cả khi xảy ra sự cố, bạn cũng có thể khôi phục dữ liệu thành các phiên bản khác nhau theo nhu cầu.</p>
</li>
<li>
<p><strong>Tối ưu hiệu năng</strong>: Khi tạo tệp RDB, quá trình chỉ yêu cầu tiến trình cha của Redis fork ra một tiến trình con, và toàn bộ công việc sau đó được tiến trình con thực hiện. Tiến trình cha không cần thực hiện thêm thao tác IO nào, do đó phương pháp lưu trữ bằng RDB có thể tối đa hóa hiệu suất của Redis.</p>
</li>
<li>
<p><strong>Phục hồi nhanh chóng với tập dữ liệu lớn</strong>: Khi phục hồi dữ liệu từ RDB, quá trình này thường nhanh hơn so với AOF.</p>
</li>
</ul>
<p><strong>Nhược điểm của RDB</strong></p>
<ul>
<li>
<p><strong>Rủi ro mất dữ liệu</strong>: Nếu hệ thống gặp sự cố, dữ liệu sau lần tạo bản sao RDB cuối cùng sẽ bị mất đi. Nếu bạn muốn giảm thiểu mất dữ liệu trong trường hợp Redis dừng đột ngột (ví dụ như mất điện), thì phương pháp lưu trữ bằng RDB không phù hợp. Mặc dù bạn có thể cấu hình các điểm lưu trữ khác nhau (ví dụ, mỗi 5 phút và có 100 thao tác ghi vào tập dữ liệu), việc lưu trữ toàn bộ dữ liệu hoàn chỉnh của Redis là một công việc tương đối nặng nề. Thông thường, bạn sẽ thực hiện lưu trữ đầy đủ mỗi 5 phút hoặc lâu hơn, và nếu Redis ngừng hoạt động đột ngột, bạn có thể mất vài phút dữ liệu.</p>
</li>
<li>
<p><strong>Thời gian lưu trữ dài khi tập dữ liệu lớn</strong>: Khi tập dữ liệu lớn, quá trình fork để lưu trữ RDB có thể tốn nhiều thời gian. Điều này có thể dẫn đến việc Redis không thể phản hồi yêu cầu từ người dùng trong vài mili giây. Nếu tập dữ liệu quá lớn và hiệu suất CPU không tốt, tình trạng này có thể kéo dài lên đến 1 giây. AOF cũng cần phải fork, nhưng bạn có thể điều chỉnh tần suất viết lại tệp nhật ký để tăng tính bền bỉ của tập dữ liệu.</p>
</li>
</ul>
<h3>Tạo tệp RDB</h3>
<p>Redis cung cấp hai lệnh để tạo tệp RDB: <a href="https://redis.io/commands/save" target="_blank" rel="noopener noreferrer"><strong><code>SAVE</code></strong></a> và <a href="https://redis.io/commands/bgsave" target="_blank" rel="noopener noreferrer"><strong><code>BGSAVE</code></strong></a>.</p>
<p><strong>Lệnh <code>SAVE</code></strong> được thực thi bởi tiến trình máy chủ trực tiếp và sẽ chặn (block) máy chủ cho đến khi tệp RDB được tạo xong. Trong thời gian chặn này, máy chủ sẽ không thể phản hồi bất kỳ yêu cầu lệnh nào khác.</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; SAVE</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">"OK"</span></span></code></pre>
</div><p><strong>Lệnh <code>BGSAVE</code></strong> khởi động một tiến trình con (fork) để tạo tệp RDB, do đó máy chủ tiếp tục xử lý các yêu cầu lệnh trong khi quá trình tạo tệp RDB diễn ra. Vì vậy, lệnh này không làm chặn máy chủ.</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; BGSAVE</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">"Background saving started"</span></span></code></pre>
</div><blockquote>
<p>🔔 <strong>【Chú ý】</strong></p>
<p><code>BGSAVE</code> sử dụng công nghệ sao chép khi ghi (Copy-On-Write, viết khi sao chép).</p>
<p>Trong quá trình thực thi <code>BGSAVE</code>, các lệnh <code>SAVE</code>, <code>BGSAVE</code>, và <code>BGREWRITEAOF</code> sẽ bị từ chối để tránh xung đột đua ra giữa <code>BGSAVE</code> hiện tại và các hoạt động khác, nhằm tối ưu hóa hiệu suất.</p>
</blockquote>
<p>Quá trình tạo tệp RDB được thực hiện bởi hàm <code>rdb.c/rdbSave</code> trong mã nguồn Redis.</p>
<h3>Tải tệp RDB</h3>
<p>Redis thực hiện việc tải tệp RDB khi máy chủ khởi động mà không cần lệnh đặc biệt để thực hiện điều này.</p>
<p><strong>Việc tải tệp RDB xảy ra tự động khi máy chủ Redis khởi động</strong>. Trong quá trình này, máy chủ sẽ ở trạng thái chặn (block) cho đến khi quá trình tải RDB hoàn tất.</p>
<p>Quá trình tải RDB được thực hiện bởi hàm <code>rdb.c/rdbLoad</code> trong mã nguồn Redis.</p>
<blockquote>
<p>🔔 <strong>【Chú ý】</strong></p>
<p>Do tần suất cập nhật của AOF thường cao hơn so với RDB:</p>
<ul>
<li>Nếu máy chủ có AOF được kích hoạt, máy chủ sẽ ưu tiên sử dụng AOF để khôi phục dữ liệu.</li>
<li>Chỉ khi AOF bị tắt, máy chủ mới sử dụng tệp RDB để khôi phục dữ liệu.</li>
</ul>
</blockquote>
<p>Điều này đảm bảo rằng Redis luôn sử dụng cơ chế lưu trữ phù hợp nhất để đảm bảo an toàn và khôi phục dữ liệu một cách hiệu quả khi khởi động lại.</p>
<h3>Tự động sao lưu định kì</h3>
<p>Redis hỗ trợ tự động thực hiện lệnh <code>BGSAVE</code> theo khoảng thời gian được cấu hình trong tệp <code>redis.conf</code> bằng cách sử dụng tùy chọn <code>save</code>. Tùy chọn <code>save</code> cho phép thiết lập nhiều điều kiện lưu trữ, và khi bất kỳ điều kiện nào được đáp ứng, máy chủ Redis sẽ thực hiện lệnh <code>BGSAVE</code>.</p>
<p><strong>Ví dụ cấu hình tự động lưu trữ trong <code>redis.conf</code>:</strong></p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Trong vòng 900 giây, ít nhất có 1 lần thay đổi cơ sở dữ liệu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">save</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 900</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Trong vòng 300 giây, ít nhất có 10 lần thay đổi cơ sở dữ liệu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">save</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 300</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic"># Trong vòng 60 giây, ít nhất có 10000 lần thay đổi cơ sở dữ liệu</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">save</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 60</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 10000</span></span></code></pre>
</div><p>Khi bất kỳ điều kiện nào được đáp ứng, Redis sẽ thực hiện lệnh <code>BGSAVE</code>.</p>
<p><strong>Định nghĩa các điều kiện lưu trữ trong <code>redis.h/redisServer</code>:</strong></p>
<div class="language-c line-numbers-mode" data-ext="c" data-title="c"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">struct</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> redisServer {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Mảng lưu trữ các điều kiện lưu trữ</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    struct</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> saveparam </span><span style="color:#C678DD;--shiki-dark:#C678DD">*</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">saveparams;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Số lần thay đổi cơ sở dữ liệu kể từ lần SAVE cuối cùng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    long</span><span style="color:#C678DD;--shiki-dark:#C678DD"> long</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> dirty;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Thời điểm thực hiện SAVE lần cuối</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    time_t</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> lastsave;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">// Cấu trúc điều kiện lưu trữ của máy chủ (các điều kiện tự động thực hiện BGSAVE)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">struct</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> saveparam {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Thời gian giới hạn (seconds)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    time_t</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> seconds;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">    // Số lần thay đổi</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    int</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> changes;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">};</span></span></code></pre>
<div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Mảng <code>saveparams</code> trong <code>redisServer</code> duy trì các điều kiện lưu trữ tự động.</p>
<p>Mỗi khi thành công thực hiện một lệnh chỉnh sửa, biến <code>dirty</code> sẽ tăng lên 1 đơn vị; <code>lastsave</code> ghi lại thời điểm lần SAVE cuối cùng được thực hiện. Redis sử dụng hàm <code>serverCron</code> để định kỳ kiểm tra xem các điều kiện được cấu hình trong <code>save</code> có được đáp ứng không. Nếu đáp ứng, Redis sẽ thực hiện lệnh <code>BGSAVE</code>.</p>
<h3>Cấu trúc của tệp RDB</h3>
<p><strong>Tệp RDB là một tệp nhị phân được nén</strong> và được chia thành nhiều phần khác nhau tùy thuộc vào loại dữ liệu (STRING, HASH, LIST, SET, SORTED SET).</p>
<figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/redis-rdb-structure.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure>
<p>Redis cung cấp công cụ <code>redis-check-dump</code> để kiểm tra tệp RDB.</p>
<h3>Cấu hình RDB</h3>
<p>Mặc định, Redis cấu hình RDB như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>save 900 1</span></span>
<span class="line"><span>save 300 10</span></span>
<span class="line"><span>save 60 10000</span></span>
<span class="line"><span>stop-writes-on-bgsave-error yes</span></span>
<span class="line"><span>rdbcompression yes</span></span>
<span class="line"><span>rdbchecksum yes</span></span>
<span class="line"><span>dbfilename dump.rdb</span></span>
<span class="line"><span>dir ./</span></span></code></pre>
</div><p>Các tùy chọn liên quan đến RDB trong tệp cấu hình <code>redis.conf</code> của Redis:</p>
<ul>
<li><code>save</code>: Redis sẽ tự động thực hiện lệnh <code>BGSAVE</code> theo các điều kiện được cấu hình trong <code>save</code>.</li>
<li><code>stop-writes-on-bgsave-error</code>: Dừng ghi khi có lỗi trong quá trình <code>BGSAVE</code>.</li>
<li><code>rdbcompression</code>: Bật/tắt nén RDB.</li>
<li><code>rdbchecksum</code>: Kiểm tra dữ liệu RDB.</li>
<li><code>dbfilename</code>: Tên tệp RDB.</li>
<li><code>dir</code>: Thư mục lưu trữ tệp RDB và AOF.</li>
</ul>
<h2>2. AOF</h2>
<h3>Giới thiệu về AOF</h3>
<p><code>AOF (Append Only File)</code> là một tệp ghi log mà Redis sử dụng để lưu trữ tất cả các lệnh ghi vào cơ sở dữ liệu. Khi máy chủ khởi động lại, Redis sẽ nạp và thực thi các lệnh từ tệp AOF này để khôi phục dữ liệu gốc. AOF được coi là phương pháp "sao lưu nóng".</p>
<p>AOF có thể được bật bằng cách đặt cấu hình <code>appendonly yes</code>.</p>
<h3>Ưu điểm và nhược điểm của AOF</h3>
<p><strong>Ưu điểm của AOF</strong></p>
<ul>
<li><strong>Giảm thiểu mất mát dữ liệu so với RDB</strong>: Khi hệ thống gặp sự cố, AOF thường mất ít dữ liệu hơn RDB. Bạn có thể cấu hình các chiến lược fsync khác nhau như không có fsync, fsync mỗi giây, hoặc fsync mỗi lần ghi. Với chiến lược mặc định fsync mỗi giây, Redis vẫn duy trì hiệu suất tốt và chỉ mất tối đa 1 giây dữ liệu khi có sự cố.</li>
<li><strong>Khả năng sửa chữa tệp AOF</strong>: Tệp AOF là một tệp log chỉ thêm vào (append-only), do đó không cần phải thực hiện seek khi ghi. Ngay cả khi một số lệnh ghi không được hoàn thành do lý do nào đó (ví dụ như không gian ổ đĩa đầy), bạn vẫn có thể sửa chữa vấn đề này bằng công cụ <code>redis-check-aof</code>.</li>
<li><strong>Nén tệp AOF</strong>: Redis có thể tự động tái viết (rewrite) tệp AOF khi nó trở nên quá lớn. Tệp AOF mới sau khi tái viết chỉ chứa các lệnh tối thiểu cần thiết để khôi phục dữ liệu hiện tại. Quá trình tái viết hoàn toàn an toàn vì Redis vẫn tiếp tục ghi các lệnh vào tệp AOF hiện có trong khi tạo ra tệp AOF mới. Khi tệp AOF mới được tạo xong, Redis sẽ chuyển sang sử dụng tệp AOF mới và tiếp tục ghi vào đó.</li>
<li><strong>Dễ đọc và phân tích</strong>: Tệp AOF lưu trữ tất cả các lệnh ghi vào cơ sở dữ liệu theo đúng thứ tự. Do đó, nội dung của tệp AOF rất dễ đọc và phân tích. Bạn có thể dễ dàng xuất tệp AOF hoặc phân tích nó. Ví dụ, nếu bạn vô tình thực hiện lệnh FLUSHALL, nhưng tệp AOF chưa bị tái viết, bạn có thể dừng máy chủ, loại bỏ lệnh FLUSHALL cuối cùng từ tệp AOF và khởi động lại Redis để khôi phục dữ liệu trước khi thực hiện FLUSHALL.</li>
</ul>
<p><strong>Nhược điểm của AOF</strong></p>
<ul>
<li><strong>Kích thước tệp AOF thường lớn hơn RDB</strong>: Đối với cùng một bộ dữ liệu, tệp AOF thường có kích thước lớn hơn tệp RDB.</li>
<li><strong>Khôi phục bộ dữ liệu lớn từ AOF có thể chậm hơn RDB</strong>: Tùy thuộc vào chiến lược fsync được sử dụng, AOF có thể chậm hơn so với RDB trong quá trình khôi phục dữ liệu lớn. Tuy nhiên, với fsync mỗi giây, hiệu suất của AOF vẫn rất cao và có thể xứng đáng với tốc độ của RDB. Tuy nhiên, trong các tải ghi lớn, RDB có thể cung cấp thời gian đáp ứng tối đa đáng tin cậy hơn.</li>
</ul>
<h3>Tạo AOF</h3>
<p><strong>Các yêu cầu lệnh Redis sẽ được lưu vào vùng đệm AOF, sau đó được ghi và đồng bộ hóa định kỳ vào tệp AOF.</strong></p>
<p>Việc triển khai AOF có thể chia thành ba bước: ghi lệnh (append), ghi tệp và đồng bộ hóa tệp (sync).</p>
<ul>
<li>
<p><strong>Ghi lệnh (append)</strong> - Khi chức năng AOF của máy chủ Redis được bật, máy chủ sẽ thêm lệnh ghi sẽ thực thi vào cuối vùng đệm AOF dưới dạng giao thức lệnh Redis.</p>
</li>
<li>
<p><strong>Ghi tệp và đồng bộ hóa tệp</strong></p>
<ul>
<li>Quá trình sự kiện của máy chủ Redis là một vòng lặp sự kiện, trong đó sự kiện tệp chịu trách nhiệm nhận yêu cầu lệnh từ khách hàng và gửi phản hồi lệnh cho khách hàng. Trong khi đó, sự kiện thời gian chịu trách nhiệm thực hiện các chức năng chạy định kỳ như <code>serverCron</code>.</li>
<li>Vì máy chủ có thể thực hiện lệnh ghi khi xử lý sự kiện tệp, các lệnh ghi này sẽ được thêm vào vùng đệm AOF. Trước khi kết thúc vòng lặp sự kiện, máy chủ sẽ kiểm tra nội dung vùng đệm AOF dựa trên tùy chọn <code>appendfsync</code> để quyết định xem liệu nội dung này có cần được ghi vào và đồng bộ hóa với tệp AOF hay không.</li>
</ul>
</li>
</ul>
<p>Tùy chọn <code>appendfsync</code> quyết định hành vi bền vững của AOF như sau:</p>
<ul>
<li><strong><code>always</code></strong> - Ghi tất cả nội dung từ vùng đệm AOF vào và đồng bộ hóa với tệp AOF. Phương pháp này đảm bảo an toàn dữ liệu nhất nhưng hiệu suất thấp nhất.</li>
<li><strong><code>no</code></strong> - Ghi tất cả nội dung từ vùng đệm AOF vào tệp AOF nhưng không đồng bộ hóa, thời điểm đồng bộ hóa phụ thuộc vào hệ điều hành. Đây là phương pháp dữ liệu không an toàn nhất, mọi dữ liệu chưa kịp đồng bộ hóa khi gặp sự cố sẽ bị mất.</li>
<li><strong><code>everysec</code></strong> - Tùy chọn mặc định của <code>appendfsync</code>. Ghi tất cả nội dung từ vùng đệm AOF vào tệp AOF, và nếu thời gian từ lần đồng bộ hóa AOF trước đó đã quá 1 giây, sẽ tiếp tục đồng bộ hóa. Thao tác này được thực hiện bởi một luồng đặc biệt, đảm bảo hiệu suất đủ tốt và chỉ mất dữ liệu trong vòng một giây nếu có sự cố.</li>
</ul>
<p>Lựa chọn của <code>appendfsync</code> ảnh hưởng đáng kể đến tính bảo mật của chức năng bền vững của AOF và hiệu suất của máy chủ Redis.</p>
<h3>Tải lại AOF</h3>
<p>AOF (Append Only File) là một phương pháp lưu trữ dữ liệu trong Redis bằng cách ghi tất cả các lệnh ghi vào một tệp log. Khi máy chủ Redis khởi động lại sau một sự cố hoặc tái khởi động, AOF được sử dụng để tái tạo lại trạng thái cơ sở dữ liệu trước khi máy chủ tắt.</p>
<p>Quá trình tải lại AOF được thực hiện như sau:</p>
<ol>
<li>
<p><strong>Khởi động chương trình tải lại của máy chủ</strong>: Khi Redis bắt đầu, nó khởi động một quy trình đặc biệt để tải lại dữ liệu từ tệp AOF.</p>
</li>
<li>
<p><strong>Tạo một khách hàng giả</strong>: Do lệnh Redis chỉ có thể thực thi trong ngữ cảnh khách hàng, Redis cần tạo ra một khách hàng giả để thực hiện và thực thi các lệnh trong tệp AOF.</p>
</li>
<li>
<p><strong>Phân tích và đọc lệnh ghi từ tệp AOF</strong>: Chương trình tải lại sẽ bắt đầu đọc và phân tích các lệnh ghi trong tệp AOF. Mỗi lệnh được lưu trong tệp AOF dưới định dạng giao thức lệnh Redis.</p>
</li>
<li>
<p><strong>Thực thi lệnh bằng khách hàng giả</strong>: Sau khi phân tích, chương trình tải lại sẽ sử dụng khách hàng giả để thực thi mỗi lệnh ghi từ tệp AOF. Điều này có nghĩa là Redis sẽ thực hiện mọi thay đổi dữ liệu được lưu trong các lệnh ghi này.</p>
</li>
<li>
<p><strong>Lặp lại quá trình đọc và thực thi lệnh</strong>: Quá trình đọc và thực thi lệnh sẽ tiếp tục cho đến khi tất cả các lệnh ghi từ tệp AOF được xử lý hoàn tất.</p>
</li>
<li>
<p><strong>Hoàn thành quá trình tải lại</strong>: Sau khi tất cả các lệnh đã được thực thi từ tệp AOF, quá trình tải lại sẽ kết thúc và Redis sẵn sàng hoạt động với dữ liệu được phục hồi từ tệp AOF.</p>
</li>
</ol>
<h3>Viết lại AOF</h3>
<p>Dưới sự hoạt động liên tục của Redis, kích thước của tệp AOF cũng sẽ không ngừng tăng lên, điều này gây ra hai vấn đề chính:</p>
<ul>
<li>AOF có thể làm đầy không gian lưu trữ trên đĩa.</li>
<li>Khi Redis khởi động lại, tất cả các lệnh ghi trong tệp AOF phải được thực thi để khôi phục lại tập dữ liệu. Nếu kích thước của AOF quá lớn, thời gian để thực hiện quá trình khôi phục cũng sẽ rất lâu.</li>
</ul>
<p>Để giải quyết vấn đề về kích thước của tệp AOF phình ra, Redis cung cấp tính năng ghi lại AOF (AOF rewrite) để nén tệp AOF. <strong>Quá trình ghi lại AOF tạo ra một tệp AOF mới, tệp này giữ nguyên trạng thái cơ sở dữ liệu như trong tệp AOF ban đầu, nhưng kích thước nhỏ hơn</strong>.</p>
<p>Quá trình ghi lại AOF không phải là đọc và phân tích nội dung của tệp AOF hiện tại, mà là trực tiếp đọc trạng thái cơ sở dữ liệu hiện tại từ Redis. Nghĩa là từng giá trị hiện tại của các khóa trong cơ sở dữ liệu được đọc và ghi vào tệp mới bằng một lệnh duy nhất, thay thế cho những lệnh có thể đã trùng lặp từ trước.</p>
<h3>AOF Đồng Bộ Hóa Nền</h3>
<p>Là một tính năng hỗ trợ, rõ ràng Redis không muốn khi thực hiện việc ghi lại AOF làm ảnh hưởng đến việc nhận các lệnh Redis dịch vụ khác. Do đó, Redis quyết định sử dụng lệnh <code>BGREWRITEAOF</code> để tạo một tiến trình con để chịu trách nhiệm tái viết tệp AOF, tương tự như cách làm của <code>BGSAVE</code>.</p>
<ul>
<li>Khi thực hiện lệnh <code>BGREWRITEAOF</code>, máy chủ Redis duy trì một vùng đệm tái viết AOF. Khi tiến trình con tái viết AOF bắt đầu làm việc, Redis sau mỗi lần thực hiện một lệnh ghi, cả hai gửi lệnh này đến vùng đệm ghi AOF và vùng đệm tái viết AOF.</li>
<li>Vì tiến trình con và tiến trình chính không hoạt động trong cùng một tiến trình, do đó quá trình tái viết AOF không ảnh hưởng đến quá trình ghi và đồng bộ hóa AOF. Khi tiến trình con hoàn thành công việc tạo tệp AOF mới, máy chủ sẽ thêm tất cả nội dung từ vùng đệm tái viết vào cuối tệp AOF mới, đảm bảo rằng trạng thái cơ sở dữ liệu được lưu trữ trong hai tệp AOF cũ và mới là như nhau.</li>
</ul>
<blockquote>
<p>Quá trình thực hiện lệnh <code>BGREWRITEAOF</code> sử dụng kỹ thuật sao chép khi ghi (Copy-On-Write, viết tắt là CoW).</p>
</blockquote>
<p>Bạn có thể thiết lập <code>auto-aof-rewrite-percentage</code> và <code>auto-aof-rewrite-min-size</code> để Redis tự động thực hiện <code>BGREWRITEAOF</code> khi đạt điều kiện nhất định.</p>
<p>Ví dụ cấu hình như sau:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>auto-aof-rewrite-percentage 100</span></span>
<span class="line"><span>auto-aof-rewrite-min-size 64mb</span></span></code></pre>
</div><p>Điều này chỉ ra rằng khi AOF lớn hơn <code>64MB</code>, và kích thước AOF lớn hơn ít nhất <code>100%</code> so với lần tái viết trước đó, Redis sẽ thực hiện lệnh <code>BGREWRITEAOF</code>.</p>
<h3>Cấu hình AOF</h3>
<p>Cấu hình mặc định của AOF trong Redis:</p>
<div class="language-plaintext" data-ext="plaintext" data-title="plaintext"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>appendonly no</span></span>
<span class="line"><span>appendfsync everysec</span></span>
<span class="line"><span>no-appendfsync-on-rewrite no</span></span>
<span class="line"><span>auto-aof-rewrite-percentage 100</span></span>
<span class="line"><span>auto-aof-rewrite-min-size 64mb</span></span></code></pre>
</div><p>Các cài đặt mặc định này có thể được điều chỉnh trong tệp cấu hình Redis (<code>redis.conf</code>). Dưới đây là các tùy chọn cấu hình AOF và ý nghĩa của chúng:</p>
<ul>
<li>
<p><strong><code>appendonly</code></strong> - Mở tính năng AOF (append-only file). Khi được thiết lập thành <code>yes</code>, Redis sẽ bắt đầu ghi lại các câu lệnh vào tệp AOF để bảo vệ dữ liệu khi Redis khởi động lại.</p>
</li>
<li>
<p><strong><code>appendfsync</code></strong> - Xác định tần suất đồng bộ hóa AOF với đĩa. Các giá trị có thể là:</p>
<ul>
<li><strong><code>always</code></strong> - Mỗi lệnh ghi vào Redis sẽ được đồng bộ hóa ngay lập tức với đĩa. Tuy nhiên, điều này có thể làm giảm hiệu suất của Redis do tần suất ghi đĩa cao.</li>
<li><strong><code>everysec</code></strong> - Redis sẽ đồng bộ hóa AOF với đĩa mỗi giây một lần. Đây là tùy chọn được khuyến khích vì nó cân bằng giữa hiệu suất và an toàn dữ liệu. Khi sử dụng tùy chọn này, Redis sẽ ghi vào AOF một lần mỗi giây, giúp bảo vệ dữ liệu mà không ảnh hưởng quá nhiều đến hiệu suất.</li>
<li><strong><code>no</code></strong> - Hệ điều hành quyết định khi nào cần đồng bộ hóa với đĩa. Đây là tùy chọn ít an toàn vì dữ liệu có thể bị mất nếu hệ thống gặp sự cố.</li>
</ul>
</li>
<li>
<p><strong><code>no-appendfsync-on-rewrite</code></strong> - Khi thực hiện quá trình tái viết AOF, Redis sẽ không đồng bộ hóa AOF với đĩa để tránh làm gián đoạn hoạt động ghi mới. Tùy chọn này giúp duy trì hiệu suất cao trong khi tái viết AOF.</p>
</li>
<li>
<p><strong><code>auto-aof-rewrite-percentage</code></strong> - Độ lớn tệp AOF hiện tại so với tệp AOF gần nhất sau khi thực hiện tái viết. Nếu tệp AOF hiện tại lớn hơn mức này, Redis sẽ tự động thực hiện tái viết AOF để nén tệp AOF. Giá trị mặc định là 100%, nghĩa là khi tệp AOF hiện tại lớn hơn hoặc bằng tệp tái viết gần đây nhất, Redis sẽ tái viết AOF.</p>
</li>
<li>
<p><strong><code>auto-aof-rewrite-min-size</code></strong> - Kích thước tối thiểu mà tệp AOF phải đạt được để Redis tự động thực hiện tái viết. Giá trị mặc định là <code>64mb</code>, nghĩa là Redis sẽ tự động tái viết AOF nếu kích thước tệp AOF hiện tại lớn hơn hoặc bằng <code>64MB</code>.</p>
</li>
<li>
<p><strong><code>dir</code></strong> - Đường dẫn nơi lưu trữ tệp RDB và AOF.</p>
</li>
</ul>
<h2>3. RDB vs AOF</h2>
<blockquote>
<p>Khi Redis khởi động, nếu cả RDB và AOF đều được kích hoạt, chương trình sẽ ưu tiên sử dụng tập tin AOF để khôi phục tập dữ liệu, vì tập tin AOF thường chứa dữ liệu hoàn chỉnh nhất.</p>
</blockquote>
<h3>Lựa chọn cơ chế lưu trữ</h3>
<ul>
<li>Nếu không quan tâm đến mất dữ liệu, bạn có thể không cần lưu trữ.</li>
<li>Nếu chấp nhận mất dữ liệu trong vài phút, chỉ cần sử dụng RDB.</li>
<li>Nếu không thể chấp nhận mất dữ liệu trong vài phút, hãy sử dụng cả RDB và AOF.</li>
</ul>
<p>Nhiều người dùng chỉ sử dụng AOF cho lưu trữ, nhưng điều này không được khuyến khích vì việc tạo snapshot RDB định kỳ rất thuận tiện cho sao lưu cơ sở dữ liệu và khôi phục nhanh chóng hơn so với AOF. Ngoài ra, việc sử dụng snapshot cũng giúp tránh được những lỗi chương trình của AOF.</p>
<h3>Chuyển từ RDB sang AOF</h3>
<p>Trong Redis phiên bản 2.2 trở lên, bạn có thể chuyển từ RDB sang AOF mà không cần khởi động lại Redis:</p>
<ul>
<li>Sao lưu tệp dump.rdb mới nhất.</li>
<li>Đặt sao lưu vào một vị trí an toàn.</li>
<li>Thực hiện hai lệnh sau:
<ul>
<li>redis-cli config set appendonly yes</li>
<li>redis-cli config set save</li>
</ul>
</li>
<li>Đảm bảo rằng các lệnh ghi sẽ được ghi đúng vào cuối tệp AOF.</li>
<li>Lệnh đầu tiên được thực hiện để bật chức năng AOF: Redis sẽ chặn cho đến khi tệp AOF ban đầu được tạo xong, sau đó Redis sẽ tiếp tục xử lý các yêu cầu lệnh và bắt đầu ghi các lệnh ghi vào cuối tệp AOF.</li>
</ul>
<p>Lệnh thứ hai được sử dụng để tắt chức năng snapshot. Bước này là tùy chọn, nếu bạn muốn, bạn cũng có thể sử dụng cả snapshot và AOF cùng một lúc.</p>
<blockquote>
<p>🔔 Quan trọng: Đừng quên mở chức năng AOF trong <code>redis.conf</code>! Nếu không, sau khi khởi động lại máy chủ, các cấu hình được thiết lập trước đó thông qua CONFIG SET sẽ bị mất và chương trình sẽ khởi động máy chủ theo cấu hình ban đầu.</p>
</blockquote>
<h3>Tương tác giữa AOF và RDB</h3>
<p>Lệnh&nbsp;<code>BGSAVE</code>&nbsp;và&nbsp;<code>BGREWRITEAOF</code>&nbsp;không thể được thực thi cùng lúc. Điều này nhằm tránh hai tiến trình Redis nền cùng thực hiện nhiều hoạt động I/O trên đĩa cùng một lúc.</p>
<p>Nếu lệnh&nbsp;<code>BGSAVE</code>&nbsp;đang được thực thi và người dùng gọi lệnh&nbsp;<code>BGREWRITEAOF</code>&nbsp;một cách rõ ràng, máy chủ sẽ trả lời người dùng với trạng thái OK và thông báo rằng&nbsp;<code>BGREWRITEAOF</code>&nbsp;đã được đặt lịch để thực thi. Sau khi&nbsp;<code>BGSAVE</code>&nbsp;hoàn thành,&nbsp;<code>BGREWRITEAOF</code>&nbsp;sẽ bắt đầu chính thức.</p>
<h3>Lưu trữ kết hợp</h3>
<p>Redis 4.0 đưa ra <strong>lưu trữ kết hợp AOF và snapshot trong bộ nhớ</strong>, hay còn gọi là lưu trữ kết hợp, để cân bằng tốc độ khởi động lại Redis và giảm rủi ro mất dữ liệu.</p>
<p>Trong lưu trữ kết hợp, trong quá trình tái viết AOF, tiến trình con tái viết sẽ đầu tiên ghi dữ liệu bộ nhớ chia sẻ với tiến trình chính dưới dạng snapshot RDB vào tệp AOF. Sau đó, các lệnh hoạt động được ghi trong bộ đệm tái viết sẽ được ghi vào tệp AOF dưới dạng tăng dần AOF. Khi việc ghi kết thúc, tiến trình chính sẽ thay thế tệp AOF cũ bằng tệp AOF mới có định dạng RDB và AOF.</p>
<p>Nói cách khác, khi sử dụng lưu trữ kết hợp, <strong>phần đầu của tệp AOF là dữ liệu đầy đủ định dạng RDB và phần cuối cùng là dữ liệu tăng dần định dạng AOF</strong>.</p>
<h2>4. Sao lưu Redis</h2>
<p>Đảm bảo rằng dữ liệu Redis được sao lưu đầy đủ là rất quan trọng.</p>
<h3>Lời khuyên về sao lưu</h3>
<p>Đề xuất sử dụng RDB để sao lưu dữ liệu Redis.</p>
<h3>Quy trình sao lưu</h3>
<ol>
<li>
<p><strong>Thiết lập công việc định kỳ (cron job)</strong>: Tạo một công việc định kỳ, sao lưu một tập tin RDB vào một thư mục mỗi giờ và sao lưu một tập tin RDB vào một thư mục khác mỗi ngày.</p>
</li>
<li>
<p><strong>Giữ lại sao lưu và thêm dấu thời gian</strong>: Đảm bảo rằng các tập tin sao lưu chứa thông tin về ngày và giờ tương ứng. Khi thực hiện công việc định kỳ, sử dụng lệnh <code>find</code> để xóa các bản sao lưu cũ. Ví dụ, có thể giữ lại các bản sao lưu mỗi giờ trong vòng 48 giờ qua và giữ lại các bản sao lưu mỗi ngày trong vòng một đến hai tháng qua.</p>
</li>
<li>
<p><strong>Sao lưu ngoại tuyến</strong>: Ít nhất mỗi ngày một lần, sao lưu RDB ra khỏi trung tâm dữ liệu hoặc ít nhất là sao lưu ra khỏi máy chủ vật lý đang chạy Redis.</p>
</li>
</ol>
<h3>Sao lưu phòng chống thảm họa</h3>
<p>Sao lưu phòng chống thảm họa Redis chủ yếu là sao lưu dữ liệu và truyền sao lưu đó đến nhiều trung tâm dữ liệu bên ngoài khác nhau.</p>
<p>Sao lưu phòng chống thảm họa cho phép dữ liệu vẫn an toàn khi trung tâm dữ liệu chính sản xuất vấn đề nghiêm trọng.</p>
]]></content:encoded>
      <enclosure url="https://raw.githubusercontent.com/vanhung4499/images/master/snap/redis-rdb-structure.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Pipeline</title>
      <link>https://vanhung4499.github.io/database/redis/pipeline.html</link>
      <guid>https://vanhung4499.github.io/database/redis/pipeline.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Pipeline</source>
      <description>Redis Pipeline Giới thiệu về Pipeline trong Redis Redis là một dịch vụ TCP dựa trên mô hình Client/Server và giao thức yêu cầu/đáp ứng. Thông thường, quá trình yêu cầu và đáp ứn...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<h2>Giới thiệu về Pipeline trong Redis</h2>
<p>Redis là một dịch vụ TCP dựa trên mô hình Client/Server và giao thức yêu cầu/đáp ứng. Thông thường, quá trình yêu cầu và đáp ứng của mỗi lệnh Redis diễn ra như sau:</p>
<ul>
<li>Khách hàng gửi yêu cầu truy vấn đến máy chủ và lắng nghe Socket để nhận phản hồi từ máy chủ (thường là ở chế độ chặn, chờ máy chủ phản hồi).</li>
<li>Máy chủ xử lý lệnh và gửi kết quả trả về cho khách hàng.</li>
</ul>
<p>Rõ ràng, nếu mỗi lệnh Redis phải gửi yêu cầu và nhận phản hồi một lần thì sẽ rất không hiệu quả. Do đó, Redis cung cấp một kỹ thuật xử lý hàng loạt, gọi là <strong>Pipeline (Đường ống)</strong>. Nguyên lý hoạt động của Pipeline là:</p>
<p><strong>Gửi đồng thời nhiều lệnh Redis đến máy chủ, máy chủ xử lý và trả về tất cả kết quả một lần cho khách hàng.</strong> Nhờ vào việc giảm số lần giao tiếp mạng, Pipeline giúp cải thiện đáng kể hiệu suất xử lý.</p>
<figure><img src="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7268887661/p514690.jpg" alt="Redis Pipeline" tabindex="0" loading="lazy"><figcaption>Redis Pipeline</figcaption></figure>
<h2>Giới hạn của Pipeline trong Redis</h2>
<p>Khi sử dụng công nghệ Pipeline trong Redis, cần lưu ý những giới hạn sau để tránh gặp phải các vấn đề không mong muốn:</p>
<ul>
<li>
<p><strong>Pipeline không đảm bảo tính nguyên tử</strong> - Pipeline chỉ là cách thức cho phép khách hàng gửi nhiều lệnh cùng lúc đến máy chủ, nhưng máy chủ nhận được các lệnh từ Pipeline sẽ phân tích thành từng lệnh riêng lẻ và thực thi chúng theo thứ tự tuần tự. Trong quá trình thực thi, máy chủ có thể thực hiện các lệnh của các khách hàng khác, do đó không thể đảm bảo tính nguyên tử. Để đảm bảo tính nguyên tử, bạn nên sử dụng giao dịch (transaction) hoặc kịch bản Lua.</p>
</li>
<li>
<p><strong>Pipeline không hỗ trợ việc lăn ngược (rollback)</strong> - Pipeline không có tính năng giao dịch, vì vậy nếu các lệnh trong Pipeline có sự phụ thuộc vào nhau, bạn không nên sử dụng Pipeline.</p>
</li>
<li>
<p><strong>Không nên gửi quá nhiều lệnh trong một lần bằng Pipeline</strong> - Khi sử dụng Pipeline để gửi lệnh, Redis Server sẽ đặt một phần yêu cầu vào hàng đợi bộ nhớ đệm và gửi kết quả một lần sau khi thực thi xong. Nếu gửi quá nhiều lệnh, sẽ tốn nhiều bộ nhớ, do đó nên chia thành các lô lệnh hợp lý để xử lý.</p>
</li>
<li>
<p><strong>Pipeline không hỗ trợ truy cập qua nhiều slot</strong> - Do Pipeline không hỗ trợ truy cập qua nhiều slot, nên khi sử dụng Redis Cluster và Pipeline, bạn cần đảm bảo rằng các khóa truy cập đều thuộc cùng một slot.</p>
</li>
</ul>
<h2>Ví dụ pipeline</h2>
<p>Các Redis Client chính thống thường hỗ trợ công nghệ pipeline.</p>
<p>Đây là một ví dụ về việc sử dụng pipeline trong Jedis để tương tác với Redis:</p>
<div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B"> Demo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "localhost"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75"> port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66"> 6379</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75"> jedis</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF"> Jedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(host, port);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75"> key</span><span style="color:#56B6C2;--shiki-dark:#56B6C2"> =</span><span style="color:#98C379;--shiki-dark:#98C379"> "pipeline:test"</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B">        jedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">(key);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic">        //</span></span></code></pre>
</div>]]></content:encoded>
      <enclosure url="https://help-static-aliyun-doc.aliyuncs.com/assets/img/zh-CN/7268887661/p514690.jpg" type="image/jpeg"/>
    </item>
    <item>
      <title>Redis Publish and Subcribe</title>
      <link>https://vanhung4499.github.io/database/redis/pub-sub.html</link>
      <guid>https://vanhung4499.github.io/database/redis/pub-sub.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Publish and Subcribe</source>
      <description>Redis Pub/Sub Redis Pub/Sub (Phát hành/Đăng ký) là một mô hình truyền thông tin: người gửi (pub) gửi thông báo, người nhận (sub) nhận thông báo. Khách hàng Redis có thể đăng ký ...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Redis Pub/Sub (Phát hành/Đăng ký) là một mô hình truyền thông tin: người gửi (pub) gửi thông báo, người nhận (sub) nhận thông báo. Khách hàng Redis có thể đăng ký bất kỳ số lượng kênh nào.</p>
<p>Redis có hai chế độ phát hành/đăng ký:</p>
<ul>
<li>Phát hành/đăng ký dựa trên kênh (Channel-based)</li>
<li>Phát hành/đăng ký dựa trên mẫu (Pattern-based)</li>
</ul>
</blockquote>
<h2>Mô hình quan sát viên</h2>
<p>Redis Pub/Sub áp dụng mô hình thiết kế kinh điển "mô hình quan sát viên" trong thiết kế phần mềm.</p>
<p><strong>Mô hình quan sát viên</strong> (Observer) là một mô hình thiết kế hành vi, cho phép bạn định nghĩa một cơ chế đăng ký để thông báo cho nhiều đối tượng khác khi có sự kiện xảy ra với đối tượng được quan sát.</p>
<ul>
<li>Mô hình này được sử dụng khi thay đổi trạng thái của một đối tượng cần thay đổi các đối tượng khác, hoặc các đối tượng thực tế chưa biết trước hoặc thay đổi động.</li>
<li>Mô hình này có thể được sử dụng khi một số đối tượng trong ứng dụng phải quan sát các đối tượng khác, nhưng chỉ trong một thời gian giới hạn hoặc trong những tình huống cụ thể.</li>
</ul>
<figure><img src="https://d1.awsstatic.com/product-marketing/Messaging/sns_img_topic.e024462ec88e79ed63d690a2eed6e050e33fb36f.png" alt="Mô hình quan sát viên" tabindex="0" loading="lazy"><figcaption>Mô hình quan sát viên</figcaption></figure>
<h2>Chế độ đăng ký của Redis</h2>
<p>Redis có hai chế độ phát hành/đăng ký:</p>
<ol>
<li><strong>Phát hành/Đăng ký dựa trên kênh (Channel-based Pub/Sub)</strong></li>
</ol>
<p>Trạng thái máy chủ trong Redis lưu giữ mối quan hệ đăng ký của tất cả các kênh trong từ điển <code>pubsub_channels</code>: Lệnh <code>SUBSCRIBE</code> chịu trách nhiệm liên kết khách hàng với kênh đã đăng ký trong từ điển này, và lệnh <code>UNSUBSCRIBE</code> thì chịu trách nhiệm hủy liên kết giữa khách hàng và kênh đã hủy đăng ký.</p>
<h3>Ví dụ: Đăng ký kênh cụ thể</h3>
<p>Mở khách hàng thứ nhất và thực hiện các lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; SUBSCRIBE first second</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Reading</span><span style="color:#98C379;--shiki-dark:#98C379"> messages...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (press </span><span style="color:#98C379;--shiki-dark:#98C379">Ctrl-C</span><span style="color:#98C379;--shiki-dark:#98C379"> to</span><span style="color:#98C379;--shiki-dark:#98C379"> quit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"subscribe"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"first"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) 1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"subscribe"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"second"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) 2</span></span></code></pre>
</div><p>Mở khách hàng thứ hai và thực hiện lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; PUBLISH second Hello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span></span></code></pre>
</div><p>Lúc này, khách hàng thứ nhất sẽ nhận được thông báo sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"message"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"second"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"Hello"</span></span></code></pre>
</div><ol start="2">
<li><strong>Phát hành/Đăng ký dựa trên mẫu (Pattern-based Pub/Sub)</strong></li>
</ol>
<p>Trạng thái máy chủ trong Redis lưu giữ mối quan hệ đăng ký của tất cả các mẫu trong danh sách <code>pubsub_patterns</code>: Lệnh <code>PSUBSCRIBE</code> chịu trách nhiệm ghi lại khách hàng và mẫu đã đăng ký trong danh sách này, và lệnh <code>PUNSUBSCRIBE</code> thì chịu trách nhiệm loại bỏ ghi chép của khách hàng và mẫu đã hủy đăng ký khỏi danh sách.</p>
<h3>Ví dụ: Đăng ký các kênh phù hợp với mẫu cụ thể</h3>
<p>Mở khách hàng thứ nhất và thực hiện các lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; PSUBSCRIBE news.*</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">Reading</span><span style="color:#98C379;--shiki-dark:#98C379"> messages...</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF"> (press </span><span style="color:#98C379;--shiki-dark:#98C379">Ctrl-C</span><span style="color:#98C379;--shiki-dark:#98C379"> to</span><span style="color:#98C379;--shiki-dark:#98C379"> quit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"psubscribe"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"news.*"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) 1</span></span></code></pre>
</div><p>Mở khách hàng thứ hai và thực hiện lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; PUBLISH news.A Hello</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span></span></code></pre>
</div><p>Mở khách hàng thứ ba và thực hiện lệnh sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">&gt; PUBLISH news.B World</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"1"</span></span></code></pre>
</div><p>Lúc này, khách hàng thứ nhất sẽ nhận được các thông báo sau:</p>
<div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"pmessage"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"news.*"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"news.A"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"Hello"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"pmessage"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"news.*"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"news.B"</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF">) </span><span style="color:#98C379;--shiki-dark:#98C379">"World"</span></span></code></pre>
</div><h2>Các lệnh Phát hành/Đăng ký</h2>
<p>Redis cung cấp các lệnh sau liên quan đến phát hành/đăng ký:</p>
<p>| Lệnh                                                     | Mô tả                       |<br>
|</p>
]]></content:encoded>
      <enclosure url="https://d1.awsstatic.com/product-marketing/Messaging/sns_img_topic.e024462ec88e79ed63d690a2eed6e050e33fb36f.png" type="image/png"/>
    </item>
    <item>
      <title>Redis Replication</title>
      <link>https://vanhung4499.github.io/database/redis/replication.html</link>
      <guid>https://vanhung4499.github.io/database/redis/replication.html</guid>
      <source url="https://vanhung4499.github.io/rss.xml">Redis Replication</source>
      <description>Redis Replication Trong Redis, có thể sử dụng lệnh SLAVEOF hoặc cài đặt tùy chọn slaveof để sao chép (replicate) một máy chủ từ một máy chủ khác, trong đó máy chủ sau được gọi l...</description>
      <category>redis</category>
      <pubDate>Fri, 28 Jun 2024 15:54:38 GMT</pubDate>
      <content:encoded><![CDATA[
<blockquote>
<p>Trong Redis,&nbsp;<strong>có thể sử dụng lệnh&nbsp;<code>SLAVEOF</code>&nbsp;hoặc cài đặt tùy chọn&nbsp;<code>slaveof</code>&nbsp;để sao chép (replicate) một máy chủ từ một máy chủ khác</strong>, trong đó máy chủ sau được gọi là máy chủ chính (master) và máy chủ trước được gọi là máy chủ phụ (slave).</p>
<p>Sao chép Redis trước phiên bản 2.8 không xử lý hiệu quả việc sao chép lại sau khi mất kết nối, và một số cập nhật sau đó của Redis đã giải quyết vấn đề này.</p>
</blockquote>
<h2>1. Giới thiệu về sao chép</h2>
<p>Redis sử dụng lệnh&nbsp;<code>slaveof host port</code>&nbsp;để biến một máy chủ thành máy chủ phụ (slave) của một máy chủ khác (master).</p>
<p><strong>Một máy chủ chính (master) có thể có nhiều máy chủ phụ (slave)</strong>. Không chỉ máy chủ chính có thể có máy chủ phụ, mà máy chủ phụ cũng có thể có máy chủ phụ riêng của mình, và nhiều máy chủ phụ có thể tạo thành một chuỗi chính-phụ.</p>
<p><strong>Một máy chủ chỉ có thể có một máy chủ chính và không hỗ trợ sao chép giữa các máy chủ chính.</strong>.</p>
<p>Có thể sử dụng chức năng sao chép để giúp máy chủ chính không cần thực hiện hoạt động bền vững: Chỉ cần tắt chức năng bền vững trên máy chủ chính, sau đó cho phép máy chủ phụ thực hiện hoạt động bền vững.</p>
<p>Trong cài đặt sử dụng chức năng sao chép của Redis, rất khuyến nghị bật tính bền vững trên cả master và slave. Khi không bật tính năng này, ví dụ như gặp vấn đề trễ do hiệu suất ổ cứng rất chậm, <strong>bạn nên cấu hình các phiên bản để tránh tự động khởi động lại sau khi thiết lập lại</strong>.</p>
<p>Kể từ phiên bản Redis 2.6, máy chủ phụ hỗ trợ chế độ chỉ đọc và chế độ này là chế độ mặc định của máy chủ phụ.</p>
<ul>
<li>Chế độ chỉ đọc được điều khiển bằng tùy chọn&nbsp;<code>slave-read-only</code>&nbsp;trong tệp&nbsp;<code>redis.conf</code>, và cũng có thể được bật hoặc tắt chế độ này bằng lệnh&nbsp;<a href="http://redisdoc.com/configure/config_set.html#config-set" target="_blank" rel="noopener noreferrer">CONFIG SET parameter value</a>.</li>
<li>Máy chủ phụ chỉ đọc sẽ từ chối thực hiện bất kỳ lệnh ghi nào, do đó không có trường hợp dữ liệu được ghi vào máy chủ phụ vì lỗi thao tác.</li>
</ul>
<h2>2. Sao chép phiên bản cũ</h2>
<blockquote>
<p>Cách triển khai sao chép trước phiên bản Redis 2.8: Lệnh&nbsp;<code>SYNC</code></p>
</blockquote>
<p>Chức năng sao chép Redis được chia thành hai hoạt động: đồng bộ hóa (sync) và truyền lệnh (command propagate):</p>
<ul>
<li><strong><code>Đồng bộ hóa (sync)</code></strong>&nbsp;- Được sử dụng để cập nhật trạng thái cơ sở dữ liệu của máy chủ phụ với trạng thái cơ sở dữ liệu hiện tại của máy chủ chính.</li>
<li><strong><code>Truyền lệnh (command propagate)</code></strong>&nbsp;- Khi trạng thái cơ sở dữ liệu của máy chủ chính được sửa đổi, dẫn đến trạng thái không nhất quán giữa cơ sở dữ liệu chính và phụ, cho phép cơ sở dữ liệu chính và phụ trở lại trạng thái nhất quán.</li>
</ul>
<h3>Đồng bộ hóa</h3>
<p>Các bước thực hiện lệnh&nbsp;<code>SYNC</code>:</p>
<ol>
<li>Máy chủ phụ gửi lệnh&nbsp;<code>SYNC</code>&nbsp;đến máy chủ chính.</li>
<li>Máy chủ chính nhận lệnh&nbsp;<code>SYNC</code>&nbsp;và thực hiện lệnh&nbsp;<code>BGSAVE</code>&nbsp;để tạo tệp RDB trong nền và sử dụng một bộ đệm để ghi lại tất cả các lệnh ghi được thực hiện từ thời điểm này trở đi.</li>
<li>Sau khi máy chủ chính hoàn thành lệnh&nbsp;<code>BGSAVE</code>, máy chủ chính sẽ gửi tệp RDB đã tạo cho máy chủ phụ. Máy chủ phụ nhận và tải tệp RDB, cập nhật trạng thái cơ sở dữ liệu của mình.</li>
<li>Máy chủ chính gửi tất cả các lệnh ghi được ghi lại trong bộ đệm cho máy chủ phụ. Máy chủ phụ thực hiện các lệnh ghi này, cập nhật trạng thái cơ sở dữ liệu của mình.</li>
</ol>
<h3>Truyền lệnh</h3>
<p>Sau khi hoàn thành hoạt động đồng bộ hóa, trạng thái cơ sở dữ liệu của máy chủ chính và phụ sẽ trở nên nhất quán. Mỗi khi máy chủ chính thực hiện một lệnh ghi được gửi từ khách hàng, trạng thái cơ sở dữ liệu của máy chủ chính và phụ không còn nhất quán. Cần gửi các lệnh ghi cho máy chủ phụ để thực hiện, đảm bảo trạng thái cơ sở dữ liệu của cả hai trở lại nhất quán.</p>
<h3>Nhược điểm của sao chép phiên bản cũ</h3>
<p>Có hai trường hợp khi sao chép từ máy chủ chính sang máy chủ phụ:</p>
<ul>
<li><strong>Sao chép lần đầu</strong>&nbsp;- Máy chủ phụ chưa từng sao chép máy chủ chính trước đó.</li>
<li><strong>Sao chép sau khi mất kết nối</strong>&nbsp;- Máy chủ phụ và máy chủ chính trong quá trình truyền lệnh bị mất kết nối do vấn đề mạng, sau khi máy chủ phụ kết nối lại với máy chủ chính, tiếp tục sao chép từ máy chủ chính.</li>
</ul>
<p>Đối với sao chép lần đầu, chức năng sao chép phiên bản cũ hoạt động tốt; tuy nhiên,&nbsp;<strong>đối với sao chép sau khi mất kết nối, hiệu suất rất thấp do việc tạo và truyền RDB mỗi lần</strong>.</p>
<blockquote>
<p>🔔 Lưu ý:&nbsp;<strong>Lệnh SYNC là một hoạt động tốn nhiều tài nguyên</strong>.</p>
<ul>
<li>Máy chủ chính thực hiện lệnh&nbsp;<code>BGSAVE</code>&nbsp;để tạo tệp RDB, hoạt động này tốn nhiều tài nguyên CPU, bộ nhớ và I/O đĩa của máy chủ chính.</li>
<li>Máy chủ chính truyền tệp RDB cho máy chủ phụ, hoạt động này tốn nhiều tài nguyên mạng của cả máy chủ chính và phụ và ảnh hưởng đến thời gian phản hồi của máy chủ chính.</li>
<li>Trong quá trình máy chủ phụ tải tệp RDB, các lệnh yêu cầu khác bị chặn.</li>
</ul>
</blockquote>
<h2>3. Sao chép phiên bản mới</h2>
<blockquote>
<p>Cách triển khai mới sau phiên bản Redis 2.8: Sử dụng lệnh&nbsp;<code>PSYNC</code>&nbsp;thay thế lệnh&nbsp;<code>SYNC</code>.</p>
</blockquote>
<p>Lệnh&nbsp;<code>PSYNC</code>&nbsp;có hai chế độ: đồng bộ hoàn toàn (full resynchronization) và đồng bộ một phần (partial resynchronization):</p>
<ul>
<li><strong><code>Đồng bộ hoàn toàn (full resynchronization)</code></strong>&nbsp;- Được sử dụng cho sao chép lần đầu. Các bước thực hiện tương tự như lệnh&nbsp;<code>SYNC</code>.</li>
<li><strong><code>Đồng bộ một phần (partial resynchronization)</code></strong>&nbsp;- Được sử dụng cho sao chép sau khi mất kết nối.&nbsp;<strong>Nếu điều kiện cho phép, máy chủ chính có thể gửi các lệnh ghi được thực hiện trong quá trình ngắt kết nối cho máy chủ phụ</strong>, máy chủ phụ chỉ cần nhận và thực hiện các lệnh ghi này để duy trì trạng thái cơ sở dữ liệu của máy chủ chính và phụ nhất quán.</li>
</ul>
<h3>Đồng bộ một phần</h3>
<p>Chức năng đồng bộ một phần bao gồm ba phần:</p>
<ul>
<li><strong>Offset sao chép</strong>&nbsp;của máy chủ chính và máy chủ phụ.</li>
<li><strong>Bộ đệm chờ sao chép</strong>&nbsp;của máy chủ chính.</li>
<li><strong>ID chạy của máy chủ</strong>.</li>
</ul>
<h4>Offset sao chép</h4>
<p>Máy chủ chính và máy chủ phụ sẽ duy trì một offset sao chép riêng biệt.</p>
<ul>
<li>Nếu offset sao chép của máy chủ chính và máy chủ phụ giống nhau, điều đó có nghĩa là trạng thái cơ sở dữ liệu của hai máy chủ là nhất quán;</li>
<li>Ngược lại, nếu offset sao chép không giống nhau, điều đó có nghĩa là trạng thái cơ sở dữ liệu của hai máy chủ không nhất quán.</li>
</ul>
<h4>Bộ đệm chờ sao chép</h4>
<p><strong>Bộ đệm chờ sao chép là một hàng đợi FIFO có độ dài cố định được duy trì bởi máy chủ chính</strong>, kích thước mặc định là&nbsp;<code>1MB</code>.</p>
<p>Bộ đệm chờ sao chép sẽ lưu trữ một phần lệnh ghi gần đây đã truyền và bộ đệm chờ sao chép sẽ ghi lại offset sao chép tương ứng cho mỗi byte trong hàng đợi.</p>
<p>Khi máy chủ phụ kết nối lại với máy chủ chính sau khi mất kết nối, máy chủ phụ sẽ gửi lệnh&nbsp;<code>PSYNC</code>&nbsp;với offset sao chép của chính nó cho máy chủ chính, máy chủ chính sẽ dựa trên offset này để quyết định thực hiện hoạt động đồng bộ nào với máy chủ phụ.</p>
<ul>
<li>Nếu dữ liệu sau offset vẫn còn trong bộ đệm chờ sao chép, máy chủ chính sẽ thực hiện đồng bộ một phần với máy chủ phụ.</li>
<li>Ngược lại, máy chủ chính sẽ thực hiện đồng bộ hoàn toàn với máy chủ phụ.</li>
</ul>
<blockquote>
<p>🔔 Lưu ý:&nbsp;<strong>Điều chỉnh kích thước bộ đệm chờ sao chép một cách hợp lý</strong></p>
<ul>
<li>
<p>Kích thước mặc định của bộ đệm chờ sao chép Redis là&nbsp;<code>1MB</code>.</p>
</li>
<li>
<p>Kích thước tối thiểu của bộ đệm chờ sao chép có thể được ước tính bằng công thức&nbsp;<code>second * write_size_per_second</code>.</p>
</li>
</ul>
</blockquote>
<h4>ID chạy của máy chủ</h4>
<ul>
<li>Mỗi máy chủ Redis có một ID chạy để xác định duy nhất.</li>
<li>ID chạy được tạo tự động khi máy chủ khởi động, bao gồm 40 ký tự thập lục phân ngẫu nhiên. Ví dụ: 132e358005e29741f8d7b0a42d666aace286edda</li>
</ul>
<p>Khi máy chủ phụ sao chép lần đầu từ máy chủ chính, máy chủ chính sẽ gửi ID chạy của chính nó cho máy chủ phụ và máy chủ phụ sẽ lưu trữ ID chạy này.</p>
<p>Khi máy chủ phụ kết nối lại với máy chủ chính, máy chủ phụ sẽ gửi ID chạy đã lưu trữ trước đó:</p>
<ul>
<li>Nếu ID chạy đã lưu trữ và ID chạy hiện tại của máy chủ chính giống nhau, điều đó có nghĩa là máy chủ phụ đã kết nối với máy chủ chính trước đó, máy chủ chính sẽ tiếp tục thử nghiệm đồng bộ một phần;</li>
<li>Ngược lại, nếu ID chạy không khớp, điều đó có nghĩa là máy chủ phụ không kết nối với máy chủ chính trước đó, máy chủ chính sẽ thực hiện đồng bộ hoàn toàn với máy chủ phụ.</li>
</ul>
<h3>Lệnh PSYNC</h3>
<p>Sau khi hiểu cách triển khai đồng bộ một phần, việc hiểu cách thực hiện lệnh PSYNC sẽ dễ dàng hơn, nguyên tắc hoạt động cơ bản của nó như sau:</p>
<p>Khi máy chủ phụ nhận được lệnh&nbsp;<code>SLAVEOF</code>, trước tiên kiểm tra xem máy chủ phụ đã sao chép từ máy chủ trước đó hay chưa.</p>
<ul>
<li>Nếu máy chủ phụ chưa sao chép từ bất kỳ máy chủ chính nào trước đó, nó sẽ gửi lệnh&nbsp;<code>PSYNC ? -1</code>&nbsp;đến máy chủ chính, yêu cầu đồng bộ hoàn toàn.</li>
<li>Ngược lại, nó sẽ gửi lệnh&nbsp;<code>PSYNC &lt;runid&gt; &lt;offset&gt;</code>&nbsp;đến máy chủ chính.
<ul>
<li><code>runid</code>&nbsp;là ID chạy của máy chủ chính trong lần sao chép trước đó.</li>
<li><code>offset</code>&nbsp;là offset sao chép.</li>
</ul>
</li>
</ul>
<p>Máy chủ chính nhận được lệnh&nbsp;<code>PSYNC &lt;runid&gt; &lt;offset&gt;</code>&nbsp;sẽ thực hiện phân tích:</p>
<ul>
<li>Nếu <strong>ID chạy của máy chủ chính và máy chủ phụ giống nhau và offset được chỉ định vẫn còn hiệu lực trong bộ đệm chờ sao chép</strong>, điều đó có nghĩa là máy chủ chính sẽ tiếp tục thực hiện đồng bộ một phần với máy chủ phụ.</li>
<li>Nếu không thỏa mãn một trong hai điều kiện trên, máy chủ chính sẽ thực hiện đồng bộ toàn bộ với máy chủ phụ.</li>
</ul>
<h2>4. Kiểm tra nhịp tim</h2>
<p>Trong giai đoạn <strong>truyền lệnh</strong>, máy chủ từ xa mặc định sẽ gửi lệnh đến máy chủ chính một lần mỗi giây:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>REPLCONF ACK &lt;replication_offset&gt;</span></span></code></pre>
</div><p>Trong đó, <code>replication_offset</code> là vị trí sao chép hiện tại của máy chủ từ xa.</p>
<p>Gửi lệnh <code>REPLCONF ACK</code> có ba tác dụng đối với máy chủ chính và máy chủ phụ:</p>
<ul>
<li>Kiểm tra trạng thái kết nối mạng giữa máy chủ chính và máy chủ phụ.</li>
<li>Hỗ trợ thực hiện tùy chọn min-slaves.</li>
<li>Kiểm tra việc mất lệnh.</li>
</ul>
<h3>Kiểm tra trạng thái kết nối giữa máy chủ chính và máy chủ phụ</h3>
<p><strong>Có thể kiểm tra xem kết nối mạng giữa máy chủ chính và máy chủ phụ có bình thường hay không</strong> bằng cách gửi và nhận lệnh <code>REPLCONF ACK</code>: Nếu máy chủ chính không nhận được lệnh <code>REPLCONF ACK</code> từ máy chủ phụ trong hơn một giây, máy chủ chính sẽ biết rằng có vấn đề về kết nối giữa máy chủ chính và máy chủ phụ.</p>
<p>Có thể sử dụng lệnh <code>INFO replication</code> để gửi đến máy chủ chính và xem trong cột lag của danh sách máy chủ phụ, thời gian đã trôi qua kể từ khi máy chủ phụ gửi lệnh <code>REPLCONF ACK</code> đến máy chủ chính.</p>
<h3>Hỗ trợ thực hiện tùy chọn min-slaves</h3>
<p>Tùy chọn <code>min-slaves-to-write</code> và <code>min-slaves-max-lag</code> trong Redis giúp ngăn máy chủ chính thực hiện lệnh ghi trong trường hợp không an toàn.</p>
<p>【Ví dụ】Cấu hình min-slaves</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>min-slaves-to-write 3</span></span>
<span class="line"><span>min-slaves-max-lag 10</span></span></code></pre>
</div><p>Cấu hình trên đại diện cho: Nếu số lượng máy chủ phụ nhỏ hơn 3 hoặc độ trễ của ba máy chủ phụ lớn hơn hoặc bằng 10 giây, máy chủ chính sẽ từ chối thực hiện lệnh ghi.</p>
<h3>Kiểm tra việc mất lệnh</h3>
<p>Nếu do sự cố mạng, các lệnh ghi mà máy chủ chính truyền cho máy chủ phụ bị mất, khi máy chủ phụ gửi lệnh <code>REPLCONF ACK</code> định kỳ đến máy chủ chính, máy chủ chính sẽ nhận ra rằng vị trí sao chép của máy chủ phụ ít hơn của chính nó. Sau đó, máy chủ chính sẽ tìm các dữ liệu mà máy chủ phụ thiếu trong bộ đệm sao chép và gửi lại cho máy chủ phụ dựa trên vị trí sao chép mà máy chủ phụ đã gửi.</p>
<h2>5. Quy trình sao chép</h2>
<p>Bằng cách gửi lệnh SLAVEOF như sau đến máy chủ phụ, bạn có thể sao chép máy chủ chính.</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>SLAVEOF &lt;master_ip&gt; &lt;master_port&gt;</span></span></code></pre>
</div><h3>Bước 1. Cấu hình máy chủ chính và máy chủ phụ</h3>
<p>Cấu hình máy chủ phụ rất đơn giản, chỉ cần thêm dòng sau vào tệp cấu hình:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>slaveof 127.0.0.1 6379</span></span></code></pre>
</div><p>Tất nhiên, bạn cần thay thế <code>127.0.0.1</code> và <code>6379</code> trong mã bằng IP và cổng của máy chủ chính của bạn.</p>
<p>Một cách khác là sử dụng lệnh <a href="https://redis.io/commands/slaveof/" target="_blank" rel="noopener noreferrer">SLAVEOF host port</a>, nhập IP và cổng của máy chủ chính, sau đó đồng bộ hóa sẽ bắt đầu:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>127.0.0.1:6379&gt; SLAVEOF 127.0.0.1 10086</span></span>
<span class="line"><span>OK</span></span></code></pre>
</div><h3>Bước 2. Thiết lập kết nối TCP giữa máy chủ chính và máy chủ phụ.</h3>
<h3>Bước 3. Gửi PING để kiểm tra trạng thái giao tiếp.</h3>
<h3>Bước 4. Xác thực.</h3>
<p>Nếu máy chủ chính không thiết lập <code>requirepass</code>, máy chủ phụ không thiết lập <code>masterauth</code>, thì không cần xác thực; ngược lại, cần xác thực. Nếu xác thực không thành công, quá trình sao chép sẽ bị hủy bỏ.</p>
<p>Nếu máy chủ chính đã đặt mật khẩu thông qua tùy chọn <code>requirepass</code>, để đảm bảo quá trình đồng bộ hóa máy chủ phụ diễn ra suôn sẻ, chúng ta cũng phải thiết lập xác thực tương ứng cho máy chủ phụ.</p>
<p>Đối với một máy chủ đang chạy, bạn có thể sử dụng lệnh sau đây trên khách hàng:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>config set masterauth &lt;password&gt;</span></span></code></pre>
</div><p>Để thiết lập mật khẩu này vĩnh viễn, bạn có thể thêm nó vào tệp cấu hình:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>masterauth &lt;password&gt;</span></span></code></pre>
</div><p>Ngoài ra, còn một số tùy chọn khác liên quan đến bộ đệm luồng sao chép được sử dụng khi máy chủ chính thực hiện đồng bộ hóa một phần, chi tiết có thể tham khảo tệp <code>redis.conf</code> đi kèm với mã nguồn Redis.</p>
<h3>Bước 5. Gửi thông tin cổng.</h3>
<p>máy chủ phụ thực hiện <code>REPLCONF listening-port &lt;port-number&gt;</code>, gửi số cổng lắng nghe của máy chủ phụ đến máy chủ chính.</p>
<h3>Bước 6. Đồng bộ hóa.</h3>
<p>Đã được giới thiệu trước đó, không lặp lại ở đây.</p>
<h3>Bước 7. Truyền lệnh.</h3>
<p>Trong giai đoạn truyền lệnh, máy chủ phụ mặc định sẽ gửi lệnh đến máy chủ chính mỗi giây một lần:</p>
<div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf" tabindex="0"><code><span class="line"><span>REPLCONF ACK &lt;replication_coffset&gt;</span></span></code></pre>
</div><p>Các lệnh có tác dụng:</p>
<ul>
<li>Kiểm tra trạng thái kết nối mạng giữa máy chủ chính và máy chủ phụ.</li>
<li>Hỗ trợ thực hiện tùy chọn min-slave.</li>
<li>Kiểm tra việc mất lệnh.</li>
</ul>
<h2>6. Các tùy chọn cấu hình sao chép</h2>
<p>Từ Redis 2.8 trở đi, để đảm bảo tính an toàn của dữ liệu, bạn có thể cấu hình để máy chủ chính chỉ thực hiện lệnh ghi khi có ít nhất N máy chủ con đang kết nối.</p>
<p>Tuy nhiên, vì Redis sử dụng sao chép bất đồng bộ, nên dữ liệu ghi mà máy chủ chính gửi không nhất thiết sẽ được máy chủ con nhận được, do đó, khả năng mất dữ liệu vẫn tồn tại.</p>
<p>Dưới đây là cách hoạt động của tính năng này:</p>
<ul>
<li>Máy chủ con gửi lệnh PING đến máy chủ chính mỗi giây một lần và báo cáo tình trạng xử lý luồng sao chép.</li>
<li>Máy chủ chính ghi lại thời gian máy chủ con cuối cùng gửi lệnh PING đến nó.</li>
<li>Người dùng có thể cấu hình giá trị tối đa của độ trễ mạng <code>min-slaves-max-lag</code> và số lượng tối thiểu máy chủ con cần để thực hiện lệnh ghi <code>min-slaves-to-write</code>.</li>
</ul>
<p>Nếu có ít nhất <code>min-slaves-to-write</code> máy chủ con và tất cả các máy chủ con này có độ trễ nhỏ hơn <code>min-slaves-max-lag</code> giây, máy chủ chính sẽ thực hiện lệnh ghi được yêu cầu từ khách hàng.</p>
<p>Bạn có thể coi tính năng này như một phiên bản nới lỏng điều kiện C trong lý thuyết CAP: Mặc dù không đảm bảo tính bền vững của lệnh ghi, nhưng ít nhất cửa sổ mất dữ liệu sẽ được giới hạn chặt chẽ trong số giây được chỉ định.</p>
<p>Mặt khác, nếu không đáp ứng được các điều kiện được chỉ định bởi <code>min-slaves-to-write</code> và <code>min-slaves-max-lag</code>, lệnh ghi sẽ không được thực hiện và máy chủ chính sẽ trả về một lỗi cho khách hàng yêu cầu thực hiện lệnh ghi.</p>
<p>Dưới đây là hai tùy chọn của tính năng này và các tham số cần thiết cho chúng:</p>
<ul>
<li><code>min-slaves-to-write &lt;số lượng máy chủ con&gt;</code></li>
<li><code>min-slaves-max-lag &lt;số giây&gt;</code></li>
</ul>
<p>Thông tin chi tiết có thể được tham khảo trong tệp <code>redis.conf</code> đi kèm với mã nguồn Redis.</p>
]]></content:encoded>
    </item>
  </channel>
</rss>