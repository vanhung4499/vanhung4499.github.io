<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/framework/spring/data/transaction.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="Spring Transaction"><meta property="og:description" content="Spring v√† Transaction Spring ƒë√£ tri·ªÉn khai m·ªôt m√¥ h√¨nh l·∫≠p tr√¨nh nh·∫•t qu√°n cho c√°c API giao d·ªãch nh∆∞ Java Transaction API (JTA), JDBC, Hibernate v√† Java Persistence API (JPA). C..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220922073737.png"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-06-28T15:54:38.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:tag" content="spring"><meta property="article:tag" content="java"><meta property="article:tag" content="db"><meta property="article:tag" content="backend"><meta property="article:modified_time" content="2024-06-28T15:54:38.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Spring Transaction","image":["https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220922073737.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220928114544.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220928115243.png"],"dateModified":"2024-06-28T15:54:38.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>Spring Transaction | VanHung4499</title><meta name="description" content="Spring v√† Transaction Spring ƒë√£ tri·ªÉn khai m·ªôt m√¥ h√¨nh l·∫≠p tr√¨nh nh·∫•t qu√°n cho c√°c API giao d·ªãch nh∆∞ Java Transaction API (JTA), JDBC, Hibernate v√† Java Persistence API (JPA). C...">
    <link rel="preload" href="/assets/style-DFXXOFfS.css" as="style"><link rel="stylesheet" href="/assets/style-DFXXOFfS.css">
    <link rel="modulepreload" href="/assets/app-CmlOSuIY.js"><link rel="modulepreload" href="/assets/transaction.html-CDjDB8iD.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon>Project<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/rouyi-vue-pro/" aria-label="Rouyi Vue Pro"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Rouyi Vue Pro<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/yudao-cloud/" aria-label="Yudao Cloud"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Yudao Cloud<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interview/" aria-label="Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:account-tie" width="1em" height="1em"></iconify-icon><!--]-->Interview<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Overview</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Core</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Data</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/framework/spring/data/data-source.html" aria-label="Spring Data Source"><!---->Spring Data Source<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/framework/spring/data/jdbc.html" aria-label="Spring JDBC"><!---->Spring JDBC<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/framework/spring/data/transaction.html" aria-label="Spring Transaction"><!---->Spring Transaction<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/framework/spring/data/jpa.html" aria-label="Spring JPA"><!---->Spring JPA<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/framework/spring/data/mybatis.html" aria-label="Spring and Mybatis"><!---->Spring and Mybatis<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/framework/spring/data/integration.html" aria-label="Spring Data Integration"><!---->Spring Data Integration<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/framework/spring/data/redis.html" aria-label="Spring Access Redis"><!---->Spring Access Redis<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/framework/spring/data/mongodb.html" aria-label="Spring Access MongoDB"><!---->Spring Access MongoDB<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/framework/spring/data/elasticsearch.html" aria-label="Spring Access ElasticSearch"><!---->Spring Access ElasticSearch<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Web</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">IO</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Intergration</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Security</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Spring Transaction</h1><div class="page-info"><span class="page-author-info" aria-label="Authorüñä" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing DateüìÖ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-28T15:54:38.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time‚åõ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 50 min</span><meta property="timeRequired" content="PT50M"></span><span class="page-category-info" aria-label="Categoryüåà" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color8 clickable" role="navigation">spring</span><span class="page-category-item color8 clickable" role="navigation">java</span><span class="page-category-item color5 clickable" role="navigation">db</span><span class="page-category-item color8 clickable" role="navigation">backend</span><!--]--><meta property="articleSection" content="spring,java,db,backend"></span><span class="page-tag-info" aria-label="Tagüè∑" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">spring</span><span class="page-tag-item color8 clickable" role="navigation">java</span><span class="page-tag-item color5 clickable" role="navigation">db</span><span class="page-tag-item color8 clickable" role="navigation">backend</span><!--]--><meta property="keywords" content="spring,java,db,backend"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#hieu-ve-giao-dich">Hi·ªÉu v·ªÅ giao d·ªãch</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ƒëac-ƒëiem-cua-giao-dich">ƒê·∫∑c ƒëi·ªÉm c·ªßa giao d·ªãch</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#giao-dich-toan-cau">Giao d·ªãch to√†n c·∫ßu</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#giao-dich-cuc-bo">Giao d·ªãch c·ª•c b·ªô</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ho-tro-giao-dich-cua-spring">H·ªó tr·ª£ giao d·ªãch c·ªßa Spring</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#loi-ich-cua-spring-transaction">L·ª£i √≠ch c·ªßa Spring Transaction</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cac-api-cot-loi">C√°c API c·ªët l√µi</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#transactionmanager">TransactionManager</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#transactiondefinition">TransactionDefinition</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#transactionstatus">TransactionStatus</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#transactiontemplate">TransactionTemplate</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#quan-ly-giao-dich-theo-cach-khai-bao">Qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trien-khai-quan-ly-giao-dich-theo-cach-khai-bao-cua-spring">Tri·ªÉn khai qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o c·ªßa Spring</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#vi-du-ve-quan-ly-giao-dich-theo-cach-khai-bao">V√≠ d·ª• v·ªÅ qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#rollback-trong-mot-giao-dich-khai-bao">Rollback trong m·ªôt giao d·ªãch khai b√°o</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cau-hinh-ngu-canh-giao-dich-khac-nhau-cho-cac-bean-khac-nhau">C·∫•u h√¨nh ng·ªØ c·∫£nh giao d·ªãch kh√°c nhau cho c√°c Bean kh√°c nhau</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cau-hinh-tx-advice">C·∫•u h√¨nh &lt;tx:advice/&gt;</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#su-dung-chu-thich-transactional">S·ª≠ d·ª•ng ch√∫ th√≠ch @Transactional</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#truu-tuong-hoa-ngoai-le-jdbc">Tr·ª´u t∆∞·ª£ng h√≥a ngo·∫°i l·ªá JDBC</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#thuc-hanh-tot-nhat-ve-giao-dich-trong-spring">Th·ª±c h√†nh t·ªët nh·∫•t v·ªÅ giao d·ªãch trong Spring</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#transactional-khong-hoat-ƒëong-trong-spring">Transactional kh√¥ng ho·∫°t ƒë·ªông trong Spring</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#giao-dich-ƒëuoc-ap-dung-nhung-khong-ƒëuoc-hoan-tac">Giao d·ªãch ƒë∆∞·ª£c √°p d·ª•ng nh∆∞ng kh√¥ng ƒë∆∞·ª£c ho√†n t√°c</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tinh-chinh-cach-truyen-giao-dich">Tinh ch·ªânh c√°ch truy·ªÅn giao d·ªãch</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="spring-va-transaction" tabindex="-1"><a class="header-anchor" href="#spring-va-transaction"><span>Spring v√† Transaction</span></a></h1><p>Spring ƒë√£ tri·ªÉn khai m·ªôt m√¥ h√¨nh l·∫≠p tr√¨nh nh·∫•t qu√°n cho c√°c API giao d·ªãch nh∆∞ Java Transaction API (JTA), JDBC, Hibernate v√† Java Persistence API (JPA). Ch·ª©c nƒÉng giao d·ªãch khai b√°o c·ªßa Spring cung c·∫•p m·ªôt c√°ch c·∫•u h√¨nh giao d·ªãch r·∫•t ti·ªán l·ª£i. K·∫øt h·ª£p v·ªõi c·∫•u h√¨nh t·ª± ƒë·ªông c·ªßa Spring Boot, h·∫ßu h·∫øt c√°c d·ª± √°n Spring Boot ch·ªâ c·∫ßn ƒë√°nh d·∫•u ph∆∞∆°ng th·ª©c v·ªõi¬†<code>@Transactional</code>¬†ƒë·ªÉ k√≠ch ho·∫°t c·∫•u h√¨nh giao d·ªãch cho ph∆∞∆°ng th·ª©c ƒë√≥.</p><h2 id="hieu-ve-giao-dich" tabindex="-1"><a class="header-anchor" href="#hieu-ve-giao-dich"><span>Hi·ªÉu v·ªÅ giao d·ªãch</span></a></h2><p>Trong lƒ©nh v·ª±c ph√°t tri·ªÉn ph·∫ßn m·ªÅm, <strong>giao d·ªãch (transaction)</strong> l√† m·ªôt t·∫≠p h·ª£p c√°c ho·∫°t ƒë·ªông ho·∫∑c thao t√°c m√† ho√†n to√†n ho·∫∑c kh√¥ng ho√†n to√†n ƒë∆∞·ª£c th·ª±c thi. Giao d·ªãch cho ph√©p b·∫°n k·∫øt h·ª£p m·ªôt s·ªë ho·∫°t ƒë·ªông th√†nh m·ªôt ƒë∆°n v·ªã c√¥ng vi·ªác m√† ho·∫∑c l√† x·∫£y ra ho√†n to√†n ho·∫∑c kh√¥ng x·∫£y ra g√¨ c·∫£. Truy·ªÅn th·ªëng, ph√°t tri·ªÉn Java EE c√≥ hai l·ª±a ch·ªçn cho qu·∫£n l√Ω giao d·ªãch:¬†<strong>giao d·ªãch to√†n c·∫ßu</strong> ho·∫∑c¬†<strong>giao d·ªãch c·ª•c b·ªô</strong>, c·∫£ hai ƒë·ªÅu c√≥ h·∫°n ch·∫ø l·ªõn.</p><h3 id="ƒëac-ƒëiem-cua-giao-dich" tabindex="-1"><a class="header-anchor" href="#ƒëac-ƒëiem-cua-giao-dich"><span>ƒê·∫∑c ƒëi·ªÉm c·ªßa giao d·ªãch</span></a></h3><p>Giao d·ªãch n√™n c√≥ 4 thu·ªôc t√≠nh: nguy√™n t·ª≠, nh·∫•t qu√°n, c√¥ l·∫≠p v√† b·ªÅn v·ªØng. B·ªën thu·ªôc t√≠nh n√†y th∆∞·ªùng ƒë∆∞·ª£c g·ªçi l√† <strong>ACID</strong>.</p><ul><li><strong>Nguy√™n t·ª≠ (Atomic)</strong>: M·ªôt giao d·ªãch l√† m·ªôt ƒë∆°n v·ªã c√¥ng vi·ªác kh√¥ng th·ªÉ chia r·∫Ω, c√°c ho·∫°t ƒë·ªông bao g·ªìm trong giao d·ªãch ph·∫£i ƒë∆∞·ª£c th·ª±c hi·ªán ho√†n to√†n ho·∫∑c kh√¥ng th·ª±c hi·ªán g√¨ c·∫£.</li><li><strong>Nh·∫•t qu√°n (Consistent)</strong>: Giao d·ªãch ph·∫£i l√†m cho c∆° s·ªü d·ªØ li·ªáu chuy·ªÉn t·ª´ m·ªôt tr·∫°ng th√°i nh·∫•t qu√°n sang m·ªôt tr·∫°ng th√°i nh·∫•t qu√°n kh√°c. Nh·∫•t qu√°n v√† nguy√™n t·ª≠ li√™n quan ch·∫∑t ch·∫Ω v·ªõi nhau.</li><li><strong>C√¥ l·∫≠p (Isolated)</strong>: Vi·ªác th·ª±c hi·ªán m·ªôt giao d·ªãch kh√¥ng th·ªÉ b·ªã c√°c giao d·ªãch kh√°c can thi·ªáp. Nghƒ©a l√† c√°c ho·∫°t ƒë·ªông v√† d·ªØ li·ªáu s·ª≠ d·ª•ng trong m·ªôt giao d·ªãch ƒë·ªëi v·ªõi c√°c giao d·ªãch kh√°c ƒëang x·∫£y ra ƒë·ªìng th·ªùi l√† c√¥ l·∫≠p, c√°c giao d·ªãch ƒëang th·ª±c hi·ªán ƒë·ªìng th·ªùi v·ªõi nhau kh√¥ng th·ªÉ can thi·ªáp l·∫´n nhau.</li><li><strong>B·ªÅn v·ªØng (Durable)</strong>: B·ªÅn v·ªØng c√≤n ƒë∆∞·ª£c g·ªçi l√† vƒ©nh c·ª≠u (permanence), ch·ªâ r·∫±ng m·ªôt giao d·ªãch ƒë√£ ƒë∆∞·ª£c x√°c nh·∫≠n th√¨ s·ª± thay ƒë·ªïi d·ªØ li·ªáu trong c∆° s·ªü d·ªØ li·ªáu ph·∫£i l√† vƒ©nh vi·ªÖn. C√°c ho·∫°t ƒë·ªông ho·∫∑c s·ª± c·ªë ti·∫øp theo kh√¥ng ƒë∆∞·ª£c ·∫£nh h∆∞·ªüng ƒë·∫øn n√≥.</li></ul><h3 id="giao-dich-toan-cau" tabindex="-1"><a class="header-anchor" href="#giao-dich-toan-cau"><span>Giao d·ªãch to√†n c·∫ßu</span></a></h3><p>Giao d·ªãch to√†n c·∫ßu cho ph√©p b·∫°n s·ª≠ d·ª•ng nhi·ªÅu ngu·ªìn t√†i nguy√™n giao d·ªãch, th∆∞·ªùng l√† c∆° s·ªü d·ªØ li·ªáu quan h·ªá v√† h√†ng ƒë·ª£i tin nh·∫Øn. M√°y ch·ªß ·ª©ng d·ª•ng qu·∫£n l√Ω giao d·ªãch to√†n c·∫ßu th√¥ng qua JTA, m·ªôt API ph·ª©c t·∫°p (m·ªôt ph·∫ßn v√¨ m√¥ h√¨nh ngo·∫°i l·ªá c·ªßa n√≥). Ngo√†i ra, UserTransaction c·ªßa JTA th∆∞·ªùng c·∫ßn ƒë∆∞·ª£c l·∫•y t·ª´ JNDI, ƒëi·ªÅu n√†y c√≥ nghƒ©a l√† b·∫°n c≈©ng c·∫ßn s·ª≠ d·ª•ng JNDI ƒë·ªÉ s·ª≠ d·ª•ng JTA. S·ª≠ d·ª•ng giao d·ªãch to√†n c·∫ßu h·∫°n ch·∫ø b·∫•t k·ª≥ kh·∫£ nƒÉng t√°i s·ª≠ d·ª•ng m√£ ·ª©ng d·ª•ng n√†o, v√¨ JTA th∆∞·ªùng ch·ªâ c√≥ s·∫µn trong m√¥i tr∆∞·ªùng m√°y ch·ªß ·ª©ng d·ª•ng.</p><p>Tr∆∞·ªõc ƒë√¢y, c√°ch ∆∞u ti√™n ƒë·ªÉ s·ª≠ d·ª•ng giao d·ªãch to√†n c·∫ßu l√† th√¥ng qua EJB CMT (Container-Managed Transactions). CMT l√† m·ªôt qu·∫£n l√Ω giao d·ªãch d·ª±a tr√™n khai b√°o (kh√°c v·ªõi qu·∫£n l√Ω giao d·ªãch theo ch∆∞∆°ng tr√¨nh). EJB CMT lo·∫°i b·ªè nhu c·∫ßu t√¨m ki·∫øm JNDI li√™n quan ƒë·∫øn giao d·ªãch, m·∫∑c d√π vi·ªác s·ª≠ d·ª•ng EJB c≈©ng ƒë√≤i h·ªèi s·ª≠ d·ª•ng JNDI. N√≥ lo·∫°i b·ªè ph·∫ßn l·ªõn (nh∆∞ng kh√¥ng ph·∫£i t·∫•t c·∫£) vi·ªác vi·∫øt m√£ Java ƒë·ªÉ ƒëi·ªÅu khi·ªÉn giao d·ªãch. Nh∆∞·ª£c ƒëi·ªÉm r√µ r√†ng c·ªßa n√≥ l√† CMT li√™n quan ƒë·∫øn JTA v√† m√¥i tr∆∞·ªùng m√°y ch·ªß ·ª©ng d·ª•ng. Ngo√†i ra, n√≥ ch·ªâ c√≥ s·∫µn khi b·∫°n ch·ªçn tri·ªÉn khai logic kinh doanh trong EJB (ho·∫∑c √≠t nh·∫•t l√† sau m·ªôt c√°i nh√¨n EJB c√≥ t√≠nh giao d·ªãch). N√≥i chung, t√°c ƒë·ªông ti√™u c·ª±c c·ªßa EJB l√† qu√° l·ªõn ƒë·∫øn n·ªói ƒë·ªÅ xu·∫•t n√†y kh√¥ng h·∫•p d·∫´n, ƒë·∫∑c bi·ªát l√† khi c√≥ nh·ªØng gi·∫£i ph√°p thay th·∫ø quy·ªÅn l·ª±c cho qu·∫£n l√Ω giao d·ªãch d·ª±a tr√™n khai b√°o.</p><h3 id="giao-dich-cuc-bo" tabindex="-1"><a class="header-anchor" href="#giao-dich-cuc-bo"><span>Giao d·ªãch c·ª•c b·ªô</span></a></h3><p>Giao d·ªãch c·ª•c b·ªô l√† giao d·ªãch ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh cho m·ªôt ngu·ªìn t√†i nguy√™n c·ª• th·ªÉ, ch·∫≥ng h·∫°n nh∆∞ giao d·ªãch qu·∫£n l√Ω k·∫øt n·ªëi JDBC. Giao d·ªãch c·ª•c b·ªô c√≥ th·ªÉ d·ªÖ d√†ng s·ª≠ d·ª•ng h∆°n, nh∆∞ng c√≥ m·ªôt nh∆∞·ª£c ƒëi·ªÉm r√µ r√†ng: ch√∫ng kh√¥ng th·ªÉ l√†m vi·ªác qua nhi·ªÅu ngu·ªìn t√†i nguy√™n giao d·ªãch. V√≠ d·ª•, m√£ qu·∫£n l√Ω giao d·ªãch s·ª≠ d·ª•ng k·∫øt n·ªëi JDBC kh√¥ng th·ªÉ ch·∫°y trong m·ªôt giao d·ªãch JTA to√†n c·∫ßu. V√¨ m√°y ch·ªß ·ª©ng d·ª•ng kh√¥ng tham gia qu·∫£n l√Ω giao d·ªãch, n√≥ kh√¥ng th·ªÉ ƒë·∫£m b·∫£o t√≠nh ch√≠nh x√°c qua nhi·ªÅu ngu·ªìn t√†i nguy√™n (ƒë√°ng l∆∞u √Ω l√† h·∫ßu h·∫øt c√°c ·ª©ng d·ª•ng ch·ªâ s·ª≠ d·ª•ng m·ªôt ngu·ªìn t√†i nguy√™n giao d·ªãch). M·ªôt nh∆∞·ª£c ƒëi·ªÉm kh√°c l√† giao d·ªãch c·ª•c b·ªô c√≥ s·ª± x√¢m nh·∫≠p v√†o m√¥ h√¨nh l·∫≠p tr√¨nh.</p><h3 id="ho-tro-giao-dich-cua-spring" tabindex="-1"><a class="header-anchor" href="#ho-tro-giao-dich-cua-spring"><span>H·ªó tr·ª£ giao d·ªãch c·ªßa Spring</span></a></h3><p>Spring th√¥ng qua c∆° ch·∫ø g·ªçi l·∫°i ƒë·ªÉ tr·ª´u t∆∞·ª£ng h√≥a vi·ªác th·ª±c hi·ªán giao d·ªãch th·ª±c s·ª± t·ª´ m√£ c√≥ t√≠nh giao d·ªãch. Spring ƒë√£ gi·∫£i quy·∫øt ƒë∆∞·ª£c nh∆∞·ª£c ƒëi·ªÉm c·ªßa giao d·ªãch to√†n c·∫ßu v√† c·ª•c b·ªô. N√≥ cho ph√©p c√°c nh√† ph√°t tri·ªÉn s·ª≠ d·ª•ng m·ªôt m√¥ h√¨nh l·∫≠p tr√¨nh nh·∫•t qu√°n trong b·∫•t k·ª≥ m√¥i tr∆∞·ªùng n√†o. B·∫°n ch·ªâ c·∫ßn vi·∫øt m√£ m·ªôt l·∫ßn, v√† n√≥ s·∫Ω ƒë∆∞·ª£c h∆∞·ªüng l·ª£i t·ª´ c√°c chi·∫øn l∆∞·ª£c qu·∫£n l√Ω giao d·ªãch kh√°c nhau trong c√°c m√¥i tr∆∞·ªùng kh√°c nhau. Spring cung c·∫•p h·ªó tr·ª£ cho qu·∫£n l√Ω giao d·ªãch l·∫≠p tr√¨nh v√† khai b√°o, trong h·∫ßu h·∫øt c√°c tr∆∞·ªùng h·ª£p, qu·∫£n l√Ω giao d·ªãch khai b√°o ƒë∆∞·ª£c khuy·∫øn ngh·ªã.</p><ul><li>Qu·∫£n l√Ω giao d·ªãch l·∫≠p tr√¨nh cho ph√©p ng∆∞·ªùi d√πng x√°c ƒë·ªãnh ch√≠nh x√°c ranh gi·ªõi giao d·ªãch trong m√£</li><li>Qu·∫£n l√Ω giao d·ªãch khai b√°o (d·ª±a tr√™n AOP) gi√∫p ng∆∞·ªùi d√πng t√°ch r·ªùi c√°c ho·∫°t ƒë·ªông kh·ªèi quy t·∫Øc giao d·ªãch</li></ul><p>Th√¥ng qua qu·∫£n l√Ω giao d·ªãch l·∫≠p tr√¨nh, nh√† ph√°t tri·ªÉn c√≥ th·ªÉ s·ª≠ d·ª•ng tr·ª´u t∆∞·ª£ng giao d·ªãch c·ªßa Spring, n√≥ c√≥ th·ªÉ ch·∫°y tr√™n b·∫•t k·ª≥ c∆° s·ªü giao d·ªãch n√†o. S·ª≠ d·ª•ng m√¥ h√¨nh khai b√°o ∆∞u ti√™n, nh√† ph√°t tri·ªÉn th∆∞·ªùng vi·∫øt r·∫•t √≠t ho·∫∑c kh√¥ng c·∫ßn vi·∫øt m√£ li√™n quan ƒë·∫øn qu·∫£n l√Ω giao d·ªãch, do ƒë√≥ kh√¥ng ph·ª• thu·ªôc v√†o API giao d·ªãch c·ªßa Spring ho·∫∑c b·∫•t k·ª≥ API giao d·ªãch n√†o kh√°c.</p><h3 id="loi-ich-cua-spring-transaction" tabindex="-1"><a class="header-anchor" href="#loi-ich-cua-spring-transaction"><span>L·ª£i √≠ch c·ªßa Spring Transaction</span></a></h3><p>Spring Framework ccung c·∫•p m·ªôt tr·ª´u t∆∞·ª£ng nh·∫•t qu√°n cho qu·∫£n l√Ω giao d·ªãch, mang l·∫°i nh·ªØng l·ª£i √≠ch sau:</p><ul><li>Cung c·∫•p m√¥ h√¨nh l·∫≠p tr√¨nh nh·∫•t qu√°n qua c√°c API giao d·ªãch kh√°c nhau, ch·∫≥ng h·∫°n nh∆∞ Java Transaction API (JTA), JDBC, Hibernate v√† Java Persistence API (JPA).</li><li>H·ªó tr·ª£ qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o.</li><li>API d√†nh cho qu·∫£n l√Ω giao d·ªãch l·∫≠p tr√¨nh ƒë∆°n gi·∫£n h∆°n so v·ªõi c√°c API giao d·ªãch ph·ª©c t·∫°p (nh∆∞ JTA).</li><li>T√≠ch h·ª£p ho√†n h·∫£o v·ªõi tr·ª´u t∆∞·ª£ng truy c·∫≠p d·ªØ li·ªáu c·ªßa Spring.</li></ul><h2 id="cac-api-cot-loi" tabindex="-1"><a class="header-anchor" href="#cac-api-cot-loi"><span>C√°c API c·ªët l√µi</span></a></h2><h3 id="transactionmanager" tabindex="-1"><a class="header-anchor" href="#transactionmanager"><span>TransactionManager</span></a></h3><p>Kh√°i ni·ªám quan tr·ªçng trong tr·ª´u t∆∞·ª£ng giao d·ªãch c·ªßa Spring l√† TransactionManager. TransactionManager ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·ªüi hai interface: <code>PlatformTransactionManager</code> cho qu·∫£n l√Ω giao d·ªãch theo c√°ch truy·ªÅn th·ªëng v√† <code>ReactiveTransactionManager</code> cho qu·∫£n l√Ω giao d·ªãch ph·∫£n ·ª©ng.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220922073737.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h4 id="platformtransactionmanager" tabindex="-1"><a class="header-anchor" href="#platformtransactionmanager"><span>PlatformTransactionManager</span></a></h4><p>D∆∞·ªõi ƒë√¢y l√† ƒë·ªãnh nghƒ©a API c·ªßa <code>PlatformTransactionManager</code>:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> PlatformTransactionManager</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionManager</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    TransactionStatus</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getTransaction</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TransactionDefinition</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> definition</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> commit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TransactionStatus</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> rollback</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TransactionStatus</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><code>PlatformTransactionManager</code> l√† m·ªôt interface SPI, cho ph√©p ng∆∞·ªùi d√πng s·ª≠ d·ª•ng n√≥ theo c√°ch l·∫≠p tr√¨nh. V√¨ <code>PlatformTransactionManager</code> l√† m·ªôt interface, n√≥ c√≥ th·ªÉ d·ªÖ d√†ng ƒë∆∞·ª£c MOCK ho·∫∑c ƒë·∫∑t ch·ªó theo nhu c·∫ßu. N√≥ kh√¥ng ph·ª• thu·ªôc v√†o c√°c chi·∫øn l∆∞·ª£c t√¨m ki·∫øm nh∆∞ JNDI. ƒê·ªãnh nghƒ©a c·ªßa <code>PlatformTransactionManager</code> gi·ªëng nh∆∞ b·∫•t k·ª≥ ƒë·ªëi t∆∞·ª£ng (ho·∫∑c bean) n√†o kh√°c trong Spring IoC container. ƒêi·ªÅu n√†y l√†m cho vi·ªác qu·∫£n l√Ω giao d·ªãch trong Spring tr·ªü th√†nh m·ªôt tr·ª´u t∆∞·ª£ng c√≥ gi√° tr·ªã, ngay c·∫£ khi b·∫°n s·ª≠ d·ª•ng JTA. So v·ªõi vi·ªác tr·ª±c ti·∫øp s·ª≠ d·ª•ng JTA, b·∫°n c√≥ th·ªÉ d·ªÖ d√†ng ki·ªÉm th·ª≠ m√£ giao d·ªãch.</p><p>T∆∞∆°ng t·ª±, ƒë·ªÉ ph√π h·ª£p v·ªõi tri·∫øt l√Ω c·ªßa Spring, b·∫•t k·ª≥ ph∆∞∆°ng th·ª©c n√†o c·ªßa <code>PlatformTransactionManager</code> c√≥ th·ªÉ n√©m ra <code>TransactionException</code> (m·ªôt RuntimeException kh√¥ng ƒë∆∞·ª£c ki·ªÉm tra). L·ªói ki·∫øn ‚Äã‚Äãtr√∫c giao d·ªãch h·∫ßu nh∆∞ lu√¥n l√† l·ªói nghi√™m tr·ªçng. Trong m·ªôt s·ªë tr∆∞·ªùng h·ª£p, ·ª©ng d·ª•ng c√≥ th·ªÉ kh√¥i ph·ª•c t·ª´ l·ªói giao d·ªãch v√† ng∆∞·ªùi ph√°t tri·ªÉn c√≥ th·ªÉ ch·ªçn b·∫Øt v√† x·ª≠ l√Ω <code>TransactionException</code>. ƒêi·ªÉm quan tr·ªçng l√† ng∆∞·ªùi ph√°t tri·ªÉn kh√¥ng b·ªã bu·ªôc ph·∫£i l√†m ƒëi·ªÅu ƒë√≥.</p><p>Ph∆∞∆°ng th·ª©c <code>getTransaction(..)</code> tr·∫£ v·ªÅ m·ªôt ƒë·ªëi t∆∞·ª£ng <code>TransactionStatus</code> d·ª±a tr√™n tham s·ªë <code>TransactionDefinition</code>. N·∫øu c√≥ giao d·ªãch kh·ªõp trong ngƒÉn x·∫øp g·ªçi hi·ªán t·∫°i, <code>TransactionStatus</code> tr·∫£ v·ªÅ c√≥ th·ªÉ ƒë·∫°i di·ªán cho m·ªôt giao d·ªãch m·ªõi ho·∫∑c c√≥ th·ªÉ ƒë·∫°i di·ªán cho m·ªôt giao d·ªãch hi·ªán c√≥. √ù nghƒ©a c·ªßa tr∆∞·ªùng h·ª£p sau l√† <code>TransactionStatus</code> ƒë∆∞·ª£c li√™n k·∫øt v·ªõi lu·ªìng th·ª±c thi, gi·ªëng nh∆∞ ng·ªØ c·∫£nh giao d·ªãch trong Java EE.</p><p>Nh∆∞ b·∫°n c√≥ th·ªÉ th·∫•y, c∆° ch·∫ø qu·∫£n l√Ω giao d·ªãch c·ª• th·ªÉ l√† m·ªù nh·∫°t ƒë·ªëi v·ªõi Spring, n√≥ kh√¥ng quan t√¢m ƒë·∫øn nh·ªØng ƒëi·ªÅu ƒë√≥, nh·ªØng ƒëi·ªÅu ƒë√≥ l√† tr√°ch nhi·ªám c·ªßa c√°c n·ªÅn t·∫£ng. V√¨ v·∫≠y, m·ªôt trong nh·ªØng l·ª£i √≠ch c·ªßa qu·∫£n l√Ω giao d·ªãch Spring l√† cung c·∫•p m·ªôt m√¥ h√¨nh l·∫≠p tr√¨nh nh·∫•t qu√°n cho c√°c API giao d·ªãch kh√°c nhau nh∆∞ JTA, JDBC, Hibernate, JPA. D∆∞·ªõi ƒë√¢y l√† c√°ch m·ªói n·ªÅn t·∫£ng tri·ªÉn khai c∆° ch·∫ø qu·∫£n l√Ω giao d·ªãch.</p><h4 id="giao-dich-jdbc" tabindex="-1"><a class="header-anchor" href="#giao-dich-jdbc"><span>Giao d·ªãch JDBC</span></a></h4><p>N·∫øu ·ª©ng d·ª•ng c·ªßa b·∫°n s·ª≠ d·ª•ng tr·ª±c ti·∫øp JDBC ƒë·ªÉ l∆∞u tr·ªØ, <code>DataSourceTransactionManager</code> s·∫Ω x·ª≠ l√Ω ranh gi·ªõi giao d·ªãch cho b·∫°n. ƒê·ªÉ s·ª≠ d·ª•ng <code>DataSourceTransactionManager</code>, b·∫°n c·∫ßn c·∫•u h√¨nh n√≥ trong ƒë·ªãnh nghƒ©a ng·ªØ c·∫£nh ·ª©ng d·ª•ng c·ªßa b·∫°n, nh∆∞ sau:</p><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;transactionManager&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p>Th·ª±c t·∫ø, <code>DataSourceTransactionManager</code> qu·∫£n l√Ω giao d·ªãch b·∫±ng c√°ch s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c <code>commit()</code> v√† <code>rollback()</code> c·ªßa <code>java.sql.Connection</code>, m√† b·∫°n c√≥ ƒë∆∞·ª£c t·ª´ <code>DataSource</code>. Khi giao d·ªãch th√†nh c√¥ng, <code>DataSourceTransactionManager</code> g·ªçi ph∆∞∆°ng th·ª©c <code>commit()</code> c·ªßa <code>Connection</code>, ng∆∞·ª£c l·∫°i, n√≥ g·ªçi ph∆∞∆°ng th·ª©c <code>rollback()</code>.</p><h4 id="giao-dich-hibernate" tabindex="-1"><a class="header-anchor" href="#giao-dich-hibernate"><span>Giao d·ªãch Hibernate</span></a></h4><p>N·∫øu ·ª©ng d·ª•ng c·ªßa b·∫°n s·ª≠ d·ª•ng Hibernate ƒë·ªÉ l∆∞u tr·ªØ, b·∫°n c·∫ßn s·ª≠ d·ª•ng <code>HibernateTransactionManager</code>. ƒê·ªëi v·ªõi Hibernate3, b·∫°n c·∫ßn th√™m khai b√°o bean sau v√†o ƒë·ªãnh nghƒ©a ng·ªØ c·∫£nh Spring:</p><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;transactionManager&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;org.springframework.orm.hibernate3.HibernateTransactionManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;sessionFactory&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;sessionFactory&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p>Thu·ªôc t√≠nh <code>sessionFactory</code> c·∫ßn ƒë∆∞·ª£c c·∫•u h√¨nh ƒë·ªÉ tr·ªè ƒë·∫øn m·ªôt session factory Hibernate. <code>HibernateTransactionManager</code> s·∫Ω ch·ªãu tr√°ch nhi·ªám qu·∫£n l√Ω giao d·ªãch b·∫±ng c√°ch ·ªßy quy·ªÅn cho ƒë·ªëi t∆∞·ª£ng <code>org.hibernate.Transaction</code>, m√† b·∫°n c√≥ ƒë∆∞·ª£c t·ª´ Hibernate Session. Khi giao d·ªãch th√†nh c√¥ng, <code>HibernateTransactionManager</code> g·ªçi ph∆∞∆°ng th·ª©c <code>commit()</code> c·ªßa <code>Transaction</code>, ng∆∞·ª£c l·∫°i, n√≥ g·ªçi ph∆∞∆°ng th·ª©c <code>rollback()</code>.</p><h4 id="giao-dich-java-persistence-api-jpa" tabindex="-1"><a class="header-anchor" href="#giao-dich-java-persistence-api-jpa"><span>Giao d·ªãch Java Persistence API (JPA)</span></a></h4><p>N·∫øu ·ª©ng d·ª•ng c·ªßa b·∫°n s·ª≠ d·ª•ng Java Persistence API (JPA), b·∫°n c·∫ßn s·ª≠ d·ª•ng <code>JpaTransactionManager</code> ƒë·ªÉ qu·∫£n l√Ω giao d·ªãch. B·∫°n c·∫ßn c·∫•u h√¨nh <code>JpaTransactionManager</code> nh∆∞ sau:</p><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;transactionManager&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;org.springframework.orm.jpa.JpaTransactionManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;entityManagerFactory&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;entityManagerFactory&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p><code>JpaTransactionManager</code> ch·ªâ c·∫ßn m·ªôt <code>EntityManagerFactory</code> (c√≥ th·ªÉ l√† b·∫•t k·ª≥ c√†i ƒë·∫∑t n√†o c·ªßa interface <code>javax.persistence.EntityManagerFactory</code>). <code>JpaTransactionManager</code> s·∫Ω l√†m vi·ªác c√πng v·ªõi <code>EntityManager</code> ƒë∆∞·ª£c t·∫°o ra t·ª´ <code>EntityManagerFactory</code> ƒë·ªÉ x√¢y d·ª±ng giao d·ªãch.</p><h4 id="giao-dich-java-native-api-jta" tabindex="-1"><a class="header-anchor" href="#giao-dich-java-native-api-jta"><span>Giao d·ªãch Java Native API (JTA)</span></a></h4><p>N·∫øu b·∫°n kh√¥ng s·ª≠ d·ª•ng b·∫•t k·ª≥ c∆° ch·∫ø qu·∫£n l√Ω giao d·ªãch n√†o ƒë∆∞·ª£c ƒë·ªÅ c·∫≠p tr√™n, ho·∫∑c b·∫°n v∆∞·ª£t qua nhi·ªÅu ngu·ªìn qu·∫£n l√Ω giao d·ªãch (v√≠ d·ª•: hai ho·∫∑c nhi·ªÅu ngu·ªìn d·ªØ li·ªáu kh√°c nhau), b·∫°n c·∫ßn s·ª≠ d·ª•ng <code>JtaTransactionManager</code>:</p><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;transactionManager&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;org.springframework.transaction.jta.JtaTransactionManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;transactionManagerName&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;java:/TransactionManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p><code>JtaTransactionManager</code> s·∫Ω ·ªßy quy·ªÅn cho ƒë·ªëi t∆∞·ª£ng <code>javax.transaction.UserTransaction</code> v√† <code>javax.transaction.TransactionManager</code> ƒë·ªÉ qu·∫£n l√Ω giao d·ªãch. Khi giao d·ªãch th√†nh c√¥ng, n√≥ s·∫Ω g·ªçi ph∆∞∆°ng th·ª©c <code>commit()</code> c·ªßa <code>UserTransaction</code>, ng∆∞·ª£c l·∫°i, n√≥ s·∫Ω g·ªçi ph∆∞∆°ng th·ª©c <code>rollback()</code>.</p><h4 id="reactivetransactionmanager" tabindex="-1"><a class="header-anchor" href="#reactivetransactionmanager"><span>ReactiveTransactionManager</span></a></h4><p>Spring cung c·∫•p m·ªôt tr·ª´u t∆∞·ª£ng qu·∫£n l√Ω giao d·ªãch cho ·ª©ng d·ª•ng ph·∫£n ·ª©ng v√† ·ª©ng d·ª•ng s·ª≠ d·ª•ng Kotlin coroutines. D∆∞·ªõi ƒë√¢y l√† ƒë·ªãnh nghƒ©a cho chi·∫øn l∆∞·ª£c qu·∫£n l√Ω giao d·ªãch <code>ReactiveTransactionManager</code>:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ReactiveTransactionManager</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionManager</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Mono</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ReactiveTransaction</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getReactiveTransaction</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TransactionDefinition</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> definition</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Mono</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Void</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> commit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ReactiveTransaction</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Mono</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Void</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> rollback</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ReactiveTransaction</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><code>ReactiveTransactionManager</code> c≈©ng l√† m·ªôt interface SPI, cho ph√©p ng∆∞·ªùi d√πng s·ª≠ d·ª•ng n√≥ theo c√°ch l·∫≠p tr√¨nh. V√¨ <code>ReactiveTransactionManager</code> l√† m·ªôt interface, n√≥ c≈©ng c√≥ th·ªÉ d·ªÖ d√†ng ƒë∆∞·ª£c MOCK ho·∫∑c ƒë·∫∑t ch·ªó theo nhu c·∫ßu.</p><h3 id="transactiondefinition" tabindex="-1"><a class="header-anchor" href="#transactiondefinition"><span>TransactionDefinition</span></a></h3><p><code>PlatformTransactionManager</code>¬†s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c¬†<code>getTransaction(TransactionDefinition definition)</code>¬†ƒë·ªÉ l·∫•y giao d·ªãch, trong ƒë√≥ tham s·ªë l√† m·ªôt ƒë·ªëi t∆∞·ª£ng¬†<code>TransactionDefinition</code>.¬†<code>TransactionDefinition</code>¬†ƒë·ªãnh nghƒ©a c√°c thu·ªôc t√≠nh c∆° b·∫£n c·ªßa giao d·ªãch. C√°c thu·ªôc t√≠nh n√†y c√≥ th·ªÉ ƒë∆∞·ª£c hi·ªÉu l√† c·∫•u h√¨nh c∆° b·∫£n c·ªßa giao d·ªãch, m√¥ t·∫£ c√°ch √°p d·ª•ng chi·∫øn l∆∞·ª£c giao d·ªãch cho c√°c ph∆∞∆°ng th·ª©c.</p><p>Interface¬†<code>TransactionDefinition</code>¬†c√≥ n·ªôi dung nh∆∞ sau:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionDefinition</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getPropagationBehavior</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Tr·∫£ v·ªÅ h√†nh vi truy·ªÅn b√° c·ªßa giao d·ªãch</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getIsolationLevel</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Tr·∫£ v·ªÅ m·ª©c ƒë·ªô c√¥ l·∫≠p c·ªßa giao d·ªãch, TransactionManager s·ª≠ d·ª•ng n√≥ ƒë·ªÉ ki·ªÉm so√°t d·ªØ li·ªáu n√†o trong giao d·ªãch c√≥ th·ªÉ ƒë∆∞·ª£c nh√¨n th·∫•y b·ªüi giao d·ªãch kh√°c</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    int</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getTimeout</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // Tr·∫£ v·ªÅ th·ªùi gian giao d·ªãch ph·∫£i ho√†n th√†nh trong bao nhi√™u gi√¢y</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> isReadOnly</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Giao d·ªãch c√≥ ch·ªâ ƒë·ªçc hay kh√¥ng, TransactionManager c√≥ th·ªÉ t·ªëi ∆∞u h√≥a d·ª±a tr√™n gi√° tr·ªã tr·∫£ v·ªÅ n√†y ƒë·ªÉ ƒë·∫£m b·∫£o giao d·ªãch ch·ªâ ƒë·ªçc</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Ch√∫ng ta c√≥ th·ªÉ th·∫•y r·∫±ng¬†<code>TransactionDefinition</code>¬†ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ ƒë·ªãnh nghƒ©a c√°c thu·ªôc t√≠nh c·ªßa giao d·ªãch. D∆∞·ªõi ƒë√¢y l√† m√¥ t·∫£ chi ti·∫øt v·ªÅ c√°c thu·ªôc t√≠nh giao d·ªãch.</p><h4 id="hanh-vi-truyen-ba-propagation-behavior" tabindex="-1"><a class="header-anchor" href="#hanh-vi-truyen-ba-propagation-behavior"><span>H√†nh vi truy·ªÅn b√° (Propagation Behavior)</span></a></h4><p>H√†nh vi truy·ªÅn b√° c·ªßa giao d·ªãch (Propagation Behavior) x√°c ƒë·ªãnh c√°ch m√† giao d·ªãch ƒë∆∞·ª£c truy·ªÅn b√° trong m·ªôt ng·ªØ c·∫£nh ƒëa giao d·ªãch. Khi m·ªôt ph∆∞∆°ng th·ª©c g·ªçi m·ªôt ph∆∞∆°ng th·ª©c giao d·ªãch kh√°c, b·∫°n c·∫ßn x√°c ƒë·ªãnh c√°ch m√† giao d·ªãch s·∫Ω ƒë∆∞·ª£c truy·ªÅn b√° t·ª´ ph∆∞∆°ng th·ª©c g·ªçi ƒë·∫øn ph∆∞∆°ng th·ª©c ƒë∆∞·ª£c g·ªçi. Spring ƒë·ªãnh nghƒ©a b·∫£y h√†nh vi truy·ªÅn b√° giao d·ªãch:</p><table><thead><tr><th>H√†nh vi truy·ªÅn b√°</th><th>√ù nghƒ©a</th></tr></thead><tbody><tr><td><code>PROPAGATION_REQUIRED</code></td><td>ƒê√°nh d·∫•u r·∫±ng ph∆∞∆°ng th·ª©c hi·ªán t·∫°i ph·∫£i ch·∫°y trong m·ªôt giao d·ªãch. N·∫øu ƒë√£ c√≥ m·ªôt giao d·ªãch hi·ªán t·∫°i, ph∆∞∆°ng th·ª©c s·∫Ω ch·∫°y trong giao d·ªãch hi·ªán c√≥. N·∫øu kh√¥ng c√≥ giao d·ªãch hi·ªán t·∫°i, m·ªôt giao d·ªãch m·ªõi s·∫Ω ƒë∆∞·ª£c kh·ªüi t·∫°o.</td></tr><tr><td><code>PROPAGATION_SUPPORTS</code></td><td>ƒê√°nh d·∫•u r·∫±ng ph∆∞∆°ng th·ª©c hi·ªán t·∫°i kh√¥ng y√™u c·∫ßu m·ªôt giao d·ªãch, nh∆∞ng n·∫øu ƒë√£ c√≥ m·ªôt giao d·ªãch hi·ªán t·∫°i, ph∆∞∆°ng th·ª©c s·∫Ω ch·∫°y trong giao d·ªãch hi·ªán c√≥.</td></tr><tr><td><code>PROPAGATION_MANDATORY</code></td><td>ƒê√°nh d·∫•u r·∫±ng ph∆∞∆°ng th·ª©c hi·ªán t·∫°i ph·∫£i ch·∫°y trong m·ªôt giao d·ªãch. N·∫øu kh√¥ng c√≥ giao d·ªãch hi·ªán t·∫°i, m·ªôt ngo·∫°i l·ªá s·∫Ω ƒë∆∞·ª£c n√©m ra.</td></tr><tr><td><code>PROPAGATION_REQUIRED_NEW</code></td><td>ƒê√°nh d·∫•u r·∫±ng ph∆∞∆°ng th·ª©c hi·ªán t·∫°i ph·∫£i ch·∫°y trong m·ªôt giao d·ªãch ri√™ng c·ªßa n√≥. M·ªôt giao d·ªãch m·ªõi s·∫Ω ƒë∆∞·ª£c kh·ªüi t·∫°o v√† giao d·ªãch hi·ªán c√≥ (n·∫øu c√≥) s·∫Ω b·ªã t·∫°m ng∆∞ng.</td></tr><tr><td><code>PROPAGATION_NOT_SUPPORTED</code></td><td>ƒê√°nh d·∫•u r·∫±ng ph∆∞∆°ng th·ª©c hi·ªán t·∫°i kh√¥ng y√™u c·∫ßu m·ªôt giao d·ªãch. N·∫øu ƒë√£ c√≥ m·ªôt giao d·ªãch hi·ªán t·∫°i, giao d·ªãch hi·ªán c√≥ s·∫Ω b·ªã t·∫°m ng∆∞ng trong khi ph∆∞∆°ng th·ª©c ƒë∆∞·ª£c th·ª±c thi.</td></tr><tr><td><code>PROPAGATION_NEVER</code></td><td>ƒê√°nh d·∫•u r·∫±ng ph∆∞∆°ng th·ª©c hi·ªán t·∫°i kh√¥ng ƒë∆∞·ª£c ch·∫°y trong m·ªôt giao d·ªãch. N·∫øu ƒë√£ c√≥ m·ªôt giao d·ªãch hi·ªán t·∫°i, m·ªôt ngo·∫°i l·ªá s·∫Ω ƒë∆∞·ª£c n√©m ra.</td></tr><tr><td><code>PROPAGATION_NESTED</code></td><td>ƒê√°nh d·∫•u r·∫±ng ph∆∞∆°ng th·ª©c hi·ªán t·∫°i ph·∫£i ch·∫°y trong m·ªôt giao d·ªãch l·ªìng nhau. Giao d·ªãch l·ªìng nhau c√≥ th·ªÉ ƒë∆∞·ª£c g·ª≠i ri√™ng bi·ªát v√† c√≥ th·ªÉ ƒë∆∞·ª£c cam k·∫øt ho·∫∑c h·ªßy b·ªè ƒë·ªôc l·∫≠p v·ªõi giao d·ªãch ch√≠nh. N·∫øu kh√¥ng c√≥ giao d·ªãch hi·ªán t·∫°i, h√†nh vi n√†y t∆∞∆°ng t·ª± nh∆∞ <code>PROPAGATION_REQUIRED</code>. L∆∞u √Ω r·∫±ng h√†nh vi n√†y kh√¥ng ƒë∆∞·ª£c h·ªó tr·ª£ b·ªüi t·∫•t c·∫£ c√°c n·ªÅn t·∫£ng.</td></tr></tbody></table><p>V√≠ d·ª•, gi·∫£ s·ª≠ ch√∫ng ta c√≥ hai ph∆∞∆°ng th·ª©c <code>methodA</code> v√† <code>methodB</code>:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// H√†nh vi truy·ªÅn b√° PROPAGATION_REQUIRED</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">methodA {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    ‚Ä¶‚Ä¶</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    methodB</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    ‚Ä¶‚Ä¶</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// H√†nh vi truy·ªÅn b√° PROPAGATION_REQUIRED</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">methodB {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">   ‚Ä¶‚Ä¶</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>Khi s·ª≠ d·ª•ng giao d·ªãch khai b√°o b·∫±ng Spring, Spring s·ª≠ d·ª•ng AOP ƒë·ªÉ h·ªó tr·ª£ giao d·ªãch khai b√°o t·ª± ƒë·ªông. D·ª±a tr√™n thu·ªôc t√≠nh h√†nh vi truy·ªÅn b√°, Spring s·∫Ω t·ª± ƒë·ªông quy·∫øt ƒë·ªãnh xem c√≥ c·∫ßn m·ªü m·ªôt giao d·ªãch m·ªõi tr∆∞·ªõc khi g·ªçi ph∆∞∆°ng th·ª©c v√† xem c√≥ c·∫ßn cam k·∫øt ho·∫∑c h·ªßy b·ªè giao d·ªãch sau khi ph∆∞∆°ng th·ª©c th·ª±c thi.</p><p>Khi g·ªçi ph∆∞∆°ng th·ª©c <code>methodB</code> ƒë·ªôc l·∫≠p:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">main {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    metodB</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>T∆∞∆°ng ƒë∆∞∆°ng v·ªõi:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Main {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Connection</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> con</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">{</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        con </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getConnection</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        con</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setAutoCommit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // G·ªçi ph∆∞∆°ng th·ª©c</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        methodB</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Cam k·∫øt giao d·ªãch</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        con</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">commit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">Catch</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RuntimeException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> ex) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // H·ªßy b·ªè giao d·ªãch</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        con</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">rollback</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Gi·∫£i ph√≥ng t√†i nguy√™n</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        closeCon</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Spring ƒë·∫£m b·∫£o r·∫±ng t·∫•t c·∫£ c√°c cu·ªôc g·ªçi trong <code>methodB</code> ƒë·ªÅu ƒë∆∞·ª£c th·ª±c hi·ªán tr√™n c√πng m·ªôt k·∫øt n·ªëi. Khi g·ªçi <code>methodB</code>, kh√¥ng c√≥ giao d·ªãch hi·ªán t·∫°i, v√¨ v·∫≠y m·ªôt k·∫øt n·ªëi m·ªõi ƒë∆∞·ª£c l·∫•y v√† m·ªôt giao d·ªãch m·ªõi ƒë∆∞·ª£c kh·ªüi t·∫°o.</p><p>Khi g·ªçi <code>methodA</code>, trong <code>methodA</code> s·∫Ω g·ªçi <code>methodB</code>.</p><p>Hi·ªáu qu·∫£ th·ª±c thi t∆∞∆°ng ƒë∆∞∆°ng v·ªõi:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">main{</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Connection</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> con </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">{</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        con </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getConnection</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        methodA</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        con</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">commit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RuntimeException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        con</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">rollback</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        closeCon</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>Khi g·ªçi <code>methodA</code>, kh√¥ng c√≥ giao d·ªãch hi·ªán t·∫°i, v√¨ v·∫≠y m·ªôt giao d·ªãch m·ªõi ƒë∆∞·ª£c kh·ªüi t·∫°o. Khi g·ªçi <code>methodB</code> trong <code>methodA</code>, ƒë√£ c√≥ m·ªôt giao d·ªãch hi·ªán t·∫°i, v√¨ v·∫≠y <code>methodB</code> s·∫Ω tham gia v√†o giao d·ªãch hi·ªán t·∫°i.</p><ol start="2"><li><code>PROPAGATION_SUPPORTS</code>: N·∫øu ƒë√£ t·ªìn t·∫°i m·ªôt giao d·ªãch, ph∆∞∆°ng th·ª©c s·∫Ω h·ªó tr·ª£ giao d·ªãch hi·ªán t·∫°i. N·∫øu kh√¥ng c√≥ giao d·ªãch, ph∆∞∆°ng th·ª©c s·∫Ω ƒë∆∞·ª£c th·ª±c thi m√† kh√¥ng c√≥ giao d·ªãch. Tuy nhi√™n, ƒë·ªëi v·ªõi c√°c TransactionManager ƒë·ªìng b·ªô h√≥a giao d·ªãch, <code>PROPAGATION_SUPPORTS</code> c√≥ m·ªôt s·ªë kh√°c bi·ªát so v·ªõi vi·ªác kh√¥ng s·ª≠ d·ª•ng giao d·ªãch.</li></ol><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Thu·ªôc t√≠nh truy·ªÅn b√° PROPAGATION_REQUIRED</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">methodA</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  methodB</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Thu·ªôc t√≠nh truy·ªÅn b√° PROPAGATION_SUPPORTS</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">methodB</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  ‚Ä¶‚Ä¶</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>Khi g·ªçi ph∆∞∆°ng th·ª©c <code>methodB</code> ƒë·ªôc l·∫≠p, ph∆∞∆°ng th·ª©c <code>methodB</code> s·∫Ω ƒë∆∞·ª£c th·ª±c thi m√† kh√¥ng c√≥ giao d·ªãch. Khi g·ªçi ph∆∞∆°ng th·ª©c <code>methodA</code>, ph∆∞∆°ng th·ª©c <code>methodB</code> s·∫Ω tham gia v√†o giao d·ªãch c·ªßa <code>methodA</code> v√† ƒë∆∞·ª£c th·ª±c thi trong giao d·ªãch.</p><ol start="3"><li><code>PROPAGATION_MANDATORY</code>: N·∫øu ƒë√£ t·ªìn t·∫°i m·ªôt giao d·ªãch, ph∆∞∆°ng th·ª©c s·∫Ω h·ªó tr·ª£ giao d·ªãch hi·ªán t·∫°i. N·∫øu kh√¥ng c√≥ giao d·ªãch ho·∫°t ƒë·ªông, m·ªôt ngo·∫°i l·ªá s·∫Ω ƒë∆∞·ª£c n√©m ra.</li></ol><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Thu·ªôc t√≠nh truy·ªÅn b√° PROPAGATION_REQUIRED</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">methodA</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    methodB</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Thu·ªôc t√≠nh truy·ªÅn b√° PROPAGATION_MANDATORY</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">methodB</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    ‚Ä¶‚Ä¶</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>Khi g·ªçi ph∆∞∆°ng th·ª©c <code>methodB</code> ƒë·ªôc l·∫≠p, v√¨ kh√¥ng c√≥ giao d·ªãch ho·∫°t ƒë·ªông, m·ªôt ngo·∫°i l·ªá <code>IllegalTransactionStateException</code> s·∫Ω ƒë∆∞·ª£c n√©m ra v·ªõi th√¥ng b√°o &quot;Transaction propagation &#39;mandatory&#39; but no existing transaction found&quot;. Khi g·ªçi ph∆∞∆°ng th·ª©c <code>methodA</code>, ph∆∞∆°ng th·ª©c <code>methodB</code> s·∫Ω tham gia v√†o giao d·ªãch c·ªßa <code>methodA</code> v√† ƒë∆∞·ª£c th·ª±c thi trong giao d·ªãch.</p><ol start="4"><li><code>PROPAGATION_REQUIRES_NEW</code> lu√¥n m·ªü m·ªôt giao d·ªãch m·ªõi. N·∫øu m·ªôt giao d·ªãch ƒë√£ t·ªìn t·∫°i, n√≥ s·∫Ω treo giao d·ªãch hi·ªán c√≥.</li></ol><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Thu·ªôc t√≠nh giao d·ªãch PROPAGATION_REQUIRED</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">methodA</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    l√†mM·ªôtS·ªëVi·ªácA</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    methodB</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    l√†mM·ªôtS·ªëVi·ªácB</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Thu·ªôc t√≠nh giao d·ªãch PROPAGATION_REQUIRES_NEW</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">methodB</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    ‚Ä¶‚Ä¶</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>G·ªçi ph∆∞∆°ng th·ª©c A:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">main</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    methodA</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>T∆∞∆°ng ƒë∆∞∆°ng v·ªõi</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">main</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(){</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    TransactionManager</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> tm </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">{</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // L·∫•y m·ªôt qu·∫£n l√Ω giao d·ªãch JTA</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        tm </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getTransactionManager</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        tm</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">begin</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // M·ªü m·ªôt giao d·ªãch m·ªõi</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        Transaction</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> ts1 </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> tm</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTransaction</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        l√†mM·ªôtS·ªëVi·ªác</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        tm</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">suspend</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Treo giao d·ªãch hi·ªán t·∫°i</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">{</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            tm</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">begin</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // M·ªü l·∫°i giao d·ªãch th·ª© hai</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            Transaction</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> ts2 </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> tm</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTransaction</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">            methodB</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            ts2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">commit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // G·ª≠i giao d·ªãch th·ª© hai</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        } </span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">Catch</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RunTimeException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> ex) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            ts2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">rollback</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Quay l·∫°i giao d·ªãch th·ª© hai</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // Gi·∫£i ph√≥ng t√†i nguy√™n</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Sau khi methodB th·ª±c hi·ªán xong, kh√¥i ph·ª•c giao d·ªãch ƒë·∫ßu ti√™n</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        tm</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">resume</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(ts1);</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        l√†mM·ªôtS·ªëVi·ªácB</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        ts1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">commit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // G·ª≠i giao d·ªãch ƒë·∫ßu ti√™n</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RunTimeException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        ts1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">rollback</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Quay l·∫°i giao d·ªãch ƒë·∫ßu ti√™n</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Gi·∫£i ph√≥ng t√†i nguy√™n</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>·ªû ƒë√¢y, t√¥i g·ªçi ts1 l√† giao d·ªãch b√™n ngo√†i v√† ts2 l√† giao d·ªãch b√™n trong. T·ª´ ƒëo·∫°n m√£ tr√™n, ta c√≥ th·ªÉ th·∫•y ts2 v√† ts1 l√† hai giao d·ªãch ƒë·ªôc l·∫≠p, kh√¥ng li√™n quan ƒë·∫øn nhau. Ts2 kh√¥ng ph·ª• thu·ªôc v√†o th√†nh c√¥ng c·ªßa ts1. N·∫øu ph∆∞∆°ng th·ª©c methodA g·∫∑p l·ªói sau khi g·ªçi ph∆∞∆°ng th·ª©c methodB v√† ph∆∞∆°ng th·ª©c doSomeThingB, k·∫øt qu·∫£ c·ªßa methodB v·∫´n ƒë∆∞·ª£c g·ª≠i. Nh∆∞ng c√°c k·∫øt qu·∫£ kh√°c do c√°c ƒëo·∫°n m√£ kh√°c g√¢y ra s·∫Ω b·ªã quay l·∫°i. ƒê·ªÉ s·ª≠ d·ª•ng PROPAGATION_REQUIRES_NEW, c·∫ßn s·ª≠ d·ª•ng JtaTransactionManager l√†m qu·∫£n l√Ω giao d·ªãch.</p><ol start="5"><li><code>PROPAGATION_NOT_SUPPORTED</code> lu√¥n th·ª±c hi·ªán m·ªôt ph∆∞∆°ng th·ª©c m√† kh√¥ng c√≥ giao d·ªãch v√† t·∫°m d·ª´ng b·∫•t k·ª≥ giao d·ªãch n√†o ƒëang t·ªìn t·∫°i. ƒê·ªÉ s·ª≠ d·ª•ng PROPAGATION_NOT_SUPPORTED, c≈©ng c·∫ßn s·ª≠ d·ª•ng JtaTransactionManager l√†m qu·∫£n l√Ω giao d·ªãch. (M√£ v√≠ d·ª• t∆∞∆°ng t·ª± nh∆∞ tr√™n, c√≥ th·ªÉ √°p d·ª•ng t∆∞∆°ng t·ª±)</li><li><code>PROPAGATION_NEVER</code> lu√¥n th·ª±c hi·ªán m·ªôt ph∆∞∆°ng th·ª©c m√† kh√¥ng c√≥ giao d·ªãch v√† n·∫øu c√≥ b·∫•t k·ª≥ giao d·ªãch n√†o ƒëang ho·∫°t ƒë·ªông, n√≥ s·∫Ω n√©m ra m·ªôt ngo·∫°i l·ªá.</li><li><code>PROPAGATION_NESTED</code> n·∫øu c√≥ m·ªôt giao d·ªãch ho·∫°t ƒë·ªông, n√≥ s·∫Ω ch·∫°y trong m·ªôt giao d·ªãch l·ªìng nhau. N·∫øu kh√¥ng c√≥ giao d·ªãch ho·∫°t ƒë·ªông, n√≥ s·∫Ω ch·∫°y theo thu·ªôc t√≠nh <code>PROPAGATION_REQUIRED</code>. ƒê√¢y l√† m·ªôt giao d·ªãch l·ªìng nhau, ch·ªâ h·ªó tr·ª£ <code>DataSourceTransactionManager</code> l√†m qu·∫£n l√Ω giao d·ªãch khi s·ª≠ d·ª•ng JDBC 3.0 tr·ªü l√™n. C·∫ßn c√≥ l·ªõp <code>java.sql.Savepoint</code> c·ªßa JDBC driver v√† m·ªôt s·ªë tri·ªÉn khai c·ªßa qu·∫£n l√Ω giao d·ªãch JTA c√≥ th·ªÉ cung c·∫•p ch·ª©c nƒÉng t∆∞∆°ng t·ª±. ƒê·ªÉ s·ª≠ d·ª•ng PROPAGATION_NESTED, c·∫ßn ƒë·∫∑t thu·ªôc t√≠nh <code>nestedTransactionAllowed</code> c·ªßa <code>PlatformTransactionManager</code> th√†nh true; gi√° tr·ªã m·∫∑c ƒë·ªãnh c·ªßa <code>nestedTransactionAllowed</code> l√† false.</li></ol><p>Trong v√≠ d·ª• tr√™n, khi g·ªçi ph∆∞∆°ng th·ª©c methodB tr∆∞·ªõc, g·ªçi ph∆∞∆°ng th·ª©c setSavepoint ƒë·ªÉ l∆∞u tr·∫°ng th√°i hi·ªán t·∫°i v√†o savepoint. N·∫øu ph∆∞∆°ng th·ª©c methodB g·ªçi th·∫•t b·∫°i, th√¨ s·∫Ω kh√¥i ph·ª•c l·∫°i tr·∫°ng th√°i ƒë√£ l∆∞u tr∆∞·ªõc ƒë√≥. Tuy nhi√™n, c·∫ßn l∆∞u √Ω r·∫±ng giao d·ªãch t·∫°i th·ªùi ƒëi·ªÉm n√†y ch∆∞a ƒë∆∞·ª£c commit, n·∫øu ƒëo·∫°n m√£ ti·∫øp theo (ph∆∞∆°ng th·ª©c doSomeThingB()) g·∫∑p l·ªói, th√¨ s·∫Ω rollback t·∫•t c·∫£ c√°c thao t√°c c·ªßa methodB.</p><p>Giao d·ªãch l·ªìng nhau l√† m·ªôt kh√°i ni·ªám quan tr·ªçng, trong ƒë√≥ giao d·ªãch b√™n trong ph·ª• thu·ªôc v√†o giao d·ªãch b√™n ngo√†i. Khi giao d·ªãch b√™n ngo√†i th·∫•t b·∫°i, c√°c h√†nh ƒë·ªông c·ªßa giao d·ªãch b√™n trong s·∫Ω b·ªã rollback. Trong khi c√°c h√†nh ƒë·ªông c·ªßa giao d·ªãch b√™n trong th·∫•t b·∫°i kh√¥ng g√¢y ra rollback c·ªßa giao d·ªãch b√™n ngo√†i.</p><p>S·ª± kh√°c bi·ªát gi·ªØa PROPAGATION_NESTED v√† PROPAGATION_REQUIRES_NEW: Ch√∫ng r·∫•t t∆∞∆°ng t·ª±, ƒë·ªÅu gi·ªëng nh∆∞ m·ªôt giao d·ªãch l·ªìng nhau, n·∫øu kh√¥ng c√≥ giao d·ªãch ho·∫°t ƒë·ªông, c·∫£ hai ƒë·ªÅu m·ªü m·ªôt giao d·ªãch m·ªõi. Khi s·ª≠ d·ª•ng PROPAGATION_REQUIRES_NEW, giao d·ªãch b√™n trong v√† giao d·ªãch b√™n ngo√†i gi·ªëng nh∆∞ hai giao d·ªãch ƒë·ªôc l·∫≠p, sau khi giao d·ªãch b√™n trong ƒë∆∞·ª£c commit, giao d·ªãch b√™n ngo√†i kh√¥ng th·ªÉ rollback n√≥. Hai giao d·ªãch kh√¥ng ·∫£nh h∆∞·ªüng l·∫´n nhau v√† kh√¥ng ph·∫£i l√† m·ªôt giao d·ªãch l·ªìng nhau th·ª±c s·ª±. ƒê·ªìng th·ªùi, n√≥ c·∫ßn h·ªó tr·ª£ c·ªßa qu·∫£n l√Ω giao d·ªãch JTA.</p><p>Khi s·ª≠ d·ª•ng PROPAGATION_NESTED, rollback c·ªßa giao d·ªãch b√™n ngo√†i c√≥ th·ªÉ g√¢y ra rollback c·ªßa giao d·ªãch b√™n trong. Trong khi ngo·∫°i l·ªá c·ªßa giao d·ªãch b√™n trong kh√¥ng g√¢y ra rollback c·ªßa giao d·ªãch b√™n ngo√†i, ƒë√≥ l√† m·ªôt giao d·ªãch l·ªìng nhau th·ª±c s·ª±. <code>DataSourceTransactionManager</code> s·ª≠ d·ª•ng savepoint ƒë·ªÉ h·ªó tr·ª£ PROPAGATION_NESTED, c·∫ßn h·ªó tr·ª£ JDBC 3.0 tr·ªü l√™n v√† phi√™n b·∫£n JDK 1.4 tr·ªü l√™n. C√°c tri·ªÉn khai kh√°c c·ªßa qu·∫£n l√Ω giao d·ªãch JTA c√≥ th·ªÉ c√≥ c√°ch h·ªó tr·ª£ kh√°c nhau.</p><p>PROPAGATION_REQUIRES_NEW kh·ªüi ƒë·ªông m·ªôt giao d·ªãch &quot;n·ªôi b·ªô&quot; m·ªõi kh√¥ng ph·ª• thu·ªôc v√†o m√¥i tr∆∞·ªùng. Giao d·ªãch n√†y s·∫Ω ƒë∆∞·ª£c commit ho·∫∑c rollback ho√†n to√†n m√† kh√¥ng ph·ª• thu·ªôc v√†o giao d·ªãch b√™n ngo√†i, n√≥ c√≥ ph·∫°m vi c√¥ l·∫≠p ri√™ng, kh√≥a ri√™ng, v.v. Khi giao d·ªãch b√™n trong b·∫Øt ƒë·∫ßu th·ª±c thi, giao d·ªãch b√™n ngo√†i s·∫Ω b·ªã t·∫°m d·ª´ng v√† khi giao d·ªãch b√™n trong k·∫øt th√∫c, giao d·ªãch b√™n ngo√†i s·∫Ω ti·∫øp t·ª•c th·ª±c thi.</p><p>M·∫∑t kh√°c, PROPAGATION_NESTED b·∫Øt ƒë·∫ßu m·ªôt giao d·ªãch &quot;l·ªìng nhau&quot; th·ª±c s·ª±, n√≥ l√† m·ªôt giao d·ªãch con th·ª±c s·ª± c·ªßa giao d·ªãch hi·ªán t·∫°i. Khi giao d·ªãch con b·∫Øt ƒë·∫ßu th·ª±c thi, n√≥ s·∫Ω l·∫•y m·ªôt savepoint. N·∫øu giao d·ªãch con th·∫•t b·∫°i, ch√∫ng ta s·∫Ω rollback ƒë·∫øn savepoint ƒë√≥. Giao d·ªãch con l√† m·ªôt ph·∫ßn c·ªßa giao d·ªãch b√™n ngo√†i, ch·ªâ khi giao d·ªãch b√™n ngo√†i k·∫øt th√∫c, giao d·ªãch con m·ªõi ƒë∆∞·ª£c commit.</p><p>T·ª´ ƒë√≥ c√≥ th·ªÉ th·∫•y, s·ª± kh√°c bi·ªát l·ªõn nh·∫•t gi·ªØa PROPAGATION_REQUIRES_NEW v√† PROPAGATION_NESTED l√†, PROPAGATION_REQUIRES_NEW ho√†n to√†n l√† m·ªôt giao d·ªãch m·ªõi, trong khi PROPAGATION_NESTED l√† m·ªôt giao d·ªãch con c·ªßa giao d·ªãch b√™n ngo√†i, n·∫øu giao d·ªãch b√™n ngo√†i commit, giao d·ªãch con c≈©ng s·∫Ω ƒë∆∞·ª£c commit, quy t·∫Øc n√†y c≈©ng √°p d·ª•ng cho rollback.</p><p>PROPAGATION_REQUIRED n√™n l√† l·ª±a ch·ªçn ƒë·∫ßu ti√™n cho h√†nh vi truy·ªÅn giao d·ªãch. N√≥ c√≥ th·ªÉ ƒë√°p ·ª©ng h·∫ßu h·∫øt c√°c y√™u c·∫ßu giao d·ªãch c·ªßa ch√∫ng ta.</p><h4 id="cac-muc-ƒëo-co-lap" tabindex="-1"><a class="header-anchor" href="#cac-muc-ƒëo-co-lap"><span>C√°c m·ª©c ƒë·ªô c√¥ l·∫≠p</span></a></h4><p>M·ªôt kh√≠a c·∫°nh quan tr·ªçng kh√°c c·ªßa giao d·ªãch l√† m·ª©c ƒë·ªô c√¥ l·∫≠p (isolation level). M·ª©c ƒë·ªô c√¥ l·∫≠p x√°c ƒë·ªãnh m·ª©c ƒë·ªô ·∫£nh h∆∞·ªüng c·ªßa c√°c giao d·ªãch ƒë·ªìng th·ªùi kh√°c ƒë·∫øn m·ªôt giao d·ªãch c·ª• th·ªÉ.</p><ol><li>V·∫•n ƒë·ªÅ g√¢y ra b·ªüi c√°c giao d·ªãch ƒë·ªìng th·ªùi</li></ol><p>Trong c√°c ·ª©ng d·ª•ng th√¥ng th∆∞·ªùng, nhi·ªÅu giao d·ªãch ch·∫°y ƒë·ªìng th·ªùi v√† th∆∞·ªùng thao t√°c tr√™n c√πng d·ªØ li·ªáu ƒë·ªÉ ho√†n th√†nh nhi·ªám v·ª• c·ªßa m√¨nh. M·∫∑c d√π s·ª± ƒë·ªìng th·ªùi l√† c·∫ßn thi·∫øt, nh∆∞ng n√≥ c√≥ th·ªÉ g√¢y ra c√°c v·∫•n ƒë·ªÅ sau:</p><ul><li>ƒê·ªçc d·ªØ li·ªáu b·∫©n (Dirty reads) - ƒê·ªçc d·ªØ li·ªáu b·∫©n x·∫£y ra khi m·ªôt giao d·ªãch ƒë·ªçc d·ªØ li·ªáu ƒë√£ ƒë∆∞·ª£c ghi l·∫°i b·ªüi m·ªôt giao d·ªãch kh√°c nh∆∞ng ch∆∞a ƒë∆∞·ª£c commit. N·∫øu giao d·ªãch ƒë√≥ b·ªã rollback sau ƒë√≥, d·ªØ li·ªáu m√† giao d·ªãch ƒë·∫ßu ti√™n ƒë√£ ƒë·ªçc s·∫Ω l√† kh√¥ng h·ª£p l·ªá.</li><li>ƒê·ªçc kh√¥ng nh·∫•t qu√°n (Nonrepeatable reads) - ƒê·ªçc kh√¥ng nh·∫•t qu√°n x·∫£y ra khi m·ªôt giao d·ªãch th·ª±c hi·ªán c√πng m·ªôt truy v·∫•n hai l·∫ßn ho·∫∑c nhi·ªÅu l·∫ßn nh∆∞ng m·ªói l·∫ßn ƒë·ªÅu nh·∫≠n ƒë∆∞·ª£c k·∫øt qu·∫£ kh√°c nhau. ƒêi·ªÅu n√†y th∆∞·ªùng x·∫£y ra khi m·ªôt giao d·ªãch kh√°c th·ª±c hi·ªán c√°c thay ƒë·ªïi gi·ªØa hai l·∫ßn ƒë·ªçc.</li><li>ƒê·ªçc gi·∫£ (Phantom reads) - ƒê·ªçc gi·∫£ t∆∞∆°ng t·ª± nh∆∞ ƒë·ªçc kh√¥ng nh·∫•t qu√°n. N√≥ x·∫£y ra khi m·ªôt giao d·ªãch ƒë·ªçc m·ªôt s·ªë h√†ng d·ªØ li·ªáu, sau ƒë√≥ m·ªôt giao d·ªãch kh√°c ch√®n th√™m d·ªØ li·ªáu v√†o gi·ªØa c√°c h√†ng ƒë√≥. Trong c√°c truy v·∫•n sau ƒë√≥, giao d·ªãch ƒë·∫ßu ti√™n s·∫Ω ph√°t hi·ªán ra r·∫±ng c√≥ th√™m c√°c h√†ng m√† ban ƒë·∫ßu kh√¥ng t·ªìn t·∫°i.</li></ul><p><strong>S·ª± kh√°c bi·ªát gi·ªØa ƒë·ªçc kh√¥ng nh·∫•t qu√°n v√† ƒë·ªçc gi·∫£</strong></p><p>ƒê·ªçc kh√¥ng nh·∫•t qu√°n t·∫≠p trung v√†o vi·ªác thay ƒë·ªïi:<br> C√πng m·ªôt ƒëi·ªÅu ki·ªán, b·∫°n ƒë·ªçc d·ªØ li·ªáu m√† b·∫°n ƒë√£ ƒë·ªçc tr∆∞·ªõc ƒë√≥ v√† nh·∫≠n th·∫•y r·∫±ng gi√° tr·ªã ƒë√£ thay ƒë·ªïi.<br> V√≠ d·ª•: Trong giao d·ªãch 1, Mary ƒë·ªçc gi√° tr·ªã l∆∞∆°ng c·ªßa m√¨nh l√† 1000, nh∆∞ng giao d·ªãch n√†y ch∆∞a ho√†n th√†nh.</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>    con1 = getConnection();</span></span>
<span class="line"><span>    select salary from employee empId =&quot;Mary&quot;;</span></span></code></pre></div><p>Trong giao d·ªãch 2, ng∆∞·ªùi qu·∫£n l√Ω t√†i ch√≠nh thay ƒë·ªïi l∆∞∆°ng c·ªßa Mary th√†nh 2000 v√† commit giao d·ªãch.</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>    con2 = getConnection();</span></span>
<span class="line"><span>    update employee set salary = 2000;</span></span>
<span class="line"><span>    con2.commit();</span></span></code></pre></div><p>Trong giao d·ªãch 1, Mary ƒë·ªçc l·∫°i gi√° tr·ªã l∆∞∆°ng c·ªßa m√¨nh v√† th·∫•y r·∫±ng l∆∞∆°ng ƒë√£ thay ƒë·ªïi th√†nh 2000.</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>    //con1</span></span>
<span class="line"><span>    select salary from employee empId =&quot;Mary&quot;;</span></span></code></pre></div><p>K·∫øt qu·∫£ ƒë·ªçc hai l·∫ßn trong c√πng m·ªôt giao d·ªãch kh√¥ng nh·∫•t qu√°n, g√¢y ra ƒë·ªçc kh√¥ng nh·∫•t qu√°n.</p><p>ƒê·ªçc gi·∫£ t·∫≠p trung v√†o vi·ªác th√™m ho·∫∑c x√≥a:<br> C√πng m·ªôt ƒëi·ªÅu ki·ªán, s·ªë l∆∞·ª£ng b·∫£n ghi ƒë·ªçc l·∫ßn th·ª© nh·∫•t v√† l·∫ßn th·ª© hai kh√¥ng gi·ªëng nhau.<br> V√≠ d·ª•: Hi·ªán c√≥ 10 nh√¢n vi√™n c√≥ m·ª©c l∆∞∆°ng l√† 1000. Giao d·ªãch 1 ƒë·ªçc t·∫•t c·∫£ nh√¢n vi√™n c√≥ m·ª©c l∆∞∆°ng l√† 1000.</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>    con1 = getConnection();</span></span>
<span class="line"><span>    Select * from employee where salary =1000;</span></span></code></pre></div><p>C√≥ th√™m m·ªôt giao d·ªãch kh√°c ch√®n m·ªôt b·∫£n ghi nh√¢n vi√™n m·ªõi v·ªõi m·ª©c l∆∞∆°ng l√† 1000.</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>    con2 = getConnection();</span></span>
<span class="line"><span>    Insert into employee(empId,salary) values(&quot;Lili&quot;,1000);</span></span>
<span class="line"><span>    con2.commit();</span></span></code></pre></div><p>Giao d·ªãch 1 ƒë·ªçc l·∫°i t·∫•t c·∫£ nh√¢n vi√™n c√≥ m·ª©c l∆∞∆°ng l√† 1000.</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>    //con1</span></span>
<span class="line"><span>    select * from employee where salary =1000;</span></span></code></pre></div><p>C√≥ t·ªïng c·ªông 11 b·∫£n ghi ƒë∆∞·ª£c ƒë·ªçc, g√¢y ra hi·ªán t∆∞·ª£ng ƒë·ªçc gi·∫£.</p><p>T·ªïng k·∫øt l·∫°i, d∆∞·ªùng nh∆∞ ƒë·ªçc kh√¥ng nh·∫•t qu√°n v√† ƒë·ªçc gi·∫£ ƒë·ªÅu c√≥ k·∫øt qu·∫£ ƒë·ªçc hai l·∫ßn kh√¥ng nh·∫•t qu√°n. Nh∆∞ng n·∫øu b·∫°n nh√¨n t·ª´ g√≥c ƒë·ªô ki·ªÉm so√°t, s·ª± kh√°c bi·ªát gi·ªØa hai tr∆∞·ªùng h·ª£p n√†y l√† r·∫•t l·ªõn.<br> ƒê·ªëi v·ªõi tr∆∞·ªùng h·ª£p ƒë·∫ßu ti√™n, ch·ªâ c·∫ßn kh√≥a c√°c b·∫£n ghi th·ªèa m√£n ƒëi·ªÅu ki·ªán.<br> ƒê·ªëi v·ªõi tr∆∞·ªùng h·ª£p th·ª© hai, c·∫ßn kh√≥a c√°c b·∫£n ghi th·ªèa m√£n ƒëi·ªÅu ki·ªán v√† c√°c b·∫£n ghi g·∫ßn k·ªÅ.</p><ol start="2"><li>M·ª©c ƒë·ªô c√¥ l·∫≠p</li></ol><table><thead><tr><th>M·ª©c ƒë·ªô c√¥ l·∫≠p</th><th>√ù nghƒ©a</th></tr></thead><tbody><tr><td>ISOLATION_DEFAULT</td><td>S·ª≠ d·ª•ng m·ª©c ƒë·ªô c√¥ l·∫≠p m·∫∑c ƒë·ªãnh c·ªßa c∆° s·ªü d·ªØ li·ªáu</td></tr><tr><td>ISOLATION_READ_UNCOMMITTED</td><td>M·ª©c ƒë·ªô c√¥ l·∫≠p th·∫•p nh·∫•t, cho ph√©p ƒë·ªçc c√°c thay ƒë·ªïi ch∆∞a ƒë∆∞·ª£c commit, c√≥ th·ªÉ g√¢y ra ƒë·ªçc d·ªØ li·ªáu b·∫©n, ƒë·ªçc kh√¥ng nh·∫•t qu√°n ho·∫∑c ƒë·ªçc gi·∫£</td></tr><tr><td>ISOLATION_READ_COMMITTED</td><td>Cho ph√©p ƒë·ªçc c√°c thay ƒë·ªïi ƒë√£ ƒë∆∞·ª£c commit b·ªüi c√°c giao d·ªãch ƒë·ªìng th·ªùi, c√≥ th·ªÉ ngƒÉn ch·∫∑n ƒë·ªçc d·ªØ li·ªáu b·∫©n, nh∆∞ng ƒë·ªçc kh√¥ng nh·∫•t qu√°n ho·∫∑c ƒë·ªçc gi·∫£ v·∫´n c√≥ th·ªÉ x·∫£y ra</td></tr><tr><td>ISOLATION_REPEATABLE_READ</td><td>ƒê·∫£m b·∫£o k·∫øt qu·∫£ ƒë·ªçc nhi·ªÅu l·∫ßn c·ªßa c√πng m·ªôt tr∆∞·ªùng d·ªØ li·ªáu l√† nh·∫•t qu√°n, tr·ª´ khi d·ªØ li·ªáu ƒë√≥ ƒë∆∞·ª£c ghi l·∫°i b·ªüi ch√≠nh giao d·ªãch hi·ªán t·∫°i, c√≥ th·ªÉ ngƒÉn ch·∫∑n ƒë·ªçc d·ªØ li·ªáu b·∫©n v√† ƒë·ªçc kh√¥ng nh·∫•t qu√°n, nh∆∞ng ƒë·ªçc gi·∫£ v·∫´n c√≥ th·ªÉ x·∫£y ra</td></tr><tr><td>ISOLATION_SERIALIZABLE</td><td>M·ª©c ƒë·ªô c√¥ l·∫≠p cao nh·∫•t, tu√¢n th·ªß ƒë·∫ßy ƒë·ªß c√°c y√™u c·∫ßu ACID, ƒë·∫£m b·∫£o ngƒÉn ch·∫∑n ƒë·ªçc d·ªØ li·ªáu b·∫©n, ƒë·ªçc kh√¥ng nh·∫•t qu√°n v√† ƒë·ªçc gi·∫£, ƒë√¢y c≈©ng l√† m·ª©c ƒë·ªô c√¥ l·∫≠p ch·∫≠m nh·∫•t v√¨ th∆∞·ªùng ƒë∆∞·ª£c th·ª±c hi·ªán b·∫±ng c√°ch kh√≥a to√†n b·ªô c√°c b·∫£ng li√™n quan ƒë·∫øn giao d·ªãch</td></tr></tbody></table><h4 id="read-only-chi-ƒëoc" tabindex="-1"><a class="header-anchor" href="#read-only-chi-ƒëoc"><span>Read-only (Ch·ªâ ƒë·ªçc)</span></a></h4><p>M·ªôt trong c√°c ƒë·∫∑c ƒëi·ªÉm c·ªßa giao d·ªãch l√† n√≥ c√≥ ph·∫£i l√† giao d·ªãch ch·ªâ ƒë·ªçc hay kh√¥ng. N·∫øu giao d·ªãch ch·ªâ th·ª±c hi·ªán c√°c thao t√°c ƒë·ªçc tr√™n c∆° s·ªü d·ªØ li·ªáu, h·ªá th·ªëng c∆° s·ªü d·ªØ li·ªáu c√≥ th·ªÉ t·∫≠n d·ª•ng t√≠nh ch·∫•t ch·ªâ ƒë·ªçc c·ªßa giao d·ªãch ƒë·ªÉ t·ªëi ∆∞u h√≥a m·ªôt s·ªë ho·∫°t ƒë·ªông c·ª• th·ªÉ. B·∫±ng c√°ch ƒë·∫∑t giao d·ªãch th√†nh ch·ªâ ƒë·ªçc, b·∫°n c√≥ th·ªÉ cung c·∫•p cho c∆° s·ªü d·ªØ li·ªáu c∆° h·ªôi √°p d·ª•ng c√°c bi·ªán ph√°p t·ªëi ∆∞u m√† n√≥ cho l√† ph√π h·ª£p.</p><h4 id="transaction-timeout-thoi-gian-cho-giao-dich" tabindex="-1"><a class="header-anchor" href="#transaction-timeout-thoi-gian-cho-giao-dich"><span>Transaction Timeout (Th·ªùi gian ch·ªù giao d·ªãch)</span></a></h4><p>ƒê·ªÉ ·ª©ng d·ª•ng ho·∫°t ƒë·ªông t·ªët, giao d·ªãch kh√¥ng th·ªÉ ch·∫°y qu√° l√¢u. V√¨ giao d·ªãch c√≥ th·ªÉ li√™n quan ƒë·∫øn vi·ªác kh√≥a c∆° s·ªü d·ªØ li·ªáu ph√≠a sau, giao d·ªãch k√©o d√†i qu√° l√¢u s·∫Ω chi·∫øm d·ª•ng t√†i nguy√™n c∆° s·ªü d·ªØ li·ªáu m·ªôt c√°ch kh√¥ng c·∫ßn thi·∫øt. Th·ªùi gian ch·ªù giao d·ªãch l√† m·ªôt b·ªô h·∫πn gi·ªù cho giao d·ªãch, n·∫øu trong kho·∫£ng th·ªùi gian nh·∫•t ƒë·ªãnh m√† giao d·ªãch kh√¥ng ho√†n th√†nh, n√≥ s·∫Ω t·ª± ƒë·ªông quay l·∫°i tr·∫°ng th√°i ban ƒë·∫ßu, thay v√¨ ti·∫øp t·ª•c ch·ªù ƒë·ª£i.</p><h4 id="rollback-rules-quy-tac-hoan-tac" tabindex="-1"><a class="header-anchor" href="#rollback-rules-quy-tac-hoan-tac"><span>Rollback Rules (Quy t·∫Øc ho√†n t√°c)</span></a></h4><p>M·ªôt trong nh·ªØng kh√≠a c·∫°nh cu·ªëi c√πng c·ªßa ng≈© gi√°c giao d·ªãch l√† m·ªôt t·∫≠p h·ª£p c√°c quy t·∫Øc, x√°c ƒë·ªãnh nh·ªØng ngo·∫°i l·ªá n√†o s·∫Ω g√¢y ra vi·ªác ho√†n t√°c giao d·ªãch v√† nh·ªØng ngo·∫°i l·ªá n√†o kh√¥ng. M·∫∑c ƒë·ªãnh, giao d·ªãch ch·ªâ ho√†n t√°c khi g·∫∑p ph·∫£i ngo·∫°i l·ªá th·ªùi gian ch·∫°y, trong khi kh√¥ng ho√†n t√°c khi g·∫∑p ph·∫£i ngo·∫°i l·ªá ki·ªÉu ki·ªÉm tra (h√†nh vi n√†y t∆∞∆°ng t·ª± v·ªõi h√†nh vi ho√†n t√°c c·ªßa EJB). Tuy nhi√™n, b·∫°n c√≥ th·ªÉ khai b√°o giao d·ªãch s·∫Ω ho√†n t√°c khi g·∫∑p ph·∫£i c√°c ngo·∫°i l·ªá ki·ªÉu ki·ªÉm tra c·ª• th·ªÉ nh∆∞ khi g·∫∑p ph·∫£i ngo·∫°i l·ªá th·ªùi gian ch·∫°y. T∆∞∆°ng t·ª±, b·∫°n c≈©ng c√≥ th·ªÉ khai b√°o giao d·ªãch s·∫Ω kh√¥ng ho√†n t√°c khi g·∫∑p ph·∫£i c√°c ngo·∫°i l·ªá c·ª• th·ªÉ, ngay c·∫£ khi ch√∫ng l√† ngo·∫°i l·ªá th·ªùi gian ch·∫°y.</p><h3 id="transactionstatus" tabindex="-1"><a class="header-anchor" href="#transactionstatus"><span>TransactionStatus</span></a></h3><p>interface <code>TransactionStatus</code> cung c·∫•p m·ªôt c√°ch ƒë∆°n gi·∫£n ƒë·ªÉ ƒëi·ªÅu khi·ªÉn vi·ªác th·ª±c thi giao d·ªãch v√† truy v·∫•n tr·∫°ng th√°i giao d·ªãch cho m√£ giao d·ªãch. C√°c kh√°i ni·ªám n√†y n√™n quen thu·ªôc v√¨ ch√∫ng l√† chung cho t·∫•t c·∫£ c√°c API giao d·ªãch. D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• v·ªÅ interface <code>TransactionStatus</code>:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionStatus</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionExecution</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SavepointManager</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Flushable</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> isNewTransaction</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> hasSavepoint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> setRollbackOnly</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> isRollbackOnly</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> flush</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> isCompleted</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>C√≥ th·ªÉ th·∫•y r·∫±ng interface n√†y m√¥ t·∫£ c√°c ph∆∞∆°ng th·ª©c ƒë·ªÉ ƒëi·ªÅu khi·ªÉn vi·ªác th·ª±c thi giao d·ªãch v√† truy v·∫•n tr·∫°ng th√°i giao d·ªãch m·ªôt c√°ch ƒë∆°n gi·∫£n, v√† c·∫ßn √°p d·ª•ng tr·∫°ng th√°i giao d·ªãch t∆∞∆°ng ·ª©ng khi rollback ho·∫∑c commit.</p><h3 id="transactiontemplate" tabindex="-1"><a class="header-anchor" href="#transactiontemplate"><span>TransactionTemplate</span></a></h3><p>Spring cung c·∫•p h·ªó tr·ª£ cho giao d·ªãch theo c√°ch l·∫≠p tr√¨nh v√† theo c√°ch khai b√°o. Giao d·ªãch theo c√°ch l·∫≠p tr√¨nh cho ph√©p ng∆∞·ªùi d√πng x√°c ƒë·ªãnh r√µ ranh gi·ªõi c·ªßa giao d·ªãch trong m√£ ngu·ªìn, trong khi giao d·ªãch theo c√°ch khai b√°o (d·ª±a tr√™n AOP) gi√∫p ng∆∞·ªùi d√πng t√°ch bi·ªát c√°c ho·∫°t ƒë·ªông kh·ªèi quy t·∫Øc giao d·ªãch. <code>TransactionTemplate</code> l√† API c·ªët l√µi ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ h·ªó tr·ª£ giao d·ªãch theo c√°ch l·∫≠p tr√¨nh.</p><p>Vi·ªác s·ª≠ d·ª•ng <code>TransactionTemplate</code> t∆∞∆°ng t·ª± nh∆∞ vi·ªác s·ª≠ d·ª•ng c√°c template Spring kh√°c nh∆∞ JdbcTemplate v√† HibernateTemplate. N√≥ s·ª≠ d·ª•ng ph∆∞∆°ng th·ª©c g·ªçi l·∫°i (callback) ƒë·ªÉ gi·∫£i ph√≥ng ·ª©ng d·ª•ng kh·ªèi vi·ªác x·ª≠ l√Ω l·∫•y v√† gi·∫£i ph√≥ng t√†i nguy√™n. Gi·ªëng nh∆∞ c√°c template kh√°c, <code>TransactionTemplate</code> l√† lu·ªìng an to√†n. ƒêo·∫°n m√£ sau ƒë√¢y l√† m·ªôt v√≠ d·ª• v·ªÅ vi·ªác s·ª≠ d·ª•ng <code>TransactionTemplate</code>:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    TransactionTemplate</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> tt </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> TransactionTemplate</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // T·∫°o m·ªôt TransactionTemplate m·ªõi</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> result </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> tt</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">execute</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> TransactionCallback</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> doTransaction</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TransactionStatus</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">){</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">                updateOperation</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> resultOfUpdateOperation</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Th·ª±c thi ph∆∞∆°ng th·ª©c execute ƒë·ªÉ qu·∫£n l√Ω giao d·ªãch</span></span></code></pre></div><p><code>TransactionCallback()</code> c√≥ th·ªÉ tr·∫£ v·ªÅ m·ªôt gi√° tr·ªã. N·∫øu s·ª≠ d·ª•ng <code>TransactionCallbackWithoutResult</code>, th√¨ kh√¥ng c√≥ gi√° tr·ªã tr·∫£ v·ªÅ.</p><h2 id="quan-ly-giao-dich-theo-cach-khai-bao" tabindex="-1"><a class="header-anchor" href="#quan-ly-giao-dich-theo-cach-khai-bao"><span>Qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o</span></a></h2><blockquote><p>H·∫ßu h·∫øt ng∆∞·ªùi d√πng Spring ƒë·ªÅu ch·ªçn qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o. T√πy ch·ªçn n√†y ·∫£nh h∆∞·ªüng √≠t nh·∫•t ƒë·∫øn m√£ ·ª©ng d·ª•ng, do ƒë√≥ ph√π h·ª£p nh·∫•t v·ªõi l√Ω t∆∞·ªüng c·ªßa m·ªôt container nh·∫π kh√¥ng x√¢m nh·∫≠p.</p></blockquote><p>Qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o trong Spring Framework ƒë∆∞·ª£c th·ª±c hi·ªán th√¥ng qua Spring AOP. Tuy nhi√™n, v√¨ m√£ li√™n quan ƒë·∫øn giao d·ªãch ƒë∆∞·ª£c cung c·∫•p c√πng v·ªõi b·∫£n ph√¢n ph·ªëi Spring v√† c√≥ th·ªÉ ƒë∆∞·ª£c s·ª≠ d·ª•ng theo c√°ch m·∫´u, n√™n th∆∞·ªùng kh√¥ng c·∫ßn hi·ªÉu r√µ v·ªÅ kh√°i ni·ªám AOP ƒë·ªÉ s·ª≠ d·ª•ng m√£ n√†y m·ªôt c√°ch hi·ªáu qu·∫£.</p><p>Qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o trong Spring Framework t∆∞∆°ng t·ª± nh∆∞ EJB CMT, v√¨ b·∫°n c√≥ th·ªÉ ch·ªâ ƒë·ªãnh h√†nh vi giao d·ªãch (ho·∫∑c thi·∫øu n√≥) cho t·ª´ng ph∆∞∆°ng th·ª©c c·ª• th·ªÉ. N·∫øu c·∫ßn thi·∫øt, b·∫°n c√≥ th·ªÉ g·ªçi <code>setRollbackOnly()</code> trong ng·ªØ c·∫£nh giao d·ªãch. S·ª± kh√°c bi·ªát gi·ªØa hai lo·∫°i qu·∫£n l√Ω giao d·ªãch l√†:</p><ul><li>Kh√°c v·ªõi EJB CMT ƒë∆∞·ª£c li√™n k·∫øt v·ªõi JTA, qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o trong Spring Framework ph√π h·ª£p v·ªõi m√¥i tr∆∞·ªùng b·∫•t k·ª≥. B·∫±ng c√°ch ƒëi·ªÅu ch·ªânh t·ªáp c·∫•u h√¨nh, n√≥ c√≥ th·ªÉ s·ª≠ d·ª•ng giao d·ªãch JTA ho·∫∑c giao d·ªãch c·ª•c b·ªô b·∫±ng JDBC, JPA ho·∫∑c Hibernate.</li><li>B·∫°n c√≥ th·ªÉ √°p d·ª•ng qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o c·ªßa Spring cho b·∫•t k·ª≥ l·ªõp n√†o, kh√¥ng ch·ªâ l√† c√°c l·ªõp ƒë·∫∑c bi·ªát nh∆∞ EJB.</li><li>Spring cung c·∫•p quy t·∫Øc rollback theo c√°ch khai b√°o, ƒë√¢y l√† m·ªôt t√≠nh nƒÉng kh√¥ng c√≥ trong EJB t∆∞∆°ng ƒë∆∞∆°ng. N√≥ cung c·∫•p h·ªó tr·ª£ cho quy t·∫Øc rollback c·∫£ trong vi·ªác l·∫≠p tr√¨nh v√† khai b√°o.</li><li>Spring cho ph√©p b·∫°n t√πy ch·ªânh h√†nh vi giao d·ªãch b·∫±ng AOP. V√≠ d·ª•, b·∫°n c√≥ th·ªÉ ch√®n h√†nh vi t√πy ch·ªânh trong tr∆∞·ªùng h·ª£p giao d·ªãch b·ªã rollback. B·∫°n c≈©ng c√≥ th·ªÉ th√™m b·∫•t k·ª≥ advice n√†o, bao g·ªìm advice v·ªÅ giao d·ªãch. Trong EJB CMT, b·∫°n kh√¥ng th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn qu·∫£n l√Ω giao d·ªãch c·ªßa container tr·ª´ khi s·ª≠ d·ª•ng <code>setRollbackOnly()</code>.</li><li>Spring kh√¥ng h·ªó tr·ª£ vi·ªác truy·ªÅn ng·ªØ c·∫£nh giao d·ªãch qua c√°c cu·ªôc g·ªçi t·ª´ xa nh∆∞ c√°c m√°y ch·ªß ·ª©ng d·ª•ng cao c·∫•p. N·∫øu b·∫°n c·∫ßn t√≠nh nƒÉng n√†y, ch√∫ng t√¥i khuy·∫øn ngh·ªã s·ª≠ d·ª•ng EJB. Tuy nhi√™n, h√£y c√¢n nh·∫Øc k·ªπ tr∆∞·ªõc khi s·ª≠ d·ª•ng t√≠nh nƒÉng n√†y, v√¨ th∆∞·ªùng kh√¥ng mu·ªën giao d·ªãch tr·∫£i d√†i qua c√°c cu·ªôc g·ªçi t·ª´ xa.</li></ul><p>Kh√°i ni·ªám v·ªÅ quy t·∫Øc rollback l√† quan tr·ªçng. Ch√∫ng cho ph√©p b·∫°n ch·ªâ ƒë·ªãnh nh·ªØng ngo·∫°i l·ªá (v√† throwable) n√†o s·∫Ω t·ª± ƒë·ªông g√¢y ra vi·ªác rollback. B·∫°n c√≥ th·ªÉ ch·ªâ ƒë·ªãnh n√≥ theo c√°ch khai b√°o trong t·ªáp c·∫•u h√¨nh, thay v√¨ trong m√£ Java. Do ƒë√≥, m·∫∑c d√π b·∫°n v·∫´n c√≥ th·ªÉ g·ªçi <code>setRollbackOnly()</code> tr√™n ƒë·ªëi t∆∞·ª£ng TransactionStatus ƒë·ªÉ rollback giao d·ªãch hi·ªán t·∫°i, nh∆∞ng th∆∞·ªùng b·∫°n c√≥ th·ªÉ ch·ªâ ƒë·ªãnh quy t·∫Øc r·∫±ng MyApplicationException lu√¥n ph·∫£i g√¢y ra rollback. L·ª£i √≠ch ƒë√°ng k·ªÉ c·ªßa t√πy ch·ªçn n√†y l√† ƒë·ªëi t∆∞·ª£ng kinh doanh kh√¥ng ph·ª• thu·ªôc v√†o c∆° s·ªü h·∫° t·∫ßng giao d·ªãch. V√≠ d·ª•, ch√∫ng th∆∞·ªùng kh√¥ng c·∫ßn nh·∫≠p c√°c API giao d·ªãch Spring ho·∫∑c API Spring kh√°c.</p><p>M·∫∑c d√π h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa EJB container l√† t·ª± ƒë·ªông rollback giao d·ªãch tr√™n ngo·∫°i l·ªá h·ªá th·ªëng (th∆∞·ªùng l√† ngo·∫°i l·ªá ch·∫°y th·ªùi gian), nh∆∞ng EJB CMT kh√¥ng t·ª± ƒë·ªông rollback giao d·ªãch tr√™n ngo·∫°i l·ªá ·ª©ng d·ª•ng (nghƒ©a l√† ngo·∫°i l·ªá ki·ªÉm tra ngo·∫°i l·ªá kh√°c RemoteException). M·∫∑c d√π h√†nh vi m·∫∑c ƒë·ªãnh c·ªßa qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o trong Spring tu√¢n theo quy ∆∞·ªõc EJB (rollback ch·ªâ t·ª± ƒë·ªông tr√™n ngo·∫°i l·ªá kh√¥ng ki·ªÉm tra), nh∆∞ng th∆∞·ªùng h·ªØu √≠ch ƒë·ªÉ t√πy ch·ªânh h√†nh vi n√†y.</p><h3 id="trien-khai-quan-ly-giao-dich-theo-cach-khai-bao-cua-spring" tabindex="-1"><a class="header-anchor" href="#trien-khai-quan-ly-giao-dich-theo-cach-khai-bao-cua-spring"><span>Tri·ªÉn khai qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o c·ªßa Spring</span></a></h3><p>V·ªÅ h·ªó tr·ª£ qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o trong Spring Framework, kh√°i ni·ªám quan tr·ªçng nh·∫•t l√† h·ªó tr·ª£ n√†y ƒë∆∞·ª£c k√≠ch ho·∫°t th√¥ng qua AOP proxy v√† advice giao d·ªãch ƒë∆∞·ª£c ƒëi·ªÅu khi·ªÉn b·∫±ng si√™u d·ªØ li·ªáu (hi·ªán t·∫°i l√† d·ª±a tr√™n XML ho·∫∑c d·ª±a tr√™n ch√∫ th√≠ch). S·ª± k·∫øt h·ª£p gi·ªØa AOP v√† si√™u d·ªØ li·ªáu giao d·ªãch t·∫°o ra m·ªôt proxy AOP, s·ª≠ d·ª•ng <code>TransactionInterceptor</code> v√† c√°c implement c·ªßa <code>TransactionManager</code> th√≠ch h·ª£p ƒë·ªÉ ƒëi·ªÅu khi·ªÉn giao d·ªãch xung quanh cu·ªôc g·ªçi ph∆∞∆°ng th·ª©c.</p><p><code>TransactionInterceptor</code> c·ªßa Spring cung c·∫•p qu·∫£n l√Ω giao d·ªãch cho c·∫£ m√¥ h√¨nh l·∫≠p tr√¨nh l·ªánh v√† m√¥ h√¨nh l·∫≠p tr√¨nh ph·∫£n ·ª©ng. Interceptor ph√°t hi·ªán ki·ªÉu qu·∫£n l√Ω giao d·ªãch y√™u c·∫ßu b·∫±ng c√°ch ki·ªÉm tra ki·ªÉu tr·∫£ v·ªÅ c·ªßa ph∆∞∆°ng th·ª©c. Ph∆∞∆°ng th·ª©c tr·∫£ v·ªÅ ki·ªÉu ph·∫£n ·ª©ng, ch·∫≥ng h·∫°n nh∆∞ Publisher ho·∫∑c Kotlin Flow (ho·∫∑c c√°c lo·∫°i con c·ªßa ch√∫ng), ƒë·ªß ƒëi·ªÅu ki·ªán ƒë·ªÉ qu·∫£n l√Ω giao d·ªãch ph·∫£n ·ª©ng. T·∫•t c·∫£ c√°c lo·∫°i tr·∫£ v·ªÅ kh√°c, bao g·ªìm void, s·ª≠ d·ª•ng qu·∫£n l√Ω giao d·ªãch l·ªánh.</p><p>Ki·ªÉu qu·∫£n l√Ω giao d·ªãch ·∫£nh h∆∞·ªüng ƒë·∫øn lo·∫°i qu·∫£n l√Ω giao d·ªãch c·∫ßn thi·∫øt. Qu·∫£n l√Ω giao d·ªãch l·ªánh y√™u c·∫ßu <code>PlatformTransactionManager</code>, trong khi qu·∫£n l√Ω giao d·ªãch ph·∫£n ·ª©ng s·ª≠ d·ª•ng <code>ReactiveTransactionManager</code>.</p><blockquote><p><code>@Transactional</code> th∆∞·ªùng ƒë∆∞·ª£c s·ª≠ d·ª•ng c√πng v·ªõi giao d·ªãch ƒë∆∞·ª£c r√†ng bu·ªôc v·ªõi lu·ªìng ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi <code>PlatformTransactionManager</code>, l√†m cho giao d·ªãch c√≥ s·∫µn cho t·∫•t c·∫£ c√°c ho·∫°t ƒë·ªông truy c·∫≠p d·ªØ li·ªáu trong lu·ªìng th·ª±c thi hi·ªán t·∫°i. L∆∞u √Ω: ƒêi·ªÅu n√†y kh√¥ng ƒë∆∞·ª£c truy·ªÅn cho c√°c lu·ªìng m·ªõi ƒë∆∞·ª£c kh·ªüi ƒë·ªông trong ph∆∞∆°ng th·ª©c.</p><p>Giao d·ªãch ph·∫£n ·ª©ng ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi <code>ReactiveTransactionManager</code> s·ª≠ d·ª•ng ng·ªØ c·∫£nh Reactor thay v√¨ thu·ªôc t√≠nh c·ª•c b·ªô c·ªßa lu·ªìng. Do ƒë√≥, t·∫•t c·∫£ c√°c ho·∫°t ƒë·ªông truy c·∫≠p d·ªØ li·ªáu tham gia ƒë·ªÅu c·∫ßn ƒë∆∞·ª£c th·ª±c hi·ªán trong c√πng m·ªôt lu·ªìng Reactor trong c√πng m·ªôt ng·ªØ c·∫£nh Reactor.</p></blockquote><h3 id="vi-du-ve-quan-ly-giao-dich-theo-cach-khai-bao" tabindex="-1"><a class="header-anchor" href="#vi-du-ve-quan-ly-giao-dich-theo-cach-khai-bao"><span>V√≠ d·ª• v·ªÅ qu·∫£n l√Ω giao d·ªãch theo c√°ch khai b√°o</span></a></h3><p>Xem x√©t interface v√† l·ªõp c√†i ƒë·∫∑t ƒëi k√®m sau ƒë√¢y. V√≠ d·ª• n√†y s·ª≠ d·ª•ng l·ªõp Foo v√† Bar nh∆∞ c√°c ƒë·ªëi t∆∞·ª£ng gi·∫£ ƒë·ªÉ b·∫°n c√≥ th·ªÉ t·∫≠p trung v√†o vi·ªác s·ª≠ d·ª•ng giao d·ªãch m√† kh√¥ng c·∫ßn quan t√¢m ƒë·∫øn m√¥ h√¨nh mi·ªÅn c·ª• th·ªÉ. Trong tr∆∞·ªùng h·ª£p n√†y, vi·ªác l·ªõp DefaultFooService n√©m m·ªôt instance UnsupportedOperationException trong th√¢n c·ªßa m·ªói ph∆∞∆°ng th·ª©c ƒë√£ ƒë∆∞·ª£c tri·ªÉn khai l√† t·ªët. H√†nh vi n√†y cho ph√©p b·∫°n xem giao d·ªãch ƒëang ƒë∆∞·ª£c t·∫°o v√† sau ƒë√≥ rollback ƒë·ªÉ ph·∫£n h·ªìi UnsupportedOperationException.</p><p>D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• v·ªÅ interface FooService:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// interface d·ªãch v·ª• m√† ch√∫ng ta mu·ªën qu·∫£n l√Ω giao d·ªãch</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> x.y.service</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> FooService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Foo</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> fooName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Foo</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> fooName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> barName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> insertFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Foo</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> foo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> updateFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Foo</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> foo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• v·ªÅ l·ªõp c√†i ƒë·∫∑t cho interface tr√™n:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">package</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> x.y.service</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> DefaultFooService</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> FooService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Foo</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> fooName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Foo</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> fooName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> barName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> insertFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Foo</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> foo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> updateFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Foo</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> foo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Gi·∫£ s·ª≠ hai ph∆∞∆°ng th·ª©c ƒë·∫ßu ti√™n c·ªßa interface FooService, getFoo(String) v√† getFoo(String, String), ph·∫£i ch·∫°y trong ng·ªØ c·∫£nh giao d·ªãch ch·ªâ ƒë·ªçc, trong khi c√°c ph∆∞∆°ng th·ª©c kh√°c insertFoo(Foo) v√† updateFoo(Foo) ph·∫£i ch·∫°y trong ng·ªØ c·∫£nh giao d·ªãch ƒë·ªçc/ghi. C·∫•u h√¨nh d∆∞·ªõi ƒë√¢y s·∫Ω ƒë∆∞·ª£c gi·∫£i th√≠ch chi ti·∫øt trong c√°c ph·∫ßn ti·∫øp theo:</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&lt;!-- from the file &#39;context.xml&#39; --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;?</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">xml</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> version</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;1.0&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> encoding</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;UTF-8&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> xmlns</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">    xmlns:xsi</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">    xmlns:aop</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/aop&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">    xmlns:tx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/tx&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">    xsi:schemaLocation</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        http://www.springframework.org/schema/beans</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        http://www.springframework.org/schema/tx</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        https://www.springframework.org/schema/tx/spring-tx.xsd</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        http://www.springframework.org/schema/aop</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!-- this is the service object that we want to make transactional --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;fooService&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;x.y.service.DefaultFooService&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!-- the transactional advice (what &#39;happens&#39;; see the &lt;aop:advisor/&gt; bean below) --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> transaction-manager</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;txManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        &lt;!-- the transactional semantics... --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            &lt;!-- all methods starting with &#39;get&#39; are read-only --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;get*&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> read-only</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;true&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            &lt;!-- other methods use the default transaction settings (see below) --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!-- ensure that the above transactional advice runs for any execution</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        of an operation defined by the FooService interface --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:pointcut</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;fooServiceOperation&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> expression</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;execution(* x.y.service.FooService.*(..))&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:advisor</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> advice-ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> pointcut-ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;fooServiceOperation&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!-- don&#39;t forget the DataSource --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;org.apache.commons.dbcp.BasicDataSource&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> destroy-method</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;close&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;driverClassName&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;oracle.jdbc.driver.OracleDriver&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;url&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;jdbc:oracle:thin:@rj-t42:1521:elvis&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;username&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;scott&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;password&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;tiger&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!-- similarly, don&#39;t forget the TransactionManager --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;txManager&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!-- other &lt;bean/&gt; definitions here --&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>H√£y xem x√©t c·∫•u h√¨nh tr√™n. N√≥ gi·∫£ ƒë·ªãnh r·∫±ng b·∫°n mu·ªën l√†m cho ƒë·ªëi t∆∞·ª£ng d·ªãch v·ª• fooService bean c√≥ t√≠nh ch·∫•t giao d·ªãch. C√°c ng·ªØ nghƒ©a giao d·ªãch c·∫ßn √°p d·ª•ng ƒë∆∞·ª£c ƒë√≥ng g√≥i trong <code>&lt;tx:advice/&gt;</code> ƒë·ªãnh nghƒ©a. <code>&lt;tx:advice/&gt;</code> ƒë·ªãnh nghƒ©a ƒë∆∞·ª£c ƒë·ªçc l√† &quot;t·∫•t c·∫£ c√°c ph∆∞∆°ng th·ª©c b·∫Øt ƒë·∫ßu b·∫±ng &#39;get&#39; s·∫Ω ch·∫°y trong ng·ªØ c·∫£nh giao d·ªãch ch·ªâ ƒë·ªçc, t·∫•t c·∫£ c√°c ph∆∞∆°ng th·ª©c kh√°c s·∫Ω ch·∫°y v·ªõi ng·ªØ c·∫£nh giao d·ªãch m·∫∑c ƒë·ªãnh&quot;. Thu·ªôc t√≠nh <code>transaction-manager</code> c·ªßa th·∫ª <code>&lt;tx:advice/&gt;</code> ƒë∆∞·ª£c ƒë·∫∑t th√†nh t√™n c·ªßa bean TransactionManager s·∫Ω ƒëi·ªÅu khi·ªÉn giao d·ªãch (trong tr∆∞·ªùng h·ª£p n√†y l√† bean txManager).</p><blockquote><p>N·∫øu t√™n bean c·ªßa TransactionManager m√† b·∫°n mu·ªën k·∫øt n·ªëi c√≥ t√™n l√† transactionManager, b·∫°n c√≥ th·ªÉ b·ªè qua thu·ªôc t√≠nh transaction-manager trong advice giao d·ªãch (tx:advice/). N·∫øu t√™n bean c·ªßa TransactionManager c·∫ßn k·∫øt n·ªëi c√≥ b·∫•t k·ª≥ t√™n n√†o kh√°c, b·∫°n ph·∫£i s·ª≠ d·ª•ng thu·ªôc t√≠nh transaction-manager m·ªôt c√°ch r√µ r√†ng, nh∆∞ trong v√≠ d·ª• tr∆∞·ªõc.</p></blockquote><p><code>&lt;aop:config/&gt;</code> ƒë·∫£m b·∫£o r·∫±ng l·ªùi khuy√™n giao d·ªãch ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·ªüi <code>txAdvice</code> bean s·∫Ω ch·∫°y ·ªü v·ªã tr√≠ th√≠ch h·ª£p trong ch∆∞∆°ng tr√¨nh. ƒê·∫ßu ti√™n, b·∫°n ƒë·ªãnh nghƒ©a m·ªôt ƒëi·ªÉm c·∫Øt (pointcut) t∆∞∆°ng ·ª©ng v·ªõi vi·ªác th·ª±c hi·ªán b·∫•t k·ª≥ ho·∫°t ƒë·ªông n√†o ƒë∆∞·ª£c x√°c ƒë·ªãnh b·ªüi <code>FooService</code> interface (fooServiceOperation). Sau ƒë√≥, b·∫°n s·ª≠ d·ª•ng m·ªôt advisor ƒë·ªÉ li√™n k·∫øt ƒëi·ªÉm c·∫Øt v·ªõi <code>txAdvice</code>. K·∫øt qu·∫£ l√† khi th·ª±c hi·ªán fooServiceOperation, l·ªùi khuy√™n ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·ªüi <code>txAdvice</code> s·∫Ω ch·∫°y.</p><p>M·ªôt y√™u c·∫ßu ph·ªï bi·∫øn l√† l√†m cho to√†n b·ªô t·∫ßng d·ªãch v·ª• c√≥ t√≠nh ch·∫•t giao d·ªãch. C√°ch t·ªët nh·∫•t l√† thay ƒë·ªïi bi·ªÉu th·ª©c ƒëi·ªÉm c·∫Øt ƒë·ªÉ ph√π h·ª£p v·ªõi b·∫•t k·ª≥ ho·∫°t ƒë·ªông n√†o trong t·∫ßng d·ªãch v·ª•. V√≠ d·ª• sau cho th·∫•y c√°ch th·ª±c hi·ªán ƒëi·ªÅu n√†y:</p><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:pointcut</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;fooServiceMethods&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> expression</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;execution(* x.y.service.*.*(..))&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:advisor</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> advice-ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> pointcut-ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;fooServiceMethods&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p>C·∫•u h√¨nh tr√™n ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o ra m·ªôt proxy giao d·ªãch xung quanh ƒë·ªëi t∆∞·ª£ng ƒë∆∞·ª£c x√°c ƒë·ªãnh b·ªüi bean fooService. Proxy ƒë∆∞·ª£c c·∫•u h√¨nh v·ªõi l·ªùi khuy√™n giao d·ªãch ƒë·ªÉ kh·ªüi ƒë·ªông, t·∫°m d·ª´ng, ƒë√°nh d·∫•u ch·ªâ ƒë·ªçc v√† c√°c giao d·ªãch kh√°c t√πy thu·ªôc v√†o c·∫•u h√¨nh giao d·ªãch li√™n k·∫øt v·ªõi ph∆∞∆°ng th·ª©c ƒë√≥. Xem x√©t ch∆∞∆°ng tr√¨nh ki·ªÉm tra ƒë∆∞·ª£c th√∫c ƒë·∫©y b·ªüi c·∫•u h√¨nh tr∆∞·ªõc ƒë√≥:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Boot</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">final</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        ApplicationContext</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> ctx</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ClassPathXmlApplicationContext</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;context.xml&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        FooService</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> fooService</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ctx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getBean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FooService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        fooService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">insertFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Foo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="rollback-trong-mot-giao-dich-khai-bao" tabindex="-1"><a class="header-anchor" href="#rollback-trong-mot-giao-dich-khai-bao"><span>Rollback trong m·ªôt giao d·ªãch khai b√°o</span></a></h3><p>Trong Spring Framework, c√°ch khuy·∫øn ngh·ªã ƒë·ªÉ k√≠ch ho·∫°t vi·ªác rollback giao d·ªãch l√† n√©m m·ªôt ngo·∫°i l·ªá trong ng·ªØ c·∫£nh giao d·ªãch. Spring Transaction Framework s·∫Ω b·∫Øt c√°c ngo·∫°i l·ªá ch∆∞a ƒë∆∞·ª£c x·ª≠ l√Ω v√† x√°c ƒë·ªãnh xem li·ªáu c√≥ ƒë√°nh d·∫•u giao d·ªãch ƒë·ªÉ rollback hay kh√¥ng.</p><p>Trong c·∫•u h√¨nh m·∫∑c ƒë·ªãnh c·ªßa n√≥, Spring Transaction Framework ch·ªâ ƒë√°nh d·∫•u giao d·ªãch ƒë·ªÉ rollback khi c√≥ ngo·∫°i l·ªá ch·∫°y th·ªùi gian ch∆∞a ƒë∆∞·ª£c ki·ªÉm tra. ƒêi·ªÅu n√†y c√≥ nghƒ©a l√† khi ngo·∫°i l·ªá ƒë∆∞·ª£c n√©m l√† m·ªôt instance c·ªßa RuntimeException ho·∫∑c l·ªõp con c·ªßa n√≥. (M·∫∑c ƒë·ªãnh, c√°c instance c·ªßa Error c≈©ng s·∫Ω d·∫´n ƒë·∫øn vi·ªác rollback). C√°c ngo·∫°i l·ªá ki·ªÉm tra ƒë∆∞·ª£c n√©m t·ª´ ph∆∞∆°ng th·ª©c giao d·ªãch kh√¥ng g√¢y rollback trong c·∫•u h√¨nh m·∫∑c ƒë·ªãnh.</p><p>B·∫°n c√≥ th·ªÉ x√°c ƒë·ªãnh c√°c quy t·∫Øc rollback c·ª• th·ªÉ b·∫±ng c√°ch ch·ªâ ƒë·ªãnh c√°c lo·∫°i ngo·∫°i l·ªá s·∫Ω d·∫´n ƒë·∫øn vi·ªác rollback giao d·ªãch.</p><blockquote><p>Quy t·∫Øc rollback ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a b·∫±ng c√°ch ch·ªâ ƒë·ªãnh m·∫´u cho c√°c ngo·∫°i l·ªá s·∫Ω d·∫´n ƒë·∫øn vi·ªác rollback khi ch√∫ng ƒë∆∞·ª£c n√©m.</p><p>Quy t·∫Øc rollback c√≥ th·ªÉ ƒë∆∞·ª£c c·∫•u h√¨nh trong XML b·∫±ng c√°ch s·ª≠ d·ª•ng thu·ªôc t√≠nh <code>rollback-for</code> v√† <code>no-rollback-for</code>, cho ph√©p ch·ªâ ƒë·ªãnh m·∫´u d∆∞·ªõi d·∫°ng chu·ªói. Khi s·ª≠ d·ª•ng <code>@Transactional</code>, b·∫°n c√≥ th·ªÉ c·∫•u h√¨nh quy t·∫Øc rollback b·∫±ng c√°ch s·ª≠ d·ª•ng c√°c thu·ªôc t√≠nh <code>rollbackFor</code> / <code>noRollbackFor</code> v√† <code>rollbackForClassName</code> / <code>noRollbackForClassName</code>, cho ph√©p ch·ªâ ƒë·ªãnh m·∫´u d∆∞·ªõi d·∫°ng tham chi·∫øu l·ªõp ho·∫∑c chu·ªói. Khi lo·∫°i ngo·∫°i l·ªá ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh l√† tham chi·∫øu l·ªõp, t√™n ƒë·∫ßy ƒë·ªß c·ªßa n√≥ s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng l√†m m·∫´u. V√¨ v·∫≠y, <code>@Transactional(rollbackFor = example.CustomException.class)</code> t∆∞∆°ng ƒë∆∞∆°ng v·ªõi <code>@Transactional(rollbackForClassName = &#39;example.CustomException&#39;)</code>.</p></blockquote><p>D∆∞·ªõi ƒë√¢y l√† m·ªôt ƒëo·∫°n m√£ XML m√¥ t·∫£ c√°ch c·∫•u h√¨nh m·∫´u ngo·∫°i l·ªá ƒë·ªÉ ch·ªâ ƒë·ªãnh rollback cho m·ªôt s·ªë lo·∫°i Exception ƒë√£ ƒë∆∞·ª£c ki·ªÉm tra:</p><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> transaction-manager</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;txManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;get*&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> read-only</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;true&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> rollback-for</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;NoProductInStockException&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p>N·∫øu b·∫°n kh√¥ng mu·ªën rollback giao d·ªãch khi ngo·∫°i l·ªá ƒë∆∞·ª£c n√©m, b·∫°n c≈©ng c√≥ th·ªÉ ch·ªâ ƒë·ªãnh quy t·∫Øc &quot;kh√¥ng rollback&quot;. V√≠ d·ª• d∆∞·ªõi ƒë√¢y cho bi·∫øt r·∫±ng, ngay c·∫£ khi c√≥ m·ªôt InstrumentNotFoundException ch∆∞a ƒë∆∞·ª£c x·ª≠ l√Ω, giao d·ªãch ph·ª• tr·ª£ v·∫´n s·∫Ω ƒë∆∞·ª£c commit.</p><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;updateStock&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> no-rollback-for</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;InstrumentNotFoundException&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p>Khi Spring Transaction Framework b·∫Øt ƒë∆∞·ª£c ngo·∫°i l·ªá v√† ki·ªÉm tra c√°c quy t·∫Øc rollback ƒë√£ ƒë∆∞·ª£c c·∫•u h√¨nh ƒë·ªÉ x√°c ƒë·ªãnh xem c√≥ ƒë√°nh d·∫•u giao d·ªãch ƒë·ªÉ rollback hay kh√¥ng, quy t·∫Øc kh·ªõp t·ªët nh·∫•t s·∫Ω quy·∫øt ƒë·ªãnh. V√¨ v·∫≠y, trong c·∫•u h√¨nh sau, b·∫•t k·ª≥ ngo·∫°i l·ªá n√†o ngo·∫°i tr·ª´ <code>InstrumentNotFoundException</code> ƒë·ªÅu s·∫Ω d·∫´n ƒë·∫øn vi·ªác rollback giao d·ªãch.</p><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> rollback-for</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Throwable&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> no-rollback-for</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;InstrumentNotFoundException&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p>B·∫°n c≈©ng c√≥ th·ªÉ ch·ªâ ƒë·ªãnh rollback theo c√°ch th·ªß c√¥ng n·∫øu b·∫°n mu·ªën. M·∫∑c d√π ƒë∆°n gi·∫£n, qu√° tr√¨nh n√†y r·∫•t x√¢m nh·∫≠p v√† l√†m cho m√£ c·ªßa b·∫°n ph·ª• thu·ªôc ch·∫∑t ch·∫Ω v√†o c∆° s·ªü h·∫° t·∫ßng giao d·ªãch c·ªßa Spring Framework. V√≠ d·ª• d∆∞·ªõi ƒë√¢y cho th·∫•y c√°ch th·ªß c√¥ng rollback.</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> resolvePosition</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // m·ªôt s·ªë logic kinh doanh...</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NoProductInStockException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // k√≠ch ho·∫°t rollback theo c√°ch th·ªß c√¥ng</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        TransactionAspectSupport</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">currentTransactionStatus</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setRollbackOnly</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>N·∫øu c√≥ th·ªÉ, ch√∫ng t√¥i khuy·∫øn ngh·ªã s·ª≠ d·ª•ng rollback theo c√°ch khai b√°o. N·∫øu tuy·ªát ƒë·ªëi c·∫ßn thi·∫øt, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng rollback theo c√°ch th·ªß c√¥ng, nh∆∞ng vi·ªác s·ª≠ d·ª•ng n√≥ l√†m m·∫•t t√≠nh s·∫°ch c·ªßa ki·∫øn tr√∫c d·ª±a tr√™n POJO.</p><h3 id="cau-hinh-ngu-canh-giao-dich-khac-nhau-cho-cac-bean-khac-nhau" tabindex="-1"><a class="header-anchor" href="#cau-hinh-ngu-canh-giao-dich-khac-nhau-cho-cac-bean-khac-nhau"><span>C·∫•u h√¨nh ng·ªØ c·∫£nh giao d·ªãch kh√°c nhau cho c√°c Bean kh√°c nhau</span></a></h3><p>Gi·∫£ s·ª≠ b·∫°n c√≥ m·ªôt t√¨nh hu·ªëng trong ƒë√≥ b·∫°n c√≥ nhi·ªÅu ƒë·ªëi t∆∞·ª£ng d·ªãch v·ª• v√† b·∫°n mu·ªën √°p d·ª•ng c·∫•u h√¨nh giao d·ªãch ho√†n to√†n kh√°c nhau cho m·ªói ƒë·ªëi t∆∞·ª£ng. B·∫°n c√≥ th·ªÉ l√†m ƒëi·ªÅu n√†y b·∫±ng c√°ch ƒë·ªãnh nghƒ©a c√°c ƒëi·ªÉm c·∫Øt (pointcut) kh√°c nhau v·ªõi c√°c gi√° tr·ªã <code>advice-ref</code> kh√°c nhau trong c√°c ph·∫ßn t·ª≠ <code>&lt;aop:advisor/&gt;</code>.</p><p>V√≠ d·ª•, gi·∫£ s·ª≠ t·∫•t c·∫£ c√°c l·ªõp d·ªãch v·ª• c·ªßa b·∫°n ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a trong g√≥i g·ªëc <code>x.y.service</code>. ƒê·ªÉ √°p d·ª•ng c·∫•u h√¨nh giao d·ªãch m·∫∑c ƒë·ªãnh cho t·∫•t c·∫£ c√°c bean c√≥ t√™n k·∫øt th√∫c b·∫±ng &quot;Service&quot; trong g√≥i n√†y (ho·∫∑c c√°c g√≥i con), b·∫°n c√≥ th·ªÉ vi·∫øt nh∆∞ sau:</p><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:pointcut</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;serviceOperation&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> expression</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;execution(* x.y.service..*Service.*(..))&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:advisor</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> pointcut-ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;serviceOperation&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> advice-ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;txAdvice&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p>Trong v√≠ d·ª• tr√™n, t·∫•t c·∫£ c√°c bean c√≥ t√™n k·∫øt th√∫c b·∫±ng &quot;Service&quot; trong g√≥i <code>x.y.service</code> (v√† c√°c g√≥i con) s·∫Ω c√≥ c·∫•u h√¨nh giao d·ªãch m·∫∑c ƒë·ªãnh. B·∫°n c≈©ng c√≥ th·ªÉ ƒë·ªãnh nghƒ©a c√°c ƒëi·ªÉm c·∫Øt kh√°c v√† li√™n k·∫øt ch√∫ng v·ªõi c√°c <code>advice</code> kh√°c nhau ƒë·ªÉ √°p d·ª•ng c·∫•u h√¨nh giao d·ªãch kh√°c nhau cho c√°c bean kh√°c nhau.</p><p>D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• v·ªÅ c√°ch c·∫•u h√¨nh hai bean kh√°c nhau v·ªõi c·∫•u h√¨nh giao d·ªãch ho√†n to√†n kh√°c nhau:</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:pointcut</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;defaultServiceOperation&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> expression</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;execution(* x.y.service.*Service.*(..))&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:pointcut</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;noTxServiceOperation&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> expression</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;execution(* x.y.service.ddl.DefaultDdlManager.*(..))&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:advisor</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> pointcut-ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;defaultServiceOperation&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> advice-ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;defaultTxAdvice&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:advisor</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> pointcut-ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;noTxServiceOperation&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> advice-ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;noTxAdvice&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">aop:config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&lt;!-- bean n√†y s·∫Ω c√≥ giao d·ªãch (xem ƒëi·ªÉm c·∫Øt &#39;defaultServiceOperation&#39;) --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;fooService&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;x.y.service.DefaultFooService&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&lt;!-- bean n√†y c≈©ng s·∫Ω c√≥ giao d·ªãch, nh∆∞ng v·ªõi c·∫•u h√¨nh giao d·ªãch ho√†n to√†n kh√°c nhau --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;anotherFooService&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;x.y.service.ddl.DefaultDdlManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;defaultTxAdvice&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;get*&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> read-only</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;true&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;noTxAdvice&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:method</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> propagation</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;NEVER&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:attributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:advice</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong v√≠ d·ª• tr√™n, bean <code>fooService</code> s·∫Ω c√≥ c·∫•u h√¨nh giao d·ªãch m·∫∑c ƒë·ªãnh, trong khi bean <code>anotherFooService</code> s·∫Ω c√≥ c·∫•u h√¨nh giao d·ªãch ho√†n to√†n kh√°c nhau.</p><h3 id="cau-hinh-tx-advice" tabindex="-1"><a class="header-anchor" href="#cau-hinh-tx-advice"><span>C·∫•u h√¨nh <code>&lt;tx:advice/&gt;</code></span></a></h3><p>C·∫•u h√¨nh m·∫∑c ƒë·ªãnh c·ªßa <code>&lt;tx:advice/&gt;</code> l√†:</p><ul><li>Propagation ƒë∆∞·ª£c ƒë·∫∑t l√† <code>REQUIRED</code></li><li>Isolation level l√† <code>DEFAULT</code></li><li>Transaction l√† read-write</li><li>Transaction timeout m·∫∑c ƒë·ªãnh l√† timeout m·∫∑c ƒë·ªãnh c·ªßa h·ªá th·ªëng giao d·ªãch c∆° s·ªü, n·∫øu kh√¥ng h·ªó tr·ª£ timeout th√¨ l√† kh√¥ng c√≥ timeout.</li><li>B·∫•t k·ª≥ <code>RuntimeException</code> n√†o s·∫Ω g√¢y ra rollback, trong khi b·∫•t k·ª≥ <code>Exception</code> ƒë√£ ƒë∆∞·ª£c ki·ªÉm tra n√†o s·∫Ω kh√¥ng g√¢y ra rollback.</li></ul><p>Thu·ªôc t√≠nh c·∫•u h√¨nh c·ªßa <code>&lt;tx:advice/&gt;</code></p><table><thead><tr><th style="text-align:left;">Thu·ªôc t√≠nh</th><th style="text-align:left;">B·∫Øt bu·ªôc</th><th style="text-align:left;">Gi√° tr·ªã m·∫∑c ƒë·ªãnh</th><th style="text-align:left;">M√¥ t·∫£</th></tr></thead><tbody><tr><td style="text-align:left;"><code>name</code></td><td style="text-align:left;">C√≥</td><td style="text-align:left;"></td><td style="text-align:left;">T√™n ph∆∞∆°ng th·ª©c li√™n quan ƒë·∫øn thu·ªôc t√≠nh giao d·ªãch. H·ªó tr·ª£ k√Ω t·ª± ƒë·∫°i di·ªán nh∆∞ <code>get*</code>, <code>handle*</code>, <code>on*Event</code>.</td></tr><tr><td style="text-align:left;"><code>propagation</code></td><td style="text-align:left;">Kh√¥ng</td><td style="text-align:left;"><code>REQUIRED</code></td><td style="text-align:left;">H√†nh vi truy·ªÅn giao d·ªãch</td></tr><tr><td style="text-align:left;"><code>isolation</code></td><td style="text-align:left;">Kh√¥ng</td><td style="text-align:left;"><code>DEFAULT</code></td><td style="text-align:left;">M·ª©c ƒë·ªô c√¥ l·∫≠p giao d·ªãch. Ch·ªâ √°p d·ª•ng cho propagation setting <code>REQUIRED</code> ho·∫∑c <code>REQUIRES_NEW</code>.</td></tr><tr><td style="text-align:left;"><code>timeout</code></td><td style="text-align:left;">Kh√¥ng</td><td style="text-align:left;">-1</td><td style="text-align:left;">Th·ªùi gian timeout giao d·ªãch (ƒë∆°n v·ªã: gi√¢y). Ch·ªâ √°p d·ª•ng cho propagation setting <code>REQUIRED</code> ho·∫∑c <code>REQUIRES_NEW</code>.</td></tr><tr><td style="text-align:left;"><code>read-only</code></td><td style="text-align:left;">Kh√¥ng</td><td style="text-align:left;">false</td><td style="text-align:left;">Giao d·ªãch read-write ho·∫∑c read-only.</td></tr><tr><td style="text-align:left;"><code>rollback-for</code></td><td style="text-align:left;">Kh√¥ng</td><td style="text-align:left;"></td><td style="text-align:left;">Danh s√°ch c√°c instance <code>Exception</code> g√¢y ra rollback (ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y).</td></tr><tr><td style="text-align:left;"><code>no-rollback-for</code></td><td style="text-align:left;">Kh√¥ng</td><td style="text-align:left;"></td><td style="text-align:left;">Danh s√°ch c√°c instance <code>Exception</code> kh√¥ng g√¢y ra rollback (ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y).</td></tr><tr><td style="text-align:left;"></td><td style="text-align:left;"></td><td style="text-align:left;"></td><td style="text-align:left;"></td></tr></tbody></table><h3 id="su-dung-chu-thich-transactional" tabindex="-1"><a class="header-anchor" href="#su-dung-chu-thich-transactional"><span>S·ª≠ d·ª•ng ch√∫ th√≠ch <code>@Transactional</code></span></a></h3><p>Ngo√†i ph∆∞∆°ng ph√°p c·∫•u h√¨nh giao d·ªãch d·ª±a tr√™n XML, b·∫°n c≈©ng c√≥ th·ªÉ s·ª≠ d·ª•ng ph∆∞∆°ng ph√°p d·ª±a tr√™n ch√∫ th√≠ch.</p><p>D∆∞·ªõi ƒë√¢y l√† m·ªôt v√≠ d·ª• v·ªÅ vi·ªác s·ª≠ d·ª•ng ch√∫ th√≠ch <code>@Transactional</code>:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> DefaultFooService</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> FooService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Foo</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> fooName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Foo</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> fooName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> barName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> insertFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Foo</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> foo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> updateFoo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Foo</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> foo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Nh∆∞ ƒë√£ ƒë·ªÅ c·∫≠p ·ªü tr√™n, khi s·ª≠ d·ª•ng ·ªü m·ª©c l·ªõp, ch√∫ th√≠ch <code>@Transactional</code> cho bi·∫øt t·∫•t c·∫£ c√°c ph∆∞∆°ng th·ª©c c·ªßa l·ªõp (v√† c√°c l·ªõp con c·ªßa n√≥) s·∫Ω s·ª≠ d·ª•ng c·∫•u h√¨nh giao d·ªãch m·∫∑c ƒë·ªãnh. Ho·∫∑c, b·∫°n c√≥ th·ªÉ ch·ªâ ƒë·ªãnh ch√∫ th√≠ch cho t·ª´ng ph∆∞∆°ng th·ª©c ri√™ng l·∫ª. L∆∞u √Ω r·∫±ng ch√∫ th√≠ch ·ªü m·ª©c l·ªõp kh√¥ng √°p d·ª•ng cho c√°c l·ªõp t·ªï ti√™n trong c·∫•u tr√∫c l·ªõp; trong tr∆∞·ªùng h·ª£p n√†y, c√°c ph∆∞∆°ng th·ª©c k·∫ø th·ª´a c·∫ßn ƒë∆∞·ª£c khai b√°o l·∫°i c·ª•c b·ªô ƒë·ªÉ tham gia ch√∫ th√≠ch ·ªü m·ª©c l·ªõp con.</p><p>Khi l·ªõp POJO tr√™n ƒë∆∞·ª£c x√°c ƒë·ªãnh l√† bean trong ng·ªØ c·∫£nh Spring, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng ch√∫ th√≠ch <code>@EnableTransactionManagement</code> trong l·ªõp <code>@Configuration</code> ƒë·ªÉ c√°c phi√™n b·∫£n bean c√≥ t√≠nh giao d·ªãch.</p><p>Trong c·∫•u h√¨nh XML, th·∫ª <code>&lt;tx:annotation-driven/&gt;</code> cung c·∫•p ti·ªán √≠ch t∆∞∆°ng t·ª±:</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&lt;!-- from the file &#39;context.xml&#39; --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;?</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">xml</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> version</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;1.0&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> encoding</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;UTF-8&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> xmlns</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">    xmlns:xsi</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">    xmlns:aop</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/aop&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">    xmlns:tx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/tx&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">    xsi:schemaLocation</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        http://www.springframework.org/schema/beans</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        https://www.springframework.org/schema/beans/spring-beans.xsd</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        http://www.springframework.org/schema/tx</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        https://www.springframework.org/schema/tx/spring-tx.xsd</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        http://www.springframework.org/schema/aop</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        https://www.springframework.org/schema/aop/spring-aop.xsd&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!-- this is the service object that we want to make transactional --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;fooService&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;x.y.service.DefaultFooService&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!-- enable the configuration of transactional behavior based on annotations --&gt;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!-- a TransactionManager is still required --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:annotation-driven</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> transaction-manager</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;txManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;txManager&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        &lt;!-- (this dependency is defined somewhere else) --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">property</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> ref</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;dataSource&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!-- other &lt;bean/&gt; definitions here --&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cau-hinh-transactional" tabindex="-1"><a class="header-anchor" href="#cau-hinh-transactional"><span>C·∫•u h√¨nh <code>@Transactional</code></span></a></h4><table><thead><tr><th style="text-align:left;">Thu·ªôc t√≠nh</th><th style="text-align:left;">Ki·ªÉu d·ªØ li·ªáu</th><th style="text-align:left;">M√¥ t·∫£</th></tr></thead><tbody><tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#tx-multiple-tx-mgrs-with-attransactional" target="_blank" rel="noopener noreferrer">value</a></td><td style="text-align:left;"><code>String</code></td><td style="text-align:left;">B·ªô x√°c ƒë·ªãnh t√πy ch·ªçn ch·ªâ ƒë·ªãnh transaction manager s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng.</td></tr><tr><td style="text-align:left;"><code>transactionManager</code></td><td style="text-align:left;"><code>String</code></td><td style="text-align:left;">B√≠ danh cho <code>value</code>.</td></tr><tr><td style="text-align:left;"><code>label</code></td><td style="text-align:left;">M·∫£ng c√°c chu·ªói <code>String</code> ƒë·ªÉ th√™m m√¥ t·∫£ bi·ªÉu ƒë·∫°t cho giao d·ªãch.</td><td style="text-align:left;">Nh√£n c√≥ th·ªÉ ƒë∆∞·ª£c ƒë√°nh gi√° b·ªüi transaction manager ƒë·ªÉ li√™n k·∫øt h√†nh vi c·ª• th·ªÉ v·ªõi giao d·ªãch th·ª±c t·∫ø.</td></tr><tr><td style="text-align:left;"><a href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#tx-propagation" target="_blank" rel="noopener noreferrer">propagation</a></td><td style="text-align:left;"><code>enum</code>: <code>Propagation</code></td><td style="text-align:left;">C√†i ƒë·∫∑t truy·ªÅn giao d·ªãch t√πy ch·ªçn.</td></tr><tr><td style="text-align:left;"><code>isolation</code></td><td style="text-align:left;"><code>enum</code>: <code>Isolation</code></td><td style="text-align:left;">M·ª©c ƒë·ªô c√¥ l·∫≠p t√πy ch·ªçn. Ch·ªâ √°p d·ª•ng cho c√°c gi√° tr·ªã propagation l√† <code>REQUIRED</code> ho·∫∑c <code>REQUIRES_NEW</code>.</td></tr><tr><td style="text-align:left;"><code>timeout</code></td><td style="text-align:left;"><code>int</code> (theo ƒë∆°n v·ªã gi√¢y)</td><td style="text-align:left;">Th·ªùi gian timeout giao d·ªãch t√πy ch·ªçn. Ch·ªâ √°p d·ª•ng cho c√°c gi√° tr·ªã propagation l√† <code>REQUIRED</code> ho·∫∑c <code>REQUIRES_NEW</code>.</td></tr><tr><td style="text-align:left;"><code>timeoutString</code></td><td style="text-align:left;"><code>String</code> (theo ƒë∆°n v·ªã gi√¢y)</td><td style="text-align:left;">T√πy ch·ªçn kh√°c ƒë·ªÉ ch·ªâ ƒë·ªãnh <code>timeout</code> d∆∞·ªõi d·∫°ng chu·ªói <code>String</code> - v√≠ d·ª•: nh∆∞ m·ªôt placeholder.</td></tr><tr><td style="text-align:left;"><code>readOnly</code></td><td style="text-align:left;"><code>boolean</code></td><td style="text-align:left;">Giao d·ªãch read-write ho·∫∑c read-only. Ch·ªâ √°p d·ª•ng cho c√°c gi√° tr·ªã propagation l√† <code>REQUIRED</code> ho·∫∑c <code>REQUIRES_NEW</code>.</td></tr><tr><td style="text-align:left;"><code>rollbackFor</code></td><td style="text-align:left;">M·∫£ng c√°c ƒë·ªëi t∆∞·ª£ng <code>Class</code>, ph·∫£i l√† l·ªõp con c·ªßa <code>Throwable</code>.</td><td style="text-align:left;">M·∫£ng t√πy ch·ªçn c√°c lo·∫°i ngo·∫°i l·ªá ph·∫£i g√¢y ra rollback.</td></tr><tr><td style="text-align:left;"><code>rollbackForClassName</code></td><td style="text-align:left;">M·∫£ng c√°c m·∫´u t√™n ngo·∫°i l·ªá.</td><td style="text-align:left;">M·∫£ng t√πy ch·ªçn c√°c m·∫´u t√™n ngo·∫°i l·ªá ph·∫£i g√¢y ra rollback.</td></tr><tr><td style="text-align:left;"><code>noRollbackFor</code></td><td style="text-align:left;">M·∫£ng c√°c ƒë·ªëi t∆∞·ª£ng <code>Class</code>, ph·∫£i l√† l·ªõp con c·ªßa <code>Throwable</code>.</td><td style="text-align:left;">M·∫£ng t√πy ch·ªçn c√°c lo·∫°i ngo·∫°i l·ªá kh√¥ng ƒë∆∞·ª£c g√¢y ra rollback.</td></tr><tr><td style="text-align:left;"><code>noRollbackForClassName</code></td><td style="text-align:left;">M·∫£ng c√°c m·∫´u t√™n ngo·∫°i l·ªá.</td><td style="text-align:left;">M·∫£ng t√πy ch·ªçn c√°c m·∫´u t√™n ngo·∫°i l·ªá kh√¥ng ƒë∆∞·ª£c g√¢y ra rollback.</td></tr></tbody></table><h4 id="su-dung-transactional-trong-truong-hop-nhieu-transaction-manager" tabindex="-1"><a class="header-anchor" href="#su-dung-transactional-trong-truong-hop-nhieu-transaction-manager"><span>S·ª≠ d·ª•ng <code>@Transactional</code> trong tr∆∞·ªùng h·ª£p nhi·ªÅu Transaction Manager</span></a></h4><p>Trong m·ªôt s·ªë tr∆∞·ªùng h·ª£p, ·ª©ng d·ª•ng c√≥ th·ªÉ c·∫ßn k·∫øt n·ªëi v·ªõi nhi·ªÅu ngu·ªìn d·ªØ li·ªáu v√† t∆∞∆°ng ·ª©ng, c·∫ßn nhi·ªÅu Transaction Manager ƒë·ªôc l·∫≠p. Ng∆∞·ªùi d√πng c√≥ th·ªÉ s·ª≠ d·ª•ng thu·ªôc t√≠nh <code>value</code> ho·∫∑c <code>transactionManager</code> c·ªßa ch√∫ th√≠ch <code>@Transactional</code> ƒë·ªÉ ch·ªâ ƒë·ªãnh m·ªôt c√°ch c√≥ ch·ªçn l·ªçc Transaction Manager ƒë∆∞·ª£c s·ª≠ d·ª•ng. ƒêi·ªÅu n√†y c√≥ th·ªÉ l√† t√™n bean ho·∫∑c gi√° tr·ªã ƒë·ªãnh danh c·ªßa Transaction Manager bean.</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionalService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;order&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> setSomething</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { ... }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;account&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> doSomething</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { ... }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;reactive-account&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Mono</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Void</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> doSomethingReactive</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { ... }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>D∆∞·ªõi ƒë√¢y l√† c√°ch ƒë·ªãnh nghƒ©a Transaction Manager:</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tx:annotation-driven</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;transactionManager1&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">qualifier</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;order&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;transactionManager2&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">qualifier</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;account&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;transactionManager3&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;org.springframework.data.r2dbc.connectionfactory.R2dbcTransactionManager&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">qualifier</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;reactive-account&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong tr∆∞·ªùng h·ª£p n√†y, c√°c ph∆∞∆°ng th·ª©c tr√™n <code>TransactionalService</code> s·∫Ω ch·∫°y trong c√°c Transaction Manager ri√™ng bi·ªát, ƒë∆∞·ª£c ph√¢n bi·ªát b·ªüi c√°c ƒë·ªãnh danh order, account v√† reactive-account. N·∫øu kh√¥ng t√¨m th·∫•y Transaction Manager bean ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh m·ªôt c√°ch r√µ r√†ng, v·∫´n s·∫Ω s·ª≠ d·ª•ng t√™n bean m·ª•c ti√™u m·∫∑c ƒë·ªãnh c·ªßa <code>&lt;tx:annotation-driven&gt;</code>.</p><h4 id="tao-chu-thich-ket-hop-tuy-chinh" tabindex="-1"><a class="header-anchor" href="#tao-chu-thich-ket-hop-tuy-chinh"><span>T·∫°o ch√∫ th√≠ch k·∫øt h·ª£p t√πy ch·ªânh</span></a></h4><p>N·∫øu b·∫°n th·∫•y m√¨nh ƒëang l·∫∑p l·∫°i c√°c thu·ªôc t√≠nh <code>@Transactional</code> gi·ªëng nhau tr√™n nhi·ªÅu ph∆∞∆°ng th·ª©c kh√°c nhau, b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng meta-annotation c·ªßa Spring ƒë·ªÉ t·∫°o ch√∫ th√≠ch k·∫øt h·ª£p t√πy ch·ªânh.</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Target</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">({</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ElementType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">METHOD</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ElementType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TYPE</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">})</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Retention</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RetentionPolicy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RUNTIME</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">transactionManager</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;order&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> label</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;causal-consistency&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">interface</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> OrderTx</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Target</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">({</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ElementType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">METHOD</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ElementType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TYPE</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">})</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Retention</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RetentionPolicy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RUNTIME</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">transactionManager</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;account&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> label</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;retryable&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">interface</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> AccountTx</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>V√≠ d·ª• s·ª≠ d·ª•ng:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TransactionalService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">OrderTx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> setSomething</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">AccountTx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> doSomething</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Trong v√≠ d·ª• tr√™n, ch√∫ng ta s·ª≠ d·ª•ng c√∫ ph√°p ƒë·ªÉ ƒë·ªãnh nghƒ©a ƒë·ªãnh danh transaction manager v√† nh√£n giao d·ªãch, nh∆∞ng ch√∫ng ta c≈©ng c√≥ th·ªÉ bao g·ªìm h√†nh vi truy·ªÅn giao d·ªãch, quy t·∫Øc rollback, timeout v√† c√°c t√≠nh nƒÉng kh√°c.</p><h4 id="truyen-giao-dich" tabindex="-1"><a class="header-anchor" href="#truyen-giao-dich"><span>Truy·ªÅn giao d·ªãch</span></a></h4><p>Trong giao d·ªãch ƒë∆∞·ª£c qu·∫£n l√Ω b·ªüi Spring, h√£y l∆∞u √Ω s·ª± kh√°c bi·ªát gi·ªØa giao d·ªãch v·∫≠t l√Ω v√† giao d·ªãch logic, c≈©ng nh∆∞ c√°ch c√†i ƒë·∫∑t truy·ªÅn ƒë∆∞·ª£c √°p d·ª•ng cho s·ª± kh√°c bi·ªát n√†y.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220928114544.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p><code>PROPAGATION_REQUIRED</code> bu·ªôc th·ª±c hi·ªán giao d·ªãch v·∫≠t l√Ω, n·∫øu kh√¥ng c√≥ giao d·ªãch t·ªìn t·∫°i, n√≥ s·∫Ω th·ª±c hi·ªán trong ph·∫°m vi c·ª•c b·ªô c·ªßa ph·∫°m vi hi·ªán t·∫°i ho·∫∑c tham gia v√†o giao d·ªãch &quot;b√™n ngo√†i&quot; ƒë√£ ƒë∆∞·ª£c x√°c ƒë·ªãnh b·ªüi ph·∫°m vi l·ªõn h∆°n. ƒê√¢y l√† m·ªôt c√†i ƒë·∫∑t m·∫∑c ƒë·ªãnh t·ªët trong c√°c l·ªãch tr√¨nh g·ªçi ph·ªï bi·∫øn trong c√πng m·ªôt lu·ªìng (v√≠ d·ª•: m·ªôt facade d·ªãch v·ª• g·ªçi nhi·ªÅu ph∆∞∆°ng th·ª©c repository, trong ƒë√≥ t·∫•t c·∫£ c√°c ngu·ªìn t√†i nguy√™n c·∫ßn tham gia v√†o giao d·ªãch c·∫•p d·ªãch v·ª•).</p><p>Khi propagation ƒë∆∞·ª£c ƒë·∫∑t l√† PROPAGATION_REQUIRED, m·ªôt ph·∫°m vi giao d·ªãch logic s·∫Ω ƒë∆∞·ª£c t·∫°o ra cho m·ªói ph∆∞∆°ng th·ª©c √°p d·ª•ng c√†i ƒë·∫∑t n√†y. M·ªói ph·∫°m vi giao d·ªãch logic n√†y c√≥ th·ªÉ x√°c ƒë·ªãnh ri√™ng bi·ªát tr·∫°ng th√°i rollback duy nh·∫•t, ph·∫°m vi giao d·ªãch b√™n ngo√†i kh√¥ng ph·ª• thu·ªôc v√†o ph·∫°m vi giao d·ªãch b√™n trong. Trong tr∆∞·ªùng h·ª£p h√†nh vi PROPAGATION_REQUIRED ti√™u chu·∫©n, t·∫•t c·∫£ c√°c ph·∫°m vi n√†y ƒë∆∞·ª£c √°nh x·∫° v√†o c√πng m·ªôt giao d·ªãch v·∫≠t l√Ω. Do ƒë√≥, ch·ªâ ƒë√°nh d·∫•u rollback ƒë∆∞·ª£c ƒë·∫∑t trong ph·∫°m vi giao d·ªãch b√™n trong th·ª±c s·ª± ·∫£nh h∆∞·ªüng ƒë·∫øn c∆° h·ªôi giao d·ªãch b√™n ngo√†i th·ª±c s·ª± ƒë∆∞·ª£c g·ª≠i ƒëi.</p><p>Tuy nhi√™n, trong tr∆∞·ªùng h·ª£p ch·ªâ ƒë·ªãnh rollback ƒë∆∞·ª£c ƒë·∫∑t trong ph·∫°m vi giao d·ªãch b√™n trong v√† ph·∫°m vi giao d·ªãch b√™n ngo√†i ch∆∞a quy·∫øt ƒë·ªãnh v·ªÅ vi·ªác rollback ch√≠nh n√≥, vi·ªác rollback (do ph·∫°m vi giao d·ªãch b√™n trong g√¢y ra m·ªôt c√°ch im l·∫∑ng) l√† kh√¥ng mong mu·ªën. Trong tr∆∞·ªùng h·ª£p n√†y, m·ªôt <code>UnexpectedRollbackException</code> t∆∞∆°ng ·ª©ng s·∫Ω ƒë∆∞·ª£c n√©m ra. ƒêi·ªÅu n√†y l√† h√†nh vi mong ƒë·ª£i, v√¨ v·∫≠y ng∆∞·ªùi g·ªçi giao d·ªãch kh√¥ng bao gi·ªù b·ªã ƒë√°nh l·ª´a r·∫±ng vi·ªác th·ª±c hi·ªán commit ƒë√£ x·∫£y ra khi th·ª±c t·∫ø kh√¥ng c√≥. V√¨ v·∫≠y, n·∫øu m·ªôt ph·∫°m vi giao d·ªãch b√™n trong (kh√¥ng ƒë∆∞·ª£c bi·∫øt ƒë·∫øn b√™n ngo√†i) t·∫Øt giao d·ªãch ch·ªâ ƒë·ªãnh rollback, ng∆∞·ªùi g·ªçi b√™n ngo√†i v·∫´n g·ªçi commit. Ng∆∞·ªùi g·ªçi b√™n ngo√†i c·∫ßn nh·∫≠n <code>UnexpectedRollbackException</code> ƒë·ªÉ ch·ªâ r√µ r·∫±ng rollback ƒë√£ x·∫£y ra.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20220928115243.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><p>PROPAGATION_REQUIRES_NEW lu√¥n s·ª≠ d·ª•ng m·ªôt giao d·ªãch v·∫≠t l√Ω ri√™ng cho m·ªói ph·∫°m vi giao d·ªãch ·∫£nh h∆∞·ªüng, kh√¥ng bao gi·ªù tham gia v√†o giao d·ªãch hi·ªán c√≥ c·ªßa ph·∫°m vi b√™n ngo√†i. Trong s·∫Øp x·∫øp n√†y, giao d·ªãch t√†i nguy√™n c∆° s·ªü ƒë∆∞·ª£c xem l√† kh√°c nhau, do ƒë√≥ c√≥ th·ªÉ ƒë∆∞·ª£c g·ª≠i ri√™ng l·∫ª ho·∫∑c rollback, giao d·ªãch b√™n ngo√†i kh√¥ng b·ªã ·∫£nh h∆∞·ªüng b·ªüi tr·∫°ng th√°i rollback c·ªßa giao d·ªãch b√™n trong, kh√≥a giao d·ªãch b√™n trong ƒë∆∞·ª£c gi·∫£i ph√≥ng ngay sau khi ho√†n th√†nh. M·ªôt giao d·ªãch n·ªôi b·ªô ƒë·ªôc l·∫≠p c≈©ng c√≥ th·ªÉ khai b√°o c·∫•p ƒë·ªô c√¥ l·∫≠p, timeout v√† ch·ªâ ƒë·ªçc ri√™ng c·ªßa n√≥, thay v√¨ k·∫ø th·ª´a c√°c t√≠nh nƒÉng c·ªßa giao d·ªãch b√™n ngo√†i.</p><h2 id="truu-tuong-hoa-ngoai-le-jdbc" tabindex="-1"><a class="header-anchor" href="#truu-tuong-hoa-ngoai-le-jdbc"><span>Tr·ª´u t∆∞·ª£ng h√≥a ngo·∫°i l·ªá JDBC</span></a></h2><p>Spring s·∫Ω chuy·ªÉn ƒë·ªïi c√°c ngo·∫°i l·ªá li√™n quan ƒë·∫øn thao t√°c d·ªØ li·ªáu th√†nh <code>DataAccessException</code>.</p><p>Spring nh·∫≠n bi·∫øt c√°c m√£ l·ªói nh∆∞ th·∫ø n√†o?</p><p>Spring s·ª≠ d·ª•ng <code>SQLErrorCodeSQLExceptionTranslator</code> ƒë·ªÉ ph√¢n t√≠ch m√£ l·ªói.</p><p>ƒê·ªãnh nghƒ©a ErrorCode (trong t·ªáp sql-error-codes.xml)</p><h2 id="thuc-hanh-tot-nhat-ve-giao-dich-trong-spring" tabindex="-1"><a class="header-anchor" href="#thuc-hanh-tot-nhat-ve-giao-dich-trong-spring"><span>Th·ª±c h√†nh t·ªët nh·∫•t v·ªÅ giao d·ªãch trong Spring</span></a></h2><h3 id="transactional-khong-hoat-ƒëong-trong-spring" tabindex="-1"><a class="header-anchor" href="#transactional-khong-hoat-ƒëong-trong-spring"><span>Transactional kh√¥ng ho·∫°t ƒë·ªông trong Spring</span></a></h3><p>M·ªôt v·∫•n ƒë·ªÅ d·ªÖ b·ªã b·ªè qua khi s·ª≠ d·ª•ng ch√∫ th√≠ch <code>@Transactional</code> ƒë·ªÉ b·∫≠t giao d·ªãch khai b√°o l√† giao d·ªãch c√≥ th·ªÉ kh√¥ng ho·∫°t ƒë·ªông.</p><p>Nguy√™n t·∫Øc ho·∫°t ƒë·ªông c·ªßa <code>@Transactional</code>:</p><h4 id="phuong-thuc-transactional-phai-la-public" tabindex="-1"><a class="header-anchor" href="#phuong-thuc-transactional-phai-la-public"><span>Ph∆∞∆°ng th·ª©c <code>@Transactional</code> ph·∫£i l√† public</span></a></h4><p>Nguy√™n t·∫Øc th·ª© nh·∫•t: Tr·ª´ khi ƒë∆∞·ª£c c·∫•u h√¨nh ƒë·∫∑c bi·ªát (v√≠ d·ª•: s·ª≠ d·ª•ng AspectJ ƒë·ªÉ tƒ©nh h√≥a AOP), <strong>ch·ªâ c√≥ <code>@Transactional</code> ƒë∆∞·ª£c ƒë·ªãnh nghƒ©a tr√™n ph∆∞∆°ng th·ª©c <code>public</code> m·ªõi c√≥ th·ªÉ ho·∫°t ƒë·ªông</strong>. L√Ω do l√† Spring m·∫∑c ƒë·ªãnh s·ª≠ d·ª•ng c√°ch th·ª©c tƒÉng c∆∞·ªùng ƒë·ªông ƒë·ªÉ th·ª±c hi·ªán AOP, tƒÉng c∆∞·ªùng c√°c ph∆∞∆°ng th·ª©c m·ª•c ti√™u, v√† ph∆∞∆°ng th·ª©c <code>private</code> kh√¥ng th·ªÉ ƒë∆∞·ª£c tƒÉng c∆∞·ªùng. Do ƒë√≥, Spring kh√¥ng th·ªÉ tƒÉng c∆∞·ªùng logic x·ª≠ l√Ω giao d·ªãch ƒë·ªông.</p><p>„ÄêV√≠ d·ª•„ÄëL·ªói s·ª≠ d·ª•ng <code>@Transactional</code> - Tr∆∞·ªùng h·ª£p 1</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">	@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">	void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUserPrivate</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserEntity</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> entity) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">		userRepository</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(entity);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">		if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">entity</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">contains</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;test&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) { </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;invalid username!&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> }</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	//Ph∆∞∆°ng th·ª©c private</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">	public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUserWrong1</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> name) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">		try</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">			this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">createUserPrivate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserEntity</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(name));</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">		} </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">			log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;create user failed because {}&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ex</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">		}</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">		return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> userRepository</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">findByName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(name).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">	}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Khi truy·ªÅn v√†o m·ªôt th·ª±c th·ªÉ ng∆∞·ªùi d√πng c√≥ t√™n l√† &quot;test&quot;, m·ªôt ngo·∫°i l·ªá s·∫Ω ƒë∆∞·ª£c n√©m ra, nh∆∞ng <code>@Transactional</code> kh√¥ng ho·∫°t ƒë·ªông v√† kh√¥ng g√¢y ra rollback.</p><h4 id="phai-goi-thong-qua-bean-ƒëuoc-spring-tiem-vao" tabindex="-1"><a class="header-anchor" href="#phai-goi-thong-qua-bean-ƒëuoc-spring-tiem-vao"><span>Ph·∫£i g·ªçi th√¥ng qua Bean ƒë∆∞·ª£c Spring ti√™m v√†o</span></a></h4><p>Nguy√™n t·∫Øc th·ª© hai: <strong>Ph·∫£i g·ªçi ph∆∞∆°ng th·ª©c m·ª•c ti√™u th√¥ng qua l·ªõp ƒë∆∞·ª£c t·∫°o ra b·ªüi proxy t·ª´ b√™n ngo√†i ƒë·ªÉ n√≥ c√≥ th·ªÉ ho·∫°t ƒë·ªông</strong>.</p><p>„ÄêV√≠ d·ª•„ÄëL·ªói s·ª≠ d·ª•ng <code>@Transactional</code> - Tr∆∞·ªùng h·ª£p 2</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	//T·ª± g·ªçi</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">	public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUserWrong2</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> name) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">		try</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">			this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">createUserPublic</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserEntity</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(name));</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">		} </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">			log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;create user failed because {}&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ex</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">		}</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">		return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> userRepository</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">findByName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(name).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">size</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	//C√≥ th·ªÉ lan truy·ªÅn ngo·∫°i l·ªá</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">	@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">	public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUserPublic</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserEntity</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> entity) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">		userRepository</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(entity);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">		if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">entity</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">contains</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;test&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) { </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;invalid username!&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> }</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">	}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Khi truy·ªÅn v√†o m·ªôt th·ª±c th·ªÉ ng∆∞·ªùi d√πng c√≥ t√™n l√† &quot;test&quot;, m·ªôt ngo·∫°i l·ªá s·∫Ω ƒë∆∞·ª£c n√©m ra, nh∆∞ng <code>@Transactional</code> kh√¥ng ho·∫°t ƒë·ªông v√† kh√¥ng g√¢y ra rollback.</p><p>Gi·∫£i th√≠ch: Spring s·ª≠ d·ª•ng c√¥ng ngh·ªá AOP ƒë·ªÉ tƒÉng c∆∞·ªùng bytecode c·ªßa ph∆∞∆°ng th·ª©c, v√† ƒë·ªÉ g·ªçi ph∆∞∆°ng th·ª©c ƒë√£ ƒë∆∞·ª£c tƒÉng c∆∞·ªùng, b·∫°n ph·∫£i g·ªçi t·ª´ ƒë·ªëi t∆∞·ª£ng proxy.</p><h3 id="giao-dich-ƒëuoc-ap-dung-nhung-khong-ƒëuoc-hoan-tac" tabindex="-1"><a class="header-anchor" href="#giao-dich-ƒëuoc-ap-dung-nhung-khong-ƒëuoc-hoan-tac"><span>Giao d·ªãch ƒë∆∞·ª£c √°p d·ª•ng nh∆∞ng kh√¥ng ƒë∆∞·ª£c ho√†n t√°c</span></a></h3><p>Vi·ªác th·ª±c hi·ªán x·ª≠ l√Ω giao d·ªãch b·∫±ng AOP c√≥ th·ªÉ hi·ªÉu l√† s·ª≠ d·ª•ng <code>try‚Ä¶catch‚Ä¶</code> ƒë·ªÉ bao b·ªçc c√°c ph∆∞∆°ng th·ª©c ƒë∆∞·ª£c ƒë√°nh d·∫•u b·∫±ng ch√∫ th√≠ch <code>@Transactional</code>. Khi ph∆∞∆°ng th·ª©c g·∫∑p ph·∫£i ngo·∫°i l·ªá v√† th·ªèa m√£n <strong>m·ªôt s·ªë ƒëi·ªÅu ki·ªán</strong>, ch√∫ng ta c√≥ th·ªÉ ƒë·∫∑t l·∫°i giao d·ªãch trong kh·ªëi <code>catch</code>, n·∫øu kh√¥ng c√≥ ngo·∫°i l·ªá, giao d·ªãch s·∫Ω ƒë∆∞·ª£c g·ª≠i ƒëi.</p><p>&quot;m·ªôt s·ªë ƒëi·ªÅu ki·ªán&quot; ch·ªß y·∫øu bao g·ªìm hai ƒëi·ªÉm:</p><p>Th·ª© nh·∫•t, ch·ªâ khi ngo·∫°i l·ªá ƒë∆∞·ª£c truy·ªÅn ra kh·ªèi ph∆∞∆°ng th·ª©c ƒë∆∞·ª£c ƒë√°nh d·∫•u b·∫±ng ch√∫ th√≠ch @Transactional, giao d·ªãch m·ªõi ƒë∆∞·ª£c ho√†n t√°c. Trong l·ªõp TransactionAspectSupport c·ªßa Spring c√≥ m·ªôt ph∆∞∆°ng th·ª©c invokeWithinTransaction, n∆°i x·ª≠ l√Ω logic giao d·ªãch.</p><p>Th·ª© hai, theo m·∫∑c ƒë·ªãnh, <strong>ch·ªâ khi c√≥ RuntimeException (ngo·∫°i l·ªá kh√¥ng ki·ªÉm tra) ho·∫∑c Error x·∫£y ra, Spring m·ªõi ho√†n t√°c giao d·ªãch</strong>.</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Service</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Slf4j</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">	@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Autowired</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">	private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserRepository</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> userRepository</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	// Ngo·∫°i l·ªá kh√¥ng th·ªÉ truy·ªÅn ra kh·ªèi ph∆∞∆°ng th·ª©c, d·∫´n ƒë·∫øn kh√¥ng ho√†n t√°c giao d·ªãch</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">	@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">	public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUserWrong1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">		try</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">			userRepository</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserEntity</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(name));</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">			throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">		} </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">			log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;create user failed&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, ex);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">		}</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	// Ngay c·∫£ khi c√≥ ngo·∫°i l·ªá ki·ªÉm tra, giao d·ªãch c≈©ng kh√¥ng th·ªÉ ho√†n t√°c</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">	@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">	public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUserWrong2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">		userRepository</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserEntity</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(name));</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">		otherTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">	// V√¨ t·ªáp kh√¥ng t·ªìn t·∫°i, s·∫Ω lu√¥n n√©m ra m·ªôt IOException</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">	private</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> otherTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">		Files</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">readAllLines</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Paths</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;file-that-not-exist&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong ph∆∞∆°ng th·ª©c createUserWrong1, m·ªôt RuntimeException s·∫Ω ƒë∆∞·ª£c n√©m ra, nh∆∞ng v√¨ ph∆∞∆°ng th·ª©c ƒë√£ b·∫Øt t·∫•t c·∫£ c√°c ngo·∫°i l·ªá trong kh·ªëi catch, ngo·∫°i l·ªá kh√¥ng th·ªÉ truy·ªÅn ra kh·ªèi ph∆∞∆°ng th·ª©c, do ƒë√≥ giao d·ªãch kh√¥ng th·ªÉ ho√†n t√°c.</p><p>Trong ph∆∞∆°ng th·ª©c createUserWrong2, trong qu√° tr√¨nh ƒëƒÉng k√Ω ng∆∞·ªùi d√πng, c≈©ng c√≥ m·ªôt ho·∫°t ƒë·ªông ƒë·ªçc t·ªáp, n·∫øu ho·∫°t ƒë·ªông ƒë·ªçc t·ªáp th·∫•t b·∫°i, ch√∫ng ta mu·ªën ho·∫°t ƒë·ªông ghi c∆° s·ªü d·ªØ li·ªáu c·ªßa ng∆∞·ªùi d√πng b·ªã ho√†n t√°c. M·∫∑c d√π kh√¥ng b·∫Øt ngo·∫°i l·ªá ·ªü ƒë√¢y, nh∆∞ng v√¨ ph∆∞∆°ng th·ª©c otherTask n√©m ra m·ªôt ngo·∫°i l·ªá ki·ªÉm tra, createUserWrong2 truy·ªÅn ra m·ªôt ngo·∫°i l·ªá ki·ªÉm tra, do ƒë√≥ giao d·ªãch c≈©ng kh√¥ng ƒë∆∞·ª£c ho√†n t√°c.</p><p>„ÄêGi·∫£i ph√°p 1„ÄëN·∫øu b·∫°n mu·ªën t·ª± b·∫Øt ngo·∫°i l·ªá v√† x·ª≠ l√Ω, kh√¥ng c√≥ v·∫•n ƒë·ªÅ g√¨, <strong>b·∫°n c√≥ th·ªÉ thi·∫øt l·∫≠p l·∫°i <code>TransactionAspectSupport.currentTransactionStatus().setRollbackOnly();</code> ƒë·ªÉ ƒë·∫∑t giao d·ªãch hi·ªán t·∫°i v√†o tr·∫°ng th√°i ho√†n t√°c</strong>:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUserRight1</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> name) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   try</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">      userRepository</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserEntity</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(name));</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">   } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">      log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;create user failed&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, ex);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">      TransactionAspectSupport</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">currentTransactionStatus</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setRollbackOnly</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">   }</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>„ÄêGi·∫£i ph√°p 2„ÄëTrong ch√∫ th√≠ch, khai b√°o <code>@Transactional(rollbackFor = Exception.class)</code>, mong mu·ªën g·∫∑p t·∫•t c·∫£ c√°c Exception ƒë·ªÅu ho√†n t√°c giao d·ªãch (ƒë·ªÉ v∆∞·ª£t qua gi·ªõi h·∫°n m·∫∑c ƒë·ªãnh kh√¥ng ho√†n t√°c ngo·∫°i l·ªá ki·ªÉm tra):</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">rollbackFor</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUserRight2</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> name) throws IOException {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">   userRepository</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserEntity</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(name));</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">   otherTask</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><h3 id="tinh-chinh-cach-truyen-giao-dich" tabindex="-1"><a class="header-anchor" href="#tinh-chinh-cach-truyen-giao-dich"><span>Tinh ch·ªânh c√°ch truy·ªÅn giao d·ªãch</span></a></h3><p>N·∫øu ph∆∞∆°ng th·ª©c li√™n quan ƒë·∫øn nhi·ªÅu ho·∫°t ƒë·ªông c∆° s·ªü d·ªØ li·ªáu v√† b·∫°n mu·ªën th·ª±c hi·ªán ch√∫ng nh∆∞ c√°c giao d·ªãch ƒë·ªôc l·∫≠p ƒë·ªÉ g·ª≠i ho·∫∑c ho√†n t√°c, th√¨ ch√∫ng ta c·∫ßn xem x√©t vi·ªác tinh ch·ªânh c√°ch truy·ªÅn giao d·ªãch b·∫±ng c√°ch s·ª≠ d·ª•ng thu·ªôc t√≠nh <code>Propagation</code> c·ªßa ch√∫ th√≠ch <code>@Transactional</code>.</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * {@link Propagation#REQUIRES_NEW} ƒë·∫°i di·ªán cho vi·ªác th·ª±c hi·ªán m·ªôt giao d·ªãch m·ªõi v√† t·∫°m ng·ª´ng giao d·ªãch hi·ªán t·∫°i khi ƒë·∫øn ph∆∞∆°ng th·ª©c n√†y</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Transactional</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">propagation</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Propagation</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">REQUIRES_NEW</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createSubUserWithExceptionRight</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserEntity</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> entity) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">   log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;createSubUserWithExceptionRight start&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">   userRepository</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(entity);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;invalid status&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/framework/spring/data/transaction.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/framework/spring/data/jdbc.html" aria-label="Spring JDBC"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->Spring JDBC</div></a><a class="route-link auto-link next" href="/framework/spring/data/jpa.html" aria-label="Spring JPA"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Spring JPA<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with ‚ù§Ô∏è by Hung Nguyen</div><div class="copyright">Copyright ¬© 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CmlOSuIY.js" defer></script>
  </body>
</html>
