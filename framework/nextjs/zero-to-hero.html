<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/framework/nextjs/zero-to-hero.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="NextJS Zero To Hero"><meta property="og:description" content="NextJS 14 Zero To Hero Giới thiệu Cá nhân tôi thiên về backend developer và không mạnh về frontend, gần đây tôi đang suy nghĩ về việc làm freelancer nên tôi bắt đầu nâng cấp kĩ ..."><meta property="og:type" content="article"><meta property="og:image" content="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjHDxWmL8uVZ1g4YSKoNAjR1po6lnLVGiawBFIAaMt0w998GnxnTdR3nw/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-10-08T13:59:29.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:tag" content="nextjs"><meta property="article:tag" content="js"><meta property="article:tag" content="ts"><meta property="article:modified_time" content="2024-10-08T13:59:29.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"NextJS Zero To Hero","image":["https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjHDxWmL8uVZ1g4YSKoNAjR1po6lnLVGiawBFIAaMt0w998GnxnTdR3nw/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1","https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjFKWqlTZp5fUUgUy8s0ureVl4JMNmlJ6x4XqvdEBluqj1qPOOCE685w/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1","https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjq5UnDrTNCiak3dmyOaE4dd3dpDnQEOBzY5gTNxrlib6rOW1X0t7jW46w/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1","https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d607004728f4bf3ae911e3822a4926c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=437&h=251&s=30636&e=png&b=fefefe","https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/abd6ea28a13749f6ac3cf5ab801e1241~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1065&h=208&s=33406&e=png&b=fdfdfd","https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjhWyZBicURjWbIyhw5hA4nry85ngiaic4wnSEN6foC7JJoSASlClP8MM0A/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1","https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQj0LrLdJbEVd5IA4Cia8LBZib7icygicibLwEjfOtYt5YM3FhOPuPuRVLBY0A/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1","https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjyZop3lnX9PvbeicVxadkww7DLu3NKor2PG7ELUTFmfYDv2mdq1ZLOgA/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1","https://mmbiz.qpic.cn/sz_mmbiz_png/mshqAkialV7EDeiaib2FwDbJoWAl5E9EluqYVpMLfWg2b3PF6hb5ykaWDyJ7yfoIqgV2czT3iciaJarXjo43ryzSQvQ/640?wx_fmt=png&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1","https://mmbiz.qpic.cn/sz_mmbiz_png/mshqAkialV7EDeiaib2FwDbJoWAl5E9Eluqvb56JW4frSKQ7tDMicj4uCn9tQHgg0BTLVaVcBSibDQAaCOgBYibYpiaWA/640?wx_fmt=png&from=appmsg","https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjzj6ZGI9t1ufAIWMId4cK1bEHIASdaOz6KbrwdD7lwxBukjyfsKweZg/640?wx_fmt=other&from=appmsg","https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/738ff98c9fe842f190d13087d09dcb0c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=877&h=393&s=44763&e=png&b=ffffff","https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d7766b731e64d0fb7d39dee9eceea63~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1002&h=729&s=144239&e=png&b=ffffff","https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e81425517839417d8042951243a5d63d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=857&h=185&s=46011&e=png&b=202020","https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa9ef9067d8448cb997e6b0fafe53ca4~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=888&h=352&s=80473&e=png&b=1f1f1f","https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3fa4812f3c2f464a92704a2249fb4dd3~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=887&h=128&s=24922&e=png&b=fdfdfd","https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f7e3b4016ed64868bc0422b98bb9abf1~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=438&h=580&s=71763&e=png&b=1b1a1c","https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98e4b19e26b745d1bce1d72f9b77ab7e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=608&h=572&s=85440&e=png&b=1b1a1c","https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c9389450bdd646a28146ebe8d0a09a5e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=841&h=630&s=95420&e=png&b=1c1c1c","https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d77fd01250f74a8bb253ea6b65931e61~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=884&h=186&s=38927&e=png&b=fdfdfd"],"dateModified":"2024-10-08T13:59:29.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>NextJS Zero To Hero | VanHung4499</title><meta name="description" content="NextJS 14 Zero To Hero Giới thiệu Cá nhân tôi thiên về backend developer và không mạnh về frontend, gần đây tôi đang suy nghĩ về việc làm freelancer nên tôi bắt đầu nâng cấp kĩ ...">
    <link rel="preload" href="/assets/style-DFXXOFfS.css" as="style"><link rel="stylesheet" href="/assets/style-DFXXOFfS.css">
    <link rel="modulepreload" href="/assets/app-CIGQMwlz.js"><link rel="modulepreload" href="/assets/zero-to-hero.html-C6iMerPo.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon>Project<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/rouyi-vue-pro/" aria-label="Rouyi Vue Pro"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Rouyi Vue Pro<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/yudao-cloud/" aria-label="Yudao Cloud"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Yudao Cloud<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interview/" aria-label="Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:account-tie" width="1em" height="1em"></iconify-icon><!--]-->Interview<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:gin" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Gin</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:golang" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Go Frame</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">NestJS</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Nextjs</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/framework/nextjs/zero-to-hero.html" aria-label="NextJS Zero To Hero"><!---->NextJS Zero To Hero<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Spring</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><span class="vp-sidebar-title">Spring Boot</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->NextJS Zero To Hero</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-10-08T13:59:29.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 73 min</span><meta property="timeRequired" content="PT73M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color0 clickable" role="navigation">nextjs</span><!--]--><meta property="articleSection" content="nextjs"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color0 clickable" role="navigation">nextjs</span><span class="page-tag-item color1 clickable" role="navigation">js</span><span class="page-tag-item color2 clickable" role="navigation">ts</span><!--]--><meta property="keywords" content="nextjs,js,ts"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#moi-truong-cai-đat">Môi trường &amp; Cài đặt</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#bat-đau-tu-layout">Bắt đầu từ Layout</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#phong-chu">Phông chữ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#đinh-tuyen-trang">Định tuyến trang</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#đinh-tuyen-api">Định tuyến API</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#xu-ly-api">Xử lý API</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#meo-tao-thu-muc">Mẹo Tạo Thư Mục</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#hinh-anh">Hình Ảnh</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tai-sao-can-toi-uu-hoa-hinh-anh">Tại sao cần tối ưu hóa hình ảnh?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#lam-the-nao-đe-thuc-hien">Làm thế nào để thực hiện?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#yeu-cau-hinh-anh-tu-nguon-ben-ngoai-voi-han-che-truy-cap">Yêu cầu hình ảnh từ nguồn bên ngoài với hạn chế truy cập</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#xu-ly-loi-hinh-anh">Xử Lý Lỗi Hình Ảnh</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#đieu-huong-link">Điều hướng Link</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trang-thai-active">Trạng thái Active</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#trang-not-found">Trang Not Found</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trang-404-toan-cuc">Trang 404 toàn cục</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trang-404-cuc-bo">Trang 404 cục bộ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#trang-error">Trang Error</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trang-error-toan-cuc">Trang Error toàn cục</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trang-error-cuc-bo">Trang Error cục bộ</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#loading">Loading</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#loading-cap-trang">Loading cấp trang</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#loading-cap-thanh-phan">Loading cấp thành phần</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ssg-va-ssr">SSG và SSR</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cache">Cache</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cache-lay-du-lieu-tu-server-qua-thu-vien-ben-thu-ba">Cache (Lấy dữ liệu từ Server qua thư viện bên thứ ba)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cache-trong-react">Cache trong React</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ssg-tien-render-cho-trang-co-tham-so-đong">SSG Tiền render cho trang có tham số động</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#streaming-render-bat-đong-bo">Streaming (Render bất đồng bộ)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#network-waterfall-mo-hinh-nuoc-đo-mang">Network Waterfall（Mô hình nước đổ mạng）</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tom-lai">Tóm lại:</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#client-component-vs-server-compoennt">Client Component vs Server Compoennt</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nhung-luu-y-ve-use-server">Những lưu ý về use server:</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#hydration-mismatch">Hydration Mismatch</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#phan-tich-hien-tuong">Phân tích hiện tượng</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nguyen-nhan">Nguyên nhân</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#giai-phap">Giải pháp</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ssr-streaming-đong-thoi-giu-kha-nang-tuong-tac-phia-client">SSR/Streaming đồng thời giữ khả năng tương tác phía client</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cac-cach-fetch-du-lieu">Các cách fetch dữ liệu</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#form-va-server-action">Form và Server Action</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#kien-thuc-co-ban">Kiến thức cơ bản</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#vi-du-1-cach-su-dung-ham-noi-tuyen">Ví dụ 1: Cách sử dụng hàm nội tuyến</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#vi-du-2-cach-su-dung-qua-module">Ví dụ 2: Cách sử dụng qua module</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#luu-y">Lưu ý</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tuong-tac-bieu-mau">Tương tác biểu mẫu</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#khuyen-nghi-react-hook-form-zod-hookform-resolvers-hookform-error-message">Khuyến nghị - react-hook-form + zod + @hookform/resolvers + @hookform/error-message</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#seo">SEO</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#giai-thich-tep-env">Giải thích tệp .env</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#co-so-du-lieu">Cơ sở dữ liệu</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#vi-du-ve-mongodb-đam-may">Ví dụ về MongoDB đám mây</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#prisma">Prisma</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#prisma-su-dung-trong-next-js">Prisma Sử Dụng Trong Next.js</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#middleware">Middleware</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#gioi-thieu-ve-middleware-trong-next-js">Giới thiệu về Middleware trong Next.js</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cac-truong-hop-su-dung-middleware">Các trường hợp sử dụng Middleware</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cac-truong-hop-khong-phu-hop-voi-middleware">Các trường hợp không phù hợp với Middleware</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cookie-headers-cors">Cookie, Headers, CORS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#waituntil">waitUntil</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#su-dung-nhieu-middleware">Sử dụng nhiều Middleware</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#xac-thuc-va-uy-quyen">Xác thực và Ủy quyền</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hieu-biet-ve-khai-niem">Hiểu biết về khái niệm</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#quy-trinh-xac-thuc-va-uy-quyen">Quy trình xác thực và ủy quyền</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nextauth">NextAuth</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#clerk-nen-tang-đang-nhap-ben-thu-ba">Clerk nền tảng đăng nhập bên thứ ba</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#quoc-te-hoa-i18n">Quốc tế hóa i18n</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#next-intl">next-intl</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#meo-nho-them-goi-y-ma-cho-usetranslation-hoac-gettranslation">Mẹo nhỏ: Thêm gợi ý mã cho useTranslation hoặc getTranslation</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#trpc">tRPC</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#trpc-so-voi-rest-api">tRPC so với REST API</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#đac-điem-cua-trpc">Đặc điểm của tRPC</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#huong-dan-nhanh-ve-trpc">Hướng dẫn nhanh về tRPC</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#su-dung-trong-next-js">Sử dụng trong Next.js</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#trien-khai">Triển khai</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ket-luan">Kết luận</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#reference">Reference</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tai-lieu-tham-khao">Tài liệu tham khảo</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="nextjs-14-zero-to-hero" tabindex="-1"><a class="header-anchor" href="#nextjs-14-zero-to-hero"><span>NextJS 14 Zero To Hero</span></a></h1><h1 id="gioi-thieu" tabindex="-1"><a class="header-anchor" href="#gioi-thieu"><span>Giới thiệu</span></a></h1><p>Cá nhân tôi thiên về backend developer và không mạnh về frontend, gần đây tôi đang suy nghĩ về việc làm freelancer nên tôi bắt đầu nâng cấp kĩ năng frontend của mình với NextJs (version <strong>14</strong>). Bài viết này do tôi nhanh chóng tổng kết lại quá trình phát triển của mình...</p><blockquote><p>Do tôi đã có kiến thức nền về frontend cơ bản và JS/TS khá tốt nên tôi học khá nhanh. Nếu bạn vẫn còn chưa tự tin về kĩ năng thì hãy học những điều cơ bản trước!</p></blockquote><h2 id="moi-truong-cai-đat" tabindex="-1"><a class="header-anchor" href="#moi-truong-cai-đat"><span>Môi trường &amp; Cài đặt</span></a></h2><ul><li>Node Environment ( &gt;= 18 )</li><li>Các công cụ npx, yarn, bun đều có thể sử dụng (tôi cá nhân thích bun2 vì nó nhanh)</li><li>Khởi tạo dự án next</li></ul><div class="language-sh" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">bunx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> create-next-app@latest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">✔</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> What</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> is</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> your</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> project</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> named?</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> …</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> my-nextjs-app</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   -</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Tên</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dự</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> án</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">✔</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Would</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> you</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> like</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> use</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> TypeScript?</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> …</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> No</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Yes</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  -</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Sử</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dụng</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Typescript</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                               </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">✔</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Would</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> you</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> like</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> use</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> ESLint?</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> …</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> No</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Yes</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">      -</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Sử</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dụng</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> ESLint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                   </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">✔</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Would</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> you</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> like</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> use</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Tailwind</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> CSS?</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> …</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> No</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Yes</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   -</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Sử</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dụng</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Tailwind</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                              </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">✔</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Would</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> you</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> like</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> use</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">src/</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> directory?</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> …</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> No</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Yes</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  -</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Mặc</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> định</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> không</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sử</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dụng</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> src</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                         </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">✔</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Would</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> you</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> like</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> use</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> App</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Router?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (recommended) … No / Yes - Mặc định sử dụng App Router, nếu chọn No, sẽ sử dụng Page Router, đây là cách sử dụng của Next13                                                 </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">✔</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Would</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> you</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> like</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> to</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> customize</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> the</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> default</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> import</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> alias</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (@/*)? … No / Yes  - Khuyến nghị không sử dụng</span></span></code></pre></div><ul><li>Cấu trúc thư mục dự án</li></ul><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> README.md</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                                                         </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> app</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                     Tương</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> đương</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> với</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> src</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                     </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   ├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> favicon.ico</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                                                  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   ├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> globals.css</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">         CSS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> toàn</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cục</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                             </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   ├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> layout.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">          Tệp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chính</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> của</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dự</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> án,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tương</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> đương</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> với</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> main.js</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                             </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   └──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> page.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">            Tệp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> trang</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chủ,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> truy</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cập</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tại</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                            </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> bun.lockb</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                                                        </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> next-env.d.ts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                                                    </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> next.config.mjs</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">         Tệp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cấu</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> hình</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                        </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> package.json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                                                     </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> postcss.config.mjs</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">      Tệp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cấu</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> hình</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> postcss</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                     </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> public</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                  Thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tệp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tĩnh,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> lưu</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> trữ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> hình</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> ảnh</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                       </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   ├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> next.svg</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                                                     </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   └──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> vercel.svg</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                                                   </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tailwind.config.ts</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">      Tệp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cấu</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> hình</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tailwindcss</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                                                 </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">└──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tsconfig.json</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Cài đặt autoprefixer và cấu hình postcss</li></ul><div class="language-sh" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">bun</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> autoprefixer</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -D</span></span></code></pre></div><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// postcss.config.mjs </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/** </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@type</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> {import(&#39;postcss-load-config&#39;).Config}</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {   </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  plugins</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {     </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    tailwindcss</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {},     </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    autoprefixer</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {}, </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Thêm autoprefixer   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  }, </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};      </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Dưới đây là bản dịch sang tiếng Việt của nội dung bạn cung cấp:</p><h1 id="bat-đau" tabindex="-1"><a class="header-anchor" href="#bat-đau"><span>Bắt đầu</span></a></h1><h2 id="bat-đau-tu-layout" tabindex="-1"><a class="header-anchor" href="#bat-đau-tu-layout"><span>Bắt đầu từ Layout</span></a></h2><p>Tệp 「app/layout.tsx」 là tệp bố cục chính của toàn bộ ứng dụng, tương tự như main.ts hoặc App.tsx trong React. Nó chủ yếu thực hiện các nhiệm vụ sau:</p><ul><li><p>Thông tin metadata của dự án</p></li><li><p>Tải kiểu dáng toàn cục từ globals.css</p></li><li><p>Tải phông chữ từ mạng hoặc cục bộ</p></li><li><p>Định nghĩa bố cục cấp cao nhất của ứng dụng</p></li><li><p>Hỗ trợ quốc tế hóa (i18n)</p></li><li><p>Gói các thư viện thành phần từ bên thứ ba thông qua Provider Wrapper</p></li></ul><p>Mỗi thư mục trang cũng có thể định nghĩa tệp bố cục riêng của mình.</p><p>「Tóm tắt」：「RootLayout cấp cao nhất áp dụng cho tất cả các trang, mỗi Layout con chỉ áp dụng cho các trang trong thư mục mà nó thuộc về.」</p><p>Ví dụ:</p><table><thead><tr><th><img src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjHDxWmL8uVZ1g4YSKoNAjR1po6lnLVGiawBFIAaMt0w998GnxnTdR3nw/640?wx_fmt=other&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="Hình ảnh" loading="lazy"></th><th><img src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjFKWqlTZp5fUUgUy8s0ureVl4JMNmlJ6x4XqvdEBluqj1qPOOCE685w/640?wx_fmt=other&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="Hình ảnh" loading="lazy"></th></tr></thead></table><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjq5UnDrTNCiak3dmyOaE4dd3dpDnQEOBzY5gTNxrlib6rOW1X0t7jW46w/640?wx_fmt=other&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="Hình ảnh" tabindex="0" loading="lazy"><figcaption>Hình ảnh</figcaption></figure><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/layout.tsx  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> RootLayout</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">children</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Readonly</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;{  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    children</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">React</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ReactNode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}&gt;) {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (  </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">html</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> lang</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;en&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{inter.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">className</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/* header */</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Header</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">/&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/* main content */</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">children</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">html</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/overview/layout.tsx  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Layout</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">children</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,}: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Readonly</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;{  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    children</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">React</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ReactNode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}&gt;) {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (  </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;flex mt-4 space-x-6&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            {</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/* Nav */</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Nav</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">/&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            {</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/* main */</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">main</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;w-full border border-green-600 p-4&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">children</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">main</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Dưới đây là bản dịch sang tiếng Việt của nội dung bạn cung cấp:</p><h3 id="phong-chu" tabindex="-1"><a class="header-anchor" href="#phong-chu"><span>Phông chữ</span></a></h3><p>Next.js sử dụng mô-đun <code>next/font</code> để tải phông chữ Google, thay vì tải thông qua CSS như trước đây. Điều này giúp Next.js tối ưu hóa việc tải phông chữ.</p><h4 id="tai-sao-can-toi-uu-hoa-phong-chu" tabindex="-1"><a class="header-anchor" href="#tai-sao-can-toi-uu-hoa-phong-chu"><span>Tại sao cần tối ưu hóa phông chữ?</span></a></h4><ul><li>Quá trình trình duyệt tải phông chữ</li></ul><!--[--><div class="mermaid-actions"><button class="preview-button" title="preview"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1316 1024" fill="currentColor"><path d="M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z"/><path d="M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z"/></svg></button><button class="download-button" title="download"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1024 1024" fill="currentColor"><path d="M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z"/></svg></button></div><div class="mermaid-wrapper"><div class="loading-icon-wrapper mermaid-loading" style="display:flex;align-items:center;justify-content:center;height:96px;"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" preserveAspectRatio="xMidYMid" viewBox="25 25 50 50"><animateTransform attributeName="transform" type="rotate" dur="2s" keyTimes="0;1" repeatCount="indefinite" values="0;360"></animateTransform><circle cx="50" cy="50" r="20" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round"><animate attributeName="stroke-dasharray" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="1,200;90,200;1,200"></animate><animate attributeName="stroke-dashoffset" dur="1.5s" keyTimes="0;0.5;1" repeatCount="indefinite" values="0;-35px;-125px"></animate></circle></svg></div></div><!--]--><p>「Khi thay thế phông chữ, có thể xuất hiện sự thay đổi về kích thước, khoảng cách và bố cục, dẫn đến CLS」 (CLS: Là một trong những chỉ số của Google dùng để đánh giá hiệu suất và trải nghiệm người dùng của website, đo lường tính ổn định của bố cục trong quá trình tải trang)</p><p>Khi sử dụng mô-đun <code>next/font</code>, Next.js sẽ tự động tối ưu hóa phông chữ. Trong quá trình xây dựng dự án, phông chữ sẽ được tải xuống và lưu trữ cùng với các tệp tài nguyên khác, cải thiện hiệu suất truy cập trang.</p><h4 id="cach-thuc-hien" tabindex="-1"><a class="header-anchor" href="#cach-thuc-hien"><span>Cách thực hiện</span></a></h4><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Inter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/font/google&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Tải xuống tập con phông chữ theo nhu cầu, tiết kiệm tài nguyên</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> inter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Inter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">subsets</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;latin&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] }); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Bộ ký tự Latin</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{inter.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">className</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">children</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span></code></pre></div><h2 id="đinh-tuyen-trang" tabindex="-1"><a class="header-anchor" href="#đinh-tuyen-trang"><span>Định tuyến trang</span></a></h2><p>Next.js 14 mặc định sử dụng chế độ App Router.</p><p>Khác với chế độ Page Router, trong App Router, bất kỳ thư mục nào có trang có thể truy cập được, 「phải được cố định định nghĩa là page.tsx」, thư mục sẽ đóng vai trò là nội dung, ví dụ:</p><table><thead><tr><th>Đường dẫn</th><th>App Router</th><th>Page Router</th></tr></thead><tbody><tr><td>/</td><td>app/page.tsx</td><td>pages/index.tsx</td></tr><tr><td>/about</td><td>app/about/page.tsx</td><td>pages/about/index.tsx</td></tr><tr><td>/blog/1</td><td>app/blog/[id]/page.tsx</td><td>pages/blog/[id]/index.tsx hoặc pages/blog/[id].tsx</td></tr><tr><td>/test/1/a</td><td>app/test/[...slug]/page.tsx</td><td>pages/test/[...slug]/index.tsx hoặc pages/test/[...slug].tsx</td></tr></tbody></table><h2 id="đinh-tuyen-api" tabindex="-1"><a class="header-anchor" href="#đinh-tuyen-api"><span>Định tuyến API</span></a></h2><p>Khác với chế độ Page Router, trong chế độ App Router, thư mục api phải được đặt trong thư mục app, và 「phải được đặt tên là route.ts」</p><table><thead><tr><th>Đường dẫn</th><th>App Router</th><th>Page Router</th></tr></thead><tbody><tr><td>/api/product</td><td>app/api/product/route.ts</td><td>pages/api/product/index.ts</td></tr><tr><td>/api/product/1</td><td>app/api/product/[id]/route.ts</td><td>pages/api/product/[id]/index.ts hoặc pages/api/product/[id].ts</td></tr></tbody></table><h3 id="xu-ly-api" tabindex="-1"><a class="header-anchor" href="#xu-ly-api"><span>Xử lý API</span></a></h3><h4 id="che-đo-app-router" tabindex="-1"><a class="header-anchor" href="#che-đo-app-router"><span>Chế độ App Router</span></a></h4><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> GET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">   // Logic lấy dữ liệu</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> ...;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> POST</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> body</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">   // Logic chèn dữ liệu</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">msg</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Created success&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> DELETE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> id</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">nextUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">searchParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">     return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">msg</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Delete Failed&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">   // Logic xóa dữ liệu</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">msg</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Deleted Success&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> PUT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> id</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">nextUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">searchParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">     return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">msg</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Update Failed&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">   // Logic cập nhật dữ liệu</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">msg</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Updated Success&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="che-đo-page-router" tabindex="-1"><a class="header-anchor" href="#che-đo-page-router"><span>Chế độ Page Router</span></a></h4><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">res</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   switch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">method</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      case</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;GET&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">         // ...</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      case</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;POST&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">         // ...</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      case</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;DELETE&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">         // ...</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      case</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;PUT&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">         // ...</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      default</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">         // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h2 id="meo-tao-thu-muc" tabindex="-1"><a class="header-anchor" href="#meo-tao-thu-muc"><span>Mẹo Tạo Thư Mục</span></a></h2><p>Cơ bản, chúng ta sẽ đặt thư mục trang, thư mục API, thư mục thành phần (components), thư viện (lib) và các thư mục khác trong thư mục <code>app</code>, để dễ dàng phân biệt giữa thư mục trang và các thư mục khác. Chúng ta có thể sử dụng &quot;thư mục ảo&quot; để đặt tất cả các thư mục trang không phải là trang chính (/) vào thư mục <code>app/(pages)</code> dưới đây, điều này sẽ không ảnh hưởng đến việc truy cập đường dẫn. Đặt chúng dưới <code>(pages)</code> hoặc trong thư mục <code>app</code> sẽ có hiệu quả giống nhau. Việc làm này nhằm làm cho cấu trúc thư mục trở nên rõ ràng hơn. Cấu trúc thư mục <code>app</code> như sau:</p><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (pages)                         Thư mục trang</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   ├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> about</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                       /about</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   │</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   └──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> page.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Trang</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> về</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   └──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> overview</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                    //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> overview</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">       ├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> layout.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">             //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Tất</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cả</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> các</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> trang</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> trong</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> overview</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sẽ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chia</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sẻ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> layout</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> này</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">       ├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> page1</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                  /overview/page1</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">       │</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   └──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> page.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">           //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Trang</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">       └──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> page2</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                  /overview/page2</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">           └──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> page.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">           //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Trang</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> api</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                             Thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> API</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   └──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> news</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                        //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tin</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tức</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">       ├──</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [id]                   // Thư mục với ID</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">       │</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   └──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> route.ts</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">           //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Đường</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dẫn</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /api/news/123</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">       └──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> route.ts</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">               //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Đường</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dẫn</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /api/news</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> components</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                      Thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thành</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> phần</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> favicon.ico</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                     //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Biểu</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tượng</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> trang</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> global-error.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">               //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Trang</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> lỗi</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cấp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cao</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> globals.css</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                     //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> CSS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> toàn</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cục</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> layout.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                      //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> RootLayout</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> lib</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                             Thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tiện</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> ích</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">│</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   └──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> db.ts</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                       //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Tập</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tin</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> quản</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> lý</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cơ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sở</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dữ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> liệu</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> not-found.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                  //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Trang</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 404</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cấp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cao</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> page.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                       //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Trang</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chính</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (/)</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">└──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> types</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                           Thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> kiểu</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> TypeScript</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    └──</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> news-type.ts</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">               //</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Kiểu</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dữ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> liệu</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cho</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tin</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tức</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="hinh-anh" tabindex="-1"><a class="header-anchor" href="#hinh-anh"><span>Hình Ảnh</span></a></h2><ul><li>Sử dụng mô-đun <code>next/image</code>, nó sẽ giúp chúng ta tối ưu hóa hình ảnh.</li></ul><h3 id="tai-sao-can-toi-uu-hoa-hinh-anh" tabindex="-1"><a class="header-anchor" href="#tai-sao-can-toi-uu-hoa-hinh-anh"><span>Tại sao cần tối ưu hóa hình ảnh?</span></a></h3><ul><li><p>Gửi hình ảnh lớn đến màn hình nhỏ, lãng phí băng thông.</p></li><li><p>Quá trình tải hình ảnh từ không đến có dễ gây ra CLS (dịch chuyển bố cục).</p></li><li><p>Nhiều hình ảnh yêu cầu đồng thời gây cản trở việc hiển thị trang.</p></li></ul><h3 id="lam-the-nao-đe-thuc-hien" tabindex="-1"><a class="header-anchor" href="#lam-the-nao-đe-thuc-hien"><span>Làm thế nào để thực hiện?</span></a></h3><p>Next.js cung cấp giải pháp tối ưu hóa hình ảnh thông qua thành phần <code>Image</code>. Sử dụng thành phần <code>Image</code> có bốn lợi ích:</p><ul><li><p>Tối ưu hóa kích thước hình ảnh: xuất ra định dạng webp.</p></li><li><p>Sử dụng kích thước và định dạng phù hợp cho từng thiết bị (khi truy cập trang bằng Chrome, hình ảnh sẽ được chuyển đổi sang định dạng webp).</p></li><li><p>Ngăn ngừa CLS (dịch chuyển bố cục tích lũy).</p></li><li><p>Tải chậm: hình ảnh chỉ được tải khi nó nằm trong chế độ xem.</p></li><li><p>Tùy chỉnh kích thước hình ảnh, width, height; vì đã định nghĩa w và h, nên hình ảnh sẽ có tỷ lệ chiều rộng và chiều cao cố định, ngăn ngừa CLS.</p></li><li><p>Next.js sẽ chuyển đổi và lưu vào bộ nhớ cache hình ảnh có kích thước tương ứng dựa trên giá trị <code>width</code> và <code>height</code> của <code>Image</code> khi trang yêu cầu từ Server.</p></li></ul><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> Image</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/image&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> About</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">props</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      {</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/* &lt;img</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">          src={&#39;/img.jpeg&#39;}</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">          alt=&quot;Hình ảnh&quot;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      /&gt; */</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">Image</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          src</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/img.jpeg&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          alt</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Hình ảnh&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          width</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          height</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          placeholder</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Dữ liệu base64 của hình ảnh&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      /&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">Image</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          src</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/hero-desktop.png&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          width</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          height</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">760</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;hidden md:block&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          alt</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Screenshots of the dashboard project showing desktop version&quot;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      /&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">Image</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          src</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/hero-mobile.png&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          width</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">560</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          height</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">620</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;block md:hidden&quot;</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Hình ảnh chỉ được tải xuống và hiển thị khi ở thiết bị di động, thật tuyệt vời </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">          alt</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Screenshots of the dashboard project showing desktop version&quot;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      /&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="yeu-cau-hinh-anh-tu-nguon-ben-ngoai-voi-han-che-truy-cap" tabindex="-1"><a class="header-anchor" href="#yeu-cau-hinh-anh-tu-nguon-ben-ngoai-voi-han-che-truy-cap"><span>Yêu cầu hình ảnh từ nguồn bên ngoài với hạn chế truy cập</span></a></h3><ul><li>Cấu hình trong <code>next.config.js</code>.</li></ul><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> nextConfig</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  images</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    remotePatterns</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        protocol</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;https&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        hostname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;*&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      },</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ],</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre></div><h3 id="xu-ly-loi-hinh-anh" tabindex="-1"><a class="header-anchor" href="#xu-ly-loi-hinh-anh"><span>Xử Lý Lỗi Hình Ảnh</span></a></h3><h4 id="thiet-lap-width-va-height-la-auto" tabindex="-1"><a class="header-anchor" href="#thiet-lap-width-va-height-la-auto"><span>Thiết lập width và height là auto</span></a></h4><p>Nếu bạn cùng lúc thêm thuộc tính width và height, trình duyệt sẽ hiển thị cảnh báo: &quot;Hình ảnh với src &#39;xxxx&#39; có width hoặc height đã được chỉnh sửa, nhưng không có thuộc tính còn lại. Nếu bạn sử dụng CSS để thay đổi kích thước hình ảnh của mình, hãy thêm các thuộc tính &#39;width: auto&#39; hoặc &#39;height: auto&#39; để duy trì tỷ lệ khung hình.&quot;</p><p><strong>Giải pháp:</strong> Thêm kiểu <code>width: auto</code> và <code>height: auto</code> vào thành phần Image.</p><h4 id="goi-y-toi-uu-lcp" tabindex="-1"><a class="header-anchor" href="#goi-y-toi-uu-lcp"><span>Gợi ý tối ưu LCP</span></a></h4><p>&quot;Hình ảnh với src &#39;xxx&#39; đã được phát hiện là Largest Contentful Paint (LCP). Vui lòng thêm thuộc tính &#39;priority&#39; nếu hình ảnh này nằm trên vùng nhìn thấy.&quot;</p><p>Thường xuất hiện với logo trên trang.</p><p>LCP là một giá trị thời gian, dùng để đo thời gian trình duyệt của người dùng cần để hiển thị phần tử nội dung lớn nhất trong vùng nhìn thấy. Phần tử nội dung lớn nhất có thể là:</p><ul><li>Phần tử khối chứa văn bản (như tiêu đề hoặc đoạn văn).</li><li>Hình ảnh được thêm vào bằng thẻ HTML <code>&lt;img&gt;</code>, thẻ <code>&lt;image&gt;</code> trong phần tử SVG, hoặc hình ảnh nền CSS được định nghĩa bằng hàm CSS <code>url()</code> (không bao gồm nền gradient).</li><li>Phần tử <code>&lt;video&gt;</code> với thuộc tính <code>poster</code> (thời gian hiển thị của hình ảnh sử dụng poster).</li></ul><p><strong>Giải pháp:</strong> Thêm thuộc tính <code>priority</code> cho thành phần Image.</p><h4 id="hinh-anh-yeu-cau-that-bai-hien-thi-mot-hinh-anh-mac-đinh" tabindex="-1"><a class="header-anchor" href="#hinh-anh-yeu-cau-that-bai-hien-thi-mot-hinh-anh-mac-đinh"><span>Hình ảnh yêu cầu thất bại, hiển thị một hình ảnh mặc định</span></a></h4><ul><li><p>Khi yêu cầu hình ảnh thất bại, chúng ta muốn cung cấp một hình ảnh mặc định, có thể sử dụng <code>onError</code> trên thành phần Image, sau đó kết hợp với <code>useState</code> để gán lại một hình ảnh mặc định.</p></li><li><p>Tuy nhiên, điều này gây ra một vấn đề: <code>useState</code> chỉ có thể được sử dụng trong các client component. Chúng ta có thể trừu tượng hóa thành phần Image thành một client component riêng biệt.</p></li></ul><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ImageWithFallback</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    height</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    width</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">300</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    src</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{p.article.image_url || </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">defaultNewsPng</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    alt</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Hình ảnh cho thử nghiệm&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    fallback</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">defaultNewsPng</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">/&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// ImageWithFallback.tsx</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> Image</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ImageProps</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">StaticImageData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/image&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ImageWithFallbackType</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ImageProps</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &amp; {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    fallback</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">StaticImageData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ImageWithFallback</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">fallback</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">src</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">alt</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, ...</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ImageWithFallbackType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">imgSrc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">setImgSrc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">src</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">Image</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            {...</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            src</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">imgSrc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            alt</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{alt || </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;mô tả mặc định&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            onError</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{() =&gt; </span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setImgSrc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(fallback.src)}</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        /&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="đieu-huong-link" tabindex="-1"><a class="header-anchor" href="#đieu-huong-link"><span>Điều hướng Link</span></a></h2><p>Lợi ích của việc sử dụng component Link thay vì thẻ a:</p><ul><li><p>Không làm mới toàn bộ trang</p></li><li><p>Tự động phân tách mã: dựa trên route sẽ tự động phân tách code (code-splitting)</p></li><li><p>Dự đoán trước mã (pre-fetch): trong môi trường production, khi component Link xuất hiện trong khung nhìn của trình duyệt, Next.js sẽ tự động prefetch trang được liên kết qua Link.href</p></li></ul><h3 id="trang-thai-active" tabindex="-1"><a class="header-anchor" href="#trang-thai-active"><span>Trạng thái Active</span></a></h3><p>Lưu ý: Chỉ trên client mới có thể biết link nào đang ở trạng thái active, do đó cần thêm &#39;use client&#39;;</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;     </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> Link</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/link&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">usePathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/navigation&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Nav</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> pathname</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> usePathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ul</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;   </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">li</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;/overview/page1&#39;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;active&#39;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">page1</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">li</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">li</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;/overview/page2&#39;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;active&#39;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">page2</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">li</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ul</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  )   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h2 id="trang-not-found" tabindex="-1"><a class="header-anchor" href="#trang-not-found"><span>Trang Not Found</span></a></h2><p>Next.js sẽ tự động tạo trang 404, nếu bạn muốn sử dụng trang 404 của riêng mình, cần tuân thủ các nguyên tắc sau:</p><h3 id="trang-404-toan-cuc" tabindex="-1"><a class="header-anchor" href="#trang-404-toan-cuc"><span>Trang 404 toàn cục</span></a></h3><p>Trong thư mục <code>app</code>, tạo tệp <code>not-found.tsx</code>. Khi truy cập vào route không tồn tại, tự động chuyển hướng đến trang not-found toàn cục.</p><ul><li><p>Lưu ý: Tệp <code>not-found.tsx</code> toàn cục chỉ có hiệu lực trong thư mục <code>app</code>, nếu ở nơi khác sẽ không có hiệu lực.</p></li><li><p>/app/not-found.tsx</p></li></ul><h3 id="trang-404-cuc-bo" tabindex="-1"><a class="header-anchor" href="#trang-404-cuc-bo"><span>Trang 404 cục bộ</span></a></h3><ul><li><p>404 cục bộ thường dùng khi không lấy được dữ liệu cần thiết, không phải do trang không tồn tại.</p></li><li><p>Trong một thư mục trang cụ thể hoặc layout chia sẻ, tạo tệp <code>not-found.tsx</code>.</p></li><li><p>Cần kích hoạt thủ công phương thức <code>notFound</code> từ <code>next/navigation</code>.</p></li></ul><p>Ví dụ: <code>/app/overview/not-found.tsx</code>. Khi truy cập <code>/app/overview/page2</code> và không lấy được dữ liệu từ API, sẽ xuất hiện trang 404 cục bộ.</p><table><thead><tr><th><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4d607004728f4bf3ae911e3822a4926c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=437&amp;h=251&amp;s=30636&amp;e=png&amp;b=fefefe" alt="Image" loading="lazy"></th><th><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/abd6ea28a13749f6ac3cf5ab801e1241~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1065&amp;h=208&amp;s=33406&amp;e=png&amp;b=fdfdfd" alt="Image" loading="lazy"></th></tr></thead></table><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /app/overview/page2.tsx   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">notFound</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/navigation&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {   </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // Giả lập việc lấy dữ liệu   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> notFound</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  }    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">h1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ô</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> l</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">à </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">page2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">h1</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h2 id="trang-error" tabindex="-1"><a class="header-anchor" href="#trang-error"><span>Trang Error</span></a></h2><p>Tùy chỉnh trang lỗi</p><h3 id="trang-error-toan-cuc" tabindex="-1"><a class="header-anchor" href="#trang-error-toan-cuc"><span>Trang Error toàn cục</span></a></h3><ul><li><p>Trang lỗi toàn cục chỉ có hiệu lực trong thư mục <code>app</code>, tạo tệp <code>global-error.tsx</code>, nếu không sẽ không có hiệu lực.</p></li><li><p>Trong môi trường production, có thể thấy trang lỗi toàn cục, còn trong môi trường phát triển sẽ không thấy.</p></li></ul><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> GlobalError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({   </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">reset</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}: {  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &amp; { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">digest</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> };  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  reset</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> void</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}) {   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">html</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">h2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">C</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ó </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">s</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ự </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ố </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">x</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ả</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">y</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> ra</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">h2</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> onClick</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{() =&gt; </span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">reset</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Th</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ử </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">l</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ạ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">html</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="trang-error-cuc-bo" tabindex="-1"><a class="header-anchor" href="#trang-error-cuc-bo"><span>Trang Error cục bộ</span></a></h3><ul><li>Trong một trang cụ thể hoặc layout chia sẻ, tạo tệp <code>error.tsx</code>.</li></ul><table><thead><tr><th><img src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjhWyZBicURjWbIyhw5hA4nry85ngiaic4wnSEN6foC7JJoSASlClP8MM0A/640?wx_fmt=other&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="Image" loading="lazy"></th><th><img src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQj0LrLdJbEVd5IA4Cia8LBZib7icygicibLwEjfOtYt5YM3FhOPuPuRVLBY0A/640?wx_fmt=other&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="Image" loading="lazy"></th></tr></thead></table><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;xxx&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">h1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ô</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> l</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">à </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">page2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">h1</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h2 id="loading" tabindex="-1"><a class="header-anchor" href="#loading"><span>Loading</span></a></h2><p>Tùy chỉnh loading</p><h3 id="loading-cap-trang" tabindex="-1"><a class="header-anchor" href="#loading-cap-trang"><span>Loading cấp trang</span></a></h3><p>Khi truy cập bất kỳ trang nào trong thư mục có tệp <code>loading.tsx</code>, trình duyệt sẽ tự động tải và hiển thị loading trước. Khi trang đã sẵn sàng, loading sẽ ẩn đi và trang sẽ được hiển thị. Tất cả quy trình này đều diễn ra tự động.</p><p>「Thực hành tốt nhất:」</p><ul><li><p>Loading toàn cục: <code>app/loading.tsx</code></p></li><li><p>Loading cục bộ: <code>app/xxxx/loading.tsx</code></p></li></ul><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjyZop3lnX9PvbeicVxadkww7DLu3NKor2PG7ELUTFmfYDv2mdq1ZLOgA/640?wx_fmt=other&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="Hình ảnh" tabindex="0" loading="lazy"><figcaption>Hình ảnh</figcaption></figure><h4 id="cach-ly-loading" tabindex="-1"><a class="header-anchor" href="#cach-ly-loading"><span>Cách ly loading</span></a></h4><div class="language-sh" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">/app/overview</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> page1/page.tsx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> page2/page.tsx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> page.tsx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> loading.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   Loading</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> bộ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sẽ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> áp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dụng</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cho</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tất</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cả</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> các</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> trang</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> trong</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> overview</span></span></code></pre></div><div class="language-sh" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">/app/overview</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> page1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">     |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> page.tsx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">     |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> loading.tsx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> page2/page.tsx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> page.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   Loading</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> bộ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chỉ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> áp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dụng</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cho overview/page1</span></span></code></pre></div><p>Giả sử bạn muốn loading cục bộ chỉ áp dụng cho một trang cụ thể mà không áp dụng cho các trang khác trong cùng thư mục, cách thực hiện như thế nào? Giả sử cấu trúc thư mục trang của bạn như sau:</p><p>「- Dùng “thư mục ảo” (tên tùy ý, có thể gọi là xxx) để bao bọc phạm vi loading và page.tsx riêng biệt」</p><div class="language-sh" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">/app/overview</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  |(</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">overview</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">     |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> loading.tsx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">     |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> page.tsx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> page1/page.tsx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  |</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> page2/page.tsx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">   Loading</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sẽ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chỉ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> áp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dụng</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cho</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tất</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cả</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> các</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> trang</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> trong</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">overview/(overview</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">)`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">   Tức</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> là</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> khi</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> truy</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cập</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">/overview</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chỉ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> khi</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> đó</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mới</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> hiển</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thị</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> loading</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> bộ.</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">   Còn</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> khi</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> truy</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cập</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">/overview/page1</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> hoặc</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">/overview/page2</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sẽ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> quay</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> lại</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> loading</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> toàn</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cục.</span></span></code></pre></div><h3 id="loading-cap-thanh-phan" tabindex="-1"><a class="header-anchor" href="#loading-cap-thanh-phan"><span>Loading cấp thành phần</span></a></h3><p>Sử dụng với <code>Suspense</code>, được truyền vào dưới dạng fallback</p><div class="language-jsx" data-highlighter="shiki" data-ext="jsx" data-title="jsx" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Suspense</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> fallback</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">LoadingComp</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> /&gt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Comp</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> /&gt;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Suspense</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><h2 id="ssg-va-ssr" tabindex="-1"><a class="header-anchor" href="#ssg-va-ssr"><span>SSG và SSR</span></a></h2><p>NextJS 14 mặc định sử dụng SSG. Hãy xem một ví dụ:</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// http://localhost:3000   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ArticleApi</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/api/article-api&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Home</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> articles</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ArticleApi</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">fetchToday</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (   </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{new </span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">toLocaleTimeString</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{JSON.stringify(articles)}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;/&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Mặc định, sau khi bạn chạy <code>npm run build</code> và <code>npm run start</code>, dù bạn có làm mới trình duyệt bao nhiêu lần, nội dung vẫn không thay đổi, ngay cả khi có fetch, thời gian hiển thị vẫn không thay đổi.</li></ul><p><strong>SSG</strong>: Kết xuất tĩnh, khi dữ liệu được tái tạo trên Server trong quá trình build và triển khai, các trang tĩnh được tạo ra có thể phân phát và lưu trữ trên toàn thế giới.</p><ul><li><p>Lợi ích: Truy cập nhanh hơn, giảm tải cho Server, tốt cho SEO.</p></li><li><p>Tình huống sử dụng: Dữ liệu không thay đổi hoặc dữ liệu được chia sẻ giữa nhiều trang.</p></li></ul><p><strong>SSR</strong>: Kết xuất động, dữ liệu được lấy lại mỗi lần Server nhận được yêu cầu từ người dùng và trang được tái tạo lại.</p><ul><li>Lợi ích: Hiển thị dữ liệu theo thời gian thực, dữ liệu cụ thể cho từng người dùng (dùng để phân biệt đối xử), có thể lấy được cookie và tham số URL từ yêu cầu của client.</li></ul><h3 id="cache" tabindex="-1"><a class="header-anchor" href="#cache"><span>Cache</span></a></h3><h4 id="thoi-gian-hieu-luc-cua-ssg" tabindex="-1"><a class="header-anchor" href="#thoi-gian-hieu-luc-cua-ssg"><span>Thời gian hiệu lực của SSG</span></a></h4><p>Khi bạn cần thiết lập một thời gian hiệu lực cố định cho SSG, bạn có thể thêm một dòng vào đầu tệp trang:</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> revalidate</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// 10 giây</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {}</span></span></code></pre></div><p>Khi thêm dòng mã này vào ví dụ trên -&gt; <code>npm run build</code> -&gt; <code>npm start</code>, bạn có thể quan sát thấy trong trình duyệt rằng sau mỗi 10 giây làm mới, thời gian mới sẽ thay đổi. Điều này xảy ra vì bạn đã thiết lập <code>revalidate</code> cho toàn bộ trang là 10 giây.</p><p>Thiết lập thời gian xác thực lại mặc định cho bố cục hoặc trang. Tùy chọn này sẽ không ghi đè lên thiết lập <code>revalidate</code> được chỉ định cho từng yêu cầu <code>fetch</code>. Nếu được thiết lập, mỗi yêu cầu <code>fetch</code> trong trang sẽ có thời gian hiệu lực được thiết lập.</p><p>「Lưu ý: <code>revalidate = 600</code> là hợp lệ, nhưng <code>revalidate = 60 * 10</code> là không hợp lệ」</p><h4 id="ssr" tabindex="-1"><a class="header-anchor" href="#ssr"><span>SSR</span></a></h4><p>Thêm một dòng vào đầu tệp trang, đảm bảo rằng mỗi lần truy cập đều là mới nhất:</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> dynamic</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;force-dynamic&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h4 id="cache-đo-granularity-cua-fetch" tabindex="-1"><a class="header-anchor" href="#cache-đo-granularity-cua-fetch"><span>Cache độ granularity của fetch</span></a></h4><p>Cache chi tiết, áp dụng cho yêu cầu <code>fetch</code>, Next.js 14 mặc định sử dụng:</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;https://...&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">cache</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;force-cache&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> })</span></span></code></pre></div><p>Chúng ta có thể cấu hình hành vi cache của từng yêu cầu <code>fetch</code> một cách riêng biệt. Điều này cho phép bạn kiểm soát hành vi cache một cách chi tiết hơn, chẳng hạn, có thể đặt <code>revalidate</code> khác nhau cho từng yêu cầu <code>fetch</code>, hoặc một yêu cầu không thay đổi, một yêu cầu có thể thay đổi khi quá thời gian hiệu lực.</p><h5 id="thoi-gian-xac-thuc-lai-cho-fetch-la-5-giay" tabindex="-1"><a class="header-anchor" href="#thoi-gian-xac-thuc-lai-cho-fetch-la-5-giay"><span>Thời gian xác thực lại cho fetch là 5 giây</span></a></h5><p>Có thể thêm thuộc tính <code>next.revalidate</code> vào <code>fetch</code>, thiết lập vòng đời:</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> fetch1</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> fetch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/api/xxx&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      revalidate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Thời gian hiệu lực cache cho yêu cầu là 5 giây. Nếu thiết lập là true, có nghĩa là không có cache, sẽ yêu cầu mỗi lần.</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  })</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span></code></pre></div><h6 id="truong-hop-ngoai-le" tabindex="-1"><a class="header-anchor" href="#truong-hop-ngoai-le"><span>Trường hợp ngoại lệ</span></a></h6><p>Mặc định, Next.js sẽ tự động cache các giá trị trả về của dữ liệu trên Server trong cache của <code>fetch</code>. Điều này có nghĩa là bạn có thể lấy dữ liệu khi tạo hoặc khi yêu cầu, cache dữ liệu và tái sử dụng cho mỗi yêu cầu dữ liệu, thường dùng cho việc truy vấn dữ liệu. Tuy nhiên, có một số trường hợp ngoại lệ mà <code>fetch</code> sẽ không cache yêu cầu:</p><ul><li>Sử dụng trong các thao tác trên Server, Server Action</li><li>Sử dụng trong các trình xử lý tuyến đường với phương thức <code>POST</code></li></ul><h5 id="tat-cache-voi-fetch" tabindex="-1"><a class="header-anchor" href="#tat-cache-voi-fetch"><span>Tắt cache với fetch</span></a></h5><p>Đặt tùy chọn <code>fetch</code> là <code>&#39;no-store&#39;</code> có nghĩa là lấy dữ liệu một cách động và không lưu cache.</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">fetch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;https://...&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">cache</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;no-store&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> })</span></span></code></pre></div><h5 id="so-sanh-no-store-va-no-cache" tabindex="-1"><a class="header-anchor" href="#so-sanh-no-store-va-no-cache"><span>So sánh no-store và no-cache</span></a></h5><p>Chỉ thị <code>no-cache</code> không có nghĩa là hoàn toàn cấm cache. Trên thực tế, nó cho phép cache lưu trữ phản hồi nhưng yêu cầu phải xác thực tính hợp lệ của phản hồi đó trước khi sử dụng.</p><ul><li>Khi một yêu cầu có chỉ thị <code>no-cache</code>, trình duyệt sẽ gửi một yêu cầu điều kiện (ví dụ: sử dụng các header <code>If-Modified-Since</code> hoặc <code>If-None-Match</code>), hỏi Server xem nội dung cache có còn hợp lệ không. Nếu Server xác nhận nội dung không thay đổi, nó sẽ trả về mã trạng thái 304 (không thay đổi), chỉ định rằng trình duyệt có thể tiếp tục sử dụng phiên bản cache; nếu nội dung đã thay đổi, Server sẽ trả về nội dung mới.</li></ul><p>Chỉ thị <code>no-store</code> thì hoàn toàn cấm cache.</p><p><code>no-cache</code> yêu cầu phải xác thực trước khi sử dụng phản hồi từ cache, trong khi <code>no-store</code> thì hoàn toàn cấm lưu trữ phản hồi. <code>no-cache</code> có thể vẫn giúp tăng tốc độ tải vì nó cho phép sử dụng cache sau khi xác thực, trong khi <code>no-store</code> có thể dẫn đến hiệu suất giảm vì nó buộc phải lấy dữ liệu từ Server mỗi lần.</p><h4 id="cache-cho-api-route" tabindex="-1"><a class="header-anchor" href="#cache-cho-api-route"><span>Cache cho API Route</span></a></h4><p>Tại đầu tệp <code>route.ts</code>, thêm cấu hình:</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// export const dynamic = &#39;force-dynamic&#39;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> revalidate</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> GET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {}</span></span></code></pre></div><ul><li>Mặc định, yêu cầu <code>GET</code> sẽ được cache, còn yêu cầu <code>POST</code> sẽ là động (không cache).</li></ul><h3 id="cache-lay-du-lieu-tu-server-qua-thu-vien-ben-thu-ba" tabindex="-1"><a class="header-anchor" href="#cache-lay-du-lieu-tu-server-qua-thu-vien-ben-thu-ba"><span>Cache (Lấy dữ liệu từ Server qua thư viện bên thứ ba)</span></a></h3><p>Nếu bạn đang sử dụng thư viện bên thứ ba không hỗ trợ hoặc không công khai <code>fetch</code> (ví dụ, cơ sở dữ liệu, CMS hoặc client ORM), bạn có thể sử dụng tùy chọn cấu hình đoạn API route hoặc <code>unstable_cache</code> để thực hiện.</p><p>Ví dụ: trên Server, yêu cầu cơ sở dữ liệu</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">unstable_noStore</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> noStore</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/cache&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> fetchRevenue</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  noStore</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Đánh dấu rõ ràng noStore</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Yêu cầu cơ sở dữ liệu</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {}</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">getUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./data&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">unstable_cache</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/cache&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> getCachedUser</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> unstable_cache</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  async</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;my-app-user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Component</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">userID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> user</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getCachedUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">userID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="cache-trong-react" tabindex="-1"><a class="header-anchor" href="#cache-trong-react"><span>Cache trong React</span></a></h3><p>Hàm <code>cache</code> trong React cũng có thể được sử dụng để ghi nhớ các yêu cầu dữ liệu.</p><p><code>cache(fn)</code> sẽ cache kết quả thực thi của fn. Khi gọi lại, có thể lấy kết quả từ cache.</p><p><strong>Tình huống ứng dụng</strong>: Trong cùng một trang, nhiều component đều yêu cầu cùng một API hoặc dữ liệu từ Server. Chúng ta chỉ muốn yêu cầu một lần cho API hoặc dữ liệu đó.</p><p>「Câu hỏi: Tình huống ứng dụng ở trên không đúng, nếu mọi người chia sẻ dữ liệu, tại sao không trực tiếp yêu cầu dữ liệu trên component cha, rồi truyền props xuống? Việc sử dụng cache không phải là thừa sao???」</p><ul><li><p>Giả sử, các component này là các component độc lập có thể yêu cầu dữ liệu.</p></li><li><p>Vậy thì, rõ ràng chúng ta cần cache để lưu trữ kết quả.</p></li></ul><p><strong>Cách sử dụng?</strong></p><ul><li>Bọc hàm yêu cầu dữ liệu từ Server/Client bằng <code>React.cache</code>. Nếu nhiều component cùng yêu cầu hàm này, chỉ yêu cầu một lần trên cùng một trang. Xem ví dụ:</li></ul><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/utils.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">cache</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getData</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  setTimeout</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> resolve</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">toLocaleTimeString</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()), </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">3000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> getItem</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> cache</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;------ Yêu cầu ------&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // Mô phỏng yêu cầu cơ sở dữ liệu</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> item</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre></div><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/item/[id]/layout.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">getItem</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./lib/util&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Home</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> time</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getItem</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> ();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/item/[id]/page.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">getItem</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./lib/util&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> time</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getItem</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> ();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Xem log của Server, nhận thấy rằng mặc dù layout và page đều yêu cầu <code>getItem</code>, nhưng <code>getItem</code> chỉ thực thi một lần, &quot;Tuyệt vời !!!&quot;</p><h2 id="ssg-tien-render-cho-trang-co-tham-so-đong" tabindex="-1"><a class="header-anchor" href="#ssg-tien-render-cho-trang-co-tham-so-đong"><span>SSG Tiền render cho trang có tham số động</span></a></h2><p>Sử dụng <code>generateStaticParams</code> thay thế cho <code>getStaticPaths</code> trong Next.js 13.</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /product/[id]/page.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> revalidate</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// 1000 giây</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> generateStaticParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // return { [propertyName]: value };</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">].</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">id</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    id</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">params</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }}) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">param</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // return ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h2 id="streaming-render-bat-đong-bo" tabindex="-1"><a class="header-anchor" href="#streaming-render-bat-đong-bo"><span>Streaming (Render bất đồng bộ)</span></a></h2><p><strong>Xử lý Stream</strong>: Chia một “khối lớn” dữ liệu thành “nhiều khối nhỏ” để xử lý. Nói một cách đơn giản, Next.js có thể chia một trang thành phần tĩnh và phần động, tránh việc phải chờ tất cả các component được tải hoàn toàn trước khi render, gây ra hiện tượng blocking trang.</p><p><strong>Tình huống ứng dụng</strong>: Stream, thao tác tệp, dữ liệu stream, component render bất đồng bộ.</p><p><strong>Cách sử dụng</strong>: Kể từ React 17, frontend đã hỗ trợ render bất đồng bộ component thông qua <code>Suspense/lazy</code>. Bây giờ chúng ta thực hiện thông qua render trên Server.</p><p><strong>Lợi ích</strong>: Có thể xây dựng một trang, với phần tĩnh (các dữ liệu không thay đổi) và phần động (các dữ liệu thay đổi), &quot;Tuyệt vời&quot;.</p><ol><li><p>Đầu tiên, đặt yêu cầu dữ liệu vào component để yêu cầu độc lập.</p></li><li><p>Đảm bảo yêu cầu dữ liệu là động (<code>no-store</code>), nếu không, không cần sử dụng Stream, chỉ cần SSG là đủ.</p></li><li><p>Nhúng component và bọc bằng <code>Suspense</code>.</p></li></ol><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// A, B render động bất đồng bộ, C render tĩnh</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Suspense</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">A</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/components/A&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">B</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/components/B&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">C</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/components/C&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">C</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Suspense</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> fallback</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{&lt;p&gt;Đang tải nội dung...</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">          &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">A</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Suspense</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Suspense</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> fallback</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{&lt;p&gt;Đang tải nội dung...</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">          &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">B</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Suspense</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="network-waterfall-mo-hinh-nuoc-đo-mang" tabindex="-1"><a class="header-anchor" href="#network-waterfall-mo-hinh-nuoc-đo-mang"><span>Network Waterfall（Mô hình nước đổ mạng）</span></a></h2><p><code>Yêu cầu A --&gt; Yêu cầu B --&gt; Yêu cầu C --&gt; ....</code></p><p>Đây là mô hình nước đổ mạng. Nếu A, B và C không có mối quan hệ phụ thuộc bắt buộc, thì tất cả các yêu cầu này sẽ phải hoàn thành trước khi có thể kết xuất trang, điều này dẫn đến hiệu suất kém.</p><p><strong>「Bad:」</strong></p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> data1</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> fetch1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> data2</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> fetch2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> data3</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> fetch3</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // return ...;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>「Good:」</strong></p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">data1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">data2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">data3</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">all</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">([</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        fetch1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        fetch2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        fetch3</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ]);</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // return ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>「Mặc dù NextJs hỗ trợ yêu cầu dữ liệu từ phía client, nhưng thường không khuyến nghị làm như vậy. Tại sao?」</strong></p><ul><li><p>Trong ứng dụng một trang (SPA), một mô hình phổ biến để lấy dữ liệu là hiển thị một dấu hiệu ban đầu và sau đó lấy dữ liệu sau khi component đã được gắn kết (sử dụng <code>useEffect</code>). Thật không may, điều này có nghĩa là các component con không thể bắt đầu lấy dữ liệu cho đến khi component cha hoàn tất tải dữ liệu của chính nó, hiện tượng này được gọi là: <strong>&quot;waterfall client-server&quot;.</strong></p></li><li><p>Chuyển yêu cầu dữ liệu lên Server đảm bảo rằng các component cần lấy dữ liệu phải là hàm async.</p></li></ul><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// &#39;use client&#39;;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // yêu cầu dữ liệu từ Server</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> http</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">service</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> y</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ê</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">u</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ầ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">u</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // yêu cầu từ client</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // useEffect(() =&gt; {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    //     // http yêu cầu</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // }, [])</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{JSON.stringify(data)}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="tom-lai" tabindex="-1"><a class="header-anchor" href="#tom-lai"><span>Tóm lại:</span></a></h3><ul><li><strong>Mô hình nước đổ</strong> có thể ảnh hưởng tiêu cực đến hiệu suất nếu không được xử lý đúng cách.</li><li>Việc sử dụng <code>Promise.all()</code> để song song hóa các yêu cầu có thể cải thiện hiệu suất.</li><li>Hạn chế việc lấy dữ liệu từ client để tránh tình trạng &quot;nước đổ client-server&quot;.</li></ul><h2 id="client-component-vs-server-compoennt" tabindex="-1"><a class="header-anchor" href="#client-component-vs-server-compoennt"><span>Client Component vs Server Compoennt</span></a></h2><p>「NextJs mặc định xem tất cả các thành phần là <code>server component</code>」</p><ul><li><p><strong>client component</strong>: Thành phần phía Client, trên đầu thành phần có chỉ thị <code>&#39;use client&#39;</code>, người dùng có thể tương tác với trang trên trình duyệt, chẳng hạn như sử dụng <code>useState</code>, <code>useEffect</code>, <code>next/navigation</code>, v.v. 「Nó chạy cả trên Server và trình duyệt, trước là Server, sau là trình duyệt.」</p></li><li><p><strong>server component</strong>: Thành phần phía Server, hoàn toàn được kết xuất trên Server, vì vậy không thể thực hiện tương tác với người dùng.</p></li></ul><p>「❌ Nhận thức sai lầm: “Nếu nó là client component, thì nó chỉ chạy trên client.”」</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/mshqAkialV7EDeiaib2FwDbJoWAl5E9EluqYVpMLfWg2b3PF6hb5ykaWDyJ7yfoIqgV2czT3iciaJarXjo43ryzSQvQ/640?wx_fmt=png&amp;from=appmsg&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" alt="Image" tabindex="0" loading="lazy"><figcaption>Image</figcaption></figure><p>「Nếu thành phần sử dụng <code>useState</code>, <code>useEffect</code> hoặc thư viện bên thứ ba (để tương tác), nhưng không đánh dấu tệp là <code>&#39;use client&#39;</code>, hệ thống sẽ báo lỗi.」</p><p>「Nếu bạn đánh dấu một tệp là <code>&#39;use server&#39;</code> một cách thủ công (mặc dù NextJs mặc định xem tất cả tệp là chạy trên Server), nhưng nếu client component <code>&#39;use client&#39;</code> muốn gọi trực tiếp hàm của Server, chẳng hạn như hành động biểu mẫu, yêu cầu dịch vụ khi nhấp chuột, bạn cần cho trình duyệt biết rằng hàm này đang chạy trên Server.」</p><p>Tại sao lại cần làm như vậy???</p><ul><li>Nếu không đánh dấu, thành phần <code>&#39;use client&#39;</code> của bạn, khi nhập hàm muốn gọi, trình duyệt sẽ coi nó là thực thi trên trình duyệt, vì vậy sẽ gặp rắc rối.</li></ul><p>Có hai cách để đánh dấu:</p><ul><li><strong>Cách 1</strong>: Đánh dấu hàm tương tác của client component là <code>&#39;use server&#39;</code>.</li></ul><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// server, /app/actions/user.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {}</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// client, /app/user/create/page.tsx</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/actions/user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FormData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        &#39;use server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Đánh dấu</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Gọi dịch vụ Server</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> clickHandler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        &#39;use server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Đánh dấu</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> action</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> onClick</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">clickHandler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">test</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>Cách 2</strong>: Đánh dấu trực tiếp ở đầu tệp Server là <code>&#39;use server&#39;</code>, điều này cho biết tệp này chạy trên Server, khi client component gọi thì không cần phải đánh dấu <code>&#39;use server&#39;</code> trong hàm nữa.</li></ul><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// server, /app/actions/user.ts</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {}</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// client, /app/user/create/page.tsx</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/actions/user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FormData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Không cần đánh dấu &#39;use server&#39; ở đây</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> clickHandler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Không cần đánh dấu &#39;use server&#39; ở đây</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> action</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">...</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> onClick</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">clickHandler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">test</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="nhung-luu-y-ve-use-server" tabindex="-1"><a class="header-anchor" href="#nhung-luu-y-ve-use-server"><span>Những lưu ý về use server:</span></a></h3><ul><li><p>Khi một tệp được đánh dấu là <code>&#39;use server&#39;</code>, thì các hàm export của nó phải là async; không thể export đối tượng, nếu không, khi client component nhập vào, sẽ báo lỗi.</p></li><li><p>Tệp &quot;use server&quot; chỉ có thể xuất các hàm async, không tìm thấy đối tượng. Những hàm này cần được định nghĩa là async, vì &quot;use server&quot; đánh dấu chúng là Server Actions và chúng có thể được gọi trực tiếp từ client thông qua yêu cầu mạng.</p></li><li><p>Không vấn đề gì khi export type, xem ví dụ dưới đây:</p></li></ul><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">❌ </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">B</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">á</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">o</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> l</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ỗ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> server</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> ch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ỉ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ó </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">th</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ể </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">xu</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ấ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">t</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">á</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> h</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">à</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">m</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ấ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> đồ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ng</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ộ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">v</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">à </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ki</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ể</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">u</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">kh</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ô</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ng</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> th</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ể </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">xu</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ấ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> đố</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ượ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// api/service.ts</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> QueryUserSchema</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> z</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">object</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">number</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">optional</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// api/route.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">QueryUserSchema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./service.ts&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> GET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> filters</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        getQueryParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> QueryUserSchema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">_type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({});</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">✅ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Xu</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ấ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">t</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> tr</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ự</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> ti</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ế</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> ki</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ể</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">u</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> th</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ì đượ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">c</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// api/service.ts</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> QueryUserSchema</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> z</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">object</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">number</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">optional</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> QueryUserParams</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> typeof</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    QueryUserSchema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">_type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// api/route.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">QueryUserParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./service.ts&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> GET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> filters</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        getQueryParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">QueryUserParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({});</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="hydration-mismatch" tabindex="-1"><a class="header-anchor" href="#hydration-mismatch"><span>Hydration Mismatch</span></a></h2><h3 id="phan-tich-hien-tuong" tabindex="-1"><a class="header-anchor" href="#phan-tich-hien-tuong"><span>Phân tích hiện tượng</span></a></h3><p>Kết quả render trên server và trên trình duyệt không nhất quán, dẫn đến việc hydrate của React không khớp.</p><p>Khi render ứng dụng, có sự khác biệt giữa cây React được render trước từ server và cây React được render lần đầu tiên trên trình duyệt (quá trình hydrate), khi đó trình duyệt sẽ báo lỗi:</p><p><strong>Error</strong>: <code>Text content does not match server-rendered HTML</code></p><p><strong>&quot;Hydration&quot;</strong> trong React đề cập đến quá trình mà React gắn các xử lý sự kiện vào HTML đã được render trước từ server và chuyển đổi nó thành một ứng dụng hoàn toàn tương tác.</p><p><em>Hãy xem một ví dụ:</em></p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Randmo 组件  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useEffect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Random</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {}) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">setValue</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Math</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">random</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  useEffect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> intervalId</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> setInterval</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      setValue</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Math</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">random</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      clearInterval</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">intervalId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  }, []);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;&gt;{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// page.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">h1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">I</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> am</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> a</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> random</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">h1</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Random</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trình duyệt báo lỗi warning: <code>Text content did not match. Server: &quot;0.49532635194084684&quot; Client: &quot;0.11063157855511907&quot;</code></p><h3 id="nguyen-nhan" tabindex="-1"><a class="header-anchor" href="#nguyen-nhan"><span>Nguyên nhân</span></a></h3><p>❌ <strong>Lỗi do thẻ HTML lồng nhau không đúng, ví dụ như thẻ <code>&lt;p&gt;</code></strong></p><ul><li><p><code>&lt;p&gt;</code> lồng trong một thẻ <code>&lt;p&gt;</code> khác: <code>&lt;p&gt;&lt;p&gt;111&lt;/p&gt;&lt;/p&gt;</code></p></li><li><p><code>&lt;section&gt;</code> lồng trong thẻ <code>&lt;p&gt;</code>: <code>&lt;p&gt;&lt;section&gt;222&lt;/section&gt;&lt;/p&gt;</code></p></li><li><p>Thẻ <code>&lt;ul&gt;</code> hoặc <code>&lt;ol&gt;</code> lồng trong thẻ <code>&lt;p&gt;</code>: <code>&lt;p&gt;&lt;ul&gt;&lt;/ul&gt;&lt;/p&gt;</code></p></li><li><p>Các nội dung tương tác không thể lồng nhau (ví dụ: thẻ <code>&lt;a&gt;</code> lồng trong <code>&lt;a&gt;</code>, thẻ <code>&lt;button&gt;</code> lồng trong <code>&lt;button&gt;</code>)</p></li></ul><p>❌ Sử dụng kiểm tra như <code>typeof window !== &#39;undefined&#39;</code> trong logic render.</p><p>❌ Sử dụng các API chỉ dành cho trình duyệt, chẳng hạn như API <code>window</code> hoặc <code>localStorage</code> trong logic render.</p><p>❌ Sử dụng API liên quan đến thời gian như <code>Date()</code> trong logic render.</p><p>❌ Trình duyệt mở rộng chỉnh sửa HTML.</p><p>❌ Cấu hình thư viện CSS-in-JS không đúng.</p><p>❌ Cấu hình sai HTML response qua Edge/CDN, chẳng hạn như Cloudflare Auto Minify.</p><p>❌ iOS cố gắng phát hiện số điện thoại, địa chỉ email và các dữ liệu khác trong nội dung văn bản và chuyển chúng thành liên kết, gây ra lỗi hydrate không khớp.</p><ul><li>Có thể vô hiệu hóa tính năng này bằng thẻ meta sau:</li></ul><div class="language-html" data-highlighter="shiki" data-ext="html" data-title="html" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">meta</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;format-detection&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> content</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;telephone=no, date=no, email=no, address=no&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> /&gt;</span></span></code></pre></div><h3 id="giai-phap" tabindex="-1"><a class="header-anchor" href="#giai-phap"><span>Giải pháp</span></a></h3><h4 id="su-dung-useeffect-đe-chi-render-tren-trinh-duyet" tabindex="-1"><a class="header-anchor" href="#su-dung-useeffect-đe-chi-render-tren-trinh-duyet"><span>Sử dụng <code>useEffect</code> để chỉ render trên trình duyệt</span></a></h4><p>Hãy để những phần gặp vấn đề chỉ render trên client, vì trong quá trình hydrate của React, <code>useEffect</code> được gọi. Điều này cho phép sử dụng các API của trình duyệt như <code>window</code> mà không gặp lỗi hydrate mismatch.</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Randmo 组件</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useEffect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Random</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {}) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">setValue</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Math</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">random</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">isClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">setIsClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  useEffect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    setIsClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> intervalId</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> setInterval</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      setValue</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Math</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">random</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      clearInterval</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">intervalId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  }, []);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;&gt;{isClient ? </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">value </span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><em>Không khuyến nghị cách này vì nó làm tăng độ phức tạp của component.</em></p><h4 id="khuyen-nghi-vo-hieu-hoa-ssr-cho-component-cu-the" tabindex="-1"><a class="header-anchor" href="#khuyen-nghi-vo-hieu-hoa-ssr-cho-component-cu-the"><span>Khuyến nghị: Vô hiệu hóa SSR cho component cụ thể</span></a></h4><ol><li><p>Đầu tiên, thay đổi cách export component thành <code>export default</code>.</p></li><li><p>Sau đó, khi sử dụng component, dùng <code>next/dynamic</code> để vô hiệu hóa SSR cho component đó.</p></li></ol><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// page.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> dynamic</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/dynamic&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NoSSR</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> dynamic</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;./Random&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">), { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ssr</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// ✅</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">h1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">hy</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">h1</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">RandomNoSSR</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h4 id="su-dung-suppresshydrationwarning" tabindex="-1"><a class="header-anchor" href="#su-dung-suppresshydrationwarning"><span>Sử dụng <code>suppressHydrationWarning</code></span></a></h4><p>Khi không thể tránh khỏi việc nội dung server và client khác nhau, chẳng hạn như với timestamp, bạn có thể bỏ qua cảnh báo hydrate mismatch bằng cách thêm thuộc tính <code>suppressHydrationWarning={true}</code> vào phần tử.</p><p>Trong ví dụ trên, không cần thay đổi gì khác, chỉ cần thêm thuộc tính <code>suppressHydrationWarning</code> vào chỗ không khớp.</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Random</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {}) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> suppressHydrationWarning</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h4 id="phuong-an-tot-nhat-phan-chia-component-voi-du-lieu-ban-đau-tu-server" tabindex="-1"><a class="header-anchor" href="#phuong-an-tot-nhat-phan-chia-component-voi-du-lieu-ban-đau-tu-server"><span>Phương án tốt nhất: Phân chia component với dữ liệu ban đầu từ server</span></a></h4><p>Do lỗi hydrate mismatch xảy ra khi render lần đầu trên client không khớp với server, ta có thể giải quyết bằng cách truyền dữ liệu ban đầu từ server cho component client.</p><p><code>Cách này giữ nguyên quyền lợi của SSR cho component và vẫn giữ khả năng tương tác trên client.</code></p><p>Chúng ta chia component thành hai phần: component trên server là cha của component trên client. Component cha sẽ SSR và truyền <code>initialData</code> cho component con qua props. Component con render dựa trên <code>initialData</code>, giải quyết hoàn hảo vấn đề!</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Client.Random.tsx</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useEffect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ClientRandom</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">initialData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">number</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">setValue</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">initialData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  useEffect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> intervalId</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> setInterval</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      setValue</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Math</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">random</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      clearInterval</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">intervalId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  }, []);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Server.Random.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ClientRandom</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./Client.Random&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ServerRandom</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ClientRandom</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> initialData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">={</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Math</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">random</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()} /&gt;;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// page.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ServerRandom</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./Server.Random&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">h1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">hy</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">h1</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ServerRandom</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ssr-streaming-đong-thoi-giu-kha-nang-tuong-tac-phia-client" tabindex="-1"><a class="header-anchor" href="#ssr-streaming-đong-thoi-giu-kha-nang-tuong-tac-phia-client"><span>SSR/Streaming đồng thời giữ khả năng tương tác phía client</span></a></h2><p><strong>「Bối cảnh sử dụng:」</strong></p><ul><li>Thông tin cập nhật thời gian thực, ví dụ như tin tức, cổ phiếu, tiền điện tử, với giả định rằng dữ liệu sẽ tự động cập nhật mỗi phút.</li></ul><p><strong>「Yêu cầu logic:」</strong></p><ul><li>Sau khi component được mount, thực hiện yêu cầu dữ liệu mỗi phút.</li><li>Tránh lỗi Hydration Mismatch.</li><li>Hỗ trợ Streaming dữ liệu.</li></ul><p><strong>「Giải pháp:」</strong></p><ul><li>Sử dụng phương án cha con với dữ liệu <code>initialData</code>.</li></ul><p><strong>「Mã nguồn đơn giản:」</strong></p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// page.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">A</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> AServer</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/components/A/Server.A&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Suspense</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;&gt;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">      // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Suspense</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">AServer</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Suspense</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;/&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /components/A/Server.A.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">A</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> AClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./Client.A&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> A</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> fetch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/api&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">AClient</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> initialData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">={</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} /&gt;;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /components/A/Client.A.tsx</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useEffect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> A</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">initialData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SomeType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">setData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SomeType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">initialData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> fetchFn</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> res</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> fetch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/api&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    setData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">res</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  useEffect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    fetchFn</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> intervalId</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> setInterval</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">fetchFn</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">10000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">      clearInterval</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">intervalId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  }, []);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{JSON.stringify(data)}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="cac-cach-fetch-du-lieu" tabindex="-1"><a class="header-anchor" href="#cac-cach-fetch-du-lieu"><span>Các cách fetch dữ liệu</span></a></h2><p>Vui lòng xem <a href="https://juejin.cn/post/7385061036830031872" target="_blank" rel="noopener noreferrer">NextJs 14 Summarize data fetching architecture4</a></p><h2 id="form-va-server-action" tabindex="-1"><a class="header-anchor" href="#form-va-server-action"><span>Form và Server Action</span></a></h2><p>Quy trình cơ bản của biểu mẫu Form: 「Kiểm tra Form phía frontend --&gt; Gửi dữ liệu --&gt; Kiểm tra dữ liệu trên server --&gt; Lưu vào cơ sở dữ liệu」</p><h3 id="kien-thuc-co-ban" tabindex="-1"><a class="header-anchor" href="#kien-thuc-co-ban"><span>Kiến thức cơ bản</span></a></h3><p>Trong các dự án React-SPA, khi gửi biểu mẫu, chúng ta thường sử dụng cách tương tác qua API POST. Bài viết này sẽ không giới thiệu về cách gửi biểu mẫu qua API nữa.</p><p>Next.js 14, ngoài việc giữ lại cách tương tác qua API, còn cung cấp chế độ <strong>Server Action</strong>. Server Action là các hàm bất đồng bộ được thực thi trên Server, có thể sử dụng trong các thành phần của server và client để xử lý việc gửi biểu mẫu và thay đổi dữ liệu trong ứng dụng Next.js.</p><p>Sử dụng chỉ thị React <code>&quot;use server&quot;</code> để định nghĩa các hành động trên server. Có thể đặt chỉ thị này ở đầu hàm <code>async</code> để đánh dấu hàm đó là hành động của server, hoặc đặt ở đầu tệp để đánh dấu tất cả các xuất trong tệp đó là hành động của server.</p><h3 id="vi-du-1-cach-su-dung-ham-noi-tuyen" tabindex="-1"><a class="header-anchor" href="#vi-du-1-cach-su-dung-ham-noi-tuyen"><span>Ví dụ 1: Cách sử dụng hàm nội tuyến</span></a></h3><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// form.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/actions/user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FormData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    &#39;use server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Đây là hành động của server</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Gọi service trên server</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> action</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;username&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;submit&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Submit</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// @/app/actions/user.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FormData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> username</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;username&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="vi-du-2-cach-su-dung-qua-module" tabindex="-1"><a class="header-anchor" href="#vi-du-2-cach-su-dung-qua-module"><span>Ví dụ 2: Cách sử dụng qua module</span></a></h3><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// form.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/actions/user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FormData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // Gọi service trên server</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// @/app/actions/user.ts</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FormData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="luu-y" tabindex="-1"><a class="header-anchor" href="#luu-y"><span>Lưu ý</span></a></h3><p>Biểu mẫu trong <strong>Server Component</strong> và <strong>Client Component</strong> có sự khác biệt trong cách sử dụng.</p><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_png/mshqAkialV7EDeiaib2FwDbJoWAl5E9Eluqvb56JW4frSKQ7tDMicj4uCn9tQHgg0BTLVaVcBSibDQAaCOgBYibYpiaWA/640?wx_fmt=png&amp;from=appmsg" alt="Image" tabindex="0" loading="lazy"><figcaption>Image</figcaption></figure><h4 id="so-sanh" tabindex="-1"><a class="header-anchor" href="#so-sanh"><span>So sánh:</span></a></h4><ul><li><p>Thành phần server chỉ có thể nhập các hành động sử dụng chỉ thị <code>&quot;use server&quot;</code> ở cấp module.</p></li><li><figure><img src="https://mmbiz.qpic.cn/sz_mmbiz_jpg/YBFV3Da0NwtYoRFA7WlFGRLVXOMskBQjzj6ZGI9t1ufAIWMId4cK1bEHIASdaOz6KbrwdD7lwxBukjyfsKweZg/640?wx_fmt=other&amp;from=appmsg" alt="Image" tabindex="0" loading="lazy"><figcaption>Image</figcaption></figure></li><li><p><strong>Khuyến nghị:</strong> Sử dụng Client Component để xử lý biểu mẫu, kiểm tra dữ liệu trên frontend trước khi gửi. Sau đó, gửi dữ liệu lên server để kiểm tra thêm, đảm bảo tính chính xác.</p></li><li><p>Dù là thành phần server hay client, dữ liệu cuối cùng vẫn cần được kiểm tra trên server.</p></li></ul><h3 id="tuong-tac-bieu-mau" tabindex="-1"><a class="header-anchor" href="#tuong-tac-bieu-mau"><span>Tương tác biểu mẫu</span></a></h3><h4 id="khong-khuyen-nghi-cach-1-useformstate-va-useformstatus" tabindex="-1"><a class="header-anchor" href="#khong-khuyen-nghi-cach-1-useformstate-va-useformstatus"><span>Không khuyến nghị - Cách 1: useFormState và useFormStatus</span></a></h4><p>Các thành phần phía máy khách kết hợp <code>ReactDom.useFormState</code> và <code>ReactDom.useFormStatus</code>, Server có thể trả về thông tin lỗi xác thực của biểu mẫu.</p><p>Cách này, Server thực hiện xác thực, sau đó phản hồi cho máy khách.</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useFormState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react-dom&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> CreatePage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">pending</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useFormStatus</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (        </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> action</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">formAction</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // ...        </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;submit&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> disabled</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">pending</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">G</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ử</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Ví dụ:</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// form.tsx   </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useFormStatus</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useFormState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react-dom&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/actions/user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">State</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/actions/user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> CreatePage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Khởi tạo trạng thái biểu mẫu    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">pending</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useFormStatus</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Khởi tạo trạng thái biểu mẫu    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> initialState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">State</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">errors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {}, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> };    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">dispatch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useFormState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">initialState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);       </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (        </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> action</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dispatch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;space-y-4&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;                </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">                &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;text&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    name</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;username&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    placeholder</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Vui lòng nhập tên của bạn&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">                /&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                {</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/* Hiển thị lỗi */</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}                </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">state</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">errors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">?.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">username</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">state</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">errors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">username</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">map</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (                    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">                    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;mt-2 text-sm text-red-500&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> key</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                ))}            </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;                </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">                &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;password&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    name</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;password&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    placeholder</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Vui lòng nhập mật khẩu của bạn&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">                /&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                {</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/* Hiển thị lỗi */</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}                </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">state</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">errors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">?.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">state</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">errors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">map</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (                    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">                    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;mt-2 text-sm text-red-500&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> key</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                ))}            </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;submit&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> disabled</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">pending</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">G</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ử</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /app/actions/user   </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">revalidatePath</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/cache&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">redirect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/navigation&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;zod&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> State</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    errors</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {        </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        username</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[];        </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        password</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[];    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    message</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CreateUserSchema</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">object</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    username</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">min</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Mật khẩu phải có ít nhất 6 ký tự&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }),   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">prevState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">State</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FormData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> validatedFields</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CreateUserSchema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">safeParse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);       </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">validatedFields</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">?.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">?.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">flatten</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">fieldErrors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">validatedFields</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);       </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">validatedFields</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            errors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">validatedFields</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">flatten</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">fieldErrors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Tạo người dùng thất bại&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        };    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }       </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> validatedFields</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;       </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);       </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Chèn vào cơ sở dữ liệu...    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Sau khi thành công, làm mới bộ nhớ cache và chuyển hướng    </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    revalidatePath</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/userlist&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);    </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    redirect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>「Mẹo: Khi gửi biểu mẫu, ngoài việc truyền formData mặc định, có thể thêm tham số bổ sung, ví dụ như thao tác cập nhật, cần có id」</p><ul><li>Phương thức id được bao gồm trong formData, gửi đến Server.</li></ul><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// form.tsx   </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;hidden&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> value</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}      </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// action.ts   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> updateUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FormData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> id</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Phương thức actionFn.bind(null, id), id không được bao gồm trong formData, id là tham số đầu tiên của actionFn.</li></ul><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// form.tsx   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> updateUserWithId</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> updateUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">bind</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);      </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> action</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">updateUserWithId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">/&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// action.ts   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> updateUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FormData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {}      </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// form-2.ts   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> updateUserWithId</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> updateUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">bind</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">state</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">dispatch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useFormState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">updateUserWithId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">initialState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);      </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> action</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dispatch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">/&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// action.ts   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> updateUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">prevState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">any</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FormData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {}</span></span></code></pre></div><h3 id="khuyen-nghi-react-hook-form-zod-hookform-resolvers-hookform-error-message" tabindex="-1"><a class="header-anchor" href="#khuyen-nghi-react-hook-form-zod-hookform-resolvers-hookform-error-message"><span>Khuyến nghị - react-hook-form + zod + @hookform/resolvers + @hookform/error-message</span></a></h3><p>Sau khi kiểm tra ở phía client thành công --&gt; Gửi biểu mẫu --&gt; Kiểm tra phía server --&gt; Lưu database</p><h5 id="react-hook-form5" tabindex="-1"><a class="header-anchor" href="#react-hook-form5"><span>react-hook-form5</span></a></h5><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useForm</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react-hook-form&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/actions/user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> App</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">register</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">handleSubmit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">formState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useForm</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Nếu đã thiết lập defaultValues, giá trị sẽ được tiêm vào các phần tử biểu mẫu tương ứng, thường dùng cho thao tác cập nhật    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // defaultValues: {    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        //     name: &#39;xfz&#39;,    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        //     age: 20,    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // },    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    })    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Sử dụng register thay thế cho tên của các phần tử biểu mẫu, và bao bọc actionFn bằng handleSubmit để gửi    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> onSubmit</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">handleSubmit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">submit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                {...</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">register</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(&#39;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;, {    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    required</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Trường này là bắt buộc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    minLength</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">messsage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Quá ngắn&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> },    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    validate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">value</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {    </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">                        if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> === </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;f*ck&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                            return</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;Không dùng từ xấu&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                        }    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                    },    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                })}    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            /&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            {</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/* Hiển thị lỗi xác thực */</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">span</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{formState.errors.name.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">span</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;number&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                {...</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">register</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(&#39;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;, { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">required</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Trường này là bắt buộc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> })}    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            /&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">span</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{formState.errors.age.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">span</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;submit&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">G</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ử</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Dù client đã thực hiện kiểm tra biểu mẫu, server vẫn cần kiểm tra lại. Vẫn sử dụng công cụ zod, đối với lỗi trả về từ server có thể hiển thị bằng toast.</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// @/app/actions/user.ts   </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;zod&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CreateUserSchema</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">object</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">min</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">messsage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Quá ngắn&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> })    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">refine</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">value</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> value</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;f*ck&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Không dùng từ xấu&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }),    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">number</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CreateUserSchemaParams</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> typeof</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CreateUserSchema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">_type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">CreateUserSchemaParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {    </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        CreateUserSchema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">parse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Chèn vào cơ sở dữ liệu    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">xxx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> };    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Có gì đó không ổn &#39;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        };    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Mã nguồn trên trang biểu mẫu có hơi lộn xộn, không đủ gọn gàng, phương pháp xác thực biểu mẫu đã được viết ở phần HTML, điều này không thuận tiện cho việc bảo trì. Vậy chúng ta nên giải quyết như thế nào? Theo dõi bài viết...</p><h5 id="su-dung-zod-trong-component5" tabindex="-1"><a class="header-anchor" href="#su-dung-zod-trong-component5"><span>Sử dụng zod trong Component5</span></a></h5><p>Công cụ zod có thể được sử dụng cả ở phía front-end và back-end, điều này rất thuận tiện, giữ cho việc kiểm tra phía trước và phía sau nhất quán, một bộ kiểm tra dùng ở hai nơi, thật tuyệt vời.</p><p>Kết hợp với react-hook-form, cần thêm gói @hookform/resolvers. Tôi khuyến nghị mọi người cũng nên thêm @hookform/error-message, một bộ hoàn chỉnh, bắt đầu thôi...</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;zod&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useForm</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react-hook-form&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">zodResolver</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@hookform/resolvers/zod&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/actions/user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useRouter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/navigation&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> FormSchema</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">object</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">min</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Quá ngắn&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> })    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">refine</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">value</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> value</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;f*ck&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Không dùng từ xấu&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }),    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">number</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> App</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">register</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">handleSubmit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">formState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">errors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useForm</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Tải sơ đồ ở đây    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        resolver</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">zodResolver</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">FormSchema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Nếu đã thiết lập defaultValues, giá trị sẽ được tiêm vào các phần tử biểu mẫu tương ứng, thường dùng cho thao tác cập nhật    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // defaultValues: {    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        //     name: &#39;xfz&#39;,    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        //     age: 20,    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // },    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });       </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> submit</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> FormSchema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">_type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        const </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">router</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useRouter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();       </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        try {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {    </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">                alert</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Thành công&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);    </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">                router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">push</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/userlist&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);    </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">                router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">refresh</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {    </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">                alert</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Tạo không thành công: &#39;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            }    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        } catch (error) {    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            console.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.message ?? </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };       </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Sử dụng register thay thế cho tên của các phần tử biểu mẫu, và bao bọc actionFn bằng handleSubmit để gửi    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> onSubmit</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">handleSubmit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">submit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {...</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">register</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(&#39;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;)} </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">/&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">span</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{errors.name.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">span</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;number&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {...</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">register</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(&#39;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;)} </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">/&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">span</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{errors.age.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">span</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;submit&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">G</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ử</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Mã nhìn gọn gàng hơn nhiều, tiếp tục tối ưu hóa thông tin lỗi...</p><h5 id="hookform-error-message5" tabindex="-1"><a class="header-anchor" href="#hookform-error-message5"><span>@hookform/error-message5</span></a></h5><p>Dựa trên ví dụ ở trên, chúng ta có thể đóng gói thông tin lỗi xác thực biểu mẫu thành một thành phần, thuận tiện cho việc sử dụng.</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ErrorMessage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@hookform/error-message&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">FieldErrors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react-hook-form&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> FieldError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">errors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FieldErrors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }) {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;text-red-500&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">ErrorMessage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                errors</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{p.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">errors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                name</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{p.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            /&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}   </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// &lt;span&gt;{errors.name.message}&lt;/span&gt;   </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">FieldError</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;name&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> errors</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">errors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">/&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">FieldError</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> name</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;age&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> errors</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">errors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">/&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Here&#39;s the translation into Vietnamese:</p><h2 id="seo" tabindex="-1"><a class="header-anchor" href="#seo"><span>SEO</span></a></h2><ul><li><p>Trong tệp <code>/app/layout.tsx</code>, thiết lập metadata cấp cao nhất.</p></li><li><p>Trong các trang, cũng có thể thiết lập metadata riêng cho từng trang và gộp chúng với metadata cấp cao nhất.</p></li></ul><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /app/layout.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Metadata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> metadata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Metadata</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  title</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Nextjs&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  description</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Hướng dẫn sử dụng nextjs&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  keywords</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;nextjs14&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;react&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;typescript&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // Khi trang được chia sẻ trên các nền tảng xã hội, hình ảnh này sẽ hiển thị</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  openGraph</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    images</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/opengraph-image.png&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // Địa chỉ này sẽ được sử dụng như một tiền tố cho một số tùy chọn cấu hình</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  metadataBase</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> URL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;https://next-learn-dashboard.vercel.sh&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /app/about/page.tsx</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Metadata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> metadata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Metadata</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  title</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Giới thiệu&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>&quot;Nếu muốn trang SSG với tham số động và metadata động, có thể sử dụng <code>generateStaticParams</code>.&quot;</p><h2 id="giai-thich-tep-env" tabindex="-1"><a class="header-anchor" href="#giai-thich-tep-env"><span>Giải thích tệp .env</span></a></h2><p>Tệp <code>.env</code> chứa các biến môi trường mà NextJs sử dụng trong quá trình chạy, bao gồm địa chỉ API, địa chỉ kết nối cơ sở dữ liệu và các thông tin khóa liên quan.</p><p>Các biến có tiền tố <code>NEXT_PUBLIC_</code> có thể được truy cập từ phía Client, nếu không, chỉ có thể truy cập từ phía Server.</p><p>Lưu ý: Khi sử dụng kho chứa không công khai, hãy thêm <code>.env</code> vào <code>.gitignore</code> để ngăn thông tin nhạy cảm bị gửi lên.</p><h2 id="co-so-du-lieu" tabindex="-1"><a class="header-anchor" href="#co-so-du-lieu"><span>Cơ sở dữ liệu</span></a></h2><p>Chúng ta có thể tải cơ sở dữ liệu về máy cục bộ hoặc sử dụng trực tiếp &quot;cơ sở dữ liệu đám mây&quot;.</p><p>&quot;Các loại cơ sở dữ liệu:&quot;</p><ul><li><p>MongoDB</p></li><li><p>MySql</p></li><li><p>Sqlite</p></li><li><p>Postgres</p></li></ul><p>&quot;Cơ sở dữ liệu đám mây:&quot;</p><ul><li><p>supabase5 - postgres</p></li><li><p>MongoDB6 - mongodb</p></li><li><p>vercel7 - postgres</p></li></ul><h3 id="vi-du-ve-mongodb-đam-may" tabindex="-1"><a class="header-anchor" href="#vi-du-ve-mongodb-đam-may"><span>Ví dụ về MongoDB đám mây</span></a></h3><ol><li><p>Đăng ký trên MongoDB và tạo tên cơ sở dữ liệu.</p></li><li><p>Chỉnh sửa tệp <code>.env</code>, thêm địa chỉ MongoDB.</p></li></ol><p>&quot;Lưu ý: Thêm <code>.env</code> vào <code>.gitignore</code>.&quot;</p><p><code>DATABASE_URL=&quot;mongodb+srv://{username}:{password}@cluster0.ugofsmz.mongodb.net/{databaseName}&quot;</code></p><ol start="3"><li><p>Chạy lệnh <code>bun add mongoose</code>.</p></li><li><p>Kết nối cơ sở dữ liệu.</p></li></ol><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> mongoose</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;mongoose&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> connectDB</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mongoose</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">connect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">DATABASE_URL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;DB Connected&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre></div><ol start="5"><li>Tạo model bảng dữ liệu.</li></ol><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> mongoose</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;mongoose&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Schema</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mongoose</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">Schema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        required</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Number</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        required</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Định nghĩa bảng user</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserModel</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mongoose</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">models</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mongoose</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">model</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Schema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> UserModel</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>Thao tác với cơ sở dữ liệu.</li></ol><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">api</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">route</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">connectDB</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/lib/config/db&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> UserModel</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/lib/models/UserModel&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> LoadDB</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> connectDB</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">LoadDB</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> GET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserModel</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">find</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({});</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> POST</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserModel</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">msg</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Người dùng đã được tạo&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> DELETE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> id</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">nextUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">searchParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserModel</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">findByIdAndDelete</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">msg</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Người dùng đã bị xóa&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> PUT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> id</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">nextUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">searchParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> body</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserModel</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">findByIdAndUpdate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        $set</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">msg</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Todo đã được cập nhật&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Cảm giác thao tác vẫn còn hơi phức tạp, vì vậy tiếp theo, chúng ta sẽ cải tiến kết hợp với Prisma.</p><h3 id="prisma" tabindex="-1"><a class="header-anchor" href="#prisma"><span>Prisma</span></a></h3><p>Prisma là một trình xây dựng truy vấn an toàn kiểu có thể tự động tạo ra, Prisma ORM cung cấp một API sạch sẽ và an toàn kiểu để thực hiện các truy vấn cơ sở dữ liệu, cho phép các nhà phát triển dễ dàng suy luận về các truy vấn cơ sở dữ liệu mà truy vấn này trả về các đối tượng JavaScript thông thường.</p><p>Nếu chúng ta thao tác trực tiếp với cơ sở dữ liệu &quot;quan hệ&quot;, đối với tôi, người đã làm việc với Java trong 2 năm, cũng có một số khó khăn, trong khi việc sử dụng Prisma để thao tác với cơ sở dữ liệu thì thật đơn giản và tiện lợi.</p><p>「Hiện tại hỗ trợ:」</p><ul><li><p>postgres</p></li><li><p>mongodb</p></li><li><p>mysql</p></li><li><p>SQLServer</p></li><li><p>...</p></li></ul><p>「Cài đặt:」</p><ul><li><code>bun add prisma -D</code></li></ul><p>「Sử dụng:」</p><p>「1. Khởi tạo Prisma (chỉ định loại cơ sở dữ liệu)」</p><ul><li><p><code>bunx prisma init --datasource-provider mongodb</code></p></li><li><p>Ở đây tôi chọn mongodb, cũng có thể là postgres hoặc các loại khác.</p></li><li><p>Nếu không chỉ định loại cơ sở dữ liệu <code>bunx prisma init</code>, mặc định sẽ là <code>postgresql</code>.</p></li><li><p>Tạo tệp prisam/schema.prisma.</p></li></ul><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// prisam/schema.prisma   </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">generator</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> client</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  provider</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;prisma-client-js&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}      </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">datasource</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> db</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  provider</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;mongodb&quot;</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // loại cơ sở dữ liệu  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  url</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> env</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;DATABASE_URL&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// địa chỉ cơ sở dữ liệu  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>「2. Trong tệp .env, thêm DATABASE_URL (lấy từ Cloud MongoDB)」</p><p><code>// .env DATABASE_URL=&quot;địa chỉ cơ sở dữ liệu&quot;</code></p><p>「3. Tạo Model (bảng dữ liệu tương ứng với ORM) trong prisam/schema.prisma」 Mỗi model tương ứng với một bảng.</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// prisam/schema.prisma      </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// ...      </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">model</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> User</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  # </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> Int</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">default</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">autoincrement</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  id</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">default</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">auto</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()) @</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;_id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">db</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ObjectId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> # </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">á</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ch</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> vi</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ế</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">t</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> c</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ố đị</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">nh</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> cho</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> mongodb</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  email</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">unique</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> # </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">duy</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> nh</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ấ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> String</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> # </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ó </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">th</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ể để </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">tr</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ố</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ng</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  posts</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> Post</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[]   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">   </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">model</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> Post</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  id String @id @</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">default</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">auto</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()) @</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;_id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) @db.ObjectId  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  title String  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  content String?  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  published Boolean @</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">default</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  author User @</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">relation</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">fields</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">authorId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">], </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">references</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">])  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  authorId Int  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"># </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">B</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ả</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ng</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> User</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> v</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">à </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Post</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> li</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ê</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">n</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> k</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ế</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">t</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> v</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ớ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> nhau</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ươ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ng</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> ứ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ng</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> v</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ớ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">i</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Post</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">authorId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ó </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">th</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ể </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">th</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ự</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">c</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> hi</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ệ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">n</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> truy</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> v</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ấ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">n</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> li</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ê</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">n</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> k</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ế</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">t</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> gi</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ữ</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">a</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> hai</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> b</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">ả</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ng</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>「4. <code>bunx prisma generate</code>」</p><ul><li>Nó sẽ chạy lệnh <code>prisma generate</code> dưới engine (tự động cài đặt gói <code>@prisma/client</code> và tạo API Prisma Client tùy chỉnh dựa trên model của bạn).</li></ul><div class="language-sh line-numbers-mode" data-highlighter="shiki" data-ext="sh" data-title="sh" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Lưu ý: Lệnh `prisma migrate` chỉ áp dụng cho cơ sở dữ liệu SQL vì chúng có cấu trúc bảng nghiêm ngặt. Ví dụ: postgres, mysql.   </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Tuy nhiên, MongoDB là một cơ sở dữ liệu tài liệu, và dữ liệu ở đây là phi cấu trúc, cần chú ý điều này.  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Khi thực hiện lần đầu, cần thực hiện lệnh bên dưới.  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">bunx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> prisma</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> migrate</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> init</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">   # (init là tên cho lần di chuyển này, tương đương với thông tin git commit)  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">-</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> prisma</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> migrate</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> di</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chuyển</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> để</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tạo</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> bảng</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cơ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sở</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dữ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> liệu.</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">-</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Thực</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> hiện</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> bước</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> này,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chúng</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> ta</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> vẫn</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chưa</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> có</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cơ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sở</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dữ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> liệu,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thực</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> hiện</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> lệnh</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> này</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sẽ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tạo</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cơ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sở</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dữ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> liệu</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mongodb</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> và</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> bảng</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mặc</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> định</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> là</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">User</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> và</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">Post</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">.</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">-</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Lệnh</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> này</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thực</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> hiện</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> ba</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> việc:</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Nó</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tạo</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> một</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tệp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> di</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chuyển</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> SQL</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mới</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> trong</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">prisma/migrations</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> cho</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> lần</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> di</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chuyển</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> này.</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Nó</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thực</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> hiện</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> di</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chuyển</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> SQL</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> trên</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cơ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> sở</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dữ</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> liệu.</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  -</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Chạy</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> prisma</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> generate</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> trong</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> /prisma</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> để</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tạo</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tệp</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> migration/xxxx_init/migration.sql.</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Nếu cần thay đổi bảng dữ liệu, ví dụ, thêm một trường job (String) vào bảng User, cần thực hiện lại di chuyển.  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">prisma</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> migrate</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> dev</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> --name</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> added_job</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">   # Tạo tệp migrations/xxx_added_job/migration.sql.  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Để thêm Prisma Migrate vào dự án hiện có:  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">1.</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> prisma</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> db</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> pull</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">2.</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Xóa</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">prisma/migrations</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> hiện</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> có.</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">3.</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> Tạo</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thư</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mục</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> mới</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> prisma/migrations/0_init`</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">.</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">4.</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> bunx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> prisma</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> migrate</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> diff</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> \ </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # Tạo di chuyển và lưu vào tệp.  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Ứng dụng di chuyển ban đầu:  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">1.</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> bunx</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> prisma</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> migrate</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> resolve</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> --applied</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> 0_init</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">2.</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> prisma</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> migrate</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> deploy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">Phần</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> di</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chuyển</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> này,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tôi</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> vẫn</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> chưa</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> nghiên</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> cứu</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> rõ,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> có</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> thể</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> xem</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tài</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> liệu</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> tại</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> https://www.prisma.io/docs/orm/prisma-migrate/getting-started.</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>「5. Thao tác với cơ sở dữ liệu」</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PrismaClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;@prisma/client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);      </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> prisma</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> PrismaClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();      </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // Tạo mới  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // await prisma.user.createMany([  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    { name: &#39;111&#39;, email: &#39;111@prisma.io&#39; },  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    { name: &#39;222&#39;, email: &#39;222@prisma.io&#39; },  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // ]);  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // await prisma.user.create({  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    data: {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //     name: &#39;Bob&#39;,  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //     email: &#39;bob@prisma.io&#39;,  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //     posts: {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //        create: [  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //         {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    title: &#39;Hello World&#39;,  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    published: true,  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //         },  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //         {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    title: &#39;My second post&#39;,  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    content: &#39;This is still a draft&#39;,  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //         },  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //      ],  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //     },  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //   },  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // });  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // Cập nhật  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // await prisma.user.update({  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    where: {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    id: &#39;667edacd346db77a9b95dfab&#39;,  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    },  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    data: {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    name: &#39;hahaha&#39;,  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    },  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // });  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // Xóa  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // await prisma.user.delete({  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    where: {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    id: &#39;667edacd346db77a9b95dfab&#39;,  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  //    },  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // });  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // Truy vấn  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> users</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> prisma</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">findMany</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    include</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        posts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    },  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  });  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">  console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">users</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">main</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">catch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">      console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">      process</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">exit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  })  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">finally</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> prisma</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">$disconnect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lần đầu tiên thực hiện, cơ sở dữ liệu chưa có bảng User, khi chèn dữ liệu, nếu không có bảng, sẽ tự động tạo bảng.</p><p>「6. <code>npx prisma studio</code>」</p><ul><li>Mở GUI Client Prisma, đã kết nối với cơ sở dữ liệu đám mây từ xa, thuận tiện cho việc truy vấn.</li></ul><p>「7. Chỉnh sửa Prisma」</p><p>Lấy ví dụ với mongodb, tạo chỉ mục mới và tái tạo Client Prisma, và đẩy lên cơ sở dữ liệu từ xa.</p><p><code>bunx prisma db push</code></p><ul><li>Tạo chỉ mục mới và tái tạo Client Prisma thì mới có hiệu lực.</li></ul><h3 id="prisma-su-dung-trong-next-js" tabindex="-1"><a class="header-anchor" href="#prisma-su-dung-trong-next-js"><span>Prisma Sử Dụng Trong Next.js</span></a></h3><p>Sau khi hoàn thành các bước trên, chúng ta có thể thực hiện các thao tác cụ thể trong Next.js.</p><p><strong>1. Tạo lớp công cụ Prisma Client</strong></p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/lib/db.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">PrismaClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@prisma/client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> prismaClientSingleton</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> PrismaClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NODE_ENV</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;development&quot;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;query&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;warn&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;error&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">declare</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> global</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  var</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> DB</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">undefined</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ReturnType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> prismaClientSingleton</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> DB</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> globalThis</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">DB</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ??</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> prismaClientSingleton</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">DB</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NODE_ENV</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;production&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">globalThis</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">DB</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> DB</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>2. Sử dụng trong dịch vụ / hành động</strong></p><p><code>@prisma/client</code> có thể ánh xạ tốt các kiểu dữ liệu model mà chúng ta đã định nghĩa trong schema, vì vậy chúng ta không cần phải viết lại các kiểu dữ liệu liên quan, điều này giúp chúng ta dễ dàng thiết lập kiểu cho biến.</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;zod&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">DB</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/lib/db&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Như bạn thấy, prisma rất tiện lợi, nó tự động ánh xạ kiểu dữ liệu của bảng User</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">User</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@prisma/client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> GetUserByIdSchema</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">object</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getUserById</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }: </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> GetUserByIdSchema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">_type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> DB</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">findMany</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      where</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> },</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;success&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">unknown</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Something went wrong: &#39;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserSchema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ZodType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Omit</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;&gt; </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">object</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  email</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">nullable</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  job</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">nullable</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserSchema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">_type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  try</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    UserSchema</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">parse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> DB</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;success&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">unknown</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Something went wrong &#39;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// form.tsx</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">User</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@prisma/client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// ...</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// form tạo hoặc cập nhật</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Form</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h2 id="middleware" tabindex="-1"><a class="header-anchor" href="#middleware"><span>Middleware</span></a></h2><blockquote><p>❝<br> Middleware là một loại phần mềm nằm giữa hệ thống ứng dụng và phần mềm hệ thống, nó sử dụng các dịch vụ cơ bản (chức năng) mà phần mềm hệ thống cung cấp, kết nối các phần khác nhau của hệ thống ứng dụng trên mạng hoặc các ứng dụng khác nhau, nhằm đạt được mục đích chia sẻ chức năng.<br> ❞</p></blockquote><h3 id="gioi-thieu-ve-middleware-trong-next-js" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-ve-middleware-trong-next-js"><span>Giới thiệu về Middleware trong Next.js</span></a></h3><p>Trong Next.js, middleware cho phép chạy mã trước khi yêu cầu hoàn tất (trước khi nội dung được lưu vào bộ nhớ cache và các tuyến đường được khớp). Sau đó, dựa trên yêu cầu đầu vào, có thể sửa đổi phản hồi thông qua việc viết lại, chuyển hướng, sửa đổi tiêu đề yêu cầu hoặc phản hồi, hoặc phản hồi trực tiếp.</p><figure><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/738ff98c9fe842f190d13087d09dcb0c~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=877&amp;h=393&amp;s=44763&amp;e=png&amp;b=ffffff" alt="Image" tabindex="0" loading="lazy"><figcaption>Image</figcaption></figure><p>Do đó, chúng ta có thể sử dụng middleware để ghi log, kiểm tra quyền truy cập/đăng nhập, v.v.</p><p>Trong thư mục gốc của dự án, tạo tệp middleware.ts.</p><p><strong>Lưu ý:</strong> <code>middleware.ts</code> phải nằm ở cùng cấp với thư mục <code>app</code>, nếu không sẽ không có hiệu lực, <em>đó là một bài học đau thương, suýt chút nữa đã làm hỏng máy tính của tôi</em>.</p><ul><li><p><strong>Nếu có thư mục src, thì sử dụng src/middleware.ts</strong></p></li><li><p><strong>Nếu không có thư mục src, thì sử dụng middleware.ts</strong></p></li></ul><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// middleware.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Logic xử lý middleware</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;I am the middleware&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Khi yêu cầu đến Server, trước tiên dịch vụ sẽ in ra “I am the middleware”, sau đó mới khớp với tuyến đường.</p><p>Tuy nhiên, sẽ có rất nhiều log được in ra, vì mỗi yêu cầu đều đi qua middleware, chẳng hạn như hình ảnh, API, hoặc thậm chí là favicon.ico, do đó, chúng ta nên cách ly một số yêu cầu.</p><p>Trong middleware, thêm cấu hình để thực hiện việc khớp tài nguyên và xuất ra.</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;I am the middleware&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">nextUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;/a&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trong middleware, redirect hoặc rewrite, cần sử dụng đường dẫn tuyệt đối, không thể sử dụng đường dẫn tương đối</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // return NextResponse.redirect(&#39;/&#39;);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">redirect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> URL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Quy tắc khớp middleware, nếu không nằm trong phạm vi này thì sẽ không thực hiện logic middleware</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    matcher</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/((?!.*</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">..*|_next).*)&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/(api|trpc)(.*)&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre></div><p>Làm mới trang, lần này cảm thấy dễ chịu hơn nhiều!</p><h3 id="cac-truong-hop-su-dung-middleware" tabindex="-1"><a class="header-anchor" href="#cac-truong-hop-su-dung-middleware"><span>Các trường hợp sử dụng Middleware</span></a></h3><ul><li><p><strong>Xác thực và Ủy quyền:</strong> Đảm bảo danh tính của người dùng và kiểm tra cookie phiên trước khi cấp quyền truy cập vào các trang hoặc API cụ thể.</p></li><li><p><strong>Chuyển hướng phía Server:</strong> Chuyển hướng người dùng ở cấp độ Server dựa trên các điều kiện cụ thể (ví dụ: cài đặt vùng, vai trò người dùng).</p></li><li><p><strong>Viết lại đường dẫn:</strong> Hỗ trợ A/B testing, triển khai chức năng hoặc các đường dẫn cũ, viết lại đường dẫn đến các API hoặc trang dựa trên thuộc tính yêu cầu.</p></li><li><p><strong>Phát hiện bot:</strong> Bảo vệ tài nguyên của bạn bằng cách phát hiện và chặn lưu lượng bot.</p></li><li><p><strong>Ghi log và phân tích:</strong> Bắt và phân tích dữ liệu yêu cầu trước khi xử lý trang hoặc API để lấy nội dung.</p></li><li><p><strong>Chuyển đổi tính năng:</strong> Kích hoạt hoặc vô hiệu hóa tính năng một cách động để thực hiện việc triển khai hoặc thử nghiệm tính năng một cách liền mạch.</p></li></ul><h3 id="cac-truong-hop-khong-phu-hop-voi-middleware" tabindex="-1"><a class="header-anchor" href="#cac-truong-hop-khong-phu-hop-voi-middleware"><span>Các trường hợp không phù hợp với Middleware</span></a></h3><ul><li><p><strong>Lấy dữ liệu và thao tác phức tạp.</strong></p></li><li><p><strong>Các tác vụ tính toán nặng nề:</strong> Middleware nên nhẹ và nhanh chóng; nếu không, nó có thể dẫn đến độ trễ khi tải trang.</p></li><li><p><strong>Xử lý phiên quy mô lớn:</strong> Mặc dù middleware có thể xử lý các tác vụ phiên cơ bản, nhưng việc xử lý phiên quy mô lớn nên được quản lý bởi các dịch vụ xác thực hoặc bộ xử lý định tuyến chuyên dụng.</p></li><li><p><strong>Không khuyến nghị thực hiện các thao tác cơ sở dữ liệu trực tiếp trong middleware.</strong></p></li></ul><h3 id="cookie-headers-cors" tabindex="-1"><a class="header-anchor" href="#cookie-headers-cors"><span>Cookie, Headers, CORS</span></a></h3><h4 id="cookie" tabindex="-1"><a class="header-anchor" href="#cookie"><span>Cookie</span></a></h4><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    let</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> cookie</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">cookies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;xxx&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">cookie</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> allCookies</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">cookies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getAll</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">allCookies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">cookies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">has</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;xxx&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// =&gt; boolean</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">cookies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">delete</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;xxx&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Thiết lập cookie trong phản hồi sử dụng API `ResponseCookies`</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">cookies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;vercel&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;fast&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">cookies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;vercel&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;fast&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        path</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    cookie</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">cookies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;vercel&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">cookie</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Cookie sẽ được thiết lập trong trình duyệt</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="headers" tabindex="-1"><a class="header-anchor" href="#headers"><span>Headers</span></a></h4><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Nhân bản tiêu đề yêu cầu và thiết lập một tiêu đề mới `x-hello-from-middleware1`</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> requestHeaders</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Headers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">headers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    requestHeaders</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;x-hello-from-middleware1&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;hello&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Có thể thấy `x-hello-from-middleware1` trong yêu cầu api</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // { name: &#39;x-hello-from-middleware1&#39;, value: &#39;hello&#39; }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Bạn cũng có thể thiết lập tiêu đề yêu cầu trong NextResponse.rewrite</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // Tiêu đề yêu cầu mới</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            headers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">requestHeaders</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Thiết lập một tiêu đề phản hồi mới `x-hello-from-middleware2`</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">headers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;x-hello-from-middleware2&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;hello&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cors" tabindex="-1"><a class="header-anchor" href="#cors"><span>CORS</span></a></h4><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> allowedOrigins</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;https://acme.com&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;https://my-app.org&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> corsOptions</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    &#39;Access-Control-Allow-Methods&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;GET, POST, PUT, DELETE, OPTIONS&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    &#39;Access-Control-Allow-Headers&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Content-Type, Authorization&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Kiểm tra nguồn gốc từ yêu cầu</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> origin</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">headers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;origin&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">??</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> isAllowedOrigin</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> allowedOrigins</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">includes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">origin</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Xử lý các yêu cầu tiền kiểm</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> isPreflight</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">method</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;OPTIONS&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">isPreflight</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> preflightHeaders</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            ...(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">isAllowedOrigin</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Access-Control-Allow-Origin&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">origin</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            ...</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">corsOptions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        };</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({}, { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">headers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">preflightHeaders</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Xử lý các yêu cầu đơn giản</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> response</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">isAllowedOrigin</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">headers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Access-Control-Allow-Origin&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">origin</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Object</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">entries</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">corsOptions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">forEach</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(([</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">key</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">]) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">headers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">key</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    matcher</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/api/:path*&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="waituntil" tabindex="-1"><a class="header-anchor" href="#waituntil"><span>waitUntil</span></a></h3><p>Phương thức <code>waitUntil()</code> nhận một promise làm tham số và kéo dài thời gian sống của middleware cho đến khi promise được giải quyết. Điều này rất hữu ích cho việc thực hiện công việc ở phía sau, chẳng hạn như ghi log.</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextFetchEvent</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextFetchEvent</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    event</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">waitUntil</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        fetch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;https://my-analytics-platform.com&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            method</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;POST&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">JSON</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">stringify</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">nextUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        })</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    matcher</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/(api|trpc)(.*)&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="su-dung-nhieu-middleware" tabindex="-1"><a class="header-anchor" href="#su-dung-nhieu-middleware"><span>Sử dụng nhiều Middleware</span></a></h3><p>Mặc dù mỗi dự án chỉ hỗ trợ một tệp <code>middleware.ts</code>, bạn vẫn có thể tổ chức logic middleware theo cách mô-đun. Hãy tách các chức năng middleware thành các tệp <code>.ts</code> hoặc <code>.js</code> riêng biệt và nhập chúng vào tệp <code>middleware.ts</code> chính.</p><p>「Ví dụ:」</p><p>「1. Tạo thư mục <code>middlewares</code> trong thư mục gốc của dự án.」</p><p>「2. Tạo một số middleware trong thư mục <code>/middlewares</code>.」</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /middlewares/authMiddleware.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextFetchEvent</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> auth</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">ev</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextFetchEvent</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;------- auth ------&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> userId</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">cookies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;userId&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">userId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">redirect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> URL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/login&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /middlewares/loggerMiddleware.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextFetchEvent</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Mô phỏng API</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> analyze</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">searchParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Record</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; }) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Promise</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">void</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;((</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">resolve</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        setTimeout</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;---- Record log ----&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">            resolve</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> loggerMiddleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">event</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextFetchEvent</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        nextUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">searchParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> },</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    event</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">waitUntil</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        analyze</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            searchParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">fromEntries</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">searchParams</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        })</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /middlewares/testMiddleware.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> testMiddleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;------- test ------&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li><strong>Tạo tệp <code>middleware.ts</code> trong thư mục gốc của dự án và tích hợp các middleware trên.</strong></li></ol><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /middleware.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextFetchEvent</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> authMiddleware</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./middlewares/authMiddleware&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> logMiddleware</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./middlewares/loggerMiddleware&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> testMiddleware</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./middlewares/testMiddleware&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Logic xử lý middleware</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">ev</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextFetchEvent</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> URL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">startsWith</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/create&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        authMiddleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ev</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">startsWith</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/api&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">||</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">startsWith</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/trpc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        logMiddleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ev</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> testMiddleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    matcher</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        &#39;/create/:path*&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Khớp với đường dẫn /create</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">        &#39;/(api|trpc)(.*)&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Khớp với đường dẫn /api</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ],</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Bởi vì tôi muốn sau khi xác thực thì các middleware khác sẽ được thực thi, nên tôi không thêm <code>return</code> cho từng middleware. Nếu mỗi middleware có đường dẫn khớp riêng, bạn có thể thêm <code>return</code> cho từng middleware.</p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">startsWith</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/create&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> authMiddleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ev</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">startsWith</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/api&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">||</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">startsWith</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/trpc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> logMiddleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ev</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h2 id="xac-thuc-va-uy-quyen" tabindex="-1"><a class="header-anchor" href="#xac-thuc-va-uy-quyen"><span>Xác thực và Ủy quyền</span></a></h2><h3 id="hieu-biet-ve-khai-niem" tabindex="-1"><a class="header-anchor" href="#hieu-biet-ve-khai-niem"><span>Hiểu biết về khái niệm</span></a></h3><ul><li><p><strong>Xác thực (Authentication)</strong>: Kiểm tra xem người dùng có đã đăng nhập hay không.</p></li><li><p><strong>Ủy quyền (Authorization)</strong>: Kiểm tra xem người dùng có quyền truy cập vào một số tài nguyên hay không.</p></li></ul><h4 id="cookie-va-session" tabindex="-1"><a class="header-anchor" href="#cookie-va-session"><span>Cookie và Session</span></a></h4><p><strong>Cookie</strong>: Là thông tin trạng thái mà Server có thể lưu trữ trên thiết bị của người dùng, được lưu trữ trên trình duyệt.</p><p><strong>Session</strong>: Khi người dùng đăng nhập, Server sẽ tạo một phiên và sinh ra một ID phiên duy nhất. ID phiên này sẽ được lưu trữ trong cookie của máy khách. Server thường lưu trữ dữ liệu phiên ở phía backend, chẳng hạn như trong bộ nhớ, cơ sở dữ liệu hoặc các hệ thống lưu trữ khác. Khi máy khách gửi yêu cầu, nó sẽ mang theo cookie, Server dựa vào ID phiên để lấy dữ liệu người dùng tương ứng, từ đó thực hiện xác thực.</p><h4 id="jwt-json-web-token" tabindex="-1"><a class="header-anchor" href="#jwt-json-web-token"><span>JWT (JSON Web Token)</span></a></h4><p>JWT là giải pháp xác thực hoàn toàn khác với phiên. Phiên lưu trữ toàn bộ dữ liệu người dùng ở phía Server, trong khi JWT lưu trữ tất cả dữ liệu ở phía máy khách. Để đảm bảo tính bảo mật, nó sẽ được ký, và mỗi lần yêu cầu, các dữ liệu này sẽ được mang theo, backend sẽ giải mã để lấy thông tin danh tính của người dùng. Lợi ích của việc sử dụng JWT là Server không cần lưu trữ bất kỳ dữ liệu phiên nào, giúp dễ dàng mở rộng.</p><p><strong>JWT là chuỗi ngẫu nhiên đã được mã hóa</strong>, nó bao gồm ba phần:</p><ul><li><p><strong>Dữ liệu phát hành (Issuer Data)</strong>: Dữ liệu về người phát hành.</p></li><li><p><strong>Dữ liệu tùy chỉnh (Custom Data)</strong>: Dữ liệu tùy chỉnh, chẳng hạn như thông tin người dùng.</p></li><li><p><strong>Khóa ký bí mật (Secret Signing Key)</strong>: Khóa (lưu trữ ở phía Server, không bao giờ nhìn thấy ở phía máy khách).</p></li></ul><h4 id="phien-so-voi-token" tabindex="-1"><a class="header-anchor" href="#phien-so-voi-token"><span>Phiên so với Token</span></a></h4><table><thead><tr><th><strong>Loại</strong></th><th><strong>Phiên (Session)</strong></th><th><strong>Token (ví dụ: JWT)</strong></th></tr></thead><tbody><tr><td><strong>Cách lưu trữ</strong></td><td>Khi người dùng đăng nhập, Server sẽ tạo một phiên và sinh ra một ID phiên duy nhất. ID này sẽ được lưu trữ trong cookie của máy khách. Server thường lưu trữ dữ liệu phiên ở phía backend, chẳng hạn như trong bộ nhớ, cơ sở dữ liệu hoặc các hệ thống lưu trữ khác.</td><td>Khi người dùng đăng nhập, Server sẽ sinh ra một token. Token này bao gồm một số dữ liệu người dùng và chữ ký để đảm bảo tính toàn vẹn. Máy khách sẽ lưu trữ token này, chẳng hạn như trong cookie, localStorage hoặc nơi khác. Khi máy khách gửi yêu cầu, nó sẽ gửi token đến Server, Server sẽ xác minh tính hợp lệ của token.</td></tr><tr><td><strong>Trạng thái</strong></td><td>Thông thường là có trạng thái. Điều này có nghĩa là Server cần lưu trữ thông tin về từng phiên.</td><td>Thông thường là không có trạng thái. Server không cần lưu trữ thông tin về token, vì mỗi yêu cầu sẽ mang theo token, Server chỉ cần xác minh tính hợp lệ của nó.</td></tr><tr><td><strong>Xuyên miền</strong></td><td>Cookies theo mặc định không hỗ trợ xuyên miền.</td><td>Dễ dàng truyền tải giữa các miền khác nhau, vì chúng chỉ là một chuỗi.</td></tr><tr><td><strong>Cách hết hạn</strong></td><td>Có thể thiết lập thời gian hết hạn cho phiên, sau thời gian này, phiên sẽ không còn hiệu lực.</td><td>Có thể thiết lập thời gian hết hạn khi sinh token, cũng có thể thiết lập chính sách làm mới cho token.</td></tr><tr><td><strong>Bảo mật</strong></td><td>Do ID phiên thường được lưu trữ trong cookie, nó có thể dễ bị tấn công CSRF (Cross-Site Request Forgery).</td><td>Nếu được lưu trữ trong cookie HTTP-only, có thể giảm thiểu rủi ro tấn công XSS (Cross-Site Scripting), nhưng nếu sử dụng không đúng cách, có thể bị lộ trước các cuộc tấn công khác.</td></tr><tr><td><strong>Khả năng mở rộng</strong></td><td>Đối với các ứng dụng lớn, việc quản lý phiên trên Server có thể trở nên phức tạp, đặc biệt trong môi trường cân bằng tải.</td><td>Do là không có trạng thái, rất dễ mở rộng, phù hợp với các ứng dụng lớn và phân tán.</td></tr><tr><td><strong>Tình huống sử dụng</strong></td><td>Phù hợp với các ứng dụng web truyền thống và đơn nhất.</td><td>Phù hợp với SPA (Single Page Applications), ứng dụng di động, dịch vụ API và các tình huống xuyên miền.</td></tr></tbody></table><h4 id="thu-vien-va-nen-tang-xac-thuc-ben-thu-ba" tabindex="-1"><a class="header-anchor" href="#thu-vien-va-nen-tang-xac-thuc-ben-thu-ba"><span>Thư viện và nền tảng xác thực bên thứ ba</span></a></h4><ul><li><p><strong>Auth0</strong></p></li><li><p><strong>Clerk</strong></p></li><li><p><strong>Lucia</strong></p></li><li><p><strong>NextAuth.js</strong></p></li><li><p><strong>...</strong></p></li></ul><h3 id="quy-trinh-xac-thuc-va-uy-quyen" tabindex="-1"><a class="header-anchor" href="#quy-trinh-xac-thuc-va-uy-quyen"><span>Quy trình xác thực và ủy quyền</span></a></h3><p>Thông qua một ví dụ mô phỏng nhỏ, để làm quen với quy trình xác thực và ủy quyền, không cần quan tâm đến chi tiết mã, có thể chi tiết có chút vấn đề.</p><p>「1. Tạo một trang đăng nhập /app/login/page.tsx」</p><div class="language-tsx line-numbers-mode" data-highlighter="shiki" data-ext="tsx" data-title="tsx" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">login</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/actions/auth&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> LoginPage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> action</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">login</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;email&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                name</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;email&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                placeholder</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Email&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                required</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            /&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;password&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                name</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;password&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                placeholder</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Password&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                required</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            /&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> type</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;submit&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;Login&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>「2. Viết action login」</p><p>Sau khi xác thực thông tin danh tính người dùng thành công, tạo phiên (session) và ghi phiên đó vào trình duyệt của máy khách.</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// @/app/actions/auth.ts</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">cookies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/headers&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">redirect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/navigation&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> login</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FormData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Kiểm tra tên người dùng + mật khẩu</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Nếu qua, tạo session và ghi vào trình duyệt</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> expires</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">now</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 60</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 60</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> *</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Thời gian hiệu lực 1h</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> session</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;test123&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        cookies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;session&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">expires</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">httpOnly</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trong service, không thể sử dụng NextResponse để thực hiện redirect</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // NextResponse.redirect(&#39;/&#39;);</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        redirect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>「3. Ủy quyền (middleware)」</p><p>Thông qua middleware, thực hiện <code>route guard</code>.</p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// middleware.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> URL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">startsWith</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/create&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> session</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">cookies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;session&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)?.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">value</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">redirect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> URL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/login&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">url</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    matcher</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/create/:path*&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Khi truy cập vào <code>/create</code>, nếu chưa đăng nhập (không lấy được session), sẽ được chuyển hướng đến <code>/login</code>.</li></ul><figure><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3d7766b731e64d0fb7d39dee9eceea63~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=1002&amp;h=729&amp;s=144239&amp;e=png&amp;b=ffffff" alt="Image" tabindex="0" loading="lazy"><figcaption>Image</figcaption></figure><h3 id="nextauth" tabindex="-1"><a class="header-anchor" href="#nextauth"><span>NextAuth</span></a></h3><p>NextAuth là một thư viện JavaScript mã nguồn mở, cung cấp nhiều phương thức xác thực người dùng khác nhau, có thể được sử dụng để thực hiện đăng nhập và đăng xuất. Một số phương thức phổ biến bao gồm:</p><ul><li><strong>Xác thực OAuth</strong> (sử dụng đăng nhập với Google, GitHub, LinkedIn, v.v.)</li><li><strong>Xác thực tên người dùng và mật khẩu</strong></li></ul><p>NextAuth cũng cung cấp các phương thức như <code>auth</code>, <code>signIn</code>, <code>signOut</code>, v.v. để thực hiện xác thực.</p><p>Sử dụng cụ thể như sau:</p><p><strong>1. Cài đặt thư viện NextAuth:</strong></p><div class="language-bash" data-highlighter="shiki" data-ext="bash" data-title="bash" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">bun</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> add</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> next-auth@beta</span></span></code></pre></div><p><strong>2. Cài đặt biến môi trường duy nhất <code>AUTH_SECRET</code> trong .env:</strong></p><ul><li>Sử dụng lệnh <code>bunx auth secret</code> hoặc <code>openssl rand -base64 32</code></li><li>Sao chép chuỗi được tạo ra vào tệp <code>.env</code></li><li>Đây là giá trị ngẫu nhiên dùng để mã hóa token và băm xác minh email.</li></ul><p><strong>3. Tạo trang đăng nhập tại <code>/app/login/page.tsx</code>:</strong></p><div class="language-tsx" data-highlighter="shiki" data-ext="tsx" data-title="tsx" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">authenticate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/actions/authentication&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> LoginPage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> action</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">authenticate</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;...&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">form</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>4. Tạo <code>/app/actions/authentication.ts</code>:</strong></p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">AuthError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-auth&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">signIn</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/auth&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> authenticate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    prevState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">undefined</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FormData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    try</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Sử dụng phương thức đăng nhập &quot;email/password&quot;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> signIn</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;credentials&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, {</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            ...</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">formData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            redirect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            callbackUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> instanceof</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> AuthError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            switch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                case</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;CredentialsSignin&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                    return</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;Invalid credentials.&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                default</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                    return</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;Something went wrong.&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>5. Tạo tệp <code>auth.ts</code> trong thư mục gốc của dự án và xuất các phương thức <code>signIn</code>, <code>signOut</code>, v.v.:</strong></p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> NextAuth</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-auth&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> Credentials</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-auth/providers/credentials&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> bcrypt</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;bcrypt&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;zod&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// import { getUser } from &#39;@/app/service/user&#39;;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">signIn</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">signOut</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">auth</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> NextAuth</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    providers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        Credentials</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            async</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> authorize</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">credentials</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // Xác thực người dùng qua biểu mẫu</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> parsedCredentials</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> z</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">object</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">email</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">email</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">min</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) })</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">safeParse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">credentials</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // Nếu xác thực thành công, lấy thông tin người dùng từ cơ sở dữ liệu</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">parsedCredentials</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">email</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> parsedCredentials</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                    // const user = await getUser(email);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> user</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">userId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;123&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">email</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;xxxxx&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                    // Nếu người dùng không tồn tại, xác thực thất bại</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                    // Xác thực mật khẩu</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> passwordsMatch</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> bcrypt</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">compare</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">passwordsMatch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // Nếu xác thực qua biểu mẫu thất bại</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">                console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Invalid credentials&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            },</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ],</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>6. Cấu hình auth.config:</strong></p><div class="language-ts line-numbers-mode" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// auth.config.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextAuthConfig</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-auth&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> authConfig</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    pages</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        signIn</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/login&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Cấu hình này: khi xác thực thất bại, sẽ tự động chuyển hướng đến /login</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    callbacks</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // auth lưu phiên người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // request phát sinh yêu cầu</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        authorized</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">auth</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">nextUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } }) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // Khi chuyển trang, gọi phương thức này, ở đây kiểm tra xem có đăng nhập không</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> isLoggedIn</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !!</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">auth</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">?.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">nextUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">startsWith</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/create&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> isLoggedIn</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Chuyển hướng người dùng chưa xác thực về trang đăng nhập</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">isLoggedIn</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">redirect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> URL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/create&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">nextUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        },</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    providers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [], </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Thêm các providers với một mảng rỗng tạm thời</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">} </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NextAuthConfig</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>7. Thêm <code>auth.config</code> vào NextAuth:</strong></p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// auth.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">authConfig</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./auth.config&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">auth</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">signIn</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">signOut</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> NextAuth</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ...</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">authConfig</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    providers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ],</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre></div><p><strong>8. Trong <code>middleware.ts</code>, nhập <code>auth.config</code>:</strong></p><div class="language-ts" data-highlighter="shiki" data-ext="ts" data-title="ts" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> NextAuth</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-auth&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">authConfig</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./auth.config&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> NextAuth</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">authConfig</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">auth</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Cấu hình khi nào thực hiện kiểm tra middleware</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    matcher</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/((?!api|_next/static|_next/image|.*</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">.png$).*)&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">], </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Loại trừ các địa chỉ này</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre></div><p><strong>9. Truy cập vào <code>/create</code> trong trình duyệt để xem kết quả.</strong></p><h3 id="clerk-nen-tang-đang-nhap-ben-thu-ba" tabindex="-1"><a class="header-anchor" href="#clerk-nen-tang-đang-nhap-ben-thu-ba"><span>Clerk nền tảng đăng nhập bên thứ ba</span></a></h3><p>Clerk cung cấp cho người dùng các dịch vụ xác thực đăng nhập/đăng xuất, đăng ký người dùng, quản lý vai trò người dùng, v.v. Là một nền tảng, nó cung cấp các trang đăng nhập/đăng xuất/đăng ký đẹp mắt, vì vậy phiên người dùng được lưu trữ trên Server của nền tảng này.</p><p>Thông qua <code>@clerk/nextjs</code>, khi tích hợp vào dịch vụ của chúng tôi, chúng tôi có thể sử dụng các API liên quan để lấy phiên (session) và lưu trữ vào cơ sở dữ liệu của riêng mình để thuận tiện cho việc quản lý.</p><p>Các thao tác cụ thể chỉ cần làm theo từng bước trong tài liệu hướng dẫn trên trang web là có thể, khá tiện lợi và đơn giản.</p><h2 id="quoc-te-hoa-i18n" tabindex="-1"><a class="header-anchor" href="#quoc-te-hoa-i18n"><span>Quốc tế hóa i18n</span></a></h2><p>Next.js cung cấp khả năng cấu hình nội dung để định tuyến và hiển thị hỗ trợ nhiều ngôn ngữ. Điều này giúp trang web phù hợp với nội dung hiển thị của các khu vực khác nhau.</p><h3 id="next-intl" tabindex="-1"><a class="header-anchor" href="#next-intl"><span>next-intl</span></a></h3><p>Lấy ví dụ về next-intl, cấu trúc dự án như sau:</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>├── messages</span></span>
<span class="line"><span>│   ├── en.json   // Tiếng Anh</span></span>
<span class="line"><span>│   └── cn.json   // Tiếng Trung</span></span>
<span class="line"><span>├── next.config.mjs</span></span>
<span class="line"><span>└── middleware.ts</span></span>
<span class="line"><span>└── app</span></span>
<span class="line"><span>    └── [locale]</span></span>
<span class="line"><span>        ├── layout.tsx</span></span>
<span class="line"><span>        └── page.tsx</span></span>
<span class="line"><span>        └── sign-in</span></span>
<span class="line"><span>            └── page.tsx</span></span>
<span class="line"><span>        └── sign-up</span></span>
<span class="line"><span>            └── page.tsx</span></span></code></pre></div><ol><li><p>Chạy lệnh <code>bun add next-intl</code>.</p></li><li><p>Tại thư mục gốc, tạo thư mục <code>messages</code> để lưu trữ thông tin nội dung của các ngôn ngữ khác nhau.</p></li><li><p>Trong thư mục <code>messages</code>, tạo các tệp thông tin nội dung cho các ngôn ngữ liên quan, mỗi ngôn ngữ sẽ có một tệp tương ứng với nội dung của trang.</p></li></ol><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /messages/en.json</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  &quot;rootLayout&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;test&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Test&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  &quot;auth&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Có thể định nghĩa key theo đường dẫn</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;sign-in&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      &quot;title&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Sign in!&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;sign-out&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      &quot;title&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Sign out!&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  &quot;home&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;buttons&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      &quot;add&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Add&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      &quot;remove&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Remove&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /messages/cn.json</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  &quot;rootLayout&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;test&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;测试&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  &quot;auth&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Có thể định nghĩa key theo đường dẫn</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;sign-in&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      &quot;title&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;登录 !&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;sign-out&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      &quot;title&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;注销 !&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  },</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  &quot;home&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;buttons&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      &quot;add&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;添加&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      &quot;remove&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;删除&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="4"><li>Cấu hình <code>next.config.mjs</code>.</li></ol><div class="language-javascript" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/** </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@type</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> {import(&#39;next&#39;).NextConfig}</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> createNextIntlPlugin</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-intl/plugin&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> nextConfig</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  reactStrictMode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> withNextIntl</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createNextIntlPlugin</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> withNextIntl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">nextConfig</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><ol start="5"><li>Tại thư mục gốc, tạo tệp <code>i18n.ts</code> để cấu hình thông tin ngôn ngữ.</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">notFound</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/navigation&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">getRequestConfig</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-intl/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Có thể nhập từ cấu hình chia sẻ</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> LOCALES</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;en&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;cn&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">as</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> DEFAULT_LOCALE</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;en&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> LOCALES_TYPE</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> LOCALES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)[</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">number</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getRequestConfig</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> ({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">locale</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // Xác thực rằng tham số `locale` đến là hợp lệ</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">LOCALES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">includes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">locale</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> any</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)) </span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">notFound</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    messages</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: (</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`./messages/</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">locale</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">.json`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)).</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">default</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  };</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="6"><li>Cấu hình middleware.</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> createMiddleware</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-intl/middleware&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">LOCALES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">DEFAULT_LOCALE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./i18n&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Middleware quốc tế hóa</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> intlMiddleware</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createMiddleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  locales</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">LOCALES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  defaultLocale</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">DEFAULT_LOCALE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Các trang không cần kiểm tra xác thực</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> publicPages</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/sign-in&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/sign-up&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">];</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> publicPathnameRegex</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> RegExp</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `^(/(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">LOCALES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;|&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">))?(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicPages</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">flatMap</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">p</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;/&#39;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> p</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">))</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">join</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;|&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">)/?$`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  &#39;i&#39;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> isPublicPage</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> publicPathnameRegex</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">nextUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">isPublicPage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> intlMiddleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Kiểm tra xác thực</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> config</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  matcher</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/((?!.+</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">.[</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">w]+$|_next).*)&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/(api|trpc)(.*)&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">],</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="7"><li><p>Di chuyển tất cả nội dung trong app vào <code>/app/[locale]</code>.</p></li><li><p>Nhập i18n trong Layout và bao bọc bằng <code>NextIntlClientProvider</code>. Các thành phần và con thành phần được bao bọc bởi <code>NextIntlClientProvider</code> có thể chia sẻ message.</p></li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextIntlClientProvider</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-intl&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">getMessages</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">getTranslations</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-intl/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> LocaleLayout</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  children</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  params</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">locale</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  children</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">React</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ReactNode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  params</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">locale</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> };</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">  // Cung cấp tất cả các message cho client</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> messages</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getMessages</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    locale</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">params</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">locale</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  });</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getTranslations</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;rootLayout&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">html</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> lang</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">locale</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextIntlClientProvider</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> messages</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">messages</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">          &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;test&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">          {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">children</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextIntlClientProvider</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">html</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Truy cập <code>/en/~</code>, hiển thị <code>Test</code>.</p></li><li><p>Truy cập <code>/cn/~</code>, hiển thị <code>测试</code>.</p></li></ul><ol start="9"><li>Thiết lập thông tin nội dung tương ứng với locale trên các trang liên quan.</li></ol><p><strong>Server Component: Sử dụng getTranslations</strong></p><div class="language-javascript" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">getTranslations</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-intl/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getTranslations</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;home&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;add&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;remove&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>Client Component: Sử dụng useTranslations</strong></p><div class="language-javascript" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useTranslations</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-intl&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Page</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useTranslations</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;home&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;add&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;remove&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ol start="10"><li>Thành phần chuyển đổi ngôn ngữ.</li></ol><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useLocale</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next-intl&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">usePathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useRouter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/navigation&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ToggleLocale</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> locale</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useLocale</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> router</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useRouter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> pathname</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> usePathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> toggleLanguage</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">item</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    locale</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">replace</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}${</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">pathname</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">split</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/&#39;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> locale</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)[</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">]</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ul</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      {</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;en&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;cn&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">].</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">map</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">item</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">li</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">          className</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">locale</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ===</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> item</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> ?</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;active&#39;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> :</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">          onClick</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">{</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> toggleLanguage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &gt;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">          {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">item</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">li</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">      ))</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ul</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  );</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="meo-nho-them-goi-y-ma-cho-usetranslation-hoac-gettranslation" tabindex="-1"><a class="header-anchor" href="#meo-nho-them-goi-y-ma-cho-usetranslation-hoac-gettranslation"><span>Mẹo nhỏ: Thêm gợi ý mã cho useTranslation hoặc getTranslation</span></a></h3><div class="language-javascript" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// global.d.ts</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">type</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Messages</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> typeof</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;./messages/en.json&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">declare</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> IntlMessages</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Messages</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {}</span></span></code></pre></div><figure><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e81425517839417d8042951243a5d63d~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=857&amp;h=185&amp;s=46011&amp;e=png&amp;b=202020" alt="Image" tabindex="0" loading="lazy"><figcaption>Image</figcaption></figure><h2 id="trpc" tabindex="-1"><a class="header-anchor" href="#trpc"><span>tRPC</span></a></h2><p>tRPC cung cấp các kiểu dữ liệu TypeScript chia sẻ giữa phía trước và phía sau, cho phép xây dựng API an toàn về kiểu dữ liệu, với các gợi ý kiểu trực quan. Điều này giúp trải nghiệm phát triển trở nên mượt mà hơn và nâng cao hiệu suất phát triển cá nhân.</p><p>Mặc dù tRPC và REST API đều được sử dụng cho giao tiếp HTTP giữa phía trước và phía sau, nhưng tRPC tiện lợi hơn nhiều so với REST API và thậm chí là GraphQL.</p><h3 id="trpc-so-voi-rest-api" tabindex="-1"><a class="header-anchor" href="#trpc-so-voi-rest-api"><span>tRPC so với REST API</span></a></h3><p><strong>Phương pháp REST API: Giao thức ràng buộc</strong></p><ol><li><p>Cấu hình một địa chỉ yêu cầu cơ bản trên phía khách, chẳng hạn như <code>my.com/10</code>.</p></li><li><p>Cấu hình các phương thức yêu cầu khác nhau cùng với địa chỉ yêu cầu tương ứng trên phía khách: GET, POST, PUT, DELETE.</p></li><li><p>Sau khi phía khách khởi xướng yêu cầu, phía Server sẽ thực hiện các hàm xử lý tương ứng dựa trên địa chỉ yêu cầu và phương thức, sau đó trả lại kết quả cho phía khách.</p></li><li><p>Phía trước được viết bằng TypeScript, trong khi phía sau có thể là bất kỳ ngôn ngữ nào.</p></li></ol><p><strong>Phương pháp tRPC:</strong></p><ol><li><p>Chỉ có một địa chỉ yêu cầu, chẳng hạn như <code>my.com/10</code>, không cần nối thêm các địa chỉ con khác cho yêu cầu.</p></li><li><p>Viết các hàm xử lý trên phía Server.</p></li><li><p>Ở phía khách, chỉ cần gọi hàm bằng tên của nó (cực kỳ tiện lợi).</p></li><li><p>Cả phía trước và phía sau đều được viết bằng TypeScript, thích hợp cho các dự án toàn diện.</p></li></ol><ul><li><strong>REST API</strong></li></ul><table><thead><tr><th>Client</th><th>Server</th></tr></thead><tbody><tr><td><code>axios.get(&#39;/api/user&#39;)</code></td><td><code>GET /api/user -&gt; getUsers()</code></td></tr><tr><td><code>axios.post(&#39;/api/user&#39;)</code></td><td><code>POST /api/user -&gt; addUser(user)</code></td></tr><tr><td><code>axios.put(&#39;/api/user&#39;)</code></td><td><code>PUT /api/user -&gt; updateUser(user)</code></td></tr><tr><td><code>axios.delete(&#39;/api/user&#39;)</code></td><td><code>DELETE /api/user -&gt; deleteUser(id)</code></td></tr></tbody></table><ul><li><strong>tRPC</strong></li></ul><table><thead><tr><th>Client</th><th>Server</th></tr></thead><tbody><tr><td><code>trpcClient.getUsers.query()</code></td><td><code>-&gt; getUsers()</code></td></tr><tr><td><code>trpcClient.addUser.mutate()</code></td><td><code>-&gt; addUser(user)</code></td></tr><tr><td><code>trpcClient.updateUser.mutate()</code></td><td><code>-&gt; updateUser(user)</code></td></tr><tr><td><code>trpcClient.deleteUser.mutate()</code></td><td><code>-&gt; deleteUser(id)</code></td></tr></tbody></table><h3 id="đac-điem-cua-trpc" tabindex="-1"><a class="header-anchor" href="#đac-điem-cua-trpc"><span>Đặc điểm của tRPC</span></a></h3><ul><li><p>Không cần phương thức và địa chỉ con, Client có thể gọi trực tiếp hàm của Server (RPC).</p></li><li><p>Trong cùng một trang, nhiều yêu cầu sẽ được gộp lại thành một yêu cầu.</p></li></ul><table><thead><tr><th><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/fa9ef9067d8448cb997e6b0fafe53ca4~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=888&amp;h=352&amp;s=80473&amp;e=png&amp;b=1f1f1f" alt="Image" loading="lazy"></th><th><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3fa4812f3c2f464a92704a2249fb4dd3~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=887&amp;h=128&amp;s=24922&amp;e=png&amp;b=fdfdfd" alt="Image" loading="lazy"></th></tr></thead></table><ul><li><p>Là một mô-đun phía trước, không có phụ thuộc, kích thước nhỏ.</p></li><li><p>Có thể sử dụng cho cả dự án mới và cũ, phù hợp với nhiều framework phổ biến.</p></li></ul><h3 id="huong-dan-nhanh-ve-trpc" tabindex="-1"><a class="header-anchor" href="#huong-dan-nhanh-ve-trpc"><span>Hướng dẫn nhanh về tRPC</span></a></h3><p><strong>Cài đặt môi trường:</strong></p><p><code>bun add @trpc/server@next @trpc/client@next</code></p><p><strong>Server:</strong></p><ul><li><p>Khởi tạo Server tRPC.</p></li><li><p>Định nghĩa hàm procedure.</p></li><li><p>Truy vấn: query.</p></li><li><p>Hoạt động: mutation (thêm, sửa, xóa).</p></li><li><p>Tổ chức các hàm router (thay thế cho router API).</p></li><li><p>Bật dịch vụ server để nhận yêu cầu.</p></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /server/index.js</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">initTRPC</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> require</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;@trpc/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Khởi tạo Server tRPC</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> initTRPC</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * t.router()</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * t.procedure</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Định nghĩa router</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> appRouter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    hello</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">procedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">((</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">params</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {}) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Lấy dữ liệu ...</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> data</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;Hello World&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }),</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // input lấy dữ liệu yêu cầu từ Client, có thể kiểm tra tại đây</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // mutation thao tác dữ liệu</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    save</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">procedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">val</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">mutation</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opt</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Lưu dữ liệu ...</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">opt</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;Lưu thành công&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    })</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * opt</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> *   .ctx // context</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> *   .type // &#39;mutation&#39;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> *   .getRawInput</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> *   .meta</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> *   .input // Dữ liệu gửi từ Client</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> *   .next</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Định nghĩa Server server</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> server</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createHTTPServer</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">appRouter</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">listen</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">5000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Server đang chạy ...&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Client:</strong></p><ul><li><p>Tạo Client tRPC.</p></li><li><p>Cấu hình địa chỉ gọi dịch vụ phía sau.</p></li><li><p>Gọi hàm từ xa (RPC).</p></li></ul><div class="language-javascript line-numbers-mode" data-highlighter="shiki" data-ext="javascript" data-title="javascript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// /client/index.js</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createTRPCClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@trpc/client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Tạo Client tRPC</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> trpcClient</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createTRPCClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    links</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Cấu hình địa chỉ yêu cầu Server</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        httpBatchLink</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            url</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`http://localhost:5000`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        })</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ]</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Sử dụng trpcClient.query(params?) gọi query từ trpcServer</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">trpcClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">hello</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// &#39;Hello World&#39;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Sử dụng trpcClient.mutate(data?) gọi mutation từ trpcServer</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">trpcClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">mutate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;xfz&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">then</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">data</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// &#39;Lưu thành công&#39;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="su-dung-trong-next-js" tabindex="-1"><a class="header-anchor" href="#su-dung-trong-next-js"><span>Sử dụng trong Next.js</span></a></h3><p><strong>Ý kiến cá nhân</strong>: Ví dụ trên trang web sử dụng <code>react-query</code> để giải quyết vấn đề thiếu dữ liệu khi các component React được gắn (thay thế cách gọi dữ liệu khởi tạo bằng <code>useEffect</code>). Vì Next.js hỗ trợ SSR và SSG, nên không cần thiết phải sử dụng <code>react-query</code>, điều này giúp giảm độ phức tạp của mã.</p><p>Trong Next.js, ngoài việc sử dụng <code>@trpc/server</code> và <code>@trpc/client</code>, còn cần <code>@trpc/next</code>, cung cấp các chức năng và công cụ đặc thù cho việc tích hợp tRPC và Next.js.</p><ul><li><p><strong>Xử lý API Route</strong>: Giúp thiết lập và xử lý các route tRPC trong dự án trở nên rất đơn giản và trực tiếp.</p></li><li><p><strong>Chức năng môi trường cụ thể của Next.js</strong>: Tiện lợi khi sử dụng với tRPC trong trường hợp sử dụng SSR và SSG.</p></li><li><p><strong>Giao tiếp giữa client và server đơn giản hóa</strong>.</p></li><li><p><strong>Tự động sinh loại</strong>: Tự động sinh định nghĩa loại, đảm bảo tính nhất quán giữa front-end và back-end.</p></li></ul><blockquote><p>❝<br> Ví dụ trên trang web sử dụng <code>@trpc/next</code> và <code>react-query</code>, tôi cảm thấy điều này là không cần thiết.<br> ❞</p></blockquote><h4 id="_1-đinh-nghia-cau-truc-thu-muc-theo-so-thich-ca-nhan" tabindex="-1"><a class="header-anchor" href="#_1-đinh-nghia-cau-truc-thu-muc-theo-so-thich-ca-nhan"><span>1. Định nghĩa cấu trúc thư mục (theo sở thích cá nhân)</span></a></h4><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>├── (pages)                         # Thư mục ảo cho các trang (đường dẫn trang), để phân biệt với các thư mục khác</span></span>
<span class="line"><span>│   ├── createUser                  # http://localhost:3000/createUser</span></span>
<span class="line"><span>│   │   └── page.tsx</span></span>
<span class="line"><span>│   └── ssrTest                     # http://localhost:3000/ssrTest</span></span>
<span class="line"><span>│       └── page.tsx</span></span>
<span class="line"><span>│   ├── favicon.ico</span></span>
<span class="line"><span>│   ├── globals.css</span></span>
<span class="line"><span>│   ├── layout.tsx                  # RootLayout</span></span>
<span class="line"><span>│   ├── page.tsx                    # http://localhost:3000</span></span>
<span class="line"><span>├── _trpc                           # Thư mục lưu trữ trpcRouter và các công cụ liên quan</span></span>
<span class="line"><span>│   ├── index.ts                    # Tập tin tổng nhập của trpcRouter, tích hợp các router kinh doanh</span></span>
<span class="line"><span>│   ├── routers                     # Thư mục phân chia router tRPC</span></span>
<span class="line"><span>│   │   ├── product.ts              # router kinh doanh 1</span></span>
<span class="line"><span>│   │   └── user.ts                 # router kinh doanh 2</span></span>
<span class="line"><span>│   ├── trpcCaller.ts               # Điểm vào router kinh doanh cho component server</span></span>
<span class="line"><span>│   └── trpcClient.ts               # Điểm vào router kinh doanh cho component client</span></span>
<span class="line"><span>├── api                             # API route</span></span>
<span class="line"><span>│   ├── news                        # RESTFUL API cách /api/news</span></span>
<span class="line"><span>│   │   └── route.ts</span></span>
<span class="line"><span>│   └── trpc                        # Đường dẫn tRPC</span></span>
<span class="line"><span>│       └── [...trpc]              # /api/trpc/xxxx</span></span>
<span class="line"><span>│           └── route.ts</span></span>
<span class="line"><span>├── lib                             # Thư viện</span></span>
<span class="line"><span>│   ├── trpc                        # Công cụ tRPC</span></span>
<span class="line"><span>│   │   ├── context.ts              # Ngữ cảnh tRPC</span></span>
<span class="line"><span>│   │   └── index.ts                # Khởi tạo tRPC</span></span>
<span class="line"><span>│   └── utils.ts                    # Tập hợp công cụ</span></span>
<span class="line"><span>└── types                           # Kiểu</span></span>
<span class="line"><span>    └── user.ts</span></span>
<span class="line"><span>    └── product.ts</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_2-khoi-tao-dich-vu-trpc" tabindex="-1"><a class="header-anchor" href="#_2-khoi-tao-dich-vu-trpc"><span>2. Khởi tạo dịch vụ tRPC</span></a></h4><ul><li>「Tạo ngữ cảnh tRPC」</li></ul><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/lib/trpc/context.ts   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">CreateNextContextOptions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@trpc/server/adapters/next&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createTRPCContext</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">CreateNextContextOptions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // const session = await getServerSession();        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Mô phỏng session    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> session</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;xfz&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">role</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;admin&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } };    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { ...(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">opts</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {}), </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> };   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Context</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> typeof</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> createTRPCContext</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li><p>「Khởi tạo dịch vụ tRPC (bao gồm Authorize) và xuất các công cụ liên quan」</p></li><li><p>Ngữ cảnh</p></li><li><p>meta</p></li><li><p>Authorize</p></li></ul><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/lib/trpc/index.ts   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">TRPCError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">initTRPC</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@trpc/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Context</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./context&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Dữ liệu meta của quy trình, cho phép thêm các thuộc tính meta tùy chọn cho từng quy trình, sẽ có sẵn trong tất cả các tham số của hàm middleware   </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Thường được sử dụng cho xác thực danh tính, phân loại vai trò, v.v.   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">interface</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Meta</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    authRequired</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">boolean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Có cần xác thực không    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    role</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;tourist&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;admin&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Phân loại vai trò người dùng   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> initTRPC</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">context</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Context</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;()    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">meta</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Meta</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;()    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({        </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        defaultMeta</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            authRequired</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            role</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;tourist&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        },    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> router</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> middleware</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> publicProcedure</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">procedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Meta: { authRequired: false, role: &#39;tourist&#39; }      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Quy trình cần xác thực, thực chất là một middleware   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> authedProcedure</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">procedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ctx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ctx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {            </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> TRPCError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;UNAUTHORIZED&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// 401        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({            </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // Nhìn vào cách mà mẫu dự án create-d3-app viết            </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // Thực sự không cần thiết, vì đã có trong ctx, không cần mở rộng nữa            </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // ctx: {                </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            //     session: { ...ctx.session }            </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // }        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        });    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    })    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">meta</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({        </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        authRequired</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,        </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        role</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });   </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Kết hợp Meta Mặc định: { authRequired: true, role: &#39;user&#39; }      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Dành riêng cho người dùng admin   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> adminProcedure</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> authedProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">meta</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ctx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ctx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">role</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> meta</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">?.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">role</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {            </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> TRPCError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;FORBIDDEN&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> }); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// 403        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    })    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">meta</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({        </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        role</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;admin&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });   </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Kết hợp Meta Mặc định: { authRequired: true, role: &#39;admin&#39; }      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Gọi nội bộ từ Server   </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// export const createCaller = t.createCaller;   </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// createCaller đã bị loại bỏ trong trpc v11   </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// @see https://trpc.io/docs/server/server-side-calls#create-caller   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> createCallerFactory</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createCallerFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong đoạn mã trên, chúng tôi đã sử dụng chức năng meta của tRPC, điều này cá nhân tôi cảm thấy rất tiện lợi. Việc sử dụng meta có hai cách:</p><p>「1. Cài đặt trước meta, sau đó thiết lập các quy trình khác nhau theo meta khác nhau, ví dụ chính thức」:<br><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f7e3b4016ed64868bc0422b98bb9abf1~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=438&amp;h=580&amp;s=71763&amp;e=png&amp;b=1b1a1c" alt="Image" loading="lazy"></p><p>「2. Chỉ thêm meta khi sử dụng quy trình cụ thể, ví dụ trên trang chính thức」:<br><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/98e4b19e26b745d1bce1d72f9b77ab7e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=608&amp;h=572&amp;s=85440&amp;e=png&amp;b=1b1a1c" alt="Image" loading="lazy"></p><p>Cá nhân tôi thích cách thứ nhất, tùy thuộc vào nhu cầu kinh doanh để chọn quy trình khác nhau.</p><h4 id="_3-tao-trpcrouter" tabindex="-1"><a class="header-anchor" href="#_3-tao-trpcrouter"><span>3. Tạo <code>trpcRouter</code></span></a></h4><p>Trong phát triển thực tế, chúng ta thường có nhiều giao diện kinh doanh khác nhau, vì vậy việc phân chia các quy trình theo không gian tên khác nhau là rất hữu ích. Cuối cùng, chúng ta sẽ tổng hợp tất cả lại với nhau (tương tự như <code>vuex</code>, <code>redux</code>).</p><p><strong>Lưu ý về thói quen lập trình tốt, hãy quý trọng!</strong></p><ul><li>Đầu tiên, chúng ta sẽ tạo hai router cho các nghiệp vụ khác nhau: <code>user.ts</code> và <code>product.ts</code>.</li></ul><h5 id="user-ts" tabindex="-1"><a class="header-anchor" href="#user-ts"><span><code>user.ts</code></span></a></h5><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/_trpc/routers/user.ts   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">TRPCError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@trpc/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">adminProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">authedProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Meta</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/lib/trpc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">UserType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/types/user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> User</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    getUserList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">publicProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ctx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> any</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">meta</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // { user: { id: 1, name: &#39;xfz&#39;, role: &#39;admin&#39; } }        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // { authRequired: false, role: &#39;tourist&#39; }        </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Lấy dữ liệu từ cơ sở dữ liệu    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> users</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;xfz&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">role</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;admin&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> },        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;xwb&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">18</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">role</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> },        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;zc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">22</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">role</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> },        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">4</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;ssb&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">25</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">role</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> },    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        ];        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">users</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;success&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        };    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }),    </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Ở đây sử dụng adminProcedure, chỉ admin mới có thể tạo người dùng    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">adminProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">val</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">mutation</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opt</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">opt</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">opt</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ctx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">opt</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> any</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">meta</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // { id: 5, name: &#39;tmd&#39;, age: 100, role: &#39;user&#39; }        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // { user: { id: 1, name: &#39;xfz&#39;, role: &#39;admin&#39; } }        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // { authRequired: true, role: &#39;admin&#39; }        </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            try</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {            </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // Chèn dữ liệu vào cơ sở dữ liệu            </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {                </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,                </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,                </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Created Success&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                };        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">any</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {            </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">                console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);            </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> TRPCError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({                </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    code</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;INTERNAL_SERVER_ERROR&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,                </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                    message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                });        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            }    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }),    </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    updateUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">authedProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">val</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">mutation</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opt</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">opt</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }),   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="product-ts" tabindex="-1"><a class="header-anchor" href="#product-ts"><span><code>product.ts</code></span></a></h5><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/_trpc/routers/product.ts   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/lib/trpc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Product</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    getAllProducts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">publicProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [],            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;success&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        };    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }),    </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    getProductById</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">publicProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">val</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {},            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;success&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        };    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }),   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Ghi chú:</strong> Vai trò có thể được lấy thông qua <code>opts.meta</code> hoặc <code>opts.ctx</code>.</p><p>Để gọi dịch vụ và truyền tham số, sử dụng <code>.input(val =&gt; val).query | mutation</code>.</p><ul><li>Bây giờ, chúng ta sẽ nhập hai router trên và kết hợp chúng lại.</li></ul><h5 id="ket-hop-cac-router" tabindex="-1"><a class="header-anchor" href="#ket-hop-cac-router"><span>Kết hợp các router</span></a></h5><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/_trpc/index.ts   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/lib/trpc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">User</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./routers/user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">Product</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;./routers/product&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/** </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * Mỗi router có không gian tên riêng, ở đây User và Product là không gian tên </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * trpcClient.User.getUserList </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * trpcClient.Product.getAllProducts </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> trpcRouter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    User</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    Product</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/** </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * Nếu muốn gộp UserRouter và ProductRouter lại và cùng không gian tên </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * trpcClient.getUserList </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * trpcClient.getAllProducts </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// export const trpcRouter = t.mergeRouters(User, Product);      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TRPCRouter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> typeof</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> trpcRouter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Với đoạn mã này, chúng ta đã thiết lập thành công các router cho từng nghiệp vụ và tổ chức chúng một cách có hệ thống.</p><h4 id="_4-tao-trpcclient" tabindex="-1"><a class="header-anchor" href="#_4-tao-trpcclient"><span>4. Tạo <code>trpcClient</code></span></a></h4><p><code>trpcClient</code> được sử dụng trong các thành phần phía khách để gửi yêu cầu, thay thế cho các yêu cầu sử dụng <code>fetch</code> hoặc <code>axios</code>.</p><h4 id="đoan-ma-trpcclient-ts" tabindex="-1"><a class="header-anchor" href="#đoan-ma-trpcclient-ts"><span>Đoạn mã <code>trpcClient.ts</code></span></a></h4><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/_trpc/trpcClient.ts   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createTRPCClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">httpBatchLink</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@trpc/client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">TRPCRouter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;.&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">getBaseUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/lib/utils&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> trpcClient</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createTRPCClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TRPCRouter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;({    </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    links</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: [        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Thiết lập địa chỉ duy nhất cho yêu cầu trpc, tương ứng với api router        </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        httpBatchLink</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            url</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getBaseUrl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">/api/trpc`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // http://localhost:3000/api/trpc        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }),    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ],  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre></div><h4 id="đoan-ma-utils-ts" tabindex="-1"><a class="header-anchor" href="#đoan-ma-utils-ts"><span>Đoạn mã <code>utils.ts</code></span></a></h4><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/lib/utils.ts   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getBaseUrl</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">typeof</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> window</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !==</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;undefined&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trình duyệt nên sử dụng đường dẫn tương đối        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">VERCEL_URL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Tham chiếu cho vercel.com        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `https://</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">VERCEL_URL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">RENDER_INTERNAL_HOSTNAME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Tham chiếu cho render.com        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `http://</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">RENDER_INTERNAL_HOSTNAME</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">:</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">PORT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Giả định localhost        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `http://localhost:</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">${</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">process</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">env</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">PORT</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ??</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 3000</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">}</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre></div><h4 id="_5-tich-hop-trpcrouter-vao-api-route-cua-next-js" tabindex="-1"><a class="header-anchor" href="#_5-tich-hop-trpcrouter-vao-api-route-cua-next-js"><span>5. Tích hợp <code>trpcRouter</code> vào API route của Next.js</span></a></h4><ul><li><p><strong>Đường dẫn</strong>: <code>app/api/trpc/[...trpc]/route.ts</code></p></li><li><p>Đường dẫn <code>/api/trpc</code> tương ứng với <code>httpBatchLink</code> đã thiết lập cho <code>trpcClient</code>.</p></li><li><p>Ví dụ: khi gọi <code>trpcClient.User.getUserList.query()</code>, yêu cầu sẽ được gửi tới:</p></li></ul><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>http://localhost:3000/api/trpc/User.getUserList?batch=1&amp;input=%7B%7D</span></span></code></pre></div><p>Đoạn mã <code>route.ts</code></p><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/api/trpc/[...trpc]/route.ts   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;next/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">fetchRequestHandler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@trpc/server/adapters/fetch&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">trpcRouter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/_trpc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createTRPCContext</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/lib/trpc/context&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">NextRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> fetchRequestHandler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({        </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Địa chỉ điểm yêu cầu, tương ứng với thư mục app/api/trpc        </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        endpoint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;/api/trpc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,        </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,        </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">trpcRouter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,        </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        createContext</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createTRPCContext</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> any</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">handler</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> GET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">handler</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> as</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> POST</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> };</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_6-1-goi-trpc-tu-client-component" tabindex="-1"><a class="header-anchor" href="#_6-1-goi-trpc-tu-client-component"><span>6.1 Gọi trpc từ Client Component</span></a></h4><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/(pages)/page.tsx   </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;use client&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useEffect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;react&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">trpcClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/_trpc/trpcClient&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">UserType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/types/user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> HomePage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> [</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">userList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">setUserList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> useState</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[]&gt;([]);      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getUserList</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {            </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> trpcClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">getUserList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();            </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">            setUserList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {            </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };       </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    useEffect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        getUserList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }, []);       </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> create</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        trpcClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">createUser</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">mutate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;tmd&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            age</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            role</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;user&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        });    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };       </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;            </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{JSON.stringify(userList)}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> onClick</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">create</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> onClick</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">update</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">update</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">button</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        </span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    );  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Truy cập: <code>http://localhost:3000</code></p><h4 id="_6-2-kiem-tra-du-lieu-đau-vao" tabindex="-1"><a class="header-anchor" href="#_6-2-kiem-tra-du-lieu-đau-vao"><span>6.2 Kiểm tra dữ liệu đầu vào</span></a></h4><p>Trước tiên, <code>procedure</code> lấy tham số cần sử dụng <code>input</code>, <code>input</code> giống như một middleware, vì vậy cần trả về tham số đã lấy được cho các thao tác sau, như <code>query</code> hoặc <code>mutation</code>, nếu không <code>opts.input</code> sẽ không lấy được dữ liệu.</p><p>Gọi</p><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> trpcClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Product</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">getProductById</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span></code></pre></div><p>Dịch vụ</p><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">getProductById</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">val</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> val</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// {id: 1}    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    })    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span></code></pre></div><p><strong>Sử dụng zod để kiểm tra dữ liệu đầu vào:</strong></p><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">getProductById</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(        </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">object</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">number</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        })    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    )    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span></code></pre></div><p><strong>Nếu cần xử lý dữ liệu đã kiểm tra, làm thế nào?</strong></p><p>Sử dụng <code>.use(opts =&gt; {})</code> middleware sau <code>input()</code> để xử lý.</p><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">getProductById</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(        </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">object</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">z</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">number</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        })    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    )    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> newInput</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { ...</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`_id_`</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> };        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">newInput</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        });    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    })    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">input</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// { id: &#39;_id_1&#39; }    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    });</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-1-goi-trpc-tu-server-component" tabindex="-1"><a class="header-anchor" href="#_7-1-goi-trpc-tu-server-component"><span>7.1 Gọi tRPC từ Server Component</span></a></h4><p><strong>Kết luận:</strong> Trong Server Component không thể sử dụng <code>trpcClient</code> để gọi dịch vụ.</p><p><strong>Nguyên tắc:</strong> Server Component chỉ cần gọi dịch vụ ở phía Server mà không cần phát sinh yêu cầu HTTP. Nhưng nếu dịch vụ của bạn đã được viết trong tRPC router thì sao?</p><ul><li>Ví dụ, sử dụng <code>trpcClient</code> trong Server Component:</li></ul><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">trpcClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/_trpc/trpcClient&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Home</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> userList</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> trpcClient</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">getUserList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();       </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{JSON.stringify(userList)}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li><p>Trong môi trường phát triển, điều này có thể hoạt động, nhưng nếu bạn thay đổi dữ liệu trả về từ backend, nội dung trang sẽ không thay đổi do Next.js 14 mặc định lưu cache GET request. Ngay cả khi thiết lập <code>dynamic = &#39;force-dynamic&#39;</code>, điều này cũng không giúp được gì.</p></li><li><p>Khi chạy <code>npm run build</code>, sẽ xảy ra lỗi kết nối đến Server.</p></li></ul><p>Do đó, cần tìm cách gọi tRPC từ bên trong Server Component, và <code>@trpc/server</code> cung cấp phương pháp gọi nội bộ.</p><h4 id="_7-2-goi-tu-phia-server" tabindex="-1"><a class="header-anchor" href="#_7-2-goi-tu-phia-server"><span>7.2 Gọi từ phía Server</span></a></h4><ul><li><p>Trước v11, bạn có thể sử dụng <code>t.createCaller</code> để thực hiện cuộc gọi nội bộ.</p></li><li><p>Từ v11 trở đi, <code>t.createCaller</code> đã được thay thế bằng <code>t.createCallerFactory</code>.</p></li></ul><p><strong>1. Tạo hàm factory gọi nội bộ <code>trpcCaller</code></strong></p><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/lib/trpc/index.ts  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// ....  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> createCallerFactory</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createCallerFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// app/_trpc/trpcCaller.ts  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">createCallerFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/lib/trpc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">trpcRouter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;.&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Tạo caller dựa trên trpcRouter  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> createCaller</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createCallerFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">trpcRouter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> trpcCaller</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createCaller</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    {        </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {                </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,                </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;xfz&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,                </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                role</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;admin&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            },        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    },    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    {        </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        onError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {            </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;An error occurred&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        },    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Sử dụng trong Server Component</strong></p><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">trpcCaller</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/_trpc/trpcCaller&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Home</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> trpcCaller</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">User</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">getUserList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> ...   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Bây giờ, khi chạy <code>npm run build</code>, sẽ không còn báo lỗi nữa, nhưng trang tạo ra vẫn là SSG.</li></ul><h4 id="_7-3-ssr" tabindex="-1"><a class="header-anchor" href="#_7-3-ssr"><span>7.3 SSR</span></a></h4><p>Dựa trên phần Cache đã học trước đó, chỉ cần thiết lập trang với <code>export const dynamic = &#39;force-dynamic&#39;</code> là đủ.</p><h4 id="_7-4-cach-tiem-session-vao-trpccaller" tabindex="-1"><a class="header-anchor" href="#_7-4-cach-tiem-session-vao-trpccaller"><span>7.4 Cách tiêm session vào <code>trpcCaller</code></span></a></h4><p>Trong phần 7.2, cách chúng ta tiêm session vào <code>trpcCaller</code> gặp vấn đề và không thể lấy được session thực. Dưới đây là cách cải tiến cho file <code>trpcCaller</code>.</p><p><strong>❌ Tuyệt đối không làm như sau:</strong></p><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> createCaller</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createCallerFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">trpcRouter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);      </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">let</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> trpcCaller</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getTrpcCaller</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">trpcCaller</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> trpcCaller</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }    </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Lấy session    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // const session = await getServerSession();    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> session</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {        </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;xfz&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,            </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">            role</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;admin&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,        </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        },    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    };      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Unauthorized&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    trpcCaller</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createCaller</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> trpcCaller</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">getTrpcCaller</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/_trpc/trpcCaller&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> dynamic</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;force-dynamic&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> function</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Home</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">() {    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> trpcCaller</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getTrpcCaller</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> trpcCaller</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTime</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();       </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">section</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;{</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">section</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;   </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>Mặc dù đoạn mã trên thành công trong việc tiêm session vào <code>trpcCaller</code>, nhưng nó có một số lỗi nghiêm trọng như sau:</strong></p><ul><li><p><strong>Session có thể hết hạn:</strong> Session thường là tạm thời, việc lưu một đối tượng session có thể dẫn đến việc tiếp tục sử dụng session đã hết hạn.</p></li><li><p><strong>Môi trường đa người dùng:</strong> Nếu ứng dụng của bạn hoạt động trong môi trường nhiều người dùng, việc lưu một đối tượng session có thể gây ra vấn đề bảo mật, vì các yêu cầu từ người dùng khác nhau có thể chia sẻ cùng một session.</p></li></ul><p>Vì vậy, tốt hơn hết là mỗi khi gọi <code>getTrpcCaller</code>, chúng ta nên lấy lại session.</p><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getTrpcCaller</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> async</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> () </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Lấy session    </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // const session = await getServerSession(authOptions);    </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    const</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createTRPCContext</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();       </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {        </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Unauthorized&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);    </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }      </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> createCaller</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">};</span></span></code></pre></div><p><strong>Để đảm bảo tính bảo mật và duy nhất, tốt nhất nên lưu trữ session trực tiếp trong cơ sở dữ liệu, tạo một bảng chuyên dụng cho quản lý session. Nếu cảm thấy phiền phức, có thể thêm một trường session vào bảng người dùng.</strong></p><h4 id="_8-trpc-middleware" tabindex="-1"><a class="header-anchor" href="#_8-trpc-middleware"><span>8. tRPC Middleware</span></a></h4><ul><li>tRPC middleware được thực hiện thông qua <code>procedure.use(middleware)</code>.</li><li><strong>Lưu ý:</strong> Middleware cuối cùng phải luôn <code>return opts.next()</code>, nếu không, các thao tác phía sau sẽ không thể thực hiện.</li><li><code>use()</code> chỉ có thể được sử dụng trước các query hoặc mutation.</li><li><code>procedure.use(middleware) =&gt; newProcedure</code></li></ul><h5 id="pre-middleware" tabindex="-1"><a class="header-anchor" href="#pre-middleware"><span>Pre-Middleware</span></a></h5><p>「Xử lý trước, sau đó thực hiện next()」</p><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/lib/trpc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> appRouter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // opts: { ctx: { session ...}, next }</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;--- Middleware --- Xử lý trước&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">            // Lưu ý: Middleware cuối cùng phải return opts.next()</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        })</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;query...&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;test&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Kết quả xuất ra:</strong></p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>--- Middleware --- Xử lý trước</span></span>
<span class="line"><span>query...</span></span></code></pre></div><p><em>Dựa vào đặc điểm này, có thể thực hiện xác thực danh tính trong middleware trước.</em></p><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">procedure</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ctx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">session</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">?.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> TRPCError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({ </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">code</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;FORBIDDEN&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    })</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {});</span></span></code></pre></div><h5 id="post-middleware" tabindex="-1"><a class="header-anchor" href="#post-middleware"><span>Post-Middleware</span></a></h5><p>「Thực hiện next() trước, sau đó xử lý」</p><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/lib/trpc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> appRouter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> result</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> await</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;--- Middleware --- Xử lý sau&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        })</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;--- Middleware --- Xử lý trước&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        })</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;query...&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;test&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Kết quả xuất ra:</strong></p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>--- Middleware --- Xử lý trước</span></span>
<span class="line"><span>query...</span></span>
<span class="line"><span>--- Middleware --- Xử lý sau</span></span></code></pre></div><h5 id="mo-rong-ctx" tabindex="-1"><a class="header-anchor" href="#mo-rong-ctx"><span>Mở rộng ctx</span></a></h5><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> appRouter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;1&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // Nếu ctx trước đó không có test, nó sẽ thêm test, và chứa tất cả thông tin từ ctx trước đó</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // Nếu ctx trước đó có test, nó sẽ ghi đè test</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                ctx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">123</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Thông tin ctx trước đó sẽ không bị mất, ở đây tương đương với việc merge</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        })</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;2&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">ctx</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;test&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Kết quả xuất ra:</strong></p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>1, { session: { user: { id: 1, name: &#39;xfz&#39;, role: &#39;admin&#39; } } }</span></span>
<span class="line"><span>2, { session: { user: { id: 1, name: &#39;xfz&#39;, role: &#39;admin&#39; } }, test: 123 }</span></span></code></pre></div><h5 id="tach-middleware" tabindex="-1"><a class="header-anchor" href="#tach-middleware"><span>Tách Middleware</span></a></h5><p>Trong phát triển thực tế, có thể tách các hàm callback trong <code>use</code> ra ngoài để dễ dàng bảo trì mã:</p><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/lib/trpc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mid1</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;--- Tách middleware 1 ---&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mid2</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;--- Tách middleware 2 ---&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> appRouter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">mid1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">mid2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {}),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="ket-hop-middleware" tabindex="-1"><a class="header-anchor" href="#ket-hop-middleware"><span>Kết hợp Middleware</span></a></h5><p>Các middleware trên có thể kết hợp lại và gán cho procedure:</p><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@/app/lib/trpc&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mid1</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;--- Tách middleware 1 ---&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mid2</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> middleware</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">async</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;--- Tách middleware 2 ---&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> opts</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Kết hợp mid1 và mid2</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mid1And2</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mid1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">unstable_pipe</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">mid2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> appRouter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    test</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">publicProcedure</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        //.use(mid1)</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        //.use(mid2)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">use</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">mid1And2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">opts</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> =&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {}),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="mo-rong-kien-thuc-ket-hop-procedure" tabindex="-1"><a class="header-anchor" href="#mo-rong-kien-thuc-ket-hop-procedure"><span>Mở rộng Kiến thức: Kết hợp Procedure</span></a></h5><div class="language-typescript" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">proc1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">unstable_concat</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">proc2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> newProc</span></span></code></pre></div><p>Với việc sử dụng middleware, bạn có thể tổ chức mã nguồn của mình một cách hiệu quả và tái sử dụng mã với tính linh hoạt cao trong các quy trình tRPC.</p><h4 id="_9-bang-ma-loi-trpc" tabindex="-1"><a class="header-anchor" href="#_9-bang-ma-loi-trpc"><span>9. Bảng mã lỗi tRPC</span></a></h4><figure><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c9389450bdd646a28146ebe8d0a09a5e~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=841&amp;h=630&amp;s=95420&amp;e=png&amp;b=1c1c1c" alt="Bảng mã lỗi tRPC" tabindex="0" loading="lazy"><figcaption>Bảng mã lỗi tRPC</figcaption></figure><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" data-title="typescript" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">import</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">initTRPC</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">TRPCError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">from</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;@trpc/server&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> initTRPC</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">create</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">const</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> appRouter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">router</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    hello</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">procedure</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">query</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(() </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">=&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">            alert</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">111</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> TRPCError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">({</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                code</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;INTERNAL_SERVER_ERROR&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                // Tùy chọn</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">                cause</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            });</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }),</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">});</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="in-loi" tabindex="-1"><a class="header-anchor" href="#in-loi"><span>In lỗi</span></a></h5><figure><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d77fd01250f74a8bb253ea6b65931e61~tplv-k3u1fbpfcp-jj-mark:3024:0:0:0:q75.awebp#?w=884&amp;h=186&amp;s=38927&amp;e=png&amp;b=fdfdfd" alt="In lỗi" tabindex="0" loading="lazy"><figcaption>In lỗi</figcaption></figure><h4 id="tom-tat" tabindex="-1"><a class="header-anchor" href="#tom-tat"><span>Tóm tắt</span></a></h4><p>Thông qua những điều đã học ở trên, bạn đã hiểu cách sử dụng tRPC trong NextJs 14. Với việc luyện tập nhiều hơn, tôi tin rằng hiệu suất phát triển của bạn sẽ có sự cải thiện đáng kể. So với REST API, loại thống nhất và cơ chế giao tiếp đơn giản giúp phát triển trở nên thuận tiện hơn.</p><h2 id="trien-khai" tabindex="-1"><a class="header-anchor" href="#trien-khai"><span>Triển khai</span></a></h2><p>Có thể triển khai trên Vercel hoặc Cloudflare, hoặc trên máy chủ đám mây mà bạn đã mua.</p><p><strong>Lưu ý khi triển khai</strong>:</p><ol><li>Đảm bảo máy chủ có môi trường Node.js.</li><li>Chuẩn bị DNS (tên miền).</li><li>Chuẩn bị cơ sở dữ liệu.</li><li>Cấu hình danh sách trắng kết nối cơ sở dữ liệu trên máy chủ.</li><li>Nếu triển khai trên máy chủ đám mây, hãy cấu hình biến môi trường (.env).</li><li>Khi triển khai dự án lần đầu, nếu sử dụng Prisma, cần chạy <code>prisma generate</code>.</li></ol><ul><li><code>prisma generate &amp;&amp; next build</code></li></ul><h2 id="ket-luan" tabindex="-1"><a class="header-anchor" href="#ket-luan"><span>Kết luận</span></a></h2><p>Chẳng mấy chốc, tôi đã viết được nhiều như vậy~</p><p>Hy vọng bài viết này sẽ giúp ích cho bạn.</p><p>Trong quá trình phát triển dự án thực tế, tôi đã gặp không ít khó khăn, tiêu tốn nhiều thuốc lá, đặc biệt là phần <code>Server Component</code> và <code>Client Component</code>, đã tốn nhiều thời gian để xem tài liệu và gỡ lỗi, cuối cùng cũng hiểu ra mọi chuyện.</p><p>Cuối cùng, NextJs 15 cũng sắp ra mắt, nếu có thời gian, chúng ta sẽ gặp lại nhé!</p><h2 id="reference" tabindex="-1"><a class="header-anchor" href="#reference"><span>Reference</span></a></h2><p>Mẫu NextJS cấp doanh nghiệp t3-app</p><h3 id="tai-lieu-tham-khao" tabindex="-1"><a class="header-anchor" href="#tai-lieu-tham-khao"><span>Tài liệu tham khảo</span></a></h3><p>[1] <a href="https://juejin.cn/post/7265210595912581159" target="_blank" rel="noopener noreferrer">NextJs từ nhập môn đến từ bỏ</a></p><p>[2] <a href="https://bun.sh/" target="_blank" rel="noopener noreferrer">bun</a></p><p>[3] <a href="https://github.com/vercel/next.js/tree/canary/examples/with-styled-jsx-scss" target="_blank" rel="noopener noreferrer">github.com/vercel/next…</a></p><p>[4] [NextJs 14] Tóm tắt kiến trúc lấy dữ liệu: <a href="https://juejin.cn/post/7385061036830031872" target="_blank" rel="noopener noreferrer">tại đây</a></p><p>[5] <a href="https://supabase.com/" target="_blank" rel="noopener noreferrer">supabase</a></p><p>[6] <a href="https://www.mongodb.com/atlas" target="_blank" rel="noopener noreferrer">MongoDB</a></p><p>[7] <a href="https://vercel.com/" target="_blank" rel="noopener noreferrer">vercel</a></p><p>[8] <a href="https://reacthustle.com/blog/how-to-chain-multiple-middleware-functions-in-nextjs" target="_blank" rel="noopener noreferrer">Giải pháp tham khảo</a></p><p>[9] <a href="https://clerk.com/" target="_blank" rel="noopener noreferrer">clerk</a></p><p>[10] <a href="http://my.com/" target="_blank" rel="noopener noreferrer">my.com</a></p><p>[11] <a href="http://my.com/" target="_blank" rel="noopener noreferrer">my.com</a></p><p>[12] <a href="http://localhost:3000/" target="_blank" rel="noopener noreferrer">localhost:3000</a></p><p>[13] <a href="https://create.t3.gg/" target="_blank" rel="noopener noreferrer">t3-app</a></p><p>[14] <a href="https://github.com/Blazity/next-enterprise" target="_blank" rel="noopener noreferrer">Mẫu NextJS cấp doanh nghiệp</a></p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/framework/nextjs/zero-to-hero.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with ❤️ by Hung Nguyen</div><div class="copyright">Copyright © 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CIGQMwlz.js" defer></script>
  </body>
</html>
