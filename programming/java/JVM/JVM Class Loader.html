<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.46" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/programming/java/JVM/JVM%20Class%20Loader.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="JVM Class Loader"><meta property="og:description" content="Quá trình tải lớp JVM Cơ chế tải lớp Lớp được tải vào trong quá trình chạy. Tải lớp đề cập đến việc đọc dữ liệu nhị phân từ tệp .class của lớp vào bộ nhớ, đặt nó trong phần dữ l..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/vanhung4499/images/master/snap/JVMCLassLifeCycle.png"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-06-28T15:54:38.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:tag" content="java"><meta property="article:tag" content="javase"><meta property="article:tag" content="jvm"><meta property="article:modified_time" content="2024-06-28T15:54:38.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"JVM Class Loader","image":["https://raw.githubusercontent.com/vanhung4499/images/master/snap/JVMCLassLifeCycle.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230719172338.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230719172838.png"],"dateModified":"2024-06-28T15:54:38.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="icon" href="/favicon.ico"><link rel="icon" href="/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>JVM Class Loader | VanHung4499</title><meta name="description" content="Quá trình tải lớp JVM Cơ chế tải lớp Lớp được tải vào trong quá trình chạy. Tải lớp đề cập đến việc đọc dữ liệu nhị phân từ tệp .class của lớp vào bộ nhớ, đặt nó trong phần dữ l...">
    <link rel="preload" href="/assets/style-DgCUO63b.css" as="style"><link rel="stylesheet" href="/assets/style-DgCUO63b.css">
    <link rel="modulepreload" href="/assets/app-B-Bgbu6w.js"><link rel="modulepreload" href="/assets/JVM Class Loader.html-yLqrcWIv.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/project/" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon><!--]-->Project<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Advanced</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Basic</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/programming/java/collection/" aria-label="Collection"><!---->Collection<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Concurency</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">IO</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/JavaSE%20MOC.html" aria-label="JavaSE MOC"><!---->JavaSE MOC<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">JVM</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/JVM/Java%20Bytecode.html" aria-label="Java Bytecode"><!---->Java Bytecode<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/JVM/JVM%20Architecture.html" aria-label="JVM Architecture"><!---->JVM Architecture<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/programming/java/JVM/JVM%20Class%20Loader.html" aria-label="JVM Class Loader"><!---->JVM Class Loader<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/JVM/JVM%20Command%20Line%20Tools.html" aria-label="JVM Command Line Tools"><!---->JVM Command Line Tools<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/JVM/JVM%20Garbage%20Collection.html" aria-label="JVM Garbage Collection"><!---->JVM Garbage Collection<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/JVM/JVM%20GUI%20Tools.html" aria-label="JVM GUI Tools"><!---->JVM GUI Tools<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/JVM/JVM%20In%20Action.html" aria-label="JVM In Action"><!---->JVM In Action<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/JVM/JVM%20Memory%20Managment.html" aria-label="JVM Memory Managment"><!---->JVM Memory Managment<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->JVM Class Loader</h1><div class="page-info"><span class="page-author-info" aria-label="Author🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing Date📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-28T15:54:38.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 22 min</span><meta property="timeRequired" content="PT22M"></span><span class="page-category-info" aria-label="Category🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color8 clickable" role="navigation">java</span><span class="page-category-item color1 clickable" role="navigation">javase</span><span class="page-category-item color5 clickable" role="navigation">jvm</span><!--]--><meta property="articleSection" content="java,javase,jvm"></span><span class="page-tag-info" aria-label="Tag🏷" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">java</span><span class="page-tag-item color1 clickable" role="navigation">javase</span><span class="page-tag-item color5 clickable" role="navigation">jvm</span><!--]--><meta property="keywords" content="java,javase,jvm"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#co-che-tai-lop">Cơ chế tải lớp</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#vong-đoi-cua-lop">Vòng đời của lớp</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_1-tai">(1) Tải</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_2-xac-minh">(2) Xác minh</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_3-chuan-bi">(3) Chuẩn bị</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_4-giai-quyet">(4) Giải quyết</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#_5-khoi-tao">(5) Khởi tạo</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#class-va-classloader">Class và ClassLoader</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#phan-loai-classloader">Phân loại ClassLoader</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#delegation-model">Delegation Model</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tham-so-classloader">Tham số ClassLoader</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#tai-lop">Tải lớp</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cach-tai-lop">Cách tải lớp</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#loi-tai-lop">Lỗi tải lớp</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="qua-trinh-tai-lop-jvm" tabindex="-1"><a class="header-anchor" href="#qua-trinh-tai-lop-jvm"><span>Quá trình tải lớp JVM</span></a></h1><h2 id="co-che-tai-lop" tabindex="-1"><a class="header-anchor" href="#co-che-tai-lop"><span>Cơ chế tải lớp</span></a></h2><blockquote><p>Lớp được tải vào trong quá trình chạy.</p></blockquote><p>Tải lớp đề cập đến việc đọc dữ liệu nhị phân từ tệp <code>.class</code> của lớp vào bộ nhớ, đặt nó trong phần dữ liệu chạy thời gian của khu vực phương thức, sau đó tạo một đối tượng <code>java.lang.Class</code> trong heap, được sử dụng để đóng gói cấu trúc dữ liệu của lớp trong khu vực phương pháp và cung cấp một giao diện cho người lập trình Java để truy cập vào cấu trúc dữ liệu trong khu vực phương pháp.</p><p>Lớp không cần phải chờ đến khi lớp được &quot;sử dụng lần đầu tiên một cách chủ động&quot; mới tải nó, quy định của JVM cho phép bộ tải lớp tải lớp trước khi dự đoán một lớp sẽ được sử dụng. Nếu trong quá trình tải trước, tệp <code>.class</code> bị thiếu hoặc có lỗi, bộ tải lớp phải báo cáo lỗi chỉ khi lớp được sử dụng lần đầu tiên bởi chương trình (lỗi LinkageError). Nếu lớp không bao giờ được sử dụng bởi chương trình, bộ tải lớp sẽ không báo cáo lỗi.</p><h2 id="vong-đoi-cua-lop" tabindex="-1"><a class="header-anchor" href="#vong-đoi-cua-lop"><span>Vòng đời của lớp</span></a></h2><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/JVMCLassLifeCycle.png" alt="class-life-cycle" tabindex="0" loading="lazy"><figcaption>class-life-cycle</figcaption></figure><p>Vòng đời đầy đủ của lớp Java bao gồm các giai đoạn sau:</p><ul><li><strong>Tải (Loading)</strong></li><li><strong>Liên kết (Linking)</strong><ul><li><strong>Xác minh (Verification)</strong></li><li><strong>Chuẩn bị (Preparation)</strong></li><li><strong>Giải quyết (Resolution)</strong></li></ul></li><li><strong>Khởi tạo (Initialization)</strong></li><li><strong>Sử dụng (Using)</strong></li><li><strong>Hủy (Unloading)</strong></li></ul><p>Quá trình tải, liên kết, chuẩn bị, giải quyết và khởi tạo 5 giai đoạn này là có thứ tự cố định. Quá trình tải lớp phải bắt đầu theo thứ tự này. Trong một số trường hợp, quá trình giải quyết có thể bắt đầu sau giai đoạn khởi tạo để hỗ trợ việc ràng buộc động trong Java.</p><p>Quá trình tải lớp đề cập đến việc tải, xác minh, chuẩn bị, giải quyết và khởi tạo lớp.</p><h3 id="_1-tai" tabindex="-1"><a class="header-anchor" href="#_1-tai"><span>(1) Tải</span></a></h3><p>Tải là một giai đoạn của quá trình tải lớp, hãy chú ý không nhầm lẫn.</p><p><strong>Tải, đề cập đến việc tìm kiếm dòng byte và tạo lớp dựa trên nó</strong>.</p><p>Quá trình tải hoàn thành ba công việc sau:</p><ul><li>Sử dụng tên đầy đủ của một lớp để lấy dòng byte mô tả lớp này.</li><li>Chuyển đổi cấu trúc lưu trữ tĩnh này thành cấu trúc lưu trữ thời gian chạy của khu vực phương pháp.</li><li>Tạo một đối tượng <code>Class</code> trong bộ nhớ, đại diện cho cấu trúc dữ liệu của lớp trong khu vực phương pháp và cung cấp một giao diện để truy cập vào cấu trúc dữ liệu trong khu vực phương pháp.</li></ul><p>Dòng byte có thể được lấy từ các nguồn sau:</p><ul><li>Đọc từ gói ZIP, điều này rất phổ biến và cuối cùng trở thành cơ sở cho các định dạng JAR, EAR, WAR trong tương lai.</li><li>Lấy từ mạng, trường hợp sử dụng phổ biến nhất là Applet.</li><li>Sinh ra trong quá trình tính toán, trường hợp sử dụng phổ biến nhất là kỹ thuật đại diện động, trong <code>java.lang.reflect.Proxy</code>, sử dụng <code>ProxyGenerator.generateProxyClass</code> để sinh ra dòng byte của lớp đại diện.</li><li>Được tạo ra từ các tệp khác, trường hợp sử dụng phổ biến là ứng dụng JSP, nghĩa là tạo lớp từ tệp JSP.</li><li>Đọc từ cơ sở dữ liệu, trường hợp này ít phổ biến, ví dụ: một số máy chủ trung gian (như SAP Netweaver) có thể chọn cài đặt chương trình vào cơ sở dữ liệu để phân phối mã chương trình giữa các cụm.</li></ul><h3 id="_2-xac-minh" tabindex="-1"><a class="header-anchor" href="#_2-xac-minh"><span>(2) Xác minh</span></a></h3><p>Xác minh là bước đầu tiên của giai đoạn liên kết. <strong>Mục tiêu của việc xác minh là đảm bảo dữ liệu nhị phân của tệp Class chứa thông tin phù hợp với yêu cầu của máy ảo hiện tại và không gây nguy hiểm cho bảo mật của máy ảo</strong>.</p><p>Giai đoạn xác minh chủ yếu hoàn thành 4 giai đoạn kiểm tra sau:</p><ul><li><strong>Xác minh định dạng tệp</strong> - Xác minh xem dòng byte có tuân theo định dạng tệp Class không và có thể được xử lý bởi phiên bản máy ảo hiện tại không.</li><li><strong>Xác minh dữ liệu siêu dữ liệu</strong> - Phân tích cú pháp thông tin mô tả byte code để đảm bảo rằng thông tin mô tả này tuân theo yêu cầu của ngôn ngữ Java.</li><li><strong>Xác minh byte code</strong> - Sử dụng phân tích dữ liệu luồng và dữ liệu điều khiển để đảm bảo rằng cú pháp của chương trình hợp lệ và tuân thủ luật lệ của ngôn ngữ.</li><li><strong>Xác minh tham chiếu biểu tượng</strong> - Xảy ra khi máy ảo chuyển đổi tham chiếu biểu tượng thành tham chiếu trực tiếp, kiểm tra tính phù hợp của thông tin ngoài lớp (tham chiếu biểu tượng) với thông tin trong lớp (tham chiếu trực tiếp).</li></ul><p>Giai đoạn xác minh là rất quan trọng, nhưng không bắt buộc, nó không ảnh hưởng đến quá trình chạy của chương trình, nếu lớp được xác minh nhiều lần, bạn có thể xem xét việc tắt hầu hết các biện pháp xác minh lớp bằng cách sử dụng tham số <code>-Xverifynone</code> để rút ngắn thời gian tải lớp của máy ảo.</p><h3 id="_3-chuan-bi" tabindex="-1"><a class="header-anchor" href="#_3-chuan-bi"><span>(3) Chuẩn bị</span></a></h3><p><strong>Biến lớp là các biến được đánh dấu bằng static, giai đoạn chuẩn bị là để phân bổ bộ nhớ cho biến lớp và khởi tạo giá trị mặc định, sử dụng bộ nhớ của khu vực phương pháp</strong>.</p><p>Các biến thể không được phân bổ bộ nhớ trong giai đoạn này, chúng sẽ được phân bổ cùng với việc khởi tạo đối tượng khi đối tượng được khởi tạo (khởi tạo không phải là quá trình tải lớp, quá trình tải lớp xảy ra trước tất cả các hoạt động khởi tạo và chỉ xảy ra một lần, khởi tạo có thể xảy ra nhiều lần).</p><p>Giá trị khởi tạo thường là giá trị 0, ví dụ biến lớp value được khởi tạo là 0 chứ không phải là 123.</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> value </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 123</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Nếu biến lớp là hằng số, thì sẽ được khởi tạo theo biểu thức, chứ không phải là gán bằng 0.</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> value </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 123</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Giai đoạn chuẩn bị cần lưu ý các điểm sau:</p><ul><li>Chỉ cần phân bổ bộ nhớ cho biến lớp (static), không phải là biến thể, biến thể sẽ được phân bổ cùng với đối tượng khi đối tượng được khởi tạo trong Java Heap.</li><li>Giá trị khởi tạo thường là giá trị mặc định của kiểu dữ liệu (ví dụ: <code>0</code>, <code>0L</code>, <code>null</code>, <code>false</code>), không phải là giá trị được gán một cách rõ ràng trong mã Java.</li></ul><p>Giả sử một biến lớp được định nghĩa là: <code>public static int value = 3</code>；</p><p>Lúc này, giá trị của biến value sau giai đoạn chuẩn bị là 0, không phải là 3, vì lúc này chưa bắt đầu thực thi bất kỳ phương thức Java nào, và việc gán giá trị 3 cho value thông qua chỉ thị <code>public static</code> sẽ được thực hiện trong phương thức khởi tạo của lớp <code>（）</code>，vì vậy hành động gán giá trị 3 cho value sẽ được thực hiện trong giai đoạn khởi tạo.</p><blockquote><p>Cần chú ý các điểm sau:</p><ul><li>Đối với kiểu dữ liệu cơ bản, đối với biến lớp (static) và biến toàn cục, nếu không gán giá trị một cách rõ ràng và sử dụng trực tiếp, hệ thống sẽ gán giá trị mặc định cho nó, trong khi đối với biến cục bộ, cần gán giá trị một cách rõ ràng trước khi sử dụng, nếu không, việc biên dịch sẽ không thành công.</li><li>Đối với kiểu dữ liệu tham chiếu, chẳng hạn như tham chiếu mảng, tham chiếu đối tượng, nếu không sử dụng trực tiếp, hệ thống sẽ gán giá trị mặc định cho nó, tức là null.</li><li>Nếu không gán giá trị cho các phần tử trong mảng khi khởi tạo mảng, thì các phần tử trong mảng sẽ được gán giá trị mặc định tương ứng với kiểu dữ liệu của chúng.</li></ul></blockquote><ul><li>Nếu trường thuộc tính của lớp có thuộc tính <code>ConstantValue</code> trong bảng thuộc tính của trường, tức là đồng thời được đánh dấu bằng final và static, thì trong giai đoạn chuẩn bị, biến value sẽ được khởi tạo thành giá trị được chỉ định bởi thuộc tính ConstValue.</li></ul><p>Giả sử biến lớp value được định nghĩa là: <code>public static final int value = 3</code>；</p><p>Khi biên dịch, Javac sẽ tạo thuộc tính ConstantValue cho value, trong giai đoạn chuẩn bị, máy ảo sẽ khởi tạo value thành 3 dựa trên cài đặt của thuộc tính <code>ConstantValue</code>. Chúng ta có thể hiểu rằng hằng số static final trong quá trình biên dịch đã đưa kết quả vào hằng số của lớp gọi nó.</p><h3 id="_4-giai-quyet" tabindex="-1"><a class="header-anchor" href="#_4-giai-quyet"><span>(4) Giải quyết</span></a></h3><p>Trước khi tệp <code>.class</code> được tải vào JVM, lớp không thể biết địa chỉ cụ thể của các lớp và phương thức, trường hợp thậm chí không biết địa chỉ của chính nó. Do đó, mỗi khi cần tham chiếu đến các thành viên này, trình biên dịch Java sẽ tạo ra một tham chiếu biểu tượng. Trong quá trình chạy, tham chiếu biểu tượng này thường có thể xác định một cách chính xác đến mục tiêu.</p><p>Giải quyết là giai đoạn để thay thế các tham chiếu biểu tượng trong bộ nhớ hằng số bằng các tham chiếu trực tiếp. Giải quyết chủ yếu áp dụng cho 7 loại tham chiếu biểu tượng: lớp hoặc giao diện, trường, phương thức lớp, phương thức giao diện, kiểu phương thức, xử lý phương thức và bộ giới hạn điểm gọi.</p><ul><li><strong>Tham chiếu biểu tượng (Symbolic References)</strong> - Tham chiếu biểu tượng mô tả một tập hợp các biểu tượng tham chiếu và được sử dụng để chỉ định mục tiêu tham chiếu.</li><li><strong>Tham chiếu trực tiếp (Direct References)</strong> - Tham chiếu trực tiếp có thể là con trỏ trực tiếp đến mục tiêu, địa chỉ tương đối hoặc một con trỏ có thể xác định mục tiêu một cách gián tiếp.</li></ul><h3 id="_5-khoi-tao" tabindex="-1"><a class="header-anchor" href="#_5-khoi-tao"><span>(5) Khởi tạo</span></a></h3><p>Trong mã Java, nếu muốn khởi tạo một trường tĩnh, bạn có thể gán giá trị trực tiếp khi khai báo hoặc gán giá trị trong khối mã tĩnh.</p><p>Nếu trường tĩnh được gán giá trị trực tiếp và được đánh dấu là <code>final</code>, và kiểu dữ liệu của nó là kiểu cơ bản hoặc chuỗi, thì trường này sẽ được trình biên dịch Java đánh dấu là giá trị hằng số (ConstantValue) và quá trình khởi tạo sẽ được JVM thực hiện. Ngoài ra, các phép gán trực tiếp khác và tất cả các khối mã tĩnh sẽ được trình biên dịch Java đặt trong một phương thức duy nhất và đặt tên là <code>&lt;clinit&gt;</code>.</p><p>Khởi tạo là giai đoạn thực sự thực hiện mã chương trình được định nghĩa trong lớp. <strong>Khởi tạo, gán giá trị ban đầu chính xác cho biến lớp, JVM chịu trách nhiệm khởi tạo lớp, chủ yếu là khởi tạo biến lớp</strong>.</p><h4 id="cach-khoi-tao-lop" tabindex="-1"><a class="header-anchor" href="#cach-khoi-tao-lop"><span>Cách khởi tạo lớp</span></a></h4><ul><li>Gán giá trị ban đầu khi khai báo biến lớp.</li><li>Sử dụng khối mã tĩnh để gán giá trị cho biến lớp.</li></ul><blockquote><p>Trong giai đoạn chuẩn bị, biến lớp đã được gán giá trị theo yêu cầu của hệ thống, trong khi trong giai đoạn khởi tạo, biến lớp và các nguồn tài nguyên khác sẽ được khởi tạo theo kế hoạch chủ quan được quy định bởi lập trình viên thông qua chương trình.</p></blockquote><h4 id="buoc-khoi-tao-lop" tabindex="-1"><a class="header-anchor" href="#buoc-khoi-tao-lop"><span>Bước khởi tạo lớp</span></a></h4><ol><li>Nếu lớp chưa được tải và liên kết, bắt đầu tải lớp này.</li><li>Nếu lớp cha của lớp này chưa được khởi tạo, hãy khởi tạo lớp cha trước.</li><li>Nếu lớp này có câu lệnh khởi tạo, hãy thực hiện các câu lệnh khởi tạo này theo thứ tự.</li></ol><h4 id="thoi-điem-khoi-tao-lop" tabindex="-1"><a class="header-anchor" href="#thoi-điem-khoi-tao-lop"><span>Thời điểm khởi tạo lớp</span></a></h4><p>Chỉ khi lớp được chủ động tham chiếu mới gây ra việc khởi tạo lớp.</p><p><strong>(1) Tham chiếu chủ động</strong></p><p>Tham chiếu chủ động của lớp bao gồm sáu trường hợp sau:</p><ul><li><strong>Tạo một phiên bản của lớp</strong> - cũng là <code>new</code> đối tượng</li><li><strong>Truy cập biến tĩnh</strong> - truy cập biến tĩnh của một lớp hoặc giao diện hoặc gán giá trị cho biến tĩnh đó</li><li><strong>Truy cập phương thức tĩnh</strong></li><li><strong>Phản chiếu</strong> - như <code>Class.forName(&quot;com.shengsiyuan.Test&quot;)</code></li><li><strong>Khởi tạo lớp con</strong> - khởi tạo một lớp con của một lớp, lớp cha cũng sẽ được khởi tạo</li><li><strong>Lớp khởi động</strong> - lớp được đánh dấu là lớp khởi động của máy ảo Java (Java Test), được sử dụng trực tiếp bằng cách sử dụng lệnh <code>java.exe</code> để chạy một lớp chính</li></ul><p><strong>(2) Tham chiếu bị động</strong></p><p>Ngoài sáu trường hợp trên, tất cả các cách tham chiếu lớp khác đều không gây ra việc khởi tạo lớp, được gọi là tham chiếu bị động. Ví dụ về tham chiếu bị động bao gồm:</p><ul><li><strong>Tham chiếu trường của lớp cha bằng lớp con, không gây ra việc khởi tạo lớp con</strong>。</li></ul><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">SubClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> // value là trường được định nghĩa trong SuperClass</span></span></code></pre></div><ul><li><strong>Tham chiếu lớp thông qua mảng, không gây ra việc khởi tạo lớp</strong>。Quá trình này sẽ khởi tạo lớp mảng, lớp mảng là một lớp con của <code>Object</code> được tạo tự động bởi máy ảo, nó chứa các thuộc tính và phương thức của mảng.</li></ul><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">SuperClass</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[] sca </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> SuperClass</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#E06C75;--shiki-dark:#E06C75;">]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li>Hằng số được lưu trong bộ nhớ hằng số của lớp gọi, không gây ra việc khởi tạo lớp gọi。</li></ul><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ConstClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">HELLOWORLD</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><h4 id="chi-tiet-khoi-tao-lop" tabindex="-1"><a class="header-anchor" href="#chi-tiet-khoi-tao-lop"><span>Chi tiết khởi tạo lớp</span></a></h4><p>Phương thức <code>&lt;clinit&gt;()</code> của lớp có các chi tiết sau:</p><ul><li>Được tự động thu thập bởi trình biên dịch các hoạt động gán giá trị cho tất cả các biến lớp và các câu lệnh trong khối mã tĩnh (<code>static {}</code>) thành một phương thức, trình biên dịch thu thập theo thứ tự xuất hiện trong tệp nguồn. Đặc biệt cần lưu ý rằng khối mã tĩnh chỉ có thể truy cập các biến lớp được định nghĩa trước nó, các biến lớp được định nghĩa sau nó chỉ có thể được gán giá trị, không thể truy cập. Ví dụ mã sau:</li></ul><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Test</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                // Gán giá trị cho biến có thể biên dịch thành công</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">print</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(i);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">  // Dòng này sẽ báo lỗi &quot;illegal forward reference&quot; từ trình biên dịch</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Khác với phương thức khởi tạo (<code>&lt;init&gt;()</code>), không cần gọi rõ ràng phương thức khởi tạo của lớp cha. Máy ảo sẽ đảm bảo rằng phương thức <code>&lt;clinit&gt;()</code> của lớp cha đã kết thúc trước khi phương thức <code>&lt;clinit&gt;()</code> của lớp con bắt đầu. Do đó, lớp đầu tiên thực hiện phương thức <code>&lt;clinit&gt;()</code> là lớp <code>java.lang.Object</code>.</li><li>Vì phương thức khởi tạo <code>&lt;clinit&gt;()</code> chỉ được thực hiện một lần, nên lớp không cần phải gọi phương thức khởi tạo của lớp cha. Ví dụ mã sau:</li></ul><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> A </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        A </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Sub</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> B </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> A</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[] args) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">     System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Sub</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">B</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">  // Kết quả in ra là giá trị của biến A trong lớp cha, tức là 2.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><ul><li>Phương thức <code>&lt;clinit&gt;()</code> không bắt buộc cho các lớp hoặc giao diện, nếu một lớp không chứa khối mã tĩnh, cũng không có gán giá trị cho biến lớp, trình biên dịch có thể không tạo phương thức <code>&lt;clinit&gt;()</code>.</li><li>Giao diện không thể sử dụng khối mã tĩnh, nhưng vẫn có khởi tạo biến lớp, do đó, giao diện và lớp giải quyết trong quá trình khởi tạo không cần phải thực hiện phương thức <code>&lt;clinit&gt;()</code> của giao diện. Ngoài ra, các lớp thực hiện giao diện cũng không thực hiện phương thức <code>&lt;clinit&gt;()</code> của giao diện.</li><li>Máy ảo sẽ đảm bảo rằng phương thức <code>&lt;clinit&gt;()</code> của một lớp được khóa và đồng bộ đúng trong môi trường đa luồng. Nếu nhiều luồng cùng khởi tạo một lớp, chỉ có một luồng thực hiện phương thức <code>&lt;clinit&gt;()</code>, các luồng khác sẽ bị chặn và chờ đợi cho đến khi luồng hoạt động hoàn tất phương thức <code>&lt;clinit&gt;()</code>. Nếu có một hoạt động tốn thời gian trong phương thức <code>&lt;clinit&gt;()</code>, nó có thể gây ra nhiều luồng bị chặn trong quá trình thực hiện thực tế này.</li></ul><h1 id="classloader" tabindex="-1"><a class="header-anchor" href="#classloader"><span>ClassLoader</span></a></h1><p><code>ClassLoader</code> là một lớp trong JVM (Java Virtual Machine) có trách nhiệm tải các lớp vào JVM. Nó cho phép ứng dụng tự quyết định cách để lấy các lớp cần thiết.</p><p>JVM tải các file <code>class</code> vào bộ nhớ theo hai cách:</p><ul><li>Tải ẩn - JVM tự động tải các lớp cần thiết vào bộ nhớ.</li><li>Tải hiển thị - Sử dụng <code>ClassLoader</code> để tải một lớp vào bộ nhớ.</li></ul><h3 id="class-va-classloader" tabindex="-1"><a class="header-anchor" href="#class-va-classloader"><span>Class và ClassLoader</span></a></h3><p>Cách xác định hai lớp có giống nhau hay không: Lớp chính là như nhau và được tải bởi cùng một <code>ClassLoader</code>. Điều này có nghĩa là lớp được tải bởi cùng một <code>ClassLoader</code> và có thể được coi là giống nhau.</p><p>Sự giống nhau bao gồm việc sử dụng phương thức <code>equals()</code> của đối tượng <code>Class</code> và phương thức <code>isAssignableFrom()</code> và <code>isInstance()</code> trả về true, cũng như sử dụng từ khóa <code>instanceof</code> để kiểm tra quan hệ sở hữu đối tượng.</p><h3 id="phan-loai-classloader" tabindex="-1"><a class="header-anchor" href="#phan-loai-classloader"><span>Phân loại ClassLoader</span></a></h3><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230719172338.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h4 id="bootstrap-classloader" tabindex="-1"><a class="header-anchor" href="#bootstrap-classloader"><span>Bootstrap ClassLoader</span></a></h4><p><code>Bootstrap ClassLoader</code> là ClassLoader khởi động, nó <strong>chịu trách nhiệm tải các lớp cần thiết cho JVM</strong>.</p><p><code>Bootstrap ClassLoader</code> sẽ tải các thư viện lớp được lưu trữ trong thư mục <code>&lt;JAVA_HOME&gt;\lib</code> hoặc được chỉ định bởi tham số <code>-Xbootclasspath</code> và chỉ tải các thư viện lớp mà JVM nhận dạng (dựa trên tên tệp, ví dụ: rt.jar, các tệp không phù hợp với tên sẽ không được tải).</p><p><code>Bootstrap ClassLoader</code> được triển khai bằng C++, nó hoàn toàn được JVM kiểm soát và không thể được tham chiếu trực tiếp bởi chương trình Java. Khi viết ClassLoader tùy chỉnh, nếu bạn muốn gửi yêu cầu tải đến <code>Bootstrap ClassLoader</code>, bạn có thể sử dụng <code>null</code> thay thế.</p><h4 id="extclassloader" tabindex="-1"><a class="header-anchor" href="#extclassloader"><span>ExtClassLoader</span></a></h4><p><code>ExtClassLoader</code> là ClassLoader mở rộng, nó được triển khai bởi <code>ExtClassLoader(sun.misc.Launcher\$ExtClassLoader)</code>.</p><p><code>ExtClassLoader</code> chịu trách nhiệm tải các thư viện lớp từ thư mục <code>&lt;JAVA_HOME&gt;\lib\ext</code> hoặc được chỉ định bởi biến môi trường <code>java.ext.dir</code> của hệ thống.</p><h4 id="appclassloader" tabindex="-1"><a class="header-anchor" href="#appclassloader"><span>AppClassLoader</span></a></h4><p><code>AppClassLoader</code> là ClassLoader ứng dụng, nó được triển khai bởi <code>AppClassLoader(sun.misc.Launcher\$AppClassLoader)</code>. Vì vậy, <code>AppClassLoader</code> là giá trị trả về của phương thức <code>getSystemClassLoader()</code> trong lớp <code>ClassLoader</code> và thường được gọi là ClassLoader hệ thống.</p><p><code>AppClassLoader</code> chịu trách nhiệm tải các thư viện lớp từ đường dẫn của lớp người dùng (classpath). Nếu không có ClassLoader tùy chỉnh trong ứng dụng, <code>AppClassLoader</code> thường là ClassLoader mặc định trong chương trình.</p><h4 id="classloader-tuy-chinh" tabindex="-1"><a class="header-anchor" href="#classloader-tuy-chinh"><span>ClassLoader tùy chỉnh</span></a></h4><p>ClassLoader tùy chỉnh có thể thực hiện các nhiệm vụ sau:</p><ul><li>Tự động xác minh chữ ký số trước khi thực thi mã không đáng tin cậy.</li><li>Tạo động các lớp xây dựng tùy chỉnh phù hợp với nhu cầu cụ thể của người dùng.</li><li>Lấy lớp Java từ một vị trí cụ thể, chẳng hạn như cơ sở dữ liệu hoặc mạng.</li></ul><p>Giả sử chúng ta muốn tạo một ClassLoader tùy chỉnh có tên là <code>FileSystemClassLoader</code> kế thừa từ <code>java.lang.ClassLoader</code>, được sử dụng để tải các lớp từ hệ thống tệp. Đầu tiên, nó sẽ tìm kiếm tệp mã byte của lớp dựa trên tên đầy đủ của lớp trên hệ thống tệp, sau đó đọc nội dung của tệp, cuối cùng sử dụng phương thức <code>defineClass()</code> để chuyển đổi các mã byte này thành một đối tượng <code>java.lang.Class</code>.</p><p>Phương thức <code>loadClass()</code> của lớp <code>java.lang.ClassLoader</code> thực hiện logic của mô hình giao nhận cha đôi, do đó ClassLoader tùy chỉnh thường không ghi đè phương thức này, mà thay vào đó ghi đè phương thức <code>findClass()</code>.</p><p>ClassLoader thường được sử dụng trong các tình huống sau:</p><ul><li>Container - Ứng dụng điển hình: Servlet container (ví dụ: Tomcat, Jetty), udf (Mysql, Hive) và nhiều hơn nữa. Tải và giải nén tệp JAR hoặc WAR, sau đó tải các lớp của nó vào ClassLoader cụ thể để chạy (thường cần xem xét cách cô lập không gian).</li><li>Triển khai nóng (Hot Deploy), cắm nóng (Hot Plug) - Khởi động ứng dụng và sau đó động lấy thông tin về một lớp, sau đó tải nó vào JVM. Nhiều phần mềm, framework nổi tiếng, khung (ví dụ: Spring) sử dụng ClassLoader để triển khai nóng của chính nó.</li></ul><p>【Ví dụ】Tạo một ClassLoader tùy chỉnh</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> FileSystemClassLoader</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ClassLoader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> rootDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> FileSystemClassLoader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> rootDir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">rootDir</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> rootDir;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    protected</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">?</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> findClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ClassNotFoundException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        byte</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;">classData</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getClassData</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(name);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (classData </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            throw</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ClassNotFoundException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">else</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> defineClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(name, classData, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">classData</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> byte</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">[] getClassData</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> className</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> path</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> classNameToPath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(className);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            InputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> ins</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> FileInputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(path);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            ByteArrayOutputStream</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> baos</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ByteArrayOutputStream</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> bufferSize</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 4096</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            byte</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;">buffer</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> byte</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[bufferSize];</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> bytesNumRead</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ((bytesNumRead </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ins</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">read</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(buffer)) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                baos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">write</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(buffer, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, bytesNumRead);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> baos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toByteArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">IOException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> classNameToPath</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> className</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> rootDir </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> File</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">separatorChar</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">                +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> className</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">replace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;.&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">File</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">separatorChar</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;.class&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="delegation-model" tabindex="-1"><a class="header-anchor" href="#delegation-model"><span>Delegation Model</span></a></h3><p>Trước khi hiểu về Delegation Model, hãy xem một ví dụ.</p><p>【Ví dụ】Tìm kiếm lớp tải</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[] args) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    ClassLoader</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> loader </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getContextClassLoader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(loader);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">loader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getParent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">loader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getParent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getParent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>Kết quả:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>sun.misc.Launcher$AppClassLoader@18b4aac2</span></span>
<span class="line"><span>sun.misc.Launcher$ExtClassLoader@19e1023e</span></span>
<span class="line"><span>null</span></span></code></pre></div><p>Kết quả trên cho thấy không có <code>ExtClassLoader</code> cha, nguyên nhân là <code>Bootstrap Loader</code> (lớp tải khởi động) được triển khai bằng C, không tìm thấy cách trả về chính xác của cha Loader, do đó trả về null.</p><p>Hình ảnh dưới đây hiển thị mối quan hệ giữa các ClassLoader, được gọi là Delegation Model của ClassLoader. <strong>Delegation Model yêu cầu tất cả các ClassLoader, ngoại trừ Bootstrap ClassLoader, đều có một ClassLoader cha của riêng mình</strong>. <strong>Mối quan hệ cha con giữa các ClassLoader thường được thực hiện thông qua mối quan hệ hợp thành (Composition), chứ không phải thông qua mối quan hệ kế thừa (Inheritance)</strong>.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230719172838.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p><strong>（1）Quá trình làm việc</strong></p><p><strong>Một ClassLoader trước tiên sẽ chuyển yêu cầu tải lớp đến ClassLoader cha, chỉ khi ClassLoader cha không thể hoàn thành yêu cầu tải lớp thì nó mới thử tải</strong>.</p><p><strong>（2）Lợi ích</strong></p><p><strong>Làm cho các lớp Java có một mối quan hệ phân cấp ưu tiên với ClassLoader của chúng</strong>, từ đó đảm bảo tính thống nhất của các lớp cơ bản:</p><ul><li>Ngăn chặn việc xuất hiện nhiều bản sao của bytecode cùng một lớp trong bộ nhớ</li><li>Đảm bảo chương trình Java chạy một cách an toàn và ổn định</li></ul><p>Ví dụ: <code>java.lang.Object</code> được lưu trữ trong rt.jar, nếu viết một lớp khác <code>java.lang.Object</code> và đặt nó trong <code>classpath</code>, chương trình vẫn có thể biên dịch thành công. Bởi vì sự tồn tại của mô hình ủy quyền cha mẹ, nên <code>Object</code> trong rt.jar có độ ưu tiên cao hơn <code>Object</code> trong <code>classpath</code>, vì <code>Object</code> trong rt.jar sử dụng ClassLoader khởi động, trong khi <code>Object</code> trong <code>classpath</code> sử dụng ClassLoader của ứng dụng. Chính vì <code>Object</code> trong rt.jar có độ ưu tiên cao hơn, nên tất cả các <code>Object</code> trong chương trình đều là <code>Object</code> này.</p><p><strong>（3）Thực hiện</strong></p><p>Dưới đây là đoạn mã trích dẫn của lớp trừu tượng <code>java.lang.ClassLoader</code>, quá trình chạy phương thức <code>loadClass()</code> như sau:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> abstract</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ClassLoader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // ClassLoader cha để ủy quyền</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ClassLoader</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">?</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> loadClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ClassNotFoundException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> loadClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(name, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    protected</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">?</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> loadClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> resolve</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ClassNotFoundException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        synchronized</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getClassLoadingLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(name)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Kiểm tra xem lớp đã được tải chưa</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">?</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">c</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> findLoadedClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(name);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (c </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                // Nếu chưa được tải, ủy quyền cho ClassLoader cha hoặc ủy quyền cho ClassLoader khởi động</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                    if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (parent </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                        // Nếu có ClassLoader cha, ủy quyền cho ClassLoader cha tải</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                        c </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> parent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">loadClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(name, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">else</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                        // Nếu không có ClassLoader cha, kiểm tra xem lớp có được tải bởi ClassLoader khởi động không, bằng cách gọi phương thức native Class findBootstrapClass(String name)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                        c </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> findBootstrapClassOrNull</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(name);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ClassNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                    // Nếu ClassLoader cha không tải được, ném ClassNotFoundException</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (c </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                    // Nếu cả ClassLoader cha và ClassLoader khởi động đều không thể hoàn thành nhiệm vụ tải, thì tự tải lớp</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    c </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> findClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(name);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (resolve) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                resolveClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(c);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> c;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    protected</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">?</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> findClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ClassNotFoundException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        throw</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ClassNotFoundException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(name);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>【Giải thích】</p><ul><li>Kiểm tra xem lớp đã được tải chưa, nếu chưa thì cho phép ClassLoader cha tải.</li><li>Khi ClassLoader cha không thể tải được, ném ra <code>ClassNotFoundException</code>, lúc này thử tải bằng chính ClassLoader của mình.</li></ul><h3 id="tham-so-classloader" tabindex="-1"><a class="header-anchor" href="#tham-so-classloader"><span>Tham số ClassLoader</span></a></h3><p>Khi khởi động ứng dụng Java trên môi trường sản xuất, thường sẽ chỉ định một số tham số ClassLoader để tải các thư viện cần thiết cho ứng dụng:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">java</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -jar</span><span style="color:#98C379;--shiki-dark:#98C379;"> xxx.jar</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -classpath</span><span style="color:#98C379;--shiki-dark:#98C379;"> lib/</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">*</span></span></code></pre></div><p>Các tùy chọn tham số ClassLoader liên quan:</p><table><thead><tr><th>Tùy chọn tham số</th><th>Loại ClassLoader</th><th>Giải thích</th></tr></thead><tbody><tr><td><code>-Xbootclasspath</code></td><td><code>Bootstrap ClassLoader</code></td><td>Thiết lập đường dẫn tìm kiếm của <code>Bootstrap ClassLoader</code>.【Ít sử dụng】</td></tr><tr><td><code>-Xbootclasspath/a</code></td><td><code>Bootstrap ClassLoader</code></td><td>Thêm đường dẫn vào cuối danh sách tìm kiếm của <code>Bootstrap ClassLoader</code>.【Thường sử dụng】</td></tr><tr><td><code>-Xbootclasspath/p</code></td><td><code>Bootstrap ClassLoader</code></td><td>Thêm đường dẫn vào đầu danh sách tìm kiếm của <code>Bootstrap ClassLoader</code>.【Ít sử dụng】</td></tr><tr><td><code>-Djava.ext.dirs</code></td><td><code>ExtClassLoader</code></td><td>Thiết lập đường dẫn tìm kiếm của <code>ExtClassLoader</code>.</td></tr><tr><td><code>-Djava.class.path</code> hoặc <code>-cp</code> hoặc <code>-classpath</code></td><td><code>AppClassLoader</code></td><td>Thiết lập đường dẫn tìm kiếm của <code>AppClassLoader</code>.</td></tr></tbody></table><h2 id="tai-lop" tabindex="-1"><a class="header-anchor" href="#tai-lop"><span>Tải lớp</span></a></h2><h3 id="cach-tai-lop" tabindex="-1"><a class="header-anchor" href="#cach-tai-lop"><span>Cách tải lớp</span></a></h3><p>Có ba cách để tải lớp:</p><ul><li>Khi khởi động ứng dụng từ dòng lệnh, JVM sẽ tải lớp theo cách khởi tạo.</li><li>Tải lớp động bằng phương thức <code>Class.forName()</code>.</li><li>Tải lớp động bằng phương thức <code>ClassLoader.loadClass()</code>.</li></ul><p><strong>Sự khác biệt giữa <code>Class.forName()</code> và <code>ClassLoader.loadClass()</code></strong></p><ul><li><code>Class.forName()</code> không chỉ tải file <code>.class</code> vào JVM, mà còn giải thích và thực thi các khối <code>static</code> trong lớp.</li><li><code>ClassLoader.loadClass()</code> chỉ tải file <code>.class</code> vào JVM mà không thực thi nội dung của khối <code>static</code>, chỉ khi gọi <code>newInstance()</code> mới thực thi khối <code>static</code>.</li><li><code>Class.forName(name, initialize, loader)</code> có thể điều khiển việc tải khối <code>static</code>. Chỉ khi gọi <code>newInstance()</code> mới gọi hàm khởi tạo và tạo đối tượng của lớp.</li></ul><h3 id="loi-tai-lop" tabindex="-1"><a class="header-anchor" href="#loi-tai-lop"><span>Lỗi tải lớp</span></a></h3><h4 id="classnotfoundexception" tabindex="-1"><a class="header-anchor" href="#classnotfoundexception"><span>ClassNotFoundException</span></a></h4><p><code>ClassNotFoundException</code> là một lỗi phổ biến. <strong><code>ClassNotFoundException</code> đại diện cho việc không tìm thấy lớp cụ thể trong <code>classpath</code></strong>.</p><p>Nguyên nhân phổ biến:</p><ul><li>Gọi phương thức <code>forName()</code> của lớp <code>Class</code>, không tìm thấy lớp.</li><li>Gọi phương thức <code>loadClass()</code> của <code>ClassLoader</code>, không tìm thấy lớp.</li><li>Gọi phương thức <code>findSystemClass()</code> của <code>ClassLoader</code>, không tìm thấy lớp.</li></ul><p>【Ví dụ】Chạy đoạn mã sau sẽ ném ra ngoại lệ <code>ClassNotFoundException</code>:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ClassNotFoundExceptionDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">forName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;NotFound&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ClassNotFoundException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Cách khắc phục: Kiểm tra xem lớp có tồn tại trong <code>classpath</code> không.</p><h4 id="noclassdeffounderror" tabindex="-1"><a class="header-anchor" href="#noclassdeffounderror"><span>NoClassDefFoundError</span></a></h4><p>Nguyên nhân phổ biến:</p><ul><li>Lớp phụ thuộc không tồn tại.</li><li>Tệp lớp tồn tại, nhưng nằm trong các lĩnh vực khác nhau.</li></ul><p>Cách khắc phục: Trong dự án Java hiện đại, thường sử dụng các công cụ xây dựng như <code>maven</code>, <code>gradle</code> để quản lý dự án, hãy kiểm tra xem tệp lớp không tìm thấy nằm trong gói jar đã được thêm làm phụ thuộc hay chưa.</p><h4 id="unsatisfiedlinkerror" tabindex="-1"><a class="header-anchor" href="#unsatisfiedlinkerror"><span>UnsatisfiedLinkError</span></a></h4><p>Lỗi này không phổ biến, nhưng nếu xảy ra, thường là do xóa một thư viện trong JVM khi khởi động JVM.</p><p>【Ví dụ】Chạy đoạn mã sau sẽ ném ra lỗi <code>UnsatisfiedLinkError</code>.</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> UnsatisfiedLinkErrorDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> native</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> nativeMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">loadLibrary</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;NoLib&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> UnsatisfiedLinkErrorDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nativeMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>【Kết quả】</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">UnsatisfiedLinkError</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> no </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">NoLib</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> in </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">library</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">path</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ClassLoader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">loadLibrary</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ClassLoader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1867</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Runtime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">loadLibrary0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Runtime</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">870</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">loadLibrary</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1122</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">com</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">hnv99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">javacore</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">jvm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">classloader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">UnsatisfiedLinkErrorDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">clinit</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">UnsatisfiedLinkErrorDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">12</span><span style="color:#E06C75;--shiki-dark:#E06C75;">)</span></span></code></pre></div><h4 id="classcastexception" tabindex="-1"><a class="header-anchor" href="#classcastexception"><span>ClassCastException</span></a></h4><p><code>ClassCastException</code> thường xảy ra khi ép kiểu tường minh trong chương trình không thành công.</p><p>【Ví dụ】Chạy đoạn mã sau sẽ ném ra ngoại lệ <code>ClassCastException</code>.</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ClassCastExceptionDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Object</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> obj</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Object</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        EmptyClass</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> newObj</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (EmptyClass) obj;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> EmptyClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>【Kết quả】</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> in thread </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;main&quot;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ClassCastException</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cannot be cast to </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">com</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">hnv99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">javacore</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">jvm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">classloader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ClassCastExceptionDemo$EmptyClass</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">com</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">hnv99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">javacore</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">jvm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">classloader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ClassCastExceptionDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ClassCastExceptionDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">11</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/programming/java/JVM/JVM Class Loader.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/programming/java/JVM/JVM%20Architecture.html" aria-label="JVM Architecture"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->JVM Architecture</div></a><a class="route-link auto-link next" href="/programming/java/JVM/JVM%20Command%20Line%20Tools.html" aria-label="JVM Command Line Tools"><div class="hint">Next<span class="arrow end"></span></div><div class="link">JVM Command Line Tools<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with ❤️ by Hung Nguyen</div><div class="copyright">Copyright © 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-B-Bgbu6w.js" defer></script>
  </body>
</html>
