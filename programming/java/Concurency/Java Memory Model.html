<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.46" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/programming/java/Concurency/Java%20Memory%20Model.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="Java Memory Model"><meta property="og:description" content="MÃ´ hÃ¬nh bá»™ nhá»› Java Keyword: JMM, volatile, synchronized, final, Happens-Before, barrier TÃ³m táº¯t: MÃ´ hÃ¬nh bá»™ nhá»› Java (Java Memory Model), viáº¿t táº¯t lÃ  JMM. Má»¥c tiÃªu cá»§a mÃ´ hÃ¬nh ..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/vanhung4499/images/master/snap/CPU%20Memory%20Model.png"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-06-28T15:54:38.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:tag" content="java"><meta property="article:tag" content="javase"><meta property="article:tag" content="concurrency"><meta property="article:modified_time" content="2024-06-28T15:54:38.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Java Memory Model","image":["https://raw.githubusercontent.com/vanhung4499/images/master/snap/CPU%20Memory%20Model.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/CodeReorderingOptimize.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/CodeRefactorOptMulti.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/jmam.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/jmm.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/jmman.png"],"dateModified":"2024-06-28T15:54:38.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>Java Memory Model | VanHung4499</title><meta name="description" content="MÃ´ hÃ¬nh bá»™ nhá»› Java Keyword: JMM, volatile, synchronized, final, Happens-Before, barrier TÃ³m táº¯t: MÃ´ hÃ¬nh bá»™ nhá»› Java (Java Memory Model), viáº¿t táº¯t lÃ  JMM. Má»¥c tiÃªu cá»§a mÃ´ hÃ¬nh ...">
    <link rel="preload" href="/assets/style-BqjKxtxe.css" as="style"><link rel="stylesheet" href="/assets/style-BqjKxtxe.css">
    <link rel="modulepreload" href="/assets/app-BsgpqssW.js"><link rel="modulepreload" href="/assets/Java Memory Model.html-Bvc6_LaK.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/project/" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon><!--]-->Project<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Advanced</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Basic</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/programming/java/collection/" aria-label="Collection"><!---->Collection<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Concurency</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Atomic%20Class.html" aria-label="Java Atomic Class"><!---->Java Atomic Class<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Concurent%20Tools.html" aria-label="Java Concurent Tools"><!---->Java Concurent Tools<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Concurrency%20Core%20Mechanism.html" aria-label="Java Concurrency Core Mechanism"><!---->Java Concurrency Core Mechanism<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Concurrency%20Intro.html" aria-label="Java Concurrency Intro"><!---->Java Concurrency Intro<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Concurrent%20Collection.html" aria-label="Java Concurrent Collection"><!---->Java Concurrent Collection<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20ForkJoin.html" aria-label="Java ForkJoin"><!---->Java ForkJoin<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Lock.html" aria-label="Java Lock"><!---->Java Lock<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/programming/java/Concurency/Java%20Memory%20Model.html" aria-label="Java Memory Model"><!---->Java Memory Model<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Thread%20Basic.html" aria-label="Java Thread Basic"><!---->Java Thread Basic<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Thread%20Pool.html" aria-label="Java Thread Pool"><!---->Java Thread Pool<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">IO</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/JavaSE%20MOC.html" aria-label="JavaSE MOC"><!---->JavaSE MOC<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">JVM</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Java Memory Model</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing DateğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-28T15:54:38.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 25 min</span><meta property="timeRequired" content="PT25M"></span><span class="page-category-info" aria-label="CategoryğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color8 clickable" role="navigation">java</span><span class="page-category-item color1 clickable" role="navigation">javase</span><span class="page-category-item color5 clickable" role="navigation">concurrency</span><!--]--><meta property="articleSection" content="java,javase,concurrency"></span><span class="page-tag-info" aria-label="TagğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">java</span><span class="page-tag-item color1 clickable" role="navigation">javase</span><span class="page-tag-item color5 clickable" role="navigation">concurrency</span><!--]--><meta property="keywords" content="java,javase,concurrency"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#mo-hinh-bo-nho-vat-ly">MÃ´ hÃ¬nh bá»™ nhá»› váº­t lÃ½</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#hieu-suat-xu-ly-phan-cung">Hiá»‡u suáº¥t xá»­ lÃ½ pháº§n cá»©ng</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#Ä‘ong-nhat-bo-nho-cache">Äá»“ng nháº¥t bá»™ nhá»› cache</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#toi-uu-hoa-thuc-thi-ma-khong-tuan-thu-thu-tu">Tá»‘i Æ°u hÃ³a thá»±c thi mÃ£ khÃ´ng tuÃ¢n thá»§ thá»© tá»±</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#mo-hinh-bo-nho-java-1">MÃ´ hÃ¬nh bá»™ nhá»› Java</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#bo-nho-chinh-va-bo-nho-lam-viec">Bá»™ nhá»› chÃ­nh vÃ  bá»™ nhá»› lÃ m viá»‡c</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#van-Ä‘e-ve-thao-tac-bo-nho-trong-jmm">Váº¥n Ä‘á» vá» thao tÃ¡c bá»™ nhá»› trong JMM</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#thao-tac-giao-tiep-giua-bo-nho">Thao tÃ¡c giao tiáº¿p giá»¯a bá»™ nhá»›</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tinh-an-toan-Ä‘ong-thoi">TÃ­nh an toÃ n Ä‘á»“ng thá»i</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#happens-before">Happens-Before</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#rao-can-bo-nho-memory-barrier">RÃ o cáº£n bá»™ nhá»› (Memory Barrier)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#volatile">volatile</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#synchronized">synchronized</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#quy-tac-Ä‘ac-biet-cho-bien-kieu-long-va-double">Quy táº¯c Ä‘áº·c biá»‡t cho biáº¿n kiá»ƒu long vÃ  double</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#quy-tac-Ä‘ac-biet-cho-bien-final">Quy táº¯c Ä‘áº·c biá»‡t cho biáº¿n final</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="mo-hinh-bo-nho-java" tabindex="-1"><a class="header-anchor" href="#mo-hinh-bo-nho-java"><span>MÃ´ hÃ¬nh bá»™ nhá»› Java</span></a></h1><blockquote><p><strong>Keyword</strong>: <code>JMM</code>, <code>volatile</code>, <code>synchronized</code>, <code>final</code>, <code>Happens-Before</code>, <code>barrier</code></p><p><strong>TÃ³m táº¯t</strong>: MÃ´ hÃ¬nh bá»™ nhá»› Java (Java Memory Model), viáº¿t táº¯t lÃ  JMM. Má»¥c tiÃªu cá»§a mÃ´ hÃ¬nh bá»™ nhá»› Java lÃ  giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» vá» an toÃ n Ä‘á»“ng thá»i do kháº£ nÄƒng nhÃ¬n tháº¥y vÃ  thá»© tá»± gÃ¢y ra. MÃ´ hÃ¬nh bá»™ nhá»› Java giÃºp áº©n Ä‘i sá»± khÃ¡c biá»‡t trong viá»‡c truy cáº­p bá»™ nhá»› giá»¯a cÃ¡c pháº§n cá»©ng vÃ  há»‡ Ä‘iá»u hÃ nh, Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c hiá»‡u suáº¥t truy cáº­p bá»™ nhá»› nháº¥t quÃ¡n cho chÆ°Æ¡ng trÃ¬nh Java trÃªn cÃ¡c ná»n táº£ng khÃ¡c nhau.</p></blockquote><h2 id="mo-hinh-bo-nho-vat-ly" tabindex="-1"><a class="header-anchor" href="#mo-hinh-bo-nho-vat-ly"><span>MÃ´ hÃ¬nh bá»™ nhá»› váº­t lÃ½</span></a></h2><p>Váº¥n Ä‘á» Ä‘á»“ng thá»i mÃ  mÃ¡y váº­t lÃ½ gáº·p pháº£i cÃ³ nhiá»u Ä‘iá»ƒm tÆ°Æ¡ng Ä‘á»“ng vá»›i trÆ°á»ng há»£p trong mÃ¡y áº£o, vÃ  cÃ¡ch xá»­ lÃ½ Ä‘á»“ng thá»i cá»§a mÃ¡y váº­t lÃ½ cÅ©ng cÃ³ Ã½ nghÄ©a tham kháº£o quan trá»ng cho viá»‡c triá»ƒn khai cá»§a mÃ¡y áº£o.</p><h3 id="hieu-suat-xu-ly-phan-cung" tabindex="-1"><a class="header-anchor" href="#hieu-suat-xu-ly-phan-cung"><span>Hiá»‡u suáº¥t xá»­ lÃ½ pháº§n cá»©ng</span></a></h3><p>Váº¥n Ä‘á» Ä‘áº§u tiÃªn cá»§a bá»™ nhá»› váº­t lÃ½ lÃ  hiá»‡u suáº¥t xá»­ lÃ½ cá»§a pháº§n cá»©ng.</p><ul><li>Háº§u háº¿t cÃ¡c tÃ¡c vá»¥ tÃ­nh toÃ¡n khÃ´ng thá»ƒ chá»‰ dá»±a vÃ o &quot;tÃ­nh toÃ¡n&quot; cá»§a bá»™ xá»­ lÃ½ Ä‘á»ƒ hoÃ n thÃ nh, Ã­t nháº¥t lÃ  bá»™ xá»­ lÃ½ cáº§n tÆ°Æ¡ng tÃ¡c <strong>vá»›i bá»™ nhá»›</strong>, cháº³ng háº¡n nhÆ° Ä‘á»c dá»¯ liá»‡u tÃ­nh toÃ¡n, ghi káº¿t quáº£ tÃ­nh toÃ¡n. Hoáº¡t Ä‘á»™ng I/O nÃ y ráº¥t khÃ³ loáº¡i bá» (khÃ´ng thá»ƒ chá»‰ dá»±a vÃ o thanh ghi Ä‘á»ƒ hoÃ n thÃ nh táº¥t cáº£ cÃ¡c nhiá»‡m vá»¥ tÃ­nh toÃ¡n).</li><li><strong>Do sá»± chÃªnh lá»‡ch giá»¯a thiáº¿t bá»‹ lÆ°u trá»¯ vÃ  tá»‘c Ä‘á»™ tÃ­nh toÃ¡n cá»§a bá»™ xá»­ lÃ­</strong> , mÃ¢u thuáº«n nÃ y trong tá»‘c Ä‘á»™ Ä‘Ã£ giáº£m hiá»‡u suáº¥t xá»­ lÃ­ pháº§n cá»©ng. VÃ¬ váº­y, mÃ¡y tÃ­nh hiá»‡n Ä‘áº¡i Ä‘Ã£ pháº£i <strong>thÃªm bá»™ nhá»› cache (Cache) lÃ m bá»™ Ä‘á»‡m giá»¯a bá»™ nhá»› vÃ  bá»™ xá»­ lÃ½</strong>. Sao chÃ©p dá»¯ liá»‡u cáº§n sá»­ dá»¥ng vÃ o cache Ä‘á»ƒ thá»±c hiá»‡n tÃ­nh toÃ¡n nhanh chÃ³ng, sau khi hoÃ n thÃ nh tÃ­nh toÃ¡n, Ä‘á»“ng bá»™ láº¡i tá»« cache vÃ o trong bá»™ nhá»›, Ä‘iá»u nÃ y giÃºp cho viá»‡c xá»­ lÃ­ khÃ´ng cáº§n pháº£i chá» Ä‘á»£i quÃ¡ trÃ¬nh ghi/Ä‘á»c tá»« bá»™ nhá»› cháº­m.</li></ul><h3 id="Ä‘ong-nhat-bo-nho-cache" tabindex="-1"><a class="header-anchor" href="#Ä‘ong-nhat-bo-nho-cache"><span>Äá»“ng nháº¥t bá»™ nhá»› cache</span></a></h3><p>Bá»™ nhá»› cache giáº£i quyáº¿t váº¥n Ä‘á» hiá»‡u suáº¥t xá»­ lÃ½ cá»§a pháº§n cá»©ng, nhÆ°ng Ä‘á»“ng thá»i Ä‘Æ°a ra má»™t váº¥n Ä‘á» má»›i: <strong>Ä‘á»“ng nháº¥t bá»™ nhá»› cache (Cache Coherence)</strong>.</p><p>Trong há»‡ thá»‘ng Ä‘a xá»­ lÃ½, má»—i bá»™ xá»­ lÃ½ cÃ³ bá»™ nhá»› cache riÃªng cá»§a nÃ³, vÃ  chÃºng chia sáº» cÃ¹ng má»™t bá»™ nhá»› chÃ­nh. Khi nhiá»u bá»™ xá»­ lÃ½ cÃ³ nhiá»‡m vá»¥ tÃ­nh toÃ¡n liÃªn quan Ä‘áº¿n cÃ¹ng má»™t vÃ¹ng nhá»› chÃ­nh, cÃ³ thá»ƒ dáº«n Ä‘áº¿n cÃ¡c báº£n sao khÃ´ng nháº¥t quÃ¡n cá»§a dá»¯ liá»‡u trong bá»™ nhá»› cache cá»§a má»—i bá»™ xá»­ lÃ½.</p><p>Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» Ä‘á»“ng nháº¥t bá»™ nhá»› cache, <strong>má»—i bá»™ xá»­ lÃ½ pháº£i tuÃ¢n thá»§ má»™t sá»‘ giao thá»©c vÃ  thá»±c hiá»‡n cÃ¡c hoáº¡t Ä‘á»™ng Ä‘á»c/ghi dá»±a trÃªn giao thá»©c Ä‘Ã³</strong>.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/CPU Memory Model.png" alt="CPU Memory Model.png" tabindex="0" loading="lazy"><figcaption>CPU Memory Model.png</figcaption></figure><h3 id="toi-uu-hoa-thuc-thi-ma-khong-tuan-thu-thu-tu" tabindex="-1"><a class="header-anchor" href="#toi-uu-hoa-thuc-thi-ma-khong-tuan-thu-thu-tu"><span>Tá»‘i Æ°u hÃ³a thá»±c thi mÃ£ khÃ´ng tuÃ¢n thá»§ thá»© tá»±</span></a></h3><p><strong>NgoÃ i bá»™ nhá»› cache, Ä‘á»ƒ táº­n dá»¥ng tá»‘i Ä‘a cÃ¡c Ä‘Æ¡n vá»‹ tÃ­nh toÃ¡n trong bÃªn trong bá»™ xá»­ lÃ½</strong>, bá»™ xá»­ lÃ½ cÃ³ thá»ƒ tá»‘i Æ°u hÃ³a viá»‡c thá»±c hiá»‡n mÃ£ nháº­p theo thá»© tá»± khÃ´ng tuáº§n tá»± (Out-Of-Order Execution). Bá»™ xá»­ lÃ½ sáº½ tÃ¡i tá»• chá»©c káº¿t quáº£ cá»§a viá»‡c thá»±c hiá»‡n khÃ´ng tuáº§n tá»± sau khi tÃ­nh toÃ¡n, <strong>Ä‘áº£m báº£o ráº±ng káº¿t quáº£ nÃ y giá»‘ng vá»›i káº¿t quáº£ cá»§a viá»‡c thá»±c hiá»‡n theo trÃ¬nh tá»±</strong>, nhÆ°ng khÃ´ng Ä‘áº£m báº£o ráº±ng cÃ¡c cÃ¢u lá»‡nh tÃ­nh toÃ¡n trong chÆ°Æ¡ng trÃ¬nh Ä‘Æ°á»£c thá»±c hiá»‡n theo cÃ¹ng má»™t trÃ¬nh tá»± nhÆ° trong mÃ£ ban Ä‘áº§u.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/CodeReorderingOptimize.png" alt="CodeReorderingOptimize.png" tabindex="0" loading="lazy"><figcaption>CodeReorderingOptimize.png</figcaption></figure><p>Ká»¹ thuáº­t thá»±c thi mÃ£ khÃ´ng tuÃ¢n thá»§ thá»© tá»± lÃ  má»™t tá»‘i Æ°u hÃ³a cá»§a bá»™ xá»­ lÃ½ Ä‘á»ƒ tÄƒng tá»‘c Ä‘á»™ tÃ­nh toÃ¡n.</p><ul><li>Trong mÃ´i trÆ°á»ng <strong>Ä‘Æ¡n nhÃ¢n</strong>, bá»™ xá»­ lÃ½ Ä‘áº£m báº£o ráº±ng cÃ¡c tá»‘i Æ°u hÃ³a Ä‘Æ°á»£c thá»±c hiá»‡n khÃ´ng dáº«n Ä‘áº¿n káº¿t quáº£ thá»±c thi xa khá»i má»¥c tiÃªu dá»± kiáº¿n, nhÆ°ng trong mÃ´i trÆ°á»ng <strong>Ä‘a nhÃ¢n</strong>, Ä‘iá»u nÃ y khÃ´ng pháº£i luÃ´n Ä‘Ãºng.</li><li>Trong mÃ´i trÆ°á»ng <strong>Ä‘a nhÃ¢n</strong>, náº¿u cÃ³ nhiá»‡m vá»¥ tÃ­nh toÃ¡n cá»§a má»™t lÃµi phá»¥ thuá»™c vÃ o káº¿t quáº£ trung gian cá»§a nhiá»‡m vá»¥ tÃ­nh toÃ¡n cá»§a lÃµi khÃ¡c vÃ  khÃ´ng cÃ³ biá»‡n phÃ¡p báº£o vá»‡ cho viá»‡c Ä‘á»c/ghi dá»¯ liá»‡u liÃªn quan, sá»± tuáº§n tá»± khÃ´ng Ä‘Æ°á»£c Ä‘áº£m báº£o chá»‰ thÃ´ng qua thá»© tá»± mÃ£.</li></ul><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/CodeRefactorOptMulti.png" alt="CodeRefactorOptMulti.png" tabindex="0" loading="lazy"><figcaption>CodeRefactorOptMulti.png</figcaption></figure><h3 id="mo-hinh-bo-nho-java-1" tabindex="-1"><a class="header-anchor" href="#mo-hinh-bo-nho-java-1"><span>MÃ´ hÃ¬nh bá»™ nhá»› Java</span></a></h3><p>KhÃ¡i niá»‡mÂ <strong>mÃ´ hÃ¬nh bá»™ nhá»›</strong>Â (Memory Model) cÃ³ thá»ƒ hiá»ƒu lÃ :Â <strong>quÃ¡ trÃ¬nh truy cáº­p vÃ  ghi vÃ o bá»™ nhá»› hoáº·c bá»™ nhá»› cache cá»¥ thá»ƒ dá»±a trÃªn má»™t giao thá»©c hoáº¡t Ä‘á»™ng</strong>. CÃ¡c mÃ¡y tÃ­nh váº­t lÃ½ khÃ¡c nhau cÃ³ thá»ƒ cÃ³ cÃ¡c mÃ´ hÃ¬nh bá»™ nhá»› khÃ¡c nhau, vÃ  JVM cÅ©ng cÃ³ mÃ´ hÃ¬nh bá»™ nhá»› riÃªng cá»§a nÃ³.</p><p>JVM cá»‘ gáº¯ng Ä‘á»‹nh nghÄ©a má»™t mÃ´ hÃ¬nh bá»™ nhá»› Java (Java Memory Model, JMM) Ä‘á»ƒÂ <strong>giáº¥u Ä‘i sá»± khÃ¡c biá»‡t trong viá»‡c truy cáº­p bá»™ nhá»› giá»¯a cÃ¡c pháº§n cá»©ng vÃ  há»‡ Ä‘iá»u hÃ nh khÃ¡c nhau</strong>, nháº±m Ä‘áº£m báº£o ráº±ng cÃ¡c chÆ°Æ¡ng trÃ¬nh Java cÃ³ thá»ƒ Ä‘áº¡t Ä‘Æ°á»£c hiá»‡u suáº¥t truy cáº­p bá»™ nhá»› nháº¥t quÃ¡n trÃªn má»i ná»n táº£ng.</p><p>TrongÂ [[Java Concurrency Intro]], chÃºng ta Ä‘Ã£ biáº¿t ráº±ng Ä‘á»“ng thá»i an toÃ n Ä‘Ã²i há»i tÃ­nh nhÃ¬n tháº¥y, tÃ¬nh tuáº§n tá»± vÃ  tÃ­nh nguyÃªn tá»­. Trong Ä‘Ã³, tÃ­nh nhÃ¬n tháº¥y bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi bá»™ nhá»› cache, vÃ  tÃ¬nh tuáº§n tá»± bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi tá»‘i Æ°u hÃ³a biÃªn dá»‹ch. Tuy nhiÃªn, viá»‡c vÃ´ hiá»‡u hÃ³a bá»™ nhá»› cache vÃ  tá»‘i Æ°u hÃ³a biÃªn dá»‹ch Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y sáº½ lÃ m giáº£m hiá»‡u suáº¥t.</p><p>Má»™t giáº£i phÃ¡p há»£p lÃ½ lÃ Â <strong>vÃ´ hiá»‡u hÃ³a bá»™ nhá»› cache vÃ  tá»‘i Æ°u hÃ³a biÃªn dá»‹ch theo nhu cáº§u</strong>. Váº­y lÃ m tháº¿ nÃ o Ä‘á»ƒ lÃ m Ä‘Æ°á»£c Ä‘iá»u nÃ y? JMM Ä‘Ã£ Ä‘á»‹nh nghÄ©a cÃ¡ch JVM cung cáº¥p vÃ´ hiá»‡u hÃ³a bá»™ nhá»› cache vÃ  tá»‘i Æ°u hÃ³a biÃªn dá»‹ch theo nhu cáº§u. Cá»¥ thá»ƒ, cÃ¡c phÆ°Æ¡ng phÃ¡p nÃ y bao gá»“m ba tá»« khÃ³a quan trá»ng lÃ Â <strong>volatile</strong>,Â <strong>synchronized</strong>Â vÃ Â <strong>final</strong>, cÃ¹ng vá»›i quy táº¯cÂ <strong>Happens-Before</strong>.</p><h3 id="bo-nho-chinh-va-bo-nho-lam-viec" tabindex="-1"><a class="header-anchor" href="#bo-nho-chinh-va-bo-nho-lam-viec"><span>Bá»™ nhá»› chÃ­nh vÃ  bá»™ nhá»› lÃ m viá»‡c</span></a></h3><p>JMM cÃ³ má»¥c tiÃªu chÃ­nh lÃ  <strong>Ä‘á»‹nh nghÄ©a quy táº¯c truy cáº­p cÃ¡c biáº¿n trong chÆ°Æ¡ng trÃ¬nh, tá»©c lÃ  lÆ°u trá»¯ vÃ  truy xuáº¥t biáº¿n tá»« bá»™ nhá»› trong mÃ¡y áº£o vá»›i cÃ¡c chi tiáº¿t cáº¥p tháº¥p nhÆ° váº­y</strong>. Biáº¿n á»Ÿ Ä‘Ã¢y (Variables) khÃ¡c vá»›i biáº¿n Ä‘Æ°á»£c Ä‘á» cáº­p trong láº­p trÃ¬nh Java, nÃ³ bao gá»“m cÃ¡c trÆ°á»ng cá»§a thá»ƒ hiá»‡n, cÃ¡c trÆ°á»ng tÄ©nh vÃ  cÃ¡c thÃ nh pháº§n cá»§a Ä‘á»‘i tÆ°á»£ng sá»‘ há»c, nhÆ°ng khÃ´ng bao gá»“m biáº¿n cá»¥c bá»™ vÃ  tham sá»‘ phÆ°Æ¡ng thá»©c, vÃ¬ sau nÃ y chá»‰ thuá»™c sá»Ÿ há»¯u riÃªng cá»§a luá»“ng vÃ  khÃ´ng Ä‘Æ°á»£c chia sáº», tá»± nhiÃªn khÃ´ng cÃ³ váº¥n Ä‘á» xung Ä‘á»™t. Äá»ƒ cÃ³ hiá»‡u suáº¥t thá»±c thi tá»‘t hÆ¡n, JMM khÃ´ng giá»›i háº¡n viá»‡c sá»­ dá»¥ng thanh ghi hoáº·c bá»™ nhá»› cache cá»§a bá»™ xá»­ lÃ½ Ä‘á»ƒ giao tiáº¿p vá»›i bá»™ nhá»› chÃ­nh vÃ  khÃ´ng giá»›i háº¡n viá»‡c tá»‘i Æ°u mÃ£ thÃ´ng qua viá»‡c Ä‘iá»u chá»‰nh thá»© tá»± thá»±c thi mÃ£ nguá»“n.</p><p>JMM quy Ä‘á»‹nh ráº±ngÂ <strong>táº¥t cáº£ cÃ¡c biáº¿n Ä‘Æ°á»£c lÆ°u trá»¯ trong bá»™ nhá»› chÃ­nh (Main Memory)</strong>.</p><p>Má»—i luá»“ng cÃ²n cÃ³ bá»™ nhá»› lÃ m viá»‡c riÃªng (Working Memory), <strong>bá»™ nhá»› lÃ m viá»‡c nÃ y chá»©a báº£n sao cá»§a biáº¿n Ä‘Æ°á»£c sá»­ dá»¥ng trong bá»™ nhá»› chÃ­nh cá»§a luá»“ng Ä‘Ã³</strong>. Bá»™ nhá»› lÃ m viá»‡c lÃ  má»™t khÃ¡i niá»‡m trá»«u tÆ°á»£ng trong JMM vÃ  khÃ´ng tá»“n táº¡i thá»±c sá»±, nÃ³ bao gá»“m cache, vÃ¹ng Ä‘á»‡m ghi, thanh ghi vÃ  cÃ¡c tá»‘i Æ°u pháº§n cá»©ng vÃ  trÃ¬nh biÃªn dá»‹ch khÃ¡c.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/jmam.png" alt="jmam.png" tabindex="0" loading="lazy"><figcaption>jmam.png</figcaption></figure><p>Má»i hoáº¡t Ä‘á»™ng cá»§a luá»“ng Ä‘á»‘i vá»›i biáº¿n pháº£i Ä‘Æ°á»£c thá»±c hiá»‡n trong bá»™ nhá»› lÃ m viá»‡c, khÃ´ng thá»ƒ trá»±c tiáº¿p Ä‘á»c/ghi vÃ o biáº¿n trong bá»™ nhá»› chÃ­nh. CÃ¡c luá»“ng khÃ¡c cÅ©ng khÃ´ng thá»ƒ truy cáº­p trá»±c tiáº¿p vÃ o bá»™ nhá»› lÃ m viá»‡c cá»§a luá»“ng khÃ¡c, mÃ  cáº§n thÃ´ng qua bá»™ nhá»› chÃ­nh Ä‘á»ƒ truyá»n giÃ¡ trá»‹ biáº¿n.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/jmm.png" alt="jmm.png" tabindex="0" loading="lazy"><figcaption>jmm.png</figcaption></figure><blockquote><p>LÆ°u Ã½:</p><p>Bá»™ nhá»› chÃ­nh vÃ  bá»™ nhá»› lÃ m viá»‡c trong JMM khÃ´ng pháº£i lÃ  cÃ¹ng má»™t cáº¥p báº­c cá»§a viá»‡c phÃ¢n chia bá»™ nhá»› trong Java nhÆ° heap, stack, pháº§n khÃ´ng gian phÆ°Æ¡ng thá»©c, v.v.</p></blockquote><h3 id="van-Ä‘e-ve-thao-tac-bo-nho-trong-jmm" tabindex="-1"><a class="header-anchor" href="#van-Ä‘e-ve-thao-tac-bo-nho-trong-jmm"><span>Váº¥n Ä‘á» vá» thao tÃ¡c bá»™ nhá»› trong JMM</span></a></h3><p>TÆ°Æ¡ng tá»± nhÆ° váº¥n Ä‘á» mÃ´ hÃ¬nh bá»™ nhá»› váº­t lÃ½, JMM Ä‘á»‘i diá»‡n vá»›i hai váº¥n Ä‘á» sau:</p><ul><li><strong>TÃ­nh nháº¥t quÃ¡n cá»§a dá»¯ liá»‡u trong bá»™ nhá»› lÃ m viá»‡c</strong> - Khi cÃ¡c luá»“ng khÃ¡c nhau thao tÃ¡c dá»¯ liá»‡u, chÃºng sáº½ lÆ°u trá»¯ báº£n sao cá»§a biáº¿n chia sáº» trong bá»™ nhá»› chÃ­nh vÃ  sá»­ dá»¥ng báº£n sao nÃ y. Khi nhiá»u luá»“ng thá»±c hiá»‡n cÃ¡c tÃ¡c vá»¥ tÃ­nh toÃ¡n liÃªn quan Ä‘áº¿n cÃ¹ng má»™t biáº¿n chia sáº», cÃ¡c báº£n sao cá»§a biáº¿n chia sáº» sáº½ khÃ´ng nháº¥t quÃ¡n. Náº¿u thá»±c sá»± xáº£y ra tÃ¬nh huá»‘ng nÃ y, dá»¯ liá»‡u Ä‘Æ°á»£c Ä‘á»“ng bá»™ trá»Ÿ láº¡i bá»™ nhá»› chÃ­nh sáº½ dá»±a vÃ o báº£n sao dá»¯ liá»‡u cá»§a ai? Java Memory Model chá»§ yáº¿u Ä‘áº£m báº£o tÃ­nh nháº¥t quÃ¡n cá»§a dá»¯ liá»‡u thÃ´ng qua má»™t loáº¡t cÃ¡c giao thá»©c vÃ  quy táº¯c Ä‘á»“ng bá»™ dá»¯ liá»‡u.</li><li><strong>Tá»‘i Æ°u hÃ³a sáº¯p xáº¿p láº¡i lá»‡nh</strong> - Sáº¯p xáº¿p láº¡i lá»‡nh trong Java thÆ°á»ng lÃ  má»™t biá»‡n phÃ¡p Ä‘á»ƒ tá»‘i Æ°u hiá»‡u suáº¥t chÆ°Æ¡ng trÃ¬nh báº±ng cÃ¡ch sáº¯p xáº¿p láº¡i thá»© tá»± thá»±c hiá»‡n cÃ¡c lá»‡nh. Sáº¯p xáº¿p láº¡i lá»‡nh Ä‘Æ°á»£c chia thÃ nh hai loáº¡i: <strong>sáº¯p xáº¿p láº¡i lá»‡nh trong quÃ¡ trÃ¬nh biÃªn dá»‹ch vÃ  sáº¯p xáº¿p láº¡i lá»‡nh trong quÃ¡ trÃ¬nh cháº¡y</strong>. Tuy nhiÃªn, sáº¯p xáº¿p láº¡i lá»‡nh khÃ´ng pháº£i lÃ  viá»‡c sáº¯p xáº¿p láº¡i tÃ¹y Ã½, nÃ³ pháº£i Ä‘Ã¡p á»©ng hai Ä‘iá»u kiá»‡n sau: <ul><li>Trong mÃ´i trÆ°á»ng Ä‘Æ¡n luá»“ng, khÃ´ng thá»ƒ thay Ä‘á»•i káº¿t quáº£ cháº¡y cá»§a chÆ°Æ¡ng trÃ¬nh. TrÃ¬nh biÃªn dá»‹ch (vÃ  bá»™ xá»­ lÃ½) cáº§n Ä‘áº£m báº£o chÆ°Æ¡ng trÃ¬nh cÃ³ váº» cháº¡y tuáº§n tá»±. NghÄ©a lÃ  káº¿t quáº£ thá»±c thi sau khi sáº¯p xáº¿p láº¡i cáº§n giá»‘ng vá»›i káº¿t quáº£ thá»±c thi tuáº§n tá»±.</li><li>KhÃ´ng cho phÃ©p sáº¯p xáº¿p láº¡i lá»‡nh náº¿u cÃ³ phá»¥ thuá»™c dá»¯ liá»‡u.</li><li>Trong mÃ´i trÆ°á»ng Ä‘a luá»“ng, náº¿u cÃ³ sá»± phá»¥ thuá»™c giá»¯a cÃ¡c logic xá»­ lÃ½ cá»§a cÃ¡c luá»“ng, cÃ³ thá»ƒ dáº«n Ä‘áº¿n káº¿t quáº£ cháº¡y khÃ¡c vá»›i káº¿t quáº£ dá»± kiáº¿n do sáº¯p xáº¿p láº¡i lá»‡nh.</li></ul></li></ul><h3 id="thao-tac-giao-tiep-giua-bo-nho" tabindex="-1"><a class="header-anchor" href="#thao-tac-giao-tiep-giua-bo-nho"><span>Thao tÃ¡c giao tiáº¿p giá»¯a bá»™ nhá»›</span></a></h3><p>JMM xÃ¡c Ä‘á»‹nh 8 thao tÃ¡c Ä‘á»ƒ hoÃ n thÃ nh viá»‡c giao tiáº¿p giá»¯a bá»™ nhá»› chÃ­nh vÃ  bá»™ nhá»› lÃ m viá»‡c cá»§a má»™t luá»“ng. JVM pháº£i Ä‘áº£m báº£o má»—i thao tÃ¡c Ä‘Æ°á»£c mÃ´ táº£ dÆ°á»›i Ä‘Ã¢y lÃ  <strong>nguyÃªn tá»­</strong> (Ä‘á»‘i vá»›i biáº¿n kiá»ƒu double vÃ  long, cÃ¡c thao tÃ¡c load, store, read vÃ  write cÃ³ thá»ƒ cÃ³ ngoáº¡i lá»‡ trÃªn má»™t sá»‘ ná»n táº£ng).</p><ul><li><code>lock</code> (khÃ³a) - Ãp dá»¥ng cho biáº¿n trong <strong>bá»™ nhá»› chÃ­nh</strong>, nÃ³ Ä‘Ã¡nh dáº¥u má»™t biáº¿n lÃ  tráº¡ng thÃ¡i Ä‘á»™c quyá»n cá»§a má»™t luá»“ng.</li><li><code>unlock</code> (má»Ÿ khÃ³a) - Ãp dá»¥ng cho biáº¿n trong <strong>bá»™ nhá»› chÃ­nh</strong>, nÃ³ giáº£i phÃ³ng má»™t biáº¿n Ä‘ang bá»‹ khÃ³a, cho phÃ©p cÃ¡c luá»“ng khÃ¡c khÃ³a biáº¿n Ä‘Ã³.</li><li><code>read</code> (Ä‘á»c) - Ãp dá»¥ng cho biáº¿n trong <strong>bá»™ nhá»› chÃ­nh</strong>, nÃ³ chuyá»ƒn dá»¯ liá»‡u cá»§a má»™t biáº¿n tá»« bá»™ nhá»› chÃ­nh Ä‘áº¿n bá»™ nhá»› lÃ m viá»‡c cá»§a luá»“ng, Ä‘á»ƒ sá»­ dá»¥ng trong cÃ¡c hoáº¡t Ä‘á»™ng <code>load</code> sau nÃ y.</li><li><code>write</code> (ghi) - Ãp dá»¥ng cho biáº¿n trong <strong>bá»™ nhá»› chÃ­nh</strong>, nÃ³ lÆ°u trá»¯ giÃ¡ trá»‹ cá»§a biáº¿n tá»« bá»™ nhá»› lÃ m viá»‡c cá»§a luá»“ng vÃ o biáº¿n trong bá»™ nhá»› chÃ­nh.</li><li><code>load</code> (táº£i) - Ãp dá»¥ng cho biáº¿n trong <strong>bá»™ nhá»› lÃ m viá»‡c</strong>, nÃ³ chuyá»ƒn giÃ¡ trá»‹ cá»§a biáº¿n tá»« bá»™ nhá»› chÃ­nh Ä‘Ã£ Ä‘á»c Ä‘Æ°á»£c vÃ o báº£n sao biáº¿n trong bá»™ nhá»› lÃ m viá»‡c.</li><li><code>use</code> (sá»­ dá»¥ng) - Ãp dá»¥ng cho biáº¿n trong <strong>bá»™ nhá»› lÃ m viá»‡c</strong>, nÃ³ chuyá»ƒn giÃ¡ trá»‹ cá»§a biáº¿n tá»« bá»™ nhá»› lÃ m viá»‡c Ä‘áº¿n bá»™ xá»­ lÃ½, má»—i khi mÃ¡y áº£o gáº·p má»™t lá»‡nh bytecode cáº§n sá»­ dá»¥ng giÃ¡ trá»‹ cá»§a biáº¿n.</li><li><code>assign</code> (gÃ¡n) - Ãp dá»¥ng cho biáº¿n trong <strong>bá»™ nhá»› lÃ m viá»‡c</strong>, nÃ³ gÃ¡n giÃ¡ trá»‹ nháº­n Ä‘Æ°á»£c tá»« bá»™ xá»­ lÃ½ vÃ o biáº¿n trong bá»™ nhá»› lÃ m viá»‡c, má»—i khi mÃ¡y áº£o gáº·p má»™t lá»‡nh bytecode gÃ¡n giÃ¡ trá»‹ cho biáº¿n.</li><li><code>store</code> (lÆ°u trá»¯) - Ãp dá»¥ng cho biáº¿n trong <strong>bá»™ nhá»› lÃ m viá»‡c</strong>, nÃ³ chuyá»ƒn giÃ¡ trá»‹ cá»§a biáº¿n tá»« bá»™ nhá»› lÃ m viá»‡c Ä‘áº¿n bá»™ nhá»› chÃ­nh, Ä‘á»ƒ sá»­ dá»¥ng trong cÃ¡c hoáº¡t Ä‘á»™ng <code>write</code> sau nÃ y.</li></ul><p>Náº¿u muá»‘n sao chÃ©p má»™t biáº¿n tá»« bá»™ nhá»› chÃ­nh vÃ o bá»™ nhá»› lÃ m viá»‡c, cáº§n <strong>thá»±c hiá»‡n tuáº§n tá»± cÃ¡c thao tÃ¡c <code>read</code> vÃ  <code>load</code></strong>; náº¿u muá»‘n Ä‘á»“ng bá»™ hÃ³a biáº¿n tá»« bá»™ nhá»› lÃ m viá»‡c trá»Ÿ láº¡i bá»™ nhá»› chÃ­nh, cáº§n <strong>thá»±c hiá»‡n tuáº§n tá»± cÃ¡c thao tÃ¡c <code>store</code> vÃ  <code>write</code></strong>. Tuy nhiÃªn, Java Memory Model chá»‰ yÃªu cáº§u cÃ¡c thao tÃ¡c trÃªn pháº£i Ä‘Æ°á»£c thá»±c hiá»‡n theo thá»© tá»±, khÃ´ng Ä‘áº£m báº£o pháº£i thá»±c hiá»‡n liÃªn tá»¥c.</p><p>JMM cÅ©ng quy Ä‘á»‹nh ráº±ng 8 thao tÃ¡c cÆ¡ báº£n trÃªn pháº£i tuÃ¢n thá»§ cÃ¡c quy táº¯c sau:</p><ul><li><strong><code>read</code> vÃ  <code>load</code> pháº£i Ä‘Æ°á»£c thá»±c hiá»‡n cáº·p vá»›i nhau</strong>; <strong><code>store</code> vÃ  <code>write</code> pháº£i Ä‘Æ°á»£c thá»±c hiá»‡n cáº·p vá»›i nhau</strong>. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  khÃ´ng cho phÃ©p má»™t biáº¿n Ä‘Æ°á»£c Ä‘á»c tá»« bá»™ nhá»› chÃ­nh nhÆ°ng khÃ´ng Ä‘Æ°á»£c cháº¥p nháº­n vÃ o bá»™ nhá»› lÃ m viá»‡c, hoáº·c ghi tá»« bá»™ nhá»› lÃ m viá»‡c nhÆ°ng khÃ´ng Ä‘Æ°á»£c cháº¥p nháº­n vÃ o bá»™ nhá»› chÃ­nh.</li><li><strong>KhÃ´ng cho phÃ©p má»™t luá»“ng bá» qua má»™t thao tÃ¡c gÃ¡n gáº§n nháº¥t cá»§a nÃ³</strong>, nghÄ©a lÃ  biáº¿n pháº£i Ä‘Æ°á»£c Ä‘á»“ng bá»™ trÆ°á»›c khi nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng.</li><li><strong>KhÃ´ng cho phÃ©p má»™t luá»“ng Ä‘á»“ng bá»™ hÃ³a má»™t biáº¿n mÃ  khÃ´ng cÃ³ lÃ½ do</strong>.</li><li>Má»™t biáº¿n má»›i chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c táº¡o ra trong bá»™ nhá»› chÃ­nh, khÃ´ng cho phÃ©p sá»­ dá»¥ng trá»±c tiáº¿p má»™t biáº¿n chÆ°a Ä‘Æ°á»£c khá»Ÿi táº¡o (load hoáº·c assign) trong bá»™ nhá»› lÃ m viá»‡c. NÃ³i cÃ¡ch khÃ¡c, trÆ°á»›c khi thá»±c hiá»‡n thao tÃ¡c <code>use</code> vÃ  <code>store</code> trÃªn má»™t biáº¿n, pháº£i Ä‘Ã£ thá»±c hiá»‡n thao tÃ¡c <code>load</code> hoáº·c <code>assign</code> trÆ°á»›c Ä‘Ã³.</li><li>Má»™t biáº¿n chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c khÃ³a bá»Ÿi má»™t luá»“ng táº¡i má»™t thá»i Ä‘iá»ƒm, nhÆ°ng khÃ³a cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c hiá»‡n nhiá»u láº§n bá»Ÿi cÃ¹ng má»™t luá»“ng. Chá»‰ khi thá»±c hiá»‡n cÃ¹ng sá»‘ láº§n khÃ³a vÃ  má»Ÿ khÃ³a, biáº¿n má»›i Ä‘Æ°á»£c má»Ÿ khÃ³a. VÃ¬ váº­y, <strong><code>lock</code> vÃ  <code>unlock</code> pháº£i Ä‘Æ°á»£c thá»±c hiá»‡n cáº·p vá»›i nhau</strong>.</li><li>Náº¿u thá»±c hiá»‡n thao tÃ¡c <code>lock</code> trÃªn má»™t biáº¿n, bá»™ nhá»› lÃ m viá»‡c cá»§a biáº¿n Ä‘Ã³ sáº½ bá»‹ xÃ³a, trÆ°á»›c khi bá»™ xá»­ lÃ½ sá»­ dá»¥ng biáº¿n Ä‘Ã³, cáº§n thá»±c hiá»‡n láº¡i thao tÃ¡c <code>load</code> hoáº·c <code>assign</code> Ä‘á»ƒ khá»Ÿi táº¡o giÃ¡ trá»‹ biáº¿n.</li><li>Náº¿u má»™t biáº¿n chÆ°a Ä‘Æ°á»£c khÃ³a trÆ°á»›c Ä‘Ã³, khÃ´ng cho phÃ©p thá»±c hiá»‡n thao tÃ¡c <code>unlock</code> trÃªn nÃ³, cÅ©ng khÃ´ng cho phÃ©p má»Ÿ khÃ³a má»™t biáº¿n bá»‹ khÃ³a bá»Ÿi luá»“ng khÃ¡c.</li><li>TrÆ°á»›c khi thá»±c hiá»‡n thao tÃ¡c <code>unlock</code> trÃªn má»™t biáº¿n, cáº§n Ä‘á»“ng bá»™ hÃ³a biáº¿n Ä‘Ã³ vá»›i bá»™ nhá»› chÃ­nh (thá»±c hiá»‡n thao tÃ¡c <code>store</code> vÃ  <code>write</code>).</li></ul><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/jmman.png" alt="jmman.png" tabindex="0" loading="lazy"><figcaption>jmman.png</figcaption></figure><h3 id="tinh-an-toan-Ä‘ong-thoi" tabindex="-1"><a class="header-anchor" href="#tinh-an-toan-Ä‘ong-thoi"><span>TÃ­nh an toÃ n Ä‘á»“ng thá»i</span></a></h3><p>Trong pháº§n trÆ°á»›c, chÃºng ta Ä‘Ã£ giá»›i thiá»‡u 8 thao tÃ¡c cÆ¡ báº£n Ä‘á»ƒ giao tiáº¿p giá»¯a bá»™ nhá»› chÃ­nh vÃ  bá»™ nhá»› lÃ m viá»‡c trong JMM. CÃ¡c thao tÃ¡c nÃ y tuÃ¢n theo ba tÃ­nh cháº¥t chÃ­nh cá»§a bá»™ nhá»› Java: tÃ­nh nguyÃªn tá»­, tÃ­nh hiá»ƒn thá»‹ vÃ  tÃ­nh tuáº§n tá»±.</p><p>Ba tÃ­nh cháº¥t nÃ y, trong báº£n cháº¥t, nháº±m Ä‘áº£m báº£oÂ <strong>tÃ­nh nháº¥t quÃ¡n cá»§a dá»¯ liá»‡u</strong>Â trong mÃ´i trÆ°á»ng Ä‘a luá»“ng, tá»‘i Æ°u hÃ³a sáº¯p xáº¿p láº¡i lá»‡nh vÃ  Ä‘áº£m báº£o káº¿t quáº£ cháº¡y theo dá»± kiáº¿n trong mÃ´i trÆ°á»ng Ä‘a luá»“ng.</p><h4 id="tinh-nguyen-tu" tabindex="-1"><a class="header-anchor" href="#tinh-nguyen-tu"><span>TÃ­nh nguyÃªn tá»­</span></a></h4><p><strong>TÃ­nh nguyÃªn tá»­ Ä‘áº£m báº£o ráº±ng má»™t hoáº·c nhiá»u hoáº¡t Ä‘á»™ng sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n hoÃ n toÃ n (quÃ¡ trÃ¬nh thá»±c hiá»‡n khÃ´ng bá»‹ giÃ¡n Ä‘oáº¡n bá»Ÿi báº¥t ká»³ yáº¿u tá»‘ nÃ o) hoáº·c khÃ´ng Ä‘Æ°á»£c thá»±c hiá»‡n</strong>. Ngay cáº£ khi nhiá»u luá»“ng cÃ¹ng thá»±c hiá»‡n, má»™t hoáº¡t Ä‘á»™ng má»™t khi báº¯t Ä‘áº§u, sáº½ khÃ´ng bá»‹ can thiá»‡p bá»Ÿi cÃ¡c luá»“ng khÃ¡c.</p><p>Trong Java, Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh nguyÃªn tá»­, chÃºng ta sá»­ dá»¥ng hai chá»‰ thá»‹ bytecode cao cáº¥p lÃ Â <code>monitorenter</code>Â vÃ Â <code>monitorexit</code>. Hai chá»‰ thá»‹ bytecode nÃ y tÆ°Æ¡ng á»©ng vá»›i tá»« khÃ³aÂ <code>synchronized</code>Â trong Java.</p><p>Do Ä‘Ã³, trong Java, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ngÂ <code>synchronized</code>Â Ä‘á»ƒ Ä‘áº£m báº£o cÃ¡c hoáº¡t Ä‘á»™ng trong phÆ°Æ¡ng thá»©c vÃ  khá»‘i mÃ£ lÃ  nguyÃªn tá»­.</p><h4 id="tinh-hien-thi" tabindex="-1"><a class="header-anchor" href="#tinh-hien-thi"><span>TÃ­nh hiá»ƒn thá»‹</span></a></h4><p><strong>TÃ­nh hiá»ƒn thá»‹ Ä‘á» cáº­p Ä‘áº¿n viá»‡c khi nhiá»u luá»“ng truy cáº­p vÃ o cÃ¹ng má»™t biáº¿n, náº¿u má»™t luá»“ng thay Ä‘á»•i giÃ¡ trá»‹ cá»§a biáº¿n, cÃ¡c luá»“ng khÃ¡c sáº½ cÃ³ thá»ƒ nhÃ¬n tháº¥y giÃ¡ trá»‹ Ä‘Ã£ thay Ä‘á»•i ngay láº­p tá»©c</strong>.</p><p>JMM Ä‘áº¡t Ä‘Æ°á»£c tÃ­nh hiá»ƒn thá»‹ báº±ng cÃ¡ch sá»­ dá»¥ngÂ <strong>&quot;Ä‘á»“ng bá»™ dá»¯ liá»‡u tá»« bá»™ nhá»› chÃ­nh trá»Ÿ láº¡i bá»™ nhá»› lÃ m viá»‡c trÆ°á»›c khi Ä‘á»c biáº¿n&quot;</strong>Â vÃ Â <strong>&quot;Ä‘á»“ng bá»™ dá»¯ liá»‡u tá»« bá»™ nhá»› lÃ m viá»‡c trá»Ÿ láº¡i bá»™ nhá»› chÃ­nh trÆ°á»›c khi ghi biáº¿n&quot;</strong>.</p><p>Java cung cáº¥p cÃ¡c cÃ¡ch Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c tÃ­nh hiá»ƒn thá»‹ trong mÃ´i trÆ°á»ng Ä‘a luá»“ng:</p><ul><li><code>volatile</code></li><li><code>synchronized</code></li><li><code>final</code></li></ul><h4 id="tinh-tuan-tu" tabindex="-1"><a class="header-anchor" href="#tinh-tuan-tu"><span>TÃ­nh tuáº§n tá»±</span></a></h4><p>TÃ­nh tuáº§n tá»± xuáº¥t hiá»‡n trong hai tÃ¬nh huá»‘ng: trong má»™t luá»“ng vÃ  giá»¯a cÃ¡c luá»“ng.</p><ul><li>Trong má»™t luá»“ng - Xem xÃ©t viá»‡c thá»±c thi má»™t phÆ°Æ¡ng thá»©c tá»« quan Ä‘iá»ƒm cá»§a má»™t luá»“ng, cÃ¡c chá»‰ thá»‹ sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n theo cÃ¡ch gá»i lÃ  &quot;tuáº§n tá»±&quot; (<code>as-if-serial</code>). Äiá»u nÃ y Ä‘Ã£ Ä‘Æ°á»£c Ã¡p dá»¥ng trong cÃ¡c ngÃ´n ngá»¯ láº­p trÃ¬nh tuáº§n tá»±.</li><li>Giá»¯a cÃ¡c luá»“ng - Khi má»™t luá»“ng &quot;quan sÃ¡t&quot; cÃ¡c luá»“ng khÃ¡c thá»±c thi cÃ¡c mÃ£ khÃ´ng Ä‘á»“ng bá»™, do sá»± tá»‘i Æ°u hÃ³a sáº¯p xáº¿p láº¡i lá»‡nh, báº¥t ká»³ mÃ£ nÃ o cÅ©ng cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c thi xen káº½. Äiá»u duy nháº¥t cÃ³ hiá»‡u lá»±c lÃ  rÃ ng buá»™c Ä‘á»‘i vá»›i cÃ¡c phÆ°Æ¡ng thá»©c Ä‘á»“ng bá»™, khá»‘i Ä‘á»“ng bá»™ (<code>synchronized</code>) vÃ  trÆ°á»ngÂ <code>volatile</code>.</li></ul><p>Trong Java, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ngÂ <code>synchronized</code>Â vÃ Â <code>volatile</code>Â Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh tuáº§n tá»± giá»¯a cÃ¡c hoáº¡t Ä‘á»™ng Ä‘a luá»“ng. CÃ¡ch thá»±c hiá»‡n cÃ³ má»™t sá»‘ khÃ¡c biá»‡t:</p><ul><li>Tá»« khÃ³aÂ <code>volatile</code>Â sáº½ ngÄƒn cháº·n sáº¯p xáº¿p láº¡i lá»‡nh.</li><li>Tá»« khÃ³aÂ <code>synchronized</code>Â sá»­ dá»¥ng khÃ³a Ä‘á»ƒ Ä‘áº£m báº£o chá»‰ cÃ³ má»™t luá»“ng Ä‘Æ°á»£c thá»±c hiá»‡n táº¡i má»™t thá»i Ä‘iá»ƒm.</li></ul><h2 id="happens-before" tabindex="-1"><a class="header-anchor" href="#happens-before"><span>Happens-Before</span></a></h2><p>JMM Ä‘Ã£ Ä‘á»‹nh nghÄ©a má»™t quan há»‡ bÃ¡n tá»± nhiÃªn cho táº¥t cáº£ cÃ¡c hoáº¡t Ä‘á»™ng trong chÆ°Æ¡ng trÃ¬nh, Ä‘Æ°á»£c gá»i lÃ  <strong><code>NguyÃªn táº¯c Xáº£y ra TrÆ°á»›c (Happens-Before)</code></strong>.</p><p><strong>Happens-Before</strong>Â cÃ³ nghÄ©a lÃ Â <strong>káº¿t quáº£ cá»§a má»™t hoáº¡t Ä‘á»™ng trÆ°á»›c Ä‘Ã³ cÃ³ thá»ƒ Ä‘Æ°á»£c nhÃ¬n tháº¥y bá»Ÿi cÃ¡c hoáº¡t Ä‘á»™ng sau Ä‘Ã³</strong>.</p><p><strong>Happens-Before</strong>Â ráº¥t quan trá»ng, nÃ³ lÃ  cÆ¡ sá»Ÿ chÃ­nh Ä‘á»ƒ xÃ¡c Ä‘á»‹nh xem dá»¯ liá»‡u cÃ³ xung Ä‘á»™t hay khÃ´ng, vÃ  xem liá»‡u luá»“ng cÃ³ an toÃ n hay khÃ´ng. Dá»±a vÃ o nguyÃªn táº¯c nÃ y, chÃºng ta cÃ³ thá»ƒ giáº£i quyáº¿t táº¥t cáº£ cÃ¡c váº¥n Ä‘á» liÃªn quan Ä‘áº¿n xung Ä‘á»™t giá»¯a hai hoáº¡t Ä‘á»™ng trong mÃ´i trÆ°á»ng Ä‘á»“ng thá»i báº±ng má»™t táº­p há»£p cÃ¡c quy táº¯c.</p><ul><li><strong>Quy táº¯c thá»© tá»± chÆ°Æ¡ng trÃ¬nh</strong>Â - Trong má»™t luá»“ng, theo thá»© tá»± mÃ£, má»™t hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c viáº¿t trÆ°á»›c xáº£y ra trÆ°á»›c hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c viáº¿t sau Ä‘Ã³.</li><li><strong>Quy táº¯c khÃ³a</strong>Â - Má»™t hoáº¡t Ä‘á»™ngÂ <code>unLock</code>Â xáº£y ra trÆ°á»›c hoáº¡t Ä‘á»™ngÂ <code>lock</code>Â tiáº¿p theo trÃªn cÃ¹ng má»™t khÃ³a.</li><li><strong>Quy táº¯c biáº¿n volatile</strong>Â - Má»™t hoáº¡t Ä‘á»™ng ghi vÃ o biáº¿nÂ <code>volatile</code>Â xáº£y ra trÆ°á»›c hoáº¡t Ä‘á»™ng Ä‘á»c tá»« biáº¿n Ä‘Ã³ tiáº¿p theo.</li><li><strong>Quy táº¯c khá»Ÿi Ä‘á»™ng luá»“ng</strong>Â - PhÆ°Æ¡ng thá»©cÂ <code>start()</code>Â cá»§a Ä‘á»‘i tÆ°á»£ngÂ <code>Thread</code>Â xáº£y ra trÆ°á»›c má»i hoáº¡t Ä‘á»™ng cá»§a luá»“ng Ä‘Ã³.</li><li><strong>Quy táº¯c káº¿t thÃºc luá»“ng</strong>Â - Táº¥t cáº£ cÃ¡c hoáº¡t Ä‘á»™ng trong luá»“ng xáº£y ra trÆ°á»›c viá»‡c kiá»ƒm tra káº¿t thÃºc cá»§a luá»“ng, chÃºng ta cÃ³ thá»ƒ kiá»ƒm tra káº¿t thÃºc luá»“ng báº±ng cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©cÂ <code>Thread.join()</code>Â hoáº·c kiá»ƒm tra giÃ¡ trá»‹ tráº£ vá» cá»§aÂ <code>Thread.isAlive()</code>.</li><li><strong>Quy táº¯c giÃ¡n Ä‘oáº¡n luá»“ng</strong>Â - Cuá»™c gá»i phÆ°Æ¡ng thá»©cÂ <code>interrupt()</code>Â cá»§a luá»“ng xáº£y ra trÆ°á»›c khi mÃ£ kiá»ƒm tra sá»± giÃ¡n Ä‘oáº¡n xáº£y ra trong luá»“ng, chÃºng ta cÃ³ thá»ƒ kiá»ƒm tra xem cÃ³ giÃ¡n Ä‘oáº¡n xáº£y ra hay khÃ´ng báº±ng cÃ¡ch sá»­ dá»¥ng phÆ°Æ¡ng thá»©cÂ <code>Thread.interrupted()</code>.</li><li><strong>Quy táº¯c káº¿t thÃºc Ä‘á»‘i tÆ°á»£ng</strong>Â - Viá»‡c khá»Ÿi táº¡o má»™t Ä‘á»‘i tÆ°á»£ng hoÃ n thÃ nh xáº£y ra trÆ°á»›c khi phÆ°Æ¡ng thá»©cÂ <code>finalize()</code>Â cá»§a Ä‘á»‘i tÆ°á»£ng báº¯t Ä‘áº§u.</li><li><strong>Quy táº¯c truyá»n thÃ´ng</strong>Â - Náº¿u hoáº¡t Ä‘á»™ng A xáº£y ra trÆ°á»›c hoáº¡t Ä‘á»™ng B, vÃ  hoáº¡t Ä‘á»™ng B xáº£y ra trÆ°á»›c hoáº¡t Ä‘á»™ng C, thÃ¬ cÃ³ thá»ƒ káº¿t luáº­n ráº±ng hoáº¡t Ä‘á»™ng A xáº£y ra trÆ°á»›c hoáº¡t Ä‘á»™ng C.</li></ul><h2 id="rao-can-bo-nho-memory-barrier" tabindex="-1"><a class="header-anchor" href="#rao-can-bo-nho-memory-barrier"><span>RÃ o cáº£n bá»™ nhá»› (Memory Barrier)</span></a></h2><p>LÃ m tháº¿ nÃ o Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh tuáº§n tá»± vÃ  tÃ­nh hiá»ƒn thá»‹ cá»§a cÃ¡c hoáº¡t Ä‘á»™ng cÆ¡ báº£n trong Java? Äiá»u nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c hiá»‡n thÃ´ng qua rÃ o cáº£n bá»™ nhá»› (memory barrier).</p><p>RÃ o cáº£n bá»™ nhá»› lÃ  má»™t lá»‡nh Ä‘Æ°á»£c chÃ¨n giá»¯a hai lá»‡nh CPU, Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ ngÄƒn cháº·n viá»‡c tÃ¡i sáº¯p xáº¿p cÃ¡c lá»‡nh xá»­ lÃ½ (giá»‘ng nhÆ° má»™t rÃ o cáº£n), tá»« Ä‘Ã³ Ä‘áº£m báº£o tÃ­nh tuáº§n tá»± cá»§a chÃºng. NgoÃ i ra, Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c hiá»‡u quáº£ cá»§a rÃ o cáº£n, nÃ³ cÅ©ng sáº½ Ä‘áº©y giÃ¡ trá»‹ tá»« bá»™ nhá»› chÃ­nh vÃ o bá»™ nhá»› cache trÆ°á»›c khi ghi hoáº·c Ä‘á»c giÃ¡ trá»‹, tá»« Ä‘Ã³ Ä‘áº£m báº£o tÃ­nh hiá»ƒn thá»‹.</p><p>VÃ­ dá»¥:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>Store1;</span></span>
<span class="line"><span>Store2;</span></span>
<span class="line"><span>Load1;</span></span>
<span class="line"><span>StoreLoad;  // RÃ o cáº£n bá»™ nhá»›</span></span>
<span class="line"><span>Store3;</span></span>
<span class="line"><span>Load2;</span></span>
<span class="line"><span>Load3;</span></span></code></pre></div><p>Äá»‘i vá»›i má»™t táº­p há»£p cÃ¡c lá»‡nh CPU nhÆ° trÃªn (Store Ä‘áº¡i diá»‡n cho lá»‡nh ghi, Load Ä‘áº¡i diá»‡n cho lá»‡nh Ä‘á»c), cÃ¡c lá»‡nh Store trÆ°á»›c rÃ o cáº£n StoreLoad khÃ´ng thá»ƒ hoÃ¡n Ä‘á»•i vá»‹ trÃ­ vá»›i cÃ¡c lá»‡nh Load sau rÃ o cáº£n StoreLoad, tá»©c lÃ  khÃ´ng thá»ƒ tÃ¡i sáº¯p xáº¿p. Tuy nhiÃªn, cÃ¡c lá»‡nh trÆ°á»›c vÃ  sau rÃ o cáº£n StoreLoad cÃ³ thá»ƒ hoÃ¡n Ä‘á»•i vá»‹ trÃ­, vÃ­ dá»¥ Store1 cÃ³ thá»ƒ hoÃ¡n Ä‘á»•i vá»›i Store2, Load2 cÃ³ thá»ƒ hoÃ¡n Ä‘á»•i vá»›i Load3.</p><p>CÃ³ 4 loáº¡i rÃ o cáº£n thÃ´ng thÆ°á»ng:</p><ul><li>RÃ o cáº£n LoadLoad - Äá»‘i vá»›i cÃ¢u lá»‡nh nhÆ° <code>Load1; LoadLoad; Load2</code>, Ä‘áº£m báº£o ráº±ng Load1 Ä‘Ã£ Ä‘á»c xong dá»¯ liá»‡u trÆ°á»›c khi Load2 Ä‘á»c dá»¯ liá»‡u.</li><li>RÃ o cáº£n StoreStore - Äá»‘i vá»›i cÃ¢u lá»‡nh nhÆ° <code>Store1; StoreStore; Store2</code>, Ä‘áº£m báº£o ráº±ng Store1 Ä‘Ã£ Ä‘Æ°á»£c ghi vÃ o bá»™ nhá»› chÃ­nh trÆ°á»›c khi cÃ¡c lá»‡nh Store2 khÃ¡c cÃ³ thá»ƒ nhÃ¬n tháº¥y nÃ³.</li><li>RÃ o cáº£n LoadStore - Äá»‘i vá»›i cÃ¢u lá»‡nh nhÆ° <code>Load1; LoadStore; Store2</code>, Ä‘áº£m báº£o ráº±ng Load1 Ä‘Ã£ Ä‘á»c xong dá»¯ liá»‡u trÆ°á»›c khi cÃ¡c lá»‡nh Store2 ghi dá»¯ liá»‡u.</li><li>RÃ o cáº£n StoreLoad - Äá»‘i vá»›i cÃ¢u lá»‡nh nhÆ° <code>Store1; StoreLoad; Load2</code>, Ä‘áº£m báº£o ráº±ng Store1 Ä‘Ã£ Ä‘Æ°á»£c ghi vÃ o bá»™ nhá»› chÃ­nh trÆ°á»›c khi cÃ¡c lá»‡nh Load2 vÃ  cÃ¡c lá»‡nh Ä‘á»c khÃ¡c Ä‘Æ°á»£c thá»±c hiá»‡n. ÄÃ¢y lÃ  rÃ o cáº£n máº¡nh nháº¥t (Ä‘áº©y dá»¯ liá»‡u tá»« bá»™ Ä‘á»‡m ghi, xÃ³a hÃ ng Ä‘á»£i khÃ´ng há»£p lá»‡). TrÃªn háº§u háº¿t cÃ¡c ná»n táº£ng, rÃ o cáº£n nÃ y cÃ³ thá»ƒ thá»±c hiá»‡n táº¥t cáº£ cÃ¡c chá»©c nÄƒng cá»§a ba rÃ o cáº£n khÃ¡c.</li></ul><p>Trong Java, viá»‡c sá»­ dá»¥ng rÃ o cáº£n bá»™ nhá»› khÃ´ng dá»… tháº¥y trong mÃ£ thÃ´ng thÆ°á»ng. CÃ¡ch sá»­ dá»¥ng phá»• biáº¿n bao gá»“m viá»‡c sá»­ dá»¥ng tá»« khÃ³a <code>volatile</code> vÃ  khá»‘i mÃ£ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u báº±ng <code>synchronized</code> (sáº½ Ä‘Æ°á»£c giáº£i thÃ­ch sau), vÃ  cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng rÃ o cáº£n bá»™ nhá»› thÃ´ng qua lá»›p <code>Unsafe</code>.</p><h2 id="volatile" tabindex="-1"><a class="header-anchor" href="#volatile"><span>volatile</span></a></h2><p><code>volatile</code> lÃ  cÆ¡ cháº¿ Ä‘á»“ng bá»™ nháº¹ nháº¥t Ä‘Æ°á»£c cung cáº¥p bá»Ÿi JVM.</p><p><code>volatile</code> cÃ³ nghÄ©a lÃ  khÃ´ng á»•n Ä‘á»‹nh, dá»… biáº¿n Ä‘á»•i. Sá»­ dá»¥ng tá»« khÃ³a <code>volatile</code> Ä‘á»ƒ Ä‘Ã¡nh dáº¥u má»™t biáº¿n nháº±m Ä‘áº£m báº£o tÃ­nh hiá»ƒn thá»‹ cá»§a biáº¿n trong mÃ´i trÆ°á»ng Ä‘a luá»“ng.</p><h4 id="Ä‘ac-Ä‘iem-cua-bien-volatile" tabindex="-1"><a class="header-anchor" href="#Ä‘ac-Ä‘iem-cua-bien-volatile"><span>Äáº·c Ä‘iá»ƒm cá»§a biáº¿n volatile</span></a></h4><p>Biáº¿n <code>volatile</code> cÃ³ hai Ä‘áº·c Ä‘iá»ƒm:</p><ul><li>Äáº£m báº£o tÃ­nh hiá»ƒn thá»‹ cá»§a biáº¿n Ä‘á»‘i vá»›i táº¥t cáº£ cÃ¡c luá»“ng.</li><li>NgÄƒn cháº·n viá»‡c tÃ¡i sáº¯p xáº¿p cÃ¡c lá»‡nh.</li></ul><h5 id="Ä‘am-bao-tinh-hien-thi-cua-bien-Ä‘oi-voi-tat-ca-cac-luong" tabindex="-1"><a class="header-anchor" href="#Ä‘am-bao-tinh-hien-thi-cua-bien-Ä‘oi-voi-tat-ca-cac-luong"><span>Äáº£m báº£o tÃ­nh hiá»ƒn thá»‹ cá»§a biáº¿n Ä‘á»‘i vá»›i táº¥t cáº£ cÃ¡c luá»“ng</span></a></h5><p>TÃ­nh hiá»ƒn thá»‹ á»Ÿ Ä‘Ã¢y cÃ³ nghÄ©a lÃ  khi má»™t luá»“ng thay Ä‘á»•i giÃ¡ trá»‹ cá»§a biáº¿n <code>volatile</code>, giÃ¡ trá»‹ má»›i sáº½ Ä‘Æ°á»£c cÃ¡c luá»“ng khÃ¡c nhÃ¬n tháº¥y ngay láº­p tá»©c. Trong khi Ä‘Ã³, biáº¿n thÃ´ng thÆ°á»ng khÃ´ng thá»ƒ Ä‘áº¡t Ä‘Æ°á»£c Ä‘iá»u nÃ y, giÃ¡ trá»‹ cá»§a biáº¿n thÃ´ng thÆ°á»ng cáº§n Ä‘Æ°á»£c truyá»n qua bá»™ nhá»› chÃ­nh giá»¯a cÃ¡c luá»“ng.</p><p><strong>QuÃ¡ trÃ¬nh ghi biáº¿n <code>volatile</code> cá»§a má»™t luá»“ng:</strong></p><ol><li>Thay Ä‘á»•i giÃ¡ trá»‹ cá»§a biáº¿n <code>volatile</code> trong bá»™ nhá»› lÃ m viá»‡c cá»§a luá»“ng.</li><li>Äáº©y giÃ¡ trá»‹ Ä‘Ã£ thay Ä‘á»•i tá»« bá»™ nhá»› lÃ m viá»‡c vÃ o bá»™ nhá»› chÃ­nh.</li></ol><p><strong>QuÃ¡ trÃ¬nh Ä‘á»c biáº¿n <code>volatile</code> cá»§a má»™t luá»“ng:</strong></p><ol><li>Äá»c giÃ¡ trá»‹ má»›i nháº¥t cá»§a biáº¿n <code>volatile</code> tá»« bá»™ nhá»› chÃ­nh vÃ o bá»™ nhá»› lÃ m viá»‡c cá»§a luá»“ng.</li><li>Äá»c giÃ¡ trá»‹ cá»§a biáº¿n <code>volatile</code> tá»« bá»™ nhá»› lÃ m viá»‡c.</li></ol><blockquote><p>LÆ°u Ã½: <strong>Äáº£m báº£o tÃ­nh hiá»ƒn thá»‹ khÃ´ng Ä‘á»“ng nghÄ©a vá»›i Ä‘áº£m báº£o tÃ­nh an toÃ n cá»§a hoáº¡t Ä‘á»™ng Ä‘á»“ng thá»i trÃªn biáº¿n <code>volatile</code></strong></p><p>Trong cÃ¡c tÃ¬nh huá»‘ng khÃ´ng Ä‘Ã¡p á»©ng hai Ä‘iá»u kiá»‡n sau, váº«n cáº§n sá»­ dá»¥ng khÃ³a Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh nguyÃªn tá»­:</p><ul><li>Káº¿t quáº£ tÃ­nh toÃ¡n khÃ´ng phá»¥ thuá»™c vÃ o giÃ¡ trá»‹ hiá»‡n táº¡i cá»§a biáº¿n hoáº·c chá»‰ cÃ³ má»™t luá»“ng duy nháº¥t thay Ä‘á»•i giÃ¡ trá»‹ cá»§a biáº¿n.</li><li>Biáº¿n khÃ´ng cáº§n tham gia vÃ o rÃ ng buá»™c khÃ´ng thay Ä‘á»•i cÃ¹ng vá»›i cÃ¡c biáº¿n tráº¡ng thÃ¡i khÃ¡c.</li></ul></blockquote><p>Tuy nhiÃªn, náº¿u nhiá»u luá»“ng cÃ¹ng cáº­p nháº­t giÃ¡ trá»‹ biáº¿n <code>volatile</code> cÃ¹ng má»™t lÃºc, cÃ³ thá»ƒ dáº«n Ä‘áº¿n viá»‡c nháº­n Ä‘Æ°á»£c giÃ¡ trá»‹ khÃ´ng nhÆ° mong Ä‘á»£i:</p><p>VÃ­ dá»¥: Äá»‹nh nghÄ©a <code>volatile int count = 0</code>, 2 luá»“ng thá»±c hiá»‡n Ä‘á»“ng thá»i hoáº¡t Ä‘á»™ng count++ má»—i luá»“ng thá»±c hiá»‡n 500 láº§n, káº¿t quáº£ cuá»‘i cÃ¹ng nhá» hÆ¡n 1000. NguyÃªn nhÃ¢n lÃ  má»—i luá»“ng thá»±c hiá»‡n count++ bao gá»“m 3 bÆ°á»›c sau:</p><ol><li>Luá»“ng Ä‘á»c giÃ¡ trá»‹ count má»›i nháº¥t tá»« bá»™ nhá»› chÃ­nh.</li><li>Bá»™ xá»­ lÃ½ tÄƒng giÃ¡ trá»‹ count lÃªn 1 vÃ  gÃ¡n láº¡i cho bá»™ nhá»› lÃ m viá»‡c cá»§a luá»“ng.</li><li>Luá»“ng lÆ°u giÃ¡ trá»‹ count vÃ o bá»™ nhá»› chÃ­nh. CÃ³ thá»ƒ xáº£y ra tÃ¬nh huá»‘ng 2 luá»“ng cÃ¹ng Ä‘á»c giÃ¡ trá»‹ 100 táº¡i má»™t thá»i Ä‘iá»ƒm, sau Ä‘Ã³ tÄƒng giÃ¡ trá»‹ lÃªn 101 vÃ  cuá»‘i cÃ¹ng lÆ°u 2 láº§n 101 vÃ o bá»™ nhá»› chÃ­nh.</li></ol><h5 id="Ä‘ac-Ä‘iem-2-cam-tai-sap-xep-lenh" tabindex="-1"><a class="header-anchor" href="#Ä‘ac-Ä‘iem-2-cam-tai-sap-xep-lenh"><span>Äáº·c Ä‘iá»ƒm 2: Cáº¥m tÃ¡i sáº¯p xáº¿p lá»‡nh</span></a></h5><p>Cá»¥ thá»ƒ, cÃ¡c quy táº¯c cáº¥m tÃ¡i sáº¯p xáº¿p nhÆ° sau:</p><ul><li>Khi chÆ°Æ¡ng trÃ¬nh thá»±c hiá»‡n phÃ©p Ä‘á»c hoáº·c ghi biáº¿n <code>volatile</code>, táº¥t cáº£ cÃ¡c thay Ä‘á»•i cá»§a cÃ¡c hoáº¡t Ä‘á»™ng trÆ°á»›c Ä‘Ã³ Ä‘Ã£ Ä‘Æ°á»£c thá»±c hiá»‡n vÃ  káº¿t quáº£ Ä‘Ã£ Ä‘Æ°á»£c nhÃ¬n tháº¥y bá»Ÿi cÃ¡c hoáº¡t Ä‘á»™ng sau Ä‘Ã³; cÃ¡c hoáº¡t Ä‘á»™ng sau Ä‘Ã³ chÆ°a Ä‘Æ°á»£c thá»±c hiá»‡n.</li><li>Trong quÃ¡ trÃ¬nh tá»‘i Æ°u hÃ³a lá»‡nh, khÃ´ng thá»ƒ Ä‘áº·t cÃ¡c lá»‡nh truy cáº­p biáº¿n <code>volatile</code> sau cÃ¡c lá»‡nh trÆ°á»›c Ä‘Ã³, cÅ©ng khÃ´ng thá»ƒ Ä‘áº·t cÃ¡c lá»‡nh sau biáº¿n <code>volatile</code> trÆ°á»›c cÃ¡c lá»‡nh trÆ°á»›c Ä‘Ã³.</li></ul><p>Biáº¿n thÃ´ng thÆ°á»ng chá»‰ Ä‘áº£m báº£o ráº±ng táº¥t cáº£ cÃ¡c Ä‘iá»ƒm phá»¥ thuá»™c vÃ o káº¿t quáº£ gÃ¡n trong quÃ¡ trÃ¬nh thá»±c thi phÆ°Æ¡ng thá»©c Ä‘á»u nháº­n Ä‘Æ°á»£c káº¿t quáº£ chÃ­nh xÃ¡c, nhÆ°ng khÃ´ng Ä‘áº£m báº£o thá»© tá»± gÃ¡n giá»¯a cÃ¡c lá»‡nh vÃ  thá»© tá»± thá»±c thi trong mÃ£ chÆ°Æ¡ng trÃ¬nh.</p><p>VÃ­ dá»¥:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">volatile</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> initialized </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// MÃ£ cháº¡y trong luá»“ng A</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Äá»c thÃ´ng tin cáº¥u hÃ¬nh, sau khi Ä‘á»c xong, Ä‘áº·t initialized thÃ nh true Ä‘á»ƒ thÃ´ng bÃ¡o cho cÃ¡c luá»“ng khÃ¡c ráº±ng cáº¥u hÃ¬nh Ä‘Ã£ sáºµn sÃ ng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">doSomethingReadConfg</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">initialized </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// MÃ£ cháº¡y trong luá»“ng B</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Äá»£i initialized trá»Ÿ thÃ nh true, cho biáº¿t luá»“ng A Ä‘Ã£ khá»Ÿi táº¡o xong cáº¥u hÃ¬nh</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">while</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#E06C75;--shiki-dark:#E06C75;">initialized) {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">     sleep</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Sá»­ dá»¥ng thÃ´ng tin cáº¥u hÃ¬nh Ä‘Ã£ Ä‘Æ°á»£c khá»Ÿi táº¡o bá»Ÿi luá»“ng A</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">doSomethingWithConfig</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Trong Ä‘oáº¡n mÃ£ trÃªn, náº¿u biáº¿n <code>initialized</code> khÃ´ng Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  <code>volatile</code>, cÃ³ thá»ƒ xáº£y ra trÆ°á»ng há»£p lá»‡nh cuá»‘i cÃ¹ng cá»§a luá»“ng A &quot;initialized = true&quot; Ä‘Æ°á»£c thá»±c hiá»‡n trÆ°á»›c lá»‡nh &quot;doSomethingReadConfg()&quot;, Ä‘iá»u nÃ y cÃ³ thá»ƒ dáº«n Ä‘áº¿n lá»—i khi luá»“ng B sá»­ dá»¥ng thÃ´ng tin cáº¥u hÃ¬nh. Tuy nhiÃªn, báº±ng cÃ¡ch sá»­ dá»¥ng tá»« khÃ³a <code>volatile</code>, ta cÃ³ thá»ƒ Ä‘áº£m báº£o ráº±ng cÃ¡c lá»‡nh sáº½ khÃ´ng bá»‹ tÃ¡i sáº¯p xáº¿p theo cÃ¡ch nÃ y.</p><h4 id="nguyen-ly-hoat-Ä‘ong-cua-tu-khoa-volatile" tabindex="-1"><a class="header-anchor" href="#nguyen-ly-hoat-Ä‘ong-cua-tu-khoa-volatile"><span>NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng cá»§a tá»« khÃ³a <code>volatile</code></span></a></h4><p>CÃ¡ch thá»©c cá»¥ thá»ƒ lÃ  trong quÃ¡ trÃ¬nh biÃªn dá»‹ch mÃ£ byte, sáº½ chÃ¨n cÃ¡c rÃ o cáº£n bá»™ nhá»› Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh khÃ´ng tÃ¡i sáº¯p xáº¿p. DÆ°á»›i Ä‘Ã¢y lÃ  chiáº¿n lÆ°á»£c chÃ¨n rÃ o cáº£n bá»™ nhá»› dá»±a trÃªn chiáº¿n lÆ°á»£c báº£o thá»§ cá»§a JMM:</p><ul><li>ChÃ¨n má»™t rÃ o cáº£n <code>StoreStore</code> trÆ°á»›c má»—i lá»‡nh ghi <code>volatile</code>. RÃ o cáº£n nÃ y khÃ´ng chá»‰ Ä‘áº£m báº£o ráº±ng cÃ¡c lá»‡nh ghi trÆ°á»›c rÃ o cáº£n vÃ  cÃ¡c lá»‡nh ghi sau rÃ o cáº£n khÃ´ng thá»ƒ tÃ¡i sáº¯p xáº¿p, mÃ  cÃ²n Ä‘áº£m báº£o ráº±ng trÆ°á»›c lá»‡nh ghi <code>volatile</code>, má»i hoáº¡t Ä‘á»™ng Ä‘á»c vÃ  ghi Ä‘á»u pháº£i Ä‘Æ°á»£c thá»±c hiá»‡n trÆ°á»›c khi <code>volatile</code> Ä‘Æ°á»£c gá»­i Ä‘i.</li><li>ChÃ¨n má»™t rÃ o cáº£n <code>StoreLoad</code> sau má»—i lá»‡nh ghi <code>volatile</code>. RÃ o cáº£n nÃ y khÃ´ng chá»‰ ngÄƒn cháº·n viá»‡c tÃ¡i sáº¯p xáº¿p lá»‡nh ghi <code>volatile</code> vá»›i cÃ¡c lá»‡nh Ä‘á»c sau Ä‘Ã³, mÃ  cÃ²n lÃ m cáº­p nháº­t bá»™ nhá»› Ä‘á»‡m cá»§a bá»™ xá»­ lÃ½, Ä‘áº£m báº£o ráº±ng cÃ¡c giÃ¡ trá»‹ ghi vÃ o biáº¿n <code>volatile</code> sáº½ Ä‘Æ°á»£c nhÃ¬n tháº¥y bá»Ÿi cÃ¡c luá»“ng khÃ¡c.</li><li>ChÃ¨n má»™t rÃ o cáº£n <code>LoadLoad</code> sau má»—i lá»‡nh Ä‘á»c <code>volatile</code>. RÃ o cáº£n nÃ y khÃ´ng chá»‰ ngÄƒn cháº·n viá»‡c tÃ¡i sáº¯p xáº¿p lá»‡nh Ä‘á»c <code>volatile</code> vá»›i cÃ¡c lá»‡nh trÆ°á»›c Ä‘Ã³, mÃ  cÃ²n lÃ m cáº­p nháº­t bá»™ nhá»› Ä‘á»‡m cá»§a bá»™ xá»­ lÃ½, Ä‘áº£m báº£o ráº±ng cÃ¡c giÃ¡ trá»‹ Ä‘á»c tá»« biáº¿n <code>volatile</code> lÃ  giÃ¡ trá»‹ má»›i nháº¥t.</li><li>ChÃ¨n má»™t rÃ o cáº£n <code>LoadStore</code> sau má»—i lá»‡nh Ä‘á»c <code>volatile</code>. RÃ o cáº£n nÃ y khÃ´ng chá»‰ cáº¥m tÃ¡i sáº¯p xáº¿p lá»‡nh Ä‘á»c <code>volatile</code> vá»›i báº¥t ká»³ lá»‡nh ghi nÃ o sau Ä‘Ã³, mÃ  cÃ²n lÃ m cáº­p nháº­t bá»™ nhá»› Ä‘á»‡m cá»§a bá»™ xá»­ lÃ½, Ä‘áº£m báº£o ráº±ng cÃ¡c luá»“ng khÃ¡c cÃ³ thá»ƒ nhÃ¬n tháº¥y cÃ¡c giÃ¡ trá»‹ ghi vÃ o biáº¿n <code>volatile</code> bá»Ÿi cÃ¡c luá»“ng khÃ¡c.</li></ul><h4 id="cac-truong-hop-su-dung-cua-tu-khoa-volatile" tabindex="-1"><a class="header-anchor" href="#cac-truong-hop-su-dung-cua-tu-khoa-volatile"><span>CÃ¡c trÆ°á»ng há»£p sá»­ dá»¥ng cá»§a tá»« khÃ³a <code>volatile</code></span></a></h4><p>TÃ³m láº¡i, tá»« khÃ³a <code>volatile</code> Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ &quot;ghi má»™t láº§n, Ä‘á»c á»Ÿ nhiá»u nÆ¡i&quot;, má»™t luá»“ng Ä‘áº£m nháº­n viá»‡c cáº­p nháº­t biáº¿n, cÃ¡c luá»“ng khÃ¡c chá»‰ Ä‘á»c biáº¿n (khÃ´ng cáº­p nháº­t) vÃ  thá»±c hiá»‡n cÃ¡c logic tÆ°Æ¡ng á»©ng dá»±a trÃªn giÃ¡ trá»‹ má»›i cá»§a biáº¿n. VÃ­ dá»¥: cáº­p nháº­t tráº¡ng thÃ¡i, phÃ¡t hÃ nh giÃ¡ trá»‹ biáº¿n trong mÃ´ hÃ¬nh quan sÃ¡t.</p><h2 id="synchronized" tabindex="-1"><a class="header-anchor" href="#synchronized"><span>synchronized</span></a></h2><h3 id="quy-tac-Ä‘ac-biet-cho-bien-kieu-long-va-double" tabindex="-1"><a class="header-anchor" href="#quy-tac-Ä‘ac-biet-cho-bien-kieu-long-va-double"><span>Quy táº¯c Ä‘áº·c biá»‡t cho biáº¿n kiá»ƒu long vÃ  double</span></a></h3><p>JMM yÃªu cáº§u cÃ¡c hoáº¡t Ä‘á»™ng lock, unlock, read, load, assign, use, store, write (8 loáº¡i hoáº¡t Ä‘á»™ng nÃ y) Ä‘á»u cÃ³ tÃ­nh nguyÃªn tá»­, nhÆ°ng Ä‘á»‘i vá»›i kiá»ƒu dá»¯ liá»‡u 64 bit (long vÃ  double), JMM Ä‘á»‹nh nghÄ©a má»™t quy táº¯c Ä‘áº·c biá»‡t vÃ  linh hoáº¡t hÆ¡n: cho phÃ©p mÃ¡y áº£o chia hoáº¡t Ä‘á»™ng Ä‘á»c vÃ  ghi dá»¯ liá»‡u 64 bit thÃ nh 2 hoáº¡t Ä‘á»™ng 32 bit, cÃ³ nghÄ©a lÃ  mÃ¡y áº£o cÃ³ thá»ƒ khÃ´ng Ä‘áº£m báº£o tÃ­nh nguyÃªn tá»­ cá»§a cÃ¡c hoáº¡t Ä‘á»™ng load, store, read vÃ  write (4 loáº¡i hoáº¡t Ä‘á»™ng nÃ y) Ä‘á»‘i vá»›i kiá»ƒu dá»¯ liá»‡u 64 bit chÆ°a Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  <code>volatile</code>. Do tÃ­nh khÃ´ng nguyÃªn tá»­ nÃ y, cÃ³ thá»ƒ xáº£y ra trÆ°á»ng há»£p cÃ¡c luá»“ng khÃ¡c Ä‘á»c giÃ¡ trá»‹ &quot;má»™t ná»­a biáº¿n&quot; chÆ°a hoÃ n thÃ nh Ä‘á»“ng bá»™.</p><p>Tuy nhiÃªn, trong thá»±c táº¿, Java Memory Model (JMM) khuyáº¿n nghá»‹ máº¡nh máº½ ráº±ng mÃ¡y áº£o nÃªn Ä‘áº£m báº£o tÃ­nh nguyÃªn tá»­ cá»§a hoáº¡t Ä‘á»™ng Ä‘á»c vÃ  ghi dá»¯ liá»‡u 64 bit. Hiá»‡n nay, cÃ¡c mÃ¡y áº£o thÆ°Æ¡ng máº¡i trÃªn cÃ¡c ná»n táº£ng khÃ¡c nhau Ä‘á»u chá»n xem xÃ©t hoáº¡t Ä‘á»™ng Ä‘á»c vÃ  ghi dá»¯ liá»‡u 64 bit lÃ  hoáº¡t Ä‘á»™ng nguyÃªn tá»­. Do Ä‘Ã³, khi viáº¿t mÃ£, chÃºng ta khÃ´ng cáº§n pháº£i Ä‘Ã¡nh dáº¥u biáº¿n long vÃ  double lÃ  <code>volatile</code>.</p><h3 id="quy-tac-Ä‘ac-biet-cho-bien-final" tabindex="-1"><a class="header-anchor" href="#quy-tac-Ä‘ac-biet-cho-bien-final"><span>Quy táº¯c Ä‘áº·c biá»‡t cho biáº¿n final</span></a></h3><p>ChÃºng ta biáº¿t ráº±ng, biáº¿n thÃ nh viÃªn final pháº£i Ä‘Æ°á»£c khá»Ÿi táº¡o khi khai bÃ¡o hoáº·c trong constructor, náº¿u khÃ´ng sáº½ bá»‹ lá»—i biÃªn dá»‹ch. TÃ­nh hiá»‡u quáº£ cá»§a tá»« khÃ³a <code>final</code> lÃ : khi biáº¿n Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u lÃ  <code>final</code> vÃ  Ä‘Ã£ Ä‘Æ°á»£c khá»Ÿi táº¡o hoÃ n táº¥t trong quÃ¡ trÃ¬nh khai bÃ¡o hoáº·c constructor, thÃ¬ trong cÃ¡c luá»“ng khÃ¡c khÃ´ng cáº§n Ä‘á»“ng bá»™ hÃ³a, giÃ¡ trá»‹ cá»§a biáº¿n <code>final</code> cÃ³ thá»ƒ Ä‘Æ°á»£c nhÃ¬n tháº¥y Ä‘Ãºng. Äiá»u nÃ y xáº£y ra vÃ¬ khi khá»Ÿi táº¡o hoÃ n táº¥t, giÃ¡ trá»‹ cá»§a biáº¿n <code>final</code> Ä‘Æ°á»£c ghi ngay láº­p tá»©c vÃ o bá»™ nhá»› chÃ­nh.</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/programming/java/Concurency/Java Memory Model.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/programming/java/Concurency/Java%20Lock.html" aria-label="Java Lock"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->Java Lock</div></a><a class="route-link auto-link next" href="/programming/java/Concurency/Java%20Thread%20Basic.html" aria-label="Java Thread Basic"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Java Thread Basic<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with â¤ï¸ by Hung Nguyen</div><div class="copyright">Copyright Â© 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-BsgpqssW.js" defer></script>
  </body>
</html>
