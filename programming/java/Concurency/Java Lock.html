<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.12" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.46" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/programming/java/Concurency/Java%20Lock.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="Java Lock"><meta property="og:description" content="Hiá»ƒu sÃ¢u vá» khÃ³a Ä‘á»“ng thá»i trong Java BÃ i viáº¿t nÃ y trÆ°á»›c tiÃªn sáº½ giáº£i thÃ­ch khÃ¡i niá»‡m vá» cÃ¡c loáº¡i khÃ³a trong Java. Sau Ä‘Ã³, giá»›i thiá»‡u vá» cÆ¡ cháº¿ cá»‘t lÃµi cá»§a khÃ³a lÃ  AQS. Tiáº¿p the..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/vanhung4499/images/master/snap/JavaAQSLinkedList.png"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-06-28T15:54:38.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:tag" content="java"><meta property="article:tag" content="javase"><meta property="article:tag" content="concurrency"><meta property="article:modified_time" content="2024-06-28T15:54:38.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Java Lock","image":["https://raw.githubusercontent.com/vanhung4499/images/master/snap/JavaAQSLinkedList.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/AQSBefore.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/AQSAcquire.png"],"dateModified":"2024-06-28T15:54:38.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>Java Lock | VanHung4499</title><meta name="description" content="Hiá»ƒu sÃ¢u vá» khÃ³a Ä‘á»“ng thá»i trong Java BÃ i viáº¿t nÃ y trÆ°á»›c tiÃªn sáº½ giáº£i thÃ­ch khÃ¡i niá»‡m vá» cÃ¡c loáº¡i khÃ³a trong Java. Sau Ä‘Ã³, giá»›i thiá»‡u vá» cÆ¡ cháº¿ cá»‘t lÃµi cá»§a khÃ³a lÃ  AQS. Tiáº¿p the...">
    <link rel="preload" href="/assets/style-BqjKxtxe.css" as="style"><link rel="stylesheet" href="/assets/style-BqjKxtxe.css">
    <link rel="modulepreload" href="/assets/app-fjbxAy1X.js"><link rel="modulepreload" href="/assets/Java Lock.html-CzLeNy7G.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link route-link-active auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/project/" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon><!--]-->Project<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Advanced</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">Basic</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/programming/java/collection/" aria-label="Collection"><!---->Collection<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><!----><span class="vp-sidebar-title">Concurency</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Atomic%20Class.html" aria-label="Java Atomic Class"><!---->Java Atomic Class<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Concurent%20Tools.html" aria-label="Java Concurent Tools"><!---->Java Concurent Tools<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Concurrency%20Core%20Mechanism.html" aria-label="Java Concurrency Core Mechanism"><!---->Java Concurrency Core Mechanism<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Concurrency%20Intro.html" aria-label="Java Concurrency Intro"><!---->Java Concurrency Intro<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Concurrent%20Collection.html" aria-label="Java Concurrent Collection"><!---->Java Concurrent Collection<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20ForkJoin.html" aria-label="Java ForkJoin"><!---->Java ForkJoin<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link vp-sidebar-page active" href="/programming/java/Concurency/Java%20Lock.html" aria-label="Java Lock"><!---->Java Lock<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Memory%20Model.html" aria-label="Java Memory Model"><!---->Java Memory Model<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Thread%20Basic.html" aria-label="Java Thread Basic"><!---->Java Thread Basic<!----></a></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/Concurency/Java%20Thread%20Pool.html" aria-label="Java Thread Pool"><!---->Java Thread Pool<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">IO</span><span class="vp-arrow end"></span></button><!----></section></li><li><a class="route-link auto-link vp-sidebar-link vp-sidebar-page" href="/programming/java/JavaSE%20MOC.html" aria-label="JavaSE MOC"><!---->JavaSE MOC<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><!----><span class="vp-sidebar-title">JVM</span><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Java Lock</h1><div class="page-info"><span class="page-author-info" aria-label="AuthorğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing DateğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-06-28T15:54:38.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading TimeâŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 43 min</span><meta property="timeRequired" content="PT43M"></span><span class="page-category-info" aria-label="CategoryğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color8 clickable" role="navigation">java</span><span class="page-category-item color1 clickable" role="navigation">javase</span><span class="page-category-item color5 clickable" role="navigation">concurrency</span><!--]--><meta property="articleSection" content="java,javase,concurrency"></span><span class="page-tag-info" aria-label="TagğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">java</span><span class="page-tag-item color1 clickable" role="navigation">javase</span><span class="page-tag-item color5 clickable" role="navigation">concurrency</span><!--]--><meta property="keywords" content="java,javase,concurrency"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#gioi-thieu-ve-khoa-Ä‘ong-thoi">Giá»›i thiá»‡u vá» khÃ³a Ä‘á»“ng thá»i</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#khoa-co-the-tai-nhap">KhÃ³a cÃ³ thá»ƒ tÃ¡i nháº­p</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#khoa-cong-bang-va-khoa-khong-cong-bang">KhÃ³a cÃ´ng báº±ng vÃ  khÃ³a khÃ´ng cÃ´ng báº±ng</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#khoa-Ä‘oc-quyen-va-khoa-chia-se">KhÃ³a Ä‘á»™c quyá»n vÃ  khÃ³a chia sáº»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#khoa-bi-quan-va-khoa-lac-quan">KhÃ³a bi quan vÃ  khÃ³a láº¡c quan</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#khoa-thien-vi-khoa-nhe-va-khoa-nang">KhÃ³a thiÃªn vá»‹, khÃ³a nháº¹ vÃ  khÃ³a náº·ng</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#khoa-phan-Ä‘oan">KhÃ³a phÃ¢n Ä‘oáº¡n</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#khoa-hien-thi-va-khoa-noi-tai">KhÃ³a hiá»ƒn thá»‹ vÃ  khÃ³a ná»™i táº¡i</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#lock-va-condition">Lock vÃ  Condition</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tai-sao-can-su-dung-lock-va-condition">Táº¡i sao cáº§n sá»­ dá»¥ng Lock vÃ  Condition</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#giao-dien-lock">Giao diá»‡n Lock</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#condition">Condition</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#reentrantlock">ReentrantLock</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#Ä‘ac-Ä‘iem-cua-reentrantlock">Äáº·c Ä‘iá»ƒm cá»§a ReentrantLock</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cach-su-dung-reentrantlock">CÃ¡ch sá»­ dá»¥ng ReentrantLock</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nguyen-ly-cua-reentrantlock">NguyÃªn lÃ½ cá»§a ReentrantLock</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#reentrantreadwritelock">ReentrantReadWriteLock</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tinh-nang-cua-reentrantreadwritelock">TÃ­nh nÄƒng cá»§a ReentrantReadWriteLock</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cach-su-dung-reentrantreadwritelock">CÃ¡ch sá»­ dá»¥ng ReentrantReadWriteLock</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nguyen-ly-hoat-Ä‘ong-cua-reentrantreadwritelock">NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng cá»§a ReentrantReadWriteLock</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#stampedlock">StampedLock</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#aqs">AQS</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#Ä‘iem-chinh-cua-aqs">Äiá»ƒm chÃ­nh cá»§a AQS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ung-dung-cua-aqs">á»¨ng dá»¥ng cá»§a AQS</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nguyen-ly-hoat-Ä‘ong-cua-aqs">NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng cá»§a AQS</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#deadlock">Deadlock</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#deadlock-la-gi">Deadlock lÃ  gÃ¬</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cach-xac-Ä‘inh-deadlock">CÃ¡ch xÃ¡c Ä‘á»‹nh Deadlock</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#cach-tranh-deadlock">CÃ¡ch trÃ¡nh Deadlock</a></li><!----><!--]--></ul></li><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="hieu-sau-ve-khoa-Ä‘ong-thoi-trong-java" tabindex="-1"><a class="header-anchor" href="#hieu-sau-ve-khoa-Ä‘ong-thoi-trong-java"><span>Hiá»ƒu sÃ¢u vá» khÃ³a Ä‘á»“ng thá»i trong Java</span></a></h1><blockquote><p>BÃ i viáº¿t nÃ y trÆ°á»›c tiÃªn sáº½ giáº£i thÃ­ch khÃ¡i niá»‡m vá» cÃ¡c loáº¡i khÃ³a trong Java.</p><p>Sau Ä‘Ã³, giá»›i thiá»‡u vá» cÆ¡ cháº¿ cá»‘t lÃµi cá»§a khÃ³a lÃ  AQS.</p><p>Tiáº¿p theo, táº­p trung giá»›i thiá»‡u hai giao diá»‡n Lock vÃ  Condition vÃ  cÃ¡c cÃ i Ä‘áº·t cá»§a chÃºng. Láº­p trÃ¬nh Ä‘á»“ng thá»i cÃ³ hai váº¥n Ä‘á» cá»‘t lÃµi: Ä‘á»“ng bá»™ vÃ  mutex.</p><p><strong>Mutex</strong> cÃ³ nghÄ©a lÃ  chá»‰ cho phÃ©p má»™t luá»“ng truy cáº­p tÃ i nguyÃªn chung vÃ o cÃ¹ng má»™t thá»i Ä‘iá»ƒm;</p><p><strong>Äá»“ng bá»™</strong> lÃ  cÃ¡ch cÃ¡c luá»“ng giao tiáº¿p vÃ  há»£p tÃ¡c vá»›i nhau.</p><p>Cáº£ hai váº¥n Ä‘á» nÃ y Ä‘á»u cÃ³ thá»ƒ Ä‘Æ°á»£c giáº£i quyáº¿t báº±ng cÃ¡ch sá»­ dá»¥ng cÆ¡ cháº¿ quáº£n lÃ½ (synchronized). <strong>GÃ³i J.U.C cung cáº¥p hai giao diá»‡n Lock vÃ  Condition Ä‘á»ƒ triá»ƒn khai cÆ¡ cháº¿ quáº£n lÃ½, trong Ä‘Ã³ Lock Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» tÆ°Æ¡ng há»— vÃ  Condition Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» Ä‘á»“ng bá»™</strong>.</p></blockquote><h2 id="gioi-thieu-ve-khoa-Ä‘ong-thoi" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-ve-khoa-Ä‘ong-thoi"><span>Giá»›i thiá»‡u vá» khÃ³a Ä‘á»“ng thá»i</span></a></h2><p>Má»™t cÃ¡ch phá»• biáº¿n Ä‘á»ƒ Ä‘áº£m báº£o an toÃ n Ä‘á»“ng thá»i lÃ  sá»­ dá»¥ng cÃ¡c cÆ¡ cháº¿ khÃ³a (Lock, synchronized) Ä‘á»ƒ Ä‘á»“ng bá»™ hÃ³a dá»¯ liá»‡u chia sáº», Ä‘áº£m báº£o chá»‰ cÃ³ má»™t luá»“ng cÃ³ thá»ƒ thá»±c thi má»™t phÆ°Æ¡ng thá»©c hoáº·c má»™t Ä‘oáº¡n mÃ£ cÃ¹ng má»™t thá»i Ä‘iá»ƒm. Äiá»u nÃ y Ä‘áº£m báº£o cÃ¡c hoáº¡t Ä‘á»™ng Ä‘Æ°á»£c thá»±c hiá»‡n má»™t cÃ¡ch nguyÃªn tá»­ vÃ  an toÃ n cho luá»“ng.</p><p>Trong cÃ´ng viá»‡c vÃ  phá»ng váº¥n, chÃºng ta thÆ°á»ng nghe tháº¥y nhiá»u loáº¡i khÃ³a khÃ¡c nhau, khiáº¿n ngÆ°á»i nghe mÆ¡ há»“. CÃ³ nhiá»u thuáº­t ngá»¯ vÃ  khÃ¡i niá»‡m liÃªn quan Ä‘áº¿n khÃ³a, nhÆ°ng chÃºng Ä‘Æ°á»£c Ä‘Æ°a ra Ä‘á»ƒ giáº£i quyáº¿t cÃ¡c váº¥n Ä‘á» khÃ¡c nhau vÃ  thÃ´ng qua viá»‡c táº¡o ra má»™t báº£n tÃ³m táº¯t Ä‘Æ¡n giáº£n, chÃºng ta cÅ©ng khÃ´ng khÃ³ Ä‘á»ƒ hiá»ƒu.</p><h3 id="khoa-co-the-tai-nhap" tabindex="-1"><a class="header-anchor" href="#khoa-co-the-tai-nhap"><span>KhÃ³a cÃ³ thá»ƒ tÃ¡i nháº­p</span></a></h3><p><strong>KhÃ³a cÃ³ thá»ƒ tÃ¡i nháº­p cho phÃ©p má»™t luá»“ng cÃ³ thá»ƒ láº¥y láº¡i cÃ¹ng má»™t khÃ³a</strong>. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  má»™t luá»“ng Â cÃ³ Ä‘Æ°á»£c khÃ³a trong phÆ°Æ¡ng thá»©c bÃªn ngoÃ i vÃ  tá»± Ä‘á»™ng cÃ³ Ä‘Æ°á»£c khÃ³a khi nháº­p phÆ°Æ¡ng thá»©c bÃªn trong.</p><p><strong>KhÃ³a cÃ³ thá»ƒ tÃ¡i nháº­p giÃºp trÃ¡nh tÃ¬nh tráº¡ng báº¿ táº¯c á»Ÿ má»™t má»©c Ä‘á»™ nháº¥t Ä‘á»‹nh.</strong></p><ul><li><code>ReentrantLock</code> vÃ  <code>ReentrantReadWriteLock</code> lÃ  cÃ¡c khÃ³a cÃ³ thá»ƒ tÃ¡i nháº­p. Äiá»u nÃ y rÃµ rÃ ng tá»« tÃªn cá»§a chÃºng.</li><li><code>synchronized</code> cÅ©ng lÃ  má»™t khÃ³a cÃ³ thá»ƒ tÃ¡i nháº­p.</li></ul><p>ã€VÃ­ dá»¥ã€‘VÃ­ dá»¥ vá» khÃ³a cÃ³ thá»ƒ tÃ¡i nháº­p <code>synchronized</code></p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">synchronized</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> setA</span><span style="color:#E06C75;--shiki-dark:#E06C75;">() throws Exception{</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    setB</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">synchronized</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> setB</span><span style="color:#E06C75;--shiki-dark:#E06C75;">() throws Exception{</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>Äoáº¡n mÃ£ trÃªn lÃ  má»™t tÃ¬nh huá»‘ng Ä‘iá»ƒn hÃ¬nh: Náº¿u khÃ³a khÃ´ng pháº£i lÃ  khÃ³a cÃ³ thá»ƒ tÃ¡i nháº­p, <code>setB</code> cÃ³ thá»ƒ khÃ´ng Ä‘Æ°á»£c thá»±c thi bá»Ÿi luá»“ng hiá»‡n táº¡i, dáº«n Ä‘áº¿n tÃ¬nh tráº¡ng báº¿ táº¯c.</p><p>ã€VÃ­ dá»¥ã€‘VÃ­ dá»¥ vá» khÃ³a cÃ³ thá»ƒ tÃ¡i nháº­p <code>ReentrantLock</code></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Task</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Lock</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> lock </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ReentrantLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Task</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Láº¥y khÃ³a</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> value;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Äáº£m báº£o khÃ³a Ä‘Æ°á»£c giáº£i phÃ³ng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> addOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Láº¥y khÃ³a</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // LÆ°u Ã½: á» Ä‘Ã¢y Ä‘Ã£ láº¥y khÃ³a thÃ nh cÃ´ng, sau Ä‘Ã³ vÃ o phÆ°Æ¡ng thá»©c get, láº¡i thá»­ láº¥y khÃ³a,</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Náº¿u khÃ³a khÃ´ng thá»ƒ láº·p láº¡i, sáº½ dáº«n Ä‘áº¿n tÃ¬nh tráº¡ng báº¿ táº¯c</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            value </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Äáº£m báº£o khÃ³a Ä‘Æ°á»£c giáº£i phÃ³ng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="khoa-cong-bang-va-khoa-khong-cong-bang" tabindex="-1"><a class="header-anchor" href="#khoa-cong-bang-va-khoa-khong-cong-bang"><span>KhÃ³a cÃ´ng báº±ng vÃ  khÃ³a khÃ´ng cÃ´ng báº±ng</span></a></h3><ul><li><strong>KhÃ³a cÃ´ng báº±ng</strong> - KhÃ³a cÃ´ng báº±ng Ä‘áº£m báº£o ráº±ng <strong>nhiá»u luá»“ng Ä‘Æ°á»£c láº¥y khÃ³a theo thá»© tá»± yÃªu cáº§u</strong>.</li><li><strong>KhÃ³a khÃ´ng cÃ´ng báº±ng</strong> - KhÃ³a khÃ´ng cÃ´ng báº±ng khÃ´ng Ä‘áº£m báº£o thá»© tá»± yÃªu cáº§u khi láº¥y khÃ³a. Äiá»u nÃ y cÃ³ thá»ƒ dáº«n Ä‘áº¿n viá»‡c Æ°u tiÃªn Ä‘áº£o ngÆ°á»£c (luá»“ng má»›i hÆ¡n Ä‘Æ°á»£c láº¥y khÃ³a trÆ°á»›c) hoáº·c tÃ¬nh tráº¡ng Ä‘Ã³i (má»™t luá»“ng luÃ´n bá»‹ cháº·n bá»Ÿi cÃ¡c luá»“ng khÃ¡c).</li></ul><p>KhÃ³a cÃ´ng báº±ng cÃ³ thá»ƒ giáº£m hiá»‡u suáº¥t vÃ¬ pháº£i tuÃ¢n thá»§ thá»© tá»± yÃªu cáº§u, trong khi khÃ³a khÃ´ng cÃ´ng báº±ng cÃ³ thá»ƒ tÄƒng hiá»‡u suáº¥t vÃ¬ khÃ´ng cáº§n tuÃ¢n thá»§ thá»© tá»± yÃªu cáº§u.</p><p>KhÃ³a cÃ´ng báº±ng vÃ  khÃ³a khÃ´ng cÃ´ng báº±ng trong Java:</p><ul><li><code>synchronized</code> chá»‰ há»— trá»£ khÃ³a khÃ´ng cÃ´ng báº±ng.</li><li><code>ReentrantLock</code> há»— trá»£ khÃ³a khÃ´ng cÃ´ng báº±ng vÃ  khÃ³a cÃ´ng báº±ng.</li></ul><h3 id="khoa-Ä‘oc-quyen-va-khoa-chia-se" tabindex="-1"><a class="header-anchor" href="#khoa-Ä‘oc-quyen-va-khoa-chia-se"><span>KhÃ³a Ä‘á»™c quyá»n vÃ  khÃ³a chia sáº»</span></a></h3><p>KhÃ³a riÃªng vÃ  khÃ³a chia sáº» lÃ  má»™t cÃ¡ch nÃ³i rá»™ng, thÆ°á»ng Ä‘Æ°á»£c gá»i lÃ  khÃ³a tÆ°Æ¡ng há»— vÃ  khÃ³a Ä‘á»c ghi.</p><ul><li><strong>KhÃ³a Ä‘á»™c quyá»n</strong> - KhÃ³a Ä‘á»™c quyá»n chá»‰ cho phÃ©p <strong>má»™t luá»“ng duy nháº¥t náº¯m giá»¯ khÃ³a</strong>.</li><li><strong>KhÃ³a chia sáº»</strong> - KhÃ³a chia sáº» cho phÃ©p <strong>nhiá»u luá»“ng náº¯m giá»¯ khÃ³a</strong>.</li></ul><p>KhÃ³a Ä‘á»™c quyá»n vÃ  khÃ³a chia sáº» trong Java:</p><ul><li><code>synchronized</code> vÃ  <code>ReentrantLock</code> chá»‰ há»— trá»£ khÃ³a Ä‘á»™c quyá»n.</li><li><code>ReentrantReadWriteLock</code> há»— trá»£ khÃ³a chia sáº» vÃ  khÃ³a Ä‘á»™c quyá»n. KhÃ³a Ä‘á»c lÃ  khÃ³a chia sáº», cho phÃ©p nhiá»u luá»“ng Ä‘á»c cÃ¹ng má»™t lÃºc, trong khi khÃ³a ghi lÃ  khÃ³a Ä‘á»™c quyá»n, chá»‰ cho phÃ©p má»™t luá»“ng ghi vÃ o cÃ¹ng má»™t thá»i Ä‘iá»ƒm.</li></ul><h3 id="khoa-bi-quan-va-khoa-lac-quan" tabindex="-1"><a class="header-anchor" href="#khoa-bi-quan-va-khoa-lac-quan"><span>KhÃ³a bi quan vÃ  khÃ³a láº¡c quan</span></a></h3><p>KhÃ³a bi quan vÃ  khÃ³a láº¡c quan khÃ´ng chá»‰ Ä‘á» cáº­p Ä‘áº¿n loáº¡i cá»¥ thá»ƒ cá»§a khÃ³a, mÃ  cÃ²n Ä‘á» cáº­p Ä‘áº¿n <strong>chiáº¿n lÆ°á»£c xá»­ lÃ½ Ä‘á»“ng thá»i</strong>.</p><ul><li><strong>KhÃ³a bi quan</strong> - KhÃ³a bi quan Ä‘á»‘i xá»­ vá»›i Ä‘á»“ng thá»i má»™t cÃ¡ch bi quan, cho ráº±ng: <strong>CÃ¡c hoáº¡t Ä‘á»™ng Ä‘á»“ng thá»i mÃ  khÃ´ng cÃ³ khÃ³a sáº½ gáº·p váº¥n Ä‘á»</strong>. KhÃ³a bi quan thÃ­ch há»£p cho cÃ¡c tÃ¬nh huá»‘ng cÃ³ táº§n suáº¥t ghi cao.</li><li><strong>KhÃ³a láº¡c quan</strong> - KhÃ³a láº¡c quan Ä‘á»‘i xá»­ vá»›i Ä‘á»“ng thá»i má»™t cÃ¡ch láº¡c quan, cho ráº±ng: <strong>CÃ¡c hoáº¡t Ä‘á»™ng Ä‘á»“ng thá»i mÃ  khÃ´ng cÃ³ khÃ³a cÅ©ng khÃ´ng gáº·p váº¥n Ä‘á»</strong>. Trong quÃ¡ trÃ¬nh cáº­p nháº­t dá»¯ liá»‡u, sáº½ liÃªn tá»¥c thá»­ nghiá»‡m cáº­p nháº­t dá»¯ liá»‡u. KhÃ³a láº¡c quan thÃ­ch há»£p cho cÃ¡c tÃ¬nh huá»‘ng Ä‘á»c nhiá»u, ghi Ã­t.</li></ul><p>KhÃ³a bi quan vÃ  khÃ³a láº¡c quan trong Java:</p><ul><li>KhÃ³a bi quan trong Java Ä‘Æ°á»£c thá»±c hiá»‡n báº±ng cÃ¡ch sá»­ dá»¥ng <code>synchronized</code> vÃ  <code>Lock</code> Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c Ä‘á»“ng bá»™ hÃ³a cháº·t cháº½. ÄÃ¢y lÃ  loáº¡i Ä‘á»“ng bá»™ hÃ³a cháº·t cháº½.</li><li>KhÃ³a láº¡c quan trong Java Ä‘Æ°á»£c thá»±c hiá»‡n báº±ng cÃ¡ch sá»­ dá»¥ng cÆ¡ cháº¿ <code>CAS</code> (Compare and Swap) trong cÃ¡c lá»›p atomic, nhÆ° <code>AtomicInteger</code>, <code>AtomicLong</code>, <code>AtomicReference</code>,â€¦ ÄÃ¢y lÃ  loáº¡i Ä‘á»“ng bá»™ hÃ³a lá»ng láº»o.</li></ul><h3 id="khoa-thien-vi-khoa-nhe-va-khoa-nang" tabindex="-1"><a class="header-anchor" href="#khoa-thien-vi-khoa-nhe-va-khoa-nang"><span>KhÃ³a thiÃªn vá»‹, khÃ³a nháº¹ vÃ  khÃ³a náº·ng</span></a></h3><p>KhÃ³a thiÃªn vá»‹, khÃ³a nháº¹ vÃ  khÃ³a náº·ng Ä‘á» cáº­p Ä‘áº¿n Ä‘á»™ tinh vi cá»§a viá»‡c kiá»ƒm soÃ¡t khÃ³a. RÃµ rÃ ng, Ä‘á»™ tinh vi cÃ ng cao, chi phÃ­ cháº·n cÃ ng tháº¥p vÃ  Ä‘á»“ng thá»i cÃ ng cao.</p><p>TrÆ°á»›c Java 1.6, khÃ³a náº·ng thÆ°á»ng chá»‰ Ä‘á» cáº­p Ä‘áº¿n <code>synchronized</code>, trong khi khÃ³a nháº¹ thÆ°á»ng chá»‰ Ä‘á» cáº­p Ä‘áº¿n <code>volatile</code>.</p><p>Sau Java 1.6, <code>synchronized</code> Ä‘Ã£ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a Ä‘Ã¡ng ká»ƒ vÃ  Ä‘Ã£ giá»›i thiá»‡u 4 tráº¡ng thÃ¡i khÃ³a: khÃ´ng khÃ³a, khÃ³a thiÃªn vá»‹, khÃ³a nháº¹ vÃ  khÃ³a náº·ng. KhÃ³a cÃ³ thá»ƒ nÃ¢ng cáº¥p tá»« khÃ³a thiÃªn vá»‹ sang khÃ³a nháº¹, sau Ä‘Ã³ tá»« khÃ³a nháº¹ nÃ¢ng cáº¥p sang khÃ³a náº·ng.</p><ul><li><strong>KhÃ³a thiÃªn vá»‹</strong> - KhÃ³a thiÃªn vá»‹ lÃ  khi má»™t Ä‘oáº¡n mÃ£ Ä‘á»“ng thá»i Ä‘Æ°á»£c truy cáº­p bá»Ÿi má»™t luá»“ng duy nháº¥t, luá»“ng Ä‘Ã³ sáº½ tá»± Ä‘á»™ng láº¥y khÃ³a. Äiá»u nÃ y giáº£m chi phÃ­ láº¥y khÃ³a.</li><li><strong>KhÃ³a nháº¹</strong> - KhÃ³a nháº¹ xáº£y ra khi khÃ³a thiÃªn vá»‹ Ä‘Æ°á»£c truy cáº­p bá»Ÿi má»™t luá»“ng khÃ¡c, khÃ³a thiÃªn vá»‹ sáº½ tiáº¿n hÃ³a thÃ nh khÃ³a nháº¹. CÃ¡c luá»“ng khÃ¡c sáº½ thá»­ láº¥y khÃ³a báº±ng cÃ¡ch quay vÃ²ng, khÃ´ng cháº·n, tá»« Ä‘Ã³ tÄƒng hiá»‡u suáº¥t.</li><li><strong>KhÃ³a náº·ng</strong> - KhÃ³a náº·ng xáº£y ra khi khÃ³a nháº¹ khÃ´ng thÃ nh cÃ´ng sau má»™t sá»‘ láº§n quay vÃ²ng. Luá»“ng khÃ¡c sáº½ chuyá»ƒn sang cháº¿ Ä‘á»™ cháº·n, Ä‘iá»u nÃ y giáº£m hiá»‡u suáº¥t.</li></ul><h3 id="khoa-phan-Ä‘oan" tabindex="-1"><a class="header-anchor" href="#khoa-phan-Ä‘oan"><span>KhÃ³a phÃ¢n Ä‘oáº¡n</span></a></h3><p>KhÃ³a phÃ¢n Ä‘oáº¡n thá»±c cháº¥t lÃ  má»™t thiáº¿t káº¿ khÃ³a, khÃ´ng pháº£i lÃ  má»™t loáº¡i khÃ³a cá»¥ thá»ƒ. Ã nghÄ©a cá»§a khÃ³a phÃ¢n Ä‘oáº¡n lÃ  chia Ä‘á»‘i tÆ°á»£ng khÃ³a thÃ nh nhiá»u phÃ¢n Ä‘oáº¡n, má»—i phÃ¢n Ä‘oáº¡n Ä‘Æ°á»£c Ä‘iá»u khiá»ƒn Ä‘á»™c láº­p, giÃºp tÄƒng Ä‘á»™ tinh vi cá»§a khÃ³a, giáº£m thiá»ƒu táº£i chá» vÃ  tÄƒng cÆ°á»ng Ä‘á»“ng thá»i. Äiá»u nÃ y dá»… hiá»ƒu, giá»‘ng nhÆ° cÃ¡c tráº¡m thu phÃ­ trÃªn Ä‘Æ°á»ng cao tá»‘c, náº¿u chá»‰ cÃ³ má»™t lÃ n thu phÃ­, táº¥t cáº£ cÃ¡c xe chá»‰ cÃ³ thá»ƒ xáº¿p hÃ ng Ä‘á»ƒ thanh toÃ¡n; nhÆ°ng náº¿u cÃ³ nhiá»u lÃ n thu phÃ­, viá»‡c phÃ¢n lÃ n sáº½ Ä‘Æ°á»£c thá»±c hiá»‡n.</p><p><code>Hashtable</code> sá»­ dá»¥ng tá»« khÃ³a <code>synchronized</code> Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh toÃ n váº¹n cá»§a luá»“ng, khi má»™t luá»“ng truy cáº­p vÃ o dá»¯ liá»‡u cá»§a <code>Hashtable</code>, <code>Hashtable</code> sáº½ khÃ³a toÃ n bá»™ Ä‘á»‘i tÆ°á»£ng, táº¥t cáº£ cÃ¡c luá»“ng khÃ¡c chá»‰ cÃ³ thá»ƒ chá» Ä‘á»£i, cÃ¡ch tiáº¿p cáº­n nÃ y giáº£m hiá»‡u suáº¥t xá»­ lÃ½.</p><p>TrÆ°á»›c Java 1.7, <code>ConcurrentHashMap</code> lÃ  má»™t vÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh vá» khÃ³a phÃ¢n Ä‘oáº¡n. <code>ConcurrentHashMap</code> duy trÃ¬ má»™t máº£ng <code>Segment</code>, thÆ°á»ng Ä‘Æ°á»£c gá»i lÃ  cÃ¡c ngÄƒn phÃ¢n Ä‘oáº¡n.</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Segment</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">K</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">V</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[] segments</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Khi má»™t luá»“ng truy cáº­p vÃ o dá»¯ liá»‡u cá»§a <code>ConcurrentHashMap</code>, <code>ConcurrentHashMap</code> sáº½ trÆ°á»›c tiÃªn tÃ­nh toÃ¡n hashCode Ä‘á»ƒ xÃ¡c Ä‘á»‹nh dá»¯ liá»‡u thuá»™c <code>Segment</code> nÃ o (tá»©c lÃ  phÃ¢n Ä‘oáº¡n nÃ o), sau Ä‘Ã³ khÃ³a phÃ¢n Ä‘oáº¡n Ä‘Ã³.</p><h3 id="khoa-hien-thi-va-khoa-noi-tai" tabindex="-1"><a class="header-anchor" href="#khoa-hien-thi-va-khoa-noi-tai"><span>KhÃ³a hiá»ƒn thá»‹ vÃ  khÃ³a ná»™i táº¡i</span></a></h3><p>TrÆ°á»›c Java 1.5, cÆ¡ cháº¿ duy nháº¥t Ä‘á»ƒ Ä‘iá»u phá»‘i quyá»n truy cáº­p Ä‘á»‘i tÆ°á»£ng chia sáº» lÃ  sá»­ dá»¥ng <code>synchronized</code> vÃ  <code>volatile</code>. Cáº£ hai Ä‘á»u thuá»™c loáº¡i khÃ³a ná»™i táº¡i, nghÄ©a lÃ  viá»‡c yÃªu cáº§u vÃ  giáº£i phÃ³ng khÃ³a Ä‘á»u do JVM Ä‘iá»u khiá»ƒn.</p><p>Sau Java 1.5, Ä‘Ã£ thÃªm cÆ¡ cháº¿ má»›i: <code>ReentrantLock</code>, <code>ReentrantReadWriteLock</code>, nhá»¯ng loáº¡i khÃ³a nÃ y cÃ³ thá»ƒ yÃªu cáº§u vÃ  giáº£i phÃ³ng khÃ³a theo Ã½ muá»‘n cá»§a chÆ°Æ¡ng trÃ¬nh, do Ä‘Ã³ thÆ°á»ng Ä‘Æ°á»£c gá»i lÃ  khÃ³a hiá»ƒn thá»‹.</p><blockquote><p>ğŸ’¡ CÃ¡ch sá»­ dá»¥ng vÃ  nguyÃªn lÃ½ cá»§a <code>synchronized</code> cÃ³ thá»ƒ tham kháº£o táº¡i: [[Java Concurrency Core Mechanism]].</p><p>ğŸ”” LÆ°u Ã½: Náº¿u khÃ´ng cáº§n cÃ¡c tÃ­nh nÄƒng Ä‘á»“ng bá»™ cao cáº¥p mÃ  <code>ReentrantLock</code>, <code>ReentrantReadWriteLock</code> cung cáº¥p, <strong>nÃªn Æ°u tiÃªn sá»­ dá»¥ng <code>synchronized</code></strong>. LÃ½ do nhÆ° sau:</p><ul><li>Tá»« Java 1.6 trá»Ÿ Ä‘i, <code>synchronized</code> Ä‘Ã£ Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a ráº¥t nhiá»u, hiá»‡u suáº¥t cá»§a nÃ³ Ä‘Ã£ gáº§n báº±ng vá»›i <code>ReentrantLock</code>, <code>ReentrantReadWriteLock</code>.</li><li>Theo xu hÆ°á»›ng, trong tÆ°Æ¡ng lai, Java cÃ³ thá»ƒ tá»‘i Æ°u hÃ³a <code>synchronized</code> hÆ¡n lÃ  <code>ReentrantLock</code>, <code>ReentrantReadWriteLock</code>, vÃ¬ <code>synchronized</code> lÃ  thuá»™c tÃ­nh Ä‘Æ°á»£c tÃ­ch há»£p sáºµn trong JVM, nÃ³ cÃ³ thá»ƒ thá»±c hiá»‡n má»™t sá»‘ tá»‘i Æ°u hÃ³a.</li><li><code>ReentrantLock</code>, <code>ReentrantReadWriteLock</code> yÃªu cáº§u yÃªu cáº§u vÃ  giáº£i phÃ³ng khÃ³a Ä‘Æ°á»£c Ä‘iá»u khiá»ƒn bá»Ÿi chÆ°Æ¡ng trÃ¬nh, náº¿u sá»­ dá»¥ng khÃ´ng Ä‘Ãºng cÃ¡ch, cÃ³ thá»ƒ gÃ¢y ra tÃ¬nh tráº¡ng báº¿ táº¯c, Ä‘iá»u nÃ y ráº¥t nguy hiá»ƒm.</li></ul></blockquote><p>DÆ°á»›i Ä‘Ã¢y lÃ  so sÃ¡nh giá»¯a khÃ³a hiá»ƒn thá»‹ vÃ  khÃ³a ná»™i táº¡i:</p><ul><li><strong>YÃªu cáº§u vÃ  giáº£i phÃ³ng khÃ³a chá»§ Ä‘á»™ng</strong><ul><li><code>synchronized</code> khÃ´ng thá»ƒ yÃªu cáº§u vÃ  giáº£i phÃ³ng khÃ³a chá»§ Ä‘á»™ng. YÃªu cáº§u vÃ  giáº£i phÃ³ng khÃ³a Ä‘á»u do JVM Ä‘iá»u khiá»ƒn.</li><li><code>ReentrantLock</code> cÃ³ thá»ƒ yÃªu cáº§u vÃ  giáº£i phÃ³ng khÃ³a chá»§ Ä‘á»™ng. (Náº¿u quÃªn giáº£i phÃ³ng khÃ³a, cÃ³ thá»ƒ gÃ¢y ra tÃ¬nh tráº¡ng káº¹t)</li></ul></li><li><strong>Pháº£n há»“i giÃ¡n Ä‘oáº¡n</strong><ul><li><code>synchronized</code> khÃ´ng thá»ƒ pháº£n há»“i giÃ¡n Ä‘oáº¡n.</li><li><code>ReentrantLock</code> cÃ³ thá»ƒ pháº£n há»“i giÃ¡n Ä‘oáº¡n.</li></ul></li><li><strong>CÆ¡ cháº¿ thá»i gian chá»</strong><ul><li><code>synchronized</code> khÃ´ng cÃ³ cÆ¡ cháº¿ thá»i gian chá».</li><li><code>ReentrantLock</code> cÃ³ cÆ¡ cháº¿ thá»i gian chá». <code>ReentrantLock</code> cÃ³ thá»ƒ Ä‘áº·t thá»i gian chá», sau khi háº¿t thá»i gian chá», khÃ³a sáº½ Ä‘Æ°á»£c giáº£i phÃ³ng tá»± Ä‘á»™ng, trÃ¡nh viá»‡c chá» Ä‘á»£i vÃ´ háº¡n.</li></ul></li><li><strong>Há»— trá»£ khÃ³a cÃ´ng báº±ng</strong><ul><li><code>synchronized</code> chá»‰ há»— trá»£ khÃ³a khÃ´ng cÃ´ng báº±ng.</li><li><code>ReentrantLock</code> há»— trá»£ khÃ³a khÃ´ng cÃ´ng báº±ng vÃ  khÃ³a cÃ´ng báº±ng.</li></ul></li><li><strong>Há»— trá»£ chia sáº»</strong><ul><li>PhÆ°Æ¡ng thá»©c hoáº·c khá»‘i mÃ£ Ä‘Æ°á»£c Ä‘Ã¡nh dáº¥u báº±ng <code>synchronized</code> chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c truy cáº­p bá»Ÿi má»™t luá»“ng duy nháº¥t (Ä‘á»™c quyá»n). Náº¿u luá»“ng nÃ y bá»‹ cháº·n, cÃ¡c luá»“ng khÃ¡c cÅ©ng chá»‰ cÃ³ thá»ƒ chá» Ä‘á»£i.</li><li><code>ReentrantLock</code> cÃ³ thá»ƒ kiá»ƒm soÃ¡t Ä‘iá»u kiá»‡n Ä‘á»“ng bá»™ linh hoáº¡t dá»±a trÃªn <code>Condition</code>.</li></ul></li><li><strong>Há»— trá»£ phÃ¢n tÃ¡ch Ä‘á»c vÃ  ghi</strong><ul><li><code>synchronized</code> khÃ´ng há»— trá»£ khÃ³a Ä‘á»c vÃ  ghi tÃ¡ch biá»‡t.</li><li><code>ReentrantReadWriteLock</code> há»— trá»£ khÃ³a Ä‘á»c vÃ  ghi tÃ¡ch biá»‡t, tá»« Ä‘Ã³ tÃ¡ch riÃªng cÃ¡c hoáº¡t Ä‘á»™ng Ä‘á»c vÃ  ghi, tÄƒng hiá»‡u suáº¥t Ä‘á»“ng thá»i.</li></ul></li></ul><h2 id="lock-va-condition" tabindex="-1"><a class="header-anchor" href="#lock-va-condition"><span>Lock vÃ  Condition</span></a></h2><h3 id="tai-sao-can-su-dung-lock-va-condition" tabindex="-1"><a class="header-anchor" href="#tai-sao-can-su-dung-lock-va-condition"><span>Táº¡i sao cáº§n sá»­ dá»¥ng Lock vÃ  Condition</span></a></h3><p>Trong lÄ©nh vá»±c láº­p trÃ¬nh Ä‘a luá»“ng, cÃ³ hai váº¥n Ä‘á» cá»‘t lÃµi: <strong>Ä‘á»“ng bá»™ hÃ³a</strong> vÃ  <strong>tÆ°Æ¡ng tÃ¡c</strong>. Äá»“ng bá»™ hÃ³a Ä‘áº£m báº£o chá»‰ cÃ³ má»™t luá»“ng Ä‘Æ°á»£c phÃ©p truy cáº­p vÃ o tÃ i nguyÃªn chung trong cÃ¹ng má»™t thá»i Ä‘iá»ƒm. TÆ°Æ¡ng tÃ¡c xáº£y ra khi cÃ¡c luá»“ng cáº§n giao tiáº¿p vÃ  cá»™ng tÃ¡c vá»›i nhau. Äá»ƒ giáº£i quyáº¿t hai váº¥n Ä‘á» nÃ y, Java SDK cung cáº¥p giao diá»‡n <code>Lock</code> vÃ  <code>Condition</code> Ä‘á»ƒ triá»ƒn khai mÃ´ hÃ¬nh quáº£n lÃ½ tÃ i nguyÃªn.</p><p>Synchronized lÃ  má»™t cÃ¡ch triá»ƒn khai cá»§a mÃ´ hÃ¬nh quáº£n lÃ½ tÃ i nguyÃªn, váº­y táº¡i sao láº¡i cáº§n Lock vÃ  Condition.</p><p>TrÆ°á»›c JDK 1.6, synchronized chÆ°a Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a vÃ  hiá»‡u suáº¥t tháº¥p hÆ¡n so vá»›i Lock. Tuy nhiÃªn, hiá»‡u suáº¥t khÃ´ng pháº£i lÃ  yáº¿u tá»‘ quan trá»ng nháº¥t khi giá»›i thiá»‡u Lock. Quan trá»ng nháº¥t lÃ  synchronized khÃ´ng thá»ƒ ngÄƒn cháº·n deadlock náº¿u sá»­ dá»¥ng khÃ´ng Ä‘Ãºng cÃ¡ch.</p><p>Synchronized khÃ´ng thá»ƒ ngÄƒn cháº·n deadlock báº±ng cÃ¡ch phÃ¡ vá»¡ Ä‘iá»u kiá»‡n khÃ´ng thá»ƒ tranh giÃ nh. LÃ½ do lÃ  khi synchronized yÃªu cáº§u tÃ i nguyÃªn vÃ  khÃ´ng thá»ƒ nháº­n Ä‘Æ°á»£c nÃ³, luá»“ng sáº½ chuyá»ƒn sang tráº¡ng thÃ¡i chá» Ä‘á»£i vÃ  khÃ´ng thá»ƒ giáº£i phÃ³ng tÃ i nguyÃªn Ä‘Ã£ náº¯m giá»¯.</p><p>NgÆ°á»£c láº¡i, Lock cung cáº¥p má»™t táº­p há»£p cÃ¡c hoáº¡t Ä‘á»™ng khÃ³a khÃ´ng cÃ³ Ä‘iá»u kiá»‡n, cÃ³ thá»ƒ kiá»ƒm tra, cÃ³ thá»ƒ Ä‘á»‹nh thá»i gian vÃ  cÃ³ thá»ƒ bá»‹ giÃ¡n Ä‘oáº¡n. Táº¥t cáº£ cÃ¡c hoáº¡t Ä‘á»™ng láº¥y khÃ³a vÃ  giáº£i phÃ³ng khÃ³a Ä‘á»u lÃ  hoáº¡t Ä‘á»™ng rÃµ rÃ ng.</p><ul><li><strong>CÃ³ thá»ƒ pháº£n há»“i giÃ¡n Ä‘oáº¡n</strong>. Váº¥n Ä‘á» vá»›i synchronized lÃ  khi má»™t luá»“ng giá»¯ khÃ³a A vÃ  khÃ´ng thá»ƒ láº¥y khÃ³a B, luá»“ng sáº½ chuyá»ƒn sang tráº¡ng thÃ¡i chá» Ä‘á»£i vÃ  khÃ´ng cÃ³ cÆ¡ há»™i nÃ o Ä‘á»ƒ Ä‘Ã¡nh thá»©c luá»“ng chá» Ä‘á»£i. Tuy nhiÃªn, náº¿u luá»“ng chá» Ä‘á»£i cÃ³ thá»ƒ pháº£n há»“i tÃ­n hiá»‡u giÃ¡n Ä‘oáº¡n, tá»©c lÃ  khi chÃºng ta gá»­i tÃ­n hiá»‡u giÃ¡n Ä‘oáº¡n cho luá»“ng chá» Ä‘á»£i, nÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘Ã¡nh thá»©c vÃ  cÃ³ cÆ¡ há»™i giáº£i phÃ³ng khÃ³a A Ä‘Ã£ náº¯m giá»¯. Äiá»u nÃ y phÃ¡ vá»¡ Ä‘iá»u kiá»‡n khÃ´ng thá»ƒ tranh giÃ nh.</li><li><strong>Há»— trá»£ thá»i gian chá»</strong>. Náº¿u má»™t luá»“ng khÃ´ng thá»ƒ láº¥y khÃ³a trong má»™t khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh, nÃ³ sáº½ khÃ´ng chuyá»ƒn sang tráº¡ng thÃ¡i chá» Ä‘á»£i, mÃ  sáº½ tráº£ vá» má»™t lá»—i. Äiá»u nÃ y cÅ©ng cÃ³ thá»ƒ phÃ¡ vá»¡ Ä‘iá»u kiá»‡n khÃ´ng thá»ƒ tranh giÃ nh.</li><li><strong>KhÃ´ng cháº·n khi láº¥y khÃ³a</strong>. Náº¿u khÃ´ng thá»ƒ láº¥y khÃ³a, luá»“ng khÃ´ng chuyá»ƒn sang tráº¡ng thÃ¡i chá» Ä‘á»£i mÃ  tráº£ vá» trá»±c tiáº¿p. Äiá»u nÃ y cÅ©ng cÃ³ thá»ƒ phÃ¡ vá»¡ Ä‘iá»u kiá»‡n khÃ´ng thá»ƒ tranh giÃ nh.</li></ul><h3 id="giao-dien-lock" tabindex="-1"><a class="header-anchor" href="#giao-dien-lock"><span>Giao diá»‡n Lock</span></a></h3><p>Giao diá»‡n Lock Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a nhÆ° sau:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> lockInterruptibly</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> tryLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> tryLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TimeUnit</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> unit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    Condition</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> newCondition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li><code>lock()</code> - Láº¥y khÃ³a.</li><li><code>unlock()</code> - Giáº£i phÃ³ng khÃ³a.</li><li><code>tryLock()</code> - Thá»­ láº¥y khÃ³a, chá»‰ láº¥y khÃ³a khi khÃ´ng cÃ³ luá»“ng khÃ¡c Ä‘ang giá»¯ khÃ³a.</li><li><code>tryLock(long time, TimeUnit unit)</code> - TÆ°Æ¡ng tá»± nhÆ° <code>tryLock()</code>, nhÆ°ng giá»›i háº¡n thá»i gian, náº¿u khÃ´ng láº¥y Ä‘Æ°á»£c khÃ³a trong thá»i gian giá»›i háº¡n, tráº£ vá» false.</li><li><code>lockInterruptibly()</code> - Láº¥y khÃ³a khi khÃ´ng cÃ³ luá»“ng khÃ¡c giá»¯ khÃ³a vÃ  luá»“ng khÃ´ng bá»‹ giÃ¡n Ä‘oáº¡n.</li><li><code>newCondition()</code> - Tráº£ vá» má»™t Ä‘á»‘i tÆ°á»£ng Condition Ä‘Æ°á»£c liÃªn káº¿t vá»›i Lock.</li></ul><h3 id="condition" tabindex="-1"><a class="header-anchor" href="#condition"><span>Condition</span></a></h3><p><strong>Condition triá»ƒn khai biáº¿n Ä‘iá»u kiá»‡n trong mÃ´ hÃ¬nh quáº£n lÃ½ tÃ i nguyÃªn</strong>.</p><p>NhÆ° Ä‘Ã£ Ä‘á» cáº­p trÆ°á»›c Ä‘Ã³, giao diá»‡n Lock cÃ³ má»™t phÆ°Æ¡ng thá»©c <code>newCondition()</code> Ä‘á»ƒ tráº£ vá» má»™t Ä‘á»‘i tÆ°á»£ng Condition Ä‘Æ°á»£c liÃªn káº¿t vá»›i Lock. Condition lÃ  gÃ¬? NÃ³ cÃ³ tÃ¡c dá»¥ng gÃ¬? Pháº§n nÃ y sáº½ giáº£i thÃ­ch tá»«ng pháº§n má»™t.</p><p>Trong má»™t luá»“ng Ä‘Æ¡n, viá»‡c thá»±c thi má»™t Ä‘oáº¡n mÃ£ cÃ³ thá»ƒ phá»¥ thuá»™c vÃ o má»™t tráº¡ng thÃ¡i nÃ o Ä‘Ã³. Náº¿u khÃ´ng Ä‘Ã¡p á»©ng Ä‘iá»u kiá»‡n tráº¡ng thÃ¡i, mÃ£ sáº½ khÃ´ng Ä‘Æ°á»£c thá»±c thi (má»™t vÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh lÃ  cÃ¢u lá»‡nh <code>if â€¦ else â€¦</code>). Trong mÃ´i trÆ°á»ng Ä‘a luá»“ng, khi má»™t luá»“ng kiá»ƒm tra Ä‘iá»u kiá»‡n tráº¡ng thÃ¡i, tráº¡ng thÃ¡i cÃ³ thá»ƒ thay Ä‘á»•i do hoáº¡t Ä‘á»™ng cá»§a cÃ¡c luá»“ng khÃ¡c. Do Ä‘Ã³, cáº§n cÃ³ cÆ¡ cháº¿ phá»‘i há»£p Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng cÃ¹ng má»™t lÃºc, dá»¯ liá»‡u chá»‰ Ä‘Æ°á»£c sá»­a Ä‘á»•i bá»Ÿi má»™t luá»“ng vÃ  táº¥t cáº£ cÃ¡c luá»“ng Ä‘á»u nháº­n biáº¿t tráº¡ng thÃ¡i dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c sá»­a Ä‘á»•i.</p><p>TrÆ°á»›c JDK 1.5, chÃºng ta sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng thá»©c <code>wait</code>ã€<code>notify</code>ã€<code>notifyAll</code> trong lá»›p <code>Object</code> Ä‘á»ƒ giao tiáº¿p giá»¯a cÃ¡c luá»“ng (náº¿u khÃ´ng quen vá»›i chÃºng, báº¡n cÃ³ thá»ƒ tham kháº£o: [[Java Thread Basic]]).</p><p><code>wait</code>ã€<code>notify</code>ã€<code>notifyAll</code> pháº£i Ä‘Æ°á»£c sá»­ dá»¥ng káº¿t há»£p vá»›i <code>synchronized</code> vÃ  khÃ´ng phÃ¹ há»£p vá»›i Lock. VÃ¬ váº­y, cÃ¡c luá»“ng sá»­ dá»¥ng Lock Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i nhau nÃªn sá»­ dá»¥ng Condition. Äiá»u nÃ y cÃ³ thá»ƒ hiá»ƒu lÃ , khÃ³a nÃ o sá»­ dá»¥ng khÃ³a nÃ o.</p><h4 id="Ä‘ac-Ä‘iem-cua-condition" tabindex="-1"><a class="header-anchor" href="#Ä‘ac-Ä‘iem-cua-condition"><span>Äáº·c Ä‘iá»ƒm cá»§a Condition</span></a></h4><p>Giao diá»‡n Condition Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a nhÆ° sau:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Condition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> await</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> awaitUninterruptibly</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    long</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> awaitNanos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> nanosTimeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> await</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TimeUnit</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> unit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> awaitUntil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Date</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> deadline</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> InterruptedException</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> signal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> signalAll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Trong Ä‘Ã³, <code>await</code>ã€<code>signal</code>ã€<code>signalAll</code> tÆ°Æ¡ng á»©ng vá»›i <code>wait</code>ã€<code>notify</code>ã€<code>notifyAll</code> vÃ  cÃ³ chá»©c nÄƒng tÆ°Æ¡ng tá»±. NgoÃ i ra, Condition cung cáº¥p nhiá»u tÃ­nh nÄƒng phong phÃº hÆ¡n so vá»›i cÃ¡c phÆ°Æ¡ng thá»©c Ä‘iá»u kiá»‡n ná»™i táº¡i (<code>wait</code>ã€<code>notify</code>ã€<code>notifyAll</code>):</p><ul><li>Má»—i khÃ³a (Lock) cÃ³ thá»ƒ cÃ³ nhiá»u Condition, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  cÃ³ thá»ƒ cÃ³ nhiá»u Ä‘iá»u kiá»‡n tráº¡ng thÃ¡i cá»§a khÃ³a.</li><li>Há»— trá»£ hÃ ng Ä‘á»£i cÃ´ng báº±ng hoáº·c khÃ´ng cÃ´ng báº±ng.</li><li>Há»— trá»£ chá» khÃ´ng bá»‹ giÃ¡n Ä‘oáº¡n, cÃ¡c phÆ°Æ¡ng thá»©c liÃªn quan: <code>awaitUninterruptibly()</code>.</li><li>Há»— trá»£ chá» vá»›i thá»i gian giá»›i háº¡n, cÃ¡c phÆ°Æ¡ng thá»©c liÃªn quan: <code>awaitNanos(long)</code>ã€<code>await(long, TimeUnit)</code>ã€<code>awaitUntil(Date)</code>.</li></ul><h4 id="cach-su-dung-condition" tabindex="-1"><a class="header-anchor" href="#cach-su-dung-condition"><span>CÃ¡ch sá»­ dá»¥ng Condition</span></a></h4><p>á» Ä‘Ã¢y, chÃºng ta sáº½ sá»­ dá»¥ng Condition Ä‘á»ƒ triá»ƒn khai má»™t mÃ´ hÃ¬nh sáº£n xuáº¥t vÃ  tiÃªu thá»¥.</p><blockquote><p>ğŸ”” LÆ°u Ã½: Trong thá»±c táº¿, viá»‡c giáº£i quyáº¿t váº¥n Ä‘á» nÃ y báº±ng cÃ¡ch sá»­ dá»¥ng cÃ¡c cÃ´ng cá»¥ nhÆ° <code>CountDownLatch</code>, <code>Semaphore</code> sáº½ dá»… dÃ ng hÆ¡n vÃ  an toÃ n hÆ¡n. Äá»ƒ biáº¿t thÃªm chi tiáº¿t, báº¡n cÃ³ thá»ƒ tham kháº£o [[Java Concurrent Tools]].</p></blockquote><p>Lá»›p sáº£n pháº©m</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Lock</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> lock </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ReentrantLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Condition</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> producedMsg </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">newCondition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Condition</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> consumedMsg </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">newCondition</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> state</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> end</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> consume</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        //lock</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // khÃ´ng cÃ³ tin nháº¯n má»›i, chá» tin nháº¯n má»›i</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">state) { </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">producedMsg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">await</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(); }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;consume message : &quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> message);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            state </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // tin nháº¯n Ä‘Ã£ tiÃªu thá»¥, thÃ´ng bÃ¡o cho luá»“ng Ä‘ang chá»</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            consumedMsg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">signal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">InterruptedException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> ie</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Thread interrupted - viewMessage&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> produce</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // tin nháº¯n trÆ°á»›c chÆ°a Ä‘Æ°á»£c tiÃªu thá»¥, chá» cho Ä‘áº¿n khi nÃ³ Ä‘Æ°á»£c tiÃªu thá»¥</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (state) { </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">consumedMsg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">await</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(); }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;produce msg: &quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> message);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">message</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> message;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            state </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // tin nháº¯n má»›i Ä‘Æ°á»£c thÃªm, thÃ´ng bÃ¡o cho luá»“ng Ä‘ang chá»</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            producedMsg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">signal</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">InterruptedException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> ie</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Thread interrupted - publishMessage&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> isEnd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> end;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> setEnd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> end</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">end</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> end;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Luá»“ng tiÃªu thá»¥</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> MessageConsumer</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Runnable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Message</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MessageConsumer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Message</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> msg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        message </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> msg;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">isEnd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()) { </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">consume</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(); }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Luá»“ng sáº£n xuáº¥t</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> MessageProducer</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Runnable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Message</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MessageProducer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Message</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> msg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        message </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> msg;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        produce</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> produce</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">msgs</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        msgs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Begin&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        msgs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Msg1&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        msgs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Msg2&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> msg</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> msgs) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">produce</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(msg);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">InterruptedException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">produce</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;End&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">setEnd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Kiá»ƒm tra</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LockConditionDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Message</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> msg</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> producer</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MessageProducer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(msg));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> consumer</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MessageConsumer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(msg));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        producer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        consumer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h2 id="reentrantlock" tabindex="-1"><a class="header-anchor" href="#reentrantlock"><span>ReentrantLock</span></a></h2><p>Lá»›p <code>ReentrantLock</code> lÃ  má»™t triá»ƒn khai cá»¥ thá»ƒ cá»§a giao diá»‡n <code>Lock</code> vÃ , giá»‘ng nhÆ° khÃ³a ná»™i táº¡i <code>synchronized</code>, nÃ³ lÃ  má»™t <strong>khÃ³a cÃ³ thá»ƒ tÃ¡i nháº­p</strong>.</p><h3 id="Ä‘ac-Ä‘iem-cua-reentrantlock" tabindex="-1"><a class="header-anchor" href="#Ä‘ac-Ä‘iem-cua-reentrantlock"><span>Äáº·c Ä‘iá»ƒm cá»§a ReentrantLock</span></a></h3><p>CÃ¡c Ä‘áº·c Ä‘iá»ƒm cá»§a <code>ReentrantLock</code> nhÆ° sau:</p><ul><li><code>ReentrantLock</code> cung cáº¥p tÃ­nh nÄƒng <strong>Ä‘á»“ng bá»™, kháº£ nÄƒng nhÃ¬n tháº¥y bá»™ nhá»› vÃ  kháº£ nÄƒng tÃ¡i nháº­p</strong> tÆ°Æ¡ng tá»± nhÆ° <code>synchronized</code>.</li><li><code>ReentrantLock</code> há»— trá»£ hai cháº¿ Ä‘á»™ khÃ³a: <strong>khÃ³a cÃ´ng báº±ng</strong> (fair) vÃ  <strong>khÃ³a khÃ´ng cÃ´ng báº±ng</strong> (non-fair) (máº·c Ä‘á»‹nh).</li><li><code>ReentrantLock</code> triá»ƒn khai giao diá»‡n <code>Lock</code>, cung cáº¥p <strong>tÃ­nh linh hoáº¡t</strong> mÃ  <code>synchronized</code> khÃ´ng cÃ³. <ul><li><code>synchronized</code> khÃ´ng thá»ƒ ngáº¯t má»™t luá»“ng Ä‘ang chá» láº¥y khÃ³a.</li><li><code>synchronized</code> khÃ´ng thá»ƒ chá» vÃ´ thá»i háº¡n khi yÃªu cáº§u láº¥y má»™t khÃ³a.</li></ul></li></ul><h3 id="cach-su-dung-reentrantlock" tabindex="-1"><a class="header-anchor" href="#cach-su-dung-reentrantlock"><span>CÃ¡ch sá»­ dá»¥ng ReentrantLock</span></a></h3><p>Sau khi tÃ¬m hiá»ƒu vá» Ä‘áº·c Ä‘iá»ƒm cá»§a <code>ReentrantLock</code>, chÃºng ta sáº½ tÃ¬m hiá»ƒu cÃ¡ch sá»­ dá»¥ng nÃ³.</p><h4 id="phuong-thuc-khoi-tao-cua-reentrantlock" tabindex="-1"><a class="header-anchor" href="#phuong-thuc-khoi-tao-cua-reentrantlock"><span>PhÆ°Æ¡ng thá»©c khá»Ÿi táº¡o cá»§a ReentrantLock</span></a></h4><p><code>ReentrantLock</code> cÃ³ hai phÆ°Æ¡ng thá»©c khá»Ÿi táº¡o:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ReentrantLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">() {}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ReentrantLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> fair) {}</span></span></code></pre></div><ul><li><code>ReentrantLock()</code> - PhÆ°Æ¡ng thá»©c khá»Ÿi táº¡o máº·c Ä‘á»‹nh sáº½ khá»Ÿi táº¡o má»™t <strong>khÃ³a khÃ´ng cÃ´ng báº±ng (NonfairSync)</strong>.</li><li><code>ReentrantLock(boolean)</code> - <code>new ReentrantLock(true)</code> sáº½ khá»Ÿi táº¡o má»™t <strong>khÃ³a cÃ´ng báº±ng (FairSync)</strong>.</li></ul><h4 id="phuong-thuc-lock-va-unlock" tabindex="-1"><a class="header-anchor" href="#phuong-thuc-lock-va-unlock"><span>PhÆ°Æ¡ng thá»©c lock vÃ  unlock</span></a></h4><ul><li><code>lock()</code> - <strong>Láº¥y khÃ³a mÃ  khÃ´ng cÃ³ Ä‘iá»u kiá»‡n</strong>. Náº¿u luá»“ng hiá»‡n táº¡i khÃ´ng thá»ƒ láº¥y khÃ³a, luá»“ng hiá»‡n táº¡i sáº½ chá» Ä‘á»£i cho Ä‘áº¿n khi cÃ³ thá»ƒ láº¥y Ä‘Æ°á»£c khÃ³a. Náº¿u khÃ³a khÃ´ng Ä‘Æ°á»£c giá»¯ bá»Ÿi má»™t luá»“ng khÃ¡c, luá»“ng hiá»‡n táº¡i sáº½ láº¥y khÃ³a vÃ  tráº£ vá» ngay láº­p tá»©c, Ä‘á»“ng thá»i Ä‘áº·t Ä‘áº¿m khÃ³a thÃ nh 1.</li><li><code>unlock()</code> - DÃ¹ng Ä‘á»ƒ <strong>giáº£i phÃ³ng khÃ³a</strong>.</li></ul><blockquote><p>ğŸ”” LÆ°u Ã½: HÃ£y nhá»› ráº±ng, viá»‡c láº¥y khÃ³a **<code>lock()</code> pháº£i Ä‘Æ°á»£c thá»±c hiá»‡n trong khá»‘i <code>try catch</code> vÃ  viá»‡c giáº£i phÃ³ng khÃ³a <code>unlock()</code> pháº£i Ä‘Æ°á»£c Ä‘áº·t trong khá»‘i <code>finally</code> Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng khÃ³a sáº½ Ä‘Æ°á»£c giáº£i phÃ³ng, trÃ¡nh deadlock.</p></blockquote><p>VÃ­ dá»¥: CÃ¡c hoáº¡t Ä‘á»™ng cÆ¡ báº£n cá»§a ReentrantLock</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ReentrantLockDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Task</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> task</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Task</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        MyThread</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tA</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MyThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Thread-A&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, task);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        MyThread</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tB</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MyThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Thread-B&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, task);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        MyThread</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tC</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MyThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Thread-C&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, task);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        tA</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        tB</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        tC</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> MyThread</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Task</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> task</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MyThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Task</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> task</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            super</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(name);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">task</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> task;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            task</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">execute</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Task</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ReentrantLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> lock </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ReentrantLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> execute</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; i++) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                    // Kiá»ƒm tra sá»‘ láº§n mÃ  luá»“ng hiá»‡n táº¡i giá»¯ khÃ³a</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\t</span><span style="color:#98C379;--shiki-dark:#98C379;"> holdCount: &quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getHoldCount</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                    // Kiá»ƒm tra sá»‘ luá»“ng Ä‘ang chá» láº¥y khÃ³a</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\t</span><span style="color:#98C379;--shiki-dark:#98C379;"> queuedLength: &quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getQueueLength</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                    // Kiá»ƒm tra xem khÃ³a cÃ³ cÃ´ng báº±ng khÃ´ng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\t</span><span style="color:#98C379;--shiki-dark:#98C379;"> isFair: &quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">isFair</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                    // Kiá»ƒm tra xem khÃ³a cÃ³ bá»‹ khÃ³a khÃ´ng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\t</span><span style="color:#98C379;--shiki-dark:#98C379;"> isLocked: &quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">isLocked</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                    // Kiá»ƒm tra xem khÃ³a cÃ³ Ä‘Æ°á»£c giá»¯ bá»Ÿi luá»“ng hiá»‡n táº¡i khÃ´ng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                    System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\t</span><span style="color:#98C379;--shiki-dark:#98C379;"> isHeldByCurrentThread: &quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">isHeldByCurrentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                    try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                        Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">500</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">InterruptedException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                        e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Káº¿t quáº£ Ä‘áº§u ra:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">concurrent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">locks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ReentrantLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">64fcd88a</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Locked</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> by thread Thread</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">A]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	 holdCount</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	 queuedLength</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	 isFair</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	 isLocked</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	 isHeldByCurrentThread</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">concurrent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">locks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ReentrantLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">64fcd88a</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Locked</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> by thread Thread</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">C]</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	 holdCount</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	 queuedLength</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	 isFair</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> false</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	 isLocked</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">	 isHeldByCurrentThread</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// ...</span></span></code></pre></div><h4 id="phuong-thuc-trylock" tabindex="-1"><a class="header-anchor" href="#phuong-thuc-trylock"><span>PhÆ°Æ¡ng thá»©c tryLock</span></a></h4><p>So vá»›i viá»‡c láº¥y khÃ³a mÃ  khÃ´ng cÃ³ Ä‘iá»u kiá»‡n, tryLock cÃ³ cÆ¡ cháº¿ phÃ²ng ngá»«a lá»—i hoÃ n háº£o hÆ¡n.</p><ul><li><code>tryLock()</code> - <strong>Cá»‘ gáº¯ng láº¥y khÃ³a theo chu ká»³</strong>. Náº¿u thÃ nh cÃ´ng, nÃ³ sáº½ tráº£ vá» true; náº¿u tháº¥t báº¡i, nÃ³ sáº½ tráº£ vá» false. Äiá»u nÃ y cÃ³ nghÄ©a lÃ  phÆ°Æ¡ng thá»©c nÃ y sáº½ <strong>tráº£ vá» ngay láº­p tá»©c</strong> mÃ  khÃ´ng chá» Ä‘á»£i náº¿u khÃ´ng thá»ƒ láº¥y Ä‘Æ°á»£c khÃ³a (khÃ³a Ä‘Ã£ Ä‘Æ°á»£c láº¥y bá»Ÿi luá»“ng khÃ¡c).</li><li><code>tryLock(long, TimeUnit)</code> - <strong>Cá»‘ gáº¯ng láº¥y khÃ³a theo thá»i gian</strong>. TÆ°Æ¡ng tá»± nhÆ° tryLock(), khÃ¡c biá»‡t duy nháº¥t lÃ  phÆ°Æ¡ng thá»©c nÃ y sáº½ <strong>Ä‘á»£i má»™t khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh</strong> náº¿u khÃ´ng thá»ƒ láº¥y Ä‘Æ°á»£c khÃ³a vÃ  tráº£ vá» false sau khoáº£ng thá»i gian Ä‘Ã³. Náº¿u láº¥y Ä‘Æ°á»£c khÃ³a tá»« Ä‘áº§u hoáº·c trong khoáº£ng thá»i gian chá», phÆ°Æ¡ng thá»©c sáº½ tráº£ vá» true.</li></ul><p>VÃ­ dá»¥: Thao tÃ¡c tryLock() cá»§a ReentrantLock</p><p>Sá»­a Ä‘á»•i phÆ°Æ¡ng thá»©c execute() trong vÃ­ dá»¥ trÆ°á»›c:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> execute</span><span style="color:#E06C75;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">tryLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">++</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">               // LÃ m gÃ¬ Ä‘Ã³...</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">else</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot; khÃ´ng thá»ƒ láº¥y Ä‘Æ°á»£c khÃ³a&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>VÃ­ dá»¥: Thao tÃ¡c tryLock(long, TimeUnit) cá»§a ReentrantLock</p><p>Sá»­a Ä‘á»•i phÆ°Æ¡ng thá»©c execute() trong vÃ­ dá»¥ trÆ°á»›c:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> execute</span><span style="color:#E06C75;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">tryLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TimeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">SECONDS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">++</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                    // LÃ m gÃ¬ Ä‘Ã³...</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">else</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot; khÃ´ng thá»ƒ láº¥y Ä‘Æ°á»£c khÃ³a&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">InterruptedException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot; Ä‘Ã£ vÆ°á»£t quÃ¡ thá»i gian chá» láº¥y khÃ³a&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="phuong-thuc-lockinterruptibly" tabindex="-1"><a class="header-anchor" href="#phuong-thuc-lockinterruptibly"><span>PhÆ°Æ¡ng thá»©c lockInterruptibly</span></a></h4><ul><li><code>lockInterruptibly()</code> - <strong>Cá»‘ gáº¯ng láº¥y khÃ³a cÃ³ thá»ƒ bá»‹ giÃ¡n Ä‘oáº¡n</strong>. Láº¥y khÃ³a cÃ³ thá»ƒ bá»‹ giÃ¡n Ä‘oáº¡n cho phÃ©p pháº£n há»“i giÃ¡n Ä‘oáº¡n trong quÃ¡ trÃ¬nh láº¥y khÃ³a. PhÆ°Æ¡ng thá»©c nÃ y hÆ¡i phá»©c táº¡p hÆ¡n cÃ¡c phÆ°Æ¡ng thá»©c láº¥y khÃ³a khÃ¡c, cáº§n sá»­ dá»¥ng hai khá»‘i <code>try-catch</code> (náº¿u trong quÃ¡ trÃ¬nh láº¥y khÃ³a xáº£y ra <code>InterruptedException</code>, cÃ³ thá»ƒ sá»­ dá»¥ng mÃ´ hÃ¬nh khÃ³a <code>try-finally</code> chuáº©n). <ul><li>VÃ­ dá»¥: Giáº£ sá»­ cÃ³ hai luá»“ng cÃ¹ng sá»­ dá»¥ng <code>lock.lockInterruptibly()</code> Ä‘á»ƒ láº¥y má»™t khÃ³a, náº¿u luá»“ng A láº¥y Ä‘Æ°á»£c khÃ³a, luá»“ng B sáº½ pháº£i chá» Ä‘á»£i. Trong trÆ°á»ng há»£p nÃ y, náº¿u gá»i <code>threadB.interrupt()</code> Ä‘á»ƒ giÃ¡n Ä‘oáº¡n quÃ¡ trÃ¬nh chá» Ä‘á»£i cá»§a luá»“ng B, thÃ¬ luá»“ng B sáº½ bá»‹ giÃ¡n Ä‘oáº¡n. VÃ¬ khai bÃ¡o cá»§a <code>lockInterruptibly()</code> cÃ³ nÃ©m ra ngoáº¡i lá»‡, nÃªn <code>lock.lockInterruptibly()</code> pháº£i Ä‘Æ°á»£c Ä‘áº·t trong khá»‘i <code>try</code> hoáº·c khai bÃ¡o ngoáº¡i lá»‡ <code>InterruptedException</code> á»Ÿ bÃªn ngoÃ i phÆ°Æ¡ng thá»©c gá»i <code>lockInterruptibly()</code>.</li></ul></li></ul><blockquote><p>ğŸ”” LÆ°u Ã½: Khi má»™t luá»“ng Ä‘Ã£ láº¥y Ä‘Æ°á»£c khÃ³a, nÃ³ sáº½ khÃ´ng bá»‹ giÃ¡n Ä‘oáº¡n bá»Ÿi phÆ°Æ¡ng thá»©c <code>interrupt()</code>. Gá»i riÃªng <code>interrupt()</code> khÃ´ng thá»ƒ giÃ¡n Ä‘oáº¡n luá»“ng Ä‘ang cháº¡y, chá»‰ cÃ³ thá»ƒ giÃ¡n Ä‘oáº¡n luá»“ng Ä‘ang bá»‹ cháº·n. Do Ä‘Ã³, khi sá»­ dá»¥ng <code>lockInterruptibly()</code> Ä‘á»ƒ láº¥y má»™t khÃ³a, chá»‰ khi Ä‘ang á»Ÿ tráº¡ng thÃ¡i chá» Ä‘á»£i, má»›i cÃ³ thá»ƒ pháº£n há»“i giÃ¡n Ä‘oáº¡n.</p></blockquote><p>VÃ­ dá»¥: Thao tÃ¡c lockInterruptibly() cá»§a ReentrantLock</p><p>Sá»­a Ä‘á»•i phÆ°Æ¡ng thá»©c execute() trong vÃ­ dá»¥ trÆ°á»›c:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> execute</span><span style="color:#E06C75;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lockInterruptibly</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">++</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // LÃ m gÃ¬ Ä‘Ã³...</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">InterruptedException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot; Ä‘Ã£ bá»‹ giÃ¡n Ä‘oáº¡n&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        e</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">printStackTrace</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><h4 id="phuong-thuc-newcondition" tabindex="-1"><a class="header-anchor" href="#phuong-thuc-newcondition"><span>PhÆ°Æ¡ng thá»©c newCondition</span></a></h4><p><code>newCondition()</code> - Tráº£ vá» má»™t phiÃªn báº£n <code>Condition</code> Ä‘Æ°á»£c liÃªn káº¿t vá»›i Ä‘á»‘i tÆ°á»£ng <code>Lock</code>. Äáº·c tÃ­nh vÃ  phÆ°Æ¡ng thá»©c cá»¥ thá»ƒ cá»§a <code>Condition</code> xin vui lÃ²ng tham kháº£o pháº§n dÆ°á»›i <a href="Condition"><code>Condition</code></a>.</p><h3 id="nguyen-ly-cua-reentrantlock" tabindex="-1"><a class="header-anchor" href="#nguyen-ly-cua-reentrantlock"><span>NguyÃªn lÃ½ cá»§a ReentrantLock</span></a></h3><h4 id="tinh-hieu-luc-cua-reentrantlock" tabindex="-1"><a class="header-anchor" href="#tinh-hieu-luc-cua-reentrantlock"><span>TÃ­nh hiá»‡u lá»±c cá»§a ReentrantLock</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> X</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">  private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Lock</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> rtl </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">  new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ReentrantLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">  int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">  public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> addOne</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Láº¥y khÃ³a</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    rtl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      value</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">      // Äáº£m báº£o khÃ³a Ä‘Æ°á»£c giáº£i phÃ³ng</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">      rtl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ReentrantLock cÃ³ má»™t trÆ°á»ng dá»¯ liá»‡u <code>state</code> lÃ  biáº¿n thÃ nh viÃªn <code>volatile</code>. Khi láº¥y khÃ³a, nÃ³ sáº½ Ä‘á»c vÃ  ghi giÃ¡ trá»‹ cá»§a biáº¿n <code>state</code>. Khi giáº£i phÃ³ng khÃ³a, nÃ³ cÅ©ng sáº½ Ä‘á»c vÃ  ghi giÃ¡ trá»‹ cá»§a biáº¿n <code>state</code>. Dá»±a trÃªn quy táº¯c Happens-Before liÃªn quan:</p><ol><li><strong>Quy táº¯c tuáº§n tá»±</strong> (Sequential Consistency): Äá»‘i vá»›i luá»“ng T1, phÃ©p <code>value+=1</code> Happens-Before phÃ©p giáº£i phÃ³ng khÃ³a unlock().</li><li><strong>Quy táº¯c biáº¿n volatile</strong> (Volatile Variable): VÃ¬ phÃ©p gÃ¡n <code>state = 1</code> Ä‘á»c giÃ¡ trá»‹ cá»§a biáº¿n <code>state</code> trÆ°á»›c khi gÃ¡n, nÃªn phÃ©p giáº£i phÃ³ng khÃ³a unlock() cá»§a luá»“ng T1 Happens-Before phÃ©p láº¥y khÃ³a lock() cá»§a luá»“ng T2.</li><li><strong>Quy táº¯c truyá»n táº£i</strong> (Transitivity): PhÃ©p <code>value+=1</code> cá»§a luá»“ng T1 Happens-Before phÃ©p láº¥y khÃ³a lock() cá»§a luá»“ng T2.</li></ol><h4 id="cau-truc-du-lieu-cua-reentrantlock" tabindex="-1"><a class="header-anchor" href="#cau-truc-du-lieu-cua-reentrantlock"><span>Cáº¥u trÃºc dá»¯ liá»‡u cá»§a ReentrantLock</span></a></h4><p>Khi Ä‘á»c mÃ£ nguá»“n cá»§a <code>ReentrantLock</code>, ta cÃ³ thá»ƒ tháº¥y nÃ³ cÃ³ má»™t trÆ°á»ng chÃ­nh:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Sync</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> sync</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li><code>sync</code> - Äá»‘i tÆ°á»£ng trá»«u tÆ°á»£ng <code>ReentrantLock.Sync</code> bÃªn trong, <code>Sync</code> káº¿ thá»«a tá»« AQS. NÃ³ cÃ³ hai lá»›p con:</li><li><code>ReentrantLock.FairSync</code> - KhÃ³a cÃ´ng báº±ng.</li><li><code>ReentrantLock.NonfairSync</code> - KhÃ³a khÃ´ng cÃ´ng báº±ng.</li></ul><p>Khi xem mÃ£ nguá»“n, ta cÃ³ thá»ƒ tháº¥y ráº±ng <code>ReentrantLock</code> thá»±c hiá»‡n giao diá»‡n <code>Lock</code> báº±ng cÃ¡ch gá»i cÃ¡c phÆ°Æ¡ng thá»©c tÆ°Æ¡ng á»©ng trong <code>ReentrantLock.FairSync</code> hoáº·c <code>ReentrantLock.NonfairSync</code>, khÃ´ng cáº§n liá»‡t kÃª tá»«ng phÆ°Æ¡ng thá»©c má»™t.</p><h4 id="lay-khoa-va-giai-phong-khoa-cua-reentrantlock" tabindex="-1"><a class="header-anchor" href="#lay-khoa-va-giai-phong-khoa-cua-reentrantlock"><span>Láº¥y khÃ³a vÃ  giáº£i phÃ³ng khÃ³a cá»§a ReentrantLock</span></a></h4><p>Giao diá»‡n láº¥y khÃ³a vÃ  giáº£i phÃ³ng khÃ³a cá»§a ReentrantLock, tá»« bá» ngoÃ i, lÃ  gá»i cÃ¡c phÆ°Æ¡ng thá»©c tÆ°Æ¡ng á»©ng trong <code>ReentrantLock.FairSync</code> hoáº·c <code>ReentrantLock.NonfairSync</code>; tá»« báº£n cháº¥t, nÃ³ dá»±a trÃªn AQS.</p><p>Äá»c mÃ£ nguá»“n cáº©n tháº­n, ta dá»… dÃ ng nháº­n tháº¥y:</p><ul><li><code>void lock()</code> gá»i phÆ°Æ¡ng thá»©c lock() cá»§a Sync.</li><li><code>void lockInterruptibly()</code> trá»±c tiáº¿p gá»i phÆ°Æ¡ng thá»©c láº¥y khÃ³a cÃ³ thá»ƒ bá»‹ giÃ¡n Ä‘oáº¡n <code>lockInterruptibly()</code> cá»§a AQS.</li><li><code>boolean tryLock()</code> gá»i phÆ°Æ¡ng thá»©c <code>nonfairTryAcquire()</code> cá»§a Sync.</li><li><code>boolean tryLock(long time, TimeUnit unit)</code> trá»±c tiáº¿p gá»i phÆ°Æ¡ng thá»©c láº¥y khÃ³a chá» Ä‘á»£i vá»›i thá»i gian chá» <code>tryAcquireNanos(int arg, long nanosTimeout)</code> cá»§a AQS.</li><li><code>void unlock()</code> trá»±c tiáº¿p gá»i phÆ°Æ¡ng thá»©c giáº£i phÃ³ng khÃ³a <code>release(int arg)</code> cá»§a AQS.</li></ul><p>Viá»‡c gá»i trá»±c tiáº¿p cÃ¡c phÆ°Æ¡ng thá»©c cá»§a AQS khÃ´ng Ä‘Æ°á»£c trÃ¬nh bÃ y chi tiáº¿t á»Ÿ Ä‘Ã¢y, vÃ¬ nguyÃªn lÃ½ cá»§a chÃºng Ä‘Ã£ Ä‘Æ°á»£c trÃ¬nh bÃ y trong pháº§n [NguyÃªn lÃ½ cá»§a AQS](NguyÃªn lÃ½ cá»§a AQS).</p><p>PhÆ°Æ¡ng thá»©c <code>nonfairTryAcquire</code> trong mÃ£ nguá»“n:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Cáº£ khÃ³a cÃ´ng báº±ng vÃ  khÃ´ng cÃ´ng báº±ng Ä‘á»u sá»­ dá»¥ng phÆ°Æ¡ng thá»©c nÃ y Ä‘á»ƒ thá»­ láº¥y khÃ³a</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> nonfairTryAcquire</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> acquires) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> current </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> c </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getState</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (c </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">compareAndSetState</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> acquires)) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">         // Náº¿u tráº¡ng thÃ¡i Ä‘á»“ng bá»™ lÃ  0, thiáº¿t láº­p nÃ³ thÃ nh acquires vÃ  Ä‘áº·t luá»“ng hiá»‡n táº¡i lÃ  luá»“ng Ä‘á»™c quyá»n</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            setExclusiveOwnerThread</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(current)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    else</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (current </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getExclusiveOwnerThread</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> nextc </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> c </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> acquires</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (nextc </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// TrÃ n sá»‘</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            throw</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Error</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Maximum lock count exceeded&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        setState</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(nextc)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>QuÃ¡ trÃ¬nh xá»­ lÃ½ ráº¥t Ä‘Æ¡n giáº£n:</p><ul><li>Náº¿u tráº¡ng thÃ¡i Ä‘á»“ng bá»™ lÃ  0, thiáº¿t láº­p tráº¡ng thÃ¡i Ä‘á»“ng bá»™ thÃ nh acquires vÃ  Ä‘áº·t luá»“ng hiá»‡n táº¡i lÃ  luá»“ng Ä‘á»™c quyá»n, sau Ä‘Ã³ tráº£ vá» true, láº¥y khÃ³a thÃ nh cÃ´ng.</li><li>Náº¿u tráº¡ng thÃ¡i Ä‘á»“ng bá»™ khÃ´ng pháº£i lÃ  0 vÃ  luá»“ng hiá»‡n táº¡i lÃ  luá»“ng Ä‘á»™c quyá»n, thiáº¿t láº­p tráº¡ng thÃ¡i Ä‘á»“ng bá»™ thÃ nh giÃ¡ trá»‹ hiá»‡n táº¡i cá»™ng vá»›i acquires, sau Ä‘Ã³ tráº£ vá» true, láº¥y khÃ³a thÃ nh cÃ´ng.</li><li>NgÆ°á»£c láº¡i, tráº£ vá» false, láº¥y khÃ³a khÃ´ng thÃ nh cÃ´ng.</li></ul><h4 id="khoa-cong-bang-va-khong-cong-bang" tabindex="-1"><a class="header-anchor" href="#khoa-cong-bang-va-khong-cong-bang"><span>KhÃ³a cÃ´ng báº±ng vÃ  khÃ´ng cÃ´ng báº±ng</span></a></h4><p>Lá»›p <code>ReentrantLock</code> cÃ³ hai hÃ m táº¡o, má»™t lÃ  hÃ m táº¡o khÃ´ng tham sá»‘ vÃ  má»™t lÃ  hÃ m táº¡o vá»›i tham sá»‘ <code>fair</code>. Tham sá»‘ <code>fair</code> Ä‘áº¡i diá»‡n cho chiáº¿n lÆ°á»£c cÃ´ng báº±ng cá»§a khÃ³a, náº¿u truyá»n vÃ o <code>true</code> thÃ¬ táº¡o má»™t khÃ³a cÃ´ng báº±ng, ngÆ°á»£c láº¡i thÃ¬ táº¡o má»™t khÃ³a khÃ´ng cÃ´ng báº±ng.</p><p>Má»—i khÃ³a Ä‘á»u tÆ°Æ¡ng á»©ng vá»›i má»™t hÃ ng Ä‘á»£i chá», náº¿u má»™t luá»“ng khÃ´ng láº¥y Ä‘Æ°á»£c khÃ³a, nÃ³ sáº½ vÃ o hÃ ng Ä‘á»£i chá», khi má»™t luá»“ng giáº£i phÃ³ng khÃ³a, cáº§n Ä‘Ã¡nh thá»©c má»™t luá»“ng Ä‘ang chá». Náº¿u lÃ  khÃ³a cÃ´ng báº±ng, chiáº¿n lÆ°á»£c Ä‘Ã¡nh thá»©c lÃ  Ä‘Ã¡nh thá»©c luá»“ng chá» lÃ¢u nháº¥t, ráº¥t cÃ´ng báº±ng; náº¿u lÃ  khÃ³a khÃ´ng cÃ´ng báº±ng, khÃ´ng Ä‘áº£m báº£o cÃ´ng báº±ng, cÃ³ thá»ƒ Ä‘Ã¡nh thá»©c luá»“ng chá» Ã­t thá»i gian hÆ¡n.</p><p>PhÆ°Æ¡ng thá»©c lock() trong khÃ³a cÃ´ng báº±ng vÃ  khÃ´ng cÃ´ng báº±ng:</p><p>Sá»± khÃ¡c biá»‡t giá»¯a hai phÆ°Æ¡ng thá»©c chá»‰ lÃ  khi yÃªu cáº§u má»™t khÃ³a khÃ´ng cÃ´ng báº±ng, náº¿u tráº¡ng thÃ¡i Ä‘á»“ng bá»™ lÃ  0, thá»­ thiáº¿t láº­p nÃ³ thÃ nh 1, náº¿u thÃ nh cÃ´ng, Ä‘áº·t luá»“ng hiá»‡n táº¡i lÃ  luá»“ng Ä‘á»™c quyá»n; náº¿u khÃ´ng, giá»‘ng nhÆ° khÃ³a cÃ´ng báº±ng, gá»i phÆ°Æ¡ng thá»©c AQS Ä‘á»ƒ láº¥y khÃ³a.</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// KhÃ³a khÃ´ng cÃ´ng báº±ng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> lock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">compareAndSetState</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#E06C75;--shiki-dark:#E06C75;">))</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Náº¿u tráº¡ng thÃ¡i Ä‘á»“ng bá»™ lÃ  0, thiáº¿t láº­p nÃ³ thÃ nh 1 vÃ  Ä‘áº·t luá»“ng hiá»‡n táº¡i lÃ  luá»“ng Ä‘á»™c quyá»n</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        setExclusiveOwnerThread</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#E06C75;--shiki-dark:#E06C75;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    else</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Gá»i phÆ°Æ¡ng thá»©c AQS Ä‘á»ƒ láº¥y khÃ³a</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        acquire</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#E06C75;--shiki-dark:#E06C75;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// KhÃ³a cÃ´ng báº±ng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> lock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Gá»i phÆ°Æ¡ng thá»©c AQS Ä‘á»ƒ láº¥y khÃ³a</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    acquire</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#E06C75;--shiki-dark:#E06C75;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="reentrantreadwritelock" tabindex="-1"><a class="header-anchor" href="#reentrantreadwritelock"><span>ReentrantReadWriteLock</span></a></h2><p><code>ReadWriteLock</code> Ä‘Æ°á»£c sá»­ dá»¥ng trong cÃ¡c tÃ¬nh huá»‘ng <strong>Ä‘á»c nhiá»u, ghi Ã­t</strong>.</p><p><code>ReentrantReadWriteLock</code> lÃ  má»™t lá»›p cá»¥ thá»ƒ cá»§a <code>ReadWriteLock</code> vÃ  lÃ  má»™t loáº¡i khÃ³a Ä‘á»c/ghi cÃ³ thá»ƒ láº·p láº¡i. <code>ReentrantReadWriteLock</code> duy trÃ¬ má»™t cáº·p khÃ³a Ä‘á»c vÃ  ghi, tÃ¡ch biá»‡t khÃ³a Ä‘á»c vÃ  khÃ³a ghi, giÃºp tÄƒng hiá»‡u suáº¥t Ä‘á»“ng thá»i.</p><p>KhÃ³a Ä‘á»c/ghi khÃ´ng pháº£i lÃ  má»™t khÃ¡i niá»‡m Ä‘á»™c quyá»n cá»§a ngÃ´n ngá»¯ Java, mÃ  lÃ  má»™t cÃ´ng nghá»‡ phá»• biáº¿n Ä‘Æ°á»£c sá»­ dá»¥ng rá»™ng rÃ£i. Táº¥t cáº£ cÃ¡c khÃ³a Ä‘á»c/ghi Ä‘á»u tuÃ¢n thá»§ ba nguyÃªn táº¯c cÆ¡ báº£n sau:</p><ul><li>Cho phÃ©p nhiá»u luá»“ng Ä‘á»c cÃ¹ng truy cáº­p biáº¿n chia sáº»;</li><li>Chá»‰ cho phÃ©p má»™t luá»“ng ghi truy cáº­p biáº¿n chia sáº»;</li><li>Náº¿u má»™t luá»“ng Ä‘ang ghi, cÃ¡c luá»“ng Ä‘á»c khÃ¡c khÃ´ng Ä‘Æ°á»£c phÃ©p truy cáº­p biáº¿n chia sáº».</li></ul><p>Má»™t Ä‘iá»ƒm khÃ¡c biá»‡t quan trá»ng giá»¯a khÃ³a Ä‘á»c/ghi vÃ  khÃ³a Ä‘á»™c quyá»n lÃ  <strong>khÃ³a Ä‘á»c/ghi cho phÃ©p nhiá»u luá»“ng Ä‘á»c cÃ¹ng truy cáº­p biáº¿n chia sáº»</strong>, trong khi khÃ³a Ä‘á»™c quyá»n khÃ´ng cho phÃ©p. Äiá»u nÃ y lÃ  yáº¿u tá»‘ quan trá»ng giÃºp khÃ³a Ä‘á»c/ghi cÃ³ hiá»‡u suáº¥t tá»‘t hÆ¡n khÃ³a Ä‘á»™c quyá»n trong cÃ¡c tÃ¬nh huá»‘ng Ä‘á»c nhiá»u, ghi Ã­t. Tuy nhiÃªn, <strong>cÃ¡c hoáº¡t Ä‘á»™ng ghi trong khÃ³a Ä‘á»c/ghi lÃ  Ä‘á»™c quyá»n</strong>, khi má»™t luá»“ng Ä‘ang ghi, khÃ´ng cho phÃ©p cÃ¡c luá»“ng khÃ¡c thá»±c hiá»‡n hoáº¡t Ä‘á»™ng ghi hoáº·c Ä‘á»c.</p><h3 id="tinh-nang-cua-reentrantreadwritelock" tabindex="-1"><a class="header-anchor" href="#tinh-nang-cua-reentrantreadwritelock"><span>TÃ­nh nÄƒng cá»§a ReentrantReadWriteLock</span></a></h3><p>CÃ¡c tÃ­nh nÄƒng cá»§a ReentrantReadWriteLock nhÆ° sau:</p><ul><li><strong><code>ReentrantReadWriteLock</code> phÃ¹ há»£p vá»›i cÃ¡c tÃ¬nh huá»‘ng Ä‘á»c nhiá»u, ghi Ã­t</strong>. Náº¿u tÃ¬nh huá»‘ng lÃ  ghi nhiá»u, Ä‘á»c Ã­t, viá»‡c triá»ƒn khai <code>ReentrantReadWriteLock</code> cÃ³ thá»ƒ phá»©c táº¡p hÆ¡n so vá»›i <code>ReentrantLock</code> vÃ  cÃ³ thá»ƒ lÃ m giáº£m hiá»‡u suáº¥t. Trong trÆ°á»ng há»£p nÃ y, cáº§n phÃ¢n tÃ­ch cá»¥ thá»ƒ tá»«ng trÆ°á»ng há»£p. VÃ¬ cáº£ khÃ³a Ä‘á»c (<code>ReadLock</code>) vÃ  khÃ³a ghi (<code>WriteLock</code>) cá»§a <code>ReentrantReadWriteLock</code> Ä‘á»u triá»ƒn khai giao diá»‡n <code>Lock</code>, viá»‡c thay tháº¿ báº±ng <code>ReentrantLock</code> cÅ©ng khÃ¡ dá»… dÃ ng.</li><li><code>ReentrantReadWriteLock</code> triá»ƒn khai giao diá»‡n <code>ReadWriteLock</code>, há»— trá»£ viá»‡c tÃ¡ch biá»‡t khÃ³a Ä‘á»c vÃ  khÃ³a ghi so vá»›i <code>ReentrantLock</code>. <code>ReentrantReadWriteLock</code> duy trÃ¬ má»™t cáº·p khÃ³a Ä‘á»c vÃ  ghi (<code>ReadLock</code>, <code>WriteLock</code>). TÃ¡ch biá»‡t khÃ³a Ä‘á»c vÃ  khÃ³a ghi giÃºp tÄƒng hiá»‡u suáº¥t Ä‘á»“ng thá»i. Chiáº¿n lÆ°á»£c khÃ³a cá»§a <code>ReentrantReadWriteLock</code> lÃ : <strong>cho phÃ©p nhiá»u hoáº¡t Ä‘á»™ng Ä‘á»c cÃ¹ng thá»i Ä‘iá»ƒm, nhÆ°ng chá»‰ cho phÃ©p má»™t hoáº¡t Ä‘á»™ng ghi táº¡i má»™t thá»i Ä‘iá»ƒm</strong>.</li><li><code>ReentrantReadWriteLock</code> cung cáº¥p kháº£ nÄƒng khÃ³a cÃ³ thá»ƒ láº·p láº¡i cho cáº£ khÃ³a Ä‘á»c vÃ  khÃ³a ghi.</li><li><code>ReentrantReadWriteLock</code> há»— trá»£ cáº£ khÃ³a cÃ´ng báº±ng vÃ  khÃ³a khÃ´ng cÃ´ng báº±ng (máº·c Ä‘á»‹nh lÃ  khÃ´ng cÃ´ng báº±ng) hai cháº¿ Ä‘á»™.</li></ul><p>Giao diá»‡n <code>ReadWriteLock</code> Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a nhÆ° sau:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ReadWriteLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    Lock</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> readLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    Lock</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> writeLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li><code>readLock</code> - Tráº£ vá» khÃ³a (<code>ReadLock</code>) Ä‘á»ƒ thá»±c hiá»‡n hoáº¡t Ä‘á»™ng Ä‘á»c.</li><li><code>writeLock</code> - Tráº£ vá» khÃ³a (<code>WriteLock</code>) Ä‘á»ƒ thá»±c hiá»‡n hoáº¡t Ä‘á»™ng ghi.</li></ul><p>CÃ³ nhiá»u cÃ¡ch Ä‘á»ƒ thá»±c hiá»‡n sá»± tÆ°Æ¡ng tÃ¡c giá»¯a khÃ³a Ä‘á»c/ghi vÃ  khÃ³a ghi, vÃ  má»™t sá»‘ cÃ¡ch thá»±c hiá»‡n tÃ¹y chá»n cá»§a <code>ReadWriteLock</code> bao gá»“m:</p><ul><li><strong>Æ¯u tiÃªn giáº£i phÃ³ng</strong> - Khi má»™t hoáº¡t Ä‘á»™ng ghi giáº£i phÃ³ng khÃ³a ghi vÃ  cÃ¹ng lÃºc cÃ³ cáº£ luá»“ng Ä‘á»c vÃ  luá»“ng ghi trong hÃ ng Ä‘á»£i, thÃ¬ Æ°u tiÃªn Ä‘Æ°á»£c chá»n lÃ  luá»“ng Ä‘á»c, luá»“ng ghi hoáº·c luá»“ng yÃªu cáº§u trÆ°á»›c nháº¥t?</li><li><strong>Luá»“ng Ä‘á»c chen vÃ o</strong> - Náº¿u khÃ³a Ä‘ang Ä‘Æ°á»£c má»™t luá»“ng Ä‘á»c náº¯m giá»¯ nhÆ°ng cÃ³ má»™t luá»“ng ghi Ä‘ang chá» Ä‘á»£i, liá»‡u luá»“ng Ä‘á»c má»›i cÃ³ thá»ƒ láº¥y quyá»n truy cáº­p ngay láº­p tá»©c hay pháº£i Ä‘á»£i sau luá»“ng ghi? Náº¿u cho phÃ©p luá»“ng Ä‘á»c chen vÃ o trÆ°á»›c luá»“ng ghi, Ä‘iá»u nÃ y sáº½ cáº£i thiá»‡n tÃ­nh cáº¡nh tranh song song, nhÆ°ng cÃ³ thá»ƒ gÃ¢y ra tÃ¬nh tráº¡ng Ä‘Ã³i luá»“ng (thread starvation).</li><li><strong>Kháº£ nÄƒng láº·p láº¡i</strong> - KhÃ³a Ä‘á»c vÃ  khÃ³a ghi cÃ³ thá»ƒ láº·p láº¡i khÃ´ng?</li><li><strong>Giáº£m cáº¥p</strong> - Náº¿u má»™t luá»“ng náº¯m giá»¯ khÃ³a ghi, liá»‡u nÃ³ cÃ³ thá»ƒ nháº­n khÃ³a Ä‘á»c mÃ  khÃ´ng cáº§n giáº£i phÃ³ng khÃ³a ghi? Äiá»u nÃ y cÃ³ thá»ƒ lÃ m giáº£m cáº¥p khÃ³a ghi thÃ nh khÃ³a Ä‘á»c mÃ  khÃ´ng cho phÃ©p cÃ¡c luá»“ng ghi khÃ¡c thay Ä‘á»•i tÃ i nguyÃªn Ä‘Æ°á»£c báº£o vá»‡.</li><li><strong>NÃ¢ng cáº¥p</strong> - KhÃ³a Ä‘á»c cÃ³ thá»ƒ Ä‘Æ°á»£c Æ°u tiÃªn trÆ°á»›c cÃ¡c luá»“ng Ä‘á»c vÃ  ghi khÃ¡c Ä‘ang chá» Ä‘á»£i Ä‘á»ƒ nÃ¢ng cáº¥p thÃ nh khÃ³a ghi khÃ´ng? Trong háº§u háº¿t cÃ¡c triá»ƒn khai khÃ³a Ä‘á»c/ghi, khÃ´ng há»— trá»£ nÃ¢ng cáº¥p mÃ  khÃ´ng cÃ³ hoáº¡t Ä‘á»™ng nÃ¢ng cáº¥p rÃµ rÃ ng, vÃ¬ Ä‘iá»u nÃ y cÃ³ thá»ƒ dáº«n Ä‘áº¿n tÃ¬nh tráº¡ng káº¹t (deadlock) náº¿u khÃ´ng cÃ³ hoáº¡t Ä‘á»™ng nÃ¢ng cáº¥p rÃµ rÃ ng.</li></ul><h3 id="cach-su-dung-reentrantreadwritelock" tabindex="-1"><a class="header-anchor" href="#cach-su-dung-reentrantreadwritelock"><span>CÃ¡ch sá»­ dá»¥ng ReentrantReadWriteLock</span></a></h3><p>Trong pháº§n trÆ°á»›c, chÃºng ta Ä‘Ã£ tÃ¬m hiá»ƒu vá» cÃ¡c tÃ­nh nÄƒng cá»§a <code>ReentrantReadWriteLock</code>. Tiáº¿p theo, chÃºng ta sáº½ trÃ¬nh bÃ y cÃ¡ch sá»­ dá»¥ng cá»¥ thá»ƒ cá»§a nÃ³.</p><h4 id="phuong-thuc-khoi-tao-cua-reentrantreadwritelock" tabindex="-1"><a class="header-anchor" href="#phuong-thuc-khoi-tao-cua-reentrantreadwritelock"><span>PhÆ°Æ¡ng thá»©c khá»Ÿi táº¡o cá»§a ReentrantReadWriteLock</span></a></h4><p><code>ReentrantReadWriteLock</code> cÅ©ng giá»‘ng nhÆ° <code>ReentrantLock</code>, cÃ³ hai phÆ°Æ¡ng thá»©c khá»Ÿi táº¡o vÃ  cÃ¡ch sá»­ dá»¥ng tÆ°Æ¡ng tá»±.</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ReentrantReadWriteLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">() {}</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ReentrantReadWriteLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> fair) {}</span></span></code></pre></div><ul><li><code>ReentrantReadWriteLock()</code> - PhÆ°Æ¡ng thá»©c khá»Ÿi táº¡o máº·c Ä‘á»‹nh sáº½ táº¡o ra má»™t <strong>khÃ³a khÃ´ng cÃ´ng báº±ng (NonfairSync)</strong>. Trong khÃ³a khÃ´ng cÃ´ng báº±ng, thá»© tá»± mÃ  cÃ¡c luá»“ng nháº­n khÃ³a lÃ  khÃ´ng xÃ¡c Ä‘á»‹nh. Viá»‡c giáº£m cáº¥p tá»« khÃ³a ghi thÃ nh khÃ³a Ä‘á»c lÃ  cÃ³ thá»ƒ, nhÆ°ng viá»‡c tÄƒng cáº¥p tá»« khÃ³a Ä‘á»c thÃ nh khÃ³a ghi lÃ  khÃ´ng thá»ƒ (Ä‘iá»u nÃ y cÃ³ thá»ƒ dáº«n Ä‘áº¿n tÃ¬nh tráº¡ng káº¹t).</li><li><code>ReentrantReadWriteLock(boolean)</code> - <code>new ReentrantLock(true)</code> sáº½ táº¡o ra má»™t <strong>khÃ³a cÃ´ng báº±ng (FairSync)</strong>. Vá»›i khÃ³a cÃ´ng báº±ng, luá»“ng chá» lÃ¢u nháº¥t sáº½ Ä‘Æ°á»£c Æ°u tiÃªn nháº­n khÃ³a. Náº¿u khÃ³a Ä‘ang Ä‘Æ°á»£c má»™t luá»“ng Ä‘á»c náº¯m giá»¯, vÃ  má»™t luá»“ng ghi Ä‘ang chá» Ä‘á»£i, luá»“ng Ä‘á»c má»›i cÃ³ thá»ƒ nháº­n quyá»n truy cáº­p ngay láº­p tá»©c hoáº·c pháº£i Ä‘á»£i sau luá»“ng ghi. Náº¿u cho phÃ©p luá»“ng Ä‘á»c chen vÃ o trÆ°á»›c luá»“ng ghi, Ä‘iá»u nÃ y sáº½ cáº£i thiá»‡n tÃ­nh cáº¡nh tranh song song, nhÆ°ng cÃ³ thá»ƒ gÃ¢y ra tÃ¬nh tráº¡ng Ä‘Ã³i luá»“ng (thread starvation).</li></ul><h4 id="vi-du-ve-cach-su-dung-reentrantreadwritelock" tabindex="-1"><a class="header-anchor" href="#vi-du-ve-cach-su-dung-reentrantreadwritelock"><span>VÃ­ dá»¥ vá» cÃ¡ch sá»­ dá»¥ng ReentrantReadWriteLock</span></a></h4><p>Trong pháº§n TÃ­nh nÄƒng cá»§a <code>ReentrantReadWriteLock</code>, chÃºng ta Ä‘Ã£ giá»›i thiá»‡u ráº±ng khÃ³a Ä‘á»c/ghi (ReadLock, WriteLock) cá»§a <code>ReentrantReadWriteLock</code> cÅ©ng triá»ƒn khai giao diá»‡n <code>Lock</code>, do Ä‘Ã³ cÃ¡ch sá»­ dá»¥ng riÃªng cá»§a chÃºng tÆ°Æ¡ng tá»± nhÆ° <code>ReentrantLock</code> vÃ  khÃ´ng Ä‘Æ°á»£c trÃ¬nh bÃ y á»Ÿ Ä‘Ã¢y.</p><p>Sá»± khÃ¡c biá»‡t chÃ­nh giá»¯a <code>ReentrantReadWriteLock</code> vÃ  <code>ReentrantLock</code> náº±m á»Ÿ cÃ¡ch sá»­ dá»¥ng khÃ³a Ä‘á»c vÃ  khÃ³a ghi cÃ¹ng nhau. VÃ­ dá»¥ dÆ°á»›i Ä‘Ã¢y sáº½ giáº£i thÃ­ch Ä‘iá»u nÃ y thÃ´ng qua má»™t tÃ¬nh huá»‘ng sá»­ dá»¥ng Ä‘iá»ƒn hÃ¬nh.</p><p>ã€VÃ­ dá»¥ã€‘Sá»­ dá»¥ng <code>ReadWriteLock</code> Ä‘á»ƒ triá»ƒn khai má»™t bá»™ nhá»› cache khÃ´ng giá»›i háº¡n vá»›i kiá»ƒu dá»¯ liá»‡u tá»•ng quÃ¡t</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">/**</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> * Triá»ƒn khai Ä‘Æ¡n giáº£n cá»§a bá»™ nhá»› cache khÃ´ng giá»›i háº¡n</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> * &lt;p&gt;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> * Sá»­ dá»¥ng WeakHashMap Ä‘á»ƒ lÆ°u trá»¯ cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹. WeakHashMap lÆ°u trá»¯ cÃ¡c Ä‘á»‘i tÆ°á»£ng dÆ°á»›i dáº¡ng tham chiáº¿u yáº¿u, JVM sáº½ tá»± Ä‘á»™ng xÃ³a cÃ¡c Ä‘á»‘i tÆ°á»£ng tham chiáº¿u yáº¿u khÃ´ng Ä‘Æ°á»£c tham chiáº¿u.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> UnboundedCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">K</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> V</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">K</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> V</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cacheMap </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> WeakHashMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ReadWriteLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cacheLock </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ReentrantReadWriteLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> V</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">K</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        cacheLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">readLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        V</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            value </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> cacheMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> log</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;%s Ä‘á»c dá»¯ liá»‡u %s:%s&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(), key, value);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(log);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            cacheLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">readLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> value;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> V</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">K</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">V</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        cacheLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">writeLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            cacheMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> log</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;%s ghi dá»¯ liá»‡u %s:%s&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(), key, value);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(log);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            cacheLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">writeLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> value;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> V</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">K</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        cacheLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">writeLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> cacheMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            cacheLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">writeLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> clear</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        cacheLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">writeLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">cacheMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">clear</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            cacheLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">writeLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Giáº£i thÃ­ch:</p><ul><li>Sá»­ dá»¥ng <code>WeakHashMap</code> thay vÃ¬ <code>HashMap</code> Ä‘á»ƒ lÆ°u trá»¯ cÃ¡c cáº·p khÃ³a-giÃ¡ trá»‹. <code>WeakHashMap</code> lÆ°u trá»¯ cÃ¡c Ä‘á»‘i tÆ°á»£ng dÆ°á»›i dáº¡ng tham chiáº¿u yáº¿u, JVM sáº½ tá»± Ä‘á»™ng xÃ³a cÃ¡c Ä‘á»‘i tÆ°á»£ng tham chiáº¿u yáº¿u khÃ´ng Ä‘Æ°á»£c tham chiáº¿u.</li><li>TrÆ°á»›c khi ghi dá»¯ liá»‡u vÃ o <code>Map</code>, khÃ³a ghi Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ khÃ³a. Sau khi ghi xong, khÃ³a ghi Ä‘Æ°á»£c giáº£i phÃ³ng.</li><li>TrÆ°á»›c khi Ä‘á»c dá»¯ liá»‡u tá»« <code>Map</code>, khÃ³a Ä‘á»c Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ khÃ³a. Sau khi Ä‘á»c xong, khÃ³a Ä‘á»c Ä‘Æ°á»£c giáº£i phÃ³ng.</li></ul><p>Kiá»ƒm tra tÃ­nh an toÃ n Ä‘a luá»“ng:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ReentrantReadWriteLockDemo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> UnboundedCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cache </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> UnboundedCache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        ExecutorService</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> executorService</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Executors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">newCachedThreadPool</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 20</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; i++) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            executorService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">execute</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MyThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            cache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        executorService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">shutdown</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /** Má»—i luá»“ng nhiá»‡m vá»¥ ghi 3 giÃ¡ trá»‹ ngáº«u nhiÃªn vÃ o cache, key cá»‘ Ä‘á»‹nh */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> MyThread</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Runnable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            Random</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> random</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Random</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> i</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; i </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">; i++) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                cache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(i, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">random</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nextInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Giáº£i thÃ­ch: Trong vÃ­ dá»¥ nÃ y, chÃºng ta sá»­ dá»¥ng má»™t <code>ExecutorService</code> Ä‘á»ƒ khá»Ÿi cháº¡y 20 nhiá»‡m vá»¥ Ä‘á»“ng thá»i. Má»—i nhiá»‡m vá»¥ sáº½ ghi 3 giÃ¡ trá»‹ ngáº«u nhiÃªn vÃ o cache, vá»›i key cá»‘ Ä‘á»‹nh. Sau Ä‘Ã³, luá»“ng chÃ­nh sáº½ Ä‘á»c giÃ¡ trá»‹ Ä‘áº§u tiÃªn trong cache.</p><p>Káº¿t quáº£ Ä‘áº§u ra:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>main Ä‘á»c dá»¯ liá»‡u 0:null</span></span>
<span class="line"><span>pool-1-thread-1 ghi dá»¯ liá»‡u 0:16</span></span>
<span class="line"><span>pool-1-thread-1 ghi dá»¯ liá»‡u 1:58</span></span>
<span class="line"><span>pool-1-thread-1 ghi dá»¯ liá»‡u 2:50</span></span>
<span class="line"><span>main Ä‘á»c dá»¯ liá»‡u 0:16</span></span>
<span class="line"><span>pool-1-thread-1 ghi dá»¯ liá»‡u 0:85</span></span>
<span class="line"><span>pool-1-thread-1 ghi dá»¯ liá»‡u 1:76</span></span>
<span class="line"><span>pool-1-thread-1 ghi dá»¯ liá»‡u 2:46</span></span>
<span class="line"><span>pool-1-thread-2 ghi dá»¯ liá»‡u 0:21</span></span>
<span class="line"><span>pool-1-thread-2 ghi dá»¯ liá»‡u 1:41</span></span>
<span class="line"><span>pool-1-thread-2 ghi dá»¯ liá»‡u 2:63</span></span>
<span class="line"><span>main Ä‘á»c dá»¯ liá»‡u 0:21</span></span>
<span class="line"><span>main Ä‘á»c dá»¯ liá»‡u 0:21</span></span>
<span class="line"><span>//...</span></span></code></pre></div><h3 id="nguyen-ly-hoat-Ä‘ong-cua-reentrantreadwritelock" tabindex="-1"><a class="header-anchor" href="#nguyen-ly-hoat-Ä‘ong-cua-reentrantreadwritelock"><span>NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng cá»§a ReentrantReadWriteLock</span></a></h3><p>Sau khi tÃ¬m hiá»ƒu vá» nguyÃªn lÃ½ hoáº¡t Ä‘á»™ng cá»§a <code>ReentrantLock</code>, viá»‡c hiá»ƒu vá» <code>ReentrantReadWriteLock</code> sáº½ dá»… dÃ ng hÆ¡n nhiá»u.</p><h4 id="cau-truc-du-lieu-cua-reentrantreadwritelock" tabindex="-1"><a class="header-anchor" href="#cau-truc-du-lieu-cua-reentrantreadwritelock"><span>Cáº¥u trÃºc dá»¯ liá»‡u cá»§a ReentrantReadWriteLock</span></a></h4><p>Äá»c mÃ£ nguá»“n cá»§a <code>ReentrantReadWriteLock</code>, ta cÃ³ thá»ƒ tháº¥y ráº±ng nÃ³ cÃ³ ba trÆ°á»ng cá»‘t lÃµi:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">/** Lá»›p ná»™i cung cáº¥p khÃ³a Ä‘á»c */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ReentrantReadWriteLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ReadLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> readerLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">/** Lá»›p ná»™i cung cáº¥p khÃ³a ghi */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ReentrantReadWriteLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">WriteLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> writerLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">/** Thá»±c hiá»‡n táº¥t cáº£ cÆ¡ cháº¿ Ä‘á»“ng bá»™ */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Sync</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> sync</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ReentrantReadWriteLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">WriteLock</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> writeLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">() { </span><span style="color:#C678DD;--shiki-dark:#C678DD;">return</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> writerLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ReentrantReadWriteLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ReadLock</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">  readLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()  { </span><span style="color:#C678DD;--shiki-dark:#C678DD;">return</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> readerLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> }</span></span></code></pre></div><ul><li><code>sync</code> - Ä‘á»‘i tÆ°á»£ng lá»›p ná»™i <code>ReentrantReadWriteLock.Sync</code>. TÆ°Æ¡ng tá»± nhÆ° <code>ReentrantLock</code>, nÃ³ cÃ³ hai lá»›p con: <code>ReentrantReadWriteLock.FairSync</code> vÃ  <code>ReentrantReadWriteLock.NonfairSync</code>, láº§n lÆ°á»£t Ä‘áº¡i diá»‡n cho cÃ i Ä‘áº·t khÃ³a cÃ´ng báº±ng vÃ  khÃ´ng cÃ´ng báº±ng.</li><li><code>readerLock</code> - Ä‘á»‘i tÆ°á»£ng lá»›p ná»™i <code>ReentrantReadWriteLock.ReadLock</code>, Ä‘Ã¢y lÃ  má»™t khÃ³a Ä‘á»c.</li><li><code>writerLock</code> - Ä‘á»‘i tÆ°á»£ng lá»›p ná»™i <code>ReentrantReadWriteLock.WriteLock</code>, Ä‘Ã¢y lÃ  má»™t khÃ³a ghi.</li></ul><h4 id="lay-khoa-va-giai-phong-khoa-cua-reentrantreadwritelock" tabindex="-1"><a class="header-anchor" href="#lay-khoa-va-giai-phong-khoa-cua-reentrantreadwritelock"><span>Láº¥y khÃ³a vÃ  giáº£i phÃ³ng khÃ³a cá»§a ReentrantReadWriteLock</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ReadLock</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java.io.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Gá»i phÆ°Æ¡ng thá»©c láº¥y khÃ³a chia sáº» cá»§a AQS</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        sync</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">acquireShared</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Gá»i phÆ°Æ¡ng thá»©c giáº£i phÃ³ng khÃ³a chia sáº» cá»§a AQS</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        sync</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">releaseShared</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> WriteLock</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java.io.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Gá»i phÆ°Æ¡ng thá»©c láº¥y khÃ³a Ä‘á»™c quyá»n cá»§a AQS</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        sync</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">acquire</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Gá»i phÆ°Æ¡ng thá»©c giáº£i phÃ³ng khÃ³a Ä‘á»™c quyá»n cá»§a AQS</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> unlock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        sync</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">release</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="stampedlock" tabindex="-1"><a class="header-anchor" href="#stampedlock"><span>StampedLock</span></a></h2><p>ReadWriteLock há»— trá»£ hai cháº¿ Ä‘á»™: khÃ³a Ä‘á»c vÃ  khÃ³a ghi. Trong khi Ä‘Ã³, StampedLock há»— trá»£ ba cháº¿ Ä‘á»™: <strong>khÃ³a ghi</strong>, <strong>khÃ³a Ä‘á»c bi quan</strong> vÃ  <strong>Ä‘á»c láº¡c quan</strong>. Trong Ä‘Ã³, Ã½ nghÄ©a cá»§a khÃ³a ghi vÃ  khÃ³a Ä‘á»c bi quan trong StampedLock ráº¥t giá»‘ng vá»›i Ã½ nghÄ©a cá»§a khÃ³a ghi vÃ  khÃ³a Ä‘á»c trong ReadWriteLock, cho phÃ©p nhiá»u luá»“ng Ä‘á»c bi quan cÃ¹ng lÃºc, nhÆ°ng chá»‰ cho phÃ©p má»™t luá»“ng ghi, khÃ³a ghi vÃ  khÃ³a Ä‘á»c bi quan lÃ  Ä‘á»‘i khÃ¡ng. Tuy nhiÃªn, Ä‘iá»ƒm khÃ¡c biá»‡t lÃ : sau khi khÃ³a ghi hoáº·c khÃ³a Ä‘á»c bi quan trong StampedLock thÃ nh cÃ´ng, nÃ³ sáº½ tráº£ vá» má»™t con dáº¥u (stamp); sau Ä‘Ã³, khi giáº£i phÃ³ng khÃ³a, cáº§n truyá»n con dáº¥u nÃ y.</p><blockquote><p>LÆ°u Ã½ ráº±ng, á»Ÿ Ä‘Ã¢y sá»­ dá»¥ng thuáº­t ngá»¯ &quot;Ä‘á»c láº¡c quan&quot; thay vÃ¬ &quot;khÃ³a Ä‘á»c láº¡c quan&quot;, Ä‘á»ƒ nháº¯c nhá»Ÿ ráº±ng hoáº¡t Ä‘á»™ng &quot;Ä‘á»c láº¡c quan&quot; nÃ y khÃ´ng cÃ³ khÃ³a, do Ä‘Ã³ so vá»›i khÃ³a Ä‘á»c cá»§a ReadWriteLock, hoáº¡t Ä‘á»™ng &quot;Ä‘á»c láº¡c quan&quot; cÃ³ hiá»‡u nÄƒng tá»‘t hÆ¡n má»™t chÃºt.</p></blockquote><p>Hiá»‡u nÄƒng cá»§a StampedLock tá»‘t hÆ¡n ReadWriteLock chá»§ yáº¿u lÃ  do StampedLock há»— trá»£ cÃ¡ch Ä‘á»c láº¡c quan.</p><ul><li>ReadWriteLock cho phÃ©p nhiá»u luá»“ng cÃ¹ng Ä‘á»c, nhÆ°ng khi nhiá»u luá»“ng cÃ¹ng Ä‘á»c, táº¥t cáº£ cÃ¡c hoáº¡t Ä‘á»™ng ghi sáº½ bá»‹ cháº·n;</li><li>StampedLock cung cáº¥p viá»‡c Ä‘á»c láº¡c quan, cho phÃ©p má»™t luá»“ng cÃ³ thá»ƒ nháº­n khÃ³a ghi, tá»©c lÃ  khÃ´ng pháº£i táº¥t cáº£ cÃ¡c hoáº¡t Ä‘á»™ng ghi Ä‘á»u bá»‹ cháº·n.</li></ul><p>Äá»‘i vá»›i cÃ¡c tÃ¬nh huá»‘ng Ä‘á»c nhiá»u, ghi Ã­t, StampedLock cÃ³ hiá»‡u nÄƒng tá»‘t, vÃ  trong cÃ¡c tÃ¬nh huá»‘ng Ä‘Æ¡n giáº£n, nÃ³ cÃ³ thá»ƒ thay tháº¿ ReadWriteLock. Tuy nhiÃªn, StampedLock chá»‰ lÃ  má»™t pháº§n con cá»§a ReadWriteLock, khi sá»­ dá»¥ng, váº«n cáº§n lÆ°u Ã½ má»™t sá»‘ Ä‘iá»ƒm.</p><ul><li><strong>StampedLock khÃ´ng há»— trá»£ viá»‡c tÃ¡i nháº­p (reentrant)</strong></li><li>KhÃ´ng há»— trá»£ biáº¿n Ä‘iá»u kiá»‡n cho khÃ³a Ä‘á»c bi quan vÃ  khÃ³a ghi cá»§a StampedLock.</li><li>Náº¿u má»™t luá»“ng bá»‹ cháº·n trÃªn readLock() hoáº·c writeLock() cá»§a StampedLock vÃ  sau Ä‘Ã³ gá»i phÆ°Æ¡ng thá»©c interrupt() cá»§a luá»“ng Ä‘Ã³, Ä‘iá»u nÃ y sáº½ dáº«n Ä‘áº¿n tÄƒng CPU. <strong>Khi sá»­ dá»¥ng StampedLock, khÃ´ng bao giá» gá»i phÆ°Æ¡ng thá»©c interrupt(), náº¿u cáº§n há»— trá»£ chá»©c nÄƒng interrupt, hÃ£y sá»­ dá»¥ng readLockInterruptibly() vÃ  writeLockInterruptibly() cÃ³ thá»ƒ bá»‹ cháº·n</strong>.</li></ul><p>ã€VÃ­ dá»¥ã€‘Khi StampedLock bá»‹ cháº·n, gá»i interrupt() dáº«n Ä‘áº¿n tÄƒng CPU</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> StampedLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> lock </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> StampedLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> T1 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(() </span><span style="color:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">  // Nháº­n khÃ³a ghi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">  lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">writeLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">  // LuÃ´n bá»‹ cháº·n á»Ÿ Ä‘Ã¢y, khÃ´ng giáº£i phÃ³ng khÃ³a ghi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">  LockSupport</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">park</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">})</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">T1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Äáº£m báº£o T1 nháº­n khÃ³a ghi</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> T2 </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(() </span><span style="color:#C678DD;--shiki-dark:#C678DD;">-&gt;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">  // Bá»‹ cháº·n á»Ÿ khÃ³a Ä‘á»c bi quan</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">  lock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">readLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">T2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Äáº£m báº£o T2 bá»‹ cháº·n á»Ÿ khÃ³a Ä‘á»c</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Ngáº¯t luá»“ng T2</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Dáº«n Ä‘áº¿n tÄƒng CPU trong luá»“ng T2</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">T2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">interrupt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">T2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">join</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ã€VÃ­ dá»¥ã€‘Máº«u Ä‘á»c StampedLock:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> StampedLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> sl </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> StampedLock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Äá»c láº¡c quan</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> stamp </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> sl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">tryOptimisticRead</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Äá»c vÃ o biáº¿n cá»¥c bá»™ cá»§a phÆ°Æ¡ng thá»©c</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">......</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Kiá»ƒm tra con dáº¥u</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">validate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(stamp)</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">  // NÃ¢ng cáº¥p thÃ nh khÃ³a Ä‘á»c bi quan</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  stamp </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> sl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">readLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">  try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Äá»c vÃ o biáº¿n cá»¥c bá»™ cá»§a phÆ°Æ¡ng thá»©c</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    .....</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Giáº£i phÃ³ng khÃ³a Ä‘á»c bi quan</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    sl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlockRead</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(stamp);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Sá»­ dá»¥ng biáº¿n cá»¥c bá»™ cá»§a phÆ°Æ¡ng thá»©c Ä‘á»ƒ thá»±c hiá»‡n hoáº¡t Ä‘á»™ng kinh doanh</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">......</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ã€VÃ­ dá»¥ã€‘Máº«u ghi StampedLock:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> stamp </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> sl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">writeLock</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">  // Ghi vÃ o biáº¿n chia sáº»</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  ......</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">} </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">  sl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">unlockWrite</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(stamp);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><h2 id="aqs" tabindex="-1"><a class="header-anchor" href="#aqs"><span>AQS</span></a></h2><p><code>AbstractQueuedSynchronizer</code>Â (viáº¿t táº¯t lÃ  AQS) lÃ  má»™tÂ <strong>bá»™ Ä‘á»“ng bá»™ hÃ ng Ä‘á»£i trá»«u tÆ°á»£ng</strong>, nhÆ° tÃªn gá»i cá»§a nÃ³, chá»©c nÄƒng chÃ­nh cá»§a nÃ³ lÃ  xá»­ lÃ½ Ä‘á»“ng bá»™. NÃ³ lÃ  cÆ¡ sá»Ÿ triá»ƒn khai cho khÃ³a Ä‘á»“ng thá»i vÃ  nhiá»u cÃ´ng cá»¥ Ä‘á»“ng bá»™ khÃ¡c (nhÆ°Â <code>ReentrantLock</code>,Â <code>ReentrantReadWriteLock</code>,Â <code>CountDownLatch</code>,Â <code>Semaphore</code>,Â <code>FutureTask</code>, v.v.).</p><h3 id="Ä‘iem-chinh-cua-aqs" tabindex="-1"><a class="header-anchor" href="#Ä‘iem-chinh-cua-aqs"><span>Äiá»ƒm chÃ­nh cá»§a AQS</span></a></h3><p><strong>AQS cung cáº¥p há»— trá»£ cho khÃ³a Ä‘á»™c quyá»n vÃ  khÃ³a chia sáº»</strong>.</p><p>CÃ¡c khÃ³a liÃªn quan trong gÃ³iÂ <code>java.util.concurrent.locks</code>Â (cÃ¡c khÃ³a phá»• biáº¿n nhÆ°Â <code>ReentrantLock</code>,Â <code>ReadWriteLock</code>) Ä‘á»u Ä‘Æ°á»£c triá»ƒn khai dá»±a trÃªn AQS. Nhá»¯ng khÃ³a nÃ y khÃ´ng káº¿ thá»«a trá»±c tiáº¿p tá»« AQS, mÃ  Ä‘á»‹nh nghÄ©a má»™t lá»›pÂ <code>Sync</code>Â Ä‘á»ƒ káº¿ thá»«a AQS. Táº¡i sao láº¡i nhÆ° váº­y? Bá»Ÿi vÃ¬ khÃ³a dÃ nh cho ngÆ°á»i dÃ¹ng, trong khi bá»™ Ä‘á»“ng bá»™ dÃ nh cho Ä‘iá»u khiá»ƒn luá»“ng, vÃ¬ váº­y viá»‡c tÃ¡ch riÃªng hai khÃ­a cáº¡nh nÃ y giÃºp tÃ¡ch biá»‡t nhá»¯ng gÃ¬ mÃ  hai khÃ³a nÃ y quan tÃ¢m.</p><h3 id="ung-dung-cua-aqs" tabindex="-1"><a class="header-anchor" href="#ung-dung-cua-aqs"><span>á»¨ng dá»¥ng cá»§a AQS</span></a></h3><p><strong>AQS cung cáº¥p há»— trá»£ cho khÃ³a Ä‘á»™c quyá»n vÃ  khÃ³a chia sáº»</strong>.</p><h4 id="api-cua-khoa-Ä‘oc-quyen" tabindex="-1"><a class="header-anchor" href="#api-cua-khoa-Ä‘oc-quyen"><span>API cá»§a khÃ³a Ä‘á»™c quyá»n</span></a></h4><p>CÃ¡c API chÃ­nh Ä‘á»ƒ láº¥y vÃ  giáº£i phÃ³ng khÃ³a Ä‘á»™c quyá»n nhÆ° sau:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> acquire</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> arg)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> acquireInterruptibly</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> arg)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> tryAcquireNanos</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> arg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> nanosTimeout)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> release</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> arg)</span></span></code></pre></div><ul><li><code>acquire</code>Â - Láº¥y khÃ³a Ä‘á»™c quyá»n.</li><li><code>acquireInterruptibly</code>Â - Láº¥y khÃ³a Ä‘á»™c quyá»n cÃ³ thá»ƒ bá»‹ giÃ¡n Ä‘oáº¡n.</li><li><code>tryAcquireNanos</code>Â - Thá»­ láº¥y khÃ³a Ä‘á»™c quyá»n cÃ³ thá»ƒ bá»‹ giÃ¡n Ä‘oáº¡n trong khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh. NÃ³ sáº½ tráº£ vá» true trong ba trÆ°á»ng há»£p sau: <ul><li>Trong khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh, luá»“ng hiá»‡n táº¡i láº¥y khÃ³a thÃ nh cÃ´ng.</li><li>Luá»“ng hiá»‡n táº¡i bá»‹ giÃ¡n Ä‘oáº¡n trong khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh.</li><li>Káº¿t thÃºc khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh mÃ  váº«n chÆ°a láº¥y Ä‘Æ°á»£c khÃ³a, tráº£ vá» false.</li></ul></li><li><code>release</code>Â - Giáº£i phÃ³ng khÃ³a Ä‘á»™c quyá»n.</li></ul><h4 id="api-cua-khoa-chia-se" tabindex="-1"><a class="header-anchor" href="#api-cua-khoa-chia-se"><span>API cá»§a khÃ³a chia sáº»</span></a></h4><p>CÃ¡c API chÃ­nh Ä‘á»ƒ láº¥y vÃ  giáº£i phÃ³ng khÃ³a chia sáº» nhÆ° sau:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> acquireShared</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> arg)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> acquireSharedInterruptibly</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> arg)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> tryAcquireSharedNanos</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> arg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> nanosTimeout)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> releaseShared</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> arg)</span></span></code></pre></div><ul><li><code>acquireShared</code>Â - Láº¥y khÃ³a chia sáº».</li><li><code>acquireSharedInterruptibly</code>Â - Láº¥y khÃ³a chia sáº» cÃ³ thá»ƒ bá»‹ giÃ¡n Ä‘oáº¡n.</li><li><code>tryAcquireSharedNanos</code>Â - Thá»­ láº¥y khÃ³a chia sáº» cÃ³ thá»ƒ bá»‹ giÃ¡n Ä‘oáº¡n trong khoáº£ng thá»i gian nháº¥t Ä‘á»‹nh.</li><li><code>releaseShared</code>Â - Giáº£i phÃ³ng khÃ³a chia sáº».</li></ul><h3 id="nguyen-ly-hoat-Ä‘ong-cua-aqs" tabindex="-1"><a class="header-anchor" href="#nguyen-ly-hoat-Ä‘ong-cua-aqs"><span>NguyÃªn lÃ½ hoáº¡t Ä‘á»™ng cá»§a AQS</span></a></h3><blockquote><p>CÃ¡c Ä‘iá»ƒm chÃ­nh cá»§a AQS:</p><ul><li>AQS sá»­ dá»¥ng má»™t biáº¿n nguyÃªnÂ <code>volatile</code>Â Ä‘á»ƒÂ <strong>duy trÃ¬ tráº¡ng thÃ¡i Ä‘á»“ng bá»™</strong>. Ã nghÄ©a cá»§a tráº¡ng thÃ¡i Ä‘Æ°á»£c gÃ¡n bá»Ÿi lá»›p con.</li><li>AQS duy trÃ¬ má»™t danh sÃ¡ch liÃªn káº¿t kÃ©p FIFO Ä‘á»ƒ lÆ°u trá»¯ cÃ¡c luá»“ng chá» khÃ´ng thÃ nh cÃ´ng.</li></ul><p>AQS cung cáº¥p hai hoáº¡t Ä‘á»™ng cÆ¡ báº£n &quot;láº¥y&quot; vÃ  &quot;giáº£i phÃ³ng&quot;, vÃ  cung cáº¥p má»™t loáº¡t cÃ¡c phÆ°Æ¡ng thá»©c kiá»ƒm tra vÃ  xá»­ lÃ½, má»™t sá»‘ Ä‘iá»ƒm chÃ­nh lÃ :</p><ul><li>Tráº¡ng thÃ¡i cÃ³ thá»ƒ lÃ  Ä‘á»™c quyá»n hoáº·c chia sáº»;</li><li>Khi tráº¡ng thÃ¡i Ä‘Æ°á»£c láº¥y, cÃ¡c luá»“ng khÃ¡c pháº£i chá» Ä‘á»£i;</li><li>Khi tráº¡ng thÃ¡i Ä‘Æ°á»£c giáº£i phÃ³ng, cÃ¡c luá»“ng chá» Ä‘á»£i Ä‘Æ°á»£c Ä‘Ã¡nh thá»©c;</li><li>CÃ¡ch thoÃ¡t khá»i viá»‡c chá» Ä‘á»£i khi khÃ´ng thá»ƒ chá» Ä‘á»£i.</li></ul><p>Viá»‡c luá»“ng cÃ³ thá»ƒ nháº­n tráº¡ng thÃ¡i hay khÃ´ng, cÃ¡ch giáº£i phÃ³ng tráº¡ng thÃ¡i, khÃ´ng pháº£i lÃ  AQS quan tÃ¢m, mÃ  pháº£i Ä‘Æ°á»£c thá»±c hiá»‡n bá»Ÿi lá»›p con cá»¥ thá»ƒ.</p></blockquote><h4 id="cau-truc-du-lieu-cua-aqs" tabindex="-1"><a class="header-anchor" href="#cau-truc-du-lieu-cua-aqs"><span>Cáº¥u trÃºc dá»¯ liá»‡u cá»§a AQS</span></a></h4><p>Äá»c mÃ£ nguá»“n cá»§a AQS, ta cÃ³ thá»ƒ tháº¥y ráº±ng: AQS káº¿ thá»«a tá»«Â <code>AbstractOwnableSynchronizer</code>.</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> abstract</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> AbstractQueuedSynchronizer</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    extends</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> AbstractOwnableSynchronizer</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    implements</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java.io.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Serializable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /** Äáº§u hÃ ng Ä‘á»£i, Ä‘Æ°á»£c táº£i lÆ°á»i biáº¿ng. Chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­a Ä‘á»•i báº±ng phÆ°Æ¡ng thá»©c setHead. */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> transient</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> volatile</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Node</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> head</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /** ÄuÃ´i hÃ ng Ä‘á»£i, Ä‘Æ°á»£c táº£i lÆ°á»i biáº¿ng. Chá»‰ cÃ³ thá»ƒ Ä‘Æ°á»£c thÃªm má»›i báº±ng phÆ°Æ¡ng thá»©c enq. */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> transient</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> volatile</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Node</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tail</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /** Tráº¡ng thÃ¡i Ä‘á»“ng bá»™ */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> volatile</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> state</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li><code>state</code>Â - AQS sá»­ dá»¥ng má»™t biáº¿n nguyÃªnÂ <code>volatile</code>Â Ä‘á»ƒÂ <strong>duy trÃ¬ tráº¡ng thÃ¡i Ä‘á»“ng bá»™</strong>. <ul><li>Ã nghÄ©a cá»§a tráº¡ng thÃ¡i nÃ y Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh bá»Ÿi lá»›p con, vÃ­ dá»¥: trongÂ <code>ReentrantLock</code>, giÃ¡ trá»‹ tráº¡ng thÃ¡i nÃ y Ä‘áº¡i diá»‡n cho sá»‘ láº§n láº¥y khÃ³a cá»§a chá»§ sá»Ÿ há»¯u luá»“ng, trongÂ <code>Semaphore</code>, giÃ¡ trá»‹ tráº¡ng thÃ¡i nÃ y Ä‘áº¡i diá»‡n cho sá»‘ lÆ°á»£ng permit cÃ²n láº¡i.</li></ul></li><li><code>head</code>Â vÃ Â <code>tail</code>Â - AQSÂ <strong>duy trÃ¬ má»™t danh sÃ¡ch liÃªn káº¿t kÃ©p FIFO Ä‘á»ƒ quáº£n lÃ½ tráº¡ng thÃ¡i Ä‘á»“ng bá»™</strong>. ÄÃ¢y lÃ  má»™t hÃ ng Ä‘á»£i FIFO hai chiá»u, Ä‘Æ°á»£c truy cáº­p thÃ´ng qua con trá»Â <code>head</code>Â vÃ Â <code>tail</code>. Khi má»™t luá»“ng khÃ´ng thá»ƒ láº¥y khÃ³a, nÃ³ sáº½ Ä‘Æ°á»£c thÃªm vÃ o cuá»‘i hÃ ng Ä‘á»£i.</li></ul><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/JavaAQSLinkedList.png" alt="JavaAQSLinkedList.png" tabindex="0" loading="lazy"><figcaption>JavaAQSLinkedList.png</figcaption></figure><p>Tiáº¿p theo, hÃ£y xem mÃ£ nguá»“n cá»§aÂ <code>Node</code>.</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Node</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /** Node nÃ y Ä‘ang á»Ÿ cháº¿ Ä‘á»™ chia sáº» */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Node</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> SHARED </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Node</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /** Node nÃ y Ä‘ang á»Ÿ cháº¿ Ä‘á»™ Ä‘á»™c quyá»n */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Node</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> EXCLUSIVE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /** Tráº¡ng thÃ¡i chá» Ä‘á»£i cá»§a luá»“ng, cÃ³ cÃ¡c giÃ¡ trá»‹: 0, 1, -1, -2, -3 */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    volatile</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> waitStatus</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> CANCELLED </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> SIGNAL    </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> CONDITION </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> PROPAGATE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /** Node trÆ°á»›c */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    volatile</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Node</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> prev</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /** Node sau */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    volatile</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Node</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> next</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /** Luá»“ng Ä‘ang chá» khÃ³a */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    volatile</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Thread</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">  	/** LiÃªn quan Ä‘áº¿n viá»‡c chia sáº» node */</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    Node</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> nextWaiter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>RÃµ rÃ ng,Â <code>Node</code>Â lÃ  má»™t danh sÃ¡ch liÃªn káº¿t kÃ©p.</p><ul><li><code>waitStatus</code>Â -Â <code>Node</code>Â sá»­ dá»¥ng má»™t biáº¿n nguyÃªnÂ <code>volatile</code>Â Ä‘á»ƒÂ <strong>duy trÃ¬ tráº¡ng thÃ¡i cá»§a nÃºt luá»“ng trong hÃ ng Ä‘á»£i Ä‘á»“ng bá»™ cá»§a AQS</strong>.Â <code>waitStatus</code>Â cÃ³ nÄƒm giÃ¡ trá»‹ tráº¡ng thÃ¡i: <ul><li><code>CANCELLED(1)</code>Â - Tráº¡ng thÃ¡i nÃ y Ä‘áº¡i diá»‡n cho viá»‡c luá»“ng cá»§a nÃºt nÃ y cÃ³ thá»ƒ bá»‹ há»§y bá» do vÆ°á»£t quÃ¡ thá»i gian chá» hoáº·c bá»‹ giÃ¡n Ä‘oáº¡n. Khi nÃºt nÃ y á»Ÿ tráº¡ng thÃ¡i nÃ y, nÃ³ sáº½ Ä‘Æ°á»£c loáº¡i bá» khá»i hÃ ng Ä‘á»£i.</li><li><code>SIGNAL(-1)</code>Â - Tráº¡ng thÃ¡i nÃ y Ä‘áº¡i diá»‡n cho viá»‡c nÃºt sau sáº½ bá»‹ treo, do Ä‘Ã³ sau khi nÃºt hiá»‡n táº¡i giáº£i phÃ³ng khÃ³a hoáº·c bá»‹ há»§y bá», nÃºt sau sáº½ Ä‘Æ°á»£c Ä‘Ã¡nh thá»©c (<code>unparking</code>).</li><li><code>CONDITION(-2)</code>Â - Tráº¡ng thÃ¡i nÃ y Ä‘áº¡i diá»‡n cho viá»‡c luá»“ng cá»§a nÃºt nÃ y Ä‘ang chá» Ä‘iá»u kiá»‡n, nÃ³ khÃ´ng Ä‘Æ°á»£c coi lÃ  má»™t nÃºt trÃªn hÃ ng Ä‘á»£i Ä‘á»“ng bá»™ cho Ä‘áº¿n khi nÃ³ Ä‘Æ°á»£c Ä‘Ã¡nh thá»©c (<code>signal</code>) vÃ  tráº¡ng thÃ¡i cá»§a nÃ³ Ä‘Æ°á»£c Ä‘áº·t thÃ nh 0, sau Ä‘Ã³ nÃ³ sáº½ quay láº¡i tráº¡ng thÃ¡i chá» Ä‘á»£i.</li><li><code>PROPAGATE(-3)</code>Â - Tráº¡ng thÃ¡i nÃ y Ä‘áº¡i diá»‡n cho viá»‡cÂ <code>acquireShared</code>Â tiáº¿p theo khÃ´ng cáº§n truyá»n Ä‘iá»u kiá»‡n.</li><li>0 - KhÃ´ng pháº£i lÃ  tráº¡ng thÃ¡i trÃªn.</li></ul></li></ul><h4 id="lay-va-giai-phong-khoa-Ä‘oc-quyen" tabindex="-1"><a class="header-anchor" href="#lay-va-giai-phong-khoa-Ä‘oc-quyen"><span>Láº¥y vÃ  giáº£i phÃ³ng khÃ³a Ä‘á»™c quyá»n</span></a></h4><h5 id="lay-khoa-Ä‘oc-quyen" tabindex="-1"><a class="header-anchor" href="#lay-khoa-Ä‘oc-quyen"><span>Láº¥y khÃ³a Ä‘á»™c quyá»n</span></a></h5><p>AQS sá»­ dá»¥ng phÆ°Æ¡ng thá»©cÂ <code>acquire(int arg)</code>Â Ä‘á»ƒ láº¥y khÃ³a Ä‘á»™c quyá»n. QuÃ¡ trÃ¬nh láº¥y khÃ³a Ä‘á»™c quyá»n diá»…n ra nhÆ° sau:</p><ol><li>Cá»‘ gáº¯ng láº¥y tráº¡ng thÃ¡i Ä‘á»“ng bá»™. Náº¿u thÃ nh cÃ´ng, káº¿t thÃºc phÆ°Æ¡ng thá»©c vÃ  tráº£ vá».</li><li>Náº¿u khÃ´ng thÃ nh cÃ´ng, AQS sáº½ liÃªn tá»¥c thá»­ chÃ¨n luá»“ng hiá»‡n táº¡i vÃ o cuá»‘i hÃ ng Ä‘á»£i Ä‘á»“ng bá»™ chá» Ä‘á»£i cho Ä‘áº¿n khi thÃ nh cÃ´ng.</li><li>Tiáº¿p theo, AQS sáº½ liÃªn tá»¥c thá»­ láº¥y khÃ³a Ä‘á»™c quyá»n cho cÃ¡c nÃºt luá»“ng trong hÃ ng Ä‘á»£i chá».</li></ol><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/AQSBefore.png" alt="AQSBefore.png" tabindex="0" loading="lazy"><figcaption>AQSBefore.png</figcaption></figure><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/AQSAcquire.png" alt="AQSAcquire.png" tabindex="0" loading="lazy"><figcaption>AQSAcquire.png</figcaption></figure><h5 id="giai-phong-khoa-Ä‘oc-quyen" tabindex="-1"><a class="header-anchor" href="#giai-phong-khoa-Ä‘oc-quyen"><span>Giáº£i phÃ³ng khÃ³a Ä‘á»™c quyá»n</span></a></h5><p>AQS sá»­ dá»¥ng phÆ°Æ¡ng thá»©cÂ <code>release(int arg)</code>Â Ä‘á»ƒ giáº£i phÃ³ng khÃ³a Ä‘á»™c quyá»n. QuÃ¡ trÃ¬nh giáº£i phÃ³ng khÃ³a Ä‘á»™c quyá»n diá»…n ra nhÆ° sau:</p><ol><li>Cá»‘ gáº¯ng láº¥y tráº¡ng thÃ¡i Ä‘á»“ng bá»™ cá»§a luá»“ng giáº£i phÃ³ng. Náº¿u khÃ´ng thÃ nh cÃ´ng, káº¿t thÃºc phÆ°Æ¡ng thá»©c vÃ  tráº£ vá».</li><li>Náº¿u thÃ nh cÃ´ng, AQS sáº½ cá»‘ gáº¯ng Ä‘Ã¡nh thá»©c cÃ¡c nÃºt luá»“ng sau cá»§a nÃºt hiá»‡n táº¡i.</li></ol><h5 id="lay-khoa-Ä‘oc-quyen-co-the-bi-gian-Ä‘oan" tabindex="-1"><a class="header-anchor" href="#lay-khoa-Ä‘oc-quyen-co-the-bi-gian-Ä‘oan"><span>Láº¥y khÃ³a Ä‘á»™c quyá»n cÃ³ thá»ƒ bá»‹ giÃ¡n Ä‘oáº¡n</span></a></h5><p>AQS sá»­ dá»¥ng phÆ°Æ¡ng thá»©cÂ <code>acquireInterruptibly(int arg)</code>Â Ä‘á»ƒ láº¥y khÃ³a Ä‘á»™c quyá»n cÃ³ thá»ƒ bá»‹ giÃ¡n Ä‘oáº¡n.</p><p>PhÆ°Æ¡ng thá»©cÂ <code>acquireInterruptibly(int arg)</code>Â vÃ  phÆ°Æ¡ng thá»©cÂ <code>acquire(int arg)</code>Â ráº¥t giá»‘ng nhau, khÃ¡c biá»‡t duy nháº¥t lÃ  nÃ³ sáº½Â <strong>kiá»ƒm tra xem luá»“ng hiá»‡n táº¡i cÃ³ bá»‹ giÃ¡n Ä‘oáº¡n khÃ´ng báº±ng cÃ¡ch sá»­ dá»¥ngÂ <code>Thread.interrupted</code></strong>. Náº¿u cÃ³, nÃ³ sáº½ nÃ©m ra ngoáº¡i lá»‡ giÃ¡n Ä‘oáº¡n (<code>InterruptedException</code>) ngay láº­p tá»©c.</p><h5 id="lay-khoa-Ä‘oc-quyen-voi-thoi-gian-cho-gioi-han" tabindex="-1"><a class="header-anchor" href="#lay-khoa-Ä‘oc-quyen-voi-thoi-gian-cho-gioi-han"><span>Láº¥y khÃ³a Ä‘á»™c quyá»n vá»›i thá»i gian chá» giá»›i háº¡n</span></a></h5><p>AQS sá»­ dá»¥ng phÆ°Æ¡ng thá»©cÂ <code>tryAcquireNanos(int arg)</code>Â Ä‘á»ƒ láº¥y khÃ³a Ä‘á»™c quyá»n vá»›i thá»i gian chá» giá»›i háº¡n.</p><p>PhÆ°Æ¡ng thá»©cÂ <code>tryAcquireNanos</code>Â vÃ  phÆ°Æ¡ng thá»©cÂ <code>acquire</code>Â ráº¥t giá»‘ng nhau, khÃ¡c biá»‡t duy nháº¥t lÃ  nÃ³ sáº½ tÃ­nh toÃ¡n thá»i gian káº¿t thÃºc dá»±a trÃªn thá»i gian chá» vÃ  thá»i gian hiá»‡n táº¡i. Trong quÃ¡ trÃ¬nh láº¥y khÃ³a, nÃ³ sáº½ liÃªn tá»¥c kiá»ƒm tra xem cÃ³ vÆ°á»£t quÃ¡ thá»i gian chá» hay khÃ´ng, náº¿u vÆ°á»£t quÃ¡, nÃ³ sáº½ tráº£ vá» false; náº¿u khÃ´ng vÆ°á»£t quÃ¡, nÃ³ sáº½ sá»­ dá»¥ngÂ <code>LockSupport.parkNanos</code>Â Ä‘á»ƒ cháº·n luá»“ng hiá»‡n táº¡i.</p><h4 id="lay-va-giai-phong-khoa-chia-se" tabindex="-1"><a class="header-anchor" href="#lay-va-giai-phong-khoa-chia-se"><span>Láº¥y vÃ  giáº£i phÃ³ng khÃ³a chia sáº»</span></a></h4><h5 id="lay-khoa-chia-se" tabindex="-1"><a class="header-anchor" href="#lay-khoa-chia-se"><span>Láº¥y khÃ³a chia sáº»</span></a></h5><p>AQS sá»­ dá»¥ng phÆ°Æ¡ng thá»©cÂ <code>acquireShared(int arg)</code>Â Ä‘á»ƒ láº¥y khÃ³a chia sáº».</p><p>PhÆ°Æ¡ng thá»©cÂ <code>acquireShared</code>Â vÃ  phÆ°Æ¡ng thá»©cÂ <code>acquire</code>Â cÃ³ cÃ¹ng quy trÃ¬nh, khÃ¡c biá»‡t duy nháº¥t lÃ  Ä‘iá»u kiá»‡n vÃ²ng láº·p vÃ  hoáº¡t Ä‘á»™ng xÃ³a nÃºt khá»i hÃ ng Ä‘á»£i.</p><p>Äiá»u kiá»‡n thÃ nh cÃ´ng Ä‘á»ƒ láº¥y khÃ³a chia sáº» nhÆ° sau:</p><ul><li><code>tryAcquireShared(arg)</code>Â tráº£ vá» giÃ¡ trá»‹ lá»›n hÆ¡n hoáº·c báº±ng 0 (Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  permit cá»§a khÃ³a chia sáº» váº«n chÆ°a Ä‘Æ°á»£c sá»­ dá»¥ng háº¿t).</li><li>NÃºt hiá»‡n táº¡i cÃ³ nÃºt trÆ°á»›c lÃ  nÃºt Ä‘áº§u danh sÃ¡ch.</li></ul><h5 id="giai-phong-khoa-chia-se" tabindex="-1"><a class="header-anchor" href="#giai-phong-khoa-chia-se"><span>Giáº£i phÃ³ng khÃ³a chia sáº»</span></a></h5><p>AQS sá»­ dá»¥ng phÆ°Æ¡ng thá»©cÂ <code>releaseShared(int arg)</code>Â Ä‘á»ƒ giáº£i phÃ³ng khÃ³a chia sáº».</p><p><code>releaseShared</code>Â Ä‘áº§u tiÃªn sáº½ cá»‘ gáº¯ng giáº£i phÃ³ng tráº¡ng thÃ¡i Ä‘á»“ng bá»™, náº¿u thÃ nh cÃ´ng, nÃ³ sáº½ Ä‘Ã¡nh thá»©c má»™t hoáº·c nhiá»u nÃºt luá»“ng sau cá»§a nÃºt hiá»‡n táº¡i.</p><h5 id="lay-khoa-chia-se-co-the-bi-gian-Ä‘oan" tabindex="-1"><a class="header-anchor" href="#lay-khoa-chia-se-co-the-bi-gian-Ä‘oan"><span>Láº¥y khÃ³a chia sáº» cÃ³ thá»ƒ bá»‹ giÃ¡n Ä‘oáº¡n</span></a></h5><p>AQS sá»­ dá»¥ng phÆ°Æ¡ng thá»©cÂ <code>acquireSharedInterruptibly(int arg)</code>Â Ä‘á»ƒ láº¥y khÃ³a chia sáº» cÃ³ thá»ƒ bá»‹ giÃ¡n Ä‘oáº¡n.</p><p>PhÆ°Æ¡ng thá»©cÂ <code>acquireSharedInterruptibly</code>Â vÃ  phÆ°Æ¡ng thá»©cÂ <code>acquireInterruptibly</code>Â ráº¥t giá»‘ng nhau, khÃ´ng cáº§n giáº£i thÃ­ch thÃªm.</p><h5 id="lay-khoa-chia-se-voi-thoi-gian-cho-gioi-han" tabindex="-1"><a class="header-anchor" href="#lay-khoa-chia-se-voi-thoi-gian-cho-gioi-han"><span>Láº¥y khÃ³a chia sáº» vá»›i thá»i gian chá» giá»›i háº¡n</span></a></h5><p>AQS sá»­ dá»¥ng phÆ°Æ¡ng thá»©cÂ <code>tryAcquireSharedNanos(int arg)</code>Â Ä‘á»ƒ láº¥y khÃ³a chia sáº» vá»›i thá»i gian chá» giá»›i háº¡n.</p><p>PhÆ°Æ¡ng thá»©cÂ <code>tryAcquireSharedNanos</code>Â vÃ  phÆ°Æ¡ng thá»©cÂ <code>tryAcquireNanos</code>Â ráº¥t giá»‘ng nhau, khÃ´ng cáº§n giáº£i thÃ­ch thÃªm.</p><h2 id="deadlock" tabindex="-1"><a class="header-anchor" href="#deadlock"><span>Deadlock</span></a></h2><h3 id="deadlock-la-gi" tabindex="-1"><a class="header-anchor" href="#deadlock-la-gi"><span>Deadlock lÃ  gÃ¬</span></a></h3><p>Deadlock lÃ  má»™t tráº¡ng thÃ¡i cá»¥ thá»ƒ cá»§a chÆ°Æ¡ng trÃ¬nh, trong Ä‘Ã³ cÃ¡c thá»±c thá»ƒ Ä‘ang chá» Ä‘á»£i láº«n nhau vÃ¬ sá»± phá»¥ thuá»™c vÃ²ng láº·p, khÃ´ng cÃ³ thá»±c thá»ƒ nÃ o cÃ³ thá»ƒ tiáº¿p tá»¥c Ä‘iá»u hÆ°á»›ng. Deadlock khÃ´ng chá»‰ xáº£y ra giá»¯a cÃ¡c luá»“ng, mÃ  cÅ©ng cÃ³ thá»ƒ xáº£y ra giá»¯a cÃ¡c quy trÃ¬nh sá»Ÿ há»¯u tÃ i nguyÃªn. ThÃ´ng thÆ°á»ng, chÃºng ta táº­p trung vÃ o deadlock giá»¯a cÃ¡c luá»“ng trong cÃ¡c tÃ¬nh huá»‘ng Ä‘a luá»“ng, chá»‰ Ä‘á» cáº­p Ä‘áº¿n deadlock giá»¯a cÃ¡c quy trÃ¬nh sá»Ÿ há»¯u tÃ i nguyÃªn khi tÃ i nguyÃªn lÃ  Ä‘á»™c quyá»n.</p><h3 id="cach-xac-Ä‘inh-deadlock" tabindex="-1"><a class="header-anchor" href="#cach-xac-Ä‘inh-deadlock"><span>CÃ¡ch xÃ¡c Ä‘á»‹nh Deadlock</span></a></h3><p>CÃ¡ch phá»• biáº¿n nháº¥t Ä‘á»ƒ xÃ¡c Ä‘á»‹nh deadlock lÃ  sá»­ dá»¥ng cÃ¡c cÃ´ng cá»¥ nhÆ° jstack Ä‘á»ƒ láº¥y stack trace cá»§a cÃ¡c luá»“ng, sau Ä‘Ã³ xÃ¡c Ä‘á»‹nh cÃ¡c phá»¥ thuá»™c láº«n nhau giá»¯a chÃºng Ä‘á»ƒ tÃ¬m ra deadlock. Náº¿u deadlock rÃµ rÃ ng, thÃ¬ thÆ°á»ng cÃ³ thá»ƒ xÃ¡c Ä‘á»‹nh trá»±c tiáº¿p báº±ng jstack, vÃ  cÃ¡c cÃ´ng cá»¥ nhÆ° JConsole tháº­m chÃ­ cÃ³ thá»ƒ phÃ¡t hiá»‡n deadlock trong giao diá»‡n Ä‘á»“ há»a cÃ³ háº¡n.</p><p>Náº¿u báº¡n Ä‘ang phÃ¡t triá»ƒn cÃ´ng cá»¥ quáº£n lÃ½ riÃªng cá»§a mÃ¬nh, cáº§n quÃ©t quy trÃ¬nh dá»‹ch vá»¥, xÃ¡c Ä‘á»‹nh deadlock má»™t cÃ¡ch tá»± Ä‘á»™ng, báº¡n cÃ³ thá»ƒ xem xÃ©t sá»­ dá»¥ng API quáº£n lÃ½ chuáº©n cá»§a Java,Â <code>ThreadMXBean</code>, nÃ³ cung cáº¥p trá»±c tiáº¿p phÆ°Æ¡ng thá»©cÂ <code>findDeadlockedThreads()</code>Â Ä‘á»ƒ xÃ¡c Ä‘á»‹nh deadlock.</p><h3 id="cach-tranh-deadlock" tabindex="-1"><a class="header-anchor" href="#cach-tranh-deadlock"><span>CÃ¡ch trÃ¡nh Deadlock</span></a></h3><p>CÆ¡ báº£n, deadlock xáº£y ra vÃ¬:</p><ul><li>Sá»± cáº¡nh tranh, giá»‘ng nhÆ° Monitor trong Java, Ä‘á»u lÃ  Ä‘á»™c quyá»n.</li><li>Giá»¯ cáº¡nh tranh lÃ¢u dÃ i, khÃ´ng giáº£i phÃ³ng trÆ°á»›c khi sá»­ dá»¥ng xong, cÅ©ng khÃ´ng thá»ƒ bá»‹ chiáº¿m giá»¯ bá»Ÿi luá»“ng khÃ¡c.</li><li>Phá»¥ thuá»™c vÃ²ng láº·p, nhiá»u thá»±c thá»ƒ phá»¥ thuá»™c vÃ o nhau qua viá»‡c giá»¯ khÃ³a.</li></ul><p>Do Ä‘Ã³, chÃºng ta cÃ³ thá»ƒ phÃ¢n tÃ­ch cÃ¡ch trÃ¡nh deadlock vÃ  phÆ°Æ¡ng phÃ¡p.</p><p>(1) TrÃ¡nh má»™t luá»“ng cÃ¹ng lÃºc giá»¯ nhiá»u khÃ³a.</p><p>TrÃ¡nh má»™t luá»“ng giá»¯ cÃ¹ng lÃºc nhiá»u tÃ i nguyÃªn, cá»‘ gáº¯ng Ä‘áº£m báº£o má»—i khÃ³a chá»‰ giá»¯ má»™t tÃ i nguyÃªn.</p><p>Thá»­ sá»­ dá»¥ng khÃ³a cÃ³ thá»i gian chá» (<code>lock.tryLock(timeout)</code>) Ä‘á»ƒ trÃ¡nh viá»‡c giá»¯ khÃ³a mÃ£i mÃ£i.</p><p>Äá»‘i vá»›i khÃ³a cÆ¡ sá»Ÿ dá»¯ liá»‡u, viá»‡c khÃ³a vÃ  má»Ÿ khÃ³a pháº£i náº±m trong má»™t káº¿t ná»‘i cÆ¡ sá»Ÿ dá»¯ liá»‡u, náº¿u khÃ´ng, cÃ³ thá»ƒ xáº£y ra tÃ¬nh huá»‘ng khÃ´ng thá»ƒ má»Ÿ khÃ³a.</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/programming/java/Concurency/Java Lock.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/programming/java/Concurency/Java%20ForkJoin.html" aria-label="Java ForkJoin"><div class="hint"><span class="arrow start"></span>Prev</div><div class="link"><!---->Java ForkJoin</div></a><a class="route-link auto-link next" href="/programming/java/Concurency/Java%20Memory%20Model.html" aria-label="Java Memory Model"><div class="hint">Next<span class="arrow end"></span></div><div class="link">Java Memory Model<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with â¤ï¸ by Hung Nguyen</div><div class="copyright">Copyright Â© 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-fjbxAy1X.js" defer></script>
  </body>
</html>
