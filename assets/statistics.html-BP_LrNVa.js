import{_ as n,o as s,c as a,a as e}from"./app-BRTHG7K9.js";const i={},l=e('<h1 id="【统计】会员、商品、交易统计" tabindex="-1"><a class="header-anchor" href="#【统计】会员、商品、交易统计"><span>【统计】会员、商品、交易统计</span></a></h1><p>本小节，我们来讲 [商城系统 -&gt; 统计中心] 菜单下的会员、商品、交易统计相关内容，它们是由 <code>yudao-module-statistics-biz</code> 后端模块实现。</p><p>友情提示：为什么所有数据库操作都使用 StatisticsMapper 结尾呢？</p><p>一方面，和现有业务使用的 Mapper 独立开，避免业务 Mapper 混乱，统计 SQL 往往较为复杂（个性化）。</p><p>另一方面，随着数据规模的增大，统计 SQL 不适合放在 MySQL 关系数据库中执行，往往会引入 ClickHouse、Doris 作为数据仓库，这个时候只要把 StatisticsMapper 改造下即可。</p><p>另外，考虑统计 SQL 往往非常消耗 MySQL 资源，可以把 StatisticsMapper 切到单独的 MySQL 读库上，避免影响线上业务。</p><h2 id="_1-会员统计" tabindex="-1"><a class="header-anchor" href="#_1-会员统计"><span><a href="#_1-%E4%BC%9A%E5%91%98%E7%BB%9F%E8%AE%A1">#</a> 1. 会员统计</span></a></h2><p>由 MemberStatisticsController 提供统计接口。</p><h3 id="_1-1-表结构" tabindex="-1"><a class="header-anchor" href="#_1-1-表结构"><span><a href="#_1-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 1.1 表结构</span></a></h3><p>暂时没有统计表，都是通过 SQL 查询实现。</p><h3 id="_1-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_1-2-管理后台"><span><a href="#_1-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 1.2 管理后台</span></a></h3><p>对应 [商城系统 -&gt; 统计中心 -&gt; 会员统计] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>src/views/mall/statistics/member</code> 目录。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/商城手册/商城统计/会员统计.png" alt="会员统计" tabindex="0" loading="lazy"><figcaption>会员统计</figcaption></figure><h2 id="_2-商品统计" tabindex="-1"><a class="header-anchor" href="#_2-商品统计"><span><a href="#_2-%E5%95%86%E5%93%81%E7%BB%9F%E8%AE%A1">#</a> 2. 商品统计</span></a></h2><p>由 ProductStatisticsController 提供统计接口。</p><h3 id="_2-1-表结构" tabindex="-1"><a class="header-anchor" href="#_2-1-表结构"><span><a href="#_2-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 2.1 表结构</span></a></h3><p>统计每个商品 SPU 的浏览量、访客量、收藏数量、加购数量、下单件数、支付件数、支付金额、退款件数、退款金额、访客支付转化率等，通过 ProductStatisticsJob 每天定时统计。</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `product_statistics` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号，主键自增&#39;,</span></span>\n<span class="line"><span>  `time` date NOT NULL COMMENT &#39;统计日期&#39;,</span></span>\n<span class="line"><span>  `spu_id` bigint NOT NULL COMMENT &#39;商品 SPU 编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `browse_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;浏览量&#39;,</span></span>\n<span class="line"><span>  `browse_user_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;访客量&#39;,</span></span>\n<span class="line"><span>  `favorite_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;收藏数量&#39;,</span></span>\n<span class="line"><span>  `cart_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;加购数量&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `order_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;下单件数&#39;,</span></span>\n<span class="line"><span>  `order_pay_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;支付件数&#39;,</span></span>\n<span class="line"><span>  `order_pay_price` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;支付金额，单位：分&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `after_sale_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;退款件数&#39;,</span></span>\n<span class="line"><span>  `after_sale_refund_price` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;退款金额，单位：分&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `browse_convert_percent` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;访客支付转化率（百分比）&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `creator` varchar(64) COLLATE utf8mb4_unicode_ci DEFAULT &#39;&#39; COMMENT &#39;创建者&#39;,</span></span>\n<span class="line"><span>  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,</span></span>\n<span class="line"><span>  `updater` varchar(64) COLLATE utf8mb4_unicode_ci DEFAULT &#39;&#39; COMMENT &#39;更新者&#39;,</span></span>\n<span class="line"><span>  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#39;更新时间&#39;,</span></span>\n<span class="line"><span>  `deleted` bit(1) NOT NULL DEFAULT b&#39;0&#39; COMMENT &#39;是否删除&#39;,</span></span>\n<span class="line"><span>  `tenant_id` bigint NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;租户编号&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  KEY `idx_time` (`time`),</span></span>\n<span class="line"><span>  KEY `idx_spu_id` (`spu_id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=&#39;商品统计表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_2-2-管理后台"><span><a href="#_2-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 2.2 管理后台</span></a></h3><p>对应 [商城系统 -&gt; 统计中心 -&gt; 商品统计] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>src/views/mall/statistics/product</code> 目录。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/商城手册/商城统计/商品统计.png" alt="商品统计" tabindex="0" loading="lazy"><figcaption>商品统计</figcaption></figure><h2 id="_3-交易统计" tabindex="-1"><a class="header-anchor" href="#_3-交易统计"><span><a href="#_3-%E4%BA%A4%E6%98%93%E7%BB%9F%E8%AE%A1">#</a> 3. 交易统计</span></a></h2><p>由 TradeStatisticsController 提供统计接口。</p><h3 id="_3-1-表结构" tabindex="-1"><a class="header-anchor" href="#_3-1-表结构"><span><a href="#_3-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 3.1 表结构</span></a></h3><p>统计每天的订单创建数、支付数、支付金额、退款数、退款金额、佣金金额、余额支付金额、充值数、充值金额、充值退款数、充值退款金额等，通过 TradeStatisticsJob 每天定时统计。</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `trade_statistics` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号，主键自增&#39;,</span></span>\n<span class="line"><span>  `time` datetime NOT NULL COMMENT &#39;统计日期&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `order_create_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;创建订单数&#39;,</span></span>\n<span class="line"><span>  `order_pay_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;支付订单商品数&#39;,</span></span>\n<span class="line"><span>  `order_pay_price` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;总支付金额，单位：分&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `after_sale_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;退款订单数&#39;,</span></span>\n<span class="line"><span>  `after_sale_refund_price` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;总退款金额，单位：分&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `brokerage_settlement_price` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;佣金金额（已结算），单位：分&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `wallet_pay_price` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;总支付金额（余额），单位：分&#39;,</span></span>\n<span class="line"><span>  `recharge_pay_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;充值订单数&#39;,</span></span>\n<span class="line"><span>  `recharge_pay_price` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;充值金额，单位：分&#39;,</span></span>\n<span class="line"><span>  `recharge_refund_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;充值退款订单数&#39;,</span></span>\n<span class="line"><span>  `recharge_refund_price` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;充值退款金额，单位：分&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `creator` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT &#39;&#39; COMMENT &#39;创建者&#39;,</span></span>\n<span class="line"><span>  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#39;创建时间&#39;,</span></span>\n<span class="line"><span>  `updater` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT &#39;&#39; COMMENT &#39;更新者&#39;,</span></span>\n<span class="line"><span>  `update_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#39;更新时间&#39;,</span></span>\n<span class="line"><span>  `deleted` bit(1) NOT NULL DEFAULT b&#39;0&#39; COMMENT &#39;是否删除&#39;,</span></span>\n<span class="line"><span>  `tenant_id` bigint NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;租户编号&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`) USING BTREE,</span></span>\n<span class="line"><span>  KEY `trade_statistics_time_index` (`time`) USING BTREE</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=153 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=&#39;交易统计表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_3-2-管理后台"><span><a href="#_3-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 3.2 管理后台</span></a></h3><p>对应 [商城系统 -&gt; 统计中心 -&gt; 交易统计] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>src/views/mall/statistics/trade</code> 目录。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/商城手册/商城统计/交易统计.png" alt="交易统计" tabindex="0" loading="lazy"><figcaption>交易统计</figcaption></figure>',29),p=[l];function c(d,t){return s(),a("div",null,p)}const E=n(i,[["render",c],["__file","statistics.html.vue"]]),o=JSON.parse('{"path":"/project/rouyi-vue-pro/mall/statistics.html","title":"【统计】会员、商品、交易统计","lang":"en-US","frontmatter":{"title":"【统计】会员、商品、交易统计","tags":["project","java","spring-boot","spring-cloud"],"categories":["project"],"order":108,"feed":false,"seo":false,"head":[]},"headers":[{"level":2,"title":"# 1. 会员统计","slug":"_1-会员统计","link":"#_1-会员统计","children":[{"level":3,"title":"# 1.1 表结构","slug":"_1-1-表结构","link":"#_1-1-表结构","children":[]},{"level":3,"title":"# 1.2 管理后台","slug":"_1-2-管理后台","link":"#_1-2-管理后台","children":[]}]},{"level":2,"title":"# 2. 商品统计","slug":"_2-商品统计","link":"#_2-商品统计","children":[{"level":3,"title":"# 2.1 表结构","slug":"_2-1-表结构","link":"#_2-1-表结构","children":[]},{"level":3,"title":"# 2.2 管理后台","slug":"_2-2-管理后台","link":"#_2-2-管理后台","children":[]}]},{"level":2,"title":"# 3. 交易统计","slug":"_3-交易统计","link":"#_3-交易统计","children":[{"level":3,"title":"# 3.1 表结构","slug":"_3-1-表结构","link":"#_3-1-表结构","children":[]},{"level":3,"title":"# 3.2 管理后台","slug":"_3-2-管理后台","link":"#_3-2-管理后台","children":[]}]}],"git":{"createdTime":1720365235000,"updatedTime":1720365235000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":4.09,"words":1228},"filePathRelative":"project/rouyi-vue-pro/mall/statistics.md","localizedDate":"July 7, 2024"}');export{E as comp,o as data};
