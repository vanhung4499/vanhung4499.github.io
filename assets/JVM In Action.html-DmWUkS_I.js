import{_ as s,o as a,c as n,d as i}from"./app-BVzepGwQ.js";const r={},o=i(`<h1 id="jvm-thuc-hanh" tabindex="-1"><a class="header-anchor" href="#jvm-thuc-hanh"><span>JVM Thực hành</span></a></h1><h2 id="tong-quan-ve-tinh-chinh-jvm" tabindex="-1"><a class="header-anchor" href="#tong-quan-ve-tinh-chinh-jvm"><span>Tổng quan về Tinh chỉnh JVM</span></a></h2><h3 id="cac-chi-so-hieu-suat-gc" tabindex="-1"><a class="header-anchor" href="#cac-chi-so-hieu-suat-gc"><span>Các chỉ số hiệu suất GC</span></a></h3><p>Trong quá trình tinh chỉnh JVM, cần xác định mục tiêu tinh chỉnh trước. Từ góc độ hiệu suất, thường quan tâm đến ba chỉ số sau:</p><ul><li><code>Thông lượng (throughput)</code> - Đây là chỉ số hiệu suất cao nhất mà bộ thu gom rác có thể hỗ trợ cho ứng dụng mà không tính đến thời gian tạm dừng hoặc tiêu thụ bộ nhớ.</li><li><code>Thời gian tạm dừng (latency)</code> - Đây là thước đo để rút ngắn thời gian tạm dừng do thu gom rác gây ra hoặc loại bỏ hoàn toàn thời gian tạm dừng do thu gom rác, từ đó tránh rung lắc khi ứng dụng đang chạy.</li><li><code>Tần suất thu gom rác</code> - Bao lâu một lần thu gom rác xảy ra? Thường thì tần suất thu gom rác càng thấp càng tốt, tuy nhiên, tăng kích thước bộ nhớ heap có thể giảm tần suất thu gom rác nhưng đồng thời cũng tăng số lượng đối tượng cần thu gom, dẫn đến tăng thời gian tạm dừng. Do đó, chỉ cần tăng kích thước bộ nhớ heap một cách phù hợp để đảm bảo tần suất thu gom rác bình thường là đủ.</li></ul><p>Trong hầu hết các trường hợp, tinh chỉnh sẽ tập trung vào một hoặc hai mục tiêu, hiếm khi có thể đạt được cả ba mục tiêu từ các góc nhìn khác nhau.</p><h3 id="nguyen-tac-tinh-chinh" tabindex="-1"><a class="header-anchor" href="#nguyen-tac-tinh-chinh"><span>Nguyên tắc tinh chỉnh</span></a></h3><p>Có hai mục tiêu tối ưu hóa GC:</p><ul><li><strong>Giảm tần suất Full GC</strong></li><li><strong>Giảm thời gian thực hiện Full GC</strong></li></ul><p>Nguyên tắc cơ bản của tinh chỉnh GC là: áp dụng các tham số GC khác nhau cho hai máy chủ trở lên, sau đó so sánh hiệu suất của chúng và áp dụng các tham số đã được chứng minh có thể cải thiện hiệu suất hoặc giảm thời gian thực hiện GC cho máy chủ làm việc cuối cùng.</p><h4 id="giam-tan-suat-minor-gc" tabindex="-1"><a class="header-anchor" href="#giam-tan-suat-minor-gc"><span>Giảm tần suất Minor GC</span></a></h4><p>Nếu không gian thế hệ trẻ nhỏ, khu vực Eden nhanh chóng bị lấp đầy, dẫn đến tần suất Minor GC thường xuyên. Do đó, bạn có thể giảm tần suất Minor GC bằng cách tăng kích thước không gian thế hệ trẻ.</p><p>Có thể bạn sẽ có câu hỏi: Nếu mở rộng khu vực Eden, liệu thời gian một lần Minor GC có tăng lên không? Nếu thời gian một lần Minor GC tăng lên, thì khó có thể đạt được hiệu quả tối ưu mà chúng ta mong đợi.</p><p>Chúng ta biết rằng thời gian một lần Minor GC bao gồm hai phần: T1 (quét thế hệ trẻ) và T2 (sao chép các đối tượng sống). Giả sử một đối tượng sống trong khu vực Eden trong 500ms và thời gian giữa các lần Minor GC là 300ms, thì thời gian một lần Minor GC là: T1 + T2.</p><p>Khi chúng ta mở rộng không gian thế hệ trẻ, thời gian giữa các lần Minor GC có thể mở rộng lên 600ms, điều này có nghĩa là một đối tượng sống trong 500ms sẽ bị thu gom trong khu vực Eden, không còn đối tượng sống để sao chép, do đó thời gian cho lần Minor GC tiếp theo là: hai lần quét thế hệ trẻ, tức là 2T1.</p><p>Như vậy, việc mở rộng không gian thế hệ trẻ sẽ tăng thời gian T1, nhưng giảm thời gian T2. Thông thường, trong máy ảo Java, chi phí sao chép đối tượng cao hơn chi phí quét.</p><p>Nếu có nhiều đối tượng sống ngắn hạn trong bộ nhớ heap, việc mở rộng không gian thế hệ trẻ sẽ không làm tăng đáng kể thời gian một lần Minor GC. Do đó, thời gian một lần Minor GC phụ thuộc nhiều vào số lượng đối tượng sống sau GC, chứ không phải kích thước của khu vực Eden.</p><h4 id="giam-tan-suat-full-gc" tabindex="-1"><a class="header-anchor" href="#giam-tan-suat-full-gc"><span>Giảm tần suất Full GC</span></a></h4><p>So với Minor GC, Full GC tốn nhiều thời gian hơn. Giảm số lượng đối tượng vào thế hệ già có thể giảm đáng kể tần suất Full GC.</p><p><strong>Giảm số lượng đối tượng lớn:</strong> Nếu một đối tượng chiếm nhiều bộ nhớ, sau khi được tạo trong khu vực Eden, nó sẽ được chuyển trực tiếp vào thế hệ già. Trong các kịch bản kinh doanh thông thường, chúng ta thường lấy một đối tượng lớn từ cơ sở dữ liệu để hiển thị trên giao diện web. Ví dụ, tôi đã gặp một trường hợp nơi một hoạt động kinh doanh truy vấn cùng lúc 60 trường dữ liệu, đối tượng lớn như vậy nếu vượt quá ngưỡng đối tượng lớn tối đa của thế hệ trẻ, sẽ được tạo trực tiếp trong thế hệ già; ngay cả khi nó được tạo trong thế hệ trẻ, do không gian thế hệ trẻ có giới hạn, sau khi trải qua Minor GC, nó cũng sẽ được chuyển vào thế hệ già. Điều này dễ dẫn đến tình trạng Full GC nhiều.</p><p>Chúng ta có thể tách đối tượng lớn này ra, chỉ truy vấn các trường quan trọng ban đầu, nếu cần xem các trường khác để hỗ trợ, thực hiện truy vấn thứ hai để hiển thị các trường còn lại.</p><p><strong>Mở rộng không gian heap:</strong> Trong trường hợp không đủ bộ nhớ heap, việc mở rộng không gian heap và đặt kích thước heap khởi tạo là kích thước heap tối đa cũng có thể giảm tần suất Full GC.</p><h4 id="giam-thoi-gian-thuc-hien-full-gc" tabindex="-1"><a class="header-anchor" href="#giam-thoi-gian-thuc-hien-full-gc"><span>Giảm thời gian thực hiện Full GC</span></a></h4><p>Thời gian thực hiện Full GC dài hơn nhiều so với Minor GC. Do đó, nếu thời gian thực hiện Full GC quá lâu (hơn 1 giây), có thể gây ra lỗi vượt quá thời gian chờ.</p><ul><li>Nếu <strong>giảm kích thước thế hệ già để giảm thời gian thực hiện Full GC</strong>, có thể gây ra lỗi <code>OutOfMemoryError</code> hoặc làm tăng tần suất Full GC.</li><li>Ngoài ra, nếu <strong>tăng kích thước thế hệ già để giảm tần suất Full GC</strong>, thời gian thực hiện Full GC có thể tăng.</li></ul><p>Do đó, bạn cần đặt kích thước thế hệ già thành một giá trị &quot;phù hợp&quot;.</p><p><strong>Các tham số JVM cần xem xét trong tinh chỉnh GC</strong></p><table><thead><tr><th><strong>Loại</strong></th><th><strong>Tham số</strong></th><th><strong>Mô tả</strong></th></tr></thead><tbody><tr><td>Kích thước heap</td><td><code>-Xms</code></td><td>Kích thước heap khi khởi động</td></tr><tr><td></td><td><code>-Xmx</code></td><td>Giới hạn kích thước heap</td></tr><tr><td>Kích thước thế hệ trẻ</td><td><code>-XX:NewRatio</code></td><td>Tỷ lệ kích thước thế hệ trẻ và thế hệ già</td></tr><tr><td></td><td><code>-XX:NewSize</code></td><td>Kích thước thế hệ trẻ</td></tr><tr><td></td><td><code>-XX:SurvivorRatio</code></td><td>Tỷ lệ kích thước Eden và Survivor</td></tr></tbody></table><p>Các tham số phổ biến nhất trong tinh chỉnh GC là <code>-Xms</code>, <code>-Xmx</code> và <code>-XX:NewRatio</code>. Thông thường, <code>-Xms</code> và <code>-Xmx</code> là bắt buộc, vì vậy giá trị của <code>NewRatio</code> sẽ ảnh hưởng đáng kể đến hiệu suất GC.</p><p>Có thể bạn sẽ hỏi <strong>làm thế nào để đặt kích thước của Permanent Generation</strong>. Bạn có thể sử dụng các tham số <code>-XX:PermSize</code> và <code>-XX:MaxPermSize</code> để đặt kích thước của Permanent Generation, nhưng hãy nhớ chỉ đặt kích thước Permanent Generation khi gặp lỗi <code>OutOfMemoryError</code>.</p><h3 id="qua-trinh-tinh-chinh-gc" tabindex="-1"><a class="header-anchor" href="#qua-trinh-tinh-chinh-gc"><span>Quá trình tinh chỉnh GC</span></a></h3><p>Quá trình tinh chỉnh GC có thể được chia thành các bước sau:</p><h4 id="_1-giam-sat-trang-thai-gc" tabindex="-1"><a class="header-anchor" href="#_1-giam-sat-trang-thai-gc"><span>(1) Giám sát trạng thái GC</span></a></h4><p>Bạn cần giám sát trạng thái GC để kiểm tra các trạng thái GC đang chạy trong hệ thống.</p><h4 id="_2-phan-tich-nhat-ky-gc" tabindex="-1"><a class="header-anchor" href="#_2-phan-tich-nhat-ky-gc"><span>(2) Phân tích nhật ký GC</span></a></h4><p>Sau khi kiểm tra trạng thái GC, bạn cần phân tích dữ liệu giám sát và quyết định xem có cần tinh chỉnh GC hay không. Nếu kết quả phân tích cho thấy thời gian chạy GC chỉ từ 0,1 đến 0,3 giây, thì không cần tốn thời gian tinh chỉnh GC, nhưng nếu thời gian chạy GC là từ 1 đến 3 giây, thậm chí lớn hơn 10 giây, thì tinh chỉnh GC là cần thiết.</p><p>Tuy nhiên, nếu bạn đã cấp phát khoảng 10GB bộ nhớ cho Java và không thể tiết kiệm bộ nhớ này, thì bạn không thể tinh chỉnh GC. Trước khi tinh chỉnh GC, bạn cần xem xét lý do tại sao bạn cần cấp phát nhiều bộ nhớ này. Nếu bạn cấp phát 1GB hoặc 2GB bộ nhớ và gặp lỗi <code>OutOfMemoryError</code>, thì bạn nên thực hiện <strong>bộ nhớ heap (heap dump)</strong> để xác định nguyên nhân gây ra lỗi.</p><blockquote><p>🔔 Lưu ý:</p></blockquote><blockquote><p><strong>Bộ nhớ heap (heap dump)</strong> là một tệp dùng để kiểm tra các đối tượng và dữ liệu trong bộ nhớ Java. Tệp này có thể được tạo bằng cách chạy lệnh <code>jmap</code> trong JDK. Trong quá trình tạo tệp, tất cả các chương trình Java sẽ tạm dừng, vì vậy không nên tạo tệp trong quá trình chạy của hệ thống.</p></blockquote><blockquote><p>Bạn có thể tìm hiểu chi tiết về bộ nhớ heap trên Internet.</p></blockquote><h4 id="_3-chon-bo-thu-gom-rac-phu-hop" tabindex="-1"><a class="header-anchor" href="#_3-chon-bo-thu-gom-rac-phu-hop"><span>(3) Chọn bộ thu gom rác phù hợp</span></a></h4><p>Nếu quyết định tinh chỉnh GC, bạn cần chọn một bộ thu gom rác và đặt các tham số JVM phù hợp cho nó. Nếu bạn có nhiều máy chủ, hãy đặt các tham số GC khác nhau trên mỗi máy chủ và so sánh hiệu suất của chúng.</p><h4 id="_4-phan-tich-ket-qua" tabindex="-1"><a class="header-anchor" href="#_4-phan-tich-ket-qua"><span>(4) Phân tích kết quả</span></a></h4><p>Sau khi đặt các tham số GC, bạn có thể bắt đầu thu thập dữ liệu và phân tích kết quả. Hãy phân tích ít nhất 24 giờ dữ liệu trước khi tiến hành phân tích kết quả. Nếu bạn may mắn đủ, bạn có thể tìm thấy các tham số GC tốt nhất cho hệ thống của mình. Nếu không, bạn cần phân tích các nhật ký đầu ra và kiểm tra việc phân bổ bộ nhớ, sau đó điều chỉnh loại GC/kích thước bộ nhớ để tìm ra các tham số tốt nhất cho hệ thống của bạn.</p><h4 id="_5-ap-dung-cau-hinh-toi-uu" tabindex="-1"><a class="header-anchor" href="#_5-ap-dung-cau-hinh-toi-uu"><span>(5) Áp dụng cấu hình tối ưu</span></a></h4><p>Nếu kết quả tinh chỉnh GC làm bạn hài lòng, bạn có thể áp dụng các tham số cho tất cả các máy chủ và kết thúc quá trình tinh chỉnh GC.</p><p>Trong các phần tiếp theo, bạn sẽ thấy các công việc cụ thể được thực hiện trong từng bước trên.</p><h2 id="nhat-ky-gc" tabindex="-1"><a class="header-anchor" href="#nhat-ky-gc"><span>Nhật ký GC</span></a></h2><h3 id="lay-nhat-ky-gc" tabindex="-1"><a class="header-anchor" href="#lay-nhat-ky-gc"><span>Lấy nhật ký GC</span></a></h3><p>Có hai cách để lấy nhật ký GC:</p><ul><li>Sử dụng lệnh <code>jstat</code> để xem động</li><li>Đặt các tham số liên quan để in nhật ký GC trong container</li></ul><h4 id="xem-gc-bang-lenh-jstat" tabindex="-1"><a class="header-anchor" href="#xem-gc-bang-lenh-jstat"><span>Xem GC bằng lệnh jstat</span></a></h4><p><code>jstat -gc</code> thống kê hành vi của bộ thu gom rác:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">jstat </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">gc </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1262</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> S0C</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    S1C</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">     S0U</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">     S1U</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">   EC</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">       EU</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        OC</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">         OU</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        PC</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">       PU</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">         YGC</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    YGCT</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    FGC</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    FGCT</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">     GCT</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">26112.0</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 24064.0</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6562.5</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.0</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   564224.0</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 76274.5</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   434176.0</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   388518.3</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  524288.0</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 42724.7</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    320</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    6.417</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">      0.398</span><span style="color:#D19A66;--shiki-dark:#D19A66;">    6.815</span></span></code></pre></div><p>Bạn cũng có thể đặt một khoảng thời gian cố định để in:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">jstat</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -gc</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1262</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2000</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 20</span></span></code></pre></div><p>Lệnh này có nghĩa là in thông tin gc của 1262 mỗi 2000ms, tổng cộng in 20 lần.</p><h4 id="đat-tham-so-in-gc" tabindex="-1"><a class="header-anchor" href="#đat-tham-so-in-gc"><span>Đặt tham số in GC</span></a></h4><p>Trước khi chạy JVM, bạn có thể đặt các tham số để in nhật ký GC. Thông thường có các cách sau để đặt các tham số JVM:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>-XX:+PrintGC In nhật ký GC</span></span>
<span class="line"><span>-XX:+PrintGCDetails In nhật ký chi tiết GC</span></span>
<span class="line"><span>-XX:+PrintGCTimeStamps In nhật ký thời gian GC (dưới dạng dấu thời gian cơ sở)</span></span>
<span class="line"><span>-XX:+PrintGCDateStamps In nhật ký thời gian GC (dưới dạng ngày tháng, ví dụ 2013-05-04T21:53:59.234+0800)</span></span>
<span class="line"><span>-XX:+PrintHeapAtGC In thông tin heap trước và sau khi GC</span></span>
<span class="line"><span>-verbose:gc -Xloggc:../logs/gc.log Đường dẫn đến tệp nhật ký</span></span></code></pre></div><p>Nếu nhật ký GC kéo dài trong thời gian dài, chúng ta khó có thể xem xét hiệu suất GC tổng thể dưới dạng văn bản. Trong trường hợp này, chúng ta có thể sử dụng công cụ <a href="https://sourceforge.net/projects/gcviewer/" target="_blank" rel="noopener noreferrer">GCView</a> để mở tệp nhật ký và xem hiệu suất GC tổng thể dưới giao diện đồ họa.</p><p>【Ví dụ】Cài đặt Tomcat</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">JAVA_OPTS</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;-server -Xms2000m -Xmx2000m -Xmn800m -XX:PermSize=64m -XX:MaxPermSize=256m -XX:SurvivorRatio=4</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">-verbose:gc -Xloggc:</span><span style="color:#E06C75;--shiki-dark:#E06C75;">$CATALINA_HOME</span><span style="color:#98C379;--shiki-dark:#98C379;">/logs/gc.log</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">-Djava.awt.headless=true</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">-XX:+PrintGCTimeStamps -XX:+PrintGCDetails</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">-Dsun.rmi.dgc.server.gcInterval=600000 -Dsun.rmi.dgc.client.gcInterval=600000</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">-XX:+UseConcMarkSweepGC -XX:MaxTenuringThreshold=15&quot;</span></span></code></pre></div><ul><li><code>-Xms2000m -Xmx2000m -Xmn800m -XX:PermSize=64m -XX:MaxPermSize=256m</code><br> Xms là kích thước heap ban đầu của JVM khi khởi động, Xmx là kích thước heap tối đa của JVM, xmn là kích thước của thế hệ trẻ, permsize là kích thước ban đầu của permgen, MaxPermSize là kích thước tối đa của permgen.</li><li><code>-XX:SurvivorRatio=4</code><br> SurvivorRatio là tỷ lệ kích thước của khu vực Eden và khu vực Survivor trong không gian mới, mặc định là 8, tức là tỷ lệ giữa hai khu vực Survivor và một khu vực Eden là 2: 8, một khu vực Survivor chiếm 1/10 của không gian trẻ. Giảm tham số này sẽ làm tăng kích thước khu vực survivor, giúp đối tượng ở lại khu vực survivor lâu hơn, giảm số lượng đối tượng vào thế hệ già. Ý tưởng của việc loại bỏ khu vực survivor là để đưa nhanh chóng các dữ liệu không thể thu gom được vào thế hệ già, tăng tần suất thu gom của thế hệ già, giảm khả năng thế hệ già bùng nổ, điều này được thực hiện bằng cách đặt -XX:SurvivorRatio thành một giá trị lớn (ví dụ: 65536).</li><li><code>-verbose:gc -Xloggc:$CATALINA_HOME/logs/gc.log</code><br> Ghi thông tin về mỗi lần thu gom rác của máy ảo vào tệp nhật ký, tên tệp được chỉ định bởi file, định dạng tệp là tệp phẳng, nội dung giống với -verbose:gc.</li><li><code>-Djava.awt.headless=true</code> Chế độ Headless là một chế độ cấu hình của hệ thống. Trong chế độ này, hệ thống thiếu thiết bị hiển thị, bàn phím hoặc chuột.</li><li><code>-XX:+PrintGCTimeStamps -XX:+PrintGCDetails</code><br> Đặt định dạng nhật ký GC</li><li><code>-Dsun.rmi.dgc.server.gcInterval=600000 -Dsun.rmi.dgc.client.gcInterval=600000</code><br> Xác định khoảng thời gian gc khi gọi rmi</li><li><code>-XX:+UseConcMarkSweepGC -XX:MaxTenuringThreshold=15</code> Sử dụng cách thu gom song song, sau 15 lần gc nhỏ, nó sẽ vào thế hệ già</li></ul><h3 id="phan-tich-nhat-ky-gc" tabindex="-1"><a class="header-anchor" href="#phan-tich-nhat-ky-gc"><span>Phân tích nhật ký GC</span></a></h3><p>Nhật ký GC trẻ:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">2016</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">07</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">05T10</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">43</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">18.093</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#E06C75;--shiki-dark:#E06C75;">0800</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 25.395</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> [</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">GC</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> [PSYoungGen</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 274931K</span><span style="color:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">10738</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">K</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(274944K)] 371093K</span><span style="color:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">147186</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">K</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(450048K)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0.0668480</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> secs] [Times</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> user</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0.17</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> sys</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0.08</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> real</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0.07</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> secs]</span></span></code></pre></div><p>Nhật ký GC đầy đủ:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">2016</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">07</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">05T10</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">43</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">18.160</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#E06C75;--shiki-dark:#E06C75;">0800</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 25.462</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> [</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Full</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> GC</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> [PSYoungGen</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 10738K</span><span style="color:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">0</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">K</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(274944K)] [ParOldGen</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 136447K</span><span style="color:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">140379</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">K</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(302592K)] 147186K</span><span style="color:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">140379</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">K</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(577536K) [PSPermGen</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 85411K</span><span style="color:#C678DD;--shiki-dark:#C678DD;">-&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">85376</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">K</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(171008K)]</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0.6763541</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> secs] [Times</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> user</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1.75</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> sys</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0.02</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> real</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0.68</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> secs]</span></span></code></pre></div><p>Dựa trên nhật ký trên, PSYoungGen, ParOldGen, PSPermGen thuộc bộ thu gom song song. Trong đó, PSYoungGen biểu thị sự thay đổi bộ nhớ trẻ trước và sau khi gc; ParOldGen biểu thị sự thay đổi bộ nhớ già trước và sau khi gc; PSPermGen biểu thị sự thay đổi bộ nhớ vĩnh viễn trước và sau khi gc. gc trẻ chủ yếu là để thu gom bộ nhớ trẻ, thời gian hoạt động ngắn; full gc sẽ thu gom toàn bộ bộ nhớ heap, thời gian hoạt động lâu, vì vậy thường cố gắng giảm số lần full gc.</p><p>Dựa trên hai biểu đồ trên, rõ ràng thấy nhật ký gc được tạo thành bởi:</p><p>GC trẻ</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20220107093538.jfif" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>Full GC</p><figure><img src="https://raw.githubusercontent.com/dunwu/images/dev/snap/20220107093543.jfif" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h4 id="cpu-cao" tabindex="-1"><a class="header-anchor" href="#cpu-cao"><span>CPU cao</span></a></h4><p>Bước xác định:</p><p>(1) Chạy lệnh top -c, tìm id của tiến trình có CPU cao nhất</p><p>(2) Xuất thông tin stack của ứng dụng Java bằng lệnh jstack PID.</p><p>Ví dụ:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">jstack </span><span style="color:#D19A66;--shiki-dark:#D19A66;">6795</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Low Memory Detector&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> daemon prio</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x081465f8</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> nid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x7</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> runnable [0x00000000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">..</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">0x00000000</span><span style="color:#E06C75;--shiki-dark:#E06C75;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &quot;CompilerThread0&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> daemon prio</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x08143c58</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> nid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x6</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> waiting on condition [0x00000000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">..</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">0xfb5fd798</span><span style="color:#E06C75;--shiki-dark:#E06C75;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &quot;Signal Dispatcher&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> daemon prio</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x08142f08</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> nid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x5</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> waiting on condition [0x00000000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">..</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">0x00000000</span><span style="color:#E06C75;--shiki-dark:#E06C75;">]</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &quot;Finalizer&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> daemon prio</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x08137ca0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> nid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x4</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> in </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wait</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> [0xfbeed000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">..</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">0xfbeeddb8</span><span style="color:#E06C75;--shiki-dark:#E06C75;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wait</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Native</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> Method)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        -</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> waiting on </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0xef600848</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (a </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ref</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ReferenceQueue$Lock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ref</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ReferenceQueue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ReferenceQueue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">116</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        -</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> locked </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0xef600848</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (a </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ref</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ReferenceQueue$Lock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ref</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ReferenceQueue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ReferenceQueue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">132</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ref</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Finalizer$FinalizerThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Finalizer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">159</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &quot;Reference Handler&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> daemon prio</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x081370f0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> nid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x3</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> in </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wait</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> [0xfbf4a000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">..</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">0xfbf4aa38</span><span style="color:#E06C75;--shiki-dark:#E06C75;">]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wait</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Native</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> Method)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        -</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> waiting on </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0xef600758</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (a </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ref</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Reference$Lock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wait</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">474</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ref</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Reference$ReferenceHandler</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Reference</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">116</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        -</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> locked </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0xef600758</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (a </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ref</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Reference$Lock</span><span style="color:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &quot;VM Thread&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> prio</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x08134878</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> nid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x2</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> runnable</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">        &quot;VM Periodic Task Thread&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> prio</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x08147768</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> nid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x8</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> waiting on condition</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Trong tệp nhật ký stack được in, tid và nid có ý nghĩa như sau:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>nid: số hiệu luồng Linux tương ứng (tid) trong hệ điều hành Linux, tức là số thập lục phân được chuyển đổi từ số thập lục phân trước đó</span></span>
<span class="line"><span>tid: Đây nên là địa chỉ duy nhất trong quy tắc bộ nhớ jmm của jvm</span></span></code></pre></div><p>Trong trường hợp CPU cao, tìm luồng tương ứng, thường được xác định bằng nid. Và nếu xảy ra vấn đề như deadlock, thường sử dụng tid để xác định.</p><p>(3) In nid của luồng CPU cao</p><p>Lệnh để xem thông tin tiến trình cụ thể của luồng như sau:</p><p>top -H -p 6735</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">top </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 14</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;">09 up </span><span style="color:#D19A66;--shiki-dark:#D19A66;">611</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> days</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  2</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">56</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  1</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  load average</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 13.19</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 7.76</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 7.82</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">Threads</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6991</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> total</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  17</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> running</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6974</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> sleeping</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> stopped</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> zombie</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">%</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Cpu</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(s)</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 90.4</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> us</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  2.1</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> sy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> ni</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  7.0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> wa</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> hi</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.4</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> si</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  0.0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> st</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">KiB</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> Mem</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  32783044</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> total</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 32505008</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> used</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   278036</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> free</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   120304</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> buffers</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">KiB</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> Swap</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">        0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> total</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">        0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> used</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;">        0</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> free</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;"> 4497428</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cached </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Mem</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">  PID</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> USER</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">      PR</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">  NI</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    VIRT</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    RES</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    SHR</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">%</span><span style="color:#E06C75;--shiki-dark:#E06C75;">CPU </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">%</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">MEM</span><span style="color:#E06C75;--shiki-dark:#E06C75;">     TIME</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> COMMAND</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6800</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S </span><span style="color:#D19A66;--shiki-dark:#D19A66;">54.7</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 187</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">55.61</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6803</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S </span><span style="color:#D19A66;--shiki-dark:#D19A66;">54.4</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 187</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">52.59</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6798</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S </span><span style="color:#D19A66;--shiki-dark:#D19A66;">53.7</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 187</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">55.08</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6801</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S </span><span style="color:#D19A66;--shiki-dark:#D19A66;">53.7</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 187</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">55.25</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6797</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S </span><span style="color:#D19A66;--shiki-dark:#D19A66;">53.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 187</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">52.78</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6804</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S </span><span style="color:#D19A66;--shiki-dark:#D19A66;">53.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 187</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">55.76</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6802</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S </span><span style="color:#D19A66;--shiki-dark:#D19A66;">52.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 187</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">54.79</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6799</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S </span><span style="color:#D19A66;--shiki-dark:#D19A66;">51.8</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 187</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">53.36</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6807</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S </span><span style="color:#D19A66;--shiki-dark:#D19A66;">13.6</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">  48</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">58.60</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">11014</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> R  </span><span style="color:#D19A66;--shiki-dark:#D19A66;">8.4</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   8</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">00</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">32</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">10642</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> R  </span><span style="color:#D19A66;--shiki-dark:#D19A66;">6.5</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   6</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">32.06</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;"> 6808</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S  </span><span style="color:#D19A66;--shiki-dark:#D19A66;">6.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 159</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">08.40</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">11315</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S  </span><span style="color:#D19A66;--shiki-dark:#D19A66;">3.9</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   5</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">54.10</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">12545</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S  </span><span style="color:#D19A66;--shiki-dark:#D19A66;">3.9</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   6</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">55.48</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">23353</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S  </span><span style="color:#D19A66;--shiki-dark:#D19A66;">3.9</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">20.55</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">24868</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S  </span><span style="color:#D19A66;--shiki-dark:#D19A66;">3.9</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   2</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">12.46</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;"> 9146</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> root      </span><span style="color:#D19A66;--shiki-dark:#D19A66;">20</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   0</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 27</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">299g</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">021t</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7172</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> S  </span><span style="color:#D19A66;--shiki-dark:#D19A66;">3.6</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 70.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;">   7</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">42.72</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> java</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Có thể thấy luồng chiếm CPU cao, nhưng chúng không cao lắm, không thể trực tiếp xác định lớp cụ thể. nid là số thập lục phân, vì vậy chúng ta cần lấy ID thập lục phân của luồng:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>printf &quot;%x\\n&quot; 6800</span></span></code></pre></div><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>Kết quả đầu ra:45cd</span></span></code></pre></div><p>Sau đó, tìm vị trí của nid trong nhật ký stack được in:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;catalina-exec-5692&quot;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> daemon prio</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x00007f3b05013800</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> nid</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x45cd</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> waiting on condition [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x00007f3ae08e3000</span><span style="color:#E06C75;--shiki-dark:#E06C75;">]</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">   java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">State</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> TIMED_WAITING</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (parking)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sun</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">misc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Unsafe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">park</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Native</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> Method)</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">        -</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> parking to wait </span><span style="color:#C678DD;--shiki-dark:#C678DD;">for</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">  &lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0x00000006a7800598</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (a </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">concurrent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">locks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">AbstractQueuedSynchronizer$ConditionObject</span><span style="color:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">concurrent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">locks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LockSupport</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">parkNanos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LockSupport</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">226</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">concurrent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">locks</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">AbstractQueuedSynchronizer$ConditionObject</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">awaitNanos</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">AbstractQueuedSynchronizer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2082</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">concurrent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LinkedBlockingQueue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">poll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LinkedBlockingQueue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">467</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">tomcat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">threads</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TaskQueue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">poll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TaskQueue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">86</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">tomcat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">threads</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TaskQueue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">poll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TaskQueue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">32</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">concurrent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ThreadPoolExecutor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getTask</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ThreadPoolExecutor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1068</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">concurrent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ThreadPoolExecutor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">runWorker</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ThreadPoolExecutor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1130</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">concurrent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ThreadPoolExecutor$Worker</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ThreadPoolExecutor</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">615</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">apache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">tomcat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">util</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">threads</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TaskThread$WrappingRunnable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TaskThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">61</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        at </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">lang</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">745</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre></div><h2 id="cau-hinh-gc" tabindex="-1"><a class="header-anchor" href="#cau-hinh-gc"><span>Cấu hình GC</span></a></h2><blockquote><p>Vui lòng tham khảo tài liệu chính thức để biết chi tiết các tham số: <a href="http://www.oracle.com/technetwork/java/javase/tech/vmoptions-jsp-140102.html" target="_blank" rel="noopener noreferrer">JavaHotSpot VM Options</a>. Ở đây chỉ liệt kê các tham số thông dụng.</p></blockquote><h3 id="cau-hinh-kich-thuoc-heap" tabindex="-1"><a class="header-anchor" href="#cau-hinh-kich-thuoc-heap"><span>Cấu hình kích thước Heap</span></a></h3><p><strong>Cấu hình cho phần Young Generation rất quan trọng.</strong></p><p>Có ba giới hạn về kích thước Heap trong JVM:</p><ol><li>Giới hạn của kiểu dữ liệu của hệ điều hành liên quan (32-bit hay 64-bit).</li><li>Giới hạn của bộ nhớ ảo có sẵn trong hệ thống.</li><li>Giới hạn của bộ nhớ vật lý có sẵn trong hệ thống.</li></ol><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>Tổng kích thước Heap = Kích thước Young Generation + Kích thước Old Generation + Kích thước Permanent Generation</span></span></code></pre></div><ul><li>Thường thì Permanent Generation có kích thước cố định là <code>64m</code>. Có thể cấu hình bằng <code>-XX:PermSize</code>.</li><li>Thường thì Young Generation chiếm 3/8 tổng kích thước Heap. Có thể cấu hình bằng <code>-Xmn</code>.</li></ul><h3 id="cau-hinh-bo-nho-jvm" tabindex="-1"><a class="header-anchor" href="#cau-hinh-bo-nho-jvm"><span>Cấu hình bộ nhớ JVM</span></a></h3><table><thead><tr><th>Cấu hình</th><th>Mô tả</th></tr></thead><tbody><tr><td><code>-Xss</code></td><td>Kích thước Stack của JVM.</td></tr><tr><td><code>-Xms</code></td><td>Giá trị khởi tạo kích thước Heap.</td></tr><tr><td><code>-Xmx</code></td><td>Giá trị tối đa của kích thước Heap.</td></tr><tr><td><code>-Xmn</code></td><td>Kích thước Young Generation.</td></tr><tr><td><code>-XX:NewSize</code></td><td>Giá trị khởi tạo kích thước Young Generation.</td></tr><tr><td><code>-XX:MaxNewSize</code></td><td>Giá trị tối đa của kích thước Young Generation.</td></tr><tr><td><code>-XX:NewRatio</code></td><td>Tỷ lệ giữa Young Generation và Old Generation. Mặc định là 2.</td></tr><tr><td><code>-XX:SurvivorRatio</code></td><td>Tỷ lệ giữa Eden Space và Survivor Space trong Young Generation. Mặc định là 8.</td></tr><tr><td><code>-XX:PermSize</code></td><td>Giá trị khởi tạo kích thước Permanent Generation.</td></tr><tr><td><code>-XX:MaxPermSize</code></td><td>Giá trị tối đa của kích thước Permanent Generation.</td></tr></tbody></table><h3 id="cau-hinh-gc-1" tabindex="-1"><a class="header-anchor" href="#cau-hinh-gc-1"><span>Cấu hình GC</span></a></h3><table><thead><tr><th>Cấu hình</th><th>Mô tả</th></tr></thead><tbody><tr><td><code>-XX:+UseSerialGC</code></td><td>Sử dụng Serial + Serial Old garbage collector.</td></tr><tr><td><code>-XX:+UseParallelGC</code></td><td>Sử dụng Parallel Scavenge + Parallel Old garbage collector.</td></tr><tr><td><s><code>-XX:+UseParallelOldGC</code></s></td><td><s>Sử dụng Parallel Old garbage collector (không còn sử dụng từ JDK 5 trở đi)</s></td></tr><tr><td><code>-XX:+UseParNewGC</code></td><td>Sử dụng ParNew + Serial Old garbage collector.</td></tr><tr><td><code>-XX:+UseConcMarkSweepGC</code></td><td>Sử dụng CMS + ParNew + Serial Old garbage collector.</td></tr><tr><td><code>-XX:+UseG1GC</code></td><td>Sử dụng G1 garbage collector.</td></tr><tr><td><code>-XX:ParallelCMSThreads</code></td><td>Số lượng luồng được sử dụng cho Concurrent Mark Sweep garbage collector.</td></tr></tbody></table><h3 id="cac-tham-so-chung-cho-garbage-collector" tabindex="-1"><a class="header-anchor" href="#cac-tham-so-chung-cho-garbage-collector"><span>Các tham số chung cho garbage collector</span></a></h3><table><thead><tr><th>Cấu hình</th><th>Mô tả</th></tr></thead><tbody><tr><td><code>PretenureSizeThreshold</code></td><td>Kích thước đối tượng được thăng cấp lên Old Generation. Mặc định là 0. Ví dụ: <code>-XX:PretenureSizeThreshold=10M</code></td></tr><tr><td><code>MaxTenuringThreshold</code></td><td>Tuổi tối đa để thăng cấp lên Old Generation. Mặc định là 15. Ví dụ: <code>-XX:MaxTenuringThreshold=10</code></td></tr><tr><td><code>DisableExplicitGC</code></td><td>Vô hiệu hóa <code>System.gc()</code></td></tr></tbody></table><h3 id="jmx" tabindex="-1"><a class="header-anchor" href="#jmx"><span>JMX</span></a></h3><p>Khi bật JMX, bạn có thể sử dụng <code>jconsole</code> hoặc <code>jvisualvm</code> để giám sát thông tin cơ bản và tình trạng chạy của chương trình Java.</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Dcom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sun</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">management</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">jmxremote</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Dcom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sun</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">management</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">jmxremote</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ssl</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Dcom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sun</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">management</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">jmxremote</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">authenticate</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Djava</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">rmi</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">hostname</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">127.0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#FFFFFF;--shiki-dark:#FFFFFF;">1</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Dcom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sun</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">management</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">jmxremote</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">18888</span></span></code></pre></div><p><code>-Djava.rmi.server.hostname</code> chỉ định máy chủ chạy chương trình Java, <code>-Dcom.sun.management.jmxremote.port</code> chỉ định cổng lắng nghe dịch vụ.</p><h3 id="debug-tu-xa" tabindex="-1"><a class="header-anchor" href="#debug-tu-xa"><span>DEBUG từ xa</span></a></h3><p>Nếu bật tính năng Debug từ xa cho ứng dụng Java, bạn cần chỉ định các tham số sau:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Xdebug</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Xnoagent</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Djava</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">compiler</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">NONE</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">Xrunjdwp</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;">transport</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;">dt_socket</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;">address</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">28888</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;">server</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;">y</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;">suspend</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;">n</span></span></code></pre></div><p>address là cổng lắng nghe Debug từ xa.</p><h3 id="heapdump" tabindex="-1"><a class="header-anchor" href="#heapdump"><span>HeapDump</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">XX</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">OmitStackTraceInFastThrow </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">XX</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">HeapDumpOnOutOfMemoryError</span></span></code></pre></div><h3 id="cau-hinh-phu-tro" tabindex="-1"><a class="header-anchor" href="#cau-hinh-phu-tro"><span>Cấu hình phụ trợ</span></a></h3><table><thead><tr><th>Cấu hình</th><th>Mô tả</th></tr></thead><tbody><tr><td><code>-XX:+PrintGCDetails</code></td><td>In log của GC.</td></tr><tr><td><code>-Xloggc:&lt;filename&gt;</code></td><td>Chỉ định tên tệp log GC.</td></tr><tr><td><code>-XX:+HeapDumpOnOutOfMemoryError</code></td><td>Tạo Heap Dump khi gặp lỗi OutOfMemoryError.</td></tr><tr><td><code>-XX:HeapDumpPath=&lt;path&gt;</code></td><td>Chỉ định đường dẫn lưu Heap Dump.</td></tr><tr><td><code>-XX:+PrintCommandLineFlags</code></td><td>In các cờ dòng lệnh JVM đã được sử dụng.</td></tr><tr><td><code>-XX:+PrintFlagsFinal</code></td><td>In các cờ JVM cuối cùng đã được sử dụng.</td></tr><tr><td><code>-XX:+PrintCompilation</code></td><td>In thông tin về quá trình biên dịch JIT.</td></tr><tr><td><code>-XX:+PrintGCApplicationStoppedTime</code></td><td>In thời gian dừng ứng dụng do GC.</td></tr><tr><td><code>-XX:+PrintGCApplicationConcurrentTime</code></td><td>In thời gian chạy ứng dụng trước và sau khi GC.</td></tr><tr><td><code>-XX:+PrintSafepointStatistics</code></td><td>In thống kê về Safepoint.</td></tr><tr><td><code>-XX:+PrintTenuringDistribution</code></td><td>In thông tin về phân phối tuổi của đối tượng trong Young Generation.</td></tr><tr><td><code>-XX:+PrintAdaptiveSizePolicy</code></td><td>In thông tin về chính sách kích thước thích ứng của GC.</td></tr><tr><td><code>-XX:+PrintReferenceGC</code></td><td>In thông tin về việc thu gom rác của các tham chiếu.</td></tr><tr><td><code>-XX:+PrintStringDeduplicationStatistics</code></td><td>In thông tin về thống kê chuỗi đã được giảm trùng.</td></tr><tr><td><code>-XX:+PrintCompilationStatistics</code></td><td>In thông tin về thống kê biên dịch.</td></tr><tr><td><code>-XX:+PrintNMTStatistics</code></td><td>In thông tin về thống kê Native Memory Tracking.</td></tr><tr><td><code>-XX:+UnlockDiagnosticVMOptions</code></td><td>Mở khóa các tùy chọn chẩn đoán của JVM.</td></tr><tr><td><code>-XX:+UnlockExperimentalVMOptions</code></td><td>Mở khóa các tùy chọn thử nghiệm của JVM.</td></tr><tr><td><code>-XX:+UnlockCommercialFeatures</code></td><td>Mở khóa các tính năng thương mại của JVM.</td></tr><tr><td><code>-XX:+UseLargePages</code></td><td>Sử dụng trang lớn (large pages) cho bộ nhớ.</td></tr><tr><td><code>-XX:+UseStringDeduplication</code></td><td>Sử dụng giảm trùng chuỗi (String Deduplication).</td></tr><tr><td><code>-XX:MaxJavaStackTraceDepth=&lt;depth&gt;</code></td><td>Giới hạn độ sâu của Stack Trace khi in log.</td></tr><tr><td><code>-XX:OnError=&quot;&lt;cmd&gt;;&lt;cmd&gt;&quot;</code></td><td>Chạy các lệnh khi gặp lỗi.</td></tr><tr><td><code>-XX:OnOutOfMemoryError=&quot;&lt;cmd&gt;;&lt;cmd&gt;&quot;</code></td><td>Chạy các lệnh khi gặp lỗi OutOfMemoryError.</td></tr><tr><td><code>-XX:ErrorFile=&lt;file&gt;</code></td><td>Chỉ định tệp để ghi thông tin lỗi.</td></tr><tr><td><code>-XX:NativeMemoryTracking=&lt;mode&gt;</code></td><td>Bật chế độ theo dõi bộ nhớ Native. Các giá trị mode có thể là <code>summary</code>, <code>detail</code>, <code>summary+detail</code>.</td></tr></tbody></table>`,119),l=[o];function t(p,h){return a(),n("div",null,l)}const e=s(r,[["render",t],["__file","JVM In Action.html.vue"]]),k=JSON.parse('{"path":"/programming/java/JVM/JVM%20In%20Action.html","title":"JVM In Action","lang":"en-US","frontmatter":{"title":"JVM In Action","tags":["java","javase","jvm"],"categories":["java","javase","jvm"],"date created":"2023-07-19T00:00:00.000Z","date modified":"2023-07-19T00:00:00.000Z","description":"JVM Thực hành Tổng quan về Tinh chỉnh JVM Các chỉ số hiệu suất GC Trong quá trình tinh chỉnh JVM, cần xác định mục tiêu tinh chỉnh trước. Từ góc độ hiệu suất, thường quan tâm đế...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/programming/java/JVM/JVM%20In%20Action.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"JVM In Action"}],["meta",{"property":"og:description","content":"JVM Thực hành Tổng quan về Tinh chỉnh JVM Các chỉ số hiệu suất GC Trong quá trình tinh chỉnh JVM, cần xác định mục tiêu tinh chỉnh trước. Từ góc độ hiệu suất, thường quan tâm đế..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/dunwu/images/dev/snap/20220107093538.jfif"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-28T15:54:38.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"java"}],["meta",{"property":"article:tag","content":"javase"}],["meta",{"property":"article:tag","content":"jvm"}],["meta",{"property":"article:modified_time","content":"2024-06-28T15:54:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"JVM In Action\\",\\"image\\":[\\"https://raw.githubusercontent.com/dunwu/images/dev/snap/20220107093538.jfif\\",\\"https://raw.githubusercontent.com/dunwu/images/dev/snap/20220107093543.jfif\\"],\\"dateModified\\":\\"2024-06-28T15:54:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Tổng quan về Tinh chỉnh JVM","slug":"tong-quan-ve-tinh-chinh-jvm","link":"#tong-quan-ve-tinh-chinh-jvm","children":[{"level":3,"title":"Các chỉ số hiệu suất GC","slug":"cac-chi-so-hieu-suat-gc","link":"#cac-chi-so-hieu-suat-gc","children":[]},{"level":3,"title":"Nguyên tắc tinh chỉnh","slug":"nguyen-tac-tinh-chinh","link":"#nguyen-tac-tinh-chinh","children":[]},{"level":3,"title":"Quá trình tinh chỉnh GC","slug":"qua-trinh-tinh-chinh-gc","link":"#qua-trinh-tinh-chinh-gc","children":[]}]},{"level":2,"title":"Nhật ký GC","slug":"nhat-ky-gc","link":"#nhat-ky-gc","children":[{"level":3,"title":"Lấy nhật ký GC","slug":"lay-nhat-ky-gc","link":"#lay-nhat-ky-gc","children":[]},{"level":3,"title":"Phân tích nhật ký GC","slug":"phan-tich-nhat-ky-gc","link":"#phan-tich-nhat-ky-gc","children":[]}]},{"level":2,"title":"Cấu hình GC","slug":"cau-hinh-gc","link":"#cau-hinh-gc","children":[{"level":3,"title":"Cấu hình kích thước Heap","slug":"cau-hinh-kich-thuoc-heap","link":"#cau-hinh-kich-thuoc-heap","children":[]},{"level":3,"title":"Cấu hình bộ nhớ JVM","slug":"cau-hinh-bo-nho-jvm","link":"#cau-hinh-bo-nho-jvm","children":[]},{"level":3,"title":"Cấu hình GC","slug":"cau-hinh-gc-1","link":"#cau-hinh-gc-1","children":[]},{"level":3,"title":"Các tham số chung cho garbage collector","slug":"cac-tham-so-chung-cho-garbage-collector","link":"#cac-tham-so-chung-cho-garbage-collector","children":[]},{"level":3,"title":"JMX","slug":"jmx","link":"#jmx","children":[]},{"level":3,"title":"DEBUG từ xa","slug":"debug-tu-xa","link":"#debug-tu-xa","children":[]},{"level":3,"title":"HeapDump","slug":"heapdump","link":"#heapdump","children":[]},{"level":3,"title":"Cấu hình phụ trợ","slug":"cau-hinh-phu-tro","link":"#cau-hinh-phu-tro","children":[]}]}],"git":{"createdTime":1719590078000,"updatedTime":1719590078000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":17.25,"words":5174},"filePathRelative":"programming/java/JVM/JVM In Action.md","localizedDate":"June 28, 2024","excerpt":"\\n<h2>Tổng quan về Tinh chỉnh JVM</h2>\\n<h3>Các chỉ số hiệu suất GC</h3>\\n<p>Trong quá trình tinh chỉnh JVM, cần xác định mục tiêu tinh chỉnh trước. Từ góc độ hiệu suất, thường quan tâm đến ba chỉ số sau:</p>\\n<ul>\\n<li><code>Thông lượng (throughput)</code> - Đây là chỉ số hiệu suất cao nhất mà bộ thu gom rác có thể hỗ trợ cho ứng dụng mà không tính đến thời gian tạm dừng hoặc tiêu thụ bộ nhớ.</li>\\n<li><code>Thời gian tạm dừng (latency)</code> - Đây là thước đo để rút ngắn thời gian tạm dừng do thu gom rác gây ra hoặc loại bỏ hoàn toàn thời gian tạm dừng do thu gom rác, từ đó tránh rung lắc khi ứng dụng đang chạy.</li>\\n<li><code>Tần suất thu gom rác</code> - Bao lâu một lần thu gom rác xảy ra? Thường thì tần suất thu gom rác càng thấp càng tốt, tuy nhiên, tăng kích thước bộ nhớ heap có thể giảm tần suất thu gom rác nhưng đồng thời cũng tăng số lượng đối tượng cần thu gom, dẫn đến tăng thời gian tạm dừng. Do đó, chỉ cần tăng kích thước bộ nhớ heap một cách phù hợp để đảm bảo tần suất thu gom rác bình thường là đủ.</li>\\n</ul>","autoDesc":true}');export{e as comp,k as data};
