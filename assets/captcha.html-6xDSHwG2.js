import{_ as e,o as a,c as n,a as s}from"./app-BRTHG7K9.js";const o={},i=s(`<h1 id="验证码" tabindex="-1"><a class="header-anchor" href="#验证码"><span>验证码</span></a></h1><p>项目基于 <a href="https://gitee.com/anji-plus/captcha" target="_blank" rel="noopener noreferrer">AJ-Captcha</a> 实现行为验证码，包含滑动拼图、文字点选两种方式，UI 支持弹出和嵌入两种方式。如下图所示：</p><table><thead><tr><th>滑动拼图</th><th>文字点选</th></tr></thead><tbody><tr><td>滑动拼图</td><td>点选文字</td></tr></tbody></table><p>疑问：为什么采用行为验证码？</p><p>相比传统的「传统字符型验证码」的“展示验证码-填写字符-比对答案”的流程来说，「行为验证码」的“展示验证码-操作-比对答案”的流程，用户只需要使用鼠标产生指定的行为轨迹，不需要键盘手动输入，用户体验更好，更加难以被机器识别，更加安全可靠。</p><h2 id="_1-交互流程" tabindex="-1"><a class="header-anchor" href="#_1-交互流程"><span><a href="#_1-%E4%BA%A4%E4%BA%92%E6%B5%81%E7%A8%8B">#</a> 1. 交互流程</span></a></h2><figure><img src="https://doc.iocoder.cn/img/验证码/shixu.png" alt="交互流程" tabindex="0" loading="lazy"><figcaption>交互流程</figcaption></figure><ul><li>① 用户访问应用页面，请求显示行为验证码</li><li>② 用户按照提示要求完成验证码拼图/点击</li><li>③ 用户提交表单，前端将第二步的输出一同提交到后台</li><li>④ 验证数据随表单提交到后台后，后台需要调用 <a href="https://gitee.com/anji-plus/captcha/blob/master/core/captcha/src/main/java/com/anji/captcha/service/CaptchaService.java#L39-44" target="_blank" rel="noopener noreferrer">captchaService.verification</a> 做二次校验</li><li>⑤ 第 4 步返回校验通过/失败到产品应用后端，再返回到前端</li></ul><h2 id="_2-如何关闭验证码" tabindex="-1"><a class="header-anchor" href="#_2-如何关闭验证码"><span><a href="#_2-%E5%A6%82%E4%BD%95%E5%85%B3%E9%97%AD%E9%AA%8C%E8%AF%81%E7%A0%81">#</a> 2. 如何关闭验证码</span></a></h2><p>管理后台的登录界面，默认开启验证码。如果需要关闭验证码，操作如下：</p><p>① 后端的 <code>application-local.yaml</code> 配置文件中，将 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-server/src/main/resources/application-local.yaml#L225-L227" target="_blank" rel="noopener noreferrer"><code>yudao.captcha.enabled</code></a> 设置为 <code>false</code>。</p><p>② 如果前端使用 <code>yudao-ui-admin-vue2</code> 项目，将环境对应的 <code>.env</code> 配置文件中，将 <a href="https://github.com/yudaocode/yudao-ui-admin-vue2/blob/master/.env.local#L17-L18" target="_blank" rel="noopener noreferrer"><code>VUE_APP_DOC_ENABLE</code></a> 设置为 <code>false</code>。</p><p>如果前端使用 <code>yudao-ui-admin-vue3</code> 项目，将环境对应的 <code>.env</code> 配置文件中，将 <a href="https://github.com/yudaocode/yudao-ui-admin-vue3/blob/master/.env#L13-L14" target="_blank" rel="noopener noreferrer"><code>VITE_APP_CAPTCHA_ENABLE</code></a> 设置为 <code>false</code>。</p><p>ps：如果你不知道环境对应的 <code>.env</code> 配置文件是哪个，就全部改成 <code>false</code> 吧！</p><h2 id="_3-接入场景" tabindex="-1"><a class="header-anchor" href="#_3-接入场景"><span><a href="#_3-%E6%8E%A5%E5%85%A5%E5%9C%BA%E6%99%AF">#</a> 3. 接入场景</span></a></h2><h3 id="_3-1-后端接入" tabindex="-1"><a class="header-anchor" href="#_3-1-后端接入"><span><a href="#_3-1-%E5%90%8E%E7%AB%AF%E6%8E%A5%E5%85%A5">#</a> 3.1 后端接入</span></a></h3><p><code>yudao-module-system-biz</code> 模块，默认在 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/pom.xml#L104-L107" target="_blank" rel="noopener noreferrer"><code>pom.xml</code></a>) 已经引入 <code>spring-boot-starter-captcha-plus</code> 依赖，代码如下：</p><blockquote><p>由于 AJ-Captcha 对 Spring Boot 3.X 版本的支持还不完善，所以使用 <a href="https://github.com/xingyuv/captcha-plus" target="_blank" rel="noopener noreferrer">captcha-plus</a> 替代，它是基于 AJ-Captcha 进行增强。</p></blockquote><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;cn.iocoder.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;yudao-spring-boot-starter-captcha&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre></div><p>② 验证码的配置，在 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-server/src/main/resources/application.yaml#L64-L81" target="_blank" rel="noopener noreferrer"><code>application.yaml</code></a> 配置文件中，配置项如下：</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>aj:</span></span>
<span class="line"><span>  captcha:</span></span>
<span class="line"><span>    jigsaw: classpath:images/jigsaw # 滑动验证，底图路径，不配置将使用默认图片；以 classpath: 开头，取 resource 目录下路径</span></span>
<span class="line"><span>    pic-click: classpath:images/pic-click # 滑动验证，底图路径，不配置将使用默认图片；以 classpath: 开头，取 resource 目录下路径</span></span>
<span class="line"><span>    cache-type: redis # 缓存 local/redis...</span></span>
<span class="line"><span>    cache-number: 1000 # local 缓存的阈值,达到这个值，清除缓存</span></span>
<span class="line"><span>    timing-clear: 180 # local定时清除过期缓存(单位秒),设置为0代表不执行</span></span>
<span class="line"><span>    type: blockPuzzle # 验证码类型 default两种都实例化。 blockPuzzle 滑块拼图 clickWord 文字点选</span></span>
<span class="line"><span>    water-mark: 芋道源码 # 右下角水印文字(我的水印)，可使用 https://tool.chinaz.com/tools/unicode.aspx 中文转 Unicode，Linux 可能需要转 unicode</span></span>
<span class="line"><span>    interference-options: 0 # 滑动干扰项(0/1/2)</span></span>
<span class="line"><span>    req-frequency-limit-enable: false # 接口请求次数一分钟限制是否开启 true|false</span></span>
<span class="line"><span>    req-get-lock-limit: 5 # 验证失败 5 次，get接口锁定</span></span>
<span class="line"><span>    req-get-lock-seconds: 10 # 验证失败后，锁定时间间隔</span></span>
<span class="line"><span>    req-get-minute-limit: 30 # get 接口一分钟内请求数限制</span></span>
<span class="line"><span>    req-check-minute-limit: 60 # check 接口一分钟内请求数限制</span></span>
<span class="line"><span>    req-verify-minute-limit: 60 # verify 接口一分钟内请求数限制</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果你想修改验证码的 <strong>图片</strong>，修改 <a href="https://github.com/YunaiV/ruoyi-vue-pro/tree/master/yudao-module-system/yudao-module-system-biz/src/main/resources/images" target="_blank" rel="noopener noreferrer">resources/images</a> 目录即可。</p><p>③ 验证码的使用，可以参考 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/captcha/CaptchaController.java" target="_blank" rel="noopener noreferrer">CaptchaController</a> 和 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-module-system/yudao-module-system-biz/src/main/java/cn/iocoder/yudao/module/system/controller/admin/auth/AuthController.java#L61-L67" target="_blank" rel="noopener noreferrer">AuthController</a> 两个类的实现代码。</p><h3 id="_3-2-vue2-x-管理后台" tabindex="-1"><a class="header-anchor" href="#_3-2-vue2-x-管理后台"><span><a href="#_3-2-vue2-x-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 3.2 Vue2.X 管理后台</span></a></h3><p>① 验证码组件：<a href="https://github.com/yudaocode/yudao-ui-admin-vue2/blob/master/src/components/Verifition/" target="_blank" rel="noopener noreferrer">Verifition</a></p><p>② 登录界面的接入：<a href="https://github.com/yudaocode/yudao-ui-admin-vue2/blob/master/src/views/login.vue#L91-L93" target="_blank" rel="noopener noreferrer">login.vue</a></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>&lt;!-- 图形验证码 --&gt;</span></span>
<span class="line"><span>&lt;Verify ref=&quot;verify&quot; :captcha-type=&quot;&#39;blockPuzzle&#39;&quot; :img-size=&quot;{width:&#39;400px&#39;,height:&#39;200px&#39;}&quot;</span></span>
<span class="line"><span>        @success=&quot;handleLogin&quot; /&gt;</span></span></code></pre></div><h3 id="_3-3-vue3-x-管理后台" tabindex="-1"><a class="header-anchor" href="#_3-3-vue3-x-管理后台"><span><a href="#_3-3-vue3-x-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 3.3 Vue3.X 管理后台</span></a></h3><p>① 验证码组件：<a href="https://github.com/yudaocode/yudao-ui-admin-vue3/blob/master/src/components/Verifition/" target="_blank" rel="noopener noreferrer">Verifition</a></p><p>② 登录界面的接入：<a href="https://github.com/yudaocode/yudao-ui-admin-vue3/blob/master/src/views/Login/components/LoginForm.vue#L77-L83" target="_blank" rel="noopener noreferrer">LoginForm.vue</a></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>&lt;Verify</span></span>
<span class="line"><span>    ref=&quot;verify&quot;</span></span>
<span class="line"><span>    mode=&quot;pop&quot;</span></span>
<span class="line"><span>    :captchaType=&quot;captchaType&quot;</span></span>
<span class="line"><span>    :imgSize=&quot;{ width: &#39;400px&#39;, height: &#39;200px&#39; }&quot;</span></span>
<span class="line"><span>    @success=&quot;handleLogin&quot;</span></span>
<span class="line"><span>/&gt;</span></span></code></pre></div><h3 id="_3-4-uni-app-用户-app" tabindex="-1"><a class="header-anchor" href="#_3-4-uni-app-用户-app"><span><a href="#_3-4-uni-app-%E7%94%A8%E6%88%B7-app">#</a> 3.4 uni-app 用户 App</span></a></h3><p>① 验证码组件：<a href="https://github.com/yudaocode/yudao-ui-admin-uniapp/tree/master/components/verifition" target="_blank" rel="noopener noreferrer">verifition</a></p><p>② 登录界面的接入：<a href="https://github.com/yudaocode/yudao-ui-admin-uniapp/blob/master/pages/login.vue#L17-L18" target="_blank" rel="noopener noreferrer">login.vue</a></p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>&lt;Verify @success=&quot;pwdLogin&quot; :mode=&quot;&#39;pop&#39;&quot; :captchaType=&quot;&#39;blockPuzzle&#39;&quot;</span></span>
<span class="line"><span>        :imgSize=&quot;{ width: &#39;330px&#39;, height: &#39;155px&#39; }&quot; ref=&quot;verify&quot;&gt;&lt;/Verify&gt;</span></span></code></pre></div>`,35),r=[i];function t(p,l){return a(),n("div",null,r)}const d=e(o,[["render",t],["__file","captcha.html.vue"]]),u=JSON.parse('{"path":"/project/rouyi-vue-pro/captcha.html","title":"验证码","lang":"en-US","frontmatter":{"title":"验证码","tags":["project","java","spring-boot","spring-cloud"],"categories":["project"],"order":49,"feed":false,"seo":false,"head":[]},"headers":[{"level":2,"title":"# 1. 交互流程","slug":"_1-交互流程","link":"#_1-交互流程","children":[]},{"level":2,"title":"# 2. 如何关闭验证码","slug":"_2-如何关闭验证码","link":"#_2-如何关闭验证码","children":[]},{"level":2,"title":"# 3. 接入场景","slug":"_3-接入场景","link":"#_3-接入场景","children":[{"level":3,"title":"# 3.1 后端接入","slug":"_3-1-后端接入","link":"#_3-1-后端接入","children":[]},{"level":3,"title":"# 3.2 Vue2.X 管理后台","slug":"_3-2-vue2-x-管理后台","link":"#_3-2-vue2-x-管理后台","children":[]},{"level":3,"title":"# 3.3 Vue3.X 管理后台","slug":"_3-3-vue3-x-管理后台","link":"#_3-3-vue3-x-管理后台","children":[]},{"level":3,"title":"# 3.4 uni-app 用户 App","slug":"_3-4-uni-app-用户-app","link":"#_3-4-uni-app-用户-app","children":[]}]}],"git":{"createdTime":1720365235000,"updatedTime":1720365235000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":3.86,"words":1157},"filePathRelative":"project/rouyi-vue-pro/captcha.md","localizedDate":"July 7, 2024"}');export{d as comp,u as data};
