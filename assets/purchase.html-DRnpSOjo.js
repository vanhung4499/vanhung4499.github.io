import{_ as s,g as e,o as i,c as p,e as c,h as n,f as d,w as l,a as r}from"./app-BRTHG7K9.js";const o={},t=r('<h1 id="【采购】采购订单、入库、退货" tabindex="-1"><a class="header-anchor" href="#【采购】采购订单、入库、退货"><span>【采购】采购订单、入库、退货</span></a></h1><p>采购模块，由 <code>yudao-module-erp-biz</code> 后端模块的 <code>purchase</code> 包实现，主要有采购订单、采购入库、采购退货等功能。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/表关系.png" alt="表关系" tabindex="0" loading="lazy"><figcaption>表关系</figcaption></figure><p>它的整体流程，如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/整体流程.png" alt="整体流程" tabindex="0" loading="lazy"><figcaption>整体流程</figcaption></figure><h2 id="_1-供应商" tabindex="-1"><a class="header-anchor" href="#_1-供应商"><span><a href="#_1-%E4%BE%9B%E5%BA%94%E5%95%86">#</a> 1. 供应商</span></a></h2><p>供应商，由 ErpSupplierController 提供接口，所有采购都是针对供应商进行操作的。</p><h3 id="_1-1-表结构" tabindex="-1"><a class="header-anchor" href="#_1-1-表结构"><span><a href="#_1-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 1.1 表结构</span></a></h3><blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_supplier` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;供应商编号&#39;,</span></span>\n<span class="line"><span>  `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;供应商名称&#39;,</span></span>\n<span class="line"><span>  `contact` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;联系人&#39;,</span></span>\n<span class="line"><span>  `mobile` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;手机号码&#39;,</span></span>\n<span class="line"><span>  `telephone` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;联系电话&#39;,</span></span>\n<span class="line"><span>  `email` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;电子邮箱&#39;,</span></span>\n<span class="line"><span>  `fax` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;传真&#39;,</span></span>\n<span class="line"><span>  `remark` varchar(255) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  `status` tinyint NOT NULL COMMENT &#39;开启状态&#39;,</span></span>\n<span class="line"><span>  `sort` int NOT NULL COMMENT &#39;排序&#39;,</span></span>\n<span class="line"><span>  `tax_no` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;纳税人识别号&#39;,</span></span>\n<span class="line"><span>  `tax_percent` decimal(24,6) DEFAULT NULL COMMENT &#39;税率&#39;,</span></span>\n<span class="line"><span>  `bank_name` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;开户行&#39;,</span></span>\n<span class="line"><span>  `bank_account` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;开户账号&#39;,</span></span>\n<span class="line"><span>  `bank_address` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;开户地址&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id` DESC)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=&#39;ERP 供应商表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>都是一些信息字段，仅仅用于展示，没有什么特殊逻辑。</p><h3 id="_1-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_1-2-管理后台"><span><a href="#_1-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 1.2 管理后台</span></a></h3><p>对应 [ERP 系统 -&gt; 采购管理 -&gt; 供应商信息] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/erp/purchase/supplier</code> 目录。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/供应商信息.png" alt="供应商信息" tabindex="0" loading="lazy"><figcaption>供应商信息</figcaption></figure><h2 id="_2-采购订单" tabindex="-1"><a class="header-anchor" href="#_2-采购订单"><span><a href="#_2-%E9%87%87%E8%B4%AD%E8%AE%A2%E5%8D%95">#</a> 2. 采购订单</span></a></h2><p>采购订单，由 ErpPurchaseOrderController 提供接口，它不会直接影响库存，只有在入库、退货等操作才会影响库存。</p><h3 id="_2-1-表结构" tabindex="-1"><a class="header-anchor" href="#_2-1-表结构"><span><a href="#_2-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 2.1 表结构</span></a></h3><p><code>erp_purchase_order</code> 表和 <code>erp_purchase_order_items</code> 表，分别对应采购订单和采购订单项。</p><blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_purchase_order` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  `no` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;采购单编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `status` tinyint NOT NULL COMMENT &#39;采购状态&#39;,</span></span>\n<span class="line"><span>  `order_time` datetime NOT NULL COMMENT &#39;采购时间&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `supplier_id` bigint NOT NULL COMMENT &#39;供应商编号&#39;,</span></span>\n<span class="line"><span>  `account_id` bigint DEFAULT NULL COMMENT &#39;结算账户编号&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `total_count` decimal(24,6) NOT NULL COMMENT &#39;合计数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;合计价格，单位：元&#39;,</span></span>\n<span class="line"><span>  `total_product_price` decimal(24,6) NOT NULL COMMENT &#39;合计产品价格，单位：元&#39;,</span></span>\n<span class="line"><span>  `total_tax_price` decimal(24,6) NOT NULL COMMENT &#39;合计税额，单位：元&#39;,</span></span>\n<span class="line"><span>  `discount_percent` decimal(24,6) NOT NULL COMMENT &#39;优惠率，百分比&#39;,</span></span>\n<span class="line"><span>  `discount_price` decimal(24,6) NOT NULL COMMENT &#39;优惠金额，单位：元&#39;,</span></span>\n<span class="line"><span>  `deposit_price` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;定金金额，单位：元&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `file_url` varchar(512) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;附件地址&#39;,</span></span>\n<span class="line"><span>  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `in_count` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;采购入库数量&#39;,</span></span>\n<span class="line"><span>  `return_count` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;采购退货数量&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `no` (`no`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=16 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=&#39;ERP 采购订单表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>no</code>：采购单号，一般是系统自动生成的，目前格式是 <code>{prefix}{yyyyMMdd}{6 位自增}</code>。具体可见 ErpNoRedisDAO 类。</p><p>② <code>status</code>：采购状态，统一使用 ErpAuditStatus 枚举类，只有“未审批”、“已审批”两个状态。</p><p>③ <code>supplier_id</code>：供应商编号，关联到上面的 <code>erp_supplier</code> 表。</p><p><code>account_id</code>：结算账户编号，关联后续的 <code>erp_account</code> 表。暂时不用关注，它用于采购的付款。</p><p>④ <code>total_count</code>、<code>total_price</code>、<code>total_product_price</code>、<code>total_tax_price</code>、<code>discount_percent</code>、<code>discount_price</code> 和 <code>deposit_price</code>：合计数量、合计价格、合计产品价格、合计税额、优惠率、优惠金额和定金金额。</p><p>⑤ <code>in_count</code>：该采购订单已经入库的数量。一个订单可以被多次采购入库，但是不能超过最大的 <code>total_count</code>，所以需要记录已经入库的数量。</p><p>⑥ <code>return_count</code>：该采购订单已经退货的数量。一个订单可以被多次采购退货，但是不能超过最大的 <code>total_count</code>，所以需要记录已经退货的数量。</p><hr><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_purchase_order_items` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `order_id` bigint NOT NULL COMMENT &#39;采购订单编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `product_id` bigint NOT NULL COMMENT &#39;产品编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `product_unit_id` bigint NOT NULL COMMENT &#39;产品单位单位&#39;,</span></span>\n<span class="line"><span>  `product_price` decimal(24,6) NOT NULL COMMENT &#39;产品单价&#39;,</span></span>\n<span class="line"><span>  `count` decimal(24,6) NOT NULL COMMENT &#39;数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;总价&#39;,</span></span>\n<span class="line"><span>  `tax_percent` decimal(24,6) DEFAULT NULL COMMENT &#39;税率，百分比&#39;,</span></span>\n<span class="line"><span>  `tax_price` decimal(24,6) DEFAULT NULL COMMENT &#39;税额，单位：元&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `in_count` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;采购入库数量&#39;,</span></span>\n<span class="line"><span>  `return_count` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;采购退货数量&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  PRIMARY KEY (`id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT=&#39;ERP 采购订单项表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>order_id</code>：采购订单编号，关联到上面的 <code>erp_purchase_order</code> 表。</p><p>② <code>product_id</code>：产品编号。</p><p>注意，因为采购订单不直接涉及库存，所以它并没有 <code>warehouse_id</code> 字段，也就是说它不关心库存的具体仓库。</p><p>③ <code>product_unit_id</code>、<code>product_price</code>、<code>count</code>、<code>total_price</code>、<code>tax_percent</code> 和 <code>tax_price</code>：产品单位编号、产品单价、数量、总价、税率和税额。</p><p>其中 <code>total_price</code> 等于 <code>product_price * count + tax_price</code>。（额外多了税额）</p><p>④ <code>in_count</code> 和 <code>return_count</code>：同 <code>erp_purchase_order</code> 表，只是它表示的是该订单“项”的入库数量和退货数量，当然它也不能超过最大的 <code>count</code>。</p><h3 id="_2-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_2-2-管理后台"><span><a href="#_2-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 2.2 管理后台</span></a></h3><p>对应 [ERP 系统 -&gt; 采购管理 -&gt; 采购订单] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/erp/purchase/order</code> 目录。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/采购订单.png" alt="采购订单" tabindex="0" loading="lazy"><figcaption>采购订单</figcaption></figure><p>① 点击「新增」按钮，随便填写一些信息，点击「确认」按钮，即可新增一条采购订单。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/采购订单-新增.png" alt="新增采购订单" tabindex="0" loading="lazy"><figcaption>新增采购订单</figcaption></figure><p>② 点击该采购订单的「审批」按钮，审批通过该采购订单，此时状态会变成“已审批”，但是并不会影响库存。</p><h2 id="_3-采购入库" tabindex="-1"><a class="header-anchor" href="#_3-采购入库"><span><a href="#_3-%E9%87%87%E8%B4%AD%E5%85%A5%E5%BA%93">#</a> 3. 采购入库</span></a></h2><p>采购入库，由 ErpPurchaseInController 提供接口，它会影响（增加）库存。总的来说，它的逻辑和 <a href="/erp/stock-in-out">其它入库</a> 基本一致，只是它是针对采购的入库。</p><h3 id="_3-1-表结构" tabindex="-1"><a class="header-anchor" href="#_3-1-表结构"><span><a href="#_3-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 3.1 表结构</span></a></h3><p><code>erp_purchase_in</code> 表和 <code>erp_purchase_in_items</code> 表，分别对应采购入库和采购入库项。</p><blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_purchase_in` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  `no` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;采购入库编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `status` tinyint NOT NULL COMMENT &#39;采购状态&#39;,</span></span>\n<span class="line"><span>  `in_time` datetime NOT NULL COMMENT &#39;入库时间&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `supplier_id` bigint NOT NULL COMMENT &#39;供应商编号&#39;,</span></span>\n<span class="line"><span>  `account_id` bigint NOT NULL COMMENT &#39;结算账户编号&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `order_id` bigint NOT NULL COMMENT &#39;采购订单编号&#39;,</span></span>\n<span class="line"><span>  `order_no` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;采购订单号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `total_count` decimal(24,6) NOT NULL COMMENT &#39;合计数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;合计价格，单位：元&#39;,</span></span>\n<span class="line"><span>  `total_product_price` decimal(24,6) NOT NULL COMMENT &#39;合计产品价格，单位：元&#39;,</span></span>\n<span class="line"><span>  `total_tax_price` decimal(24,6) NOT NULL COMMENT &#39;合计税额，单位：元&#39;,</span></span>\n<span class="line"><span>  `discount_percent` decimal(24,6) NOT NULL COMMENT &#39;优惠率，百分比&#39;,</span></span>\n<span class="line"><span>  `discount_price` decimal(24,6) NOT NULL COMMENT &#39;优惠金额，单位：元&#39;,</span></span>\n<span class="line"><span>  `other_price` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;其它金额，单位：元&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `payment_price` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;已付款金额，单位：元&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `file_url` varchar(512) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;附件地址&#39;,</span></span>\n<span class="line"><span>  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `no` (`no`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=17 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=&#39;ERP 采购入库表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>no</code>：采购入库编号，一般是系统自动生成的，目前格式是 <code>{prefix}{yyyyMMdd}{6 位自增}</code>。具体可见 ErpNoRedisDAO 类。</p><p>② <code>status</code>：入库状态，统一使用 ErpAuditStatus 枚举类，只有“未审批”、“已审批”两个状态。</p><p>③ <code>supplier_id</code>：供应商编号，关联到上面的 <code>erp_supplier</code> 表。</p><p><code>account_id</code>：结算账户编号，关联后续的 <code>erp_account</code> 表。暂时不用关注，它用于采购的付款。</p><p>④ <code>order_id</code> 和 <code>order_no</code>：采购订单编号和采购订单号，关联到上面的 <code>erp_purchase_order</code> 表。</p><p>⑤ <code>total_count</code>、<code>total_price</code>、<code>total_product_price</code>、<code>total_tax_price</code>、<code>discount_percent</code>、<code>discount_price</code> 和 <code>other_price</code>：合计数量、合计价格、合计产品价格、合计税额、优惠率、优惠金额和其它金额。</p><p>其中，<code>total_price</code> 等于 <code>total_product_price + total_tax_price + other_price - discount_price</code>。</p><p>⑥ <code>payment_price</code>：已付款金额，单位：元。暂时不用关注，它用于采购的付款。</p><hr><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_purchase_in_items` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `in_id` bigint NOT NULL COMMENT &#39;采购入库编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `order_item_id` bigint NOT NULL COMMENT &#39;采购订单项编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `warehouse_id` bigint NOT NULL COMMENT &#39;仓库编号&#39;,</span></span>\n<span class="line"><span>  `product_id` bigint NOT NULL COMMENT &#39;产品编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `product_unit_id` bigint NOT NULL COMMENT &#39;产品单位单位&#39;,</span></span>\n<span class="line"><span>  `product_price` decimal(24,6) NOT NULL COMMENT &#39;产品单价&#39;,</span></span>\n<span class="line"><span>  `count` decimal(24,6) NOT NULL COMMENT &#39;数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;总价&#39;,</span></span>\n<span class="line"><span>  `tax_percent` decimal(24,6) DEFAULT NULL COMMENT &#39;税率，百分比&#39;,</span></span>\n<span class="line"><span>  `tax_price` decimal(24,6) DEFAULT NULL COMMENT &#39;税额，单位：元&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=30 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT=&#39;ERP 销售入库项表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>in_id</code>：采购入库编号，关联到上面的 <code>erp_purchase_in</code> 表。</p><p>② <code>order_item_id</code>：采购订单项编号，关联到上面的 <code>erp_purchase_order_items</code> 表，因为它需要对应的 <code>in_count</code> 字段。</p><p>③ <code>warehouse_id</code> 和 <code>product_id</code>：分别关联到仓库和产品，因为它涉及到库存变更。</p><p>④ <code>product_unit_id</code>、<code>product_price</code>、<code>count</code>、<code>total_price</code>、<code>tax_percent</code> 和 <code>tax_price</code>：产品单位编号、产品单价、数量、总价、税率和税额。</p><p>其中 <code>total_price</code> 等于 <code>product_price * count + tax_price</code>。（额外多了税额）</p><h3 id="_3-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_3-2-管理后台"><span><a href="#_3-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 3.2 管理后台</span></a></h3><p>对应 [ERP 系统 -&gt; 采购管理 -&gt; 采购入库] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/erp/purchase/in</code> 目录。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/采购入库.png" alt="采购入库" tabindex="0" loading="lazy"><figcaption>采购入库</figcaption></figure><p>① 点击「新增」按钮，随便填写一些信息，点击「确认」按钮，即可新增一条采购入库。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/采购入库-新增.png" alt="新增采购入库" tabindex="0" loading="lazy"><figcaption>新增采购入库</figcaption></figure><p>② 点击该采购入库的「审批」按钮，审批通过该采购入库，此时状态会变成“已审批”，同时会增加对应的库存、新增库存明细。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/采购入库-审批.png" alt="审批采购入库" tabindex="0" loading="lazy"><figcaption>审批采购入库</figcaption></figure><p>③ 点击该采购入库的「反审批」按钮，反审批该采购入库，此时状态会变成“未审批”，同时会减少对应的库存、新增库存明细。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/采购入库-反审批.png" alt="反审批采购入库" tabindex="0" loading="lazy"><figcaption>反审批采购入库</figcaption></figure><h2 id="_4-采购退货" tabindex="-1"><a class="header-anchor" href="#_4-采购退货"><span><a href="#_4-%E9%87%87%E8%B4%AD%E9%80%80%E8%B4%A7">#</a> 4. 采购退货</span></a></h2><p>采购退货，由 ErpPurchaseReturnController 提供接口，它会影响（减少）库存。总的来说，它的逻辑和 <a href="/erp/stock-in-out">其它出库</a> 基本一致，只是它是针对采购的出库。</p><h3 id="_4-1-表结构" tabindex="-1"><a class="header-anchor" href="#_4-1-表结构"><span><a href="#_4-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 4.1 表结构</span></a></h3><p>友情提示：采购退货相关的表，和采购入库相关的表结构基本一致。</p><p><code>erp_purchase_return</code> 表和 <code>erp_purchase_return_items</code> 表，分别对应采购退货和采购退货项。</p><blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_purchase_return` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  `no` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;采购退货编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `status` tinyint NOT NULL COMMENT &#39;退货状态&#39;,</span></span>\n<span class="line"><span>  `return_time` datetime NOT NULL COMMENT &#39;退货时间&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `supplier_id` bigint NOT NULL COMMENT &#39;供应商编号&#39;,</span></span>\n<span class="line"><span>  `account_id` bigint NOT NULL COMMENT &#39;结算账户编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `order_id` bigint NOT NULL COMMENT &#39;采购订单编号&#39;,</span></span>\n<span class="line"><span>  `order_no` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;采购订单号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `total_count` decimal(24,6) NOT NULL COMMENT &#39;合计数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;合计价格，单位：元&#39;,</span></span>\n<span class="line"><span>  `total_product_price` decimal(24,6) NOT NULL COMMENT &#39;合计产品价格，单位：元&#39;,</span></span>\n<span class="line"><span>  `total_tax_price` decimal(24,6) NOT NULL COMMENT &#39;合计税额，单位：元&#39;,</span></span>\n<span class="line"><span>  `discount_percent` decimal(24,6) NOT NULL COMMENT &#39;优惠率，百分比&#39;,</span></span>\n<span class="line"><span>  `discount_price` decimal(24,6) NOT NULL COMMENT &#39;优惠金额，单位：元&#39;,</span></span>\n<span class="line"><span>  `other_price` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;其它金额，单位：元&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `refund_price` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;已退款金额，单位：元&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `file_url` varchar(512) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;附件地址&#39;,</span></span>\n<span class="line"><span>  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `no` (`no`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=25 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=&#39;ERP 采购退货表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>no</code>：采购退货编号，一般是系统自动生成的，目前格式是 <code>{prefix}{yyyyMMdd}{6 位自增}</code>。具体可见 ErpNoRedisDAO 类。</p><p>② <code>status</code>：退货状态，统一使用 ErpAuditStatus 枚举类，只有“未审批”、“已审批”两个状态。</p><p>③ <code>supplier_id</code>：供应商编号，关联到上面的 <code>erp_supplier</code> 表。</p><p><code>account_id</code>：结算账户编号，关联后续的 <code>erp_account</code> 表。暂时不用关注，它用于采购的付款。</p><p>④ <code>order_id</code> 和 <code>order_no</code>：采购订单编号和采购订单号，关联到上面的 <code>erp_purchase_order</code> 表。</p><p>疑问：采购退货，为什么不是针对采购入库进行退货，而是针对采购订单进行退货呢？</p><p>确实是有 ERP 是针对采购入库进行退货的，不过相对比较少。和一些做 ERP 的朋友交流过，他们的倾向于基于采购订单进行退货。</p><p>⑤ <code>total_count</code>、<code>total_price</code>、<code>total_product_price</code>、<code>total_tax_price</code>、<code>discount_percent</code>、<code>discount_price</code> 和 <code>other_price</code>：合计数量、合计价格、合计产品价格、合计税额、优惠率、优惠金额和其它金额。</p><p>其中，<code>total_price</code> 等于 <code>total_product_price + total_tax_price + other_price - discount_price</code>。</p><p>【差异】⑥ <code>refund_price</code>：已退款金额，单位：元。暂时不用关注，它用于采购的付款。</p><hr><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_purchase_return_items` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `return_id` bigint NOT NULL COMMENT &#39;采购退货编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `order_item_id` bigint NOT NULL COMMENT &#39;采购订单项编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `warehouse_id` bigint NOT NULL COMMENT &#39;仓库编号&#39;,</span></span>\n<span class="line"><span>  `product_id` bigint NOT NULL COMMENT &#39;产品编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `product_unit_id` bigint NOT NULL COMMENT &#39;产品单位单位&#39;,</span></span>\n<span class="line"><span>  `product_price` decimal(24,6) NOT NULL COMMENT &#39;产品单价&#39;,</span></span>\n<span class="line"><span>  `count` decimal(24,6) NOT NULL COMMENT &#39;数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;总价&#39;,</span></span>\n<span class="line"><span>  `tax_percent` decimal(24,6) DEFAULT NULL COMMENT &#39;税率，百分比&#39;,</span></span>\n<span class="line"><span>  `tax_price` decimal(24,6) DEFAULT NULL COMMENT &#39;税额，单位：元&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=45 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT=&#39;ERP 采购退货项表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>return_id</code>：采购退货编号，关联到上面的 <code>erp_purchase_return</code> 表。</p><p>② <code>order_item_id</code>：采购订单项编号，关联到上面的 <code>erp_purchase_order_items</code> 表，因为它需要对应的 <code>return_count</code> 字段。</p><p>③ <code>warehouse_id</code> 和 <code>product_id</code>：分别关联到仓库和产品，因为它涉及到库存变更。</p><p>④ <code>product_unit_id</code>、<code>product_price</code>、<code>count</code>、<code>total_price</code>、<code>tax_percent</code> 和 <code>tax_price</code>：产品单位编号、产品单价、数量、总价、税率和税额。</p><p>其中 <code>total_price</code> 等于 <code>product_price * count + tax_price</code>。（额外多了税额）</p><h3 id="_4-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_4-2-管理后台"><span><a href="#_4-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 4.2 管理后台</span></a></h3><p>对应 [ERP 系统 -&gt; 采购管理 -&gt; 采购退货] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/erp/purchase/return</code> 目录。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/采购退货.png" alt="采购退货" tabindex="0" loading="lazy"><figcaption>采购退货</figcaption></figure><p>① 点击「新增」按钮，随便填写一些信息，点击「确认」按钮，即可新增一条采购退货。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/采购退货-新增.png" alt="新增采购退货" tabindex="0" loading="lazy"><figcaption>新增采购退货</figcaption></figure><p>② 点击该采购退货的「审批」按钮，审批通过该采购退货，此时状态会变成“已审批”，同时会减少对应的库存、新增库存明细。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/采购退货-审批.png" alt="审批采购退货" tabindex="0" loading="lazy"><figcaption>审批采购退货</figcaption></figure><p>③ 点击该采购退货的「反审批」按钮，反审批该采购退货，此时状态会变成“未审批”，同时会增加对应的库存、新增库存明细。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/采购模块/采购退货-反审批.png" alt="反审批采购退货" tabindex="0" loading="lazy"><figcaption>反审批采购退货</figcaption></figure><h2 id="_5-采购付款" tabindex="-1"><a class="header-anchor" href="#_5-采购付款"><span><a href="#_5-%E9%87%87%E8%B4%AD%E4%BB%98%E6%AC%BE">#</a> 5. 采购付款</span></a></h2>',105);function u(_,E){const a=e("RouteLink");return i(),p("div",null,[t,c("p",null,[n("参见 "),d(a,{to:"/erp/finance-payment-receipt/"},{default:l(()=>[n("《【财务】采购付款、销售收款》")]),_:1}),n(" 文档。")])])}const m=s(o,[["render",u],["__file","purchase.html.vue"]]),b=JSON.parse('{"path":"/project/rouyi-vue-pro/erp/purchase.html","title":"【采购】采购订单、入库、退货","lang":"en-US","frontmatter":{"title":"【采购】采购订单、入库、退货","tags":["project","java","spring-boot","spring-cloud"],"categories":["project"],"order":115,"feed":false,"seo":false,"head":[]},"headers":[{"level":2,"title":"# 1. 供应商","slug":"_1-供应商","link":"#_1-供应商","children":[{"level":3,"title":"# 1.1 表结构","slug":"_1-1-表结构","link":"#_1-1-表结构","children":[]},{"level":3,"title":"# 1.2 管理后台","slug":"_1-2-管理后台","link":"#_1-2-管理后台","children":[]}]},{"level":2,"title":"# 2. 采购订单","slug":"_2-采购订单","link":"#_2-采购订单","children":[{"level":3,"title":"# 2.1 表结构","slug":"_2-1-表结构","link":"#_2-1-表结构","children":[]},{"level":3,"title":"# 2.2 管理后台","slug":"_2-2-管理后台","link":"#_2-2-管理后台","children":[]}]},{"level":2,"title":"# 3. 采购入库","slug":"_3-采购入库","link":"#_3-采购入库","children":[{"level":3,"title":"# 3.1 表结构","slug":"_3-1-表结构","link":"#_3-1-表结构","children":[]},{"level":3,"title":"# 3.2 管理后台","slug":"_3-2-管理后台","link":"#_3-2-管理后台","children":[]}]},{"level":2,"title":"# 4. 采购退货","slug":"_4-采购退货","link":"#_4-采购退货","children":[{"level":3,"title":"# 4.1 表结构","slug":"_4-1-表结构","link":"#_4-1-表结构","children":[]},{"level":3,"title":"# 4.2 管理后台","slug":"_4-2-管理后台","link":"#_4-2-管理后台","children":[]}]},{"level":2,"title":"# 5. 采购付款","slug":"_5-采购付款","link":"#_5-采购付款","children":[]}],"git":{"createdTime":1720365235000,"updatedTime":1720365235000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":13.37,"words":4012},"filePathRelative":"project/rouyi-vue-pro/erp/purchase.md","localizedDate":"July 7, 2024"}');export{m as comp,b as data};
