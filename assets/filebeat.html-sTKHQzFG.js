import{_ as a,o as n,c as s,a as t}from"./app-B9pwkC50.js";const e={},i=t(`<h1 id="elastic-stack-va-filebeat" tabindex="-1"><a class="header-anchor" href="#elastic-stack-va-filebeat"><span>Elastic Stack và Filebeat</span></a></h1><h2 id="gioi-thieu" tabindex="-1"><a class="header-anchor" href="#gioi-thieu"><span>Giới thiệu</span></a></h2><p>Beats là các đại lý truyền dữ liệu được cài đặt trên máy chủ.</p><p>Beats có thể truyền dữ liệu trực tiếp đến Elasticsearch hoặc đến Logstash.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/beats-platform.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>Beats có nhiều loại, bạn có thể chọn loại phù hợp với nhu cầu thực tế của bạn.</p><p>Các loại phổ biến bao gồm:</p><ul><li><strong>Packetbeat:</strong> Trình phân tích gói dữ liệu mạng, cung cấp thông tin về các giao dịch được trao đổi giữa các máy chủ ứng dụng của bạn.</li><li><strong>Filebeat:</strong> Gửi các tệp nhật ký từ máy chủ của bạn.</li><li><strong>Metricbeat:</strong> Là một đại lý giám sát máy chủ, thu thập định kỳ các chỉ số từ hệ điều hành và dịch vụ đang chạy trên máy chủ.</li><li><strong>Winlogbeat:</strong> Cung cấp nhật ký sự kiện Windows.</li></ul><blockquote><p><strong>Tham khảo</strong></p><p>Các loại Beats khác có thể tham khảo tại: <a href="https://www.elastic.co/guide/en/beats/libbeat/current/community-beats.html" target="_blank" rel="noopener noreferrer">community-beats</a></p><p><strong>Chú ý</strong></p><p>Vì tôi chỉ sử dụng FileBeat trong công việc, nên nội dung sau chỉ giới thiệu về FileBeat.</p></blockquote><h3 id="filebeat-co-tac-dung-gi" tabindex="-1"><a class="header-anchor" href="#filebeat-co-tac-dung-gi"><span>FileBeat có tác dụng gì?</span></a></h3><p>So với Logstash, FileBeat nhẹ nhàng hơn.</p><p>Trong bất kỳ môi trường nào, ứng dụng đều có khả năng bị tắt. Filebeat đọc và chuyển tiếp các dòng nhật ký, nếu bị gián đoạn, nó sẽ nhớ tất cả các sự kiện ở vị trí khi trạng thái trực tuyến được khôi phục.</p><p>Filebeat có các mô-đun nội bộ (auditd, Apache, Nginx, System và MySQL) để đơn giản hóa việc thu thập, phân tích và trực quan hóa định dạng nhật ký phổ biến.</p><p>FileBeat không làm quá tải ống dẫn của bạn. Nếu FileBeat truyền dữ liệu đến Logstash, khi Logstash bận xử lý dữ liệu, nó sẽ thông báo cho FileBeat làm chậm tốc độ đọc. Khi tình trạng tắc nghẽn được giải quyết, FileBeat sẽ trở lại tốc độ ban đầu và tiếp tục truyền dữ liệu.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/filebeat.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h2 id="cai-đat" tabindex="-1"><a class="header-anchor" href="#cai-đat"><span>Cài đặt</span></a></h2><p>Đối với hệ thống Unix / Linux, bạn nên cài đặt theo cách sau vì nó khá phổ biến.</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wget</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://artifacts.elastic.co/downloads/beats/filebeat/filebeat-6.1.1-linux-x86_64.tar.gz</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">tar</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -zxf</span><span style="color:#98C379;--shiki-dark:#98C379;"> filebeat-6.1.1-linux-x86_64.tar.gz</span></span></code></pre></div><blockquote><p><strong>Tham khảo</strong></p><p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-installation.html" target="_blank" rel="noopener noreferrer">filebeat-installation</a></p></blockquote><h2 id="cau-hinh" tabindex="-1"><a class="header-anchor" href="#cau-hinh"><span>Cấu hình</span></a></h2><h3 id="tep-cau-hinh" tabindex="-1"><a class="header-anchor" href="#tep-cau-hinh"><span>Tệp cấu hình</span></a></h3><p>Đầu tiên, điều cần biết là: <code>filebeat.yml</code> là tệp cấu hình của Filebeat. Đường dẫn của tệp cấu hình có thể thay đổi tùy thuộc vào cách bạn cài đặt.</p><p>Tất cả các sản phẩm trong loạt Beat đều dựa trên định dạng cấu hình <a href="http://www.yaml.org/" target="_blank" rel="noopener noreferrer">YAML</a>, và FileBeat cũng không phải là ngoại lệ.</p><p>Ví dụ về một phần cấu hình filebeat.yml:</p><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">filebeat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        - </span><span style="color:#98C379;--shiki-dark:#98C379;">/var/log/*.log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      multiline</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        pattern</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;^[&#39;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        match</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">after</span></span></code></pre></div><blockquote><p><strong>Tham khảo</strong></p><p>Để biết thêm về cấu hình Filebeat, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuring-howto-filebeat.html" target="_blank" rel="noopener noreferrer">Cấu hình Filebeat</a></p><p>Để biết thêm về định dạng tệp filebeat.yml, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/libbeat/6.1/config-file-format.html" target="_blank" rel="noopener noreferrer">Định dạng tệp filebeat.yml</a></p></blockquote><h3 id="cac-muc-cau-hinh-quan-trong" tabindex="-1"><a class="header-anchor" href="#cac-muc-cau-hinh-quan-trong"><span>Các mục cấu hình quan trọng</span></a></h3><h4 id="filebeat-prospectors" tabindex="-1"><a class="header-anchor" href="#filebeat-prospectors"><span>filebeat.prospectors</span></a></h4><p>(Trình theo dõi tệp) được sử dụng để chỉ định các tệp cần quan tâm.</p><p><strong>Ví dụ</strong></p><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">filebeat.prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    enabled</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#98C379;--shiki-dark:#98C379;">/var/log/*.log</span></span></code></pre></div><h4 id="output-elasticsearch" tabindex="-1"><a class="header-anchor" href="#output-elasticsearch"><span>output.elasticsearch</span></a></h4><p>Nếu bạn muốn Filebeat trực tiếp xuất dữ liệu đến Elasticsearch, bạn cần cấu hình output.elasticsearch.</p><p><strong>Ví dụ</strong></p><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">output.elasticsearch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;192.168.1.42:9200&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span></code></pre></div><h4 id="output-logstash" tabindex="-1"><a class="header-anchor" href="#output-logstash"><span>output.logstash</span></a></h4><p>Nếu bạn muốn Filebeat xuất dữ liệu đến Logstash, sau đó Logstash sẽ xuất dữ liệu đến Elasticsearch, bạn cần cấu hình output.logstash.</p><blockquote><p><strong>Lưu ý</strong></p><p>So với xuất dữ liệu đến Elasticsearch, tôi khuyên bạn nên xuất dữ liệu đến Logstash.</p><p>Bởi vì khi Logstash và Filebeat làm việc cùng nhau, nếu Logstash bận xử lý dữ liệu, nó sẽ thông báo cho FileBeat làm chậm tốc độ đọc. Một khi tình trạng tắc nghẽn được giải quyết, FileBeat sẽ trở lại tốc độ ban đầu và tiếp tục truyền dữ liệu. Như vậy, có thể giảm bớt tình trạng quá tải ống dẫn.</p></blockquote><p><strong>Ví dụ</strong></p><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">output.logstash</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;127.0.0.1:5044&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span></code></pre></div><p>Ngoài ra, bạn cũng cần chỉ định plugin đầu vào beats trong tệp cấu hình Logstash (như logstash.conf):</p><div class="language-yaml line-numbers-mode" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">input {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  beats {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    port =&gt; 5044</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> # Cổng này cần phải giống với cổng trong filebeat.yml</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Phần filter của tệp này được bình luận để chỉ ra rằng nó là</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># tùy chọn.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># filter {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">#</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">output {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">  elasticsearch {</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    hosts =&gt; &quot;localhost:9200&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    manage_template =&gt; false</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    index =&gt; &quot;%{[@metadata][beat]}-%{[@metadata][version]}-%{+YYYY.MM.dd}&quot;</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">    document_type =&gt; &quot;%{[@metadata][type]}&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="setup-kibana" tabindex="-1"><a class="header-anchor" href="#setup-kibana"><span>setup.kibana</span></a></h4><p>Nếu bạn dự định sử dụng bảng điều khiển Kibana do Filebeat cung cấp, bạn cần cấu hình setup.kibana.</p><p><strong>Ví dụ</strong></p><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">setup.kibana</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;localhost:5601&#39;</span></span></code></pre></div><h4 id="setup-template-settings" tabindex="-1"><a class="header-anchor" href="#setup-template-settings"><span>setup.template.settings</span></a></h4><p>Trong Elasticsearch, <a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.1/indices-templates.html" target="_blank" rel="noopener noreferrer">mẫu chỉ mục</a> được sử dụng để định nghĩa cài đặt và ánh xạ, để xác định cách phân tích các trường.</p><p>Trong Filebeat, setup.template.settings được sử dụng để cấu hình mẫu chỉ mục.</p><p>Filebeat gợi ý mẫu chỉ mục được cài đặt bởi gói phần mềm Filebeat. Nếu bạn chấp nhận cấu hình mặc định trong tệp cấu hình filebeat.yml, Filebeat tự động tải mẫu sau khi kết nối thành công với Elasticsearch.</p><p>Bạn có thể vô hiệu hóa tải mẫu tự động hoặc tải mẫu của riêng bạn bằng cách cấu hình các tùy chọn tải mẫu trong tệp cấu hình Filebeat. Bạn cũng có thể đặt tùy chọn để thay đổi tên chỉ mục và mẫu chỉ mục.</p><blockquote><p><strong>Tham khảo</strong></p><p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-template.html" target="_blank" rel="noopener noreferrer">filebeat-template</a></p><p><strong>Chú ý</strong></p><p>Nếu không cần thiết, hãy sử dụng mẫu chỉ mục mặc định trong tệp cấu hình Filebeat.</p></blockquote><h4 id="setup-dashboards" tabindex="-1"><a class="header-anchor" href="#setup-dashboards"><span>setup.dashboards</span></a></h4><p>Filebeat đi kèm với các bảng điều khiển Kibana mẫu. Trước khi sử dụng bảng điều khiển, bạn cần tạo mẫu chỉ mục <code>filebeat-*</code> và tải bảng điều khiển vào Kibana. Để làm điều này, bạn có thể chạy lệnh <code>setup</code> hoặc cấu hình tải bảng điều khiển trong tệp <code>filebeat.yml</code>.</p><p>Để tải bảng điều khiển Filebeat vào Kibana, bạn cần bật chức năng trong cấu hình <code>filebeat.yml</code>:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>setup.dashboards.enabled: true</span></span></code></pre></div><blockquote><p><strong>Tham khảo</strong></p><p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-dashboards.html" target="_blank" rel="noopener noreferrer">configuration-dashboards</a></p></blockquote><h2 id="lenh" tabindex="-1"><a class="header-anchor" href="#lenh"><span>Lệnh</span></a></h2><p>Filebeat cung cấp một loạt các lệnh để hoàn thành nhiều chức năng.</p><p>Cách thực hiện lệnh:</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">./filebeat</span><span style="color:#98C379;--shiki-dark:#98C379;"> COMMAND</span></span></code></pre></div><blockquote><p><strong>Tham khảo</strong></p><p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/command-line-options.html" target="_blank" rel="noopener noreferrer">command-line-options</a></p><p><strong>Chú ý</strong></p><p>Theo quan điểm cá nhân, không cần phải nắm bắt tất cả các lệnh, bởi vì hầu hết các chức năng đều có thể được hoàn thành thông qua cấu hình. Hơn nữa, việc chỉ định chức năng thông qua dòng lệnh đòi hỏi phải nhập cùng một tham số mỗi lần, điều này không thuận lợi cho việc khởi động cố định.</p><p>Quan trọng nhất, tất nhiên, là lệnh khởi động run.</p><p><strong>Ví dụ</strong> Khởi động bằng cách chỉ định tệp cấu hình</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">./filebeat</span><span style="color:#98C379;--shiki-dark:#98C379;"> run</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -e</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -c</span><span style="color:#98C379;--shiki-dark:#98C379;"> filebeat.yml</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -d</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;publish&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">./filebeat</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -e</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -c</span><span style="color:#98C379;--shiki-dark:#98C379;"> filebeat.yml</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -d</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;publish&quot;</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> # run có thể bỏ qua</span></span></code></pre></div></blockquote><h2 id="module" tabindex="-1"><a class="header-anchor" href="#module"><span>Module</span></a></h2><p>Filebeat cung cấp một bộ module được xây dựng sẵn, cho phép bạn triển khai giải pháp giám sát log nhanh chóng và đi kèm với các bảng điều khiển mẫu và trực quan hóa dữ liệu. Những module này hỗ trợ các định dạng log phổ biến như Nginx, Apache2 và MySQL, v.v.</p><h3 id="cac-buoc-đe-chay-module" tabindex="-1"><a class="header-anchor" href="#cac-buoc-đe-chay-module"><span>Các bước để chạy module</span></a></h3><ul><li>Cấu hình elasticsearch và kibana</li></ul><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>output.elasticsearch:</span></span>
<span class="line"><span>  hosts: [&quot;myEShost:9200&quot;]</span></span>
<span class="line"><span>  username: &quot;elastic&quot;</span></span>
<span class="line"><span>  password: &quot;elastic&quot;</span></span>
<span class="line"><span>setup.kibana:</span></span>
<span class="line"><span>  host: &quot;mykibanahost:5601&quot;</span></span>
<span class="line"><span>  username: &quot;elastic&quot;</span></span>
<span class="line"><span>  password: &quot;elastic</span></span></code></pre></div><blockquote><p>username và password là tùy chọn, nếu không cần xác thực thì không cần điền.</p></blockquote><ul><li>Khởi tạo môi trường</li></ul><p>Chạy lệnh dưới đây, Filebeat sẽ tải mẫu chỉ mục được gợi ý.</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>./filebeat setup -e</span></span></code></pre></div><ul><li>Chỉ định module</li></ul><p>Chạy lệnh dưới đây, chỉ định module bạn muốn tải.</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>./filebeat -e --modules system,nginx,mysql</span></span></code></pre></div><blockquote><p><strong>Tham khảo</strong></p><p>Để biết thêm thông tin, bạn có thể tham khảo: <a href="https://www.elastic.co/guide/en/beats/filebeat/current/configuration-filebeat-modules.html" target="_blank" rel="noopener noreferrer">Cấu hình module Filebeat</a> | <a href="https://www.elastic.co/guide/en/beats/filebeat/current/filebeat-modules.html" target="_blank" rel="noopener noreferrer">Module được hỗ trợ bởi Filebeat</a></p></blockquote><h2 id="nguyen-ly" tabindex="-1"><a class="header-anchor" href="#nguyen-ly"><span>Nguyên lý</span></a></h2><p>Filebeat có hai thành phần chính:</p><p>harvester: chịu trách nhiệm đọc nội dung của một tệp. Nó sẽ đọc từng dòng nội dung của tệp và gửi nội dung đến đích xuất.</p><p>prospector: chịu trách nhiệm quản lý harvester và tìm tất cả các nguồn tệp cần đọc. Ví dụ, nếu kiểu là log, prospector sẽ duyệt qua tất cả các tệp phù hợp với yêu cầu trong đường dẫn đã chỉ định.</p><div class="language-yaml" data-ext="yaml" data-title="yaml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">filebeat.prospectors</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  - </span><span style="color:#E06C75;--shiki-dark:#E06C75;">type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">log</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    paths</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#98C379;--shiki-dark:#98C379;">/var/log/*.log</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">      - </span><span style="color:#98C379;--shiki-dark:#98C379;">/var/path2/*.log</span></span></code></pre></div><p>Filebeat giữ trạng thái của mỗi tệp và thường xuyên làm mới trạng thái đĩa trong tệp đăng ký. Trạng thái được sử dụng để nhớ vị trí cuối cùng mà harvester đang đọc và đảm bảo tất cả các dòng log được gửi đi.</p><p>Filebeat lưu trạng thái gửi của mỗi sự kiện trong tệp đăng ký. Vì vậy, nó có thể đảm bảo rằng sự kiện được gửi ít nhất một lần đến đầu ra được cấu hình, không có dữ liệu bị mất.</p><h2 id="tai-lieu" tabindex="-1"><a class="header-anchor" href="#tai-lieu"><span>Tài liệu</span></a></h2><p><a href="https://www.elastic.co/guide/en/beats/libbeat/current/index.html" target="_blank" rel="noopener noreferrer">Tài liệu chính thức của Beats</a></p>`,84),l=[i];function c(o,r){return n(),s("div",null,l)}const p=a(e,[["render",c],["__file","filebeat.html.vue"]]),d=JSON.parse('{"path":"/database/elastic/filebeat.html","title":"Filebeat","lang":"en-US","frontmatter":{"title":"Filebeat","icon":"vscode-icons:file-type-elastic","tags":["elastic","filebeat"],"categories":["elastic"],"date created":"2024-02-24T00:00:00.000Z","date modified":"2024-02-24T00:00:00.000Z","order":2,"description":"Elastic Stack và Filebeat Giới thiệu Beats là các đại lý truyền dữ liệu được cài đặt trên máy chủ. Beats có thể truyền dữ liệu trực tiếp đến Elasticsearch hoặc đến Logstash. img...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/database/elastic/filebeat.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"Filebeat"}],["meta",{"property":"og:description","content":"Elastic Stack và Filebeat Giới thiệu Beats là các đại lý truyền dữ liệu được cài đặt trên máy chủ. Beats có thể truyền dữ liệu trực tiếp đến Elasticsearch hoặc đến Logstash. img..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/vanhung4499/images/master/snap/beats-platform.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-28T15:54:38.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"elastic"}],["meta",{"property":"article:tag","content":"filebeat"}],["meta",{"property":"article:modified_time","content":"2024-06-28T15:54:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Filebeat\\",\\"image\\":[\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/beats-platform.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/filebeat.png\\"],\\"dateModified\\":\\"2024-06-28T15:54:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Giới thiệu","slug":"gioi-thieu","link":"#gioi-thieu","children":[{"level":3,"title":"FileBeat có tác dụng gì?","slug":"filebeat-co-tac-dung-gi","link":"#filebeat-co-tac-dung-gi","children":[]}]},{"level":2,"title":"Cài đặt","slug":"cai-đat","link":"#cai-đat","children":[]},{"level":2,"title":"Cấu hình","slug":"cau-hinh","link":"#cau-hinh","children":[{"level":3,"title":"Tệp cấu hình","slug":"tep-cau-hinh","link":"#tep-cau-hinh","children":[]},{"level":3,"title":"Các mục cấu hình quan trọng","slug":"cac-muc-cau-hinh-quan-trong","link":"#cac-muc-cau-hinh-quan-trong","children":[]}]},{"level":2,"title":"Lệnh","slug":"lenh","link":"#lenh","children":[]},{"level":2,"title":"Module","slug":"module","link":"#module","children":[{"level":3,"title":"Các bước để chạy module","slug":"cac-buoc-đe-chay-module","link":"#cac-buoc-đe-chay-module","children":[]}]},{"level":2,"title":"Nguyên lý","slug":"nguyen-ly","link":"#nguyen-ly","children":[]},{"level":2,"title":"Tài liệu","slug":"tai-lieu","link":"#tai-lieu","children":[]}],"git":{"createdTime":1719590078000,"updatedTime":1719590078000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":7.02,"words":2106},"filePathRelative":"database/elastic/filebeat.md","localizedDate":"June 28, 2024","excerpt":"\\n<h2>Giới thiệu</h2>\\n<p>Beats là các đại lý truyền dữ liệu được cài đặt trên máy chủ.</p>\\n<p>Beats có thể truyền dữ liệu trực tiếp đến Elasticsearch hoặc đến Logstash.</p>\\n<figure><img src=\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/beats-platform.png\\" alt=\\"img\\" tabindex=\\"0\\" loading=\\"lazy\\"><figcaption>img</figcaption></figure>","autoDesc":true}');export{p as comp,d as data};
