import{_ as s,g as e,o as i,c,e as p,h as n,f as d,w as l,a as r}from"./app-BRTHG7K9.js";const o={},t=r('<h1 id="【销售】销售订单、出库、退货" tabindex="-1"><a class="header-anchor" href="#【销售】销售订单、出库、退货"><span>【销售】销售订单、出库、退货</span></a></h1><p>友情提示：“销售”和“采购”目前是基本一致的，只是“销售”是向“客户”卖，“采购”是从“供应商”买。</p><p>销售模块，由 <code>yudao-module-erp-biz</code> 后端模块的 <code>sale</code> 包实现，主要有销售订单、销售出库、销售退货等功能。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/表关系.png" alt="表关系" tabindex="0" loading="lazy"><figcaption>表关系</figcaption></figure><p>它的整体流程，如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/整体流程.png" alt="整体流程" tabindex="0" loading="lazy"><figcaption>整体流程</figcaption></figure><h2 id="_1-客户" tabindex="-1"><a class="header-anchor" href="#_1-客户"><span><a href="#_1-%E5%AE%A2%E6%88%B7">#</a> 1. 客户</span></a></h2><p>客户，由 ErpCustomerController 提供接口，所有销售都是针对客户进行操作的。</p><h3 id="_1-1-表结构" tabindex="-1"><a class="header-anchor" href="#_1-1-表结构"><span><a href="#_1-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 1.1 表结构</span></a></h3><blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_customer` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;客户编号&#39;,</span></span>\n<span class="line"><span>  `name` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;客户名称&#39;,</span></span>\n<span class="line"><span>  `contact` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;联系人&#39;,</span></span>\n<span class="line"><span>  `mobile` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;手机号码&#39;,</span></span>\n<span class="line"><span>  `telephone` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;联系电话&#39;,</span></span>\n<span class="line"><span>  `email` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;电子邮箱&#39;,</span></span>\n<span class="line"><span>  `fax` varchar(30) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;传真&#39;,</span></span>\n<span class="line"><span>  `remark` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  `status` tinyint NOT NULL COMMENT &#39;开启状态&#39;,</span></span>\n<span class="line"><span>  `sort` int NOT NULL COMMENT &#39;排序&#39;,</span></span>\n<span class="line"><span>  `tax_no` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;纳税人识别号&#39;,</span></span>\n<span class="line"><span>  `tax_percent` decimal(24,6) DEFAULT NULL COMMENT &#39;税率&#39;,</span></span>\n<span class="line"><span>  `bank_name` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;开户行&#39;,</span></span>\n<span class="line"><span>  `bank_account` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;开户账号&#39;,</span></span>\n<span class="line"><span>  `bank_address` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;开户地址&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id` DESC)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=3 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=&#39;ERP 客户表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>都是一些信息字段，仅仅用于展示，没有什么特殊逻辑。</p><h3 id="_1-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_1-2-管理后台"><span><a href="#_1-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 1.2 管理后台</span></a></h3><p>对应 [ERP 系统 -&gt; 销售管理 -&gt; 客户信息] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/erp/sale/customer</code> 目录。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/客户信息.png" alt="客户信息" tabindex="0" loading="lazy"><figcaption>客户信息</figcaption></figure><h2 id="_2-销售订单" tabindex="-1"><a class="header-anchor" href="#_2-销售订单"><span><a href="#_2-%E9%94%80%E5%94%AE%E8%AE%A2%E5%8D%95">#</a> 2. 销售订单</span></a></h2><p>销售订单，由 ErpSaleOrderController 提供接口，它不会直接影响库存，只有在出库、退货等操作才会影响库存。</p><h3 id="_2-1-表结构" tabindex="-1"><a class="header-anchor" href="#_2-1-表结构"><span><a href="#_2-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 2.1 表结构</span></a></h3><p><code>erp_sale_order</code> 表和 <code>erp_sale_order_items</code> 表，分别对应销售订单和销售订单项。</p><blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_sale_order` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `no` varchar(255) COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;销售单编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `status` tinyint NOT NULL COMMENT &#39;销售状态&#39;,</span></span>\n<span class="line"><span>  `order_time` datetime NOT NULL COMMENT &#39;下单时间&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `customer_id` bigint NOT NULL COMMENT &#39;客户编号&#39;,</span></span>\n<span class="line"><span>  `account_id` bigint DEFAULT NULL COMMENT &#39;结算账户编号&#39;,</span></span>\n<span class="line"><span>  `sale_user_id` bigint DEFAULT NULL COMMENT &#39;销售用户编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `total_count` decimal(24,6) NOT NULL COMMENT &#39;合计数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;合计价格，单位：元&#39;,</span></span>\n<span class="line"><span>  `total_product_price` decimal(24,6) NOT NULL COMMENT &#39;合计产品价格，单位：元&#39;,</span></span>\n<span class="line"><span>  `total_tax_price` decimal(24,6) NOT NULL COMMENT &#39;合计税额，单位：元&#39;,</span></span>\n<span class="line"><span>  `discount_percent` decimal(24,6) NOT NULL COMMENT &#39;优惠率，百分比&#39;,</span></span>\n<span class="line"><span>  `discount_price` decimal(24,6) NOT NULL COMMENT &#39;优惠金额，单位：元&#39;,</span></span>\n<span class="line"><span>  `deposit_price` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;定金金额，单位：元&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `file_url` varchar(512) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;附件地址&#39;,</span></span>\n<span class="line"><span>  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `out_count` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;销售出库数量&#39;,</span></span>\n<span class="line"><span>  `return_count` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;销售退货数量&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `no` (`no`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=6 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=&#39;ERP 销售订单表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>no</code>：销售单号，一般是系统自动生成的，目前格式是 <code>{prefix}{yyyyMMdd}{6 位自增}</code>。具体可见 ErpNoRedisDAO 类。</p><p>② <code>status</code>：销售状态，统一使用 ErpAuditStatus 枚举类，只有“未审批”、“已审批”两个状态。</p><p>③ <code>customer_id</code>：客户编号，关联 <code>erp_customer</code> 表。</p><p><code>account_id</code>：结算账户编号，关联后续的 <code>erp_account</code> 表。暂时不用关注，它用于销售的收款。</p><p>④ <code>total_count</code>、<code>total_price</code>、<code>total_product_price</code>、<code>total_tax_price</code>、<code>discount_percent</code>、<code>discount_price</code> 和 <code>deposit_price</code>：合计数量、合计价格、合计产品价格、合计税额、优惠率、优惠金额和定金金额。</p><p>⑤ <code>out_count</code>：该销售订单已经出库的数量。一个订单可以被多次销售出库，但是不能超过最大的 <code>total_count</code>，所以需要记录已经出库的数量。</p><p>⑥ <code>return_count</code>：该销售订单已经退货的数量。一个订单可以被多次销售退货，但是不能超过最大的 <code>total_count</code>，所以需要记录已经退货的数量。</p><hr><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_sale_order_items` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `order_id` bigint NOT NULL COMMENT &#39;销售订单编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `product_id` bigint NOT NULL COMMENT &#39;产品编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `product_unit_id` bigint NOT NULL COMMENT &#39;产品单位单位&#39;,</span></span>\n<span class="line"><span>  `product_price` decimal(24,6) NOT NULL COMMENT &#39;产品单价&#39;,</span></span>\n<span class="line"><span>  `count` decimal(24,6) NOT NULL COMMENT &#39;数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;总价&#39;,</span></span>\n<span class="line"><span>  `tax_percent` decimal(24,6) DEFAULT NULL COMMENT &#39;税率，百分比&#39;,</span></span>\n<span class="line"><span>  `tax_price` decimal(24,6) DEFAULT NULL COMMENT &#39;税额，单位：元&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `out_count` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;销售出库数量&#39;,</span></span>\n<span class="line"><span>  `return_count` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;销售退货数量&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  PRIMARY KEY (`id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=7 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT=&#39;ERP 销售订单项表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>order_id</code>：销售订单编号，关联到上面的 <code>erp_sale_order</code> 表。</p><p>② <code>product_id</code>：产品编号。</p><p>注意，因为销售订单不直接涉及库存，所以它并没有 <code>warehouse_id</code> 字段，也就是说它不关心库存的具体仓库。</p><p>③ <code>product_unit_id</code>、<code>product_price</code>、<code>count</code>、<code>total_price</code>、<code>tax_percent</code> 和 <code>tax_price</code>：产品单位编号、产品单价、数量、总价、税率和税额。</p><p>其中 <code>total_price</code> 等于 <code>product_price * count + tax_price</code>。（额外多了税额）</p><p>④ <code>in_count</code> 和 <code>return_count</code>：同 <code>erp_sale_order</code> 表，只是它表示的是该订单“项”的出库数量和退货数量，当然它也不能超过最大的 <code>count</code>。</p><h3 id="_2-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_2-2-管理后台"><span><a href="#_2-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 2.2 管理后台</span></a></h3><p>对应 [ERP 系统 -&gt; 销售管理 -&gt; 销售订单] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/erp/sale/order</code> 目录。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/销售订单.png" alt="销售订单" tabindex="0" loading="lazy"><figcaption>销售订单</figcaption></figure><p>① 点击「新增」按钮，随便填写一些信息，点击「确认」按钮，即可新增一条销售订单。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/销售订单-新增.png" alt="新增销售订单" tabindex="0" loading="lazy"><figcaption>新增销售订单</figcaption></figure><p>② 点击该销售订单的「审批」按钮，审批通过该销售订单，此时状态会变成“已审批”，但是并不会影响库存。</p><h2 id="_3-销售出库" tabindex="-1"><a class="header-anchor" href="#_3-销售出库"><span><a href="#_3-%E9%94%80%E5%94%AE%E5%87%BA%E5%BA%93">#</a> 3. 销售出库</span></a></h2><p>销售出库，由 ErpSaleOutController 提供接口，它会影响（减少）库存。总的来说，它的逻辑和 <a href="/erp/stock-in-out">其它出库</a> 基本一致，只是它是针对销售的出库。</p><h3 id="_3-1-表结构" tabindex="-1"><a class="header-anchor" href="#_3-1-表结构"><span><a href="#_3-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 3.1 表结构</span></a></h3><p><code>erp_sale_out</code> 表和 <code>erp_sale_out_items</code> 表，分别对应销售出库和销售出库项。</p><blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_sale_out` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  `no` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;销售出库编号&#39;,</span></span>\n<span class="line"><span> </span></span>\n<span class="line"><span>  `status` tinyint NOT NULL COMMENT &#39;出库状态&#39;,</span></span>\n<span class="line"><span>  `out_time` datetime NOT NULL COMMENT &#39;出库时间&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `customer_id` bigint NOT NULL COMMENT &#39;客户编号&#39;,</span></span>\n<span class="line"><span>  `account_id` bigint NOT NULL COMMENT &#39;结算账户编号&#39;,</span></span>\n<span class="line"><span>  `sale_user_id` bigint DEFAULT NULL COMMENT &#39;销售用户编号&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `order_id` bigint NOT NULL COMMENT &#39;销售订单编号&#39;,</span></span>\n<span class="line"><span>  `order_no` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;销售订单号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `total_count` decimal(24,6) NOT NULL COMMENT &#39;合计数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;合计价格，单位：元&#39;,</span></span>\n<span class="line"><span>  `total_product_price` decimal(24,6) NOT NULL COMMENT &#39;合计产品价格，单位：元&#39;,</span></span>\n<span class="line"><span>  `total_tax_price` decimal(24,6) NOT NULL COMMENT &#39;合计税额，单位：元&#39;,</span></span>\n<span class="line"><span>  `discount_percent` decimal(24,6) NOT NULL COMMENT &#39;优惠率，百分比&#39;,</span></span>\n<span class="line"><span>  `discount_price` decimal(24,6) NOT NULL COMMENT &#39;优惠金额，单位：元&#39;,</span></span>\n<span class="line"><span>  `other_price` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;其它金额，单位：元&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `receipt_price` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;已收款金额，单位：元&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `file_url` varchar(512) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;附件地址&#39;,</span></span>\n<span class="line"><span>  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `no` (`no`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=15 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=&#39;ERP 销售出库表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>no</code>：销售出库编号，一般是系统自动生成的，目前格式是 <code>{prefix}{yyyyMMdd}{6 位自增}</code>。具体可见 ErpNoRedisDAO 类。</p><p>② <code>status</code>：出库状态，统一使用 ErpAuditStatus 枚举类，只有“未审批”、“已审批”两个状态。</p><p>③ <code>customer_id</code>：客户编号，关联 <code>erp_customer</code> 表。</p><p><code>account_id</code>：结算账户编号，关联后续的 <code>erp_account</code> 表。暂时不用关注，它用于销售的收款。</p><p>④ <code>order_id</code> 和 <code>order_no</code>：销售订单编号和销售订单号，关联到上面的 <code>erp_sale_order</code> 表。</p><p>⑤ <code>total_count</code>、<code>total_price</code>、<code>total_product_price</code>、<code>total_tax_price</code>、<code>discount_percent</code>、<code>discount_price</code> 和 <code>other_price</code>：合计数量、合计价格、合计产品价格、合计税额、优惠率、优惠金额和其它金额。</p><p>其中，<code>total_price</code> 等于 <code>total_product_price + total_tax_price + other_price - discount_price</code>。</p><p>⑥ <code>receipt_price</code>：已收款金额，单位：元。暂时不用关注，它用于销售的收款。</p><hr><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_sale_out_items` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `out_id` bigint NOT NULL COMMENT &#39;销售出库编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `order_item_id` bigint NOT NULL COMMENT &#39;销售订单项编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `warehouse_id` bigint NOT NULL COMMENT &#39;仓库编号&#39;,</span></span>\n<span class="line"><span>  `product_id` bigint NOT NULL COMMENT &#39;产品编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `product_unit_id` bigint NOT NULL COMMENT &#39;产品单位单位&#39;,</span></span>\n<span class="line"><span>  `product_price` decimal(24,6) NOT NULL COMMENT &#39;产品单价&#39;,</span></span>\n<span class="line"><span>  `count` decimal(24,6) NOT NULL COMMENT &#39;数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;总价&#39;,</span></span>\n<span class="line"><span>  `tax_percent` decimal(24,6) DEFAULT NULL COMMENT &#39;税率，百分比&#39;,</span></span>\n<span class="line"><span>  `tax_price` decimal(24,6) DEFAULT NULL COMMENT &#39;税额，单位：元&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=27 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT=&#39;ERP 销售出库项表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>out_id</code>：销售出库编号，关联到上面的 <code>erp_sale_out</code> 表。</p><p>② <code>order_item_id</code>：销售订单项编号，关联到上面的 <code>erp_sale_order_items</code> 表，因为它需要对应的 <code>out_count</code> 字段。</p><p>③ <code>warehouse_id</code> 和 <code>product_id</code>：分别关联到仓库和产品，因为它涉及到库存变更。</p><p>④ <code>product_unit_id</code>、<code>product_price</code>、<code>count</code>、<code>total_price</code>、<code>tax_percent</code> 和 <code>tax_price</code>：产品单位编号、产品单价、数量、总价、税率和税额。</p><p>其中 <code>total_price</code> 等于 <code>product_price * count + tax_price</code>。（额外多了税额）</p><h3 id="_3-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_3-2-管理后台"><span><a href="#_3-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 3.2 管理后台</span></a></h3><p>对应 [ERP 系统 -&gt; 销售管理 -&gt; 销售出库] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/erp/sale/out</code> 目录。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/销售出库.png" alt="销售出库" tabindex="0" loading="lazy"><figcaption>销售出库</figcaption></figure><p>① 点击「新增」按钮，随便填写一些信息，点击「确认」按钮，即可新增一条销售出库。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/销售出库-新增.png" alt="新增销售出库" tabindex="0" loading="lazy"><figcaption>新增销售出库</figcaption></figure><p>② 点击该销售出库的「审批」按钮，审批通过该销售出库，此时状态会变成“已审批”，同时会减少对应的库存、新增库存明细。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/销售出库-审批.png" alt="审批销售出库" tabindex="0" loading="lazy"><figcaption>审批销售出库</figcaption></figure><p>③ 点击该销售出库的「反审批」按钮，反审批该销售出库，此时状态会变成“未审批”，同时会增加对应的库存、新增库存明细。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/销售出库-反审批.png" alt="反审批销售出库" tabindex="0" loading="lazy"><figcaption>反审批销售出库</figcaption></figure><h2 id="_4-销售退货" tabindex="-1"><a class="header-anchor" href="#_4-销售退货"><span><a href="#_4-%E9%94%80%E5%94%AE%E9%80%80%E8%B4%A7">#</a> 4. 销售退货</span></a></h2><p>销售退货，由 ErpSaleReturnController 提供接口，它会影响（增加）库存。总的来说，它的逻辑和 <a href="/erp/stock-in-out">其它入库</a> 基本一致，只是它是针对销售的入库。</p><h3 id="_4-1-表结构" tabindex="-1"><a class="header-anchor" href="#_4-1-表结构"><span><a href="#_4-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 4.1 表结构</span></a></h3><p>友情提示：销售退货相关的表，和销售出库相关的表结构基本一致。</p><p><code>erp_sale_return</code> 表和 <code>erp_sale_return_items</code> 表，分别对应销售退货和销售退货项。</p><blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_sale_return` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  `no` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;销售退货编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `status` tinyint NOT NULL COMMENT &#39;退货状态&#39;,</span></span>\n<span class="line"><span>  `return_time` datetime NOT NULL COMMENT &#39;退货时间&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `customer_id` bigint NOT NULL COMMENT &#39;客户编号&#39;,</span></span>\n<span class="line"><span>  `account_id` bigint NOT NULL COMMENT &#39;结算账户编号&#39;,</span></span>\n<span class="line"><span>  `sale_user_id` bigint DEFAULT NULL COMMENT &#39;销售用户编号&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `order_id` bigint NOT NULL COMMENT &#39;销售订单编号&#39;,</span></span>\n<span class="line"><span>  `order_no` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;销售订单号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `total_count` decimal(24,6) NOT NULL COMMENT &#39;合计数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;合计价格，单位：元&#39;,</span></span>\n<span class="line"><span>  `total_product_price` decimal(24,6) NOT NULL COMMENT &#39;合计产品价格，单位：元&#39;,</span></span>\n<span class="line"><span>  `total_tax_price` decimal(24,6) NOT NULL COMMENT &#39;合计税额，单位：元&#39;,</span></span>\n<span class="line"><span>  `discount_percent` decimal(24,6) NOT NULL COMMENT &#39;优惠率，百分比&#39;,</span></span>\n<span class="line"><span>  `discount_price` decimal(24,6) NOT NULL COMMENT &#39;优惠金额，单位：元&#39;,</span></span>\n<span class="line"><span>  `other_price` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;其它金额，单位：元&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `refund_price` decimal(24,6) NOT NULL DEFAULT &#39;0.000000&#39; COMMENT &#39;已退款金额，单位：元&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `file_url` varchar(512) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;附件地址&#39;,</span></span>\n<span class="line"><span>  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`),</span></span>\n<span class="line"><span>  UNIQUE KEY `no` (`no`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=23 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=&#39;ERP 销售退货表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>no</code>：销售退货编号，一般是系统自动生成的，目前格式是 <code>{prefix}{yyyyMMdd}{6 位自增}</code>。具体可见 ErpNoRedisDAO 类。</p><p>② <code>status</code>：退货状态，统一使用 ErpAuditStatus 枚举类，只有“未审批”、“已审批”两个状态。</p><p>③ <code>customer_id</code>：客户编号，关联 <code>erp_customer</code> 表。</p><p><code>account_id</code>：结算账户编号，关联后续的 <code>erp_account</code> 表。暂时不用关注，它用于销售的收款。</p><p>④ <code>order_id</code> 和 <code>order_no</code>：销售订单编号和销售订单号，关联到上面的 <code>erp_sale_order</code> 表。</p><p>⑤ <code>total_count</code>、<code>total_price</code>、<code>total_product_price</code>、<code>total_tax_price</code>、<code>discount_percent</code>、<code>discount_price</code> 和 <code>other_price</code>：合计数量、合计价格、合计产品价格、合计税额、优惠率、优惠金额和其它金额。</p><p>其中，<code>total_price</code> 等于 <code>total_product_price + total_tax_price + other_price - discount_price</code>。</p><p>【差异】⑥ <code>refund_price</code>：已退款金额，单位：元。暂时不用关注，它用于销售的收款。</p><hr><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>CREATE TABLE `erp_sale_return_items` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `return_id` bigint NOT NULL COMMENT &#39;销售退货编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `order_item_id` bigint NOT NULL COMMENT &#39;销售订单项编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `warehouse_id` bigint NOT NULL COMMENT &#39;仓库编号&#39;,</span></span>\n<span class="line"><span>  `product_id` bigint NOT NULL COMMENT &#39;产品编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `product_unit_id` bigint NOT NULL COMMENT &#39;产品单位单位&#39;,</span></span>\n<span class="line"><span>  `product_price` decimal(24,6) NOT NULL COMMENT &#39;产品单价&#39;,</span></span>\n<span class="line"><span>  `count` decimal(24,6) NOT NULL COMMENT &#39;数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;总价&#39;,</span></span>\n<span class="line"><span>  `tax_percent` decimal(24,6) DEFAULT NULL COMMENT &#39;税率，百分比&#39;,</span></span>\n<span class="line"><span>  `tax_price` decimal(24,6) DEFAULT NULL COMMENT &#39;税额，单位：元&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `remark` varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci DEFAULT NULL COMMENT &#39;备注&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`)</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=43 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci COMMENT=&#39;ERP 销售退货项表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>return_id</code>：销售退货编号，关联到上面的 <code>erp_sale_return</code> 表。</p><p>② <code>order_item_id</code>：销售订单项编号，关联到上面的 <code>erp_sale_order_items</code> 表，因为它需要对应的 <code>return_count</code> 字段。</p><p>③ <code>warehouse_id</code> 和 <code>product_id</code>：分别关联到仓库和产品，因为它涉及到库存变更。</p><p>④ <code>product_unit_id</code>、<code>product_price</code>、<code>count</code>、<code>total_price</code>、<code>tax_percent</code> 和 <code>tax_price</code>：产品单位编号、产品单价、数量、总价、税率和税额。</p><p>其中 <code>total_price</code> 等于 <code>product_price * count + tax_price</code>。（额外多了税额）</p><h3 id="_4-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_4-2-管理后台"><span><a href="#_4-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 4.2 管理后台</span></a></h3><p>对应 [ERP 系统 -&gt; 销售管理 -&gt; 销售退货] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/erp/sale/return</code> 目录。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/销售退货.png" alt="销售退货" tabindex="0" loading="lazy"><figcaption>销售退货</figcaption></figure><p>① 点击「新增」按钮，随便填写一些信息，点击「确认」按钮，即可新增一条销售退货。</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/销售退货-新增.png" alt="新增销售退货" tabindex="0" loading="lazy"><figcaption>新增销售退货</figcaption></figure><p>② 点击该销售退货的「审批」按钮，审批通过该销售退货，此时状态会变成“已审批”，同时会增加对应的库存、新增库存明细。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/销售退货-审批.png" alt="审批销售退货" tabindex="0" loading="lazy"><figcaption>审批销售退货</figcaption></figure><p>③ 点击该销售退货的「反审批」按钮，反审批该销售退货，此时状态会变成“未审批”，同时会减少对应的库存、新增库存明细。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/ERP手册/销售模块/销售退货-反审批.png" alt="反审批销售退货" tabindex="0" loading="lazy"><figcaption>反审批销售退货</figcaption></figure><h2 id="_5-销售收款" tabindex="-1"><a class="header-anchor" href="#_5-销售收款"><span><a href="#_5-%E9%94%80%E5%94%AE%E6%94%B6%E6%AC%BE">#</a> 5. 销售收款</span></a></h2>',104);function u(_,E){const a=e("RouteLink");return i(),c("div",null,[t,p("p",null,[n("参见 "),d(a,{to:"/erp/finance-payment-receipt/"},{default:l(()=>[n("《【财务】采购付款、销售收款》")]),_:1}),n(" 文档。")])])}const m=s(o,[["render",u],["__file","sale.html.vue"]]),b=JSON.parse('{"path":"/project/rouyi-vue-pro/erp/sale.html","title":"【销售】销售订单、出库、退货","lang":"en-US","frontmatter":{"title":"【销售】销售订单、出库、退货","tags":["project","java","spring-boot","spring-cloud"],"categories":["project"],"order":116,"feed":false,"seo":false,"head":[]},"headers":[{"level":2,"title":"# 1. 客户","slug":"_1-客户","link":"#_1-客户","children":[{"level":3,"title":"# 1.1 表结构","slug":"_1-1-表结构","link":"#_1-1-表结构","children":[]},{"level":3,"title":"# 1.2 管理后台","slug":"_1-2-管理后台","link":"#_1-2-管理后台","children":[]}]},{"level":2,"title":"# 2. 销售订单","slug":"_2-销售订单","link":"#_2-销售订单","children":[{"level":3,"title":"# 2.1 表结构","slug":"_2-1-表结构","link":"#_2-1-表结构","children":[]},{"level":3,"title":"# 2.2 管理后台","slug":"_2-2-管理后台","link":"#_2-2-管理后台","children":[]}]},{"level":2,"title":"# 3. 销售出库","slug":"_3-销售出库","link":"#_3-销售出库","children":[{"level":3,"title":"# 3.1 表结构","slug":"_3-1-表结构","link":"#_3-1-表结构","children":[]},{"level":3,"title":"# 3.2 管理后台","slug":"_3-2-管理后台","link":"#_3-2-管理后台","children":[]}]},{"level":2,"title":"# 4. 销售退货","slug":"_4-销售退货","link":"#_4-销售退货","children":[{"level":3,"title":"# 4.1 表结构","slug":"_4-1-表结构","link":"#_4-1-表结构","children":[]},{"level":3,"title":"# 4.2 管理后台","slug":"_4-2-管理后台","link":"#_4-2-管理后台","children":[]}]},{"level":2,"title":"# 5. 销售收款","slug":"_5-销售收款","link":"#_5-销售收款","children":[]}],"git":{"createdTime":1720365235000,"updatedTime":1720365235000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":13.2,"words":3961},"filePathRelative":"project/rouyi-vue-pro/erp/sale.md","localizedDate":"July 7, 2024"}');export{m as comp,b as data};
