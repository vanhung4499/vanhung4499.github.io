import{_ as s,g as e,o as l,c as o,e as i,h as a,f as p,w as r,a as c}from"./app-BRTHG7K9.js";const d={},t=c(`<h1 id="定时任务-xxl-job" tabindex="-1"><a class="header-anchor" href="#定时任务-xxl-job"><span>定时任务 XXL Job</span></a></h1><p>定时任务的使用场景主要如下：</p><ul><li>时间驱动处理场景：每分钟扫描超时支付的订单，活动状态刷新，整点发送优惠券。</li><li>批量处理数据：按月批量统计报表数据，批量更新短信状态，实时性要求不高。</li></ul><p>年度最佳定时任务：每个月初的工资单的推送！！！</p><p>项目基于 XXL Job 实现分布式定时任务，支持动态控制任务的添加、修改、开启、暂停、删除、执行一次等操作。</p><figure><img src="https://static.iocoder.cn/images/XXL-JOB/2019-11-28/06.jpg" alt="定时任务" tabindex="0" loading="lazy"><figcaption>定时任务</figcaption></figure><h2 id="_1-如何搭建-xxl-job-调度中心" tabindex="-1"><a class="header-anchor" href="#_1-如何搭建-xxl-job-调度中心"><span><a href="#_1-%E5%A6%82%E4%BD%95%E6%90%AD%E5%BB%BA-xxl-job-%E8%B0%83%E5%BA%A6%E4%B8%AD%E5%BF%83">#</a> 1. 如何搭建 XXL Job 调度中心</span></a></h2><p>① 参见 <a href="https://www.iocoder.cn/XXL-JOB/install/?qun" target="_blank" rel="noopener noreferrer">《芋道 XXL-Job 极简入门》</a> 文档的「4. 搭建调度中心 」部分。</p><p>② 搭建完成后，需要修改管理后台的 [基础设施 -&gt; 定时任务] 菜单，指向你的 XXL-Job 地址。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/定时任务/xxl-job-menu.png" alt="修改定时任务地址" tabindex="0" loading="lazy"><figcaption>修改定时任务地址</figcaption></figure><h2 id="_2-如何编写-xxl-job-定时任务" tabindex="-1"><a class="header-anchor" href="#_2-如何编写-xxl-job-定时任务"><span><a href="#_2-%E5%A6%82%E4%BD%95%E7%BC%96%E5%86%99-xxl-job-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1">#</a> 2. 如何编写 XXL Job 定时任务</span></a></h2><p>友情提示：以 yudao-module-system 服务为例子。</p><h3 id="_2-1-引入依赖" tabindex="-1"><a class="header-anchor" href="#_2-1-引入依赖"><span><a href="#_2-1-%E5%BC%95%E5%85%A5%E4%BE%9D%E8%B5%96">#</a> 2.1 引入依赖</span></a></h3><p>在 <code>yudao-module-system-biz</code> 模块的 <a href="https://github.com/YunaiV/yudao-cloud/blob/master/yudao-module-system/yudao-module-system-biz/pom.xml" target="_blank" rel="noopener noreferrer"><code>pom.xml</code></a> 中，引入 <code>yudao-spring-boot-starter-job</code> 技术组件。如下所示：</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;cn.iocoder.cloud&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;yudao-spring-boot-starter-job&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre></div><p>该组件基于 XXL Job 框架的封装，实现它的 Spring Boot Starter 配置。</p><h3 id="_2-2-添加配置" tabindex="-1"><a class="header-anchor" href="#_2-2-添加配置"><span><a href="#_2-2-%E6%B7%BB%E5%8A%A0%E9%85%8D%E7%BD%AE">#</a> 2.2 添加配置</span></a></h3><p>① 在 <a href="https://github.com/YunaiV/yudao-cloud/blob/master/yudao-module-system/yudao-module-system-biz/src/main/resources/application.yaml#L86-L93" target="_blank" rel="noopener noreferrer"><code>application.yaml</code></a> 中，添加 <code>xxl.job</code> 配置。如下所示：</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>--- #################### 定时任务相关配置 ####################</span></span>
<span class="line"><span></span></span>
<span class="line"><span>xxl:</span></span>
<span class="line"><span>  job:</span></span>
<span class="line"><span>    executor:</span></span>
<span class="line"><span>      appname: \${spring.application.name} # 执行器 AppName</span></span>
<span class="line"><span>      logpath: \${user.home}/logs/xxl-job/\${spring.application.name} # 执行器运行日志文件存储磁盘路径</span></span>
<span class="line"><span>    accessToken: default_token # 执行器通讯TOKEN</span></span></code></pre></div><ul><li>注意，<code>xxl.job.accessToken</code> 配置，需要改成你的 XXL Job 调度中心的访问令牌。</li></ul><p>② 在 <a href="https://github.com/YunaiV/yudao-cloud/blob/master/yudao-module-system/yudao-module-system-biz/src/main/resources/application-local.yaml#L80-L85" target="_blank" rel="noopener noreferrer"><code>application-local.yaml</code></a> 中，添加 <code>xxl.job</code> 配置。如下所示：</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>--- #################### 定时任务相关配置 ####################</span></span>
<span class="line"><span></span></span>
<span class="line"><span>xxl:</span></span>
<span class="line"><span>  job:</span></span>
<span class="line"><span>    admin:</span></span>
<span class="line"><span>      addresses: http://127.0.0.1:9090/xxl-job-admin # 调度中心部署跟地址</span></span></code></pre></div><h3 id="_2-3-创建-job-定时任务" tabindex="-1"><a class="header-anchor" href="#_2-3-创建-job-定时任务"><span><a href="#_2-3-%E5%88%9B%E5%BB%BA-job-%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1">#</a> 2.3 创建 Job 定时任务</span></a></h3><p>参见 <a href="http://www.iocoder.cn/Spring-Boot/Job/?yudao" target="_blank" rel="noopener noreferrer">《芋道 Spring Boot 定时任务入门》</a> 文章的「5. 快速入门 XXL-JOB」部分。</p><p>常用的 Cron 表达式如下：</p><div class="language- line-numbers-mode" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>0 0 10,14,16 * * ? 每天上午 10 点，下午 2 点、4 点</span></span>
<span class="line"><span>0 0/30 9-17 * * ? 朝九晚五工作时间内，每半小时</span></span>
<span class="line"><span>0 0 12 ? * WED 表示每个星期三中午 12 点</span></span>
<span class="line"><span>0 0 12 * * ? 每天中午 12 点触发</span></span>
<span class="line"><span>0 15 10 ? * * 每天上午 10:15 触发</span></span>
<span class="line"><span>0 15 10 * * ? 每天上午 10:15 触发</span></span>
<span class="line"><span>0 15 10 * * ? * 每天上午 10:15 触发</span></span>
<span class="line"><span>0 15 10 * * ? 2005 2005 年的每天上午 10:15 触发</span></span>
<span class="line"><span>0 * 14 * * ? 在每天下午 2 点到下午 2:59 期间，每 1 分钟触发</span></span>
<span class="line"><span>0 0/5 14 * * ? 在每天下午 2 点到下午 2:55 期间，每 5 分钟触发</span></span>
<span class="line"><span>0 0/5 14,18 * * ? 在每天下午 2 点到 2:55 期间和下午 6 点到 6:55 期间，每 5 分钟触发</span></span>
<span class="line"><span>0 0-5 14 * * ? 在每天下午 2 点到下午 2:05 期间，每 1 分钟触发</span></span>
<span class="line"><span>0 10,44 14 ? 3 WED 每年三月的星期三的下午 2:10 和 2:44 触发</span></span>
<span class="line"><span>0 15 10 ? * MON-FRI 周一至周五的上午 10:15 触发</span></span>
<span class="line"><span>0 15 10 15 * ? 每月15日上午 10:15 触发</span></span>
<span class="line"><span>0 15 10 L * ? 每月最后一日的上午 10:15 触发</span></span>
<span class="line"><span>0 15 10 ? * 6L 每月的最后一个星期五上午 10:15 触发</span></span>
<span class="line"><span>0 15 10 ? * 6L 2002-2005 2002 年至 2005 年，每月的最后一个星期五上午 10:15 触发</span></span>
<span class="line"><span>0 15 10 ? * 6#3 每月的第三个星期五上午 10:15 触发</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>疑问：为什么 Job 查询数据库时，报多租户的错误？</p><p>需要声明 <a href="https://github.com/YunaiV/yudao-cloud/blob/master/yudao-framework/yudao-spring-boot-starter-biz-tenant/src/main/java/cn/iocoder/yudao/framework/tenant/core/job/TenantJob.java" target="_blank" rel="noopener noreferrer"><code>@TenantJob</code></a> 注解在 Job 类上，实现<strong>并行</strong>遍历每个租户，执行定时任务的逻辑。</p>`,28);function b(u,m){const n=e("RouteLink");return l(),o("div",null,[t,i("p",null,[a("更多多租户的内容，可见 "),p(n,{to:"/saas-tenant/"},{default:r(()=>[a("《开发指南 —— SaaS 多租户》")]),_:1}),a(" 文档。")])])}const g=s(d,[["render",b],["__file","job.html.vue"]]),v=JSON.parse('{"path":"/project/yudao-cloud/job.html","title":"定时任务 XXL Job","lang":"en-US","frontmatter":{"title":"定时任务 XXL Job","tags":["project","java","spring-boot","spring-cloud"],"categories":["project"],"order":55,"feed":false,"seo":false,"head":[]},"headers":[{"level":2,"title":"# 1. 如何搭建 XXL Job 调度中心","slug":"_1-如何搭建-xxl-job-调度中心","link":"#_1-如何搭建-xxl-job-调度中心","children":[]},{"level":2,"title":"# 2. 如何编写 XXL Job 定时任务","slug":"_2-如何编写-xxl-job-定时任务","link":"#_2-如何编写-xxl-job-定时任务","children":[{"level":3,"title":"# 2.1 引入依赖","slug":"_2-1-引入依赖","link":"#_2-1-引入依赖","children":[]},{"level":3,"title":"# 2.2 添加配置","slug":"_2-2-添加配置","link":"#_2-2-添加配置","children":[]},{"level":3,"title":"# 2.3 创建 Job 定时任务","slug":"_2-3-创建-job-定时任务","link":"#_2-3-创建-job-定时任务","children":[]}]}],"git":{"createdTime":1720365235000,"updatedTime":1720365235000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":3.41,"words":1023},"filePathRelative":"project/yudao-cloud/job.md","localizedDate":"July 7, 2024"}');export{g as comp,v as data};
