import{_ as s,o as a,c as n,d as i}from"./app-BG8AAbz2.js";const l={},o=i(`<h1 id="mysql-operation" tabindex="-1"><a class="header-anchor" href="#mysql-operation"><span>MySQL Operation</span></a></h1><blockquote><p>Nếu công ty của bạn có DBA, thì tôi xin chúc mừng bạn, bạn có thể bỏ qua việc quản trị Mysql. Nếu công ty của bạn không có DBA, hãy học cách thực hiện các hoạt động quản trị cơ bản của Mysql, đó là điều cần thiết để tự bảo vệ mình khi hoạt động trong lĩnh vực này.</p></blockquote><h2 id="cai-đat-va-trien-khai" tabindex="-1"><a class="header-anchor" href="#cai-đat-va-trien-khai"><span>Cài đặt và triển khai</span></a></h2><h3 id="cai-đat-tren-windows" tabindex="-1"><a class="header-anchor" href="#cai-đat-tren-windows"><span>Cài đặt trên Windows</span></a></h3><p>(1) Tải phiên bản Mysql 5.7 Portable (không cần cài đặt)</p><p>Link tải: <a href="https://dev.mysql.com/downloads/mysql/5.7.html#downloads" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/downloads/mysql/5.7.html#downloads</a></p><p>(2) Giải nén và tạo file my.ini trong thư mục gốc</p><p>Ví dụ file my.ini:</p><div class="language-ini line-numbers-mode" data-ext="ini" data-title="ini"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">[mysqld]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Thiết lập cổng 3306</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> 3306</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Thiết lập đường dẫn cài đặt mysql, thay đổi đường dẫn này cho phù hợp với thư mục bạn giải nén</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">basedir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">D:\\\\Tools\\\\DB\\\\mysql\\\\mysql-5.7.31</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Số kết nối tối đa</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">max_connections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">200</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Mysql sử dụng bộ ký tự mặc định là latin1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">character-set-server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">utf8</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Thiết lập engine lưu trữ mặc định cho bảng mới</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">default-storage-engine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">INNODB</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">[client]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Thiết lập bộ ký tự mặc định cho client mysql</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">default-character-set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">utf8</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) Thực hiện các lệnh cài đặt</p><p>Trên cửa sổ CMD, thực hiện lần lượt các lệnh cài đặt sau:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>cd D:\\\\Tools\\\\DB\\\\mysql\\\\mysql-5.7.31</span></span>
<span class="line"><span>mysqld --initialize</span></span>
<span class="line"><span>mysqld -install</span></span></code></pre></div><p>Giải thích:</p><ul><li><code>mysqld --initialize</code> sẽ tự động khởi tạo và tạo thư mục data.</li><li><code>mysqld -install</code> sẽ cài đặt dịch vụ mysql.</li></ul><p>(4) Khởi động dịch vụ</p><p>Trên cửa sổ CMD, thực hiện lệnh <code>net start mysql</code> để khởi động dịch vụ.</p><h3 id="cai-đat-tren-centos" tabindex="-1"><a class="header-anchor" href="#cai-đat-tren-centos"><span>Cài đặt trên CentOS</span></a></h3><blockquote><p>Bài viết này chỉ giới thiệu cách cài đặt thông qua gói rpm</p></blockquote><h4 id="cai-đat-nguon-yum-cua-mysql" tabindex="-1"><a class="header-anchor" href="#cai-đat-nguon-yum-cua-mysql"><span>Cài đặt nguồn yum của mysql</span></a></h4><p>Link tải chính thức: <a href="https://dev.mysql.com/downloads/repo/yum/" target="_blank" rel="noopener noreferrer">https://dev.mysql.com/downloads/repo/yum/</a></p><p>(1) Tải gói yum</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">wget</span><span style="color:#98C379;--shiki-dark:#98C379;"> https://dev.mysql.com/get/mysql80-community-release-el7-1.noarch.rpm</span></span></code></pre></div><p>(2) Cài đặt tệp repo yum và cập nhật bộ nhớ cache yum</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">rpm</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -ivh</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysql80-community-release-el7-1.noarch.rpm</span></span></code></pre></div><p>Kết quả thực hiện:</p><p>Sẽ tạo ra hai tệp repo trong thư mục /etc/yum.repos.d/</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> ls</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysql</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql-community.repo</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql-community-source.repo</span></span></code></pre></div><p>Cập nhật yum:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> clean</span><span style="color:#98C379;--shiki-dark:#98C379;"> all</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> makecache</span></span></code></pre></div><p>(3) Kiểm tra trạng thái cài đặt rpm</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> search</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#98C379;--shiki-dark:#98C379;"> server</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql-community-common.i686</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379;"> database</span><span style="color:#98C379;--shiki-dark:#98C379;"> common</span><span style="color:#98C379;--shiki-dark:#98C379;"> files</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> server</span><span style="color:#98C379;--shiki-dark:#98C379;"> and</span><span style="color:#98C379;--shiki-dark:#98C379;"> client</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql-community-common.x86_64</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379;"> database</span><span style="color:#98C379;--shiki-dark:#98C379;"> common</span><span style="color:#98C379;--shiki-dark:#98C379;"> files</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> server</span><span style="color:#98C379;--shiki-dark:#98C379;"> and</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql-community-test.x86_64</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> Test</span><span style="color:#98C379;--shiki-dark:#98C379;"> suite</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> the</span><span style="color:#98C379;--shiki-dark:#98C379;"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379;"> database</span><span style="color:#98C379;--shiki-dark:#98C379;"> server</span></span>
<span class="line"><span style="color:#56B6C2;--shiki-dark:#56B6C2;">                       :</span><span style="color:#98C379;--shiki-dark:#98C379;"> administering</span><span style="color:#98C379;--shiki-dark:#98C379;"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379;"> servers</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql-community-server.x86_64</span><span style="color:#98C379;--shiki-dark:#98C379;"> :</span><span style="color:#98C379;--shiki-dark:#98C379;"> A</span><span style="color:#98C379;--shiki-dark:#98C379;"> very</span><span style="color:#98C379;--shiki-dark:#98C379;"> fast</span><span style="color:#98C379;--shiki-dark:#98C379;"> and</span><span style="color:#98C379;--shiki-dark:#98C379;"> reliable</span><span style="color:#98C379;--shiki-dark:#98C379;"> SQL</span><span style="color:#98C379;--shiki-dark:#98C379;"> database</span><span style="color:#98C379;--shiki-dark:#98C379;"> server</span></span></code></pre></div><p>Sau khi cài đặt mysql bằng yum, sẽ có một số thư mục quan trọng:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>## Tệp cấu hình</span></span>
<span class="line"><span>/etc/my.cnf</span></span>
<span class="line"><span>## Thư mục cơ sở dữ liệu</span></span>
<span class="line"><span>/var/lib/mysql/</span></span>
<span class="line"><span>## Tệp cấu hình</span></span>
<span class="line"><span>/usr/share/mysql (lệnh mysql.server và tệp cấu hình)</span></span>
<span class="line"><span>## Các lệnh liên quan</span></span>
<span class="line"><span>/usr/bin (mysqladmin, mysqldump và các lệnh khác)</span></span>
<span class="line"><span>## Tệp khởi động</span></span>
<span class="line"><span>/usr/lib/systemd/system/mysqld.service (đăng ký dịch vụ systemd)</span></span></code></pre></div><p>(4) Cài đặt máy chủ mysql</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> install</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysql-community-server</span></span></code></pre></div><h4 id="quan-ly-dich-vu-mysql" tabindex="-1"><a class="header-anchor" href="#quan-ly-dich-vu-mysql"><span>Quản lý dịch vụ mysql</span></a></h4><p>Sau khi cài đặt mysql bằng yum, sẽ có một dịch vụ systemd có tên <code>mysqld</code>.</p><p>Quản lý dịch vụ rất đơn giản:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">## Kiểm tra trạng thái</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> status</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">## Kích hoạt dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> enable</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">## Vô hiệu hóa dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> disable</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">## Khởi động dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> start</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">## Khởi động lại dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> restart</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">## Dừng dịch vụ</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> stop</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysqld</span></span></code></pre></div><h3 id="khoi-tao-mat-khau-cho-co-so-du-lieu" tabindex="-1"><a class="header-anchor" href="#khoi-tao-mat-khau-cho-co-so-du-lieu"><span>Khởi tạo mật khẩu cho cơ sở dữ liệu</span></a></h3><p>Xem mật khẩu tạm thời:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> grep</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;password&quot;</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/log/mysqld.log</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2018-09-30T03:13:41.727736Z</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [Note] [MY-010454] [Server] A temporary password is generated </span><span style="color:#C678DD;--shiki-dark:#C678DD;">for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> root@localhost: %:lt+srWu4k1</span></span></code></pre></div><p>Thực hiện lệnh sau:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -uroot</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -p</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;">temporary_password</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p>Nhập mật khẩu tạm thời để truy cập vào mysql. Nếu bạn muốn thay đổi mật khẩu, thực hiện lệnh sau:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ALTER</span><span style="color:#98C379;--shiki-dark:#98C379;"> USER</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;root&#39;@&#39;localhost&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> IDENTIFIED</span><span style="color:#98C379;--shiki-dark:#98C379;"> BY</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;your_password&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Lưu ý: Mật khẩu mặc định có độ mạnh trung bình, bao gồm chữ hoa, chữ thường, chữ số và ký tự đặc biệt. Bạn chỉ có thể thay đổi cấu hình để sử dụng mật khẩu đơn giản hơn sau khi đã thay đổi thành công mật khẩu.</p><h3 id="cau-hinh-truy-cap-tu-xa" tabindex="-1"><a class="header-anchor" href="#cau-hinh-truy-cap-tu-xa"><span>Cấu hình truy cập từ xa</span></a></h3><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">root</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;your_password&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ALL </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD;">TO</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;root&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">ALTER</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> USER</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;root&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;your_password&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">FLUSH PRIVILEGES;</span></span></code></pre></div><h3 id="bo-qua-xac-thuc-đang-nhap" tabindex="-1"><a class="header-anchor" href="#bo-qua-xac-thuc-đang-nhap"><span>Bỏ qua xác thực đăng nhập</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">vim</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/my.cnf</span></span></code></pre></div><p>Thêm dòng <code>skip-grant-tables</code> dưới phần <code>[mysqld]</code>.</p><p>Chức năng này cho phép bỏ qua xác thực đăng nhập, nghĩa là bạn có thể đăng nhập vào root với bất kỳ mật khẩu nào.</p><p>Thực hiện <code>systemctl restart mysqld</code> để khởi động lại mysql.</p><h3 id="ket-noi-tu-may-khach" tabindex="-1"><a class="header-anchor" href="#ket-noi-tu-may-khach"><span>Kết nối từ máy khách</span></a></h3><p>Cú pháp: <code>mysql -h&lt;host&gt; -P&lt;port&gt; -u&lt;username&gt; -p&lt;password&gt;</code></p><p>Nếu không chỉ định mật khẩu một cách rõ ràng, bạn sẽ được yêu cầu nhập mật khẩu trước khi truy cập.</p><p>【Ví dụ】Kết nối đến Mysql cục bộ</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysql</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -h</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 127.0.0.1</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -P</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3306</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -u</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -p</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Enter</span><span style="color:#98C379;--shiki-dark:#98C379;"> password:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Welcome</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> the</span><span style="color:#98C379;--shiki-dark:#98C379;"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379;"> monitor.</span><span style="color:#98C379;--shiki-dark:#98C379;">  Commands</span><span style="color:#98C379;--shiki-dark:#98C379;"> end</span><span style="color:#98C379;--shiki-dark:#98C379;"> with</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ; </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">or</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> \\g</span><span style="color:#98C379;--shiki-dark:#98C379;">.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Your</span><span style="color:#98C379;--shiki-dark:#98C379;"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379;"> connection</span><span style="color:#98C379;--shiki-dark:#98C379;"> id</span><span style="color:#98C379;--shiki-dark:#98C379;"> is</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 13501</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Server</span><span style="color:#98C379;--shiki-dark:#98C379;"> version:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 8.0.19</span><span style="color:#98C379;--shiki-dark:#98C379;"> MySQL</span><span style="color:#98C379;--shiki-dark:#98C379;"> Community</span><span style="color:#98C379;--shiki-dark:#98C379;"> Server</span><span style="color:#98C379;--shiki-dark:#98C379;"> -</span><span style="color:#98C379;--shiki-dark:#98C379;"> GPL</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Copyright</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (c) 2000, 2020, Oracle and/or its affiliates. All rights reserved.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Oracle</span><span style="color:#98C379;--shiki-dark:#98C379;"> is</span><span style="color:#98C379;--shiki-dark:#98C379;"> a</span><span style="color:#98C379;--shiki-dark:#98C379;"> registered</span><span style="color:#98C379;--shiki-dark:#98C379;"> trademark</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> Oracle</span><span style="color:#98C379;--shiki-dark:#98C379;"> Corporation</span><span style="color:#98C379;--shiki-dark:#98C379;"> and/or</span><span style="color:#98C379;--shiki-dark:#98C379;"> its</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">affiliates.</span><span style="color:#98C379;--shiki-dark:#98C379;"> Other</span><span style="color:#98C379;--shiki-dark:#98C379;"> names</span><span style="color:#98C379;--shiki-dark:#98C379;"> may</span><span style="color:#98C379;--shiki-dark:#98C379;"> be</span><span style="color:#98C379;--shiki-dark:#98C379;"> trademarks</span><span style="color:#98C379;--shiki-dark:#98C379;"> of</span><span style="color:#98C379;--shiki-dark:#98C379;"> their</span><span style="color:#98C379;--shiki-dark:#98C379;"> respective</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">owners.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Type</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;help;&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> or</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\\h&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> for</span><span style="color:#98C379;--shiki-dark:#98C379;"> help.</span><span style="color:#98C379;--shiki-dark:#98C379;"> Type</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;\\c&#39;</span><span style="color:#98C379;--shiki-dark:#98C379;"> to</span><span style="color:#98C379;--shiki-dark:#98C379;"> clear</span><span style="color:#98C379;--shiki-dark:#98C379;"> the</span><span style="color:#98C379;--shiki-dark:#98C379;"> current</span><span style="color:#98C379;--shiki-dark:#98C379;"> input</span><span style="color:#98C379;--shiki-dark:#98C379;"> statement.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="xem-ket-noi" tabindex="-1"><a class="header-anchor" href="#xem-ket-noi"><span>Xem kết nối</span></a></h3><p>Sau khi kết nối thành công, nếu bạn không có hoạt động tiếp theo, kết nối sẽ ở trạng thái rảnh rỗi và bạn có thể thấy nó trong lệnh <code>show processlist</code>. Nếu máy khách không có hoạt động trong một khoảng thời gian dài, trình kết nối sẽ tự động đóng nó. Thời gian này được điều chỉnh bởi tham số <code>wait_timeout</code>, giá trị mặc định là 8 giờ.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200714115031.png" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><h3 id="tao-nguoi-dung" tabindex="-1"><a class="header-anchor" href="#tao-nguoi-dung"><span>Tạo người dùng</span></a></h3><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">username</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;host&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;password&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Giải thích:</p><ul><li>username: Tên người dùng bạn muốn tạo</li><li>host: Xác định người dùng có thể đăng nhập từ máy chủ nào. Nếu là người dùng cục bộ, bạn có thể sử dụng localhost. Nếu bạn muốn người dùng có thể đăng nhập từ bất kỳ máy chủ từ xa nào, bạn có thể sử dụng ký tự đại diện <code>%</code>.</li><li>password: Mật khẩu đăng nhập của người dùng. Mật khẩu có thể để trống. Nếu để trống, người dùng có thể đăng nhập vào máy chủ mà không cần mật khẩu.</li></ul><p>Ví dụ:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">dog</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;localhost&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;123456&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">pig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;192.168.1.101_&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> IDENDIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;123456&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">pig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;123456&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">pig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">pig</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><blockquote><p>Lưu ý: Trong Mysql 8, xác thực mặc định không còn là <code>password</code>. Vì vậy, khi tạo người dùng, <code>create user &#39;username&#39;@&#39;%&#39; identified by &#39;password&#39;;</code> không thể kết nối từ máy khách.</p><p>Vì vậy, bạn cần thêm <code>IDENTIFIED WITH mysql_native_password</code>, ví dụ: <code>CREATE USER &#39;slave&#39;@&#39;%&#39; IDENTIFIED WITH mysql_native_password BY &#39;123456&#39;;</code></p></blockquote><h3 id="xem-nguoi-dung" tabindex="-1"><a class="header-anchor" href="#xem-nguoi-dung"><span>Xem người dùng</span></a></h3><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Xem tất cả người dùng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT DISTINCT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> CONCAT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;User: &#39;&#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, user, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&#39;&#39;@&#39;&#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, host, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&#39;&#39;;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> query</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h3 id="cap-quyen" tabindex="-1"><a class="header-anchor" href="#cap-quyen"><span>Cấp quyền</span></a></h3><p>Cú pháp:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> privileges </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> databasename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tablename</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TO</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;username&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;host&#39;</span></span></code></pre></div><p>Giải thích:</p><ul><li>privileges: Các quyền thực hiện của người dùng, như <code>SELECT</code>, <code>INSERT</code>, <code>UPDATE</code>, vv. Nếu muốn cấp tất cả quyền, sử dụng <code>ALL</code>.</li><li>databasename: Tên cơ sở dữ liệu.</li><li>tablename: Tên bảng. Nếu muốn cấp quyền cho người dùng trên tất cả cơ sở dữ liệu và bảng, bạn có thể sử dụng <code>*.*</code>.</li></ul><p>Ví dụ:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">GRANT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">INSERT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ON</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> test</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">user</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TO</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;pig&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ALL </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD;">TO</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;pig&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ALL </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> maindataplus.* </span><span style="color:#C678DD;--shiki-dark:#C678DD;">TO</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;pig&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Lưu ý:</p><p>Người dùng được cấp quyền bằng các lệnh trên không thể cấp quyền cho người dùng khác. Nếu bạn muốn cho phép người dùng cấp quyền, sử dụng lệnh sau:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Cấu hình quyền cụ thể cho người dùng đã chỉ định</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> privileges </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> databasename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tablename</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TO</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;username&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;host&#39;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> WITH</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> GRANT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> OPTION</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Gán tất cả quyền cho người dùng root</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> ALL </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD;">TO</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;root&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;password&#39;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> WITH</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> GRANT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> OPTION</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h3 id="thu-hoi-quyen" tabindex="-1"><a class="header-anchor" href="#thu-hoi-quyen"><span>Thu hồi quyền</span></a></h3><p>Cú pháp:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">REVOKE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> privilege </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> databasename</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">tablename</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FROM</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;username&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;host&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Giải thích:</p><p>privilege, databasename, tablename: Tương tự như phần cấp quyền.</p><p>Ví dụ:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">REVOKE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> SELECT</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;pig&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Lưu ý:</p><p>Nếu bạn đã cấp quyền cho người dùng <code>&#39;pig&#39;@&#39;%&#39;</code> như sau (hoặc tương tự): <code>GRANT SELECT ON test.user TO &#39;pig&#39;@&#39;%&#39;</code>, thì việc sử dụng lệnh <code>REVOKE SELECT ON *.* FROM &#39;pig&#39;@&#39;%&#39;;</code> sẽ không thu hồi quyền <code>SELECT</code> của người dùng trên bảng <code>user</code> trong cơ sở dữ liệu <code>test</code>. Ngược lại, nếu quyền được cấp bằng <code>GRANT SELECT ON *.* TO &#39;pig&#39;@&#39;%&#39;;</code>, thì lệnh <code>REVOKE SELECT ON test.user FROM &#39;pig&#39;@&#39;%&#39;;</code> cũng không thu hồi quyền <code>SELECT</code> của người dùng trên bảng <code>user</code> trong cơ sở dữ liệu <code>test</code>.</p><p>Bạn có thể sử dụng lệnh <code>SHOW GRANTS FOR &#39;pig&#39;@&#39;%&#39;;</code> để xem thông tin chi tiết.</p><h3 id="xem-quyen" tabindex="-1"><a class="header-anchor" href="#xem-quyen"><span>Xem quyền</span></a></h3><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Xem quyền của người dùng</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">SHOW GRANTS </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FOR</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;root&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h3 id="thay-đoi-mat-khau-nguoi-dung" tabindex="-1"><a class="header-anchor" href="#thay-đoi-mat-khau-nguoi-dung"><span>Thay đổi mật khẩu người dùng</span></a></h3><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PASSWORD</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FOR</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;username&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;host&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PASSWORD</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;newpassword&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><p>Nếu đang đăng nhập với người dùng hiện tại, sử dụng:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PASSWORD</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PASSWORD</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;newpassword&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><p>Ví dụ:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PASSWORD</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> FOR</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;pig&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> PASSWORD</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;123456&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><h3 id="sao-luu-va-khoi-phuc" tabindex="-1"><a class="header-anchor" href="#sao-luu-va-khoi-phuc"><span>Sao lưu và khôi phục</span></a></h3><p>Để sao lưu dữ liệu MySQL, chúng ta sử dụng lệnh mysqldump.</p><p>Mysqldump sẽ sao lưu dữ liệu trong cơ sở dữ liệu thành một tệp văn bản, cấu trúc bảng và dữ liệu của bảng sẽ được lưu trữ trong tệp văn bản được tạo ra.</p><p>Sao lưu:</p><h4 id="sao-luu-mot-co-so-du-lieu" tabindex="-1"><a class="header-anchor" href="#sao-luu-mot-co-so-du-lieu"><span>Sao lưu một cơ sở dữ liệu</span></a></h4><p>Cú pháp:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysqldump -h </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -P</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -u</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -p</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">database</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> [&lt;table1&gt; &lt;table2&gt; ...]</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> &gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> backup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">sql</span></span></code></pre></div><ul><li><strong><code>host</code></strong> - Máy chủ Mysql</li><li><strong><code>port</code></strong> - Cổng của máy chủ Mysql</li><li><strong><code>username</code></strong> - Tên người dùng cơ sở dữ liệu</li><li><strong><code>dbname</code></strong> - Tên cơ sở dữ liệu</li><li>Tham số table1 và table2 đại diện cho tên các bảng cần sao lưu, nếu để trống thì sao lưu toàn bộ cơ sở dữ liệu;</li><li>Tham số BackupName.sql đại diện cho tên tệp sao lưu được tạo ra, bạn có thể thêm đường dẫn tuyệt đối trước tên tệp. Thông thường, cơ sở dữ liệu được sao lưu thành một tệp có phần mở rộng là sql.</li></ul><h4 id="sao-luu-nhieu-co-so-du-lieu" tabindex="-1"><a class="header-anchor" href="#sao-luu-nhieu-co-so-du-lieu"><span>Sao lưu nhiều cơ sở dữ liệu</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysqldump -u </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -p </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">--databases &lt;database1&gt; &lt;database2&gt; ... &gt; backup.sql</span></span></code></pre></div><h4 id="sao-luu-tat-ca-co-so-du-lieu" tabindex="-1"><a class="header-anchor" href="#sao-luu-tat-ca-co-so-du-lieu"><span>Sao lưu tất cả cơ sở dữ liệu</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysqldump -u </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -p </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">--all-databases &gt; backup.sql</span></span></code></pre></div><h4 id="khoi-phuc-mot-co-so-du-lieu" tabindex="-1"><a class="header-anchor" href="#khoi-phuc-mot-co-so-du-lieu"><span>Khôi phục một cơ sở dữ liệu</span></a></h4><p>Để khôi phục dữ liệu MySQL, chúng ta sử dụng lệnh mysql.</p><p>Cú pháp:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql -h </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">host</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -P</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">port</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -u</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -p</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">database</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> &lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> backup</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">sql</span></span></code></pre></div><h4 id="khoi-phuc-tat-ca-co-so-du-lieu" tabindex="-1"><a class="header-anchor" href="#khoi-phuc-tat-ca-co-so-du-lieu"><span>Khôi phục tất cả cơ sở dữ liệu</span></a></h4><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql -u</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">username</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> -p </span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">--all-databases &lt; backup.sql</span></span></code></pre></div><h3 id="go-cai-đat" tabindex="-1"><a class="header-anchor" href="#go-cai-đat"><span>Gỡ cài đặt</span></a></h3><p>(1) Xem MySQL đã được cài đặt</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">$</span><span style="color:#98C379;--shiki-dark:#98C379;"> rpm</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -qa</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> | </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">grep</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -i</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysql</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">perl-DBD-MySQL-4.023-6.el7.x86_64</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql80-community-release-el7-1.noarch</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql-community-common-8.0.12-1.el7.x86_64</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql-community-client-8.0.12-1.el7.x86_64</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql-community-libs-compat-8.0.12-1.el7.x86_64</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql-community-libs-8.0.12-1.el7.x86_64</span></span></code></pre></div><p>(2) Gỡ cài đặt MySQL</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">yum</span><span style="color:#98C379;--shiki-dark:#98C379;"> remove</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysql-community-server.x86_64</span></span></code></pre></div><h3 id="trien-khai-master-slave" tabindex="-1"><a class="header-anchor" href="#trien-khai-master-slave"><span>Triển khai Master-Slave</span></a></h3><p>Giả sử bạn cần cấu hình một môi trường máy chủ Master-Slave cho MySQL:</p><ul><li>Node Master: 192.168.8.10</li><li>Node Slave: 192.168.8.11</li></ul><h4 id="cac-buoc-tren-node-master" tabindex="-1"><a class="header-anchor" href="#cac-buoc-tren-node-master"><span>Các bước trên Node Master</span></a></h4><p>(1) Sửa đổi cấu hình và khởi động lại</p><p>Chạy lệnh <code>vi /etc/my.cnf</code> và thêm cấu hình sau:</p><div class="language-ini" data-ext="ini" data-title="ini"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">[mysqld]</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">server-id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">log_bin</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">/var/lib/mysql/binlog</span></span></code></pre></div><ul><li><code>server-id</code> - Số ID của máy chủ. Trong kiến trúc Master-Slave, mỗi máy phải có một ID duy nhất.</li><li><code>log_bin</code> - Đường dẫn và tên tệp nhật ký đồng bộ, hãy đảm bảo rằng thư mục này có quyền ghi cho MySQL;</li></ul><p>Sau khi chỉnh sửa, khởi động lại MySQL để áp dụng cấu hình mới:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">systemctl </span><span style="color:#C678DD;--shiki-dark:#C678DD;">restart</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> mysql</span></span></code></pre></div><p>(2) Tạo người dùng cho đồng bộ hoá</p><p>Truy cập vào bảng điều khiển MySQL:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>$ mysql -u root -p</span></span>
<span class="line"><span>Password:</span></span></code></pre></div><p>Thực hiện các câu lệnh SQL sau:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- a. Tạo người dùng slave</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;password&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Cấp quyền REPLICATION SLAVE cho slave</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD;">TO</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;slave&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- b. Hoặc, tạo người dùng slave và cho phép người dùng đăng nhập từ bất kỳ máy chủ nào</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Nếu có nhiều slave và bạn muốn tất cả các slave sử dụng cùng một tên người dùng và mật khẩu, bạn có thể sử dụng cách này</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;password&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD;">TO</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;slave&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Làm mới thông tin bảng phân quyền</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">FLUSH PRIVILEGES;</span></span></code></pre></div><blockquote><p>Lưu ý: Trong MySQL 8, phương thức xác thực mặc định không còn là <code>password</code>. Vì vậy, khi tạo người dùng, <code>create user &#39;username&#39;@&#39;%&#39; identified by &#39;password&#39;;</code> không thể kết nối từ máy khách. Vì vậy, bạn cần thêm <code>IDENTIFIED WITH mysql_native_password BY &#39;password&#39;</code> khi tạo người dùng.</p></blockquote><p>SQL quản lý người dùng bổ sung:</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Xem tất cả người dùng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT DISTINCT</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> CONCAT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;User: &#39;&#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, user, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&#39;&#39;@&#39;&#39;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, host, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;&#39;&#39;;&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">AS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> query</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> mysql</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Xem quyền của người dùng</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">SHOW GRANTS </span><span style="color:#C678DD;--shiki-dark:#C678DD;">FOR</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;root&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Tạo người dùng</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- a. Tạo người dùng slave và chỉ cho phép người dùng đăng nhập từ máy chủ 192.168.8.11</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> USER</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &#39;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">slave</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&#39;@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;192.168.8.11&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> IDENTIFIED </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WITH</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> mysql_native_password </span><span style="color:#C678DD;--shiki-dark:#C678DD;">BY</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;password&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Cấp quyền REPLICATION SLAVE cho slave</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">GRANT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> REPLICATION SLAVE </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> *.* </span><span style="color:#C678DD;--shiki-dark:#C678DD;">TO</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;slave&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;192.168.8.11&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Xóa người dùng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">DROP</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> USER</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;slave&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;192.168.8.11&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>(3) Thêm khóa đọc</p><p>Để đảm bảo dữ liệu trên máy chủ chính và máy chủ phụ giữ nguyên, chúng ta sẽ thêm khóa đọc cho MySQL, biến nó thành chỉ có thể đọc.</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> FLUSH TABLES </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WITH</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> READ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> LOCK;</span></span></code></pre></div><p>(4) Xem trạng thái của máy chủ chính</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> show </span><span style="color:#C678DD;--shiki-dark:#C678DD;">master</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">------------------+----------+--------------+---------------------------------------------+-------------------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| </span><span style="color:#C678DD;--shiki-dark:#C678DD;">File</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             | Position | Binlog_Do_DB | Binlog_Ignore_DB                            | Executed_Gtid_Set |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">------------------+----------+--------------+---------------------------------------------+-------------------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| mysql-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">bin</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">000001</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> |     </span><span style="color:#D19A66;--shiki-dark:#D19A66;">4202</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> |              | mysql,information_schema,performance_schema |                   |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">------------------+----------+--------------+---------------------------------------------+-------------------+</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> row</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> in</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">00</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> sec)</span></span></code></pre></div><blockquote><p>Lưu ý: Ghi lại <code>File</code> và <code>Position</code>, chúng ta sẽ sử dụng chúng sau này.</p></blockquote><p>(5) Xuất SQL</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysqldump</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -u</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -p</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --all-databases</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --master-data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &gt; </span><span style="color:#98C379;--shiki-dark:#98C379;">dbdump.sql</span></span></code></pre></div><p>(6) Mở khóa đọc</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> UNLOCK</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> TABLES;</span></span></code></pre></div><p>(7) Truyền SQL từ xa đến máy chủ phụ</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">scp</span><span style="color:#98C379;--shiki-dark:#98C379;"> dbdump.sql</span><span style="color:#98C379;--shiki-dark:#98C379;"> root@192.168.8.11:/home</span></span></code></pre></div><h4 id="cac-buoc-tren-node-slave" tabindex="-1"><a class="header-anchor" href="#cac-buoc-tren-node-slave"><span>Các bước trên Node Slave</span></a></h4><p>(1) Sửa đổi cấu hình và khởi động lại</p><p>Chạy lệnh <code>vi /etc/my.cnf</code> và thêm cấu hình sau:</p><div class="language-ini" data-ext="ini" data-title="ini"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">[mysqld]</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">server-id</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">2</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">log_bin</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">/var/lib/mysql/binlog</span></span></code></pre></div><ul><li><code>server-id</code> - Số ID của máy chủ. Trong kiến trúc Master-Slave, mỗi máy phải có một ID duy nhất.</li><li><code>log_bin</code> - Đường dẫn và tên tệp nhật ký đồng bộ, hãy đảm bảo rằng thư mục này có quyền ghi cho MySQL;</li></ul><p>Sau khi chỉnh sửa, khởi động lại MySQL để áp dụng cấu hình mới:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">systemctl</span><span style="color:#98C379;--shiki-dark:#98C379;"> restart</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysql</span></span></code></pre></div><p>(2) Nhập SQL</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">mysql</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -u</span><span style="color:#98C379;--shiki-dark:#98C379;"> root</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -p</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt; </span><span style="color:#98C379;--shiki-dark:#98C379;">/home/dbdump.sql</span></span></code></pre></div><p>(3) Thiết lập kết nối với máy chủ chính trên máy chủ phụ</p><p>Truy cập vào bảng điều khiển MySQL:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>$ mysql -u root -p</span></span>
<span class="line"><span>Password:</span></span></code></pre></div><p>Thực hiện các câu lệnh SQL sau:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Dừng dịch vụ slave</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">STOP</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> SLAVE;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Lưu ý: MASTER_USER và</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">CHANGE </span><span style="color:#C678DD;--shiki-dark:#C678DD;">MASTER</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> TO</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">MASTER_HOST</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;192.168.8.10&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">MASTER_USER</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;slave&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">MASTER_PASSWORD</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;password&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">MASTER_LOG_FILE</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;binlog.000001&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">MASTER_LOG_POS</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">4202</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li><code>MASTER_LOG_FILE</code> và <code>MASTER_LOG_POS</code> phải tương ứng với giá trị <code>File</code> và <code>Position</code> thu được từ lệnh <code>show master status</code>.</li><li><code>MASTER_HOST</code> là địa chỉ IP của máy chủ chính.</li><li><code>MASTER_USER</code> và <code>MASTER_PASSWORD</code> là tên người dùng và mật khẩu đã đăng ký trên máy chủ chính.</li></ul><p>(4) Khởi động quá trình sao lưu</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> start</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> slave;</span></span></code></pre></div><p>(5) Kiểm tra trạng thái đồng bộ giữa máy chủ chính và máy chủ phụ</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> show slave </span><span style="color:#C678DD;--shiki-dark:#C678DD;">status</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">\\G;</span></span></code></pre></div><p>Lưu ý: Nếu cả hai tham số sau đây đều là YES, điều đó có nghĩa là cấu hình đã đúng.</p><ul><li><code>Slave_IO_Running</code></li><li><code>Slave_SQL_Running</code></li></ul><p>(6) Đặt máy chủ phụ thành chỉ đọc</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> global</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> read_only</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> global</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> super_read_only</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> show </span><span style="color:#C678DD;--shiki-dark:#C678DD;">global</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> variables </span><span style="color:#C678DD;--shiki-dark:#C678DD;">like</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;%read_only%&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-----------------------+-------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| Variable_name         | </span><span style="color:#C678DD;--shiki-dark:#C678DD;">Value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-----------------------+-------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| innodb_read_only      | </span><span style="color:#C678DD;--shiki-dark:#C678DD;">OFF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| </span><span style="color:#C678DD;--shiki-dark:#C678DD;">read_only</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">             | </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| super_read_only       | </span><span style="color:#C678DD;--shiki-dark:#C678DD;">ON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| transaction_read_only | </span><span style="color:#C678DD;--shiki-dark:#C678DD;">OFF</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-----------------------+-------+</span></span></code></pre></div><blockquote><p>Lưu ý: Đặt máy chủ phụ thành chỉ đọc không ảnh hưởng đến quá trình đồng bộ hoá Master-Slave</p></blockquote><h3 id="truy-van-cham" tabindex="-1"><a class="header-anchor" href="#truy-van-cham"><span>Truy vấn chậm</span></a></h3><p>Kiểm tra xem truy vấn chậm có được bật hay không:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">show variables </span><span style="color:#C678DD;--shiki-dark:#C678DD;">like</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;%slow_query_log&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Bạn có thể sử dụng lệnh <code>set global slow_query_log</code> để bật hoặc tắt truy vấn chậm: ON để bật; OFF để tắt.</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> global</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> slow_query_log</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;ON&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Xem ngưỡng thời gian truy vấn chậm:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">show variables </span><span style="color:#C678DD;--shiki-dark:#C678DD;">like</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;%long_query_time%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Đặt ngưỡng thời gian truy vấn chậm:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> global</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> long_query_time </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><h3 id="cap-đo-co-lap" tabindex="-1"><a class="header-anchor" href="#cap-đo-co-lap"><span>Cấp độ cô lập</span></a></h3><p>Xem cấp độ cô lập hiện tại:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> show variables </span><span style="color:#C678DD;--shiki-dark:#C678DD;">like</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;transaction_isolation&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-----------------------+-----------------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| Variable_name         | </span><span style="color:#C678DD;--shiki-dark:#C678DD;">Value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">           |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-----------------------+-----------------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| transaction_isolation | </span><span style="color:#C678DD;--shiki-dark:#C678DD;">READ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">-</span><span style="color:#C678DD;--shiki-dark:#C678DD;">COMMITTED</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-----------------------+-----------------+</span></span></code></pre></div><h2 id="cau-hinh-may-chu" tabindex="-1"><a class="header-anchor" href="#cau-hinh-may-chu"><span>Cấu hình máy chủ</span></a></h2><blockquote><p><strong><em>Trong hầu hết các trường hợp, cấu hình mặc định đã đủ để xử lý hầu hết các tình huống, không nên thay đổi cấu hình máy chủ MySQL trừ khi bạn biết rõ rằng sự thay đổi đó có lợi.</em></strong></p><p>Hãy cố gắng không sử dụng tính năng bộ nhớ cache của MySQL, vì nó yêu cầu các yêu cầu truy vấn giống nhau hoàn toàn để trúng cache. Cách tiếp cận này thực tế không hiệu quả và tăng thêm chi phí. Trong các tình huống thực tế, chúng ta thường sử dụng lưu trữ key-value như Redis để giải quyết vấn đề cache, hiệu suất cao hơn nhiều so với bộ nhớ cache truy vấn của MySQL.</p></blockquote><h3 id="đuong-dan-tep-cau-hinh" tabindex="-1"><a class="header-anchor" href="#đuong-dan-tep-cau-hinh"><span>Đường dẫn tệp cấu hình</span></a></h3><p>Trước tiên, bạn cần xác định đường dẫn tệp cấu hình MySQL.</p><p>Trên các hệ điều hành Linux khác nhau, đường dẫn tệp cấu hình MySQL có thể khác nhau. Đường dẫn thông thường là /etc/my.cnf hoặc /etc/mysql/my.cnf.</p><p>Nếu bạn không biết đường dẫn tệp cấu hình, bạn có thể thử các bước sau:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># which mysqld</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/usr/sbin/mysqld</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># /usr/sbin/mysqld --verbose --help | grep -A 1 &#39;Default options&#39;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Default</span><span style="color:#98C379;--shiki-dark:#98C379;"> options</span><span style="color:#98C379;--shiki-dark:#98C379;"> are</span><span style="color:#98C379;--shiki-dark:#98C379;"> read</span><span style="color:#98C379;--shiki-dark:#98C379;"> from</span><span style="color:#98C379;--shiki-dark:#98C379;"> the</span><span style="color:#98C379;--shiki-dark:#98C379;"> following</span><span style="color:#98C379;--shiki-dark:#98C379;"> files</span><span style="color:#98C379;--shiki-dark:#98C379;"> in</span><span style="color:#98C379;--shiki-dark:#98C379;"> the</span><span style="color:#98C379;--shiki-dark:#98C379;"> given</span><span style="color:#98C379;--shiki-dark:#98C379;"> order:</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/etc/my.cnf</span><span style="color:#98C379;--shiki-dark:#98C379;"> /etc/mysql/my.cnf</span><span style="color:#98C379;--shiki-dark:#98C379;"> /usr/etc/my.cnf</span><span style="color:#98C379;--shiki-dark:#98C379;"> ~/.my.cnf</span></span></code></pre></div><h3 id="cu-phap-cau-hinh" tabindex="-1"><a class="header-anchor" href="#cu-phap-cau-hinh"><span>Cú pháp cấu hình</span></a></h3><p><strong>Các cấu hình MySQL được thiết lập bằng chữ thường, các từ khóa được phân tách bằng dấu gạch dưới (<code>_</code>) hoặc dấu gạch ngang (<code>-</code>).</strong></p><p>Đề nghị sử dụng một kiểu cú pháp cố định để dễ dàng tìm kiếm các cấu hình.</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Hai định dạng sau đây tương đương nhau</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/usr/sbin/mysqld</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --auto-increment-offset=5</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">/usr/sbin/mysqld</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> --auto_increment_offset=5</span></span></code></pre></div><h3 id="giai-thich-cac-cau-hinh-pho-bien" tabindex="-1"><a class="header-anchor" href="#giai-thich-cac-cau-hinh-pho-bien"><span>Giải thích các cấu hình phổ biến</span></a></h3><blockquote><p>Đây là một số cấu hình cơ bản phổ biến, bạn có thể tham khảo thêm: [[MySQL Configuration]]</p></blockquote><p>Dưới đây là một mẫu cấu hình phổ biến, nội dung như sau:</p><div class="language-ini line-numbers-mode" data-ext="ini" data-title="ini"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">[mysqld]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># GENERAL</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># -------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">datadir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/lib/mysql</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">socket</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  =</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/lib/mysql/mysql.sock</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">pid_file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/lib/mysql/mysql.pid</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> mysql</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> 3306</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">default_storage_engine</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> InnoDB</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">default_time_zone</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;+8:00&#39;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">character_set_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> utf8mb4</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">collation_server</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> utf8mb4_0900_ai_ci</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># LOG</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># -------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">log_error</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/log/mysql/mysql-error.log</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">slow_query_log</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">slow_query_log_file</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/log/mysql/mysql-slow.log</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># InnoDB</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># -------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">innodb_buffer_pool_size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &lt;value&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">innodb_log_file_size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &lt;value&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">innodb_file_per_table</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> 1</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">innodb_flush_method</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> O_DIRECT</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># MyIsam</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># -------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">key_buffer_size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &lt;value&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># OTHER</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># -------------------------------------------------------------------------------</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">tmp_table_size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> 32M</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">max_heap_table_size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> 32M</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">query_cache_type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> 0</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">query_cache_size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> 0</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">max_connections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &lt;value&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">thread_cache</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> &lt;value&gt;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">open_files_limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> 65535</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">[client]</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">socket</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  =</span><span style="color:#98C379;--shiki-dark:#98C379;"> /var/lib/mysql/mysql.sock</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> =</span><span style="color:#98C379;--shiki-dark:#98C379;"> 3306</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>GENERAL <ul><li><code>datadir</code> - Đường dẫn thư mục dữ liệu MySQL</li><li><code>socket</code> - Tệp socket</li><li><code>pid_file</code> - Tệp PID</li><li><code>user</code> - Người dùng khởi động quy trình dịch vụ MySQL</li><li><code>port</code> - Số cổng dịch vụ, mặc định là <code>3306</code></li><li><code>default_storage_engine</code> - Động cơ lưu trữ mặc định của MySQL từ phiên bản 5.1 trở đi là InnoDB</li><li><code>default_time_zone</code> - Múi giờ mặc định. Hầu hết các khu vực của Trung Quốc nằm trong múi giờ GMT+8, tức là <code>+8:00</code></li><li><code>character_set_server</code> - Bộ ký tự mặc định của cơ sở dữ liệu</li><li><code>collation_server</code> - Bộ ký tự của cơ sở dữ liệu tương ứng với một số quy tắc sắp xếp, hãy chắc chắn rằng nó phù hợp với <code>character_set_server</code></li></ul></li><li>LOG <ul><li><code>log_error</code> - Đường dẫn tệp nhật ký lỗi</li><li><code>slow_query_log</code> - Có bật nhật ký truy vấn chậm hay không</li><li><code>slow_query_log_file</code> - Đường dẫn tệp nhật ký truy vấn chậm</li></ul></li><li>InnoDB <ul><li><code>innodb_buffer_pool_size</code> - InnoDB sử dụng một bộ nhớ đệm để lưu trữ chỉ mục và dữ liệu gốc, không giống như MyISAM. Kích thước bộ nhớ đệm càng lớn, số lần I/O đĩa cần thiết để truy cập dữ liệu trong bảng càng ít. <ul><li>Trên một máy chủ cơ sở dữ liệu độc lập, bạn có thể đặt biến này thành 60% - 80% của kích thước bộ nhớ vật lý của máy chủ.</li><li>Lưu ý không đặt giá trị quá lớn, nếu không sẽ chiếm dụng không gian swap của hệ thống, làm chậm hệ điều hành và giảm hiệu suất truy vấn SQL.</li><li>Giá trị mặc định: 128M, giá trị đề nghị: 60% - 80% của bộ nhớ vật lý</li></ul></li><li><code>innodb_log_file_size</code> - Kích thước tệp nhật ký. Giá trị mặc định: 48M, giá trị đề nghị: điều chỉnh kích thước dựa trên không gian đĩa của hệ thống và tốc độ tăng nhật ký</li><li><code>innodb_file_per_table</code> - Giải thích: Mặc định từ MySQL 5.7 trở đi, mỗi bảng có một không gian bảng riêng. Giá trị mặc định là 1, bật.</li><li><code>innodb_flush_method</code> - Giải thích: Điều khiển cách mở và ghi tệp dữ liệu và nhật ký redo của InnoDB, có ba chế độ: fdatasync (mặc định), O_DSYNC, O_DIRECT. Giá trị mặc định là rỗng, giá trị đề nghị: sử dụng SAN hoặc RAID, đề nghị sử dụng O_DIRECT, nếu không hiểu thì mặc định sử dụng O_DIRECT trong môi trường sản xuất <ul><li><code>fdatasync</code>: Dữ liệu tệp, bộ đệm OS -&gt; bộ đệm OS -&gt; đĩa; Tệp nhật ký, bộ đệm OS -&gt; bộ đệm OS -&gt; đĩa;</li><li><code>O_DSYNC</code>: Dữ liệu tệp, bộ đệm OS -&gt; bộ đệm OS -&gt; đĩa; Tệp nhật ký, bộ đệm OS -&gt; đĩa;</li><li><code>O_DIRECT</code>: Dữ liệu tệp, bộ đệm OS -&gt; đĩa; Tệp nhật ký, bộ đệm OS -&gt; bộ đệm OS -&gt; đĩa;</li></ul></li></ul></li><li>MyIsam <ul><li><code>key_buffer_size</code> - Xác định kích thước bộ đệm chỉ mục, cho phép chia sẻ giữa các luồng cho bảng MyISAM, không ảnh hưởng đến InnoDB. Ảnh hưởng đáng kể đến hiệu suất của MyISAM. <ul><li>Không nên đặt giá trị lớn hơn 30% dung lượng bộ nhớ khả dụng, vì một phần bộ nhớ cũng được sử dụng bởi hệ điều hành để đệm dữ liệu hàng.</li><li>Thậm chí trong trường hợp bạn không sử dụng bảng MyISAM, bạn vẫn nên đặt giá trị từ 8-64M bởi vì nó cũng được sử dụng bởi các bảng tạm thời nội bộ.</li><li>Giá trị mặc định: 8M, giá trị đề nghị: 256M hoặc 384M đối với máy chủ có 4GB RAM.</li><li>Lưu ý: Đặt giá trị quá lớn sẽ làm giảm hiệu suất tổng thể của máy chủ!</li></ul></li></ul></li><li>OTHER <ul><li><code>tmp_table_size</code> - Kích thước tối đa của bảng tạm thời trong bộ nhớ, mặc định là 16M, ở đây đặt thành 128M</li><li><code>max_heap_table_size</code> - Kích thước của bảng tạm thời được tạo bởi người dùng trong bộ nhớ, mặc định là 16M, thường được đặt cùng với <code>tmp_table_size</code> để giới hạn kích thước bảng tạm thời của người dùng. Nếu vượt quá giới hạn, MySQL sẽ tự động chuyển nó thành bảng MyISAM dựa trên đĩa, lưu trữ trong thư mục tmpdir được chỉ định, tăng tải I/O, đề nghị tăng kích thước khi có nhiều bộ nhớ.</li><li><code>query_cache_type</code> - Biến hệ thống này điều khiển việc bật và tắt chức năng bộ nhớ cache truy vấn, 0 để tắt, 1 để bật, 2 để chỉ bộ nhớ cache truy vấn khi <code>select</code> được chỉ định <code>SQL_CACHE</code>.</li><li><code>query_cache_size</code> - Giá trị mặc định là 1M, ưu điểm của bộ nhớ cache truy vấn là nó có thể cải thiện đáng kể tốc độ của máy chủ. Nếu bạn có nhiều truy vấn giống nhau và ít thay đổi bảng, bộ nhớ cache truy vấn có thể làm giảm hiệu suất thay vì tăng hiệu suất.</li><li><code>max_connections</code> - Số kết nối tối đa, có thể đặt giá trị tối đa là 16384, thường xem xét một số tổng hợp dựa trên số người dùng đồng thời trực tuyến, nếu thường xuyên gặp thông báo lỗi &quot;Too Many Connections&quot; khi truy cập, bạn cần tăng giá trị này.</li><li><code>thread_cache</code> - Khi khách hàng ngắt kết nối, máy chủ xử lý khách hàng này sẽ được lưu trữ trong bộ nhớ cache để phục vụ khách hàng tiếp theo thay vì bị hủy bỏ. Có thể tái sử dụng, giảm chi phí hệ thống. Giá trị mặc định là 9, giá trị đề nghị: hai cách lấy giá trị, <ul><li>Cách 1, dựa trên bộ nhớ vật lý, 1G -&gt; 8; 2G -&gt; 16; 3G -&gt; 32;&gt; 3G -&gt; 64;</li><li>Cách 2, dựa trên <code>show status like &#39;threads%&#39;</code>, xem giá trị Threads_connected.</li></ul></li><li><code>open_files_limit</code> - Giới hạn số mô tả tệp mà MySQL mở, mặc định tối thiểu là 1024; <ul><li>Khi open_files_limit không được cấu hình, so sánh max_connections * 5 và giá trị ulimit -n, sử dụng giá trị lớn hơn,</li><li>Khi open_file_limit được cấu hình, so sánh open_files_limit và max_connections * 5, sử dụng giá trị lớn hơn</li><li>Lưu ý: Vẫn có thể xảy ra lỗi &quot;Can&#39;t create a new thread&quot;; trong trường hợp này, quan sát giới hạn ulimit của hệ thống <code>cat /proc/mysql</code> tiến trình / giới hạn, quan sát giới hạn ulimit của tiến trình <code>cat /proc/mysql</code> / giới hạn</li><li>Nếu giá trị quá nhỏ, xem xét sửa bảng cấu hình hệ thống, <code>/etc/security/limits.conf</code> và <code>/etc/security/limits.d/90-nproc.conf</code></li></ul></li></ul></li></ul><h2 id="cac-van-đe-thuong-gap" tabindex="-1"><a class="header-anchor" href="#cac-van-đe-thuong-gap"><span>Các vấn đề thường gặp</span></a></h2><h3 id="qua-nhieu-ket-noi-too-many-connections" tabindex="-1"><a class="header-anchor" href="#qua-nhieu-ket-noi-too-many-connections"><span>Quá nhiều kết nối (Too many connections)</span></a></h3><p><strong>Hiện tượng</strong></p><p>Khi cố gắng kết nối với MySQL, bạn gặp phải lỗi &quot;Too many connections&quot;.</p><p><strong>Nguyên nhân</strong></p><p>Số lượng luồng kết nối vượt quá giá trị tối đa, từ chối truy cập.</p><p><strong>Giải pháp</strong></p><p>Nếu số lượng luồng kết nối thực tế quá lớn, bạn có thể xem xét thêm các máy chủ để phân tải công việc; nếu số lượng luồng thực tế không quá lớn, bạn có thể cấu hình <code>max_connections</code> để tăng số lượng kết nối tối đa được cho phép. Lưu ý rằng số lượng kết nối không nên quá lớn, thông thường, mỗi giây có khoảng 2000 kết nối đồng thời, bạn có thể xem xét mở rộng khi số lượng kết nối đồng thời đạt khoảng 1000 kết nối mỗi giây.</p><p>(1) Xem số lượng kết nối tối đa</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> show variables </span><span style="color:#C678DD;--shiki-dark:#C678DD;">like</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;%max_connections%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">------------------------+-------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| Variable_name          | </span><span style="color:#C678DD;--shiki-dark:#C678DD;">Value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">------------------------+-------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| max_connections        | </span><span style="color:#D19A66;--shiki-dark:#D19A66;">151</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| mysqlx_max_connections | </span><span style="color:#D19A66;--shiki-dark:#D19A66;">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">------------------------+-------+</span></span></code></pre></div><p>(2) Xem số lượng kết nối tối đa mà máy chủ đã phản hồi</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">mysql</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> show </span><span style="color:#C678DD;--shiki-dark:#C678DD;">global</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> status</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> like</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;Max_used_connections&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">----------------------+-------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| Variable_name        | </span><span style="color:#C678DD;--shiki-dark:#C678DD;">Value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">----------------------+-------+</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">| Max_used_connections | </span><span style="color:#D19A66;--shiki-dark:#D19A66;">142</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">   |</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">+</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">----------------------+-------+</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> row</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> in</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">00</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> sec)</span></span></code></pre></div><p>(3) Đặt số lượng kết nối tối đa tạm thời</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">set</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> GLOBAL</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> max_connections</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">256</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Lưu ý: Khi máy chủ khởi động lại, số lượng kết nối tối đa sẽ được đặt lại.</p><p>(4) Đặt số lượng kết nối tối đa vĩnh viễn</p><p>Chỉnh sửa tệp cấu hình <code>/etc/my.cnf</code>, thêm cấu hình sau vào phần <code>[mysqld]</code>:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">max_connections</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;">256</span></span></code></pre></div><p>Khởi động lại MySQL để áp dụng cấu hình mới.</p><p>(5) Sửa giới hạn số tệp tối đa trên Linux</p><p>Số lượng kết nối tối đa của MySQL sẽ bị giới hạn bởi số lượng tệp tối đa, <code>vim /etc/security/limits.conf</code>, thêm cấu hình cho người dùng mysql:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>mysql hard nofile 65535</span></span>
<span class="line"><span>mysql soft nofile 65535</span></span></code></pre></div><p>(6) Kiểm tra giới hạn LimitNOFILE</p><p>Nếu bạn cài đặt MySQL bằng cách sử dụng rpm, hãy kiểm tra xem tệp <strong>mysqld.service</strong> có chứa cấu hình <code>LimitNOFILE</code> không.</p><h3 id="cach-sua-chua-bang-du-lieu-bi-hong" tabindex="-1"><a class="header-anchor" href="#cach-sua-chua-bang-du-lieu-bi-hong"><span>Cách sửa chữa bảng dữ liệu bị hỏng</span></a></h3><p>Để sửa chữa bảng dữ liệu bị hỏng, bạn có thể sử dụng các phương pháp sau:</p><p>Sử dụng <code>myisamchk</code>:</p><ol><li>Trước khi sửa chữa, dừng dịch vụ MySQL.</li><li>Mở cửa sổ dòng lệnh và điều hướng đến thư mục <code>bin</code> của MySQL.</li><li>Chạy lệnh <code>myisamchk –recover</code> với đường dẫn đến tệp <code>.MYI</code> của cơ sở dữ liệu.</li></ol><p>Sử dụng lệnh <code>REPAIR TABLE</code> hoặc <code>OPTIMIZE TABLE</code>:</p><ul><li><code>REPAIR TABLE table_name</code> được sử dụng để sửa chữa bảng bị hỏng.</li><li><code>OPTIMIZE TABLE table_name</code> được sử dụng để tối ưu hóa bảng và giải phóng không gian không sử dụng. Khi các hàng dữ liệu trên bảng bị xóa, không gian trên đĩa không được giải phóng ngay lập tức. Sử dụng lệnh <code>OPTIMIZE TABLE</code> sẽ giải phóng không gian này và sắp xếp lại các hàng dữ liệu trên đĩa (lưu ý: trên đĩa, không phải trong cơ sở dữ liệu).</li></ul><h3 id="cau-truc-du-lieu" tabindex="-1"><a class="header-anchor" href="#cau-truc-du-lieu"><span>Cấu trúc dữ liệu</span></a></h3><blockquote><p><strong>Hiện tượng vấn đề</strong>: ERROR 1071: Specified key was too long; max key length is 767 bytes</p></blockquote><p><strong>Nguyên nhân vấn đề</strong>: Mặc định, MySQL không cho phép tạo chỉ mục (index) trên một cột với độ dài vượt quá 767 byte (có thể khác nhau đối với các phiên bản khác nhau).</p><p><strong>Giải pháp</strong>: Tối ưu hóa cấu trúc chỉ mục bằng cách giảm độ dài của các trường chỉ mục. Tránh sử dụng các trường quá dài cho chỉ mục.</p>`,238),e=[o];function r(p,c){return a(),n("div",null,e)}const k=s(l,[["render",r],["__file","opearation.html.vue"]]),h=JSON.parse('{"path":"/database/mysql/opearation.html","title":"MySQL Opearation","lang":"en-US","frontmatter":{"title":"MySQL Opearation","ags":["mysql"],"categories":["mysql"],"icon":"devicon:mysql","date created":"2023-07-23T00:00:00.000Z","date modified":"2023-07-23T00:00:00.000Z","order":10,"description":"MySQL Operation Nếu công ty của bạn có DBA, thì tôi xin chúc mừng bạn, bạn có thể bỏ qua việc quản trị Mysql. Nếu công ty của bạn không có DBA, hãy học cách thực hiện các hoạt đ...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/database/mysql/opearation.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"MySQL Opearation"}],["meta",{"property":"og:description","content":"MySQL Operation Nếu công ty của bạn có DBA, thì tôi xin chúc mừng bạn, bạn có thể bỏ qua việc quản trị Mysql. Nếu công ty của bạn không có DBA, hãy học cách thực hiện các hoạt đ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200714115031.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-28T15:54:38.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:modified_time","content":"2024-06-28T15:54:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"MySQL Opearation\\",\\"image\\":[\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200714115031.png\\"],\\"dateModified\\":\\"2024-06-28T15:54:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Cài đặt và triển khai","slug":"cai-đat-va-trien-khai","link":"#cai-đat-va-trien-khai","children":[{"level":3,"title":"Cài đặt trên Windows","slug":"cai-đat-tren-windows","link":"#cai-đat-tren-windows","children":[]},{"level":3,"title":"Cài đặt trên CentOS","slug":"cai-đat-tren-centos","link":"#cai-đat-tren-centos","children":[]},{"level":3,"title":"Khởi tạo mật khẩu cho cơ sở dữ liệu","slug":"khoi-tao-mat-khau-cho-co-so-du-lieu","link":"#khoi-tao-mat-khau-cho-co-so-du-lieu","children":[]},{"level":3,"title":"Cấu hình truy cập từ xa","slug":"cau-hinh-truy-cap-tu-xa","link":"#cau-hinh-truy-cap-tu-xa","children":[]},{"level":3,"title":"Bỏ qua xác thực đăng nhập","slug":"bo-qua-xac-thuc-đang-nhap","link":"#bo-qua-xac-thuc-đang-nhap","children":[]},{"level":3,"title":"Kết nối từ máy khách","slug":"ket-noi-tu-may-khach","link":"#ket-noi-tu-may-khach","children":[]},{"level":3,"title":"Xem kết nối","slug":"xem-ket-noi","link":"#xem-ket-noi","children":[]},{"level":3,"title":"Tạo người dùng","slug":"tao-nguoi-dung","link":"#tao-nguoi-dung","children":[]},{"level":3,"title":"Xem người dùng","slug":"xem-nguoi-dung","link":"#xem-nguoi-dung","children":[]},{"level":3,"title":"Cấp quyền","slug":"cap-quyen","link":"#cap-quyen","children":[]},{"level":3,"title":"Thu hồi quyền","slug":"thu-hoi-quyen","link":"#thu-hoi-quyen","children":[]},{"level":3,"title":"Xem quyền","slug":"xem-quyen","link":"#xem-quyen","children":[]},{"level":3,"title":"Thay đổi mật khẩu người dùng","slug":"thay-đoi-mat-khau-nguoi-dung","link":"#thay-đoi-mat-khau-nguoi-dung","children":[]},{"level":3,"title":"Sao lưu và khôi phục","slug":"sao-luu-va-khoi-phuc","link":"#sao-luu-va-khoi-phuc","children":[]},{"level":3,"title":"Gỡ cài đặt","slug":"go-cai-đat","link":"#go-cai-đat","children":[]},{"level":3,"title":"Triển khai Master-Slave","slug":"trien-khai-master-slave","link":"#trien-khai-master-slave","children":[]},{"level":3,"title":"Truy vấn chậm","slug":"truy-van-cham","link":"#truy-van-cham","children":[]},{"level":3,"title":"Cấp độ cô lập","slug":"cap-đo-co-lap","link":"#cap-đo-co-lap","children":[]}]},{"level":2,"title":"Cấu hình máy chủ","slug":"cau-hinh-may-chu","link":"#cau-hinh-may-chu","children":[{"level":3,"title":"Đường dẫn tệp cấu hình","slug":"đuong-dan-tep-cau-hinh","link":"#đuong-dan-tep-cau-hinh","children":[]},{"level":3,"title":"Cú pháp cấu hình","slug":"cu-phap-cau-hinh","link":"#cu-phap-cau-hinh","children":[]},{"level":3,"title":"Giải thích các cấu hình phổ biến","slug":"giai-thich-cac-cau-hinh-pho-bien","link":"#giai-thich-cac-cau-hinh-pho-bien","children":[]}]},{"level":2,"title":"Các vấn đề thường gặp","slug":"cac-van-đe-thuong-gap","link":"#cac-van-đe-thuong-gap","children":[{"level":3,"title":"Quá nhiều kết nối (Too many connections)","slug":"qua-nhieu-ket-noi-too-many-connections","link":"#qua-nhieu-ket-noi-too-many-connections","children":[]},{"level":3,"title":"Cách sửa chữa bảng dữ liệu bị hỏng","slug":"cach-sua-chua-bang-du-lieu-bi-hong","link":"#cach-sua-chua-bang-du-lieu-bi-hong","children":[]},{"level":3,"title":"Cấu trúc dữ liệu","slug":"cau-truc-du-lieu","link":"#cau-truc-du-lieu","children":[]}]}],"git":{"createdTime":1719590078000,"updatedTime":1719590078000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":20.84,"words":6252},"filePathRelative":"database/mysql/opearation.md","localizedDate":"June 28, 2024","excerpt":"\\n<blockquote>\\n<p>Nếu công ty của bạn có DBA, thì tôi xin chúc mừng bạn, bạn có thể bỏ qua việc quản trị Mysql. Nếu công ty của bạn không có DBA, hãy học cách thực hiện các hoạt động quản trị cơ bản của Mysql, đó là điều cần thiết để tự bảo vệ mình khi hoạt động trong lĩnh vực này.</p>\\n</blockquote>\\n","autoDesc":true}');export{k as comp,h as data};
