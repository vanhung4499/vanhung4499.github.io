import{_ as s,o as n,c as a,d as i}from"./app-CwNOAUqW.js";const t={},l=i(`<h1 id="elasticsearch-operation" tabindex="-1"><a class="header-anchor" href="#elasticsearch-operation"><span>Elasticsearch Operation</span></a></h1><blockquote><p><a href="https://github.com/elastic/elasticsearch" target="_blank" rel="noopener noreferrer">Elasticsearch</a> là một công cụ tìm kiếm và phân tích dữ liệu phân tán, hỗ trợ RESTful, có khả năng giải quyết một số lượng ngày càng tăng các trường hợp sử dụng. Là trung tâm của Elastic Stack, nó lưu trữ dữ liệu của bạn tập trung để tìm kiếm nhanh chóng, tinh chỉnh độ liên quan, và phân tích mạnh mẽ có thể mở rộng dễ dàng.</p></blockquote><h2 id="cai-đat-elasticsearch" tabindex="-1"><a class="header-anchor" href="#cai-đat-elasticsearch"><span>Cài đặt Elasticsearch</span></a></h2><blockquote><p><a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener noreferrer">Hướng dẫn tải và cài đặt chính thức của Elasticsearch</a></p></blockquote><p>(1) Tải và giải nén</p><p>Truy cập <a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener noreferrer">địa chỉ tải chính thức</a>, chọn phiên bản cần thiết, tải và giải nén về máy của bạn.</p><p>(2) Chạy</p><p>Chạy <code>bin/elasticsearch</code> (Trên hệ thống Windows, chạy <code>bin\\elasticsearch.bat</code>)</p><p>(3) Truy cập</p><p>Thực hiện <code>curl http://localhost:9200/</code> để kiểm tra xem dịch vụ đã khởi động chưa</p><h2 id="lap-ke-hoach-cho-cluster-elasticsearch" tabindex="-1"><a class="header-anchor" href="#lap-ke-hoach-cho-cluster-elasticsearch"><span>Lập kế hoạch cho Cluster Elasticsearch</span></a></h2><p>Cluster Elasticsearch cần được lập kế hoạch một cách hợp lý dựa trên tình hình thực tế của doanh nghiệp.</p><p>Các điểm cần xem xét:</p><ul><li>Cần triển khai bao nhiêu node trong cluster?</li><li>Có bao nhiêu index?</li><li>Mỗi index có bao nhiêu dữ liệu?</li><li>Mỗi index có bao nhiêu shard?</li></ul><p>Một kế hoạch tham khảo:</p><ul><li>3 máy, mỗi máy là 6-core 64G.</li><li>Tăng hàng ngày của cluster ES của chúng tôi là khoảng 20 triệu bản ghi, dữ liệu tăng hàng ngày là khoảng 500MB, dữ liệu tăng hàng tháng là khoảng 600 triệu, 15G. Hệ thống đã hoạt động trong vài tháng, và bây giờ tổng lượng dữ liệu trong cluster ES là khoảng 100G.</li><li>Hiện tại có 5 index trực tuyến (điều này được kết hợp với doanh nghiệp của bạn, xem dữ liệu nào của bạn có thể đặt trong ES), mỗi index có khối lượng dữ liệu là khoảng 20G, vì vậy trong khối lượng dữ liệu này, chúng tôi phân bổ 8 shard cho mỗi index, đó là 3 shard nhiều hơn mặc định là 5 shard.</li></ul><h2 id="cau-hinh-elasticsearch" tabindex="-1"><a class="header-anchor" href="#cau-hinh-elasticsearch"><span>Cấu hình Elasticsearch</span></a></h2><p>Tệp cấu hình mặc định của ES là <code>config/elasticsearch.yml</code></p><p>Dưới đây là một số thông tin cơ bản về cấu hình:</p><div class="language-yml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">cluster.name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">elasticsearch</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Cấu hình tên cụm của es, mặc định là elasticsearch, es sẽ tự động phát hiện es trong cùng một shard mạng, nếu có nhiều cụm trong cùng một shard mạng, thuộc tính này có thể được sử dụng để phân biệt các cụm khác nhau.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">node.name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;Franz Kafka&#39;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tên node, mặc định được chỉ định một cách ngẫu nhiên từ danh sách tên, danh sách này nằm trong tệp name.txt trong thư mục cấu hình trong gói jar es, trong đó có nhiều tên thú vị được thêm bởi các tác giả.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">node.master</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xác định node này có đủ điều kiện để được bầu làm node hay không, mặc định là true, es mặc định là máy đầu tiên trong cụm là master, nếu máy này bị treo thì sẽ bầu lại master.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">node.data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xác định node này có lưu trữ dữ liệu index hay không, mặc định là true.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">index.number_of_shards</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">5</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt số lượng mảnh shard mặc định cho index, mặc định là 5 mảnh.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">index.number_of_replicas</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt số lượng bản sao mặc định cho index, mặc định là 1 bản sao.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">path.conf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/path/to/conf</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt đường dẫn lưu trữ tệp cấu hình, mặc định là thư mục config trong thư mục gốc es.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">path.data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/path/to/data</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt đường dẫn lưu trữ dữ liệu index, mặc định là thư mục data trong thư mục gốc es, có thể đặt nhiều đường dẫn lưu trữ, phân cách bằng dấu phẩy, ví dụ:</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">#path.data: /path/to/data1,/path/to/data2</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">path.work</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/path/to/work</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt đường dẫn lưu trữ tệp tạm thời, mặc định là thư mục work trong thư mục gốc es.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">path.logs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/path/to/logs</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt đường dẫn lưu trữ tệp nhật ký, mặc định là thư mục logs trong thư mục gốc es</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">path.plugins</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">/path/to/plugins</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt đường dẫn lưu trữ plugin, mặc định là thư mục plugins trong thư mục gốc es</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">bootstrap.mlockall</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt true để khóa bộ nhớ. Bởi vì khi jvm bắt đầu swapping thì hiệu suất của es sẽ giảm, vì vậy để đảm bảo nó không swap, bạn có thể đặt hai biến môi trường ES_MIN_MEM và ES_MAX_MEM thành cùng một giá trị, và đảm bảo máy có đủ bộ nhớ để phân bổ cho es. Đồng thời, bạn cũng phải cho phép tiến trình elasticsearch có thể khóa bộ nhớ, trên linux bạn có thể sử dụng lệnh \`ulimit -l unlimited\`.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">network.bind_host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.0.1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt địa chỉ ip được liên kết, có thể là ipv4 hoặc ipv6, mặc định là 0.0.0.0.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">network.publish_host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.0.1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt địa chỉ ip mà các node khác và node này tương tác, nếu không đặt nó sẽ tự động xác định, giá trị phải là một địa chỉ ip thực sự.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">network.host</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">192.168.0.1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tham số này được sử dụng để đồng thời đặt bind_host và publish_host ở trên.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">transport.tcp.port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">9300</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt cổng tcp để tương tác giữa các node, mặc định là 9300.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">transport.tcp.compress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt liệu có nén dữ liệu khi truyền tải tcp hay không, mặc định là false, không nén.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">http.port</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">9200</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt cổng http phục vụ bên ngoài, mặc định là 9200.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">http.max_content_length</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">100mb</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt dung lượng tối đa của nội dung, mặc định là 100mb</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">http.enabled</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Có sử dụng giao thức http để cung cấp dịch vụ bên ngoài hay không, mặc định là true, được mở.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">gateway.type</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">local</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Loại gateway, mặc định là local tức là hệ thống tệp cục bộ, có thể đặt là hệ thống tệp cục bộ, hệ thống tệp phân tán, HDFS của hadoop, và máy chủ s3 của amazon, cách đặt hệ thống tệp khác sẽ được nói chi tiết vào lần sau.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">gateway.recover_after_nodes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt số lượng node trong cụm khi khởi động để khôi phục dữ liệu, mặc định là 1.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">gateway.recover_after_time</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">5m</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt thời gian chờ tối đa để khởi tạo quá trình khôi phục dữ liệu, mặc định là 5 phút.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">gateway.expected_nodes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt số lượng node trong cụm này, mặc định là 2, một khi N node này được khởi động, quá trình khôi phục dữ liệu sẽ được bắt đầu ngay lập tức.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">cluster.routing.allocation.node_initial_primaries_recoveries</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">4</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Khi khôi phục dữ liệu ban đầu, số lượng luồng khôi phục đồng thời, mặc định là 4.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">cluster.routing.allocation.node_concurrent_recoveries</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Khi thêm hoặc xóa node hoặc cân bằng tải, số lượng luồng khôi phục đồng thời, mặc định là 2.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">indices.recovery.max_size_per_sec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt băng thông giới hạn khi khôi phục dữ liệu, ví dụ 100mb, mặc định là 0, tức không giới hạn.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">indices.recovery.concurrent_streams</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">5</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt tham số này để giới hạn số lượng luồng đồng thời mở tối đa khi khôi phục dữ liệu từ các mảnh khác, mặc định là 5.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">discovery.zen.minimum_master_nodes</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt tham số này để đảm bảo rằng các node trong cụm có thể biết được số lượng tối thiểu N node khác có đủ điều kiện làm master. Mặc định là 1, đối với cụm lớn, có thể đặt giá trị lớn hơn một chút (2-4)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">discovery.zen.ping.timeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#98C379;--shiki-dark:#98C379;">3s</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt thời gian chờ kết nối ping khi tự động phát hiện các node khác trong cụm, mặc định là 3 giây, đối với môi trường mạng kém, có thể đặt giá trị cao hơn để ngăn chặn lỗi khi phát hiện tự động.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">discovery.zen.ping.multicast.enabled</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="color:#D19A66;--shiki-dark:#D19A66;">false</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt liệu có mở phát hiện node đa phát hay không, mặc định là true.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">discovery.zen.ping.unicast.hosts</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">: [</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;host1&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;host2:port&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;host3[portX-portY]&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Đặt danh sách ban đầu của các node master trong cụm, các node mới tham gia cụm có thể được phát hiện tự động thông qua các node này.</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="elasticsearch-faq" tabindex="-1"><a class="header-anchor" href="#elasticsearch-faq"><span>Elasticsearch FAQ</span></a></h2><h3 id="elasticsearch-khong-cho-phep-chay-voi-quyen-root" tabindex="-1"><a class="header-anchor" href="#elasticsearch-khong-cho-phep-chay-voi-quyen-root"><span>Elasticsearch không cho phép chạy với quyền root</span></a></h3><p><strong>Vấn đề:</strong> Trong môi trường Linux, Elasticsearch không cho phép chạy với quyền root.</p><p>Nếu bạn chạy Elasticsearch dưới quyền root, bạn sẽ nhận được lỗi sau:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>can not run elasticsearch as root</span></span></code></pre></div><p><strong>Cách giải quyết:</strong> Chạy Elasticsearch dưới tài khoản không có quyền root</p><div class="language-bash" data-ext="bash" data-title="bash"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tạo nhóm người dùng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">groupadd</span><span style="color:#98C379;--shiki-dark:#98C379;"> elk</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tạo người dùng mới, -g elk đặt nhóm người dùng của nó thành elk, -p elk đặt mật khẩu của nó thành elk</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">useradd</span><span style="color:#98C379;--shiki-dark:#98C379;"> elk</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -g</span><span style="color:#98C379;--shiki-dark:#98C379;"> elk</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -p</span><span style="color:#98C379;--shiki-dark:#98C379;"> elk</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Thay đổi chủ sở hữu của thư mục /opt và các tệp bên trong thành elk:elk</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">chown</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> -R</span><span style="color:#98C379;--shiki-dark:#98C379;"> elk:elk</span><span style="color:#98C379;--shiki-dark:#98C379;"> /opt</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> # Giả sử bạn đã cài đặt elasticsearch trong thư mục opt</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Chuyển đổi tài khoản</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">su</span><span style="color:#98C379;--shiki-dark:#98C379;"> elk</span></span></code></pre></div><h3 id="vm-max-map-count-khong-thap-hon-262144" tabindex="-1"><a class="header-anchor" href="#vm-max-map-count-khong-thap-hon-262144"><span>vm.max_map_count không thấp hơn 262144</span></a></h3><p><strong>Vấn đề:</strong> <code>vm.max_map_count</code> biểu thị kích thước bộ nhớ ảo, đây là một tham số kernel. Elasticsearch yêu cầu <code>vm.max_map_count</code> không thấp hơn 262144.</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>max virtual memory areas vm.max_map_count [65530] is too low, increase to at least [262144]</span></span></code></pre></div><p><strong>Cách giải quyết:</strong></p><p>Bạn có thể thực hiện lệnh sau để đặt <code>vm.max_map_count</code>, nhưng sau khi khởi động lại, nó sẽ trở lại giá trị ban đầu.</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>sysctl -w vm.max_map_count=262144</span></span></code></pre></div><p>Cách làm lâu dài là sửa đổi tham số <code>vm.max_map_count</code> trong tệp <code>/etc/sysctl.conf</code>:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>echo &quot;vm.max_map_count=262144&quot; &gt; /etc/sysctl.conf</span></span>
<span class="line"><span>sysctl -p</span></span></code></pre></div><blockquote><p><strong>Lưu ý</strong></p><p>Nếu môi trường chạy là docker container, có thể sẽ hạn chế việc thực hiện sysctl để sửa đổi tham số kernel.</p><p>Trong trường hợp này, bạn chỉ có thể chọn sửa đổi tham số trên máy chủ chủ.</p></blockquote><h3 id="nofile-khong-thap-hon-65536" tabindex="-1"><a class="header-anchor" href="#nofile-khong-thap-hon-65536"><span>nofile không thấp hơn 65536</span></a></h3><p><strong>Vấn đề:</strong> <code>nofile</code> biểu thị số lượng tệp tối đa mà một quá trình có thể mở. Quá trình Elasticsearch yêu cầu số lượng tệp tối đa có thể mở không thấp hơn 65536.</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>max file descriptors [4096] for elasticsearch process is too low, increase to at least [65536]</span></span></code></pre></div><p><strong>Cách giải quyết:</strong></p><p>Sửa đổi tham số <code>nofile</code> trong tệp <code>/etc/security/limits.conf</code>:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>echo &quot;* soft nofile 65536&quot; &gt; /etc/security/limits.conf</span></span>
<span class="line"><span>echo &quot;* hard nofile 131072&quot; &gt; /etc/security/limits.conf</span></span></code></pre></div><h3 id="nproc-khong-thap-hon-2048" tabindex="-1"><a class="header-anchor" href="#nproc-khong-thap-hon-2048"><span>nproc không thấp hơn 2048</span></a></h3><p><strong>Vấn đề:</strong> <code>nproc</code> biểu thị số lượng tối đa của các thread. Elasticsearch yêu cầu số lượng tối đa thread không thấp hơn 2048.</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>max number of threads [1024] for user [user] is too low, increase to at least [2048]</span></span></code></pre></div><p><strong>Cách giải quyết:</strong></p><p>Sửa đổi tham số <code>nproc</code> trong tệp <code>/etc/security/limits.conf</code>:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>echo &quot;* soft nproc 2048&quot; &gt; /etc/security/limits.conf</span></span>
<span class="line"><span>echo &quot;* hard nproc 4096&quot; &gt; /etc/security/limits.conf</span></span></code></pre></div><h2 id="tai-lieu-tham-khao" tabindex="-1"><a class="header-anchor" href="#tai-lieu-tham-khao"><span>Tài liệu tham khảo</span></a></h2><ul><li><a href="https://www.elastic.co/cn/downloads/elasticsearch" target="_blank" rel="noopener noreferrer">Hướng dẫn tải và cài đặt Elasticsearch chính thức</a></li><li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/rpm.html#rpm" target="_blank" rel="noopener noreferrer">Cài đặt Elasticsearch với RPM</a></li><li><a href="http://siye1982.github.io/2015/09/17/es-optimize/" target="_blank" rel="noopener noreferrer">Tích lũy sử dụng Elasticsearch</a></li></ul>`,50),e=[l];function c(o,r){return n(),a("div",null,e)}const p=s(t,[["render",c],["__file","operation.html.vue"]]),d=JSON.parse('{"path":"/database/elasticsearch/operation.html","title":"Elasticsearch Operation","lang":"en-US","frontmatter":{"title":"Elasticsearch Operation","icon":"devicon:elasticsearch","tags":["elasticssearch"],"categories":["elasticssearch"],"order":13,"description":"Elasticsearch Operation Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu phân tán, hỗ trợ RESTful, có khả năng giải quyết một số lượng ngày càng tăng các trường hợp sử...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/database/elasticsearch/operation.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"Elasticsearch Operation"}],["meta",{"property":"og:description","content":"Elasticsearch Operation Elasticsearch là một công cụ tìm kiếm và phân tích dữ liệu phân tán, hỗ trợ RESTful, có khả năng giải quyết một số lượng ngày càng tăng các trường hợp sử..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-28T15:54:38.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"elasticssearch"}],["meta",{"property":"article:modified_time","content":"2024-06-28T15:54:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Elasticsearch Operation\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-06-28T15:54:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Cài đặt Elasticsearch","slug":"cai-đat-elasticsearch","link":"#cai-đat-elasticsearch","children":[]},{"level":2,"title":"Lập kế hoạch cho Cluster Elasticsearch","slug":"lap-ke-hoach-cho-cluster-elasticsearch","link":"#lap-ke-hoach-cho-cluster-elasticsearch","children":[]},{"level":2,"title":"Cấu hình Elasticsearch","slug":"cau-hinh-elasticsearch","link":"#cau-hinh-elasticsearch","children":[]},{"level":2,"title":"Elasticsearch FAQ","slug":"elasticsearch-faq","link":"#elasticsearch-faq","children":[{"level":3,"title":"Elasticsearch không cho phép chạy với quyền root","slug":"elasticsearch-khong-cho-phep-chay-voi-quyen-root","link":"#elasticsearch-khong-cho-phep-chay-voi-quyen-root","children":[]},{"level":3,"title":"vm.max_map_count không thấp hơn 262144","slug":"vm-max-map-count-khong-thap-hon-262144","link":"#vm-max-map-count-khong-thap-hon-262144","children":[]},{"level":3,"title":"nofile không thấp hơn 65536","slug":"nofile-khong-thap-hon-65536","link":"#nofile-khong-thap-hon-65536","children":[]},{"level":3,"title":"nproc không thấp hơn 2048","slug":"nproc-khong-thap-hon-2048","link":"#nproc-khong-thap-hon-2048","children":[]}]},{"level":2,"title":"Tài liệu tham khảo","slug":"tai-lieu-tham-khao","link":"#tai-lieu-tham-khao","children":[]}],"git":{"createdTime":1719590078000,"updatedTime":1719590078000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":7.8,"words":2341},"filePathRelative":"database/elasticsearch/operation.md","localizedDate":"June 28, 2024","excerpt":"\\n<blockquote>\\n<p><a href=\\"https://github.com/elastic/elasticsearch\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Elasticsearch</a> là một công cụ tìm kiếm và phân tích dữ liệu phân tán, hỗ trợ RESTful, có khả năng giải quyết một số lượng ngày càng tăng các trường hợp sử dụng. Là trung tâm của Elastic Stack, nó lưu trữ dữ liệu của bạn tập trung để tìm kiếm nhanh chóng, tinh chỉnh độ liên quan, và phân tích mạnh mẽ có thể mở rộng dễ dàng.</p>\\n</blockquote>","autoDesc":true}');export{p as comp,d as data};
