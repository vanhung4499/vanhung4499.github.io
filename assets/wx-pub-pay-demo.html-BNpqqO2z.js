import{_ as o,g as r,o as l,c as d,e as n,h as t,f as i,w as a,a as u}from"./app-5QVbWi7Z.js";const s={};function g(f,e){const p=r("RouteLink");return l(),d("div",null,[e[14]||(e[14]=n("h1",{id:"微信公众号支付接入",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#微信公众号支付接入"},[n("span",null,"微信公众号支付接入")])],-1)),e[15]||(e[15]=n("p",null,"前置阅读：",-1)),n("p",null,[e[2]||(e[2]=t("① 阅读 ")),i(p,{to:"/pay/build/"},{default:a(()=>e[0]||(e[0]=[t("《支付功能开启》")])),_:1}),e[3]||(e[3]=t(" 和 ")),i(p,{to:"/pay/alipay-pay-demo/"},{default:a(()=>e[1]||(e[1]=[t("《支付宝支付接入》")])),_:1}),e[4]||(e[4]=t(" 文档，一定要先跑通支付宝支付流程！！！不跑通支付宝，微信公众号支付更跑不通。"))]),n("p",null,[e[6]||(e[6]=t("② 阅读 ")),i(p,{to:"/member/weixin-mp-login/"},{default:a(()=>e[5]||(e[5]=[t("《微信公众号登录》")])),_:1}),e[7]||(e[7]=t(" 文档，因为微信公众号支付需要先微信公众号登录，超级麻烦的说！"))]),n("p",null,[e[9]||(e[9]=t("注意，微信公众号支付不能使用“测试公众号”，必须使用认证过的公众号。并且，在阅读《公众号登录》文档时，前端项目需要使用 ")),i(p,{to:"/natapp/"},{default:a(()=>e[8]||(e[8]=[t("《内网穿透》")])),_:1}),e[10]||(e[10]=t("，因为微信公众号支付只能在手机微信上测试！！！"))]),e[16]||(e[16]=n("p",null,"微信公众号支付，使用 WxPubPayClient 客户端进行对接。",-1)),e[17]||(e[17]=n("p",null,[t("下面，我们以 "),n("code",null,"yudao-mall-uniapp"),t(" 商城项目，演示微信公众号支付的接入流程。")],-1)),e[18]||(e[18]=n("p",null,"友情提示：",-1)),e[19]||(e[19]=n("ul",null,[n("li",null,[n("a",{href:"http://niubi.natapp1.cc",target:"_blank",rel:"noopener noreferrer"},"http://niubi.natapp1.cc"),t(" 域名，是我前端项目的访问域名")]),n("li",null,[n("a",{href:"http://yunai.natapp1.cc",target:"_blank",rel:"noopener noreferrer"},"http://yunai.natapp1.cc"),t(" 域名，是我后端项目的访问域名")])],-1)),n("p",null,[e[12]||(e[12]=t("所以，你的前后端项目也要分别使用 ")),i(p,{to:"/natapp/"},{default:a(()=>e[11]||(e[11]=[t("《内网穿透》")])),_:1}),e[13]||(e[13]=t(" 实现独立域名！！！"))]),e[20]||(e[20]=u('<h2 id="_1-第一步-配置支付渠道" tabindex="-1"><a class="header-anchor" href="#_1-第一步-配置支付渠道"><span><a href="#_1-%E7%AC%AC%E4%B8%80%E6%AD%A5-%E9%85%8D%E7%BD%AE%E6%94%AF%E4%BB%98%E6%B8%A0%E9%81%93">#</a> 1. 第一步，配置支付渠道</span></a></h2><p>① 访问 [支付管理 -&gt; 应用信息] 菜单，点击“商城应用”对应的【微信 JSAPI 支付】，进入支付渠道的配置。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/支付手册/微信公众号支付接入/支付渠道配置.png" alt="支付渠道配置" tabindex="0" loading="lazy"><figcaption>支付渠道配置</figcaption></figure><ul><li>在 <a href="https://pay.weixin.qq.com/index.php/core/account/info" target="_blank" rel="noopener noreferrer">https://pay.weixin.qq.com/index.php/core/account/info</a> 地址，可获取微信支付商户号</li><li>在 <a href="https://pay.weixin.qq.com/index.php/core/cert/api_cert#/" target="_blank" rel="noopener noreferrer">https://pay.weixin.qq.com/index.php/core/cert/api_cert#/</a> 地址，可获取 API 证书、密钥</li></ul><p>友情提示：</p><p>可以简单阅读下 <a href="https://pay.weixin.qq.com/wiki/doc/apiv3_partner/open/pay/chapter2_1.shtml" target="_blank" rel="noopener noreferrer">《微信官方文档 —— JSAPI 支付的接入前准备》</a> 文章。</p><p>② 访问微信支付的 <a href="https://pay.weixin.qq.com/index.php/extend/pay_setting" target="_blank" rel="noopener noreferrer">开发配置</a> 地址，设置 JSAPI 支付目录，设置为前端项目的访问域名。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/支付手册/微信公众号支付接入/JSAPI支付目录.png" alt="JSAPI 支付目录" tabindex="0" loading="lazy"><figcaption>JSAPI 支付目录</figcaption></figure><h2 id="_2-支付功能测试" tabindex="-1"><a class="header-anchor" href="#_2-支付功能测试"><span><a href="#_2-%E6%94%AF%E4%BB%98%E5%8A%9F%E8%83%BD%E6%B5%8B%E8%AF%95">#</a> 2. 支付功能测试</span></a></h2><p>① IDEA 打开前端项目，搜索 <code>http://127.0.0.1:48080</code> 关键字，都替换成后端项目的访问域名。例如说下图：</p><figure><img src="https://cloud.iocoder.cn/img/支付手册/微信公众号支付接入/替换后端域名.png" alt="替换后端域名" tabindex="0" loading="lazy"><figcaption>替换后端域名</figcaption></figure><p>② 使用手机微信，访问前端项目的域名。随便找个商品下单，一路往下走，可以进入“收银台”界面（对应前端项目的 <code>pages/pay/index.vue</code> 文件）。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/支付手册/微信公众号支付接入/收银台.png" alt="收银台" tabindex="0" loading="lazy"><figcaption>收银台</figcaption></figure><p>③ 选择“微信支付”，点击“立即支付”按钮，即可进行微信支付。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/支付手册/微信公众号支付接入/立即支付.png" alt="立即支付" tabindex="0" loading="lazy"><figcaption>立即支付</figcaption></figure><ul><li>前端代码的实现，可见 <code>sheep/platform/pay.js</code> 文件的 <code>#wechatOfficialAccountPay(...)</code> 方法</li><li>后端代码的实现，可见 AppPayOrderController 提供的 <code>#submitPayOrder(...)</code> 接口</li></ul><p>④ 支付成功后，跳转到“支付结果”界面（对应前端项目的 <code>pages/pay/result.vue</code> 文件）。</p><p>友情提示：</p><p>如果这个过程中碰到问题，可以先使用「微信开发者工具」访问前端项目的域名，看看这个过程中有没什么报错。</p><p>自查 30-60 分钟，如果还是无法解决，可以在星球发帖求助！但是注意，一定要先自查，因为这玩意没环境现场，很难搞啊！！！</p>',20))])}const y=o(s,[["render",g],["__file","wx-pub-pay-demo.html.vue"]]),c=JSON.parse('{"path":"/project/yudao-cloud/pay/wx-pub-pay-demo.html","title":"微信公众号支付接入","lang":"en-US","frontmatter":{"title":"微信公众号支付接入","tags":["project","java","spring-boot","spring-cloud"],"categories":["project"],"order":84,"feed":false,"seo":false,"head":[]},"headers":[{"level":2,"title":"# 1. 第一步，配置支付渠道","slug":"_1-第一步-配置支付渠道","link":"#_1-第一步-配置支付渠道","children":[]},{"level":2,"title":"# 2. 支付功能测试","slug":"_2-支付功能测试","link":"#_2-支付功能测试","children":[]}],"git":{"createdTime":1720365235000,"updatedTime":1720365235000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":3.49,"words":1048},"filePathRelative":"project/yudao-cloud/pay/wx-pub-pay-demo.md","localizedDate":"July 7, 2024"}');export{y as comp,c as data};
