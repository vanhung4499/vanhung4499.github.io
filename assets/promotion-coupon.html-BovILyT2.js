import{_ as e,o as a,c as i,a as s}from"./app-5QVbWi7Z.js";const p={};function l(c,n){return a(),i("div",null,n[0]||(n[0]=[s('<h1 id="【营销】优惠劵" tabindex="-1"><a class="header-anchor" href="#【营销】优惠劵"><span>【营销】优惠劵</span></a></h1><p>优惠劵功能，主要由 <code>yudao-module-promotion-biz</code> 后端模块的 <code>coupon</code> 实现，包括两部分：优惠劵模版、优惠劵。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/商城手册/优惠劵/表关系.png" alt="表关系" tabindex="0" loading="lazy"><figcaption>表关系</figcaption></figure><h2 id="_1-优惠劵模版" tabindex="-1"><a class="header-anchor" href="#_1-优惠劵模版"><span><a href="#_1-%E4%BC%98%E6%83%A0%E5%8A%B5%E6%A8%A1%E7%89%88">#</a> 1. 优惠劵模版</span></a></h2><p>优惠劵模版，由卖家在管理后台配置，提供给买家领取成优惠劵，由 CouponTemplateService 类实现。</p><h3 id="_1-1-表结构" tabindex="-1"><a class="header-anchor" href="#_1-1-表结构"><span><a href="#_1-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 1.1 表结构</span></a></h3><blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>CREATE TABLE `promotion_coupon_template` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;模板编号，自增唯一。&#39;,</span></span>\n<span class="line"><span>  `name` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT &#39;优惠劵名&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `status` tinyint NOT NULL COMMENT &#39;状态&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `take_type` tinyint NOT NULL COMMENT &#39;领取方式&#39;,  </span></span>\n<span class="line"><span>  `total_count` int NOT NULL COMMENT &#39;发放数量, -1 - 则表示不限制&#39;,</span></span>\n<span class="line"><span>  `take_limit_count` tinyint NOT NULL COMMENT &#39;每人限领个数, -1 - 则表示不限制&#39;,</span></span>\n<span class="line"><span>  `take_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;领取优惠券的数量&#39;,</span></span>\n<span class="line"><span>  `use_count` int NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;使用优惠券的次数&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `use_price` int NOT NULL COMMENT &#39;是否设置满多少金额可用，单位：分&#39;,</span></span>\n<span class="line"><span>  `product_scope` tinyint NOT NULL COMMENT &#39;商品范围&#39;,</span></span>\n<span class="line"><span>  `product_scope_values` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT &#39;商品范围编号的数组&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `validity_type` tinyint NOT NULL COMMENT &#39;生效日期类型&#39;,</span></span>\n<span class="line"><span>  `valid_start_time` datetime DEFAULT NULL COMMENT &#39;固定日期-生效开始时间&#39;,</span></span>\n<span class="line"><span>  `valid_end_time` datetime DEFAULT NULL COMMENT &#39;固定日期-生效结束时间&#39;,</span></span>\n<span class="line"><span>  `fixed_start_term` int DEFAULT NULL COMMENT &#39;领取日期-开始天数&#39;,</span></span>\n<span class="line"><span>  `fixed_end_term` int DEFAULT NULL COMMENT &#39;领取日期-结束天数&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `discount_type` int NOT NULL COMMENT &#39;优惠类型：1-代金卷；2-折扣卷\\n&#39;,</span></span>\n<span class="line"><span>  `discount_percent` tinyint DEFAULT NULL COMMENT &#39;折扣百分比&#39;,</span></span>\n<span class="line"><span>  `discount_price` int DEFAULT NULL COMMENT &#39;优惠金额，单位：分&#39;,</span></span>\n<span class="line"><span>  `discount_limit_price` int DEFAULT NULL COMMENT &#39;折扣上限，仅在 discount_type 等于 2 时生效&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`) USING BTREE</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=17 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT=&#39;优惠劵模板&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>status</code> 字段：优惠劵模版状态，由 CommonStatusEnum 枚举，只有开启、禁用两个状态。禁用时，无法领取。</p><p>② 【领取限制】<code>take_type</code> 字段：领取方式，由 CouponTemplateTakeTypeEnum 枚举，分成 3 种情况：</p><ul><li>1、直接领取：展示在 uni-app 的 [首页]、[领劵中心]、[商品详情]，由用户主动领取。如下图所示：<br><img src="https://doc.iocoder.cn/img/商城手册/优惠劵/优惠劵模版-领取-直接领取.png" alt="直接领取" loading="lazy"></li><li>2、指定发放：管理员在管理后台，指定用户发放。如下图所示：<br><img src="https://doc.iocoder.cn/img/商城手册/优惠劵/优惠劵模版-领取-指定发放.png" alt="指定发放" loading="lazy"></li><li>3、新人券：买家在注册时，自动发放，由 CouponTakeByRegisterConsumer 消息消费者实现</li></ul><p>③ 【使用条件】<code>product_scope</code> 字段：商品范围，由 PromotionProductScopeEnum 枚举，分成 3 种情况：</p><ul><li>1、通用券：全部商品</li><li>2、商品券：指定商品，由 <code>product_scope_values</code> 字段指定商品编号的数组</li><li>3、品类券：指定品类，由 <code>product_scope_values</code> 字段指定品类编号的数组</li></ul><p>④ 【有效期】<code>validity_type</code> 字段：生效日期类型，由 CouponTemplateValidityTypeEnum 枚举，分成 2 种情况：</p><ul><li>1、固定日期：由 <code>valid_start_time</code>、<code>valid_end_time</code> 字段指定生效时间范围</li><li>2、领取日期：由 <code>fixed_start_term</code>、<code>fixed_end_term</code> 字段指定领取后多少天生效</li></ul><p>⑤ 【优惠金额】<code>discount_type</code> 字段：优惠类型，由 PromotionDiscountTypeEnum 枚举，分成 2 种情况：</p><ul><li>1、代金卷：由 <code>discount_price</code> 字段指定优惠金额</li><li>2、折扣卷：由 <code>discount_percent</code> 字段指定折扣百分比，由 <code>discount_limit_price</code> 字段指定折扣上限</li></ul><h3 id="_1-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_1-2-管理后台"><span><a href="#_1-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 1.2 管理后台</span></a></h3><p>对应 [商城系统 -&gt; 营销中心 -&gt; 优惠劵 -&gt; 优惠劵] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>src/views/mall/promotion/coupon/template</code> 目录。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/商城手册/优惠劵/优惠劵模版-管理后台.png" alt="管理后台" tabindex="0" loading="lazy"><figcaption>管理后台</figcaption></figure><h3 id="_1-3-移动端" tabindex="-1"><a class="header-anchor" href="#_1-3-移动端"><span><a href="#_1-3-%E7%A7%BB%E5%8A%A8%E7%AB%AF">#</a> 1.3 移动端</span></a></h3><p>① 在 uni-app 的 [我的] 有 [领劵中心]，可以领取优惠劵，对应 <code>yudao-ui-uniapp</code> 项目的 <code>pages/coupon/list.vue</code> 文件。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/商城手册/优惠劵/优惠劵模版-领劵中心.png" alt="领劵中心" tabindex="0" loading="lazy"><figcaption>领劵中心</figcaption></figure><p>② 点击 [领劵中心] 的优惠劵，可以查看该优惠劵的详情，对应 <code>yudao-ui-uniapp</code> 项目的 <code>pages/coupon/detail.vue</code> 文件。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/商城手册/优惠劵/优惠劵模版-移动端-详情.png" alt="优惠劵详情" tabindex="0" loading="lazy"><figcaption>优惠劵详情</figcaption></figure><h2 id="_2-优惠劵" tabindex="-1"><a class="header-anchor" href="#_2-优惠劵"><span><a href="#_2-%E4%BC%98%E6%83%A0%E5%8A%B5">#</a> 2. 优惠劵</span></a></h2><p>优惠劵，会员领取优惠劵模版来“生成”，由 CouponService 类实现。</p><h3 id="_2-1-表结构" tabindex="-1"><a class="header-anchor" href="#_2-1-表结构"><span><a href="#_2-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 2.1 表结构</span></a></h3><blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>CREATE TABLE `promotion_coupon` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;优惠劵编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `template_id` bigint NOT NULL COMMENT &#39;优惠劵模板编号&#39;,</span></span>\n<span class="line"><span>  `name` varchar(50) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL COMMENT &#39;优惠劵名&#39;,</span></span>\n<span class="line"><span>  `use_price` int NOT NULL COMMENT &#39;是否设置满多少金额可用，单位：分&#39;,</span></span>\n<span class="line"><span>  `take_type` tinyint NOT NULL COMMENT &#39;领取方式&#39;,</span></span>\n<span class="line"><span>  `valid_start_time` datetime NOT NULL COMMENT &#39;生效开始时间&#39;,</span></span>\n<span class="line"><span>  `valid_end_time` datetime NOT NULL COMMENT &#39;生效结束时间&#39;,</span></span>\n<span class="line"><span>  `product_scope` tinyint NOT NULL COMMENT &#39;商品范围&#39;,</span></span>\n<span class="line"><span>  `product_scope_values` varchar(500) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci DEFAULT NULL COMMENT &#39;商品范围编号的数组&#39;,</span></span>\n<span class="line"><span>  `discount_type` tinyint NOT NULL COMMENT &#39;折扣类型&#39;,</span></span>\n<span class="line"><span>  `discount_percent` tinyint DEFAULT NULL COMMENT &#39;折扣百分比&#39;,</span></span>\n<span class="line"><span>  `discount_price` int DEFAULT NULL COMMENT &#39;优惠金额，单位：分&#39;,</span></span>\n<span class="line"><span>  `discount_limit_price` int DEFAULT NULL COMMENT &#39;折扣上限&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `user_id` bigint NOT NULL COMMENT &#39;用户编号&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `status` tinyint NOT NULL COMMENT &#39;优惠码状态；1-未使用；2-已使用；3-已失效&#39;,</span></span>\n<span class="line"><span>  `use_order_id` bigint DEFAULT NULL COMMENT &#39;使用订单号&#39;,</span></span>\n<span class="line"><span>  `use_time` datetime DEFAULT NULL COMMENT &#39;使用时间&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`) USING BTREE</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=18 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci COMMENT=&#39;优惠劵&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>字段虽然也蛮多，但是都是从 <code>promotion_coupon_template</code> 中复制过来的，所以更多讲讲差异的地方。</p><p>① 【优惠劵模版】从 <code>template_id</code> 开始到 <code>discount_limit_price</code> 结束，都是从 <code>promotion_coupon_template</code> 中复制过来的，用于记录优惠劵模版的信息。</p><p>要注意，如果 <code>promotion_coupon_template</code> 中的信息发生变化，<code>promotion_coupon</code> 中的信息不会变化，因为买家已经领取了，不能随意变更。</p><p>② 【用户】<code>user_id</code> 字段：用户编号，就是领取的买家。</p><p>③ 【状态】<code>status</code> 字段：优惠码状态，由 CouponStatusEnum 枚举，分成 3 种情况：未使用、已使用、已失效。</p><p>如果已使用，会记录 <code>use_order_id</code>、<code>use_time</code> 字段，表示使用的订单编号、使用时间。</p><p>优惠劵的过期，由 CouponExpireJob 定时任务实现。</p><h3 id="_2-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_2-2-管理后台"><span><a href="#_2-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 2.2 管理后台</span></a></h3><p>对应 [商城系统 -&gt; 营销中心 -&gt; 优惠劵 -&gt; 领取记录] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>src/views/mall/promotion/coupon</code> 目录。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/商城手册/优惠劵/优惠劵-管理后台.png" alt="管理后台" tabindex="0" loading="lazy"><figcaption>管理后台</figcaption></figure><h3 id="_2-3-移动端" tabindex="-1"><a class="header-anchor" href="#_2-3-移动端"><span><a href="#_2-3-%E7%A7%BB%E5%8A%A8%E7%AB%AF">#</a> 2.3 移动端</span></a></h3><p>① 在 uni-app 的 [我的] 有 [已领取]、[已使用]、[已失效]，可以查看优惠劵，对应 <code>yudao-ui-uniapp</code> 项目的 <code>pages/coupon/list.vue</code> 文件。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/商城手册/优惠劵/优惠劵-移动端-列表.png" alt="我的优惠劵" tabindex="0" loading="lazy"><figcaption>我的优惠劵</figcaption></figure><p>② 点击某个优惠劵，可以查看该优惠劵的详情，对应 <code>yudao-ui-uniapp</code> 项目的 <code>pages/coupon/detail.vue</code> 文件。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/商城手册/优惠劵/优惠劵-移动端-详情.png" alt="优惠劵详情" tabindex="0" loading="lazy"><figcaption>优惠劵详情</figcaption></figure><p>③ 在 uni-app 下单时，可以选择优惠劵，对应 <code>yudao-ui-uniapp</code> 项目的 <code>sheep/components/s-coupon-select/s-coupon-select.vue</code> 文件。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/商城手册/优惠劵/优惠劵-移动端-确认订单.png" alt="确认订单" tabindex="0" loading="lazy"><figcaption>确认订单</figcaption></figure>',47)]))}const t=e(p,[["render",l],["__file","promotion-coupon.html.vue"]]),o=JSON.parse('{"path":"/project/rouyi-vue-pro/mall/promotion-coupon.html","title":"【营销】优惠劵","lang":"en-US","frontmatter":{"title":"【营销】优惠劵","tags":["project","java","spring-boot","spring-cloud"],"categories":["project"],"order":101,"feed":false,"seo":false,"head":[]},"headers":[{"level":2,"title":"# 1. 优惠劵模版","slug":"_1-优惠劵模版","link":"#_1-优惠劵模版","children":[{"level":3,"title":"# 1.1 表结构","slug":"_1-1-表结构","link":"#_1-1-表结构","children":[]},{"level":3,"title":"# 1.2 管理后台","slug":"_1-2-管理后台","link":"#_1-2-管理后台","children":[]},{"level":3,"title":"# 1.3 移动端","slug":"_1-3-移动端","link":"#_1-3-移动端","children":[]}]},{"level":2,"title":"# 2. 优惠劵","slug":"_2-优惠劵","link":"#_2-优惠劵","children":[{"level":3,"title":"# 2.1 表结构","slug":"_2-1-表结构","link":"#_2-1-表结构","children":[]},{"level":3,"title":"# 2.2 管理后台","slug":"_2-2-管理后台","link":"#_2-2-管理后台","children":[]},{"level":3,"title":"# 2.3 移动端","slug":"_2-3-移动端","link":"#_2-3-移动端","children":[]}]}],"git":{"createdTime":1720365235000,"updatedTime":1720365235000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":6.77,"words":2032},"filePathRelative":"project/rouyi-vue-pro/mall/promotion-coupon.md","localizedDate":"July 7, 2024"}');export{t as comp,o as data};
