import{_ as n,o as s,c as t,a as h}from"./app-5QVbWi7Z.js";const a={};function e(l,i){return s(),t("div",null,i[0]||(i[0]=[h(`<h1 id="redis-event" tabindex="-1"><a class="header-anchor" href="#redis-event"><span>Redis Event</span></a></h1><blockquote><p>Máy chủ Redis là một chương trình điều khiển sự kiện, máy chủ cần xử lý hai loại sự kiện:</p><ul><li><strong>Sự kiện tệp (file event)</strong> - Máy chủ Redis giao tiếp với các khách hàng hoặc các máy chủ khác thông qua các socket. Sự kiện tệp là một sự trừu tượng của các thao tác trên socket. Giao tiếp giữa máy chủ và khách hàng (hoặc các máy chủ khác) sẽ tạo ra các sự kiện tệp, và máy chủ sẽ hoàn thành một loạt các thao tác giao tiếp mạng bằng cách lắng nghe và xử lý các sự kiện này.</li><li><strong>Sự kiện thời gian (time event)</strong> - Máy chủ Redis có một số thao tác cần được thực hiện vào một thời điểm nhất định. Sự kiện thời gian là một sự trừu tượng của các thao tác định kỳ này.</li></ul></blockquote><h2 id="su-kien-tep" tabindex="-1"><a class="header-anchor" href="#su-kien-tep"><span>Sự kiện tệp</span></a></h2><p>Redis đã phát triển bộ xử lý sự kiện mạng của riêng mình dựa trên mô hình Reactor.</p><ul><li>Bộ xử lý sự kiện tệp của Redis sử dụng chương trình I/O đa luồng để lắng nghe đồng thời nhiều socket và liên kết các trình xử lý sự kiện khác nhau cho các socket dựa trên nhiệm vụ hiện tại của socket.</li><li>Khi socket đang được lắng nghe sẵn sàng thực hiện các thao tác kết nối phản hồi, đọc, ghi, hoặc đóng, các sự kiện tệp tương ứng với các thao tác này sẽ được tạo ra. Lúc này, bộ xử lý sự kiện tệp sẽ gọi các trình xử lý sự kiện đã liên kết trước đó với socket để xử lý các sự kiện này.</li></ul><p>Mặc dù bộ xử lý sự kiện tệp chạy theo cách đơn luồng, nhưng thông qua việc sử dụng chương trình I/O đa luồng để lắng nghe nhiều socket, bộ xử lý sự kiện tệp đã đạt được mô hình giao tiếp mạng hiệu suất cao.</p><p>Bộ xử lý sự kiện tệp bao gồm bốn thành phần: socket, chương trình I/O đa luồng, bộ phân phối sự kiện tệp, và trình xử lý sự kiện.</p><h2 id="su-kien-thoi-gian" tabindex="-1"><a class="header-anchor" href="#su-kien-thoi-gian"><span>Sự kiện thời gian</span></a></h2><p>Sự kiện thời gian được chia thành:</p><ul><li><strong>Sự kiện định thời</strong>: cho phép một đoạn chương trình được thực thi một lần vào thời điểm được chỉ định.</li><li><strong>Sự kiện chu kỳ</strong>: cho phép một đoạn chương trình được thực thi định kỳ sau khoảng thời gian được chỉ định.</li></ul><p>Redis lưu trữ tất cả các sự kiện thời gian trong một danh sách liên kết không có thứ tự. Mỗi khi bộ xử lý sự kiện thời gian chạy, nó sẽ duyệt qua toàn bộ danh sách để tìm các sự kiện thời gian đã đến hạn và gọi các trình xử lý sự kiện tương ứng.</p><h2 id="lap-lich-va-thuc-thi-su-kien" tabindex="-1"><a class="header-anchor" href="#lap-lich-va-thuc-thi-su-kien"><span>Lập lịch và thực thi sự kiện</span></a></h2><p>Máy chủ Redis cần liên tục lắng nghe các sự kiện tệp trên các socket để xử lý các sự kiện tệp đó. Tuy nhiên, không thể chỉ lắng nghe mãi mà không quan tâm đến các sự kiện thời gian, nếu không các sự kiện thời gian sẽ không được thực thi đúng lúc. Do đó, thời gian lắng nghe cần được xác định dựa trên sự kiện thời gian gần nhất so với thời điểm hiện tại.</p><p>Việc lập lịch và thực thi sự kiện được quản lý bởi hàm <code>aeProcessEvents</code>, với mã giả như sau:</p><div class="language-python line-numbers-mode" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> aeProcessEvents</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    ## Lấy sự kiện thời gian gần nhất so với thời gian hiện tại</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    time_event </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> aeSearchNearestTimer</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    ## Tính toán khoảng thời gian còn lại cho đến khi sự kiện gần nhất xảy ra</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    remaind_ms </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> time_event.when </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> unix_ts_now</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    ## Nếu sự kiện đã đến hạn, giá trị của remaind_ms có thể âm, đặt nó bằng 0</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> remaind_ms </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        remaind_ms </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    ## Tạo timeval dựa trên giá trị remaind_ms</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    timeval </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> create_timeval_with_ms</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(remaind_ms)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    ## Chặn và chờ đợi sự kiện tệp phát sinh, thời gian chặn tối đa được quyết định bởi timeval</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    aeApiPoll</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(timeval)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    ## Xử lý tất cả các sự kiện tệp đã phát sinh</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    procesFileEvents</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    ## Xử lý tất cả các sự kiện thời gian đã đến hạn</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    processTimeEvents</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đặt hàm <code>aeProcessEvents</code> trong một vòng lặp, cùng với các hàm khởi tạo và dọn dẹp, sẽ tạo thành hàm chính của máy chủ Redis, mã giả như sau:</p><div class="language-python" data-highlighter="shiki" data-ext="python" data-title="python" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">def</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    ## Khởi tạo máy chủ</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    init_server</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    ## Liên tục xử lý sự kiện cho đến khi máy chủ tắt</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    while</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> server_is_not_shutdown</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">():</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        aeProcessEvents</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    ## Máy chủ tắt, thực hiện các thao tác dọn dẹp</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    clean_server</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span></span></code></pre></div><h2 id="lap-lich-va-thuc-thi-su-kien-1" tabindex="-1"><a class="header-anchor" href="#lap-lich-va-thuc-thi-su-kien-1"><span>Lập lịch và thực thi sự kiện</span></a></h2><h3 id="cach-thuc-hoat-đong" tabindex="-1"><a class="header-anchor" href="#cach-thuc-hoat-đong"><span>Cách thức hoạt động</span></a></h3><p>Máy chủ cần liên tục lắng nghe các sự kiện tệp để xử lý chúng. Tuy nhiên, để đảm bảo các sự kiện thời gian cũng được thực thi đúng lúc, thời gian lắng nghe các sự kiện tệp được xác định dựa trên thời điểm xảy ra sự kiện thời gian gần nhất.</p><h3 id="qua-trinh-xu-ly-su-kien" tabindex="-1"><a class="header-anchor" href="#qua-trinh-xu-ly-su-kien"><span>Quá trình xử lý sự kiện</span></a></h3><ol><li>Lấy sự kiện thời gian gần nhất so với thời gian hiện tại.</li><li>Tính toán khoảng thời gian còn lại cho đến khi sự kiện xảy ra.</li><li>Nếu sự kiện đã đến hạn, đặt thời gian còn lại bằng 0.</li><li>Tạo giá trị timeval dựa trên thời gian còn lại.</li><li>Chặn và chờ đợi sự kiện tệp, thời gian chặn tối đa được quyết định bởi timeval.</li><li>Xử lý tất cả các sự kiện tệp đã phát sinh.</li><li>Xử lý tất cả các sự kiện thời gian đã đến hạn.</li></ol><h3 id="vong-lap-chinh-cua-may-chu" tabindex="-1"><a class="header-anchor" href="#vong-lap-chinh-cua-may-chu"><span>Vòng lặp chính của máy chủ</span></a></h3><p>Máy chủ Redis liên tục chạy vòng lặp để xử lý các sự kiện cho đến khi máy chủ tắt. Quy trình bao gồm khởi tạo máy chủ, xử lý sự kiện liên tục và thực hiện các thao tác dọn dẹp khi máy chủ tắt.</p>`,24)]))}const k=n(a,[["render",e],["__file","event.html.vue"]]),p=JSON.parse('{"path":"/database/redis/event.html","title":"Redis Event","lang":"en-US","frontmatter":{"title":"Redis Event","tags":["redis","nosql"],"categories":["redis"],"icon":"devicon:redis","order":8,"description":"Redis Event Máy chủ Redis là một chương trình điều khiển sự kiện, máy chủ cần xử lý hai loại sự kiện: Sự kiện tệp (file event) - Máy chủ Redis giao tiếp với các khách hàng hoặc ...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/database/redis/event.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"Redis Event"}],["meta",{"property":"og:description","content":"Redis Event Máy chủ Redis là một chương trình điều khiển sự kiện, máy chủ cần xử lý hai loại sự kiện: Sự kiện tệp (file event) - Máy chủ Redis giao tiếp với các khách hàng hoặc ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-28T15:54:38.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"redis"}],["meta",{"property":"article:tag","content":"nosql"}],["meta",{"property":"article:modified_time","content":"2024-06-28T15:54:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redis Event\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-06-28T15:54:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Sự kiện tệp","slug":"su-kien-tep","link":"#su-kien-tep","children":[]},{"level":2,"title":"Sự kiện thời gian","slug":"su-kien-thoi-gian","link":"#su-kien-thoi-gian","children":[]},{"level":2,"title":"Lập lịch và thực thi sự kiện","slug":"lap-lich-va-thuc-thi-su-kien","link":"#lap-lich-va-thuc-thi-su-kien","children":[]},{"level":2,"title":"Lập lịch và thực thi sự kiện","slug":"lap-lich-va-thuc-thi-su-kien-1","link":"#lap-lich-va-thuc-thi-su-kien-1","children":[{"level":3,"title":"Cách thức hoạt động","slug":"cach-thuc-hoat-đong","link":"#cach-thuc-hoat-đong","children":[]},{"level":3,"title":"Quá trình xử lý sự kiện","slug":"qua-trinh-xu-ly-su-kien","link":"#qua-trinh-xu-ly-su-kien","children":[]},{"level":3,"title":"Vòng lặp chính của máy chủ","slug":"vong-lap-chinh-cua-may-chu","link":"#vong-lap-chinh-cua-may-chu","children":[]}]}],"git":{"createdTime":1719590078000,"updatedTime":1719590078000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":4.52,"words":1355},"filePathRelative":"database/redis/event.md","localizedDate":"June 28, 2024","excerpt":"\\n<blockquote>\\n<p>Máy chủ Redis là một chương trình điều khiển sự kiện, máy chủ cần xử lý hai loại sự kiện:</p>\\n<ul>\\n<li><strong>Sự kiện tệp (file event)</strong> - Máy chủ Redis giao tiếp với các khách hàng hoặc các máy chủ khác thông qua các socket. Sự kiện tệp là một sự trừu tượng của các thao tác trên socket. Giao tiếp giữa máy chủ và khách hàng (hoặc các máy chủ khác) sẽ tạo ra các sự kiện tệp, và máy chủ sẽ hoàn thành một loạt các thao tác giao tiếp mạng bằng cách lắng nghe và xử lý các sự kiện này.</li>\\n<li><strong>Sự kiện thời gian (time event)</strong> - Máy chủ Redis có một số thao tác cần được thực hiện vào một thời điểm nhất định. Sự kiện thời gian là một sự trừu tượng của các thao tác định kỳ này.</li>\\n</ul>\\n</blockquote>","autoDesc":true}');export{k as comp,p as data};
