import{_ as n,o as s,c as a,d as i}from"./app-BVzepGwQ.js";const t={},l=i(`<h2 id="y-tuong" tabindex="-1"><a class="header-anchor" href="#y-tuong"><span>Ý tưởng</span></a></h2><p><strong>Singleton Pattern</strong> là một mẫu thiết kế tạo ra một đối tượng duy nhất của một lớp và cung cấp một điểm truy cập toàn cầu để truy xuất đến đối tượng đó.</p><p>Lớp Singleton khai báo một phương thức tĩnh <code>getInstance</code> để trả về một phiên bản duy nhất của lớp đó.</p><p>Hàm tạo của Singleton phải được ẩn đi để mã khách hàng không thể sử dụng toán tử <code>new</code> để tạo đối tượng.</p><p>Tất cả các triển khai của Singleton đều bao gồm hai bước chung sau:</p><ul><li><strong>Đặt hàm tạo mặc định thành riêng tư</strong> để ngăn các đối tượng khác sử dụng toán tử <code>new</code> của lớp Singleton.</li><li><strong>Tạo một phương thức tạo tĩnh như một hàm tạo</strong>. Phương thức này sẽ &quot;bí mật&quot; gọi hàm tạo riêng tư để tạo đối tượng và lưu trữ nó trong một biến thành viên tĩnh. Từ đó, mọi lần gọi phương thức này sẽ trả về đối tượng được lưu trữ trong biến thành viên.</li></ul><p>Nếu mã của bạn có thể truy cập vào lớp Singleton, nó có thể gọi phương thức tĩnh của lớp Singleton. Bất kể khi nào phương thức này được gọi, nó luôn trả về cùng một đối tượng.</p><p>Ưu điểm của Singleton Pattern:</p><ul><li>✔ Bạn có thể đảm bảo rằng một lớp chỉ có một phiên bản.</li><li>✔ Bạn có một điểm truy cập toàn cầu để truy xuất đến phiên bản đó.</li><li>✔ Chỉ khởi tạo đối tượng khi lần đầu tiên yêu cầu.</li></ul><p>Nhược điểm của Singleton Pattern:</p><ul><li>❌ Vi phạm nguyên tắc <em>đơn trách nhiệm (single responsbility)</em>. Mẫu này giải quyết cùng lúc hai vấn đề.</li><li>❌ Singleton Pattern có thể che giấu thiết kế kém chất lượng, ví dụ như các thành phần trong chương trình biết quá nhiều về nhau.</li><li>❌ Mẫu này cần xử lý đặc biệt trong môi trường đa luồng để tránh việc tạo nhiều đối tượng Singleton bởi nhiều luồng cùng một lúc.</li><li>❌ Việc kiểm thử đơn vị cho mã khách của Singleton có thể khó khăn, vì nhiều framework kiểm thử tạo đối tượng giả bằng cách kế thừa. Vì hàm tạo của lớp Singleton là riêng tư và hầu hết các ngôn ngữ không cho phép ghi đè phương thức tĩnh, bạn cần nghĩ ra cách khác để tạo đối tượng giả. Bạn có thể không viết mã kiểm thử hoặc không sử dụng Singleton Pattern.</li></ul><h2 id="ung-dung" tabindex="-1"><a class="header-anchor" href="#ung-dung"><span>Ứng dụng</span></a></h2><ul><li>Nếu một lớp trong chương trình chỉ có một phiên bản duy nhất và chỉ có thể sử dụng cho tất cả các khách hàng, bạn có thể sử dụng Singleton Pattern.<br> ⚡ Singleton Pattern ngăn chặn việc tạo đối tượng của lớp trừ khi sử dụng phương thức tạo đặc biệt. Phương thức này có thể tạo một đối tượng mới, nhưng nếu đối tượng đã được tạo, nó sẽ trả về đối tượng hiện có.</li><li>Nếu bạn cần kiểm soát biến toàn cầu một cách nghiêm ngặt, bạn có thể sử dụng Singleton Pattern.<br> ⚡ Singleton Pattern khác biệt với biến toàn cầu, nó đảm bảo chỉ có một phiên bản của lớp tồn tại. Ngoài lớp Singleton, không có cách nào thay thế phiên bản được lưu trữ.</li></ul><p>Lưu ý rằng bạn có thể điều chỉnh giới hạn và số lượng phiên bản Singleton bằng cách chỉnh sửa phương thức <code>getInstance</code> trong mã.</p><p>Ví dụ, một số trình quản lý tài nguyên thường được thiết kế theo Singleton Pattern.</p><p>Trong hệ thống máy tính, các tài nguyên cần quản lý bao gồm các tài nguyên bên ngoài phần mềm, ví dụ như mỗi máy tính có thể có nhiều máy in, nhưng chỉ có một Printer Spooler để tránh việc hai công việc in cùng lúc.</p><p>Mỗi máy tính có thể có nhiều cổng giao tiếp, hệ thống phải quản lý tập trung các cổng giao tiếp này để tránh một cổng giao tiếp bị gọi đồng thời bởi hai yêu cầu. Trình quản lý nhiệm vụ khó khăn để khởi động hai tác vụ giống nhau.</p><h2 id="cau-truc" tabindex="-1"><a class="header-anchor" href="#cau-truc"><span>Cấu trúc</span></a></h2><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20231006145225.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><ol><li>Lớp <strong>Singleton</strong> khai báo một phương thức tĩnh <code>getInstance</code> để trả về một phiên bản duy nhất của lớp đó. <ul><li>Hàm tạo của Singleton phải được ẩn đi để mã khách không thể sử dụng toán tử <code>new</code> để tạo đối tượng.</li></ul></li></ol><h2 id="pseudocode" tabindex="-1"><a class="header-anchor" href="#pseudocode"><span>Pseudocode</span></a></h2><p>Trong ví dụ này, lớp kết nối cơ sở dữ liệu là một <strong>Singleton</strong>.</p><p>Lớp này không cung cấp hàm tạo công khai, vì vậy cách duy nhất để lấy đối tượng là thông qua phương thức <code>getInstance</code>. Phương thức này sẽ lưu trữ đối tượng được tạo lần đầu tiên và trả về nó cho tất cả các lần gọi sau đó.</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Lớp cơ sở dữ liệu sẽ định nghĩa phương thức \`getInstance\` để cho phép mã khách</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// truy cập vào cùng một phiên bản kết nối cơ sở dữ liệu ở khắp mọi nơi trong chương trình.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Database</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> is</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Biến thành viên để lưu trữ phiên bản Singleton phải được khai báo là tĩnh.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> field instance: Database</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Hàm tạo của Singleton phải luôn là riêng tư để ngăn mã khách gọi trực tiếp</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // hàm tạo bằng toán tử \`new\`.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> constructor Database() is</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Một số mã khởi tạo (ví dụ: kết nối thực tế đến máy chủ cơ sở dữ liệu).</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Phương thức tĩnh để kiểm soát quyền truy cập vào phiên bản Singleton.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> method getInstance() is</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        if (Database.instance == null) then</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            acquireThreadLock() and then</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                // Đảm bảo không có luồng khác khởi tạo phiên bản trong khi luồng này đang chờ mở khóa.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                if (Database.instance == null) then</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                    Database.instance = new Database()</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        return Database.instance</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Cuối cùng, Singleton phải định nghĩa một số logic kinh doanh có thể thực hiện trên phiên bản của nó.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> method query(sql) is</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Ví dụ: tất cả các yêu cầu truy vấn cơ sở dữ liệu của ứng dụng đều phải thông qua phương thức này. Bạn có thể thêm logic giới hạn tải hoặc đệm ở đây.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Application</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> is</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    method main() is</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        Database foo = Database.getInstance()</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        foo.query(&quot;SELECT ...&quot;)</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        Database bar = Database.getInstance()</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        bar.query(&quot;SELECT ...&quot;)</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Cả biến \`bar\` và \`foo\` đều chứa cùng một đối tượng.</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="vi-du" tabindex="-1"><a class="header-anchor" href="#vi-du"><span>Ví dụ</span></a></h2><p><strong>Ví dụ sử dụng:</strong> Nhiều nhà phát triển xem mẫu Singleton là một anti-pattern. Do đó, tần suất sử dụng nó trong mã Java đang dần giảm.</p><p>Tuy nhiên, vẫn có một số ví dụ về Singleton trong thư viện lõi của Java:</p><ul><li><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/Runtime.html#getRuntime--" target="_blank" rel="noopener noreferrer"><code>java.lang.Runtime#getRuntime()</code></a></li><li><a href="http://docs.oracle.com/javase/8/docs/api/java/awt/Desktop.html#getDesktop--" target="_blank" rel="noopener noreferrer"><code>java.awt.Desktop#getDesktop()</code></a></li><li><a href="http://docs.oracle.com/javase/8/docs/api/java/lang/System.html#getSecurityManager--" target="_blank" rel="noopener noreferrer"><code>java.lang.System#getSecurityManager()</code></a></li></ul><p><strong>Cách nhận biết:</strong> Singleton có thể được nhận biết thông qua phương thức tạo tĩnh trả về cùng một đối tượng được lưu trữ trong bộ nhớ cache.</p><h3 id="lop-ket-noi-co-so-du-lieu" tabindex="-1"><a class="header-anchor" href="#lop-ket-noi-co-so-du-lieu"><span>Lớp kết nối cơ sở dữ liệu</span></a></h3><p>Lớp kết nối cơ sở dữ liệu là một ví dụ về <strong>Singleton</strong>.</p><p>Lớp này không cung cấp hàm tạo công khai, vì vậy cách duy nhất để lấy đối tượng là thông qua phương thức <code>getInstance</code>. Phương thức này sẽ lưu trữ đối tượng được tạo lần đầu tiên và trả về nó cho tất cả các lần gọi sau đó.</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// Lớp cơ sở dữ liệu định nghĩa phương thức \`getInstance\` để cho phép mã khách</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// truy cập vào cùng một phiên bản kết nối cơ sở dữ liệu ở khắp mọi nơi trong chương trình.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Database</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> is</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Biến thành viên để lưu trữ phiên bản Singleton phải được khai báo là tĩnh.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> field instance: Database</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Hàm tạo của Singleton phải luôn là riêng tư để ngăn mã khách gọi trực tiếp</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // hàm tạo bằng toán tử \`new\`.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> constructor Database() is</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Một số mã khởi tạo (ví dụ: kết nối thực tế đến máy chủ cơ sở dữ liệu).</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Phương thức tĩnh để kiểm soát quyền truy cập vào phiên bản Singleton.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> method getInstance() is</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        if (Database.instance == null) then</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            acquireThreadLock() and then</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                // Đảm bảo không có luồng khác khởi tạo phiên bản trong khi luồng này đang chờ mở khóa.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                if (Database.instance == null) then</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                    Database.instance = new Database()</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        return Database.instance</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    // Cuối cùng, Singleton phải định nghĩa một số logic kinh doanh có thể thực hiện trên phiên bản của nó.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> method query(sql) is</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Ví dụ: tất cả các yêu cầu truy vấn cơ sở dữ liệu của ứng dụng đều phải thông qua phương thức này. Bạn có thể thêm logic giới hạn tải hoặc đệm ở đây.</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Application</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> is</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    method main() is</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        Database foo = Database.getInstance()</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        foo.query(&quot;SELECT ...&quot;)</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // ...</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        Database bar = Database.getInstance()</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        bar.query(&quot;SELECT ...&quot;)</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Cả biến \`bar\` và \`foo\` đều chứa cùng một đối tượng.</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lazy-singleton-singleton-luoi" tabindex="-1"><a class="header-anchor" href="#lazy-singleton-singleton-luoi"><span>Lazy Singleton (Singleton Lười)</span></a></h3><p>Ý tưởng triển khai Lazy Singleton là: Lười không tìm kiếm, lười không muốn khởi tạo chính mình.</p><p><code>instance</code> không được khởi tạo ban đầu, chỉ khi lần đầu tiên gọi <code>getInstance()</code> thì đối tượng mới được tạo.</p><p><strong>Nhược điểm</strong>: Khi có hai luồng gọi <code>getInstance()</code> cùng một lúc và cả hai đều thực hiện đến dòng mã <code>if (null == instance)</code>, <code>instance</code> sẽ là <code>null</code>.</p><p>Tiếp tục thực thi, sẽ tạo ra hai đối tượng, vi phạm mục đích ban đầu của Singleton.</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LazySingleton</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> LazySingleton</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Singleton()&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LazySingleton</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> instance </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LazySingleton</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getInstance</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> instance) {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            instance </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> LazySingleton</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> instance;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="double-checked-locking-kiem-tra-khoa-hai-lan" tabindex="-1"><a class="header-anchor" href="#double-checked-locking-kiem-tra-khoa-hai-lan"><span>Double-Checked Locking (Kiểm tra khóa hai lần)</span></a></h3><p>Nếu không muốn tạo ra chi phí khi không cần lấy đối tượng và không muốn gặp vấn đề an toàn luồng, có thể sử dụng kiểm tra khóa hai lần.</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> SyncSingleton</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> SyncSingleton</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Singleton()&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> SyncSingleton</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> instance </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> SyncSingleton</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getInstance</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> instance) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            synchronized</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">SyncSingleton</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> instance) {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                    instance </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> SyncSingleton</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> instance;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p><strong>Lưu ý: Tại sao lại có một lần kiểm tra <code>instance</code> trong khối đồng bộ?</strong></p><p>Điều này là do nếu <code>instance</code> là <code>null</code> và hai luồng cùng gọi <code>getInstance()</code>, do cơ chế <code>synchronized</code>, chỉ cho phép một luồng đi vào, luồng còn lại phải chờ đợi.</p><p>Trong trường hợp này, nếu không có lần kiểm tra <code>instance</code> thứ hai, có thể xảy ra tình huống luồng đầu tiên tạo một đối tượng và luồng thứ hai cũng tạo một đối tượng.</p></blockquote><h2 id="moi-quan-he-voi-cac-mau-thiet-ke-khac" tabindex="-1"><a class="header-anchor" href="#moi-quan-he-voi-cac-mau-thiet-ke-khac"><span>Mối quan hệ với các mẫu thiết kế khác</span></a></h2><ul><li>Lớp [[Facade Pattern]] thường có thể được chuyển đổi thành một lớp [[Singleton Pattern]], vì trong hầu hết các trường hợp, một đối tượng facade là đủ.</li><li>Nếu bạn có thể giảm bớt tất cả các trạng thái chia sẻ của đối tượng thành một đối tượng flyweight, thì [[Flyweight Pattern]] và [[Singleton Pattern]] sẽ trở nên tương tự. Tuy nhiên, hai mẫu này có hai khác biệt cơ bản. <ol><li>Chỉ có một thực thể Singleton, trong khi lớp flyweight có thể có nhiều thực thể và có thể có trạng thái nội tại khác nhau.</li><li>Đối tượng Singleton có thể thay đổi, trong khi đối tượng flyweight là không thay đổi.</li></ol></li><li>[[Abstract Factory Pattern]], [[Builder Pattern]] và [[Prototype Pattern]] đều có thể được triển khai bằng [[Singleton Pattern]].</li></ul>`,45),e=[l];function c(o,r){return s(),a("div",null,e)}const h=n(t,[["render",c],["__file","singleton.html.vue"]]),d=JSON.parse('{"path":"/design/design-pattern/patterns/creational/singleton.html","title":"Singleton Pattern","lang":"en-US","frontmatter":{"title":"Singleton Pattern","tags":["design-pattern"],"categories":["design-pattern"],"date created":"2023-10-06T00:00:00.000Z","date modified":"2023-10-06T00:00:00.000Z","description":"Ý tưởng Singleton Pattern là một mẫu thiết kế tạo ra một đối tượng duy nhất của một lớp và cung cấp một điểm truy cập toàn cầu để truy xuất đến đối tượng đó. Lớp Singleton khai ...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/design/design-pattern/patterns/creational/singleton.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"Singleton Pattern"}],["meta",{"property":"og:description","content":"Ý tưởng Singleton Pattern là một mẫu thiết kế tạo ra một đối tượng duy nhất của một lớp và cung cấp một điểm truy cập toàn cầu để truy xuất đến đối tượng đó. Lớp Singleton khai ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20231006145225.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-28T15:54:38.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"design-pattern"}],["meta",{"property":"article:modified_time","content":"2024-06-28T15:54:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Singleton Pattern\\",\\"image\\":[\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20231006145225.png\\"],\\"dateModified\\":\\"2024-06-28T15:54:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Ý tưởng","slug":"y-tuong","link":"#y-tuong","children":[]},{"level":2,"title":"Ứng dụng","slug":"ung-dung","link":"#ung-dung","children":[]},{"level":2,"title":"Cấu trúc","slug":"cau-truc","link":"#cau-truc","children":[]},{"level":2,"title":"Pseudocode","slug":"pseudocode","link":"#pseudocode","children":[]},{"level":2,"title":"Ví dụ","slug":"vi-du","link":"#vi-du","children":[{"level":3,"title":"Lớp kết nối cơ sở dữ liệu","slug":"lop-ket-noi-co-so-du-lieu","link":"#lop-ket-noi-co-so-du-lieu","children":[]},{"level":3,"title":"Lazy Singleton (Singleton Lười)","slug":"lazy-singleton-singleton-luoi","link":"#lazy-singleton-singleton-luoi","children":[]},{"level":3,"title":"Double-Checked Locking (Kiểm tra khóa hai lần)","slug":"double-checked-locking-kiem-tra-khoa-hai-lan","link":"#double-checked-locking-kiem-tra-khoa-hai-lan","children":[]}]},{"level":2,"title":"Mối quan hệ với các mẫu thiết kế khác","slug":"moi-quan-he-voi-cac-mau-thiet-ke-khac","link":"#moi-quan-he-voi-cac-mau-thiet-ke-khac","children":[]}],"git":{"createdTime":1719590078000,"updatedTime":1719590078000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":8.55,"words":2566},"filePathRelative":"design/design-pattern/patterns/creational/singleton.md","localizedDate":"June 28, 2024","excerpt":"<h2>Ý tưởng</h2>\\n<p><strong>Singleton Pattern</strong> là một mẫu thiết kế tạo ra một đối tượng duy nhất của một lớp và cung cấp một điểm truy cập toàn cầu để truy xuất đến đối tượng đó.</p>\\n<p>Lớp Singleton khai báo một phương thức tĩnh <code>getInstance</code> để trả về một phiên bản duy nhất của lớp đó.</p>","autoDesc":true}');export{h as comp,d as data};
