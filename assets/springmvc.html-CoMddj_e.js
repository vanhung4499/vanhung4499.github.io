import{_ as s,o as a,c as n,a as t}from"./app-CIGQMwlz.js";const l={};function h(e,i){return a(),n("div",null,i[0]||(i[0]=[t(`<h1 id="springmvc" tabindex="-1"><a class="header-anchor" href="#springmvc"><span>SpringMVC</span></a></h1><hr><blockquote><p>Bài viết này cung cấp mã nguồn đầy đủ, bạn có thể xem tại <a href="https://github.com/YunaiV/SpringBoot-Labs" target="_blank" rel="noopener noreferrer">https://github.com/YunaiV/SpringBoot-Labs</a> trong thư mục <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23" target="_blank" rel="noopener noreferrer">lab-23</a>.</p><p>Việc sáng tạo nội dung không hề dễ dàng, hãy ủng hộ mình bằng cách tặng một <a href="https://github.com/YunaiV/SpringBoot-Labs/stargazers" target="_blank" rel="noopener noreferrer">Star</a>, cùng nhau phát triển nhé!</p></blockquote><h1 id="_1-tong-quan" tabindex="-1"><a class="header-anchor" href="#_1-tong-quan"><span>1. Tổng quan</span></a></h1><p>Nếu bạn đã từng làm việc với phát triển Java Web từ sớm, có thể bạn đã biết đến những framework Web MVC dưới đây. Thời kỳ đó là thời đại mà <a href="https://struts.apache.org/" target="_blank" rel="noopener noreferrer">Struts2</a> và <a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web.html" target="_blank" rel="noopener noreferrer">SpringMVC</a> cùng nhau thống trị. Thậm chí, khi đi phỏng vấn, một câu hỏi phổ biến là: &quot;Sự khác biệt giữa SpringMVC và Struts2 là gì?&quot;</p><p>Hiện nay, SpringMVC gần như đã chiếm lĩnh hoàn toàn vị trí của các framework Web MVC khác, và rất hiếm khi bạn gặp phải một dự án không sử dụng SpringMVC.</p><blockquote><p>Nếu hiện tại bạn gặp phải một công việc với Struts thì tôi khuyên bạn là hãy bỏ qua nó vì nó đã rất cũ!</p></blockquote><p>So với Struts2, SpringMVC dễ sử dụng hơn và có hiệu suất tốt hơn, với cách triển khai rõ ràng và sáng sủa hơn. Quan trọng hơn cả, SpringMVC có một hệ sinh thái mạnh mẽ và cộng đồng rất sôi động.</p><p>Vì đây là một bài viết hướng dẫn tích hợp Spring Boot với SpringMVC, mình sẽ không nói thêm nhiều, mà sẽ đi thẳng vào phần hướng dẫn nhập môn nhanh. Tuy nhiên, cần lưu ý rằng, bạn nên nắm rõ quy trình xử lý yêu cầu của SpringMVC để có thể hiểu thấu đáo cách nó hoạt động.</p><h1 id="_2-huong-dan-nhanh" tabindex="-1"><a class="header-anchor" href="#_2-huong-dan-nhanh"><span>2. Hướng dẫn nhanh</span></a></h1><blockquote><p>Mã ví dụ tương ứng với kho lưu trữ: <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-01" target="_blank" rel="noopener noreferrer">lab-springmvc-23-01</a>.</p></blockquote><p>Trong phần này, chúng ta sẽ sử dụng <a href="https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-web" target="_blank" rel="noopener noreferrer"><code>spring-boot-starter-web</code></a> để triển khai cấu hình tự động của SpringMVC. Sau đó, thực hiện các API cho việc thêm, xóa, sửa, và xem thông tin người dùng. Danh sách API như sau:</p><table><thead><tr><th>Phương thức</th><th>URL</th><th>Chức năng</th></tr></thead><tbody><tr><td><code>GET</code></td><td><code>/users</code></td><td>Xem danh sách người dùng</td></tr><tr><td><code>GET</code></td><td><code>/users/{id}</code></td><td>Lấy thông tin người dùng theo ID</td></tr><tr><td><code>POST</code></td><td><code>/users</code></td><td>Thêm người dùng</td></tr><tr><td><code>PUT</code></td><td><code>/users/{id}</code></td><td>Cập nhật thông tin người dùng theo ID</td></tr><tr><td><code>DELETE</code></td><td><code>/users/{id}</code></td><td>Xóa người dùng theo ID</td></tr></tbody></table><p>Bây giờ, hãy bắt đầu hành trình khám phá!</p><h2 id="_2-1-cac-chu-thich-annotation" tabindex="-1"><a class="header-anchor" href="#_2-1-cac-chu-thich-annotation"><span>2.1 Các chú thích (Annotation)</span></a></h2><p>Có thể một số bạn chưa từng sử dụng SpringMVC trước đây, nên trong phần này, chúng ta sẽ giới thiệu các chú thích mà SpringMVC cung cấp.</p><ul><li><code>@Controller</code></li><li><code>@RestController</code></li><li><code>@RequestMapping</code></li><li><code>@GetMapping</code></li><li><code>@PostMapping</code></li><li><code>@PutMapping</code></li><li><code>@RequestParam</code></li><li><code>@PathVariable</code></li></ul><p>Những bạn đã quen thuộc có thể lướt qua hoặc bỏ qua phần này.</p><h3 id="_2-1-1-controller" tabindex="-1"><a class="header-anchor" href="#_2-1-1-controller"><span>2.1.1 @Controller</span></a></h3><p>Chú thích <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-context/src/main/java/org/springframework/stereotype/Controller.java" target="_blank" rel="noopener noreferrer"><code>@Controller</code></a> được thêm vào lớp, cho biết đây là một đối tượng Controller. Thuộc tính như sau:</p><ul><li>Thuộc tính <code>name</code>: tên của đối tượng Controller. Có thể để trống.</li></ul><p>Chú thích <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/bind/annotation/RestController.java" target="_blank" rel="noopener noreferrer"><code>@RestController</code></a> là sự kết hợp giữa <code>@Controller</code> và <a href="https://github.com/ndimiduk/spring-framework/blob/master/org.springframework.web/src/main/java/org/springframework/web/bind/annotation/ResponseBody.java" target="_blank" rel="noopener noreferrer"><code>@ResponseBody</code></a>, tự động trả về kết quả của phương thức API dưới dạng JSON/XML mà không cần trình xử lý view.</p><p>Hiện nay, kiến trúc phổ biến là kiến trúc <strong>tách biệt front-end và back-end</strong>, trong đó back-end chỉ cung cấp các API và trả về dữ liệu. Vì vậy, 99,99% các dự án đều sử dụng chú thích <code>@RestController</code>.</p><p>Thường thì API chúng ta cung cấp có phong cách Restful hoặc gần giống Restful. Nếu bạn chưa quen, có thể tham khảo hai bài viết sau:</p><ul><li><a href="http://www.iocoder.cn/Fight/estful-api-best-practices.html" target="_blank" rel="noopener noreferrer">“Thực hành tốt nhất cho RESTful API”</a></li><li><a href="http://www.iocoder.cn/Fight/Learn-Restful-HTTP-API-design-from-Github" target="_blank" rel="noopener noreferrer">“Học thiết kế Restful HTTP API từ GitHub”</a></li></ul><h3 id="_2-1-2-requestmapping" tabindex="-1"><a class="header-anchor" href="#_2-1-2-requestmapping"><span>2.1.2 @RequestMapping</span></a></h3><p>Chú thích <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/bind/annotation/RequestMapping.java" target="_blank" rel="noopener noreferrer"><code>@RequestMapping</code></a> được thêm vào lớp hoặc phương thức để cấu hình thông tin về các API.</p><p>Thuộc tính <strong>thường dùng</strong> của <code>@RequestMapping</code>:</p><ul><li><code>path</code>: Đường dẫn API. Là một mảng <code>[]</code>, có thể chỉ định nhiều đường dẫn.</li><li><code>values</code>: Tương tự như thuộc tính <code>path</code>, là một tên khác của nó.</li><li><code>method</code>: Phương thức yêu cầu (GET, POST, PUT, DELETE,...). Là một mảng <code>[]</code>, có thể chỉ định nhiều phương thức. Nếu để trống, mặc định sẽ chấp nhận mọi phương thức.</li></ul><p>Thuộc tính <strong>ít dùng hơn</strong> của <code>@RequestMapping</code>:</p><ul><li><code>name</code>: Tên API. Thường không được điền.</li><li><code>params</code>: Các tham số yêu cầu phải có trong yêu cầu.</li><li><code>headers</code>: Tương tự như <code>params</code>, nhưng cho tiêu đề yêu cầu (headers).</li><li><code>consumes</code>: Định nghĩa loại dữ liệu đầu vào (Content-Type).</li><li><code>produces</code>: Định nghĩa loại dữ liệu trả về (Accept).</li></ul><p>Spring cung cấp các chú thích ngắn gọn hơn cho mỗi phương thức yêu cầu:</p><ul><li><a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/bind/annotation/GetMapping.java" target="_blank" rel="noopener noreferrer"><code>@GetMapping</code></a>: Tương ứng với yêu cầu GET.</li><li><a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/bind/annotation/PostMapping.java" target="_blank" rel="noopener noreferrer"><code>@PostMapping</code></a>: Tương ứng với yêu cầu POST.</li><li><a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/bind/annotation/PutMapping.java" target="_blank" rel="noopener noreferrer"><code>@PutMapping</code></a>: Tương ứng với yêu cầu PUT.</li><li><a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/bind/annotation/DeleteMapping.java" target="_blank" rel="noopener noreferrer"><code>@DeleteMapping</code></a>: Tương ứng với yêu cầu DELETE.</li></ul><h3 id="_2-1-3-requestparam" tabindex="-1"><a class="header-anchor" href="#_2-1-3-requestparam"><span>2.1.3 @RequestParam</span></a></h3><p>Chú thích <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/bind/annotation/RequestParam.java" target="_blank" rel="noopener noreferrer"><code>@RequestParam</code></a> được dùng để ánh xạ tham số yêu cầu từ URL vào phương thức.</p><p>Các thuộc tính:</p><ul><li><code>name</code>: Tên tham số yêu cầu.</li><li><code>value</code>: Tên khác của <code>name</code>.</li><li><code>required</code>: Có bắt buộc phải truyền tham số hay không. Mặc định là <code>true</code>.</li><li><code>defaultValue</code>: Giá trị mặc định nếu tham số không được truyền.</li></ul><p>Chú thích <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/bind/annotation/PathVariable.java" target="_blank" rel="noopener noreferrer"><code>@PathVariable</code></a> dùng để ánh xạ giá trị từ URL vào biến của phương thức.</p><h2 id="_2-2-them-phu-thuoc" tabindex="-1"><a class="header-anchor" href="#_2-2-them-phu-thuoc"><span>2.2 Thêm phụ thuộc</span></a></h2><p>Trong tệp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/pom.xml" target="_blank" rel="noopener noreferrer"><code>pom.xml</code></a>, hãy thêm các phụ thuộc cần thiết.</p><div class="language-xml line-numbers-mode" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;?</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">xml</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> version</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;1.0&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> encoding</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;UTF-8&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">project</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> xmlns</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://maven.apache.org/POM/4.0.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">         xmlns:xsi</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">         xsi:schemaLocation</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">parent</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;spring-boot-starter-parent&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;2.1.3.RELEASE&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">relativePath</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">/&gt; </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&lt;!-- lookup parent from repository --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">parent</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">modelVersion</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;4.0.0&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">modelVersion</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;lab-springmvc-23-01&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependencies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        &lt;!-- Tự động cấu hình Spring MVC --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;spring-boot-starter-web&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        &lt;!-- Dễ dàng viết kiểm thử đơn vị --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;org.springframework.boot&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;spring-boot-starter-test&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">scope</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;test&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">scope</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependencies</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">project</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Mỗi phụ thuộc cụ thể có tác dụng gì, bạn hãy xem kỹ các chú thích mà tác giả đã thêm vào.</p><h2 id="_2-3-application" tabindex="-1"><a class="header-anchor" href="#_2-3-application"><span>2.3 Application</span></a></h2><p>Tạo lớp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/src/main/java/cn/iocoder/springboot/lab23/springmvc/Application.java" target="_blank" rel="noopener noreferrer"><code>Application.java</code></a> và cấu hình chú thích <code>@SpringBootApplication</code>. Mã như sau:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SpringBootApplication</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        SpringApplication</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, args);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Tạm thời chưa khởi động dự án. Chúng ta sẽ làm điều đó sau khi thêm Controller.</p><h2 id="_2-4-usercontroller" tabindex="-1"><a class="header-anchor" href="#_2-4-usercontroller"><span>2.4 UserController</span></a></h2><p>Trong đường dẫn gói <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/src/main/java/cn/iocoder/springboot/lab23/springmvc/controller/" target="_blank" rel="noopener noreferrer"><code>cn.iocoder.springboot.lab23.springmvc</code></a>, tạo lớp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/src/main/java/cn/iocoder/springboot/lab23/springmvc/controller/UserController.java" target="_blank" rel="noopener noreferrer">UserController</a>. Mã như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserController.java</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/users&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserController</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Truy vấn danh sách người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> danh sách người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> List</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> list</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Truy vấn danh sách</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ArrayList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;yudaoyuanma&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;woshiyutou&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;chifanshuijiao&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trả về danh sách</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> result;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Nhận người dùng theo ID xác định</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ID người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/{id}&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserVO</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Truy vấn và trả về người dùng</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(id).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;username:&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> id);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Thêm người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> addDTO</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> thông tin người dùng cần thêm</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ID người dùng đã thêm thành công</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserAddDTO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> addDTO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Chèn bản ghi người dùng và trả về ID</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> returnId</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trả về ID người dùng</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> returnId;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Cập nhật người dùng theo ID xác định</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ID người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> updateDTO</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> thông tin người dùng cần cập nhật</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> trạng thái cập nhật thành công</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PutMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/{id}&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> update</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserUpdateDTO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> updateDTO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Đặt ID vào updateDTO</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        updateDTO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(id);</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Cập nhật bản ghi người dùng</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        Boolean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> success</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trả về trạng thái cập nhật</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> success;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Xóa người dùng theo ID xác định</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ID người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> trạng thái xóa thành công</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">DeleteMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/{id}&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> delete</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Xóa bản ghi người dùng</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        Boolean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> success</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trả về trạng thái xóa</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> success;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Thêm chú thích <code>@RestController</code> lên lớp, cho biết rằng sẽ trả về kết quả trực tiếp từ API. Mặc định, JSON được sử dụng làm phương thức tuần tự hóa.</p></li><li><p>Thêm chú thích <code>@RequestMapping(&quot;/users&quot;)</code> lên lớp, cho biết rằng tất cả các đường dẫn API của UserController đều bắt đầu bằng <code>/users</code>.</p></li><li><p>Phương thức <code>#list()</code> truy vấn danh sách người dùng. Yêu cầu tương ứng với <code>GET /users</code>, kết quả yêu cầu là:</p><div class="language-json" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        &quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        &quot;username&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;yudaoyuanma&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        &quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        &quot;username&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;woshiyutou&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    },</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        &quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        &quot;username&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;chifanshuijiao&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">]</span></span></code></pre></div><ul><li>Trong đó, <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/src/main/java/cn/iocoder/springboot/lab23/springmvc/vo/UserVO.java" target="_blank" rel="noopener noreferrer">UserVO</a> là lớp VO trả về cho người dùng.</li></ul></li><li><p>Phương thức <code>#get(Integer id)</code> nhận người dùng theo ID xác định. Yêu cầu tương ứng với <code>GET /users/{id}</code> [tham số đường dẫn], kết quả yêu cầu là:</p><div class="language-json" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;username&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;username:1&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div></li><li><p>Phương thức <code>#add(UserAddDTO addDTO)</code> thêm người dùng. Yêu cầu tương ứng với <code>POST /users</code>, kết quả yêu cầu là:</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>1</span></span></code></pre></div><ul><li>Bởi vì chúng ta trả về kiểu Integer, không cần phải sử dụng JSON để tuần tự hóa trả về cho các đối tượng không phải POJO.</li><li>Trong đó, <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/src/main/java/cn/iocoder/springboot/lab23/springmvc/dto/UserAddDTO.java" target="_blank" rel="noopener noreferrer">UserAddDTO</a> là lớp DTO để thêm người dùng.</li></ul></li><li><p>Phương thức <code>#update(Integer id, UserUpdateDTO updateDTO)</code> cập nhật người dùng theo ID xác định. Yêu cầu tương ứng với <code>PUT /users/{id}</code> [tham số đường dẫn], kết quả yêu cầu là:</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>true</span></span></code></pre></div><ul><li>Trong đó, <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/src/main/java/cn/iocoder/springboot/lab23/springmvc/dto/UserUpdateDTO.java" target="_blank" rel="noopener noreferrer">UserUpdateDTO</a> là lớp DTO để cập nhật người dùng.</li></ul></li><li><p>Phương thức <code>#delete(Integer id)</code> xóa người dùng theo ID xác định. Yêu cầu tương ứng với <code>DELETE /users/{id}</code> [tham số đường dẫn], kết quả yêu cầu là:</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>false</span></span></code></pre></div></li></ul><p>Tất cả các bài kiểm tra trên chắc chắn cần phải thông qua việc chạy ứng dụng, khởi động dự án. Dưới đây là nhật ký khởi động của nó:</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>2019-11-15 18:46:00.671  INFO 99493 --- [           main] c.i.s.lab23.springmvc.Application        : Starting Application on MacBook-Pro-8 with PID 99493 (/Users/yunai/Java/SpringBoot-Labs/lab-23/lab-springmvc-23-01/target/classes started by yunai in /Users/yunai/Java/SpringBoot-Labs)</span></span>
<span class="line"><span>2019-11-15 18:46:00.673  INFO 99493 --- [           main] c.i.s.lab23.springmvc.Application        : No active profile set, falling back to default profiles: default</span></span>
<span class="line"><span>2019-11-15 18:46:01.593  INFO 99493 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 8080 (http)</span></span>
<span class="line"><span>2019-11-15 18:46:01.613  INFO 99493 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span></span>
<span class="line"><span>2019-11-15 18:46:01.613  INFO 99493 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat/9.0.16]</span></span>
<span class="line"><span>2019-11-15 18:46:01.619  INFO 99493 --- [           main] o.a.catalina.core.AprLifecycleListener   : The APR based Apache Tomcat Native library which allows optimal performance in production environments was not found on the java.library.path: [/Users/yunai/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.]</span></span>
<span class="line"><span>2019-11-15 18:46:01.684  INFO 99493 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[/]       : Initializing Spring embedded WebApplicationContext</span></span>
<span class="line"><span>2019-11-15 18:46:01.684  INFO 99493 --- [           main] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 976 ms</span></span>
<span class="line"><span>2019-11-15 18:46:01.844  INFO 99493 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService &#39;applicationTaskExecutor&#39;</span></span>
<span class="line"><span>2019-11-15 18:46:01.987  INFO 99493 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 8080 (http) with context path &#39;&#39;</span></span>
<span class="line"><span>2019-11-15 18:46:01.990  INFO 99493 --- [           main] c.i.s.lab23.springmvc.Application        : Started Application in 1.559 seconds (JVM running for 2.146)</span></span></code></pre></div><ul><li>Chúng ta có thể thấy, Spring Boot khi khởi động Spring MVC sẽ tự động khởi tạo một Tomcat, lắng nghe các yêu cầu trên cổng 8080.</li></ul><h2 id="_2-5-usercontroller2" tabindex="-1"><a class="header-anchor" href="#_2-5-usercontroller2"><span>2.5 UserController2</span></a></h2><p>Trong quá trình phát triển dự án hàng ngày, tôi chỉ sử dụng phương thức yêu cầu <code>GET</code> và <code>POST</code>. Nguyên nhân chính là trong thực tế, vì các tình huống nghiệp vụ tương đối phức tạp, API Restful tiêu chuẩn không thể đáp ứng tất cả các thao tác. Ví dụ, đơn hàng có thể bị người dùng hủy, quản trị viên hủy, thay đổi địa chỉ giao hàng, đánh giá, v.v. Vì vậy, chúng tôi thường cung cấp <strong>API tương tự</strong> Restful hơn.</p><p>Đối với tham số đường dẫn <code>@PathVariable</code> mà SpringMVC cung cấp, tôi hiện chưa sử dụng trong dự án, lý do chính là:</p><ol><li><strong>Khung quyền truy cập được đóng gói</strong>, dựa vào URL làm định danh quyền truy cập, hiện tại không hỗ trợ URL có tham số đường dẫn.</li><li><strong>Cảnh báo dựa vào URL</strong>, trong khi URL có tham số đường dẫn, URL &quot;giống nhau&quot; thực chất tương ứng với các URL khác nhau, dẫn đến việc không dễ dàng thực hiện việc cảnh báo số lần yêu cầu sai theo thời gian.</li><li>URL tham số đường dẫn <code>@PathVariable</code> sẽ gây ra một số suy giảm hiệu suất trong SpringMVC. Cụ thể có thể xem bài viết <a href="https://tech.imdada.cn/2015/12/23/springmvc-restful-optimize/" target="_blank" rel="noopener noreferrer">《SpringMVC RESTful 性能优化》</a>.</li></ol><p>Vì vậy, chúng tôi tạo lớp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/src/main/java/cn/iocoder/springboot/lab23/springmvc/controller/UserController2.java" target="_blank" rel="noopener noreferrer">UserController2</a> để sửa đổi API. Mã cuối cùng như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserController2.java</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RestController</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/users2&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserController2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Truy vấn danh sách người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> danh sách người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/list&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// URL thay đổi thành /list</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> List</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> list</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Truy vấn danh sách</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ArrayList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;();</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;yudaoyuanma&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;woshiyutou&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">3</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;chifanshuijiao&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trả về danh sách</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> result;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Nhận người dùng theo ID xác định</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ID người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/get&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// URL thay đổi thành /get</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserVO</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RequestParam</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Truy vấn và trả về người dùng</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(id).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UUID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">randomUUID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Thêm người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> addDTO</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> thông tin người dùng cần thêm</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ID người dùng đã thêm thành công</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/add&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// URL thay đổi thành /add</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserAddDTO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> addDTO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Chèn bản ghi người dùng và trả về ID</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> returnId</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UUID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">randomUUID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">hashCode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trả về ID người dùng</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> returnId;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Cập nhật người dùng theo ID xác định</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> updateDTO</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> thông tin người dùng cần cập nhật</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> trạng thái cập nhật thành công</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/update&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// URL thay đổi thành /update, RequestMethod thay đổi thành POST</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> update</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserUpdateDTO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> updateDTO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Cập nhật bản ghi người dùng</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        Boolean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> success</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trả về trạng thái cập nhật</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> success;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Xóa người dùng theo ID xác định</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ID người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> trạng thái xóa thành công</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">DeleteMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/delete&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// URL thay đổi thành /delete, RequestMethod thay đổi thành DELETE</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> delete</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RequestParam</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Xóa bản ghi người dùng</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        Boolean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> success</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trả về trạng thái xóa</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> success;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Mỗi thay đổi ở đây, hãy xem các chú thích mô tả sau chú thích <code>@XXXMapping</code>.</li></ul><h1 id="_3-kiem-tra-api" tabindex="-1"><a class="header-anchor" href="#_3-kiem-tra-api"><span>3. Kiểm Tra API</span></a></h1><blockquote><p>Mã mẫu tương ứng với kho lưu trữ: <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-01" target="_blank" rel="noopener noreferrer">lab-springmvc-23-01</a>.</p></blockquote><p>Sau khi phát triển xong API, chúng ta sẽ thực hiện tự kiểm tra API. Thông thường, chúng ta khởi động dự án, sau đó sử dụng <a href="https://www.getpostman.com/" target="_blank" rel="noopener noreferrer">Postman</a>, <a href="https://curl.haxx.se/" target="_blank" rel="noopener noreferrer">curl</a>, hoặc trình duyệt để mô phỏng yêu cầu đến API backend.</p><p>Thực tế, SpringMVC cung cấp một framework kiểm thử là <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/test/web/servlet/MockMvc.html" target="_blank" rel="noopener noreferrer">MockMvc</a>, giúp chúng ta kiểm thử API một cách nhanh chóng. Dưới đây, chúng ta sẽ thực hiện kiểm thử đơn vị cho các API được cung cấp trong <a href="#">「2.4 UserController」</a>. Nói cách khác, trong phần này, chúng ta sẽ tiếp tục sửa đổi trên nền tảng của ví dụ <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-01" target="_blank" rel="noopener noreferrer">lab-springmvc-23-01</a>.</p><p>MockMvc cung cấp khả năng kiểm thử tích hợp và kiểm thử đơn vị, chúng ta sẽ phân chia thành <a href="#">「3.1 Kiểm thử tích hợp」</a> và <a href="#">「3.2 Kiểm thử đơn vị」</a> để tìm hiểu. Nếu bạn đọc chưa quen với phần kiểm thử, có thể tham khảo hai bài viết sau:</p><ul><li><a href="http://www.iocoder.cn/Fight/A-little-bit-about-Java-unit-testing/?self" target="_blank" rel="noopener noreferrer">《Một chút về kiểm thử đơn vị trong Java》</a></li><li><a href="http://www.iocoder.cn/Architecture/talk-about-java-unit-test/?self" target="_blank" rel="noopener noreferrer">《Nói về kiểm thử đơn vị》</a></li></ul><h2 id="_3-1-kiem-thu-tich-hop" tabindex="-1"><a class="header-anchor" href="#_3-1-kiem-thu-tich-hop"><span>3.1 Kiểm Thử Tích Hợp</span></a></h2><p>Tạo lớp kiểm thử <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/src/test/java/cn/iocoder/springboot/lab23/springmvc/controller/UserControllerTest.java" target="_blank" rel="noopener noreferrer">UserControllerTest</a> để kiểm thử từng thao tác đơn giản của UserController. Mã cốt lõi như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserControllerTest.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RunWith</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SpringRunner</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SpringBootTest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">classes</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">AutoConfigureMockMvc</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserControllerTest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Autowired</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MockMvc</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> mvc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Test</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> testList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Truy vấn danh sách người dùng  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        ResultActions</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> resultActions</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mvc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcRequestBuilders</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/users&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Kiểm tra kết quả  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isOk</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Mã trạng thái phản hồi 200  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">content</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\[\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;    {</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;        </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">id\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;: 1,</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;        </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">username\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;: </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">yudaoyuanma\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;    },</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;    {</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;        </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">id\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;: 2,</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;        </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">username\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;: </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">woshiyutou\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;    },</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;    {</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;        </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">id\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;: 3,</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;        </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">username\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;: </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">chifanshuijiao\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;    }</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\]</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Kết quả phản hồi  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Test</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> testGet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Lấy người dùng với ID chỉ định  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        ResultActions</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> resultActions</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mvc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcRequestBuilders</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/users/1&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Kiểm tra kết quả  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isOk</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Mã trạng thái phản hồi 200  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">content</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;{</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">id\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;: 1,</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">username\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;: </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">username</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;}&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Kết quả phản hồi  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Test</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> testAdd</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Thêm người dùng mới  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        ResultActions</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> resultActions</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mvc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcRequestBuilders</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">post</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/users&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">param</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;username&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;yudaoyuanma&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">param</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;password&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;nicai&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Kiểm tra kết quả  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isOk</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Mã trạng thái phản hồi 200  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">content</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;1&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Kết quả phản hồi  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Test</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> testUpdate</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Cập nhật người dùng với ID chỉ định  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        ResultActions</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> resultActions</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mvc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcRequestBuilders</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/users/1&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">param</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;username&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;yudaoyuanma&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">param</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;password&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;nicai&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Kiểm tra kết quả  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isOk</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Mã trạng thái phản hồi 200  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">content</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;true&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Kết quả phản hồi  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Test</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> testDelete</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Xóa người dùng với ID chỉ định  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        ResultActions</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> resultActions</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mvc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcRequestBuilders</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">delete</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/users/1&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Kiểm tra kết quả  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isOk</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Mã trạng thái phản hồi 200  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">content</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">string</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;false&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Kết quả phản hồi  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Lớp trên, chúng ta đã thêm chú thích <code>@AutoConfigureMockMvc</code> để tự động cấu hình đối tượng MockMvc Bean mà chúng ta sẽ tiêm sau này. Trong các bài kiểm thử tiếp theo, chúng ta sẽ thấy rằng tất cả các yêu cầu gọi API backend đều thông qua <code>mvc</code>. Mỗi lần gọi API backend, nó sẽ thực thi <strong>logic backend thực sự</strong>. Do đó, toàn bộ logic sẽ sử dụng <strong>kiểm thử tích hợp</strong> và sẽ khởi động một môi trường Spring <strong>thực</strong>.</p></li><li><p>Mỗi yêu cầu API đều được xây dựng thông qua <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-test/src/main/java/org/springframework/test/web/servlet/request/MockMvcRequestBuilders.java" target="_blank" rel="noopener noreferrer">MockMvcRequestBuilders</a>. Sau khi hoàn thành việc xây dựng, yêu cầu sẽ được thực hiện thông qua <code>mvc</code>, trả về kết quả <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-test/src/main/java/org/springframework/test/web/servlet/ResultActions.java" target="_blank" rel="noopener noreferrer">ResultActions</a>.</p></li><li><p>Sau khi thực hiện yêu cầu, chúng ta sẽ gọi phương thức <code>andExpect(ResultMatcher matcher)</code> của <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-test/src/main/java/org/springframework/test/web/servlet/ResultActions.java" target="_blank" rel="noopener noreferrer">ResultActions</a> để thêm dự kiến kết quả, tương đương với việc thực hiện khẳng định. Nếu không khớp với dự kiến, sẽ ném ra ngoại lệ và bài kiểm thử sẽ không thành công.</p></li></ul><p>Ngoài ra, <code>ResultActions</code> còn có hai phương thức khác:</p><ul><li>Phương thức <code>#andDo(ResultHandler handler)</code>, cho phép thêm bộ xử lý kết quả ResultHandler, chẳng hạn như in kết quả ra bảng điều khiển trong quá trình gỡ lỗi để kiểm tra xem kết quả có đúng hay không.</li><li>Phương thức <code>#andReturn()</code>, cuối cùng trả về kết quả <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-test/src/main/java/org/springframework/test/web/servlet/MvcResult.java" target="_blank" rel="noopener noreferrer">MvcResult</a>. Sau đó, bạn có thể viết một số logic tùy chỉnh cho MvcResult.</li></ul><p>Ví dụ, chúng ta sẽ sử dụng hai phương thức đã đề cập để bổ sung và sửa đổi phương thức <code>#testGet()</code> như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserControllerTest.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Test</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> testGet2</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() throws Exception {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Lấy người dùng với ID chỉ định  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    ResultActions</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> resultActions </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mvc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcRequestBuilders</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/users/1&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Kiểm tra kết quả  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isOk</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Mã trạng thái phản hồi 200  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">content</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;{</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">            &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">id\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;: 1,</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">            &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">username\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;: </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">username</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">            &quot;}&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Kết quả phản hồi  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // &lt;1&gt; In kết quả  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andDo</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultHandlers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">print</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // &lt;2&gt; Lấy MvcResult, thực hiện các logic tùy chỉnh  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    MvcResult</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> mvcResult </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andReturn</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    System</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Số lượng bộ lọc: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mvcResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getInterceptors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">length</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Tại <code>&lt;1&gt;</code>, in thông tin yêu cầu và phản hồi. Đầu ra như sau:</li></ul><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>    MockHttpServletRequest:  </span></span>
<span class="line"><span>          HTTP Method = GET  </span></span>
<span class="line"><span>          Request URI = /users/1  </span></span>
<span class="line"><span>           Parameters = {}  </span></span>
<span class="line"><span>              Headers = \\[\\]  </span></span>
<span class="line"><span>                 Body = null  </span></span>
<span class="line"><span>        Session Attrs = {}  </span></span>
<span class="line"><span>      </span></span>
<span class="line"><span>    Handler:  </span></span>
<span class="line"><span>                 Type = cn.iocoder.springboot.lab23.springmvc.controller.UserController  </span></span>
<span class="line"><span>               Method = public cn.iocoder.springboot.lab23.springmvc.vo.UserVO cn.iocoder.springboot.lab23.springmvc.controller.UserController.get(java.lang.Integer)  </span></span>
<span class="line"><span>      </span></span>
<span class="line"><span>    Async:  </span></span>
<span class="line"><span>        Async started = false  </span></span>
<span class="line"><span>         Async result = null  </span></span>
<span class="line"><span>      </span></span>
<span class="line"><span>    Resolved Exception:  </span></span>
<span class="line"><span>                 Type = null  </span></span>
<span class="line"><span>      </span></span>
<span class="line"><span>    ModelAndView:  </span></span>
<span class="line"><span>            View name = null  </span></span>
<span class="line"><span>                 View = null  </span></span>
<span class="line"><span>                Model = null  </span></span>
<span class="line"><span>      </span></span>
<span class="line"><span>    FlashMap:  </span></span>
<span class="line"><span>           Attributes = null  </span></span>
<span class="line"><span>      </span></span>
<span class="line"><span>    MockHttpServletResponse:  </span></span>
<span class="line"><span>               Status = 200  </span></span>
<span class="line"><span>        Error message = null  </span></span>
<span class="line"><span>              Headers = \\[Content-Type:&quot;application/json;charset=UTF-8&quot;\\]  </span></span>
<span class="line"><span>         Content type = application/json;charset=UTF-8  </span></span>
<span class="line"><span>                 Body = {&quot;id&quot;:1,&quot;username&quot;:&quot;username:1&quot;}  </span></span>
<span class="line"><span>        Forwarded URL = null  </span></span>
<span class="line"><span>       Redirected URL = null  </span></span>
<span class="line"><span>              Cookies = \\[\\]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Tại <code>&lt;2&gt;</code>, sau khi lấy được MvcResult in ra số lượng thiết bị chặn. Đầu ra như sau:</li></ul><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>Số lượng bộ lọc: 2</span></span></code></pre></div><h2 id="_3-2-kiem-thu-đon-vi" tabindex="-1"><a class="header-anchor" href="#_3-2-kiem-thu-đon-vi"><span>3.2 Kiểm thử Đơn vị</span></a></h2><p>Để trình bày rõ hơn về ví dụ kiểm thử đơn vị trong SpringMVC, chúng ta cần chỉnh sửa mã của <code>UserController</code> để nó phụ thuộc vào <code>UserService</code>. Các điểm sửa đổi như sau:</p><ul><li>Tại <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-01/src/main/java/cn/iocoder/springboot/lab23/springmvc/service" target="_blank" rel="noopener noreferrer">gói <code>cn.iocoder.springboot.lab23.springmvc.service</code></a>, tạo lớp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/src/main/java/cn/iocoder/springboot/lab23/springmvc/service/UserService.java" target="_blank" rel="noopener noreferrer">UserService</a>. Mã như sau:</li></ul><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserService.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Service</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserVO</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(id).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;test&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Trong lớp <a href="#">UserController</a>, thêm interface <code>GET /users/v2/{id}</code> để lấy người dùng theo ID đã cho. Mã như sau:</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserController.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Autowired</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserService</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> userService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * Lấy người dùng theo ID đã cho  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> *  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ID của người dùng  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> Người dùng  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/v2/{id}&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserVO</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> get2</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PathVariable</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> id) {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> userService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(id);</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Trong mã, chúng ta tiêm đối tượng Bean <code>userService</code> từ <code>UserService</code>, sau đó trong phương thức interface mới, chúng ta sẽ gọi phương thức <code>UserService#get(Integer id)</code> để lấy người dùng theo ID đã cho.</li></ul><p>Tạo lớp kiểm thử <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/src/test/java/cn/iocoder/springboot/lab23/springmvc/controller/UserControllerTest2.java" target="_blank" rel="noopener noreferrer">UserControllerTest2</a> để kiểm thử API mới của <code>UserController</code>. Mã như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserControllerTest2.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RunWith</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SpringRunner</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">WebMvcTest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserController</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserControllerTest2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Autowired</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MockMvc</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> mvc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockBean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserService</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> userService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Test</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> testGet2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Mock phương thức get của UserService  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;before mock:&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> userService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// &lt;1.1&gt;  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        Mockito</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">when</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">userService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">thenReturn</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;username:1&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// &lt;1.2&gt;  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;after mock:&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> userService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// &lt;1.3&gt;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Gửi yêu cầu lấy người dùng  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        ResultActions</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> resultActions</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> mvc</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">perform</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcRequestBuilders</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/users/v2/1&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Kiểm tra kết quả  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">status</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isOk</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Mã trạng thái phản hồi 200  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        resultActions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">andExpect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MockMvcResultMatchers</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">content</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">json</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;{</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;    </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">id\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;: 1,</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;    </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">username\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;: </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">username</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">:</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">n&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;}&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Kết quả phản hồi  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Thêm chú thích <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot-test-autoconfigure/src/main/java/org/springframework/boot/test/autoconfigure/web/servlet/WebMvcTest.java" target="_blank" rel="noopener noreferrer"><code>@WebMvcTest</code></a> trên lớp, với <code>UserController</code> là đối số, cho biết rằng chúng ta sẽ thực hiện kiểm thử đơn vị trên <code>UserController</code>.</p></li><li><p>Chú thích <code>@WebMvcTest</code> là một chú thích tổ hợp chứa <code>@AutoConfigureMockMvc</code>, vì vậy nó sẽ tự động cấu hình đối tượng MockMvc Bean mà chúng ta sẽ tiêm sau này. Trong các bài kiểm thử tiếp theo, chúng ta sẽ thấy rằng tất cả các yêu cầu API backend đều được gọi thông qua <code>mvc</code>. <strong>Tuy nhiên</strong>, mỗi lần gọi API backend sẽ <strong>không</strong> thực thi <strong>logic backend thực sự</strong>, mà chỉ thực hiện logic Mock. Điều này có nghĩa là toàn bộ logic sẽ sử dụng <strong>kiểm thử đơn vị</strong>, và <strong>chỉ</strong> khởi động một môi trường Spring <strong>Mock</strong>.</p><blockquote><p><strong>Lưu ý</strong>: Hãy chú ý đến mỗi điểm được <strong>in đậm</strong> ở trên!</p></blockquote></li><li><p>Thuộc tính <code>userService</code>, chúng ta thêm chú thích <a href="https://docs.spring.io/spring-boot/docs/current/api/org/springframework/boot/test/mock/mockito/MockBean.html" target="_blank" rel="noopener noreferrer"><code>@MockBean</code></a>, thực tế, đối tượng tiêm ở đây là một đối tượng UserService Mock được tạo ra bằng <a href="https://site.mockito.org/" target="_blank" rel="noopener noreferrer">Mockito</a>. Như hình dưới đây: <img src="https://static.iocoder.cn/images/Spring-Boot/2019-11-17/01.png" alt="Đối tượng UserService Mock" loading="lazy"></p><ul><li><p>Trong <code>UserController</code>, cũng sẽ tiêm một thuộc tính <code>UserService</code>, và đối tượng tiêm này chính là Bean UserService Mock đã được tạo ra.</p></li><li><p>Theo mặc định,</p></li><li><p>Tại <code>&lt;1.1&gt;</code>, chúng ta gọi phương thức <code>UserService#get(Integer id)</code> và in kết quả trả về. Kết quả thực thi như sau:</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>before mock:null</span></span></code></pre></div><ul><li>Kết quả trả về là <code>null</code>. Lý thuyết mà nói, lúc này đáng lẽ ra phải trả về một đối tượng UserVO với <code>id = 1</code>. Thực tế, vì <code>userService</code> hiện đang là một đối tượng được Mock thông qua Mockito, nên tất cả các cuộc gọi đến các phương thức của nó sẽ trả về giá trị <code>null</code>.</li></ul></li><li><p>Tại <code>&lt;1.2&gt;</code>, chúng ta sử dụng Mockito để Mock phương thức <code>#get(Integer id)</code> của <code>userService</code>, khi tham số truyền vào là <code>id = 1</code>, phương thức sẽ trả về một đối tượng UserVO với <code>id = 1</code> và <code>username = &quot;username:1&quot;</code>.</p></li><li><p>Tại <code>&lt;1.3&gt;</code>, gọi lại phương thức <code>UserService#get(Integer id)</code> và in kết quả trả về. Kết quả thực thi như sau:</p><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>after mock:cn.iocoder.springboot.lab23.springmvc.vo.UserVO@23202c31</span></span></code></pre></div><ul><li>Kết quả in ra là đối tượng UserVO mà chúng ta đã Mock trả về.</li></ul></li></ul></li><li><p>Cuối cùng, sử dụng <code>mvc</code> để thực hiện một cuộc gọi API backend và kiểm tra kết quả có đúng hay không. Nếu thực hiện thành công, bài kiểm thử đơn vị sẽ thông qua.</p></li></ul><p>Có thể bạn chưa quen với kiểm thử đơn vị, bạn có thể tham khảo bài viết <a href="https://spring.io/guides/gs/testing-web/" target="_blank" rel="noopener noreferrer">《Testing the Web Layer》</a> trong tài liệu chính thức của Spring về lĩnh vực này.</p><h1 id="_4-global-response" tabindex="-1"><a class="header-anchor" href="#_4-global-response"><span>4. Global Response</span></a></h1><blockquote><p>Mã ví dụ tương ứng với kho lưu trữ: <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02" target="_blank" rel="noopener noreferrer">lab-springmvc-23-02</a>.</p></blockquote><p>Khi chúng ta cung cấp API backend cho frontend, chúng ta cần thông báo cho frontend biết liệu kết quả của cuộc gọi API này có thành công hay không:</p><ul><li>Nếu <strong>thành công</strong>, dữ liệu thành công là gì. Sau đó, frontend sẽ lấy dữ liệu để hiển thị trên trang.</li><li>Nếu <strong>thất bại</strong>, lý do thất bại là gì. Thông thường, frontend sẽ hiển thị lý do này cho người dùng.</li></ul><p>Vì vậy, chúng ta cần có một phản hồi đồng nhất, không thể để mỗi API tự định nghĩa phong cách riêng của mình. Thông thường, thông tin phản hồi đồng nhất toàn cầu có thể như sau:</p><ul><li>Khi thành công, trả về <strong>mã trạng thái thành công</strong> + <strong>dữ liệu</strong>.</li><li>Khi thất bại, trả về <strong>mã trạng thái thất bại</strong> + <strong>thông báo lỗi</strong>.</li></ul><p>Trong định nghĩa chuẩn của API RESTful, khuyến nghị sử dụng <a href="https://zh.wikipedia.org/wiki/HTTP%E7%8A%B6%E6%80%81%E7%A0%81" target="_blank" rel="noopener noreferrer">mã trạng thái phản hồi HTTP</a> để trả về mã trạng thái. Tuy nhiên, trong thực tế, chúng ta rất ít khi làm như vậy, chủ yếu vì những lý do sau:</p><ul><li>Mã trạng thái lỗi mà doanh nghiệp trả về rất nhiều, mã trạng thái phản hồi HTTP không thể ánh xạ tốt. Ví dụ như, sự kiện chưa bắt đầu, đơn hàng đã bị hủy, v.v.</li><li>Các nhà phát triển trong nước không hiểu rõ về mã trạng thái phản hồi HTTP, có thể họ chỉ biết một vài mã phổ biến như 200, 403, 404, 500. Điều này lại làm tăng chi phí học tập.</li></ul><p>Do đó, trong thực tế, trong các dự án, chúng ta sẽ đặt mã trạng thái vào <strong>nội dung phản hồi</strong> Response Body.</p><p>Trong phản hồi đồng nhất toàn cầu, chúng ta ít nhất cần định nghĩa ba trường:</p><ul><li><p><code>code</code>: Mã trạng thái. Bất kể có thành công hay không, phải trả về trường này.</p><ul><li>Khi thành công, mã trạng thái là 0.</li><li>Khi thất bại, mã lỗi tương ứng với doanh nghiệp.</li></ul><blockquote><p>Về phần này, một số đội ngũ thực hành đã thêm trường <code>success</code>, thông qua <code>true</code> và <code>false</code> để biểu thị thành công hay thất bại. Điều này tùy thuộc vào thói quen của từng đội ngũ. Theo quan điểm của tôi, tôi vẫn thích dựa trên quy ước, trả về 0 để biểu thị thành công.</p></blockquote></li><li><p><code>data</code>: Dữ liệu. Khi thành công, trả về trường này.</p></li><li><p><code>message</code>: Thông báo lỗi. Khi thất bại, trả về trường này.</p></li></ul><p>Bây giờ, hãy xem hai ví dụ:</p><div class="language-json" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Phản hồi thành công  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;code&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;data&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        &quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        &quot;username&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;yudaoyuanma&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Phản hồi thất bại  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;code&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">233666</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;message&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Xu Mã quá xấu&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Dưới đây, chúng ta sẽ xem một ví dụ.</p><blockquote><p><strong>Lưu ý</strong>: Để không làm hỏng các ví dụ trong <a href="#">「2. Hướng dẫn Nhanh」</a> và <a href="#">「3. Kiểm tra API」</a>, chúng ta cần thiết lập lại một cái mới.</p></blockquote><h2 id="_4-1-nhap-thu-vien" tabindex="-1"><a class="header-anchor" href="#_4-1-nhap-thu-vien"><span>4.1 Nhập Thư Viện</span></a></h2><p>Giống như ở <a href="#">「2.2 Thêm phụ thuộc」</a>.</p><h2 id="_4-2-ung-dung" tabindex="-1"><a class="header-anchor" href="#_4-2-ung-dung"><span>4.2 Ứng Dụng</span></a></h2><p>Giống như ở <a href="#">「2.3 Application」</a>.</p><h2 id="_4-3-commonresult" tabindex="-1"><a class="header-anchor" href="#_4-3-commonresult"><span>4.3 CommonResult</span></a></h2><p>Trong gói <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/vo" target="_blank" rel="noopener noreferrer"><code>cn.iocoder.springboot.lab23.springmvc.core.vo</code></a>, tạo lớp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/vo/CommonResult.java" target="_blank" rel="noopener noreferrer">CommonResult</a> dùng để trả về đồng nhất toàn cầu. Mã như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// CommonResult.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Serializable</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> CODE_SUCCESS </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Mã lỗi  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> code</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Thông báo lỗi  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Dữ liệu trả về  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> T</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Chuyển đổi đối tượng result đã truyền vào thành một đối tượng kết quả khác với kiểu tổng quát  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Bởi vì đối tượng CommonResult trả về từ phương thức A không phù hợp để gọi phương thức B, nên cần phải chuyển đổi.  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> result</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> Đối tượng result đã truyền vào  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> &lt;T&gt;</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> Kiểu trả về  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> Đối tượng CommonResult mới  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getCode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> code</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        Assert</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isTrue</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">CODE_SUCCESS</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(code), </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Mã phải là lỗi!&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;();  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">code</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> code;  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> message;  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> result;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> data</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">result</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;();  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">code</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CODE_SUCCESS;  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">data</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> data;  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> result;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">JsonIgnore</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Bỏ qua, tránh việc jackson tuần tự hóa cho frontend  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> isSuccess</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Dễ dàng kiểm tra xem có thành công hay không  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CODE_SUCCESS</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(code);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">JsonIgnore</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Bỏ qua, tránh việc jackson tuần tự hóa cho frontend  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> isError</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> { </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Dễ dàng kiểm tra xem có thất bại hay không  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isSuccess</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // ... Bỏ qua các phương thức setting/getting/toString  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Mỗi trường, bạn hãy xem các chú thích tương ứng.<br> Dưới đây là bản dịch sang tiếng Việt cho nội dung mà bạn đã cung cấp:</li></ul><h2 id="_4-4-globalresponsebodyhandler" tabindex="-1"><a class="header-anchor" href="#_4-4-globalresponsebodyhandler"><span>4.4 GlobalResponseBodyHandler</span></a></h2><p>Trong gói <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/web" target="_blank" rel="noopener noreferrer"><code>cn.iocoder.springboot.lab23.springmvc.core.web</code></a>, tạo lớp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/web/GlobalResponseBodyHandler.java" target="_blank" rel="noopener noreferrer">GlobalResponseBodyHandler</a> để xử lý phản hồi toàn cầu thống nhất. Mã như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// GlobalResponseBodyHandler.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ControllerAdvice</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">basePackages</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;cn.iocoder.springboot.lab23.springmvc.controller&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> GlobalResponseBodyHandler</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ResponseBodyAdvice</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> supports</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MethodParameter</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> returnType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> converterType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Object</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> beforeBodyWrite</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> body</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MethodParameter</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> returnType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MediaType</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> selectedContentType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> selectedConverterType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">                                   ServerHttpRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServerHttpResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Nếu đã là kiểu CommonResult, thì trả về trực tiếp  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (body </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">instanceof</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CommonResult) {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> body;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Nếu không, thì bao bọc thành kiểu CommonResult  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(body);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Trong SpringMVC, bạn có thể sử dụng thông qua việc thực hiện interface <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/java/org/springframework/web/servlet/mvc/method/annotation/ResponseBodyAdvice.java" target="_blank" rel="noopener noreferrer">ResponseBodyAdvice</a> và thêm chú thích <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/bind/annotation/ControllerAdvice.java" target="_blank" rel="noopener noreferrer"><code>@ControllerAdvice</code></a> để chặn các kết quả trả về của Controller. Lưu ý rằng, trong chú thích <code>@ControllerAdvice</code>, chúng ta đã thiết lập thuộc tính <code>basePackages</code> để <strong>chỉ chặn</strong> gói <code>&quot;cn.iocoder.springboot.lab23.springmvc.controller&quot;</code>, tức là các Controller mà chúng ta đã định nghĩa. Tại sao lại như vậy? Bởi vì trong dự án, chúng ta có thể sẽ tích hợp các thư viện như Swagger và cũng sử dụng Controller để cung cấp các API, vì vậy rõ ràng là chúng ta không nên để GlobalResponseBodyHandler chặn các interface này, <strong>dù sao thì chúng cũng không cần chúng ta làm phản hồi toàn cầu đồng nhất cho chúng</strong>.</li><li>Thực hiện phương thức <code>#supports(MethodParameter returnType, Class converterType)</code> và trả về <code>true</code>. Điều này có nghĩa là chặn tất cả các kết quả trả về của các interface API của Controller.</li><li>Thực hiện phương thức <code>#beforeBodyWrite(...)</code>, khi kết quả trả về không phải là kiểu CommonResult, thì bao bọc thành kiểu CommonResult. Có hai điểm cần lưu ý ở đây: <ul><li>Thứ nhất, có thể kết quả trả về của API đã là kiểu CommonResult, vì vậy không cần bao bọc lần hai.</li><li>Thứ hai, vì API đã trả về kết quả và bị GlobalResponseBodyHandler chặn, <strong>quy ước</strong> là kết quả trả về phải thành công, do đó sử dụng phương thức <code>CommonResult#success(T data)</code> để bao bọc thành phản hồi CommonResult <strong>thành công</strong>. Vậy nếu chúng ta muốn API trả về <strong>thất bại</strong> thì sao? Chúng ta <strong>quy ước</strong> rằng trong Controller sẽ ném ra ngoại lệ, điều này chúng ta sẽ thấy trong <a href="#">「5. Xử Lý Ngoại Lệ Toàn Cầu」</a>.</li></ul></li></ul><h2 id="_4-5-usercontroller" tabindex="-1"><a class="header-anchor" href="#_4-5-usercontroller"><span>4.5 UserController</span></a></h2><p>Trong gói <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/src/main/java/cn/iocoder/springboot/lab23/springmvc/controller/" target="_blank" rel="noopener noreferrer"><code>cn.iocoder.springboot.lab23.springmvc.controller</code></a>, tạo lớp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-01/src/main/java/cn/iocoder/springboot/lab23/springmvc/controller/UserController.java" target="_blank" rel="noopener noreferrer">UserController</a>. Mã như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserController.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RestController</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/users&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserController</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Lấy thông tin người dùng theo mã định danh</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Cung cấp không sử dụng CommonResult để đóng gói</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> Mã định danh người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> Thông tin người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/get&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserVO</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RequestParam</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Truy vấn và trả về thông tin người dùng</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(id).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UUID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">randomUUID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Lấy thông tin người dùng theo mã định danh</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Cung cấp sử dụng CommonResult để đóng gói</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> Mã định danh người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> Thông tin người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/get2&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> get2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RequestParam</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Truy vấn người dùng</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        UserVO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(id).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UUID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">randomUUID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trả về kết quả</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">success</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(user);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Trong phương thức <code>#get(Integer id)</code>, kết quả trả về là kiểu <code>UserVO</code>. Kết quả này sẽ bị <strong>GlobalResponseBodyHandler</strong> chặn và đóng gói thành kiểu <code>CommonResult</code>. Kết quả yêu cầu sẽ như sau:</p><div class="language-json" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;code&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;message&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;data&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: {</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        &quot;id&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">        &quot;username&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;f0ab9401-062f-4697-bcc9-1dc70c1c1310&quot;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Lý do có <code>&quot;message&quot;: &quot;&quot;</code> trong kết quả trả về là do SpringMVC sử dụng Jackson để tuần tự hóa. Khi <code>message = null</code>, nó sẽ tuần tự hóa thành <code>&quot;message&quot;: &quot;&quot;</code>. Trong thực tế, điều này không ảnh hưởng đến việc xử lý của phía giao diện người dùng.</li></ul></li><li><p>Trong phương thức <code>#get2(Integer id)</code>, kết quả trả về là kiểu <code>CommonResult&lt;UserVO&gt;</code>. Kết quả này cũng sẽ bị <strong>GlobalResponseBodyHandler</strong> chặn, nhưng <strong>sẽ không</strong> được đóng gói lại lần nữa thành kiểu <code>CommonResult</code>.</p></li></ul><h2 id="_4-6-mot-cuoc-thao-luan-nho" tabindex="-1"><a class="header-anchor" href="#_4-6-mot-cuoc-thao-luan-nho"><span>4.6 Một Cuộc Thảo Luận Nhỏ</span></a></h2><p>Cho đến giờ, chúng ta đã hoàn thành ví dụ về <strong>phản hồi thống nhất toàn cục</strong>. Tuy nhiên, tôi muốn đưa ra một câu hỏi thảo luận: <strong>Liệu chúng ta có nên sử dụng cách như GlobalResponseBodyHandler để chặn kết quả trả về của Controller và đưa ra phản hồi thống nhất toàn cục không?</strong></p><p>Chúng ta sẽ thấy rất nhiều bài viết trên mạng cũng sử dụng cách này để thực hiện việc trả về thống nhất toàn cục. Có vẻ như không có vấn đề gì khi áp dụng cách này trong các dự án thực tế, và thực sự, nó có thể được sử dụng mà không gặp khó khăn hay rủi ro nào. Nhưng đây chỉ là một điểm mà tôi (艿艿) băn khoăn. Khi chúng ta sử dụng AOP để <strong>thay đổi loại dữ liệu trả về của một phương thức</strong>, liệu điều này có thực sự phù hợp?</p><p>Ý kiến cá nhân của tôi là, <strong>điều này không phù hợp</strong>. Do đó, trong dự án mã nguồn mở <a href="https://github.com/YunaiV/onemall" target="_blank" rel="noopener noreferrer">onemall</a>, tôi <strong>bắt buộc</strong> Controller phải trả về loại <code>CommonResult</code>, giống như cách của phương thức <code>Controller#get2(Integer id)</code>.</p><p>Tuy nhiên, trong các dự án của nhóm tại công ty tôi, chúng tôi vẫn sử dụng cách của <strong>GlobalResponseBodyHandler</strong> để chặn kết quả. Vậy nên, cả hai cách đều có thể sử dụng, tùy thuộc vào quan điểm cá nhân và yêu cầu của từng dự án.</p><p>Ngoài ra, <code>ResponseBodyAdvice</code> được dùng để cắt ngang nội dung phản hồi (Response Body). Tương tự như vậy, SpringMVC cũng cung cấp <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/servlet/mvc/method/annotation/RequestBodyAdvice.html" target="_blank" rel="noopener noreferrer"><code>RequestBodyAdvice</code></a> để cắt ngang nội dung yêu cầu (Request Body). Cách sử dụng rất đơn giản, tương tự với <code>ResponseBodyAdvice</code>, nên tôi sẽ không nhắc lại chi tiết ở đây. Tuy nhiên, có vẻ như <code>ResponseBodyAdvice</code> không được sử dụng nhiều. Bạn chỉ cần biết rằng có công cụ này, và khi cần thì có thể quay lại tìm hiểu kỹ hơn.</p><h1 id="_5-xu-ly-ngoai-le-toan-cuc" tabindex="-1"><a class="header-anchor" href="#_5-xu-ly-ngoai-le-toan-cuc"><span>5. Xử lý ngoại lệ toàn cục</span></a></h1><blockquote><p>Mã nguồn mẫu tương ứng với kho: <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02" target="_blank" rel="noopener noreferrer">lab-springmvc-23-02</a>.</p></blockquote><p>Trong phần <a href="#">「4. Phản hồi thống nhất toàn cục」</a>, chúng ta đã định nghĩa sử dụng CommonResult để phản hồi thống nhất toàn cục và đã thấy ví dụ về phản hồi thành công. Ở phần này, chúng ta sẽ xử lý ngoại lệ toàn cục, cuối cùng cũng sẽ thông qua CommonResult để trả về.</p><p>Vậy nên, chúng ta không nói nhiều nữa, cùng xem qua mã mẫu và đi sâu vào chi tiết.</p><blockquote><p>Lưu ý: Ví dụ này dựa trên nền tảng của phần <a href="#">「4. Phản hồi thống nhất toàn cục」</a> từ kho <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02" target="_blank" rel="noopener noreferrer">lab-springmvc-23-02</a>.</p></blockquote><h2 id="_5-1-serviceexceptionenum" tabindex="-1"><a class="header-anchor" href="#_5-1-serviceexceptionenum"><span>5.1 ServiceExceptionEnum</span></a></h2><p>Trong đường dẫn gói <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/constants" target="_blank" rel="noopener noreferrer"><code>cn.iocoder.springboot.lab23.springmvc.constants</code></a>, tạo lớp enum <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/constants/ServiceExceptionEnum.java" target="_blank" rel="noopener noreferrer">ServiceExceptionEnum</a>, liệt kê mã lỗi trong dự án. Mã như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// ServiceExceptionEnum.java  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> enum</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServiceExceptionEnum</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // ========== Hệ thống cấp cao ==========  </span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">    SUCCESS</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;Thành công&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">    SYS_ERROR</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2001001000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;Lỗi phía máy chủ&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">    MISSING_REQUEST_PARAM_ERROR</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2001001001</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;Thiếu tham số&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // ========== Module người dùng ==========  </span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">    USER_NOT_FOUND</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1001002000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;Không tìm thấy người dùng&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // ========== Module đơn hàng ==========  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // ========== Module sản phẩm ==========  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Mã lỗi  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> code</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Thông báo lỗi  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    ServiceExceptionEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">int</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> code</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> message</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">code</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> code;  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">message</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> message;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // ... Lược bỏ các phương thức getter  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Vì mã lỗi là toàn cục, tốt nhất là phân chia theo module. Dưới đây là ví dụ từ dự án <a href="https://github.com/YunaiV/onemall" target="_blank" rel="noopener noreferrer">onemall</a> của tôi:</li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Ngoại lệ dịch vụ</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Tham khảo https://www.kancloud.cn/onebase/ob/484204 bài viết</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Tổng cộng 10 chữ số, chia làm bốn phần</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Phần đầu tiên, 1 chữ số, loại:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *      1 - Ngoại lệ cấp dịch vụ</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *      2 - Ngoại lệ cấp hệ thống</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Phần thứ hai, 3 chữ số, loại hệ thống:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *      001 - Hệ thống người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *      002 - Hệ thống sản phẩm</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *      003 - Hệ thống đơn hàng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *      004 - Hệ thống thanh toán</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *      005 - Hệ thống phiếu giảm giá</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *      ... - ...</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Phần thứ ba, 3 chữ số, module:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *      Không có quy tắc cố định.</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *      Thông thường, đề nghị mỗi hệ thống có thể có nhiều module, ví dụ với hệ thống người dùng:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *          001 - Module OAuth2</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *          002 - Module Người dùng</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *          003 - Module Mã xác minh qua di động</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Phần thứ tư, 3 chữ số, mã lỗi:</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *       Không có quy tắc cố định.</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *       Thường thì, đề nghị mỗi module sẽ tự tăng mã.</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-2-serviceexception" tabindex="-1"><a class="header-anchor" href="#_5-2-serviceexception"><span>5.2 ServiceException</span></a></h2><p>Chúng ta hãy cùng thảo luận về cách xử lý ngoại lệ logic trong tầng Service. Các ngoại lệ logic ở đây là những tình huống như tên người dùng đã tồn tại, hoặc số lượng hàng trong kho không đủ. Thông thường, có hai phương án phổ biến để xử lý:</p><ul><li>Đóng gói một lớp ngoại lệ logic thống nhất là <strong>ServiceException</strong>, trong đó có mã lỗi và thông báo lỗi, sau đó sử dụng <code>throws</code> để ném ra ngoại lệ.</li><li>Đóng gói một lớp phản hồi chung là <strong>CommonResult</strong>, trong đó có mã lỗi và thông báo lỗi, sau đó sử dụng <code>return</code> để trả về kết quả.</li></ul><p>Ban đầu, chúng tôi chọn phương án sử dụng <strong>CommonResult</strong>, nhưng phát hiện ra một số vấn đề sau:</p><ul><li>Vì Spring sử dụng <code>@Transactional</code> để xử lý giao dịch dựa trên cơ chế ngoại lệ, nếu sử dụng <strong>CommonResult</strong> để trả về kết quả, việc rollback giao dịch sẽ trở nên rất phức tạp.</li><li>Khi gọi các phương thức khác, nếu phương thức đó trả về đối tượng <strong>CommonResult</strong>, chúng ta cần liên tục kiểm tra và xử lý, điều này làm cho mã trở nên phức tạp.</li></ul><p>Vì vậy, sau đó chúng tôi đã quyết định sử dụng cách ném ngoại lệ logic bằng <strong>ServiceException</strong>.</p><p>Trong đường dẫn gói <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/exception" target="_blank" rel="noopener noreferrer"><code>cn.iocoder.springboot.lab23.springmvc.core.exception</code></a>, tạo lớp ngoại lệ <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/exception/ServiceException.java" target="_blank" rel="noopener noreferrer">ServiceException</a> kế thừa <strong>RuntimeException</strong>, dùng để định nghĩa ngoại lệ logic. Mã nguồn như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// ServiceException.java  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServiceException</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> RuntimeException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Mã lỗi  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Integer</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> code</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ServiceException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServiceExceptionEnum</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> serviceExceptionEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Sử dụng message từ lớp cha  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        super</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">serviceExceptionEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Gán mã lỗi  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">code</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> serviceExceptionEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getCode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // ... Lược bỏ các phương thức getter  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Phương thức khởi tạo nhận tham số <strong>serviceExceptionEnum</strong> để gán mã lỗi và thông báo lỗi. Cách xử lý cụ thể, hãy xem mã nguồn và các chú thích.</li></ul><h2 id="_5-3-globalexceptionhandler" tabindex="-1"><a class="header-anchor" href="#_5-3-globalexceptionhandler"><span>5.3 GlobalExceptionHandler</span></a></h2><p>Trong đường dẫn gói <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/web" target="_blank" rel="noopener noreferrer"><code>cn.iocoder.springboot.lab23.springmvc.core.web</code></a>, tạo lớp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/web/GlobalExceptionHandler.java" target="_blank" rel="noopener noreferrer">GlobalExceptionHandler</a> để xử lý ngoại lệ toàn cục. Mã nguồn như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// GlobalExceptionHandler.java  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ControllerAdvice</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">basePackages</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;cn.iocoder.springboot.lab23.springmvc.controller&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> GlobalExceptionHandler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Xử lý ngoại lệ ServiceException  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ResponseBody</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ExceptionHandler</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServiceException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> serviceExceptionHandler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServiceException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">debug</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[serviceExceptionHandler]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, ex);  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Gói kết quả thành CommonResult  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ex</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getCode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ex</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Xử lý ngoại lệ MissingServletRequestParameterException  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Ngoại lệ khi tham số của SpringMVC không đúng  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ResponseBody</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ExceptionHandler</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MissingServletRequestParameterException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> missingServletRequestParameterExceptionHandler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MissingServletRequestParameterException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">debug</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[missingServletRequestParameterExceptionHandler]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, ex);  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Gói kết quả thành CommonResult  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServiceExceptionEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MISSING_REQUEST_PARAM_ERROR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getCode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">                ServiceExceptionEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MISSING_REQUEST_PARAM_ERROR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Xử lý các ngoại lệ khác  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ResponseBody</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ExceptionHandler</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> exceptionHandler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Ghi lại nhật ký lỗi  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[exceptionHandler]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, e);  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Trả về CommonResult báo lỗi  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> CommonResult</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">error</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServiceExceptionEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SYS_ERROR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getCode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">                ServiceExceptionEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SYS_ERROR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getMessage</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Trong lớp, thêm annotation <code>@ControllerAdvice</code>. Điều này tương tự như <a href="#">「4.4 GlobalResponseBodyHandler」</a>, nhưng chúng ta không cần triển khai giao diện <code>ResponseBodyAdvice</code>, vì không cần chặn kết quả trả về để sửa đổi.</li><li>Chúng ta định nghĩa ba phương thức, mỗi phương thức được gắn với annotation <a href="https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/web/bind/annotation/ExceptionHandler.html" target="_blank" rel="noopener noreferrer"><code>@ExceptionHandler</code></a> để xử lý ngoại lệ tương ứng. Đồng thời, cũng thêm annotation <code>@ResponseBody</code> để chỉ định rằng kết quả trả về sẽ được sử dụng trực tiếp làm phản hồi API.</li><li>Phương thức <code>#serviceExceptionHandler(...)</code> xử lý ngoại lệ <strong>ServiceException</strong>, xây dựng đối tượng <strong>CommonResult</strong> từ thuộc tính <code>code</code> và <code>message</code> của ngoại lệ này.</li><li>Phương thức <code>#missingServletRequestParameterExceptionHandler(...)</code> xử lý ngoại lệ <strong>MissingServletRequestParameterException</strong>, xây dựng đối tượng <strong>CommonResult</strong> với mã lỗi là <code>ServiceExceptionEnum.MISSING_REQUEST_PARAM_ERROR</code>.</li><li>Phương thức <code>#exceptionHandler(...)</code> xử lý ngoại lệ <strong>Exception</strong>, xây dựng đối tượng <strong>CommonResult</strong> với mã lỗi là <code>ServiceExceptionEnum.SYS_ERROR</code>. Đây là phương thức xử lý ngoại lệ &quot;cuối cùng&quot;, dùng để xử lý các ngoại lệ khác mà chúng ta không định nghĩa trong <strong>GlobalExceptionHandler</strong>.</li></ul><p><strong>Lưu ý</strong>: Trong phương thức <code>#exceptionHandler(...)</code>, chúng ta đã sử dụng <strong>logger</strong> để ghi nhật ký lỗi, điều này giúp dễ dàng kết nối với các dịch vụ nhật ký như <strong>ELK</strong>, từ đó gửi cảnh báo và thông báo để kiểm tra và khắc phục sự cố. Nếu hệ thống của bạn chưa có dịch vụ nhật ký, bạn có thể ghi lại lỗi vào cơ sở dữ liệu cũng là một phương án tốt. Còn đối với hai phương thức còn lại, vì chúng xử lý ngoại lệ liên quan đến logic nghiệp vụ, nên không cần phải ghi nhật ký lỗi.</p><h2 id="_5-4-usercontroller" tabindex="-1"><a class="header-anchor" href="#_5-4-usercontroller"><span>5.4 UserController</span></a></h2><p>Trong lớp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/controller/UserController.java" target="_blank" rel="noopener noreferrer">UserController</a>, chúng ta thêm hai API để ném ngoại lệ, giúp thử nghiệm tính năng xử lý ngoại lệ toàn cục. Mã nguồn như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserController.java  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * Thử nghiệm ném ngoại lệ NullPointerException  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/exception-01&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserVO</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> exception01</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> NullPointerException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Không có cá viên chiên&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">/**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> * Thử nghiệm ném ngoại lệ ServiceException  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/exception-02&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserVO</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> exception02</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ServiceException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServiceExceptionEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">USER_NOT_FOUND</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Trong phương thức <code>#exception01()</code>, chúng ta ném ngoại lệ <strong>NullPointerException</strong>. Khi đó, ngoại lệ này sẽ được phương thức <code>GlobalExceptionHandler#exceptionHandler(...)</code> chặn lại và gói thành đối tượng <strong>CommonResult</strong> để trả về. Kết quả yêu cầu sẽ như sau:</p><div class="language-json" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;code&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2001001000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;message&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Dịch vụ xảy ra lỗi&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;data&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div></li><li><p>Trong phương thức <code>#exception02()</code>, chúng ta ném ngoại lệ <strong>ServiceException</strong>. Ngoại lệ này sẽ được phương thức <code>GlobalExceptionHandler#serviceExceptionHandler(...)</code> chặn lại và gói thành đối tượng <strong>CommonResult</strong> để trả về. Kết quả yêu cầu sẽ như sau:</p><div class="language-json" data-highlighter="shiki" data-ext="json" data-title="json" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;code&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1001002000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;message&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Người dùng không tồn tại&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    &quot;data&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div></li></ul><h1 id="_6-bo-chan-handlerinterceptor" tabindex="-1"><a class="header-anchor" href="#_6-bo-chan-handlerinterceptor"><span>6. Bộ chặn HandlerInterceptor</span></a></h1><blockquote><p>Mã ví dụ tương ứng với kho lưu trữ: <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02" target="_blank" rel="noopener noreferrer">lab-springmvc-23-02</a>.</p></blockquote><p>Khi sử dụng SpringMVC, chúng ta có thể sử dụng <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/java/org/springframework/web/servlet/HandlerInterceptor.java" target="_blank" rel="noopener noreferrer">HandlerInterceptor</a> để can thiệp vào quá trình xử lý yêu cầu của SpringMVC và tùy chỉnh logic trước và sau khi xử lý yêu cầu. Ví dụ như:</p><ul><li><strong>Bộ chặn nhật ký</strong>: Ghi lại các yêu cầu và phản hồi. Nhờ đó, chúng ta có thể biết được tham số của mỗi yêu cầu, kết quả phản hồi, thời gian thực thi, v.v.</li><li><strong>Bộ chặn xác thực</strong>: Giải mã thông tin người dùng từ phía trước truyền vào, chẳng hạn như <code>access_token</code> để lấy thông tin người dùng hiện tại và lưu vào <strong>ThreadLocal</strong>. Nhờ vậy, các logic sau đó chỉ cần lấy thông tin người dùng qua <strong>ThreadLocal</strong>.</li><li><strong>Bộ chặn phân quyền</strong>: Dựa vào thông tin phân quyền của mỗi API để xác định xem yêu cầu hiện tại có được phép truy cập hay không. Ví dụ, người dùng đã đăng nhập chưa, có quyền thực hiện thao tác API đó không.</li><li><strong>Bộ chặn giới hạn tần suất</strong>: Dựa vào cấu hình giới hạn tần suất của mỗi API để xác định xem yêu cầu hiện tại có vượt quá tần suất cho phép không, nhằm tránh các yêu cầu ác ý làm quá tải hệ thống.</li></ul><p>Interface <code>HandlerInterceptor</code> định nghĩa ba điểm chặn. Mã như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// HandlerInterceptor.java  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> HandlerInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">	default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> preHandle</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">			throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">		return</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">	default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> postHandle</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">			@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Nullable</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ModelAndView</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> modelAndView</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">	default</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> afterCompletion</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">			@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Nullable</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">	}</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Trước tiên, chúng ta cần hiểu một khái niệm. Mỗi yêu cầu API sẽ tương ứng với một <strong>handler</strong>. Như hình minh họa sau:<br><img src="https://static.iocoder.cn/images/Spring-Boot/2019-11-17/02.png" alt="" loading="lazy"></p><ul><li>Chúng ta có thể thấy rằng yêu cầu <code>users/exception_03</code> này có <strong>handler</strong> tương ứng với phương thức <code>#exception03()</code> trong <code>UserController</code>.</li><li>Vì vậy, tên của giao diện <code>HandlerInterceptor</code> bắt đầu với <strong>Handler</strong>, vì nó là bộ chặn dựa trên Handler.</li></ul></li><li><p>Tiếp theo, chúng ta sẽ xem một đoạn mã giả để hiểu rõ cách ba điểm chặn này và quá trình thực thi của <code>handler</code>. Mã như sau:</p></li></ul><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Mã giả  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> ex </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">try</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Xử lý trước  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">preHandle</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> handler)) {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Thực thi xử lý chính của handler, tức là logic của API  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">execute</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Xử lý sau  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    postHandle</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> handler)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">} </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> exception</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Nếu xảy ra ngoại lệ, lưu vào biến ex  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    ex </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">} </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {  </span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    afterCompletion</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> handler)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Dựa trên đoạn mã này, chúng ta có thể hiểu rõ quá trình xử lý yêu cầu.</p></li><li><p>Tuy nhiên, đây chỉ là mã giả và chưa tính đến trường hợp có nhiều bộ chặn. Trong các phần sau, chúng ta sẽ cung cấp các ví dụ cụ thể để giải thích rõ ràng hơn về quá trình thực thi.</p></li><li><p>Phương thức <code>#preHandle(...)</code>: Xử lý logic <strong>trước</strong> khi thực thi <code>handler</code>. Nếu trả về <code>true</code>, <strong>tiếp tục</strong> thực hiện <code>handler</code>; nếu trả về <code>false</code>, <strong>dừng</strong> quá trình thực thi.</p></li></ul><blockquote><p>Ví dụ, kiểm tra xem người dùng đã đăng nhập hay chưa. Nếu chưa, trả về <code>false</code> và <strong>dừng</strong> quá trình thực thi.</p></blockquote><ul><li>Phương thức <code>#postHandle(...)</code>: Xử lý logic <strong>sau</strong> khi <code>handler</code> đã thực thi.</li></ul><blockquote><p>Ví dụ, thực hiện một số xử lý trước khi hiển thị giao diện. Tuy nhiên, do hiện tại phần lớn các ứng dụng đều tách biệt giữa frontend và backend, nên điểm chặn này ít được sử dụng hơn.</p></blockquote><ul><li>Phương thức <code>#afterCompletion(...)</code>: Sau khi <code>handler</code> và toàn bộ chuỗi <strong>Interceptor</strong> đã hoàn thành quá trình xử lý trước và sau, thực hiện logic <strong>sau khi hoàn thành</strong> yêu cầu. <strong>Lưu ý</strong>, chỉ những <code>HandlerInterceptor</code> có phương thức <code>#preHandle(...)</code> trả về <code>true</code> mới thực thi được <code>#afterCompletion(...)</code>, vì chỉ khi đó <code>HandlerInterceptor</code> mới được coi là <strong>hoàn thành</strong>.</li></ul><blockquote><p>Ví dụ, giải phóng tài nguyên. Chẳng hạn, xóa các biến <strong>ThreadLocal</strong> được tạo ra bởi bộ chặn xác thực để tránh memory leak cho yêu cầu tiếp theo sử dụng cùng một thread.</p><p>Hoặc xử lý ngoại lệ xảy ra trong quá trình thực thi <code>handler</code> và ghi lại nhật ký ngoại lệ. Tuy nhiên, hiện nay thường sử dụng <a href="#">xử lý ngoại lệ toàn cục</a> để xử lý các ngoại lệ, nên ít khi cần làm như vậy.</p><p>Ngoài ra, có thể ghi lại thời gian kết thúc yêu cầu để tính toán thời gian xử lý của toàn bộ quá trình.</p></blockquote><p>Nhiều <code>HandlerInterceptor</code> có thể được kết hợp lại thành một <strong>chuỗi Interceptor</strong>. Quá trình thực thi sẽ diễn ra theo trình tự:</p><ul><li>Đầu tiên, thực thi phương thức <code>#preHandle(...)</code> của chuỗi theo thứ tự.</li><li>Tiếp theo, thực thi logic của <code>handler</code>.</li><li>Sau đó, thực thi phương thức <code>#postHandle(...)</code> của chuỗi theo thứ tự ngược lại.</li><li>Cuối cùng, thực thi phương thức <code>#afterCompletion(...)</code> của chuỗi theo thứ tự ngược lại.</li></ul><p>Đây là quá trình thực thi trong trường hợp bình thường. Còn trong các trường hợp ngoại lệ thì sao? Ví dụ:</p><ul><li>Một <code>HandlerInterceptor</code> trả về <code>false</code> trong phương thức <code>#preHandle(...)</code>.</li><li>Quá trình thực thi của <code>handler</code> ném ra ngoại lệ.</li><li>Một <code>HandlerInterceptor</code> ném ra ngoại lệ trong phương thức <code>#afterCompletion(...)</code>.</li><li>...</li></ul><p>Đừng lo lắng, chúng ta sẽ đưa ra các ví dụ để giải thích những trường hợp ngoại lệ này. Tiếp theo, chúng ta sẽ khám phá sâu hơn các ví dụ trong phần này.</p><blockquote><p>Lưu ý: Ví dụ này dựa trên <a href="#">xử lý ngoại lệ toàn cục</a> của dự án <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02" target="_blank" rel="noopener noreferrer">lab-springmvc-23-02</a> và tiếp tục được cải tiến.</p></blockquote><h2 id="_6-1-tuy-chinh-handlerinterceptor" tabindex="-1"><a class="header-anchor" href="#_6-1-tuy-chinh-handlerinterceptor"><span>6.1 Tùy chỉnh HandlerInterceptor</span></a></h2><p>Trong đường dẫn gói <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/interceptor" target="_blank" rel="noopener noreferrer"><code>cn.iocoder.springboot.lab23.springmvc.core.interceptor</code></a>, chúng ta tạo ba bộ chặn <code>HandlerInterceptor</code> tùy chỉnh.</p><h3 id="_1-firstinterceptor" tabindex="-1"><a class="header-anchor" href="#_1-firstinterceptor"><span>1. <code>FirstInterceptor</code></span></a></h3><p>Mã nguồn của <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/interceptor/FirstInterceptor" target="_blank" rel="noopener noreferrer">FirstInterceptor</a> như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// FirstInterceptor.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> FirstInterceptor</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> HandlerInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> preHandle</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[preHandle][handler({})]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, handler);  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> postHandle</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ModelAndView</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> modelAndView</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[postHandle][handler({})]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, handler);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> afterCompletion</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[afterCompletion][handler({})]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, handler, ex);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Mỗi phương thức đều ghi lại nhật ký (log).</li></ul><h3 id="_2-secondinterceptor" tabindex="-1"><a class="header-anchor" href="#_2-secondinterceptor"><span>2. <code>SecondInterceptor</code></span></a></h3><p>Mã nguồn của <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/interceptor/SecondInterceptor" target="_blank" rel="noopener noreferrer">SecondInterceptor</a> như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// SecondInterceptor.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SecondInterceptor</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> HandlerInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> preHandle</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[preHandle][handler({})]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, handler);  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> false</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">; </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Cố tình trả về false  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> postHandle</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ModelAndView</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> modelAndView</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[postHandle][handler({})]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, handler);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> afterCompletion</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[afterCompletion][handler({})]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, handler, ex);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Gần giống với <code>FirstInterceptor</code>, khác biệt nằm ở phương thức <code>#preHandle(...)</code> trả về <code>false</code>.</li></ul><h3 id="_3-thirdinterceptor" tabindex="-1"><a class="header-anchor" href="#_3-thirdinterceptor"><span>3. <code>ThirdInterceptor</code></span></a></h3><p>Mã nguồn của <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/interceptor/ThirdInterceptor" target="_blank" rel="noopener noreferrer">ThirdInterceptor</a> như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// ThirdInterceptor.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ThirdInterceptor</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> HandlerInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> preHandle</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[preHandle][handler({})]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, handler);  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> postHandle</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ModelAndView</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> modelAndView</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[postHandle][handler({})]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, handler);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> afterCompletion</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> request</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> response</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> handler</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ex</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[afterCompletion][handler({})]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, handler, ex);  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Cố tình ném ra lỗi&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">); </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Cố tình ném ra ngoại lệ  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Gần giống với <code>FirstInterceptor</code>, nhưng khác biệt nằm ở phương thức <code>#afterCompletion(...)</code> cố tình ném ra ngoại lệ <code>RuntimeException</code>.</li></ul><h3 id="tom-lai" tabindex="-1"><a class="header-anchor" href="#tom-lai"><span>Tóm lại</span></a></h3><ul><li><code>FirstInterceptor</code>: Ghi nhật ký bình thường cho cả ba phương thức <code>preHandle</code>, <code>postHandle</code> và <code>afterCompletion</code>.</li><li><code>SecondInterceptor</code>: Dừng quá trình xử lý (trả về <code>false</code>) ngay tại phương thức <code>preHandle</code>.</li><li><code>ThirdInterceptor</code>: Ghi nhật ký bình thường nhưng cố tình ném ra ngoại lệ trong phương thức <code>afterCompletion</code>.</li></ul><p>Ba bộ chặn này sẽ được sử dụng để minh họa cách mà các <code>HandlerInterceptor</code> hoạt động khi được liên kết thành một chuỗi (Chain) và khi gặp các tình huống đặc biệt như dừng hoặc ném ra ngoại lệ.</p><h2 id="_6-2-springmvcconfiguration" tabindex="-1"><a class="header-anchor" href="#_6-2-springmvcconfiguration"><span>6.2 SpringMVCConfiguration</span></a></h2><p>Trong đường dẫn gói <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/config/" target="_blank" rel="noopener noreferrer"><code>cn.iocoder.springboot.lab23.springmvc.config</code></a>, chúng ta tạo lớp cấu hình <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/config/SpringMVCConfiguration.java" target="_blank" rel="noopener noreferrer">SpringMVCConfiguration</a>. Mã nguồn như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// SpringMVCConfiguration.java</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Configuration</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SpringMVCConfiguration</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> WebMvcConfigurer</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> FirstInterceptor</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> firstInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> FirstInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SecondInterceptor</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> secondInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> SecondInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ThirdInterceptor</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> thirdInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ThirdInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> addInterceptors</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">InterceptorRegistry</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> registry</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Bộ chặn thứ nhất</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        registry</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">addInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">firstInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">addPathPatterns</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/**&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Bộ chặn thứ hai</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        registry</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">addInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">secondInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">addPathPatterns</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/users/current_user&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Bộ chặn thứ ba</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        registry</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">addInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">thirdInterceptor</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">addPathPatterns</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/**&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="giai-thich" tabindex="-1"><a class="header-anchor" href="#giai-thich"><span>Giải thích:</span></a></h3><ul><li><p>Lớp cấu hình này triển khai interface <a href="https://www.jianshu.com/p/52f39b799fbb" target="_blank" rel="noopener noreferrer">WebMvcConfigurer</a>, cho phép tùy chỉnh cấu hình trong Spring MVC. Lớp này cũng được đánh dấu với chú thích <code>@Configuration</code>, để chỉ ra rằng nó là một lớp cấu hình.</p></li><li><p>Phương thức <code>#addInterceptors(InterceptorRegistry registry)</code> dùng để thêm các bộ chặn <code>HandlerInterceptor</code> tùy chỉnh vào bảng đăng ký <code>InterceptorRegistry</code>. Cụ thể:</p><ul><li>Bộ chặn <code>FirstInterceptor</code> được áp dụng cho tất cả các đường dẫn (<code>/**</code>).</li><li>Bộ chặn <code>SecondInterceptor</code> chỉ áp dụng cho đường dẫn <code>/users/current_user</code>. Điều này nhằm kiểm tra hành vi khi <code>SecondInterceptor#preHandle(...)</code> trả về <code>false</code>, làm gián đoạn quá trình xử lý trước khi tiếp tục đến bộ điều khiển.</li><li>Bộ chặn <code>ThirdInterceptor</code> cũng được áp dụng cho tất cả các đường dẫn (<code>/**</code>).</li></ul></li></ul><h3 id="tong-ket" tabindex="-1"><a class="header-anchor" href="#tong-ket"><span>Tổng kết:</span></a></h3><ul><li>Lớp cấu hình này tạo các bean cho ba bộ chặn <code>FirstInterceptor</code>, <code>SecondInterceptor</code>, và <code>ThirdInterceptor</code>.</li><li>Thông qua việc đăng ký các bộ chặn, Spring MVC sẽ kích hoạt các interceptor tương ứng trên các đường dẫn cụ thể. Ví dụ, với <code>SecondInterceptor</code>, nếu người dùng truy cập vào <code>/users/current_user</code>, quá trình sẽ bị dừng lại do phương thức <code>preHandle</code> trả về <code>false</code>.</li></ul><h2 id="_6-3-usercontroller" tabindex="-1"><a class="header-anchor" href="#_6-3-usercontroller"><span>6.3 UserController</span></a></h2><p>Trong phần này, chúng ta sẽ kiểm tra hành vi của chuỗi interceptor (bộ chặn) thông qua các API được cung cấp bởi <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/controller/UserController.java" target="_blank" rel="noopener noreferrer">UserController</a>.</p><h3 id="_1-api-users-do-something" tabindex="-1"><a class="header-anchor" href="#_1-api-users-do-something"><span><strong>① API <code>/users/do_something</code></strong></span></a></h3><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserController.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/do_something&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> doSomething</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[doSomething]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>Khi gọi API này, kết quả log sẽ như sau:</p><div class="language-plaintext line-numbers-mode" data-highlighter="shiki" data-ext="plaintext" data-title="plaintext" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>// Đầu tiên, theo thứ tự của chuỗi HandlerInterceptor, các phương thức \`#preHandle(...)\` được thực thi.  </span></span>
<span class="line"><span>2019-11-17 12:31:38.049  INFO 28157 --- [nio-8080-exec-1] c.i.s.l.s.c.i.FirstInterceptor           : [preHandle][handler(public void cn.iocoder.springboot.lab23.springmvc.controller.UserController.doSomething())]  </span></span>
<span class="line"><span>2019-11-17 12:31:38.050  INFO 28157 --- [nio-8080-exec-1] c.i.s.l.s.c.i.ThirdInterceptor           : [preHandle][handler(public void cn.iocoder.springboot.lab23.springmvc.controller.UserController.doSomething())]  </span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>// Sau đó, xử lý logic của \`handler\`.  </span></span>
<span class="line"><span>[doSomething]  </span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>// Tiếp theo, theo thứ tự ngược của chuỗi HandlerInterceptor, các phương thức \`#postHandle(...)\` được thực thi.  </span></span>
<span class="line"><span>2019-11-17 12:31:38.109  INFO 28157 --- [nio-8080-exec-1] c.i.s.l.s.c.i.ThirdInterceptor           : [postHandle][handler(public void cn.iocoder.springboot.lab23.springmvc.controller.UserController.doSomething())]  </span></span>
<span class="line"><span>2019-11-17 12:31:38.109  INFO 28157 --- [nio-8080-exec-1] c.i.s.l.s.c.i.FirstInterceptor           : [postHandle][handler(public void cn.iocoder.springboot.lab23.springmvc.controller.UserController.doSomething())]  </span></span>
<span class="line"><span>  </span></span>
<span class="line"><span>// Cuối cùng, theo thứ tự ngược của chuỗi HandlerInterceptor, các phương thức \`#afterCompletion(...)\` được thực thi.  </span></span>
<span class="line"><span>2019-11-17 12:31:38.109  INFO 28157 --- [nio-8080-exec-1] c.i.s.l.s.c.i.ThirdInterceptor           : [afterCompletion][handler(public void cn.iocoder.springboot.lab23.springmvc.controller.UserController.doSomething())]  </span></span>
<span class="line"><span>java.lang.RuntimeException: Cố ý ném lỗi</span></span>
<span class="line"><span></span></span>
<span class="line"><span>2019-11-17 12:31:38.116  INFO 28157 --- [nio-8080-exec-1] c.i.s.l.s.c.i.FirstInterceptor           : [afterCompletion][handler(public void cn.iocoder.springboot.lab23.springmvc.controller.UserController.doSomething())]</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="giai-thich-1" tabindex="-1"><a class="header-anchor" href="#giai-thich-1"><span>Giải thích:</span></a></h3><ul><li>Các interceptor được thực thi theo thứ tự chuỗi <code>HandlerInterceptor</code>: <ul><li><code>preHandle()</code> thực thi từ interceptor đầu tiên (<code>FirstInterceptor</code>) đến cuối cùng (<code>ThirdInterceptor</code>).</li><li><code>postHandle()</code> và <code>afterCompletion()</code> thực thi ngược lại, từ <code>ThirdInterceptor</code> về <code>FirstInterceptor</code>.</li></ul></li><li><code>SecondInterceptor</code> không được kích hoạt vì nó chỉ được đăng ký cho đường dẫn <code>/users/current_user</code>.</li><li>Mặc dù <code>ThirdInterceptor</code> ném ra ngoại lệ trong <code>afterCompletion()</code>, nó không ảnh hưởng đến việc thực thi <code>afterCompletion()</code> của <code>FirstInterceptor</code>.</li></ul><h3 id="_2-api-users-current-user" tabindex="-1"><a class="header-anchor" href="#_2-api-users-current-user"><span><strong>② API <code>/users/current_user</code></strong></span></a></h3><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserController.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/current_user&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserVO</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> currentUser</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[currentUser]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UUID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">randomUUID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>Khi gọi API này, kết quả log sẽ như sau:</p><div class="language-plaintext" data-highlighter="shiki" data-ext="plaintext" data-title="plaintext" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>// Đầu tiên, theo thứ tự của chuỗi HandlerInterceptor, các phương thức \`#preHandle(...)\` được thực thi.  </span></span>
<span class="line"><span>2019-11-17 12:48:37.357  INFO 28157 --- [nio-8080-exec-5] c.i.s.l.s.c.i.FirstInterceptor           : [preHandle][handler(public cn.iocoder.springboot.lab23.springmvc.vo.UserVO cn.iocoder.springboot.lab23.springmvc.controller.UserController.currentUser())]  </span></span>
<span class="line"><span>2019-11-17 12:48:37.357  INFO 28157 --- [nio-8080-exec-5] c.i.s.l.s.c.i.SecondInterceptor          : [preHandle][handler(public cn.iocoder.springboot.lab23.springmvc.vo.UserVO cn.iocoder.springboot.lab23.springmvc.controller.UserController.currentUser())]  </span></span>
<span class="line"><span></span></span>
<span class="line"><span>// Không có xử lý \`handler\` do \`preHandle()\` của SecondInterceptor trả về \`false\`.</span></span>
<span class="line"><span></span></span>
<span class="line"><span>// Chỉ có \`afterCompletion()\` của FirstInterceptor được thực thi.</span></span>
<span class="line"><span>2019-11-17 12:48:37.358  INFO 28157 --- [nio-8080-exec-5] c.i.s.l.s.c.i.FirstInterceptor           : [afterCompletion][handler(public cn.iocoder.springboot.lab23.springmvc.vo.UserVO cn.iocoder.springboot.lab23.springmvc.controller.UserController.currentUser())]</span></span></code></pre></div><h3 id="giai-thich-2" tabindex="-1"><a class="header-anchor" href="#giai-thich-2"><span>Giải thích:</span></a></h3><ul><li>Vì <code>preHandle()</code> của <code>SecondInterceptor</code> trả về <code>false</code>, nên <code>handler</code> không được thực thi, và do đó, <code>postHandle()</code> không được gọi.</li><li>Chỉ có <code>afterCompletion()</code> của <code>FirstInterceptor</code> được thực thi.</li></ul><h3 id="_3-api-users-exception-03" tabindex="-1"><a class="header-anchor" href="#_3-api-users-exception-03"><span><strong>③ API <code>/users/exception-03</code></strong></span></a></h3><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserController.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/exception-03&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> exception03</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[exception03]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ServiceException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServiceExceptionEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">USER_NOT_FOUND</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>Khi gọi API này, kết quả log sẽ như sau:</p><div class="language-plaintext" data-highlighter="shiki" data-ext="plaintext" data-title="plaintext" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>// Đầu tiên, theo thứ tự của chuỗi HandlerInterceptor, các phương thức \`#preHandle(...)\` được thực thi.  </span></span>
<span class="line"><span>2019-11-17 12:54:45.029  INFO 28157 --- [nio-8080-exec-7] c.i.s.l.s.c.i.FirstInterceptor           : [preHandle][handler(public void cn.iocoder.springboot.lab23.springmvc.controller.UserController.exception03())]  </span></span>
<span class="line"><span>2019-11-17 12:54:45.029  INFO 28157 --- [nio-8080-exec-7] c.i.s.l.s.c.i.ThirdInterceptor           : [preHandle][handler(public void cn.iocoder.springboot.lab23.springmvc.controller.UserController.exception03())]  </span></span>
<span class="line"><span></span></span>
<span class="line"><span>// Xử lý \`handler\` ném ra ngoại lệ.</span></span>
<span class="line"><span>2019-11-17 12:54:45.029  INFO 28157 --- [nio-8080-exec-7] c.i.s.l.s.controller.UserController      : [exception03]  </span></span>
<span class="line"><span></span></span>
<span class="line"><span>// Chỉ có \`afterCompletion()\` được gọi sau khi handler ném ra ngoại lệ.</span></span>
<span class="line"><span>2019-11-17 12:54:45.036  INFO 28157 --- [nio-8080-exec-7] c.i.s.l.s.c.i.ThirdInterceptor           : [afterCompletion][handler(public void cn.iocoder.springboot.lab23.springmvc.controller.UserController.exception03())]  </span></span>
<span class="line"><span>2019-11-17 12:54:45.037 ERROR 28157 --- [nio-8080-exec-7] o.s.web.servlet.HandlerExecutionChain    : HandlerInterceptor.afterCompletion threw exception  </span></span>
<span class="line"><span>java.lang.RuntimeException: Cố ý ném lỗi</span></span></code></pre></div><h3 id="giai-thich-3" tabindex="-1"><a class="header-anchor" href="#giai-thich-3"><span>Giải thích:</span></a></h3><ul><li>Do <code>handler</code> ném ra ngoại lệ, nên <code>postHandle()</code> không được gọi.</li><li>Chỉ có <code>afterCompletion()</code> của các interceptor được thực thi.</li></ul><h2 id="_6-4-đoc-mo-rong" tabindex="-1"><a class="header-anchor" href="#_6-4-đoc-mo-rong"><span>6.4 Đọc Mở Rộng</span></a></h2><p>Dưới đây, tác giả đã tổng hợp một số lớp triển khai <code>HandlerInterceptor</code> cho các tình huống khác nhau, bạn có thể tham khảo tùy theo nhu cầu:</p><ul><li><strong>Interceptor hạn chế tốc độ</strong>: <a href="http://www.iocoder.cn/Fight/Spring-Boot-project-API-anti-brush-interface/?self" target="_blank" rel="noopener noreferrer">《Ngăn chặn API bị spam trong dự án Spring Boot》</a></li><li><strong>Interceptor ghi nhật ký truy cập</strong>: <a href="https://github.com/YunaiV/onemall/blob/master/common/mall-spring-boot/src/main/java/cn/iocoder/mall/spring/boot/web/interceptor/AccessLogInterceptor.java" target="_blank" rel="noopener noreferrer"><code>AccessLogInterceptor.java</code></a></li><li><strong>Interceptor xác thực và phân quyền người dùng</strong>: <a href="https://github.com/YunaiV/onemall/blob/master/user/user-sdk/src/main/java/cn/iocoder/mall/user/sdk/interceptor/UserSecurityInterceptor.java" target="_blank" rel="noopener noreferrer"><code>UserSecurityInterceptor.java</code></a></li><li><strong>Interceptor xác thực và phân quyền quản trị viên</strong>: <a href="https://github.com/YunaiV/onemall/blob/master/system/system-sdk/src/main/java/cn/iocoder/mall/admin/sdk/interceptor/AdminSecurityInterceptor.java" target="_blank" rel="noopener noreferrer"><code>AdminSecurityInterceptor.java</code></a></li></ul><p>Nếu bạn có ví dụ về <code>HandlerInterceptor</code> cho các tình huống khác, hãy để lại bình luận cho tác giả.</p><h1 id="_7-servlet-filter-listener" tabindex="-1"><a class="header-anchor" href="#_7-servlet-filter-listener"><span>7. Servlet, Filter, Listener</span></a></h1><p>Mặc dù trong phần lớn các trường hợp, chúng ta không cần sử dụng trực tiếp các thành phần <code>java.servlet</code> trong SpringMVC, nhưng khi làm việc với một số thư viện của bên thứ ba, họ thường cung cấp các thành phần trong <code>java.servlet</code>. Nguyên nhân là họ cần cung cấp các thành phần phổ biến và không thể gắn kết quá chặt với SpringMVC.</p><p>Ví dụ, khi sử dụng <a href="https://shiro.apache.org/" target="_blank" rel="noopener noreferrer">Shiro</a> để thực hiện các chức năng xác thực quyền truy cập, chúng ta cần cấu hình <code>ShiroFilterFactoryBean</code> mà Shiro cung cấp. Điều này yêu cầu sử dụng các thành phần <code>Filter</code> mà Shiro cung cấp, thay vì SpringMVC thuần túy.</p><p>Chúng ta có <strong>hai cách</strong> để cấu hình <code>Servlet</code>, <code>Filter</code>, và <code>Listener</code> bằng mã Java:</p><ol><li>Cấu hình thông qua Bean</li><li>Cấu hình thông qua Annotation</li></ol><p>Dưới đây, chúng ta sẽ cùng tìm hiểu ví dụ của hai cách cấu hình này.</p><blockquote><p><strong>Lưu ý</strong>: Ví dụ này được xây dựng dựa trên <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02" target="_blank" rel="noopener noreferrer">lab-springmvc-23-02</a>, tiếp nối từ <a href="#">Mục 6. Bộ chặn HandlerInterceptor</a>.</p></blockquote><h2 id="_7-1-cau-hinh-qua-bean" tabindex="-1"><a class="header-anchor" href="#_7-1-cau-hinh-qua-bean"><span>7.1 Cấu hình qua Bean</span></a></h2><p>Trong lớp cấu hình <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/config/SpringMVCConfiguration.java" target="_blank" rel="noopener noreferrer">SpringMVCConfiguration</a>, chúng ta sẽ thêm cấu hình cho ba Bean là Servlet, Filter và Listener. Mã nguồn như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// SpringMVCConfiguration.java  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServletRegistrationBean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> testServlet01</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    ServletRegistrationBean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> servletRegistrationBean </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServletRegistrationBean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> HttpServlet</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        protected</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> doGet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> resp</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServletException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[doGet][uri: {}]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequestURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    })</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    servletRegistrationBean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUrlMappings</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Collections</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">singleton</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/test/01&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> servletRegistrationBean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> FilterRegistrationBean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> testFilter01</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    FilterRegistrationBean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> filterRegistrationBean </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> FilterRegistrationBean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Filter</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> doFilter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> servletRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> servletResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FilterChain</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> filterChain</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServletException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[doFilter]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            filterChain</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">doFilter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(servletRequest, servletResponse);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    })</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    filterRegistrationBean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUrlPatterns</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Collections</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">singleton</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/test/*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> filterRegistrationBean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServletListenerRegistrationBean</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> testListener01</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServletListenerRegistrationBean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ServletContextListener</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> contextInitialized</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServletContextEvent</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> sce</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[contextInitialized]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> contextDestroyed</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServletContextEvent</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> sce</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    })</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Trong Spring Boot, đã cung cấp các lớp <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/web/servlet/ServletRegistrationBean.java" target="_blank" rel="noopener noreferrer">ServletRegistrationBean</a> để cấu hình Servlet Bean, <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/web/servlet/FilterRegistrationBean.java" target="_blank" rel="noopener noreferrer">FilterRegistrationBean</a> để cấu hình Filter Bean và <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/web/servlet/ServletListenerRegistrationBean.java" target="_blank" rel="noopener noreferrer">ServletListenerRegistrationBean</a> để cấu hình Listener Bean.</li><li>Ở đây, chúng ta sử dụng lớp nội bộ để ví dụ đơn giản hơn. Tuy nhiên, trong thực tế, hãy định nghĩa các lớp riêng biệt để dễ quản lý hơn.</li></ul><h2 id="_7-2-cau-hinh-qua-chu-thich" tabindex="-1"><a class="header-anchor" href="#_7-2-cau-hinh-qua-chu-thich"><span>7.2 Cấu hình qua chú thích</span></a></h2><p>Trong các tính năng mới của Servlet 3.0, đã cung cấp ba chú thích là <a href="https://github.com/javaee/servlet-spec/blob/master/src/main/java/javax/servlet/annotation/WebServlet.java" target="_blank" rel="noopener noreferrer"><code>@WebServlet</code></a>、<a href="https://github.com/javaee/servlet-spec/blob/master/src/main/java/javax/servlet/annotation/WebFilter.java" target="_blank" rel="noopener noreferrer"><code>@WebFilter</code></a> và <a href="https://github.com/javaee/servlet-spec/blob/master/src/main/java/javax/servlet/annotation/WebListener.java" target="_blank" rel="noopener noreferrer"><code>@WebListener</code></a> để dễ dàng cấu hình Servlet, Filter và Listener.</p><p>Trong Spring Boot, chúng ta chỉ cần thêm chú thích <a href="https://github.com/spring-projects/spring-boot/blob/master/spring-boot-project/spring-boot/src/main/java/org/springframework/boot/web/servlet/ServletComponentScan.java" target="_blank" rel="noopener noreferrer"><code>@ServletComponentScan</code></a> vào lớp Application, để kích hoạt việc quét các chú thích <code>@WebServlet</code>, <code>@WebFilter</code>, <code>@WebListener</code>. Tuy nhiên, cần <strong>lưu ý</strong> rằng điều này chỉ có hiệu lực khi sử dụng Web Server <strong>nhúng</strong>.</p><p>Trong gói <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/core/servlet" target="_blank" rel="noopener noreferrer"><code>cn.iocoder.springboot.lab23.springmvc.core.servlet</code></a>, chúng ta đã tạo ba ví dụ. Mã nguồn như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// TestServlet02.java  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">WebServlet</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">urlPatterns</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;/test/02&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TestServlet02</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> HttpServlet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    protected</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> doGet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> resp</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServletException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[doGet][uri: {}]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">req</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getRequestURI</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// TestFilter02.java  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">WebFilter</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/test/*&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TestFilter02</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Filter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> doFilter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServletRequest</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> servletRequest</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServletResponse</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> servletResponse</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">FilterChain</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> filterChain</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> IOException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServletException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[doFilter]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        filterChain</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">doFilter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(servletRequest, servletResponse);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// TestServletContextListener02.java  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">WebListener</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TestServletContextListener02</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ServletContextListener</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getClass</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> contextInitialized</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServletContextEvent</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> sce</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;[contextInitialized]&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> contextDestroyed</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ServletContextEvent</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> sce</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h1 id="_8-cors-cross-origin-resource-sharing" tabindex="-1"><a class="header-anchor" href="#_8-cors-cross-origin-resource-sharing"><span>8. CORS (Cross-Origin Resource Sharing)</span></a></h1><blockquote><p>Mã ví dụ tương ứng với kho lưu trữ: <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02" target="_blank" rel="noopener noreferrer">lab-springmvc-23-02</a>.</p></blockquote><p>Sau khi tách biệt frontend và backend, chúng ta sẽ gặp phải vấn đề liên quan đến CORS. Ví dụ, frontend nằm ở miền <a href="http://www.iocoder.cn" target="_blank" rel="noopener noreferrer">http://www.iocoder.cn</a> trong khi API backend ở miền <a href="http://api.iocoder.cn" target="_blank" rel="noopener noreferrer">http://api.iocoder.cn</a>.</p><p>Đối với những bạn chưa hiểu rõ về CORS, có thể tham khảo bài viết <a href="https://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener noreferrer">Tìm hiểu về CORS</a> của tác giả Ruanyu. 😈 Tất nhiên, bạn cũng có thể tiếp tục đọc bài viết này.</p><p>Có nhiều cách để giải quyết vấn đề CORS, chẳng hạn như cấu hình các tham số xử lý yêu cầu CORS trên Nginx. Hay trong trường hợp có dịch vụ gateway trong dự án, bạn có thể cấu hình đồng nhất. Tuy nhiên, vì bài viết này tập trung vào Spring Boot và Spring MVC, nên chúng ta sẽ chỉ sử dụng Spring MVC để giải quyết vấn đề CORS. Hiện có ba giải pháp:</p><ul><li><strong>Giải pháp 1</strong>: Sử dụng chú thích <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/bind/annotation/CrossOrigin.java" target="_blank" rel="noopener noreferrer"><code>@CrossOrigin</code></a> để cấu hình cho từng API.</li><li><strong>Giải pháp 2</strong>: Sử dụng bảng <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/java/org/springframework/web/servlet/config/annotation/CorsRegistry.java" target="_blank" rel="noopener noreferrer"><code>CorsRegistry.java</code></a> để đăng ký cho từng API.</li><li><strong>Giải pháp 3</strong>: Sử dụng <strong>bộ lọc</strong> <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-web/src/main/java/org/springframework/web/filter/CorsFilter.java" target="_blank" rel="noopener noreferrer"><code>CorsFilter.java</code></a> để xử lý các yêu cầu CORS.</li></ul><p>Trong đó, giải pháp 1 và giải pháp 2 về bản chất là giống nhau, chỉ khác nhau ở cách cấu hình. Những bạn muốn hiểu nguyên lý bên dưới có thể tham khảo <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/java/org/springframework/web/servlet/handler/AbstractHandlerMapping.java#L561-L582" target="_blank" rel="noopener noreferrer">CorsInterceptor</a> <strong>bộ lọc</strong>.</p><blockquote><p>Lưu ý: Ví dụ này được phát triển dựa trên <a href="#">「7. Servlet, Filter, Listener」</a> trong <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02" target="_blank" rel="noopener noreferrer">lab-springmvc-23-02</a>.</p></blockquote><h2 id="_8-1-crossorigin" tabindex="-1"><a class="header-anchor" href="#_8-1-crossorigin"><span>8.1 @CrossOrigin</span></a></h2><p>Chú thích <code>@CrossOrigin</code> được thêm vào lớp hoặc phương thức để đánh dấu thông tin CORS cho API tương ứng.</p><p>Các <strong>thuộc tính thường dùng</strong> của chú thích <code>@CrossOrigin</code> như sau:</p><ul><li>Thuộc tính <code>origins</code>: thiết lập nguồn yêu cầu được phép. Đây là một mảng <code>[]</code> có thể chứa nhiều nguồn yêu cầu. Giá trị mặc định là <code>*</code>.</li><li>Thuộc tính <code>value</code>: giống như thuộc tính <code>origins</code>, đây là bí danh của nó.</li><li>Thuộc tính <code>allowCredentials</code>: xác định xem có cho phép yêu cầu từ phía client gửi Cookie hay không. Giá trị mặc định là <code>false</code>, không cho phép gửi Cookie.</li><li>Thuộc tính <code>maxAge</code>: thời gian hiệu lực của yêu cầu kiểm tra trước (preflight request) trong đơn vị giây. Giá trị mặc định là 1800 giây.</li></ul><p>Các <strong>thuộc tính ít được sử dụng</strong> của chú thích <code>@CrossOrigin</code> như sau:</p><ul><li>Thuộc tính <code>methods</code>: thiết lập các phương thức yêu cầu được phép. Đây cũng là một mảng <code>[]</code> có thể chứa nhiều phương thức yêu cầu. Giá trị mặc định là <code>GET + POST</code>.</li><li>Thuộc tính <code>allowedHeaders</code>: các header yêu cầu được phép. Đây cũng là một mảng <code>[]</code> có thể chứa nhiều header. Giá trị mặc định là <code>*</code>.</li><li>Thuộc tính <code>exposedHeaders</code>: các header phản hồi được phép. Đây cũng là một mảng <code>[]</code> có thể chứa nhiều header. Giá trị mặc định là <code>*</code>.</li></ul><p>Trong hầu hết các trường hợp, bạn chỉ cần thêm chú thích <code>@CrossOrigin</code> lên <strong>mỗi</strong> Controller. Tuy nhiên, nếu một API cụ thể muốn cấu hình tùy chỉnh, bạn có thể thêm chú thích này lên phương thức. Ví dụ như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// TestController.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RestController</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RequestMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/test&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">CrossOrigin</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">origins</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> allowCredentials</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;true&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Cho phép tất cả nguồn, cho phép gửi Cookie  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> TestController</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    /**  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * Lấy người dùng theo ID được chỉ định  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     *  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> Người dùng  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">     */</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GetMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/get&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">CrossOrigin</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">allowCredentials</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;false&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Cho phép tất cả nguồn, không cho phép gửi Cookie  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserVO</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UserVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">UUID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">randomUUID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">toString</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Trong hầu hết các trường hợp, bạn chỉ cần thêm <code>@CrossOrigin(allowCredentials = &quot;true&quot;)</code> lên Controller là đủ.</strong></p><p><strong>Một số vấn đề cần lưu ý</strong></p><p>Khi frontend sử dụng thư viện mạng tuân thủ tiêu chuẩn CORS, chẳng hạn như thư viện mạng phổ biến trong Vue là <a href="https://github.com/axios/axios" target="_blank" rel="noopener noreferrer">axios</a>, khi gửi <a href="https://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener noreferrer">yêu cầu không đơn giản</a>, nó sẽ tự động gửi trước một yêu cầu <code>OPTIONS</code> để xác nhận xem server có cho phép yêu cầu như vậy hay không. Do đó, yêu cầu này sẽ được xử lý bởi bộ lọc của Spring MVC.</p><p>Lúc này, nếu bộ lọc của chúng ta cho rằng <code>handler</code> <strong>chắc chắn</strong> là loại <code>HandlerMethod</code>, sẽ dẫn đến lỗi. Chẳng hạn, trong bộ lọc <a href="https://github.com/YunaiV/onemall/blob/master/user/user-sdk/src/main/java/cn/iocoder/mall/user/sdk/interceptor/UserSecurityInterceptor.java" target="_blank" rel="noopener noreferrer">UserSecurityInterceptor</a>, nó sẽ coi <code>handler</code> là loại <code>HandlerMethod</code> và sau đó lấy thông tin chú thích <code>@RequiresLogin</code> để xác định xem có cần đăng nhập hay không. Nhưng thực tế, lúc này <code>handler</code> lại là loại <a href="https://github.com/spring-projects/spring-framework/blob/master/spring-webmvc/src/main/java/org/springframework/web/servlet/handler/AbstractHandlerMapping.java#L539-L558" target="_blank" rel="noopener noreferrer">PreFlightHandler</a>, do đó sẽ ném ra ngoại lệ. Như hình dưới đây:</p><figure><img src="https://static.iocoder.cn/images/Spring-Boot/2019-11-17/03.png" alt="getCorsHandlerExecutionChain" tabindex="0" loading="lazy"><figcaption>getCorsHandlerExecutionChain</figcaption></figure><p>Trong trường hợp này, có hai giải pháp:</p><ol><li>Kiểm tra từng bộ lọc để xác nhận xem có phải phụ thuộc vào logic cho rằng <code>handler</code> là <code>HandlerMethod</code> hay không và thực hiện sửa chữa.</li><li>Không sử dụng giải pháp này mà thay vào đó áp dụng <a href="#">「8.3 CorsFilter」</a> để tránh việc yêu cầu <code>OPTIONS</code> đi qua bộ lọc.</li></ol><p>Rõ ràng, giải pháp <code>1)</code> có chi phí cao hơn một chút, vì vậy trong hầu hết các trường hợp, khuyến nghị sử dụng <code>2)</code>. Hiện tại, dự án của tôi cũng áp dụng phương pháp <a href="#">「8.3 CorsFilter」</a>.</p><p>😈 Trong bài viết <a href="https://segmentfault.com/a/1190000010348077" target="_blank" rel="noopener noreferrer">《【SpringMVC】与权限拦截器冲突导致的 Cors 跨域设置失效问题》</a>, bạn cũng có thể thấy một nhà phát triển gặp phải vấn đề tương tự.</p><h2 id="_8-2-corsregistry" tabindex="-1"><a class="header-anchor" href="#_8-2-corsregistry"><span>8.2 CorsRegistry</span></a></h2><p>Rõ ràng, việc cấu hình chú thích <code>@CrossOrigin</code> trên mỗi Controller là một công việc khá phức tạp. Vì vậy, trong nhiều trường hợp, chúng ta sẽ chọn cấu hình thông qua <code>CorsRegistry</code>.</p><p>Hãy sửa đổi lớp cấu hình <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/config/SpringMVCConfiguration.java" target="_blank" rel="noopener noreferrer">SpringMVCConfiguration</a> để thêm cấu hình liên quan đến <code>CorsRegistry</code>. Dưới đây là đoạn mã:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// SpringMVCConfiguration.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> addCorsMappings</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">CorsRegistry</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> registry) {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Thêm cấu hình CORS toàn cầu  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    registry</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">addMapping</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/**&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Khớp với tất cả URL, tương đương với cấu hình toàn cầu  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">allowedOrigins</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Cho phép tất cả nguồn yêu cầu  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">allowCredentials</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Cho phép gửi Cookie  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">allowedMethods</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Cho phép tất cả phương thức yêu cầu  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">allowedHeaders</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Cho phép tất cả header yêu cầu  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">//            .exposedHeaders(&quot;*&quot;) // Cho phép tất cả header phản hồi  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">            .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">maxAge</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1800L</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Thời gian hiệu lực 1800 giây, tức 2 giờ  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><ul><li>Ở đây, cấu hình đường dẫn khớp là <code>/**</code>, cho phép cấu hình CORS toàn cầu.</li><li>Nếu bạn muốn cấu hình CORS cho một đường dẫn cụ thể, có thể sử dụng phương thức <code>CorsRegistry#addMapping(String pathPattern)</code> để thêm cấu hình CORS.</li><li>Nếu bạn muốn an toàn hơn, có thể chỉ định các địa chỉ miền frontend cho thuộc tính <code>origins</code>.</li></ul><p>Phương pháp này cũng sẽ gặp phải những vấn đề tương tự như trong phần <a href="#">「8.1 @CrossOrigin」</a>, vì hai phương pháp này có cách triển khai tương tự. Vì vậy, hãy tiếp tục xem xét phương pháp <a href="#">「8.3 CorsFilter」</a>.</p><h2 id="_8-3-corsfilter" tabindex="-1"><a class="header-anchor" href="#_8-3-corsfilter"><span>8.3 CorsFilter</span></a></h2><p>Trong <a href="https://github.com/spring-projects/spring-framework/tree/master/spring-web" target="_blank" rel="noopener noreferrer">Spring Web</a>, đã cung cấp sẵn bộ lọc <code>CorsFilter</code> để xử lý CORS.</p><p>Cách cấu hình rất đơn giản. Vì đây là một bộ lọc (Filter), chúng ta có thể sử dụng cách <a href="#">「7.1 Cấu hình qua Bean」</a> để cấu hình. Do đó, hãy chỉnh sửa lớp cấu hình <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/config/SpringMVCConfiguration.java" target="_blank" rel="noopener noreferrer">SpringMVCConfiguration</a> để thêm cấu hình liên quan đến <code>CorsFilter</code>. Dưới đây là đoạn mã:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// SpringMVCConfiguration.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> FilterRegistrationBean</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">CorsFilter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> corsFilter</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">() {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Tạo UrlBasedCorsConfigurationSource, giống như CorsRegistry  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    UrlBasedCorsConfigurationSource</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> source </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> UrlBasedCorsConfigurationSource</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Tạo CorsConfiguration, tương đương với thông tin CorsRegistration  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    CorsConfiguration</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> config </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> CorsConfiguration</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setAllowedOrigins</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Collections</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">singletonList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Cho phép tất cả nguồn yêu cầu  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setAllowCredentials</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Cho phép gửi Cookie  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">addAllowedMethod</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Cho phép tất cả phương thức yêu cầu  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setAllowedHeaders</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Collections</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">singletonList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;*&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Cho phép tất cả header yêu cầu  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // config.setExposedHeaders(Collections.singletonList(&quot;*&quot;)); // Cho phép tất cả header phản hồi  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setMaxAge</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1800L</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Thời gian hiệu lực 1800 giây, tức 2 giờ  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    source</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">registerCorsConfiguration</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/**&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, config);</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Tạo đối tượng FilterRegistrationBean  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    FilterRegistrationBean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">CorsFilter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> bean </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> FilterRegistrationBean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> CorsFilter</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(source))</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Tạo bộ lọc CorsFilter  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setOrder</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Thiết lập thứ tự. Thứ tự này rất quan trọng, nên hãy đặt ở vị trí đầu tiên  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Tôi đã thêm các chú thích chi tiết, các bạn tự xem nhé. Về hiệu ứng, nó giống như phương pháp <a href="#">「8.2 CorsRegistry」</a>.</li></ul><p>Đến đây, chúng ta đã học xong ba cách cấu hình CORS trong SpringMVC. <strong>Kết luận là, nên sử dụng phương pháp <a href="#">「8.3 CorsFilter」</a></strong>. 😈 Cảm thấy mình nói hơi nhiều rồi. Cuối cùng, tôi muốn giới thiệu một bài viết mà tôi thấy viết rất hay: <a href="https://segmentfault.com/a/1190000019485883" target="_blank" rel="noopener noreferrer">《Spring 里那么多种 CORS 的配置方式，到底有什么区》</a>.</p><h1 id="_9-httpmessageconverter-chuyen-đoi-noi-dung-tin-nhan" tabindex="-1"><a class="header-anchor" href="#_9-httpmessageconverter-chuyen-đoi-noi-dung-tin-nhan"><span>9. HttpMessageConverter chuyển đổi nội dung tin nhắn</span></a></h1><blockquote><p>Mã nguồn nằm trong：<a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02" target="_blank" rel="noopener noreferrer">lab-springmvc-23-02</a>。</p></blockquote><p>Trong Spring MVC, chúng ta có thể sử dụng hai chú thích <code>@RequestBody</code> và <code>@ResponseBody</code> để thực hiện việc <strong>chuyển đổi nội dung yêu cầu thành đối tượng</strong> và <strong>đối tượng thành nội dung phản hồi</strong>. Cơ chế chuyển đổi linh hoạt này được thực hiện bởi <code>HttpMessageConverter</code> được giới thiệu trong Spring 3.x, tức là cơ chế chuyển đổi tin nhắn.</p><p>Với giải thích như vậy, có lẽ bạn vẫn chưa thực sự thấu hiểu. 😜 Trong ví dụ trên, chúng ta đã thấy rằng khi trả về một đối tượng <code>UserVO</code>, nó cuối cùng được xuất ra dưới dạng chuỗi JSON cho phía trước, điều này được thực hiện bởi <code>MappingJackson2HttpMessageConverter</code>, bộ chuyển đổi tin nhắn chuyển đổi đối tượng <code>UserVO</code> thành chuỗi JSON để trả về phía trước. 😈 Bây giờ bạn đã hiểu hơn một chút chưa?</p><p>Trong một số tình huống nghiệp vụ, khi phía trước gửi các tham số đến API backend có thể phức tạp, có thể chúng ta muốn sử dụng định dạng JSON để gửi đến API backend. Lúc này, chúng ta có thể sử dụng bộ chuyển đổi <code>MappingJackson2HttpMessageConverter</code> để chuyển đổi chuỗi JSON thành đối tượng tương ứng. 😈 Có phải mọi thứ đã trở nên rõ ràng hơn chưa?</p><p>Hãy cùng xem qua giao diện <code>HttpMessageConverter</code>, dưới đây là mã nguồn:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// HttpMessageConverter.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Kiểm tra xem có thể đọc loại nội dung mediaType cụ thể, chuyển đổi thành đối tượng clazz hay không  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> canRead</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Class</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> clazz</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Nullable</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MediaType</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> mediaType)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Đọc nội dung yêu cầu, chuyển đổi thành đối tượng clazz  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> read</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Class</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> extends T</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> clazz</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> HttpInputMessage</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> inputMessage)  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">			throws IOException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> HttpMessageNotReadableException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Kiểm tra xem có thể tuần tự hóa đối tượng clazz thành loại nội dung mediaType hay không  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> canWrite</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Class</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> clazz</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Nullable</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MediaType</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> mediaType)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Tuần tự hóa đối tượng clazz thành loại nội dung contentType và ghi vào phản hồi.  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> write</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">T</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> t</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Nullable</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MediaType</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> contentType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> HttpOutputMessage</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> outputMessage)  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">			throws IOException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> HttpMessageNotWritableException</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Lấy loại nội dung mà HttpMessageConverter có thể hỗ trợ.  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">MediaType</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getSupportedMediaTypes</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><p>Trong <strong>yêu cầu</strong>, chúng ta chỉ định loại nội dung của nội dung yêu cầu (Request Body) thông qua tiêu đề <code>Content-Type</code>. Khi đó, Spring MVC sẽ kiểm tra mảng <strong>HttpMessageConverter</strong> của mình bằng phương thức <code>#canRead(clazz, mediaType)</code> để xác định xem có thể đọc loại nội dung <code>mediaType</code> cụ thể hay không, và chuyển đổi thành đối tượng <code>clazz</code>. Nếu có thể, nó sẽ gọi phương thức <code>#read(Class&lt;? extends T&gt; clazz, HttpInputMessage inputMessage)</code> để đọc nội dung yêu cầu và chuyển đổi thành đối tượng <code>clazz</code>.</p></li><li><p>Trong <strong>phản hồi</strong>, chúng ta chỉ định loại nội dung của nội dung phản hồi (Response Body) thông qua tiêu đề <code>Accept</code>. Khi đó, Spring MVC sẽ kiểm tra mảng <strong>HttpMessageConverter</strong> của mình bằng phương thức <code>#canWrite(clazz, mediaType)</code> để xác định xem có thể tuần tự hóa đối tượng <code>clazz</code> thành loại nội dung <code>mediaType</code> hay không. Nếu có thể, nó sẽ gọi phương thức <code>#write(contentType, outputMessage)</code> để tuần tự hóa đối tượng <code>clazz</code> thành loại nội dung <code>contentType</code> và ghi vào phản hồi.</p></li></ul><p>Nếu bạn vẫn chưa hiểu, chúng ta hãy cùng nhau xem xét một ví dụ. Chúng ta sẽ thực hiện một API thêm người dùng, hỗ trợ <strong>định dạng JSON/XML</strong> cho cả việc gửi dữ liệu và phản hồi dữ liệu.</p><blockquote><p>Lưu ý: Ví dụ này dựa trên nền tảng của <a href="#">「8. Cors 」</a> trong kho lưu trữ <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02" target="_blank" rel="noopener noreferrer">lab-springmvc-23-02</a>.</p></blockquote><h2 id="_9-1-nhap-phu-thuoc" tabindex="-1"><a class="header-anchor" href="#_9-1-nhap-phu-thuoc"><span>9.1 Nhập phụ thuộc</span></a></h2><p>Trong tệp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/pom.xml" target="_blank" rel="noopener noreferrer"><code>pom.xml</code></a>, <strong>thêm</strong> phụ thuộc <a href="https://mvnrepository.com/artifact/com.fasterxml.jackson.dataformat/jackson-dataformat-xml" target="_blank" rel="noopener noreferrer"><code>jackson-dataformat-xml</code></a> như sau:</p><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&lt;!-- Thêm jackson để chuyển đổi sang xml, thực hiện tuần tự hóa đối với XML --&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;com.fasterxml.jackson.dataformat&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;jackson-dataformat-xml&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><h2 id="_9-2-springmvcconfiguration" tabindex="-1"><a class="header-anchor" href="#_9-2-springmvcconfiguration"><span>9.2 SpringMVCConfiguration</span></a></h2><p>Sửa đổi lớp cấu hình <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/config/SpringMVCConfiguration.java" target="_blank" rel="noopener noreferrer">SpringMVCConfiguration</a> để thêm cấu hình liên quan đến <code>MappingJackson2XmlHttpMessageConverter</code>, dùng cho bộ chuyển đổi <code>HttpMessageConverter</code> định dạng XML. Mã như sau:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// SpringMVCConfiguration.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> configureMessageConverters</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpMessageConverter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> converters) {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Thêm bộ chuyển đổi tin nhắn XML  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    Jackson2ObjectMapperBuilder</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> xmlBuilder </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Jackson2ObjectMapperBuilder</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">xml</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    xmlBuilder</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">indentOutput</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    converters</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> MappingJackson2XmlHttpMessageConverter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">xmlBuilder</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()));</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><h2 id="_9-3-usercontroller" tabindex="-1"><a class="header-anchor" href="#_9-3-usercontroller"><span>9.3 UserController</span></a></h2><p>Trong lớp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/controller/UserController.java" target="_blank" rel="noopener noreferrer">UserController</a>, chúng ta thêm một API để tạo người dùng, thuận tiện cho việc xử lý yêu cầu và phản hồi định dạng XML/JSON. Mã như sau:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// UserController.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">value</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;/add&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ↓ Thêm &quot;application/xml&quot;, &quot;application/json&quot; cho tiêu đề yêu cầu Content-Type  </span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">        consumes</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MediaType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">APPLICATION_XML_VALUE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MediaType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">APPLICATION_JSON_VALUE</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // ↓ Thêm &quot;application/xml&quot;, &quot;application/json&quot; cho tiêu đề yêu cầu Accept  </span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">        produces</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MediaType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">APPLICATION_XML_VALUE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MediaType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">APPLICATION_JSON_VALUE</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserVO</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RequestBody</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> UserVO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> user) {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><h3 id="yeu-cau" tabindex="-1"><a class="header-anchor" href="#yeu-cau"><span>Yêu cầu</span></a></h3><ul><li>Trong tham số của giao diện, chúng ta đã thêm chú thích <code>@RequestBody</code>.</li><li>Thêm thuộc tính <code>consumes</code>, tăng cường <code>&quot;application/xml&quot;</code>, <code>&quot;application/json&quot;</code> cho tiêu đề yêu cầu <code>Content-Type</code>.</li></ul><h3 id="phan-hoi" tabindex="-1"><a class="header-anchor" href="#phan-hoi"><span>Phản hồi</span></a></h3><ul><li>Bởi vì <code>UserController</code> đã thêm chú thích <code>@RestController</code>, chúng ta không cần phải thêm chú thích <code>@ResponseBody</code> cho API này.</li><li>Thêm thuộc tính <code>produces</code>, tăng cường <code>&quot;application/xml&quot;</code>, <code>&quot;application/json&quot;</code> cho tiêu đề yêu cầu <code>Accept</code>.</li></ul><p>Sau đây, chúng ta sẽ sử dụng <a href="https://www.getpostman.com/" target="_blank" rel="noopener noreferrer">Postman</a> để mô phỏng yêu cầu.</p><p><strong>① Yêu cầu định dạng JSON, phản hồi định dạng JSON</strong></p><figure><img src="https://static.iocoder.cn/images/Spring-Boot/2019-11-17/04.png" alt="JSON + JSON" tabindex="0" loading="lazy"><figcaption>JSON + JSON</figcaption></figure><p><strong>② Yêu cầu định dạng XML, phản hồi định dạng XML</strong></p><figure><img src="https://static.iocoder.cn/images/Spring-Boot/2019-11-17/05.png" alt="XML + XML" tabindex="0" loading="lazy"><figcaption>XML + XML</figcaption></figure><p><strong>③ Yêu cầu định dạng JSON, phản hồi định dạng XML</strong></p><figure><img src="https://static.iocoder.cn/images/Spring-Boot/2019-11-17/06.png" alt="JSON + XML" tabindex="0" loading="lazy"><figcaption>JSON + XML</figcaption></figure><h1 id="_10-tich-hop-fastjson" tabindex="-1"><a class="header-anchor" href="#_10-tich-hop-fastjson"><span>10. Tích hợp Fastjson</span></a></h1><blockquote><p>Mã ví dụ tương ứng với kho lưu trữ: <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02" target="_blank" rel="noopener noreferrer">lab-springmvc-23-02</a>.</p></blockquote><p>Tham khảo bài viết <a href="https://github.com/alibaba/fastjson/wiki/%E5%9C%A8-Spring-%E4%B8%AD%E9%9B%86%E6%88%90-Fastjson" target="_blank" rel="noopener noreferrer">《Tích hợp Fastjson trong Spring》</a>.</p><p>Chúng ta có thể muốn sử dụng Fastjson làm công cụ mặc định cho JSON để nâng cao hiệu suất tuần tự hóa và giải tuần tự hóa JSON. Trong Fastjson, đã có sẵn <a href="https://github.com/alibaba/fastjson/blob/master/src/main/java/com/alibaba/fastjson/support/spring/FastJsonHttpMessageConverter.java" target="_blank" rel="noopener noreferrer">FastJsonHttpMessageConverter</a>, giúp chúng ta thay thế bộ chuyển đổi <code>HttpMessageConverter</code> mặc định của SpringMVC.</p><blockquote><p>Lưu ý: Ví dụ này dựa trên <a href="#">「8. CORS」</a> của <a href="https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23/lab-springmvc-23-02" target="_blank" rel="noopener noreferrer">lab-springmvc-23-02</a> để tiếp tục cải tiến.</p></blockquote><h2 id="_10-1-nhap-phu-thuoc" tabindex="-1"><a class="header-anchor" href="#_10-1-nhap-phu-thuoc"><span>10.1 Nhập phụ thuộc</span></a></h2><p>Trong tệp <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/pom.xml" target="_blank" rel="noopener noreferrer"><code>pom.xml</code></a>, <strong>thêm</strong> phụ thuộc <a href="https://mvnrepository.com/artifact/com.alibaba/fastjson" target="_blank" rel="noopener noreferrer"><code>fastjson</code></a> như sau:</p><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&lt;!-- Thêm Fastjson, thực hiện tuần tự hóa đối với JSON --&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;com.alibaba&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;fastjson&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;1.2.62&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">version</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><h2 id="_10-2-springmvcconfiguration" tabindex="-1"><a class="header-anchor" href="#_10-2-springmvcconfiguration"><span>10.2 SpringMVCConfiguration</span></a></h2><p>Sửa đổi lớp cấu hình <a href="https://github.com/YunaiV/SpringBoot-Labs/blob/master/lab-23/lab-springmvc-23-02/src/main/java/cn/iocoder/springboot/lab23/springmvc/config/SpringMVCConfiguration.java" target="_blank" rel="noopener noreferrer">SpringMVCConfiguration</a> để thêm cấu hình liên quan đến <code>FastJsonHttpMessageConverter</code>. Mã như sau:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// SpringMVCConfiguration.java  </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> configureMessageConverters</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">List</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">HttpMessageConverter</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> converters) {  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Tạo đối tượng FastJsonHttpMessageConverter  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    FastJsonHttpMessageConverter</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> fastJsonHttpMessageConverter </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> FastJsonHttpMessageConverter</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Tùy chỉnh cấu hình FastJson  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    FastJsonConfig</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> fastJsonConfig </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> FastJsonConfig</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    fastJsonConfig</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setCharset</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Charset</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">defaultCharset</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Thiết lập bộ mã ký tự  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    fastJsonConfig</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setSerializerFeatures</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SerializerFeature</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">DisableCircularReferenceDetect</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Bỏ qua tham chiếu vòng  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    fastJsonHttpMessageConverter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setFastJsonConfig</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(fastJsonConfig);</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Thiết lập MediaType hỗ trợ  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    fastJsonHttpMessageConverter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setSupportedMediaTypes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Arrays</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">asList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">MediaType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">APPLICATION_JSON</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            MediaType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">APPLICATION_JSON_UTF8</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">));</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Thêm vào converters  </span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    converters</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, fastJsonHttpMessageConverter);</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> // Lưu ý, thêm vào đầu tiên, đặt trước MappingJackson2XmlHttpMessageConverter  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Đến đây, việc tích hợp Fastjson vào SpringMVC đã hoàn tất, rất thuận tiện!</p><h1 id="_666-tong-ket" tabindex="-1"><a class="header-anchor" href="#_666-tong-ket"><span>666. Tổng kết</span></a></h1><p>Tóm lại, đầy là một bài viết dài nhưng mà nó đầy đủ các kiến thức cơ bản về Spring MVC mà các bạn sẽ phải đối mặt trong các dự án thực tế được tổng hợp đầy đủ và gọn gàng.</p><p>Nếu trong bài viết này có gì không chính xác hoặc khiến bạn đọc hiểu lầm, rất mong bạn để lại lời nhắn cho mình.</p>`,320)]))}const p=s(l,[["render",h],["__file","springmvc.html.vue"]]),r=JSON.parse('{"path":"/framework/spring-boot/springmvc.html","title":"SpringMVC","lang":"en-US","frontmatter":{"title":"SpringMVC","tags":["java","spring-boot"],"categories":["spring-boot"],"order":7,"description":"SpringMVC Bài viết này cung cấp mã nguồn đầy đủ, bạn có thể xem tại https://github.com/YunaiV/SpringBoot-Labs trong thư mục lab-23. Việc sáng tạo nội dung không hề dễ dàng, hãy ...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/framework/spring-boot/springmvc.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"SpringMVC"}],["meta",{"property":"og:description","content":"SpringMVC Bài viết này cung cấp mã nguồn đầy đủ, bạn có thể xem tại https://github.com/YunaiV/SpringBoot-Labs trong thư mục lab-23. Việc sáng tạo nội dung không hề dễ dàng, hãy ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://static.iocoder.cn/images/Spring-Boot/2019-11-17/01.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-10-02T17:20:50.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"java"}],["meta",{"property":"article:tag","content":"spring-boot"}],["meta",{"property":"article:modified_time","content":"2024-10-02T17:20:50.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"SpringMVC\\",\\"image\\":[\\"https://static.iocoder.cn/images/Spring-Boot/2019-11-17/01.png\\",\\"https://static.iocoder.cn/images/Spring-Boot/2019-11-17/02.png\\",\\"https://static.iocoder.cn/images/Spring-Boot/2019-11-17/03.png\\",\\"https://static.iocoder.cn/images/Spring-Boot/2019-11-17/04.png\\",\\"https://static.iocoder.cn/images/Spring-Boot/2019-11-17/05.png\\",\\"https://static.iocoder.cn/images/Spring-Boot/2019-11-17/06.png\\"],\\"dateModified\\":\\"2024-10-02T17:20:50.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"2.1 Các chú thích (Annotation)","slug":"_2-1-cac-chu-thich-annotation","link":"#_2-1-cac-chu-thich-annotation","children":[{"level":3,"title":"2.1.1 @Controller","slug":"_2-1-1-controller","link":"#_2-1-1-controller","children":[]},{"level":3,"title":"2.1.2 @RequestMapping","slug":"_2-1-2-requestmapping","link":"#_2-1-2-requestmapping","children":[]},{"level":3,"title":"2.1.3 @RequestParam","slug":"_2-1-3-requestparam","link":"#_2-1-3-requestparam","children":[]}]},{"level":2,"title":"2.2 Thêm phụ thuộc","slug":"_2-2-them-phu-thuoc","link":"#_2-2-them-phu-thuoc","children":[]},{"level":2,"title":"2.3 Application","slug":"_2-3-application","link":"#_2-3-application","children":[]},{"level":2,"title":"2.4 UserController","slug":"_2-4-usercontroller","link":"#_2-4-usercontroller","children":[]},{"level":2,"title":"2.5 UserController2","slug":"_2-5-usercontroller2","link":"#_2-5-usercontroller2","children":[]},{"level":2,"title":"3.1 Kiểm Thử Tích Hợp","slug":"_3-1-kiem-thu-tich-hop","link":"#_3-1-kiem-thu-tich-hop","children":[]},{"level":2,"title":"3.2 Kiểm thử Đơn vị","slug":"_3-2-kiem-thu-đon-vi","link":"#_3-2-kiem-thu-đon-vi","children":[]},{"level":2,"title":"4.1 Nhập Thư Viện","slug":"_4-1-nhap-thu-vien","link":"#_4-1-nhap-thu-vien","children":[]},{"level":2,"title":"4.2 Ứng Dụng","slug":"_4-2-ung-dung","link":"#_4-2-ung-dung","children":[]},{"level":2,"title":"4.3 CommonResult","slug":"_4-3-commonresult","link":"#_4-3-commonresult","children":[]},{"level":2,"title":"4.4 GlobalResponseBodyHandler","slug":"_4-4-globalresponsebodyhandler","link":"#_4-4-globalresponsebodyhandler","children":[]},{"level":2,"title":"4.5 UserController","slug":"_4-5-usercontroller","link":"#_4-5-usercontroller","children":[]},{"level":2,"title":"4.6 Một Cuộc Thảo Luận Nhỏ","slug":"_4-6-mot-cuoc-thao-luan-nho","link":"#_4-6-mot-cuoc-thao-luan-nho","children":[]},{"level":2,"title":"5.1 ServiceExceptionEnum","slug":"_5-1-serviceexceptionenum","link":"#_5-1-serviceexceptionenum","children":[]},{"level":2,"title":"5.2 ServiceException","slug":"_5-2-serviceexception","link":"#_5-2-serviceexception","children":[]},{"level":2,"title":"5.3 GlobalExceptionHandler","slug":"_5-3-globalexceptionhandler","link":"#_5-3-globalexceptionhandler","children":[]},{"level":2,"title":"5.4 UserController","slug":"_5-4-usercontroller","link":"#_5-4-usercontroller","children":[]},{"level":2,"title":"6.1 Tùy chỉnh HandlerInterceptor","slug":"_6-1-tuy-chinh-handlerinterceptor","link":"#_6-1-tuy-chinh-handlerinterceptor","children":[{"level":3,"title":"1. FirstInterceptor","slug":"_1-firstinterceptor","link":"#_1-firstinterceptor","children":[]},{"level":3,"title":"2. SecondInterceptor","slug":"_2-secondinterceptor","link":"#_2-secondinterceptor","children":[]},{"level":3,"title":"3. ThirdInterceptor","slug":"_3-thirdinterceptor","link":"#_3-thirdinterceptor","children":[]},{"level":3,"title":"Tóm lại","slug":"tom-lai","link":"#tom-lai","children":[]}]},{"level":2,"title":"6.2 SpringMVCConfiguration","slug":"_6-2-springmvcconfiguration","link":"#_6-2-springmvcconfiguration","children":[{"level":3,"title":"Giải thích:","slug":"giai-thich","link":"#giai-thich","children":[]},{"level":3,"title":"Tổng kết:","slug":"tong-ket","link":"#tong-ket","children":[]}]},{"level":2,"title":"6.3 UserController","slug":"_6-3-usercontroller","link":"#_6-3-usercontroller","children":[{"level":3,"title":"① API /users/do_something","slug":"_1-api-users-do-something","link":"#_1-api-users-do-something","children":[]},{"level":3,"title":"Giải thích:","slug":"giai-thich-1","link":"#giai-thich-1","children":[]},{"level":3,"title":"② API /users/current_user","slug":"_2-api-users-current-user","link":"#_2-api-users-current-user","children":[]},{"level":3,"title":"Giải thích:","slug":"giai-thich-2","link":"#giai-thich-2","children":[]},{"level":3,"title":"③ API /users/exception-03","slug":"_3-api-users-exception-03","link":"#_3-api-users-exception-03","children":[]},{"level":3,"title":"Giải thích:","slug":"giai-thich-3","link":"#giai-thich-3","children":[]}]},{"level":2,"title":"6.4 Đọc Mở Rộng","slug":"_6-4-đoc-mo-rong","link":"#_6-4-đoc-mo-rong","children":[]},{"level":2,"title":"7.1 Cấu hình qua Bean","slug":"_7-1-cau-hinh-qua-bean","link":"#_7-1-cau-hinh-qua-bean","children":[]},{"level":2,"title":"7.2 Cấu hình qua chú thích","slug":"_7-2-cau-hinh-qua-chu-thich","link":"#_7-2-cau-hinh-qua-chu-thich","children":[]},{"level":2,"title":"8.1 @CrossOrigin","slug":"_8-1-crossorigin","link":"#_8-1-crossorigin","children":[]},{"level":2,"title":"8.2 CorsRegistry","slug":"_8-2-corsregistry","link":"#_8-2-corsregistry","children":[]},{"level":2,"title":"8.3 CorsFilter","slug":"_8-3-corsfilter","link":"#_8-3-corsfilter","children":[]},{"level":2,"title":"9.1 Nhập phụ thuộc","slug":"_9-1-nhap-phu-thuoc","link":"#_9-1-nhap-phu-thuoc","children":[]},{"level":2,"title":"9.2 SpringMVCConfiguration","slug":"_9-2-springmvcconfiguration","link":"#_9-2-springmvcconfiguration","children":[]},{"level":2,"title":"9.3 UserController","slug":"_9-3-usercontroller","link":"#_9-3-usercontroller","children":[{"level":3,"title":"Yêu cầu","slug":"yeu-cau","link":"#yeu-cau","children":[]},{"level":3,"title":"Phản hồi","slug":"phan-hoi","link":"#phan-hoi","children":[]}]},{"level":2,"title":"10.1 Nhập phụ thuộc","slug":"_10-1-nhap-phu-thuoc","link":"#_10-1-nhap-phu-thuoc","children":[]},{"level":2,"title":"10.2 SpringMVCConfiguration","slug":"_10-2-springmvcconfiguration","link":"#_10-2-springmvcconfiguration","children":[]}],"git":{"createdTime":1727889650000,"updatedTime":1727889650000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":55.72,"words":16716},"filePathRelative":"framework/spring-boot/springmvc.md","localizedDate":"October 2, 2024","excerpt":"\\n<hr>\\n<blockquote>\\n<p>Bài viết này cung cấp mã nguồn đầy đủ, bạn có thể xem tại <a href=\\"https://github.com/YunaiV/SpringBoot-Labs\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">https://github.com/YunaiV/SpringBoot-Labs</a> trong thư mục <a href=\\"https://github.com/YunaiV/SpringBoot-Labs/tree/master/lab-23\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">lab-23</a>.</p>\\n<p>Việc sáng tạo nội dung không hề dễ dàng, hãy ủng hộ mình bằng cách tặng một <a href=\\"https://github.com/YunaiV/SpringBoot-Labs/stargazers\\" target=\\"_blank\\" rel=\\"noopener noreferrer\\">Star</a>, cùng nhau phát triển nhé!</p>\\n</blockquote>","autoDesc":true}');export{p as comp,r as data};
