import{_ as s,o as n,c as a,d as i}from"./app-Dw_Osp-z.js";const l={},t=i(`<h1 id="observer-pattern-practice-mo-phong-quy-trinh-xo-so-va-giam-sat-cac-tin-nhan-đe-thong-bao-cho-nguoi-dung-ve-cac-kich-ban-chien-thang" tabindex="-1"><a class="header-anchor" href="#observer-pattern-practice-mo-phong-quy-trinh-xo-so-va-giam-sat-cac-tin-nhan-đe-thong-bao-cho-nguoi-dung-ve-cac-kich-ban-chien-thang"><span>Observer Pattern Practice: Mô phỏng quy trình xổ số và giám sát các tin nhắn để thông báo cho người dùng về các kịch bản chiến thắng</span></a></h1><h2 id="gioi-thieu" tabindex="-1"><a class="header-anchor" href="#gioi-thieu"><span>Giới thiệu</span></a></h2><p>&quot;Kiến thức càng nhiều, điều chúng ta không biết càng nhiều.&quot;</p><p>Con đường phát triển trong lập trình không bao giờ kết thúc, giống như từ trước đây bạn có thể tự tin nói bạn thành thạo Java, sau đó bạn chỉ muốn hiểu biết về Java, và sau vài năm bạn chỉ muốn nói bạn hiểu một chút về Java. Khi tầm nhìn và tầm nhìn mở rộng, chúng ta sẽ càng phát hiện ra cách nhìn của mình trước đây là nông cạn như thế nào, giống như đứng trên Trái đất nhìn Trái đất và đứng trong Vũ trụ nhìn Trái đất. Nhưng chính vì lòng rộng lớn và tầm nhìn mở rộng, chúng ta có nhiều nhận thức hơn và dần dần học được nhiều kỹ năng hơn. Mặc dù không biết càng nhiều, nhưng cũng nhờ đó mà bản thân chúng ta đã tích lũy được nhiều kiến thức, khiến bản thân mạnh mẽ hơn.</p><p>&quot;Sự lười biếng trong việc học hỏi là đáng sợ.&quot;</p><p>Bây giờ không giống như trước, tài liệu đa dạng, cách tiếp cận rộng rãi, trong đó chứa đựng rất nhiều quảng cáo. Điều này làm cho rất nhiều người mới học khó khăn để tìm kiếm kiến thức mà họ cần, và cuối cùng khi họ thấy có người giới thiệu tài liệu học liên quan, họ ngay lập tức chặn, xóa, nhưng đồng thời, các tài liệu học chất lượng cũng không được những người cần xem. Dần dần, họ dành nhiều thời gian và năng lượng của mình cho trò chơi, giải trí, và đa phương tiện, việc giải trí phù hợp là được chấp nhận, nhưng thường xuyên dễ dàng mắc phải, và sau đó rất khó để thoát ra khỏi. Do đó, họ cần phải lập kế hoạch để tự mình phát triển, và giữ một chút kiên nhẫn.</p><p>&quot;Cân nhắc giữa chi phí thiết kế phần mềm và chi phí thực hiện là quan trọng.&quot;</p><p>Đôi khi, một thiết kế kiến trúc phần mềm cần phải phù hợp với các yếu tố hiện tại, thường không thể bắt đầu thực hiện chỉ vì một kế hoạch trong đầu. Có thể mặc dù thiết kế của bạn rất xuất sắc, nhưng vẫn khó đáp ứng yêu cầu thời gian của doanh nghiệp, khi mà nhu cầu cơ bản của một dự án không được đáp ứng, dự án toàn bộ cũng sẽ đứng im. Nhưng phát triển cũng không thể chỉ là một đống mã lạ mắt, vì vậy cần phải tìm ra một mức độ phù hợp, ví dụ như có thể thiết lập một nền tảng vững chắc, dễ mở rộng. Nhưng về cơ bản, các tính năng cụ thể có thể được đơn giản hóa ban đầu, và sau đó được hoàn thiện trong quá trình phát triển.</p><h2 id="moi-truong-phat-trien" tabindex="-1"><a class="header-anchor" href="#moi-truong-phat-trien"><span>Môi trường phát triển</span></a></h2><ol><li>JDK 1.8</li><li>Idea + Maven</li><li>Code: <a href="https://github.com/vanhung4499/practical-java-design" target="_blank" rel="noopener noreferrer">vanhung4499/practical-java-design</a></li></ol><table><thead><tr><th>Dự án</th><th>Mô tả</th></tr></thead><tbody><tr><td>demo-design-18-00</td><td>Dự án m Dự án mô phỏng tình huống: mô phỏng một giao diện rút thăm xe hơi nhỏ ign-18-01</td></tr><tr><td></td><td></td></tr></tbody></table><h2 id="gioi-thieu-mo-hinh-quan-sat" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-mo-hinh-quan-sat"><span>Giới thiệu mô hình quan sát</span></a></h2><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240401150915.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Để nói một cách đơn giản về mô hình quan sát🕵, đó là khi một hành động xảy ra, thông tin được chuyển đến người nghe khác để thực hiện xử lý tương ứng, không có mối liên kết trực tiếp giữa hai bên. Ví dụ; Xạ thủ bắn tỉa, Lý Văn Lượng.</p><p>Ngoài các tình huống trong cuộc sống, chúng ta cũng thường sử dụng một số mô hình hoặc thành phần theo dõi trong quá trình phát triển phần mềm, ví dụ như dịch vụ MQ mà chúng ta thường sử dụng. Mặc dù dịch vụ MQ có một trung tâm thông báo và không phải tất cả các dịch vụ lớp nhận thông báo, nhưng nó cũng có thể được coi là thiết kế mô hình quan sát. Ví dụ khác có thể là một số bus lắng nghe sự kiện, cho phép dịch vụ chính chia rẽ khỏi các dịch vụ phụ khác, nhằm giảm kết nối và tăng tính mở rộng của hệ thống.</p><h2 id="mo-phong-tinh-huong" tabindex="-1"><a class="header-anchor" href="#mo-phong-tinh-huong"><span>Mô phỏng tình huống</span></a></h2><p><strong>Trong tình huống này, chúng tôi mô phỏng mỗi lần sự kiện rút thăm số xe nhỏ, thông báo sự kiện (Thực tế sự kiện này sẽ không được trang web chính thức gửi tin nhắn cho bạn)</strong></p><p>Có lẽ đa số mọi người khi nhìn thấy ví dụ này sẽ nghĩ đến tình huống mỗi khi rút thăm số xe nhỏ mà mình không trúng, nhận được một tin nhắn thông báo đáng tiếc. Tuy nhiên, hệ thống rút thăm hiện tại không gửi tin nhắn cho bạn, mà được gửi bằng Google hoặc một số plugin khác. Vậy nếu bạn phải phát triển một tính năng rút thăm tương tự và cần thông báo sự kiện cho người dùng bên ngoài cũng như thêm một số quy trình hỗ trợ bổ sung ngoài quy trình chính thì bạn sẽ xử lý như thế nào?</p><p>Đa số mọi người thường thực hiện việc triển khai các lớp thông báo sự kiện như vậy một cách khá thô sơ, đơn giản là thêm trực tiếp vào lớp. 1 là vì họ nghĩ rằng việc này có thể không mở rộng, 2 là vì họ thậm chí không nghĩ tới. Nhưng nếu bạn đã suy nghĩ kỹ về chức năng của lớp cốt lõi của mình, bạn sẽ nhận ra rằng có một số chức năng cốt lõi, cũng như một số chức năng hỗ trợ. Ví dụ, sau khi hoàn thành một hành động nào đó, cần kích hoạt MQ để gửi ra bên ngoài và thực hiện một số thông báo PUSH cho người dùng, tất cả những điều này không phải là một chuỗi quy trình cốt lõi và có thể được xử lý thông qua cách thông báo sự kiện.</p><p>Tiếp theo, chúng ta sẽ sử dụng mẫu thiết kế như vậy để tối ưu hóa mã trong tình huống này.</p><h3 id="du-an-mo-phong-tinh-huong" tabindex="-1"><a class="header-anchor" href="#du-an-mo-phong-tinh-huong"><span>Dự án mô phỏng tình huống</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">design</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">demo</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">18</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">00</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">├── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">pom</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">xml</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">└── src</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    └── main</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        └── java</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            └── com</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                └── hnv99</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                    └── design</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                        └── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">MinibusTargetService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span></span></code></pre></div><ul><li>Đây là một dịch vụ giao diện mô phỏng rút thăm số xe nhỏ.</li></ul><h3 id="tom-tat-tinh-huong" tabindex="-1"><a class="header-anchor" href="#tom-tat-tinh-huong"><span>Tóm tắt tình huống</span></a></h3><h4 id="dich-vu-rut-tham" tabindex="-1"><a class="header-anchor" href="#dich-vu-rut-tham"><span>Dịch vụ rút thăm</span></a></h4><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> MinibusTargetService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     * Giả lập rút thăm, nhưng không phải thuật toán rút thăm thực sự</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     *</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> uId</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> Mã người dùng</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic;">@return</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> Kết quả</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> lottery</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> uId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Math</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">abs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">uId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hashCode</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">%</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ?</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Chúc mừng bạn, mã&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">concat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(uId).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">concat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot; được chọn trong lần rút thăm này&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;Rất tiếc, mã&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">concat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(uId).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">concat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot; không được chọn trong lần rút thăm này hoặc hết thời hạn rút thăm&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Đây là một giao diện giả lập rút thăm, nhưng không phải là thuật toán rút thăm thực sự.</li></ul><h2 id="trien-khai-code-truc-tiep" tabindex="-1"><a class="header-anchor" href="#trien-khai-code-truc-tiep"><span>Triển khai code trực tiếp</span></a></h2><p><code>Ở đây chúng ta sẽ bắt đầu bằng cách triển khai chức năng một cách tệ hại nhất</code></p><p>Theo yêu cầu, chúng ta cần thêm chức năng gửi tin nhắn MQ và thông báo ngắn cho dịch vụ rút thăm số xe nhỏ hiện có. Nếu sử dụng cách tiếp cận trực tiếp nhất, bạn có thể bổ sung chức năng trực tiếp vào phương thức.</p><h3 id="cau-truc-du-an" tabindex="-1"><a class="header-anchor" href="#cau-truc-du-an"><span>Cấu trúc dự án</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">itstack</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">demo</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">design</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">18</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">01</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">└── src</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    └── main</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        └── java</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            └── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">itstack</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">demo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">design</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                ├── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LotteryResult</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                ├── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LotteryService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                └── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LotteryServiceImpl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span></span></code></pre></div><ul><li>Mã trong giao diện này bao gồm ba phần; Đối tượng trả về (<code>LotteryResult</code>), định nghĩa giao diện (<code>LotteryService</code>), và triển khai cụ thể (<code>LotteryServiceImpl</code>).</li></ul><h3 id="trien-khai-code" tabindex="-1"><a class="header-anchor" href="#trien-khai-code"><span>Triển khai code</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">import</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> java.util.Date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LotteryServiceImpl</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LotteryService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LotteryServiceImpl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> MinibusTargetService</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> minibusTargetService </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MinibusTargetService</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LotteryResult</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> doDraw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> uId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Rút thăm</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> lottery</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> minibusTargetService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lottery</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(uId);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Gửi tin nhắn</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Gửi tin nhắn thông báo cho người dùng {} (tin nhắn): {}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, uId, lottery);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Gửi tin nhắn MQ</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Ghi nhận kết quả rút thăm của người dùng {} (MQ): {}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, uId, lottery);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Kết quả</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> LotteryResult</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(uId, lottery, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Từ các phần code triển khai trên, bạn có thể thấy rằng quá trình tổng cả ba phần gồm có; Rút thăm, gửi tin nhắn, và gửi tin nhắn MQ, và tất cả chúng đều được gọi theo thứ tự.</li><li>Ngoài việc gọi giao diện &quot;rút thăm&quot;, các phần sau đều không phải là một chuỗi chính của quy trình, và chúng sẽ phát triển và điều chỉnh liên tục theo yêu cầu kinh doanh trong tương lai. Dưới dạng phát triển này, cách tiếp cận hiện tại rất khó để bảo trì.</li></ul><h3 id="kiem-thu" tabindex="-1"><a class="header-anchor" href="#kiem-thu"><span>Kiểm thử</span></a></h3><h4 id="viet-lop-kiem-thu" tabindex="-1"><a class="header-anchor" href="#viet-lop-kiem-thu"><span>Viết lớp kiểm thử</span></a></h4><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> test</span><span style="color:#E06C75;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    LotteryService</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> lotteryService </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> LotteryServiceImpl</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    LotteryResult</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> lotteryService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">doDraw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;2765789109876&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Kết quả kiểm tra: {}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">JSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toJSONString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(result));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><ul><li>Trong quá trình kiểm thử, gọi giao diện dịch vụ rút thăm số xe nhỏ.</li></ul><h4 id="ket-qua" tabindex="-1"><a class="header-anchor" href="#ket-qua"><span>Kết quả</span></a></h4><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">2024</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">04</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">01</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 15</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">41</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">41.498</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">	INFO</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">	main</span><span style="color:#E06C75;--shiki-dark:#E06C75;">		(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ApiTest</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;">14</span><span style="color:#E06C75;--shiki-dark:#E06C75;">)	</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">|</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">	Kết</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> quả kiểm tra</span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Rất</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> tiếc</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> mã2765789109876không trúng hoặc đã hết hạn tham gia quay số lần này</span></span></code></pre></div><ul><li>Kết quả kiểm tra là đúng như dự kiến, và cũng giống như cách mà chúng ta thường thấy trong việc phát triển code.</li></ul><h2 id="tai-cau-truc-theo-observer-pattern" tabindex="-1"><a class="header-anchor" href="#tai-cau-truc-theo-observer-pattern"><span>Tái cấu trúc theo Observer Pattern</span></a></h2><h3 id="cau-truc-du-an-1" tabindex="-1"><a class="header-anchor" href="#cau-truc-du-an-1"><span>Cấu trúc dự án</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">itstack</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">demo</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;">design</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">18</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">02</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">└── src</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    └── main</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        └── java</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            └── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">org</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">itstack</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">demo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">design</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                ├── event</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                │    ├── listener</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                │    │    ├── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                │    │    ├── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">MessageEventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                │    │    └── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">MQEventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                │    └── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                ├── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LotteryResult</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                ├── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LotteryService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                └── </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LotteryServiceImpl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">java</span></span></code></pre></div><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240401154345.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><ul><li>Trong hình ảnh trên, chúng ta có thể chia thành ba phần chính; <code>lắng nghe sự kiện</code>, <code>xử lý sự kiện</code>, <code>quy trình kinh doanh cụ thể</code>, và trong quy trình kinh doanh cụ thể <code>LotteryService</code> được định nghĩa là một lớp trừu tượng, vì điều này có thể ẩn đi chức năng sự kiện thông qua lớp trừu tượng, người phát triển quy trình kinh doanh bên ngoài không cần biết về các hoạt động thông báo cụ thể.</li><li>Hình tròn ở góc dưới bên phải đại diện cho cấu trúc của quy trình chính và quy trình phụ, trong phát triển, chúng ta sẽ hoàn thành quy trình chính trước, sau đó xử lý các quy trình phụ thông qua cách thông báo. Chúng có thể là không đồng bộ, trong xử lý thông qua MQ và công việc lên lịch, đảm bảo tính nhất quán cuối cùng.</li></ul><h3 id="trien-khai-code-1" tabindex="-1"><a class="header-anchor" href="#trien-khai-code-1"><span>Triển khai code</span></a></h3><h4 id="đinh-nghia-giao-dien-lang-nghe-su-kien" tabindex="-1"><a class="header-anchor" href="#đinh-nghia-giao-dien-lang-nghe-su-kien"><span>Định nghĩa giao diện lắng nghe sự kiện</span></a></h4><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> EventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> doEvent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LotteryResult</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> result</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Giao diện định nghĩa một lớp sự kiện cơ bản, ở đây nếu kiểu thông tin đầu vào của phương thức thay đổi, bạn có thể sử dụng generics <code>&lt;T&gt;</code>.</li></ul><h4 id="trien-khai-hai-su-kien-lang-nghe-cu-the" tabindex="-1"><a class="header-anchor" href="#trien-khai-hai-su-kien-lang-nghe-cu-the"><span>Triển khai hai sự kiện lắng nghe cụ thể</span></a></h4><p><strong>Lắng nghe sự kiện tin nhắn</strong></p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> MessageEventListener</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> EventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">MessageEventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> doEvent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LotteryResult</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> result</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Gửi tin nhắn thông báo (Tin nhắn) đến người dùng {}: {}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">result</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getUId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(), </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">result</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getMsg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>Lắng nghe sự kiện gửi MQ</strong></p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> MQEventListener</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> EventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">MQEventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Override</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> doEvent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LotteryResult</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> result</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Ghi lại kết quả rút thăm của người dùng {} (MQ): {}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">result</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getUId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(), </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">result</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getMsg</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Đây là hai triển khai sự kiện cụ thể, tương đối đơn giản. Trong phát triển thực tế của doanh nghiệp, bạn có thể cần gọi API bên ngoài và xử lý ngoại lệ.</li><li>Đồng thời, như đã đề cập ở trên, giao diện sự kiện được thêm generics, nếu cần, trong triển khai sự kiện, bạn có thể đóng gói nội dung sự kiện theo các loại khác nhau.</li></ul><h4 id="lop-xu-ly-su-kien" tabindex="-1"><a class="header-anchor" href="#lop-xu-ly-su-kien"><span>Lớp xử lý sự kiện</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> EventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    Map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Enum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> listeners </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> HashMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> EventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Enum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;... </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">operations</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Enum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">operation</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> operations) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">listeners</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(operation, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> enum</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> EventType</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">        MQ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> Message</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     * Đăng ký</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> eventType</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> Loại sự kiện</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> listener</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">  Trình nghe</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> subscribe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Enum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">eventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventListener</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> listener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">users</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> listeners</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(eventType);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        users</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(listener);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     * Hủy đăng ký</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> eventType</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> Loại sự kiện</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> listener</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">  Trình nghe</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> unsubscribe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Enum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">eventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventListener</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> listener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">users</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> listeners</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(eventType);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        users</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(listener);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    /**</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     * Thông báo</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> eventType</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> Loại sự kiện</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     * </span><span style="color:#C678DD;--shiki-dark:#C678DD;font-style:italic;--shiki-dark-font-style:italic;">@param</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> result</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">    Kết quả</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">     */</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> notify</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Enum</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">eventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">LotteryResult</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> result</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">users</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> listeners</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(eventType);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventListener</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> listener</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> users) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            listener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">doEvent</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(result);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Trong triển khai này, ba phương thức chính được cung cấp: đăng ký (<code>subscribe</code>), hủy đăng ký (<code>unsubscribe</code>) và thông báo (<code>notify</code>). Các phương thức này được sử dụng để thêm và sử dụng các sự kiện lắng nghe.</li><li>Bên cạnh đó, vì sự kiện có các loại khác nhau, ở đây sử dụng cách liệt kê để xử lý, cũng dễ dàng cho phía bên ngoài sử dụng sự kiện trong các quy tắc cụ thể (<code>EventType.MQ</code>, <code>EventType.Message</code>).</li></ul><h4 id="giao-dien-lop-truu-tuong-kinh-doanh" tabindex="-1"><a class="header-anchor" href="#giao-dien-lop-truu-tuong-kinh-doanh"><span>Giao diện lớp trừu tượng kinh doanh</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> abstract</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LotteryService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> EventManager</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> eventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> LotteryService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        eventManager </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> EventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">MQ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        eventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">subscribe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">MQ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MQEventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        eventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">subscribe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MessageEventListener</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LotteryResult</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> draw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> uId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        LotteryResult</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> lotteryResult</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> doDraw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(uId);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Gọi đến những gì cần thông báo</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        eventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">notify</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">MQ</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, lotteryResult);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        eventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">notify</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventManager</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EventType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, lotteryResult);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> lotteryResult;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    protected</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> abstract</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LotteryResult</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> doDraw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> uId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Cách triển khai này sử dụng lớp trừu tượng để định nghĩa phương thức thực hiện, có thể mở rộng và thêm các cuộc gọi bổ sung. Nó cung cấp một phương thức trừu tượng <code>abstract LotteryResult doDraw(String uId)</code> để các lớp con triển khai.</li><li>Đồng thời, phương thức được định nghĩa bằng <code>protected</code>, đảm bảo rằng người gọi từ bên ngoài sẽ không gọi phương thức này, chỉ có thể gọi <code>draw(String uId)</code> để hoàn thành việc thông báo sự kiện.</li><li>Cách triển khai này là viết một phương thức cơ bản trong một lớp trừu tượng, trong phương thức, thêm một cách tiếp cận mới trong khi thêm việc sử dụng lớp trừu tượng. Sự định nghĩa của lớp trừu tượng này sẽ được triển khai bởi lớp con.</li><li>Ngoài ra, trong hàm tạo, đã cung cấp định nghĩa cho các sự kiện: <code>eventManager.subscribe(EventManager.EventType.MQ, new MQEventListener())</code>.</li><li>Khi sử dụng, cũng sử dụng cách liệt kê để thông báo sự kiện, truyền loại gì <code>EventManager.EventType.MQ</code>, sự kiện đó sẽ được thực hiện, và thêm sự kiện theo nhu cầu.</li></ul><h4 id="lop-trien-khai-giao-dien-kinh-doanh" tabindex="-1"><a class="header-anchor" href="#lop-trien-khai-giao-dien-kinh-doanh"><span>Lớp triển khai giao diện kinh doanh</span></a></h4><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LotteryServiceImpl</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LotteryService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> MinibusTargetService</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> minibusTargetService </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MinibusTargetService</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    protected</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LotteryResult</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> doDraw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> uId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Trực tiếp ra số</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> lottery</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> minibusTargetService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lottery</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(uId);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Trả về kết quả</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> LotteryResult</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(uId, lottery, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Bây giờ, khi nhìn vào triển khai luồng công việc, ta thấy rằng nó đã trở nên rất đơn giản, không có luồng công việc phụ trợ nào, chỉ có xử lý luồng công việc cốt lõi.</li></ul><h4 id="lop-trien-khai-giao-dien-kinh-doanh-1" tabindex="-1"><a class="header-anchor" href="#lop-trien-khai-giao-dien-kinh-doanh-1"><span>Lớp triển khai giao diện kinh doanh</span></a></h4><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LotteryServiceImpl</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LotteryService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> MinibusTargetService</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> minibusTargetService </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> MinibusTargetService</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    protected</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LotteryResult</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> doDraw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> uId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Trực tiếp ra số</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> lottery</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> minibusTargetService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lottery</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(uId);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Trả về kết quả</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> LotteryResult</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(uId, lottery, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Bây giờ, khi nhìn vào triển khai luồng công việc, ta thấy rằng nó đã trở nên rất đơn giản, không có luồng công việc phụ trợ nào, chỉ có xử lý luồng công việc cốt lõi.</li></ul><h3 id="kiem-thu-1" tabindex="-1"><a class="header-anchor" href="#kiem-thu-1"><span>Kiểm thử</span></a></h3><h4 id="viet-lop-kiem-thu-1" tabindex="-1"><a class="header-anchor" href="#viet-lop-kiem-thu-1"><span>Viết lớp kiểm thử</span></a></h4><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Test</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> test</span><span style="color:#E06C75;--shiki-dark:#E06C75;">() {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    LotteryService</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> lotteryService </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> LotteryServiceImpl</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    LotteryResult</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> result </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> lotteryService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">draw</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;2765789109876&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Kết quả kiểm thử: {}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">JSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toJSONString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(result));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><ul><li>Từ cách gọi trông gần như không có sự khác biệt, nhưng cách triển khai này giúp việc bảo trì mã nguồn và mở rộng yêu cầu mới trở nên dễ dàng hơn.</li></ul><h4 id="ket-qua-1" tabindex="-1"><a class="header-anchor" href="#ket-qua-1"><span>Kết quả</span></a></h4><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2024-04-01</span><span style="color:#98C379;--shiki-dark:#98C379;"> 16:00:55.903</span><span style="color:#98C379;--shiki-dark:#98C379;">	INFO</span><span style="color:#98C379;--shiki-dark:#98C379;">	main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		(MQEventListener.java:13)	|	</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Ghi</span><span style="color:#98C379;--shiki-dark:#98C379;"> lại</span><span style="color:#98C379;--shiki-dark:#98C379;"> kết</span><span style="color:#98C379;--shiki-dark:#98C379;"> quả</span><span style="color:#98C379;--shiki-dark:#98C379;"> rút</span><span style="color:#98C379;--shiki-dark:#98C379;"> thăm</span><span style="color:#98C379;--shiki-dark:#98C379;"> của</span><span style="color:#98C379;--shiki-dark:#98C379;"> người</span><span style="color:#98C379;--shiki-dark:#98C379;"> dùng</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2765789109876</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (MQ): Rất tiếc, mã2765789109876không trúng hoặc đã hết hạn tham gia quay số lần này</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2024-04-01</span><span style="color:#98C379;--shiki-dark:#98C379;"> 16:00:55.909</span><span style="color:#98C379;--shiki-dark:#98C379;">	INFO</span><span style="color:#98C379;--shiki-dark:#98C379;">	main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		(MessageEventListener.java:13)	|	</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Gửi</span><span style="color:#98C379;--shiki-dark:#98C379;"> tin</span><span style="color:#98C379;--shiki-dark:#98C379;"> nhắn</span><span style="color:#98C379;--shiki-dark:#98C379;"> thông</span><span style="color:#98C379;--shiki-dark:#98C379;"> báo</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (Tin </span><span style="color:#98C379;--shiki-dark:#98C379;">nhắn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) đến người dùng 2765789109876: Rất tiếc, mã2765789109876không trúng hoặc đã hết hạn tham gia quay số lần này</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2024-04-01</span><span style="color:#98C379;--shiki-dark:#98C379;"> 16:00:55.973</span><span style="color:#98C379;--shiki-dark:#98C379;">	INFO</span><span style="color:#98C379;--shiki-dark:#98C379;">	main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		(ApiTest.java:16)	|	</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Kết</span><span style="color:#98C379;--shiki-dark:#98C379;"> quả</span><span style="color:#98C379;--shiki-dark:#98C379;"> kiểm</span><span style="color:#98C379;--shiki-dark:#98C379;"> thử:</span><span style="color:#98C379;--shiki-dark:#98C379;"> {&quot;dateTime&quot;:1711962055902,&quot;msg&quot;:&quot;Rất tiếc, mã2765789109876không trúng hoặc đã hết hạn tham gia quay số lần này&quot;,&quot;uId&quot;:&quot;2765789109876&quot;}</span></span></code></pre></div><ul><li>Từ kết quả kiểm thử, chúng ta thấy rằng kết quả đã đáp ứng các kỳ vọng của chúng ta. Mặc dù kết quả là giống nhau, nhưng chỉ có chúng ta mới hiểu được sức mạnh của mô hình thiết kế.</li></ul><h2 id="tong-ket" tabindex="-1"><a class="header-anchor" href="#tong-ket"><span>Tổng kết</span></a></h2><ul><li>Từ quá trình phát triển cơ bản ban đầu của chúng ta và sau đó là sử dụng Observer Pattern trong lập trình hướng đối tượng, chúng ta có thể thấy rằng sau khi cải tiến theo mẫu thiết kế, chúng ta đã tách rời các quy trình lõi và các quy trình hỗ trợ của mã. Thông thường, các quy trình lõi trong mã không thay đổi thường xuyên. Nhưng các quy trình hỗ trợ sẽ thay đổi theo thời gian và yêu cầu kinh doanh, bao gồm; <code>Tiếp thị</code>, <code>Phân chia</code> và <code>Khuyến mãi</code> vv, do đó việc sử dụng mẫu thiết kế để xây dựng mã trở nên rất cần thiết.</li><li>Mô hình thiết kế này đáp ứng nguyên tắc mở đóng từ mặt cấu trúc. Khi bạn cần thêm các sự kiện nghe hoặc sửa đổi logic nghe, bạn không cần phải sửa đổi lớp xử lý sự kiện. Tuy nhiên, có thể bạn không kiểm soát thứ tự gọi hoặc cần phải xử lý một số kết quả sự kiện để tiếp tục thực hiện, vì vậy trong quá trình sử dụng, bạn cần xem xét tính hợp lý của tình huống.</li><li>Bất kỳ mẫu thiết kế nào cũng không phải là một mình, chúng cần phải kết hợp với các mẫu khác để xây dựng cùng nhau. Ngoài ra, việc sử dụng mẫu thiết kế nhằm làm cho mã dễ mở rộng và bảo trì hơn, không thể làm cho cấu trúc trở nên phức tạp hơn và khó bảo trì chỉ vì thêm mẫu thiết kế. Kinh nghiệm sử dụng mẫu này một cách hợp lý cần được tích lũy thông qua việc thực hành thực tế nhiều.</li></ul>`,79),r=[t];function e(o,p){return n(),a("div",null,r)}const h=s(l,[["render",e],["__file","observer.html.vue"]]),k=JSON.parse('{"path":"/design/design-pattern/practical/behavioral/observer.html","title":"Observer Pattern Practice","lang":"en-US","frontmatter":{"title":"Observer Pattern Practice","tags":["design-pattern"],"categories":null,"date created":"2024-04-01T00:00:00.000Z","date modified":"2024-04-01T00:00:00.000Z","description":"Observer Pattern Practice: Mô phỏng quy trình xổ số và giám sát các tin nhắn để thông báo cho người dùng về các kịch bản chiến thắng Giới thiệu \\"Kiến thức càng nhiều, điều chúng...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/design/design-pattern/practical/behavioral/observer.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"Observer Pattern Practice"}],["meta",{"property":"og:description","content":"Observer Pattern Practice: Mô phỏng quy trình xổ số và giám sát các tin nhắn để thông báo cho người dùng về các kịch bản chiến thắng Giới thiệu \\"Kiến thức càng nhiều, điều chúng..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240401150915.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-28T15:54:38.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"design-pattern"}],["meta",{"property":"article:modified_time","content":"2024-06-28T15:54:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Observer Pattern Practice\\",\\"image\\":[\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240401150915.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240401154345.png\\"],\\"dateModified\\":\\"2024-06-28T15:54:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Giới thiệu","slug":"gioi-thieu","link":"#gioi-thieu","children":[]},{"level":2,"title":"Môi trường phát triển","slug":"moi-truong-phat-trien","link":"#moi-truong-phat-trien","children":[]},{"level":2,"title":"Giới thiệu mô hình quan sát","slug":"gioi-thieu-mo-hinh-quan-sat","link":"#gioi-thieu-mo-hinh-quan-sat","children":[]},{"level":2,"title":"Mô phỏng tình huống","slug":"mo-phong-tinh-huong","link":"#mo-phong-tinh-huong","children":[{"level":3,"title":"Dự án mô phỏng tình huống","slug":"du-an-mo-phong-tinh-huong","link":"#du-an-mo-phong-tinh-huong","children":[]},{"level":3,"title":"Tóm tắt tình huống","slug":"tom-tat-tinh-huong","link":"#tom-tat-tinh-huong","children":[]}]},{"level":2,"title":"Triển khai code trực tiếp","slug":"trien-khai-code-truc-tiep","link":"#trien-khai-code-truc-tiep","children":[{"level":3,"title":"Cấu trúc dự án","slug":"cau-truc-du-an","link":"#cau-truc-du-an","children":[]},{"level":3,"title":"Triển khai code","slug":"trien-khai-code","link":"#trien-khai-code","children":[]},{"level":3,"title":"Kiểm thử","slug":"kiem-thu","link":"#kiem-thu","children":[]}]},{"level":2,"title":"Tái cấu trúc theo Observer Pattern","slug":"tai-cau-truc-theo-observer-pattern","link":"#tai-cau-truc-theo-observer-pattern","children":[{"level":3,"title":"Cấu trúc dự án","slug":"cau-truc-du-an-1","link":"#cau-truc-du-an-1","children":[]},{"level":3,"title":"Triển khai code","slug":"trien-khai-code-1","link":"#trien-khai-code-1","children":[]},{"level":3,"title":"Kiểm thử","slug":"kiem-thu-1","link":"#kiem-thu-1","children":[]}]},{"level":2,"title":"Tổng kết","slug":"tong-ket","link":"#tong-ket","children":[]}],"git":{"createdTime":1719590078000,"updatedTime":1719590078000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":13.62,"words":4086},"filePathRelative":"design/design-pattern/practical/behavioral/observer.md","localizedDate":"June 28, 2024","excerpt":"\\n<h2>Giới thiệu</h2>\\n<p>\\"Kiến thức càng nhiều, điều chúng ta không biết càng nhiều.\\"</p>\\n<p>Con đường phát triển trong lập trình không bao giờ kết thúc, giống như từ trước đây bạn có thể tự tin nói bạn thành thạo Java, sau đó bạn chỉ muốn hiểu biết về Java, và sau vài năm bạn chỉ muốn nói bạn hiểu một chút về Java. Khi tầm nhìn và tầm nhìn mở rộng, chúng ta sẽ càng phát hiện ra cách nhìn của mình trước đây là nông cạn như thế nào, giống như đứng trên Trái đất nhìn Trái đất và đứng trong Vũ trụ nhìn Trái đất. Nhưng chính vì lòng rộng lớn và tầm nhìn mở rộng, chúng ta có nhiều nhận thức hơn và dần dần học được nhiều kỹ năng hơn. Mặc dù không biết càng nhiều, nhưng cũng nhờ đó mà bản thân chúng ta đã tích lũy được nhiều kiến thức, khiến bản thân mạnh mẽ hơn.</p>","autoDesc":true}');export{h as comp,k as data};
