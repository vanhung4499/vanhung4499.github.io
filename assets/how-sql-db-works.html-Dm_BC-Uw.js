import{_ as n,o as h,c as t,d as i}from"./app-BdwADm4z.js";const c={},a=i(`<h2 id="bat-Ä‘au-voi-data-structure-algorithm" tabindex="-1"><a class="header-anchor" href="#bat-Ä‘au-voi-data-structure-algorithm"><span>Báº¯t Ä‘áº§u vá»›i Data Structure &amp; Algorithm</span></a></h2><h3 id="Ä‘o-phuc-tap-thoi-gian" tabindex="-1"><a class="header-anchor" href="#Ä‘o-phuc-tap-thoi-gian"><span>Äá»™ phá»©c táº¡p thá»i gian</span></a></h3><blockquote><p>Äá»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u, Ä‘iá»u quan trá»ng khÃ´ng pháº£i lÃ  khá»‘i lÆ°á»£ng dá»¯ liá»‡u, mÃ  lÃ  lÃ m tháº¿ nÃ o cÃ¡c hoáº¡t Ä‘á»™ng tÄƒng lÃªn khi khá»‘i lÆ°á»£ng dá»¯ liá»‡u tÄƒng lÃªn.</p></blockquote><p>Äá»™ phá»©c táº¡p thuáº­t toÃ¡n kÃ©o theo Ä‘á»™ phá»©c táº¡p thá»i gian (time complexity) vÃ  Ä‘á»™ phá»©c táº¡p khÃ´ng gian (space complexity). Vui lÃ²ng Ä‘á»c [[Complexity Analysis]]</p><h3 id="merge-sort" tabindex="-1"><a class="header-anchor" href="#merge-sort"><span>[[Merge Sort]]</span></a></h3><blockquote><p>Äá»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u, báº¡n cáº§n pháº£i hiá»ƒu cÃ¡ch thá»©c hoáº¡t Ä‘á»™ng cá»§a hÃ m sort() nÃ y.</p></blockquote><p>[[Merge Sort]] chia bÃ i toÃ¡n lá»›n thÃ nh cÃ¡c bÃ i toÃ¡n nhá», giáº£i quyáº¿t bÃ i toÃ¡n ban Ä‘áº§u báº±ng cÃ¡ch giáº£i quyáº¿t cÃ¡c bÃ i toÃ¡n nhá». Thuáº­t toÃ¡n nÃ y theo tÆ° tÆ°á»Ÿng chia Ä‘á»ƒ trá»‹ (deidve and conquer)</p><p><strong>Táº¡i sao láº¡i lÃ  Merge Sort?</strong></p><ul><li>Báº¡n cÃ³ thá»ƒ thay Ä‘á»•i thuáº­t toÃ¡n Ä‘á»ƒ tiáº¿t kiá»‡m khÃ´ng gian bá»™ nhá»› báº±ng cÃ¡ch khÃ´ng táº¡o chuá»—i má»›i mÃ  thay Ä‘á»•i trá»±c tiáº¿p chuá»—i Ä‘áº§u vÃ o. LÆ°u Ã½: Thuáº­t toÃ¡n nÃ y Ä‘Æ°á»£c gá»i lÃ  <strong>in-place algorithm</strong></li><li>Báº¡n cÃ³ thá»ƒ thay Ä‘á»•i thuáº­t toÃ¡n Ä‘á»ƒ báº¡n cÃ³ thá»ƒ trÃ¡nh Disk I/O khá»•ng lá»“ báº±ng cÃ¡ch sá»­ dá»¥ng cáº£ dung lÆ°á»£ng Ä‘Ä©a vÃ  má»™t lÆ°á»£ng nhá» bá»™ nhá»›. PhÆ°Æ¡ng phÃ¡p lÃ  chá»‰ táº£i cÃ¡c pháº§n hiá»‡n Ä‘ang Ä‘Æ°á»£c xá»­ lÃ½ vÃ o bá»™ nhá»›. ÄÃ¢y lÃ  má»™t ká»¹ thuáº­t quan trá»ng khi sáº¯p xáº¿p má»™t vÃ i GB báº£ng trong bá»™ Ä‘á»‡m bá»™ nhá»› chá»‰ 100MB. LÆ°u Ã½: Thuáº­t toÃ¡n nÃ y Ä‘Æ°á»£c gá»i lÃ  <strong>external sorting</strong>.</li><li>Báº¡n cÃ³ thá»ƒ thay Ä‘á»•i thuáº­t toÃ¡n Ä‘á»ƒ dá»… dÃ ng cháº¡y trÃªn Ä‘a nhÃ¢n / Ä‘a luá»“ng / Ä‘a mÃ¡y chá»§. VÃ­ dá»¥, sáº¯p xáº¿p há»£p nháº¥t phÃ¢n tÃ¡n lÃ  má»™t trong nhá»¯ng thÃ nh pháº§n quan trá»ng cá»§a <strong>Hadoop</strong>, má»™t big data framework ná»•i tiáº¿ng.</li></ul><h3 id="binary-search-tree" tabindex="-1"><a class="header-anchor" href="#binary-search-tree"><span>[[Binary Search Tree]]</span></a></h3><blockquote><p>Äá»™ phá»©c táº¡p thá»i gian cá»§a truy váº¥n trong cÆ¡ sá»Ÿ dá»¯ liá»‡u lÃ  khÃ´ng thá»ƒ sá»­ dá»¥ng ma tráº­n, thay vÃ o Ä‘Ã³ sá»­ dá»¥ng Binary Search Tree (BST), vui lÃ²ng xem [[Binary Search Tree]]</p></blockquote><ul><li>[[Binary Search Tree]] chá»‰ yÃªu cáº§u truy cáº¥n O(log(n)), trong khi náº¿u báº¡n sá»­ dá»¥ng máº£ng trá»±c tiáº¿p, báº¡n sáº½ cáº§n truy váº¥n O(n)</li></ul><h3 id="b-tree" tabindex="-1"><a class="header-anchor" href="#b-tree"><span>[[B Tree]]</span></a></h3><blockquote><p>Tree lÃ m viá»‡c tá»‘t vá»›i viá»‡c tÃ¬m má»™t giÃ¡ trá»‹ cá»¥ thá»ƒ, nhÆ°ng khi báº¡n cáº§n pháº£i <strong>tÃ¬m nhiá»u yáº¿u tá»‘ giá»¯a hai giÃ¡ trá»‹</strong>, báº¡n cÃ³ thá»ƒ gáº·p ráº¯c rá»‘i lá»›n. Chi phÃ­ cá»§a báº¡n sáº½ lÃ  O(N) vÃ¬ báº¡n pháº£i tÃ¬m má»—i nÃºt cá»§a cÃ¢y Ä‘á»ƒ xÃ¡c Ä‘á»‹nh xem nÃ³ cÃ³ náº±m giá»¯a 2 giÃ¡ trá»‹ Ä‘Ã³ hay khÃ´ng (vÃ­ dá»¥: sá»­ dá»¥ng inorder traversal trÃªn cÃ¢y). VÃ  thao tÃ¡c nÃ y khÃ´ng pháº£i lÃ  thuáº­n lá»£i cho Disk I/O, bá»Ÿi vÃ¬ báº¡n pháº£i Ä‘á»c toÃ n bá»™ cÃ¢y. ChÃºng ta cáº§n pháº£i tÃ¬m má»™t phÆ°Æ¡ng phÃ¡p truy váº¥n pháº¡m vi hiá»‡u quáº£.</p></blockquote><p><strong>Náº¿u báº¡n thÃªm hoáº·c xÃ³a má»™t hÃ ng trong cÆ¡ sá»Ÿ dá»¯ liá»‡u</strong>Â (do Ä‘Ã³ trong chá»‰ má»¥c cÃ¢y B + cÃ³ liÃªn quan):</p><ul><li>Báº¡n pháº£i duy trÃ¬ thá»© tá»± giá»¯a cÃ¡c nÃºt trong B+ Tree, náº¿u khÃ´ng cÃ¡c nÃºt sáº½ trá»Ÿ nÃªn lá»™n xá»™n vÃ  báº¡n khÃ´ng thá»ƒ tÃ¬m tháº¥y nÃºt báº¡n muá»‘n.</li><li>Báº¡n pháº£i giáº£m thiá»ƒu sá»‘ lá»›p cá»§a B+ Tree, náº¿u khÃ´ng Ä‘á»™ phá»©c táº¡p cá»§a O (log(N) sáº½ trá»Ÿ thÃ nh O (N</li></ul><p>NÃ³i cÃ¡ch khÃ¡c, [[B Tree]] cáº§n pháº£i tá»± sáº¯p xáº¿p vÃ  tá»± cÃ¢n báº±ng. Ráº¥t may, chÃºng cÃ³ xÃ³a vÃ  chÃ¨n thÃ´ng minh. NhÆ°ng Ä‘iá»u nÃ y cÅ©ng mang láº¡i chi phÃ­: trong B+ Tree, chÃ¨n vÃ  xÃ³a lÃ  Ä‘á»™ phá»©c táº¡p O(log(N). VÃ¬ váº­y, má»™t sá»‘ ngÆ°á»i Ä‘Ã£ nghe nÃ³i ráº±ng sá»­ dá»¥ng quÃ¡ nhiá»u Index khÃ´ng pháº£i lÃ  má»™t Ã½ tÆ°á»Ÿng tá»‘t nhÆ° váº­y. ÄÃºng váº­y, báº¡n Ä‘Ã£ lÃ m cháº­m hoáº¡t Ä‘á»™ng cá»§a má»™t hÃ ng trong báº£ng chÃ¨n/cáº­p nháº­t/xÃ³a nhanh chÃ³ng vÃ¬ cÆ¡ sá»Ÿ dá»¯ liá»‡u cáº§n pháº£i cáº­p nháº­t chá»‰ má»¥c cá»§a báº£ng vá»›i chi phÃ­ cao cho má»—i hoáº¡t Ä‘á»™ng O(log(N). HÆ¡n ná»¯a, tÄƒng chá»‰ má»¥c cÃ³ nghÄ©a lÃ  mang láº¡i nhiá»u khá»‘i lÆ°á»£ng cÃ´ng viá»‡c hÆ¡n cho Transaction Manager (sáº½ Ä‘Æ°á»£c Ä‘á» cáº­p phÃ­a dÆ°á»›i).</p><h3 id="hash-table" tabindex="-1"><a class="header-anchor" href="#hash-table"><span>Hash Table</span></a></h3><blockquote><p>[[Hash Table]] ráº¥t há»¯u Ã­ch khi báº¡n muá»‘n tÃ¬m cÃ¡c giÃ¡ trá»‹ má»™t cÃ¡ch nhanh chÃ³ng. HÆ¡n ná»¯a, sá»± hiá»ƒu biáº¿t vá» Hash Table sáº½ giÃºp chÃºng ta hiá»ƒu cÃ¡c hoáº¡t Ä‘á»™ng káº¿t ná»‘i phá»• biáº¿n tiáº¿p theo cá»§a má»™t cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘Æ°á»£c gá»i lÃ  &quot;hash connection&quot;. <strong>Cáº¥u trÃºc dá»¯ liá»‡u nÃ y cÅ©ng Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘á»ƒ lÆ°u má»™t cÃ¡i gÃ¬ Ä‘Ã³ bÃªn trong</strong> (cháº³ng háº¡n nhÆ° <strong>báº£ng khÃ³a</strong> hoáº·c <strong>vÃ¹ng Ä‘á»‡m</strong>, mÃ  sáº½ nghiÃªn cá»©u dÆ°á»›i Ä‘Ã¢y)</p></blockquote><p><strong>Táº¡i sao khÃ´ng sá»­ dá»¥ng máº£ng</strong>?</p><ul><li>Náº¿u cÃ³ má»™t hash function tá»‘t, Ä‘á»™ phá»©c táº¡p thá»i gian tÃ¬m kiáº¿m trong [[Hash Table]] lÃ  O(1).</li><li><strong>Má»™t [[Hash Table]] cÃ³ thá»ƒ Ä‘Æ°á»£c náº¡p chá»‰ má»™t ná»­a vÃ o bá»™ nhá»›, vÃ  hash bucket cÃ²n láº¡i cÃ³ thá»ƒ Ä‘Æ°á»£c giá»¯ láº¡i trÃªn Ä‘Ä©a cá»©ng</strong>.</li><li>Vá»›i máº£ng, báº¡n cáº§n má»™t khÃ´ng gian bá»™ nhá»› liÃªn tá»¥c. Náº¿u báº¡n táº£i má»™t báº£ng lá»›n, tháº­t khÃ³ Ä‘á»ƒ phÃ¢n bá»• Ä‘á»§ khÃ´ng gian bá»™ nhá»› liÃªn tá»¥c.</li></ul><h2 id="tong-quan-sql-db" tabindex="-1"><a class="header-anchor" href="#tong-quan-sql-db"><span>Tá»•ng quan SQL DB</span></a></h2><p>CÆ¡ sá»Ÿ dá»¯ liá»‡u (database) thÆ°á»ng cÃ³ thá»ƒ Ä‘Æ°á»£c hiá»ƒu báº±ng cÃ¡ch sá»­ dá»¥ng Ä‘á»“ há»a sau:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604124944.png" alt="Pasted image 20230604124944" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604124944</figcaption></figure><h3 id="cac-thanh-phan-cot-loi-core-components" tabindex="-1"><a class="header-anchor" href="#cac-thanh-phan-cot-loi-core-components"><span>CÃ¡c thÃ nh pháº§n cá»‘t lÃµi (Core Components)</span></a></h3><ul><li><p><strong>TrÃ¬nh quáº£n lÃ½ quy trÃ¬nh (process manager):</strong> Nhiá»u cÆ¡ sá»Ÿ dá»¯ liá»‡u cÃ³ process/thread pool cáº§n Ä‘Æ°á»£c quáº£n lÃ½ Ä‘Ãºng cÃ¡ch. HÆ¡n ná»¯a, Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c hoáº¡t Ä‘á»™ng trong nanosecond, má»™t sá»‘ cÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n Ä‘áº¡i sá»­ dá»¥ng thread riÃªng cá»§a há» thay vÃ¬ OS thread.</p></li><li><p><strong>Network manager</strong>: Internet I/O lÃ  má»™t váº¥n Ä‘á» lá»›n, Ä‘áº·c biá»‡t lÃ  Ä‘á»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u phÃ¢n tÃ¡n. VÃ¬ váº­y, má»™t sá»‘ cÆ¡ sá»Ÿ dá»¯ liá»‡u cÃ³ trÃ¬nh quáº£n lÃ½ máº¡ng riÃªng.</p></li><li><p>**TrÃ¬nh quáº£n lÃ½ há»‡ thá»‘ng tá»‡p (File system manager)ğŸ˜—*Disk I/O lÃ  nÃºt tháº¯t cá»• chai chÃ­nh cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u. NÃ³ lÃ  ráº¥t quan trá»ng Ä‘á»ƒ cÃ³ má»™t trÃ¬nh quáº£n lÃ½ há»‡ thá»‘ng táº­p tin Ä‘á»ƒ xá»­ lÃ½ hoÃ n háº£o há»‡ thá»‘ng táº­p tin OS hoáº·c tháº­m chÃ­ thay tháº¿ há»‡ thá»‘ng táº­p tin OS.</p></li><li><p><strong>Memory manager</strong>: Äá»ƒ trÃ¡nh giáº£m hiá»‡u suáº¥t do disk I/O gÃ¢y ra, cáº§n ráº¥t nhiá»u bá»™ nhá»›. NhÆ°ng náº¿u báº¡n muá»‘n xá»­ lÃ½ bá»™ nhá»› dung lÆ°á»£ng lá»›n, báº¡n cáº§n trÃ¬nh quáº£n lÃ½ bá»™ nhá»› hiá»‡u quáº£, Ä‘áº·c biá»‡t lÃ  khi báº¡n cÃ³ ráº¥t nhiá»u truy váº¥n Ä‘á»ƒ sá»­ dá»¥ng bá»™ nhá»› cÃ¹ng má»™t lÃºc.</p></li><li><p><strong>Security Manager</strong>: ÄÆ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xÃ¡c thá»±c vÃ  phÃ¢n quyá»n ngÆ°á»i dÃ¹ng.</p></li><li><p><strong>TrÃ¬nh quáº£n lÃ½ khÃ¡ch hÃ ng (Client manager):</strong> ÄÆ°á»£c sá»­ dá»¥ng Ä‘á»ƒ quáº£n lÃ½ káº¿t ná»‘i khÃ¡ch hÃ ng.</p></li><li><p>â€¦â€¦</p></li></ul><h3 id="cong-cu-tools" tabindex="-1"><a class="header-anchor" href="#cong-cu-tools"><span>CÃ´ng cá»¥ (Tools)</span></a></h3><ul><li><p><strong>TrÃ¬nh quáº£n lÃ½ sao lÆ°u (Backup manager):</strong> ÄÆ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÆ°u vÃ  khÃ´i phá»¥c dá»¯ liá»‡u.</p></li><li><p><strong>TrÃ¬nh quáº£n lÃ½ phá»¥c há»“i (Recovery manager</strong>): ÄÆ°á»£c sá»­ dá»¥ng Ä‘á»ƒ khá»Ÿi Ä‘á»™ng láº¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘áº¿n tráº¡ng thÃ¡i nháº¥t quÃ¡n sau khi sá»± cá»‘.</p></li><li><p><strong>Monitor manager</strong>: CÃ´ng cá»¥ Ä‘á»ƒ ghi láº¡i hoáº¡t Ä‘á»™ng cÆ¡ sá»Ÿ dá»¯ liá»‡u vÃ  cung cáº¥p cÆ¡ sá»Ÿ dá»¯ liá»‡u giÃ¡m sÃ¡t.</p></li><li><p><strong>Administration manager</strong>: ÄÆ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÆ°u siÃªu dá»¯ liá»‡u nhÆ° tÃªn vÃ  cáº¥u trÃºc cá»§a báº£ng, cung cáº¥p cÃ¡c cÃ´ng cá»¥ Ä‘á»ƒ quáº£n lÃ½ cÆ¡ sá»Ÿ dá»¯ liá»‡u, máº«u, khÃ´ng gian báº£ng.</p></li><li><p>â€¦â€¦</p></li></ul><h3 id="trinh-quan-ly-truy-van-query-manager" tabindex="-1"><a class="header-anchor" href="#trinh-quan-ly-truy-van-query-manager"><span>TrÃ¬nh quáº£n lÃ½ truy váº¥n (Query Manager)</span></a></h3><ul><li><p><strong>TrÃ¬nh phÃ¢n tÃ­ch cÃº phÃ¡p truy váº¥n (Query parser):</strong> ÄÆ°á»£c sá»­ dá»¥ng Ä‘á»ƒ kiá»ƒm tra xem truy váº¥n cÃ³ há»£p phÃ¡p hay khÃ´ng</p></li><li><p><strong>TrÃ¬nh viáº¿t láº¡i truy váº¥n (Query Rewriter):</strong> Äá»ƒ tá»‘i Æ°u hÃ³a trÆ°á»›c truy váº¥n</p></li><li><p><strong>TrÃ¬nh tá»‘i Æ°u hÃ³a truy váº¥n (Query Optimizer):</strong> Äá»ƒ tá»‘i Æ°u hÃ³a truy váº¥n</p></li><li><p><strong>TrÃ¬nh thá»±c thi truy váº¥n (Query Executor):</strong> ÄÆ°á»£c sá»­ dá»¥ng Ä‘á»ƒ biÃªn dá»‹ch vÃ  thá»±c thi truy váº¥n</p></li></ul><h3 id="trinh-quan-ly-du-lieu-data-manager" tabindex="-1"><a class="header-anchor" href="#trinh-quan-ly-du-lieu-data-manager"><span>TrÃ¬nh quáº£n lÃ½ dá»¯ liá»‡u (Data Manager)</span></a></h3><ul><li><p><strong>TrÃ¬nh quáº£n lÃ½ giao dá»‹ch (Transaction Manager):</strong> ÄÆ°á»£c sá»­ dá»¥ng Ä‘á»ƒ xá»­ lÃ½ cÃ¡c giao dá»‹ch</p></li><li><p><strong>TrÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache (Cache Manager)</strong>: Dá»¯ liá»‡u Ä‘Æ°á»£c Ä‘áº·t trong bá»™ nhá»› trÆ°á»›c khi nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng, hoáº·c trÆ°á»›c khi dá»¯ liá»‡u Ä‘Æ°á»£c ghi vÃ o Ä‘Ä©a</p></li><li><p><strong>TrÃ¬nh quáº£n lÃ½ truy cáº­p dá»¯ liá»‡u (Data Access Manager):</strong> Truy cáº­p dá»¯ liá»‡u trong Ä‘Ä©a</p></li></ul><h2 id="qua-trinh-truy-van-du-lieu" tabindex="-1"><a class="header-anchor" href="#qua-trinh-truy-van-du-lieu"><span>QuÃ¡ trÃ¬nh truy váº¥n dá»¯ liá»‡u</span></a></h2><p>ChÆ°Æ¡ng nÃ y táº­p trung vÃ o cÃ¡ch cÆ¡ sá»Ÿ dá»¯ liá»‡u cÃ³ thá»ƒ quáº£n lÃ½ truy váº¥n SQL thÃ´ng qua cÃ¡c quy trÃ¬nh sau:</p><ul><li>TrÃ¬nh quáº£n lÃ½ khÃ¡ch hÃ ng</li><li>TrÃ¬nh quáº£n lÃ½ truy váº¥n</li><li>TrÃ¬nh quáº£n lÃ½ dá»¯ liá»‡u (bao gá»“m trÃ¬nh quáº£n lÃ½ phá»¥c há»“i)</li><li>TrÃ¬nh quáº£n lÃ½ khÃ¡ch hÃ ng</li></ul><h2 id="trinh-quan-ly-khach-hang-client-manager" tabindex="-1"><a class="header-anchor" href="#trinh-quan-ly-khach-hang-client-manager"><span>TrÃ¬nh quáº£n lÃ½ khÃ¡ch hÃ ng (Client Manager)</span></a></h2><blockquote><p>TrÃ¬nh quáº£n lÃ½ khÃ¡ch hÃ ng xá»­ lÃ½ giao tiáº¿p khÃ¡ch hÃ ng. KhÃ¡ch hÃ ng cÃ³ thá»ƒ lÃ  má»™t mÃ¡y chá»§ (trang web) hoáº·c má»™t ngÆ°á»i dÃ¹ng cuá»‘i hoáº·c á»©ng dá»¥ng cuá»‘i cÃ¹ng. TrÃ¬nh quáº£n lÃ½ khÃ¡ch hÃ ng thÃ´ng qua má»™t loáº¡t cÃ¡c API ná»•i tiáº¿ng (JDBC, ODBC, OLE-DB â€¦ ) cung cáº¥p nhá»¯ng cÃ¡ch khÃ¡c nhau Ä‘á»ƒ truy cáº­p vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u. TrÃ¬nh quáº£n lÃ½ khÃ¡ch hÃ ng cÅ©ng cung cáº¥p API truy cáº­p cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘á»™c quyá»n.</p></blockquote><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604125929.png" alt="Pasted image 20230604125929" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604125929</figcaption></figure><p><strong>Khi báº¡n káº¿t ná»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u</strong>:</p><ul><li>TrÃ¬nh quáº£n lÃ½ báº¯t Ä‘áº§u báº±ng cÃ¡ch kiá»ƒm tra thÃ´ng tin xÃ¡c minh (tÃªn ngÆ°á»i dÃ¹ng vÃ  máº­t kháº©u) cá»§a báº¡n vÃ  sau Ä‘Ã³ kiá»ƒm tra xem báº¡n cÃ³ quyá»n truy cáº­p vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u hay khÃ´ng. CÃ¡c quyá»n nÃ y Ä‘Æ°á»£c gÃ¡n bá»Ÿi DBA.</li><li>TrÃ¬nh quáº£n lÃ½ sau Ä‘Ã³ kiá»ƒm tra xem cÃ³ má»™t tiáº¿n trÃ¬nh nhÃ n rá»—i (hoáº·c luá»“ng) Ä‘á»ƒ xá»­ lÃ½ truy váº¥n cá»§a báº¡n khÃ´ng?</li><li>TrÃ¬nh quáº£n lÃ½ cÅ©ng kiá»ƒm tra xem cÆ¡ sá»Ÿ dá»¯ liá»‡u cÃ³ táº£i náº·ng hay khÃ´ng?</li><li>TrÃ¬nh quáº£n lÃ½ cÃ³ thá»ƒ chá» má»™t lÃºc Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c tÃ i nguyÃªn cáº§n thiáº¿t. Náº¿u thá»i gian chá» Ä‘áº¡t Ä‘áº¿n thá»i gian chá», nÃ³ sáº½ Ä‘Ã³ng káº¿t ná»‘i vÃ  Ä‘Æ°a ra thÃ´ng bÃ¡o lá»—i cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c.</li><li>TrÃ¬nh quáº£n lÃ½ sau Ä‘Ã³ sáº½ gá»­i truy váº¥n cá»§a báº¡n cho trÃ¬nh quáº£n lÃ½ truy váº¥n Ä‘á»ƒ xá»­ lÃ½.</li><li>Bá»Ÿi vÃ¬ quÃ¡ trÃ¬nh xá»­ lÃ½ truy váº¥n khÃ´ng pháº£i lÃ  &#39;khÃ´ng Ä‘áº§y Ä‘á»§ thÃ¬ khÃ´ng cÃ³&#39;, má»™t khi nÃ³ nháº­n Ä‘Æ°á»£c dá»¯ liá»‡u tá»« trÃ¬nh quáº£n lÃ½ truy váº¥n, nÃ³ sáº½ lÆ°u má»™t pháº§n káº¿t quáº£ vÃ o bá»™ Ä‘á»‡m vÃ  báº¯t Ä‘áº§u gá»­i cho báº¡n.</li><li>Náº¿u báº¡n gáº·p sá»± cá»‘, TrÃ¬nh quáº£n lÃ½ Ä‘Ã³ng káº¿t ná»‘i, gá»­i cho báº¡n thÃ´ng tin giáº£i thÃ­ch cÃ³ thá»ƒ Ä‘á»c Ä‘Æ°á»£c vÃ  sau Ä‘Ã³ giáº£i phÃ³ng tÃ i nguyÃªn.</li></ul><h2 id="trinh-quan-ly-truy-van" tabindex="-1"><a class="header-anchor" href="#trinh-quan-ly-truy-van"><span>TrÃ¬nh quáº£n lÃ½ truy váº¥n</span></a></h2><blockquote><p>Pháº§n nÃ y lÃ  sá»©c máº¡nh cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u, trong Ä‘Ã³ má»™t truy váº¥n Ä‘Æ°á»£c viáº¿t xáº¥u cÃ³ thá»ƒ Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i thÃ nh mÃ£ thá»±c thi nhanh chÃ³ng, vÃ  káº¿t quáº£ thá»±c thi mÃ£ Ä‘Æ°á»£c gá»­i Ä‘áº¿n trÃ¬nh quáº£n lÃ½ khÃ¡ch hÃ ng.</p></blockquote><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604130525.png" alt="Pasted image 20230604130525" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604130525</figcaption></figure><p>QuÃ¡ trÃ¬nh hoáº¡t Ä‘á»™ng nhiá»u bÆ°á»›c nÃ y nhÆ° sau:</p><ul><li><p>Truy váº¥n Ä‘áº§u tiÃªn Ä‘Æ°á»£c <strong>phÃ¢n tÃ­ch cÃº phÃ¡p (parser)</strong> vÃ  xÃ¡c Ä‘á»‹nh xem nÃ³ cÃ³ há»£p phÃ¡p hay khÃ´ng</p></li><li><p>Sau Ä‘Ã³ Ä‘Æ°á»£c <strong>viáº¿t láº¡i (rewrite)</strong>, loáº¡i bá» cÃ¡c hoáº¡t Ä‘á»™ng vÃ´ dá»¥ng vÃ  tham gia pháº§n <strong>tá»‘i Æ°u hÃ³a trÆ°á»›c (pre-optimized)</strong></p></li><li><p>Sau Ä‘Ã³ Ä‘Æ°á»£c <strong>tá»‘i Æ°u hÃ³a (optimized)</strong> Ä‘á»ƒ cáº£i thiá»‡n hiá»‡u suáº¥t vÃ  Ä‘Æ°á»£c <strong>chuyá»ƒn Ä‘á»•i thÃ nh mÃ£ thá»±c thi (translated into executable code)</strong> vÃ  <strong>káº¿ hoáº¡ch truy cáº­p dá»¯ liá»‡u (data access plans)</strong>.</p></li><li><p>Káº¿ hoáº¡ch sau Ä‘Ã³ Ä‘Æ°á»£c <strong>biÃªn dá»‹ch (compiled)</strong></p></li><li><p>Cuá»‘i cÃ¹ng, Ä‘Æ°á»£c <strong>thá»±c thi (excuted)</strong></p></li></ul><p>TÃ´i sáº½ khÃ´ng khÃ¡m phÃ¡ quÃ¡ nhiá»u hai bÆ°á»›c cuá»‘i cÃ¹ng á»Ÿ Ä‘Ã¢y, bá»Ÿi vÃ¬ há» khÃ´ng quÃ¡ quan trá»ng.</p><h3 id="trinh-phan-tich-cu-phap-truy-van-query-parser" tabindex="-1"><a class="header-anchor" href="#trinh-phan-tich-cu-phap-truy-van-query-parser"><span>TrÃ¬nh phÃ¢n tÃ­ch cÃº phÃ¡p truy váº¥n (Query Parser)</span></a></h3><blockquote><p>Má»—i cÃ¢u lá»‡nh SQL Ä‘Æ°á»£c gá»­i Ä‘áº¿n trÃ¬nh phÃ¢n tÃ­ch cÃº phÃ¡p Ä‘á»ƒ kiá»ƒm tra cÃº phÃ¡p vÃ  náº¿u truy váº¥n cá»§a báº¡n sai, trÃ¬nh phÃ¢n tÃ­ch cÃº phÃ¡p sáº½ tá»« chá»‘i truy váº¥n Ä‘Ã³. VÃ­ dá»¥, náº¿u báº¡n viáº¿t &quot;SLECT â€¦&quot; Thay vÃ¬ &quot;SELECTâ€¦&quot;, thÃ¬ khÃ´ng cÃ³ gÃ¬ dÆ°á»›i Ä‘Ã¢y.</p></blockquote><p>NhÆ°ng Ä‘iá»u nÃ y khÃ´ng hoÃ n táº¥t, trÃ¬nh phÃ¢n tÃ­ch cÃº phÃ¡p cÅ©ng sáº½ kiá»ƒm tra xem tá»« khÃ³a cÃ³ sá»­ dá»¥ng Ä‘Ãºng thá»© tá»± hay khÃ´ng, cháº³ng háº¡n nhÆ° WHERE sáº½ bá»‹ tá»« chá»‘i trÆ°á»›c khi SELECT.</p><p>TrÃ¬nh phÃ¢n tÃ­ch cÃº phÃ¡p sau Ä‘Ã³ muá»‘n phÃ¢n tÃ­ch cÃ¡c báº£ng vÃ  trÆ°á»ng trong truy váº¥n, sá»­ dá»¥ng siÃªu dá»¯ liá»‡u cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘á»ƒ kiá»ƒm tra:</p><ul><li>Báº£ng cÃ³ tá»“n táº¡i hay khÃ´ng</li><li>TrÆ°á»ng cá»§a báº£ng cÃ³ tá»“n táº¡i hay khÃ´ng</li><li>TÃ­nh toÃ¡n cho má»™t loáº¡i trÆ°á»ng cÃ³ thá»ƒ khÃ´ng (vÃ­ dá»¥: báº¡n khÃ´ng thá»ƒ so sÃ¡nh sá»‘ nguyÃªn vá»›i chuá»—i, báº¡n khÃ´ng thá»ƒ sá»­ dá»¥ng hÃ m substring() cho má»™t sá»‘ nguyÃªn)</li></ul><p>Tiáº¿p theo, trÃ¬nh phÃ¢n tÃ­ch cÃº phÃ¡p kiá»ƒm tra xem báº¡n cÃ³ quyá»n Ä‘á»c (hoáº·c viáº¿t) báº£ng trong truy váº¥n hay khÃ´ng. Nháº¥n máº¡nh má»™t láº§n ná»¯a: cÃ¡c quyá»n nÃ y Ä‘Æ°á»£c cáº¥p phÃ¡t bá»Ÿi DBA.</p><p>Trong quÃ¡ trÃ¬nh phÃ¢n tÃ­ch cÃº phÃ¡p, truy váº¥n SQL Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i thÃ nh Ä‘áº¡i diá»‡n ná»™i bá»™ (internal representation) (thÆ°á»ng lÃ  má»™t cÃ¢y).</p><p>Náº¿u má»i thá»© Ä‘á»u á»•n, Ä‘áº¡i diá»‡n ná»™i bá»™ Ä‘Æ°á»£c gá»­i Ä‘áº¿n trÃ¬nh viáº¿t láº¡i truy váº¥n.</p><h3 id="trinh-viet-lai-truy-van-bo-query-rewriter" tabindex="-1"><a class="header-anchor" href="#trinh-viet-lai-truy-van-bo-query-rewriter"><span>TrÃ¬nh viáº¿t láº¡i truy váº¥n bá»™ (Query Rewriter)</span></a></h3><p>á» bÆ°á»›c nÃ y, tÃ´i Ä‘Ã£ cÃ³ má»™t Ä‘áº¡i diá»‡n ná»™i bá»™ cá»§a truy váº¥n, má»¥c tiÃªu cá»§a trÃ¬nh viáº¿t láº¡i lÃ :</p><ul><li>Truy váº¥n Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a trÆ°á»›c</li><li>TrÃ¡nh cÃ¡c tÃ­nh toÃ¡n khÃ´ng cáº§n thiáº¿t</li><li>GiÃºp trÃ¬nh tá»‘i Æ°u hÃ³a tÃ¬m ra giáº£i phÃ¡p tá»‘t nháº¥t há»£p lÃ½</li></ul><p>TrÃ¬nh viáº¿t láº¡i thá»±c hiá»‡n kiá»ƒm tra truy váº¥n theo má»™t táº­p há»£p cÃ¡c quy táº¯c Ä‘Ã£ biáº¿t. Náº¿u truy váº¥n phÃ¹ há»£p vá»›i má»™t quy táº¯c cá»§a má»™t máº«u, truy váº¥n sáº½ Ä‘Æ°á»£c viáº¿t láº¡i theo quy táº¯c nÃ y. DÆ°á»›i Ä‘Ã¢y lÃ  danh sÃ¡ch khÃ´ng Ä‘áº§y Ä‘á»§ cÃ¡c quy táº¯c (tÃ¹y chá»n):</p><ul><li><strong>Há»£p nháº¥t view</strong>: Náº¿u báº¡n sá»­ dá»¥ng view trong truy váº¥n cá»§a mÃ¬nh, view sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i thÃ nh mÃ£ SQL cá»§a nÃ³.</li><li><strong>LÃ m pháº³ng truy váº¥n con</strong>: Truy váº¥n con ráº¥t khÃ³ tá»‘i Æ°u hÃ³a, vÃ¬ váº­y trÃ¬nh viáº¿t láº¡i sáº½ cá»‘ gáº¯ng loáº¡i bá» truy váº¥n con <ul><li>VÃ­ dá»¥:</li></ul></li></ul><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> PERSON.*</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> PERSON</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">person_key</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> IN</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> MAILS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">person_key</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> MAILS</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> MAILS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">mail</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> LIKE</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;christophe%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><p>sáº½ Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i thÃ nh:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> PERSON.*</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">FROM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> PERSON, MAILS</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">person_key</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> MAILS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">person_key</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">and</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> MAILS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">mail</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> LIKE</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;christophe%&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li><strong>Loáº¡i bá» cÃ¡c toÃ¡n tá»­ khÃ´ng cáº§n thiáº¿t</strong>: VÃ­ dá»¥: náº¿u báº¡n sá»­ dá»¥ng DISTINCT vÃ  báº¡n thá»±c sá»± cÃ³ cÃ¡c rÃ ng buá»™c UNIQUE (Ä‘iá»u nÃ y ngÄƒn cháº·n sá»± trÃ¹ng láº·p dá»¯ liá»‡u), tá»« khÃ³a DISTINCT sáº½ bá»‹ xÃ³a.</li><li><strong>Loáº¡i trá»« cÃ¡c JOIN dÆ° thá»«a</strong>: Náº¿u cÃ¹ng má»™t Ä‘iá»u kiá»‡n JOIN xáº£y ra hai láº§n, cháº³ng háº¡n nhÆ° Ä‘iá»u kiá»‡n JOIN áº©n trong view hoáº·c JOIN vÃ´ dá»¥ng phÃ¡t sinh tá»« kháº£ nÄƒng truyá»n, chÃºng sáº½ bá»‹ loáº¡i bá».</li><li><strong>Háº±ng sá»‘ tÃ­nh toÃ¡n gÃ¡n</strong>: Náº¿u truy váº¥n cá»§a báº¡n cáº§n tÃ­nh toÃ¡n, tÃ­nh toÃ¡n Ä‘Æ°á»£c thá»±c hiá»‡n má»™t láº§n trong quÃ¡ trÃ¬nh viáº¿t láº¡i. VÃ­ dá»¥: WHERE AGE &gt; 10+2 Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i sang WHERE AGE &gt; 12 vÃ  TODATE (&quot;date string&quot;) Ä‘Æ°á»£c chuyá»ƒn Ä‘á»•i sang giÃ¡ trá»‹ ngÃ y á»Ÿ Ä‘á»‹nh dáº¡ng datetime.</li><li><strong>(NÃ¢ng cao) Cáº¯t phÃ¢n vÃ¹ng (Partition Pruning):</strong> Náº¿u báº¡n sá»­ dá»¥ng báº£ng phÃ¢n vÃ¹ng, trÃ¬nh viáº¿t láº¡i cÃ³ thá»ƒ tÃ¬m tháº¥y phÃ¢n vÃ¹ng báº¡n cáº§n sá»­ dá»¥ng.</li><li><strong>(NÃ¢ng cao) view váº­t lÃ½ (Materialized view rewrite):</strong> Náº¿u báº¡n cÃ³ view váº­t lÃ½ phÃ¹ há»£p vá»›i má»™t táº­p há»£p con cá»§a vá»‹ ngá»¯ truy váº¥n, trÃ¬nh viáº¿t láº¡i sáº½ kiá»ƒm tra xem view cÃ³ Ä‘Æ°á»£c cáº­p nháº­t vÃ  sá»­a Ä‘á»•i truy váº¥n hay khÃ´ng, cho phÃ©p truy váº¥n sá»­ dá»¥ng view váº­t lÃ½ thay vÃ¬ báº£ng gá»‘c.</li><li><strong>(NÃ¢ng cao) Quy táº¯c tÃ¹y chá»‰nh:</strong> Náº¿u báº¡n cÃ³ cÃ¡c quy táº¯c tÃ¹y chá»‰nh Ä‘á»ƒ sá»­a Ä‘á»•i truy váº¥n (giá»‘ng nhÆ° Oracle policy), trÃ¬nh viáº¿t láº¡i sáº½ thá»±c hiá»‡n cÃ¡c quy táº¯c nÃ y.</li><li><strong>(NÃ¢ng cao) Chuyá»ƒn Ä‘á»•i OLAP:</strong> chá»©c nÄƒng phÃ¢n tÃ­ch / cá»­a sá»•, star join, chá»©c nÄƒng ROLLUP â€¦ Chuyá»ƒn Ä‘á»•i xáº£y ra (nhÆ°ng tÃ´i khÃ´ng cháº¯c cháº¯n Ä‘iá»u nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n bá»Ÿi trÃ¬nh viáº¿t láº¡i hoáº·c trÃ¬nh tá»‘i Æ°u hÃ³a, vÃ¬ cáº£ hai quÃ¡ trÃ¬nh Ä‘Æ°á»£c liÃªn káº¿t cháº·t cháº½ vÃ  pháº£i xem cÆ¡ sá»Ÿ dá»¯ liá»‡u lÃ  gÃ¬).</li></ul><p>Truy váº¥n sau khi viáº¿t láº¡i tiáº¿p tá»¥c Ä‘Æ°á»£c gá»­i Ä‘áº¿n trÃ¬nh tá»‘i Æ°u hÃ³a, táº¡i thá»i Ä‘iá»ƒm nÃ y niá»m vui báº¯t Ä‘áº§u.</p><h3 id="thong-ke" tabindex="-1"><a class="header-anchor" href="#thong-ke"><span>Thá»‘ng kÃª</span></a></h3><blockquote><p>TrÆ°á»›c khi nghiÃªn cá»©u cÃ¡ch cÆ¡ sá»Ÿ dá»¯ liá»‡u tá»‘i Æ°u hÃ³a truy váº¥n. chÃºng ta cáº§n nÃ³i vá» thá»‘ng kÃª, vÃ¬ <strong>cÆ¡ sá»Ÿ dá»¯ liá»‡u khÃ´ng cÃ³ sá»‘ liá»‡u thá»‘ng kÃª lÃ  ngu ngá»‘c</strong>. CÆ¡ sá»Ÿ dá»¯ liá»‡u khÃ´ng phÃ¢n tÃ­ch dá»¯ liá»‡u cá»§a riÃªng báº¡n trá»« khi báº¡n nÃ³i ra rÃµ rÃ ng. KhÃ´ng cÃ³ phÃ¢n tÃ­ch nÃ o cÃ³ thá»ƒ khiáº¿n cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘Æ°a ra cÃ¡c giáº£ Ä‘á»‹nh (ráº¥t) kÃ©m.</p></blockquote><p>Tuy nhiÃªn, cÆ¡ sá»Ÿ dá»¯ liá»‡u cáº§n loáº¡i thÃ´ng tin nÃ o?</p><p>TÃ´i pháº£i nÃ³i (ngáº¯n gá»n) vá» cÃ¡ch cÆ¡ sá»Ÿ dá»¯ liá»‡u vÃ  há»‡ Ä‘iá»u hÃ nh lÆ°u dá»¯ liá»‡u. ÄÆ¡n vá»‹ nhá» nháº¥t Ä‘Æ°á»£c sá»­ dá»¥ng cho cáº£ hai Ä‘Æ°á»£c gá»i lÃ  trang hoáº·c khá»‘i (máº·c Ä‘á»‹nh 4 hoáº·c 8 KB). Äiá»u nÃ y cÃ³ nghÄ©a lÃ  náº¿u báº¡n chá»‰ cáº§n 1KB, báº¡n cÅ©ng sáº½ chiáº¿m má»™t trang. Náº¿u kÃ­ch thÆ°á»›c cá»§a trang lÃ  8KB, báº¡n lÃ£ng phÃ­ 7KB.</p><p>Quay láº¡i vÃ  tiáº¿p tá»¥c nÃ³i vá» thá»‘ng kÃª! Khi báº¡n yÃªu cáº§u cÆ¡ sá»Ÿ dá»¯ liá»‡u thu tháº­p sá»‘ liá»‡u thá»‘ng kÃª, cÆ¡ sá»Ÿ dá»¯ liá»‡u tÃ­nh toÃ¡n cÃ¡c giÃ¡ trá»‹ sau:</p><ul><li>Sá»‘ lÆ°á»£ng hÃ ng vÃ  trang trong báº£ng</li><li>Trong má»—i cá»™t trong báº£ng: <ul><li>GiÃ¡ trá»‹ duy nháº¥t</li><li>Äá»™ dÃ i dá»¯ liá»‡u (tá»‘i thiá»ƒu, tá»‘i Ä‘a, trung bÃ¬nh)</li><li>Pháº¡m vi dá»¯ liá»‡u (tá»‘i thiá»ƒu, tá»‘i Ä‘a, trung bÃ¬nh)</li></ul></li><li>ThÃ´ng tin chá»‰ má»¥c cá»§a báº£ng</li></ul><p><strong>CÃ¡c sá»‘ liá»‡u thá»‘ng kÃª nÃ y giÃºp trÃ¬nh tá»‘i Æ°u hÃ³a Æ°á»›c tÃ­nh Disk I/O, CPU vÃ  sá»­ dá»¥ng bá»™ nhá»› cáº§n thiáº¿t cho truy váº¥n</strong></p><p>Thá»‘ng kÃª cho má»—i cá»™t lÃ  ráº¥t quan trá»ng. VÃ­ dá»¥: náº¿u má»™t báº£ng PERSON cáº§n pháº£i Ä‘Æ°á»£c JOIN vá»›i 2 cá»™t: LAST_NAME, FIRST_NAME. Theo thá»‘ng kÃª, cÆ¡ sá»Ÿ dá»¯ liá»‡u biáº¿t ráº±ng FIRST_NAME chá»‰ cÃ³ 1.000 giÃ¡ trá»‹ khÃ¡c nhau vÃ  LAST_NAME cÃ³ 1.000.000 giÃ¡ trá»‹ khÃ¡c nhau. VÃ¬ váº­y, cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘Æ°á»£c JOIN theo LAST_NAME, FIRST_NAME. Bá»Ÿi vÃ¬ LAST_NAME khÃ´ng cÃ³ kháº£ nÄƒng láº·p láº¡i, so sÃ¡nh 2, 3 kÃ½ tá»± Ä‘áº§u tiÃªn cá»§a LAST_NAME lÃ  Ä‘á»§ trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p, Ä‘iá»u nÃ y sáº½ lÃ m giáº£m Ä‘Ã¡ng ká»ƒ sá»‘ láº§n so sÃ¡nh.</p><p>Tuy nhiÃªn, Ä‘Ã¢y chá»‰ lÃ  nhá»¯ng sá»‘ liá»‡u thá»‘ng kÃª cÆ¡ báº£n. Báº¡n cÃ³ thá»ƒ yÃªu cáº§u cÆ¡ sá»Ÿ dá»¯ liá»‡u lÃ m má»™t sá»‘ liá»‡u thá»‘ng kÃª nÃ¢ng cao Ä‘Æ°á»£c gá»i lÃ  histogram. Histogram lÃ  sá»‘ liá»‡u thá»‘ng kÃª vá» phÃ¢n phá»‘i giÃ¡ trá»‹ cá»™t. VÃ­ dá»¥:</p><ul><li>CÃ¡c giÃ¡ trá»‹ xuáº¥t hiá»‡n thÆ°á»ng xuyÃªn nháº¥t</li><li>PhÃ¢n vá»‹ (quantiles)</li><li>â€¦</li></ul><p>CÃ¡c sá»‘ liá»‡u thá»‘ng kÃª bá»• sung nÃ y giÃºp cÆ¡ sá»Ÿ dá»¯ liá»‡u tÃ¬m tháº¥y káº¿ hoáº¡ch truy váº¥n tá»‘t hÆ¡n, Ä‘áº·c biá»‡t lÃ  Ä‘á»‘i vá»›i cÃ¡c vá»‹ ngá»¯ phÆ°Æ¡ng trÃ¬nh (vÃ­ dá»¥: WHERE AGE = 18) hoáº·c vá»‹ ngá»¯ pháº¡m vi (vÃ­ dá»¥: WHERE AGE &gt; 10 vÃ  AGE &lt; 40) vÃ¬ cÆ¡ sá»Ÿ dá»¯ liá»‡u cÃ³ thá»ƒ hiá»ƒu rÃµ hÆ¡n vá» cÃ¡c dÃ²ng dá»¯ liá»‡u loáº¡i sá»‘ liÃªn quan Ä‘áº¿n cÃ¡c vá»‹ ngá»¯ nÃ y (LÆ°u Ã½: TÃªn ká»¹ thuáº­t cá»§a khÃ¡i niá»‡m nÃ y Ä‘Æ°á»£c gá»i lÃ  tá»· lá»‡ chá»n).</p><p>Sá»‘ liá»‡u thá»‘ng kÃª Ä‘Æ°á»£c lÆ°u trá»¯ trong siÃªu dá»¯ liá»‡u cÆ¡ sá»Ÿ dá»¯ liá»‡u, cháº³ng háº¡n nhÆ° vá»‹ trÃ­ thá»‘ng kÃª cá»§a báº£ng (khÃ´ng phÃ¢n vÃ¹ng):</p><ul><li>Oracle: USER / ALL / DBA_TABLES vÃ  USER / ALL / DBA_TAB_COLUMNS</li><li>DB2ï¼š SYSCAT. TABLES vÃ  SYSCAT. COLUMNS</li></ul><p><strong>Sá»‘ liá»‡u thá»‘ng kÃª pháº£i Ä‘Æ°á»£c cáº­p nháº­t ká»‹p thá»i</strong>. Náº¿u má»™t báº£ng cÃ³ 1.000.000 hÃ ng vÃ  cÆ¡ sá»Ÿ dá»¯ liá»‡u nghÄ© ráº±ng nÃ³ chá»‰ cÃ³ 500 hÃ ng, khÃ´ng cÃ³ gÃ¬ tá»“i tá»‡ hÆ¡n tháº¿. NhÆ°á»£c Ä‘iá»ƒm duy nháº¥t cá»§a thá»‘ng kÃª lÃ  cáº§n cÃ³ thá»i gian Ä‘á»ƒ tÃ­nh toÃ¡n, Ä‘Ã³ lÃ  lÃ½ do táº¡i sao háº§u háº¿t cÃ¡c cÆ¡ sá»Ÿ dá»¯ liá»‡u khÃ´ng tá»± Ä‘á»™ng tÃ­nh toÃ¡n sá»‘ liá»‡u thá»‘ng kÃª theo máº·c Ä‘á»‹nh. Khi dá»¯ liá»‡u Ä‘áº¡t Ä‘áº¿n má»™t triá»‡u cáº¥p Ä‘á»™ thá»‘ng kÃª trá»Ÿ nÃªn khÃ³ khÄƒn, táº¡i thá»i Ä‘iá»ƒm nÃ y, báº¡n cÃ³ thá»ƒ chá»n chá»‰ lÃ m sá»‘ liá»‡u thá»‘ng kÃª cÆ¡ báº£n hoáº·c thá»±c hiá»‡n thá»‘ng kÃª trÃªn má»™t máº«u cÆ¡ sá»Ÿ dá»¯ liá»‡u.</p><p>VÃ­ dá»¥, má»™t dá»± Ã¡n mÃ  cáº§n pháº£i xá»­ lÃ½ hÃ ng trÄƒm triá»‡u dá»¯ liá»‡u trÃªn má»—i báº£ng vÃ  tÃ´i Ä‘Ã£ chá»n chá»‰ thá»‘ng kÃª 10%, dáº«n Ä‘áº¿n tiÃªu thá»¥ thá»i gian ráº¥t lá»›n. VÃ­ dá»¥ nÃ y chá»©ng minh ráº±ng Ä‘Ã¢y lÃ  má»™t quyáº¿t Ä‘á»‹nh tá»“i vÃ¬ Ä‘Ã´i khi 10% oracle 10G Ä‘Æ°á»£c chá»n tá»« má»™t cá»™t cá»¥ thá»ƒ cá»§a má»™t báº£ng cá»¥ thá»ƒ ráº¥t khÃ¡c so vá»›i táº¥t cáº£ 100% (Ä‘iá»u nÃ y hiáº¿m khi xáº£y ra Ä‘á»‘i vá»›i cÃ¡c báº£ng cÃ³ 100 triá»‡u hÃ ng dá»¯ liá»‡u). Sá»‘ liá»‡u thá»‘ng kÃª sai nÃ y Ä‘Ã£ dáº«n Ä‘áº¿n má»™t truy váº¥n Ä‘Æ°á»£c cho lÃ  30 giÃ¢y Ä‘á»ƒ hoÃ n thÃ nh cuá»‘i cÃ¹ng Ä‘Æ°á»£c thá»±c hiá»‡n trong tÃ¡m giá», quÃ¡ trÃ¬nh tÃ¬m kiáº¿m nguyÃªn nhÃ¢n gá»‘c rá»… cá»§a hiá»‡n tÆ°á»£ng nÃ y lÃ  má»™t cÆ¡n Ã¡c má»™ng. VÃ­ dá»¥ nÃ y cho tháº¥y táº§m quan trá»ng cá»§a thá»‘ng kÃª.</p><blockquote><p>LÆ°u Ã½: Táº¥t nhiÃªn, má»—i cÆ¡ sá»Ÿ dá»¯ liá»‡u cÃ³ sá»‘ liá»‡u thá»‘ng kÃª cá»¥ thá»ƒ vÃ  cao hÆ¡n. Náº¿u báº¡n muá»‘n biáº¿t thÃªm thÃ´ng tin, hÃ£y Ä‘á»c tÃ i liá»‡u vá» cÆ¡ sá»Ÿ dá»¯ liá»‡u. Máº·c dÃ¹ váº­y, tÃ´i Ä‘Ã£ cá»‘ gáº¯ng háº¿t sá»©c Ä‘á»ƒ hiá»ƒu lÃ m tháº¿ nÃ o sá»‘ liá»‡u thá»‘ng kÃª Ä‘Æ°á»£c sá»­ dá»¥ng, vÃ  tÃ i liá»‡u chÃ­nh thá»©c tá»‘t nháº¥t tÃ´i tÃ¬m tháº¥y Ä‘áº¿n tá»« PostgreSQL.</p></blockquote><h3 id="trinh-toi-uu-hoa-truy-van-query-optimizer" tabindex="-1"><a class="header-anchor" href="#trinh-toi-uu-hoa-truy-van-query-optimizer"><span>TrÃ¬nh tá»‘i Æ°u hÃ³a truy váº¥n (Query optimizer)</span></a></h3><blockquote><p>Táº¥t cáº£ cÃ¡c cÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n Ä‘áº¡i Ä‘ang <strong>tá»‘i Æ°u hÃ³a truy váº¥n vá»›i tá»‘i Æ°u hÃ³a dá»±a trÃªn chi phÃ­</strong>, tá»©c lÃ  <strong>cost-based optimization - CBO</strong>. Sá»± tháº­t lÃ  thiáº¿t láº­p má»™t chi phÃ­ cho má»—i tÃ­nh toÃ¡n, báº±ng cÃ¡ch Ã¡p dá»¥ng má»™t loáº¡t cÃ¡c tÃ­nh toÃ¡n chi phÃ­ tháº¥p nháº¥t, Ä‘á»ƒ tÃ¬m cÃ¡ch tá»‘t nháº¥t Ä‘á»ƒ giáº£m chi phÃ­ truy váº¥n.</p></blockquote><p>Äá»ƒ hiá»ƒu cÃ¡c nguyÃªn táº¯c cá»§a trÃ¬nh tá»‘i Æ°u hÃ³a chi phÃ­, tÃ´i nghÄ© ráº±ng nÃ³ lÃ  tá»‘t hÆ¡n Ä‘á»ƒ sá»­ dá»¥ng má»™t vÃ­ dá»¥ Ä‘á»ƒ &quot;cáº£m nháº­n&quot; sá»± phá»©c táº¡p Ä‘áº±ng sau nhiá»‡m vá»¥ nÃ y. á» Ä‘Ã¢y tÃ´i sáº½ Ä‘Æ°a ra 3 cÃ¡ch Ä‘á»ƒ káº¿t ná»‘i 2 báº£ng vÃ  chÃºng ta sáº½ sá»›m tháº¥y ráº±ng ngay cáº£ má»™t truy váº¥n ná»‘i Ä‘Æ¡n giáº£n lÃ  má»™t cÆ¡n Ã¡c má»™ng Ä‘á»‘i vá»›i trÃ¬nh tá»‘i Æ°u hÃ³a. Sau Ä‘Ã³, chÃºng ta sáº½ tÃ¬m hiá»ƒu cÃ¡ch trÃ¬nh tá»‘i Æ°u hÃ³a thá»±c sá»± hoáº¡t Ä‘á»™ng.</p><p><strong>Äá»‘i vá»›i cÃ¡c hoáº¡t Ä‘á»™ng JOIN, tÃ´i sáº½ táº­p trung vÃ o Ä‘á»™ phá»©c táº¡p thá»i gian cá»§a chÃºng, tuy nhiÃªn, trÃ¬nh tá»‘i Æ°u hÃ³a cÆ¡ sá»Ÿ dá»¯ liá»‡u tÃ­nh toÃ¡n chi phÃ­ CPU, chi phÃ­ Disk I/O vÃ  yÃªu cáº§u bá»™ nhá»› cá»§a chÃºng</strong>. Sá»± khÃ¡c biá»‡t giá»¯a Ä‘á»™ phá»©c táº¡p thá»i gian vÃ  chi phÃ­ CPU lÃ  chi phÃ­ thá»i gian lÃ  má»™t xáº¥p xá»‰ (Ä‘Æ°á»£c chuáº©n bá»‹ cho má»™t káº» lÆ°á»i biáº¿ng nhÆ° tÃ´i). VÃ  chi phÃ­ CPU, tÃ´i bao gá»“m táº¥t cáº£ cÃ¡c tÃ­nh toÃ¡n á»Ÿ Ä‘Ã¢y, cháº³ng háº¡n nhÆ°: cá»™ng, phÃ¡n Ä‘oÃ¡n Ä‘iá»u kiá»‡n, nhÃ¢n, láº·p láº¡i â€¦ NgoÃ i ra, nhá»¯ng gÃ¬ khÃ¡c:</p><p>Má»—i hoáº¡t Ä‘á»™ng high-level code yÃªu cáº§u má»™t sá»‘ lÆ°á»£ng cá»¥ thá»ƒ cá»§a cÃ¡c hoáº¡t Ä‘á»™ng CPU low-level.</p><p>Äá»‘i vá»›i Intel Core i7, Intel Pentium 4, AMD Opteronâ€¦ Vv, (xÃ©t chu ká»³ CPU), chi phÃ­ hoáº¡t Ä‘á»™ng cá»§a CPU lÃ  khÃ¡c nhau, cÃ³ nghÄ©a lÃ  nÃ³ phá»¥ thuá»™c vÃ o kiáº¿n trÃºc cá»§a CPU.</p><p>Sá»­ dá»¥ng Ä‘á»™ phá»©c táº¡p thá»i gian dá»… dÃ ng hÆ¡n nhiá»u (Ã­t nháº¥t lÃ  Ä‘á»‘i vá»›i tÃ´i), vÃ  sá»­ dá»¥ng nÃ³ tÃ´i cÅ©ng cÃ³ thá»ƒ tÃ¬m hiá»ƒu vá» khÃ¡i niá»‡m CBO. VÃ¬ Disk I/O lÃ  má»™t khÃ¡i niá»‡m quan trá»ng, thá»‰nh thoáº£ng tÃ´i cÅ©ng Ä‘á» cáº­p Ä‘áº¿n nÃ³. HÃ£y nhá»› ráº±ng <strong>háº§u háº¿t thá»i gian tháº¯t cá»• chai lÃ  Disk I/O thay vÃ¬ sá»­ dá»¥ng CPU</strong>.</p><h4 id="chi-muc-index" tabindex="-1"><a class="header-anchor" href="#chi-muc-index"><span>Chá»‰ má»¥c (Index)</span></a></h4><blockquote><p>Khi nghiÃªn cá»©u [[B Tree]], tÃ´i Ä‘Ã£ nÃ³i vá» Index, hÃ£y nhá»› ráº±ng cÃ¡c chá»‰ sá»‘ Ä‘Ã£ Ä‘Æ°á»£c sáº¯p xáº¿p.</p></blockquote><p>Chá»‰ Ä‘á»ƒ tham kháº£o: NgoÃ i ra cÃ²n cÃ³ cÃ¡c loáº¡i chá»‰ má»¥c khÃ¡c, cháº³ng háº¡n nhÆ° bitmap index, khÃ´ng giá»‘ng nhÆ° chi phÃ­ cá»§a chá»‰ má»¥c B+ Tree vá» CPU, Disk I/O vÃ  bá»™ nhá»›.</p><p>NgoÃ i ra, nhiá»u cÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n Ä‘áº¡i Ä‘á»ƒ cáº£i thiá»‡n chi phÃ­ thá»±c thi truy váº¥n, chá»‰ cÃ³ thá»ƒ tá»± Ä‘á»™ng táº¡o chá»‰ má»¥c táº¡m thá»i cho cÃ¡c truy váº¥n hiá»‡n táº¡i.</p><h4 id="Ä‘uong-dan-truy-cap-access-path" tabindex="-1"><a class="header-anchor" href="#Ä‘uong-dan-truy-cap-access-path"><span>ÄÆ°á»ng dáº«n truy cáº­p (access path)</span></a></h4><p>TrÆ°á»›c khi Ã¡p dá»¥ng toÃ¡n tá»­ liÃªn káº¿t (join), trÆ°á»›c tiÃªn báº¡n cáº§n láº¥y dá»¯ liá»‡u. DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡ch Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c dá»¯ liá»‡u.</p><p>LÆ°u Ã½: VÃ¬ váº¥n Ä‘á» thá»±c sá»± vá»›i táº¥t cáº£ cÃ¡c Ä‘Æ°á»ng dáº«n truy cáº­p lÃ  Disk I/O, tÃ´i sáº½ khÃ´ng nÃ³i quÃ¡ nhiá»u vá» Ä‘á»™ phá»©c táº¡p thá»i gian.</p><ul><li>QuÃ©t Ä‘áº§y Ä‘á»§ (full scan)</li></ul><p>Náº¿u báº¡n Ä‘Ã£ Ä‘á»c káº¿ hoáº¡ch thá»±c thi, báº¡n cháº¯c cháº¯n Ä‘Ã£ tháº¥y tá»« &quot;quÃ©t Ä‘áº§y Ä‘á»§&quot; (hoáº·c chá»‰ quÃ©t&#39;). NÃ³i má»™t cÃ¡ch Ä‘Æ¡n giáº£n, quÃ©t Ä‘áº§y Ä‘á»§ lÃ  cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘á»c Ä‘áº§y Ä‘á»§ má»™t báº£ng hoáº·c chá»‰ má»¥c. Äá»‘i vá»›i Disk I/O, rÃµ rÃ ng lÃ  quÃ©t báº£ng Ä‘áº§y Ä‘á»§ cÃ³ chi phÃ­ cao hÆ¡n so vá»›i quÃ©t Ä‘áº§y Ä‘á»§ chá»‰ má»¥c.</p><ul><li>QuÃ©t pháº¡m vi</li></ul><p>CÃ¡c loáº¡i quÃ©t khÃ¡c Ä‘Æ°á»£c quÃ©t theo chá»‰ má»¥c, cháº³ng háº¡n nhÆ° khi báº¡n sá»­ dá»¥ng vá»‹ ngá»¯ <code>WHERE AGE &gt; 20 AND AGE &lt; 40</code></p><p>Táº¥t nhiÃªn, báº¡n cáº§n pháº£i cÃ³ chá»‰ má»¥c trÃªn trÆ°á»ng <code>AGE</code> Ä‘á»ƒ quÃ©t pháº¡m vi chá»‰ má»¥c.</p><p>Trong pháº§n Ä‘áº§u tiÃªn, chÃºng ta Ä‘Ã£ biáº¿t ráº±ng chi phÃ­ thá»i gian cá»§a truy váº¥n pháº¡m vi lÃ  khoáº£ng <code>log(N) + M</code>, á»Ÿ Ä‘Ã¢y N lÃ  khá»‘i lÆ°á»£ng dá»¯ liá»‡u Ä‘Æ°á»£c chá»‰ má»¥c vÃ  M lÃ  sá»‘ dÃ²ng Ä‘Æ°á»£c Æ°á»›c tÃ­nh trong pháº¡m vi. Nhá» thá»‘ng kÃª, chÃºng ta má»›i cÃ³ thá»ƒ biáº¿t giÃ¡ trá»‹ cá»§a N vÃ  M (LÆ°u Ã½: M lÃ  vá»‹ ngá»¯ <code>AGE &gt; 20 AND AGE &lt; 40</code>). NgoÃ i ra, báº¡n khÃ´ng cáº§n pháº£i Ä‘á»c toÃ n bá»™ chá»‰ má»¥c khi quÃ©t pháº¡m vi, vÃ¬ váº­y nÃ³ khÃ´ng tá»‘n kÃ©m nhÆ° quÃ©t Ä‘áº§y Ä‘á»§ trÃªn Disk I/O.</p><ul><li>QuÃ©t duy nháº¥t</li></ul><p>Náº¿u báº¡n chá»‰ cáº§n láº¥y má»™t giÃ¡ trá»‹ tá»« chá»‰ má»¥c, báº¡n cÃ³ thá»ƒ quÃ©t duy nháº¥t.</p><ul><li>Truy cáº­p theo ROW ID</li></ul><p>Trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p, náº¿u cÆ¡ sá»Ÿ dá»¯ liá»‡u sá»­ dá»¥ng chá»‰ má»¥c, nÃ³ pháº£i tÃ¬m cÃ¡c hÃ ng liÃªn quan Ä‘áº¿n chá»‰ má»¥c, Ä‘iá»u nÃ y sáº½ Ä‘Æ°á»£c sá»­ dá»¥ng theo cÃ¡ch truy cáº­p dá»±a trÃªn ROW ID.</p><p>VÃ­ dá»¥: náº¿u báº¡n cháº¡y:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> LASTNAME, FIRSTNAME </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> PERSON </span><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> AGE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 28</span></span></code></pre></div><p>Náº¿u cá»™t <code>age</code> cá»§a báº£ng <code>person</code> cÃ³ chá»‰ má»¥c, trÃ¬nh tá»‘i Æ°u hÃ³a sáº½ sá»­ dá»¥ng chá»‰ má»¥c Ä‘á»ƒ tÃ¬m má»i ngÆ°á»i á»Ÿ táº¥t cáº£ cÃ¡c lá»©a tuá»•i 28, sau Ä‘Ã³ nÃ³ sáº½ Ä‘i vÃ o báº£ng Ä‘á»ƒ Ä‘á»c cÃ¡c hÃ ng cÃ³ liÃªn quan, Ä‘Ã³ lÃ  bá»Ÿi vÃ¬ chá»‰ cÃ³ thÃ´ng tin age trong chá»‰ má»¥c vÃ  báº¡n muá»‘n há» vÃ  tÃªn.</p><p>Tuy nhiÃªn, náº¿u báº¡n thá»±c hiá»‡n má»™t cÃ¡ch tiáº¿p cáº­n khÃ¡c:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> TYPE_PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">CATEGORY</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> PERSON, TYPE_PERSON</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">AGE</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> TYPE_PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">AGE</span></span></code></pre></div><p>Chá»‰ má»¥c cá»§a báº£ng <code>PERSON</code> Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ káº¿t ná»‘i báº£ng <code>TYPE_PERSON</code>, nhÆ°ng báº£ng <code>PERSON</code> khÃ´ng Ä‘Æ°á»£c truy cáº­p dá»±a trÃªn ROW ID vÃ¬ báº¡n khÃ´ng yÃªu cáº§u thÃ´ng tin trong báº£ng Ä‘Ã³.</p><p>Máº·c dÃ¹ phÆ°Æ¡ng phÃ¡p nÃ y hoáº¡t Ä‘á»™ng tá»‘t á»Ÿ má»™t lÆ°á»£ng nhá» truy cáº­p, váº¥n Ä‘á» thá»±c sá»± vá»›i hoáº¡t Ä‘á»™ng nÃ y thá»±c sá»± lÃ  Disk I/O. Náº¿u cáº§n ráº¥t nhiá»u truy cáº­p dá»±a trÃªn ROW ID, cÆ¡ sá»Ÿ dá»¯ liá»‡u cÃ³ thá»ƒ chá»n quÃ©t Ä‘áº§y Ä‘á»§.</p><ul><li>ÄÆ°á»ng dáº«n khÃ¡c</li></ul><p>TÃ´i khÃ´ng liá»‡t kÃª táº¥t cáº£ cÃ¡c Ä‘Æ°á»ng dáº«n truy cáº­p vÃ  báº¡n cÃ³ thá»ƒ Ä‘á»c tÃ i liá»‡u Oracle náº¿u báº¡n quan tÃ¢m. CÃ¡c cÆ¡ sá»Ÿ dá»¯ liá»‡u khÃ¡c cÃ³ thá»ƒ Ä‘Æ°á»£c gá»i khÃ¡c nhau nhÆ°ng cÃ¡c khÃ¡i niá»‡m Ä‘áº±ng sau nÃ³ lÃ  nhÆ° nhau.</p><h4 id="phep-ket-noi-join" tabindex="-1"><a class="header-anchor" href="#phep-ket-noi-join"><span>PhÃ©p káº¿t ná»‘i (join)</span></a></h4><blockquote><p>BÃ¢y giá» chÃºng ta Ä‘Ã£ biáº¿t lÃ m tháº¿ nÃ o Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c dá»¯ liá»‡u, sau Ä‘Ã³ káº¿t ná»‘i chÃºng ngay !</p></blockquote><p>Nhá»¯ng gÃ¬ tÃ´i muá»‘n trÃ¬nh bÃ y lÃ  ba phÃ©p káº¿t ná»‘i phá»• biáº¿n: Merge Join, Hash Join vÃ  Nested Loop Join. NhÆ°ng trÆ°á»›c Ä‘Ã³, tÃ´i cáº§n pháº£i giá»›i thiá»‡u má»™t tá»« má»›i: quan há»‡ bÃªn trong vÃ  bÃªn ngoÃ i (inner relation and outer relation) cÃ³ thá»ƒ lÃ :</p><ul><li>Má»™t báº£ng</li><li>Má»™t chá»‰ má»¥c</li><li>Káº¿t quáº£ trung gian cá»§a phÃ©p tÃ­nh trÆ°á»›c Ä‘Ã³ (vÃ­ dá»¥: káº¿t quáº£ cá»§a cÃ¡c phÃ©p káº¿t ná»‘i trÆ°á»›c Ä‘Ã³)</li></ul><p>Khi báº¡n káº¿t ná»‘i hai quan há»‡, thuáº­t toÃ¡n káº¿t ná»‘i xá»­ lÃ½ hai quan há»‡ lÃ  khÃ¡c nhau. Trong pháº§n cÃ²n láº¡i cá»§a bÃ i viáº¿t nÃ y, tÃ´i sáº½ giáº£ Ä‘á»‹nh:</p><ul><li>Quan há»‡ bÃªn ngoÃ i lÃ  táº­p dá»¯ liá»‡u bÃªn trÃ¡i</li><li>Quan há»‡ bÃªn trong lÃ  táº­p dá»¯ liá»‡u bÃªn pháº£i</li></ul><p>VÃ­ dá»¥: A JOIN B lÃ  káº¿t ná»‘i giá»¯a A vÃ  B, á» Ä‘Ã¢y A lÃ  quan há»‡ bÃªn ngoÃ i vÃ  B lÃ  quan há»‡ bÃªn trong.</p><p>Trong háº§u háº¿t cÃ¡c trÆ°á»ng há»£p, <strong>chi phÃ­ cá»§a A JOIN B khÃ¡c vá»›i chi phÃ­ cá»§a B JOIN A</strong>.</p><p>Trong pháº§n nÃ y, tÃ´i cÅ©ng sáº½ giáº£ Ä‘á»‹nh ráº±ng quan há»‡ bÃªn ngoÃ i cÃ³ má»™t yáº¿u tá»‘ N vÃ  quan há»‡ bÃªn trong cÃ³ yáº¿u tá»‘ M. HÃ£y nhá»› ráº±ng trÃ¬nh tá»‘i Æ°u hÃ³a thá»±c sá»± biáº¿t giÃ¡ trá»‹ cá»§a N vÃ  M thÃ´ng qua thá»‘ng kÃª.</p><p>LÆ°u Ã½: N vÃ  M lÃ  lá»±c lÆ°á»£ng cá»§a quan há»‡.</p><h5 id="nested-loop-join" tabindex="-1"><a class="header-anchor" href="#nested-loop-join"><span>Nested Loop Join</span></a></h5><blockquote><p>Nested Loop Join lÃ  Ä‘Æ¡n giáº£n nháº¥t.</p></blockquote><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604200445.png" alt="Pasted image 20230604200445" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604200445</figcaption></figure><p>DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ lÃ½ do:</p><ul><li>Äá»‘i vá»›i má»—i dÃ²ng cá»§a quan há»‡ bÃªn ngoÃ i, xem táº¥t cáº£ cÃ¡c hÃ ng trong quan há»‡ bÃªn trong Ä‘á»ƒ tÃ¬m cÃ¡c hÃ ng phÃ¹ há»£p</li></ul><p>DÆ°á»›i Ä‘Ã¢y lÃ  mÃ£ giáº£:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nested_loop_join</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(array outer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> array inner)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">  for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> each row a in outer</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> each row b in inner</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">      if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">match_join_condition</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;">b))</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        write_result_in_output</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;">b)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">      end </span><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    end </span><span style="color:#C678DD;--shiki-dark:#C678DD;">for</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">   end </span><span style="color:#C678DD;--shiki-dark:#C678DD;">for</span></span></code></pre></div><p>VÃ¬ Ä‘Ã¢y lÃ  má»™t láº§n láº·p kÃ©p, <strong>Ä‘á»™ phá»©c táº¡p thá»i gian lÃ  <code>O(N*M)</code></strong>.</p><p>Vá» phÃ­a Disk I/O, vÃ²ng láº·p bÃªn trong yÃªu cáº§u Ä‘á»c M hÃ ng tá»« quan há»‡ bÃªn trong vá»›i má»—i hÃ ng trong N hÃ ng cá»§a quan há»‡ bÃªn ngoÃ i. Thuáº­t toÃ¡n nÃ y yÃªu cáº§u Ä‘á»c <code>N + N * M</code> hÃ ng tá»« disk. Tuy nhiÃªn, náº¿u quan há»‡ bÃªn trong Ä‘á»§ nhá» Ä‘á»ƒ báº¡n cÃ³ thá»ƒ Ä‘á»c nÃ³ vÃ o bá»™ nhá»›, chá»‰ cÃ³ <code>M + N</code> láº§n Ä‘á»c. Sau khi sá»­a Ä‘á»•i nhÆ° váº­y, quan há»‡ bÃªn trong pháº£i lÃ  tá»‘i thiá»ƒu vÃ¬ nÃ³ cÃ³ nhiá»u cÆ¡ há»™i hÆ¡n Ä‘á»ƒ náº¡p vÃ o bá»™ nhá»›.</p><p>KhÃ´ng cÃ³ sá»± khÃ¡c biá»‡t vá» chi phÃ­ CPU, nhÆ°ng vá» Disk I/O thÃ¬ tá»‘t nháº¥t lÃ  má»—i quan há»‡ chá»‰ Ä‘á»c má»™t láº§n.</p><p>Táº¥t nhiÃªn, quan há»‡ bÃªn trong cÃ³ thá»ƒ Ä‘Æ°á»£c thay tháº¿ báº±ng chá»‰ má»¥c vÃ  thuáº­n lá»£i hÆ¡n cho Disk I/O.</p><p>VÃ¬ thuáº­t toÃ¡n nÃ y ráº¥t Ä‘Æ¡n giáº£n, phiÃªn báº£n sau Ä‘Ã¢y cÃ³ lá»£i hÆ¡n cho Disk I/O khi quan há»‡ bÃªn trong quÃ¡ lá»›n Ä‘á»ƒ náº¡p vÃ o bá»™ nhá»›. DÆ°á»›i Ä‘Ã¢y lÃ  má»™t sá»‘ lÃ½ do:</p><ul><li>Äá»ƒ trÃ¡nh Ä‘á»c hai quan há»‡ tá»«ng dÃ²ng</li><li>Báº¡n cÃ³ thá»ƒ Ä‘á»c chÃºng, lÆ°u hai dÃ²ng dá»¯ liá»‡u (Ä‘Æ°á»£c Ä‘á»c trong hai quan há»‡) vÃ o bá»™ nhá»›,</li><li>So sÃ¡nh hai cá»¥m dá»¯ liá»‡u, giá»¯ láº¡i cÃ¡c cáº·p thoáº£ mÃ£n</li><li>Sau Ä‘Ã³ táº£i cÃ¡c cá»¥m dá»¯ liá»‡u má»›i tá»« Ä‘Ä©a Ä‘á»ƒ tiáº¿p tá»¥c so sÃ¡nh</li><li>Cho Ä‘áº¿n khi táº¥t cáº£ dá»¯ liá»‡u Ä‘Æ°á»£c náº¡p.</li></ul><p>Thuáº­t toÃ¡n cÃ³ thá»ƒ nhÆ° sau:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">// improved version to reduce the disk I/O.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nested_loop_join_v2</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(file outer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> file inner)</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">  for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> each bunch ba in outer</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">  // ba is now in memory</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> each bunch bb in inner</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // bb is now in memory</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> each row a in ba</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">          for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> each row b in bb</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">match_join_condition</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;">b))</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">              write_result_in_output</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(a</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;">b)</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            end </span><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">          end </span><span style="color:#C678DD;--shiki-dark:#C678DD;">for</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">       end </span><span style="color:#C678DD;--shiki-dark:#C678DD;">for</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    end </span><span style="color:#C678DD;--shiki-dark:#C678DD;">for</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">   end </span><span style="color:#C678DD;--shiki-dark:#C678DD;">for</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Vá»›i phiÃªn báº£n nÃ y, Ä‘á»™ phá»©c táº¡p thá»i gian khÃ´ng thay Ä‘á»•i, nhÆ°ng truy cáº­p disk giáº£m</strong>:</p><ul><li>Vá»›i phiÃªn báº£n trÆ°á»›c, thuáº­t toÃ¡n yÃªu cáº§u truy cáº­p <code>N + N * M</code> láº§n (má»™t dÃ²ng cho má»—i truy cáº­p).</li><li>Vá»›i phiÃªn báº£n má»›i, truy cáº­p Ä‘Ä©a trá»Ÿ thÃ nh sá»‘ lÆ°á»£ng cá»¥m dá»¯ liá»‡u quan há»‡ bÃªn ngoÃ i + sá»‘ lÆ°á»£ng cá»¥m dá»¯ liá»‡u quan há»‡ bÃªn ngoÃ i * Sá»‘ lÆ°á»£ng cá»¥m dá»¯ liá»‡u cho quan há»‡ bÃªn trong.</li><li>TÄƒng kÃ­ch thÆ°á»›c cá»§a cÃ¡c cá»¥m dá»¯ liá»‡u cÃ³ thá»ƒ lÃ m giáº£m truy cáº­p disk.</li></ul><h5 id="hash-join" tabindex="-1"><a class="header-anchor" href="#hash-join"><span>Hash Join</span></a></h5><p>Hash Join phá»©c táº¡p hÆ¡n, nhÆ°ng trong nhiá»u trÆ°á»ng há»£p, chi phÃ­ tháº¥p hÆ¡n so vá»›i Nested Loop Join.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604203453.png" alt="Pasted image 20230604203453" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604203453</figcaption></figure><p>NguyÃªn táº¯c cá»§a Hash Join lÃ :</p><ul><li>Äá»c táº¥t cáº£ cÃ¡c hÃ ng cá»§a quan há»‡ bÃªn trong</li><li>XÃ¢y dá»±ng má»™t báº£ng bÄƒm (hash table) trong bá»™ nhá»›</li><li>Äá»c tá»«ng hÃ ng cá»§a quan há»‡ bÃªn ngoÃ i + (sá»­ dá»¥ng hÃ m bÄƒm (hash function) cá»§a báº£ng bÄƒm (hash table)) Ä‘á»ƒ tÃ­nh toÃ¡n giÃ¡ trá»‹ bÄƒm (hash value) cá»§a má»—i hÃ ng Ä‘á»ƒ tÃ¬m bÃªn trong thÃ¹ng bÄƒm (hash bucket) cÃ³ liÃªn quan trong quan há»‡ bÃªn trong</li><li>XÃ¡c Ä‘á»‹nh cÃ³ khá»›p vá»›i cÃ¡c hÃ ng cá»§a quan há»‡ bÃªn ngoÃ i hay khÃ´ng?</li></ul><p>Vá» Ä‘á»™ phá»©c táº¡p cá»§a thá»i gian, tÃ´i cáº§n pháº£i Ä‘Æ°a ra má»™t sá»‘ giáº£ Ä‘á»‹nh Ä‘á»ƒ Ä‘Æ¡n giáº£n hÃ³a váº¥n Ä‘á»:</p><ul><li>quan há»‡ bÃªn trong Ä‘Æ°á»£c chia thÃ nh X thÃ¹ng bÄƒm</li><li>HÃ m bÄƒm phÃ¢n phá»‘i gáº§n nhÆ° Ä‘á»“ng Ä‘á»u giÃ¡ trá»‹ bÄƒm cá»§a dá»¯ liá»‡u trong má»—i quan há»‡, cÃ³ nghÄ©a lÃ  kÃ­ch thÆ°á»›c thÃ¹ng bÄƒm lÃ  nhÆ° nhau.</li><li>CÃ¡c yáº¿u tá»‘ cá»§a quan há»‡ bÃªn ngoÃ i phÃ¹ há»£p vá»›i táº¥t cáº£ cÃ¡c yáº¿u tá»‘ trong thÃ¹ng bÄƒm, vá»›i chi phÃ­ lÃ  sá»‘ lÆ°á»£ng cÃ¡c hÃ ng trong thÃ¹ng bÄƒm.</li></ul><p>Äá»™ phá»©c táº¡p thá»i gian lÃ  <code>(M/X) * N + chi phÃ­ táº¡o báº£ng bÄƒm (M) + chi phÃ­ hÃ m bÄƒm * N</code>. Náº¿u hÃ m bÄƒm táº¡o ra thÃ¹ng bÄƒm Ä‘á»§ nhá», Ä‘á»™ phá»©c táº¡p lÃ  <code>O(M+N)</code>.</p><p>NgoÃ i ra cÃ²n cÃ³ má»™t phiÃªn báº£n Hash Join, cÃ³ lá»£i cho bá»™ nhá»› nhÆ°ng khÃ´ng Ä‘á»§ tá»‘t cho disk I/O. Láº§n nÃ y nÃ³ trÃ´ng nhÆ° tháº¿ nÃ y:</p><ul><li>TÃ­nh toÃ¡n báº£ng bÄƒm cá»§a cáº£ hai quan há»‡ bÃªn trong vÃ  bÃªn ngoÃ i</li><li>LÆ°u báº£ng bÄƒm vÃ o disk</li><li>Sau Ä‘Ã³ so sÃ¡nh tá»«ng thÃ¹ng bÄƒm (má»™t trong sá»‘ Ä‘Ã³ Ä‘Æ°á»£c Ä‘á»c vÃ o bá»™ nhá»› vÃ  Ä‘á»c tá»«ng dÃ²ng khÃ¡c).</li></ul><h5 id="merge-join" tabindex="-1"><a class="header-anchor" href="#merge-join"><span>Merge Join</span></a></h5><blockquote><p>Merge Join lÃ  thuáº­t toÃ¡n liÃªn káº¿t duy nháº¥t táº¡o ra sáº¯p xáº¿p.</p></blockquote><p>LÆ°u Ã½: Merge Join Ä‘Æ¡n giáº£n nÃ y khÃ´ng phÃ¢n biá»‡t giá»¯a báº£ng bÃªn trong hoáº·c bá» ngoÃ i. Hai báº£ng Ä‘Ã³ng cÃ¹ng má»™t vai trÃ². NhÆ°ng thá»±c sá»± thá»±c hiá»‡n theo nhá»¯ng cÃ¡ch khÃ¡c nhau, cháº³ng háº¡n nhÆ° khi xá»­ lÃ½ cÃ¡c giÃ¡ trá»‹ trÃ¹ng láº·p.</p><ul><li><ol><li>(TÃ¹y chá»n) Hoáº¡t Ä‘á»™ng sáº¯p xáº¿p cÃ¡c káº¿t há»£p (join): cáº£ hai nguá»“n Ä‘áº§u vÃ o Ä‘Æ°á»£c sáº¯p xáº¿p theo tá»« khÃ³a Ä‘Æ°á»£c liÃªn káº¿t.</li></ol></li><li><ol start="2"><li>Hoáº¡t Ä‘á»™ng há»£p nháº¥t cÃ¡c káº¿t há»£p : cÃ¡c nguá»“n Ä‘áº§u vÃ o Ä‘Ã£ Ä‘Æ°á»£c sáº¯p xáº¿p Ä‘Æ°á»£c há»£p nháº¥t vá»›i nhau.</li></ol></li><li><p><strong>Sort</strong></p></li></ul><p>TÃ´i Ä‘Ã£ nÃ³i vá» [[Merge Sort]], lÃ  má»™t thuáº­t toÃ¡n sáº¯p xáº¿p tá»‘t (nhÆ°ng khÃ´ng pháº£i lÃ  tá»‘t nháº¥t, hoáº·c hash Join tá»‘t hÆ¡n náº¿u bá»™ nhá»› lÃ  Ä‘á»§).</p><p>Tuy nhiÃªn, Ä‘Ã´i khi táº­p dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c sáº¯p xáº¿p, cháº³ng háº¡n nhÆ°:</p><ul><li><p>Náº¿u bÃªn trong báº£ng cÃ³ thá»© tá»±, cháº³ng háº¡n nhÆ° má»™t báº£ng cÃ³ chá»‰ má»¥c trong Ä‘iá»u kiá»‡n ná»‘i (index-organized table)</p></li><li><p>Náº¿u quan há»‡ lÃ  má»™t chá»‰ má»¥c trong Ä‘iá»u kiá»‡n káº¿t ná»‘i</p></li><li><p>Náº¿u phÃ©p káº¿t ná»‘i Ã¡p dá»¥ng vá»›i káº¿t quáº£ trung gian mÃ  Ä‘Ã£ Ä‘Æ°á»£c sáº¯p xáº¿p trong má»™t truy váº¥n</p></li><li><p><strong>Merge Join</strong></p></li></ul><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604205032.png" alt="Pasted image 20230604205032" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604205032</figcaption></figure><p>Pháº§n nÃ y ráº¥t giá»‘ng vá»›i cÃ¡c hoáº¡t Ä‘á»™ng há»£p nháº¥t trong merge sort. NhÆ°ng láº§n nÃ y, tÃ´i khÃ´ng chá»n táº¥t cáº£ cÃ¡c yáº¿u tá»‘ tá»« hai quan há»‡, nhÆ°ng chá»‰ chá»n cÃ¹ng má»™t yáº¿u tá»‘. Sá»± tháº­t lÃ  nhÆ° sau:</p><ol><li>Trong hai quan há»‡, so sÃ¡nh cÃ¡c yáº¿u tá»‘ hiá»‡n táº¡i (hiá»‡n táº¡i = láº§n Ä‘áº§u tiÃªn xuáº¥t hiá»‡n)</li><li>Náº¿u giá»‘ng nhau, Ä‘Æ°a cáº£ hai yáº¿u tá»‘ vÃ o káº¿t quáº£ vÃ  so sÃ¡nh yáº¿u tá»‘ tiáº¿p theo trong cáº£ hai quan há»‡</li><li>Náº¿u khÃ¡c nhau, hÃ£y tÃ¬m yáº¿u tá»‘ tiáº¿p theo trong quan há»‡ vá»›i cÃ¡c yáº¿u tá»‘ nhá» nháº¥t (vÃ¬ yáº¿u tá»‘ tiáº¿p theo cÃ³ thá»ƒ phÃ¹ há»£p)</li><li>Láº·p láº¡i cÃ¡c bÆ°á»›c 1, 2, 3 cho Ä‘áº¿n khi yáº¿u tá»‘ cuá»‘i cÃ¹ng cá»§a má»™t trong cÃ¡c quan há»‡.</li></ol><p>Bá»Ÿi vÃ¬ cáº£ hai quan há»‡ Ä‘Ã£ Ä‘Æ°á»£c sáº¯p xáº¿p, báº¡n khÃ´ng cáº§n pháº£i &quot;nhÃ¬n láº¡i&quot;, vÃ¬ váº­y phÆ°Æ¡ng phÃ¡p nÃ y cÃ³ hiá»‡u quáº£.</p><p>ÄÃ¢y Ä‘Æ¡n giáº£n lÃ  kÄ© thuáº­t two pointer, duyá»‡t trÃªn hai máº£ng Ä‘Ã£ sáº¯p xáº¿p.</p><p>Thuáº­t toÃ¡n lÃ  má»™t phiÃªn báº£n Ä‘Æ¡n giáº£n vÃ¬ nÃ³ khÃ´ng xá»­ lÃ½ cÃ¡c tÃ¬nh huá»‘ng xáº£y dá»¯ liá»‡u trÃ¹ng (tá»©c lÃ  nhiá»u káº¿t há»£p) trÃªn cÃ¹ng máº£ng trong cáº£ hai máº£ng. PhiÃªn báº£n thá»±c táº¿ phá»©c táº¡p hÆ¡n, vÃ¬ váº­y tÃ´i Ä‘Ã£ chá»n phiÃªn báº£n Ä‘Æ¡n giáº£n hÃ³a.</p><p>Náº¿u cáº£ hai quan há»‡ Ä‘Ã£ Ä‘Æ°á»£c sáº¯p xáº¿p, Ä‘á»™ phá»©c táº¡p cá»§a thá»i gian lÃ  <code>O(N+M)</code></p><p>Náº¿u hai quan há»‡ cáº§n Ä‘Æ°á»£c sáº¯p xáº¿p, Ä‘á»™ phá»©c táº¡p thá»i gian lÃ  chi phÃ­ sáº¯p xáº¿p hai quan há»‡: <code>O(N*Log(N) + M*Log(M))</code></p><h5 id="thuat-toan-nao-la-tot-nhat" tabindex="-1"><a class="header-anchor" href="#thuat-toan-nao-la-tot-nhat"><span>Thuáº­t toÃ¡n nÃ o lÃ  tá»‘t nháº¥t?</span></a></h5><p>Náº¿u cÃ³ tá»‘t nháº¥t, khÃ´ng cáº§n pháº£i lÃ m cho nhiá»u loáº¡i nhÆ° váº­y. CÃ¢u há»i nÃ y lÃ  khÃ³, bá»Ÿi vÃ¬ nhiá»u yáº¿u tá»‘ cáº§n xem xÃ©t, cháº³ng háº¡n nhÆ°:</p><ul><li><strong>Bá»™ nhá»› nhÃ n rá»—i</strong>: Náº¿u báº¡n khÃ´ng cÃ³ Ä‘á»§ bá»™ nhá»›, hÃ£y chá»n Hash Join (Ã­t nháº¥t lÃ  hoÃ n toÃ n trong bá»™ nhá»›).</li><li><strong>KÃ­ch thÆ°á»›c cá»§a cáº£ hai táº­p dá»¯ liá»‡u</strong>. VÃ­ dá»¥, náº¿u má»™t báº£ng lá»›n ná»‘i má»™t báº£ng nhá», thÃ¬ Nested Loop Join nhanh hÆ¡n so vá»›i Hash Join, vÃ¬ sau nÃ y cÃ³ chi phÃ­ cao Ä‘á»ƒ táº¡o ra báº£ng bÄƒm; Náº¿u cáº£ hai báº£ng Ä‘á»u ráº¥t lá»›n, Nested Loop Join cÃ³ chi phÃ­ cpu ráº¥t cao.</li><li><strong>Náº¿u cÃ³ chá»‰ má»¥c</strong>: Náº¿u cÃ³ hai chá»‰ má»¥c B+ Tree, lá»±a chá»n thÃ´ng minh dÆ°á»ng nhÆ° lÃ  Merge Join.</li><li><strong>Káº¿t quáº£ cÃ³ cáº§n pháº£i Ä‘Æ°á»£c sáº¯p xáº¿p hay khÃ´ng?</strong>: Ngay cáº£ khi báº¡n Ä‘ang sá»­ dá»¥ng má»™t táº­p dá»¯ liá»‡u chÆ°a Ä‘Æ°á»£c sáº¯p xáº¿p, máº·c dÃ¹ cÃ³ chi phÃ­ cao hÆ¡n (vÃ¬ pháº£i sáº¯p xáº¿p) nhÆ°ng báº¡n cÃ³ thá»ƒ váº«n muá»‘n sá»­ dá»¥ng Merge Join náº¿u sau khi cÃ³ Ä‘Æ°á»£c káº¿t quáº£ Ä‘Æ°á»£c sáº¯p xáº¿p, báº¡n cÃ³ thá»ƒ liÃªn káº¿t nÃ³ vá»›i má»™t Merge Join khÃ¡c (hoáº·c cÃ³ thá»ƒ vÃ¬ truy váº¥n yÃªu cáº§u káº¿t quáº£ sáº¯p xáº¿p ngáº§m hoáº·c rÃµ rÃ ng vá»›i cÃ¡c thao tÃ¡c nhÆ° ORDER BY/GROUP BY/DISTINCT).</li><li><strong>Quan há»‡ Ä‘Ã£ Ä‘Æ°á»£c sáº¯p xáº¿p:</strong> Táº¡i thá»i Ä‘iá»ƒm nÃ y, Merge Join lÃ  lá»±a chá»n tá»‘t nháº¥t.</li><li><strong>Loáº¡i káº¿t ná»‘i</strong>: LÃ  káº¿t ná»‘i tÆ°Æ¡ng Ä‘Æ°Æ¡ng (vÃ­ dá»¥: tableA.col1 = tableB.col2)? Hoáº·c Inner Join? Outer Join? Cartesian Join? Hoáº·c Self Join? Má»™t sá»‘ káº¿t ná»‘i khÃ´ng hoáº¡t Ä‘á»™ng trong má»™t mÃ´i trÆ°á»ng cá»¥ thá»ƒ.</li><li><strong>PhÃ¢n phá»‘i dá»¯ liá»‡u</strong>: Náº¿u dá»¯ liá»‡u vá» Ä‘iá»u kiá»‡n káº¿t ná»‘i lÃ  lá»‡ch (vÃ­ dá»¥: Ä‘á»ƒ káº¿t ná»‘i ngÆ°á»i vá»›i há» (lastname), nhÆ°ng nhiá»u ngÆ°á»i cÃ³ cÃ¹ng há»), Hash Join sáº½ lÃ  má»™t tháº£m há»a vÃ¬ hÃ m bÄƒm sáº½ táº¡o ra thÃ¹ng bÄƒm phÃ¢n bá»‘ ráº¥t khÃ´ng Ä‘á»“ng Ä‘á»u.</li><li>Náº¿u báº¡n muá»‘n cÃ¡c hoáº¡t Ä‘á»™ng káº¿t ná»‘i sá»­ dá»¥ng <strong>Ä‘a luá»“ng hoáº·c Ä‘a tiáº¿n trÃ¬nh</strong>.</li></ul><p>Äá»ƒ biáº¿t thÃªm thÃ´ng tin, báº¡n cÃ³ thá»ƒ Ä‘á»c tÃ i liá»‡u cho DB2, ORACLE hoáº·c SQL Server.</p><h4 id="vi-du-Ä‘on-gian" tabindex="-1"><a class="header-anchor" href="#vi-du-Ä‘on-gian"><span>VÃ­ dá»¥ Ä‘Æ¡n giáº£n</span></a></h4><p>ChÃºng tÃ´i Ä‘Ã£ nghiÃªn cá»©u 3 loáº¡i phÃ©p káº¿t ná»‘i. BÃ¢y giá», vÃ­ dá»¥, chÃºng ta sáº½ káº¿t ná»‘i 5 báº£ng Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c táº¥t cáº£ thÃ´ng tin cá»§a má»™t ngÆ°á»i. Má»™t ngÆ°á»i cÃ³ thá»ƒ cÃ³:</p><ul><li>Nhiá»u sá»‘ Ä‘iá»‡n thoáº¡i di Ä‘á»™ng (MOBILES)</li><li>Nhiá»u há»™p thÆ° (MAILS)</li><li>Nhiá»u Ä‘á»‹a chá»‰ (ADRESSES)</li><li>Nhiá»u tÃ i khoáº£n ngÃ¢n hÃ ng (BANK_ACCOUNTS)</li></ul><p>NÃ³i cÃ¡ch khÃ¡c, chÃºng ta cáº§n pháº£i nhanh chÃ³ng nháº­n Ä‘Æ°á»£c cÃ¢u tráº£ lá»i vá»›i truy váº¥n sau:</p><div class="language-sql" data-ext="sql" data-title="sql"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">SELECT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> * </span><span style="color:#C678DD;--shiki-dark:#C678DD;">from</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> PERSON, MOBILES, MAILS, ADRESSES, BANK_ACCOUNTS</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">WHERE</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">PERSON_ID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> MOBILES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">PERSON_ID</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">AND</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">PERSON_ID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> MAILS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">PERSON_ID</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">AND</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">PERSON_ID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> ADRESSES</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">PERSON_ID</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">AND</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> PERSON</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">PERSON_ID</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> BANK_ACCOUNTS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#D19A66;--shiki-dark:#D19A66;">PERSON_ID</span></span></code></pre></div><p>LÃ  má»™t trÃ¬nh tá»‘i Æ°u hÃ³a truy váº¥n, tÃ´i pháº£i tÃ¬m cÃ¡ch tá»‘t nháº¥t Ä‘á»ƒ xá»­ lÃ½ dá»¯ liá»‡u. NhÆ°ng cÃ³ 2 cÃ¢u há»i:</p><ul><li>Loáº¡i nÃ o Ä‘Æ°á»£c sá»­ dá»¥ng cho má»—i káº¿t ná»‘i? <ul><li>TÃ´i cÃ³ 3 lá»±a chá»n (hash, merge, nested loop) vÃ  cÃ³ thá»ƒ sá»­ dá»¥ng 0, 1 hoáº·c 2 chá»‰ má»¥c cÃ¹ng lÃºc (khÃ´ng cáº§n pháº£i nÃ³i ráº±ng cÃ³ nhiá»u loáº¡i chá»‰ má»¥c).</li></ul></li><li>Káº¿t ná»‘i Ä‘Æ°á»£c thá»±c hiá»‡n theo thá»© tá»± nÃ o?</li></ul><p>VÃ­ dá»¥: hÃ¬nh áº£nh sau Ä‘Ã¢y cho tháº¥y káº¿ hoáº¡ch thá»±c thi cÃ³ thá»ƒ Ä‘Æ°á»£c sá»­ dá»¥ng cho 4 báº£ng chá»‰ 3 láº§n join:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604214715.png" alt="Pasted image 20230604214715" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604214715</figcaption></figure><p>CÃ¡c truy váº¥n trong thá»±c táº¿ cÅ©ng cÃ³ cÃ¡c toÃ¡n tá»­ quan há»‡ khÃ¡c, cháº³ng háº¡n nhÆ° OUTER JOIN, CROSS JOIN, GROUP BY, ORDER BY, PROJECTION, UNION, INTERSECT, DISTINCT â€¦ Äiá»u nÃ y cÃ³ nghÄ©a lÃ  nhiá»u kháº£ nÄƒng hÆ¡n.</p><p><strong>VÃ¬ váº­y, lÃ m tháº¿ nÃ o Ä‘á»ƒ cÆ¡ sá»Ÿ dá»¯ liá»‡u xá»­ lÃ½</strong>?</p><p><code>Dynamic Programing</code>, <code>Greedy</code> <code>Heuristic</code></p><h4 id="dynamic-programming-greedy-and-heuristic-algorithm" tabindex="-1"><a class="header-anchor" href="#dynamic-programming-greedy-and-heuristic-algorithm"><span>Dynamic Programming, Greedy, and Heuristic Algorithm</span></a></h4><p>CÆ¡ sá»Ÿ dá»¯ liá»‡u quan há»‡ sáº½ thá»­ má»™t sá»‘ phÆ°Æ¡ng phÃ¡p mÃ  tÃ´i vá»«a Ä‘á» cáº­p, <strong>vÃ  cÃ´ng viá»‡c thá»±c sá»± cá»§a trÃ¬nh tá»‘i Æ°u hÃ³a lÃ  tÃ¬m má»™t giáº£i phÃ¡p tá»‘t trong má»™t khoáº£ng thá»i gian giá»›i háº¡n</strong>.</p><p>Háº§u háº¿t thá»i gian, trÃ¬nh tá»‘i Æ°u hÃ³a khÃ´ng tÃ¬m tháº¥y giáº£i phÃ¡p tá»‘t nháº¥t, nhÆ°ng giáº£i phÃ¡p cÃ³ thá»ƒ xem lÃ  &quot;tá»‘t&quot; (Ä‘Æ°Æ¡ng nhiÃªn lÃ  cÅ©ng cÃ³ nhá»¯ng lÃºc tá»‘t trong ngoáº·c kÃ©p tháº­t)</p><ul><li><strong>Quy hoáº¡ch Ä‘á»™ng (Dynamic Programming)</strong></li></ul><blockquote><p>Äá»‘i vá»›i cÃ¡c truy váº¥n quy mÃ´ nhá», cÃ³ thá»ƒ Ã¡p dá»¥ng má»™t cÃ¡ch tiáº¿p cáº­n trÃ¢u (brute-force). NhÆ°ng Ä‘á»ƒ cÃ¡c truy váº¥n quy mÃ´ trung bÃ¬nh cÅ©ng cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c hiá»‡n má»™t cÃ¡ch tiáº¿p cáº­n trÃ¢u, chÃºng tÃ´i cÃ³ má»™t cÃ¡ch Ä‘á»ƒ trÃ¡nh cÃ¡c tÃ­nh toÃ¡n khÃ´ng cáº§n thiáº¿t, Ä‘Ã³ lÃ  quy hoáº¡ch Ä‘á»™ng.</p></blockquote><p>Ã tÆ°á»Ÿng Ä‘áº±ng sau nhá»¯ng tá»« nÃ y lÃ  nhiá»u káº¿ hoáº¡ch thá»±c hiá»‡n ráº¥t giá»‘ng nhau. HÃ£y xem cÃ¡c káº¿ hoáº¡ch dÆ°á»›i Ä‘Ã¢y:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604215931.png" alt="Pasted image 20230604215931" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604215931</figcaption></figure><p>Táº¥t cáº£ chÃºng Ä‘á»u cÃ³ cÃ¹ng má»™t cÃ¢y con (A JOIN B), vÃ¬ váº­y báº¡n khÃ´ng cáº§n pháº£i tÃ­nh toÃ¡n chi phÃ­ cá»§a cÃ¢y con nÃ y trong má»—i káº¿ hoáº¡ch, tÃ­nh toÃ¡n má»™t láº§n, lÆ°u káº¿t quáº£ vÃ  tÃ¡i sá»­ dá»¥ng khi gáº·p láº¡i cÃ¢y con nÃ y. Theo cÃ¡ch nÃ³i chÃ­nh thá»©c hÆ¡n, chÃºng ta Ä‘ang pháº£i Ä‘á»‘i máº·t vá»›i má»™t váº¥n Ä‘á» chá»“ng chÃ©o. Äá»ƒ trÃ¡nh tÃ­nh toÃ¡n trÃ¹ng láº·p má»™t sá»‘ káº¿t quáº£, chÃºng tÃ´i sá»­ dá»¥ng phÆ°Æ¡ng phÃ¡p ghi nhá»›.</p><p>Ãp dá»¥ng kÄ© thuáº­t nÃ y, chÃºng tÃ´i khÃ´ng cÃ²n Ä‘á»™ phá»©c táº¡p <code>(2*N)!/(N+1)!</code>, nhÆ°ng &quot;chá»‰&quot; <code>3^N</code>. Trong vÃ­ dá»¥ 4 JOIN trÃªn, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  giáº£m sá»‘ láº§n sáº¯p xáº¿p tá»« 336 xuá»‘ng cÃ²n 81 láº§n. Náº¿u Ä‘Ã³ lÃ  má»™t truy váº¥n lá»›n hÆ¡n, cháº³ng háº¡n nhÆ° 8 JOIN (thá»±c sá»± khÃ´ng pháº£i lÃ  ráº¥t lá»›n), giáº£m 57.657.600 xuá»‘ng cÃ²n 6.551.</p><p>Äá»‘i vá»›i cÃ¡c truy váº¥n quy mÃ´ lá»›n, báº¡n cÅ©ng cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c phÆ°Æ¡ng phÃ¡p quy hoáº¡ch Ä‘á»™ng, nhÆ°ng kÃ¨m vá»›i cÃ¡c quy táº¯c bá»• sung(hoáº·c thuáº­t toÃ¡n heuristics) Ä‘á»ƒ giáº£m kháº£ nÄƒng.</p><ul><li>Náº¿u chÃºng ta chá»‰ phÃ¢n tÃ­ch má»™t loáº¡i káº¿ hoáº¡ch cá»¥ thá»ƒ (vÃ­ dá»¥: cÃ¢y sÃ¢u bÃªn trÃ¡i left-deep tree), chÃºng ta sáº½ nháº­n Ä‘Æ°á»£c <code>n*2^n</code> thay vÃ¬ <code>3^n</code>.</li></ul><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604220538.png" alt="Pasted image 20230604220538" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604220538</figcaption></figure><ul><li><p>Náº¿u chÃºng ta thÃªm cÃ¡c quy táº¯c há»£p lÃ½ Ä‘á»ƒ trÃ¡nh káº¿ hoáº¡ch cho má»™t sá»‘ mÃ´ hÃ¬nh (vÃ­ dá»¥: &#39;náº¿u má»™t báº£ng cÃ³ chá»‰ má»¥c cho cÃ¡c vá»‹ ngá»¯ Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh, khÃ´ng cá»‘ gáº¯ng merge join vá»›i báº£ng, nhÆ°ng vá»›i chá»‰ má»¥c), chÃºng ta sáº½ giáº£m sá»‘ lÆ°á»£ng kháº£ nÄƒng mÃ  khÃ´ng gÃ¢y ra thiá»‡t háº¡i quÃ¡ má»©c cho ká»‹ch báº£n tá»‘t nháº¥t.</p></li><li><p>Náº¿u chÃºng ta thÃªm cÃ¡c quy táº¯c vÃ o quÃ¡ trÃ¬nh (cháº³ng háº¡n nhÆ° cÃ¡c hoáº¡t Ä‘á»™ng káº¿t ná»‘i trÆ°á»›c táº¥t cáº£ cÃ¡c tÃ­nh toÃ¡n quan há»‡ khÃ¡c), chÃºng ta cÅ©ng cÃ³ thá»ƒ giáº£m Ä‘Ã¡ng ká»ƒ kháº£ nÄƒng.</p></li><li><p>â€¦â€¦</p></li><li><p><strong>Thuáº­t toÃ¡n tham lam (Greed Alogrithm)</strong></p></li></ul><blockquote><p>Tuy nhiÃªn, trÃ¬nh tá»‘i Æ°u hÃ³a pháº£i Ä‘á»‘i máº·t vá»›i má»™t truy váº¥n ráº¥t lá»›n, hoáº·c Ä‘á»ƒ tÃ¬m cÃ¢u tráº£ lá»i cÃ ng sá»›m cÃ ng tá»‘t (tuy nhiÃªn tá»‘c Ä‘á»™ truy váº¥n khÃ´ng nhanh), má»™t thuáº­t toÃ¡n khÃ¡c, Ä‘Æ°á»£c gá»i lÃ  thuáº­t toÃ¡n tham lam.</p></blockquote><p>NguyÃªn táº¯c lÃ  láº­p káº¿ hoáº¡ch truy váº¥n theo má»™t quy táº¯c (hoáº·c heuristic) má»™t cÃ¡ch dáº§n dáº§n. Theo quy táº¯c nÃ y, cÃ¡c thuáº­t toÃ¡n tham lam dáº§n dáº§n tÃ¬m kiáº¿m cÃ¡c thuáº­t toÃ¡n tá»‘t nháº¥t, xá»­ lÃ½ má»™t JOIN Ä‘áº§u tiÃªn, sau Ä‘Ã³ thÃªm má»™t JOIN má»›i theo cÃ¹ng má»™t quy táº¯c cho má»—i bÆ°á»›c.</p><p>HÃ£y xem xÃ©t má»™t vÃ­ dá»¥ Ä‘Æ¡n giáº£n. VÃ­ dá»¥, má»™t truy váº¥n JOIN cho 5 báº£ng (A, B, C, D, E) 4 láº§n, Ä‘á»ƒ Ä‘Æ¡n giáº£n hÃ³a viá»‡c chÃºng tÃ´i sá»­ dá»¥ng JOIN lá»“ng nhau nhÆ° má»™t phÆ°Æ¡ng phÃ¡p káº¿t ná»‘i cÃ³ thá»ƒ, chÃºng tÃ´i lÃ m theo quy táº¯c &quot;sá»­ dá»¥ng káº¿t ná»‘i chi phÃ­ tháº¥p nháº¥t&quot;.</p><ul><li>Chá»n má»™t báº¯t Ä‘áº§u trá»±c tiáº¿p tá»« 5 báº£ng (vÃ­ dá»¥: A)</li><li>TÃ­nh toÃ¡n má»—i káº¿t ná»‘i vá»›i A (A lÃ  má»™t quan há»‡ bÃªn trong hoáº·c bÃªn ngoÃ i)</li><li>KhÃ¡m phÃ¡ &quot;A JOIN B&quot; cÃ³ chi phÃ­ tháº¥p nháº¥t</li><li>TÃ­nh toÃ¡n chi phÃ­ cá»§a má»—i káº¿t quáº£ Ä‘Æ°á»£c káº¿t ná»‘i vá»›i <code>A JOIN B</code> (<code>A JOIN B</code> lÃ  quan há»‡ bÃªn trong hoáº·c bÃªn ngoÃ i)</li><li>KhÃ¡m phÃ¡ <code>(A JOIN B) JOIN C</code> cÃ³ chi phÃ­ tháº¥p nháº¥t</li><li>TÃ­nh toÃ¡n chi phÃ­ cá»§a má»—i káº¿t quáº£ Ä‘Æ°á»£c káº¿t há»£p vá»›i <code>(A JOIN B) JOIN C</code>.</li><li>â€¦â€¦</li><li>HoÃ n thiá»‡n káº¿ hoáº¡ch thá»±c hiá»‡n <code>((A JOIN B) JOIN C) JOIN D ) JOIN E)</code></li></ul><p>Bá»Ÿi vÃ¬ chÃºng tÃ´i báº¯t Ä‘áº§u má»™t cÃ¡ch tÃ¹y tiá»‡n vá»›i báº£ng A, chÃºng ta cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¹ng má»™t thuáº­t toÃ¡n trong B, sau Ä‘Ã³ C, sau Ä‘Ã³ D, sau Ä‘Ã³ E. Cuá»‘i cÃ¹ng giá»¯ láº¡i káº¿ hoáº¡ch thá»±c hiá»‡n vá»›i chi phÃ­ tháº¥p nháº¥t.</p><p>NhÃ¢n tiá»‡n, thuáº­t toÃ¡n nÃ y cÃ³ má»™t cÃ¡i tÃªn, Ä‘Æ°á»£c gá»i lÃ  &quot;Nearest Neighbor Algorithm&quot;.</p><p>Bá» qua cÃ¡c chi tiáº¿t, chá»‰ cáº§n má»™t mÃ´ hÃ¬nh tá»‘t vÃ  sáº¯p xáº¿p Ä‘á»™ phá»©c táº¡p <code>Nlog(N)</code>, váº¥n Ä‘á» cÃ³ thá»ƒ dá»… dÃ ng Ä‘Æ°á»£c giáº£i quyáº¿t. Äá»™ phá»©c táº¡p cá»§a thuáº­t toÃ¡n nÃ y lÃ  <code>O(Nlog(N)</code>, so sÃ¡nh vá»›i <code>O(3^N)</code> cá»§a dynamic programming. Náº¿u báº¡n cÃ³ má»™t truy váº¥n lá»›n 20 JOIN, Ä‘iá»u nÃ y cÃ³ nghÄ©a lÃ  26 vs 3,486,784,401, má»™t sá»± khÃ¡c biá»‡t lá»›n!</p><p>Váº¥n Ä‘á» vá»›i thuáº­t toÃ¡n nÃ y lÃ  giáº£ Ä‘á»‹nh chÃºng tÃ´i thá»±c hiá»‡n lÃ  tÃ¬m cÃ¡ch tá»‘t nháº¥t Ä‘á»ƒ káº¿t ná»‘i 2 báº£ng, giá»¯ láº¡i káº¿t quáº£ káº¿t ná»‘i nÃ y vÃ  káº¿t ná»‘i báº£ng tiáº¿p theo Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c chi phÃ­ tháº¥p nháº¥t. Tuy nhiÃªn:</p><ul><li>Ngay cáº£ giá»¯a A, B, C, <code>A JOIN B</code> cÃ³ giÃ¡ tháº¥p nháº¥t</li><li><code>(A JOIN C) JOIN B</code> cÃ³ thá»ƒ tá»‘t hÆ¡n so vá»›i <code>(A JOIN B) JOIN C</code>.</li></ul><p>Äá»ƒ cáº£i thiá»‡n tÃ¬nh tráº¡ng nÃ y, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng cÃ¡c thuáº­t toÃ¡n tham lam dá»±a trÃªn cÃ¡c quy táº¯c khÃ¡c nhau nhiá»u láº§n vÃ  giá»¯ láº¡i káº¿ hoáº¡ch thá»±c hiá»‡n tá»‘t nháº¥t.</p><h4 id="bo-nho-cache-ke-hoach-truy-van-query-plan-cache" tabindex="-1"><a class="header-anchor" href="#bo-nho-cache-ke-hoach-truy-van-query-plan-cache"><span>Bá»™ nhá»› cache káº¿ hoáº¡ch truy váº¥n (Query Plan Cache)</span></a></h4><p>VÃ¬ viá»‡c táº¡o káº¿ hoáº¡ch truy váº¥n tá»‘n thá»i gian, háº§u háº¿t cÃ¡c cÆ¡ sá»Ÿ dá»¯ liá»‡u lÆ°u káº¿ hoáº¡ch trong bá»™ nhá»› <code>query plan cache</code> Ä‘á»ƒ trÃ¡nh tÃ­nh toÃ¡n trÃ¹ng láº·p. Chá»§ Ä‘á» nÃ y lÃ  lá»›n hÆ¡n bá»Ÿi vÃ¬ cÆ¡ sá»Ÿ dá»¯ liá»‡u cáº§n pháº£i biáº¿t khi nÃ o Ä‘á»ƒ cáº­p nháº­t cÃ¡c káº¿ hoáº¡ch lá»—i thá»i. CÃ¡ch tiáº¿p cáº­n lÃ  Ä‘áº·t giá»›i háº¡n trÃªn vÃ  náº¿u má»™t báº£ng thay Ä‘á»•i thá»‘ng kÃª vÆ°á»£t quÃ¡ giá»›i háº¡n trÃªn, káº¿ hoáº¡ch truy váº¥n vá» báº£ng sáº½ bá»‹ xÃ³a khá»i bá»™ nhá»› cache.</p><h3 id="trinh-thuc-thi-truy-van-query-excuter" tabindex="-1"><a class="header-anchor" href="#trinh-thuc-thi-truy-van-query-excuter"><span>TrÃ¬nh thá»±c thi truy váº¥n (Query Excuter)</span></a></h3><p>á» giai Ä‘oáº¡n nÃ y, chÃºng tÃ´i cÃ³ má»™t káº¿ hoáº¡ch thá»±c hiá»‡n Ä‘Æ°á»£c tá»‘i Æ°u hÃ³a vÃ  biÃªn dá»‹ch thÃ nh mÃ£ thá»±c thi. Sau Ä‘Ã³, náº¿u cÃ³ Ä‘á»§ tÃ i nguyÃªn (bá»™ nhá»›, CPU), trÃ¬nh thá»±c thi truy váº¥n sáº½ thá»±c thi nÃ³. CÃ¡c toÃ¡n tá»­ (JOIN, SORT BY â€¦) trong káº¿ hoáº¡ch cÃ³ thá»ƒ Ä‘Æ°á»£c thá»±c hiá»‡n theo thá»© tá»± hoáº·c song song, tÃ¹y thuá»™c vÃ o trÃ¬nh thá»±c thi. Äá»ƒ láº¥y vÃ  ghi dá»¯ liá»‡u, trÃ¬nh thá»±c thi truy váº¥n tÆ°Æ¡ng tÃ¡c vá»›i trÃ¬nh quáº£n lÃ½ dá»¯ liá»‡u, pháº§n tiáº¿p theo cá»§a bÃ i viáº¿t nÃ y tháº£o luáº­n vá» trÃ¬nh quáº£n lÃ½ dá»¯ liá»‡u.</p><h2 id="trinh-quan-ly-du-lieu" tabindex="-1"><a class="header-anchor" href="#trinh-quan-ly-du-lieu"><span>TrÃ¬nh quáº£n lÃ½ dá»¯ liá»‡u</span></a></h2><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604232022.png" alt="Pasted image 20230604232022" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604232022</figcaption></figure><p>á» bÆ°á»›c nÃ y, trÃ¬nh quáº£n lÃ½ truy váº¥n thá»±c hiá»‡n truy váº¥n vÃ  yÃªu cáº§u dá»¯ liá»‡u tá»« báº£ng vÃ  chá»‰ má»¥c. NhÆ°ng cÃ³ 2 cÃ¢u há»i:</p><ul><li>CÆ¡ sá»Ÿ dá»¯ liá»‡u quan há»‡ sá»­ dá»¥ng mÃ´ hÃ¬nh giao dá»‹ch, vÃ¬ váº­y báº¡n khÃ´ng thá»ƒ cÃ³ Ä‘Æ°á»£c pháº§n dá»¯ liá»‡u nÃ y khi ngÆ°á»i khÃ¡c sá»­ dá»¥ng hoáº·c sá»­a Ä‘á»•i dá»¯ liá»‡u cÃ¹ng má»™t lÃºc.</li><li>TrÃ­ch xuáº¥t dá»¯ liá»‡u lÃ  hoáº¡t Ä‘á»™ng cháº­m nháº¥t trong cÆ¡ sá»Ÿ dá»¯ liá»‡u, vÃ¬ váº­y trÃ¬nh quáº£n lÃ½ dá»¯ liá»‡u cáº§n pháº£i Ä‘á»§ thÃ´ng minh Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c dá»¯ liá»‡u vÃ  lÆ°u nÃ³ trong bá»™ Ä‘á»‡m bá»™ nhá»›.</li></ul><p>Trong pháº§n nÃ y, chÃºng ta hÃ£y xem lÃ m tháº¿ nÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u quan há»‡ xá»­ lÃ½ cáº£ hai váº¥n Ä‘á».</p><h3 id="trinh-quan-ly-bo-nho-cache-cache-manager" tabindex="-1"><a class="header-anchor" href="#trinh-quan-ly-bo-nho-cache-cache-manager"><span>TrÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache (Cache Manager)</span></a></h3><blockquote><p>NhÆ° Ä‘Ã£ Ä‘á» cáº­p trÆ°á»›c Ä‘Ã³, nÃºt tháº¯t chai chÃ­nh cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u lÃ  Disk I/O. Äá»ƒ cáº£i thiá»‡n hiá»‡u suáº¥t, cÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n Ä‘áº¡i sá»­ dá»¥ng trÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache.</p></blockquote><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604232659.png" alt="Pasted image 20230604232659" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604232659</figcaption></figure><p>TrÃ¬nh thá»±c thi truy váº¥n khÃ´ng láº¥y dá»¯ liá»‡u trá»±c tiáº¿p tá»« há»‡ thá»‘ng tá»‡p, nhÆ°ng tá»« trÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache. TrÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache cÃ³ má»™t khu vá»±c bá»™ nhá»› cache Ä‘Æ°á»£c gá»i lÃ  vÃ¹ng Ä‘á»‡m (buffer pool), Ä‘á»c dá»¯ liá»‡u tá»« bá»™ nhá»› cÃ³ thá»ƒ cáº£i thiá»‡n Ä‘Ã¡ng ká»ƒ hiá»‡u suáº¥t cÆ¡ sá»Ÿ dá»¯ liá»‡u. Tháº­t khÃ³ Ä‘á»ƒ Ä‘Æ°a ra má»™t má»©c Ä‘á»™ Ä‘á»‹nh lÆ°á»£ng cho Ä‘iá»u nÃ y, bá»Ÿi vÃ¬ nÃ³ phá»¥ thuá»™c vÃ o nhá»¯ng gÃ¬ báº¡n cáº§n:</p><ul><li>Truy cáº­p tuáº§n tá»± (vÃ­ dá»¥: quÃ©t Ä‘áº§y Ä‘á»§) vs truy cáº­p ngáº«u nhiÃªn (vÃ­ dá»¥: truy cáº­p theo row id)</li><li>Äá»c hay ghi</li></ul><p>VÃ  loáº¡i disk Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi cÆ¡ sá»Ÿ dá»¯ liá»‡u:</p><ul><li>7.2k/10k/15k rpm hard drive</li><li>SSD</li><li>RAID 1/5/â€¦</li></ul><p>Äá»ƒ tÃ´i nÃ³i, bá»™ nhá»› nhanh hÆ¡n 100 Ä‘áº¿n 100.000 láº§n so vá»›i disk. Tuy nhiÃªn, Ä‘iá»u nÃ y dáº«n Ä‘áº¿n má»™t váº¥n Ä‘á» khÃ¡c (cÆ¡ sá»Ÿ dá»¯ liá»‡u luÃ´n luÃ´n nhÆ° váº­y â€¦), trÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache cáº§n pháº£i cÃ³ Ä‘Æ°á»£c dá»¯ liá»‡u trÆ°á»›c khi TrÃ¬nh thá»±c thi truy váº¥n sá»­ dá»¥ng dá»¯ liá»‡u, náº¿u khÃ´ng trÃ¬nh quáº£n lÃ½ truy váº¥n sáº½ pháº£i chá» Ä‘á»£i vÃ¬ Ä‘á»c dá»¯ liá»‡u tá»« disk cháº­m.</p><h4 id="Ä‘oc-truoc-pre-reading" tabindex="-1"><a class="header-anchor" href="#Ä‘oc-truoc-pre-reading"><span>Äá»c trÆ°á»›c (Pre-Reading)</span></a></h4><p>Váº¥n Ä‘á» nÃ y Ä‘Æ°á»£c gá»i <strong>Ä‘á»c trÆ°á»›c (pre-reading)</strong>. TrÃ¬nh thá»±c thi truy váº¥n biáº¿t dá»¯ liá»‡u nÃ o nÃ³ sáº½ cáº§n vÃ¬ nÃ³ hiá»ƒu toÃ n bá»™ luá»“ng truy váº¥n vÃ  dá»¯ liá»‡u trÃªn disk thÃ´ng qua thá»‘ng kÃª. QuÃ¡ trÃ¬nh nÃ y trÃ´ng nhÆ° tháº¿ nÃ y:</p><ul><li>Khi TrÃ¬nh thá»±c thi truy váº¥n xá»­ lÃ½ lÃ´ dá»¯ liá»‡u Ä‘áº§u tiÃªn cá»§a nÃ³, trÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache Ä‘Æ°á»£c yÃªu cáº§u táº£i trÆ°á»›c lÃ´ dá»¯ liá»‡u thá»© hai</li><li>Khi báº¡n báº¯t Ä‘áº§u xá»­ lÃ½ lÃ´ dá»¯ liá»‡u thá»© hai, hÃ£y nÃ³i vá»›i trÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache Ä‘á»ƒ táº£i trÆ°á»›c lÃ´ dá»¯ liá»‡u thá»© ba vÃ  nÃ³i vá»›i trÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache ráº±ng lÃ´ Ä‘áº§u tiÃªn cÃ³ thá»ƒ Ä‘Æ°á»£c xÃ³a khá»i bá»™ nhá»› cache.</li><li>â€¦â€¦</li></ul><p>TrÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache lÆ°u táº¥t cáº£ dá»¯ liá»‡u nÃ y trong vÃ¹ng Ä‘á»‡m. Äá»ƒ xÃ¡c Ä‘á»‹nh xem má»™t dá»¯ liá»‡u cÃ³ há»¯u Ã­ch hay khÃ´ng, trÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache Ä‘Ã£ thÃªm thÃ´ng tin bá»• sung (Ä‘Æ°á»£c gá»i lÃ  chá»‘t (latch)) vÃ o dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trong bá»™ nhá»› cache.</p><p>ÄÃ´i khi TrÃ¬nh thá»±c thi truy váº¥n khÃ´ng biáº¿t nhá»¯ng gÃ¬ vá» dá»¯ liá»‡u nÃ³ cáº§n vÃ  má»™t sá»‘ cÆ¡ sá»Ÿ dá»¯ liá»‡u khÃ´ng cung cáº¥p chá»©c nÄƒng nÃ y. Thay vÃ o Ä‘Ã³, há» sá»­ dá»¥ng má»™t phÆ°Æ¡ng phÃ¡p Ä‘á»c trÆ°á»›c suy Ä‘oÃ¡n (vÃ­ dá»¥: náº¿u TrÃ¬nh thá»±c thi truy váº¥n muá»‘n dá»¯ liá»‡u 1, 3, 5, nÃ³ cÃ³ thá»ƒ sáº½ Ä‘á»c trÆ°á»›c 7, 9, 11) hoáº·c Ä‘á»c trÆ°á»›c tuáº§n tá»± (táº¡i thá»i Ä‘iá»ƒm nÃ y trÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache chá»‰ Ä‘Æ¡n giáº£n lÃ  táº£i dá»¯ liá»‡u liÃªn tá»¥c tiáº¿p theo tá»« Ä‘Ä©a sau khi Ä‘á»c má»™t loáº¡t dá»¯ liá»‡u).</p><p>Äá»ƒ theo dÃµi tÃ¬nh tráº¡ng hoáº¡t Ä‘á»™ng Ä‘á»c trÆ°á»›c, cÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n Ä‘áº¡i giá»›i thiá»‡u má»™t thÆ°á»›c Ä‘o Ä‘Æ°á»£c gá»i lÃ  <strong>(bá»™ Ä‘á»‡m / bá»™ nhá»› cache)</strong> hay <strong>(buffer / cache)</strong> Ä‘á»ƒ hiá»ƒn thá»‹ táº§n suáº¥t dá»¯ liá»‡u Ä‘Æ°á»£c yÃªu cáº§u Ä‘Æ°á»£c tÃ¬m tháº¥y trong bá»™ nhá»› cache thay vÃ¬ Ä‘á»c tá»« disk.</p><p>LÆ°u Ã½: Tá»· lá»‡ trÃºng bá»™ nhá»› cache (cache hit ratio) kÃ©m khÃ´ng pháº£i lÃºc nÃ o cÅ©ng cÃ³ nghÄ©a lÃ  bá»™ nhá»› cache hoáº¡t Ä‘á»™ng kÃ©m.</p><p>Bá»™ Ä‘á»‡m chá»‰ lÃ  dung lÆ°á»£ng háº¡n cháº¿ cá»§a bá»™ nhá»›, vÃ¬ váº­y Ä‘á»ƒ táº£i dá»¯ liá»‡u má»›i khi Ä‘Ã£ Ä‘áº§y, nÃ³ cáº§n pháº£i loáº¡i bá» má»™t sá»‘ dá»¯ liá»‡u. Táº£i vÃ  xÃ³a bá»™ nhá»› cache Ä‘Ã²i há»i má»™t sá»‘ chi phÃ­ disk vÃ  network I/O. Náº¿u báº¡n cÃ³ má»™t truy váº¥n Ä‘Æ°á»£c thá»±c hiá»‡n thÆ°á»ng xuyÃªn, sau Ä‘Ã³ táº£i káº¿t quáº£ truy váº¥n má»—i láº§n vÃ  xÃ³a nÃ³, hiá»‡u quáº£ lÃ  quÃ¡ tháº¥p. CÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n Ä‘áº¡i giáº£i quyáº¿t váº¥n Ä‘á» nÃ y vá»›i chÃ­nh sÃ¡ch thay tháº¿ bá»™ Ä‘á»‡m.</p><h4 id="chinh-sach-thay-the-bo-Ä‘em" tabindex="-1"><a class="header-anchor" href="#chinh-sach-thay-the-bo-Ä‘em"><span>ChÃ­nh sÃ¡ch thay tháº¿ bá»™ Ä‘á»‡m</span></a></h4><blockquote><p>Háº§u háº¿t cÃ¡c cÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n Ä‘áº¡i (Ã­t nháº¥t lÃ  SQL Server, MySQL, Oracle vÃ  DB2) sá»­ dá»¥ng thuáº­t toÃ¡n LRU.</p></blockquote><h5 id="lru" tabindex="-1"><a class="header-anchor" href="#lru"><span>LRU</span></a></h5><p>LRU (Least Recently Used) : bá» Ä‘i pháº§n tá»­ Ã­t Ä‘Æ°á»£c sá»­ dá»¥ng gáº§n Ä‘Ã¢y nháº¥t. NguyÃªn táº¯c Ä‘áº±ng sau nÃ³: dá»¯ liá»‡u Ä‘Æ°á»£c giá»¯ láº¡i trong bá»™ nhá»› cache Ä‘Æ°á»£c sá»­ dá»¥ng gáº§n Ä‘Ã¢y nháº¥t, cÃ³ nhiá»u kháº£ nÄƒng sáº½ Ä‘Æ°á»£c tÃ¡i sá»­ dá»¥ng.</p><p>HÃ¬nh minh há»a:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230604234649.png" alt="Pasted image 20230604234649" tabindex="0" loading="lazy"><figcaption>Pasted image 20230604234649</figcaption></figure><p>Äá»ƒ hiá»ƒu rÃµ hÆ¡n, tÃ´i giáº£ Ä‘á»‹nh ráº±ng dá»¯ liá»‡u trong bá»™ Ä‘á»‡m khÃ´ng bá»‹ khÃ³a bá»Ÿi chá»‘t (cÃ³ nghÄ©a lÃ  nÃ³ cÃ³ nghÄ©a lÃ  nÃ³ cÃ³ thá»ƒ Ä‘Æ°á»£c gá»¡ bá»). Trong vÃ­ dá»¥ Ä‘Æ¡n giáº£n nÃ y, bá»™ Ä‘á»‡m cÃ³ thá»ƒ lÆ°u 3 thÃ nh viÃªn:</p><ul><li>1: TrÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache (CM) sá»­ dá»¥ng dá»¯ liá»‡u 1 vÃ  Ä‘áº·t nÃ³ vÃ o bá»™ Ä‘á»‡m trá»‘ng</li><li>2: CM sá»­ dá»¥ng dá»¯ liá»‡u 4 vÃ  Ä‘áº·t nÃ³ vÃ o bá»™ Ä‘á»‡m</li><li>3: CM sá»­ dá»¥ng dá»¯ liá»‡u 3 vÃ  Ä‘áº·t nÃ³ vÃ o bá»™ Ä‘á»‡m</li><li>4: CM sá»­ dá»¥ng dá»¯ liá»‡u 9, bá»™ Ä‘á»‡m Ä‘Ã£ Ä‘áº§y, vÃ¬ váº­y dá»¯ liá»‡u 1 Ä‘Ã£ bá»‹ xÃ³a vÃ¬ lÃ  láº§n cuá»‘i cÃ¹ng nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng gáº§n Ä‘Ã¢y lÃ  xa nháº¥t vÃ  dá»¯ liá»‡u 9 Ä‘Æ°á»£c thÃªm vÃ o bá»™ Ä‘á»‡m</li><li>5: CM sá»­ dá»¥ng dá»¯ liá»‡u 4, dá»¯ liá»‡u 4 Ä‘Ã£ á»Ÿ trong bá»™ Ä‘á»‡m, vÃ¬ váº­y nÃ³ má»™t láº§n ná»¯a trá»Ÿ thÃ nh pháº§n tá»­ Ä‘Æ°á»£c sá»­ dá»¥ng gáº§n Ä‘Ã¢y.</li><li>6: CM sá»­ dá»¥ng dá»¯ liá»‡u 1, bá»™ Ä‘á»‡m Ä‘áº§y Ä‘á»§, vÃ¬ váº­y dá»¯ liá»‡u 9 Ä‘Ã£ bá»‹ xÃ³a vÃ¬ lÃ  láº§n gáº§n Ä‘Ã¢y nháº¥t nÃ³ Ä‘Æ°á»£c sá»­ dá»¥ng lÃ  xa nháº¥t vÃ  dá»¯ liá»‡u 1 Ä‘Æ°á»£c thÃªm vÃ o bá»™ Ä‘á»‡m</li><li>â€¦â€¦</li></ul><p>Thuáº­t toÃ¡n nÃ y hoáº¡t Ä‘á»™ng tá»‘t, nhÆ°ng cÃ³ má»™t sá»‘ háº¡n cháº¿. <strong>Äiá»u gÃ¬ sáº½ xáº£y ra náº¿u báº¡n thá»±c hiá»‡n quÃ©t toÃ n bá»™ trÃªn má»™t báº£ng lá»›n</strong>? NÃ³i cÃ¡ch khÃ¡c, Ä‘iá»u gÃ¬ sáº½ xáº£y ra khi kÃ­ch thÆ°á»›c cá»§a báº£ng/chá»‰ má»¥c vÆ°á»£t quÃ¡ bá»™ Ä‘á»‡m? Sá»­ dá»¥ng thuáº­t toÃ¡n nÃ y sáº½ xÃ³a táº¥t cáº£ dá»¯ liá»‡u trong bá»™ nhá»› cache trÆ°á»›c Ä‘Ã³ vÃ  dá»¯ liá»‡u Ä‘Æ°á»£c quÃ©t Ä‘áº§y Ä‘á»§ cÃ³ kháº£ nÄƒng chá»‰ Ä‘Æ°á»£c sá»­ dá»¥ng má»™t láº§n.</p><h5 id="cai-thien" tabindex="-1"><a class="header-anchor" href="#cai-thien"><span>Cáº£i thiá»‡n</span></a></h5><p>Äá»ƒ ngÄƒn cháº·n hiá»‡n tÆ°á»£ng nÃ y, má»™t sá»‘ cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘Ã£ thÃªm cÃ¡c quy táº¯c Ä‘áº·c biá»‡t, cháº³ng háº¡n nhÆ° mÃ´ táº£ trong tÃ i liá»‡u Oracle:</p><blockquote><p>ã€ Äá»‘i vá»›i cÃ¡c báº£ng ráº¥t lá»›n, cÆ¡ sá»Ÿ dá»¯ liá»‡u thÆ°á»ng sá»­ dá»¥ng Ä‘Æ°á»ng dáº«n trá»±c tiáº¿p Ä‘á»ƒ Ä‘á»c, tá»©c lÃ  táº£i trá»±c tiáº¿p cÃ¡c khá»‘i [â€¦] Ä‘á»ƒ trÃ¡nh láº¥p Ä‘áº§y bá»™ Ä‘á»‡m. Äá»‘i vá»›i cÃ¡c báº£ng cÃ³ kÃ­ch thÆ°á»›c trung bÃ¬nh, cÆ¡ sá»Ÿ dá»¯ liá»‡u cÃ³ thá»ƒ Ä‘Æ°á»£c Ä‘á»c trá»±c tiáº¿p hoáº·c cache dá»¯ liá»‡u Ä‘Ã£ Ä‘á»c. Náº¿u báº¡n chá»n Ä‘á»c bá»™ nhá»› cache, cÆ¡ sá»Ÿ dá»¯ liá»‡u Ä‘áº·t khá»‘i á»Ÿ Ä‘uÃ´i LRU Ä‘á»ƒ ngÄƒn cháº·n bá»™ Ä‘á»‡m hiá»‡n táº¡i bá»‹ xÃ³a.ã€</p></blockquote><p>NgoÃ i ra cÃ²n cÃ³ má»™t sá»‘ kháº£ nÄƒng, cháº³ng háº¡n nhÆ° sá»­ dá»¥ng phiÃªn báº£n cao cáº¥p cá»§a LRU, Ä‘Æ°á»£c gá»i lÃ  LRU-K. VÃ­ dá»¥, SQL Server sá»­ dá»¥ng LRU-2ã€‚</p><p>NguyÃªn táº¯c cá»§a thuáº­t toÃ¡n nÃ y lÃ  xem xÃ©t nhiá»u lá»‹ch sá»­ hÆ¡n. LRU Ä‘Æ¡n giáº£n (tá»©c lÃ  LRU-1) chá»‰ xem xÃ©t dá»¯ liá»‡u Ä‘Æ°á»£c sá»­ dá»¥ng láº§n cuá»‘i. CÃ²n LRU-K:</p><ul><li>HÃ£y xem xÃ©t dá»¯ liá»‡u Ä‘Æ°á»£c sá»­ dá»¥ng K láº§n cuá»‘i cÃ¹ng</li><li>Sá»‘ láº§n dá»¯ liá»‡u Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘Æ°á»£c thÃªm vÃ o trá»ng lÆ°á»£ng</li><li>Má»™t loáº¡t dá»¯ liá»‡u má»›i Ä‘Æ°á»£c táº£i vÃ o bá»™ nhá»› cache vÃ  dá»¯ liá»‡u cÅ© nhÆ°ng thÆ°á»ng Ä‘Æ°á»£c sá»­ dá»¥ng sáº½ khÃ´ng bá»‹ xÃ³a (vÃ¬ trá»ng lÆ°á»£ng cao hÆ¡n)</li><li>Tuy nhiÃªn, thuáº­t toÃ¡n nÃ y khÃ´ng giá»¯ láº¡i dá»¯ liá»‡u khÃ´ng cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng trong bá»™ nhá»› cache</li><li>VÃ¬ váº­y, náº¿u dá»¯ liá»‡u khÃ´ng cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng, giÃ¡ trá»‹ trá»ng lÆ°á»£ng giáº£m theo thá»i gian</li></ul><p>TÃ­nh toÃ¡n trá»ng lÆ°á»£ng lÃ  tá»‘n kÃ©m, vÃ¬ váº­y SQL Server chá»‰ sá»­ dá»¥ng K = 2, hiá»‡u suáº¥t giÃ¡ trá»‹ tá»‘t vÃ  chi phÃ­ bá»• sung Ä‘Æ°á»£c cháº¥p nháº­n.</p><h5 id="cac-thuat-toan-khac" tabindex="-1"><a class="header-anchor" href="#cac-thuat-toan-khac"><span>CÃ¡c thuáº­t toÃ¡n khÃ¡c</span></a></h5><p>Táº¥t nhiÃªn cÃ³ cÃ¡c thuáº­t toÃ¡n khÃ¡c Ä‘á»ƒ quáº£n lÃ½ bá»™ nhá»› cache, cháº³ng háº¡n nhÆ°:</p><ul><li>2Q (giá»‘ng thuáº­t toÃ¡n LRU-K)</li><li>CLOCK (giá»‘ng thuáº­t toÃ¡n LRU-K)</li><li>MRU (thuáº­t toÃ¡n má»›i nháº¥t Ä‘Æ°á»£c sá»­ dá»¥ng, cÃ¹ng má»™t logic nhÆ°ng cÃ¡c quy táº¯c khÃ¡c nhau vá»›i LRU)</li><li>LRFU(Least Recently and Frequently Used)</li><li>â€¦â€¦</li></ul><h4 id="bo-Ä‘em-ghi-write-buffer" tabindex="-1"><a class="header-anchor" href="#bo-Ä‘em-ghi-write-buffer"><span>Bá»™ Ä‘á»‡m ghi (Write Buffer)</span></a></h4><p>TÃ´i chá»‰ tÃ¬m hiá»ƒu bá»™ nhá»› cache Ä‘á»c - táº£i trÆ°á»›c dá»¯ liá»‡u trÆ°á»›c khi sá»­ dá»¥ng. Bá»™ Ä‘á»‡m ghi Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ lÆ°u dá»¯ liá»‡u, ghi hÃ ng loáº¡t vÃ o disk, thay vÃ¬ ghi dá»¯ liá»‡u tá»«ng cÃ¡i má»™t, dáº«n Ä‘áº¿n nhiá»u truy cáº­p disk duy nháº¥t.</p><p>HÃ£y nhá»› ráº±ng <strong>bá»™ Ä‘á»‡m lÆ°u cÃ¡c trang (Ä‘Æ¡n vá»‹ dá»¯ liá»‡u nhá» nháº¥t) chá»© khÃ´ng pháº£i lÃ  hÃ ng (row) (Ä‘Æ¡n vá»‹ logic mÃ  ngÆ°á»i nhÃ¬n vÃ o dá»¯ liá»‡u).</strong> Náº¿u cÃ¡c trang trong vÃ¹ng Ä‘á»‡m Ä‘Æ°á»£c sá»­a Ä‘á»•i nhÆ°ng chÆ°a Ä‘Æ°á»£c ghi vÃ o disk, Ä‘Ã³ lÃ  má»™t trang báº©n. CÃ³ ráº¥t nhiá»u thuáº­t toÃ¡n Ä‘á»ƒ quyáº¿t Ä‘á»‹nh thá»i Ä‘iá»ƒm tá»‘t nháº¥t Ä‘á»ƒ ghi cÃ¡c trang báº©n, nhÆ°ng váº¥n Ä‘á» nÃ y cÃ³ liÃªn quan cao Ä‘áº¿n khÃ¡i niá»‡m giao dá»‹ch (transaction), vÃ  bÃ¢y giá» chÃºng ta sáº½ nÃ³i vá» cÃ¡c giao dá»‹ch (transaction).</p><h3 id="trinh-quan-ly-giao-dich-transaction-manager" tabindex="-1"><a class="header-anchor" href="#trinh-quan-ly-giao-dich-transaction-manager"><span>TrÃ¬nh quáº£n lÃ½ giao dá»‹ch (Transaction Manager)</span></a></h3><blockquote><p>Cuá»‘i cÃ¹ng nhÆ°ng khÃ´ng kÃ©m pháº§n quan trá»ng, lÃ  trÃ¬nh quáº£n lÃ½ giao dá»‹ch, vÃ  chÃºng ta sáº½ tháº¥y quÃ¡ trÃ¬nh nÃ y Ä‘áº£m báº£o ráº±ng má»—i truy váº¥n Ä‘Æ°á»£c thá»±c hiá»‡n trong giao dá»‹ch cá»§a riÃªng nÃ³. NhÆ°ng trÆ°á»›c khi chÃºng ta báº¯t Ä‘áº§u, chÃºng ta cáº§n pháº£i hiá»ƒu khÃ¡i niá»‡m vá» cÃ¡c giao dá»‹ch ACID.</p></blockquote><p>â€œIâ€™m on acidâ€</p><p>Má»™t giao dá»‹ch ACID lÃ  má»™t Ä‘Æ¡n vá»‹ lÃ m viá»‡c Ä‘áº£m báº£o bá»‘n tÃ­nh cháº¥t:</p><ul><li>NguyÃªn tá»­ (Atomicity): Giao dá»‹ch Ä‘Æ°á»£c thá»±c hiá»‡n Ä‘áº§y Ä‘á»§ hoáº·c há»§y bá» hoÃ n toÃ n, ngay cáº£ khi nÃ³ cháº¡y liÃªn tá»¥c trong 10 giá». Náº¿u giao dá»‹ch sá»¥p Ä‘á»•, tráº¡ng thÃ¡i trá»Ÿ láº¡i trÆ°á»›c khi giao dá»‹ch (transaction rollback).</li><li>TÃ­nh nháº¥t quÃ¡n (Consistency): Chá»‰ dá»¯ liá»‡u há»£p phÃ¡p (tÃ¹y thuá»™c vÃ o cÃ¡c rÃ ng buá»™c quan há»‡ vÃ  chá»©c nÄƒng) má»›i cÃ³ thá»ƒ Ä‘Æ°á»£c ghi vÃ o cÆ¡ sá»Ÿ dá»¯ liá»‡u vÃ  tÃ­nh nháº¥t quÃ¡n cÃ³ liÃªn quan Ä‘áº¿n nguyÃªn tá»­ vÃ  cÃ¡ch ly.</li><li>Äá»™c láº­p (Isolation): Náº¿u 2 giao dá»‹ch A vÃ  B cháº¡y cÃ¹ng má»™t lÃºc, káº¿t quáº£ cuá»‘i cÃ¹ng cá»§a giao dá»‹ch A vÃ  B lÃ  nhÆ° nhau, cho dÃ¹ A káº¿t thÃºc trÆ°á»›c/sau/trong khi B cháº¡y.</li><li>Bá»n vá»¯ng (Durability): Má»™t khi giao dá»‹ch Ä‘Æ°á»£c cam káº¿t (cÃ³ nghÄ©a lÃ  thá»±c hiá»‡n thÃ nh cÃ´ng), báº¥t cá»© Ä‘iá»u gÃ¬ xáº£y ra (sá»± cá»‘ hoáº·c lá»—i), dá»¯ liá»‡u Ä‘Æ°á»£c lÆ°u trá»¯ trong cÆ¡ sá»Ÿ dá»¯ liá»‡u.</li></ul><p>Trong cÃ¹ng má»™t giao dá»‹ch, báº¡n cÃ³ thá»ƒ cháº¡y nhiá»u truy váº¥n SQL Ä‘á»ƒ Ä‘á»c, táº¡o, cáº­p nháº­t vÃ  xÃ³a dá»¯ liá»‡u. Khi hai giao dá»‹ch sá»­ dá»¥ng cÃ¹ng má»™t dá»¯ liá»‡u, ráº¯c rá»‘i Ä‘áº¿n. VÃ­ dá»¥ Ä‘iá»ƒn hÃ¬nh lÃ  chuyá»ƒn tiá»n tá»« tÃ i khoáº£n A Ä‘áº¿n tÃ i khoáº£n B. Giáº£ sá»­ cÃ³ 2 giao dá»‹ch:</p><ul><li>Giao dá»‹ch 1 (T1) rÃºt $100 tá»« tÃ i khoáº£n A vÃ o tÃ i khoáº£n B</li><li>Giao dá»‹ch 2 (T2) rÃºt $ 50 tá»« tÃ i khoáº£n A cho tÃ i khoáº£n B</li></ul><p>HÃ£y trá»Ÿ láº¡i Ä‘á»ƒ xem cÃ¡c thuá»™c tÃ­nh ACID:</p><ul><li>Atomicity Ä‘áº£m báº£o ráº±ng báº¥t cá»© Ä‘iá»u gÃ¬ xáº£y ra trong T1 (sá»± cá»‘ mÃ¡y chá»§, giÃ¡n Ä‘oáº¡n máº¡ng â€¦ ), khÃ´ng thá»ƒ xuáº¥t hiá»‡n hiá»‡n tÆ°á»£ng tÃ i khoáº£n A Ä‘Ã£ bá»‹ rÃºt 100$ nhÆ°ng khÃ´ng gá»­i cho tÃ i khoáº£n B (Ä‘Ã¢y lÃ  tráº¡ng thÃ¡i khÃ´ng nháº¥t quÃ¡n cá»§a dá»¯ liá»‡u).</li><li>Isolation Ä‘áº£m báº£o ráº±ng náº¿u T1 vÃ  T2 xáº£y ra cÃ¹ng má»™t lÃºc, cuá»‘i cÃ¹ng A sáº½ giáº£m $ 150 vÃ  B sáº½ nháº­n Ä‘Æ°á»£c $150 thay vÃ¬ cÃ¡c káº¿t quáº£ khÃ¡c, cháº³ng háº¡n nhÆ° vÃ¬ pháº§n T2 xÃ³a hÃ nh vi cá»§a T1, A giáº£m $150 vÃ  B chá»‰ nháº­n Ä‘Æ°á»£c $50 (Ä‘Ã¢y cÅ©ng lÃ  tráº¡ng thÃ¡i khÃ´ng nháº¥t quÃ¡n).</li><li>Durability Ä‘áº£m báº£o ráº±ng náº¿u T1 vá»«a Ä‘Æ°á»£c cam káº¿t, cÆ¡ sá»Ÿ dá»¯ liá»‡u sá»¥p Ä‘á»• vÃ  T1 sáº½ khÃ´ng biáº¿n máº¥t mÃ  khÃ´ng cÃ³ dáº¥u váº¿t.</li><li>Consistency Ä‘áº£m báº£o ráº±ng tiá»n khÃ´ng Ä‘Æ°á»£c táº¡o ra hoáº·c máº¥t mÃ¡t trong há»‡ thá»‘ng.</li></ul><h3 id="kiem-soat-Ä‘ong-thoi-concurrency-control" tabindex="-1"><a class="header-anchor" href="#kiem-soat-Ä‘ong-thoi-concurrency-control"><span>Kiá»ƒm soÃ¡t Ä‘á»“ng thá»i (Concurrency Control)</span></a></h3><p>Váº¥n Ä‘á» thá»±c sá»± vá»›i viá»‡c Ä‘áº£m báº£o isolation, consistency, and atomicity lÃ  <strong>write operation (add, update, delete) Ä‘á»‘i vá»›i cÃ¹ng má»™t dá»¯ liá»‡u</strong>:</p><ul><li>Náº¿u táº¥t cáº£ cÃ¡c giao dá»‹ch chá»‰ Ä‘á»c dá»¯ liá»‡u, chÃºng cÃ³ thá»ƒ hoáº¡t Ä‘á»™ng cÃ¹ng má»™t lÃºc vÃ  khÃ´ng thay Ä‘á»•i hÃ nh vi cá»§a má»™t giao dá»‹ch khÃ¡c.</li><li>Náº¿u (Ã­t nháº¥t) cÃ³ má»™t giao dá»‹ch sá»­a Ä‘á»•i dá»¯ liá»‡u Ä‘Æ°á»£c Ä‘á»c bá»Ÿi cÃ¡c giao dá»‹ch khÃ¡c, cÆ¡ sá»Ÿ dá»¯ liá»‡u cáº§n pháº£i tÃ¬m má»™t cÃ¡ch Ä‘á»ƒ áº©n nhá»¯ng thay Ä‘á»•i nhÆ° váº­y cho cÃ¡c giao dá»‹ch khÃ¡c. NgoÃ i ra, nÃ³ cÅ©ng cáº§n pháº£i Ä‘áº£m báº£o ráº±ng sá»­a Ä‘á»•i nÃ y sáº½ khÃ´ng bá»‹ xÃ³a bá»Ÿi má»™t giao dá»‹ch khÃ¡c mÃ  báº¡n khÃ´ng tháº¥y dá»¯ liá»‡u nÃ y sá»­a Ä‘á»•i.</li></ul><p>Váº¥n Ä‘á» nÃ y Ä‘Æ°á»£c gá»i lÃ  <strong>kiá»ƒm soÃ¡t Ä‘á»“ng thá»i (concurency control)</strong>.</p><p>Giáº£i phÃ¡p Ä‘Æ¡n giáº£n nháº¥t lÃ  thá»±c hiá»‡n láº§n lÆ°á»£t tá»«ng giao dá»‹ch (tá»©c lÃ  thá»±c hiá»‡n theo thá»© tá»±), nhÆ°ng Ä‘iá»u nÃ y hoÃ n toÃ n khÃ´ng cÃ³ kháº£ nÄƒng má»Ÿ rá»™ng, chá»‰ cÃ³ má»™t nhÃ¢n hoáº¡t Ä‘á»™ng trÃªn má»™t mÃ¡y chá»§ Ä‘a nhÃ¢n / Ä‘a luá»“ng vÃ  khÃ´ng hiá»‡u quáº£.</p><ul><li>LÃ½ tÆ°á»Ÿng nháº¥t lÃ  má»—i khi má»™t giao dá»‹ch Ä‘Æ°á»£c táº¡o hoáº·c há»§y bá»:</li><li>GiÃ¡m sÃ¡t táº¥t cáº£ cÃ¡c hoáº¡t Ä‘á»™ng cá»§a táº¥t cáº£ cÃ¡c giao dá»‹ch</li><li>Kiá»ƒm tra xem cÃ¡c pháº§n cá»§a 2 (hoáº·c nhiá»u) giao dá»‹ch xung Ä‘á»™t do Ä‘á»c/sá»­a cÃ¹ng má»™t dá»¯ liá»‡u hay khÃ´ng?</li><li>Sáº¯p xáº¿p láº¡i cÃ¡c hoáº¡t Ä‘á»™ng trong cÃ¡c giao dá»‹ch xung Ä‘á»™t Ä‘á»ƒ giáº£m cÃ¡c pháº§n xung Ä‘á»™t</li><li>Thá»±c hiá»‡n cÃ¡c pháº§n xung Ä‘á»™t theo má»™t thá»© tá»± nháº¥t Ä‘á»‹nh (trong khi cÃ¡c giao dá»‹ch khÃ´ng xung Ä‘á»™t váº«n Ä‘ang cháº¡y Ä‘á»“ng thá»i)</li><li>Xem xÃ©t ráº±ng giao dá»‹ch cÃ³ thá»ƒ bá»‹ há»§y bá»</li></ul><p>Theo cÃ¡ch nÃ³i chÃ­nh thá»©c hÆ¡n, Ä‘Ã¢y lÃ  má»™t váº¥n Ä‘á» láº­p lá»‹ch cho xung Ä‘á»™t. Cá»¥ thá»ƒ hÆ¡n, Ä‘Ã¢y lÃ  má»™t váº¥n Ä‘á» tá»‘i Æ°u hÃ³a ráº¥t khÃ³ khÄƒn vÃ  chi phÃ­ CPU ráº¥t lá»›n. CÆ¡ sá»Ÿ dá»¯ liá»‡u cáº¥p doanh nghiá»‡p khÃ´ng thá»ƒ chá»‹u Ä‘á»±ng Ä‘Æ°á»£c viá»‡c chá» Ä‘á»£i hÃ ng giá» Ä‘á»ƒ tÃ¬m lá»‹ch trÃ¬nh tá»‘t nháº¥t cho má»—i hoáº¡t Ä‘á»™ng giao dá»‹ch má»›i, vÃ¬ váº­y hÃ£y sá»­ dá»¥ng má»™t cÃ¡ch Ã­t lÃ½ tÆ°á»Ÿng hÆ¡n Ä‘á»ƒ trÃ¡nh lÃ£ng phÃ­ nhiá»u thá»i gian hÆ¡n Ä‘á»ƒ giáº£i quyáº¿t xung Ä‘á»™t.</p><h3 id="trinh-quan-ly-khoa-lock-manager" tabindex="-1"><a class="header-anchor" href="#trinh-quan-ly-khoa-lock-manager"><span>TrÃ¬nh quáº£n lÃ½ khÃ³a (Lock Manager)</span></a></h3><blockquote><p>Äá»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y, háº§u háº¿t cÃ¡c cÆ¡ sá»Ÿ dá»¯ liá»‡u sá»­ dá»¥ng <strong>khÃ³a</strong> vÃ  / hoáº·c <strong>kiá»ƒm soÃ¡t phiÃªn báº£n dá»¯ liá»‡u</strong>. ÄÃ¢y lÃ  má»™t chá»§ Ä‘á» lá»›n, tÃ´i sáº½ táº­p trung vÃ o khÃ³a, vÃ  má»™t chÃºt kiá»ƒm soÃ¡t phiÃªn báº£n dá»¯ liá»‡u.</p></blockquote><h4 id="khoa-bi-quan-pessimistic-lock" tabindex="-1"><a class="header-anchor" href="#khoa-bi-quan-pessimistic-lock"><span>KhÃ³a bi quan (pessimistic lock)</span></a></h4><p>NguyÃªn táº¯c lÃ :</p><ul><li>Náº¿u má»™t giao dá»‹ch yÃªu cáº§u má»™t dá»¯ liá»‡u, nÃ³ khÃ³a dá»¯ liá»‡u</li><li>Náº¿u má»™t giao dá»‹ch khÃ¡c cÅ©ng cáº§n dá»¯ liá»‡u nÃ y, nÃ³ pháº£i chá» giao dá»‹ch Ä‘áº§u tiÃªn tá»« bá» dá»¯ liá»‡u Ä‘Ã³</li></ul><p>á»” khÃ³a nÃ y gá»i lÃ  <strong>khÃ³a Ä‘á»™c quyá»n</strong>.</p><p>NhÆ°ng viá»‡c sá»­ dá»¥ng khÃ³a Ä‘á»™c quyá»n cho má»™t giao dá»‹ch chá»‰ Ä‘á»c dá»¯ liá»‡u lÃ  tá»‘n kÃ©m, bá»Ÿi vÃ¬ nÃ³ sáº½ buá»™c cÃ¡c giao dá»‹ch khÃ¡c chá»‰ cáº§n Ä‘á»c cÃ¹ng má»™t dá»¯ liá»‡u chá» Ä‘á»£i. VÃ¬ váº­y, cÃ³ má»™t loáº¡i khÃ³a khÃ¡c, <strong>khÃ³a chia sáº» (shared lock)</strong>.</p><p><strong>KhÃ³a chia sáº» trÃ´ng nhÆ° tháº¿ nÃ y</strong>:</p><ul><li>Náº¿u má»™t giao dá»‹ch chá»‰ cáº§n Ä‘á»c dá»¯ liá»‡u A, nÃ³ sáº½ thÃªm &quot;khÃ³a chia sáº»&quot; vÃ o dá»¯ liá»‡u A vÃ  Ä‘á»c</li><li>Náº¿u giao dá»‹ch thá»© hai cÅ©ng cáº§n chá»‰ Ä‘á»c dá»¯ liá»‡u A, nÃ³ sáº½ thÃªm &quot;khÃ³a chia sáº»&quot; dá»¯ liá»‡u A vÃ  Ä‘á»c</li><li>Náº¿u giao dá»‹ch thá»© ba cáº§n pháº£i sá»­a Ä‘á»•i dá»¯ liá»‡u A, nÃ³ sáº½ thÃªm &quot;khÃ³a Ä‘á»™c quyá»n&quot; vÃ o dá»¯ liá»‡u A, nhÆ°ng pháº£i chá» Ä‘á»£i cho hai giao dá»‹ch khÃ¡c tá»« bá» khÃ³a chia sáº» cá»§a há».</li></ul><p>TÆ°Æ¡ng tá»± nhÆ° váº­y, náº¿u khÃ³a Ä‘á»™c quyá»n Ä‘Æ°á»£c thÃªm má»™t khá»‘i dá»¯ liá»‡u, má»™t giao dá»‹ch mÃ  chá»‰ cáº§n Ä‘á»c dá»¯ liá»‡u Ä‘Ã³ thÃ¬ pháº£i chá» khÃ³a Ä‘á»™c quyá»n tá»« bá» trÆ°á»›c khi thÃªm khÃ³a chia sáº» cho dá»¯ liá»‡u Ä‘Ã³.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230605010909.png" alt="Pasted image 20230605010909" tabindex="0" loading="lazy"><figcaption>Pasted image 20230605010909</figcaption></figure><p>TrÃ¬nh quáº£n lÃ½ khÃ³a lÃ  quÃ¡ trÃ¬nh thÃªm vÃ  giáº£i phÃ³ng khÃ³a, lÆ°u thÃ´ng tin khÃ³a trong ná»™i bá»™ vá»›i má»™t báº£ng bÄƒm (vá»›i key lÃ  dá»¯ liá»‡u bá»‹ khÃ³a) vÃ  hiá»ƒu ráº±ng má»—i khá»‘i dá»¯ liá»‡u lÃ :</p><ul><li>Bá»‹ khÃ³a bá»Ÿi giao dá»‹ch nÃ o</li><li>Giao dá»‹ch nÃ o Ä‘ang chá» dá»¯ liá»‡u Ä‘Æ°á»£c má»Ÿ khÃ³a</li></ul><h4 id="be-tac-deadlock" tabindex="-1"><a class="header-anchor" href="#be-tac-deadlock"><span>Báº¿ táº¯c (Deadlock)</span></a></h4><p>NhÆ°ng sá»­ dá»¥ng khÃ³a cÃ³ thá»ƒ dáº«n Ä‘áº¿n má»™t tÃ¬nh huá»‘ng mÃ  2 giao dá»‹ch luÃ´n chá» Ä‘á»£i má»™t máº£nh dá»¯ liá»‡u:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230605011404.png" alt="Pasted image 20230605011404" tabindex="0" loading="lazy"><figcaption>Pasted image 20230605011404</figcaption></figure><p>Trong hÃ¬nh nÃ y:</p><ul><li>Giao dá»‹ch A thÃªm khÃ³a Ä‘á»™c quyá»n vÃ o dá»¯ liá»‡u 1 vÃ  chá» Ä‘á»£i Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c dá»¯ liá»‡u 2</li><li>Giao dá»‹ch B thÃªm khÃ³a Ä‘á»™c quyá»n cho dá»¯ liá»‡u 2 vÃ  chá» Ä‘á»£i Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c dá»¯ liá»‡u 1</li></ul><p>NÃ³ Ä‘Æ°á»£c gá»i lÃ  <strong>báº¿ táº¯c (deadlock)</strong>.</p><p>Khi báº¿ táº¯c xáº£y ra, trÃ¬nh quáº£n lÃ½ khÃ³a sáº½ chá»n há»§y bá» (rollback) má»™t giao dá»‹ch Ä‘á»ƒ loáº¡i bá» báº¿ táº¯c. ÄÃ¢y lÃ  má»™t quyáº¿t Ä‘á»‹nh khÃ³ khÄƒn:</p><ul><li>Huá»· cÃ¡c giao dá»‹ch cÃ³ Ã­t sá»­a Ä‘á»•i dá»¯ liá»‡u nháº¥t (Ä‘iá»u nÃ y lÃ m giáº£m chi phÃ­ rollback)?</li><li>Huá»· cÃ¡c giao dá»‹ch cÃ³ thá»i gian ngáº¯n nháº¥t vÃ¬ ngÆ°á»i dÃ¹ng cá»§a cÃ¡c giao dá»‹ch khÃ¡c chá» Ä‘á»£i lÃ¢u hÆ¡n?</li><li>Huá»· cÃ¡c giao dá»‹ch tá»‘n Ã­t thá»i gian Ä‘á»ƒ káº¿t thÃºc hÆ¡n(trÃ¡nh Ä‘Ã³i tÃ i nguyÃªn)?</li><li>Má»™t khi rollback xáº£y ra, cÃ³ bao nhiÃªu giao dá»‹ch sáº½ bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi rollback?</li></ul><p>TrÆ°á»›c khi thá»±c hiá»‡n lá»±a chá»n, trÃ¬nh quáº£n lÃ½ khÃ³a cáº§n kiá»ƒm tra xem cÃ³ báº¿ táº¯c hay khÃ´ng.</p><p>Báº£ng bÄƒm cÃ³ thá»ƒ Ä‘Æ°á»£c coi lÃ  má»™t Ä‘á»“ thá»‹ (xem Ä‘á»“ thá»‹ á»Ÿ trÃªn), trong Ä‘Ã³ náº¿u chu trÃ¬nh xuáº¥t hiá»‡n cho tháº¥y báº¿ táº¯c. VÃ¬ vÃ²ng láº·p kiá»ƒm tra lÃ  tá»‘n kÃ©m (Ä‘á»“ thá»‹ bao gá»“m táº¥t cáº£ cÃ¡c á»• khÃ³a lÃ  ráº¥t lá»›n), nÃ³ thÆ°á»ng Ä‘Æ°á»£c giáº£i quyáº¿t theo nhá»¯ng cÃ¡ch Ä‘Æ¡n giáº£n: <strong>sá»­ dá»¥ng thá»i gian chá» (timeout)</strong>. Náº¿u má»™t khÃ³a khÃ´ng Ä‘Æ°á»£c thÃªm vÃ o trong thá»i gian chá», sau Ä‘Ã³ giao dá»‹ch sáº½ Ä‘i vÃ o tráº¡ng thÃ¡i báº¿ táº¯c.</p><p>TrÃ¬nh quáº£n lÃ½ khÃ³a cÅ©ng cÃ³ thá»ƒ kiá»ƒm tra xem khÃ³a cÃ³ trá»Ÿ thÃ nh báº¿ táº¯c hay khÃ´ng trÆ°á»›c khi thÃªm khÃ³a Ä‘Ã³, nhÆ°ng nÃ³ váº«n tá»‘n kÃ©m Ä‘á»ƒ lÃ m Ä‘iá»u Ä‘Ã³ má»™t cÃ¡ch hoÃ n háº£o. Do Ä‘Ã³, cÃ¡c tiá»n kiá»ƒm thá»­ (preflight) nÃ y thÆ°á»ng thiáº¿t láº­p má»™t sá»‘ quy táº¯c cÆ¡ báº£n.</p><h4 id="two-phase-locking-protocol" tabindex="-1"><a class="header-anchor" href="#two-phase-locking-protocol"><span>Two-Phase Locking Protocol</span></a></h4><blockquote><p>CÃ¡ch dá»… nháº¥t Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c sá»± Ä‘á»™c láº­p thuáº§n tÃºy lÃ  Ä‘á»ƒ cÃ³ Ä‘Æ°á»£c má»™t khÃ³a khi báº¯t Ä‘áº§u giao dá»‹ch vÃ  giáº£i phÃ³ng nÃ³ khi káº¿t thÃºc. Äiá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ , trÆ°á»›c khi giao dá»‹ch báº¯t Ä‘áº§u, báº¡n pháº£i chá» Ä‘á»£i Ä‘á»ƒ Ä‘áº£m báº£o ráº±ng báº¡n cÃ³ thá»ƒ thÃªm táº¥t cáº£ cÃ¡c khÃ³a vÃ  giáº£i phÃ³ng khÃ³a mÃ  báº¡n giá»¯ khi giao dá»‹ch káº¿t thÃºc. Äiá»u nÃ y lÃ  ok, nhÆ°ng ráº¥t nhiá»u thá»i gian Ä‘Ã£ bá»‹ lÃ£ng phÃ­ Ä‘á»ƒ chá» Ä‘á»£i cho táº¥t cáº£ cÃ¡c á»• khÃ³a.</p></blockquote><p>CÃ¡ch nhanh hÆ¡n lÃ  <strong>giao thá»©c khÃ³a hai giai Ä‘oáº¡n</strong> (Two-Phase Locking Protocol, Ä‘Æ°á»£c sá»­ dá»¥ng bá»Ÿi DB2 vÃ  SQL Server), nÆ¡i cÃ¡c giao dá»‹ch Ä‘Æ°á»£c chia thÃ nh hai giai Ä‘oáº¡n:</p><ul><li><strong>Giai Ä‘oáº¡n tÄƒng trÆ°á»Ÿng</strong>: Giao dá»‹ch cÃ³ thá»ƒ nháº­n Ä‘Æ°á»£c khÃ³a, nhÆ°ng khÃ´ng thá»ƒ giáº£i phÃ³ng khÃ³a.</li><li><strong>Giai Ä‘oáº¡n thu háº¹p</strong>: Giao dá»‹ch cÃ³ thá»ƒ giáº£i phÃ³ng khÃ³a (Ä‘á»‘i vá»›i dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c xá»­ lÃ½ vÃ  khÃ´ng Ä‘Æ°á»£c xá»­ lÃ½ láº¡i), nhÆ°ng khÃ´ng thá»ƒ cÃ³ Ä‘Æ°á»£c khÃ³a má»›i.</li></ul><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230605013007.png" alt="Pasted image 20230605013007" tabindex="0" loading="lazy"><figcaption>Pasted image 20230605013007</figcaption></figure><p>QuÃ¡ trÃ¬nh Ä‘áº±ng sau hai quy táº¯c Ä‘Æ¡n giáº£n nÃ y lÃ :</p><ul><li>Giáº£i phÃ³ng khÃ³a khÃ´ng cÃ²n Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ giáº£m thá»i gian chá» Ä‘á»£i cho cÃ¡c giao dá»‹ch khÃ¡c</li><li>NgÄƒn cháº·n tÃ¬nh huá»‘ng sau xáº£y ra: dá»¯ liá»‡u thu Ä‘Æ°á»£c ban Ä‘áº§u tá»« giao dá»‹ch, Ä‘Æ°á»£c sá»­a Ä‘á»•i sau khi giao dá»‹ch báº¯t Ä‘áº§u, vÃ  sá»± khÃ´ng nháº¥t quÃ¡n xáº£y ra khi giao dá»‹ch Ä‘á»c láº¡i dá»¯ liá»‡u.</li></ul><p>Quy táº¯c nÃ y hoáº¡t Ä‘á»™ng tá»‘t, vá»›i má»™t ngoáº¡i lá»‡: náº¿u má»™t máº£nh dá»¯ liá»‡u bá»‹ sá»­a Ä‘á»•i, cÃ¡c khÃ³a liÃªn quan bá»‹ giáº£i phÃ³ng, giao dá»‹ch bá»‹ há»§y bá» (rollback), trong khi giao dá»‹ch khÃ¡c Ä‘á»c giÃ¡ trá»‹ Ä‘Ã£ bá»‹ sá»­a Ä‘á»•i, nhÆ°ng giÃ¡ trá»‹ cuá»‘i cÃ¹ng nÃ y Ä‘Ã£ Ä‘Æ°á»£c rollback. Äá»ƒ trÃ¡nh váº¥n Ä‘á» nÃ y, <strong>táº¥t cáº£ cÃ¡c khÃ³a Ä‘á»™c quyá»n pháº£i Ä‘Æ°á»£c giáº£i phÃ³ng vÃ o cuá»‘i giao dá»‹ch</strong>.</p><h4 id="nhieu-hon-nua" tabindex="-1"><a class="header-anchor" href="#nhieu-hon-nua"><span>Nhiá»u hÆ¡n ná»¯a</span></a></h4><blockquote><p>Táº¥t nhiÃªn, cÆ¡ sá»Ÿ dá»¯ liá»‡u thá»±c táº¿ sá»­ dá»¥ng cÃ¡c há»‡ thá»‘ng phá»©c táº¡p hÆ¡n liÃªn quan Ä‘áº¿n nhiá»u loáº¡i khÃ³a hÆ¡n (vÃ­ dá»¥: khÃ³a Ã½ Ä‘á»‹nh, intention lock) vÃ  nhiá»u chi tiáº¿t hÆ¡n (krow-level lock, page-level lock, partition lock, table lock, table space lock), nhÆ°ng Ã½ tÆ°á»Ÿng lÃ  nhÆ° nhau.</p></blockquote><p>TÃ´i chá»‰ tÃ¬m hiá»ƒu cÃ¡c phÆ°Æ¡ng phÃ¡p hoÃ n toÃ n dá»±a trÃªn khÃ³a vÃ  <strong>kiá»ƒm soÃ¡t phiÃªn báº£n dá»¯ liá»‡u lÃ  má»™t cÃ¡ch khÃ¡c Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y</strong>.</p><p>Kiá»ƒm soÃ¡t phiÃªn báº£n (version control) trÃ´ng nhÆ° tháº¿ nÃ y:</p><ul><li>Má»—i giao dá»‹ch cÃ³ thá»ƒ sá»­a Ä‘á»•i cÃ¹ng má»™t dá»¯ liá»‡u táº¡i cÃ¹ng má»™t thá»i Ä‘iá»ƒm</li><li>Má»—i giao dá»‹ch cÃ³ báº£n sao riÃªng (hoáº·c phiÃªn báº£n) cá»§a dá»¯ liá»‡u</li><li>Náº¿u 2 giao dá»‹ch sá»­a Ä‘á»•i cÃ¹ng má»™t dá»¯ liá»‡u, chá»‰ cháº¥p nháº­n má»™t sá»­a Ä‘á»•i, cÃ²n láº¡i sáº½ bá»‹ tá»« chá»‘i vÃ  cÃ¡c giao dá»‹ch liÃªn quan rollback (hoáº·c cháº¡y láº¡i)</li></ul><p>Äiá»u nÃ y sáº½ cáº£i thiá»‡n hiá»‡u suáº¥t vÃ¬:</p><ul><li>Giao dá»‹ch Ä‘á»c khÃ´ng cháº·n giao dá»‹ch viáº¿t</li><li>Giao dá»‹ch viáº¿t khÃ´ng cháº·n Ä‘á»c</li><li>KhÃ´ng cÃ³ chi phÃ­ bá»• sung cho trÃ¬nh quáº£n lÃ½ khÃ³a &quot;cá»“ng ká»nh vÃ  cháº­m&quot;</li></ul><p>Ngoáº¡i trá»« khi hai giao dá»‹ch viáº¿t cÃ¹ng má»™t dá»¯ liá»‡u, kiá»ƒm soÃ¡t phiÃªn báº£n dá»¯ liá»‡u hoáº¡t Ä‘á»™ng tá»‘t hÆ¡n so vá»›i khÃ³a trong táº¥t cáº£ cÃ¡c khÃ­a cáº¡nh. Chá»‰ cÃ³ Ä‘iá»u, báº¡n sáº½ sá»›m phÃ¡t hiá»‡n ra ráº±ng sá»± tiÃªu thá»¥ khÃ´ng gian disk lÃ  ráº¥t lá»›n.</p><p><strong>Kiá»ƒm soÃ¡t phiÃªn báº£n dá»¯ liá»‡u vÃ  cÆ¡ cháº¿ khÃ³a lÃ  hai hiá»ƒu biáº¿t khÃ¡c nhau</strong>: khÃ³a láº¡c quan vÃ  khÃ³a bi quan. Cáº£ hai Ä‘á»u cÃ³ Æ°u vÃ  nhÆ°á»£c Ä‘iá»ƒm, hoÃ n toÃ n phá»¥ thuá»™c vÃ o viá»‡c ká»‹ch báº£n sá»­ dá»¥ng (Ä‘á»c nhiá»u hÆ¡n hoáº·c viáº¿t nhiá»u hÆ¡n).</p><blockquote><p>Má»™t sá»‘ cÆ¡ sá»Ÿ dá»¯ liá»‡u, cháº³ng háº¡n nhÆ° DB2 (cho Ä‘áº¿n phiÃªn báº£n 9.7) vÃ  SQL Server (khÃ´ng cÃ³ isolation snapshot), chá»‰ sá»­ dá»¥ng cÆ¡ cháº¿ khÃ³a. Nhá»¯ng cÆ¡ sá»Ÿ dá»¯ liá»‡u khÃ¡c nhÆ° PostgreSQL, MySQL vÃ  Oracle sá»­ dá»¥ng cÆ¡ cháº¿ káº¿t há»£p khÃ³a vÃ  phiÃªn báº£n chuá»™t.</p></blockquote><h3 id="trinh-quan-ly-nhat-ky-log-manager" tabindex="-1"><a class="header-anchor" href="#trinh-quan-ly-nhat-ky-log-manager"><span>TrÃ¬nh quáº£n lÃ½ nháº­t kÃ½ (Log Manager)</span></a></h3><p>NhÆ° chÃºng ta Ä‘Ã£ biáº¿t, Ä‘á»ƒ cáº£i thiá»‡n hiá»‡u suáº¥t, cÆ¡ sá»Ÿ dá»¯ liá»‡u lÆ°u dá»¯ liá»‡u trong bá»™ Ä‘á»‡m bá»™ nhá»›. NhÆ°ng náº¿u mÃ¡y chá»§ sá»¥p Ä‘á»• khi giao dá»‹ch Ä‘Æ°á»£c cam káº¿t, dá»¯ liá»‡u váº«n cÃ²n trong bá»™ nhá»› bá»‹ máº¥t, lÃ m suy yáº¿u tÃ­nh bá»n vá»¯ng (durability) cá»§a giao dá»‹ch. Báº¡n cÃ³ thá»ƒ ghi táº¥t cáº£ dá»¯ liá»‡u trÃªn disk, nhÆ°ng náº¿u mÃ¡y chá»§ sá»¥p Ä‘á»•, dá»¯ liá»‡u cuá»‘i cÃ¹ng cÃ³ thá»ƒ chá»‰ Ä‘Æ°á»£c ghi má»™t pháº§n vÃ o disk, lÃ m há»ng tÃ­nh nguyÃªn tá»­ (atomicity) cá»§a giao dá»‹ch.</p><p><strong>Báº¥t ká»³ sá»­a Ä‘á»•i nÃ o Ä‘Æ°á»£c thá»±c hiá»‡n bá»Ÿi giao dá»‹ch pháº£i bá»‹ há»§y bá» hoáº·c hoÃ n thÃ nh</strong>.</p><p>CÃ³ 2 cÃ¡ch Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y:</p><ul><li><p><strong>Báº£n sao/Trang bÃ³ng (Shadow copies/pages)</strong>: Â Má»—i giao dá»‹ch táº¡o ra má»™t báº£n sao cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a riÃªng nÃ³ (hoáº·c má»™t pháº§n cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u), vÃ  lÃ m viá»‡c trÃªn báº£n sao nÃ y. Khi xáº£y ra lá»—i, báº£n sao nÃ y sáº½ Ä‘Æ°á»£c loáº¡i bá»; khi thÃ nh cÃ´ng, cÆ¡ sá»Ÿ dá»¯ liá»‡u ngay láº­p tá»©c sá»­ dá»¥ng má»™t thá»§ thuáº­t tá»« há»‡ thá»‘ng tá»‡p tin Ä‘á»ƒ thay tháº¿ báº£n sao vÃ o trong dá»¯ liá»‡u, sau Ä‘Ã³ xÃ³a Ä‘i cÃ¡c &quot;dá»¯ liá»‡u cÅ©&quot;.</p></li><li><p><strong>Nháº­t kÃ½ giao dá»‹ch (Transaction log)</strong>: Nháº­t kÃ½ giao dá»‹ch lÃ  má»™t khÃ´ng gian lÆ°u trá»¯, trÆ°á»›c khi ghi vÃ o Ä‘Ä©a má»—i láº§n, cÆ¡ sá»Ÿ dá»¯ liá»‡u sáº½ viáº¿t thÃ´ng tin vÃ o nháº­t kÃ½ giao dá»‹ch. Äiá»u nÃ y giÃºp cÆ¡ sá»Ÿ dá»¯ liá»‡u biáº¿t cÃ¡ch loáº¡i bá» hoáº·c hoÃ n thÃ nh cÃ¡c giao dá»‹ch chÆ°a hoÃ n thÃ nh khi xáº£y ra sá»± cá»‘ hoáº·c rollback cá»§a giao dá»‹ch.</p></li></ul><h4 id="wal-write-ahead-logging" tabindex="-1"><a class="header-anchor" href="#wal-write-ahead-logging"><span>WAL (Write-Ahead Logging)</span></a></h4><blockquote><p>Shadow copies/pages táº¡o ra ráº¥t nhiá»u chi phÃ­ disk khi cháº¡y má»™t cÆ¡ sá»Ÿ dá»¯ liá»‡u lá»›n vá»›i nhiá»u giao dá»‹ch hÆ¡n, vÃ¬ váº­y cÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n Ä‘áº¡i sá»­ dá»¥ng <strong>transaction log</strong>. Nháº­t kÃ½ giao dá»‹ch pháº£i Ä‘Æ°á»£c <strong>lÆ°u trá»¯ á»•n Ä‘á»‹nh</strong> vÃ  tÃ´i sáº½ khÃ´ng Ä‘Ã o sÃ¢u vÃ o cÃ´ng nghá»‡ lÆ°u trá»¯, nhÆ°ng Ã­t nháº¥t Disk RAID lÃ  báº¯t buá»™c trong trÆ°á»ng há»£p disk lá»—i.</p></blockquote><p>Háº§u háº¿t cÃ¡c cÆ¡ sá»Ÿ dá»¯ liá»‡u (Ã­t nháº¥t lÃ  Oracle, SQL Server, DB2, PostgreSQL, MySQL vÃ  SQLite) xá»­ lÃ½ nháº­t kÃ½ giao dá»‹ch báº±ng cÃ¡ch sá»­ dá»¥ng giao thá»©c nháº­t kÃ½ ghi trÆ°á»›c (Write-Ahead Logging protocol, WAL). Giao thá»©c WAL cÃ³ 3 quy táº¯c:</p><ul><li>Má»—i sá»­a Ä‘á»•i cÆ¡ sá»Ÿ dá»¯ liá»‡u táº¡o ra má»™t báº£n ghi nháº­t kÃ½, vÃ  trÆ°á»›c khi dá»¯ liá»‡u Ä‘Æ°á»£c ghi vÃ o disk, báº£n ghi nháº­t kÃ½ pháº£i Ä‘Æ°á»£c ghi vÃ o nháº­t kÃ½ giao dá»‹ch.</li><li>Ghi nháº­t kÃ½ pháº£i Ä‘Æ°á»£c viáº¿t theo thá»© tá»±; Báº£n ghi A xáº£y ra trÆ°á»›c khi báº£n ghi B thÃ¬ A pháº£i Ä‘Æ°á»£c viáº¿t trÆ°á»›c B.</li><li>Khi má»™t giao dá»‹ch Ä‘Æ°á»£c cam káº¿t, trÃ¬nh tá»± cam káº¿t pháº£i Ä‘Æ°á»£c ghi vÃ o nháº­t kÃ½ giao dá»‹ch trÆ°á»›c khi giao dá»‹ch thÃ nh cÃ´ng.</li></ul><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230605020105.png" alt="Pasted image 20230605020105" tabindex="0" loading="lazy"><figcaption>Pasted image 20230605020105</figcaption></figure><p>CÃ´ng viá»‡c nÃ y Ä‘Æ°á»£c thá»±c hiá»‡n bá»Ÿi trÃ¬nh quáº£n lÃ½ nháº­t kÃ½. Sá»± hiá»ƒu biáº¿t Ä‘Æ¡n giáº£n lÃ  trÃ¬nh quáº£n lÃ½ nháº­t kÃ½ náº±m giá»¯a trÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache (cache manager) vÃ  trÃ¬nh quáº£n lÃ½ truy cáº­p dá»¯ liá»‡u (data access manager, chá»‹u trÃ¡ch nhiá»‡m ghi dá»¯ liá»‡u vÃ o disk), má»—i thao tÃ¡c update / delete / create / commit / rollback ghi vÃ o nháº­t kÃ½ giao dá»‹ch trÆ°á»›c khi ghi vÃ o disk. QuÃ¡ trÃ¬nh nÃ y lÃ  Ä‘Æ¡n giáº£n, lÃ½ do lÃ  <strong>lÃ m tháº¿ nÃ o Ä‘á»ƒ tÃ¬m má»™t cÃ¡ch Ä‘á»ƒ viáº¿t nháº­t kÃ½ trong khi váº«n duy trÃ¬ hiá»‡u suáº¥t tá»‘t</strong>, náº¿u nháº­t kÃ½ giao dá»‹ch Ä‘Æ°á»£c viáº¿t quÃ¡ cháº­m, toÃ n bá»™ sáº½ cháº­m láº¡i.</p><h4 id="aries" tabindex="-1"><a class="header-anchor" href="#aries"><span>ARIES</span></a></h4><blockquote><p>NÄƒm 1992, cÃ¡c nhÃ  nghiÃªn cá»©u IBM Ä‘Ã£ phÃ¡t minh ra má»™t phiÃªn báº£n nÃ¢ng cao cá»§a WAL, Ä‘Æ°á»£c gá»i lÃ  ARIES. ARIES Ã­t nhiá»u Ä‘Æ°á»£c sá»­ dá»¥ng trong cÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n Ä‘áº¡i, logic khÃ´ng nháº¥t thiáº¿t pháº£i giá»‘ng nhau, nhÆ°ng cÃ¡c khÃ¡i niá»‡m Ä‘áº±ng sau AIRES cÃ³ á»Ÿ kháº¯p má»i nÆ¡i. ARIES viáº¿t táº¯t cá»§a Algorithms for Recovery and Isolation Exploiting Semantics.</p></blockquote><p>CÃ´ng nghá»‡ nÃ y Ä‘á»ƒ Ä‘áº¡t Ä‘Æ°á»£c má»™t má»¥c tiÃªu kÃ©p:</p><ul><li>Ghi nháº­t kÃ½ trong khi váº«n duy trÃ¬ hiá»‡u suáº¥t tá»‘t</li><li>Phá»¥c há»“i dá»¯ liá»‡u nhanh chÃ³ng vÃ  Ä‘Ã¡ng tin cáº­y</li></ul><p>CÃ³ má»™t sá»‘ lÃ½ do khiáº¿n cÆ¡ sá»Ÿ dá»¯ liá»‡u pháº£i rollback giao dá»‹ch:</p><ul><li>Bá»Ÿi vÃ¬ ngÆ°á»i dÃ¹ng há»§y bá»</li><li>Bá»Ÿi vÃ¬ mÃ¡y chá»§ hoáº·c máº¡ng tháº¥t báº¡i</li><li>Bá»Ÿi vÃ¬ cÃ¡c giao dá»‹ch phÃ¡ há»§y tÃ­nh toÃ n váº¹n cá»§a cÆ¡ sá»Ÿ dá»¯ liá»‡u (cháº³ng háº¡n nhÆ° má»™t cá»™t vá»›i cÃ¡c rÃ ng buá»™c duy nháº¥t vÃ  cÃ¡c giao dá»‹ch thÃªm cÃ¡c giÃ¡ trá»‹ trÃ¹ng láº·p)</li><li>Bá»Ÿi vÃ¬ báº¿ táº¯c</li></ul><h4 id="nhat-ky-log" tabindex="-1"><a class="header-anchor" href="#nhat-ky-log"><span>Nháº­t kÃ½ (Log)</span></a></h4><blockquote><p>ÄÃ´i khi (cháº³ng háº¡n nhÆ° lá»—i máº¡ng), cÆ¡ sá»Ÿ dá»¯ liá»‡u cÃ³ thá»ƒ khÃ´i phá»¥c giao dá»‹ch. LÃ m tháº¿ nÃ o Ä‘iá»u nÃ y cÃ³ thá»ƒ Ä‘Æ°á»£c? Äá»ƒ tráº£ lá»i cÃ¢u há»i nÃ y, chÃºng ta cáº§n pháº£i hiá»ƒu thÃ´ng tin Ä‘Æ°á»£c lÆ°u trong nháº­t kÃ½.</p></blockquote><p><strong>Má»—i hÃ nh Ä‘á»™ng (add/delete/modify) cá»§a giao dá»‹ch táº¡o ra má»™t log</strong> bao gá»“m:</p><ul><li>LSN: Má»™t sá»‘ sÃª-ri nháº­t kÃ½ duy nháº¥t (Log Sequence Number). LSN Ä‘Æ°á»£c phÃ¢n bá»• theo thá»© tá»± thá»i gian, cÃ³ nghÄ©a lÃ  náº¿u A hoáº¡t Ä‘á»™ng trÆ°á»›c B, LSN cá»§a log A nhá» hÆ¡n LSN cá»§a log B.</li><li>TransID: ID giao dá»‹ch táº¡o ra hÃ nh Ä‘á»™ng.</li><li>PageID: Vá»‹ trÃ­ cá»§a dá»¯ liá»‡u sá»­a Ä‘á»•i trÃªn disk. ÄÆ¡n vá»‹ nhá» nháº¥t cá»§a dá»¯ liá»‡u disk lÃ  má»™t trang, vÃ¬ váº­y vá»‹ trÃ­ cá»§a dá»¯ liá»‡u lÃ  nÆ¡i nÃ³ Ä‘ang á»Ÿ.</li><li>PrevLSN: LiÃªn káº¿t cuá»‘i cÃ¹ng Ä‘Æ°á»£c ghi láº¡i nháº­t kÃ½ Ä‘Æ°á»£c táº¡o ra bá»Ÿi cÃ¹ng má»™t giao dá»‹ch.</li><li>UNDO: PhÆ°Æ¡ng phÃ¡p há»§y bá» thao tÃ¡c nÃ y. VÃ­ dá»¥: náº¿u hÃ nh Ä‘á»™ng lÃ  cáº­p nháº­t, UNDO sáº½ hoáº·c lÆ°u cÃ¡c giÃ¡ trá»‹/tráº¡ng thÃ¡i pháº§n tá»­ trÆ°á»›c khi cáº­p nháº­t (physical UNDO), hoáº·c trá»Ÿ láº¡i hoáº¡t Ä‘á»™ng Ä‘áº£o ngÆ°á»£c cá»§a tráº¡ng thÃ¡i ban Ä‘áº§u (logical UNDO, chá»‰ sá»­ dá»¥ng UNDO logic vÃ¬ xá»­ lÃ½ physical UNDO quÃ¡ lá»™n xá»™n).</li><li>REDO: PhÆ°Æ¡ng phÃ¡p láº·p láº¡i hoáº¡t Ä‘á»™ng nÃ y. TÆ°Æ¡ng tá»± nhÆ° váº­y, cÃ³ 2 cÃ¡ch: hoáº·c lÆ°u giÃ¡ trá»‹ pháº§n tá»­ / tráº¡ng thÃ¡i sau khi hoáº¡t Ä‘á»™ng hoáº·c lÆ°u chÃ­nh hÃ nh Ä‘á»™ng Ä‘á»ƒ láº·p láº¡i.</li><li>â€¦ ğŸ˜¦ Ä‘á»ƒ báº¡n tham kháº£o, má»™t nháº­t kÃ½ ARIES cÅ©ng cÃ³ 2 trÆ°á»ng: UndoNxtLSN vÃ  Type).</li></ul><p>Má»—i trang trÃªn Ä‘Ä©a (lÆ°u dá»¯ liá»‡u, khÃ´ng pháº£i nháº­t kÃ½ Ä‘Æ°á»£c lÆ°u) ghi láº¡i LSN cuá»‘i cÃ¹ng sá»­a Ä‘á»•i hoáº¡t Ä‘á»™ng dá»¯ liá»‡u Ä‘Ã³.</p><blockquote><p>LÆ°u Ã½: Theo nhÆ° tÃ´i biáº¿t, chá»‰ PostgreSQL khÃ´ng sá»­ dá»¥ng UNDO mÃ  thay vÃ o Ä‘Ã³ sá»­ dá»¥ng dá»‹ch vá»¥ thu gom rÃ¡c Ä‘á»ƒ xÃ³a cÃ¡c phiÃªn báº£n cÅ© hÆ¡n cá»§a dá»¯ liá»‡u. Äiá»u nÃ y cÃ³ liÃªn quan Ä‘áº¿n viá»‡c thá»±c hiá»‡n kiá»ƒm soÃ¡t phiÃªn báº£n dá»¯ liá»‡u cá»§a PostgreSQL.</p></blockquote><p>Äá»ƒ minh há»a tá»‘t hÆ¡n Ä‘iá»u nÃ y, Ä‘iá»u nÃ y cÃ³ má»™t báº£n trÃ¬nh bÃ y ghi nháº­t kÃ½ Ä‘Æ¡n giáº£n Ä‘Æ°á»£c thá»±c hiá»‡n bá»Ÿi truy váº¥n &quot;<code>UPDATE FROM PERSON SET AGE = 18;</code>&quot; Káº¿t quáº£:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230605200014.png" alt="Pasted image 20230605200014" tabindex="0" loading="lazy"><figcaption>Pasted image 20230605200014</figcaption></figure><p>Má»—i nháº­t kÃ½ cÃ³ má»™t LSN duy nháº¥t, vÃ  cÃ¡c báº£n ghi Ä‘Æ°á»£c liÃªn káº¿t vá»›i nhau thuá»™c vá» cÃ¹ng má»™t giao dá»‹ch. Nháº­t kÃ½ Ä‘Æ°á»£c liÃªn káº¿t theo thá»© tá»± thá»i gian (nháº­t kÃ½ cuá»‘i cÃ¹ng cá»§a danh sÃ¡ch liÃªn káº¿t Ä‘Æ°á»£c táº¡o ra bá»Ÿi hÃ nh Ä‘á»™ng cuá»‘i cÃ¹ng).</p><h4 id="bo-Ä‘em-nhat-ky-log-buffer" tabindex="-1"><a class="header-anchor" href="#bo-Ä‘em-nhat-ky-log-buffer"><span>Bá»™ Ä‘á»‡m nháº­t kÃ½ (log buffer)</span></a></h4><blockquote><p>Äá»ƒ ngÄƒn cháº·n ghi nháº­t kÃ½ trá»Ÿ thÃ nh nÃºt tháº¯t cá»• chai chÃ­nh, cÆ¡ sá»Ÿ dá»¯ liá»‡u sá»­ dá»¥ng bá»™ Ä‘á»‡m nháº­t kÃ½.</p></blockquote><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted image 20230605200118.png" alt="Pasted image 20230605200118" tabindex="0" loading="lazy"><figcaption>Pasted image 20230605200118</figcaption></figure><p>Khi trÃ¬nh thá»±c thi truy váº¥n yÃªu cáº§u sá»­a Ä‘á»•i má»™t láº§n:</p><ol><li>TrÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache sáº½ sá»­a Ä‘á»•i Ä‘á»ƒ lÆ°u trá»¯ bá»™ Ä‘á»‡m cá»§a riÃªng mÃ¬nh</li><li>TrÃ¬nh quáº£n lÃ½ nháº­t kÃ½ lÆ°u trá»¯ cÃ¡c báº£n ghi cÃ³ liÃªn quan vÃ o bá»™ Ä‘á»‡m cá»§a riÃªng há»</li><li>Äáº¿n bÆ°á»›c nÃ y, trÃ¬nh thá»±c thi truy váº¥n tin ráº±ng thao tÃ¡c Ä‘Ã£ hoÃ n táº¥t (vÃ¬ váº­y báº¡n cÃ³ thá»ƒ yÃªu cáº§u sá»­a Ä‘á»•i khÃ¡c);</li><li>Sau Ä‘Ã³ (ngay sau Ä‘Ã³) trÃ¬nh quáº£n lÃ½ nháº­t kÃ½ ghi nháº­t kÃ½ vÃ o nháº­t kÃ½ giao dá»‹ch, thá»i Ä‘iá»ƒm ghinháº­t kÃ½ Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh bá»Ÿi má»™t thuáº­t toÃ¡n.</li><li>Sau Ä‘Ã³ (ngay sau Ä‘Ã³) trÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache ghi cÃ¡c sá»­a Ä‘á»•i vÃ o disk vÃ  thá»i Ä‘iá»ƒm ghi vÃ o disk Ä‘Æ°á»£c Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh bá»Ÿi má»™t thuáº­t toÃ¡n.</li></ol><p><strong>Khi giao dá»‹ch Ä‘Æ°á»£c cam káº¿t, Ä‘iá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  5 bÆ°á»›c cá»§a má»—i hoáº¡t Ä‘á»™ng cá»§a giao dá»‹ch Ä‘Ã£ Ä‘Æ°á»£c hoÃ n thÃ nh</strong>. Viáº¿t nháº­t kÃ½ giao dá»‹ch ráº¥t nhanh vÃ¬ nÃ³ chá»‰ Ä‘Æ¡n giáº£n lÃ  &quot;thÃªm má»™t báº£n ghi á»Ÿ Ä‘Ã¢u Ä‘Ã³ trong nháº­t kÃ½ giao dá»‹ch&quot;; VÃ  ghi dá»¯ liá»‡u vÃ o disk phá»©c táº¡p hÆ¡n, bá»Ÿi vÃ¬ nÃ³ cáº§n pháº£i &quot;ghi dá»¯ liá»‡u báº±ng má»™t cÃ¡ch Ä‘á»ƒ cÃ³ thá»ƒ Ä‘á»c nhanh chÃ³ng&quot;.</p><h4 id="steal-and-force-strategies" tabindex="-1"><a class="header-anchor" href="#steal-and-force-strategies"><span>STEAL and FORCE strategies</span></a></h4><blockquote><p>VÃ¬ lÃ½ do hiá»‡u suáº¥t, <strong>BÆ°á»›c 5 cÃ³ thá»ƒ Ä‘Æ°á»£c hoÃ n thÃ nh sau khi cam káº¿t</strong>, bá»Ÿi vÃ¬ trong trÆ°á»ng há»£p xáº£y ra sá»± cá»‘, cÅ©ng cÃ³ thá»ƒ khÃ´i phá»¥c giao dá»‹ch vá»›i nháº­t kÃ½ REDO. Äiá»u nÃ y Ä‘Æ°á»£c gá»i lÃ  <strong>chÃ­nh sÃ¡ch NO-FORCE</strong>.</p></blockquote><p>CÆ¡ sá»Ÿ dá»¯ liá»‡u cÃ³ thá»ƒ chá»n chÃ­nh sÃ¡ch FORCE, cháº³ng háº¡n nhÆ° bÆ°á»›c 5 pháº£i Ä‘Æ°á»£c hoÃ n thÃ nh trÆ°á»›c khi cam káº¿t, Ä‘á»ƒ giáº£m táº£i khi phá»¥c há»“i.</p><p>Má»™t cÃ¢u há»i khÃ¡c lÃ  <strong>Ä‘á»ƒ chá»n xem dá»¯ liá»‡u lÃ  ghi tá»«ng bÆ°á»›c (chÃ­nh sÃ¡ch STEAL) hoáº·c ngÆ°á»i quáº£n lÃ½ bá»™ Ä‘á»‡m cáº§n pháº£i chá» Ä‘á»£i cho cÃ¡c lá»‡nh cam káº¿t Ä‘á»ƒ ghi táº¥t cáº£ cÃ¹ng má»™t lÃºc (chÃ­nh sÃ¡ch NO-STEAL</strong>). Chá»n STEAL hay NO-STEAL phá»¥ thuá»™c vÃ o nhá»¯ng gÃ¬ báº¡n muá»‘n: viáº¿t nhanh nhÆ°ng phá»¥c há»“i cháº­m tá»« nháº­t kÃ½ UNDO hoáº·c khÃ´i phá»¥c nhanh chÃ³ng.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  tÃ¡c Ä‘á»™ng cá»§a cÃ¡c chÃ­nh sÃ¡ch nÃ y Ä‘á»‘i vá»›i phá»¥c há»“i:</p><ul><li><strong>STEAL/NO-FORCE yÃªu cáº§u UNDO vÃ  REDO: hiá»‡u suáº¥t cao</strong>, nhÆ°ng cÃ¡c quy trÃ¬nh nháº­t kÃ½ vÃ  phá»¥c há»“i phá»©c táº¡p hÆ¡n (vÃ­ dá»¥: ARIES). Háº§u háº¿t cÃ¡c cÆ¡ sá»Ÿ dá»¯ liá»‡u chá»n chÃ­nh sÃ¡ch nÃ y. LÆ°u Ã½: ÄÃ¢y lÃ  nhá»¯ng gÃ¬ tÃ´i tháº¥y tá»« nhiá»u bÃ i bÃ¡o há»c thuáº­t vÃ  hÆ°á»›ng dáº«n, nhÆ°ng tÃ´i khÃ´ng tháº¥y Ä‘iá»u nÃ y rÃµ rÃ ng trong tÃ i liá»‡u chÃ­nh thá»©c.</li><li>STEAL/ FORCE chá»‰ cáº§n UNDO.</li><li>NO-STEAL/NO-FORCE chá»‰ cáº§n REDO.</li><li>NO-STEAL/FORCE khÃ´ng cáº§n báº¥t cá»© Ä‘iá»u gÃ¬: hiá»‡u suáº¥t tá»“i tá»‡ nháº¥t vÃ  yÃªu cáº§u bá»™ nhá»› ráº¥t lá»›n.</li></ul><h4 id="ve-phuc-hoi-recovery" tabindex="-1"><a class="header-anchor" href="#ve-phuc-hoi-recovery"><span>Vá» phá»¥c há»“i (recovery)</span></a></h4><blockquote><p>Ok, vá»›i nháº­t kÃ½ tá»‘t, chÃºng ta hÃ£y sá»­ dá»¥ng chÃºng!</p></blockquote><p>Giáº£ sá»­ thá»±c táº­p sinh má»›i lÃ m cho cÆ¡ sá»Ÿ dá»¯ liá»‡u sá»¥p Ä‘á»•, báº¡n khá»Ÿi Ä‘á»™ng láº¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u vÃ  quÃ¡ trÃ¬nh phá»¥c há»“i báº¯t Ä‘áº§u.</p><p>ARIES phá»¥c há»“i tá»« sá»± cá»‘ cÃ³ ba giai Ä‘oáº¡n:</p><ul><li><ol><li><strong>Giai Ä‘oáº¡n phÃ¢n tÃ­ch</strong>: QuÃ¡ trÃ¬nh phá»¥c há»“i Ä‘á»c táº¥t cáº£ cÃ¡c báº£n ghi giao dá»‹ch Ä‘á»ƒ xÃ¢y dá»±ng láº¡i dÃ²ng thá»i gian cá»§a nhá»¯ng gÃ¬ Ä‘Ã£ xáº£y ra trong quÃ¡ trÃ¬nh sá»¥p Ä‘á»•, quyáº¿t Ä‘á»‹nh giao dá»‹ch nÃ o sáº½ rollback (táº¥t cáº£ cÃ¡c giao dá»‹ch chÆ°a Ä‘Æ°á»£c gá»­i pháº£i rollback), dá»¯ liá»‡u nÃ o cáº§n pháº£i Ä‘Æ°á»£c viáº¿t khi tai náº¡n.</li></ol></li><li><ol start="2"><li><strong>Giai Ä‘oáº¡n Redo</strong>: Cáº¥p Ä‘á»™ nÃ y báº¯t Ä‘áº§u vá»›i má»™t báº£n ghi nháº­t kÃ½ Ä‘Æ°á»£c chá»n trong phÃ¢n tÃ­ch, sá»­ dá»¥ng REDO Ä‘á»ƒ khÃ´i phá»¥c cÆ¡ sá»Ÿ dá»¯ liá»‡u vá» tráº¡ng thÃ¡i trÆ°á»›c khi sá»¥p Ä‘á»•.</li></ol><ul><li>Trong giai Ä‘oáº¡n REDO, nháº­t kÃ½ REDO Ä‘Æ°á»£c xá»­ lÃ½ theo thá»© tá»± thá»i gian (sá»­ dá»¥ng LSN).</li><li>Äá»‘i vá»›i má»—i nháº­t kÃ½, quÃ¡ trÃ¬nh phá»¥c há»“i Ä‘Ã²i há»i pháº£i Ä‘á»c LSN trang Ä‘Ä©a cÃ³ chá»©a dá»¯ liá»‡u.</li><li>Náº¿u LSN (trang Ä‘Ä©a) &gt; = LSN (ghi nháº­t kÃ½), dá»¯ liá»‡u Ä‘Ã£ Ä‘Æ°á»£c ghi vÃ o Ä‘Ä©a trÆ°á»›c khi sá»¥p Ä‘á»• (nhÆ°ng giÃ¡ trá»‹ Ä‘Ã£ Ä‘Æ°á»£c ghi Ä‘Ã¨ bá»Ÿi má»™t hÃ nh Ä‘á»™ng sau nháº­t kÃ½ vÃ  trÆ°á»›c khi sá»¥p Ä‘á»•), vÃ¬ váº­y khÃ´ng cáº§n pháº£i lÃ m gÃ¬.</li><li>Náº¿u LSN (trang Ä‘Ä©a) &lt; LSN (ghi nháº­t kÃ½), cÃ¡c trang trÃªn Ä‘Ä©a sáº½ Ä‘Æ°á»£c cáº­p nháº­t.</li><li>Ngay cáº£ khi cÃ¡c giao dá»‹ch Ä‘Æ°á»£c rollback, REDO sáº½ lÃ m Ä‘iá»u Ä‘Ã³ vÃ¬ nÃ³ Ä‘Æ¡n giáº£n hÃ³a quÃ¡ trÃ¬nh phá»¥c há»“i (nhÆ°ng tÃ´i tin ráº±ng cÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n Ä‘áº¡i sáº½ khÃ´ng lÃ m Ä‘iá»u Ä‘Ã³).</li></ul></li><li><ol start="3"><li><strong>Giai Ä‘oáº¡n Undo</strong>: Giai Ä‘oáº¡n nÃ y rollback táº¥t cáº£ cÃ¡c giao dá»‹ch chÆ°a hoÃ n thÃ nh khi tai náº¡n. rollback báº¯t Ä‘áº§u vá»›i nháº­t kÃ½ cuá»‘i cÃ¹ng cá»§a má»—i giao dá»‹ch vÃ  xá»­ lÃ½ nháº­t kÃ½ UNSO theo thá»© tá»± Ä‘áº£o ngÆ°á»£c thá»i gian (prevLSN Ä‘Æ°á»£c ghi láº¡i báº±ng nháº­t kÃ½).</li></ol></li></ul><p>Trong quÃ¡ trÃ¬nh phá»¥c há»“i, nháº­t kÃ½ giao dá»‹ch pháº£i chÃº Ã½ Ä‘áº¿n cÃ¡c hoáº¡t Ä‘á»™ng cá»§a quÃ¡ trÃ¬nh phá»¥c há»“i Ä‘á»ƒ dá»¯ liá»‡u ghi vÃ o Ä‘Ä©a phÃ¹ há»£p vá»›i nháº­t kÃ½ giao dá»‹ch. Má»™t giáº£i phÃ¡p lÃ  loáº¡i bá» cÃ¡c báº£n ghi nháº­t kÃ½ Ä‘Æ°á»£c táº¡o ra bá»Ÿi cÃ¡c giao dá»‹ch bá»‹ há»§y bá», nhÆ°ng Ä‘iá»u nÃ y lÃ  quÃ¡ khÃ³ khÄƒn. Thay vÃ o Ä‘Ã³, ARIES ghi láº¡i nháº­t kÃ½ bÃ¹ trong nháº­t kÃ½ giao dá»‹ch Ä‘á»ƒ loáº¡i bá» há»£p lÃ½ cÃ¡c báº£n ghi nháº­t kÃ½ cho cÃ¡c giao dá»‹ch bá»‹ há»§y bá».</p><p>Khi giao dá»‹ch bá»‹ há»§y bá» báº±ng tay hoáº·c bá»‹ há»§y bá» bá»Ÿi ngÆ°á»i quáº£n lÃ½ khÃ³a (Ä‘á»ƒ loáº¡i bá» báº¿ táº¯c), hoáº·c chá»‰ vÃ¬ lá»—i máº¡ng, giai Ä‘oáº¡n phÃ¢n tÃ­ch khÃ´ng cáº§n thiáº¿t. Äá»‘i vá»›i nhá»¯ng gÃ¬ cáº§n REDO cáº§n thÃ´ng tin UNDO trong 2 báº£ng bá»™ nhá»›:</p><ul><li>Báº£ng giao dá»‹ch (lÆ°u tráº¡ng thÃ¡i cá»§a táº¥t cáº£ cÃ¡c giao dá»‹ch hiá»‡n táº¡i)</li><li>Báº£ng trang báº©n (dá»¯ liá»‡u nÃ o cáº§n Ä‘Æ°á»£c ghi vÃ o Ä‘Ä©a)</li></ul><p>Khi má»™t giao dá»‹ch má»›i Ä‘Æ°á»£c táº¡o ra, cáº£ hai báº£ng Ä‘Æ°á»£c cáº­p nháº­t bá»Ÿi trÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache vÃ  trÃ¬nh quáº£n lÃ½ giao dá»‹ch. Bá»Ÿi vÃ¬ nÃ³ náº±m trong bá»™ nhá»›, chÃºng cÅ©ng bá»‹ phÃ¡ há»§y khi cÆ¡ sá»Ÿ dá»¯ liá»‡u sá»¥p Ä‘á»•.</p><p>Nhiá»‡m vá»¥ cá»§a giai Ä‘oáº¡n phÃ¢n tÃ­ch lÃ  xÃ¢y dá»±ng láº¡i hai báº£ng trÃªn vá»›i thÃ´ng tin trong nháº­t kÃ½ giao dá»‹ch sau khi sá»¥p Ä‘á»•. Äá»ƒ Ä‘áº©y nhanh giai Ä‘oáº¡n phÃ¢n tÃ­ch, ARIES Ä‘Æ°a ra má»™t khÃ¡i niá»‡m: <strong>check point</strong>, thá»‰nh thoáº£ng ghi ná»™i dung cá»§a báº£ng giao dá»‹ch vÃ  báº£ng trang báº©n vÃ  LSN cuá»‘i cÃ¹ng vÃ o Ä‘Ä©a. VÃ¬ váº­y, trong giai Ä‘oáº¡n phÃ¢n tÃ­ch, chá»‰ cáº§n phÃ¢n tÃ­ch nháº­t kÃ½ sau LSN nÃ y.</p>`,357),l=[a];function g(o,s){return h(),t("div",null,l)}const u=n(c,[["render",g],["__file","how-sql-db-works.html.vue"]]),e=JSON.parse('{"path":"/database/sql/how-sql-db-works.html","title":"How SQL DB works?","lang":"en-US","frontmatter":{"title":"How SQL DB works?","tags":["sql"],"categories":["sql"],"date created":"2023-06-04T00:00:00.000Z","date modified":"2023-07-20T00:00:00.000Z","icon":"mdi:sql-query","order":2,"description":"Báº¯t Ä‘áº§u vá»›i Data Structure & Algorithm Äá»™ phá»©c táº¡p thá»i gian Äá»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u, Ä‘iá»u quan trá»ng khÃ´ng pháº£i lÃ  khá»‘i lÆ°á»£ng dá»¯ liá»‡u, mÃ  lÃ  lÃ m tháº¿ nÃ o cÃ¡c hoáº¡t Ä‘á»™ng tÄƒng lÃªn kh...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/database/sql/how-sql-db-works.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"How SQL DB works?"}],["meta",{"property":"og:description","content":"Báº¯t Ä‘áº§u vá»›i Data Structure & Algorithm Äá»™ phá»©c táº¡p thá»i gian Äá»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u, Ä‘iá»u quan trá»ng khÃ´ng pháº£i lÃ  khá»‘i lÆ°á»£ng dá»¯ liá»‡u, mÃ  lÃ  lÃ m tháº¿ nÃ o cÃ¡c hoáº¡t Ä‘á»™ng tÄƒng lÃªn kh..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604124944.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-28T15:54:38.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"sql"}],["meta",{"property":"article:modified_time","content":"2024-06-28T15:54:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"How SQL DB works?\\",\\"image\\":[\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604124944.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604125929.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604130525.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604200445.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604203453.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604205032.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604214715.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604215931.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604220538.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604232022.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604232659.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230604234649.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230605010909.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230605011404.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230605013007.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230605020105.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230605200014.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/Pasted%20image%2020230605200118.png\\"],\\"dateModified\\":\\"2024-06-28T15:54:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Báº¯t Ä‘áº§u vá»›i Data Structure & Algorithm","slug":"bat-Ä‘au-voi-data-structure-algorithm","link":"#bat-Ä‘au-voi-data-structure-algorithm","children":[{"level":3,"title":"Äá»™ phá»©c táº¡p thá»i gian","slug":"Ä‘o-phuc-tap-thoi-gian","link":"#Ä‘o-phuc-tap-thoi-gian","children":[]},{"level":3,"title":"[[Merge Sort]]","slug":"merge-sort","link":"#merge-sort","children":[]},{"level":3,"title":"[[Binary Search Tree]]","slug":"binary-search-tree","link":"#binary-search-tree","children":[]},{"level":3,"title":"[[B Tree]]","slug":"b-tree","link":"#b-tree","children":[]},{"level":3,"title":"Hash Table","slug":"hash-table","link":"#hash-table","children":[]}]},{"level":2,"title":"Tá»•ng quan SQL DB","slug":"tong-quan-sql-db","link":"#tong-quan-sql-db","children":[{"level":3,"title":"CÃ¡c thÃ nh pháº§n cá»‘t lÃµi (Core Components)","slug":"cac-thanh-phan-cot-loi-core-components","link":"#cac-thanh-phan-cot-loi-core-components","children":[]},{"level":3,"title":"CÃ´ng cá»¥ (Tools)","slug":"cong-cu-tools","link":"#cong-cu-tools","children":[]},{"level":3,"title":"TrÃ¬nh quáº£n lÃ½ truy váº¥n (Query Manager)","slug":"trinh-quan-ly-truy-van-query-manager","link":"#trinh-quan-ly-truy-van-query-manager","children":[]},{"level":3,"title":"TrÃ¬nh quáº£n lÃ½ dá»¯ liá»‡u (Data Manager)","slug":"trinh-quan-ly-du-lieu-data-manager","link":"#trinh-quan-ly-du-lieu-data-manager","children":[]}]},{"level":2,"title":"QuÃ¡ trÃ¬nh truy váº¥n dá»¯ liá»‡u","slug":"qua-trinh-truy-van-du-lieu","link":"#qua-trinh-truy-van-du-lieu","children":[]},{"level":2,"title":"TrÃ¬nh quáº£n lÃ½ khÃ¡ch hÃ ng (Client Manager)","slug":"trinh-quan-ly-khach-hang-client-manager","link":"#trinh-quan-ly-khach-hang-client-manager","children":[]},{"level":2,"title":"TrÃ¬nh quáº£n lÃ½ truy váº¥n","slug":"trinh-quan-ly-truy-van","link":"#trinh-quan-ly-truy-van","children":[{"level":3,"title":"TrÃ¬nh phÃ¢n tÃ­ch cÃº phÃ¡p truy váº¥n (Query Parser)","slug":"trinh-phan-tich-cu-phap-truy-van-query-parser","link":"#trinh-phan-tich-cu-phap-truy-van-query-parser","children":[]},{"level":3,"title":"TrÃ¬nh viáº¿t láº¡i truy váº¥n bá»™ (Query Rewriter)","slug":"trinh-viet-lai-truy-van-bo-query-rewriter","link":"#trinh-viet-lai-truy-van-bo-query-rewriter","children":[]},{"level":3,"title":"Thá»‘ng kÃª","slug":"thong-ke","link":"#thong-ke","children":[]},{"level":3,"title":"TrÃ¬nh tá»‘i Æ°u hÃ³a truy váº¥n (Query optimizer)","slug":"trinh-toi-uu-hoa-truy-van-query-optimizer","link":"#trinh-toi-uu-hoa-truy-van-query-optimizer","children":[]},{"level":3,"title":"TrÃ¬nh thá»±c thi truy váº¥n (Query Excuter)","slug":"trinh-thuc-thi-truy-van-query-excuter","link":"#trinh-thuc-thi-truy-van-query-excuter","children":[]}]},{"level":2,"title":"TrÃ¬nh quáº£n lÃ½ dá»¯ liá»‡u","slug":"trinh-quan-ly-du-lieu","link":"#trinh-quan-ly-du-lieu","children":[{"level":3,"title":"TrÃ¬nh quáº£n lÃ½ bá»™ nhá»› cache (Cache Manager)","slug":"trinh-quan-ly-bo-nho-cache-cache-manager","link":"#trinh-quan-ly-bo-nho-cache-cache-manager","children":[]},{"level":3,"title":"TrÃ¬nh quáº£n lÃ½ giao dá»‹ch (Transaction Manager)","slug":"trinh-quan-ly-giao-dich-transaction-manager","link":"#trinh-quan-ly-giao-dich-transaction-manager","children":[]},{"level":3,"title":"Kiá»ƒm soÃ¡t Ä‘á»“ng thá»i (Concurrency Control)","slug":"kiem-soat-Ä‘ong-thoi-concurrency-control","link":"#kiem-soat-Ä‘ong-thoi-concurrency-control","children":[]},{"level":3,"title":"TrÃ¬nh quáº£n lÃ½ khÃ³a (Lock Manager)","slug":"trinh-quan-ly-khoa-lock-manager","link":"#trinh-quan-ly-khoa-lock-manager","children":[]},{"level":3,"title":"TrÃ¬nh quáº£n lÃ½ nháº­t kÃ½ (Log Manager)","slug":"trinh-quan-ly-nhat-ky-log-manager","link":"#trinh-quan-ly-nhat-ky-log-manager","children":[]}]}],"git":{"createdTime":1719590078000,"updatedTime":1719590078000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":65.14,"words":19542},"filePathRelative":"database/sql/how-sql-db-works.md","localizedDate":"June 28, 2024","excerpt":"<h2>Báº¯t Ä‘áº§u vá»›i Data Structure &amp; Algorithm</h2>\\n<h3>Äá»™ phá»©c táº¡p thá»i gian</h3>\\n<blockquote>\\n<p>Äá»‘i vá»›i cÆ¡ sá»Ÿ dá»¯ liá»‡u, Ä‘iá»u quan trá»ng khÃ´ng pháº£i lÃ  khá»‘i lÆ°á»£ng dá»¯ liá»‡u, mÃ  lÃ  lÃ m tháº¿ nÃ o cÃ¡c hoáº¡t Ä‘á»™ng tÄƒng lÃªn khi khá»‘i lÆ°á»£ng dá»¯ liá»‡u tÄƒng lÃªn.</p>\\n</blockquote>\\n<p>Äá»™ phá»©c táº¡p thuáº­t toÃ¡n kÃ©o theo Ä‘á»™ phá»©c táº¡p thá»i gian (time complexity) vÃ  Ä‘á»™ phá»©c táº¡p khÃ´ng gian (space complexity). Vui lÃ²ng Ä‘á»c [[Complexity Analysis]]</p>","autoDesc":true}');export{u as comp,e as data};
