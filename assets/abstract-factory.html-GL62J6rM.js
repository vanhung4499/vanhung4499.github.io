import{_ as s,o as a,c as n,d as i}from"./app-B-9Tvu0g.js";const l={},r=i(`<h1 id="abstract-factory-pattern-nang-cap-redis-cluster-kep-su-dung-abstract-proxy" tabindex="-1"><a class="header-anchor" href="#abstract-factory-pattern-nang-cap-redis-cluster-kep-su-dung-abstract-proxy"><span>Abstract Factory Pattern: Nâng cấp Redis Cluster kép, sử dụng abstract proxy</span></a></h1><h2 id="gioi-thieu" tabindex="-1"><a class="header-anchor" href="#gioi-thieu"><span>Giới thiệu</span></a></h2><p><strong>Code lộn xộn và anh phải chịu trách nhiệm.</strong></p><p>Hầu hết các lập trình viên đều muốn viết code tốt, ngoài việc lập trình là công việc, họ cũng là những người có tinh thần nghề nghiệp. Nhưng nhiều lúc lại khó để bạn giữ vững điều này, giống như: nhận một dự án tệ, chức năng sản phẩm cần gấp, khả năng cá nhân không đủ, và nhiều lý do khác dẫn đến mã nguồn của dự án nặng nề, thường xuyên gặp sự cố, cuối cùng phải từ chức rời đi.</p><p><strong>Đọc nhiều sách, học nhiều kiến thức, đa luồng có thể làm màu mè, nhưng cuối cùng tôi vẫn không viết được mã nguồn tốt!</strong></p><p>Điều này hơi giống việc bạn mua đồ sau khi sửa sang lại ngôi nhà của mình, chiếc ghế sofa gỗ thực sự hàng trăm triệu, nhưng đặt ở đây nó không đẹp. Mãi mãi viết code tệ không nhất thiết là do kiến thức cơ bản không đủ, cũng không nhất thiết là vì &quot;Chức năng cần gấp, tôi không quan tâm đến việc triển khai ngày mai.&quot; Thực tế, nhiều lúc là vì kinh nghiệm lập trình của chúng ta còn hạn chế và khả năng kiểm soát kiến trúc không đủ, tôi tin rằng nhu cầu đầu tiên của sản phẩm thường không phức tạp, thậm chí là thấy và hiểu được. Nhưng nếu bạn không xem xét xem sau này sẽ mở rộng ra sao, bạn sẽ thêm các chức năng vào các module nào, thì mã nguồn sau này sẽ bắt đầu lan rộng từ hạt giống tệ đầu tiên bạn đã gieo.</p><p><strong>Kinh nghiệm của bạn khi học các mẫu thiết kế là gì cũng như cách tìm hiểu và sử dụng chúng!</strong></p><p>Các cuốn sách về mẫu thiết kế, hơi giống như giấy phép lái xe của bạn, hướng dẫn trang trí nhà hoặc sách hướng dẫn hẹn hò cho người độc thân. Nhưng! Nếu bạn không áp dụng vào thực tế, bạn chắc chắn sẽ làm cho mã nguồn trở nên <strong>lộn xộn và khó hiểu</strong>. Bởi vì những suy nghĩ hướng dẫn này được trích xuất từ kinh nghiệm thực tế, không có kinh nghiệm lập trình mới có thể nắm bắt được kiến thức như vậy. Vì vậy, trong quá trình học, trước tiên bạn cần có các trường hợp, sau đó kết hợp các trường hợp với công việc thực tế của bạn, thử nghiệm và cải thiện từng bước, từ đó cảm nhận được cảm xúc bên trong và cuối cùng học cách xây dựng mã nguồn tốt.</p><h2 id="moi-truong-phat-trien" tabindex="-1"><a class="header-anchor" href="#moi-truong-phat-trien"><span>Môi trường phát triển</span></a></h2><ol><li>JDK 1.8</li><li>Idea + Maven</li><li>Code: <a href="https://github.com/vanhung4499/practical-java-design" target="_blank" rel="noopener noreferrer">vanhung4499/practical-java-design</a></li></ol><table><thead><tr><th>Dự án</th><th>Mô tả</th></tr></thead><tbody><tr><td>demo-design-2-00</td><td>Dự án mô phỏng, giả lập việc nâng cấp từ Redis lên cụm khiến cần phải sửa đổi các lớp</td></tr><tr><td>demo-design-2-01</td><td>Sử dụng một đống mã để thực hiện yêu cầu kinh doanh, cũng là sử dụng if-else</td></tr><tr><td>demo-design-2-02</td><td>Tối ưu và cải thiện mã thông qua thiết kế mẫu, tạo ra sự so sánh để học hỏi</td></tr></tbody></table><h2 id="gioi-thieu-ve-abstract-factory-pattern" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-ve-abstract-factory-pattern"><span>Giới thiệu về Abstract Factory Pattern</span></a></h2><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240326130330.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Factory Pattern và Factory Method Pattern mặc dù chủ yếu đều nhằm giải quyết vấn đề <strong>chọn interface</strong>. Nhưng trong cách triển khai, Abstract Factory Pattern là một nhà máy trung tâm, tạo ra các nhà máy khác.</p><p>Có thể trong công việc lập trình hàng ngày, bạn ít quan tâm đến các mẫu thiết kế như vậy hoặc cấu trúc mã tương tự, nhưng tình huống như vậy luôn hiện diện xung quanh chúng ta, ví dụ như:</p><ol><li><p>Sự khác biệt trong việc xuống dòng trên các hệ thống khác nhau</p><ol><li>Trong hệ điều hành Unix, mỗi dòng kết thúc chỉ có <strong>&lt;xuống dòng&gt;</strong>, tức là <code>\\n</code>;</li><li>Trong hệ điều hành Windows, mỗi dòng kết thúc là <strong>&lt;xuống dòng&gt;&lt;về đầu dòng&gt;</strong>, tức là <code>\\n\\r</code>;</li><li>Trong hệ điều hành Mac, mỗi dòng kết thúc là <strong>&lt;về đầu dòng&gt;</strong></li></ol></li><li><p>Sự khác biệt trong giao diện của Inteliji IDEA (Win\\Mac)</p></li></ol><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240326130915.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p><strong>Ngoài những ví dụ rõ ràng như vậy, chúng ta thường xuyên gặp phải các vấn đề tương tự trong phát triển doanh nghiệp và cần phải xử lý tương thích.</strong> Nhưng đa số những lập trình viên thiếu kinh nghiệm thường dễ dàng thêm các điều kiện <code>ifelse</code> để xử lý.</p><h2 id="mo-phong-kich-ban-tinh-huong" tabindex="-1"><a class="header-anchor" href="#mo-phong-kich-ban-tinh-huong"><span>Mô phỏng kịch bản tình huống</span></a></h2><p><code>Đôi khi sự phát triển sơ khai của doanh nghiệp ở giai đoạn đầu cũng làm cho việc xây dựng hệ thống trở nên quan trọng.</code></p><p>Các ước lượng <strong>QPS thấp</strong>, <strong>áp lực hệ thống nhỏ</strong>, <strong>lưu lượng truy cập không lớn</strong>, <strong>không có nhiều thay đổi lớn trong vòng gần một năm</strong>, v.v được khảo sát trước khi xem xét về thời gian và chi phí đầu tư, thường sẽ không đầu tư nhiều nguồn lực để xây dựng một hệ thống thật hoàn chỉnh. Chỉ cần sử dụng một <code>Redis</code> đơn lẻ có thể đáp ứng được tình hình hiện tại.</p><p><code>Không tự hào về việc nói rằng, ngày mới học tôi có thể xây trang chủ Google trong một ngày. Nhưng khi tôi đủ nhận thức, dù có cho tôi chục năm cũng không thể hoàn thành!</code></p><p>Nhưng với sự phát triển nhanh chóng của doanh nghiệp vượt xa những gì dự kiến, khả năng tải của hệ thống cũng cần phải được nâng cao theo. Redis đơn lẻ hiện tại không đáp ứng được yêu cầu của hệ thống. Lúc này, cần phải chuyển đổi sang một dịch vụ Redis cụ thể hơn, mặc dù việc này cần sửa đổi nhưng không thể ảnh hưởng đến hoạt động của hệ thống hiện tại và phải chuyển qua một cách suôn sẻ.</p><p>Với việc nâng cấp này, các vấn đề có thể dự kiến sẽ có:</p><ol><li>Nhiều dịch vụ sử dụng Redis cần được nâng cấp cùng một cụm Redis.</li><li>Cần tương thích với cụm A và cụm B, để dễ dàng sao lưu trong tương lai.</li><li>Hai cụm cung cấp các interface và method khác nhau, cần phải thực hiện điều chỉnh.</li><li>Không được ảnh hưởng đến hệ thống đang hoạt động bình thường hiện tại.</li></ol><h3 id="du-an-mo-phong-kich-ban" tabindex="-1"><a class="header-anchor" href="#du-an-mo-phong-kich-ban"><span>Dự án mô phỏng kịch bản</span></a></h3><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">design-demo-2-00/</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> pom.xml</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">└──</span><span style="color:#98C379;--shiki-dark:#98C379;"> src</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> main</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> com</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> hnv99</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> design</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                        ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> CacheService.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                        ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> RedisUtils.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                        ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> cuisine</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                        │  </span><span style="color:#98C379;--shiki-dark:#98C379;"> └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> impl</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                        │  </span><span style="color:#98C379;--shiki-dark:#98C379;">     └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> CacheServiceImpl.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                        └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> matter</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                            ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> EGM.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                            └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> IIR.java</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tom-tat-tinh-huong" tabindex="-1"><a class="header-anchor" href="#tom-tat-tinh-huong"><span>Tóm tắt tình huống</span></a></h3><h4 id="mo-phong-dich-vu-redis-đon" tabindex="-1"><a class="header-anchor" href="#mo-phong-dich-vu-redis-đon"><span>Mô phỏng Dịch vụ Redis đơn</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> RedisUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">RedisUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> dataMap </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ConcurrentHashMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Redis lấy dữ liệu key：{}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, key);  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> dataMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Redis ghi dữ liệu key：{} val：{}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, key, value);  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        dataMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TimeUnit</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Redis ghi dữ liệu key：{} val：{} timeout：{} timeUnit：{}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, key, value, timeout, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">timeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        dataMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Redis xóa dữ liệu key：{}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, key);  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        dataMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Mô phỏng chức năng của Redis, tức là giả định rằng tất cả các hệ thống hiện tại đang sử dụng dịch vụ này.</li><li>Tên lớp và phương thức đã cố định được sử dụng trong từng hệ thống kinh doanh, việc thay đổi đôi khi hơi phức tạp.</li></ul><h4 id="mo-phong-cum-egm" tabindex="-1"><a class="header-anchor" href="#mo-phong-cum-egm"><span>Mô phỏng Cụm EGM</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> EGM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">EGM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> dataMap </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ConcurrentHashMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> gain</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;EGM lấy dữ liệu key：{}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, key);  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> dataMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;EGM ghi dữ liệu key：{} val：{}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, key, value);  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        dataMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> setEx</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TimeUnit</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;EGM ghi dữ liệu key：{} val：{} timeout：{} timeUnit：{}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, key, value, timeout, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">timeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        dataMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> delete</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;EGM xóa dữ liệu key：{}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, key);  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        dataMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Mô phỏng một dịch vụ cụm, nhưng tên phương thức không giống với các phương thức được sử dụng trong từng hệ thống kinh doanh. Giống như bạn sử dụng macOS, tôi sử dụng Windows. Cùng làm một việc nhưng lại có cách thực hiện khác nhau.</li></ul><h4 id="mo-phong-cum-iir" tabindex="-1"><a class="header-anchor" href="#mo-phong-cum-iir"><span>Mô phỏng Cụm IIR</span></a></h4><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> IIR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Logger</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> logger </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> LoggerFactory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getLogger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">IIR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> dataMap </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ConcurrentHashMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;IIR lấy dữ liệu key：{}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, key);  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> dataMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;IIR ghi dữ liệu key：{} val：{}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, key, value);  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        dataMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> setExpire</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TimeUnit</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;IIR ghi dữ liệu key：{} val：{} timeout：{} timeUnit：{}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, key, value, timeout, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">timeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toString</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        dataMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        logger</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;IIR xóa dữ liệu key：{}&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, key);  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        dataMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">remove</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Đây là một dịch vụ cụm khác, đôi khi trong quá trình phát triển doanh nghiệp có thể có hai dịch vụ cụm khác nhau. Ở đây, chúng tôi cũng đang tạo ra một ví dụ mô phỏng, vì vậy chúng tôi đã thêm hai dịch vụ cung cấp cùng một chức năng nhưng khác nhau, để học về Abstract Factory Pattern.</li></ul><p>Tóm lại, trong hệ thống hiện tại của chúng ta, đã có sử dụng dịch vụ Redis một cách rộng rãi. Tuy nhiên, do hệ thống không đáp ứng được sự phát triển nhanh chóng của kinh doanh, vì vậy cần chuyển sang sử dụng dịch vụ cụm. Khi đó, có hai dịch vụ cụm cần phải tương thích, và đồng thời phải đảm bảo sự thay đổi của tất cả các hệ thống kinh doanh mà không ảnh hưởng đến việc sử dụng trực tuyến.</p><h2 id="su-dung-dich-vu-đon-cum" tabindex="-1"><a class="header-anchor" href="#su-dung-dich-vu-đon-cum"><span>Sử dụng dịch vụ đơn cụm</span></a></h2><p>Dưới đây là cách sử dụng dịch vụ Redis đơn cụm trong mô phỏng hiện tại, và sau này sẽ thay đổi mã nguồn ở đây.</p><h3 id="đinh-nghia-interface" tabindex="-1"><a class="header-anchor" href="#đinh-nghia-interface"><span>Định nghĩa interface</span></a></h3><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> CacheService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">final</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TimeUnit</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><h3 id="trien-khai" tabindex="-1"><a class="header-anchor" href="#trien-khai"><span>Triển khai</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> CacheServiceImpl</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> CacheService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> RedisUtils</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> redisUtils </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> RedisUtils</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> redisUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        redisUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TimeUnit</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        redisUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value, timeout, timeUnit);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        redisUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Hiện tại mã nguồn cho việc sử dụng dịch vụ Redis đơn cụm trong tình huống hiện tại không có vấn đề gì và khá đơn giản. Tuy nhiên, khi tất cả các hệ thống kinh doanh đều sử dụng nó, việc cần phải thay đổi sẽ không dễ dàng. Ở đây bạn có thể suy nghĩ và xem làm thế nào để thực hiện sửa đổi một cách hợp lý.</li></ul><h2 id="trien-khai-code" tabindex="-1"><a class="header-anchor" href="#trien-khai-code"><span>Triển khai code</span></a></h2><p><strong>Thực sự không có logic nào không giải quyết được bằng if-else, nếu không được thì thêm một dòng nữa!</strong></p><p>Trong cách triển khai hiện tại, không cần phải thay đổi cấu trúc lớp, tức là cấu trúc lớp vẫn giữ nguyên như đã được định nghĩa ở trên. Chúng ta sẽ sử dụng một trường loại để phân biệt xem Redis nào đang được sử dụng, và đó sẽ là điều kiện quyết định cho việc sử dụng. Có thể nói cách triển khai hiện tại rất khó sử dụng, các hệ thống sử dụng đều cần phải thay đổi nhiều, ở đây chỉ là một ví dụ.</p><h3 id="cau-truc-du-an" tabindex="-1"><a class="header-anchor" href="#cau-truc-du-an"><span>Cấu trúc dự án</span></a></h3><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">design-demo-2-01/</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> pom.xml</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">└──</span><span style="color:#98C379;--shiki-dark:#98C379;"> src</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> main</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> com</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> hnv99</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> design</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                        ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> CacheService.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                        └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> cuisine</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                            └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> impl</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                                └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> CacheServiceImpl.java</span></span></code></pre></div><ul><li>Lúc này chỉ có hai lớp, cấu trúc lớp rất đơn giản. Và các chức năng mở rộng bổ sung mà chúng tôi cần chỉ được triển khai trong <code>CacheServiceImpl</code>.</li></ul><h3 id="trien-khai-ifelse" tabindex="-1"><a class="header-anchor" href="#trien-khai-ifelse"><span>Triển khai ifelse</span></a></h3><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> CacheServiceImpl</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> CacheService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> RedisUtils</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> redisUtils </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> RedisUtils</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> EGM</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> egm </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> EGM</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> IIR</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> iir </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> IIR</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> redisType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> redisType) {  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> egm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">gain</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> redisType) {  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> iir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> redisUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> redisType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> redisType) {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            egm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> redisType) {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            iir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        redisUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TimeUnit</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> redisType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> redisType) {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            egm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">setEx</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value, timeout, timeUnit);  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> redisType) {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            iir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">setExpire</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value, timeout, timeUnit);  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        redisUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value, timeout, timeUnit);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> redisType</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> redisType) {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            egm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">delete</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> redisType) {  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            iir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        redisUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Quá trình xử lý ở đây rất đơn giản, chủ yếu chọn cụm Redis nào dựa trên loại.</li><li>Mặc dù cách triển khai đơn giản nhưng lại gây rắc rối cho người dùng và cũng khó đối phó với việc mở rộng và bảo trì liên tục sau này.</li></ul><h3 id="kiem-thu" tabindex="-1"><a class="header-anchor" href="#kiem-thu"><span>Kiểm thử</span></a></h3><p>Tiếp theo, chúng tôi viết unit test thông qua Junit, nhấn mạnh rằng việc viết các bài unit test tốt hàng ngày có thể cải thiện tốt hơn tính mạnh mẽ của hệ thống.</p><p><strong>Viết lớp kiểm tra:</strong></p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ApiTest</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Test</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> test_CacheService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        CacheService</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cacheService</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> CacheServiceImpl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        cacheService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;user_name_01&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Hung&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> val01</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> cacheService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;user_name_01&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Kết quả kiểm tra: &quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> val01);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>Kết quả:</strong></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2024-03-26</span><span style="color:#98C379;--shiki-dark:#98C379;"> 15:01:39.193</span><span style="color:#98C379;--shiki-dark:#98C379;">	INFO</span><span style="color:#98C379;--shiki-dark:#98C379;">	main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		(EGM.java:21)	|	</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">EGM</span><span style="color:#98C379;--shiki-dark:#98C379;"> ghi</span><span style="color:#98C379;--shiki-dark:#98C379;"> dữ</span><span style="color:#98C379;--shiki-dark:#98C379;"> liệu</span><span style="color:#98C379;--shiki-dark:#98C379;"> key：user_name_01</span><span style="color:#98C379;--shiki-dark:#98C379;"> val：Hung</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2024-03-26</span><span style="color:#98C379;--shiki-dark:#98C379;"> 15:01:39.197</span><span style="color:#98C379;--shiki-dark:#98C379;">	INFO</span><span style="color:#98C379;--shiki-dark:#98C379;">	main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		(EGM.java:16)	|	</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">EGM</span><span style="color:#98C379;--shiki-dark:#98C379;"> lấy</span><span style="color:#98C379;--shiki-dark:#98C379;"> dữ</span><span style="color:#98C379;--shiki-dark:#98C379;"> liệu</span><span style="color:#98C379;--shiki-dark:#98C379;"> key：user_name_01</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Kết</span><span style="color:#98C379;--shiki-dark:#98C379;"> quả</span><span style="color:#98C379;--shiki-dark:#98C379;"> kiểm</span><span style="color:#98C379;--shiki-dark:#98C379;"> tra:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Hung</span></span></code></pre></div><ul><li>Đánh giá từ kết quả, nó chạy bình thường và không có vấn đề gì. Nhưng một khi code như vậy được tạo và chạy thì thực sự rất khó để thay đổi nó!</li></ul><h2 id="tai-cau-truc-abstract-factory-pattern" tabindex="-1"><a class="header-anchor" href="#tai-cau-truc-abstract-factory-pattern"><span>Tái cấu trúc Abstract Factory Pattern</span></a></h2><p>Tiếp theo, chúng ta sẽ tối ưu mã lệnh bằng cách sử dụng Abstract Factory Pattern, đây thực chất là một cải tiến nhỏ.</p><p>Abstract Factory sẽ được tạo và truy cập bằng cách sử dụng một lớp proxy. Lớp đang được proxy là lớp thao tác Redis hiện tại, cho phép lớp này gọi dịch vụ dữ liệu cho các cụm A và B mà không cần bất kỳ sửa đổi nào.</p><p>Ngoài ra, điều cần lưu ý quan trọng là vì các cụm A và B có các phương thức khác nhau ở một số khía cạnh, nên cần phải tạo một bộ chuyển đổi interface. Lớp chuyển đổi này đóng vai trò như một nhà máy trong nhà máy, tạo ra các dịch vụ trừu tượng để thống nhất các dịch vụ khác nhau cho cùng một mục đích nghiệp vụ. Khía cạnh này tương tự như mẫu thiết kế Factory Method đã thảo luận trong chương trước và có thể được tham khảo thêm thông tin.</p><h3 id="cau-truc-du-an-1" tabindex="-1"><a class="header-anchor" href="#cau-truc-du-an-1"><span>Cấu trúc dự án</span></a></h3><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">design-demo-2-02/</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> pom.xml</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">└──</span><span style="color:#98C379;--shiki-dark:#98C379;"> src</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> main</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;"> └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">     └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> com</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">         └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> hnv99</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">             └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> design</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">                 ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> CacheService.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">                 ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> factory</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">                 │  </span><span style="color:#98C379;--shiki-dark:#98C379;"> ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> ICacheAdapter.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">                 │  </span><span style="color:#98C379;--shiki-dark:#98C379;"> ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> JDKInvocationHandler.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">                 │  </span><span style="color:#98C379;--shiki-dark:#98C379;"> ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> JDKProxy.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">                 │  </span><span style="color:#98C379;--shiki-dark:#98C379;"> └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> impl</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">                 │  </span><span style="color:#98C379;--shiki-dark:#98C379;">     ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> EGMCacheAdapter.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">                 │  </span><span style="color:#98C379;--shiki-dark:#98C379;">     └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> IIRCacheAdapter.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">                 ├──</span><span style="color:#98C379;--shiki-dark:#98C379;"> impl</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">                 │  </span><span style="color:#98C379;--shiki-dark:#98C379;"> └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> CacheServiceImpl.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">                 └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> util</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    │  </span><span style="color:#98C379;--shiki-dark:#98C379;">                     └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> ClassLoaderUtils.java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">    └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> test</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">        └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> java</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">            └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> com</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> hnv99</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> design</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                        └──</span><span style="color:#98C379;--shiki-dark:#98C379;"> ApiTest.java</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Cấu trúc Abstract Factory Pattern</strong></p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240326161552.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">CacheService</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> proxy_EGM </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> JDKProxy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getProxy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">CacheServiceImpl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> EGMCacheAdapter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span></code></pre></div><p>Trong dự án, có một số điểm chính như sau:</p><ul><li><code>ICacheAdapter</code>: Định nghĩa adapter interface, đóng gói các tên gọi phương thức khác nhau trong hai cụm Redis. <code>EGMCacheAdapter</code>, <code>IIRCacheAdapter</code>.</li><li><code>JDKProxy</code>, <code>JDKInvocationHandler</code>: là định nghĩa và cách triển khai của lớp proxy. Phần này cũng là một cách triển khai khác của Abstract Factory. Bằng cách này, bạn có thể triển khai các phương thức Redis gốc thông qua việc gọi proxy, điều này giúp kiểm soát việc sử dụng bộ đệm bằng cách điều khiển các đối tượng tham số đầu vào khác nhau.</li></ul><p><strong>OK</strong>, sau đó tôi sẽ giải thích cách triển khai cụ thể của một số lớp.</p><h3 id="trien-khai-code-1" tabindex="-1"><a class="header-anchor" href="#trien-khai-code-1"><span>Triển khai code</span></a></h3><h4 id="đinh-nghia-adapter-interface" tabindex="-1"><a class="header-anchor" href="#đinh-nghia-adapter-interface"><span>Định nghĩa adapter interface</span></a></h4><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> interface</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ICacheAdapter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TimeUnit</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Chức năng chính của lớp này là cho phép tất cả các nhà cung cấp trong các cụm hoạt động dưới tên gọi phương thức thống nhất. Điều này cũng thuận tiện cho việc mở rộng sau này.</li></ul><h4 id="trien-khai-dich-vu-cum" tabindex="-1"><a class="header-anchor" href="#trien-khai-dich-vu-cum"><span>Triển khai dịch vụ cụm</span></a></h4><p><strong>EGMCacheAdapter</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> EGMCacheAdapter</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ICacheAdapter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> EGM</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> egm </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> EGM</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> egm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">gain</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        egm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TimeUnit</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        egm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">setEx</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value, timeout, timeUnit);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        egm</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">delete</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>IIRCacheAdapter</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> IIRCacheAdapter</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ICacheAdapter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> IIR</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> iir </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> IIR</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> iir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        iir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">long</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeout</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TimeUnit</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> timeUnit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        iir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">setExpire</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, value, timeout, timeUnit);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        iir</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Cả hai triển khai đều rất dễ dàng, đều được đóng gói với phương thức giống nhau.</li></ul><h4 id="đinh-nghia-lop-proxy-cho-abstract-factory-va-trien-khai" tabindex="-1"><a class="header-anchor" href="#đinh-nghia-lop-proxy-cho-abstract-factory-va-trien-khai"><span>Định nghĩa lớp proxy cho abstract factory và triển khai</span></a></h4><p><strong>JDKProxy</strong></p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">T</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> T</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getProxy</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Class</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">T</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> interfaceClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ICacheAdapter</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cacheAdapter) throws Exception {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    InvocationHandler</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> handler </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> JDKInvocationHandler</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(cacheAdapter)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    ClassLoader</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> classLoader </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getContextClassLoader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">    Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#C678DD;--shiki-dark:#C678DD;">?</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[] classes </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> interfaceClass</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getInterfaces</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (T) </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Proxy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">newProxyInstance</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(classLoader, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[]{classes[</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]}, handler);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><ul><li>Chức năng chính ở đây là hoàn thiện lớp proxy, đồng thời, cụm nào được sử dụng sẽ được truyền qua các tham số bên ngoài.</li></ul><p><strong>JDKInvocationHandler</strong></p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> JDKInvocationHandler</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> InvocationHandler</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ICacheAdapter</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cacheAdapter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> JDKInvocationHandler</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ICacheAdapter</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> cacheAdapter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">cacheAdapter</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> cacheAdapter;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Object</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> invoke</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> proxy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Method</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> method</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Object</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;">args</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Throwable</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ICacheAdapter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getMethod</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">method</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getName</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(), </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ClassLoaderUtils</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getClazzByArgs</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(args)).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">invoke</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(cacheAdapter, args);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><ul><li>Việc triển khai lớp proxy thực sự rất đơn giản. Các hoạt động của phương thức được thực hiện bằng cách thâm nhập vào dịch vụ cụm đến.</li><li>Ngoài ra <code>invoke</code>, bằng cách sử dụng phương pháp phản chiếu để lấy tên phương thức và gọi hàm phương thức tương ứng, việc sử dụng tổng thể sẽ được đơn giản hóa.</li><li>Tại thời điểm này, chúng tôi đã hoàn thành việc triển khai chức năng tổng thể và phần abstract factory cũng có thể được triển khai bằng phương pháp không proxy.</li></ul><h3 id="kiem-thu-1" tabindex="-1"><a class="header-anchor" href="#kiem-thu-1"><span>Kiểm thử</span></a></h3><p><strong>Viết Unit Test:</strong></p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ApiTest</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Test</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> test_CacheService</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> throws</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Tạo proxy cho EGM Cache  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        CacheService</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> proxy_EGM</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> JDKProxy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getProxy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">CacheServiceImpl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> EGMCacheAdapter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        proxy_EGM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;user_name_01&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Hung&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> val01</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> proxy_EGM</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;user_name_01&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Kết quả kiểm tra: &quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> val01);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Tạo proxy cho IIR Cache  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        CacheService</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> proxy_IIR</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> JDKProxy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getProxy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">CacheServiceImpl</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> IIRCacheAdapter</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">());  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        proxy_IIR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;user_name_01&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Hung&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> val02</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> proxy_IIR</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;user_name_01&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);  </span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">out</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">println</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Kết quả kiểm tra: &quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> val02);  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span><span style="color:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>Trong mã kiểm thử, bằng cách truyền vào loại cụm khác nhau, chúng ta có thể gọi các phương thức của các cụm khác nhau. <code>JDKProxy.getProxy(CacheServiceImpl.class, new EGMCacheAdapter());</code></li><li>Nếu có yêu cầu mở rộng sau này, bạn cũng có thể bổ sung theo cách này, đồng thời đối với việc sửa đổi, không cần sửa đổi phương thức gốc, giảm thiểu chi phí sửa đổi.</li></ul><p><strong>Kết quả</strong></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2024-03-26</span><span style="color:#98C379;--shiki-dark:#98C379;"> 15:39:35.719</span><span style="color:#98C379;--shiki-dark:#98C379;">	INFO</span><span style="color:#98C379;--shiki-dark:#98C379;">	main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		(EGM.java:21)	|	</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">EGM</span><span style="color:#98C379;--shiki-dark:#98C379;"> ghi</span><span style="color:#98C379;--shiki-dark:#98C379;"> dữ</span><span style="color:#98C379;--shiki-dark:#98C379;"> liệu</span><span style="color:#98C379;--shiki-dark:#98C379;"> key：user_name_01</span><span style="color:#98C379;--shiki-dark:#98C379;"> val：Hung</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2024-03-26</span><span style="color:#98C379;--shiki-dark:#98C379;"> 15:39:35.721</span><span style="color:#98C379;--shiki-dark:#98C379;">	INFO</span><span style="color:#98C379;--shiki-dark:#98C379;">	main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		(EGM.java:16)	|	</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">EGM</span><span style="color:#98C379;--shiki-dark:#98C379;"> lấy</span><span style="color:#98C379;--shiki-dark:#98C379;"> dữ</span><span style="color:#98C379;--shiki-dark:#98C379;"> liệu</span><span style="color:#98C379;--shiki-dark:#98C379;"> key：user_name_01</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Kết</span><span style="color:#98C379;--shiki-dark:#98C379;"> quả</span><span style="color:#98C379;--shiki-dark:#98C379;"> kiểm</span><span style="color:#98C379;--shiki-dark:#98C379;"> tra:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Hung</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2024-03-26</span><span style="color:#98C379;--shiki-dark:#98C379;"> 15:39:35.722</span><span style="color:#98C379;--shiki-dark:#98C379;">	INFO</span><span style="color:#98C379;--shiki-dark:#98C379;">	main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		(IIR.java:22)	|	</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">IIR</span><span style="color:#98C379;--shiki-dark:#98C379;"> ghi</span><span style="color:#98C379;--shiki-dark:#98C379;"> dữ</span><span style="color:#98C379;--shiki-dark:#98C379;"> liệu</span><span style="color:#98C379;--shiki-dark:#98C379;"> key：user_name_01</span><span style="color:#98C379;--shiki-dark:#98C379;"> val：Hung</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2024-03-26</span><span style="color:#98C379;--shiki-dark:#98C379;"> 15:39:35.723</span><span style="color:#98C379;--shiki-dark:#98C379;">	INFO</span><span style="color:#98C379;--shiki-dark:#98C379;">	main</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">		(IIR.java:17)	|	</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">IIR</span><span style="color:#98C379;--shiki-dark:#98C379;"> lấy</span><span style="color:#98C379;--shiki-dark:#98C379;"> dữ</span><span style="color:#98C379;--shiki-dark:#98C379;"> liệu</span><span style="color:#98C379;--shiki-dark:#98C379;"> key：user_name_01</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">Kết</span><span style="color:#98C379;--shiki-dark:#98C379;"> quả</span><span style="color:#98C379;--shiki-dark:#98C379;"> kiểm</span><span style="color:#98C379;--shiki-dark:#98C379;"> tra:</span><span style="color:#98C379;--shiki-dark:#98C379;"> Hung</span></span></code></pre></div><ul><li>Kết quả chạy bình thường, mã này đáp ứng được yêu cầu mở rộng, đồng thời năng lực kỹ thuật của bạn cũng để lại ấn tượng sâu sắc với sếp.</li><li>Hãy nâng cao khả năng tự nghiên cứu và phát triển không phải chịu áp lực từ bên ngoài viết code lặp đi lặp lại. nếu đã thành thạo nhiều kỹ năng, bạn có thể lập một kế hoạch hoàn chỉnh ngay cả trong những tình huống khẩn cấp.</li></ul><h2 id="tong-ket" tabindex="-1"><a class="header-anchor" href="#tong-ket"><span>Tổng kết</span></a></h2><ul><li>Mẫu thiết kế trừu tượng làm việc để giải quyết vấn đề khi trong một họ sản phẩm, có nhiều loại sản phẩm khác nhau (cụm Redis, hệ điều hành) và phải chọn interface. Và tình huống này cũng rất phổ biến trong phát triển kinh doanh, chỉ là có thời gian đôi khi không được trừu tượng hóa chúng ra.</li><li>&quot;Code của bạn chỉ là được lấp đầy bằng ifelse!&quot; Khi bạn biết khi nào và trong trường hợp nào cần phải tối ưu hóa mã bằng cách sử dụng mẫu thiết kế trừu tượng, bạn có thể hoàn thành chức năng của mình và nâng cao tính mở rộng và tính dễ hiểu của mã của mình.</li><li>Vậy nên, mẫu thiết kế này đáp ứng được các điểm: nguyên tắc trách nhiệm đơn lẻ, nguyên tắc mở đóng, tách biệt, v.v. Tuy nhiên, khi hoạt động kinh doanh tiếp tục mở rộng, nó có thể gây ra sự phức tạp trong việc triển khai lớp. Nhưng cũng có thể nói rằng đó không phải là một thiếu sót, bởi vì thiếu sót này có thể được giảm bớt khi đưa ra các phương pháp thiết kế khác, các lớp proxy và việc tạo và tải tự động.</li></ul>`,99),p=[r];function e(o,t){return a(),n("div",null,p)}const k=s(l,[["render",e],["__file","abstract-factory.html.vue"]]),B=JSON.parse('{"path":"/design/design-pattern/practical/creational/abstract-factory.html","title":"Abstract Factory Pattern Practice","lang":"en-US","frontmatter":{"title":"Abstract Factory Pattern Practice","tags":["design-pattern"],"categories":null,"date created":"2024-03-26T00:00:00.000Z","date modified":"2024-03-26T00:00:00.000Z","description":"Abstract Factory Pattern: Nâng cấp Redis Cluster kép, sử dụng abstract proxy Giới thiệu Code lộn xộn và anh phải chịu trách nhiệm. Hầu hết các lập trình viên đều muốn viết code ...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/design/design-pattern/practical/creational/abstract-factory.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"Abstract Factory Pattern Practice"}],["meta",{"property":"og:description","content":"Abstract Factory Pattern: Nâng cấp Redis Cluster kép, sử dụng abstract proxy Giới thiệu Code lộn xộn và anh phải chịu trách nhiệm. Hầu hết các lập trình viên đều muốn viết code ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240326130330.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-28T15:54:38.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"design-pattern"}],["meta",{"property":"article:modified_time","content":"2024-06-28T15:54:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Abstract Factory Pattern Practice\\",\\"image\\":[\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240326130330.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240326130915.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240326161552.png\\"],\\"dateModified\\":\\"2024-06-28T15:54:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Giới thiệu","slug":"gioi-thieu","link":"#gioi-thieu","children":[]},{"level":2,"title":"Môi trường phát triển","slug":"moi-truong-phat-trien","link":"#moi-truong-phat-trien","children":[]},{"level":2,"title":"Giới thiệu về Abstract Factory Pattern","slug":"gioi-thieu-ve-abstract-factory-pattern","link":"#gioi-thieu-ve-abstract-factory-pattern","children":[]},{"level":2,"title":"Mô phỏng kịch bản tình huống","slug":"mo-phong-kich-ban-tinh-huong","link":"#mo-phong-kich-ban-tinh-huong","children":[{"level":3,"title":"Dự án mô phỏng kịch bản","slug":"du-an-mo-phong-kich-ban","link":"#du-an-mo-phong-kich-ban","children":[]},{"level":3,"title":"Tóm tắt tình huống","slug":"tom-tat-tinh-huong","link":"#tom-tat-tinh-huong","children":[]}]},{"level":2,"title":"Sử dụng dịch vụ đơn cụm","slug":"su-dung-dich-vu-đon-cum","link":"#su-dung-dich-vu-đon-cum","children":[{"level":3,"title":"Định nghĩa interface","slug":"đinh-nghia-interface","link":"#đinh-nghia-interface","children":[]},{"level":3,"title":"Triển khai","slug":"trien-khai","link":"#trien-khai","children":[]}]},{"level":2,"title":"Triển khai code","slug":"trien-khai-code","link":"#trien-khai-code","children":[{"level":3,"title":"Cấu trúc dự án","slug":"cau-truc-du-an","link":"#cau-truc-du-an","children":[]},{"level":3,"title":"Triển khai ifelse","slug":"trien-khai-ifelse","link":"#trien-khai-ifelse","children":[]},{"level":3,"title":"Kiểm thử","slug":"kiem-thu","link":"#kiem-thu","children":[]}]},{"level":2,"title":"Tái cấu trúc Abstract Factory Pattern","slug":"tai-cau-truc-abstract-factory-pattern","link":"#tai-cau-truc-abstract-factory-pattern","children":[{"level":3,"title":"Cấu trúc dự án","slug":"cau-truc-du-an-1","link":"#cau-truc-du-an-1","children":[]},{"level":3,"title":"Triển khai code","slug":"trien-khai-code-1","link":"#trien-khai-code-1","children":[]},{"level":3,"title":"Kiểm thử","slug":"kiem-thu-1","link":"#kiem-thu-1","children":[]}]},{"level":2,"title":"Tổng kết","slug":"tong-ket","link":"#tong-ket","children":[]}],"git":{"createdTime":1719590078000,"updatedTime":1719590078000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":15.47,"words":4640},"filePathRelative":"design/design-pattern/practical/creational/abstract-factory.md","localizedDate":"June 28, 2024","excerpt":"\\n<h2>Giới thiệu</h2>\\n<p><strong>Code lộn xộn và anh phải chịu trách nhiệm.</strong></p>\\n<p>Hầu hết các lập trình viên đều muốn viết code tốt, ngoài việc lập trình là công việc, họ cũng là những người có tinh thần nghề nghiệp. Nhưng nhiều lúc lại khó để bạn giữ vững điều này, giống như: nhận một dự án tệ, chức năng sản phẩm cần gấp, khả năng cá nhân không đủ, và nhiều lý do khác dẫn đến mã nguồn của dự án nặng nề, thường xuyên gặp sự cố, cuối cùng phải từ chức rời đi.</p>","autoDesc":true}');export{k as comp,B as data};
