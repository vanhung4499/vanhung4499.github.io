import{_ as k,g as p,o as B,c as e,e as s,f as h,w as t,a as l,h as a}from"./app-CmlOSuIY.js";const d={},r={class:"hint-container info"};function g(c,i){const n=p("font");return B(),e("div",null,[i[8]||(i[8]=s("h1",{id:"pmhub-distributed-transaction-with-seata",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#pmhub-distributed-transaction-with-seata"},[s("span",null,"PmHub - Distributed Transaction with Seata")])],-1)),i[9]||(i[9]=s("p",null,"Bài viết này chủ yếu nói về cách sử dụng Seata để đảm bảo tính nhất quán của trạng thái phê duyệt nhiệm vụ trong hệ thống PmHub.",-1)),i[10]||(i[10]=s("p",null,"Giao dịch phân tán luôn là một chủ đề phỏng vấn được ưa chuộng, nhưng tôi nhận thấy các hướng dẫn trên mạng thường tập trung nhiều vào lý thuyết mà ít liên kết với các dự án thực tế. Trong khi đó, phỏng vấn thường dựa trên những tình huống thực tiễn để kiểm tra kiến thức của ứng viên. Mục tiêu của chúng ta là kết hợp lý thuyết với thực hành, giúp bạn tránh được nhiều trở ngại.",-1)),i[11]||(i[11]=s("p",null,"Thông qua bài viết này, bạn sẽ hiểu rõ về giao dịch phân tán và cách sử dụng nó trong PmHub. Đây sẽ là nền tảng vững chắc từ lý thuyết đến thực hành!",-1)),s("p",null,[s("strong",null,[h(n,{style:{color:"#DF2A3F"}},{default:t(()=>i[0]||(i[0]=[a("Bài viết này chứa đầy kiến thức thiết thực và rất quan trọng trong phỏng vấn!")])),_:1})])]),i[12]||(i[12]=l(`<div class="hint-container info"><p class="hint-container-title">Info</p><ul><li>Để đảm bảo tính nhất quán của trạng thái phê duyệt nhiệm vụ, chúng tôi sử dụng <strong>chế độ AT của giao dịch phân tán Seata</strong>.</li></ul></div><h2 id="giao-dich" tabindex="-1"><a class="header-anchor" href="#giao-dich"><span>Giao dịch</span></a></h2><p>Chúng ta hãy tưởng tượng một tình huống:</p><div class="hint-container info"><p class="hint-container-title">Info</p><p>Giả sử người dùng A chuyển 100 nhân dân tệ cho người dùng B, quy trình này bao gồm các bước sau:</p><ol><li>Trừ 100 nhân dân tệ từ tài khoản của người dùng A.</li><li>Cộng 100 nhân dân tệ vào tài khoản của người dùng B.</li></ol><p>Hai bước này hoặc phải thực hiện thành công cả hai, hoặc không thực hiện gì. Nếu bước 1 đã trừ 100 nhân dân tệ nhưng xảy ra lỗi khi thực hiện bước 2, chúng ta muốn số tiền trong tài khoản của người dùng A trở về trạng thái ban đầu.</p></div><p>Đây là một ví dụ điển hình về giao dịch. Giao dịch là gì? Nói đơn giản, giao dịch là một tập hợp các thao tác logic, <strong>hoặc tất cả đều thực hiện, hoặc không thực hiện gì cả</strong>.</p><p>Dưới đây là một bộ câu hỏi kinh điển để kiểm tra hiểu biết về bốn tính chất của giao dịch, hãy ghi nhớ để chuẩn bị cho phỏng vấn.</p><div class="hint-container info"><p class="hint-container-title">Info</p><h3 id="bon-tinh-chat-cua-giao-dich-acid" tabindex="-1"><a class="header-anchor" href="#bon-tinh-chat-cua-giao-dich-acid"><span>Bốn tính chất của giao dịch (ACID)</span></a></h3><ol><li><strong>Tính nguyên tử (Atomicity)</strong>: <ul><li>Tất cả các thao tác trong giao dịch hoặc thành công, hoặc thất bại. Ngay cả trong trường hợp hệ thống gặp sự cố, giao dịch vẫn đảm bảo không thực hiện chỉ một phần của thao tác.</li><li><strong>Ví dụ</strong>: Trong thao tác chuyển khoản, việc trừ tiền từ tài khoản này và cộng tiền vào tài khoản khác phải thành công hoặc thất bại toàn bộ.</li></ul></li><li><strong>Tính nhất quán (Consistency)</strong>: <ul><li>Trước và sau khi thực hiện giao dịch, cơ sở dữ liệu phải ở trạng thái nhất quán. Mọi giao dịch đều phải đảm bảo cơ sở dữ liệu chuyển từ một trạng thái nhất quán này sang một trạng thái nhất quán khác.</li><li><strong>Ví dụ</strong>: Sau khi chuyển khoản, tổng số tiền trong hai tài khoản vẫn phải giữ nguyên.</li></ul></li><li><strong>Tính cách ly (Isolation)</strong>: <ul><li>Các giao dịch đồng thời không được ảnh hưởng lẫn nhau, trạng thái trung gian của một giao dịch không thể bị các giao dịch khác nhìn thấy.</li><li><strong>Ví dụ</strong>: Hai thao tác chuyển khoản diễn ra cùng lúc sẽ không ảnh hưởng lẫn nhau, và mỗi thao tác không thấy được trạng thái trung gian của thao tác kia.</li></ul></li><li><strong>Tính bền vững (Durability)</strong>: <ul><li>Một khi giao dịch đã được hoàn thành, kết quả của nó là vĩnh viễn, ngay cả khi hệ thống bị sự cố, kết quả giao dịch cũng không bị mất.</li><li><strong>Ví dụ</strong>: Sau khi chuyển khoản thành công, ngay cả khi hệ thống khởi động lại, biến động số tiền trong tài khoản vẫn tồn tại.</li></ul></li></ol></div><h2 id="giao-dich-cuc-bo" tabindex="-1"><a class="header-anchor" href="#giao-dich-cuc-bo"><span>Giao dịch cục bộ</span></a></h2><p>Trong ứng dụng đơn thể, các giao dịch thường là giao dịch cục bộ. Ví dụ, trong Spring Boot, khi thêm annotation @Transactional vào phương thức, chúng ta đang thực hiện một giao dịch cục bộ.</p><p>Trong hệ thống đơn thể, một thao tác có thể liên quan đến nhiều bảng, nhưng tất cả đều nằm trong cùng một cơ sở dữ liệu. Ví dụ, trong MySQL, một giao dịch có thể bao gồm nhiều câu lệnh SQL. Tất cả các câu lệnh này hoặc thành công, hoặc thất bại. MySQL hỗ trợ giao dịch qua engine <strong>InnoDB</strong>, trong khi <strong>MyISAM</strong> thì không hỗ trợ giao dịch.</p><p>Trong MySQL, giao dịch được quản lý bằng <strong>redo log</strong> và <strong>undo log</strong>. <strong>redo log</strong> giúp phục hồi trước khi giao dịch được cam kết, đảm bảo <strong>tính bền vững</strong>. <strong>undo log</strong> giúp phục hồi sau khi giao dịch được cam kết, đảm bảo <strong>tính nguyên tử</strong>. Dưới đây là một biểu đồ minh họa:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-mysql-log.drawio.png" alt="pmhub-mysql-log.drawio.png" tabindex="0" loading="lazy"><figcaption>pmhub-mysql-log.drawio.png</figcaption></figure><h2 id="giao-dich-phan-tan" tabindex="-1"><a class="header-anchor" href="#giao-dich-phan-tan"><span>Giao dịch phân tán</span></a></h2><p>Trong hệ thống phân tán microservice, các hệ thống đơn thể ban đầu được chia nhỏ thành nhiều microservice. Ví dụ, trong PmHub, hệ thống được chia thành dịch vụ hệ thống, dịch vụ dự án, dịch vụ quy trình, v.v. Trong các ứng dụng thực tế, mỗi microservice có thể được triển khai trên các máy khác nhau và cơ sở dữ liệu của chúng cũng được tách biệt. Ví dụ, trong PmHub, dịch vụ pmhub-project sử dụng cơ sở dữ liệu pmhub-project, còn dịch vụ pmhub-workflow sử dụng cơ sở dữ liệu pmhub-workflow.</p><p>Trong trường hợp này, một thao tác có thể liên quan đến nhiều máy, nhiều dịch vụ, và nhiều cơ sở dữ liệu. Ví dụ, trong kịch bản thêm nhiệm vụ của PmHub:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-add-task.drawio.png" alt="pmhub-add-task.drawio.png" tabindex="0" loading="lazy"><figcaption>pmhub-add-task.drawio.png</figcaption></figure><p>Vậy làm thế nào để đảm bảo một thao tác <strong>hoặc thực hiện thành công tất cả, hoặc thất bại tất cả</strong>?</p><p>Chúng ta cần sử dụng giải pháp giao dịch phân tán. Giao dịch cục bộ giải quyết vấn đề nhất quán dữ liệu của một nguồn dữ liệu duy nhất, còn giao dịch phân tán giải quyết vấn đề nhất quán dữ liệu <strong>đa nguồn</strong>.</p><h2 id="giai-phap-giao-dich-phan-tan" tabindex="-1"><a class="header-anchor" href="#giai-phap-giao-dich-phan-tan"><span>Giải pháp giao dịch phân tán</span></a></h2><p>Việc triển khai giao dịch phân tán chủ yếu có 6 giải pháp sau đây:</p><ul><li>Giải pháp XA</li><li>Giải pháp TCC</li><li>Giải pháp SAGA</li><li>Bảng tin nhắn cục bộ</li><li>Giải pháp nhất quán cuối cùng của tin nhắn đáng tin cậy</li><li>Giải pháp thông báo tối đa</li></ul><p>Trong đó, chuẩn XA đã phát triển thành giải pháp 2PC, 3PC không xâm nhập mã nghiệp vụ, còn TCC và SAGA thuộc các giải pháp có sự xâm nhập vào nghiệp vụ, và bảng tin nhắn cục bộ không hỗ trợ hoàn tác.</p><p>Mỗi giải pháp có các trường hợp sử dụng khác nhau, bảng dưới đây là so sánh giữa các giải pháp này:</p><table><thead><tr><th>Giải pháp</th><th>Mô tả</th><th>Ưu điểm</th><th>Nhược điểm</th><th>Trường hợp sử dụng</th></tr></thead><tbody><tr><td>Giải pháp XA</td><td>Hai giai đoạn xác nhận, sử dụng bộ quản lý giao dịch để điều phối nhiều cơ sở dữ liệu, thích hợp cho các giao dịch phân tán giữa nhiều cơ sở dữ liệu trong ứng dụng</td><td>Tính nhất quán mạnh</td><td>Hiệu suất thấp, không phù hợp cho các tình huống yêu cầu đồng thời cao</td><td>Ứng dụng đơn khối, giao dịch phân tán giữa nhiều cơ sở dữ liệu</td></tr><tr><td>Giải pháp TCC</td><td>Try-Confirm-Cancel, quản lý giao dịch qua ba giai đoạn, giai đoạn Try kiểm tra và dự trữ tài nguyên, giai đoạn Confirm thực hiện hành động, giai đoạn Cancel hoàn tác bồi thường</td><td>Tính nhất quán mạnh, phù hợp với quy trình ngắn và tình huống yêu cầu đồng thời cao</td><td>Mã hoàn tác phức tạp, khó bảo trì</td><td>Các trường hợp liên quan đến thanh toán, giao dịch tài chính</td></tr><tr><td>Giải pháp SAGA</td><td>Giao dịch hoàn tác, đảm bảo nhất quán cuối cùng thông qua giao dịch cục bộ và hành động hoàn tác, khi một giao dịch thất bại, thực hiện ngược lại các hành động đã thành công để hoàn tác</td><td>Không cần khóa, hiệu suất cao, các thành viên có thể thực hiện không đồng bộ</td><td>Không đảm bảo tính cách ly của giao dịch</td><td>Các quy trình nghiệp vụ dài, có sự tham gia của các công ty khác hoặc hệ thống kế thừa</td></tr><tr><td>Bảng tin nhắn cục bộ</td><td>Chèn tin nhắn vào bảng tin nhắn trong giao dịch cục bộ và gửi tin nhắn đến MQ, người nhận xử lý tin nhắn trong giao dịch cục bộ và cập nhật trạng thái tin nhắn, nếu thất bại sẽ thử lại theo lịch</td><td>Đảm bảo tính nhất quán cuối cùng, phù hợp với tình huống yêu cầu đồng thời thấp</td><td>Phụ thuộc nhiều vào bảng tin nhắn trong cơ sở dữ liệu, khả năng mở rộng kém trong tình huống yêu cầu đồng thời cao</td><td>Tình huống yêu cầu đồng thời thấp</td></tr><tr><td>Giải pháp nhất quán cuối cùng của tin nhắn đáng tin cậy</td><td>Dựa trên MQ để thực hiện giao dịch, gửi tin nhắn dự phòng trước, sau khi thực hiện giao dịch cục bộ sẽ xác nhận hoặc hoàn tác tin nhắn, MQ sẽ kiểm tra trạng thái tin nhắn dự phòng theo lịch và gọi lại để xác nhận</td><td>Phù hợp với tình huống yêu cầu đồng thời cao, độ tin cậy cao</td><td>Xử lý phức tạp, nếu giao dịch của hệ thống B thất bại cần phải thử lại hoặc xử lý thủ công</td><td>Tình huống yêu cầu đồng thời cao, được sử dụng rộng rãi tại các công ty internet trong nước</td></tr><tr><td>Giải pháp thông báo tối đa</td><td>Hệ thống A gửi tin nhắn đến MQ sau khi hoàn thành giao dịch cục bộ, dịch vụ thông báo tối đa sẽ tiêu thụ tin nhắn và gọi hệ thống B, nếu hệ thống B thất bại thì sẽ thử lại theo lịch, nếu vẫn thất bại sẽ bỏ qua</td><td>Đơn giản, dễ thực hiện, phù hợp với những trường hợp không yêu cầu tính nhất quán cao</td><td>Không đảm bảo tính nhất quán tuyệt đối</td><td>Các tình huống không yêu cầu tính nhất quán cao, chẳng hạn như các thao tác nghiệp vụ không quan trọng</td></tr></tbody></table><h2 id="gioi-thieu-seata" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-seata"><span>Giới thiệu Seata</span></a></h2><h3 id="seata-la-gi" tabindex="-1"><a class="header-anchor" href="#seata-la-gi"><span>Seata là gì?</span></a></h3><p>Seata là một giải pháp giao dịch phân tán mã nguồn mở của Alibaba, là một khung giao dịch tự trị đơn giản và mở rộng được 👍.</p><ul><li>Địa chỉ trang web chính thức: <a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">https://seata.apache.org</a></li><li>Địa chỉ mã nguồn: <a href="https://github.com/apache/incubator-seata" target="_blank" rel="noopener noreferrer">https://github.com/apache/incubator-seata</a></li></ul><p>Với Seata, chúng ta chỉ cần thêm annotation <code>@GlobalTransactional</code> tại những nơi cần sử dụng giao dịch phân tán.</p><figure><img src="https://seata.apache.org/assets/images/solution-1bdadb80e54074aa3088372c17f0244b.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="co-che-tong-the" tabindex="-1"><a class="header-anchor" href="#co-che-tong-the"><span>Cơ chế tổng thể</span></a></h3><p>Seata hỗ trợ 3 chế độ: chế độ AT, chế độ TCC và chế độ Saga.</p><table><thead><tr><th>Chế độ</th><th>Mô tả</th><th>Ưu điểm</th><th>Nhược điểm</th><th>Các tình huống phù hợp</th></tr></thead><tbody><tr><td>Chế độ AT</td><td>Giao dịch bồi thường tự động, tự động quản lý việc cam kết và rollback giao dịch thông qua proxy, phù hợp cho các tình huống đơn giản</td><td>Dễ sử dụng, chi phí phát triển thấp, tự động quản lý giao dịch</td><td>Phụ thuộc vào hỗ trợ của cơ sở dữ liệu, phù hợp với các tình huống đơn giản, không phù hợp với logic nghiệp vụ phức tạp</td><td>Tình huống nghiệp vụ đơn giản, như thao tác bảng đơn, các dịch vụ vi mô nhỏ</td></tr><tr><td>Chế độ TCC</td><td>Try-Confirm-Cancel, nhà phát triển tự thực hiện logic nghiệp vụ của ba giai đoạn Try, Confirm và Cancel để đảm bảo tính nhất quán của giao dịch</td><td>Cung cấp tính nhất quán mạnh, phù hợp cho các tình huống yêu cầu quản lý giao dịch nghiêm ngặt</td><td>Thực hiện phức tạp, chi phí phát triển cao, cần tự quản lý các giai đoạn của giao dịch</td><td>Tình huống yêu cầu tính nhất quán cao và các thao tác nghiệp vụ ngắn, như hệ thống thanh toán, giao dịch liên quan đến tài chính</td></tr><tr><td>Chế độ Saga</td><td>Giao dịch dài, hoàn thành giao dịch chính thông qua một loạt các giao dịch con, các giao dịch con hoạt động độc lập, nếu một giao dịch con thất bại, sẽ thực hiện rollback các giao dịch đã thành công trước đó</td><td>Không cần khóa toàn cục, hiệu suất cao, phù hợp cho các tình huống giao dịch dài</td><td>Cần phát triển logic bồi thường, có thể không đảm bảo tính nhất quán mạnh</td><td>Tình huống nghiệp vụ dài, liên quan đến nhiều hệ thống hoặc dịch vụ, như quản lý đơn hàng, quản lý chuỗi cung ứng</td></tr></tbody></table><h3 id="che-đo-at" tabindex="-1"><a class="header-anchor" href="#che-đo-at"><span>Chế độ AT</span></a></h3><p>Chế độ AT thực chất là giao thức 2PC, phù hợp cho hầu hết các tình huống, cấu hình và sử dụng tương đối đơn giản. PmHub sử dụng chế độ AT, dưới đây là một quy trình cụ thể:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919143501.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="che-đo-tcc" tabindex="-1"><a class="header-anchor" href="#che-đo-tcc"><span>Chế độ TCC</span></a></h3><p>Chế độ TCC là chế độ hỗ trợ đưa các giao dịch con tùy chỉnh vào trong việc quản lý giao dịch toàn cục.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919151242.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="che-đo-saga" tabindex="-1"><a class="header-anchor" href="#che-đo-saga"><span>Chế độ Saga</span></a></h3><p>Chế độ Saga là giải pháp giao dịch dài do Seata cung cấp. Trong chế độ Saga, mỗi người tham gia trong quy trình nghiệp vụ sẽ thực hiện giao dịch cục bộ của mình. Khi một người tham gia thất bại, hệ thống sẽ thực hiện bồi thường các giao dịch đã thành công trước đó. Dịch vụ giai đoạn một (dịch vụ chính) và dịch vụ giai đoạn hai (dịch vụ bồi thường) đều do các nhà phát triển nghiệp vụ thực hiện.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919151318.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Tiếp theo là phần thực hành giao dịch phân tán với Seata.</p><h2 id="cai-đat-va-tai-xuong-seata" tabindex="-1"><a class="header-anchor" href="#cai-đat-va-tai-xuong-seata"><span>Cài đặt và tải xuống Seata</span></a></h2><h3 id="tai-xuong" tabindex="-1"><a class="header-anchor" href="#tai-xuong"><span>Tải xuống</span></a></h3><p>Địa chỉ tải về: <a href="https://seata.apache.org/unversioned/download/seata-server" target="_blank" rel="noopener noreferrer">https://seata.apache.org/unversioned/download/seata-server</a></p><p>Tải phiên bản mới nhất 2.0.0</p><h3 id="tao-co-so-du-lieu-va-bang" tabindex="-1"><a class="header-anchor" href="#tao-co-so-du-lieu-va-bang"><span>Tạo cơ sở dữ liệu và bảng</span></a></h3><p>Vì Seata sử dụng MySQL làm cơ sở dữ liệu có tính khả dụng cao, nên cần tạo một cơ sở dữ liệu <code>pmhub-seata</code> trong MySQL và nhập script cơ sở dữ liệu.</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`pmhub-seata\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> CHARACTER</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> SET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4 </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">COLLATE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4_general_ci;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> NAMES utf8mb4;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> FOREIGN_KEY_CHECKS </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">USE</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`pmhub-seata\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- -------------------------------- The script used when storeMode is &#39;db&#39; --------------------------------</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- the table to store GlobalSession data</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`global_table\`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`xid\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                       VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`transaction_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            BIGINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`status\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                    TINYINT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`application_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`transaction_service_group\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`transaction_name\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">          VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`timeout\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                   INT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`begin_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                BIGINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`application_data\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">          VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`gmt_create\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`gmt_modified\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">              DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`xid\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`idx_status_gmt_modified\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`status\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`gmt_modified\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`idx_transaction_id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`transaction_id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- the table to store BranchSession data</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`branch_table\`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`branch_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">         BIGINT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`xid\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">               VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`transaction_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    BIGINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`resource_group_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`resource_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`branch_type\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`status\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            TINYINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`client_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">         VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`application_data\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`gmt_create\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`gmt_modified\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`branch_id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`idx_xid\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`xid\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- the table to store lock data</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`lock_table\`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`row_key\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`xid\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`transaction_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> BIGINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`branch_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      BIGINT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`resource_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`table_name\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">     VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`pk\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">             VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">36</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`status\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">         TINYINT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;0:locked ,1:rollbacking&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`gmt_create\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">     DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`gmt_modified\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`row_key\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`idx_status\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`status\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`idx_branch_id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`branch_id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`idx_xid\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`xid\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`distributed_lock\`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`lock_key\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       CHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`lock_value\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">     VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`expire\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">         BIGINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    primary key</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`lock_key\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`distributed_lock\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (lock_key, lock_value, expire) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;AsyncCommitting&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39; &#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`distributed_lock\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (lock_key, lock_value, expire) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;RetryCommitting&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39; &#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`distributed_lock\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (lock_key, lock_value, expire) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;RetryRollbacking&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39; &#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`distributed_lock\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (lock_key, lock_value, expire) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;TxTimeoutCheck&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39; &#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> FOREIGN_KEY_CHECKS </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="thay-đoi-cau-hinh" tabindex="-1"><a class="header-anchor" href="#thay-đoi-cau-hinh"><span>Thay đổi cấu hình</span></a></h3><p>Chủ yếu là thay đổi cổng và cấu hình liên quan đến Nacos. Để tránh việc sửa cấu hình sai, hãy sao lưu cấu hình ban đầu.</p><p>Cấu hình như sau:</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Cấu hình cổng dịch vụ</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">server</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">7091</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Tên dịch vụ</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">seata-server</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Cấu hình đăng nhập giao diện quản lý Seata</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    username</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">seata</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">seata</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Cấu hình seata-server và đăng ký vào Nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">seata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  service</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    vgroup-mapping</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      default_tx_group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">default</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    disable-global-transaction</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      server-addr</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">127.0.0.1:8848</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">SEATA_GROUP</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      username</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  registry</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">seata-server</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      server-addr</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">127.0.0.1:8848</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">SEATA_GROUP</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      username</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  store</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    mode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">db</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    db</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      url</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">jdbc:mysql://localhost:3306/pmhub-seata?characterEncoding=utf8&amp;useSSL=false</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">123456</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="khoi-đong-seata" tabindex="-1"><a class="header-anchor" href="#khoi-đong-seata"><span>Khởi động Seata</span></a></h3><p>Vào thư mục <code>bin</code> của Seata và khởi động theo hệ điều hành, ví dụ trên macOS có thể dùng lệnh:</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">sh seata-server.sh</span></span></code></pre></div><p>Truy cập: <a href="http://localhost:7091/" target="_blank" rel="noopener noreferrer">http://localhost:7091/</a></p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919152345.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Kiểm tra Nacos để xem Seata đã được khởi động và đăng ký thành công vào Nacos hay chưa.</p><h2 id="pmhub-thuc-chien-them-nhiem-vu-quan-ly-giao-dich" tabindex="-1"><a class="header-anchor" href="#pmhub-thuc-chien-them-nhiem-vu-quan-ly-giao-dich"><span>PmHub Thực Chiến - Thêm Nhiệm Vụ Quản Lý Giao Dịch</span></a></h2><p>Khi tạo nhiệm vụ dự án, cần thêm hoặc cập nhật cài đặt phê duyệt, điều này yêu cầu gọi các dịch vụ giữa các cơ sở dữ liệu khác nhau và liên quan đến việc chỉnh sửa trên các cơ sở dữ liệu khác nhau trong các microservices khác nhau, do đó cần sử dụng xử lý giao dịch phân tán.</p><p>Dưới đây là sơ đồ quy trình cụ thể cho việc thêm nhiệm vụ:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-add-task.drawio.png" alt="pmhub-add-task.drawio.png" tabindex="0" loading="lazy"><figcaption>pmhub-add-task.drawio.png</figcaption></figure><h3 id="them-bang-undo-log-vao-co-so-du-lieu-nghiep-vu" tabindex="-1"><a class="header-anchor" href="#them-bang-undo-log-vao-co-so-du-lieu-nghiep-vu"><span>Thêm bảng <code>undo_log</code> vào cơ sở dữ liệu nghiệp vụ</span></a></h3><p>Vì ở đây sử dụng chế độ AT của Seata, do đó cần tạo bảng <code>undo_log</code> ghi lại nhật ký quay lui trong cơ sở dữ liệu nghiệp vụ, cụ thể là các cơ sở dữ liệu <code>pmhub-project</code> và <code>pmhub-workflow</code>. Dưới đây là câu lệnh tạo bảng:</p><div class="language-sql" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- for AT mode you must to init this sql for you business database. the seata server not need it.</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`undo_log\`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`branch_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">     BIGINT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;branch transaction id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`xid\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">           VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;global transaction id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`context\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;undo_log context,such as serialization&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`rollback_info\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> LONGBLOB     </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;rollback info&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`log_status\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    INT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">11</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)      </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;0:normal status,1:defense status&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`log_created\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;create datetime&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`log_modified\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;modify datetime&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    UNIQUE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`ux_undo_log\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`xid\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`branch_id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> InnoDB AUTO_INCREMENT </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4 COMMENT </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;AT transaction mode undo table&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`undo_log\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> ADD</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`ix_log_created\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`log_created\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>Lưu ý quan trọng:</p><p>Nếu phiên bản của bạn gặp lỗi: &quot;undo_log needs to contain the primary key&quot;, bạn cần thêm khóa chính thủ công cho bảng <code>undo_log</code>. Bạn cũng có thể sao chép SQL dưới đây để tạo bảng trực tiếp.</p></div><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- for AT mode you must to init this sql for you business database. the seata server not need it.</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`undo_log\`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> BIGINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`branch_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">     BIGINT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;branch transaction id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`xid\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">           VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;global transaction id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`context\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;undo_log context,such as serialization&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`rollback_info\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> LONGBLOB     </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;rollback info&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`log_status\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    INT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">11</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)      </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;0:normal status,1:defense status&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`log_created\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;create datetime&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    \`log_modified\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;modify datetime&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    UNIQUE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`ux_undo_log\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`xid\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`branch_id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ) ENGINE </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> InnoDB AUTO_INCREMENT </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4 COMMENT </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;AT transaction mode undo table&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`undo_log\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> ADD</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`ix_log_created\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`log_created\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- ----------------------------</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- Records of undo_log</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- ----------------------------</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">BEGIN</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">COMMIT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="them-phu-thuoc-vao-pmhub-project" tabindex="-1"><a class="header-anchor" href="#them-phu-thuoc-vao-pmhub-project"><span>Thêm phụ thuộc vào <code>pmhub-project</code>:</span></a></h3><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&lt;!--Giao dịch phân tán--&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;com.laigeoffer.pmhub-cloud&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;pmhub-base-seata&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><h3 id="them-cau-hinh-seata-vao-tep-cau-hinh-pmhub-project-dev-yml" tabindex="-1"><a class="header-anchor" href="#them-cau-hinh-seata-vao-tep-cau-hinh-pmhub-project-dev-yml"><span>Thêm cấu hình seata vào tệp cấu hình <code>pmhub-project-dev.yml</code>:</span></a></h3><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Giao dịch phân tán</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">seata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  registry</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      server-addr</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">127.0.0.1:8848</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      namespace</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">SEATA_GROUP</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">seata-server</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  tx-service-group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">default_tx_group</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # Nhóm giao dịch, dùng để nhận tên của cụm TC service</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  service</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    vgroup-mapping</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      default_tx_group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">default</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # Mối quan hệ ánh xạ giữa nhóm giao dịch và cụm dịch vụ TC</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  data-source-proxy-mode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">AT</span></span></code></pre></div><hr><h3 id="them-annotation-globaltransactional-vao-interface" tabindex="-1"><a class="header-anchor" href="#them-annotation-globaltransactional-vao-interface"><span>Thêm annotation <code>@GlobalTransactional</code> vào interface</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GlobalTransactional</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">name</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;pmhub-project-addTask&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> rollbackFor</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// giao dịch phân tán seata, chế độ AT</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TaskReqVO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> taskReqVO) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Kiểm tra xid của giao dịch toàn cục (để dễ dàng theo dõi)</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> xid </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> RootContext</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getXID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;---------------Bắt đầu tạo nhiệm vụ: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\t</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;xid: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> xid);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ProjectStatusEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PAUSE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getStatus</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">projectTaskMapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">queryProjectStatus</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getProjectId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()))</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ServiceException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Dự án hiện đang tạm dừng, không thể thêm nhiệm vụ mới&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 1. Thêm nhiệm vụ</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    ProjectTask</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> projectTask </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ProjectTask</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">StringUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isNotBlank</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTaskId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setTaskPid</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTaskId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    BeanUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">copyProperties</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(taskReqVO, projectTask);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setCreatedBy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setCreatedTime</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUpdatedBy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUpdatedTime</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    projectTaskMapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">insert</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(projectTask);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 2. Thêm thành viên nhiệm vụ</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    insertMember</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 3. Thêm nhật ký</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    saveLog</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;addTask&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getProjectId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTaskName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;Tham gia vào nhiệm vụ&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Thêm người thực hiện nhiệm vụ</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Objects</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        insertMember</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Thêm nhật ký</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        saveLog</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;invitePartakeTask&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getProjectId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTaskName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;Mời &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> projectMemberMapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">selectUserById</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Collections</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">singletonList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getNickName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot; tham gia vào nhiệm vụ&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 4. Nhắc nhở về nhiệm vụ đã được chỉ định</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    extracted</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTaskName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 5. Thêm hoặc cập nhật cài đặt phê duyệt (gọi từ xa đến microservice \`pmhub-workflow\`)</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    ApprovalSetDTO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> approvalSetDTO </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ApprovalSetDTO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ProjectStatusEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TASK</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getStatusName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getApproved</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getDefinitionId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getDeploymentId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    R</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> result </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> wfDeployService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">insertOrUpdateApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(approvalSetDTO, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityConstants</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">INNER</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Objects</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isNull</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(result)</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Objects</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isNull</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            ||</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> R</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">fail</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ServiceException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;Gọi từ xa đến dịch vụ phê duyệt thất bại&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;---------------Kết thúc tạo nhiệm vụ: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\\t</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;xid: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> xid);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="bang-du-lieu" tabindex="-1"><a class="header-anchor" href="#bang-du-lieu"><span>Bảng dữ liệu</span></a></h3><ul><li><strong>pmhub_project_task</strong>:</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> \`</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">pmhub_project_task</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">\` (</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Primary key id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`created_by\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Creator&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`created_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Creation time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`updated_by\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Updater&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`updated_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Update time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`task_name\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task name&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`project_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`task_priority\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> tinyint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task priority&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`user_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;User id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`project_stage_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project stage id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`description\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task description&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`begin_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Planned start time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`end_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Planned end time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`close_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Deadline&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`task_pid\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Parent task&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`assign_to\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Assigned to&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`status\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> tinyint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task status&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`execute_status\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> tinyint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Execution status&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`task_process\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0.00&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task progress&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`deleted\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> tinyint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Deleted or not&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`deleted_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`task_flow\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task flow&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`task_type_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task type id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> BTREE,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> \`idx\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`project_id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`user_id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> BTREE</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">InnoDB </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">utf8mb4 COMMENT</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project-Task table&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>pmhub_project_member</strong>:</li></ul><div class="language-sql" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> \`</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">pmhub_project_member</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">\` (</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Primary key id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`pt_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project or task id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`user_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;User id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`joined_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Join time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`created_by\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Creator&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`created_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Creation time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`updated_by\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Updater&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`updated_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Update time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`type\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Type: project or task&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`creator\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> tinyint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Whether the creator&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> BTREE</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">InnoDB </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">utf8mb4 COMMENT</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project-Task Member&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li><strong>pmhub_project_log</strong>:</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> \`</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">pmhub_project_log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">\` (</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Primary key id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`user_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Operator id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`type\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Type: project or task&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`operate_type\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Operation type&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`content\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> text</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Operation content&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`remark\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Remarks&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`pt_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project or task id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`to_user_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`created_by\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`created_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`updated_by\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`updated_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`log_type\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> tinyint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;1&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;1-Activity 2-Deliverable 3-Comment&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`file_url\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;File URL&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`icon\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`project_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> BTREE</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">InnoDB </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">utf8mb4 COMMENT</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project-Task Log&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pmhub-thuc-chien-tao-moi-cap-nhat-trang-thai-phe-duyet" tabindex="-1"><a class="header-anchor" href="#pmhub-thuc-chien-tao-moi-cap-nhat-trang-thai-phe-duyet"><span>PmHub Thực Chiến - Tạo Mới/Cập Nhật Trạng Thái Phê Duyệt</span></a></h2><p>API:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">InnerAuth</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/updateApprovalSet&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">DistributedLock</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">key</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;#approvalSetDTO.approved&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> lockTime</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 10L</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> keyPrefix</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;workflow-approve-&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> R</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> updateApprovalSet</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ApprovalSetDTO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> approvalSetDTO) {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> R</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">ok</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">deployService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">updateApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(approvalSetDTO, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ProjectStatusEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PROJECT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getStatusName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()));</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>Cụ thể thực hiện mã:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> insertOrUpdateApprovalSet</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> extraId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> approved</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> definitionId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> deploymentId) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    LambdaQueryWrapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">WfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> qw </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> LambdaQueryWrapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    qw</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">eq</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(WfApprovalSet</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">::</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">getExtraId, extraId).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">eq</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(WfApprovalSet</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">::</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">getType, type);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    WfApprovalSet</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> mas </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> wfApprovalSetMapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">selectOne</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(qw);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (mas </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        mas</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setApproved</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(approved);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        mas</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setDefinitionId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(definitionId);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        mas</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setDeploymentId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(deploymentId);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        mas</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUpdatedBy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        mas</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUpdatedTime</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSetMapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">updateById</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(mas);</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        WfApprovalSet</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> wfApprovalSet </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> WfApprovalSet</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setExtraId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(extraId);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(type);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setApproved</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(approved);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setDefinitionId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(definitionId);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setDeploymentId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(deploymentId);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setCreatedBy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setCreatedTime</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUpdatedBy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUpdatedTime</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSetMapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">insert</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(wfApprovalSet);</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Liên quan đến cơ sở dữ liệu và bảng:</p><p>Cơ sở dữ liệu: pmhub-workflow</p><p>Bảng: pmhub_wf_approval_set</p><div class="language-sql" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> \`</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">pmhub_wf_approval_set</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">\` (</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`type\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`approved\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`deployment_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`definition_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`created_by\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`created_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`updated_by\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`updated_time\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  \`extra_id\`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">\`id\`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> BTREE</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">InnoDB </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">utf8mb4 COMMENT</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Bảng cấu hình trạng thái phê duyệt&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>Cấu hình thêm cho dịch vụ <code>pmhub-workflow-dev.yml</code>:</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Cấu hình giao dịch phân tán</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">seata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  registry</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      server-addr</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">127.0.0.1:8848</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      namespace</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">SEATA_GROUP</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">seata-server</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  tx-service-group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">default_tx_group</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # Nhóm giao dịch, nhận tên của cụm dịch vụ TC</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  service</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    vgroup-mapping</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      default_tx_group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">default</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # Mối quan hệ ánh xạ giữa nhóm giao dịch và cụm dịch vụ TC</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  data-source-proxy-mode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">AT</span></span></code></pre></div><h2 id="cau-hoi-phong-van" tabindex="-1"><a class="header-anchor" href="#cau-hoi-phong-van"><span>Câu hỏi phỏng vấn</span></a></h2><p><strong>1. Bạn đã viết về giao dịch phân tán trong CV, bạn đã thực hiện nó như thế nào?</strong></p><p>Đây là một câu hỏi khá rộng, bạn cần phải hiểu rõ cách mà PmHub kết hợp với giao dịch phân tán. Hãy tổ chức ngôn ngữ theo hiểu biết của bạn để trả lời câu hỏi này.</p><p><strong>2. Chế độ Seata-AT của Alibaba làm thế nào để không xâm nhập vào mã nghiệp vụ?</strong></p><p>Sau khi cấu hình kết nối tại phía khách hàng, chế độ Seata-AT sẽ thêm bảng <code>undo_log</code> vào cơ sở dữ liệu nghiệp vụ. Chế độ Seata-AT sẽ tự động tạo và quản lý <code>undo_log</code> trước và sau khi thực thi phương thức nghiệp vụ, nhằm ghi lại hình ảnh trước và sau của dữ liệu.</p><p>Nó thực hiện quản lý giao dịch tự động thông qua proxy, bằng cách cấu hình proxy nguồn dữ liệu của Seata, tất cả các thao tác cơ sở dữ liệu sẽ bị Seata chặn và quản lý giao dịch.</p><p>Chế độ Seata-AT thực hiện giao thức hai giai đoạn tự động (2PC), bao gồm giai đoạn chuẩn bị và giai đoạn cam kết/hoàn tác. Khi giao dịch được cam kết, Seata sẽ thực hiện thao tác chuẩn bị (ghi lại <code>undo_log</code>), sau đó quyết định cam kết hoặc hoàn tác dựa trên tình trạng của các giao dịch phân nhánh.</p><div class="hint-container info"><p class="hint-container-title">Info</p><p>Chế độ Seata-AT thực hiện việc không xâm nhập vào mã nghiệp vụ qua các cách sau:</p><ul><li>Tự động tạo và quản lý <code>undo_log</code>.</li><li>Chặn các thao tác cơ sở dữ liệu và giao dịch thông qua proxy.</li><li>Cấu hình đơn giản bằng cách sử dụng annotation để kích hoạt quản lý giao dịch phân tán.</li><li>Tự động xử lý quá trình cam kết và hoàn tác trong hai giai đoạn.</li></ul><p>Nhà phát triển chỉ cần thêm annotation vào phương thức nghiệp vụ mà không cần thay đổi logic nghiệp vụ ban đầu và cách thức thao tác cơ sở dữ liệu, giúp đơn giản hóa rất nhiều việc triển khai giao dịch phân tán.</p></div><p><strong>Trong giai đoạn đầu, Seata sẽ chặn “SQL nghiệp vụ”</strong>,</p><ol><li><p>Phân tích cú pháp SQL để tìm dữ liệu nghiệp vụ mà “SQL nghiệp vụ” cần cập nhật. Trước khi dữ liệu nghiệp vụ được cập nhật, Seata sẽ lưu lại hình ảnh trước của nó (&quot;before image&quot;).</p></li><li><p>Thực thi &quot;SQL nghiệp vụ&quot; để cập nhật dữ liệu nghiệp vụ. Sau khi cập nhật, Seata sẽ lưu lại hình ảnh sau (&quot;after image&quot;) và cuối cùng tạo khóa hàng.</p></li></ol><p>Tất cả các thao tác trên đều được hoàn thành trong một giao dịch cơ sở dữ liệu, đảm bảo tính nguyên tử của giai đoạn đầu.</p><figure><img src="https://cdn.nlark.com/yuque/0/2024/png/29495295/1719395526981-e02f9478-7727-42c1-8948-975d261a7553.png" alt="Seata Giai đoạn 1" tabindex="0" loading="lazy"><figcaption>Seata Giai đoạn 1</figcaption></figure><p><strong>Giai đoạn hai khi cam kết thành công:</strong></p><div class="hint-container info"><p class="hint-container-title">Info</p><p>Nếu giai đoạn hai được cam kết thành công,</p><p>Vì “SQL nghiệp vụ” đã được cam kết với cơ sở dữ liệu trong giai đoạn đầu, nên khung Seata chỉ cần xóa dữ liệu snapshot và khóa hàng đã lưu trong giai đoạn đầu để hoàn tất việc dọn dẹp dữ liệu.</p><figure><img src="https://cdn.nlark.com/yuque/0/2024/png/29495295/1719395592766-12f22df4-c88d-4495-b3d0-e8fd2c776603.png" alt="Seata Giai đoạn 2" tabindex="0" loading="lazy"><figcaption>Seata Giai đoạn 2</figcaption></figure></div><p><strong>Giai đoạn hai khi gặp sự cố:</strong></p>`,109)),s("div",r,[i[4]||(i[4]=s("p",{class:"hint-container-title"},"Info",-1)),i[5]||(i[5]=s("p",null,"Trong trường hợp phải hoàn tác ở giai đoạn hai:",-1)),h(n,{style:{color:"#DF2A3F"}},{default:t(()=>i[1]||(i[1]=[a("Seata cần phải hoàn tác “SQL nghiệp vụ” đã được thực hiện ở giai đoạn một và khôi phục dữ liệu nghiệp vụ.")])),_:1}),i[6]||(i[6]=s("p",null,"Cách hoàn tác là sử dụng “before image” để khôi phục dữ liệu nghiệp vụ. Tuy nhiên, trước khi khôi phục, Seata cần kiểm tra viết bẩn bằng cách so sánh dữ liệu hiện tại trong cơ sở dữ liệu và “after image”.",-1)),s("p",null,[i[3]||(i[3]=a("Nếu hai bản dữ liệu giống nhau, điều đó có nghĩa là không có viết bẩn và có thể khôi phục dữ liệu. ")),h(n,{style:{color:"#DF2A3F"}},{default:t(()=>i[2]||(i[2]=[a("Nếu không giống nhau, điều đó có nghĩa là có viết bẩn và cần phải xử lý thủ công.")])),_:1})]),i[7]||(i[7]=s("figure",null,[s("img",{src:"https://cdn.nlark.com/yuque/0/2024/png/29495295/1719395636269-91d4ff83-d0d7-4c05-a3fb-56f209d8d525.png",alt:"Seata Giai đoạn 2 - Hoàn tác",tabindex:"0",loading:"lazy"}),s("figcaption",null,"Seata Giai đoạn 2 - Hoàn tác")],-1))]),i[13]||(i[13]=l("<p><strong>3. Các giải pháp cho giao dịch phân tán là gì?</strong></p><p>Có 6 giải pháp chính để triển khai giao dịch phân tán:</p><ul><li>Giải pháp XA</li><li>Giải pháp TCC</li><li>Giải pháp SAGA</li><li>Bảng thông điệp cục bộ</li><li>Giải pháp đảm bảo thông điệp cuối cùng nhất quán</li><li>Giải pháp thông báo nỗ lực tối đa</li></ul><p>Bạn có thể xem thêm tài liệu để hiểu rõ hơn về các giải pháp này.</p>",4))])}const A=k(d,[["render",g],["__file","distributed-transaction.html.vue"]]),C=JSON.parse('{"path":"/project/pmhub/distributed-transaction.html","title":"Distributed Transaction","lang":"en-US","frontmatter":{"title":"Distributed Transaction","tags":["java","microservice"],"categories":["project"],"order":11,"description":"PmHub - Distributed Transaction with Seata Bài viết này chủ yếu nói về cách sử dụng Seata để đảm bảo tính nhất quán của trạng thái phê duyệt nhiệm vụ trong hệ thống PmHub. Giao ...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/project/pmhub/distributed-transaction.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"Distributed Transaction"}],["meta",{"property":"og:description","content":"PmHub - Distributed Transaction with Seata Bài viết này chủ yếu nói về cách sử dụng Seata để đảm bảo tính nhất quán của trạng thái phê duyệt nhiệm vụ trong hệ thống PmHub. Giao ..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-mysql-log.drawio.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-10-02T17:20:50.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"java"}],["meta",{"property":"article:tag","content":"microservice"}],["meta",{"property":"article:modified_time","content":"2024-10-02T17:20:50.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Distributed Transaction\\",\\"image\\":[\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-mysql-log.drawio.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-add-task.drawio.png\\",\\"https://seata.apache.org/assets/images/solution-1bdadb80e54074aa3088372c17f0244b.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919143501.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919151242.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919151318.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919152345.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-add-task.drawio.png\\",\\"https://cdn.nlark.com/yuque/0/2024/png/29495295/1719395526981-e02f9478-7727-42c1-8948-975d261a7553.png\\",\\"https://cdn.nlark.com/yuque/0/2024/png/29495295/1719395592766-12f22df4-c88d-4495-b3d0-e8fd2c776603.png\\",\\"https://cdn.nlark.com/yuque/0/2024/png/29495295/1719395636269-91d4ff83-d0d7-4c05-a3fb-56f209d8d525.png\\"],\\"dateModified\\":\\"2024-10-02T17:20:50.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Giao dịch","slug":"giao-dich","link":"#giao-dich","children":[]},{"level":2,"title":"Giao dịch cục bộ","slug":"giao-dich-cuc-bo","link":"#giao-dich-cuc-bo","children":[]},{"level":2,"title":"Giao dịch phân tán","slug":"giao-dich-phan-tan","link":"#giao-dich-phan-tan","children":[]},{"level":2,"title":"Giải pháp giao dịch phân tán","slug":"giai-phap-giao-dich-phan-tan","link":"#giai-phap-giao-dich-phan-tan","children":[]},{"level":2,"title":"Giới thiệu Seata","slug":"gioi-thieu-seata","link":"#gioi-thieu-seata","children":[{"level":3,"title":"Seata là gì?","slug":"seata-la-gi","link":"#seata-la-gi","children":[]},{"level":3,"title":"Cơ chế tổng thể","slug":"co-che-tong-the","link":"#co-che-tong-the","children":[]},{"level":3,"title":"Chế độ AT","slug":"che-đo-at","link":"#che-đo-at","children":[]},{"level":3,"title":"Chế độ TCC","slug":"che-đo-tcc","link":"#che-đo-tcc","children":[]},{"level":3,"title":"Chế độ Saga","slug":"che-đo-saga","link":"#che-đo-saga","children":[]}]},{"level":2,"title":"Cài đặt và tải xuống Seata","slug":"cai-đat-va-tai-xuong-seata","link":"#cai-đat-va-tai-xuong-seata","children":[{"level":3,"title":"Tải xuống","slug":"tai-xuong","link":"#tai-xuong","children":[]},{"level":3,"title":"Tạo cơ sở dữ liệu và bảng","slug":"tao-co-so-du-lieu-va-bang","link":"#tao-co-so-du-lieu-va-bang","children":[]},{"level":3,"title":"Thay đổi cấu hình","slug":"thay-đoi-cau-hinh","link":"#thay-đoi-cau-hinh","children":[]},{"level":3,"title":"Khởi động Seata","slug":"khoi-đong-seata","link":"#khoi-đong-seata","children":[]}]},{"level":2,"title":"PmHub Thực Chiến - Thêm Nhiệm Vụ Quản Lý Giao Dịch","slug":"pmhub-thuc-chien-them-nhiem-vu-quan-ly-giao-dich","link":"#pmhub-thuc-chien-them-nhiem-vu-quan-ly-giao-dich","children":[{"level":3,"title":"Thêm bảng undo_log vào cơ sở dữ liệu nghiệp vụ","slug":"them-bang-undo-log-vao-co-so-du-lieu-nghiep-vu","link":"#them-bang-undo-log-vao-co-so-du-lieu-nghiep-vu","children":[]},{"level":3,"title":"Thêm phụ thuộc vào pmhub-project:","slug":"them-phu-thuoc-vao-pmhub-project","link":"#them-phu-thuoc-vao-pmhub-project","children":[]},{"level":3,"title":"Thêm cấu hình seata vào tệp cấu hình pmhub-project-dev.yml:","slug":"them-cau-hinh-seata-vao-tep-cau-hinh-pmhub-project-dev-yml","link":"#them-cau-hinh-seata-vao-tep-cau-hinh-pmhub-project-dev-yml","children":[]},{"level":3,"title":"Thêm annotation @GlobalTransactional vào interface","slug":"them-annotation-globaltransactional-vao-interface","link":"#them-annotation-globaltransactional-vao-interface","children":[]},{"level":3,"title":"Bảng dữ liệu","slug":"bang-du-lieu","link":"#bang-du-lieu","children":[]}]},{"level":2,"title":"PmHub Thực Chiến - Tạo Mới/Cập Nhật Trạng Thái Phê Duyệt","slug":"pmhub-thuc-chien-tao-moi-cap-nhat-trang-thai-phe-duyet","link":"#pmhub-thuc-chien-tao-moi-cap-nhat-trang-thai-phe-duyet","children":[]},{"level":2,"title":"Câu hỏi phỏng vấn","slug":"cau-hoi-phong-van","link":"#cau-hoi-phong-van","children":[]}],"git":{"createdTime":1727889650000,"updatedTime":1727889650000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":21.67,"words":6502},"filePathRelative":"project/pmhub/distributed-transaction.md","localizedDate":"October 2, 2024","excerpt":"\\n<p>Bài viết này chủ yếu nói về cách sử dụng Seata để đảm bảo tính nhất quán của trạng thái phê duyệt nhiệm vụ trong hệ thống PmHub.</p>\\n<p>Giao dịch phân tán luôn là một chủ đề phỏng vấn được ưa chuộng, nhưng tôi nhận thấy các hướng dẫn trên mạng thường tập trung nhiều vào lý thuyết mà ít liên kết với các dự án thực tế. Trong khi đó, phỏng vấn thường dựa trên những tình huống thực tiễn để kiểm tra kiến thức của ứng viên. Mục tiêu của chúng ta là kết hợp lý thuyết với thực hành, giúp bạn tránh được nhiều trở ngại.</p>","autoDesc":true}');export{A as comp,C as data};
