import{_ as s,o as a,c as n,d as i}from"./app-BdwADm4z.js";const l={},t=i(`<h1 id="redis-basic-data-types" tabindex="-1"><a class="header-anchor" href="#redis-basic-data-types"><span>Redis Basic Data Types</span></a></h1><p>Redis cung cấp nhiều loại dữ liệu, mỗi loại dữ liệu đều có các lệnh hỗ trợ phong phú.</p><p>Khi sử dụng Redis, không chỉ cần hiểu các đặc điểm của các loại dữ liệu, mà còn cần linh hoạt và hiệu quả trong việc sử dụng các loại dữ liệu này để xây dựng mô hình dữ liệu phù hợp với kịch bản nghiệp vụ.</p><p>Các loại dữ liệu cơ bản mà Redis hỗ trợ:</p><ul><li><strong>STRING</strong>: Chuỗi</li><li><strong>HASH</strong>: Bảng băm</li><li><strong>LIST</strong>: List</li><li><strong>SET</strong>: Tập hợp</li><li><strong>ZSET</strong>: Tập hợp có thứ tự</li></ul><p>Các loại dữ liệu nâng cao mà Redis hỗ trợ:</p><ul><li><strong>BitMap</strong>: Bản đồ bit</li><li><strong>HyperLogLog</strong>: Đếm dữ liệu khổng lồ</li><li><strong>GEO</strong>: Dữ liệu vị trí địa lý</li><li><strong>Stream</strong>: Dữ liệu luồng</li></ul><p>Sử dụng Redis, không chỉ cần hiểu các đặc tính của các loại dữ liệu mà còn cần linh hoạt và hiệu quả trong việc sử dụng các loại dữ liệu này để xây dựng mô hình theo từng tình huống cụ thể của nghiệp vụ.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624195542.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h2 id="cac-kieu-du-lieu-co-ban-cua-redis" tabindex="-1"><a class="header-anchor" href="#cac-kieu-du-lieu-co-ban-cua-redis"><span>Các kiểu dữ liệu cơ bản của Redis</span></a></h2><table><thead><tr><th>Kiểu dữ liệu</th><th>Giá trị có thể lưu trữ</th><th>Các hoạt động</th></tr></thead><tbody><tr><td>STRING</td><td>Chuỗi, số nguyên hoặc số thực</td><td>Thực hiện các hoạt động trên toàn bộ chuỗi hoặc một phần của chuỗi <br>Thực hiện tăng hoặc giảm giá trị số nguyên hoặc số thực</td></tr><tr><td>LIST</td><td>List</td><td>Thêm hoặc lấy ra phần tử từ hai đầu <br>Đọc một hoặc nhiều phần tử <br>Thực hiện cắt tỉa, chỉ giữ lại một phạm vi phần tử</td></tr><tr><td>SET</td><td>Tập hợp không thứ tự</td><td>Thêm, lấy và xóa một phần tử <br>Kiểm tra xem một phần tử có tồn tại trong tập hợp hay không <br>Tính toán giao, hợp, hiệu <br>Lấy ngẫu nhiên một phần tử từ tập hợp</td></tr><tr><td>HASH</td><td>Bảng băm không thứ tự</td><td>Thêm, lấy và xóa một cặp khóa-giá trị <br>Lấy tất cả các cặp khóa-giá trị <br>Kiểm tra xem một khóa có tồn tại trong bảng hay không</td></tr><tr><td>ZSET</td><td>Tập hợp có thứ tự</td><td>Thêm, lấy và xóa phần tử <br>Lấy phần tử dựa trên phạm vi hoặc thành viên <br>Tính hạng của một khóa</td></tr></tbody></table><blockquote><p><a href="https://redislabs.com/ebook/part-1-getting-started/chapter-1-getting-to-know-redis/1-2-what-redis-data-structures-look-like/" target="_blank" rel="noopener noreferrer">What Redis data structures look like</a></p></blockquote><h2 id="string" tabindex="-1"><a class="header-anchor" href="#string"><span>STRING</span></a></h2><h3 id="gioi-thieu-ve-string" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-ve-string"><span>Giới thiệu về String</span></a></h3><p>Kiểu dữ liệu String là một cấu trúc dạng cặp khóa-giá trị.</p><p>String là loại dữ liệu <strong>an toàn nhị phân</strong>. An toàn nhị phân có nghĩa là kiểu dữ liệu String không chỉ có thể lưu trữ dữ liệu văn bản mà còn có thể lưu trữ bất kỳ định dạng dữ liệu nhị phân nào, chẳng hạn như: hình ảnh, âm thanh, video, tệp nén, v.v.</p><p>Theo mặc định, giá trị của kiểu dữ liệu String có thể lên đến <strong>512 MB</strong>.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724115329.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="cach-trien-khai-string" tabindex="-1"><a class="header-anchor" href="#cach-trien-khai-string"><span>Cách triển khai String</span></a></h3><p>Cấu trúc dữ liệu cơ bản của kiểu String chủ yếu là <code>int</code> và <code>SDS</code> (Simple Dynamic String - Chuỗi động đơn giản).</p><p>SDS khác với chuỗi C mà chúng ta thường biết. Lý do không sử dụng chuỗi C vì SDS so với chuỗi gốc của C có những ưu điểm sau:</p><ul><li><strong>SDS không chỉ lưu trữ dữ liệu văn bản mà còn lưu trữ dữ liệu nhị phân</strong>. SDS sử dụng thuộc tính <code>len</code> để xác định độ dài chuỗi thay vì sử dụng ký tự kết thúc null, và tất cả các API của SDS đều xử lý dữ liệu trong mảng <code>buf[]</code> như là dữ liệu nhị phân. Do đó, SDS không chỉ có thể lưu trữ dữ liệu văn bản mà còn có thể lưu trữ dữ liệu nhị phân như hình ảnh, âm thanh, video, tệp nén.</li><li><strong>Thời gian phức tạp để lấy độ dài chuỗi của SDS là O(1)</strong>. Vì chuỗi C không ghi lại độ dài của chính nó, nên thời gian phức tạp để lấy độ dài là O(n); trong khi cấu trúc SDS sử dụng thuộc tính <code>len</code> để ghi lại độ dài chuỗi, do đó thời gian phức tạp là <code>O(1)</code>.</li><li><strong>API của SDS trong Redis là an toàn, việc nối chuỗi sẽ không gây ra tràn bộ đệm</strong>. SDS kiểm tra không gian trước khi nối chuỗi, nếu không đủ không gian sẽ tự động mở rộng, do đó sẽ không gây ra vấn đề tràn bộ đệm.</li></ul><p><strong>Mã hóa của đối tượng chuỗi có thể là <code>int</code>, <code>raw</code> hoặc <code>embstr</code></strong>.</p><p>Các phương pháp mã hóa giá trị của đối tượng chuỗi:</p><table><thead><tr><th style="text-align:left;">Giá trị</th><th style="text-align:left;">Mã hóa</th></tr></thead><tbody><tr><td style="text-align:left;">Số nguyên có thể được lưu bằng kiểu <code>long</code>.</td><td style="text-align:left;"><code>int</code></td></tr><tr><td style="text-align:left;">Số thực có thể được lưu bằng kiểu <code>long double</code>.</td><td style="text-align:left;"><code>embstr</code> hoặc <code>raw</code></td></tr><tr><td style="text-align:left;">Giá trị chuỗi hoặc số nguyên quá lớn không thể biểu diễn bằng <code>long</code>.</td><td style="text-align:left;"><code>embstr</code> hoặc <code>raw</code></td></tr></tbody></table><p>Nếu một đối tượng chuỗi lưu trữ giá trị số nguyên và giá trị này có thể biểu diễn bằng kiểu <code>long</code>, thì đối tượng chuỗi sẽ lưu trữ giá trị số nguyên trong thuộc tính <code>ptr</code> của cấu trúc đối tượng chuỗi (chuyển <code>void*</code> thành <code>long</code>), và sẽ đặt mã hóa của đối tượng chuỗi thành <code>int</code>.</p><p><strong>Ví dụ</strong></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SET number 10086</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; OBJECT ENCODING number</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;int&quot;</span></span></code></pre></div><p>Nếu đối tượng chuỗi lưu trữ một giá trị chuỗi và độ dài của chuỗi này lớn hơn <code>39</code> byte, thì đối tượng chuỗi sẽ sử dụng một chuỗi động đơn giản (SDS) để lưu trữ giá trị chuỗi này và mã hóa đối tượng sẽ được đặt là <code>raw</code>.</p><div class="language-c" data-ext="c" data-title="c"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> SET story </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Long, long, long ago there lived a king ...&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">OK</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> STRLEN story</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(integer) </span><span style="color:#D19A66;--shiki-dark:#D19A66;">43</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> OBJECT ENCODING story</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;raw&quot;</span></span></code></pre></div><p>Nếu đối tượng chuỗi lưu trữ một giá trị chuỗi và độ dài của chuỗi này nhỏ hơn hoặc bằng <code>39</code> byte, thì đối tượng chuỗi sẽ sử dụng mã hóa <code>embstr</code> để lưu trữ giá trị chuỗi này. Mã hóa <code>embstr</code> là một cách mã hóa tối ưu được thiết kế đặc biệt để lưu trữ các chuỗi ngắn.</p><p><strong>Ví dụ</strong></p><div class="language-c" data-ext="c" data-title="c"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> SET msg </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;hello&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">OK</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> OBJECT ENCODING msg</span></span>
<span class="line"><span style="color:#98C379;--shiki-dark:#98C379;">&quot;embstr&quot;</span></span></code></pre></div><h3 id="lenh-string" tabindex="-1"><a class="header-anchor" href="#lenh-string"><span>Lệnh String</span></a></h3><table><thead><tr><th>Lệnh</th><th>Mô tả</th></tr></thead><tbody><tr><td><code>SET</code></td><td>Lưu trữ một giá trị chuỗi</td></tr><tr><td><code>SETNX</code></td><td>Lưu trữ giá trị chuỗi chỉ khi khóa không tồn tại</td></tr><tr><td><code>GET</code></td><td>Lấy giá trị của khóa cụ thể</td></tr><tr><td><code>MGET</code></td><td>Lấy giá trị của một hoặc nhiều khóa cụ thể</td></tr><tr><td><code>INCRBY</code></td><td>Tăng giá trị số lưu trữ trong khóa lên một giá trị nhất định</td></tr><tr><td><code>DECRBY</code></td><td>Giảm giá trị số lưu trữ trong khóa xuống một giá trị nhất định</td></tr></tbody></table><blockquote><p>Tham khảo thêm các lệnh khác tại: <a href="https://redis.io/commands#string" target="_blank" rel="noopener noreferrer">Tài liệu chính thức về lệnh String của Redis</a></p></blockquote><p><strong>Ví dụ về các thao tác SET, GET, và DEL</strong></p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lưu giá trị &#39;hung&#39; cho khóa &#39;name&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; set name hung</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy giá trị của khóa &#39;name&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; get name</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;hung&quot;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lưu giá trị &#39;unknown&#39; cho khóa &#39;name&#39; (ghi đè giá trị cũ)</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; set name unknown</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; get name</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;unknown&quot;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Kiểm tra xem khóa &#39;name&#39; có tồn tại hay không</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; exists name</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xóa khóa &#39;name&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; del name</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Kiểm tra xem khóa &#39;name&#39; có tồn tại hay không</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; exists name</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">0</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy giá trị của khóa &#39;name&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; get name</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">nil</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Ví dụ về thao tác SETNX</strong></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Kiểm tra xem khóa &#39;lock&#39; có tồn tại hay không</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; exists lock</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">0</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lưu giá trị &#39;1&#39; cho khóa &#39;lock&#39;, lưu thành công</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; setnx lock 1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Cố gắng lưu giá trị &#39;2&#39; cho khóa &#39;lock&#39;, lưu thất bại do khóa đã tồn tại</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; setnx lock 2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">0</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy giá trị của khóa &#39;lock&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; get lock</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;1&quot;</span></span></code></pre></div><p><strong>Ví dụ về thao tác MSET, MGET</strong></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lưu trữ hàng loạt giá trị cho các khóa &#39;one&#39;, &#39;two&#39;, &#39;three&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; mset one 1 two 2 three 3</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy giá trị của các khóa &#39;one&#39;, &#39;two&#39;, &#39;three&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; mget one two three</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;2&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;3&quot;</span></span></code></pre></div><p><strong>Ví dụ về các thao tác INCR, DECR, INCRBY, DECRBY</strong></p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lưu giá trị &#39;0&#39; cho khóa &#39;counter&#39;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; set counter 0</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tăng giá trị của khóa &#39;counter&#39; lên 1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; incr counter</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tăng giá trị của khóa &#39;counter&#39; lên 9</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; incrby counter 9</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">10</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Giảm giá trị của khóa &#39;counter&#39; xuống 1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; decr counter</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">9</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Giảm giá trị của khóa &#39;counter&#39; xuống 9</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; decrby counter 9</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">0</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ung-dung-string" tabindex="-1"><a class="header-anchor" href="#ung-dung-string"><span>Ứng dụng String</span></a></h3><p><strong>Các kịch bản phù hợp: Cache, Bộ đếm, Chia sẻ Session</strong></p><h4 id="cache-đoi-tuong" tabindex="-1"><a class="header-anchor" href="#cache-đoi-tuong"><span>Cache đối tượng</span></a></h4><p>Có hai cách sử dụng String để cache đối tượng:</p><ol><li>Cache giá trị JSON của đối tượng</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; set user:1 {</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;name&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;hung&quot;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">,</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;sex&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">:</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;man&quot;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">}</span></span></code></pre></div><ol start="2"><li>Chia key thành dạng <code>user:ID:attribute</code>, sử dụng MSET để lưu trữ, dùng MGET để lấy giá trị các thuộc tính</li></ol><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; mset user:1:name hung user:1:sex man</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; mget user:1:name user:1:sex</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;hung&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;man&quot;</span></span></code></pre></div><h4 id="bo-đem" tabindex="-1"><a class="header-anchor" href="#bo-đem"><span>Bộ đếm</span></a></h4><p><strong>Kịch bản yêu cầu</strong></p><p>Thống kê số lượt truy cập, lượt yêu thích, lượt thích, v.v. của nội dung trên trang web.</p><p><strong>Giải pháp</strong></p><blockquote><p>Sử dụng kiểu String của Redis để lưu trữ một bộ đếm.</p></blockquote><p>Các thao tác phổ biến để duy trì bộ đếm:</p><ul><li>Tăng giá trị thống kê - sử dụng lệnh <code>INCR</code>, <code>INCRBY</code></li><li>Giảm giá trị thống kê - sử dụng lệnh <code>DECR</code>, <code>DECRBY</code></li></ul><p><strong>Ví dụ mã</strong></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Khởi tạo số lượt truy cập của bài viết ID là 1024 là 0</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; set blog:view:1024 0</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">OK</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tăng số lượt truy cập của bài viết ID là 1024 lên 1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; incr blog:view:1024</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tăng số lượt truy cập của bài viết ID là 1024 lên 1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; incr blog:view:1024</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xem số lượt truy cập của bài viết ID là 1024</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; get blog:view:1024</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;2&quot;</span></span></code></pre></div><h4 id="khoa-phan-tan" tabindex="-1"><a class="header-anchor" href="#khoa-phan-tan"><span>Khóa phân tán</span></a></h4><ol><li>Yêu cầu khóa</li></ol><p>Lệnh SET có tham số NX có thể thực hiện &quot;chỉ chèn khi key không tồn tại&quot;, có thể dùng nó để thực hiện khóa phân tán:</p><ul><li>Nếu key không tồn tại, chèn thành công, có thể coi là khóa thành công.</li><li>Nếu key đã tồn tại, chèn thất bại, có thể coi là khóa thất bại.</li></ul><p>Thông thường, khóa phân tán cũng sẽ được thiết lập thời gian hết hạn, lệnh khóa phân tán như sau:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SET</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> value</span><span style="color:#98C379;--shiki-dark:#98C379;"> NX</span><span style="color:#98C379;--shiki-dark:#98C379;"> PX</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 30000</span></span></code></pre></div><ul><li>key - là từ khóa của khóa phân tán.</li><li>value - là giá trị duy nhất được tạo bởi client.</li><li>NX - chỉ thực hiện SET nếu key không tồn tại. (Nếu Redis đã có key này, thiết lập thất bại và trả về <code>nil</code>)</li><li>PX 30000 - chỉ định key sẽ bị xóa sau 30 giây (nghĩa là khóa sẽ được giải phóng). Thiết lập thời gian hết hạn để tránh khóa không được giải phóng do các tình huống bất ngờ.</li></ul><ol start="2"><li>Giải phóng khóa</li></ol><p>Giải phóng khóa bằng cách xóa key, nhưng thông thường có thể sử dụng script <code>lua</code> để xóa, so sánh giá trị trước khi xóa, đảm bảo rằng chỉ client nào tạo ra khóa mới có thể xóa khóa đó. Để đảm bảo tính nguyên tử, có thể sử dụng script lua:</p><div class="language-lua" data-ext="lua" data-title="lua"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">-- Xóa khóa nếu giá trị của key trùng khớp với giá trị truyền vào</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">call</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;get&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;">KEYS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">]) == </span><span style="color:#E06C75;--shiki-dark:#E06C75;">ARGV</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="color:#C678DD;--shiki-dark:#C678DD;">then</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> redis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">call</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;del&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;">KEYS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">])</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">else</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">end</span></span></code></pre></div><h4 id="chia-se-thong-tin-session" tabindex="-1"><a class="header-anchor" href="#chia-se-thong-tin-session"><span>Chia sẻ thông tin Session</span></a></h4><p>Trong môi trường phân tán, nếu một Session của người dùng chỉ được lưu trên một máy chủ, khi bộ cân bằng tải chuyển yêu cầu tiếp theo của người dùng tới máy chủ khác, máy chủ này không có Session của người dùng, có thể dẫn đến việc người dùng phải đăng nhập lại.</p><p>Các chiến lược để thực hiện Session phân tán:</p><ol><li>Session dính</li><li>Sao chép và chia sẻ session giữa các máy chủ ứng dụng</li><li>Chia sẻ session dựa trên cache ✅</li></ol><p>Thực hiện chia sẻ session dựa trên cache</p><blockquote><p><strong>Sử dụng một máy chủ lưu trữ riêng biệt để lưu trữ dữ liệu Session</strong>, có thể là MySQL, Redis hoặc Memcached.</p><p>Nhược điểm: Cần triển khai mã để truy xuất Session.</p></blockquote><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624200410.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h2 id="hash" tabindex="-1"><a class="header-anchor" href="#hash"><span>HASH</span></a></h2><h3 id="gioi-thieu-ve-hash" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-ve-hash"><span>Giới thiệu về Hash</span></a></h3><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724122757.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Hash là một tập hợp các cặp khóa-giá trị (key-value), trong đó giá trị có dạng: <code>value=[{field1, value1}, ...{fieldN, valueN}]</code>. Hash đặc biệt phù hợp để lưu trữ các đối tượng.</p><h3 id="cau-truc-hash" tabindex="-1"><a class="header-anchor" href="#cau-truc-hash"><span>Cấu trúc Hash</span></a></h3><p>Mã hóa của đối tượng Hash có thể là <code>ziplist</code> hoặc <code>hashtable</code>.</p><ul><li><code>ziplist</code>: Mã hóa đối tượng Hash bằng List nén làm cấu trúc nền tảng. Mỗi khi có một cặp khóa-giá trị mới được thêm vào đối tượng Hash, chương trình sẽ đẩy nút chứa khóa vào cuối List nén, sau đó đẩy nút chứa giá trị vào cuối List nén.</li><li><code>hashtable</code>: Mã hóa đối tượng Hash bằng bảng băm làm cấu trúc nền tảng. Mỗi cặp khóa-giá trị trong đối tượng Hash đều được lưu trữ dưới dạng một cặp khóa-giá trị của bảng băm.</li></ul><p>Đối tượng Hash sẽ sử dụng mã hóa <code>ziplist</code> khi đồng thời thỏa mãn hai điều kiện sau; ngược lại, sẽ sử dụng mã hóa <code>hashtable</code>:</p><ol><li>Độ dài của tất cả các khóa và giá trị của các cặp khóa-giá trị trong đối tượng Hash đều nhỏ hơn <code>64</code> byte (có thể được cấu hình bằng <code>hash-max-ziplist-value</code>).</li><li>Số lượng cặp khóa-giá trị trong đối tượng Hash nhỏ hơn <code>512</code> (có thể được cấu hình bằng <code>hash-max-ziplist-entries</code>).</li></ol><blockquote><p>Lưu ý: Giá trị giới hạn của hai điều kiện này có thể được thay đổi, cụ thể hãy xem phần mô tả trong tệp cấu hình về tùy chọn <code>hash-max-ziplist-value</code> và <code>hash-max-ziplist-entries</code>.</p></blockquote><h3 id="cac-lenh-cua-hash" tabindex="-1"><a class="header-anchor" href="#cac-lenh-cua-hash"><span>Các lệnh của Hash</span></a></h3><table><thead><tr><th>Lệnh</th><th>Mô tả</th></tr></thead><tbody><tr><td><code>HSET</code></td><td>Thiết lập giá trị của trường đã chỉ định</td></tr><tr><td><code>HGET</code></td><td>Lấy giá trị của trường đã chỉ định</td></tr><tr><td><code>HGETALL</code></td><td>Lấy tất cả các cặp khóa-giá trị</td></tr><tr><td><code>HMSET</code></td><td>Thiết lập nhiều cặp khóa-giá trị</td></tr><tr><td><code>HMGET</code></td><td>Lấy giá trị của nhiều trường đã chỉ định</td></tr><tr><td><code>HDEL</code></td><td>Xóa trường đã chỉ định</td></tr><tr><td><code>HINCRBY</code></td><td>Tăng giá trị số nguyên của trường đã chỉ định</td></tr><tr><td><code>HKEYS</code></td><td>Lấy tất cả các trường</td></tr></tbody></table><blockquote><p>Xem thêm các lệnh tại <a href="https://redis.io/commands#hash" target="_blank" rel="noopener noreferrer">Tài liệu chính thức về các lệnh của Redis Hash</a></p></blockquote><p>Ví dụ về các lệnh Hash:</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lưu trữ một giá trị của bảng băm</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">HSET</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> field</span><span style="color:#98C379;--shiki-dark:#98C379;"> value</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy giá trị của trường trong bảng băm</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">HGET</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> field</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lưu trữ nhiều cặp khóa-giá trị trong bảng băm</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">HMSET</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> field</span><span style="color:#98C379;--shiki-dark:#98C379;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [field </span><span style="color:#98C379;--shiki-dark:#98C379;">value...]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy giá trị của nhiều trường trong bảng băm</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">HMGET</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> field</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [field </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xóa trường trong bảng băm</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">HDEL</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> field</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [field </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Trả về số lượng trường trong bảng băm</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">HLEN</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Trả về tất cả các cặp khóa-giá trị trong bảng băm</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">HGETALL</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tăng giá trị của trường trong bảng băm lên n</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">HINCRBY</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> field</span><span style="color:#98C379;--shiki-dark:#98C379;"> n</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ung-dung-cua-hash" tabindex="-1"><a class="header-anchor" href="#ung-dung-cua-hash"><span>Ứng dụng của Hash</span></a></h3><blockquote><p><strong>Hash phù hợp để lưu trữ dữ liệu có cấu trúc.</strong></p></blockquote><h4 id="cache-đoi-tuong-1" tabindex="-1"><a class="header-anchor" href="#cache-đoi-tuong-1"><span>Cache đối tượng</span></a></h4><p>Cấu trúc (key, field, value) của Hash giống với cấu trúc (id đối tượng, thuộc tính, giá trị) của đối tượng, nên cũng có thể dùng để lưu trữ đối tượng.</p><p>Ví dụ, với thông tin người dùng trong cơ sở dữ liệu quan hệ:</p><p>Chúng ta có thể sử dụng các lệnh sau để lưu trữ thông tin đối tượng người dùng vào Hash:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lưu trữ một bảng băm với id người dùng là 1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; HMSET uid:1 name Tom age 15</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lưu trữ một bảng băm với id người dùng là 2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; HMSET uid:2 name Jerry age 13</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy tất cả các cặp khóa-giá trị của người dùng có id là 1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; HGETALL uid:1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;name&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Tom&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;age&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;15&quot;</span></span></code></pre></div><p>Cấu trúc lưu trữ Hash của Redis:</p><p>Trong các kịch bản ứng dụng của kiểu String đã được giới thiệu trước đó, việc sử dụng String + JSON cũng là một cách để lưu trữ đối tượng. Vậy khi lưu trữ đối tượng, nên dùng String + JSON hay Hash?</p><p>Thông thường, đối tượng được lưu trữ bằng String + JSON. Đối với những thuộc tính thay đổi thường xuyên của đối tượng, có thể tách ra và lưu trữ bằng Hash.</p><h4 id="gio-hang" tabindex="-1"><a class="header-anchor" href="#gio-hang"><span>Giỏ hàng</span></a></h4><p><strong>Kịch bản yêu cầu</strong></p><p>Người dùng duyệt trang web thương mại điện tử, thêm sản phẩm vào giỏ hàng và hỗ trợ xem giỏ hàng. Cần xem xét trường hợp chưa đăng nhập.</p><p><strong>Giải pháp</strong></p><blockquote><p>Có thể sử dụng kiểu HASH để thực hiện chức năng giỏ hàng.</p><p>Sử dụng session của người dùng làm khóa, lưu trữ ánh xạ giữa ID sản phẩm và số lượng sản phẩm. Trong đó, ID sản phẩm là trường, số lượng sản phẩm là giá trị.</p><p>Tại sao không sử dụng ID người dùng?</p><p>Vì trong nhiều trường hợp, cần hỗ trợ người dùng sử dụng giỏ hàng mà không cần đăng nhập, do đó không biết ID người dùng. Trong trường hợp này, việc sử dụng session của người dùng phù hợp hơn. Ngoài ra, khi xóa session, có thể tiện lợi xóa luôn cache giỏ hàng.</p></blockquote><p>Các thao tác phổ biến để duy trì giỏ hàng:</p><ul><li>Thêm sản phẩm - <code>HSET cart:{session} {productID} 1</code></li><li>Thêm số lượng - <code>HINCRBY cart:{session} {productID} 1</code></li><li>Tổng số sản phẩm - <code>HLEN cart:{session}</code></li><li>Xóa sản phẩm - <code>HDEL cart:{session} {productID}</code></li><li>Lấy tất cả sản phẩm trong giỏ hàng - <code>HGETALL cart:{session}</code></li></ul><p>Hiện tại, chỉ lưu trữ ID sản phẩm vào Redis, khi hiển thị thông tin chi tiết của sản phẩm, cần truy vấn thêm cơ sở dữ liệu để lấy thông tin đầy đủ của sản phẩm.</p><h2 id="list" tabindex="-1"><a class="header-anchor" href="#list"><span>LIST</span></a></h2><p>Loại List trong Redis là một danh sách có thứ tự.</p><h3 id="gioi-thieu-ve-list" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-ve-list"><span>Giới thiệu về List</span></a></h3><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724122821.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>List là một danh sách các chuỗi đơn giản, <strong>được sắp xếp theo thứ tự chèn vào</strong>, có thể thêm phần tử vào List từ đầu hoặc cuối.</p><p>List có độ dài tối đa là <code>2^32 - 1</code>, tức là mỗi List hỗ trợ hơn <code>4 tỷ</code> phần tử.</p><h3 id="cach-trien-khai-list" tabindex="-1"><a class="header-anchor" href="#cach-trien-khai-list"><span>Cách triển khai List</span></a></h3><p>Mã hóa đối tượng List có thể là <code>ziplist</code> hoặc <code>linkedlist</code>.</p><p>List mã hóa bằng <code>ziplist</code> sử dụng List nén làm cơ sở, mỗi nút trong List nén (entry) lưu trữ một phần tử trong List.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624201754.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>List mã hóa bằng <code>linkedlist</code> sử dụng List liên kết đôi làm cơ sở.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624201852.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Khi đối tượng List thỏa mãn đồng thời hai điều kiện sau, đối tượng List sử dụng mã hóa <code>ziplist</code>; ngược lại, sử dụng mã hóa <code>linkedlist</code>:</p><ol><li>Độ dài của tất cả các chuỗi trong List nhỏ hơn <code>64</code> byte.</li><li>Số lượng phần tử trong List nhỏ hơn <code>512</code>.</li></ol><blockquote><p>Lưu ý:</p><p>Hai giá trị giới hạn trên của hai điều kiện này có thể được thay đổi, chi tiết xem trong file cấu hình về các tùy chọn <code>list-max-ziplist-value</code> và <code>list-max-ziplist-entries</code>.</p></blockquote><h3 id="lenh-list" tabindex="-1"><a class="header-anchor" href="#lenh-list"><span>Lệnh List</span></a></h3><table><thead><tr><th>Lệnh</th><th>Hành vi</th></tr></thead><tbody><tr><td><code>LPUSH</code></td><td>Thêm giá trị vào đầu List.</td></tr><tr><td><code>RPUSH</code></td><td>Thêm giá trị vào cuối List.</td></tr><tr><td><code>LPOP</code></td><td>Xóa và trả về giá trị đầu tiên của List.</td></tr><tr><td><code>RPOP</code></td><td>Xóa và trả về giá trị cuối cùng của List.</td></tr><tr><td><code>LRANGE</code></td><td>Lấy tất cả các giá trị trong khoảng cho trước.</td></tr><tr><td><code>LINDEX</code></td><td>Lấy giá trị tại vị trí cho trước trong List.</td></tr><tr><td><code>LREM</code></td><td>Xóa giá trị đầu tiên trong List.</td></tr><tr><td><code>LTRIM</code></td><td>Chỉ giữ lại các phần tử trong khoảng cho trước, xóa các phần tử khác.</td></tr></tbody></table><blockquote><p>Tham khảo thêm các lệnh tại: <a href="https://redis.io/commands#list" target="_blank" rel="noopener noreferrer">Tài liệu chính thức về lệnh List của Redis</a></p></blockquote><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Thêm một hoặc nhiều giá trị vào đầu List key</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">LPUSH</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [value </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Thêm một hoặc nhiều giá trị vào cuối List key</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">RPUSH</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> value</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [value </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xóa và trả về giá trị đầu tiên của List key</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">LPOP</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xóa và trả về giá trị cuối cùng của List key</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">RPOP</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Trả về các phần tử trong List key trong khoảng start và stop, bắt đầu từ 0</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">LRANGE</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> start</span><span style="color:#98C379;--shiki-dark:#98C379;"> stop</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xóa phần tử đầu tiên trong List key, nếu không có phần tử nào thì chờ timeout giây, nếu timeout=0 thì chờ mãi mãi</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">BLPOP</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [key </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span><span style="color:#98C379;--shiki-dark:#98C379;"> timeout</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xóa phần tử cuối cùng trong List key, nếu không có phần tử nào thì chờ timeout giây, nếu timeout=0 thì chờ mãi mãi</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">BRPOP</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [key </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span><span style="color:#98C379;--shiki-dark:#98C379;"> timeout</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ung-dung-list" tabindex="-1"><a class="header-anchor" href="#ung-dung-list"><span>Ứng dụng List</span></a></h3><h4 id="hang-đoi-tin-nhan" tabindex="-1"><a class="header-anchor" href="#hang-đoi-tin-nhan"><span>Hàng đợi tin nhắn</span></a></h4><p>Hàng đợi tin nhắn cần thỏa mãn ba yêu cầu khi lưu trữ và truy xuất tin nhắn: <strong>duy trì thứ tự tin nhắn, xử lý tin nhắn lặp lại và đảm bảo độ tin cậy của tin nhắn</strong>.</p><p>Loại List và Stream trong Redis có thể thỏa mãn ba yêu cầu này. Trước tiên, chúng ta sẽ tìm hiểu về cách thực hiện hàng đợi tin nhắn dựa trên List, sau đó sẽ tìm hiểu về Stream.</p><p><em>1. Làm thế nào để duy trì thứ tự tin nhắn?</em></p><p>List tự thân là List lưu trữ dữ liệu theo nguyên tắc vào trước ra trước (FIFO), do đó, nếu sử dụng List làm hàng đợi tin nhắn, sẽ tự nhiên thỏa mãn yêu cầu này.</p><p>List có thể sử dụng lệnh LPUSH + RPOP (hoặc ngược lại, RPUSH+LPOP) để thực hiện hàng đợi tin nhắn.</p><ul><li><p>Nhà sản xuất sử dụng lệnh <code>LPUSH key value[value...]</code> để chèn tin nhắn vào đầu List, nếu key không tồn tại, nó sẽ tạo một List trống trước khi chèn tin nhắn.</p></li><li><p>Người tiêu thụ sử dụng lệnh <code>RPOP key</code> để lần lượt đọc tin nhắn từ List, theo thứ tự vào trước ra trước.</p></li></ul><p>Tuy nhiên, khi người tiêu thụ đọc dữ liệu, có một nguy cơ tiềm ẩn về hiệu suất.</p><p>Khi nhà sản xuất chèn dữ liệu vào List, List sẽ không tự động thông báo cho người tiêu thụ rằng có tin nhắn mới, nếu người tiêu thụ muốn xử lý tin nhắn kịp thời, họ cần phải liên tục gọi lệnh <code>RPOP</code> (ví dụ sử dụng vòng lặp while(1)). Nếu có tin nhắn mới, lệnh RPOP sẽ trả về kết quả, ngược lại, lệnh RPOP sẽ trả về giá trị trống và tiếp tục vòng lặp.</p><p>Vì vậy, ngay cả khi không có tin nhắn mới chèn vào List, người tiêu thụ cũng phải liên tục gọi lệnh RPOP, dẫn đến việc tiêu thụ CPU không cần thiết.</p><p>Để giải quyết vấn đề này, Redis cung cấp lệnh BRPOP. <strong>Lệnh BRPOP còn gọi là đọc chặn, khi không đọc được dữ liệu từ List, khách hàng sẽ tự động chặn, đợi đến khi có dữ liệu mới chèn vào List, sau đó mới bắt đầu đọc dữ liệu</strong>. So với việc chương trình người tiêu thụ tự mình liên tục gọi lệnh RPOP, cách này giúp tiết kiệm tài nguyên CPU.</p><p><em>2. Làm thế nào để xử lý tin nhắn lặp lại?</em></p><p>Người tiêu thụ cần thực hiện xác định tin nhắn lặp lại từ hai khía cạnh:</p><ul><li>Mỗi tin nhắn cần có một ID duy nhất toàn cục.</li><li>Người tiêu thụ cần ghi lại các ID tin nhắn đã được xử lý. Khi nhận được một tin nhắn, chương trình người tiêu thụ có thể so sánh ID tin nhắn nhận được với ID tin nhắn đã được xử lý để xác định liệu tin nhắn hiện tại đã được xử lý chưa. Nếu đã được xử lý, chương trình người tiêu thụ sẽ không xử lý lại.</li></ul><p>Nhưng <strong>List không tự động tạo ID cho mỗi tin nhắn</strong>, vì vậy chúng ta cần tự tạo một ID duy nhất toàn cục cho mỗi tin nhắn, sau đó khi sử dụng lệnh LPUSH để chèn tin nhắn vào List, chúng ta cần bao gồm ID duy nhất này trong tin nhắn.</p><p>Ví dụ, chúng ta có thể thực hiện lệnh sau để chèn một tin nhắn với ID duy nhất toàn cục là 111000102 và số lượng kho là 99 vào hàng đợi tin nhắn:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; LPUSH mq </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;111000102:stock:99&quot;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span></code></pre></div><p><em>3. Làm thế nào để đảm bảo độ tin cậy của tin nhắn?</em></p><p>Khi chương trình người tiêu thụ đọc một tin nhắn từ List, tin nhắn sẽ không còn lưu trữ trong List. Vì vậy, nếu chương trình người tiêu thụ gặp sự cố hoặc tắt máy trong quá trình xử lý tin nhắn, tin nhắn sẽ không được xử lý xong và chương trình người tiêu thụ khởi động lại sẽ không thể đọc lại tin nhắn từ List.</p><p>Để lưu trữ tin nhắn, List cung cấp lệnh <code>BRPOPLPUSH</code>. <strong>Lệnh này cho phép chương trình người tiêu thụ đọc tin nhắn từ một List, đồng thời Redis sẽ chèn tin nhắn đó vào một List khác (có thể gọi là List sao lưu) để lưu trữ</strong>.</p><p>Nhờ vậy, nếu chương trình người tiêu thụ đọc tin nhắn nhưng không xử lý thành công, khi khởi động lại, nó có thể đọc lại tin nhắn từ List sao lưu và tiếp tục xử lý.</p><p>Như vậy, chúng ta có thể thấy rằng dựa trên List, hàng đợi tin nhắn có thể đáp ứng ba yêu cầu chính (duy trì thứ tự tin nhắn, xử lý tin nhắn lặp lại và đảm bảo độ tin cậy của tin nhắn).</p><ul><li>Duy trì thứ tự tin nhắn: sử dụng LPUSH + RPOP.</li><li>Chặn đọc: sử dụng BRPOP.</li><li>Xử lý tin nhắn trùng lặp: nhà sản xuất tự triển khai một ID duy nhất trên toàn cầu.</li><li>Độ tin cậy của tin nhắn: Sử dụng BRPOPLPUSH</li></ul><blockquote><p>Hạn chế của List dưới dạng hàng đợi tin nhắn là gì?</p></blockquote><p>List không hỗ trợ nhiều người tiêu thụ sử dụng cùng một tin nhắn** , vì khi một người tiêu thụ lấy một tin nhắn, tin nhắn sẽ bị xóa khỏi Danh sách và những người tiêu thụ khác không thể sử dụng lại.</p><p>Để nhận ra rằng một tin nhắn có thể được sử dụng bởi nhiều người tiêu thụ, nhiều người tiêu thụ phải được hợp thành một nhóm người tiêu thụ để nhiều người tiêu thụ có thể sử dụng cùng một thông báo. Tuy nhiên, <strong>loại List không hỗ trợ việc triển khai các nhóm người tiêu thụ</strong>.</p><p>Đây là về kiểu dữ liệu Stream do Redis cung cấp bắt đầu từ phiên bản 5.0. Stream cũng có thể đáp ứng ba yêu cầu chính của hàng đợi tin nhắn và nó cũng hỗ trợ đọc tin nhắn dưới dạng &quot;nhóm người tiêu thụ&quot;.</p><h4 id="tu-đong-nhap-du-lieu" tabindex="-1"><a class="header-anchor" href="#tu-đong-nhap-du-lieu"><span>Tự động nhập dữ liệu</span></a></h4><p>【Kịch bản nhu cầu】</p><p>Dựa vào thông tin nhập từ người dùng, tự động hoàn thành thông tin, như: danh sách liên lạc, tên hàng hóa,...</p><ul><li>Tình huống điển hình 1 - Backend website mạng xã hội ghi lại 100 người bạn mà người dùng đã liên hệ gần đây. Khi người dùng tìm kiếm bạn bè, tên sẽ tự động được điền dựa trên từ khóa đã nhập.</li><li>Tình huống điển hình 2 - Phần backend của website thương mại điện tử ghi lại 10 sản phẩm mà người dùng đã xem gần đây. Khi người dùng tìm kiếm một sản phẩm, tên sản phẩm sẽ tự động được điền dựa trên từ khóa đã nhập.</li></ul><p>【Giải pháp】</p><blockquote><p>Sử dụng kiểu List của Redis để lưu trữ danh sách thông tin gần đây, sau đó tại thời điểm cần tự động hoàn thành thông tin, hiển thị số lượng dữ liệu tương ứng.</p></blockquote><p>Các thao tác phổ biến để duy trì danh sách các tin nhắn gần đây như sau:</p><ul><li>Nếu tin nhắn được chỉ định đã tồn tại trong danh sách tin nhắn gần đây thì nó sẽ bị xóa khỏi danh sách. Sử dụng <code>LREM</code>lệnh.</li><li>Thêm tin nhắn được chỉ định vào đầu danh sách tin nhắn gần đây. Sử dụng <code>LPUSH</code>lệnh.</li><li>Sau khi thao tác thêm hoàn tất, nếu số trong danh sách thông tin gần đây vượt quá giới hạn trên N thì thao tác cắt bớt sẽ được thực hiện. Sử dụng <code>LTRIM</code>lệnh.</li></ul><h2 id="set" tabindex="-1"><a class="header-anchor" href="#set"><span>SET</span></a></h2><p>Loại Set trong Redis là một tập hợp không có thứ tự và loại bỏ trùng lặp.</p><h3 id="gioi-thieu-ve-set" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-ve-set"><span>Giới thiệu về Set</span></a></h3><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724122943.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Set trong Redis là một tập hợp các cặp key - value không có thứ tự và các giá trị là duy nhất, tức là mỗi giá trị trong Set là duy nhất và không thứ tự về thời gian.</p><p>Một Set có thể lưu trữ tối đa <code>2^32-1</code> phần tử. Set trong Redis giống như tập hợp trong toán học, cho phép thực hiện các phép toán như giao, hợp, hiệu, và các hoạt động khác trên các tập hợp. Vì vậy, Set không chỉ hỗ trợ thêm, xóa, sửa và truy vấn các phần tử trong tập hợp mà còn hỗ trợ các phép toán với nhiều tập hợp như giao, hợp, hiệu.</p><p>Sự khác biệt giữa Set và List trong Redis như sau:</p><ul><li>List có thể lưu trữ các phần tử trùng lặp, trong khi Set chỉ có thể lưu trữ các phần tử duy nhất.</li><li>List lưu trữ các phần tử theo thứ tự chèn, trong khi Set lưu trữ các phần tử mà không có thứ tự nhất định.</li></ul><p>Set trong Redis là một cấu trúc dữ liệu mạnh mẽ để lưu trữ và xử lý các tập hợp các phần tử độc lập một cách hiệu quả.</p><h3 id="trien-khai-set" tabindex="-1"><a class="header-anchor" href="#trien-khai-set"><span>Triển khai Set</span></a></h3><p>Các đối tượng Set trong Redis có thể được mã hóa dưới hai dạng: <code>intset</code> hoặc <code>hashtable</code>.</p><h4 id="ma-hoa-intset" tabindex="-1"><a class="header-anchor" href="#ma-hoa-intset"><span>Mã hóa <code>intset</code></span></a></h4><p>Set được mã hóa bằng <code>intset</code> sử dụng một tập hợp số nguyên làm cấu trúc dữ liệu cơ sở. Tất cả các phần tử trong Set được lưu trữ trong tập hợp số nguyên này.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624203635.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h4 id="ma-hoa-hashtable" tabindex="-1"><a class="header-anchor" href="#ma-hoa-hashtable"><span>Mã hóa <code>hashtable</code></span></a></h4><p>Set được mã hóa bằng <code>hashtable</code> sử dụng một từ điển làm cấu trúc dữ liệu cơ sở. Mỗi khóa của từ điển là một đối tượng chuỗi, mỗi đối tượng chuỗi này chứa một phần tử của Set và các giá trị của từ điển được đặt là <code>NULL</code>.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624203650.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h4 id="đieu-kien-su-dung-intset-hoac-hashtable" tabindex="-1"><a class="header-anchor" href="#đieu-kien-su-dung-intset-hoac-hashtable"><span>Điều kiện sử dụng <code>intset</code> hoặc <code>hashtable</code></span></a></h4><p>Set sẽ sử dụng mã hóa <code>intset</code> khi đáp ứng cùng lúc hai điều kiện sau; nếu không, nó sẽ sử dụng mã hóa <code>hashtable</code>:</p><ol><li>Tất cả các phần tử trong Set là giá trị số nguyên.</li><li>Số lượng phần tử trong Set không vượt quá <code>512</code>.</li></ol><blockquote><p>Lưu ý: Giá trị trần của điều kiện thứ hai có thể được thay đổi. Xem thêm thông tin trong tài liệu cấu hình về tùy chọn <code>set-max-intset-entries</code>.</p></blockquote><p>Mã hóa <code>intset</code> và <code>hashtable</code> cung cấp cho Redis sự linh hoạt trong việc lưu trữ và quản lý các tập hợp dữ liệu, tối ưu hóa hiệu suất dựa trên các đặc tính của dữ liệu trong Set.</p><h3 id="cac-lenh-set" tabindex="-1"><a class="header-anchor" href="#cac-lenh-set"><span>Các lệnh Set</span></a></h3><p>Redis Set hỗ trợ nhiều lệnh để thao tác và thực hiện các phép toán trên tập hợp. Dưới đây là một số lệnh phổ biến:</p><table><thead><tr><th>Lệnh</th><th>Hành vi</th></tr></thead><tbody><tr><td><code>SADD</code></td><td>Thêm một hoặc nhiều thành viên vào tập hợp.</td></tr><tr><td><code>SMEMBERS</code></td><td>Trả về tất cả các thành viên của tập hợp.</td></tr><tr><td><code>SISMEMBER</code></td><td>Kiểm tra xem một thành viên có tồn tại trong tập hợp hay không.</td></tr><tr><td><code>SREM</code></td><td>Xoá một hoặc nhiều thành viên khỏi tập hợp.</td></tr><tr><td><code>SCARD</code></td><td>Lấy số lượng thành viên trong tập hợp.</td></tr><tr><td><code>SRANDMEMBER</code></td><td>Lấy một hoặc nhiều thành viên ngẫu nhiên từ tập hợp.</td></tr><tr><td><code>SPOP</code></td><td>Xoá và trả về một hoặc nhiều thành viên ngẫu nhiên từ tập hợp.</td></tr></tbody></table><table><thead><tr><th>Lệnh</th><th>Hành vi</th></tr></thead><tbody><tr><td><code>SINTER</code></td><td>Tính giao của nhiều tập hợp.</td></tr><tr><td><code>SINTERSTORE</code></td><td>Tính giao của nhiều tập hợp và lưu kết quả vào một tập hợp mới.</td></tr><tr><td><code>SUNION</code></td><td>Tính hợp của nhiều tập hợp.</td></tr><tr><td><code>SUNIONSTORE</code></td><td>Tính hợp của nhiều tập hợp và lưu kết quả vào một tập hợp mới.</td></tr><tr><td><code>SDIFF</code></td><td>Tính hiệu của hai tập hợp.</td></tr><tr><td><code>SDIFFSTORE</code></td><td>Tính hiệu của hai tập hợp và lưu kết quả vào một tập hợp mới.</td></tr></tbody></table><p>Để biết thêm chi tiết và các lệnh khác, bạn có thể tham khảo <a href="https://redis.io/commands#set" target="_blank" rel="noopener noreferrer">tài liệu lệnh Set của Redis</a>.</p><h4 id="cac-thao-tac-pho-bien-tren-set" tabindex="-1"><a class="header-anchor" href="#cac-thao-tac-pho-bien-tren-set"><span>Các Thao Tác Phổ Biến trên Set:</span></a></h4><h5 id="them-va-xoa-thanh-vien" tabindex="-1"><a class="header-anchor" href="#them-va-xoa-thanh-vien"><span>Thêm và Xoá Thành Viên:</span></a></h5><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Thêm các thành viên vào một tập hợp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> member</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [member </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xoá các thành viên khỏi một tập hợp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SREM</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> member</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [member </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span></span></code></pre></div><h5 id="lay-thanh-vien" tabindex="-1"><a class="header-anchor" href="#lay-thanh-vien"><span>Lấy Thành Viên:</span></a></h5><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy tất cả các thành viên của một tập hợp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SMEMBERS</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Kiểm tra xem một thành viên có tồn tại trong tập hợp hay không</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SISMEMBER</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> member</span></span></code></pre></div><h5 id="đem-so-luong-thanh-vien" tabindex="-1"><a class="header-anchor" href="#đem-so-luong-thanh-vien"><span>Đếm Số Lượng Thành Viên:</span></a></h5><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy số lượng thành viên trong một tập hợp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SCARD</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span></span></code></pre></div><h5 id="thao-tac-ngau-nhien-tren-tap-hop" tabindex="-1"><a class="header-anchor" href="#thao-tac-ngau-nhien-tren-tap-hop"><span>Thao Tác Ngẫu Nhiên trên Tập Hợp:</span></a></h5><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy một hoặc nhiều thành viên ngẫu nhiên từ tập hợp (không xoá chúng)</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SRANDMEMBER</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [count]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xoá và lấy một hoặc nhiều thành viên ngẫu nhiên từ tập hợp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SPOP</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [count]</span></span></code></pre></div><h5 id="cac-phep-toan-tren-tap-hop-giao-hop-hieu" tabindex="-1"><a class="header-anchor" href="#cac-phep-toan-tren-tap-hop-giao-hop-hieu"><span>Các Phép Toán trên Tập Hợp (Giao, Hợp, Hiệu):</span></a></h5><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tính giao của nhiều tập hợp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SINTER</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [key </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tính giao của nhiều tập hợp và lưu kết quả vào một tập hợp mới</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SINTERSTORE</span><span style="color:#98C379;--shiki-dark:#98C379;"> destination</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [key </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tính hợp của nhiều tập hợp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SUNION</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [key </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tính hợp của nhiều tập hợp và lưu kết quả vào một tập hợp mới</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SUNIONSTORE</span><span style="color:#98C379;--shiki-dark:#98C379;"> destination</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [key </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tính hiệu của hai tập hợp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [key </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tính hiệu của hai tập hợp và lưu kết quả vào một tập hợp mới</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFFSTORE</span><span style="color:#98C379;--shiki-dark:#98C379;"> destination</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [key </span><span style="color:#98C379;--shiki-dark:#98C379;">...]</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ung-dung-set" tabindex="-1"><a class="header-anchor" href="#ung-dung-set"><span>Ứng dụng Set</span></a></h3><p>Set trong Redis có các đặc tính chính là không có thứ tự, duy nhất và hỗ trợ các phép toán như giao, hợp, hiệu, ...</p><p>Do đó, Set rất phù hợp để loại bỏ dữ liệu trùng lặp và đảm bảo tính duy nhất của dữ liệu. Ngoài ra, nó cũng có thể được sử dụng để thống kê các phép giao, hợp và hiệu của nhiều tập hợp. Khi lưu trữ dữ liệu không có thứ tự và cần loại bỏ các giá trị trùng lặp, Set là lựa chọn lý tưởng.</p><p>Tuy nhiên, tôi muốn nhắc bạn rằng có một nguy cơ tiềm ẩn ở đây. <strong>Việc tính toán các phép hiệu, giao và hợp của Set có độ phức tạp cao. Trong trường hợp dữ liệu lớn, việc thực hiện các phép toán này trực tiếp có thể dẫn đến Redis bị chặn</strong>.</p><p>Trong một cụm sao lưu chính, để tránh việc máy chủ chính bị chặn do thực hiện các phép toán tổng hợp (giao, hiệu, hợp) trên Set, chúng ta có thể chọn một máy chủ sao lưu để hoàn thành các thống kê tổng hợp, hoặc trả dữ liệu về cho khách hàng để họ thực hiện các thống kê tổng hợp.</p><h4 id="luot-thich-đanh-gia-tich-cuc" tabindex="-1"><a class="header-anchor" href="#luot-thich-đanh-gia-tich-cuc"><span>Lượt thích (Đánh giá tích cực)</span></a></h4><p>Set trong Redis cho phép đảm bảo rằng mỗi người dùng chỉ có thể thực hiện một lần đánh giá tích cực cho một mục, ví dụ như một bài viết. Trong ví dụ sau, key là id của bài viết và value là id của người dùng.</p><p>Ba người dùng <code>uid:1</code>, <code>uid:2</code>, <code>uid:3</code> đã thực hiện đánh giá tích cực cho bài viết <code>article:1</code>.</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Người dùng uid:1 đánh giá tích cực cho bài viết article:1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SADD article:1 uid:1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Người dùng uid:2 đánh giá tích cực cho bài viết article:1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SADD article:1 uid:2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Người dùng uid:3 đánh giá tích cực cho bài viết article:1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SADD article:1 uid:3</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span></code></pre></div><p>Người dùng <code>uid:1</code> hủy đánh giá tích cực cho bài viết <code>article:1</code>.</p><div class="language-plain" data-ext="plain" data-title="plain"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>&gt; SREM article:1 uid:1</span></span>
<span class="line"><span>(integer) 1</span></span></code></pre></div><p>Lấy danh sách tất cả người dùng đã đánh giá tích cực cho bài viết <code>article:1</code>:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SMEMBERS article:1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;uid:3&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;uid:2&quot;</span></span></code></pre></div><p>Lấy số lượng người dùng đã đánh giá tích cực cho bài viết <code>article:1</code>:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SCARD article:1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span></span></code></pre></div><p>Kiểm tra xem người dùng <code>uid:1</code> đã đánh giá tích cực cho bài viết <code>article:1</code> hay chưa:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SISMEMBER article:1 uid:1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">0</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">  # Trả về 0 có nghĩa là chưa đánh giá tích cực, trả về 1 có nghĩa là đã đánh giá tích cực</span></span></code></pre></div><h4 id="chia-se-lua-chon" tabindex="-1"><a class="header-anchor" href="#chia-se-lua-chon"><span>Chia sẻ lựa chọn</span></a></h4><p>Set trong Redis hỗ trợ phép toán giao của nó, vì vậy nó có thể được sử dụng để tính toán những gì mà nhiều người dùng cùng quan tâm như bạn bè chung, các tài khoản công cộng và nhiều hơn nữa.</p><p>Key có thể là ID người dùng, giá trị là ID của tài khoản công cộng mà họ đã theo dõi.</p><p>Người dùng <code>uid:1</code> theo dõi tài khoản công cộng với ID là 5, 6, 7, 8, 9; người dùng <code>uid:2</code> theo dõi tài khoản công cộng với ID là 7, 8, 9, 10, 11.</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Người dùng uid:1 theo dõi các tài khoản công cộng với ID là 5, 6, 7, 8, 9</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SADD uid:1 5 6 7 8 9</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">5</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Người dùng uid:2 theo dõi các tài khoản công cộng với ID là 7, 8, 9, 10, 11</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SADD uid:2 7 8 9 10 11</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">5</span></span></code></pre></div><p>Các tài khoản công cộng mà <code>uid:1</code> và <code>uid:2</code> cùng theo dõi:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy giao của chung</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SINTER uid:1 uid:2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;7&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;8&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;9&quot;</span></span></code></pre></div><p>Gợi ý cho <code>uid:2</code> các tài khoản công cộng mà <code>uid:1</code> đã theo dõi:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SDIFF uid:1 uid:2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;5&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;6&quot;</span></span></code></pre></div><p>Xác minh xem một tài khoản công cộng cụ thể có được theo dõi bởi <code>uid:1</code> hoặc <code>uid:2</code> hay không:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SISMEMBER uid:1 5</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> # Trả về 1, tức là đã theo dõi</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SISMEMBER uid:2 5</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">0</span><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"> # Trả về 0, tức là chưa theo dõi</span></span></code></pre></div><h4 id="hoat-đong-rut-tham-may-man" tabindex="-1"><a class="header-anchor" href="#hoat-đong-rut-tham-may-man"><span>Hoạt động rút thăm may mắn</span></a></h4><p>Set trong Redis rất hữu ích để lưu trữ tên người dùng đã trúng thưởng trong một hoạt động rút thăm may mắn, với tính năng loại bỏ các giá trị trùng lặp, đảm bảo rằng mỗi người dùng chỉ có thể trúng thưởng một lần.</p><p>Key là tên của hoạt động rút thăm, value là tên của nhân viên. Đưa tất cả tên nhân viên vào hộp rút thăm:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;SADD lucky Tom Jerry John Sean Marry Lindy Sary Mark</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">7</span></span></code></pre></div><p>Nếu cho phép trúng thưởng lặp lại, bạn có thể sử dụng lệnh SRANDMEMBER.</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Rút 1 giải nhất:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SRANDMEMBER lucky 1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Tom&quot;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Rút 2 giải nhì:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SRANDMEMBER lucky 2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Mark&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Jerry&quot;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Rút 3 giải ba:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SRANDMEMBER lucky 3</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Sary&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Tom&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Jerry&quot;</span></span></code></pre></div><p>Nếu không cho phép trùng lặp, bạn có thể sử dụng lệnh SPOP.</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Rút 1 giải nhất:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SPOP lucky 1</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Sary&quot;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Rút 2 giải nhì:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SPOP lucky 2</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Jerry&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Mark&quot;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Rút 3 giải ba:</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; SPOP lucky 3</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;John&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Sean&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Lindy&quot;</span></span></code></pre></div><p>Đây là cách sử dụng Set trong Redis để thực hiện hoạt động rút thăm may mắn, đảm bảo tính duy nhất của các giải thưởng và người dùng chỉ có thể trúng thưởng một lần.</p><h2 id="zset-sorted-set" tabindex="-1"><a class="header-anchor" href="#zset-sorted-set"><span>ZSET (Sorted Set)</span></a></h2><p>Loại Zset trong Redis là một tập hợp được sắp xếp và loại bỏ trùng lặp.</p><h3 id="gioi-thieu-ve-zset" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-ve-zset"><span>Giới thiệu về Zset</span></a></h3><p>Zset (tập hợp có thứ tự) là một loại dữ liệu đặc biệt trong Redis, so với loại Set, nó có thêm một thuộc tính sắp xếp gọi là điểm (score). Đối với tập hợp có thứ tự Zset, mỗi phần tử lưu trữ bao gồm hai giá trị: một là giá trị thành viên của tập hợp và hai là giá trị sắp xếp (score).</p><p>Tập hợp có thứ tự giữ nguyên tính chất thành viên không thể trùng lặp như Set, nhưng khác biệt ở chỗ các thành viên trong tập hợp có thứ tự có thể được sắp xếp theo thứ tự.<br><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724123002.png" alt="image.png" loading="lazy"></p><h3 id="trien-khai-zset" tabindex="-1"><a class="header-anchor" href="#trien-khai-zset"><span>Triển khai Zset</span></a></h3><p>Loại dữ liệu tập hợp có thứ tự (Zset) có thể được mã hóa bằng <code>ziplist</code> hoặc <code>skiplist</code>.</p><p>Đối tượng Zset mã hóa bằng <code>ziplist</code> sử dụng danh sách nén làm cơ chế lưu trữ cơ sở. Mỗi phần tử của tập hợp được lưu trữ bằng hai nút danh sách nén kề nhau. Nút đầu tiên lưu trữ thành viên của phần tử (member), trong khi nút thứ hai lưu trữ giá trị điểm (score) của phần tử. Các phần tử trong danh sách nén được sắp xếp theo thứ tự từ điểm thấp đến cao, tức là các phần tử có điểm thấp hơn được đặt gần đầu danh sách, và các phần tử có điểm cao hơn được đặt gần cuối danh sách.</p><p>Đối tượng Zset mã hóa bằng <code>skiplist</code> sử dụng cấu trúc <code>zset</code> như là cơ chế lưu trữ cơ sở. Mỗi <code>zset</code> bao gồm đồng thời một từ điển (dictionary) và một bảng bỏ qua (skiplist).</p><div class="language-cpp" data-ext="cpp" data-title="cpp"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">typedef</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> struct</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> zset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    zskiplist </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">*</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">zsl;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    dict </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">*</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">dict;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">} </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">zset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li><p><strong>zskiplist</strong>: Skiplist sắp xếp từ điểm thấp đến cao các phần tử của tập hợp. Mỗi nút skiplist lưu trữ một phần tử của tập hợp: thuộc tính <code>object</code> của nút skiplist lưu trữ thành viên của phần tử, trong khi thuộc tính <code>score</code> của nút skiplist lưu trữ điểm của phần tử. Bằng cách này, Redis có thể thực hiện các phép toán phạm vi trên tập hợp có thứ tự như ZRANK, ZRANGE dựa trên API của skiplist.</p></li><li><p><strong>dict</strong>: Từ điển tạo một ánh xạ từ thành viên đến điểm của tập hợp có thứ tự. Mỗi cặp khóa-giá trị trong từ điển lưu trữ một phần tử của tập hợp: khóa của từ điển lưu trữ thành viên của phần tử, trong khi giá trị của từ điển lưu trữ điểm của phần tử. Redis có thể truy vấn điểm của một thành viên cụ thể với độ phức tạp O(1) bằng lệnh ZSCORE, và nhiều lệnh khác của tập hợp có thứ tự dựa trên tính năng này.</p></li></ul><p>Mỗi thành viên của tập hợp có thứ tự là một đối tượng chuỗi, và mỗi điểm của thành viên là một số thực loại double. Đáng chú ý là, mặc dù <code>zset</code> sử dụng cả skiplist và từ điển để lưu trữ các phần tử của tập hợp có thứ tự, nhưng cả hai cấu trúc dữ liệu này sẽ chia sẻ cùng một con trỏ cho các thành viên và điểm tương tự nhau. Do đó, việc sử dụng đồng thời skiplist và từ điển để lưu trữ các phần tử của tập hợp có thứ tự không tạo ra bất kỳ thành viên hoặc điểm lặp lại nào và cũng không lãng phí bộ nhớ thừa.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624210536.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Khi đối tượng tập hợp có thứ tự có thể đáp ứng đồng thời hai điều kiện sau đây, nó sẽ sử dụng mã hóa <code>ziplist</code>; ngược lại, nó sẽ sử dụng mã hóa <code>skiplist</code>:</p><ul><li>Số lượng phần tử của tập hợp có thứ tự nhỏ hơn <code>128</code>.</li><li>Độ dài của tất cả các thành viên của tập hợp có thứ tự nhỏ hơn <code>64</code> byte.</li></ul><blockquote><p>Lưu ý: Các giới hạn trên đều có thể được điều chỉnh, vui lòng xem trong tài liệu cấu hình về các tùy chọn <code>zset-max-ziplist-entries</code> và <code>zset-max-ziplist-value</code> để biết thêm chi tiết.</p></blockquote><p><strong>Trong Redis 7.0, cấu trúc dữ liệu ziplist đã bị loại bỏ và được triển khai bằng cấu trúc dữ liệu listpack.</strong></p><h3 id="zset-commands" tabindex="-1"><a class="header-anchor" href="#zset-commands"><span>Zset Commands</span></a></h3><table><thead><tr><th>Command</th><th>Behavior</th></tr></thead><tbody><tr><td><code>ZADD</code></td><td>Thêm một thành viên với điểm xếp hạng đã cho vào tập hợp có thứ tự</td></tr><tr><td><code>ZRANGE</code></td><td>Sắp xếp theo thứ tự và trả về các thành viên trong khoảng xếp hạng chỉ định</td></tr><tr><td><code>ZREVRANGE</code></td><td>Sắp xếp theo thứ tự ngược và trả về các thành viên trong khoảng xếp hạng chỉ định</td></tr><tr><td><code>ZRANGEBYSCORE</code></td><td>Sắp xếp theo thứ tự và trả về các thành viên trong khoảng xếp hạng chỉ định cùng với điểm xếp hạng</td></tr><tr><td><code>ZREVRANGEBYSCORE</code></td><td>Sắp xếp theo thứ tự ngược và trả về các thành viên trong khoảng xếp hạng chỉ định cùng với điểm xếp hạng</td></tr><tr><td><code>ZREM</code></td><td>Xóa các thành viên được chỉ định khỏi tập hợp có thứ tự</td></tr><tr><td><code>ZSCORE</code></td><td>Lấy điểm xếp hạng của một thành viên được chỉ định</td></tr><tr><td><code>ZCARD</code></td><td>Lấy số lượng thành viên trong tập hợp có thứ tự</td></tr></tbody></table><h4 id="cac-hoat-đong-pho-bien-cua-zset" tabindex="-1"><a class="header-anchor" href="#cac-hoat-đong-pho-bien-cua-zset"><span>Các hoạt động phổ biến của Zset:</span></a></h4><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Thêm thành viên với điểm xếp hạng vào tập hợp có thứ tự</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ZADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> score</span><span style="color:#98C379;--shiki-dark:#98C379;"> member</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [[score </span><span style="color:#98C379;--shiki-dark:#98C379;">member]...]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xóa thành viên từ tập hợp có thứ tự</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ZREM</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> member</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [member...]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy điểm xếp hạng của thành viên</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ZSCORE</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> member</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy số lượng thành viên trong tập hợp</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ZCARD</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Tăng điểm xếp hạng của thành viên trong tập hợp có thứ tự</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ZINCRBY</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> increment</span><span style="color:#98C379;--shiki-dark:#98C379;"> member</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy các thành viên theo thứ tự từ vị trí start đến stop</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ZRANGE</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> start</span><span style="color:#98C379;--shiki-dark:#98C379;"> stop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [WITHSCORES]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy các thành viên theo thứ tự ngược từ vị trí start đến stop</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ZREVRANGE</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> start</span><span style="color:#98C379;--shiki-dark:#98C379;"> stop</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [WITHSCORES]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy các thành viên trong khoảng điểm xếp hạng từ min đến max, sắp xếp theo thứ tự</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ZRANGEBYSCORE</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> min</span><span style="color:#98C379;--shiki-dark:#98C379;"> max</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [WITHSCORES] [LIMIT offset count]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy các thành viên trong khoảng từ min đến max theo thứ tự từ điển, với điểm xếp hạng giống nhau</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ZRANGEBYLEX</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> min</span><span style="color:#98C379;--shiki-dark:#98C379;"> max</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [LIMIT </span><span style="color:#98C379;--shiki-dark:#98C379;">offset</span><span style="color:#98C379;--shiki-dark:#98C379;"> count]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Lấy các thành viên trong khoảng từ max đến min theo thứ tự từ điển, với điểm xếp hạng giống nhau</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ZREVRANGEBYLEX</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#98C379;--shiki-dark:#98C379;"> max</span><span style="color:#98C379;--shiki-dark:#98C379;"> min</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [LIMIT </span><span style="color:#98C379;--shiki-dark:#98C379;">offset</span><span style="color:#98C379;--shiki-dark:#98C379;"> count]</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cac-phep-toan-zset-so-voi-loai-set-loai-zset-khong-ho-tro-phep-toan-hieu" tabindex="-1"><a class="header-anchor" href="#cac-phep-toan-zset-so-voi-loai-set-loai-zset-khong-ho-tro-phep-toan-hieu"><span>Các phép toán Zset (so với loại Set, loại Zset không hỗ trợ phép toán hiệu):</span></a></h4><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Phép toán hợp nhất (tổng hợp điểm xếp hạng cho các thành viên giống nhau), numberkeys là số lượng key, WEIGHTS là tích điểm xếp hạng cho từng key</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ZUNIONSTORE</span><span style="color:#98C379;--shiki-dark:#98C379;"> destkey</span><span style="color:#98C379;--shiki-dark:#98C379;"> numberkeys</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [key...]</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Phép toán giao nhau (tổng hợp điểm xếp hạng cho các thành viên giống nhau), numberkeys là số lượng key, WEIGHTS là tích điểm xếp hạng cho từng key</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ZINTERSTORE</span><span style="color:#98C379;--shiki-dark:#98C379;"> destkey</span><span style="color:#98C379;--shiki-dark:#98C379;"> numberkeys</span><span style="color:#98C379;--shiki-dark:#98C379;"> key</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> [key...]</span></span></code></pre></div><h3 id="ung-dung-cua-zset" tabindex="-1"><a class="header-anchor" href="#ung-dung-cua-zset"><span>Ứng dụng của Zset</span></a></h3><p>Loại dữ liệu Zset (Sorted Set - Tập hợp có thứ tự) trong Redis cho phép sắp xếp các phần tử dựa trên trọng số của chúng, mà ta có thể tự định nghĩa. Ví dụ, chúng ta có thể sử dụng thời gian chèn các phần tử vào Sorted Set để xác định giá trị trọng số, các phần tử chèn trước sẽ có giá trị trọng số nhỏ hơn và các phần tử chèn sau sẽ có giá trị trọng số lớn hơn.</p><p>Trong các tình huống cần hiển thị danh sách mới nhất, bảng xếp hạng và các ứng dụng cần cập nhật dữ liệu thường xuyên hoặc cần hiển thị theo trang, thì sử dụng Sorted Set là lựa chọn hàng đầu.</p><h3 id="bang-xep-hang" tabindex="-1"><a class="header-anchor" href="#bang-xep-hang"><span>Bảng xếp hạng</span></a></h3><p><strong>[Các tình huống cần thiết]</strong></p><p>Các loại bảng xếp hạng khác nhau như: bảng xếp hạng lượt xem/đánh giá/bình luận của nội dung (video, bài hát, bài viết) trên các nền tảng nội dung; bảng xếp hạng doanh số bán hàng của các sản phẩm trên các trang thương mại điện tử.</p><p><strong>[Giải pháp]</strong></p><p>Sorted Set (Tập hợp có thứ tự) là một trong những giải pháp phổ biến cho các bảng xếp hạng. Ví dụ như bảng xếp hạng điểm số học sinh, bảng xếp hạng điểm trong game, bảng xếp hạng video phát sóng, bảng xếp hạng doanh số sản phẩm trên hệ thống thương mại điện tử.</p><p>Chúng ta lấy ví dụ về bảng xếp hạng các bài viết được thích của người dùng có tên là Xiaolin, Xiaolin đã đăng năm bài viết và có số lượng lượt thích là 200, 40, 100, 50 và 150 lượt lần lượt.</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Bài viết arcticle:1 có 200 lượt thích</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZADD user:xiaolin:ranking 200 arcticle:1</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Bài viết arcticle:2 có 40 lượt thích</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZADD user:xiaolin:ranking 40 arcticle:2</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Bài viết arcticle:3 có 100 lượt thích</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZADD user:xiaolin:ranking 100 arcticle:3</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Bài viết arcticle:4 có 50 lượt thích</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZADD user:xiaolin:ranking 50 arcticle:4</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Bài viết arcticle:5 có 150 lượt thích</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZADD user:xiaolin:ranking 150 arcticle:5</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Nếu bài viết arcticle:4 có thêm một lượt thích mới, ta có thể sử dụng lệnh ZINCRBY (tăng giá trị điểm số cho thành viên trong Sorted Set):</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZINCRBY user:xiaolin:ranking 1 arcticle:4</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;51&quot;</span></span></code></pre></div><p>Để xem số lượt thích của một bài viết cụ thể, ta có thể sử dụng lệnh ZSCORE (trả về giá trị điểm số của thành viên trong Sorted Set):</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZSCORE user:xiaolin:ranking arcticle:4</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">&quot;50&quot;</span></span></code></pre></div><p>Để lấy danh sách 3 bài viết của Xiaolin có số lượt thích cao nhất, ta sử dụng lệnh ZREVRANGE (lấy danh sách các thành viên từ cao đến thấp trong Sorted Set):</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># WITHSCORES cho biết cả điểm số</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZREVRANGE user:xiaolin:ranking 0 2 WITHSCORES</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;arcticle:1&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;200&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;arcticle:5&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;150&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;arcticle:3&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;100&quot;</span></span></code></pre></div><p>Để lấy danh sách các bài viết của Xiaolin có từ 100 đến 200 lượt thích, ta sử dụng lệnh ZRANGEBYSCORE (lấy danh sách các thành viên trong một khoảng điểm số từ thấp đến cao trong Sorted Set):</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZRANGEBYSCORE user:xiaolin:ranking 100 200 WITHSCORES</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;arcticle:3&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;100&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;arcticle:5&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;150&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;arcticle:1&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;200&quot;</span></span></code></pre></div><h3 id="sap-xep-theo-tien-to" tabindex="-1"><a class="header-anchor" href="#sap-xep-theo-tien-to"><span>Sắp xếp theo tiền tố</span></a></h3><p>Sử dụng các lệnh <code>ZRANGEBYLEX</code> hoặc <code>ZREVRANGEBYLEX</code> trên tập hợp có thứ tự (Sorted Set) cho phép chúng ta sắp xếp số điện thoại hoặc tên theo thứ tự. Chúng ta sẽ lấy ví dụ về lệnh <code>ZRANGEBYLEX</code> (trả về các thành viên trong một khoảng nhất định theo thứ tự từ điển).</p><p><strong>1. Sắp xếp số điện thoại</strong></p><p>Chúng ta có thể lưu trữ các số điện thoại trong Sorted Set và lấy các số điện thoại trong một dãy cụ thể:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZADD phone 0 13100111100 0 13110114300 0 13132110901</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZADD phone 0 13200111100 0 13210414300 0 13252110901</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZADD phone 0 13300111100 0 13310414300 0 13352110901</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span></span></code></pre></div><p>Lấy tất cả các số điện thoại:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZRANGEBYLEX phone - +</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13100111100&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13110114300&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13132110901&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13200111100&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13210414300&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13252110901&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">7</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13300111100&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">8</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13310414300&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">9</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13352110901&quot;</span></span></code></pre></div><p>Lấy các số điện thoại trong dãy 132:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZRANGEBYLEX phone [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">132</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">133</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">1) &quot;13200111100&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13210414300&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13252110901&quot;</span></span></code></pre></div><p>Lấy các số điện thoại trong dãy 132 và 133:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZRANGEBYLEX phone [</span><span style="color:#D19A66;--shiki-dark:#D19A66;">132</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#D19A66;--shiki-dark:#D19A66;">134</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">1) &quot;13200111100&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13210414300&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13252110901&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13300111100&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13310414300&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;13352110901&quot;</span></span></code></pre></div><p><strong>2. Sắp xếp theo tên</strong></p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; zadd names 0 Toumas 0 Jake 0 Bluetuo 0 Gaodeng 0 Aimini 0 Aidehua</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">6</span></span></code></pre></div><p>Lấy tất cả các tên:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZRANGEBYLEX names - +</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Aidehua&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Aimini&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Bluetuo&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">4</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Gaodeng&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Jake&quot;</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">6</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Toumas&quot;</span></span></code></pre></div><p>Lấy các tên bắt đầu bằng chữ cái A:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZRANGEBYLEX names [A (</span><span style="color:#E06C75;--shiki-dark:#E06C75;">B</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">1) &quot;Aidehua&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Aimini&quot;</span></span></code></pre></div><p>Lấy các tên từ chữ cái C đến Z:</p><div class="language-shell" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; ZRANGEBYLEX names [C [Z</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Gaodeng&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Jake&quot;</span></span>
<span class="line"><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;Toumas&quot;</span></span></code></pre></div><p>Đó là các ví dụ về cách sử dụng <code>ZRANGEBYLEX</code> để sắp xếp các thành viên trong Sorted Set theo thứ tự từ điển.</p><h2 id="ung-dung-thuc-te" tabindex="-1"><a class="header-anchor" href="#ung-dung-thuc-te"><span>Ứng dụng thực tê</span></a></h2><h3 id="case-study-bai-viet-pho-bien-nhat" tabindex="-1"><a class="header-anchor" href="#case-study-bai-viet-pho-bien-nhat"><span>Case study - Bài viết phổ biến nhất</span></a></h3><p>Để chọn ra các bài viết phổ biến nhất, cần hỗ trợ việc đánh giá bài viết.</p><h4 id="binh-chon-cho-bai-viet" tabindex="-1"><a class="header-anchor" href="#binh-chon-cho-bai-viet"><span>Bình chọn cho bài viết</span></a></h4><p>(1) Lưu trữ bài viết bằng HASH</p><p>Sử dụng kiểu dữ liệu HASH để lưu trữ thông tin của bài viết. Trong đó: key là ID của bài viết; field là khóa thuộc tính của bài viết; value là giá trị tương ứng của thuộc tính.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200225143038.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>Các thao tác:</p><ul><li>Lưu trữ thông tin bài viết - Sử dụng lệnh HSET hoặc HMSET</li><li>Truy vấn thông tin bài viết - Sử dụng lệnh HGETALL</li><li>Thêm phiếu bình chọn - Sử dụng lệnh HINCRBY</li></ul><p>(2) Sử dụng ZSET để sắp xếp tập hợp bài viết theo các tiêu chí khác nhau</p><p>Sử dụng kiểu dữ liệu ZSET để lưu trữ tập hợp các ID bài viết được sắp xếp theo thời gian và điểm số.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200225145742.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>Các thao tác:</p><ul><li>Thêm bản ghi - Sử dụng lệnh ZADD</li><li>Thêm điểm - Sử dụng lệnh ZINCRBY</li><li>Lấy ra nhiều bài viết - Sử dụng lệnh ZREVRANGE</li></ul><p>(3) Để tránh việc bình chọn trùng lặp, sử dụng kiểu dữ liệu SET để ghi lại tập hợp các bài viết đã được bình chọn.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200225150105.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>Các thao tác:</p><ul><li>Thêm người bình chọn - Sử dụng lệnh SADD</li><li>Đặt thời gian hiệu lực - Sử dụng lệnh EXPIRE</li></ul><p>(4) Giả sử user:115423 bình chọn cho article:100408, cần cập nhật cả tập hợp sắp xếp theo điểm số và tập hợp bình chọn.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200225150138.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>Khi cần bình chọn cho một bài viết, chương trình cần sử dụng lệnh ZSCORE để kiểm tra tập hợp sắp xếp theo thời gian đăng bài viết và xác định xem thời gian đăng bài viết có vượt quá thời gian hiệu lực của bình chọn (ví dụ: một tuần) hay không.</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> articleVote</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> article) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Tính toán thời gian kết thúc bình chọn của bài viết.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cutoff </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> /</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1000</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> ONE_WEEK_IN_SECONDS</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Kiểm tra xem có thể bình chọn cho bài viết hay không</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // (Mặc dù có thể lấy thời gian đăng bài viết từ HASH,</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // nhưng tập hợp sắp xếp trả về thời gian đăng bài viết dưới dạng số thực,</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // nên có thể sử dụng trực tiếp mà không cần chuyển đổi).</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zscore</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;time:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, article)</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> &lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cutoff) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Lấy ID của bài viết từ định danh article:id.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> articleId </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> article</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">substring</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">article</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">indexOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;:&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Nếu người dùng chưa bình chọn cho bài viết này, tăng số lượng bình chọn và điểm số của bài viết.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;voted:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> articleId, user)</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zincrby</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;score:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, VOTE_SCORE, article);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hincrBy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(article, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;votes&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="đang-va-lay-bai-viet" tabindex="-1"><a class="header-anchor" href="#đang-va-lay-bai-viet"><span>Đăng và lấy bài viết</span></a></h4><p>Đăng bài viết:</p><ul><li>Thêm bài viết - Sử dụng lệnh <code>INCR</code> để tính toán ID mới cho bài viết, điền thông tin bài viết và sử dụng lệnh <code>HSET</code> hoặc <code>HMSET</code> để ghi vào cấu trúc <code>HASH</code>.</li><li>Thêm ID tác giả vào List bình chọn - Sử dụng lệnh <code>SADD</code> để thêm vào cấu trúc <code>SET</code> đại diện cho List bình chọn.</li><li>Đặt thời gian hiệu lực của bình chọn - Sử dụng lệnh <code>EXPIRE</code> để đặt thời gian hiệu lực của bình chọn.</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> postArticle</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> title</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> link) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Tạo một ID mới cho bài viết.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> articleId </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">valueOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">incr</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;article:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> voted </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;voted:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> articleId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Thêm người dùng đăng bài vào List đã bình chọn của bài viết,</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(voted, user);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Đặt thời gian tồn tại của List này là một tuần (Chương 3 sẽ giải thích chi tiết hơn về thời gian tồn tại).</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">expire</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(voted, ONE_WEEK_IN_SECONDS);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> now </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> /</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> article </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;article:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> articleId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Lưu thông tin bài viết vào một hash.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        HashMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> articleData </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> HashMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        articleData</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;title&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, title);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        articleData</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;link&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, link);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        articleData</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;user&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, user);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        articleData</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;now&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">valueOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(now));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        articleData</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;votes&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;1&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hmset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(article, articleData);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Thêm bài viết vào tập hợp sắp xếp theo thời gian đăng và tập hợp sắp xếp theo điểm số.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;score:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, now </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> VOTE_SCORE, article);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;time:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, now, article);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> articleId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Truy vấn phân trang cho các bài viết phổ biến:</p><p>Sử dụng lệnh <code>ZINTERSTORE</code> để truy vấn List ID bài viết theo trang, số bài viết trên mỗi trang và số thứ tự sắp xếp theo điểm số từ cao xuống thấp.</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> List</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Map</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> String</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getArticles</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> page</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> order) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Đặt chỉ mục bắt đầu và kết thúc để lấy bài viết.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> start </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (page </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">*</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> ARTICLES_PER_PAGE</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> end </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> start </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> ARTICLES_PER_PAGE </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Lấy List ID bài viết.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> ids </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zrevrange</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(order, start, end);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> articles </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Lấy thông tin chi tiết của bài viết dựa trên ID bài viết.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> id </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> ids) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            Map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> articleData </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hgetAll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(id);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            articleData</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;id&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, id);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            articles</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(articleData);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> articles</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="phan-nhom-bai-viet" tabindex="-1"><a class="header-anchor" href="#phan-nhom-bai-viet"><span>Phân nhóm bài viết</span></a></h4><p>Nếu bài viết cần được phân nhóm, chức năng sẽ được chia thành hai phần:</p><ul><li>Ghi nhận bài viết thuộc nhóm nào</li><li>Trích xuất các bài viết trong nhóm</li></ul><p>Thêm và xóa nhóm cho bài viết:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> addRemoveGroups</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> articleId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[] toAdd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[] toRemove) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Xây dựng tên khóa để lưu thông tin bài viết.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> article </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;article:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> articleId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Thêm bài viết vào các nhóm mà nó thuộc về.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> group </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> toAdd) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;group:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> group, article);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Xóa bài viết khỏi các nhóm.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> group </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> toRemove) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">srem</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;group:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> group, article);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre></div><p>Trích xuất các bài viết trong nhóm:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200225214210.jpg" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><ul><li>Bằng cách thực hiện lệnh <code>ZINTERSTORE</code> trên tập hợp các bài viết trong nhóm và tập hợp sắp xếp theo điểm số của bài viết, chúng ta có thể nhận được các bài viết trong nhóm được sắp xếp theo điểm số.</li><li>Bằng cách thực hiện lệnh <code>ZINTERSTORE</code> trên tập hợp các bài viết trong nhóm và tập hợp sắp xếp theo thời gian đăng bài viết, chúng ta có thể nhận được các bài viết trong nhóm được sắp xếp theo thời gian đăng.</li></ul><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> List</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Map</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> String</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getGroupArticles</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> group</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> page</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> order) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Tạo một khóa cho mỗi thứ tự sắp xếp của mỗi nhóm.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> key </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> order </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> group</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Kiểm tra xem có kết quả sắp xếp đã được lưu trữ trong bộ nhớ cache chưa, nếu chưa thì tiến hành sắp xếp.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">exists</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key)</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Sắp xếp các bài viết trong nhóm theo điểm số hoặc thời gian đăng bài viết.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            ZParams</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> params </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ZParams</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">aggregate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">ZParams</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Aggregate</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">MAX</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zinterstore</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, params, </span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;group:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> group, order);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Đặt thời gian tồn tại của tập hợp sắp xếp này là 60 giây.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">expire</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(key, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">60</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Gọi hàm getArticles đã được định nghĩa trước đó để phân trang và lấy dữ liệu bài viết.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getArticles</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> page</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> key)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre></div><h3 id="case-study-quan-ly-token" tabindex="-1"><a class="header-anchor" href="#case-study-quan-ly-token"><span>Case study - Quản lý token</span></a></h3><p>Trang web thường lưu trữ thông tin xác thực người dùng dưới dạng Cookie, Session, Token và các thông tin tương tự.</p><p>Có thể lưu trữ mappinng giữa Cookie/Session/Token và người dùng trong cấu trúc HASH.</p><p>Dưới đây là ví dụ với Token.</p><h4 id="kiem-tra-token" tabindex="-1"><a class="header-anchor" href="#kiem-tra-token"><span>Kiểm tra Token</span></a></h4><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> checkToken</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> token) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Thử lấy và trả về người dùng tương ứng với token.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hget</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;login:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, token);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre></div><h4 id="cap-nhat-token" tabindex="-1"><a class="header-anchor" href="#cap-nhat-token"><span>Cập nhật Token</span></a></h4><ul><li>Mỗi lần người dùng truy cập trang, có thể ghi lại mapping giữa token và timestamp hiện tại, lưu vào một cấu trúc ZSET để phân tích xem người dùng có hoạt động hay không, sau đó có thể định kỳ xóa các token cũ nhất, thống kê số người dùng đang trực tuyến, v.v.</li><li>Nếu người dùng đang xem sản phẩm, có thể ghi lại các sản phẩm đã xem gần đây vào một cấu trúc ZSET (có thể giới hạn số lượng, vượt quá số lượng sẽ bị cắt bỏ), lưu vào một cấu trúc ZSET để phân tích xem người dùng có thể quan tâm đến sản phẩm nào gần đây, từ đó có thể gợi ý sản phẩm.</li></ul><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> updateToken</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> token</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> user</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> item) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Lấy timestamp hiện tại.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> timestamp </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> /</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Lưu mapping giữa token và người dùng đã đăng nhập.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;login:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, token, user);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Ghi lại thời gian xuất hiện cuối cùng của token.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;recent:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, timestamp, token);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (item </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Ghi lại các sản phẩm người dùng đã xem.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;viewed:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> token, timestamp, item);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Xóa các bản ghi cũ, chỉ giữ lại 25 sản phẩm người dùng đã xem gần đây nhất.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zremrangeByRank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;viewed:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> token, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">26</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zincrby</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;viewed:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, item);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="xoa-token" tabindex="-1"><a class="header-anchor" href="#xoa-token"><span>Xóa Token</span></a></h4><p>Như đã đề cập ở phần trước, khi cập nhật token, mapping giữa token và timestamp hiện tại được lưu vào cấu trúc ZSET. Do đó, có thể biết được những token nào là cũ nhất. Nếu không xóa, việc cập nhật token sẽ tiếp tục chiếm dụng bộ nhớ cho đến khi gây ra sự cố.</p><p>Ví dụ: Cho phép lưu trữ tối đa 10 triệu thông tin token, kiểm tra định kỳ, nếu số lượng token vượt quá 10 triệu, sắp xếp ZSET từ mới đến cũ và xóa các thông tin vượt quá 10 triệu.</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> CleanSessionsThread</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> volatile</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> quit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> CleanSessionsThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> limit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">conn</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Jedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;localhost&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">15</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">limit</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> limit;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> quit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        quit </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">quit) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Lấy số lượng token hiện có.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> size</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zcard</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;recent:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Nếu số lượng token không vượt quá giới hạn, ngủ và kiểm tra lại sau.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (size </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;=</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> limit) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">InterruptedException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> ie</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                    Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">interrupt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                continue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Lấy các token cần xóa.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> endIndex</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Math</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">min</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(size </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> limit, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            Set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">tokenSet</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zrange</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;recent:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, endIndex </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="color:#E06C75;--shiki-dark:#E06C75;">tokens</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> tokenSet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">tokenSet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Xây dựng các key cho các token sẽ bị xóa.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">sessionKeys</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            for</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> token</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> :</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> tokens) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                sessionKeys</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;viewed:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> token);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Xóa các token cũ nhất.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sessionKeys</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sessionKeys</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()]));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hdel</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;login:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, tokens);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zrem</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;recent:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, tokens);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="case-study-gio-hang" tabindex="-1"><a class="header-anchor" href="#case-study-gio-hang"><span>Case study - Giỏ hàng</span></a></h3><p>Có thể sử dụng cấu trúc HASH để triển khai chức năng giỏ hàng.</p><p>Mỗi giỏ hàng của người dùng lưu trữ ánh xạ giữa ID sản phẩm và số lượng sản phẩm.</p><h4 id="them-va-xoa-san-pham-trong-gio-hang" tabindex="-1"><a class="header-anchor" href="#them-va-xoa-san-pham-trong-gio-hang"><span>Thêm và xóa sản phẩm trong giỏ hàng</span></a></h4><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> addToCart</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> session</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> item</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> count) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (count </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Xóa sản phẩm cụ thể khỏi giỏ hàng.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hdel</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;cart:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> session, item);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">else</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Thêm sản phẩm cụ thể vào giỏ hàng.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;cart:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> session, item, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">valueOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(count));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre></div><h4 id="xoa-toan-bo-gio-hang" tabindex="-1"><a class="header-anchor" href="#xoa-toan-bo-gio-hang"><span>Xóa toàn bộ giỏ hàng</span></a></h4><p>Dựa trên <a href="#x%C3%B3a-token">Xóa Token</a>, khi xóa phiên làm việc, cũng xóa luôn giỏ hàng.</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">   while</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#E06C75;--shiki-dark:#E06C75;">quit) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> size </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zcard</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;recent:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (size </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> limit) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                sleep</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1000</span><span style="color:#E06C75;--shiki-dark:#E06C75;">)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">InterruptedException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> ie</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">interrupt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            continue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> endIndex </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Math</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">min</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(size </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> limit, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">100</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> sessionSet </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zrange</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;recent:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, endIndex </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">-</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[] sessions </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> sessionSet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sessionSet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> sessionKeys </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> sess </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> sessions) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            sessionKeys</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;viewed:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> sess);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Dòng code mới được thêm vào để xóa giỏ hàng của người dùng tương ứng với phiên làm việc cũ.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            sessionKeys</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;cart:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> sess);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sessionKeys</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toArray</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">sessionKeys</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()]));</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hdel</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;login:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, sessions);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zrem</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;recent:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, sessions);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="case-study-bo-nho-cache-trang-web" tabindex="-1"><a class="header-anchor" href="#case-study-bo-nho-cache-trang-web"><span>Case study - Bộ nhớ cache trang web</span></a></h3><p>Hầu hết nội dung trang web không thay đổi thường xuyên, nhưng khi truy cập, phía máy chủ cần tính toán động, điều này có thể tốn thời gian. Trong trường hợp này, có thể sử dụng cấu trúc <code>STRING</code> để lưu trữ bộ nhớ cache trang web.</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> cacheRequest</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> request</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Callback</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> callback) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Đối với các yêu cầu không thể được lưu vào bộ nhớ cache, gọi hàm callback trực tiếp.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">canCache</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> request)) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> callback </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ?</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> callback</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">call</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(request)</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> :</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Chuyển đổi yêu cầu thành một khóa chuỗi đơn giản để dễ dàng tìm kiếm sau này.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> pageKey </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;cache:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> hashRequest</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(request)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Thử tìm trang web đã được lưu trong bộ nhớ cache.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> content </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(pageKey);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (content </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> callback </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Nếu trang web chưa được lưu trong bộ nhớ cache, tạo trang web.</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            content </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> callback</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">call</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(request);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Lưu trang web mới tạo vào bộ nhớ cache.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">setex</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(pageKey, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">300</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, content);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Trả về nội dung trang web.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> content</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="case-study-bo-nho-cache-dong-du-lieu" tabindex="-1"><a class="header-anchor" href="#case-study-bo-nho-cache-dong-du-lieu"><span>Case study - Bộ nhớ cache dòng dữ liệu</span></a></h3><p>Các trang web thương mại điện tử có thể có các hoạt động khuyến mãi, giảm giá, rút thăm may mắn, v.v. Những trang web này chỉ cần tải vài dòng dữ liệu từ cơ sở dữ liệu, chẳng hạn như thông tin người dùng, thông tin sản phẩm.</p><p>Có thể sử dụng cấu trúc STRING để lưu trữ bộ nhớ cache cho các dòng dữ liệu này, sử dụng JSON để lưu trữ thông tin có cấu trúc.</p><p>Ngoài ra, cần có hai cấu trúc ZSET để ghi lại thời điểm cập nhật bộ nhớ cache:</p><ul><li>Cấu trúc ZSET thứ nhất là tập hợp lịch trình;</li><li>Cấu trúc ZSET thứ hai là tập hợp trễ.</li></ul><p>Ghi lại thời điểm cập nhật bộ nhớ cache:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> scheduleRowCache</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> rowId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> delay) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Đặt giá trị trễ cho dòng dữ liệu.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;delay:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, delay, rowId);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">        // Lập lịch cập nhật bộ nhớ cache cho dòng dữ liệu.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;schedule:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, rowId);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre></div><p>Cập nhật bộ nhớ cache dòng dữ liệu theo định kỳ:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> CacheRowsThread</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> extends</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    private</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> quit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> CacheRowsThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">conn</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Jedis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;localhost&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        this</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">select</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">15</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> quit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        quit </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> run</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Gson</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> gson</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Gson</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        while</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">quit) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Thử lấy dòng dữ liệu tiếp theo cần được cập nhật và thời điểm lên lịch của nó,</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Lệnh sẽ trả về một List chứa một hoặc không có cặp (tuple).</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            Set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Tuple</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; </span><span style="color:#E06C75;--shiki-dark:#E06C75;">range</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zrangeWithScores</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;schedule:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            Tuple</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> next</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> range</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ?</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> range</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">iterator</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> now</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> System</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentTimeMillis</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 1000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (next </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ||</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> next</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getScore</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">() </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> now) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                try</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                    // Tạm thời không có dòng dữ liệu cần được cập nhật, ngủ 50ms và thử lại.</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">                    sleep</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">50</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">InterruptedException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> ie</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                    Thread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">currentThread</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">interrupt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">                }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                continue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> rowId</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> next</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getElement</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Lấy thời gian trễ trước lần cập nhật tiếp theo.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            double</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> delay</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zscore</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;delay:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, rowId);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> (delay </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                // Không cần cập nhật dòng dữ liệu này nữa, xóa nó khỏi bộ nhớ cache.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zrem</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;delay:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, rowId);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zrem</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;schedule:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, rowId);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">del</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;inv:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> rowId);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                continue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Đọc dòng dữ liệu.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            Inventory</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> row</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Inventory</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(rowId);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Cập nhật thời gian lên lịch và đặt giá trị bộ nhớ cache.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;schedule:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, now </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> delay, rowId);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;inv:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> rowId, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">gson</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toJson</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(row));</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="case-study-phan-tich-trang-web" tabindex="-1"><a class="header-anchor" href="#case-study-phan-tich-trang-web"><span>Case study - Phân tích trang web</span></a></h3><p>Trang web có thể thu thập hành vi truy cập, tương tác và mua hàng của người dùng, sau đó phân tích thói quen và sở thích của người dùng để đánh giá tình hình thị trường và cơ hội nghiệp vụ tiềm năng.</p><p>Vậy làm thế nào để ghi lại các trang sản phẩm mà người dùng đã truy cập trong một khoảng thời gian nhất định?</p><p>Tham khảo ví dụ mã code <a href="#c%E1%BA%ADp-nh%E1%BA%ADt-token">Cập nhật Token</a>, ghi lại số lần truy cập của người dùng vào các trang sản phẩm khác nhau và sắp xếp chúng.</p><p>Để xác định xem trang có cần được lưu vào bộ nhớ cache hay không, dựa trên điểm đánh giá để xác định xem trang sản phẩm có phổ biến hay không:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> canCache</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> request) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            URL</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> url </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> URL</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(request)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            HashMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> params </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> HashMap</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">url</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getQuery</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> !=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> param </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> url</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getQuery</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">split</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;&amp;&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                    String</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[] pair </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> param</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">split</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;=&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                    params</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">put</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(pair[</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">], </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">pair</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">length</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 2</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> ?</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> pair[</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">] </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Thử lấy ID sản phẩm từ trang.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> itemId </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> extractItemId</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(params)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Kiểm tra xem trang này có thể được lưu vào bộ nhớ cache và có phải là trang sản phẩm hay không.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (itemId </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ||</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> isDynamic</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(params)) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                return</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Lấy xếp hạng số lần xem của sản phẩm.</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            Long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> rank </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zrank</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;viewed:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, itemId);</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Dựa trên xếp hạng số lần xem của sản phẩm để xác định xem trang này có cần được lưu vào bộ nhớ cache hay không.</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> rank </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> rank </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 10000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">MalformedURLException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> mue</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> false</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="case-study-ghi-log" tabindex="-1"><a class="header-anchor" href="#case-study-ghi-log"><span>Case study - Ghi log</span></a></h3><p>Có thể sử dụng cấu trúc LIST để lưu trữ dữ liệu nhật ký (log).</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> logRecent</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> message</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> severity) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> destination </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#98C379;--shiki-dark:#98C379;"> &quot;recent:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> name </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;:&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> severity</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Pipeline</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> pipe </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">pipelined</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">lpush</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(destination, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">TIMESTAMP</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">format</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">+</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39; &#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> message);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">ltrim</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(destination, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">99</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        pipe</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sync</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre></div><h3 id="case-study-thong-ke-du-lieu" tabindex="-1"><a class="header-anchor" href="#case-study-thong-ke-du-lieu"><span>Case study - Thống kê dữ liệu</span></a></h3><p>Cập nhật bộ đếm:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> final</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[] PRECISION </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[] { </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 5</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 60</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 300</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 3600</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 18000</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 86400</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> }</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> updateCounter</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> now) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Transaction</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> trans </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">multi</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#C678DD;--shiki-dark:#C678DD;">int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> prec </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> PRECISION) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            long</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> pnow </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (now </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">/</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> prec) </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">*</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> prec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> hash </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">valueOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(prec)</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;:&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            trans</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;known:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, hash);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            trans</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hincrBy</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;count:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> hash, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">valueOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(pnow), count);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        trans</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">exec</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre></div><p>Xem dữ liệu bộ đếm:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> List</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Pair</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">Integer</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">&gt;&gt;</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> getCounter</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> precision) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> hash </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">valueOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(precision)</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;:&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> name</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> data </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hgetAll</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;count:&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;"> hash);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Pair</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> results </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ArrayList</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Map</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Entry</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> entry </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> data</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">entrySet</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            results</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">add</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Pair</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;(</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                entry</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getKey</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">parseInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">entry</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getValue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">())));</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Collections</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">sort</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(results);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> results</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre></div><h3 id="case-study-tim-đia-chi-ip-thuoc-ve-đau" tabindex="-1"><a class="header-anchor" href="#case-study-tim-đia-chi-ip-thuoc-ve-đau"><span>Case study - Tìm địa chỉ IP thuộc về đâu</span></a></h3><p>Tìm địa chỉ IP thuộc về đâu bằng cách sử dụng Redis nhanh hơn so với cách thực hiện trên cơ sở dữ liệu quan hệ.</p><h4 id="tai-du-lieu-ip" tabindex="-1"><a class="header-anchor" href="#tai-du-lieu-ip"><span>Tải dữ liệu IP</span></a></h4><p>Chuyển đổi địa chỉ IP thành giá trị số nguyên:</p><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> int</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ipToScore</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> ipAddress) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> score </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> v </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> ipAddress</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">split</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\\\</span><span style="color:#98C379;--shiki-dark:#98C379;">.&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            score </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> score </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">*</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 256</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">parseInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(v, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> score</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre></div><p>Tạo ánh xạ giữa địa chỉ IP và ID thành phố:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> importIpsToRedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> file) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> reader </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Tải dữ liệu từ tệp csv</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            reader </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(file)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            CSVFormat</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> csvFormat </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> CSVFormat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">DEFAULT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">withRecordSeparator</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\n</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            CSVParser</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> csvParser </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> csvFormat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">parse</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(reader);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> count </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">CSVRecord</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> records </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> csvParser</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getRecords</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">CSVRecord</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> line </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> records) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> startIp </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">startIp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toLowerCase</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">indexOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;i&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> !=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                    continue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                }</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                // Chuyển đổi địa chỉ IP thành giá trị số nguyên</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> score </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">startIp</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">indexOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;.&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> !=</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> -</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                    score </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ipToScore</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(startIp)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">else</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                    try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                        score </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> Integer</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">parseInt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(startIp, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">10</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                    } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">NumberFormatException</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> nfe</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                        // Bỏ qua dòng đầu tiên của tệp và các mục không đúng định dạng</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                        continue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                    }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                // Xây dựng ID thành phố duy nhất</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cityId </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> line</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#98C379;--shiki-dark:#98C379;"> &#39;_&#39;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                // Thêm ID thành phố và giá trị số nguyên tương ứng của địa chỉ IP vào ZSET</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zadd</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;ip2cityid:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, score, cityId);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                count</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">++;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            throw</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(e)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                reader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                // bỏ qua</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Lưu trữ thông tin thành phố:</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> importCitiesToRedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> File</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> file) {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Gson</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> gson </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Gson</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> reader </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // Tải thông tin từ tệp csv</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            reader </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> FileReader</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(file)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            CSVFormat</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> csvFormat </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> CSVFormat</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">DEFAULT</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">withRecordSeparator</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">\\n</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            CSVParser</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> parser </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> CSVParser</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(reader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> csvFormat)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">            // String[] line;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">            List</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">CSVRecord</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> records </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> parser</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">getRecords</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            for</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">CSVRecord</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> record </span><span style="color:#C678DD;--shiki-dark:#C678DD;">:</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> records) {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">record</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> &lt;</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 4</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ||</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> !</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Character</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">isDigit</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">record</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">charAt</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">))</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">                    continue</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">                }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                // Chuyển đổi thông tin địa lý thành cấu trúc json và lưu vào HASH</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cityId </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> record</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> country </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> record</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> region </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> record</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">2</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> city </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> record</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">3</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> json </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> gson</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">toJson</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#C678DD;--shiki-dark:#C678DD;">new</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[] { city, region, country });</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hset</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;cityid2city:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, cityId, json);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            throw</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> RuntimeException</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(e)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">finally</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            try</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">                reader</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">close</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            } </span><span style="color:#C678DD;--shiki-dark:#C678DD;">catch</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Exception</span><span style="color:#E06C75;--shiki-dark:#E06C75;font-style:italic;--shiki-dark-font-style:italic;"> e</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;">                // bỏ qua</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">            }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="tim-đia-chi-ip-thuoc-ve-thanh-pho-nao" tabindex="-1"><a class="header-anchor" href="#tim-đia-chi-ip-thuoc-ve-thanh-pho-nao"><span>Tìm địa chỉ IP thuộc về thành phố nào</span></a></h4><p>Các bước thực hiện:</p><ol><li>Chuyển đổi địa chỉ IP cần tìm thành giá trị số nguyên;</li><li>Tìm tất cả các địa chỉ có điểm số nhỏ hơn hoặc bằng địa chỉ IP cần tìm, lấy ra bản ghi có điểm số lớn nhất;</li><li>Sử dụng ID thành phố tìm thấy để truy vấn thông tin thành phố.</li></ol><div class="language-java" data-ext="java" data-title="java"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;">[] </span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">findCityByIp</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">Jedis</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> ipAddress) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        int</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> score </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> ipToScore</span><span style="color:#E06C75;--shiki-dark:#E06C75;">(ipAddress)</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        Set</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> results </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">zrevrangeByScore</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;ip2cityid:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, score, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#D19A66;--shiki-dark:#D19A66;">1</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">results</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">size</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="color:#56B6C2;--shiki-dark:#56B6C2;"> ==</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="color:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="color:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E5C07B;--shiki-dark:#E5C07B;">        String</span><span style="color:#E06C75;--shiki-dark:#E06C75;"> cityId </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> results</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">iterator</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">next</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">        cityId </span><span style="color:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;"> cityId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">substring</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#D19A66;--shiki-dark:#D19A66;">0</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">cityId</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">indexOf</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&#39;_&#39;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">));</span></span>
<span class="line"><span style="color:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="color:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;"> Gson</span><span style="color:#E06C75;--shiki-dark:#E06C75;">()</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">fromJson</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">conn</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="color:#61AFEF;--shiki-dark:#61AFEF;">hget</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="color:#98C379;--shiki-dark:#98C379;">&quot;cityid2city:&quot;</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">, cityId), </span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">[].</span><span style="color:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="color:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="color:#E06C75;--shiki-dark:#E06C75;">    }</span></span></code></pre></div><h3 id="case-study-phat-hien-va-cau-hinh-dich-vu" tabindex="-1"><a class="header-anchor" href="#case-study-phat-hien-va-cau-hinh-dich-vu"><span>Case study - Phát hiện và cấu hình dịch vụ</span></a></h3><h3 id="case-study-tu-đong-hoan-chinh" tabindex="-1"><a class="header-anchor" href="#case-study-tu-đong-hoan-chinh"><span>Case study - Tự động hoàn chỉnh</span></a></h3><p>Yêu cầu: Tự động hoàn chỉnh thông tin dựa trên đầu vào của người dùng, ví dụ: tên liên lạc, tên sản phẩm, v.v.</p><ul><li>Tình huống điển hình 1: Hệ thống mạng xã hội ghi lại 100 người bạn gần đây nhất mà người dùng đã liên lạc, khi người dùng tìm kiếm bạn bè, tự động hoàn chỉnh tên dựa trên từ khóa nhập vào.</li><li>Tình huống điển hình 2: Hệ thống thương mại điện tử ghi lại 10 sản phẩm mà người dùng đã xem gần đây, khi người dùng tìm kiếm sản phẩm, tự động hoàn chỉnh tên sản phẩm dựa trên từ khóa nhập vào.</li></ul><p>Mô hình dữ liệu: Sử dụng kiểu dữ liệu LIST của Redis để lưu trữ List liên lạc gần đây.</p><p>Xây dựng List hoàn chỉnh tự động thường bao gồm các hoạt động sau:</p><ul><li>Nếu người liên hệ đã được chỉ định tồn tại trong List liên lạc gần đây, hãy loại bỏ nó khỏi List. Tương ứng với lệnh <code>LREM</code>.</li><li>Thêm người liên hệ đã chỉ định vào đầu List liên lạc gần đây. Tương ứng với lệnh <code>LPUSH</code>.</li><li>Sau khi hoạt động thêm đã hoàn thành, nếu số lượng người liên hệ trong List vượt quá 100, thực hiện cắt tỉa. Tương ứng với lệnh <code>LTRIM</code>.</li></ul><h3 id="case-study-đinh-huong-quang-cao" tabindex="-1"><a class="header-anchor" href="#case-study-đinh-huong-quang-cao"><span>Case study - Định hướng quảng cáo</span></a></h3><h3 id="case-study-tim-kiem-vi-tri-cong-viec" tabindex="-1"><a class="header-anchor" href="#case-study-tim-kiem-vi-tri-cong-viec"><span>Case study - Tìm kiếm vị trí công việc</span></a></h3><p>Yêu cầu: Trên một trang web tuyển dụng, người tìm việc có một List kỹ năng của riêng mình; các công ty tuyển dụng có một List kỹ năng cần thiết cho vị trí công việc. Các công ty tuyển dụng cần tìm kiếm người tìm việc phù hợp với yêu cầu công việc của mình; người tìm việc cần tìm kiếm các vị trí công việc mà mình có thể nộp đơn.</p><p>Mô hình dữ liệu quan trọng: Sử dụng kiểu dữ liệu <code>SET</code> để lưu trữ List kỹ năng của người tìm việc và List kỹ năng của vị trí công việc.</p><p>Hoạt động quan trọng: Sử dụng lệnh <code>SDIFF</code> để so sánh sự khác biệt giữa hai <code>SET</code>, trả về <code>empty</code> nếu đáp ứng yêu cầu.</p><p>Ví dụ sử dụng Redis CLI:</p><div class="language-shell line-numbers-mode" data-ext="shell" data-title="shell"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># -----------------------------------------------------------</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Mô hình dữ liệu tìm kiếm vị trí công việc trong Redis</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># -----------------------------------------------------------</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># (1) Bảng kỹ năng vị trí công việc: Lưu trữ bằng kiểu dữ liệu SET</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Công việc job:001 yêu cầu 4 kỹ năng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:001</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:001</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:002</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:001</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:003</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:001</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:004</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Công việc job:002 yêu cầu 3 kỹ năng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:002</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:003</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Công việc job:003 yêu cầu 2 kỹ năng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:003</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:003</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:003</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xem List kỹ năng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SMEMBERS</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SMEMBERS</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:002</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SMEMBERS</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:003</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># (2) Bảng kỹ năng của người tìm việc: Lưu trữ bằng kiểu dữ liệu SET</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:001</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:001</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:003</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:002</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:003</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:004</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SADD</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> skill:005</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># Xem List kỹ năng</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SMEMBERS</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SMEMBERS</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:002</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># (3) Người tìm việc tìm kiếm các vị trí công việc phù hợp với yêu cầu của mình (trả về empty nếu tất cả các kỹ năng yêu cầu đều được đáp ứng)</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># So sánh sự khác biệt giữa List kỹ năng của vị trí công việc và List kỹ năng của người tìm việc</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:001</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:003</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:001</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:001</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:002</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:002</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:003</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:002</span></span>
<span class="line"></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># (4) Công ty tuyển dụng tìm kiếm người tìm việc phù hợp với yêu cầu công việc của mình (trả về empty nếu tất cả các kỹ năng yêu cầu đều được đáp ứng)</span></span>
<span class="line"><span style="color:#7F848E;--shiki-dark:#7F848E;font-style:italic;--shiki-dark-font-style:italic;"># So sánh sự khác biệt giữa List kỹ năng của người tìm việc và List kỹ năng của vị trí công việc</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:001</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:001</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:001</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:001</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:002</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:002</span></span>
<span class="line"></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:001</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:003</span></span>
<span class="line"><span style="color:#61AFEF;--shiki-dark:#61AFEF;">SDIFF</span><span style="color:#98C379;--shiki-dark:#98C379;"> interviewee:002</span><span style="color:#98C379;--shiki-dark:#98C379;"> job:003</span></span></code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Redis có năm loại dữ liệu phổ biến: <strong>String (chuỗi), Hash (bảng băm), List (danh sách), Set (tập hợp) và Zset (tập hợp có thứ tự)</strong>.</p><p>Các loại dữ liệu này được triển khai với nhiều cấu trúc dữ liệu khác nhau, chủ yếu là để tối ưu thời gian và không gian lưu trữ. Khi tập dữ liệu nhỏ, việc sử dụng cấu trúc đơn giản hơn có lợi để tiết kiệm bộ nhớ và cải thiện hiệu suất.</p><p>Cấu trúc dữ liệu dưới cùng cho các loại dữ liệu Redis có sự khác biệt theo từng phiên bản, ví dụ như:</p><ul><li>Trong phiên bản Redis 3.0, cấu trúc dữ liệu của đối tượng List được triển khai bằng &quot;danh sách liên kết hai chiều&quot; hoặc &quot;ziplist&quot;. Tuy nhiên, từ phiên bản 3.2 trở đi, List sử dụng cấu trúc dữ liệu quicklist.</li><li>Trong mã nguồn Redis mới nhất, cấu trúc dữ liệu ziplist đã bị loại bỏ và thay thế bằng listpack.</li></ul><p><strong>Ứng dụng của các loại dữ liệu Redis:</strong></p><ul><li><strong>String</strong>: Lưu trữ cache, đếm tổng, khóa phân tán, chia sẻ thông tin phiên, v.v.</li><li><strong>List</strong>: Hàng đợi tin nhắn (tuy nhiên có hai vấn đề: 1. Nhà sản xuất phải tự triển khai ID duy nhất toàn cầu; 2. Không hỗ trợ việc tiêu thụ dữ liệu theo nhóm).</li><li><strong>Hash</strong>: Lưu trữ cache, giỏ hàng mua sắm, v.v.</li><li><strong>Set</strong>: Tính toán tổ hợp (hợp, giao, khác), chẳng hạn như thích, theo dõi chung, hoạt động rút thăm, v.v.</li><li><strong>Zset (Sorted Set)</strong>: Sắp xếp dữ liệu, chẳng hạn như bảng xếp hạng, sắp xếp số điện thoại và tên.</li></ul><p><strong>Các loại dữ liệu mới trong Redis và ứng dụng của chúng:</strong></p><ul><li><strong>Bitmap (thêm từ phiên bản 2.2)</strong>: Thống kê trạng thái nhị phân, chẳng hạn như đánh dấu tham gia, xác định trạng thái đăng nhập của người dùng, tổng số người dùng liên tục đăng ký, v.v.</li><li><strong>HyperLogLog (thêm từ phiên bản 2.8)</strong>: Thống kê số lượng cơ sở dữ liệu lớn, chẳng hạn như số lượt truy cập trang web hàng triệu.</li><li><strong>GEO (thêm từ phiên bản 3.2)</strong>: Lưu trữ thông tin vị trí địa lý, chẳng hạn như dịch vụ gọi xe Didi.</li><li><strong>Stream (thêm từ phiên bản 5.0)</strong>: Hàng đợi tin nhắn, có hai tính năng đặc biệt so với hàng đợi tin nhắn triển khai dựa trên List: tự động tạo ID tin nhắn duy nhất toàn cầu, hỗ trợ tiêu thụ dữ liệu theo nhóm.</li></ul><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624212030.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Việc sử dụng Redis làm hệ thống hàng đợi tin nhắn phụ thuộc vào tình huống nghiệp vụ của bạn:</p><ul><li>Nếu kịch bản nghiệp vụ của bạn đơn giản, không nhạy cảm với việc mất dữ liệu và khả năng chất đống thông tin ít, Redis có thể được sử dụng như một hàng đợi hoàn toàn.</li><li>Nếu kịch bản nghiệp vụ của bạn có số lượng tin nhắn lớn, tỷ lệ chất đống thông tin cao và không thể chấp nhận mất dữ liệu, hãy sử dụng phần mềm trung gian hàng đợi chuyên nghiệp.</li></ul>`,425),r=[t];function p(o,e){return a(),n("div",null,r)}const k=s(l,[["render",p],["__file","basic-data-types.html.vue"]]),h=JSON.parse('{"path":"/database/redis/basic-data-types.html","title":"Redis Basic Data Types","lang":"en-US","frontmatter":{"title":"Redis Basic Data Types","tags":["redis","nosql"],"categories":["redis"],"icon":"devicon:redis","date created":"2023-07-24T00:00:00.000Z","date modified":"2023-07-24T00:00:00.000Z","order":3,"description":"Redis Basic Data Types Redis cung cấp nhiều loại dữ liệu, mỗi loại dữ liệu đều có các lệnh hỗ trợ phong phú. Khi sử dụng Redis, không chỉ cần hiểu các đặc điểm của các loại dữ l...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/database/redis/basic-data-types.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"Redis Basic Data Types"}],["meta",{"property":"og:description","content":"Redis Basic Data Types Redis cung cấp nhiều loại dữ liệu, mỗi loại dữ liệu đều có các lệnh hỗ trợ phong phú. Khi sử dụng Redis, không chỉ cần hiểu các đặc điểm của các loại dữ l..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624195542.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-28T15:54:38.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"redis"}],["meta",{"property":"article:tag","content":"nosql"}],["meta",{"property":"article:modified_time","content":"2024-06-28T15:54:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redis Basic Data Types\\",\\"image\\":[\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624195542.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724115329.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624200410.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724122757.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724122821.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624201754.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624201852.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724122943.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624203635.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624203650.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230724123002.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624210536.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200225143038.jpg\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200225145742.jpg\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200225150105.jpg\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200225150138.jpg\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20200225214210.jpg\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240624212030.png\\"],\\"dateModified\\":\\"2024-06-28T15:54:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Các kiểu dữ liệu cơ bản của Redis","slug":"cac-kieu-du-lieu-co-ban-cua-redis","link":"#cac-kieu-du-lieu-co-ban-cua-redis","children":[]},{"level":2,"title":"STRING","slug":"string","link":"#string","children":[{"level":3,"title":"Giới thiệu về String","slug":"gioi-thieu-ve-string","link":"#gioi-thieu-ve-string","children":[]},{"level":3,"title":"Cách triển khai String","slug":"cach-trien-khai-string","link":"#cach-trien-khai-string","children":[]},{"level":3,"title":"Lệnh String","slug":"lenh-string","link":"#lenh-string","children":[]},{"level":3,"title":"Ứng dụng String","slug":"ung-dung-string","link":"#ung-dung-string","children":[]}]},{"level":2,"title":"HASH","slug":"hash","link":"#hash","children":[{"level":3,"title":"Giới thiệu về Hash","slug":"gioi-thieu-ve-hash","link":"#gioi-thieu-ve-hash","children":[]},{"level":3,"title":"Cấu trúc Hash","slug":"cau-truc-hash","link":"#cau-truc-hash","children":[]},{"level":3,"title":"Các lệnh của Hash","slug":"cac-lenh-cua-hash","link":"#cac-lenh-cua-hash","children":[]},{"level":3,"title":"Ứng dụng của Hash","slug":"ung-dung-cua-hash","link":"#ung-dung-cua-hash","children":[]}]},{"level":2,"title":"LIST","slug":"list","link":"#list","children":[{"level":3,"title":"Giới thiệu về List","slug":"gioi-thieu-ve-list","link":"#gioi-thieu-ve-list","children":[]},{"level":3,"title":"Cách triển khai List","slug":"cach-trien-khai-list","link":"#cach-trien-khai-list","children":[]},{"level":3,"title":"Lệnh List","slug":"lenh-list","link":"#lenh-list","children":[]},{"level":3,"title":"Ứng dụng List","slug":"ung-dung-list","link":"#ung-dung-list","children":[]}]},{"level":2,"title":"SET","slug":"set","link":"#set","children":[{"level":3,"title":"Giới thiệu về Set","slug":"gioi-thieu-ve-set","link":"#gioi-thieu-ve-set","children":[]},{"level":3,"title":"Triển khai Set","slug":"trien-khai-set","link":"#trien-khai-set","children":[]},{"level":3,"title":"Các lệnh Set","slug":"cac-lenh-set","link":"#cac-lenh-set","children":[]},{"level":3,"title":"Ứng dụng Set","slug":"ung-dung-set","link":"#ung-dung-set","children":[]}]},{"level":2,"title":"ZSET (Sorted Set)","slug":"zset-sorted-set","link":"#zset-sorted-set","children":[{"level":3,"title":"Giới thiệu về Zset","slug":"gioi-thieu-ve-zset","link":"#gioi-thieu-ve-zset","children":[]},{"level":3,"title":"Triển khai Zset","slug":"trien-khai-zset","link":"#trien-khai-zset","children":[]},{"level":3,"title":"Zset Commands","slug":"zset-commands","link":"#zset-commands","children":[]},{"level":3,"title":"Ứng dụng của Zset","slug":"ung-dung-cua-zset","link":"#ung-dung-cua-zset","children":[]},{"level":3,"title":"Bảng xếp hạng","slug":"bang-xep-hang","link":"#bang-xep-hang","children":[]},{"level":3,"title":"Sắp xếp theo tiền tố","slug":"sap-xep-theo-tien-to","link":"#sap-xep-theo-tien-to","children":[]}]},{"level":2,"title":"Ứng dụng thực tê","slug":"ung-dung-thuc-te","link":"#ung-dung-thuc-te","children":[{"level":3,"title":"Case study - Bài viết phổ biến nhất","slug":"case-study-bai-viet-pho-bien-nhat","link":"#case-study-bai-viet-pho-bien-nhat","children":[]},{"level":3,"title":"Case study - Quản lý token","slug":"case-study-quan-ly-token","link":"#case-study-quan-ly-token","children":[]},{"level":3,"title":"Case study - Giỏ hàng","slug":"case-study-gio-hang","link":"#case-study-gio-hang","children":[]},{"level":3,"title":"Case study - Bộ nhớ cache trang web","slug":"case-study-bo-nho-cache-trang-web","link":"#case-study-bo-nho-cache-trang-web","children":[]},{"level":3,"title":"Case study - Bộ nhớ cache dòng dữ liệu","slug":"case-study-bo-nho-cache-dong-du-lieu","link":"#case-study-bo-nho-cache-dong-du-lieu","children":[]},{"level":3,"title":"Case study - Phân tích trang web","slug":"case-study-phan-tich-trang-web","link":"#case-study-phan-tich-trang-web","children":[]},{"level":3,"title":"Case study - Ghi log","slug":"case-study-ghi-log","link":"#case-study-ghi-log","children":[]},{"level":3,"title":"Case study - Thống kê dữ liệu","slug":"case-study-thong-ke-du-lieu","link":"#case-study-thong-ke-du-lieu","children":[]},{"level":3,"title":"Case study - Tìm địa chỉ IP thuộc về đâu","slug":"case-study-tim-đia-chi-ip-thuoc-ve-đau","link":"#case-study-tim-đia-chi-ip-thuoc-ve-đau","children":[]},{"level":3,"title":"Case study - Phát hiện và cấu hình dịch vụ","slug":"case-study-phat-hien-va-cau-hinh-dich-vu","link":"#case-study-phat-hien-va-cau-hinh-dich-vu","children":[]},{"level":3,"title":"Case study - Tự động hoàn chỉnh","slug":"case-study-tu-đong-hoan-chinh","link":"#case-study-tu-đong-hoan-chinh","children":[]},{"level":3,"title":"Case study - Định hướng quảng cáo","slug":"case-study-đinh-huong-quang-cao","link":"#case-study-đinh-huong-quang-cao","children":[]},{"level":3,"title":"Case study - Tìm kiếm vị trí công việc","slug":"case-study-tim-kiem-vi-tri-cong-viec","link":"#case-study-tim-kiem-vi-tri-cong-viec","children":[]}]}],"git":{"createdTime":1719590078000,"updatedTime":1719590078000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":57.43,"words":17229},"filePathRelative":"database/redis/basic-data-types.md","localizedDate":"June 28, 2024","excerpt":"\\n<p>Redis cung cấp nhiều loại dữ liệu, mỗi loại dữ liệu đều có các lệnh hỗ trợ phong phú.</p>\\n<p>Khi sử dụng Redis, không chỉ cần hiểu các đặc điểm của các loại dữ liệu, mà còn cần linh hoạt và hiệu quả trong việc sử dụng các loại dữ liệu này để xây dựng mô hình dữ liệu phù hợp với kịch bản nghiệp vụ.</p>","autoDesc":true}');export{k as comp,h as data};
