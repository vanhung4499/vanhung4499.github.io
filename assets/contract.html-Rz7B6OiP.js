import{_ as p,g as o,o as c,c as l,e as s,h as a,f as e,w as d,a as t}from"./app-5QVbWi7Z.js";const r={};function u(m,n){const i=o("RouteLink");return c(),l("div",null,[n[25]||(n[25]=s("h1",{id:"【合同】合同管理、合同提醒",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#【合同】合同管理、合同提醒"},[s("span",null,"【合同】合同管理、合同提醒")])],-1)),s("p",null,[n[1]||(n[1]=a("合同模块，由 ")),n[2]||(n[2]=s("code",null,"yudao-module-crm-biz",-1)),n[3]||(n[3]=a(" 后端模块的 ")),n[4]||(n[4]=s("code",null,"contract",-1)),n[5]||(n[5]=a(" 包实现，已经和 ")),e(i,{to:"/bpm/"},{default:d(()=>n[0]||(n[0]=[a("BPM 工作流")])),_:1}),n[6]||(n[6]=a(" 打通审批。"))]),n[26]||(n[26]=t('<h2 id="_1-合同" tabindex="-1"><a class="header-anchor" href="#_1-合同"><span><a href="#_1-%E5%90%88%E5%90%8C">#</a> 1. 合同</span></a></h2><p>合同，由 <code>yudao-module-crm-biz</code> 后端模块的 <code>business</code> 包的 CrmContractController 实现。表关系如下：</p><figure><img src="https://doc.iocoder.cn/img/CRM手册/合同/表关系.png" alt="表关系" tabindex="0" loading="lazy"><figcaption>表关系</figcaption></figure><h3 id="_1-表结构" tabindex="-1"><a class="header-anchor" href="#_1-表结构"><span><a href="#_1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 1. 表结构</span></a></h3><blockquote><p>【合同表】省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language- line-numbers-mode" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>CREATE TABLE `crm_contract` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号，主键自增&#39;,</span></span>\n<span class="line"><span>  `name` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;合同名称&#39;,</span></span>\n<span class="line"><span>  `no` varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT &#39;合同编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `customer_id` bigint NOT NULL COMMENT &#39;客户编号&#39;,</span></span>\n<span class="line"><span>  `business_id` bigint DEFAULT NULL COMMENT &#39;商机编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `contact_last_time` datetime DEFAULT NULL COMMENT &#39;最后跟进时间&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `owner_user_id` bigint DEFAULT NULL COMMENT &#39;负责人的用户编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `process_instance_id` varchar(64) COLLATE utf8mb4_unicode_ci DEFAULT NULL COMMENT &#39;工作流编号&#39;,</span></span>\n<span class="line"><span>  `audit_status` tinyint NOT NULL DEFAULT &#39;0&#39; COMMENT &#39;审批状态&#39;,</span></span>\n<span class="line"><span></span></span>\n<span class="line"><span>  `total_product_price` decimal(24,6) DEFAULT NULL COMMENT &#39;产品总金额&#39;,</span></span>\n<span class="line"><span>  `discount_percent` decimal(24,6) DEFAULT NULL COMMENT &#39;整单折扣&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(10,2) DEFAULT NULL COMMENT &#39;合同总金额&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `order_date` datetime DEFAULT NULL COMMENT &#39;下单日期&#39;,</span></span>\n<span class="line"><span>  `start_time` datetime DEFAULT NULL COMMENT &#39;开始时间&#39;,</span></span>\n<span class="line"><span>  `end_time` datetime DEFAULT NULL COMMENT &#39;结束时间&#39;,</span></span>\n<span class="line"><span>  `sign_contact_id` bigint DEFAULT NULL COMMENT &#39;联系人编号&#39;,</span></span>\n<span class="line"><span>  `sign_user_id` bigint DEFAULT NULL COMMENT &#39;公司签约人&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  PRIMARY KEY (`id`) USING BTREE</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=8 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=&#39;CRM 合同表&#39;;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>① <code>no</code> 字段：合同编号，系统自动生成的，目前格式是 <code>{prefix}{yyyyMMdd}{6 位自增}</code>。具体可见 ErpNoRedisDAO 类。</p><p>② <code>customer_id</code> 字段：客户编号，对应 <code>crm_customer</code> 表的 <code>id</code> 字段，必填。</p><p>③ <code>business_id</code> 字段：商机编号，对应 <code>crm_business</code> 表的 <code>id</code> 字段，选填。在选择商机时，会自动带出商机的 <code>crm_business_product</code> 表的产品信息，稍后会看到</p>',9)),s("p",null,[n[8]||(n[8]=a("④ ")),n[9]||(n[9]=s("code",null,"contact_last_time",-1)),n[10]||(n[10]=a(" 字段：跟进相关，和线索类似。不重复赘述，详细可见 ")),e(i,{to:"/crm/follow-up/"},{default:d(()=>n[7]||(n[7]=[a("《【通用】跟进记录》")])),_:1}),n[11]||(n[11]=a(" 文档。"))]),s("p",null,[n[13]||(n[13]=a("⑤ ")),n[14]||(n[14]=s("code",null,"owner_user_id",-1)),n[15]||(n[15]=a(" 字段：合同的负责人编号，和线索类似。不重复赘述，详细可见 ")),e(i,{to:"/crm/permission/"},{default:d(()=>n[12]||(n[12]=[a("《【通用】数据权限》")])),_:1}),n[16]||(n[16]=a(" 文档。"))]),s("p",null,[n[18]||(n[18]=a("⑥ ")),n[19]||(n[19]=s("code",null,"process_instance_id",-1)),n[20]||(n[20]=a(" 字段：工作流编号，用于和 ")),e(i,{to:"/bpm/"},{default:d(()=>n[17]||(n[17]=[a("BPM 工作流")])),_:1}),n[21]||(n[21]=a(" 打通审批。提交审批后，会自动创建一个工作流实例，并记录到该字段。"))]),n[27]||(n[27]=t('<p><code>audit_status</code> 字段：审批结果，目前由 CrmAuditStatusEnum 枚举，目前有 5 个状态：未提交、审批中、审批通过、审批不通过、已取消。</p><p>⑤ <code>total_product_price</code>、<code>discount_percent</code>、<code>total_price</code> 字段：合同的金额相关，关系是 <code>total_price = total_product_price * discount_percent</code>。</p><p>其中，<code>total_product_price</code> 字段是 <code>crm_contract_product</code> 表的 <code>total_price * count</code> 的累加。</p><p>⑥ 从 <code>order_date</code> 到 <code>sign_user_id</code> 字段：合同的信息字段，比较简单，不重复赘述。</p><blockquote><p>【合同产品表】省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>CREATE TABLE `crm_contract_product` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;主键&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `contract_id` bigint NOT NULL COMMENT &#39;合同编号&#39;,</span></span>\n<span class="line"><span>  `product_id` bigint NOT NULL COMMENT &#39;产品编号&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  `product_price` decimal(24,6) NOT NULL COMMENT &#39;产品单价&#39;,</span></span>\n<span class="line"><span>  `contract_price` decimal(24,6) NOT NULL COMMENT &#39;合同价格&#39;,</span></span>\n<span class="line"><span>  `count` decimal(24,6) NOT NULL COMMENT &#39;数量&#39;,</span></span>\n<span class="line"><span>  `total_price` decimal(24,6) NOT NULL COMMENT &#39;总计价格&#39;,</span></span>\n<span class="line"><span>  </span></span>\n<span class="line"><span>  PRIMARY KEY (`id`) USING BTREE</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=39 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci ROW_FORMAT=DYNAMIC COMMENT=&#39;CRM 合同产品关联表&#39;;</span></span></code></pre></div><p>友情提示：整体和商机产品表 <code>crm\\_business\\_product</code> 类似。因为本身商机进一步转化后，就是合同。</p><p>① <code>contract_id</code> 字段：合同编号，对应 <code>crm_contract</code> 表的 <code>id</code> 字段。</p><p><code>product_id</code> 字段：产品编号，对应 <code>crm_product</code> 表的 <code>id</code> 字段。</p><p>② <code>product_price</code> 字段：产品单价，<strong>冗余</strong>，来自 <code>crm_product</code> 表的 <code>price</code> 字段。目的是，和 <code>contract_price</code> 字段比较，看看是否有折扣。</p><p><code>count</code>、<code>total_price</code> 字段：数量、总计价格。</p><h3 id="_2-管理后台" tabindex="-1"><a class="header-anchor" href="#_2-管理后台"><span><a href="#_2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 2. 管理后台</span></a></h3><p>对应 [CRM 系统 -&gt; 合同管理] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/crm/contract</code> 目录。</p><figure><img src="https://doc.iocoder.cn/img/CRM手册/合同/合同管理.png" alt="合同管理" tabindex="0" loading="lazy"><figcaption>合同管理</figcaption></figure><p>① 点击【新增】按钮，随便填写一些信息，点击「确认」按钮，即可新增一条合同。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/CRM手册/合同/合同新增.png" alt="新增合同" tabindex="0" loading="lazy"><figcaption>新增合同</figcaption></figure><p>② 点击【提交审批】按钮，可以提交审批。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/CRM手册/合同/合同提交审批.png" alt="提交审批" tabindex="0" loading="lazy"><figcaption>提交审批</figcaption></figure><p>友情提示：</p><p>合同对应的审批流程，需要自己在 [工作流程 -&gt; 流程管理 -&gt; 流程模型] 菜单，配置一个流程标识为 <code>crm-contract-audit</code> 的流程模型。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/CRM手册/合同/流程模型.png" alt="流程模型" tabindex="0" loading="lazy"><figcaption>流程模型</figcaption></figure>',21)),s("p",null,[n[23]||(n[23]=a("如果不了解怎么配置的同学，可以学习下 ")),e(i,{to:"/bpm/"},{default:d(()=>n[22]||(n[22]=[a("《BPM 工作流》")])),_:1}),n[24]||(n[24]=a(" 的文档。"))]),n[28]||(n[28]=t('<p>提交完成后，会自动创建一个工作流实例，并记录到 <code>process_instance_id</code> 字段。之后可点击【查看审批】按钮，查看审批详情。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/CRM手册/合同/合同审批详情.png" alt="查看审批" tabindex="0" loading="lazy"><figcaption>查看审批</figcaption></figure><p>点击审批【通过】按钮，将合同审批通过，此时它会回调 CrmContractResultListener 监听器，更新合同的 <code>audit_status</code> 字段为审批通过。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/CRM手册/合同/合同审批通过.png" alt="审批通过" tabindex="0" loading="lazy"><figcaption>审批通过</figcaption></figure><p>③ 点击“合同名称”，进入合同详情页，可以查看合同的详细信息，如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/CRM手册/合同/合同详情.png" alt="合同详情" tabindex="0" loading="lazy"><figcaption>合同详情</figcaption></figure><h2 id="_2-合同配置" tabindex="-1"><a class="header-anchor" href="#_2-合同配置"><span><a href="#_2-%E5%90%88%E5%90%8C%E9%85%8D%E7%BD%AE">#</a> 2. 合同配置</span></a></h2><p>客户公海配置，由 <code>yudao-module-crm-biz</code> 后端模块的 <code>contract</code> 包的 CrmContractConfigController 实现。</p><h3 id="_2-1-表结构" tabindex="-1"><a class="header-anchor" href="#_2-1-表结构"><span><a href="#_2-1-%E8%A1%A8%E7%BB%93%E6%9E%84">#</a> 2.1 表结构</span></a></h3><blockquote><p>省略 creator/create_time/updater/update_time/deleted/tenant_id 等通用字段</p></blockquote><div class="language-" data-highlighter="shiki" data-ext="" data-title="" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span>CREATE TABLE `crm_contract_config` (</span></span>\n<span class="line"><span>  `id` bigint NOT NULL AUTO_INCREMENT COMMENT &#39;编号&#39;,</span></span>\n<span class="line"><span>  `notify_enabled` tinyint(1) DEFAULT NULL COMMENT &#39;是否开启提前提醒&#39;,</span></span>\n<span class="line"><span>  `notify_days` int DEFAULT NULL COMMENT &#39;提前提醒天数&#39;,</span></span>\n<span class="line"><span>  PRIMARY KEY (`id`) USING BTREE</span></span>\n<span class="line"><span>) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT=&#39;CRM 合同配置表&#39;;</span></span></code></pre></div><p>目前主要是合同提醒功能。</p><p><code>notify_enabled</code> 字段：是否开启提前提醒。如果开启，合同的结束时间 <code>end_time</code> 超过今天，并且小于 <code>notify_days</code> 天的，可以在 [CRM 系统 -&gt; 待办事项] 菜单中，看到提醒。如下图所示：</p><figure><img src="https://doc.iocoder.cn/img/CRM手册/合同/即将到期的合同.png" alt="即将到期的合同" tabindex="0" loading="lazy"><figcaption>即将到期的合同</figcaption></figure><h3 id="_2-2-管理后台" tabindex="-1"><a class="header-anchor" href="#_2-2-管理后台"><span><a href="#_2-2-%E7%AE%A1%E7%90%86%E5%90%8E%E5%8F%B0">#</a> 2.2 管理后台</span></a></h3><p>对应 [CRM 系统 -&gt; 系统配置 -&gt; 合同配置] 菜单，对应 <code>yudao-ui-admin-vue3</code> 项目的 <code>@/views/contract/config</code> 目录。</p><figure><img src="https://doc.iocoder.cn/img/CRM手册/合同/合同配置.png" alt="合同配置" tabindex="0" loading="lazy"><figcaption>合同配置</figcaption></figure>',17))])}const E=p(r,[["render",u],["__file","contract.html.vue"]]),b=JSON.parse('{"path":"/project/rouyi-vue-pro/crm/contract.html","title":"【合同】合同管理、合同提醒","lang":"en-US","frontmatter":{"title":"【合同】合同管理、合同提醒","tags":["project","java","spring-boot","spring-cloud"],"categories":["project"],"order":123,"feed":false,"seo":false,"head":[]},"headers":[{"level":2,"title":"# 1. 合同","slug":"_1-合同","link":"#_1-合同","children":[{"level":3,"title":"# 1. 表结构","slug":"_1-表结构","link":"#_1-表结构","children":[]},{"level":3,"title":"# 2. 管理后台","slug":"_2-管理后台","link":"#_2-管理后台","children":[]}]},{"level":2,"title":"# 2. 合同配置","slug":"_2-合同配置","link":"#_2-合同配置","children":[{"level":3,"title":"# 2.1 表结构","slug":"_2-1-表结构","link":"#_2-1-表结构","children":[]},{"level":3,"title":"# 2.2 管理后台","slug":"_2-2-管理后台","link":"#_2-2-管理后台","children":[]}]}],"git":{"createdTime":1720365235000,"updatedTime":1720365235000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":5.52,"words":1657},"filePathRelative":"project/rouyi-vue-pro/crm/contract.md","localizedDate":"July 7, 2024"}');export{E as comp,b as data};
