import{_ as s,o as a,c as n,a as t}from"./app-CmlOSuIY.js";const h={};function l(p,i){return a(),n("div",null,i[0]||(i[0]=[t(`<h1 id="nguyen-ly-co-ban-cua-spring-boot" tabindex="-1"><a class="header-anchor" href="#nguyen-ly-co-ban-cua-spring-boot"><span>Nguyên lý cơ bản của Spring Boot</span></a></h1><p>Spring Boot đã tự động cấu hình cho chúng ta, thật tiện lợi và nhanh chóng, nhưng tôi vẫn không hiểu rõ về nguyên lý khởi động bên trong nó. Lần này, chúng ta sẽ từng bước khám phá bí mật của Spring Boot và làm cho nó không còn bí ẩn nữa.</p><hr><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SpringBootApplication</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        SpringApplication</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, args);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Từ đoạn mã trên, chúng ta có thể thấy rằng <strong>Annotation (@SpringBootApplication) và phương thức (SpringApplication.run)</strong> là những nổi bật nhất, vì vậy để khám phá bí mật của Spring Boot, chúng ta chỉ cần bắt đầu từ hai điểm này.</p><h2 id="bi-mat-sau-springbootapplication" tabindex="-1"><a class="header-anchor" href="#bi-mat-sau-springbootapplication"><span>Bí mật sau @SpringBootApplication</span></a></h2><div class="language-kotlin" data-highlighter="shiki" data-ext="kotlin" data-title="kotlin" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">@Target</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(ElementType.TYPE)            </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Phạm vi áp dụng của Annotation, trong đó TYPE được sử dụng để mô tả lớp, giao diện (bao gồm cả loại chú thích gói) hoặc khai báo enum</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">@Retention</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(RetentionPolicy.RUNTIME)  </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Vòng đời của Annotation, lưu giữ trong tệp class (ba vòng đời)</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">@Documented</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                          // Cho biết chú thích này nên được ghi lại trong javadoc</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">@Inherited</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">                           // Lớp con có thể kế thừa chú thích này</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">@SpringBootConfiguration</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">             // Kế thừa từ Configuration, chỉ định rằng đây là một lớp chú thích</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">@EnableAutoConfiguration</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">             // Kích hoạt tính năng chú thích của Spring Boot, một trong bốn công cụ mạnh mẽ của Spring Boot, được hỗ trợ bởi @import</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">@ComponentScan</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(excludeFilters </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {    </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// Cài đặt quét đường dẫn (sử dụng cụ thể cần xác nhận)</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        @Filter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(type </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> FilterType.CUSTOM, classes </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> TypeExcludeFilter.class),</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        @Filter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(type </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> FilterType.CUSTOM, classes </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> AutoConfigurationExcludeFilter.class) })</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> @interface</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> SpringBootApplication</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Mặc dù việc định nghĩa sử dụng nhiều Annotation đã được gắn kết thông tin gốc, nhưng thực tế chỉ có ba Annotation quan trọng:</p><p><strong>@Configuration</strong> (@SpringBootConfiguration khi mở ra để xem, bạn sẽ thấy nó vẫn áp dụng @Configuration)<br><strong>@EnableAutoConfiguration</strong><br><strong>@ComponentScan</strong></p><p>Vì vậy, nếu chúng ta sử dụng lớp khởi động Spring Boot như sau, toàn bộ ứng dụng Spring Boot vẫn có thể tương đương với lớp khởi động trước đó:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">EnableAutoConfiguration</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ComponentScan</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> main</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">args</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        SpringApplication</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">run</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, args);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Việc viết ba Annotation này mỗi lần khá mệt mỏi, vì vậy chúng ta sẽ viết một @SpringBootApplication để tiện lợi hơn. Tiếp theo, chúng ta sẽ giới thiệu từng Annotation này một cách riêng biệt.</p><h2 id="configuration" tabindex="-1"><a class="header-anchor" href="#configuration"><span>@Configuration</span></a></h2><p>Chúng ta không xa lạ với @Configuration, nó là cách cấu hình của Spring IoC Container sử dụng JavaConfig. Cộng đồng Spring Boot khuyến nghị sử dụng cách cấu hình dựa trên JavaConfig, vì vậy khi chúng ta đánh dấu @Configuration trên lớp khởi động, nó thực sự là một lớp cấu hình của IoC Container.</p><p>Hãy xem một số ví dụ đơn giản để nhớ lại sự khác biệt giữa cách cấu hình XML và JavaConfig:</p><p>Mức độ biểu thị:<br> Cách cấu hình dựa trên XML như sau:</p><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;?</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">xml</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> version</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;1.0&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> encoding</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;UTF-8&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">?&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> xmlns</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/beans&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">       xmlns:xsi</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">       xsi:schemaLocation</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd&quot;</span></span>
<span class="line"><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">       default-lazy-init</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;true&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    &lt;!-- Định nghĩa bean --&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">beans</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p>Còn cách cấu hình dựa trên JavaConfig như sau:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MockConfiguration</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Định nghĩa bean</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>Bất kỳ lớp Java nào được đánh dấu @Configuration đều là một lớp cấu hình JavaConfig.</strong></p><p>Đăng ký định nghĩa bean:<br> Trong cách cấu hình dựa trên XML, chúng ta có:</p><div class="language-csharp" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">bean</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> id</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;mockService&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> class</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;..MockServiceImpl&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ...</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span></span></code></pre></div><p>Còn trong cách cấu hình dựa trên JavaConfig, chúng ta có:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MockConfiguration</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MockService</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> mockService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> MockServiceImpl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>Bất kỳ phương thức nào được đánh dấu @Bean, giá trị trả về của nó sẽ được đăng ký như một định nghĩa bean trong IoC Container của Spring, và tên phương thức sẽ mặc định là id của định nghĩa bean đó.</strong></p><p>Biểu diễn mối quan hệ dependency injection:<br> Để biểu diễn mối quan hệ phụ thuộc giữa các bean trong cách cấu hình dựa trên XML, chúng ta thường có:</p><div class="language-jsx" data-highlighter="shiki" data-ext="jsx" data-title="jsx" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;mockService&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> class</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;..MockServiceImpl&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">propery</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> name</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;dependencyService&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> ref</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;dependencyService&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> /&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> id</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;dependencyService&quot;</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> class</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;DependencyServiceImpl&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">bean</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><p>Trong cách cấu hình dựa trên JavaConfig, chúng ta có:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Configuration</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MockConfiguration</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">{</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> MockService</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> mockService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> MockServiceImpl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">dependencyService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Bean</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> DependencyService</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> dependencyService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(){</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> DependencyServiceImpl</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p><strong>Nếu một định nghĩa bean phụ thuộc vào các bean khác, chúng ta chỉ cần gọi phương thức tạo bean phụ thuộc đó trong lớp JavaConfig tương ứng.</strong></p><h2 id="componentscan" tabindex="-1"><a class="header-anchor" href="#componentscan"><span>@ComponentScan</span></a></h2><p><strong>@ComponentScan là một Annotation quan trọng trong Spring, nó tương ứng với phần tử <code>&lt;context:component-scan&gt;</code> trong cấu hình XML. Chức năng của @ComponentScan là tự động quét và tải các thành phần (ví dụ: @Component và @Repository) hoặc định nghĩa bean phù hợp, và cuối cùng tải các định nghĩa bean này vào IoC Container.</strong></p><p>Chúng ta có thể tùy chỉnh phạm vi quét chi tiết bằng cách sử dụng các thuộc tính như basePackages, nếu không chỉ định, Spring Boot sẽ mặc định quét từ gói chứa lớp chứa @ComponentScan.</p><blockquote><p>Lưu ý: Vì vậy, lớp khởi động của Spring Boot nên được đặt trong gói gốc, vì mặc định không chỉ định basePackages.</p></blockquote><h2 id="enableautoconfiguration" tabindex="-1"><a class="header-anchor" href="#enableautoconfiguration"><span>@EnableAutoConfiguration</span></a></h2><p>Annotation <strong>@EnableAutoConfiguration</strong> được cho là quan trọng nhất theo cảm nhận cá nhân của tôi, vì vậy nó được đặt ở cuối để giải thích. Mọi người có còn nhớ các Annotation bắt đầu bằng @Enable mà Spring Framework cung cấp không? Ví dụ: @EnableScheduling, @EnableCaching, @EnableMBeanExport và nhiều hơn nữa. Tư tưởng và phong cách hoạt động của @EnableAutoConfiguration thực sự tương tự với các Annotation này. Để tóm gọn, thông qua việc sử dụng hỗ trợ từ @Import, nó thu thập và đăng ký các định nghĩa bean liên quan đến các tình huống cụ thể.</p><p><strong>@EnableScheduling</strong> sử dụng @Import để tải các định nghĩa bean liên quan đến framework lập lịch của Spring vào IoC Container.<br><strong>@EnableMBeanExport</strong> sử dụng @Import để tải các định nghĩa bean liên quan đến JMX vào IoC Container.<br> Và <strong>@EnableAutoConfiguration</strong> cũng sử dụng @Import để tải tất cả các định nghĩa bean phù hợp với điều kiện tự động cấu hình vào IoC Container, chỉ đơn giản như vậy!</p><p>@EnableAutoConfiguration là một Annotation kết hợp, định nghĩa chính của nó như sau:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SuppressWarnings</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;deprecation&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Target</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ElementType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TYPE</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Retention</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RetentionPolicy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">RUNTIME</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Documented</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Inherited</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">AutoConfigurationPackage</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Import</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">EnableAutoConfigurationImportSelector</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> @</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">interface</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> EnableAutoConfiguration</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ...</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>Hai Annotation quan trọng:</p><p><strong>@AutoConfigurationPackage: Gói tự động cấu hình</strong></p><p><strong>@Import: Nhập các thành phần cấu hình tự động</strong></p><h4 id="annotation-autoconfigurationpackage" tabindex="-1"><a class="header-anchor" href="#annotation-autoconfigurationpackage"><span>Annotation AutoConfigurationPackage:</span></a></h4><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">static</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Registrar</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> implements</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ImportBeanDefinitionRegistrar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> DeterminableImports</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        @</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> void</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> registerBeanDefinitions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">AnnotationMetadata</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> metadata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">                BeanDefinitionRegistry</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> registry</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">            register</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(registry, </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> PackageImport</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(metadata).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getPackageName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span></code></pre></div><p>Thực tế, nó đăng ký một định nghĩa Bean.</p><p><code>new PackageImport(metadata).getPackageName()</code> thực tế là trả về gói thành phần cùng cấp và con của lớp chương trình chính hiện tại.</p><p>Ví dụ trên, DemoApplication nằm cùng cấp với gói demo, nhưng lớp demo2 là cấp cha của DemoApplication và nằm cùng cấp với gói example.</p><p>Điều này có nghĩa là trong các Bean được tải khi DemoApplication khởi động, nó sẽ không tải demo2. Đây cũng là lý do tại sao chúng ta phải đặt DemoApplication ở cấp cao nhất của dự án.</p><h4 id="annotation-import-autoconfigurationimportselector-class" tabindex="-1"><a class="header-anchor" href="#annotation-import-autoconfigurationimportselector-class"><span>Annotation Import(AutoConfigurationImportSelector.class):</span></a></h4><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230726003902.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Có thể thấy rõ ràng rằng AutoConfigurationImportSelector kế thừa từ DeferredImportSelector kế thừa từ ImportSelector.</p><p>ImportSelector có một phương thức là selectImports.</p><div class="language-dart line-numbers-mode" data-highlighter="shiki" data-ext="dart" data-title="dart" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">@Override</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    public </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">[] </span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">selectImports</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">AnnotationMetadata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> annotationMetadata) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        if</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isEnabled</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(annotationMetadata)) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> NO_IMPORTS</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        }</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        AutoConfigurationMetadata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> autoConfigurationMetadata </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> AutoConfigurationMetadataLoader</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                .</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">loadMetadata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">this</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.beanClassLoader);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        AnnotationAttributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> attributes </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getAttributes</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(annotationMetadata);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        List</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; configurations </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getCandidateConfigurations</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(annotationMetadata,</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">                attributes);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        configurations </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> removeDuplicates</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(configurations);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        Set</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt; exclusions </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> getExclusions</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(annotationMetadata, attributes);</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        checkExcludedClasses</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(configurations, exclusions);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        configurations.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">removeAll</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(exclusions);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        configurations </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> filter</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(configurations, autoConfigurationMetadata);</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        fireAutoConfigurationImportEvents</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(configurations, exclusions);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> StringUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">toStringArray</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(configurations);</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Có thể thấy ở dòng thứ 9, nó thực sự là tải một tệp bên ngoài có đường dẫn public static final String FACTORIES_RESOURCE_LOCATION = &quot;META-INF/spring.factories&quot;. Tệp bên ngoài này chứa nhiều lớp tự động cấu hình.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230726003925.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Trong đó, điều quan trọng nhất là <code>@Import(EnableAutoConfigurationImportSelector.class)</code>, thông qua <code>EnableAutoConfigurationImportSelector</code>, <code>@EnableAutoConfiguration</code> có thể giúp ứng dụng Spring Boot tải tất cả các cấu hình <code>@Configuration</code> phù hợp vào IoC Container hiện tại được tạo và sử dụng bởi Spring Boot. Giống như một &quot;con bạch tuộc&quot;.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230726004006.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="nhan-vat-hau-truong-cua-tu-đong-cau-hinh-springfactoriesloader" tabindex="-1"><a class="header-anchor" href="#nhan-vat-hau-truong-cua-tu-đong-cau-hinh-springfactoriesloader"><span>Nhân vật hậu trường của tự động cấu hình: SpringFactoriesLoader</span></a></h3><p>Nhờ sự hỗ trợ của một công cụ trong Spring Framework gọi là SpringFactoriesLoader, @EnableAutoConfiguration mới có thể hoạt động tự động cấu hình một cách thông minh!</p><p>SpringFactoriesLoader là một phương pháp mở rộng riêng của Spring Framework, chức năng chính của nó là tải cấu hình từ tệp cấu hình được chỉ định META-INF/spring.factories.</p><div class="language-php" data-highlighter="shiki" data-ext="php" data-title="php" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> abstract</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> class</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SpringFactoriesLoader</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    //...</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> &lt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">T</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> List</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">T</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> loadFactories</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Class</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">T</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> factoryClass,</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> ClassLoader</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> classLoader) {</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        ...</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> static</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> List</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> loadFactoryNames</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Class</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> factoryClass, ClassLoader classLoader) {</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">        ...</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    }</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">}</span></span></code></pre></div><p>Khi được sử dụng cùng với <strong>@EnableAutoConfiguration</strong>, nó cung cấp chức năng tìm kiếm cấu hình, tức là sử dụng org.springframework.boot.autoconfigure.EnableAutoConfiguration làm khóa tìm kiếm để lấy một nhóm các lớp <strong>@Configuration</strong> tương ứng.</p><figure><img src="https://upload-images.jianshu.io/upload_images/6430208-fcdfcb56828a015a?imageMogr2/auto-orient/strip|imageView2/2/w/1200/format/webp" alt="img" tabindex="0" loading="lazy"><figcaption>img</figcaption></figure><p>Hình trên là một đoạn mã được trích từ tệp cấu hình META-INF/spring.factories trong gói phụ thuộc autoconfigure của Spring Boot, nó giải thích rõ vấn đề.</p><p>Vì vậy, &quot;hiệp sĩ ma thuật&quot; tự động cấu hình của <strong>@EnableAutoConfiguration</strong> trở thành: <strong>Tìm kiếm tất cả các tệp cấu hình META-INF/spring.factories trong classpath và sử dụng Java Reflection để khởi tạo các cấu hình IoC dưới dạng JavaConfig đã được đánh dấu @Configuration, sau đó tổng hợp chúng thành một và tải vào IoC Container.</strong></p>`,65)]))}const e=s(h,[["render",l],["__file","springboot-fundamentals.html.vue"]]),B=JSON.parse('{"path":"/framework/spring/overview/springboot-fundamentals.html","title":"SpringBoot Fundamentals","lang":"en-US","frontmatter":{"title":"SpringBoot Fundamentals","tags":["spring","springboot","java","backend"],"categories":["spring","springboot","java","backend"],"date created":"2023-07-26T00:00:00.000Z","date modified":"20243-2071-26","order":3,"description":"Nguyên lý cơ bản của Spring Boot Spring Boot đã tự động cấu hình cho chúng ta, thật tiện lợi và nhanh chóng, nhưng tôi vẫn không hiểu rõ về nguyên lý khởi động bên trong nó. Lần...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/framework/spring/overview/springboot-fundamentals.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"SpringBoot Fundamentals"}],["meta",{"property":"og:description","content":"Nguyên lý cơ bản của Spring Boot Spring Boot đã tự động cấu hình cho chúng ta, thật tiện lợi và nhanh chóng, nhưng tôi vẫn không hiểu rõ về nguyên lý khởi động bên trong nó. Lần..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:image","content":"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230726003902.png"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-28T15:54:38.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"spring"}],["meta",{"property":"article:tag","content":"springboot"}],["meta",{"property":"article:tag","content":"java"}],["meta",{"property":"article:tag","content":"backend"}],["meta",{"property":"article:modified_time","content":"2024-06-28T15:54:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"SpringBoot Fundamentals\\",\\"image\\":[\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230726003902.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230726003925.png\\",\\"https://raw.githubusercontent.com/vanhung4499/images/master/snap/20230726004006.png\\",\\"https://upload-images.jianshu.io/upload_images/6430208-fcdfcb56828a015a?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp\\"],\\"dateModified\\":\\"2024-06-28T15:54:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"Bí mật sau @SpringBootApplication","slug":"bi-mat-sau-springbootapplication","link":"#bi-mat-sau-springbootapplication","children":[]},{"level":2,"title":"@Configuration","slug":"configuration","link":"#configuration","children":[]},{"level":2,"title":"@ComponentScan","slug":"componentscan","link":"#componentscan","children":[]},{"level":2,"title":"@EnableAutoConfiguration","slug":"enableautoconfiguration","link":"#enableautoconfiguration","children":[{"level":3,"title":"Nhân vật hậu trường của tự động cấu hình: SpringFactoriesLoader","slug":"nhan-vat-hau-truong-cua-tu-đong-cau-hinh-springfactoriesloader","link":"#nhan-vat-hau-truong-cua-tu-đong-cau-hinh-springfactoriesloader","children":[]}]}],"git":{"createdTime":1719590078000,"updatedTime":1719590078000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":6.84,"words":2052},"filePathRelative":"framework/spring/overview/springboot-fundamentals.md","localizedDate":"June 28, 2024","excerpt":"\\n<p>Spring Boot đã tự động cấu hình cho chúng ta, thật tiện lợi và nhanh chóng, nhưng tôi vẫn không hiểu rõ về nguyên lý khởi động bên trong nó. Lần này, chúng ta sẽ từng bước khám phá bí mật của Spring Boot và làm cho nó không còn bí ẩn nữa.</p>\\n<hr>\\n<div class=\\"language-java\\" data-highlighter=\\"shiki\\" data-ext=\\"java\\" data-title=\\"java\\" style=\\"--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34\\"><pre class=\\"shiki shiki-themes one-dark-pro one-dark-pro vp-code\\"><code><span class=\\"line\\"><span style=\\"--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF\\">@</span><span style=\\"--shiki-light:#E5C07B;--shiki-dark:#E5C07B\\">SpringBootApplication</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#C678DD;--shiki-dark:#C678DD\\">public</span><span style=\\"--shiki-light:#C678DD;--shiki-dark:#C678DD\\"> class</span><span style=\\"--shiki-light:#E5C07B;--shiki-dark:#E5C07B\\"> Application</span><span style=\\"--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF\\"> {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#C678DD;--shiki-dark:#C678DD\\">    public</span><span style=\\"--shiki-light:#C678DD;--shiki-dark:#C678DD\\"> static</span><span style=\\"--shiki-light:#C678DD;--shiki-dark:#C678DD\\"> void</span><span style=\\"--shiki-light:#61AFEF;--shiki-dark:#61AFEF\\"> main</span><span style=\\"--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF\\">(</span><span style=\\"--shiki-light:#E5C07B;--shiki-dark:#E5C07B\\">String</span><span style=\\"--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF\\">[] </span><span style=\\"--shiki-light:#E06C75;--shiki-dark:#E06C75;--shiki-light-font-style:italic;--shiki-dark-font-style:italic\\">args</span><span style=\\"--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF\\">)</span><span style=\\"--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF\\"> {</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#E5C07B;--shiki-dark:#E5C07B\\">        SpringApplication</span><span style=\\"--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF\\">.</span><span style=\\"--shiki-light:#61AFEF;--shiki-dark:#61AFEF\\">run</span><span style=\\"--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF\\">(</span><span style=\\"--shiki-light:#E5C07B;--shiki-dark:#E5C07B\\">Application</span><span style=\\"--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF\\">.</span><span style=\\"--shiki-light:#E5C07B;--shiki-dark:#E5C07B\\">class</span><span style=\\"--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF\\">, args);</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF\\">    }</span></span>\\n<span class=\\"line\\"><span style=\\"--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF\\">}</span></span></code></pre>\\n</div>","autoDesc":true}');export{e as comp,B as data};
