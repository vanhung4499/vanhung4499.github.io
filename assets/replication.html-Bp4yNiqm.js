import{_ as i,r as t,o as a,c as e,b as c,d as h}from"./app-D5FncmNl.js";const o={},s=h('<h1 id="redis-replication" tabindex="-1"><a class="header-anchor" href="#redis-replication"><span>Redis Replication</span></a></h1><blockquote><p>Trong Redis,Â <strong>cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nhÂ <code>SLAVEOF</code>Â hoáº·c cÃ i Ä‘áº·t tÃ¹y chá»nÂ <code>slaveof</code>Â Ä‘á»ƒ sao chÃ©p (replicate) má»™t mÃ¡y chá»§ tá»« má»™t mÃ¡y chá»§ khÃ¡c</strong>, trong Ä‘Ã³ mÃ¡y chá»§ sau Ä‘Æ°á»£c gá»i lÃ  mÃ¡y chá»§ chÃ­nh (master) vÃ  mÃ¡y chá»§ trÆ°á»›c Ä‘Æ°á»£c gá»i lÃ  mÃ¡y chá»§ phá»¥ (slave).</p><p>Sao chÃ©p Redis trÆ°á»›c phiÃªn báº£n 2.8 khÃ´ng xá»­ lÃ½ hiá»‡u quáº£ viá»‡c sao chÃ©p láº¡i sau khi máº¥t káº¿t ná»‘i, vÃ  má»™t sá»‘ cáº­p nháº­t sau Ä‘Ã³ cá»§a Redis Ä‘Ã£ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y.</p></blockquote><h2 id="_1-gioi-thieu-ve-sao-chep" tabindex="-1"><a class="header-anchor" href="#_1-gioi-thieu-ve-sao-chep"><span>1. Giá»›i thiá»‡u vá» sao chÃ©p</span></a></h2><p>Redis sá»­ dá»¥ng lá»‡nhÂ <code>slaveof host port</code>Â Ä‘á»ƒ biáº¿n má»™t mÃ¡y chá»§ thÃ nh mÃ¡y chá»§ phá»¥ (slave) cá»§a má»™t mÃ¡y chá»§ khÃ¡c (master).</p><p><strong>Má»™t mÃ¡y chá»§ chÃ­nh (master) cÃ³ thá»ƒ cÃ³ nhiá»u mÃ¡y chá»§ phá»¥ (slave)</strong>. KhÃ´ng chá»‰ mÃ¡y chá»§ chÃ­nh cÃ³ thá»ƒ cÃ³ mÃ¡y chá»§ phá»¥, mÃ  mÃ¡y chá»§ phá»¥ cÅ©ng cÃ³ thá»ƒ cÃ³ mÃ¡y chá»§ phá»¥ riÃªng cá»§a mÃ¬nh, vÃ  nhiá»u mÃ¡y chá»§ phá»¥ cÃ³ thá»ƒ táº¡o thÃ nh má»™t chuá»—i chÃ­nh-phá»¥.</p><p><strong>Má»™t mÃ¡y chá»§ chá»‰ cÃ³ thá»ƒ cÃ³ má»™t mÃ¡y chá»§ chÃ­nh vÃ  khÃ´ng há»— trá»£ sao chÃ©p giá»¯a cÃ¡c mÃ¡y chá»§ chÃ­nh.</strong>.</p><p>CÃ³ thá»ƒ sá»­ dá»¥ng chá»©c nÄƒng sao chÃ©p Ä‘á»ƒ giÃºp mÃ¡y chá»§ chÃ­nh khÃ´ng cáº§n thá»±c hiá»‡n hoáº¡t Ä‘á»™ng bá»n vá»¯ng: Chá»‰ cáº§n táº¯t chá»©c nÄƒng bá»n vá»¯ng trÃªn mÃ¡y chá»§ chÃ­nh, sau Ä‘Ã³ cho phÃ©p mÃ¡y chá»§ phá»¥ thá»±c hiá»‡n hoáº¡t Ä‘á»™ng bá»n vá»¯ng.</p><p>Trong cÃ i Ä‘áº·t sá»­ dá»¥ng chá»©c nÄƒng sao chÃ©p cá»§a Redis, ráº¥t khuyáº¿n nghá»‹ báº­t tÃ­nh bá»n vá»¯ng trÃªn cáº£ master vÃ  slave. Khi khÃ´ng báº­t tÃ­nh nÄƒng nÃ y, vÃ­ dá»¥ nhÆ° gáº·p váº¥n Ä‘á» trá»… do hiá»‡u suáº¥t á»• cá»©ng ráº¥t cháº­m, <strong>báº¡n nÃªn cáº¥u hÃ¬nh cÃ¡c phiÃªn báº£n Ä‘á»ƒ trÃ¡nh tá»± Ä‘á»™ng khá»Ÿi Ä‘á»™ng láº¡i sau khi thiáº¿t láº­p láº¡i</strong>.</p><p>Ká»ƒ tá»« phiÃªn báº£n Redis 2.6, mÃ¡y chá»§ phá»¥ há»— trá»£ cháº¿ Ä‘á»™ chá»‰ Ä‘á»c vÃ  cháº¿ Ä‘á»™ nÃ y lÃ  cháº¿ Ä‘á»™ máº·c Ä‘á»‹nh cá»§a mÃ¡y chá»§ phá»¥.</p><ul><li>Cháº¿ Ä‘á»™ chá»‰ Ä‘á»c Ä‘Æ°á»£c Ä‘iá»u khiá»ƒn báº±ng tÃ¹y chá»nÂ <code>slave-read-only</code>Â trong tá»‡pÂ <code>redis.conf</code>, vÃ  cÅ©ng cÃ³ thá»ƒ Ä‘Æ°á»£c báº­t hoáº·c táº¯t cháº¿ Ä‘á»™ nÃ y báº±ng lá»‡nhÂ <a href="http://redisdoc.com/configure/config_set.html#config-set" target="_blank" rel="noopener noreferrer">CONFIG SET parameter value</a>.</li><li>MÃ¡y chá»§ phá»¥ chá»‰ Ä‘á»c sáº½ tá»« chá»‘i thá»±c hiá»‡n báº¥t ká»³ lá»‡nh ghi nÃ o, do Ä‘Ã³ khÃ´ng cÃ³ trÆ°á»ng há»£p dá»¯ liá»‡u Ä‘Æ°á»£c ghi vÃ o mÃ¡y chá»§ phá»¥ vÃ¬ lá»—i thao tÃ¡c.</li></ul><h2 id="_2-sao-chep-phien-ban-cu" tabindex="-1"><a class="header-anchor" href="#_2-sao-chep-phien-ban-cu"><span>2. Sao chÃ©p phiÃªn báº£n cÅ©</span></a></h2><blockquote><p>CÃ¡ch triá»ƒn khai sao chÃ©p trÆ°á»›c phiÃªn báº£n Redis 2.8: Lá»‡nhÂ <code>SYNC</code></p></blockquote><p>Chá»©c nÄƒng sao chÃ©p Redis Ä‘Æ°á»£c chia thÃ nh hai hoáº¡t Ä‘á»™ng: Ä‘á»“ng bá»™ hÃ³a (sync) vÃ  truyá»n lá»‡nh (command propagate):</p><ul><li><strong><code>Äá»“ng bá»™ hÃ³a (sync)</code></strong>Â - ÄÆ°á»£c sá»­ dá»¥ng Ä‘á»ƒ cáº­p nháº­t tráº¡ng thÃ¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a mÃ¡y chá»§ phá»¥ vá»›i tráº¡ng thÃ¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u hiá»‡n táº¡i cá»§a mÃ¡y chá»§ chÃ­nh.</li><li><strong><code>Truyá»n lá»‡nh (command propagate)</code></strong>Â - Khi tráº¡ng thÃ¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a mÃ¡y chá»§ chÃ­nh Ä‘Æ°á»£c sá»­a Ä‘á»•i, dáº«n Ä‘áº¿n tráº¡ng thÃ¡i khÃ´ng nháº¥t quÃ¡n giá»¯a cÆ¡ sá»Ÿ dá»¯ liá»‡u chÃ­nh vÃ  phá»¥, cho phÃ©p cÆ¡ sá»Ÿ dá»¯ liá»‡u chÃ­nh vÃ  phá»¥ trá»Ÿ láº¡i tráº¡ng thÃ¡i nháº¥t quÃ¡n.</li></ul><h3 id="Ä‘ong-bo-hoa" tabindex="-1"><a class="header-anchor" href="#Ä‘ong-bo-hoa"><span>Äá»“ng bá»™ hÃ³a</span></a></h3><p>CÃ¡c bÆ°á»›c thá»±c hiá»‡n lá»‡nhÂ <code>SYNC</code>:</p><ol><li>MÃ¡y chá»§ phá»¥ gá»­i lá»‡nhÂ <code>SYNC</code>Â Ä‘áº¿n mÃ¡y chá»§ chÃ­nh.</li><li>MÃ¡y chá»§ chÃ­nh nháº­n lá»‡nhÂ <code>SYNC</code>Â vÃ  thá»±c hiá»‡n lá»‡nhÂ <code>BGSAVE</code>Â Ä‘á»ƒ táº¡o tá»‡p RDB trong ná»n vÃ  sá»­ dá»¥ng má»™t bá»™ Ä‘á»‡m Ä‘á»ƒ ghi láº¡i táº¥t cáº£ cÃ¡c lá»‡nh ghi Ä‘Æ°á»£c thá»±c hiá»‡n tá»« thá»i Ä‘iá»ƒm nÃ y trá»Ÿ Ä‘i.</li><li>Sau khi mÃ¡y chá»§ chÃ­nh hoÃ n thÃ nh lá»‡nhÂ <code>BGSAVE</code>, mÃ¡y chá»§ chÃ­nh sáº½ gá»­i tá»‡p RDB Ä‘Ã£ táº¡o cho mÃ¡y chá»§ phá»¥. MÃ¡y chá»§ phá»¥ nháº­n vÃ  táº£i tá»‡p RDB, cáº­p nháº­t tráº¡ng thÃ¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a mÃ¬nh.</li><li>MÃ¡y chá»§ chÃ­nh gá»­i táº¥t cáº£ cÃ¡c lá»‡nh ghi Ä‘Æ°á»£c ghi láº¡i trong bá»™ Ä‘á»‡m cho mÃ¡y chá»§ phá»¥. MÃ¡y chá»§ phá»¥ thá»±c hiá»‡n cÃ¡c lá»‡nh ghi nÃ y, cáº­p nháº­t tráº¡ng thÃ¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a mÃ¬nh.</li></ol>',17),l=h('<h3 id="truyen-lenh" tabindex="-1"><a class="header-anchor" href="#truyen-lenh"><span>Truyá»n lá»‡nh</span></a></h3><p>Sau khi hoÃ n thÃ nh hoáº¡t Ä‘á»™ng Ä‘á»“ng bá»™ hÃ³a, tráº¡ng thÃ¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a mÃ¡y chá»§ chÃ­nh vÃ  phá»¥ sáº½ trá»Ÿ nÃªn nháº¥t quÃ¡n. Má»—i khi mÃ¡y chá»§ chÃ­nh thá»±c hiá»‡n má»™t lá»‡nh ghi Ä‘Æ°á»£c gá»­i tá»« khÃ¡ch hÃ ng, tráº¡ng thÃ¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a mÃ¡y chá»§ chÃ­nh vÃ  phá»¥ khÃ´ng cÃ²n nháº¥t quÃ¡n. Cáº§n gá»­i cÃ¡c lá»‡nh ghi cho mÃ¡y chá»§ phá»¥ Ä‘á»ƒ thá»±c hiá»‡n, Ä‘áº£m báº£o tráº¡ng thÃ¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a cáº£ hai trá»Ÿ láº¡i nháº¥t quÃ¡n.</p><h3 id="nhuoc-Ä‘iem-cua-sao-chep-phien-ban-cu" tabindex="-1"><a class="header-anchor" href="#nhuoc-Ä‘iem-cua-sao-chep-phien-ban-cu"><span>NhÆ°á»£c Ä‘iá»ƒm cá»§a sao chÃ©p phiÃªn báº£n cÅ©</span></a></h3><p>CÃ³ hai trÆ°á»ng há»£p khi sao chÃ©p tá»« mÃ¡y chá»§ chÃ­nh sang mÃ¡y chá»§ phá»¥:</p><ul><li><strong>Sao chÃ©p láº§n Ä‘áº§u</strong>Â - MÃ¡y chá»§ phá»¥ chÆ°a tá»«ng sao chÃ©p mÃ¡y chá»§ chÃ­nh trÆ°á»›c Ä‘Ã³.</li><li><strong>Sao chÃ©p sau khi máº¥t káº¿t ná»‘i</strong>Â - MÃ¡y chá»§ phá»¥ vÃ  mÃ¡y chá»§ chÃ­nh trong quÃ¡ trÃ¬nh truyá»n lá»‡nh bá»‹ máº¥t káº¿t ná»‘i do váº¥n Ä‘á» máº¡ng, sau khi mÃ¡y chá»§ phá»¥ káº¿t ná»‘i láº¡i vá»›i mÃ¡y chá»§ chÃ­nh, tiáº¿p tá»¥c sao chÃ©p tá»« mÃ¡y chá»§ chÃ­nh.</li></ul><p>Äá»‘i vá»›i sao chÃ©p láº§n Ä‘áº§u, chá»©c nÄƒng sao chÃ©p phiÃªn báº£n cÅ© hoáº¡t Ä‘á»™ng tá»‘t; tuy nhiÃªn,Â <strong>Ä‘á»‘i vá»›i sao chÃ©p sau khi máº¥t káº¿t ná»‘i, hiá»‡u suáº¥t ráº¥t tháº¥p do viá»‡c táº¡o vÃ  truyá»n RDB má»—i láº§n</strong>.</p><blockquote><p>ğŸ”” LÆ°u Ã½:Â <strong>Lá»‡nh SYNC lÃ  má»™t hoáº¡t Ä‘á»™ng tá»‘n nhiá»u tÃ i nguyÃªn</strong>.</p><ul><li>MÃ¡y chá»§ chÃ­nh thá»±c hiá»‡n lá»‡nhÂ <code>BGSAVE</code>Â Ä‘á»ƒ táº¡o tá»‡p RDB, hoáº¡t Ä‘á»™ng nÃ y tá»‘n nhiá»u tÃ i nguyÃªn CPU, bá»™ nhá»› vÃ  I/O Ä‘Ä©a cá»§a mÃ¡y chá»§ chÃ­nh.</li><li>MÃ¡y chá»§ chÃ­nh truyá»n tá»‡p RDB cho mÃ¡y chá»§ phá»¥, hoáº¡t Ä‘á»™ng nÃ y tá»‘n nhiá»u tÃ i nguyÃªn máº¡ng cá»§a cáº£ mÃ¡y chá»§ chÃ­nh vÃ  phá»¥ vÃ  áº£nh hÆ°á»Ÿng Ä‘áº¿n thá»i gian pháº£n há»“i cá»§a mÃ¡y chá»§ chÃ­nh.</li><li>Trong quÃ¡ trÃ¬nh mÃ¡y chá»§ phá»¥ táº£i tá»‡p RDB, cÃ¡c lá»‡nh yÃªu cáº§u khÃ¡c bá»‹ cháº·n.</li></ul></blockquote><h2 id="_3-sao-chep-phien-ban-moi" tabindex="-1"><a class="header-anchor" href="#_3-sao-chep-phien-ban-moi"><span>3. Sao chÃ©p phiÃªn báº£n má»›i</span></a></h2><blockquote><p>CÃ¡ch triá»ƒn khai má»›i sau phiÃªn báº£n Redis 2.8: Sá»­ dá»¥ng lá»‡nhÂ <code>PSYNC</code>Â thay tháº¿ lá»‡nhÂ <code>SYNC</code>.</p></blockquote><p>Lá»‡nhÂ <code>PSYNC</code>Â cÃ³ hai cháº¿ Ä‘á»™: Ä‘á»“ng bá»™ hoÃ n toÃ n (full resynchronization) vÃ  Ä‘á»“ng bá»™ má»™t pháº§n (partial resynchronization):</p><ul><li><strong><code>Äá»“ng bá»™ hoÃ n toÃ n (full resynchronization)</code></strong>Â - ÄÆ°á»£c sá»­ dá»¥ng cho sao chÃ©p láº§n Ä‘áº§u. CÃ¡c bÆ°á»›c thá»±c hiá»‡n tÆ°Æ¡ng tá»± nhÆ° lá»‡nhÂ <code>SYNC</code>.</li><li><strong><code>Äá»“ng bá»™ má»™t pháº§n (partial resynchronization)</code></strong>Â - ÄÆ°á»£c sá»­ dá»¥ng cho sao chÃ©p sau khi máº¥t káº¿t ná»‘i.Â <strong>Náº¿u Ä‘iá»u kiá»‡n cho phÃ©p, mÃ¡y chá»§ chÃ­nh cÃ³ thá»ƒ gá»­i cÃ¡c lá»‡nh ghi Ä‘Æ°á»£c thá»±c hiá»‡n trong quÃ¡ trÃ¬nh ngáº¯t káº¿t ná»‘i cho mÃ¡y chá»§ phá»¥</strong>, mÃ¡y chá»§ phá»¥ chá»‰ cáº§n nháº­n vÃ  thá»±c hiá»‡n cÃ¡c lá»‡nh ghi nÃ y Ä‘á»ƒ duy trÃ¬ tráº¡ng thÃ¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a mÃ¡y chá»§ chÃ­nh vÃ  phá»¥ nháº¥t quÃ¡n.</li></ul><h3 id="Ä‘ong-bo-mot-phan" tabindex="-1"><a class="header-anchor" href="#Ä‘ong-bo-mot-phan"><span>Äá»“ng bá»™ má»™t pháº§n</span></a></h3><p>Chá»©c nÄƒng Ä‘á»“ng bá»™ má»™t pháº§n bao gá»“m ba pháº§n:</p><ul><li><strong>Offset sao chÃ©p</strong>Â cá»§a mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥.</li><li><strong>Bá»™ Ä‘á»‡m chá» sao chÃ©p</strong>Â cá»§a mÃ¡y chá»§ chÃ­nh.</li><li><strong>ID cháº¡y cá»§a mÃ¡y chá»§</strong>.</li></ul><h4 id="offset-sao-chep" tabindex="-1"><a class="header-anchor" href="#offset-sao-chep"><span>Offset sao chÃ©p</span></a></h4><p>MÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥ sáº½ duy trÃ¬ má»™t offset sao chÃ©p riÃªng biá»‡t.</p><ul><li>Náº¿u offset sao chÃ©p cá»§a mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥ giá»‘ng nhau, Ä‘iá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  tráº¡ng thÃ¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a hai mÃ¡y chá»§ lÃ  nháº¥t quÃ¡n;</li><li>NgÆ°á»£c láº¡i, náº¿u offset sao chÃ©p khÃ´ng giá»‘ng nhau, Ä‘iá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  tráº¡ng thÃ¡i cÆ¡ sá»Ÿ dá»¯ liá»‡u cá»§a hai mÃ¡y chá»§ khÃ´ng nháº¥t quÃ¡n.</li></ul><h4 id="bo-Ä‘em-cho-sao-chep" tabindex="-1"><a class="header-anchor" href="#bo-Ä‘em-cho-sao-chep"><span>Bá»™ Ä‘á»‡m chá» sao chÃ©p</span></a></h4><p><strong>Bá»™ Ä‘á»‡m chá» sao chÃ©p lÃ  má»™t hÃ ng Ä‘á»£i FIFO cÃ³ Ä‘á»™ dÃ i cá»‘ Ä‘á»‹nh Ä‘Æ°á»£c duy trÃ¬ bá»Ÿi mÃ¡y chá»§ chÃ­nh</strong>, kÃ­ch thÆ°á»›c máº·c Ä‘á»‹nh lÃ Â <code>1MB</code>.</p><p>Bá»™ Ä‘á»‡m chá» sao chÃ©p sáº½ lÆ°u trá»¯ má»™t pháº§n lá»‡nh ghi gáº§n Ä‘Ã¢y Ä‘Ã£ truyá»n vÃ  bá»™ Ä‘á»‡m chá» sao chÃ©p sáº½ ghi láº¡i offset sao chÃ©p tÆ°Æ¡ng á»©ng cho má»—i byte trong hÃ ng Ä‘á»£i.</p><p>Khi mÃ¡y chá»§ phá»¥ káº¿t ná»‘i láº¡i vá»›i mÃ¡y chá»§ chÃ­nh sau khi máº¥t káº¿t ná»‘i, mÃ¡y chá»§ phá»¥ sáº½ gá»­i lá»‡nhÂ <code>PSYNC</code>Â vá»›i offset sao chÃ©p cá»§a chÃ­nh nÃ³ cho mÃ¡y chá»§ chÃ­nh, mÃ¡y chá»§ chÃ­nh sáº½ dá»±a trÃªn offset nÃ y Ä‘á»ƒ quyáº¿t Ä‘á»‹nh thá»±c hiá»‡n hoáº¡t Ä‘á»™ng Ä‘á»“ng bá»™ nÃ o vá»›i mÃ¡y chá»§ phá»¥.</p><ul><li>Náº¿u dá»¯ liá»‡u sau offset váº«n cÃ²n trong bá»™ Ä‘á»‡m chá» sao chÃ©p, mÃ¡y chá»§ chÃ­nh sáº½ thá»±c hiá»‡n Ä‘á»“ng bá»™ má»™t pháº§n vá»›i mÃ¡y chá»§ phá»¥.</li><li>NgÆ°á»£c láº¡i, mÃ¡y chá»§ chÃ­nh sáº½ thá»±c hiá»‡n Ä‘á»“ng bá»™ hoÃ n toÃ n vá»›i mÃ¡y chá»§ phá»¥.</li></ul><blockquote><p>ğŸ”” LÆ°u Ã½:Â <strong>Äiá»u chá»‰nh kÃ­ch thÆ°á»›c bá»™ Ä‘á»‡m chá» sao chÃ©p má»™t cÃ¡ch há»£p lÃ½</strong></p><ul><li><p>KÃ­ch thÆ°á»›c máº·c Ä‘á»‹nh cá»§a bá»™ Ä‘á»‡m chá» sao chÃ©p Redis lÃ Â <code>1MB</code>.</p></li><li><p>KÃ­ch thÆ°á»›c tá»‘i thiá»ƒu cá»§a bá»™ Ä‘á»‡m chá» sao chÃ©p cÃ³ thá»ƒ Ä‘Æ°á»£c Æ°á»›c tÃ­nh báº±ng cÃ´ng thá»©cÂ <code>second * write_size_per_second</code>.</p></li></ul></blockquote><h4 id="id-chay-cua-may-chu" tabindex="-1"><a class="header-anchor" href="#id-chay-cua-may-chu"><span>ID cháº¡y cá»§a mÃ¡y chá»§</span></a></h4><ul><li>Má»—i mÃ¡y chá»§ Redis cÃ³ má»™t ID cháº¡y Ä‘á»ƒ xÃ¡c Ä‘á»‹nh duy nháº¥t.</li><li>ID cháº¡y Ä‘Æ°á»£c táº¡o tá»± Ä‘á»™ng khi mÃ¡y chá»§ khá»Ÿi Ä‘á»™ng, bao gá»“m 40 kÃ½ tá»± tháº­p lá»¥c phÃ¢n ngáº«u nhiÃªn. VÃ­ dá»¥: 132e358005e29741f8d7b0a42d666aace286edda</li></ul><p>Khi mÃ¡y chá»§ phá»¥ sao chÃ©p láº§n Ä‘áº§u tá»« mÃ¡y chá»§ chÃ­nh, mÃ¡y chá»§ chÃ­nh sáº½ gá»­i ID cháº¡y cá»§a chÃ­nh nÃ³ cho mÃ¡y chá»§ phá»¥ vÃ  mÃ¡y chá»§ phá»¥ sáº½ lÆ°u trá»¯ ID cháº¡y nÃ y.</p><p>Khi mÃ¡y chá»§ phá»¥ káº¿t ná»‘i láº¡i vá»›i mÃ¡y chá»§ chÃ­nh, mÃ¡y chá»§ phá»¥ sáº½ gá»­i ID cháº¡y Ä‘Ã£ lÆ°u trá»¯ trÆ°á»›c Ä‘Ã³:</p><ul><li>Náº¿u ID cháº¡y Ä‘Ã£ lÆ°u trá»¯ vÃ  ID cháº¡y hiá»‡n táº¡i cá»§a mÃ¡y chá»§ chÃ­nh giá»‘ng nhau, Ä‘iá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  mÃ¡y chá»§ phá»¥ Ä‘Ã£ káº¿t ná»‘i vá»›i mÃ¡y chá»§ chÃ­nh trÆ°á»›c Ä‘Ã³, mÃ¡y chá»§ chÃ­nh sáº½ tiáº¿p tá»¥c thá»­ nghiá»‡m Ä‘á»“ng bá»™ má»™t pháº§n;</li><li>NgÆ°á»£c láº¡i, náº¿u ID cháº¡y khÃ´ng khá»›p, Ä‘iá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  mÃ¡y chá»§ phá»¥ khÃ´ng káº¿t ná»‘i vá»›i mÃ¡y chá»§ chÃ­nh trÆ°á»›c Ä‘Ã³, mÃ¡y chá»§ chÃ­nh sáº½ thá»±c hiá»‡n Ä‘á»“ng bá»™ hoÃ n toÃ n vá»›i mÃ¡y chá»§ phá»¥.</li></ul><h3 id="lenh-psync" tabindex="-1"><a class="header-anchor" href="#lenh-psync"><span>Lá»‡nh PSYNC</span></a></h3><p>Sau khi hiá»ƒu cÃ¡ch triá»ƒn khai Ä‘á»“ng bá»™ má»™t pháº§n, viá»‡c hiá»ƒu cÃ¡ch thá»±c hiá»‡n lá»‡nh PSYNC sáº½ dá»… dÃ ng hÆ¡n, nguyÃªn táº¯c hoáº¡t Ä‘á»™ng cÆ¡ báº£n cá»§a nÃ³ nhÆ° sau:</p><p>Khi mÃ¡y chá»§ phá»¥ nháº­n Ä‘Æ°á»£c lá»‡nhÂ <code>SLAVEOF</code>, trÆ°á»›c tiÃªn kiá»ƒm tra xem mÃ¡y chá»§ phá»¥ Ä‘Ã£ sao chÃ©p tá»« mÃ¡y chá»§ trÆ°á»›c Ä‘Ã³ hay chÆ°a.</p><ul><li>Náº¿u mÃ¡y chá»§ phá»¥ chÆ°a sao chÃ©p tá»« báº¥t ká»³ mÃ¡y chá»§ chÃ­nh nÃ o trÆ°á»›c Ä‘Ã³, nÃ³ sáº½ gá»­i lá»‡nhÂ <code>PSYNC ? -1</code>Â Ä‘áº¿n mÃ¡y chá»§ chÃ­nh, yÃªu cáº§u Ä‘á»“ng bá»™ hoÃ n toÃ n.</li><li>NgÆ°á»£c láº¡i, nÃ³ sáº½ gá»­i lá»‡nhÂ <code>PSYNC &lt;runid&gt; &lt;offset&gt;</code>Â Ä‘áº¿n mÃ¡y chá»§ chÃ­nh. <ul><li><code>runid</code>Â lÃ  ID cháº¡y cá»§a mÃ¡y chá»§ chÃ­nh trong láº§n sao chÃ©p trÆ°á»›c Ä‘Ã³.</li><li><code>offset</code>Â lÃ  offset sao chÃ©p.</li></ul></li></ul><p>MÃ¡y chá»§ chÃ­nh nháº­n Ä‘Æ°á»£c lá»‡nhÂ <code>PSYNC &lt;runid&gt; &lt;offset&gt;</code>Â sáº½ thá»±c hiá»‡n phÃ¢n tÃ­ch:</p><ul><li>Náº¿u <strong>ID cháº¡y cá»§a mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥ giá»‘ng nhau vÃ  offset Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh váº«n cÃ²n hiá»‡u lá»±c trong bá»™ Ä‘á»‡m chá» sao chÃ©p</strong>, Ä‘iá»u Ä‘Ã³ cÃ³ nghÄ©a lÃ  mÃ¡y chá»§ chÃ­nh sáº½ tiáº¿p tá»¥c thá»±c hiá»‡n Ä‘á»“ng bá»™ má»™t pháº§n vá»›i mÃ¡y chá»§ phá»¥.</li><li>Náº¿u khÃ´ng thá»a mÃ£n má»™t trong hai Ä‘iá»u kiá»‡n trÃªn, mÃ¡y chá»§ chÃ­nh sáº½ thá»±c hiá»‡n Ä‘á»“ng bá»™ toÃ n bá»™ vá»›i mÃ¡y chá»§ phá»¥.</li></ul>',34),p=h(`<h2 id="_4-kiem-tra-nhip-tim" tabindex="-1"><a class="header-anchor" href="#_4-kiem-tra-nhip-tim"><span>4. Kiá»ƒm tra nhá»‹p tim</span></a></h2><p>Trong giai Ä‘oáº¡n <strong>truyá»n lá»‡nh</strong>, mÃ¡y chá»§ tá»« xa máº·c Ä‘á»‹nh sáº½ gá»­i lá»‡nh Ä‘áº¿n mÃ¡y chá»§ chÃ­nh má»™t láº§n má»—i giÃ¢y:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>REPLCONF ACK &lt;replication_offset&gt;</span></span></code></pre></div><p>Trong Ä‘Ã³, <code>replication_offset</code> lÃ  vá»‹ trÃ­ sao chÃ©p hiá»‡n táº¡i cá»§a mÃ¡y chá»§ tá»« xa.</p><p>Gá»­i lá»‡nh <code>REPLCONF ACK</code> cÃ³ ba tÃ¡c dá»¥ng Ä‘á»‘i vá»›i mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥:</p><ul><li>Kiá»ƒm tra tráº¡ng thÃ¡i káº¿t ná»‘i máº¡ng giá»¯a mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥.</li><li>Há»— trá»£ thá»±c hiá»‡n tÃ¹y chá»n min-slaves.</li><li>Kiá»ƒm tra viá»‡c máº¥t lá»‡nh.</li></ul><h3 id="kiem-tra-trang-thai-ket-noi-giua-may-chu-chinh-va-may-chu-phu" tabindex="-1"><a class="header-anchor" href="#kiem-tra-trang-thai-ket-noi-giua-may-chu-chinh-va-may-chu-phu"><span>Kiá»ƒm tra tráº¡ng thÃ¡i káº¿t ná»‘i giá»¯a mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥</span></a></h3><p><strong>CÃ³ thá»ƒ kiá»ƒm tra xem káº¿t ná»‘i máº¡ng giá»¯a mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥ cÃ³ bÃ¬nh thÆ°á»ng hay khÃ´ng</strong> báº±ng cÃ¡ch gá»­i vÃ  nháº­n lá»‡nh <code>REPLCONF ACK</code>: Náº¿u mÃ¡y chá»§ chÃ­nh khÃ´ng nháº­n Ä‘Æ°á»£c lá»‡nh <code>REPLCONF ACK</code> tá»« mÃ¡y chá»§ phá»¥ trong hÆ¡n má»™t giÃ¢y, mÃ¡y chá»§ chÃ­nh sáº½ biáº¿t ráº±ng cÃ³ váº¥n Ä‘á» vá» káº¿t ná»‘i giá»¯a mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥.</p><p>CÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh <code>INFO replication</code> Ä‘á»ƒ gá»­i Ä‘áº¿n mÃ¡y chá»§ chÃ­nh vÃ  xem trong cá»™t lag cá»§a danh sÃ¡ch mÃ¡y chá»§ phá»¥, thá»i gian Ä‘Ã£ trÃ´i qua ká»ƒ tá»« khi mÃ¡y chá»§ phá»¥ gá»­i lá»‡nh <code>REPLCONF ACK</code> Ä‘áº¿n mÃ¡y chá»§ chÃ­nh.</p><h3 id="ho-tro-thuc-hien-tuy-chon-min-slaves" tabindex="-1"><a class="header-anchor" href="#ho-tro-thuc-hien-tuy-chon-min-slaves"><span>Há»— trá»£ thá»±c hiá»‡n tÃ¹y chá»n min-slaves</span></a></h3><p>TÃ¹y chá»n <code>min-slaves-to-write</code> vÃ  <code>min-slaves-max-lag</code> trong Redis giÃºp ngÄƒn mÃ¡y chá»§ chÃ­nh thá»±c hiá»‡n lá»‡nh ghi trong trÆ°á»ng há»£p khÃ´ng an toÃ n.</p><p>ã€VÃ­ dá»¥ã€‘Cáº¥u hÃ¬nh min-slaves</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>min-slaves-to-write 3</span></span>
<span class="line"><span>min-slaves-max-lag 10</span></span></code></pre></div><p>Cáº¥u hÃ¬nh trÃªn Ä‘áº¡i diá»‡n cho: Náº¿u sá»‘ lÆ°á»£ng mÃ¡y chá»§ phá»¥ nhá» hÆ¡n 3 hoáº·c Ä‘á»™ trá»… cá»§a ba mÃ¡y chá»§ phá»¥ lá»›n hÆ¡n hoáº·c báº±ng 10 giÃ¢y, mÃ¡y chá»§ chÃ­nh sáº½ tá»« chá»‘i thá»±c hiá»‡n lá»‡nh ghi.</p><h3 id="kiem-tra-viec-mat-lenh" tabindex="-1"><a class="header-anchor" href="#kiem-tra-viec-mat-lenh"><span>Kiá»ƒm tra viá»‡c máº¥t lá»‡nh</span></a></h3><p>Náº¿u do sá»± cá»‘ máº¡ng, cÃ¡c lá»‡nh ghi mÃ  mÃ¡y chá»§ chÃ­nh truyá»n cho mÃ¡y chá»§ phá»¥ bá»‹ máº¥t, khi mÃ¡y chá»§ phá»¥ gá»­i lá»‡nh <code>REPLCONF ACK</code> Ä‘á»‹nh ká»³ Ä‘áº¿n mÃ¡y chá»§ chÃ­nh, mÃ¡y chá»§ chÃ­nh sáº½ nháº­n ra ráº±ng vá»‹ trÃ­ sao chÃ©p cá»§a mÃ¡y chá»§ phá»¥ Ã­t hÆ¡n cá»§a chÃ­nh nÃ³. Sau Ä‘Ã³, mÃ¡y chá»§ chÃ­nh sáº½ tÃ¬m cÃ¡c dá»¯ liá»‡u mÃ  mÃ¡y chá»§ phá»¥ thiáº¿u trong bá»™ Ä‘á»‡m sao chÃ©p vÃ  gá»­i láº¡i cho mÃ¡y chá»§ phá»¥ dá»±a trÃªn vá»‹ trÃ­ sao chÃ©p mÃ  mÃ¡y chá»§ phá»¥ Ä‘Ã£ gá»­i.</p><h2 id="_5-quy-trinh-sao-chep" tabindex="-1"><a class="header-anchor" href="#_5-quy-trinh-sao-chep"><span>5. Quy trÃ¬nh sao chÃ©p</span></a></h2><p>Báº±ng cÃ¡ch gá»­i lá»‡nh SLAVEOF nhÆ° sau Ä‘áº¿n mÃ¡y chá»§ phá»¥, báº¡n cÃ³ thá»ƒ sao chÃ©p mÃ¡y chá»§ chÃ­nh.</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>SLAVEOF &lt;master_ip&gt; &lt;master_port&gt;</span></span></code></pre></div><h3 id="buoc-1-cau-hinh-may-chu-chinh-va-may-chu-phu" tabindex="-1"><a class="header-anchor" href="#buoc-1-cau-hinh-may-chu-chinh-va-may-chu-phu"><span>BÆ°á»›c 1. Cáº¥u hÃ¬nh mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥</span></a></h3><p>Cáº¥u hÃ¬nh mÃ¡y chá»§ phá»¥ ráº¥t Ä‘Æ¡n giáº£n, chá»‰ cáº§n thÃªm dÃ²ng sau vÃ o tá»‡p cáº¥u hÃ¬nh:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>slaveof 127.0.0.1 6379</span></span></code></pre></div><p>Táº¥t nhiÃªn, báº¡n cáº§n thay tháº¿ <code>127.0.0.1</code> vÃ  <code>6379</code> trong mÃ£ báº±ng IP vÃ  cá»•ng cá»§a mÃ¡y chá»§ chÃ­nh cá»§a báº¡n.</p><p>Má»™t cÃ¡ch khÃ¡c lÃ  sá»­ dá»¥ng lá»‡nh <a href="https://redis.io/commands/slaveof/" target="_blank" rel="noopener noreferrer">SLAVEOF host port</a>, nháº­p IP vÃ  cá»•ng cá»§a mÃ¡y chá»§ chÃ­nh, sau Ä‘Ã³ Ä‘á»“ng bá»™ hÃ³a sáº½ báº¯t Ä‘áº§u:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>127.0.0.1:6379&gt; SLAVEOF 127.0.0.1 10086</span></span>
<span class="line"><span>OK</span></span></code></pre></div><h3 id="buoc-2-thiet-lap-ket-noi-tcp-giua-may-chu-chinh-va-may-chu-phu" tabindex="-1"><a class="header-anchor" href="#buoc-2-thiet-lap-ket-noi-tcp-giua-may-chu-chinh-va-may-chu-phu"><span>BÆ°á»›c 2. Thiáº¿t láº­p káº¿t ná»‘i TCP giá»¯a mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥.</span></a></h3><h3 id="buoc-3-gui-ping-Ä‘e-kiem-tra-trang-thai-giao-tiep" tabindex="-1"><a class="header-anchor" href="#buoc-3-gui-ping-Ä‘e-kiem-tra-trang-thai-giao-tiep"><span>BÆ°á»›c 3. Gá»­i PING Ä‘á»ƒ kiá»ƒm tra tráº¡ng thÃ¡i giao tiáº¿p.</span></a></h3><h3 id="buoc-4-xac-thuc" tabindex="-1"><a class="header-anchor" href="#buoc-4-xac-thuc"><span>BÆ°á»›c 4. XÃ¡c thá»±c.</span></a></h3><p>Náº¿u mÃ¡y chá»§ chÃ­nh khÃ´ng thiáº¿t láº­p <code>requirepass</code>, mÃ¡y chá»§ phá»¥ khÃ´ng thiáº¿t láº­p <code>masterauth</code>, thÃ¬ khÃ´ng cáº§n xÃ¡c thá»±c; ngÆ°á»£c láº¡i, cáº§n xÃ¡c thá»±c. Náº¿u xÃ¡c thá»±c khÃ´ng thÃ nh cÃ´ng, quÃ¡ trÃ¬nh sao chÃ©p sáº½ bá»‹ há»§y bá».</p><p>Náº¿u mÃ¡y chá»§ chÃ­nh Ä‘Ã£ Ä‘áº·t máº­t kháº©u thÃ´ng qua tÃ¹y chá»n <code>requirepass</code>, Ä‘á»ƒ Ä‘áº£m báº£o quÃ¡ trÃ¬nh Ä‘á»“ng bá»™ hÃ³a mÃ¡y chá»§ phá»¥ diá»…n ra suÃ´n sáº», chÃºng ta cÅ©ng pháº£i thiáº¿t láº­p xÃ¡c thá»±c tÆ°Æ¡ng á»©ng cho mÃ¡y chá»§ phá»¥.</p><p>Äá»‘i vá»›i má»™t mÃ¡y chá»§ Ä‘ang cháº¡y, báº¡n cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh sau Ä‘Ã¢y trÃªn khÃ¡ch hÃ ng:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>config set masterauth &lt;password&gt;</span></span></code></pre></div><p>Äá»ƒ thiáº¿t láº­p máº­t kháº©u nÃ y vÄ©nh viá»…n, báº¡n cÃ³ thá»ƒ thÃªm nÃ³ vÃ o tá»‡p cáº¥u hÃ¬nh:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>masterauth &lt;password&gt;</span></span></code></pre></div><p>NgoÃ i ra, cÃ²n má»™t sá»‘ tÃ¹y chá»n khÃ¡c liÃªn quan Ä‘áº¿n bá»™ Ä‘á»‡m luá»“ng sao chÃ©p Ä‘Æ°á»£c sá»­ dá»¥ng khi mÃ¡y chá»§ chÃ­nh thá»±c hiá»‡n Ä‘á»“ng bá»™ hÃ³a má»™t pháº§n, chi tiáº¿t cÃ³ thá»ƒ tham kháº£o tá»‡p <code>redis.conf</code> Ä‘i kÃ¨m vá»›i mÃ£ nguá»“n Redis.</p><h3 id="buoc-5-gui-thong-tin-cong" tabindex="-1"><a class="header-anchor" href="#buoc-5-gui-thong-tin-cong"><span>BÆ°á»›c 5. Gá»­i thÃ´ng tin cá»•ng.</span></a></h3><p>mÃ¡y chá»§ phá»¥ thá»±c hiá»‡n <code>REPLCONF listening-port &lt;port-number&gt;</code>, gá»­i sá»‘ cá»•ng láº¯ng nghe cá»§a mÃ¡y chá»§ phá»¥ Ä‘áº¿n mÃ¡y chá»§ chÃ­nh.</p><h3 id="buoc-6-Ä‘ong-bo-hoa" tabindex="-1"><a class="header-anchor" href="#buoc-6-Ä‘ong-bo-hoa"><span>BÆ°á»›c 6. Äá»“ng bá»™ hÃ³a.</span></a></h3><p>ÄÃ£ Ä‘Æ°á»£c giá»›i thiá»‡u trÆ°á»›c Ä‘Ã³, khÃ´ng láº·p láº¡i á»Ÿ Ä‘Ã¢y.</p><h3 id="buoc-7-truyen-lenh" tabindex="-1"><a class="header-anchor" href="#buoc-7-truyen-lenh"><span>BÆ°á»›c 7. Truyá»n lá»‡nh.</span></a></h3><p>Trong giai Ä‘oáº¡n truyá»n lá»‡nh, mÃ¡y chá»§ phá»¥ máº·c Ä‘á»‹nh sáº½ gá»­i lá»‡nh Ä‘áº¿n mÃ¡y chá»§ chÃ­nh má»—i giÃ¢y má»™t láº§n:</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>REPLCONF ACK &lt;replication_coffset&gt;</span></span></code></pre></div><p>CÃ¡c lá»‡nh cÃ³ tÃ¡c dá»¥ng:</p><ul><li>Kiá»ƒm tra tráº¡ng thÃ¡i káº¿t ná»‘i máº¡ng giá»¯a mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥.</li><li>Há»— trá»£ thá»±c hiá»‡n tÃ¹y chá»n min-slave.</li><li>Kiá»ƒm tra viá»‡c máº¥t lá»‡nh.</li></ul><h2 id="_6-cac-tuy-chon-cau-hinh-sao-chep" tabindex="-1"><a class="header-anchor" href="#_6-cac-tuy-chon-cau-hinh-sao-chep"><span>6. CÃ¡c tÃ¹y chá»n cáº¥u hÃ¬nh sao chÃ©p</span></a></h2><p>Tá»« Redis 2.8 trá»Ÿ Ä‘i, Ä‘á»ƒ Ä‘áº£m báº£o tÃ­nh an toÃ n cá»§a dá»¯ liá»‡u, báº¡n cÃ³ thá»ƒ cáº¥u hÃ¬nh Ä‘á»ƒ mÃ¡y chá»§ chÃ­nh chá»‰ thá»±c hiá»‡n lá»‡nh ghi khi cÃ³ Ã­t nháº¥t N mÃ¡y chá»§ con Ä‘ang káº¿t ná»‘i.</p><p>Tuy nhiÃªn, vÃ¬ Redis sá»­ dá»¥ng sao chÃ©p báº¥t Ä‘á»“ng bá»™, nÃªn dá»¯ liá»‡u ghi mÃ  mÃ¡y chá»§ chÃ­nh gá»­i khÃ´ng nháº¥t thiáº¿t sáº½ Ä‘Æ°á»£c mÃ¡y chá»§ con nháº­n Ä‘Æ°á»£c, do Ä‘Ã³, kháº£ nÄƒng máº¥t dá»¯ liá»‡u váº«n tá»“n táº¡i.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  cÃ¡ch hoáº¡t Ä‘á»™ng cá»§a tÃ­nh nÄƒng nÃ y:</p><ul><li>MÃ¡y chá»§ con gá»­i lá»‡nh PING Ä‘áº¿n mÃ¡y chá»§ chÃ­nh má»—i giÃ¢y má»™t láº§n vÃ  bÃ¡o cÃ¡o tÃ¬nh tráº¡ng xá»­ lÃ½ luá»“ng sao chÃ©p.</li><li>MÃ¡y chá»§ chÃ­nh ghi láº¡i thá»i gian mÃ¡y chá»§ con cuá»‘i cÃ¹ng gá»­i lá»‡nh PING Ä‘áº¿n nÃ³.</li><li>NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ cáº¥u hÃ¬nh giÃ¡ trá»‹ tá»‘i Ä‘a cá»§a Ä‘á»™ trá»… máº¡ng <code>min-slaves-max-lag</code> vÃ  sá»‘ lÆ°á»£ng tá»‘i thiá»ƒu mÃ¡y chá»§ con cáº§n Ä‘á»ƒ thá»±c hiá»‡n lá»‡nh ghi <code>min-slaves-to-write</code>.</li></ul><p>Náº¿u cÃ³ Ã­t nháº¥t <code>min-slaves-to-write</code> mÃ¡y chá»§ con vÃ  táº¥t cáº£ cÃ¡c mÃ¡y chá»§ con nÃ y cÃ³ Ä‘á»™ trá»… nhá» hÆ¡n <code>min-slaves-max-lag</code> giÃ¢y, mÃ¡y chá»§ chÃ­nh sáº½ thá»±c hiá»‡n lá»‡nh ghi Ä‘Æ°á»£c yÃªu cáº§u tá»« khÃ¡ch hÃ ng.</p><p>Báº¡n cÃ³ thá»ƒ coi tÃ­nh nÄƒng nÃ y nhÆ° má»™t phiÃªn báº£n ná»›i lá»ng Ä‘iá»u kiá»‡n C trong lÃ½ thuyáº¿t CAP: Máº·c dÃ¹ khÃ´ng Ä‘áº£m báº£o tÃ­nh bá»n vá»¯ng cá»§a lá»‡nh ghi, nhÆ°ng Ã­t nháº¥t cá»­a sá»• máº¥t dá»¯ liá»‡u sáº½ Ä‘Æ°á»£c giá»›i háº¡n cháº·t cháº½ trong sá»‘ giÃ¢y Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh.</p><p>Máº·t khÃ¡c, náº¿u khÃ´ng Ä‘Ã¡p á»©ng Ä‘Æ°á»£c cÃ¡c Ä‘iá»u kiá»‡n Ä‘Æ°á»£c chá»‰ Ä‘á»‹nh bá»Ÿi <code>min-slaves-to-write</code> vÃ  <code>min-slaves-max-lag</code>, lá»‡nh ghi sáº½ khÃ´ng Ä‘Æ°á»£c thá»±c hiá»‡n vÃ  mÃ¡y chá»§ chÃ­nh sáº½ tráº£ vá» má»™t lá»—i cho khÃ¡ch hÃ ng yÃªu cáº§u thá»±c hiá»‡n lá»‡nh ghi.</p><p>DÆ°á»›i Ä‘Ã¢y lÃ  hai tÃ¹y chá»n cá»§a tÃ­nh nÄƒng nÃ y vÃ  cÃ¡c tham sá»‘ cáº§n thiáº¿t cho chÃºng:</p><ul><li><code>min-slaves-to-write &lt;sá»‘ lÆ°á»£ng mÃ¡y chá»§ con&gt;</code></li><li><code>min-slaves-max-lag &lt;sá»‘ giÃ¢y&gt;</code></li></ul><p>ThÃ´ng tin chi tiáº¿t cÃ³ thá»ƒ Ä‘Æ°á»£c tham kháº£o trong tá»‡p <code>redis.conf</code> Ä‘i kÃ¨m vá»›i mÃ£ nguá»“n Redis.</p>`,55);function r(g,m){const n=t("Mermaid");return a(),e("div",null,[s,c(n,{id:"mermaid-95",code:"eJwrTi0sTc1LTnXJTEwvSszlKkgsKslMzixIzCtR8E0sLkktQhEKzkksS+UCk7p2dhAFVgoahpoK7g93r81UyHm4uz0vQyE40s+ZCyKLrMxIU8E54+GuhZUwdU7uwY5hrgpHJj7c3axQApTJVwhycVIoO7xAITkxOSNVIfnwwmSoYoR5YOuBxhnDbC0BKigA6cRUY4JQs2tpiULyw12LYZaXFOXnpUPs4eIqySzJSYX6WBesGeIJALCdb2Q="}),l,c(n,{id:"mermaid-331",code:"eJx90D9Lw0AYBvD9PsU7tkgG99LS5l+FWMVUoYQMZ0x6wZgryaUipYOTq+IkTuJQHBxcc4ND+kXum3h3oSAiXe7g7vc+PHdJRm8jggsGUwsNO4Gf4WUMc8E/U8gEf8gJ+N7wwj5xgAn+msIxLllchF0wjD6MVj6mEJHmYyF1vclh+yS3arBGI8OAWVwqZgauzjv1ZxMTBmAcavad78I0nlBlLW2rHe4VVZ5e9aFHk6SMWf/voClH7GBKBP+KgKSqsCL8OZ/DpeAvbZ87fbYJkSW5s7Iww1DiCtpQYAWVPMIRidfIkcQN2nx5I+p3WAp+DwfOueed2f+2CpGreuh1vK/NjVwYLIj6qhCNJT/qBNvHX4LQ5g2u5RtlLdLUUdhFtmLoB+blq6Y="}),p])}const u=i(o,[["render",r],["__file","replication.html.vue"]]),y=JSON.parse('{"path":"/database/redis/replication.html","title":"Redis Replication","lang":"en-US","frontmatter":{"title":"Redis Replication","tags":["redis","nosql"],"categories":["redis"],"icon":"devicon:redis","date created":"2023-07-24T00:00:00.000Z","date modified":"2023-07-24T00:00:00.000Z","order":9,"description":"Redis Replication Trong Redis, cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh SLAVEOF hoáº·c cÃ i Ä‘áº·t tÃ¹y chá»n slaveof Ä‘á»ƒ sao chÃ©p (replicate) má»™t mÃ¡y chá»§ tá»« má»™t mÃ¡y chá»§ khÃ¡c, trong Ä‘Ã³ mÃ¡y chá»§ sau Ä‘Æ°á»£c gá»i l...","head":[["meta",{"property":"og:url","content":"https://vanhung4499.github.io/database/redis/replication.html"}],["meta",{"property":"og:site_name","content":"VanHung4499"}],["meta",{"property":"og:title","content":"Redis Replication"}],["meta",{"property":"og:description","content":"Redis Replication Trong Redis, cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh SLAVEOF hoáº·c cÃ i Ä‘áº·t tÃ¹y chá»n slaveof Ä‘á»ƒ sao chÃ©p (replicate) má»™t mÃ¡y chá»§ tá»« má»™t mÃ¡y chá»§ khÃ¡c, trong Ä‘Ã³ mÃ¡y chá»§ sau Ä‘Æ°á»£c gá»i l..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2024-06-28T15:54:38.000Z"}],["meta",{"property":"article:author","content":"Hung Nguyen"}],["meta",{"property":"article:tag","content":"redis"}],["meta",{"property":"article:tag","content":"nosql"}],["meta",{"property":"article:modified_time","content":"2024-06-28T15:54:38.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redis Replication\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-06-28T15:54:38.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hung Nguyen\\",\\"url\\":\\"https://vanhung4499.github.io\\"}]}"]]},"headers":[{"level":2,"title":"1. Giá»›i thiá»‡u vá» sao chÃ©p","slug":"_1-gioi-thieu-ve-sao-chep","link":"#_1-gioi-thieu-ve-sao-chep","children":[]},{"level":2,"title":"2. Sao chÃ©p phiÃªn báº£n cÅ©","slug":"_2-sao-chep-phien-ban-cu","link":"#_2-sao-chep-phien-ban-cu","children":[{"level":3,"title":"Äá»“ng bá»™ hÃ³a","slug":"Ä‘ong-bo-hoa","link":"#Ä‘ong-bo-hoa","children":[]},{"level":3,"title":"Truyá»n lá»‡nh","slug":"truyen-lenh","link":"#truyen-lenh","children":[]},{"level":3,"title":"NhÆ°á»£c Ä‘iá»ƒm cá»§a sao chÃ©p phiÃªn báº£n cÅ©","slug":"nhuoc-Ä‘iem-cua-sao-chep-phien-ban-cu","link":"#nhuoc-Ä‘iem-cua-sao-chep-phien-ban-cu","children":[]}]},{"level":2,"title":"3. Sao chÃ©p phiÃªn báº£n má»›i","slug":"_3-sao-chep-phien-ban-moi","link":"#_3-sao-chep-phien-ban-moi","children":[{"level":3,"title":"Äá»“ng bá»™ má»™t pháº§n","slug":"Ä‘ong-bo-mot-phan","link":"#Ä‘ong-bo-mot-phan","children":[]},{"level":3,"title":"Lá»‡nh PSYNC","slug":"lenh-psync","link":"#lenh-psync","children":[]}]},{"level":2,"title":"4. Kiá»ƒm tra nhá»‹p tim","slug":"_4-kiem-tra-nhip-tim","link":"#_4-kiem-tra-nhip-tim","children":[{"level":3,"title":"Kiá»ƒm tra tráº¡ng thÃ¡i káº¿t ná»‘i giá»¯a mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥","slug":"kiem-tra-trang-thai-ket-noi-giua-may-chu-chinh-va-may-chu-phu","link":"#kiem-tra-trang-thai-ket-noi-giua-may-chu-chinh-va-may-chu-phu","children":[]},{"level":3,"title":"Há»— trá»£ thá»±c hiá»‡n tÃ¹y chá»n min-slaves","slug":"ho-tro-thuc-hien-tuy-chon-min-slaves","link":"#ho-tro-thuc-hien-tuy-chon-min-slaves","children":[]},{"level":3,"title":"Kiá»ƒm tra viá»‡c máº¥t lá»‡nh","slug":"kiem-tra-viec-mat-lenh","link":"#kiem-tra-viec-mat-lenh","children":[]}]},{"level":2,"title":"5. Quy trÃ¬nh sao chÃ©p","slug":"_5-quy-trinh-sao-chep","link":"#_5-quy-trinh-sao-chep","children":[{"level":3,"title":"BÆ°á»›c 1. Cáº¥u hÃ¬nh mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥","slug":"buoc-1-cau-hinh-may-chu-chinh-va-may-chu-phu","link":"#buoc-1-cau-hinh-may-chu-chinh-va-may-chu-phu","children":[]},{"level":3,"title":"BÆ°á»›c 2. Thiáº¿t láº­p káº¿t ná»‘i TCP giá»¯a mÃ¡y chá»§ chÃ­nh vÃ  mÃ¡y chá»§ phá»¥.","slug":"buoc-2-thiet-lap-ket-noi-tcp-giua-may-chu-chinh-va-may-chu-phu","link":"#buoc-2-thiet-lap-ket-noi-tcp-giua-may-chu-chinh-va-may-chu-phu","children":[]},{"level":3,"title":"BÆ°á»›c 3. Gá»­i PING Ä‘á»ƒ kiá»ƒm tra tráº¡ng thÃ¡i giao tiáº¿p.","slug":"buoc-3-gui-ping-Ä‘e-kiem-tra-trang-thai-giao-tiep","link":"#buoc-3-gui-ping-Ä‘e-kiem-tra-trang-thai-giao-tiep","children":[]},{"level":3,"title":"BÆ°á»›c 4. XÃ¡c thá»±c.","slug":"buoc-4-xac-thuc","link":"#buoc-4-xac-thuc","children":[]},{"level":3,"title":"BÆ°á»›c 5. Gá»­i thÃ´ng tin cá»•ng.","slug":"buoc-5-gui-thong-tin-cong","link":"#buoc-5-gui-thong-tin-cong","children":[]},{"level":3,"title":"BÆ°á»›c 6. Äá»“ng bá»™ hÃ³a.","slug":"buoc-6-Ä‘ong-bo-hoa","link":"#buoc-6-Ä‘ong-bo-hoa","children":[]},{"level":3,"title":"BÆ°á»›c 7. Truyá»n lá»‡nh.","slug":"buoc-7-truyen-lenh","link":"#buoc-7-truyen-lenh","children":[]}]},{"level":2,"title":"6. CÃ¡c tÃ¹y chá»n cáº¥u hÃ¬nh sao chÃ©p","slug":"_6-cac-tuy-chon-cau-hinh-sao-chep","link":"#_6-cac-tuy-chon-cau-hinh-sao-chep","children":[]}],"git":{"createdTime":1719590078000,"updatedTime":1719590078000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":14.09,"words":4227},"filePathRelative":"database/redis/replication.md","localizedDate":"June 28, 2024","excerpt":"\\n<blockquote>\\n<p>Trong Redis,&nbsp;<strong>cÃ³ thá»ƒ sá»­ dá»¥ng lá»‡nh&nbsp;<code>SLAVEOF</code>&nbsp;hoáº·c cÃ i Ä‘áº·t tÃ¹y chá»n&nbsp;<code>slaveof</code>&nbsp;Ä‘á»ƒ sao chÃ©p (replicate) má»™t mÃ¡y chá»§ tá»« má»™t mÃ¡y chá»§ khÃ¡c</strong>, trong Ä‘Ã³ mÃ¡y chá»§ sau Ä‘Æ°á»£c gá»i lÃ  mÃ¡y chá»§ chÃ­nh (master) vÃ  mÃ¡y chá»§ trÆ°á»›c Ä‘Æ°á»£c gá»i lÃ  mÃ¡y chá»§ phá»¥ (slave).</p>\\n<p>Sao chÃ©p Redis trÆ°á»›c phiÃªn báº£n 2.8 khÃ´ng xá»­ lÃ½ hiá»‡u quáº£ viá»‡c sao chÃ©p láº¡i sau khi máº¥t káº¿t ná»‘i, vÃ  má»™t sá»‘ cáº­p nháº­t sau Ä‘Ã³ cá»§a Redis Ä‘Ã£ giáº£i quyáº¿t váº¥n Ä‘á» nÃ y.</p>\\n</blockquote>","autoDesc":true}');export{u as comp,y as data};
