import{_ as a,o as i,c as n,a as r}from"./app-5QVbWi7Z.js";const o={};function t(l,e){return i(),n("div",null,e[0]||(e[0]=[r('<h1 id="服务监控" tabindex="-1"><a class="header-anchor" href="#服务监控"><span>服务监控</span></a></h1><p>系统使用 Spring Boot Admin 和 SkyWalking 实现后端服务的监控。</p><h2 id="_1-spring-boot-admin" tabindex="-1"><a class="header-anchor" href="#_1-spring-boot-admin"><span><a href="#_1-spring-boot-admin">#</a> 1. Spring Boot Admin</span></a></h2><p>阅读 <a href="https://www.iocoder.cn/Spring-Boot/Admin/?yudao" target="_blank" rel="noopener noreferrer">《芋道 Spring Boot 监控工具 Admin 入门》</a> 文章，入门 Spring Boot Admin。</p><p>注意，Spring Boot Admin 是内嵌在 <code>yudao-server</code> 后端项目中，无需单独启动。</p><h3 id="_1-1-如何配置" tabindex="-1"><a class="header-anchor" href="#_1-1-如何配置"><span><a href="#_1-1-%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE">#</a> 1.1 如何配置？</span></a></h3><p>在 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-server/src/main/resources/application-local.yaml#L136-L146" target="_blank" rel="noopener noreferrer"><code>application-local.yaml</code></a> 配置文件中，通过 <code>spring.boot.admin</code> 配置项，设置 Spring Boot Admin 的配置。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/服务监控/01.png" alt=" 配置文件" tabindex="0" loading="lazy"><figcaption> 配置文件</figcaption></figure><p>疑问：prod 生产环境下，后端部署多个 JVM 进程时，spring.boot.admin.client.url 填写哪个 IP？</p><ul><li>第一步，在 Nginx 中配置 <code>/admin</code> 路径，转发到多个 JVM 的 IP 上，使用 <a href="https://blog.csdn.net/bolg_hero/article/details/73382117" target="_blank" rel="noopener noreferrer"><code>backup</code></a> 参数实现主备。注意，该转发只允许内网访问，避免安全问题！！！</li><li>第二步，设置 <code>spring.boot.admin.client.url</code> 配置项，为 Nginx 的 <code>内置 IP/admin</code> 地址。<br> 重要！！！考虑到项目的启动速度，<code>local</code> 本地开发环境下，默认禁用了 Spring Boot Admin 的启动，可以参考下图进行开启：</li></ul><p>① 在 <code>infra</code> 服务，删除这 3 行配置，开启 Spring Boot Admin 的 Server 和 UI 界面：</p><figure><img src="https://cloud.iocoder.cn/img/服务监控/Admin开启-cloud01.png" alt="Admin Server 开启" tabindex="0" loading="lazy"><figcaption>Admin Server 开启</figcaption></figure><p>② 在 <code>system</code>、<code>pay</code> 等其它服务，删除这 1 行配置，开启 Spring Boot Admin 的 Client 注册：</p><figure><img src="https://cloud.iocoder.cn/img/服务监控/Admin开启-cloud02.png" alt="Admin Client 开启" tabindex="0" loading="lazy"><figcaption>Admin Client 开启</figcaption></figure><h3 id="_1-2-如何使用" tabindex="-1"><a class="header-anchor" href="#_1-2-如何使用"><span><a href="#_1-2-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">#</a> 1.2 如何使用？</span></a></h3><p>① 访问 <a href="http://127.0.0.1:48080//admin/applications" target="_blank" rel="noopener noreferrer">http://127.0.0.1:48080//admin/applications</a> 地址，可以在 Spring Boot Admin 中，查看到应用与实例的列表。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/服务监控/02.png" alt="应用 - 列表" tabindex="0" loading="lazy"><figcaption>应用 - 列表</figcaption></figure><p>② 点击 <code>yudao-server</code> 应用，再点击实例，可以查看到该实例的细节信息。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/服务监控/03.png" alt="应用 - 明细" tabindex="0" loading="lazy"><figcaption>应用 - 明细</figcaption></figure><p>③ 点击 [日志 -&gt; 日志文件] 菜单，查看该示例的日志内容。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/服务监控/04.png" alt="应用 - 日志" tabindex="0" loading="lazy"><figcaption>应用 - 日志</figcaption></figure><p>点击 [日志 -&gt; 日志文件] 菜单，可动态修改 Logger 的日志级别，方便排查线上的某些 BUG。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/服务监控/05.png" alt="应用 - 日志" tabindex="0" loading="lazy"><figcaption>应用 - 日志</figcaption></figure><p>补充说明：也可以通过前端的 [基础设施 -&gt; 监控中心 -&gt; Java 监控] 菜单。</p><p>前端 [基础设施 -&gt; 监控中心 -&gt; Java 监控] 菜单，通过 iframe 内嵌后端 <code>/admin/applications</code> 路径。</p><p>如果你想自定义地址，可以前往 [基础设置 -&gt; 配置管理] 菜单，设置 key 为 <code>url.spring-boot-admin</code> 配置项。</p><h3 id="_1-3-如何开启登录" tabindex="-1"><a class="header-anchor" href="#_1-3-如何开启登录"><span><a href="#_1-3-%E5%A6%82%E4%BD%95%E5%BC%80%E5%90%AF%E7%99%BB%E5%BD%95">#</a> 1.3 如何开启登录？</span></a></h3><p>生产环境下，建议 Spring Boot Admin 开启“安全认证”的功能，避免出现安全事故。</p><p>由于项目本身已经使用 Spring Security 做安全认证，再额外配置 Spring Boot Admin 的“安全认证”有点麻烦。我自己是拓展 Spring Security 解决，预计<a href="https://yunai1024.notion.site/druid-admin-9d856cf606a74e5e9f07438b03b0142b?pvs=4" target="_blank" rel="noopener noreferrer">需要改 2-3 个类</a>，不是很建议。</p><p>那么怎么办呢？可以参考 <a href="https://www.iocoder.cn/Spring-Boot/Admin/" target="_blank" rel="noopener noreferrer">《芋道 Spring Boot 监控工具 Admin 入门》</a> 文档，额外搭建一个 Spring Boot Admin 进程，然后项目接入它使用！</p><h2 id="_2-skywalking" tabindex="-1"><a class="header-anchor" href="#_2-skywalking"><span><a href="#_2-skywalking">#</a> 2. SkyWalking</span></a></h2><p>阅读 <a href="https://www.iocoder.cn/SkyWalking/install/?yudao" target="_blank" rel="noopener noreferrer">《芋道 SkyWalking 极简入门》</a> 文章，入门 SkyWalking。</p><p>注意，SkyWalking 需要单独启动，预计需要 4 核 8G 的硬件资源。</p><h3 id="_2-1-如何配置" tabindex="-1"><a class="header-anchor" href="#_2-1-如何配置"><span><a href="#_2-1-%E5%A6%82%E4%BD%95%E9%85%8D%E7%BD%AE">#</a> 2.1 如何配置？</span></a></h3><p>① 在 <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-server/src/main/resources/logback-spring.xml" target="_blank" rel="noopener noreferrer"><code>logback-spring.xml</code></a> 配置文件中，添加 SkyWalking 收集日志的 appender 配置。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/服务监控/10.png" alt=" 配置" tabindex="0" loading="lazy"><figcaption> 配置</figcaption></figure><p>② 修改 SkyWalking 在前端项目的 [基础设施 -&gt; 监控中心 -&gt; 链路追踪] 对应的 <a href="https://github.com/yudaocode/yudao-ui-admin-vue2/blob/master/src/views/infra/skywalking/index.vue#L11" target="_blank" rel="noopener noreferrer"><code>skywaling/index.vue</code></a> 文件，调整为你 SkyWalking 的访问地址。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/服务监控/11.png" alt=" 文件" tabindex="0" loading="lazy"><figcaption> 文件</figcaption></figure><h3 id="_2-2-如何使用" tabindex="-1"><a class="header-anchor" href="#_2-2-如何使用"><span><a href="#_2-2-%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8">#</a> 2.2 如何使用？</span></a></h3><p>① 点击 [基础设施 -&gt; 监控中心 -&gt; 链路追踪] 菜单，可以看到 SkyWalking 提供的链路追踪。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/服务监控/21.png" alt="基础设施 -&gt; 链路追踪" tabindex="0" loading="lazy"><figcaption>基础设施 -&gt; 链路追踪</figcaption></figure><p>② 点击 <code>yudao-server</code> 服务，查看该服务的监控信息。如下图所示：</p><figure><img src="https://cloud.iocoder.cn/img/服务监控/22.png" alt=" 服务" tabindex="0" loading="lazy"><figcaption> 服务</figcaption></figure><p>补充说明：</p><p>前端 [基础设施 -&gt; 监控中心 -&gt; 链路追踪] 菜单，通过 iframe 内嵌 <code>http://skywalking.iocoder.cn</code> 路径。</p><p>如果你想自定义地址，可以前往 [基础设置 -&gt; 配置管理] 菜单，设置 key 为 <code>url.skywalking</code> 配置项。</p><h2 id="_3-更多监控系统" tabindex="-1"><a class="header-anchor" href="#_3-更多监控系统"><span><a href="#_3-%E6%9B%B4%E5%A4%9A%E7%9B%91%E6%8E%A7%E7%B3%BB%E7%BB%9F">#</a> 3. 更多监控系统</span></a></h2><h3 id="_3-1-prometheus" tabindex="-1"><a class="header-anchor" href="#_3-1-prometheus"><span><a href="#_3-1-prometheus">#</a> 3.1 Prometheus</span></a></h3><p>参见 <a href="https://www.iocoder.cn/Prometheus/install/?yudao" target="_blank" rel="noopener noreferrer">《芋道 Prometheus + Grafana + Alertmanager 极简入门 》</a> 文章。</p><h3 id="_3-2-elk" tabindex="-1"><a class="header-anchor" href="#_3-2-elk"><span><a href="#_3-2-elk">#</a> 3.2 ELK</span></a></h3><p>参见 <a href="https://www.iocoder.cn/Elasticsearch/ELK-install/?yudao" target="_blank" rel="noopener noreferrer">芋道 ELK(Elasticsearch + Logstash + Kibana) 极简入门</a> 文章。</p><h3 id="_3-3-sentry" tabindex="-1"><a class="header-anchor" href="#_3-3-sentry"><span><a href="#_3-3-sentry">#</a> 3.3 Sentry</span></a></h3><p>参见 <a href="https://www.iocoder.cn/Sentry/install/?yudao" target="_blank" rel="noopener noreferrer">《Sentry 极简入门 》</a> 文章。</p>',53)]))}const p=a(o,[["render",t],["__file","server-monitor.html.vue"]]),c=JSON.parse('{"path":"/project/yudao-cloud/server-monitor.html","title":"服务监控","lang":"en-US","frontmatter":{"title":"服务监控","tags":["project","java","spring-boot","spring-cloud"],"categories":["project"],"order":153,"feed":false,"seo":false,"head":[]},"headers":[{"level":2,"title":"# 1. Spring Boot Admin","slug":"_1-spring-boot-admin","link":"#_1-spring-boot-admin","children":[{"level":3,"title":"# 1.1 如何配置？","slug":"_1-1-如何配置","link":"#_1-1-如何配置","children":[]},{"level":3,"title":"# 1.2 如何使用？","slug":"_1-2-如何使用","link":"#_1-2-如何使用","children":[]},{"level":3,"title":"# 1.3 如何开启登录？","slug":"_1-3-如何开启登录","link":"#_1-3-如何开启登录","children":[]}]},{"level":2,"title":"# 2. SkyWalking","slug":"_2-skywalking","link":"#_2-skywalking","children":[{"level":3,"title":"# 2.1 如何配置？","slug":"_2-1-如何配置","link":"#_2-1-如何配置","children":[]},{"level":3,"title":"# 2.2 如何使用？","slug":"_2-2-如何使用","link":"#_2-2-如何使用","children":[]}]},{"level":2,"title":"# 3. 更多监控系统","slug":"_3-更多监控系统","link":"#_3-更多监控系统","children":[{"level":3,"title":"# 3.1 Prometheus","slug":"_3-1-prometheus","link":"#_3-1-prometheus","children":[]},{"level":3,"title":"# 3.2 ELK","slug":"_3-2-elk","link":"#_3-2-elk","children":[]},{"level":3,"title":"# 3.3 Sentry","slug":"_3-3-sentry","link":"#_3-3-sentry","children":[]}]}],"git":{"createdTime":1720365235000,"updatedTime":1720365235000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":4.08,"words":1225},"filePathRelative":"project/yudao-cloud/server-monitor.md","localizedDate":"July 7, 2024"}');export{p as comp,c as data};
