import{_ as o,g as n,o as s,c as r,e as p,h as e,f as i,w as d,a}from"./app-BRTHG7K9.js";const c={},l=a(`<h1 id="å¹‚ç­‰æ€§-é˜²é‡å¤æäº¤" tabindex="-1"><a class="header-anchor" href="#å¹‚ç­‰æ€§-é˜²é‡å¤æäº¤"><span>å¹‚ç­‰æ€§ï¼ˆé˜²é‡å¤æäº¤ï¼‰</span></a></h1><p><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-protection/" target="_blank" rel="noopener noreferrer"><code>yudao-spring-boot-starter-protection</code></a> æŠ€æœ¯ç»„ä»¶ï¼Œç”±å®ƒçš„ <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-protection/src/main/java/cn/iocoder/yudao/framework/idempotent/" target="_blank" rel="noopener noreferrer"><code>idempotent</code></a> åŒ…ï¼Œæä¾›å£°æ˜å¼çš„å¹‚ç­‰ç‰¹æ€§ï¼Œå¯é˜²æ­¢é‡å¤è¯·æ±‚ã€‚ä¾‹å¦‚è¯´ï¼Œç”¨æˆ·å¿«é€Ÿçš„åŒå‡»äº†æŸä¸ªæŒ‰é’®ï¼Œå‰ç«¯æ²¡æœ‰ç¦ç”¨è¯¥æŒ‰é’®ï¼Œå¯¼è‡´å‘é€äº†ä¸¤æ¬¡é‡å¤çš„è¯·æ±‚ã€‚</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>// UserController.java</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@Idempotent(timeout = 10, timeUnit = TimeUnit.SECONDS, message = &quot;æ­£åœ¨æ·»åŠ ç”¨æˆ·ä¸­ï¼Œè¯·å‹¿é‡å¤æäº¤&quot;)</span></span>
<span class="line"><span>@PostMapping(&quot;/user/create&quot;)</span></span>
<span class="line"><span>public String createUser(User user){</span></span>
<span class="line"><span>    userService.createUser(user);</span></span>
<span class="line"><span>    return &quot;æ·»åŠ æˆåŠŸ&quot;;</span></span>
<span class="line"><span>}</span></span></code></pre></div><ul><li>æ¯ 10 ç§’é’Ÿï¼Œæ‰€æœ‰ç”¨æˆ·ï¼Œåªèƒ½æ“ä½œä¸€æ¬¡</li></ul><p>ç–‘é—®ï¼šå¦‚æœæƒ³æŒ‰ç…§æ¯ä¸ªç”¨æˆ·ï¼Œæˆ–è€…æ¯ä¸ª IPï¼Œé™åˆ¶è¯·æ±‚å‘¢ï¼Ÿ</p><p>å¯è®¾ç½®è¯¥æ³¨è§£çš„ <code>keyResolver</code> å±æ€§ï¼Œå¯é€‰æ‹©çš„æœ‰ï¼š</p><ul><li>DefaultIdempotentKeyResolverï¼šå…¨å±€çº§åˆ«</li><li>UserIdempotentKeyResolverï¼šç”¨æˆ·çº§åˆ«</li><li>ExpressionIdempotentKeyResolverï¼šè‡ªå®šä¹‰çº§åˆ«ï¼Œé€šè¿‡ <code>keyArg</code> å±æ€§æŒ‡å®š Spring EL è¡¨è¾¾å¼</li></ul><h2 id="_1-å®ç°åŸç†" tabindex="-1"><a class="header-anchor" href="#_1-å®ç°åŸç†"><span><a href="#_1-%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">#</a> 1. å®ç°åŸç†</span></a></h2><p>å‹æƒ…æç¤ºï¼š</p>`,9),u=a(`<p>å®ƒçš„å®ç°åŸç†éå¸¸ç®€å•ï¼Œé’ˆå¯¹ç›¸åŒå‚æ•°çš„æ–¹æ³•ï¼Œä¸€æ®µæ—¶é—´å†…ï¼Œæœ‰ä¸”ä»…èƒ½æ‰§è¡Œä¸€æ¬¡ã€‚æ‰§è¡Œæµç¨‹å¦‚ä¸‹ï¼š</p><p>â‘  åœ¨æ–¹æ³•æ‰§è¡Œå‰ï¼Œæ ¹æ®å‚æ•°å¯¹åº”çš„ Key æŸ¥è¯¢æ˜¯å¦å­˜åœ¨ï¼š</p><ul><li>å¦‚æœ<strong>å­˜åœ¨</strong>ï¼Œè¯´æ˜æ­£åœ¨æ‰§è¡Œä¸­ï¼Œåˆ™è¿›è¡ŒæŠ¥é”™ã€‚</li><li>å¦‚æœ<strong>ä¸åœ¨</strong>ï¼Œåˆ™è®¡ç®—å‚æ•°å¯¹åº”çš„ Keyï¼Œå­˜å‚¨åˆ° Redis ä¸­ï¼Œå¹¶è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œå³æ ‡è®°æ­£åœ¨æ‰§è¡Œä¸­ã€‚</li></ul><p>é»˜è®¤å‚æ•°çš„ Redis Key çš„è®¡ç®—è§„åˆ™ç”± <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-protection/src/main/java/cn/iocoder/yudao/framework/idempotent/core/keyresolver/impl/DefaultIdempotentKeyResolver.java" target="_blank" rel="noopener noreferrer">DefaultIdempotentKeyResolver</a> å®ç°ï¼Œä½¿ç”¨ MD5(æ–¹æ³•å + æ–¹æ³•å‚æ•°)ï¼Œé¿å… Redis Key è¿‡é•¿ã€‚</p><p>â‘¡ æ–¹æ³•æ‰§è¡Œå®Œæˆï¼Œ<strong>ä¸ä¼š</strong>ä¸»åŠ¨åˆ é™¤å‚æ•°å¯¹åº”çš„ Keyã€‚</p><p>å¦‚æœå¸Œæœ›ä¼š<strong>ä¸»åŠ¨</strong>åˆ é™¤ Keyï¼Œå¯ä»¥ä½¿ç”¨ <a href="/distributed-lock">ã€Šå¼€å‘æŒ‡å— â€”â€” åˆ†å¸ƒå¼é”ã€‹</a> æä¾›çš„ <code>@Lock</code> æ¥å®ç°å¹‚ç­‰æ€§ã€‚</p><p>ğŸ™‚ ä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œ<code>idempotent</code> åŒ…æä¾›çš„å¹‚ç­‰ç‰¹æ€§ï¼Œæœ¬è´¨ä¸Šä¹Ÿæ˜¯åŸºäº Redis å®ç°çš„åˆ†å¸ƒå¼é”ã€‚</p><p>â‘¢ å¦‚æœæ–¹æ³•æ‰§è¡Œæ—¶é—´è¾ƒé•¿ï¼Œè¶…è¿‡ Key çš„è¿‡æœŸæ—¶é—´ï¼Œåˆ™ Redis ä¼šè‡ªåŠ¨åˆ é™¤å¯¹åº”çš„ Keyã€‚å› æ­¤ï¼Œéœ€è¦å¤§æ¦‚è¯„ä¼°ä¸‹ï¼Œé¿å…æ–¹æ³•çš„æ‰§è¡Œæ—¶é—´è¶…è¿‡è¿‡æœŸæ—¶é—´ã€‚</p><p>â‘£ å¦‚æœæ–¹æ³•æ‰§è¡Œå‘ç”Ÿ Exception å¼‚å¸¸æ—¶ï¼Œé»˜è®¤ä¼šåˆ é™¤ Keyï¼Œé¿å…ä¸‹æ¬¡è¯·æ±‚æ— æ³•æ­£å¸¸æ‰§è¡Œï¼Œæ­¤å¤„å‚è€ƒ <a href="https://tech.meituan.com/2016/09/29/distributed-system-mutually-exclusive-idempotence-cerberus-gtis.html" target="_blank" rel="noopener noreferrer">ã€Šç¾å›¢ GTISã€‹</a> ã€‚</p><h2 id="_2-idempotent-æ³¨è§£" tabindex="-1"><a class="header-anchor" href="#_2-idempotent-æ³¨è§£"><span><a href="#_2-idempotent-%E6%B3%A8%E8%A7%A3">#</a> 2. <code>@Idempotent</code> æ³¨è§£</span></a></h2><p><a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-protection/src/main/java/cn/iocoder/yudao/framework/idempotent/core/annotation/Idempotent.java" target="_blank" rel="noopener noreferrer"><code>@Idempotent</code></a> æ³¨è§£ï¼Œå£°æ˜åœ¨æ–¹æ³•ä¸Šï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•éœ€è¦å¼€å¯å¹‚ç­‰æ€§ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><figure><img src="https://doc.iocoder.cn/img/åç«¯æ‰‹å†Œ/å¹‚ç­‰æ€§/æ³¨è§£.png" alt=" æ³¨è§£" tabindex="0" loading="lazy"><figcaption> æ³¨è§£</figcaption></figure><p>â‘  å¯¹åº”çš„ AOP åˆ‡é¢æ˜¯ <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-protection/src/main/java/cn/iocoder/yudao/framework/idempotent/core/aop/IdempotentAspect.java" target="_blank" rel="noopener noreferrer">IdempotentAspect</a> ç±»ï¼Œæ ¸å¿ƒå°± 10 è¡Œå·¦å³çš„ä»£ç ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="https://doc.iocoder.cn/img/åç«¯æ‰‹å†Œ/å¹‚ç­‰æ€§/IdempotentAspect.png" alt="IdempotentAspect åˆ‡é¢" tabindex="0" loading="lazy"><figcaption>IdempotentAspect åˆ‡é¢</figcaption></figure><p>â‘¡ å¯¹åº”çš„ Redis Key çš„å‰ç¼€æ˜¯ <code>idempotent:%s</code>ï¼Œå¯è§ <a href="https://github.com/YunaiV/ruoyi-vue-pro/blob/master/yudao-framework/yudao-spring-boot-starter-protection/src/main/java/cn/iocoder/yudao/framework/idempotent/core/redis/IdempotentRedisDAO.java" target="_blank" rel="noopener noreferrer">IdempotentRedisDAO</a> ç±»ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><figure><img src="https://doc.iocoder.cn/img/åç«¯æ‰‹å†Œ/å¹‚ç­‰æ€§/IdempotentRedisDAO.png" alt="IdempotentRedisDAO å­˜å‚¨" tabindex="0" loading="lazy"><figcaption>IdempotentRedisDAO å­˜å‚¨</figcaption></figure><h2 id="_3-ä½¿ç”¨ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#_3-ä½¿ç”¨ç¤ºä¾‹"><span><a href="#_3-%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">#</a> 3. ä½¿ç”¨ç¤ºä¾‹</span></a></h2><p>æœ¬å°èŠ‚ï¼Œæˆ‘ä»¬å®ç° <code>/admin-api/infra/test-demo/get</code> RESTful API æ¥å£çš„å¹‚ç­‰æ€§ã€‚</p><p>â‘  åœ¨ <code>pom.xml</code> æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ <code>yudao-spring-boot-starter-protection</code> ä¾èµ–ã€‚</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>&lt;dependency&gt;</span></span>
<span class="line"><span>    &lt;groupId&gt;cn.iocoder.boot&lt;/groupId&gt;</span></span>
<span class="line"><span>    &lt;artifactId&gt;yudao-spring-boot-starter-protection&lt;/artifactId&gt;</span></span>
<span class="line"><span>&lt;/dependency&gt;</span></span></code></pre></div><p>â‘¡ åœ¨è¯¥ API æ¥å£çš„å¯¹åº”æ–¹æ³•ä¸Šï¼Œæ·»åŠ  <code>@Idempotent</code> æ³¨è§£ã€‚ä»£ç å¦‚ä¸‹ï¼š</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>// TestDemoController.java</span></span>
<span class="line"><span></span></span>
<span class="line"><span>@GetMapping(&quot;/get&quot;)</span></span>
<span class="line"><span>@Idempotent(timeout = 10, message = &quot;é‡å¤è¯·æ±‚ï¼Œè¯·ç¨åé‡è¯•&quot;)</span></span>
<span class="line"><span>public CommonResult&lt;TestDemoRespVO&gt; getTestDemo(@RequestParam(&quot;id&quot;) Long id) {</span></span>
<span class="line"><span>    // ... çœç•¥ä»£ç </span></span>
<span class="line"><span>}</span></span></code></pre></div><p>â‘¢ è°ƒç”¨è¯¥ API æ¥å£ï¼Œæ‰§è¡ŒæˆåŠŸã€‚</p><figure><img src="https://doc.iocoder.cn/img/åç«¯æ‰‹å†Œ/å¹‚ç­‰æ€§/æ¡ˆä¾‹.png" alt="è°ƒç”¨æˆåŠŸ" tabindex="0" loading="lazy"><figcaption>è°ƒç”¨æˆåŠŸ</figcaption></figure><p>â‘£ å†æ¬¡è°ƒç”¨è¯¥ API æ¥å£ï¼Œè¢«å¹‚ç­‰æ€§æ‹¦æˆªï¼Œæ‰§è¡Œå¤±è´¥ã€‚</p><div class="language-" data-ext="" data-title=""><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code" style="background-color:#282c34;--shiki-dark-bg:#282c34;color:#abb2bf;--shiki-dark:#abb2bf;" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;code&quot;: 900,</span></span>
<span class="line"><span>  &quot;data&quot;: null,</span></span>
<span class="line"><span>  &quot;msg&quot;: &quot;é‡å¤è¯·æ±‚ï¼Œè¯·ç¨åé‡è¯•&quot;</span></span>
<span class="line"><span>}</span></span></code></pre></div>`,26);function m(g,b){const t=n("RouteLink");return s(),r("div",null,[l,p("p",null,[e("å®ƒçš„å®ç°åŸç†ï¼Œå’Œ "),i(t,{to:"/rate-limiter/"},{default:d(()=>[e("ã€Šè¯·æ±‚é™æµï¼ˆRateLimiterï¼‰ã€‹")]),_:1}),e(" æ¯”è¾ƒæ¥è¿‘å“ˆã€‚")]),u])}const f=o(c,[["render",m],["__file","idempotent.html.vue"]]),k=JSON.parse('{"path":"/project/rouyi-vue-pro/idempotent.html","title":"å¹‚ç­‰æ€§ï¼ˆé˜²é‡å¤æäº¤ï¼‰","lang":"en-US","frontmatter":{"title":"å¹‚ç­‰æ€§ï¼ˆé˜²é‡å¤æäº¤ï¼‰","tags":["project","java","spring-boot","spring-cloud"],"categories":["project"],"order":45,"feed":false,"seo":false,"head":[]},"headers":[{"level":2,"title":"# 1. å®ç°åŸç†","slug":"_1-å®ç°åŸç†","link":"#_1-å®ç°åŸç†","children":[]},{"level":2,"title":"# 2. @Idempotent æ³¨è§£","slug":"_2-idempotent-æ³¨è§£","link":"#_2-idempotent-æ³¨è§£","children":[]},{"level":2,"title":"# 3. ä½¿ç”¨ç¤ºä¾‹","slug":"_3-ä½¿ç”¨ç¤ºä¾‹","link":"#_3-ä½¿ç”¨ç¤ºä¾‹","children":[]}],"git":{"createdTime":1720365235000,"updatedTime":1720365235000,"contributors":[{"name":"Hung Nguyen Van","email":"vanhung4499@gmail.com","commits":1}]},"readingTime":{"minutes":3.18,"words":954},"filePathRelative":"project/rouyi-vue-pro/idempotent.md","localizedDate":"July 7, 2024"}');export{f as comp,k as data};
