<!doctype html>
<html lang="en-US" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.15" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.52" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="https://vanhung4499.github.io/project/pmhub/distributed-transaction.html"><meta property="og:site_name" content="VanHung4499"><meta property="og:title" content="Distributed Transaction"><meta property="og:description" content="PmHub - Distributed Transaction with Seata B√†i vi·∫øt n√†y ch·ªß y·∫øu n√≥i v·ªÅ c√°ch s·ª≠ d·ª•ng Seata ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n c·ªßa tr·∫°ng th√°i ph√™ duy·ªát nhi·ªám v·ª• trong h·ªá th·ªëng PmHub. Giao ..."><meta property="og:type" content="article"><meta property="og:image" content="https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-mysql-log.drawio.png"><meta property="og:locale" content="en-US"><meta property="og:updated_time" content="2024-10-02T17:20:50.000Z"><meta property="article:author" content="Hung Nguyen"><meta property="article:tag" content="java"><meta property="article:tag" content="microservice"><meta property="article:modified_time" content="2024-10-02T17:20:50.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Distributed Transaction","image":["https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-mysql-log.drawio.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-add-task.drawio.png","https://seata.apache.org/assets/images/solution-1bdadb80e54074aa3088372c17f0244b.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919143501.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919151242.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919151318.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919152345.png","https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-add-task.drawio.png","https://cdn.nlark.com/yuque/0/2024/png/29495295/1719395526981-e02f9478-7727-42c1-8948-975d261a7553.png","https://cdn.nlark.com/yuque/0/2024/png/29495295/1719395592766-12f22df4-c88d-4495-b3d0-e8fd2c776603.png","https://cdn.nlark.com/yuque/0/2024/png/29495295/1719395636269-91d4ff83-d0d7-4c05-a3fb-56f209d8d525.png"],"dateModified":"2024-10-02T17:20:50.000Z","author":[{"@type":"Person","name":"Hung Nguyen","url":"https://vanhung4499.github.io"}]}</script><meta name="referrer" content="no-referrer-when-downgrade"><link rel="alternate" type="application/rss+xml" href="https://vanhung4499.github.io/rss.xml" title="VanHung4499 RSS Feed"><title>Distributed Transaction | VanHung4499</title><meta name="description" content="PmHub - Distributed Transaction with Seata B√†i vi·∫øt n√†y ch·ªß y·∫øu n√≥i v·ªÅ c√°ch s·ª≠ d·ª•ng Seata ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n c·ªßa tr·∫°ng th√°i ph√™ duy·ªát nhi·ªám v·ª• trong h·ªá th·ªëng PmHub. Giao ...">
    <link rel="preload" href="/assets/style-DFXXOFfS.css" as="style"><link rel="stylesheet" href="/assets/style-DFXXOFfS.css">
    <link rel="modulepreload" href="/assets/app-CmlOSuIY.js"><link rel="modulepreload" href="/assets/distributed-transaction.html-DArHVyOJ.js">
    
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">Skip to main content</a><!--]--><div class="theme-container no-sidebar external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">VanHung4499</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/" aria-label="Home"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:home" width="1em" height="1em"></iconify-icon><!--]-->Home<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/wiki.html" aria-label="Wiki"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="carbon:wikis" width="1em" height="1em"></iconify-icon><!--]-->Wiki<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/dsa/" aria-label="Algorithms"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="hugeicons:algorithm" width="1em" height="1em"></iconify-icon><!--]-->Algorithms<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Programming"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:code" width="1em" height="1em"></iconify-icon>Programming<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/java/" aria-label="Java"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:java" width="1em" height="1em"></iconify-icon><!--]-->Java<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/golang/" aria-label="Golang"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:go" width="1em" height="1em"></iconify-icon><!--]-->Golang<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/js/" aria-label="JavaScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:javascript" width="1em" height="1em"></iconify-icon><!--]-->JavaScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/ts/" aria-label="TypeScript"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:typescript" width="1em" height="1em"></iconify-icon><!--]-->TypeScript<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/programming/python/" aria-label="Python"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:python" width="1em" height="1em"></iconify-icon><!--]-->Python<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Database"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:database" width="1em" height="1em"></iconify-icon>Database<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/sql/" aria-label="SQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:sql-query" width="1em" height="1em"></iconify-icon><!--]-->SQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mysql/" aria-label="MySQL"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mysql" width="1em" height="1em"></iconify-icon><!--]-->MySQL<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/mongodb/" aria-label="MongoDB"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:mongodb" width="1em" height="1em"></iconify-icon><!--]-->MongoDB<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/redis/" aria-label="Redis"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:redis" width="1em" height="1em"></iconify-icon><!--]-->Redis<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elasticsearch/" aria-label="Elasticsearch"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:elasticsearch" width="1em" height="1em"></iconify-icon><!--]-->Elasticsearch<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/database/elastic/" aria-label="Elastic Stack"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:elastic-stack" width="1em" height="1em"></iconify-icon><!--]-->Elastic Stack<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Framework"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="simple-icons:framework" width="1em" height="1em"></iconify-icon>Framework<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring/" aria-label="Spring"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/spring-boot/" aria-label="Spring Boot"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Spring Boot<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/nestjs/" aria-label="NestJS"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:nestjs" width="1em" height="1em"></iconify-icon><!--]-->NestJS<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/framework/gin/" aria-label="Gin"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="logos:gin" width="1em" height="1em"></iconify-icon><!--]-->Gin<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="DevOps"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon-plain:azuredevops" width="1em" height="1em"></iconify-icon>DevOps<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/docker/" aria-label="Docker"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:docker" width="1em" height="1em"></iconify-icon><!--]-->Docker<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/kubernetes/" aria-label="Kubernetes"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:kubernetes" width="1em" height="1em"></iconify-icon><!--]-->Kubernetes<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/jenkins/" aria-label="Jenkins"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:jenkins" width="1em" height="1em"></iconify-icon><!--]-->Jenkins<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/git/" aria-label="Git"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:git" width="1em" height="1em"></iconify-icon><!--]-->Git<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/devops/linux/" aria-label="Linux"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:linux" width="1em" height="1em"></iconify-icon><!--]-->Linux<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tdesign:system-sum" width="1em" height="1em"></iconify-icon>Design<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/design-pattern/" aria-label="Design Pattern"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="tabler:grid-pattern" width="1em" height="1em"></iconify-icon><!--]-->Design Pattern<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/design/system-design/" aria-label="System Design"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="icon-park-outline:system" width="1em" height="1em"></iconify-icon><!--]-->System Design<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="Project"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="ant-design:project-outlined" width="1em" height="1em"></iconify-icon>Project<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/rouyi-vue-pro/" aria-label="Rouyi Vue Pro"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Rouyi Vue Pro<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/project/yudao-cloud/" aria-label="Yudao Cloud"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="devicon:spring" width="1em" height="1em"></iconify-icon><!--]-->Yudao Cloud<!----></a></li></ul></button></div></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/interview/" aria-label="Interview"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:account-tie" width="1em" height="1em"></iconify-icon><!--]-->Interview<!----></a></div><div class="vp-nav-item hide-in-mobile"><div class="vp-dropdown-wrapper"><button type="button" class="vp-dropdown-title" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon>About<!--]--><span class="arrow"></span><ul class="vp-dropdown"><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about-me.html" aria-label="About me"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="cib:about-me" width="1em" height="1em"></iconify-icon><!--]-->About me<!----></a></li><li class="vp-dropdown-item"><a class="route-link auto-link" href="/about.html" aria-label="About"><!--[--><iconify-icon class="font-icon icon" style="" mode="style" inline icon="mdi:about" width="1em" height="1em"></iconify-icon><!--]-->About<!----></a></li></ul></button></div></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/vanhung4499/my-wiki" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-outlook-button" tabindex="-1" aria-hidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon" name="outlook"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="vp-outlook-dropdown"><!----></div></button></div><!--[--><button type="button" class="search-pro-button" aria-label="Search"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">Search</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><!---->Distributed Transaction</h1><div class="page-info"><span class="page-author-info" aria-label="Authorüñä" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://vanhung4499.github.io" target="_blank" rel="noopener noreferrer">Hung Nguyen</a></span><span property="author" content="Hung Nguyen"></span></span><!----><span class="page-date-info" aria-label="Writing DateüìÖ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2024-10-02T17:20:50.000Z"></span><!----><span class="page-reading-time-info" aria-label="Reading Time‚åõ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>About 22 min</span><meta property="timeRequired" content="PT22M"></span><span class="page-category-info" aria-label="Categoryüåà" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color6 clickable" role="navigation">project</span><!--]--><meta property="articleSection" content="project"></span><span class="page-tag-info" aria-label="Tagüè∑" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color8 clickable" role="navigation">java</span><span class="page-tag-item color2 clickable" role="navigation">microservice</span><!--]--><meta property="keywords" content="java,microservice"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">On This Page<button type="button" class="print-button" title="Print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#giao-dich">Giao d·ªãch</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#giao-dich-cuc-bo">Giao d·ªãch c·ª•c b·ªô</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#giao-dich-phan-tan">Giao d·ªãch ph√¢n t√°n</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#giai-phap-giao-dich-phan-tan">Gi·∫£i ph√°p giao d·ªãch ph√¢n t√°n</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#gioi-thieu-seata">Gi·ªõi thi·ªáu Seata</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#seata-la-gi">Seata l√† g√¨?</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#co-che-tong-the">C∆° ch·∫ø t·ªïng th·ªÉ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#che-ƒëo-at">Ch·∫ø ƒë·ªô AT</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#che-ƒëo-tcc">Ch·∫ø ƒë·ªô TCC</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#che-ƒëo-saga">Ch·∫ø ƒë·ªô Saga</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cai-ƒëat-va-tai-xuong-seata">C√†i ƒë·∫∑t v√† t·∫£i xu·ªëng Seata</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tai-xuong">T·∫£i xu·ªëng</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#tao-co-so-du-lieu-va-bang">T·∫°o c∆° s·ªü d·ªØ li·ªáu v√† b·∫£ng</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#thay-ƒëoi-cau-hinh">Thay ƒë·ªïi c·∫•u h√¨nh</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#khoi-ƒëong-seata">Kh·ªüi ƒë·ªông Seata</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#pmhub-thuc-chien-them-nhiem-vu-quan-ly-giao-dich">PmHub Th·ª±c Chi·∫øn - Th√™m Nhi·ªám V·ª• Qu·∫£n L√Ω Giao D·ªãch</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#them-bang-undo-log-vao-co-so-du-lieu-nghiep-vu">Th√™m b·∫£ng undo_log v√†o c∆° s·ªü d·ªØ li·ªáu nghi·ªáp v·ª•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#them-phu-thuoc-vao-pmhub-project">Th√™m ph·ª• thu·ªôc v√†o pmhub-project:</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#them-cau-hinh-seata-vao-tep-cau-hinh-pmhub-project-dev-yml">Th√™m c·∫•u h√¨nh seata v√†o t·ªáp c·∫•u h√¨nh pmhub-project-dev.yml:</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#them-annotation-globaltransactional-vao-interface">Th√™m annotation @GlobalTransactional v√†o interface</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#bang-du-lieu">B·∫£ng d·ªØ li·ªáu</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#pmhub-thuc-chien-tao-moi-cap-nhat-trang-thai-phe-duyet">PmHub Th·ª±c Chi·∫øn - T·∫°o M·ªõi/C·∫≠p Nh·∫≠t Tr·∫°ng Th√°i Ph√™ Duy·ªát</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#cau-hoi-phong-van">C√¢u h·ªèi ph·ªèng v·∫•n</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><h1 id="pmhub-distributed-transaction-with-seata" tabindex="-1"><a class="header-anchor" href="#pmhub-distributed-transaction-with-seata"><span>PmHub - Distributed Transaction with Seata</span></a></h1><p>B√†i vi·∫øt n√†y ch·ªß y·∫øu n√≥i v·ªÅ c√°ch s·ª≠ d·ª•ng Seata ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n c·ªßa tr·∫°ng th√°i ph√™ duy·ªát nhi·ªám v·ª• trong h·ªá th·ªëng PmHub.</p><p>Giao d·ªãch ph√¢n t√°n lu√¥n l√† m·ªôt ch·ªß ƒë·ªÅ ph·ªèng v·∫•n ƒë∆∞·ª£c ∆∞a chu·ªông, nh∆∞ng t√¥i nh·∫≠n th·∫•y c√°c h∆∞·ªõng d·∫´n tr√™n m·∫°ng th∆∞·ªùng t·∫≠p trung nhi·ªÅu v√†o l√Ω thuy·∫øt m√† √≠t li√™n k·∫øt v·ªõi c√°c d·ª± √°n th·ª±c t·∫ø. Trong khi ƒë√≥, ph·ªèng v·∫•n th∆∞·ªùng d·ª±a tr√™n nh·ªØng t√¨nh hu·ªëng th·ª±c ti·ªÖn ƒë·ªÉ ki·ªÉm tra ki·∫øn th·ª©c c·ªßa ·ª©ng vi√™n. M·ª•c ti√™u c·ªßa ch√∫ng ta l√† k·∫øt h·ª£p l√Ω thuy·∫øt v·ªõi th·ª±c h√†nh, gi√∫p b·∫°n tr√°nh ƒë∆∞·ª£c nhi·ªÅu tr·ªü ng·∫°i.</p><p>Th√¥ng qua b√†i vi·∫øt n√†y, b·∫°n s·∫Ω hi·ªÉu r√µ v·ªÅ giao d·ªãch ph√¢n t√°n v√† c√°ch s·ª≠ d·ª•ng n√≥ trong PmHub. ƒê√¢y s·∫Ω l√† n·ªÅn t·∫£ng v·ªØng ch·∫Øc t·ª´ l√Ω thuy·∫øt ƒë·∫øn th·ª±c h√†nh!</p><p><strong><!----></strong></p><div class="hint-container info"><p class="hint-container-title">Info</p><ul><li>ƒê·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n c·ªßa tr·∫°ng th√°i ph√™ duy·ªát nhi·ªám v·ª•, ch√∫ng t√¥i s·ª≠ d·ª•ng <strong>ch·∫ø ƒë·ªô AT c·ªßa giao d·ªãch ph√¢n t√°n Seata</strong>.</li></ul></div><h2 id="giao-dich" tabindex="-1"><a class="header-anchor" href="#giao-dich"><span>Giao d·ªãch</span></a></h2><p>Ch√∫ng ta h√£y t∆∞·ªüng t∆∞·ª£ng m·ªôt t√¨nh hu·ªëng:</p><div class="hint-container info"><p class="hint-container-title">Info</p><p>Gi·∫£ s·ª≠ ng∆∞·ªùi d√πng A chuy·ªÉn 100 nh√¢n d√¢n t·ªá cho ng∆∞·ªùi d√πng B, quy tr√¨nh n√†y bao g·ªìm c√°c b∆∞·ªõc sau:</p><ol><li>Tr·ª´ 100 nh√¢n d√¢n t·ªá t·ª´ t√†i kho·∫£n c·ªßa ng∆∞·ªùi d√πng A.</li><li>C·ªông 100 nh√¢n d√¢n t·ªá v√†o t√†i kho·∫£n c·ªßa ng∆∞·ªùi d√πng B.</li></ol><p>Hai b∆∞·ªõc n√†y ho·∫∑c ph·∫£i th·ª±c hi·ªán th√†nh c√¥ng c·∫£ hai, ho·∫∑c kh√¥ng th·ª±c hi·ªán g√¨. N·∫øu b∆∞·ªõc 1 ƒë√£ tr·ª´ 100 nh√¢n d√¢n t·ªá nh∆∞ng x·∫£y ra l·ªói khi th·ª±c hi·ªán b∆∞·ªõc 2, ch√∫ng ta mu·ªën s·ªë ti·ªÅn trong t√†i kho·∫£n c·ªßa ng∆∞·ªùi d√πng A tr·ªü v·ªÅ tr·∫°ng th√°i ban ƒë·∫ßu.</p></div><p>ƒê√¢y l√† m·ªôt v√≠ d·ª• ƒëi·ªÉn h√¨nh v·ªÅ giao d·ªãch. Giao d·ªãch l√† g√¨? N√≥i ƒë∆°n gi·∫£n, giao d·ªãch l√† m·ªôt t·∫≠p h·ª£p c√°c thao t√°c logic, <strong>ho·∫∑c t·∫•t c·∫£ ƒë·ªÅu th·ª±c hi·ªán, ho·∫∑c kh√¥ng th·ª±c hi·ªán g√¨ c·∫£</strong>.</p><p>D∆∞·ªõi ƒë√¢y l√† m·ªôt b·ªô c√¢u h·ªèi kinh ƒëi·ªÉn ƒë·ªÉ ki·ªÉm tra hi·ªÉu bi·∫øt v·ªÅ b·ªën t√≠nh ch·∫•t c·ªßa giao d·ªãch, h√£y ghi nh·ªõ ƒë·ªÉ chu·∫©n b·ªã cho ph·ªèng v·∫•n.</p><div class="hint-container info"><p class="hint-container-title">Info</p><h3 id="bon-tinh-chat-cua-giao-dich-acid" tabindex="-1"><a class="header-anchor" href="#bon-tinh-chat-cua-giao-dich-acid"><span>B·ªën t√≠nh ch·∫•t c·ªßa giao d·ªãch (ACID)</span></a></h3><ol><li><strong>T√≠nh nguy√™n t·ª≠ (Atomicity)</strong>: <ul><li>T·∫•t c·∫£ c√°c thao t√°c trong giao d·ªãch ho·∫∑c th√†nh c√¥ng, ho·∫∑c th·∫•t b·∫°i. Ngay c·∫£ trong tr∆∞·ªùng h·ª£p h·ªá th·ªëng g·∫∑p s·ª± c·ªë, giao d·ªãch v·∫´n ƒë·∫£m b·∫£o kh√¥ng th·ª±c hi·ªán ch·ªâ m·ªôt ph·∫ßn c·ªßa thao t√°c.</li><li><strong>V√≠ d·ª•</strong>: Trong thao t√°c chuy·ªÉn kho·∫£n, vi·ªác tr·ª´ ti·ªÅn t·ª´ t√†i kho·∫£n n√†y v√† c·ªông ti·ªÅn v√†o t√†i kho·∫£n kh√°c ph·∫£i th√†nh c√¥ng ho·∫∑c th·∫•t b·∫°i to√†n b·ªô.</li></ul></li><li><strong>T√≠nh nh·∫•t qu√°n (Consistency)</strong>: <ul><li>Tr∆∞·ªõc v√† sau khi th·ª±c hi·ªán giao d·ªãch, c∆° s·ªü d·ªØ li·ªáu ph·∫£i ·ªü tr·∫°ng th√°i nh·∫•t qu√°n. M·ªçi giao d·ªãch ƒë·ªÅu ph·∫£i ƒë·∫£m b·∫£o c∆° s·ªü d·ªØ li·ªáu chuy·ªÉn t·ª´ m·ªôt tr·∫°ng th√°i nh·∫•t qu√°n n√†y sang m·ªôt tr·∫°ng th√°i nh·∫•t qu√°n kh√°c.</li><li><strong>V√≠ d·ª•</strong>: Sau khi chuy·ªÉn kho·∫£n, t·ªïng s·ªë ti·ªÅn trong hai t√†i kho·∫£n v·∫´n ph·∫£i gi·ªØ nguy√™n.</li></ul></li><li><strong>T√≠nh c√°ch ly (Isolation)</strong>: <ul><li>C√°c giao d·ªãch ƒë·ªìng th·ªùi kh√¥ng ƒë∆∞·ª£c ·∫£nh h∆∞·ªüng l·∫´n nhau, tr·∫°ng th√°i trung gian c·ªßa m·ªôt giao d·ªãch kh√¥ng th·ªÉ b·ªã c√°c giao d·ªãch kh√°c nh√¨n th·∫•y.</li><li><strong>V√≠ d·ª•</strong>: Hai thao t√°c chuy·ªÉn kho·∫£n di·ªÖn ra c√πng l√∫c s·∫Ω kh√¥ng ·∫£nh h∆∞·ªüng l·∫´n nhau, v√† m·ªói thao t√°c kh√¥ng th·∫•y ƒë∆∞·ª£c tr·∫°ng th√°i trung gian c·ªßa thao t√°c kia.</li></ul></li><li><strong>T√≠nh b·ªÅn v·ªØng (Durability)</strong>: <ul><li>M·ªôt khi giao d·ªãch ƒë√£ ƒë∆∞·ª£c ho√†n th√†nh, k·∫øt qu·∫£ c·ªßa n√≥ l√† vƒ©nh vi·ªÖn, ngay c·∫£ khi h·ªá th·ªëng b·ªã s·ª± c·ªë, k·∫øt qu·∫£ giao d·ªãch c≈©ng kh√¥ng b·ªã m·∫•t.</li><li><strong>V√≠ d·ª•</strong>: Sau khi chuy·ªÉn kho·∫£n th√†nh c√¥ng, ngay c·∫£ khi h·ªá th·ªëng kh·ªüi ƒë·ªông l·∫°i, bi·∫øn ƒë·ªông s·ªë ti·ªÅn trong t√†i kho·∫£n v·∫´n t·ªìn t·∫°i.</li></ul></li></ol></div><h2 id="giao-dich-cuc-bo" tabindex="-1"><a class="header-anchor" href="#giao-dich-cuc-bo"><span>Giao d·ªãch c·ª•c b·ªô</span></a></h2><p>Trong ·ª©ng d·ª•ng ƒë∆°n th·ªÉ, c√°c giao d·ªãch th∆∞·ªùng l√† giao d·ªãch c·ª•c b·ªô. V√≠ d·ª•, trong Spring Boot, khi th√™m annotation @Transactional v√†o ph∆∞∆°ng th·ª©c, ch√∫ng ta ƒëang th·ª±c hi·ªán m·ªôt giao d·ªãch c·ª•c b·ªô.</p><p>Trong h·ªá th·ªëng ƒë∆°n th·ªÉ, m·ªôt thao t√°c c√≥ th·ªÉ li√™n quan ƒë·∫øn nhi·ªÅu b·∫£ng, nh∆∞ng t·∫•t c·∫£ ƒë·ªÅu n·∫±m trong c√πng m·ªôt c∆° s·ªü d·ªØ li·ªáu. V√≠ d·ª•, trong MySQL, m·ªôt giao d·ªãch c√≥ th·ªÉ bao g·ªìm nhi·ªÅu c√¢u l·ªánh SQL. T·∫•t c·∫£ c√°c c√¢u l·ªánh n√†y ho·∫∑c th√†nh c√¥ng, ho·∫∑c th·∫•t b·∫°i. MySQL h·ªó tr·ª£ giao d·ªãch qua engine <strong>InnoDB</strong>, trong khi <strong>MyISAM</strong> th√¨ kh√¥ng h·ªó tr·ª£ giao d·ªãch.</p><p>Trong MySQL, giao d·ªãch ƒë∆∞·ª£c qu·∫£n l√Ω b·∫±ng <strong>redo log</strong> v√† <strong>undo log</strong>. <strong>redo log</strong> gi√∫p ph·ª•c h·ªìi tr∆∞·ªõc khi giao d·ªãch ƒë∆∞·ª£c cam k·∫øt, ƒë·∫£m b·∫£o <strong>t√≠nh b·ªÅn v·ªØng</strong>. <strong>undo log</strong> gi√∫p ph·ª•c h·ªìi sau khi giao d·ªãch ƒë∆∞·ª£c cam k·∫øt, ƒë·∫£m b·∫£o <strong>t√≠nh nguy√™n t·ª≠</strong>. D∆∞·ªõi ƒë√¢y l√† m·ªôt bi·ªÉu ƒë·ªì minh h·ªça:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-mysql-log.drawio.png" alt="pmhub-mysql-log.drawio.png" tabindex="0" loading="lazy"><figcaption>pmhub-mysql-log.drawio.png</figcaption></figure><h2 id="giao-dich-phan-tan" tabindex="-1"><a class="header-anchor" href="#giao-dich-phan-tan"><span>Giao d·ªãch ph√¢n t√°n</span></a></h2><p>Trong h·ªá th·ªëng ph√¢n t√°n microservice, c√°c h·ªá th·ªëng ƒë∆°n th·ªÉ ban ƒë·∫ßu ƒë∆∞·ª£c chia nh·ªè th√†nh nhi·ªÅu microservice. V√≠ d·ª•, trong PmHub, h·ªá th·ªëng ƒë∆∞·ª£c chia th√†nh d·ªãch v·ª• h·ªá th·ªëng, d·ªãch v·ª• d·ª± √°n, d·ªãch v·ª• quy tr√¨nh, v.v. Trong c√°c ·ª©ng d·ª•ng th·ª±c t·∫ø, m·ªói microservice c√≥ th·ªÉ ƒë∆∞·ª£c tri·ªÉn khai tr√™n c√°c m√°y kh√°c nhau v√† c∆° s·ªü d·ªØ li·ªáu c·ªßa ch√∫ng c≈©ng ƒë∆∞·ª£c t√°ch bi·ªát. V√≠ d·ª•, trong PmHub, d·ªãch v·ª• pmhub-project s·ª≠ d·ª•ng c∆° s·ªü d·ªØ li·ªáu pmhub-project, c√≤n d·ªãch v·ª• pmhub-workflow s·ª≠ d·ª•ng c∆° s·ªü d·ªØ li·ªáu pmhub-workflow.</p><p>Trong tr∆∞·ªùng h·ª£p n√†y, m·ªôt thao t√°c c√≥ th·ªÉ li√™n quan ƒë·∫øn nhi·ªÅu m√°y, nhi·ªÅu d·ªãch v·ª•, v√† nhi·ªÅu c∆° s·ªü d·ªØ li·ªáu. V√≠ d·ª•, trong k·ªãch b·∫£n th√™m nhi·ªám v·ª• c·ªßa PmHub:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-add-task.drawio.png" alt="pmhub-add-task.drawio.png" tabindex="0" loading="lazy"><figcaption>pmhub-add-task.drawio.png</figcaption></figure><p>V·∫≠y l√†m th·∫ø n√†o ƒë·ªÉ ƒë·∫£m b·∫£o m·ªôt thao t√°c <strong>ho·∫∑c th·ª±c hi·ªán th√†nh c√¥ng t·∫•t c·∫£, ho·∫∑c th·∫•t b·∫°i t·∫•t c·∫£</strong>?</p><p>Ch√∫ng ta c·∫ßn s·ª≠ d·ª•ng gi·∫£i ph√°p giao d·ªãch ph√¢n t√°n. Giao d·ªãch c·ª•c b·ªô gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ nh·∫•t qu√°n d·ªØ li·ªáu c·ªßa m·ªôt ngu·ªìn d·ªØ li·ªáu duy nh·∫•t, c√≤n giao d·ªãch ph√¢n t√°n gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ nh·∫•t qu√°n d·ªØ li·ªáu <strong>ƒëa ngu·ªìn</strong>.</p><h2 id="giai-phap-giao-dich-phan-tan" tabindex="-1"><a class="header-anchor" href="#giai-phap-giao-dich-phan-tan"><span>Gi·∫£i ph√°p giao d·ªãch ph√¢n t√°n</span></a></h2><p>Vi·ªác tri·ªÉn khai giao d·ªãch ph√¢n t√°n ch·ªß y·∫øu c√≥ 6 gi·∫£i ph√°p sau ƒë√¢y:</p><ul><li>Gi·∫£i ph√°p XA</li><li>Gi·∫£i ph√°p TCC</li><li>Gi·∫£i ph√°p SAGA</li><li>B·∫£ng tin nh·∫Øn c·ª•c b·ªô</li><li>Gi·∫£i ph√°p nh·∫•t qu√°n cu·ªëi c√πng c·ªßa tin nh·∫Øn ƒë√°ng tin c·∫≠y</li><li>Gi·∫£i ph√°p th√¥ng b√°o t·ªëi ƒëa</li></ul><p>Trong ƒë√≥, chu·∫©n XA ƒë√£ ph√°t tri·ªÉn th√†nh gi·∫£i ph√°p 2PC, 3PC kh√¥ng x√¢m nh·∫≠p m√£ nghi·ªáp v·ª•, c√≤n TCC v√† SAGA thu·ªôc c√°c gi·∫£i ph√°p c√≥ s·ª± x√¢m nh·∫≠p v√†o nghi·ªáp v·ª•, v√† b·∫£ng tin nh·∫Øn c·ª•c b·ªô kh√¥ng h·ªó tr·ª£ ho√†n t√°c.</p><p>M·ªói gi·∫£i ph√°p c√≥ c√°c tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng kh√°c nhau, b·∫£ng d∆∞·ªõi ƒë√¢y l√† so s√°nh gi·ªØa c√°c gi·∫£i ph√°p n√†y:</p><table><thead><tr><th>Gi·∫£i ph√°p</th><th>M√¥ t·∫£</th><th>∆Øu ƒëi·ªÉm</th><th>Nh∆∞·ª£c ƒëi·ªÉm</th><th>Tr∆∞·ªùng h·ª£p s·ª≠ d·ª•ng</th></tr></thead><tbody><tr><td>Gi·∫£i ph√°p XA</td><td>Hai giai ƒëo·∫°n x√°c nh·∫≠n, s·ª≠ d·ª•ng b·ªô qu·∫£n l√Ω giao d·ªãch ƒë·ªÉ ƒëi·ªÅu ph·ªëi nhi·ªÅu c∆° s·ªü d·ªØ li·ªáu, th√≠ch h·ª£p cho c√°c giao d·ªãch ph√¢n t√°n gi·ªØa nhi·ªÅu c∆° s·ªü d·ªØ li·ªáu trong ·ª©ng d·ª•ng</td><td>T√≠nh nh·∫•t qu√°n m·∫°nh</td><td>Hi·ªáu su·∫•t th·∫•p, kh√¥ng ph√π h·ª£p cho c√°c t√¨nh hu·ªëng y√™u c·∫ßu ƒë·ªìng th·ªùi cao</td><td>·ª®ng d·ª•ng ƒë∆°n kh·ªëi, giao d·ªãch ph√¢n t√°n gi·ªØa nhi·ªÅu c∆° s·ªü d·ªØ li·ªáu</td></tr><tr><td>Gi·∫£i ph√°p TCC</td><td>Try-Confirm-Cancel, qu·∫£n l√Ω giao d·ªãch qua ba giai ƒëo·∫°n, giai ƒëo·∫°n Try ki·ªÉm tra v√† d·ª± tr·ªØ t√†i nguy√™n, giai ƒëo·∫°n Confirm th·ª±c hi·ªán h√†nh ƒë·ªông, giai ƒëo·∫°n Cancel ho√†n t√°c b·ªìi th∆∞·ªùng</td><td>T√≠nh nh·∫•t qu√°n m·∫°nh, ph√π h·ª£p v·ªõi quy tr√¨nh ng·∫Øn v√† t√¨nh hu·ªëng y√™u c·∫ßu ƒë·ªìng th·ªùi cao</td><td>M√£ ho√†n t√°c ph·ª©c t·∫°p, kh√≥ b·∫£o tr√¨</td><td>C√°c tr∆∞·ªùng h·ª£p li√™n quan ƒë·∫øn thanh to√°n, giao d·ªãch t√†i ch√≠nh</td></tr><tr><td>Gi·∫£i ph√°p SAGA</td><td>Giao d·ªãch ho√†n t√°c, ƒë·∫£m b·∫£o nh·∫•t qu√°n cu·ªëi c√πng th√¥ng qua giao d·ªãch c·ª•c b·ªô v√† h√†nh ƒë·ªông ho√†n t√°c, khi m·ªôt giao d·ªãch th·∫•t b·∫°i, th·ª±c hi·ªán ng∆∞·ª£c l·∫°i c√°c h√†nh ƒë·ªông ƒë√£ th√†nh c√¥ng ƒë·ªÉ ho√†n t√°c</td><td>Kh√¥ng c·∫ßn kh√≥a, hi·ªáu su·∫•t cao, c√°c th√†nh vi√™n c√≥ th·ªÉ th·ª±c hi·ªán kh√¥ng ƒë·ªìng b·ªô</td><td>Kh√¥ng ƒë·∫£m b·∫£o t√≠nh c√°ch ly c·ªßa giao d·ªãch</td><td>C√°c quy tr√¨nh nghi·ªáp v·ª• d√†i, c√≥ s·ª± tham gia c·ªßa c√°c c√¥ng ty kh√°c ho·∫∑c h·ªá th·ªëng k·∫ø th·ª´a</td></tr><tr><td>B·∫£ng tin nh·∫Øn c·ª•c b·ªô</td><td>Ch√®n tin nh·∫Øn v√†o b·∫£ng tin nh·∫Øn trong giao d·ªãch c·ª•c b·ªô v√† g·ª≠i tin nh·∫Øn ƒë·∫øn MQ, ng∆∞·ªùi nh·∫≠n x·ª≠ l√Ω tin nh·∫Øn trong giao d·ªãch c·ª•c b·ªô v√† c·∫≠p nh·∫≠t tr·∫°ng th√°i tin nh·∫Øn, n·∫øu th·∫•t b·∫°i s·∫Ω th·ª≠ l·∫°i theo l·ªãch</td><td>ƒê·∫£m b·∫£o t√≠nh nh·∫•t qu√°n cu·ªëi c√πng, ph√π h·ª£p v·ªõi t√¨nh hu·ªëng y√™u c·∫ßu ƒë·ªìng th·ªùi th·∫•p</td><td>Ph·ª• thu·ªôc nhi·ªÅu v√†o b·∫£ng tin nh·∫Øn trong c∆° s·ªü d·ªØ li·ªáu, kh·∫£ nƒÉng m·ªü r·ªông k√©m trong t√¨nh hu·ªëng y√™u c·∫ßu ƒë·ªìng th·ªùi cao</td><td>T√¨nh hu·ªëng y√™u c·∫ßu ƒë·ªìng th·ªùi th·∫•p</td></tr><tr><td>Gi·∫£i ph√°p nh·∫•t qu√°n cu·ªëi c√πng c·ªßa tin nh·∫Øn ƒë√°ng tin c·∫≠y</td><td>D·ª±a tr√™n MQ ƒë·ªÉ th·ª±c hi·ªán giao d·ªãch, g·ª≠i tin nh·∫Øn d·ª± ph√≤ng tr∆∞·ªõc, sau khi th·ª±c hi·ªán giao d·ªãch c·ª•c b·ªô s·∫Ω x√°c nh·∫≠n ho·∫∑c ho√†n t√°c tin nh·∫Øn, MQ s·∫Ω ki·ªÉm tra tr·∫°ng th√°i tin nh·∫Øn d·ª± ph√≤ng theo l·ªãch v√† g·ªçi l·∫°i ƒë·ªÉ x√°c nh·∫≠n</td><td>Ph√π h·ª£p v·ªõi t√¨nh hu·ªëng y√™u c·∫ßu ƒë·ªìng th·ªùi cao, ƒë·ªô tin c·∫≠y cao</td><td>X·ª≠ l√Ω ph·ª©c t·∫°p, n·∫øu giao d·ªãch c·ªßa h·ªá th·ªëng B th·∫•t b·∫°i c·∫ßn ph·∫£i th·ª≠ l·∫°i ho·∫∑c x·ª≠ l√Ω th·ªß c√¥ng</td><td>T√¨nh hu·ªëng y√™u c·∫ßu ƒë·ªìng th·ªùi cao, ƒë∆∞·ª£c s·ª≠ d·ª•ng r·ªông r√£i t·∫°i c√°c c√¥ng ty internet trong n∆∞·ªõc</td></tr><tr><td>Gi·∫£i ph√°p th√¥ng b√°o t·ªëi ƒëa</td><td>H·ªá th·ªëng A g·ª≠i tin nh·∫Øn ƒë·∫øn MQ sau khi ho√†n th√†nh giao d·ªãch c·ª•c b·ªô, d·ªãch v·ª• th√¥ng b√°o t·ªëi ƒëa s·∫Ω ti√™u th·ª• tin nh·∫Øn v√† g·ªçi h·ªá th·ªëng B, n·∫øu h·ªá th·ªëng B th·∫•t b·∫°i th√¨ s·∫Ω th·ª≠ l·∫°i theo l·ªãch, n·∫øu v·∫´n th·∫•t b·∫°i s·∫Ω b·ªè qua</td><td>ƒê∆°n gi·∫£n, d·ªÖ th·ª±c hi·ªán, ph√π h·ª£p v·ªõi nh·ªØng tr∆∞·ªùng h·ª£p kh√¥ng y√™u c·∫ßu t√≠nh nh·∫•t qu√°n cao</td><td>Kh√¥ng ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n tuy·ªát ƒë·ªëi</td><td>C√°c t√¨nh hu·ªëng kh√¥ng y√™u c·∫ßu t√≠nh nh·∫•t qu√°n cao, ch·∫≥ng h·∫°n nh∆∞ c√°c thao t√°c nghi·ªáp v·ª• kh√¥ng quan tr·ªçng</td></tr></tbody></table><h2 id="gioi-thieu-seata" tabindex="-1"><a class="header-anchor" href="#gioi-thieu-seata"><span>Gi·ªõi thi·ªáu Seata</span></a></h2><h3 id="seata-la-gi" tabindex="-1"><a class="header-anchor" href="#seata-la-gi"><span>Seata l√† g√¨?</span></a></h3><p>Seata l√† m·ªôt gi·∫£i ph√°p giao d·ªãch ph√¢n t√°n m√£ ngu·ªìn m·ªü c·ªßa Alibaba, l√† m·ªôt khung giao d·ªãch t·ª± tr·ªã ƒë∆°n gi·∫£n v√† m·ªü r·ªông ƒë∆∞·ª£c üëç.</p><ul><li>ƒê·ªãa ch·ªâ trang web ch√≠nh th·ª©c: <a href="https://seata.apache.org/" target="_blank" rel="noopener noreferrer">https://seata.apache.org</a></li><li>ƒê·ªãa ch·ªâ m√£ ngu·ªìn: <a href="https://github.com/apache/incubator-seata" target="_blank" rel="noopener noreferrer">https://github.com/apache/incubator-seata</a></li></ul><p>V·ªõi Seata, ch√∫ng ta ch·ªâ c·∫ßn th√™m annotation <code>@GlobalTransactional</code> t·∫°i nh·ªØng n∆°i c·∫ßn s·ª≠ d·ª•ng giao d·ªãch ph√¢n t√°n.</p><figure><img src="https://seata.apache.org/assets/images/solution-1bdadb80e54074aa3088372c17f0244b.png" alt="" tabindex="0" loading="lazy"><figcaption></figcaption></figure><h3 id="co-che-tong-the" tabindex="-1"><a class="header-anchor" href="#co-che-tong-the"><span>C∆° ch·∫ø t·ªïng th·ªÉ</span></a></h3><p>Seata h·ªó tr·ª£ 3 ch·∫ø ƒë·ªô: ch·∫ø ƒë·ªô AT, ch·∫ø ƒë·ªô TCC v√† ch·∫ø ƒë·ªô Saga.</p><table><thead><tr><th>Ch·∫ø ƒë·ªô</th><th>M√¥ t·∫£</th><th>∆Øu ƒëi·ªÉm</th><th>Nh∆∞·ª£c ƒëi·ªÉm</th><th>C√°c t√¨nh hu·ªëng ph√π h·ª£p</th></tr></thead><tbody><tr><td>Ch·∫ø ƒë·ªô AT</td><td>Giao d·ªãch b·ªìi th∆∞·ªùng t·ª± ƒë·ªông, t·ª± ƒë·ªông qu·∫£n l√Ω vi·ªác cam k·∫øt v√† rollback giao d·ªãch th√¥ng qua proxy, ph√π h·ª£p cho c√°c t√¨nh hu·ªëng ƒë∆°n gi·∫£n</td><td>D·ªÖ s·ª≠ d·ª•ng, chi ph√≠ ph√°t tri·ªÉn th·∫•p, t·ª± ƒë·ªông qu·∫£n l√Ω giao d·ªãch</td><td>Ph·ª• thu·ªôc v√†o h·ªó tr·ª£ c·ªßa c∆° s·ªü d·ªØ li·ªáu, ph√π h·ª£p v·ªõi c√°c t√¨nh hu·ªëng ƒë∆°n gi·∫£n, kh√¥ng ph√π h·ª£p v·ªõi logic nghi·ªáp v·ª• ph·ª©c t·∫°p</td><td>T√¨nh hu·ªëng nghi·ªáp v·ª• ƒë∆°n gi·∫£n, nh∆∞ thao t√°c b·∫£ng ƒë∆°n, c√°c d·ªãch v·ª• vi m√¥ nh·ªè</td></tr><tr><td>Ch·∫ø ƒë·ªô TCC</td><td>Try-Confirm-Cancel, nh√† ph√°t tri·ªÉn t·ª± th·ª±c hi·ªán logic nghi·ªáp v·ª• c·ªßa ba giai ƒëo·∫°n Try, Confirm v√† Cancel ƒë·ªÉ ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n c·ªßa giao d·ªãch</td><td>Cung c·∫•p t√≠nh nh·∫•t qu√°n m·∫°nh, ph√π h·ª£p cho c√°c t√¨nh hu·ªëng y√™u c·∫ßu qu·∫£n l√Ω giao d·ªãch nghi√™m ng·∫∑t</td><td>Th·ª±c hi·ªán ph·ª©c t·∫°p, chi ph√≠ ph√°t tri·ªÉn cao, c·∫ßn t·ª± qu·∫£n l√Ω c√°c giai ƒëo·∫°n c·ªßa giao d·ªãch</td><td>T√¨nh hu·ªëng y√™u c·∫ßu t√≠nh nh·∫•t qu√°n cao v√† c√°c thao t√°c nghi·ªáp v·ª• ng·∫Øn, nh∆∞ h·ªá th·ªëng thanh to√°n, giao d·ªãch li√™n quan ƒë·∫øn t√†i ch√≠nh</td></tr><tr><td>Ch·∫ø ƒë·ªô Saga</td><td>Giao d·ªãch d√†i, ho√†n th√†nh giao d·ªãch ch√≠nh th√¥ng qua m·ªôt lo·∫°t c√°c giao d·ªãch con, c√°c giao d·ªãch con ho·∫°t ƒë·ªông ƒë·ªôc l·∫≠p, n·∫øu m·ªôt giao d·ªãch con th·∫•t b·∫°i, s·∫Ω th·ª±c hi·ªán rollback c√°c giao d·ªãch ƒë√£ th√†nh c√¥ng tr∆∞·ªõc ƒë√≥</td><td>Kh√¥ng c·∫ßn kh√≥a to√†n c·ª•c, hi·ªáu su·∫•t cao, ph√π h·ª£p cho c√°c t√¨nh hu·ªëng giao d·ªãch d√†i</td><td>C·∫ßn ph√°t tri·ªÉn logic b·ªìi th∆∞·ªùng, c√≥ th·ªÉ kh√¥ng ƒë·∫£m b·∫£o t√≠nh nh·∫•t qu√°n m·∫°nh</td><td>T√¨nh hu·ªëng nghi·ªáp v·ª• d√†i, li√™n quan ƒë·∫øn nhi·ªÅu h·ªá th·ªëng ho·∫∑c d·ªãch v·ª•, nh∆∞ qu·∫£n l√Ω ƒë∆°n h√†ng, qu·∫£n l√Ω chu·ªói cung ·ª©ng</td></tr></tbody></table><h3 id="che-ƒëo-at" tabindex="-1"><a class="header-anchor" href="#che-ƒëo-at"><span>Ch·∫ø ƒë·ªô AT</span></a></h3><p>Ch·∫ø ƒë·ªô AT th·ª±c ch·∫•t l√† giao th·ª©c 2PC, ph√π h·ª£p cho h·∫ßu h·∫øt c√°c t√¨nh hu·ªëng, c·∫•u h√¨nh v√† s·ª≠ d·ª•ng t∆∞∆°ng ƒë·ªëi ƒë∆°n gi·∫£n. PmHub s·ª≠ d·ª•ng ch·∫ø ƒë·ªô AT, d∆∞·ªõi ƒë√¢y l√† m·ªôt quy tr√¨nh c·ª• th·ªÉ:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919143501.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="che-ƒëo-tcc" tabindex="-1"><a class="header-anchor" href="#che-ƒëo-tcc"><span>Ch·∫ø ƒë·ªô TCC</span></a></h3><p>Ch·∫ø ƒë·ªô TCC l√† ch·∫ø ƒë·ªô h·ªó tr·ª£ ƒë∆∞a c√°c giao d·ªãch con t√πy ch·ªânh v√†o trong vi·ªác qu·∫£n l√Ω giao d·ªãch to√†n c·ª•c.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919151242.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><h3 id="che-ƒëo-saga" tabindex="-1"><a class="header-anchor" href="#che-ƒëo-saga"><span>Ch·∫ø ƒë·ªô Saga</span></a></h3><p>Ch·∫ø ƒë·ªô Saga l√† gi·∫£i ph√°p giao d·ªãch d√†i do Seata cung c·∫•p. Trong ch·∫ø ƒë·ªô Saga, m·ªói ng∆∞·ªùi tham gia trong quy tr√¨nh nghi·ªáp v·ª• s·∫Ω th·ª±c hi·ªán giao d·ªãch c·ª•c b·ªô c·ªßa m√¨nh. Khi m·ªôt ng∆∞·ªùi tham gia th·∫•t b·∫°i, h·ªá th·ªëng s·∫Ω th·ª±c hi·ªán b·ªìi th∆∞·ªùng c√°c giao d·ªãch ƒë√£ th√†nh c√¥ng tr∆∞·ªõc ƒë√≥. D·ªãch v·ª• giai ƒëo·∫°n m·ªôt (d·ªãch v·ª• ch√≠nh) v√† d·ªãch v·ª• giai ƒëo·∫°n hai (d·ªãch v·ª• b·ªìi th∆∞·ªùng) ƒë·ªÅu do c√°c nh√† ph√°t tri·ªÉn nghi·ªáp v·ª• th·ª±c hi·ªán.</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919151318.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Ti·∫øp theo l√† ph·∫ßn th·ª±c h√†nh giao d·ªãch ph√¢n t√°n v·ªõi Seata.</p><h2 id="cai-ƒëat-va-tai-xuong-seata" tabindex="-1"><a class="header-anchor" href="#cai-ƒëat-va-tai-xuong-seata"><span>C√†i ƒë·∫∑t v√† t·∫£i xu·ªëng Seata</span></a></h2><h3 id="tai-xuong" tabindex="-1"><a class="header-anchor" href="#tai-xuong"><span>T·∫£i xu·ªëng</span></a></h3><p>ƒê·ªãa ch·ªâ t·∫£i v·ªÅ: <a href="https://seata.apache.org/unversioned/download/seata-server" target="_blank" rel="noopener noreferrer">https://seata.apache.org/unversioned/download/seata-server</a></p><p>T·∫£i phi√™n b·∫£n m·ªõi nh·∫•t 2.0.0</p><h3 id="tao-co-so-du-lieu-va-bang" tabindex="-1"><a class="header-anchor" href="#tao-co-so-du-lieu-va-bang"><span>T·∫°o c∆° s·ªü d·ªØ li·ªáu v√† b·∫£ng</span></a></h3><p>V√¨ Seata s·ª≠ d·ª•ng MySQL l√†m c∆° s·ªü d·ªØ li·ªáu c√≥ t√≠nh kh·∫£ d·ª•ng cao, n√™n c·∫ßn t·∫°o m·ªôt c∆° s·ªü d·ªØ li·ªáu <code>pmhub-seata</code> trong MySQL v√† nh·∫≠p script c∆° s·ªü d·ªØ li·ªáu.</p><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DATABASE</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `pmhub-seata`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> CHARACTER</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> SET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4 </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">COLLATE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4_general_ci;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> NAMES utf8mb4;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> FOREIGN_KEY_CHECKS </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">USE</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `pmhub-seata`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- -------------------------------- The script used when storeMode is &#39;db&#39; --------------------------------</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- the table to store GlobalSession data</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `global_table`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `xid`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                       VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `transaction_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            BIGINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `status`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                    TINYINT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `application_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `transaction_service_group`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `transaction_name`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">          VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `timeout`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                   INT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `begin_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                BIGINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `application_data`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">          VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `gmt_create`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">                DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `gmt_modified`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">              DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`xid`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `idx_status_gmt_modified`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`status`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> , </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`gmt_modified`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `idx_transaction_id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`transaction_id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- the table to store BranchSession data</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `branch_table`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `branch_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">         BIGINT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `xid`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">               VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `transaction_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    BIGINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `resource_group_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `resource_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `branch_type`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">8</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `status`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            TINYINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `client_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">         VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `application_data`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2000</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `gmt_create`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `gmt_modified`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`branch_id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `idx_xid`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`xid`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- the table to store lock data</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `lock_table`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `row_key`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `xid`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">            VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `transaction_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> BIGINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `branch_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      BIGINT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `resource_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">256</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `table_name`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">     VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `pk`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">             VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">36</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `status`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">         TINYINT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">      NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;0:locked ,1:rollbacking&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `gmt_create`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">     DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `gmt_modified`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`row_key`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `idx_status`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`status`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `idx_branch_id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`branch_id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `idx_xid`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`xid`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `distributed_lock`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `lock_key`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       CHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `lock_value`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">     VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `expire`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">         BIGINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    primary key</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`lock_key`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> InnoDB</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `distributed_lock`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (lock_key, lock_value, expire) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;AsyncCommitting&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39; &#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `distributed_lock`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (lock_key, lock_value, expire) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;RetryCommitting&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39; &#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `distributed_lock`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (lock_key, lock_value, expire) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;RetryRollbacking&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39; &#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">INSERT INTO</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `distributed_lock`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (lock_key, lock_value, expire) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">VALUES</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;TxTimeoutCheck&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39; &#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">SET</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> FOREIGN_KEY_CHECKS </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="thay-ƒëoi-cau-hinh" tabindex="-1"><a class="header-anchor" href="#thay-ƒëoi-cau-hinh"><span>Thay ƒë·ªïi c·∫•u h√¨nh</span></a></h3><p>Ch·ªß y·∫øu l√† thay ƒë·ªïi c·ªïng v√† c·∫•u h√¨nh li√™n quan ƒë·∫øn Nacos. ƒê·ªÉ tr√°nh vi·ªác s·ª≠a c·∫•u h√¨nh sai, h√£y sao l∆∞u c·∫•u h√¨nh ban ƒë·∫ßu.</p><p>C·∫•u h√¨nh nh∆∞ sau:</p><div class="language-yaml line-numbers-mode" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># C·∫•u h√¨nh c·ªïng d·ªãch v·ª•</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">server</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  port</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">7091</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># T√™n d·ªãch v·ª•</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">spring</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    name</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">seata-server</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># C·∫•u h√¨nh ƒëƒÉng nh·∫≠p giao di·ªán qu·∫£n l√Ω Seata</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">console</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    username</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">seata</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">seata</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># C·∫•u h√¨nh seata-server v√† ƒëƒÉng k√Ω v√†o Nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">seata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  service</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    vgroup-mapping</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      default_tx_group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">default</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    disable-global-transaction</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  config</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      server-addr</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">127.0.0.1:8848</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">SEATA_GROUP</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      username</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  registry</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">seata-server</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      server-addr</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">127.0.0.1:8848</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">SEATA_GROUP</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      username</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    </span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  store</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    mode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">db</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    db</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      url</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">jdbc:mysql://localhost:3306/pmhub-seata?characterEncoding=utf8&amp;useSSL=false</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      user</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">root</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      password</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">123456</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="khoi-ƒëong-seata" tabindex="-1"><a class="header-anchor" href="#khoi-ƒëong-seata"><span>Kh·ªüi ƒë·ªông Seata</span></a></h3><p>V√†o th∆∞ m·ª•c <code>bin</code> c·ªßa Seata v√† kh·ªüi ƒë·ªông theo h·ªá ƒëi·ªÅu h√†nh, v√≠ d·ª• tr√™n macOS c√≥ th·ªÉ d√πng l·ªánh:</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">sh seata-server.sh</span></span></code></pre></div><p>Truy c·∫≠p: <a href="http://localhost:7091/" target="_blank" rel="noopener noreferrer">http://localhost:7091/</a></p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/20240919152345.png" alt="image.png" tabindex="0" loading="lazy"><figcaption>image.png</figcaption></figure><p>Ki·ªÉm tra Nacos ƒë·ªÉ xem Seata ƒë√£ ƒë∆∞·ª£c kh·ªüi ƒë·ªông v√† ƒëƒÉng k√Ω th√†nh c√¥ng v√†o Nacos hay ch∆∞a.</p><h2 id="pmhub-thuc-chien-them-nhiem-vu-quan-ly-giao-dich" tabindex="-1"><a class="header-anchor" href="#pmhub-thuc-chien-them-nhiem-vu-quan-ly-giao-dich"><span>PmHub Th·ª±c Chi·∫øn - Th√™m Nhi·ªám V·ª• Qu·∫£n L√Ω Giao D·ªãch</span></a></h2><p>Khi t·∫°o nhi·ªám v·ª• d·ª± √°n, c·∫ßn th√™m ho·∫∑c c·∫≠p nh·∫≠t c√†i ƒë·∫∑t ph√™ duy·ªát, ƒëi·ªÅu n√†y y√™u c·∫ßu g·ªçi c√°c d·ªãch v·ª• gi·ªØa c√°c c∆° s·ªü d·ªØ li·ªáu kh√°c nhau v√† li√™n quan ƒë·∫øn vi·ªác ch·ªânh s·ª≠a tr√™n c√°c c∆° s·ªü d·ªØ li·ªáu kh√°c nhau trong c√°c microservices kh√°c nhau, do ƒë√≥ c·∫ßn s·ª≠ d·ª•ng x·ª≠ l√Ω giao d·ªãch ph√¢n t√°n.</p><p>D∆∞·ªõi ƒë√¢y l√† s∆° ƒë·ªì quy tr√¨nh c·ª• th·ªÉ cho vi·ªác th√™m nhi·ªám v·ª•:</p><figure><img src="https://raw.githubusercontent.com/vanhung4499/images/master/snap/pmhub-add-task.drawio.png" alt="pmhub-add-task.drawio.png" tabindex="0" loading="lazy"><figcaption>pmhub-add-task.drawio.png</figcaption></figure><h3 id="them-bang-undo-log-vao-co-so-du-lieu-nghiep-vu" tabindex="-1"><a class="header-anchor" href="#them-bang-undo-log-vao-co-so-du-lieu-nghiep-vu"><span>Th√™m b·∫£ng <code>undo_log</code> v√†o c∆° s·ªü d·ªØ li·ªáu nghi·ªáp v·ª•</span></a></h3><p>V√¨ ·ªü ƒë√¢y s·ª≠ d·ª•ng ch·∫ø ƒë·ªô AT c·ªßa Seata, do ƒë√≥ c·∫ßn t·∫°o b·∫£ng <code>undo_log</code> ghi l·∫°i nh·∫≠t k√Ω quay lui trong c∆° s·ªü d·ªØ li·ªáu nghi·ªáp v·ª•, c·ª• th·ªÉ l√† c√°c c∆° s·ªü d·ªØ li·ªáu <code>pmhub-project</code> v√† <code>pmhub-workflow</code>. D∆∞·ªõi ƒë√¢y l√† c√¢u l·ªánh t·∫°o b·∫£ng:</p><div class="language-sql" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- for AT mode you must to init this sql for you business database. the seata server not need it.</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `undo_log`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `branch_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">     BIGINT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;branch transaction id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `xid`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">           VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;global transaction id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `context`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;undo_log context,such as serialization&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `rollback_info`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> LONGBLOB     </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;rollback info&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `log_status`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    INT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">11</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)      </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;0:normal status,1:defense status&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `log_created`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;create datetime&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `log_modified`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;modify datetime&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    UNIQUE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `ux_undo_log`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`xid`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`branch_id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> InnoDB AUTO_INCREMENT </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4 COMMENT </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;AT transaction mode undo table&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `undo_log`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> ADD</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `ix_log_created`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`log_created`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span></code></pre></div><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>L∆∞u √Ω quan tr·ªçng:</p><p>N·∫øu phi√™n b·∫£n c·ªßa b·∫°n g·∫∑p l·ªói: &quot;undo_log needs to contain the primary key&quot;, b·∫°n c·∫ßn th√™m kh√≥a ch√≠nh th·ªß c√¥ng cho b·∫£ng <code>undo_log</code>. B·∫°n c≈©ng c√≥ th·ªÉ sao ch√©p SQL d∆∞·ªõi ƒë√¢y ƒë·ªÉ t·∫°o b·∫£ng tr·ª±c ti·∫øp.</p></div><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- for AT mode you must to init this sql for you business database. the seata server not need it.</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> IF</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NOT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> EXISTS</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `undo_log`</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> BIGINT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> AUTO_INCREMENT,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `branch_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">     BIGINT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;branch transaction id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `xid`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">           VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;global transaction id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `context`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">       VARCHAR</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">128</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;undo_log context,such as serialization&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `rollback_info`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> LONGBLOB     </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;rollback info&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `log_status`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    INT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">11</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)      </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;0:normal status,1:defense status&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `log_created`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">   DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;create datetime&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">    `log_modified`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  DATETIME</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">6</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)  </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;modify datetime&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">),</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    UNIQUE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `ux_undo_log`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`xid`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">, </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`branch_id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">    ) ENGINE </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> InnoDB AUTO_INCREMENT </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> utf8mb4 COMMENT </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;AT transaction mode undo table&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">ALTER</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `undo_log`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> ADD</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> INDEX</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `ix_log_created`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`log_created`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- ----------------------------</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- Records of undo_log</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">-- ----------------------------</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">BEGIN</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">COMMIT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="them-phu-thuoc-vao-pmhub-project" tabindex="-1"><a class="header-anchor" href="#them-phu-thuoc-vao-pmhub-project"><span>Th√™m ph·ª• thu·ªôc v√†o <code>pmhub-project</code>:</span></a></h3><div class="language-xml" data-highlighter="shiki" data-ext="xml" data-title="xml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">&lt;!--Giao d·ªãch ph√¢n t√°n--&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;com.laigeoffer.pmhub-cloud&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">groupId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">  &lt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;pmhub-base-seata&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">artifactId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;/</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">dependency</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span></span></code></pre></div><h3 id="them-cau-hinh-seata-vao-tep-cau-hinh-pmhub-project-dev-yml" tabindex="-1"><a class="header-anchor" href="#them-cau-hinh-seata-vao-tep-cau-hinh-pmhub-project-dev-yml"><span>Th√™m c·∫•u h√¨nh seata v√†o t·ªáp c·∫•u h√¨nh <code>pmhub-project-dev.yml</code>:</span></a></h3><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># Giao d·ªãch ph√¢n t√°n</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">seata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  registry</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      server-addr</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">127.0.0.1:8848</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      namespace</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">SEATA_GROUP</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">seata-server</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  tx-service-group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">default_tx_group</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # Nh√≥m giao d·ªãch, d√πng ƒë·ªÉ nh·∫≠n t√™n c·ªßa c·ª•m TC service</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  service</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    vgroup-mapping</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      default_tx_group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">default</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # M·ªëi quan h·ªá √°nh x·∫° gi·ªØa nh√≥m giao d·ªãch v√† c·ª•m d·ªãch v·ª• TC</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  data-source-proxy-mode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">AT</span></span></code></pre></div><hr><h3 id="them-annotation-globaltransactional-vao-interface" tabindex="-1"><a class="header-anchor" href="#them-annotation-globaltransactional-vao-interface"><span>Th√™m annotation <code>@GlobalTransactional</code> v√†o interface</span></a></h3><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">GlobalTransactional</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">name</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;pmhub-project-addTask&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> rollbackFor</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Exception</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">class</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) </span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">// giao d·ªãch ph√¢n t√°n seata, ch·∫ø ƒë·ªô AT</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> add</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TaskReqVO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> taskReqVO) {</span></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Ki·ªÉm tra xid c·ªßa giao d·ªãch to√†n c·ª•c (ƒë·ªÉ d·ªÖ d√†ng theo d√µi)</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> xid </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> RootContext</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getXID</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;---------------B·∫Øt ƒë·∫ßu t·∫°o nhi·ªám v·ª•: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\t</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;xid: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> xid);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ProjectStatusEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PAUSE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getStatus</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">projectTaskMapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">queryProjectStatus</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getProjectId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()))</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ServiceException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;D·ª± √°n hi·ªán ƒëang t·∫°m d·ª´ng, kh√¥ng th·ªÉ th√™m nhi·ªám v·ª• m·ªõi&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 1. Th√™m nhi·ªám v·ª•</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    ProjectTask</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> projectTask </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ProjectTask</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">StringUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isNotBlank</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTaskId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setTaskPid</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTaskId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    BeanUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">copyProperties</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(taskReqVO, projectTask);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setCreatedBy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setCreatedTime</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUpdatedBy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUpdatedTime</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    projectTaskMapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">insert</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(projectTask);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 2. Th√™m th√†nh vi√™n nhi·ªám v·ª•</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    insertMember</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 3. Th√™m nh·∫≠t k√Ω</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    saveLog</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;addTask&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getProjectId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTaskName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;Tham gia v√†o nhi·ªám v·ª•&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // Th√™m ng∆∞·ªùi th·ª±c hi·ªán nhi·ªám v·ª•</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> &amp;&amp;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> !</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Objects</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(), </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        insertMember</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">        // Th√™m nh·∫≠t k√Ω</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">        saveLog</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;invitePartakeTask&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getProjectId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTaskName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">                &quot;M·ªùi &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> projectMemberMapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">selectUserById</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Collections</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">singletonList</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">get</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">0</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getNickName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot; tham gia v√†o nhi·ªám v·ª•&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 4. Nh·∫Øc nh·ªü v·ªÅ nhi·ªám v·ª• ƒë√£ ƒë∆∞·ª£c ch·ªâ ƒë·ªãnh</span></span>
<span class="line"><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">    extracted</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getTaskName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUserId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;">    // 5. Th√™m ho·∫∑c c·∫≠p nh·∫≠t c√†i ƒë·∫∑t ph√™ duy·ªát (g·ªçi t·ª´ xa ƒë·∫øn microservice `pmhub-workflow`)</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    ApprovalSetDTO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> approvalSetDTO </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ApprovalSetDTO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> ProjectStatusEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">TASK</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getStatusName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">            taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getApproved</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getDefinitionId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(),</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> taskReqVO</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getDeploymentId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    R</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> result </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> wfDeployService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">insertOrUpdateApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(approvalSetDTO, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityConstants</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">INNER</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Objects</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isNull</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(result)</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> ||</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> Objects</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">isNull</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())</span></span>
<span class="line"><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">            ||</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> R</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">fail</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">().</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">equals</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">result</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getData</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">())</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">        throw</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> ServiceException</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;G·ªçi t·ª´ xa ƒë·∫øn d·ªãch v·ª• ph√™ duy·ªát th·∫•t b·∫°i&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">info</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;---------------K·∫øt th√∫c t·∫°o nhi·ªám v·ª•: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">\t</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;xid: &quot;</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> +</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> xid);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> projectTask</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">();</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="bang-du-lieu" tabindex="-1"><a class="header-anchor" href="#bang-du-lieu"><span>B·∫£ng d·ªØ li·ªáu</span></a></h3><ul><li><strong>pmhub_project_task</strong>:</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">pmhub_project_task</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">` (</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Primary key id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `created_by`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Creator&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `created_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Creation time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `updated_by`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Updater&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `updated_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Update time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `task_name`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task name&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `project_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `task_priority`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> tinyint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task priority&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `user_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;User id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `project_stage_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project stage id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `description`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task description&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `begin_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Planned start time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `end_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Planned end time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `close_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Deadline&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `task_pid`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Parent task&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `assign_to`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Assigned to&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `status`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> tinyint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task status&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `execute_status`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> tinyint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Execution status&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `task_process`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> decimal</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">5</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">2</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0.00&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task progress&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `deleted`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> tinyint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Deleted or not&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `deleted_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `task_flow`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">200</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task flow&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `task_type_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Task type id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> BTREE,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  KEY</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> `idx`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`project_id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`user_id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> BTREE</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">InnoDB </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">utf8mb4 COMMENT</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project-Task table&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>pmhub_project_member</strong>:</li></ul><div class="language-sql" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">pmhub_project_member</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">` (</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Primary key id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `pt_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project or task id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `user_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;User id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `joined_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Join time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `created_by`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Creator&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `created_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Creation time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `updated_by`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">100</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Updater&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `updated_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Update time&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `type`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Type: project or task&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `creator`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> tinyint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;0&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Whether the creator&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> BTREE</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">InnoDB </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">utf8mb4 COMMENT</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project-Task Member&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><ul><li><strong>pmhub_project_log</strong>:</li></ul><div class="language-sql line-numbers-mode" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">pmhub_project_log</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">` (</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Primary key id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `user_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Operator id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `type`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">16</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Type: project or task&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `operate_type`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Operation type&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `content`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> text</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Operation content&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `remark`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Remarks&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `pt_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project or task id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `to_user_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> bigint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `created_by`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `created_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `updated_by`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `updated_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `log_type`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> tinyint</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">1</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &#39;1&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;1-Activity 2-Deliverable 3-Comment&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `file_url`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">500</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;File URL&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `icon`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">20</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `project_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> COMMENT </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project id&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> BTREE</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">InnoDB </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">utf8mb4 COMMENT</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;Project-Task Log&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pmhub-thuc-chien-tao-moi-cap-nhat-trang-thai-phe-duyet" tabindex="-1"><a class="header-anchor" href="#pmhub-thuc-chien-tao-moi-cap-nhat-trang-thai-phe-duyet"><span>PmHub Th·ª±c Chi·∫øn - T·∫°o M·ªõi/C·∫≠p Nh·∫≠t Tr·∫°ng Th√°i Ph√™ Duy·ªát</span></a></h2><p>API:</p><div class="language-java" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">InnerAuth</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PostMapping</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;/updateApprovalSet&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">DistributedLock</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">key</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;#approvalSetDTO.approved&quot;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> lockTime</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> 10L</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> keyPrefix</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;"> =</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;"> &quot;workflow-approve-&quot;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">)  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> R</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&lt;</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">?</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">&gt;</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> updateApprovalSet</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ApprovalSetDTO</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> approvalSetDTO) {  </span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> R</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">ok</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">deployService</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">updateApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(approvalSetDTO, </span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">ProjectStatusEnum</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">PROJECT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getStatusName</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">()));</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre></div><p>C·ª• th·ªÉ th·ª±c hi·ªán m√£:</p><div class="language-java line-numbers-mode" data-highlighter="shiki" data-ext="java" data-title="java" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">@</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">Override</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">public</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> boolean</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> insertOrUpdateApprovalSet</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> extraId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> approved</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> definitionId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> String</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> deploymentId) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    LambdaQueryWrapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">WfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> qw </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> LambdaQueryWrapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">&lt;&gt;</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    qw</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">eq</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(WfApprovalSet</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">::</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">getExtraId, extraId).</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">eq</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(WfApprovalSet</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">::</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">getType, type);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">    WfApprovalSet</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> mas </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;"> wfApprovalSetMapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">selectOne</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(qw);</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    if</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> (mas </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">!=</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> null</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">) {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        mas</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setApproved</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(approved);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        mas</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setDefinitionId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(definitionId);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        mas</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setDeploymentId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(deploymentId);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        mas</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUpdatedBy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        mas</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUpdatedTime</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSetMapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">updateById</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(mas);</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    } </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">else</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> {</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        WfApprovalSet</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;"> wfApprovalSet </span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> WfApprovalSet</span><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">()</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setExtraId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(extraId);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setType</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(type);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setApproved</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(approved);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setDefinitionId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(definitionId);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setDeploymentId</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(deploymentId);</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setCreatedBy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setCreatedTime</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUpdatedBy</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">SecurityUtils</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">getUsername</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSet</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">setUpdatedTime</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">new</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;"> Date</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">());</span></span>
<span class="line"><span style="--shiki-light:#E5C07B;--shiki-dark:#E5C07B;">        wfApprovalSetMapper</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">.</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">insert</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(wfApprovalSet);</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">    return</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;"> true</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Li√™n quan ƒë·∫øn c∆° s·ªü d·ªØ li·ªáu v√† b·∫£ng:</p><p>C∆° s·ªü d·ªØ li·ªáu: pmhub-workflow</p><p>B·∫£ng: pmhub_wf_approval_set</p><div class="language-sql" data-highlighter="shiki" data-ext="sql" data-title="sql" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">CREATE</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> TABLE</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> `</span><span style="--shiki-light:#61AFEF;--shiki-dark:#61AFEF;">pmhub_wf_approval_set</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">` (</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">NOT NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `type`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `approved`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">10</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `deployment_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `definition_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `created_by`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `created_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `updated_by`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">64</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `updated_time`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> datetime</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">  `extra_id`</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> varchar</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#D19A66;--shiki-dark:#D19A66;">32</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;"> NULL</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">,</span></span>
<span class="line"><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">  PRIMARY KEY</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> (</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">`id`</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">USING</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> BTREE</span></span>
<span class="line"><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">) ENGINE</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">InnoDB </span><span style="--shiki-light:#C678DD;--shiki-dark:#C678DD;">DEFAULT</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;"> CHARSET</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">utf8mb4 COMMENT</span><span style="--shiki-light:#56B6C2;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&#39;B·∫£ng c·∫•u h√¨nh tr·∫°ng th√°i ph√™ duy·ªát&#39;</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">;</span></span></code></pre></div><p>C·∫•u h√¨nh th√™m cho d·ªãch v·ª• <code>pmhub-workflow-dev.yml</code>:</p><div class="language-yaml" data-highlighter="shiki" data-ext="yaml" data-title="yaml" style="--shiki-light:#abb2bf;--shiki-dark:#abb2bf;--shiki-light-bg:#282c34;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-dark-pro one-dark-pro vp-code"><code><span class="line"><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"># C·∫•u h√¨nh giao d·ªãch ph√¢n t√°n</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">seata</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  registry</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    type</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">nacos</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    nacos</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      server-addr</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">127.0.0.1:8848</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      namespace</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">SEATA_GROUP</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      application</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">seata-server</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  tx-service-group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">default_tx_group</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # Nh√≥m giao d·ªãch, nh·∫≠n t√™n c·ªßa c·ª•m d·ªãch v·ª• TC</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  service</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">:</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">    vgroup-mapping</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">      default_tx_group</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">default</span><span style="--shiki-light:#7F848E;--shiki-dark:#7F848E;--shiki-light-font-style:italic;--shiki-dark-font-style:italic;"> # M·ªëi quan h·ªá √°nh x·∫° gi·ªØa nh√≥m giao d·ªãch v√† c·ª•m d·ªãch v·ª• TC</span></span>
<span class="line"><span style="--shiki-light:#E06C75;--shiki-dark:#E06C75;">  data-source-proxy-mode</span><span style="--shiki-light:#ABB2BF;--shiki-dark:#ABB2BF;">: </span><span style="--shiki-light:#98C379;--shiki-dark:#98C379;">AT</span></span></code></pre></div><h2 id="cau-hoi-phong-van" tabindex="-1"><a class="header-anchor" href="#cau-hoi-phong-van"><span>C√¢u h·ªèi ph·ªèng v·∫•n</span></a></h2><p><strong>1. B·∫°n ƒë√£ vi·∫øt v·ªÅ giao d·ªãch ph√¢n t√°n trong CV, b·∫°n ƒë√£ th·ª±c hi·ªán n√≥ nh∆∞ th·∫ø n√†o?</strong></p><p>ƒê√¢y l√† m·ªôt c√¢u h·ªèi kh√° r·ªông, b·∫°n c·∫ßn ph·∫£i hi·ªÉu r√µ c√°ch m√† PmHub k·∫øt h·ª£p v·ªõi giao d·ªãch ph√¢n t√°n. H√£y t·ªï ch·ª©c ng√¥n ng·ªØ theo hi·ªÉu bi·∫øt c·ªßa b·∫°n ƒë·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi n√†y.</p><p><strong>2. Ch·∫ø ƒë·ªô Seata-AT c·ªßa Alibaba l√†m th·∫ø n√†o ƒë·ªÉ kh√¥ng x√¢m nh·∫≠p v√†o m√£ nghi·ªáp v·ª•?</strong></p><p>Sau khi c·∫•u h√¨nh k·∫øt n·ªëi t·∫°i ph√≠a kh√°ch h√†ng, ch·∫ø ƒë·ªô Seata-AT s·∫Ω th√™m b·∫£ng <code>undo_log</code> v√†o c∆° s·ªü d·ªØ li·ªáu nghi·ªáp v·ª•. Ch·∫ø ƒë·ªô Seata-AT s·∫Ω t·ª± ƒë·ªông t·∫°o v√† qu·∫£n l√Ω <code>undo_log</code> tr∆∞·ªõc v√† sau khi th·ª±c thi ph∆∞∆°ng th·ª©c nghi·ªáp v·ª•, nh·∫±m ghi l·∫°i h√¨nh ·∫£nh tr∆∞·ªõc v√† sau c·ªßa d·ªØ li·ªáu.</p><p>N√≥ th·ª±c hi·ªán qu·∫£n l√Ω giao d·ªãch t·ª± ƒë·ªông th√¥ng qua proxy, b·∫±ng c√°ch c·∫•u h√¨nh proxy ngu·ªìn d·ªØ li·ªáu c·ªßa Seata, t·∫•t c·∫£ c√°c thao t√°c c∆° s·ªü d·ªØ li·ªáu s·∫Ω b·ªã Seata ch·∫∑n v√† qu·∫£n l√Ω giao d·ªãch.</p><p>Ch·∫ø ƒë·ªô Seata-AT th·ª±c hi·ªán giao th·ª©c hai giai ƒëo·∫°n t·ª± ƒë·ªông (2PC), bao g·ªìm giai ƒëo·∫°n chu·∫©n b·ªã v√† giai ƒëo·∫°n cam k·∫øt/ho√†n t√°c. Khi giao d·ªãch ƒë∆∞·ª£c cam k·∫øt, Seata s·∫Ω th·ª±c hi·ªán thao t√°c chu·∫©n b·ªã (ghi l·∫°i <code>undo_log</code>), sau ƒë√≥ quy·∫øt ƒë·ªãnh cam k·∫øt ho·∫∑c ho√†n t√°c d·ª±a tr√™n t√¨nh tr·∫°ng c·ªßa c√°c giao d·ªãch ph√¢n nh√°nh.</p><div class="hint-container info"><p class="hint-container-title">Info</p><p>Ch·∫ø ƒë·ªô Seata-AT th·ª±c hi·ªán vi·ªác kh√¥ng x√¢m nh·∫≠p v√†o m√£ nghi·ªáp v·ª• qua c√°c c√°ch sau:</p><ul><li>T·ª± ƒë·ªông t·∫°o v√† qu·∫£n l√Ω <code>undo_log</code>.</li><li>Ch·∫∑n c√°c thao t√°c c∆° s·ªü d·ªØ li·ªáu v√† giao d·ªãch th√¥ng qua proxy.</li><li>C·∫•u h√¨nh ƒë∆°n gi·∫£n b·∫±ng c√°ch s·ª≠ d·ª•ng annotation ƒë·ªÉ k√≠ch ho·∫°t qu·∫£n l√Ω giao d·ªãch ph√¢n t√°n.</li><li>T·ª± ƒë·ªông x·ª≠ l√Ω qu√° tr√¨nh cam k·∫øt v√† ho√†n t√°c trong hai giai ƒëo·∫°n.</li></ul><p>Nh√† ph√°t tri·ªÉn ch·ªâ c·∫ßn th√™m annotation v√†o ph∆∞∆°ng th·ª©c nghi·ªáp v·ª• m√† kh√¥ng c·∫ßn thay ƒë·ªïi logic nghi·ªáp v·ª• ban ƒë·∫ßu v√† c√°ch th·ª©c thao t√°c c∆° s·ªü d·ªØ li·ªáu, gi√∫p ƒë∆°n gi·∫£n h√≥a r·∫•t nhi·ªÅu vi·ªác tri·ªÉn khai giao d·ªãch ph√¢n t√°n.</p></div><p><strong>Trong giai ƒëo·∫°n ƒë·∫ßu, Seata s·∫Ω ch·∫∑n ‚ÄúSQL nghi·ªáp v·ª•‚Äù</strong>,</p><ol><li><p>Ph√¢n t√≠ch c√∫ ph√°p SQL ƒë·ªÉ t√¨m d·ªØ li·ªáu nghi·ªáp v·ª• m√† ‚ÄúSQL nghi·ªáp v·ª•‚Äù c·∫ßn c·∫≠p nh·∫≠t. Tr∆∞·ªõc khi d·ªØ li·ªáu nghi·ªáp v·ª• ƒë∆∞·ª£c c·∫≠p nh·∫≠t, Seata s·∫Ω l∆∞u l·∫°i h√¨nh ·∫£nh tr∆∞·ªõc c·ªßa n√≥ (&quot;before image&quot;).</p></li><li><p>Th·ª±c thi &quot;SQL nghi·ªáp v·ª•&quot; ƒë·ªÉ c·∫≠p nh·∫≠t d·ªØ li·ªáu nghi·ªáp v·ª•. Sau khi c·∫≠p nh·∫≠t, Seata s·∫Ω l∆∞u l·∫°i h√¨nh ·∫£nh sau (&quot;after image&quot;) v√† cu·ªëi c√πng t·∫°o kh√≥a h√†ng.</p></li></ol><p>T·∫•t c·∫£ c√°c thao t√°c tr√™n ƒë·ªÅu ƒë∆∞·ª£c ho√†n th√†nh trong m·ªôt giao d·ªãch c∆° s·ªü d·ªØ li·ªáu, ƒë·∫£m b·∫£o t√≠nh nguy√™n t·ª≠ c·ªßa giai ƒëo·∫°n ƒë·∫ßu.</p><figure><img src="https://cdn.nlark.com/yuque/0/2024/png/29495295/1719395526981-e02f9478-7727-42c1-8948-975d261a7553.png" alt="Seata Giai ƒëo·∫°n 1" tabindex="0" loading="lazy"><figcaption>Seata Giai ƒëo·∫°n 1</figcaption></figure><p><strong>Giai ƒëo·∫°n hai khi cam k·∫øt th√†nh c√¥ng:</strong></p><div class="hint-container info"><p class="hint-container-title">Info</p><p>N·∫øu giai ƒëo·∫°n hai ƒë∆∞·ª£c cam k·∫øt th√†nh c√¥ng,</p><p>V√¨ ‚ÄúSQL nghi·ªáp v·ª•‚Äù ƒë√£ ƒë∆∞·ª£c cam k·∫øt v·ªõi c∆° s·ªü d·ªØ li·ªáu trong giai ƒëo·∫°n ƒë·∫ßu, n√™n khung Seata ch·ªâ c·∫ßn x√≥a d·ªØ li·ªáu snapshot v√† kh√≥a h√†ng ƒë√£ l∆∞u trong giai ƒëo·∫°n ƒë·∫ßu ƒë·ªÉ ho√†n t·∫•t vi·ªác d·ªçn d·∫πp d·ªØ li·ªáu.</p><figure><img src="https://cdn.nlark.com/yuque/0/2024/png/29495295/1719395592766-12f22df4-c88d-4495-b3d0-e8fd2c776603.png" alt="Seata Giai ƒëo·∫°n 2" tabindex="0" loading="lazy"><figcaption>Seata Giai ƒëo·∫°n 2</figcaption></figure></div><p><strong>Giai ƒëo·∫°n hai khi g·∫∑p s·ª± c·ªë:</strong></p><div class="hint-container info"><p class="hint-container-title">Info</p><p>Trong tr∆∞·ªùng h·ª£p ph·∫£i ho√†n t√°c ·ªü giai ƒëo·∫°n hai:</p><!----><p>C√°ch ho√†n t√°c l√† s·ª≠ d·ª•ng ‚Äúbefore image‚Äù ƒë·ªÉ kh√¥i ph·ª•c d·ªØ li·ªáu nghi·ªáp v·ª•. Tuy nhi√™n, tr∆∞·ªõc khi kh√¥i ph·ª•c, Seata c·∫ßn ki·ªÉm tra vi·∫øt b·∫©n b·∫±ng c√°ch so s√°nh d·ªØ li·ªáu hi·ªán t·∫°i trong c∆° s·ªü d·ªØ li·ªáu v√† ‚Äúafter image‚Äù.</p><p>N·∫øu hai b·∫£n d·ªØ li·ªáu gi·ªëng nhau, ƒëi·ªÅu ƒë√≥ c√≥ nghƒ©a l√† kh√¥ng c√≥ vi·∫øt b·∫©n v√† c√≥ th·ªÉ kh√¥i ph·ª•c d·ªØ li·ªáu. <!----></p><figure><img src="https://cdn.nlark.com/yuque/0/2024/png/29495295/1719395636269-91d4ff83-d0d7-4c05-a3fb-56f209d8d525.png" alt="Seata Giai ƒëo·∫°n 2 - Ho√†n t√°c" tabindex="0" loading="lazy"><figcaption>Seata Giai ƒëo·∫°n 2 - Ho√†n t√°c</figcaption></figure></div><p><strong>3. C√°c gi·∫£i ph√°p cho giao d·ªãch ph√¢n t√°n l√† g√¨?</strong></p><p>C√≥ 6 gi·∫£i ph√°p ch√≠nh ƒë·ªÉ tri·ªÉn khai giao d·ªãch ph√¢n t√°n:</p><ul><li>Gi·∫£i ph√°p XA</li><li>Gi·∫£i ph√°p TCC</li><li>Gi·∫£i ph√°p SAGA</li><li>B·∫£ng th√¥ng ƒëi·ªáp c·ª•c b·ªô</li><li>Gi·∫£i ph√°p ƒë·∫£m b·∫£o th√¥ng ƒëi·ªáp cu·ªëi c√πng nh·∫•t qu√°n</li><li>Gi·∫£i ph√°p th√¥ng b√°o n·ªó l·ª±c t·ªëi ƒëa</li></ul><p>B·∫°n c√≥ th·ªÉ xem th√™m t√†i li·ªáu ƒë·ªÉ hi·ªÉu r√µ h∆°n v·ªÅ c√°c gi·∫£i ph√°p n√†y.</p></div><!----><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/vanhung4499/my-wiki/edit/main/src/project/pmhub/distributed-transaction.md" aria-label="Edit this page on GitHub" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->Edit this page on GitHub<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">Last update: </span><!----></div><div class="contributors"><span class="vp-meta-label">Contributors: </span><!--[--><!--[--><span class="vp-meta-info" title="email: vanhung4499@gmail.com">Hung Nguyen Van</span><!--]--><!--]--></div></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper" style="display:none;--1ea755b8:;"><div class="footer-content"><div class="footer">Made with ‚ù§Ô∏è by Hung Nguyen</div><div class="copyright">Copyright ¬© 2016-2024 Hung Nguyen</div></div><span id="runtime_span"></span></footer></div><!--]--><!--[--><!----><!----><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CmlOSuIY.js" defer></script>
  </body>
</html>
